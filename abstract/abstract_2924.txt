BACKGROUND
structure elucidation of unknown small molecules by mass spectrometry is a challenge despite advances in instrumentation. the first crucial step is to obtain correct elemental compositions. in order to automatically constrain the thousands of possible candidate structures, rules need to be developed to select the most likely and chemically correct molecular formulas.


RESULTS
an algorithm for filtering molecular formulas is derived from seven heuristic rules:  restrictions for the number of elements,  lewis and senior chemical rules,  isotopic patterns,  hydrogen/carbon ratios,  element ratio of nitrogen, oxygen, phosphor, and sulphur versus carbon,  element ratio probabilities and  presence of trimethylsilylated compounds. formulas are ranked according to their isotopic patterns and subsequently constrained by presence in public chemical databases. the seven rules were developed on  <dig>  existing molecular formulas and were validated in four experiments. first,  <dig>  formulas covering five million pubchem database entries were checked for consistency. only  <dig> % of these compounds did not pass all rules. next, the rules were shown to effectively reducing the complement all eight billion theoretically possible c, h, n, s, o, p-formulas up to  <dig> da to only  <dig> million most probable elemental compositions. thirdly  <dig>  pharmaceutical, toxic and natural compounds were selected from drugbank, tsca and dnp databases. the correct formulas were retrieved as top hit at 80–99% probability when assuming data acquisition with complete resolution of unique compounds and 5% absolute isotope ratio deviation and  <dig> ppm mass accuracy. last, some exemplary compounds were analyzed by fourier transform ion cyclotron resonance mass spectrometry and by gas chromatography-time of flight mass spectrometry. in each case, the correct formula was ranked as top hit when combining the seven rules with database queries.


CONCLUSIONS
the seven rules enable an automatic exclusion of molecular formulas which are either wrong or which contain unlikely high or low number of elements. the correct molecular formula is assigned with a probability of 98% if the formula exists in a compound database. for truly novel compounds that are not present in databases, the correct formula is found in the first three hits with a probability of 65–81%. corresponding software and supplemental data are available for downloads from the authors' website.

