BACKGROUND
in serial analysis of gene expression , mrna is extracted from a tissue sample and converted to cdna, from which oligonucleotides  at specific locations in the cdna fragments are extracted and amplified using pcr. those tags are either ten or seventeen bases long, depending on the experimental protocol. sequencing the pcr product, it is possible to establish the number of copies of each tag extracted. . ideally, there would be a one-to-one relation between tags and genes, so that the number of copies of a tag would be an indicator of the rate of transcription of the corresponding gene. suppose the tissue sample contained nt copies of tag t each of which have a probability p of being extracted. the exact magnitude of p is unknown  but is certainly much smaller than  <dig> ), which suggests modeling the number yt of observed copies of tag t  as poisson distributed with intensity λt = pnt.

a poisson model predicts a  number of zero counts, i.e. tags with positive lambda-values that just happened not to be counted. those cannot be distinguished from tags that do not exist at all or are never transcribed. the problem of estimating the total number of expressible tags  was studied by stern  <cit> , who found the number of tags expressed at each level to be inversely proportional to the square of the expression level. stern concluded that the size of the transcriptome could not be reliably estimated from sage data. part of the problem is that a substantial part of the low-expressed tags may be artifactual, which is difficult to incorporate in the model. . kuznetsov  <cit> ,  <cit>  modeled the sage data using a discrete pareto-like distribution and found that his model was able to predict the number of transcripts expressed at a level of ≥  <dig> copy per cell. although this was a major breakthrough, the discrete pareto-like distribution models the counts directly, which means that sample variance is not explicitly separated from the variance in gene expression. the model that we explore in this paper is an hierarchical poisson model, i.e. a poisson distribution with some prior distribution f of poisson parameter λ

yt ~ poisson, λt ~ f     

where yt is the observed count for tag t, λt is the "true" expression level of tag t and θ is some parameter in the model. for the prior f we tried a number of candidates . the gamma prior turned out to provide a good fit to the distributions of the tag counts for counts lower than a certain threshold, typically the 98th or 99th percentile. attempts to model the tag counts above that threshold with a second gamma-distributed component failed, not surprisingly since the number of tags in that range was too small to support meaningful estimates.

for the purpose of this paper we choose the gamma distribution, whose parameters were estimated with an empirical bayesian approach  <cit> . the choice of the gamma distribution was motivated by mathematical convenience only. the gamma distribution is the conjugate prior of the poisson distribution, i.e. if the parameters α and β are known, the posterior distribution of λt given yt is distributed as gamma this is convenient because the posterior distribution of γ represents our knowledge of the true gene expression after the sage count has been observed. also, since 1/β is a scale parameter in the gamma distribution, libraries of different size can be compared. other things being equal, we expect the estimated value of β to be inversely proportional to the library size.

the marginal distribution of y becomes a negative binomial distribution:

p=ΓΓy!βαy+α     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgqbaucqggoaakcqwgzbqwcqgh9aqpcqwg5bqecqggpaqkcqgh9aqpdawcaaqaaiabfo5ahjabcicaoiabdmha5jabgucarggaciab=f7ahjabcmcapaqaaiabfo5ahjabcicaoiab=f7ahjabcmcapiabdmha5jabcgcahaaadawcaaqaaiab=j7ainaacaaaleqabagae8xsdegaaagcbagaeiikagiae8nsdimaey4kasiaegymaejaeiykakyaawbaasqabeaacqwg5bqecqghrawkcqwfxoqyaaaaaogaaczcaiaaxmaadaqadaqaaiabikdayagaayjkaiaawmcaaaaa@52f9@

and in particular

p=α     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgqbaucqggoaakcqwgzbqwcqgh9aqpcqaiwaamcqggpaqkcqgh9aqpdaqadaqaamaalaaabaaccigae8nsdigabagae8nsdimaey4kasiaegymaedaaagaayjkaiaawmcaamaacaaaleqabagae8xsdegaaogaaczcaiaaxmaadaqadaqaaiabiodazagaayjkaiaawmcaaaaa@3ffd@

since the zero counts are not recorded, the counts of the recorded tags follow a zero-truncated negative binomial distribution

p=ΓΓy!βαy+α11−α     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgqbaucqggoaakcqwgzbqwcqgh9aqpcqwg5bqecqgg8bafcqwgzbqwcqgh+agpcqaiwaamcqggpaqkcqgh9aqpdawcaaqaaiabfo5ahjabcicaoiabdmha5jabgucarggaciab=f7ahjabcmcapaqaaiabfo5ahjabcicaoiab=f7ahjabcmcapiabdmha5jabcgcahaaadawcaaqaaiab=j7ainaacaaaleqabagae8xsdegaaagcbagaeiikagiae8nsdimaey4kasiaegymaejaeiykakyaawbaasqabeaacqwg5bqecqghrawkcqwfxoqyaaaaaowaasaaaeaacqaixaqmaeaacqaixaqmcqghsisldaqadaqaamaalaaabagae8nsdigabagae8nsdimaey4kasiaegymaedaaagaayjkaiaawmcaamaacaaaleqabagae8xsdegaaaaakiaaxmaacawljawaaewaaeaacqai0aanaiaawicacaglpaaaaaa@62ff@

the zero-truncated negative binomial distribution has been studied by several authors, mainly for modeling group sizes. see johnson  <cit>  for an overview. schenzle  <cit>  studied the efficiency of various estimation methods for the parameters and reached the conclusion that for α <  <dig> heuristic methods do not work and ml estimation should be used instead.

if such a model can provide a good fit to the data, it will be useful for several purposes. for example, knowing the posterior distribution of λt given yt, one can construct a variance-stabilizing transform for a sage library. also, in order to assess the sensitivity of the sage technology with respect to genes with low expression levels, one needs to know the distribution of λ. the idea of applying poisson models to sage data is not new. cai  <cit>  found a poisson-based gene clustering algorithm to work better than one based on euclidian distances. and several authors  have compared poisson-based tests for differentiation in gene expression between libraries. however, those tests always look at a single sage tag at a time and tests for difference in the parameter λ across the libraries. as noted by baggerly  <cit> , it is possible that a model that incorporates all tags simultaneously, analogous to the models applied to microarray data, would be more powerful. this motivates our attempt to model the behavior of λ across genes. in this paper, we present a truncated gamma-poisson model augmented with a non-parametric component, as well as a bivariate truncated gamma-poisson model that can be used to comparing two libraries, and we show how the parameters can be estimated in those models.

RESULTS
untruncated gamma-poisson, ml and method of moments
in the human transcriptome map, genes with zero counts were reported, which allowed for the untruncated negative binomial model to be used. while the maximum likelihood  method worked quite well with simulated data, it did not provide meaningful results with the data from the human transcriptome map, presumably because of the failure to account for a small population of tags with extremely high counts . because those tags had high influence on the likelihood function, it was necessary to take them into account. therefore, we assumed the expressed tags to be a mixture of two populations: a large population of tags with expression levels below some threshold k, described by the gamma-poisson model, and a small population of tags with expressions at or above k, described by a non-parametric distribution. because the maximum likelihood estimator itself requires iteration, we decided to use a heuristic to choose the threshold k and the start-guess for the maximum likelihood estimator .

as for the human transcriptome map, the model provided a good fit to the counts for tags of low to moderate expression, but for all  <dig> libraries it was necessary to assume a non-parametric component accounting for the extremely strongly expressed genes. figure  <dig> shows the expected frequencies versus the observed frequencies for htm library n <dig> k , which was the largest library.

the quartiles of the estimated parameters for the  <dig> libraries are shown in table  <dig> 

we expected the estimated parameter β to scale with the inverse of the library size, and indeed we found a clear negative correlation between log and log, r = - <dig> .

using the estimates from n <dig> k  as an example, variance of λ is α/β <dig> =  <dig> .

the average sampling variance is identical to the mean, α/β =  <dig> . those average variances, however, hide huge differences in information content between tags with different expression levels: the coefficient of variation of the posterior λt given a count yt is 1/yt+α
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqaixaqmcqggvawldagcaaqaaiabdmha5naabaaaleaacqwg0badaeqaaogaey4kascccigae8xsdegaleqaaaaa@3447@

truncated gamma-poisson, maximum likelihood and mcmc
the log-likelihood in the truncated negative binomial model, without the non-parametric component for the high-expressed tags, is

∑t+∑j=0yt−1log−log−logα))     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaaeqbqaamaabmaabaaccigae8xsde2exlmbbxgbcf2cpn2qvrwzqf2zlnharygvljhzh5wyagabciaa+xgacagfvbgaa43zaiabcicaoiab=j7aijabcmcapiabgucarmaaqahabagaa4hbaiaa+9gacagfnbgaeiikagiae8xsdemaey4kasiaemoaaomaeiykakiaeyoei0iaeiikagiae8xsdemaey4kasiaemywak1aasbaasqaaiabdsha0bqabagccqggpaqkcagfsbgaa43baiaa+dgacqggoaakcqwfyogycqghrawkcqaixaqmcqggpaqkcqghsislcagfsbgaa43baiaa+dgadaqadaqaaiabigdaxiabgkhitmaabmaabawaasaaaeaacqwfyogyaeaacqaixaqmcqghrawkcqwfyogyaaaacagloagaayzkaawaawbaasqabeaacqwfxoqyaaaakiaawicacaglpaaaasqaaiabdqgaqjabg2da9iabicdawaqaaiabdmfaznaabaaameaacqwg0badaeqaasgaeyoei0iaegymaedaniabgghildaakiaawicacaglpaaaasqaaiabdsha0bqab0gaeyyeiuoakiaaxmaacawljawaaewaaeaacqai1aqnaiaawicacaglpaaaaaa@7ad0@

we augmented this model with a non-parametric component for the high-expressed genes in the same way as the untruncated model described above.

while the estimate of the rate parameter in the truncated model became reasonably stable, and, as expected, approximately inversely proportional to the library size, the shape parameter became unstable, in particular with real data but also with simulated data.

the rate parameter  in most libraries converged towards the lower bound specified in the call to the maximization routine . a curious exception was gsm <dig>  a small library with only  <dig> tags, which gave an estimate of α of  <dig>  in the censored model as opposed to  <dig>  in the uncensored model. for all the other libraries, the estimate of β for the censored model was in agreement with that from the uncensored model . computations with simulated data did not show a bias on the estimate of α, but still the estimated value of α was very unstable. presumably, this difference between real and simulated data is related to the failure of the model to account for the extreme high-expressed tags, which were modeled with a non-parametric component.

when the parameters in the same model were estimated using mcmc, the rate parameter β was stable and in agreement with the results from the other methods, but the shape parameter  was, again, unstable. the estimated parameters for the htm library n <dig> k  are shown in table  <dig> 

truncated log-normal-poisson, maximum likelihood
instead of incorporating a non-parametric component for the high-expressed genes, one may look for a different prior that has a thicker tail. for that purpose, we used a log-normal prior. from a biological point of view, the log-normal distribution is an attractive model for the true gene expression, because it is conventionally used for analysis of microarray data. the disadvantage of that model, however, is that the marginal distribution of the sage counts cannot be written on closed form. therefore, the likelihood must be evaluated with numerical integration.

a simpler method would be to use the method of moments. since the the probability of a zero count cannot be expressed on closed form, however, numerical integration is still required, though only for the zero counts. unfortunately, experiments with simulated data showed that the parameters estimated by the method of moments were severely biased . the ml-algorithm converged in  <dig> of the  <dig> libraries, the exception being gsm <dig>  the library that also gave contradicting β-estimates for the truncated and untruncated gamma-poisson model. figure  <dig> shows the frequency plot predicted by the truncated log-normal poisson model, compared to the empiric frequency plot. notice that while the model provides a good prediction of the number of strongly expressed tags, it gives a much lower estimate of the number of zero counts than recorded in the data set. that picture is typical.

bivariate truncated gamma-poisson, maximum likelihood, htm data
the fact that the shape parameter in the truncated model could not be estimated on the basis on a single sage library is related to the problem of estimating the number of zero counts. in order to solve this problem we fitted the parameters in a bivariate model applied to two libraries. when two libraries are compared, the tags that have positive counts in one library and zero count in the other are reported. if the correlation between the two libraries could be estimated, the number of tags that had zero counts in both libraries could be estimated as well, and we would get a stable estimate of the shape parameter. see the methods section for details.

we fitted the bivariate model to all pairs from the  <dig> largest libraries. of those  <dig> library pairs, the likelihood maximization algorithm converged in  <dig> cases. in  <dig> of those, the four-parameter-model, allowing α to be different for the two libraries, provided a significantly better fit . this is not surprising, given that there was considerable dispersion across libraries of the estimated α from the untruncated model. with this model, the median of our estimates of the transcriptome size for the subset selected in the htm was median =  <dig> with a quartile range from  <dig> to  <dig>  compared to the  <dig> reported in the htm.

figures  <dig>   <dig> and  <dig> show how the model compares to the observed data when htm library idc- <dig>  is compared to htm library  <dig> . figure  <dig> shows a frequency plot for idc- <dig> for tags that were not observed in libray  <dig>  figure  <dig> is for tags that had count =  <dig> in library  <dig> and figure  <dig> for tags that had count =  <dig> in library  <dig>  notice that the model accurately predicts the number of tags with zero counts , given a positive count in the other library.

since the bivariate model specifies the probability of  =  we were able to quantify the correlation between two libraries with the correlation coefficient. as seen in figure  <dig>  a low correlation implies that the two libraries are based on different tissue types, while the converse is not necessarily true.

bivariate truncated gamma-poisson, maximum likelihood, raw sage libraries
as expected, the bivariate model underestimated the number of tags with a count of one, presumably due to sequencing errors. figure  <dig> shows a frequency plot for tag counts in sage-genie library  <dig>  conditioned on a count of one in library  <dig>  compared to the predictions from two different versions of the bivariate gamma-poisson-model: the first estimate is based on the assumption that the model fits the data over the entire range, the second is based on the assumption that tags with count one in one library and zero in the other are unreliable and therefore have to be ignored  or  count is assumed). as seen in figure  <dig>  the second model fits much better. the number of tags with a count of one, assigned to the non-parametric component, was  <dig> for library  <dig> and  <dig> for library  <dig>  corresponding to sequencing error rates of  <dig> % and  <dig> %. this is similar to beissbart's estimates .

discussion
we have demonstrated that the poisson distribution with a conjugate gamma prior provides a good fit to real data with the exception of a small population  of sage tags. however, the univariate model does not provide a stable estimate of the shape parameter. for the interpretation of the sage counts, this is not so terrible, since the posterior distribution of the true tag expression  given count yt is gamma. with a value of α typically between  <dig> and  <dig> , the posterior for distribution of λ given a positive count becomes insensitive to α. however, the posterior distribution of λ given a zero count requires a reliable estimate of α.

for the untruncated model, we assumed the total number of expressible tags  to be  <dig> as recorded in the human transcriptome map. one could ask the question whether this set is  complete or whether there is a significant number of extreme low-expressed tags which have not been recorded in any of the libraries. the fact that the number of expressible tags, as estimated by the bivariate model, had a median of  <dig> suggest that the number of tags recorded in the human transcriptome map is of the correct order of magnitude.

the small population of strongly expressed tags has been noted by other authors before. it is possible that it has a biological or technological interpretation. however, kuznetsov  <cit>  showed that a discrete pareto-like distribution accurately predicts the number of high-expressed genes, which suggests that it is a modeling issue rather than a separate group of genes. as seen in figure  <dig>  a poisson distribution with a log-normal prior, which is also a biologically appealing model, may also be able to predict the number of high-expressed genes. since the majority of the genes are expressed at such low levels that the difference between the gamma prior and the log-normal prior is small, we decided to base the bivariate model on the gamma prior which is mathematically more convenient.

as a consequence of this choice, the model does not provide a posterior distribution of λ given a count above the threshold. fortunately, this is not so critical because for a high count the posterior mean will be close to the observed count.

another issue relates to genes mapped to multiple tags. it is reasonable to assume some correlation between two tags representing the same gene. in the human transcriptome map, the counts for those genes were reported as the sum of the tag counts. suppose a gene is represented by two tags, the count of both being poisson distributed with intensity λ ~ gamma and correlation coefficient r. if the total count for the gene is poisson distributed with intensity λ* ~ gamma, we have

e=2e⇒α*β*=2αβ     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgfbqrcqggoaakiigacqwf7oabcqggqagkcqggpaqkcqgh9aqpcqaiyagmcqwgfbqrcqggoaakcqwf7oabcqggpaqkcqghshi3dawcaaqaaiab=f7ahjabcqcaqaqaaiab=j7aijabcqcaqaaacqgh9aqpcqaiyagmdawcaaqaaiab=f7ahbqaaiab=j7aibaacawljagaaczcamaabmaabagaegonaydacagloagaayzkaaaaaa@48d4@

var=var⇒α*β*2=αβ2     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgwbgvcqwgbbqqcqwgsbgucqggoaakiigacqwf7oabcqggqagkcqggpaqkcqgh9aqpcqggoaakcqaiyagmcqghrawkcqwgsbgucqggpaqkcqwgwbgvcqwgbbqqcqwgsbgucqggoaakcqwf7oabcqggpaqkcqghshi3dawcaaqaaiab=f7ahjabcqcaqaqaaiab=j7aijabcqcaqiabikdayaaacqgh9aqpcqggoaakcqaiyagmcqghrawkcqwgsbgucqggpaqkdawcaaqaaiab=f7ahbqaaiab=j7ainaacaaaleqabagaegomaidaaaaakiaaxmaacawljawaaewaaeaacqai3awnaiaawicacaglpaaaaaa@5727@

and thus

β*=β1+r     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfyogycqggqagkcqgh9aqpdawcaaqaaiab=j7aibqaaiabigdaxiabgucariabdkfasbaacawljagaaczcamaabmaabagaegioagdacagloagaayzkaaaaaa@38ac@

α*=2α1+r     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfxoqycqggqagkcqgh9aqpdawcaaqaaiabikdayiab=f7ahbqaaiabigdaxiabgucariabdkfasbaacawljagaaczcamaabmaabagaegyoakdacagloagaayzkaaaaaa@399c@

this shows that if the counts per gene, rather than the counts per tag, are reported in a data set, genes with different numbers of representing tags should be kept separate. as shown in figure  <dig>  the estimated values of α for genes mapped to two or three tags are proportional to the estimated values of α for the genes mapped to a single tag. this suggests that the tag counts have the same distribution, whether they share the gene with other tags or not. the proportionality constant of  <dig>  for genes mapped to two tags and  <dig>  for genes mapped to three tags correspond to a correlation coefficient of approximately - <dig> . this is a surprising result, since we found positive correlation between tags mapping to the same gene in the data used by cai  <cit> . a possible explanation for the negative correlation is that different splicing variants compete for the same transcription product.

by modeling two sage libraries with a bivariate truncated negative binomial model, it was possible to achieve a more stable estimate of α. more important, the bivariate model has a useful interpretation: the shared gamma process z is the main effect  while the independent gamma process x is the  interaction effect. a further generalization of the bivariate model will be to incorporate multiple interaction effects in a multivariate model, for example a third gamma process related to treatment groups.

we have made the distinction between truncated models  untruncated model . it could be argued, however, that even when zero counts are reported , the untruncated models should allow for a an unknown number of non-recorded tags. such models are called zero-deflated poisson models.

by the analysis of the htm data, we have ignored the issue of sequencing errors. figure  <dig> suggests that, augmented with a model for the sequencing errors, the model could be applied to raw sage data as well.

CONCLUSIONS
sage data appear, when sequencing errors are handled properly, to follow a poisson mixture with a log-normal prior on the poisson parameter. the gamma prior  provides a good approximation for low counts . using a bivariate gamma-poisson model, the transcriptome size can be estimated from the data; alternatively, the list of expressible tags from the human transcriptome map can be used. whether one prefers the mathematically convenient gamma prior or a log-normal prior traditionally applied to microarray data, and whether one prefers a parametric or non-parametric model for the high-expressed tags, we believe that the poisson model is useful for analyzing sage data because it separates the sample variance in the poisson process from the biological variance. vencio  <cit>  and cai  <cit>  both demonstrated it to be superior to alternative methods for gene expression differentiation testing and gene clustering, respectively. assuming a prior distribution of the λ's across the genes could boost their methods further.

