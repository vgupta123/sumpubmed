BACKGROUND
the dna microarray technique involves a series of steps, from the harvesting of cells or biopsies to the preprocessing of the scanned arrays, before analysable data are obtained. during several of these steps the quality can be affected by random factors. for instance, depending on the handling of a biological sample the mrna can be more or less degraded  <cit> , and the cell-type composition of a biopsy can be more or less representative for the tissue in question. when arrays share sources of variation the deviations from the nominal value will be correlated. for example, two arrays from sources with degraded rna will both tend to underestimate the expression of easily degradable genes, and two biopsies with a similar and non-representative cell-type composition will deviate in a similar fashion from the average expression for the ideal cell-type composition.

the procedure weighted analysis of microarray experiments   <cit>  introduced a model where a covariance-structure matrix common for all genes aims at catching differences in quality by differences in variances and covarying deviations by correlations between arrays. for computations of test statistics and estimators this resulted in weighting of observations according to the estimated covariance-structure matrix, giving lower weight to imprecise or positively correlated arrays.

in order for the estimation of the covariance matrix to work in the current wame method, the measurements of most genes must only measure noise, i.e. have an expected value of zero. this is the case in experiments where pair-wise log-ratios are observed and where few genes are differentially expressed between any of the pairwise measured conditions. in the present paper, this crucial constraint will be relaxed to only require that most genes are non-differentially expressed between the conditions actually being compared. thus, non-paired experiments can be analysed, e.g. many additional ones based on one-channel microarray data. the relaxation is realised by transforming the data to remove irrelevant information in a manner yielding transformed data with expectation zero for non-differentially expressed genes, after which the current wame method is applied. the transformed data are shown to give equivalent tests and estimates to those of the original data, given the corresponding covariance-structure matrices.

problem formulation and current methods
given a microarray experiment with n arrays and m genes, we observe for each gene g an n-dimensional vector xg of log <dig> transformed values measuring mrna abundance. in wame the vector xg is assumed to have expectation μg described by a design matrix d and a gene-specific parameter vector γg, typically having one dimension per studied condition. a covariance-structure matrix Σ, common for all genes, is used to model differences in quality between arrays as different variances and shared sources of variation between arrays as correlations. a gene-specific variance-scaling factor cg is assumed to have inverse gamma prior distribution with a global shape parameter α. conditional on cg the vector xg is assumed to have a normal distribution with covariance matrix cgΣ. a matrix c specifies the differential expression vector δg, describing the linear combinations of the parameters that are of main interest. formally,

 μg=dγg,xg|cg~n,cg~Γ− <dig> 
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaafaqadewadaaabaaccmgae8hvd02aasbaasqaaiabdeganbqabaaakeaacqgh9aqpaeaacqwgebarcqwfzowzdawgaawcbagaem4zacgabeaakiabcycasaqaagqabiab+hfaynaabaaaleaacqwgnbwzaeqaaogaeiifawnaem4yam2aasbaasqaaiabdeganbqabaaakeaacqgg+bgfaeaacqqgobgtcqggoaakcqwf8oqbdawgaawcbagaem4zacgabeaakiabcycasiabdogajnaabaaaleaacqwgnbwzaeqaaogaeu4odmlaeiykakiaeiilawcabagaem4yam2aasbaasqaaiabdeganbqabaaakeaacqgg+bgfaeaacqqhtowrdaahaawcbeqaaiabgkhitiabigdaxaaakiabcicaoggaciab9f7ahjabcycasiabigdaxiabcmcapiabcycasaaaaaa@58f6@ 

and variables corresponding to different genes are assumed independent. we want to estimate the differential expression

 δg = cγg 

or we want to test for differential expression

 h0:δg=0ha:δg≠ <dig> 
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaafaqadegadaaabagaemisag0aasbaasqaaiabicdawaqabagccqgg6agoiiwacqwf0oazdawgaawcbagaem4zacgabeaaaoqaaiabg2da9aqaagqabiab+bdawaqaaiabdieainaabaaaleaacqwgbbqqaeqaaogaeiooaojae8htdq2aasbaasqaaiabdeganbqabaaakeaacqghgjsuaeaacqgfwaamcqgguaglaaaaaa@3f3a@ 

in the current version of wame  <cit>  the estimation of the covariance-structure matrix Σ is based on a temporary assumption of expectation zero, μg =  <dig>  for all genes, which is shown to give reasonable results if the expectation is close to zero for most genes. thus, this is a suitable assumption for data with paired observations and few regulated genes between the pair-wise measured conditions.

the wame model can be compared with the ordinary linear model   <cit> ,

 xg ~ n 

which gives rise to the ordinary t- or f-tests, and with a widely used empirical bayes model proposed in  <cit>  and implemented in the limma package  <cit> ,

 xg|cg~n,cg~Γ− <dig> 
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaafaqadegadaaabaacbegae8hwag1aasbaasqaaiabdeganbqabagccqgg8bafcqwgjbwydawgaawcbagaem4zacgabeaaaoqaaiabc6ha+bqaaiabb6eaojabcicaoggadiab+x7atnaabaaaleaacqwgnbwzaeqaaogaeiilawiaem4yam2aasbaasqaaiabdeganbqabagccqwgjbqscqggpaqkcqggsaalaeaacqwgjbwydawgaawcbagaem4zacgabeaaaoqaaiabc6ha+bqaaiabfo5ahnaacaaaleqabagaeyoei0iaegymaedaaogaeiikagcccigae0xsdemaeiilawiae0nsdimaeiykakiaeiola4caaaaa@4fd3@ 

the novel feature of wame was thus the introduction of the quality modelling covariance-structure matrix Σ.

after the introduction of wame, a weighted version of limma was proposed  <cit> , which we will refer to as wlimma. there, a model with array-wise variance scales but no correlations is used,

 xg|cg~n),cg~Γ− <dig> 
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaafaqadegadaaabaacbegae8hwag1aasbaasqaaiabdeganbqabagccqgg8bafcqwgjbwydawgaawcbagaem4zacgabeaaaoqaaiabc6ha+bqaaiabb6eaojabcicaoggadiab+x7atnaabaaaleaacqwgnbwzaeqaaogaeiilawiaem4yam2aasbaasqaaiabdeganbqabagccqqgkbazcqqgpbqacqqghbqycqqgnbwzcqggoaakiigacqqfdpwcdaqhaawcbagaegymaedabagaegomaidaaogaeiilawiaeiola4iaeiola4iaeiola4iaeiilawiae03wdm3aa0baasqaaiabd6gaubqaaiabikdayaaakiabcmcapiabcmcapiabcycasaqaaiabdogajnaabaaaleaacqwgnbwzaeqaaagcbagaeiofa4habagaeu4kdc0aawbaasqabeaacqghsislcqaixaqmaagccqggoaakcqqfxoqycqggsaalcqqfyogycqggpaqkcqgguaglaaaaaa@623b@ 

the parameters are estimated using a restricted maximum-likelihood  approach.

a widely used approach is to only consider the ordinary least-squares estimated differential expression, often referred to as the log fold-change, here abbreviated as fc, or as the average m-value. in the present paper, the ranking of the genes imposed by this method will be included in comparisons, when applicable.

RESULTS
the new version of wame
in the current version of wame  <cit>  the covariance-structure matrix Σ is estimated using a temporary assumption that μg =  <dig> for most genes, i.e. that the measurements of most genes consist solely of biological and technical noise. in the new version of wame we relax this to only assume that most genes are non-differentially expressed, i.e. δg =  <dig>  this allows a much larger class of experimental designs and design matrices d, most notably unpaired designs.

the trick used is to transform the data and consider

 yg=xg−μ˜g0
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieqacqwfzbqwdawgaawcbagaem4zacgabeaakiabg2da9iab=hfaynaabaaaleaacqwgnbwzaeqaaogaeyoei0cccmgaf4hvd0mbagaadaqhaawcbagaem4zacgabagaegimaadaaaaa@386d@ 

where μ˜g0
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiiwacuwf8oqbgaacamaadaaaleaacqwgnbwzaeaacqaiwaamaaaaaa@30eb@ is a suitable linear estimator of μg which is unbiased under h <dig> and which preserves the estimability of the differential expression δg, based on only the transformed data . an example is  below where for each gene the mean value of all arrays is subtracted.

since the transformed data contain only noise for non-differentially expressed genes by construction, the current version of wame can essentially be applied to the transformed data yg. as before, the covariance-structure matrix  and the hyperparameter α are first estimated under a provisional assumption . the maximum likelihood estimates of δg and the likelihood ratio test statistics of  are then computed. the tests and estimators are in fact unchanged by the transformation , if the covariance-structure matrices for the transformed and untransformed data are known . wame is implemented as a package for the r language  <cit>  and is available at  <cit> .

evaluation on real and resampled data
to investigate the properties of the new version of wame, two real datasets are examined. briefly, they are analysed both using wame and the current methods described in background. array-specific weights, p-value distributions and rankings are produced showing clear differences between the procedures, most notably in the p-value distributions. to investigate the power of the different procedures and to look at p-value distributions in a controlled but realistic setting, we also analyse simulated data with real noise from the studied datasets and synthetic signal.

description of the real datasets
two public one-channel microarray datasets are analysed. the datasets are selected from the ncbi geo database  <cit>  with the criteria of having unpaired design and being sufficiently large to allow for the resample-based simulations in resampled data below.

in the first dataset  <cit> , biopsies were taken from the left atrium from  <dig> human hearts with normal sinus rythm and  <dig> hearts with permanent atrial fibrillation. it is here referred to as atrium. in the second dataset  <cit> , mechanisms in chronic obstructive pulmonary disease, copd, were investigated by taking lung tissue biopsies from  <dig> smokers with mild or no emphysema and from  <dig> smokers with severe emphysema. in both datasets one affymetrix hgu-133a array was used for each patient. in the present paper rma  <cit>  is used to obtain expression measures from the raw probe-wise intensities. the analyses are performed using the r language and the bioconductor framework  <cit> .

analysis of the real datasets
a natural parameterisation of the included datasets is to have one parameter per condition, yielding design and hypothesis matrices

 d= and c=.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgebarcqgh9aqpdawadaqaauaabeqagiaaaaqaaiabigdaxaqaaiabicdawaqaaiabl6uinbqaaiabl6uinbqaaiabigdaxaqaaiabicdawaqaaiabicdawaqaaiabigdaxaqaaiabl6uinbqaaiabl6uinbqaaiabicdawaqaaiabigdaxaaaaiaawufacagldbaacqqggaaicqqghbqycqqgubgbcqqgkbazcqqggaaicqwgdbwqcqgh9aqpdawadaqaauaabeqabiaaaeaacqghsislcqaixaqmaeaacqaixaqmaaaacaglbbgaayzxaagaeiola4caaa@4d4f@ 

under the null hypothesis, for each gene g and array i, an unbiased estimator of the expected value of the measurement xig is obtained by the gene-wise mean value over all arrays from both groups. the transformation then becomes a subtraction of that mean value, cf. ,

 yig=xig−1n∑j=1nxjg.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgzbqwdawgaawcbagaemyaakmaem4zacgabeaakiabg2da9iabdifaynaabaaaleaacqwgpbqacqwgnbwzaeqaaogaeyoei0yaasaaaeaacqaixaqmaeaacqwgubgbaawaaabcaeaacqwgybawdawgaawcbagaemoaaomaem4zacgabeaaaeaacqwgqbgacqgh9aqpcqaixaqmaeaacqwgubgba0gaeyyeiuoakiabc6cauaaa@453e@ 

note how the transformation preserves the difference in mean value between the two groups of arrays.

if the elements in xg from the different arrays had in fact independent and identically distributed noise for each fixed gene g as assumed in olm and unweighted limma, the noise in yg would have equal variances for all arrays. in figure  <dig> array-wise density estimates for the transformed expression values are shown. for arrays from the same condition the distributions should be identical, reflecting the combined variability of signal and noise. for unregulated genes the expectation of yg is zero, so if the assumption of few regulated genes holds the densities from all arrays should furthermore be essentially equal. examination of figure  <dig> reveals that neither of these statements are true, indicating that some variances are highly unequal.

analogously, all pairs of arrays within each condition should have a common joint distribution and when few genes are regulated all pairs of arrays should essentially have a common joint distribution with a small negative correlation of -1/. examination of scatter plots for all pairs of arrays shows that this is clearly not the case .

as expected from the observations above, unequal variances and non-zero correlations are estimated in the analyses with wame, giving rise to highly unequal weights in the estimates of the differential expressions . in fact, the sign of the weight for some arrays even get switched compared to the sign of the weight of the other arrays from the same condition. this is an effect of strong correlations combined with unequal variances. it is an issue which is further addressed in discussion.

the analysis methods described in background are applied to the data and p-values and ranks computed. the respective probability plots are shown in figure  <dig>  demonstrating that there are substantial differences in the distribution of p-values between the different statistics. since correlations and unequal variances are observed, the model assumptions of the alternative standard methods do not seem to hold. the p-values could thereby have become optimistic. on the other hand, it cannot be ruled out that the temporary assumption in wame of no regulated genes makes its p-values conservative, which could also partly explain the differences. these problems are studied below by use of resampled data.

a common alternative to using the p-values as measures of significance is to consider the ranking of the genes, induced by the p-values or test statistics, and to select a fixed number of top ranked genes for further investigations. in table  <dig> and table  <dig> the concordance of the ranked lists are shown. the results from the included methods differ, for instance those from wame compared to the other methods. this is not surprising since high correlations and highly unequal variances were identified by wame, giving rise to highly unequal weights.

resampled data
to examine closer the effect of violated assumptions of independence and identical distribution, we repeatedly selected two random subgroups of four arrays from within one group in the original data and performed tests between those groups. this was performed  <dig> times for the largest group in each of the two real datasets. differentially expressed genes have unequal expected values in the two populations being sampled ). since we now sample twice from the same condition, no differentially expressed genes exist.

 f¯=1100∑i=1100fi,
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwggbgrgaqeaiabcicaoiabdchawjabcmcapiabg2da9maalaaabagaegymaedabagaegymaejaegimaajaegimaadaamaaqahabagaemoray0aasbaasqaaiabdmgapbqabagccqggoaakcqwgwbaccqggpaqkasqaaiabdmgapjabg2da9iabigdaxaqaaiabigdaxiabicdawiabicdawaqdcqghris5aogaeiilawcaaa@44d0@ 

where fi denotes the empirical cdf from the ith of the  <dig> resamples. for wame, the p-value distributions are very close to the expected uniform. for olm, limma and weighted limma there is a high variability between the p-value distributions and they are in many cases substantially different from the expected uniform. for wame, olm and limma, the respective average empirical distribution is approximately correct, while for weighted limma it is clearly optimistic. the results for the atrium dataset  are very similar.

evaluation of power
to evaluate the power of the tests in the studied datasets, a known regulation is added to randomly selected genes in one of the resampled groups, created according to the previous section. thus, the noise is obtained from the real data and only the signal is synthetic. ideally, the power can then be estimated by the proportion of differentially expressed genes that have a computed p-value less than a fixed level. however, valid p-values of the test statistics cannot be obtained from the respective models since, as demonstrated above, the corresponding assumptions are typically not valid. ideally, the p-values would be determined by the true null distribution of the respective test statistics, given the array-wise quality deviations. in the simulation study, the critical value of the test statistics are therefore estimated from the empirical distribution of the test statistic for the unregulated genes. this is used to estimate the power of the different statistics .

the power estimates for the different methods are shown in figure  <dig>  for a level  <dig> % test. the  <dig> % level yields approximately  <dig> false positives if relatively few genes are in fact differentially expressed. for wame, Σ is estimated both before and after adding a signal to  <dig> genes , thereby substantially affecting the estimate of Σ . the powers of the two versions are nevertheless very similar  and only the latter version is included in the plot.

when the covariance-structure matrix Σ is estimated in wame it is assumed that no genes are differentially expressed. figure  <dig> includes the average empirical distribution for the p-values of the unregulated genes when different proportions of the genes have a log <dig> differential expression of  <dig>  it is clear that the distributions are biased for high proportions, giving conservative p-values, which should be an effect of biased estimates of Σ.

the results from the studied datasets indicate  that wame offers a relevant power increase compared to the included alternatives,  that weighted limma does not offer an advantage compared to limma and  that the moderated statistics  are superior to the traditional methods of ranking by ordinary t-statistic  or estimated differential expression .

discussion
the wame model and the simulations
the wame model aims at catching quality deviations by one covariance-structure matrix common for all genes. this is certainly simplistic in some cases, e.g. when only certain physical parts of an array or certain types of mrnas are of decreased quality. the estimated covariance structure can then only be expected to reflect a mixture of the qualities of the different genes. however, examining the simulations , we see a clear power gain in the wame model compared to the other models. also, wame succeeds in catching enough of the quality deviations to make the p-value distributions more correct, thus providing increased usefulness of the p-values .

the models of limma, weighted limma and wame are nested, where weighted limma adds unequal variances and wame adds unequal variances and correlations. examination of figure  <dig> shows that there are evident differences in variability between arrays. it is therefore interesting that we have not found a power increase of weighted limma compared to limma. further, the p-values of weighted limma turned out to be too optimistic . comparison with the results of the wame method, where the power increases and the p-value distributions get substantially more correct, suggests that the correlations are crucial in the model.

in the simulations, noise is taken from real data through resampling within a fixed group. this procedure provides data with fewer assumption on the noise structure compared to a fully parameterised simulation and should hopefully better reflect realistic situations. to evaluate the power of the different methods, a synthetic signal which is constant within each condition is added to the resample-based noise. this follows the assumption in the models of both wame, olm, limma and weighted limma, that the noise structure is equal for genes that are differentially expressed and non-differentially expressed. however, the biological variability of the expression of differentially expressed genes might be different under the different conditions due to the changed rôle of those genes. for complicated conditions such as complex diseases, the problem is more severe  since crucial genes might only be differentially expressed in a subset of the studied arrays. further work is needed to evaluate the performance of wame in such settings, as well as to possibly expand it to better fit these situations.

a relevant question regarding the modelling of quality deviations by the covariance-structure matrix Σ is whether biologically interesting features may be hidden by this model. in the present datasets, the question can partly be answered by examining the pairwise plots  and noticing that a large proportion of the genes show similar deviations, which should speak against a specific interesting biological explanation. also, the estimated covariance structure matrix Σ can be inspected with the goal of finding relevant correlations between arrays and thus highlighting interesting features in the data. possible future work is to use such inspections to reveal unwanted features in normalisation or in preprocessing wet-lab steps that give rise to correlated errors for a large proportion of the genes.

weights with switched signs
in the studied datasets, strong correlations combined with unequal variances make some weights within a group switch sign, in essence meaning that it is beneficial to partly subtract some arrays within a group in the estimate to be able to add more of the others in the same group . since this might seem counter-intuitive, an elucidating example of possible mechanisms behind such weights follows.

consider an example where two two-colour arrays are observed, x <dig> and x <dig>  let the two arrays have two sources of variation, one that is mutually independent  and one consisting of different proportions, a <dig> and a <dig>  of one common source of variation η. let ε <dig>  ε <dig> and η be independent and normally distributed with expectation  <dig> and variances σε2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfdpwcdaqhaawcbagae8xtdugabagaegomaidaaaaa@3137@ and ση2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfdpwcdaqhaawcbagae83tdggabagaegomaidaaaaa@313c@, respectively. furthermore, let μ be the parameter to be estimated. the model becomes

 xi = μ + aiη + εi, i ∈ { <dig> }. 

then, x <dig> gets a negative weight if and only if

 a1>a2+σε2a2ση <dig> 
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwghbqydawgaawcbagaegymaedabeaakiabg6da+iabdggahnaabaaaleaacqaiyagmaeqaaogaey4kasyaasaaaeaaiigacqwfdpwcdaqhaawcbagae8xtdugabagaegomaidaaagcbagaemyyae2aasbaasqaaiabikdayaqabagccqwfdpwcdaqhaawcbagae83tdggabagaegomaidaaaaakiabcycasaaa@4000@ 

i.e. if array  <dig> includes a large enough contribution from the common source of variation. when a negative weight is allowed instead of removing the array, a smaller proportion of the common source of variation is included in the final estimate. its precision is thus increased.

validity of the p-values and derived entities
varying quality of arrays and correlated errors were demonstrated in  <cit>  and in the present paper through examination of the data. these questions are typically neglected in microarray analyses, both when using parametric and when using non-parametric analysis methods, since independence and identical distribution or exchangeability are generally assumed under the null hypothesis. thus, the validity is questionable of the corresponding p-values and their derived entities, e.g. false discovery rates and estimates of proportions of differentially expressed genes. this problem is obvious in the resample based simulations.

a number of experiments have been analysed  in addition to those published in the present paper and in  <cit> . in almost all cases relevant unequal variances and correlations have been identified, indicating that the problem is common.

in the resample based simulations with added signal, wame is shown to be conservative, which is an effect of the biased estimate of Σ. further work on an estimator of Σ with better characteristics under regulation is therefore needed. however, the simulations indicate  that the power of the test is basically unaffected by the bias and  that hundreds of genes may be differentially expressed  with only mildly conservative p-values as result.

correlations between genes or between arrays?
it has recently been argued that the expression of different genes are highly dependent, making the law of large number normally inapplicable  <cit>  and standard estimators of e.g. the false discovery rate  imprecise  <cit> . in  <cit> , a latent fdr is introduced, being the conditional fdr given a random effect b that captures the correlation effects between genes. the fdr is then the marginal latent fdr, that is the average over the random effect b.

for the datasets examined in the present paper, the model assumptions of e.g. the ordinary linear model are shown not to hold . this can be expected to result in invalid p-values, which is indeed observed in figure  <dig>  interestingly, the p-value distribution seem to be valid marginally, i.e. on average over the different resamples, which would yield valid but imprecise estimates of the fdr. this type of failed model assumptions is not taken into account in e.g.  <cit> . since for a performed experiment, the p-values from the ordinary t-statistic  share a common bias conditional on the experiment , the different p-values may be highly dependent. however, this dependency is due to failure of taking array-wide quality deviations into account in the model and not due to the nature of microarray data per se, e.g. through substantial long-range gene-gene interactions.

consequently, the strong observed dependencies between statistics from different genes might largely be explainable by quality deviations between the arrays in the experiment, e.g. correlations between arrays. since wame models these deviations such that the p-values are essentially correctly distributed when few genes are differentially expressed in the studied datasets, the dependency between genes should be greatly decreased. the covariance structure matrix Σ is therefore in a sense a parallel to the random factor b in  <cit> . it remains as future work to evaluate the gene-gene dependencies and estimates of e.g. the fdr in the context of the wame model.

in the wame model, the data from different genes are assumed independent, which is unrealistic, e.g. since genes act together in pathways. however, this is only used in the derivation of the maximum likelihood estimaties of the covariance structure matrix Σ and the shape parameter α. the assumption could thus be relaxed to a dependence between the different genes that is weak enough that the estimates of Σ and α become precise, and accurate under h <dig>  this holds if the law of large numbers is applicable for averages of certain functions of the gene-wise observed data . given the large number of genes and the observed p-value distributions in figure  <dig>  this relaxed assumption seems plausible.

it can be noted that for the studied data, wame has higher power and considerably more valid p-values than weighted limma. since the difference between the weighted limma and wame models is the inclusion of correlations between arrays, this emphasises the importance of the correlations in the model.

CONCLUSIONS
statistical methods in microarray analysis are typically based on the often erroneous assumption that the data from different arrays are independent and identically distributed. an exception is weighted analysis of microarray experiment  where heteroscedasticity and correlations between arrays are modelled by a covariance-structure common for all genes. in the present paper, wame has been extended to handle datasets without a natural pairing, e.g. data from one-channel microarrays, and corresponding estimates and test statistics have been derived. in the examined one-channel microarray datasets wame detected unequal variances and nonzero correlations.

wame was compared with four other common methods: an ordinary linear model with t-tests, limma, weighted limma, and fold-change ranking. the comparison was performed using resampling of the different arrays within the datasets. here, wame had the highest power. when a relatively small proportion of the genes are regulated, wame also generates close to correct p-value distributions while the p-value distributions from the other methods are highly variable. however, when many genes are differentially expressed, the p-values from wame tend to be conservative.

in conclusion, p-values from the standard methods for microarray analysis should in general not be trusted and any result based on p-values, e.g. estimates of the number of regulated genes and false discovery rates, should be interpreted with care. the analyses of the examined datasets showed that wame gives a powerful approach for finding differentially expressed genes and that it produces more trustworthy p-values when a relatively small proportion of genes are differentially expressed.

