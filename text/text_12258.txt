BACKGROUND
bacterial and archaeal microorganisms are capable of very diverse cellular functions. some examples are nitrogen fixation, organic matter degradation, and antibiotic resistance. the full set of cellular functions, or the functional profile, of a microorganism is encoded in its genome. for a microbial species, some essential cellular functions are maintained via vertical gene transfer, some beneficial ones are gained via horizontal gene transfer or evolutionary innovation, and some dispensable ones are lost in order to maintain a compact genome. phylogeny and environment are the two primary factors that shape the functional profile of a microbial species. the phylogeny defines the evolutionary history of the species and dictates the cellular functions available from inheritance. the environment, including the physical and chemical conditions of the habitat and the biological cohorts of the microbial communities, applies selective pressure on the species to acquire and retain beneficial cellular functions and remove deleterious or dispensable ones.

decades of biochemistry research have uncovered the molecular implementation of many cellular functions in terms of biological processes and metabolic pathways. enzymes that carry out the reactions in pathways and processes have been identified and linked with genes in model organisms in databases, such as metacyc, kegg, and others  <cit> . as a result, many cellular functions in a microorganism can now be inferred computationally from its genome in three steps. first, genes are predicted from the genome sequence. then, the molecular functions of the genes are inferred by sequence analysis and database searching. finally, a cellular function is considered to be present in the microorganism if the essential enzymes for the cellular function are encoded in its genome. owing to the progress in dna sequencing technology, a large number of genomes  have been sequenced and deposited in genbank  <cit> , covering considerable phylogenetic diversity of the bacterial and archaeal domains. characterization of cellular functions consistently predicted from the sequenced microbial genomes in a phylogenetic context can shed light on their evolution in bacteria and archaea. this is referred to as functional phylogenomics analysis.

evolution in the bacterial and archaeal domains has been studied extensively based on species trees and gene trees  <cit> . functional phylogenomics studies can uncover the evolution of cellular functions at an intermediate level between genes and species. genes may evolve in parallel with species or in a divergent manner through horizontal gene transfers and gene losses. likewise, a cellular function may evolve in parallel with both its host species and its constituent genes. during this process, some genes may be replaced with their non-homologues of equivalent function, or conferred to a species by horizontal gene transfer, gene sharing, or evolutionary innovation  <cit> . reconstruction of a cellular function tree is difficult due to the lack of an evolutionary model to account for all these types of events. instead, the evolution of cellular functions can be studied by inferring their ancestral states across the prokaryotic phylogenetic tree and tracking their gains and losses along the evolutionary timeline. more broadly used cellular functions should have earlier initial appearances in the evolutionary history. we hypothesize that the propagation of a cellular function through the prokaryotic tree may follow the diversification of selected clades, pass laterally across distant species, or discontinue at certain lineages. our functional phylogenomics analysis provided a quantitative test of these hypotheses for a large number of cellular functions in the phylogenetic tree of all sequenced prokaryotic genomes in genbank.

microbiologists have long observed the association of certain functions with certain clades of the phylogenetic tree  <cit> . recently, the picrust algorithm  <cit>  was developed to predict metagenome functional profiles of microbial community members from 16s rrna marker genes. however, many genomics studies have also shown the prevalence of horizontal gene transfer among bacteria  <cit> , which would disrupt the association of a cellular function with some closely related taxa. our functional phylogenomics analysis measured the phylogeny-function correlation for many cellular functions over the prokaryotic tree. on one hand, some functions are concentrated in selected clades. as a result, many clades have distinct functional profiles with enrichment of certain functions. on the other hand, some other functions are sparsely dispersed across distant clades, which would make it difficult to predict the presence or absence of these functions in a microorganism based on the functions of its phylogenetic neighbors. the functional phylogenomics analysis provided the parsimony scores of cellular functions as an empirical measure of their consistency with the phylogeny, and generated the aggregate functional profiles of taxa at different taxonomic ranks.

RESULTS
phylogeny reconstruction of the prokaryotic genomes
we downloaded from genbank  more than  <dig>  bacterial and archaeal genomes, henceforth referred to as the prokaryotic genomes. after discarding genomes containing more than  <dig> contigs and genomes with less than  <dig> protein-coding genes, the remaining  <dig>  prokaryotic genomes were analyzed in this study and their metadata was provided in additional file  <dig>  a phylogenetic tree of these genomes  was built using phylophlan  <cit>  and fasttree  <cit>  based on proteins found by prodigal  <cit> . prodigal was chosen in order to standardize gene calling across all genomes, as genbank gene predictions were shown to have more variation as a result of the different methods used by the submitters  <cit> . prodigal predictions were also found to have more consistent identification of translation initiation sites than genbank records, as in burkholderia genomes  <cit> . the phylogenetic tree in the newick format is available in the additional file  <dig>  the full lineages of the genomes were extracted from the ncbi taxonomy database and their phyla are color-coded in ring  <dig> of figure  <dig>  most phyla were monophyletic and occupied contiguous sectors of the ring  <dig>  except that proteobacteria was separated into two clades. this indicated a general agreement between the taxonomic classification and phylogenetic distribution of these genomes. due to the errors in either taxonomic classification or phylogeny reconstruction, there was also occasional inconsistency, indicated by distinct colored lines within some contiguous phylum sections in ring  <dig> figure  <dig> 
overview of the prokaryotic genomes. the phylogenetic tree contains  <dig>  genomes with tips colored according to their phylum classification. rings:  phylum classification of the genomes. phyla with less than  <dig> genomes are in the “others” category.  completion status of the genomes with black for finished genomes and white for draft genomes.  number of contigs in each genome.  number of proteins in each genome.  percentage of proteins annotated by unifam in each genome.  number of pathways inferred for each genome.



to compare the gene calling results from prodigal predictions and genbank annotations, we built two phylogenetic trees for the  <dig>  genomes that had genbank annotations. one tree was based on proteins called by prodigal and the other was based on proteins provided in genbank . the robinson-foulds  <cit>  distance between the two trees, defined as the total number of partitions of tips implied by one tree but not the other, was  <dig>  this was 45% of  <dig>  total partitions in the two trees. the branch score  <cit>  defined by the square root of sum of squared differences between branches in the two trees was  <dig> , comparing to the total internal branch length of  <dig>  in the two trees. these two distance measures indicated that there were many discordant internal branches between the two trees, but the lengths of these branches were very small.

the taxonomic classification and the phylogenetic tree  exhibited highly uneven distribution of the sequenced genomes among different phyla. 85% of the genomes belonged to the three most sequenced phyla , whereas  <dig> phyla have  <dig> or fewer sequenced genomes. the completion status of the genomes is indicated in ring  <dig> of figure  <dig>  and the number of contigs in a genome is shown by the height of its corresponding bar in ring  <dig>  a few phyla had very high percentages of finished genomes, including chlamydiae , tenericutes  in the bacterial domain, as did the most phyla in the archaeal domain.

re-annotation of the prokaryotic genomes
the prokaryotic genomes were annotated by their submitters to genbank. we observed a significant degree of inconsistency between the genbank annotations of different genomes in the following aspects:  terminology: genomes have different names for orthologous proteins,  ontology: some genomes have extensive annotations in go terms and ec numbers and some others do not, and  annotation coverage: closely related genomes have different percentages of genes with assigned functions. the inconsistency probably stemmed from the submitters’ different annotation procedures that may involve a variety of algorithms and databases for inferring functions. in addition, the inconsistency also existed between genomes deposited by the same submitter at different times, because the algorithms and databases used for annotation are continuously improved, but the genome annotation in genbank was rarely updated after initial submission. because such inconsistency in the existing genbank annotations may prevent accurate comparison of cellular functions across genomes, we re-annotated the  <dig>  prokaryotic genomes in three steps: gene calling, protein functional annotation, and metabolic pathway inference.

prodigal  <cit>  was used to predict protein-coding genes in the genomes. the numbers of predicted genes  were comparable between neighboring genomes in the phylogenetic tree. the number of genes in a genome was not correlated with the completion status of the genome or its number of contigs. this suggested that, although draft genomes were likely fragmented by many repeat sequences, most of them could still provide sufficient coverage of the gene content of the genomes.

the predicted protein-coding genes were re-annotated using unifam_prok. the unifam protein family database  was constructed from the uniprot database as described in the material and methods. the manually curated annotations of proteins in swissprot were used as the source of function information in standardized terminology. protein families were built around the swissprot proteins with their close homologs in trembl. substantial sequence diversity was obtained for many protein families, owing to the enormous sequence space of trembl. in comparison with many existing protein family databases, unifam provided the following advantages for genome annotation. first, unifam provided a comprehensive coverage to alleviate the need for searching multiple databases and combining the results. ring  <dig> of figure  <dig> shows the percentages of annotated proteins for all the genomes. on average, 70% of the predicted proteins were annotated in a genome.  <dig>  out of  <dig>  genomes had more than 65% of their proteins annotated by unifam. second, because only the manually curated annotations of proteins in swissprot were used as the source of function information, the unifam families were associated with standardized protein product names, extensive go term annotations, and ec numbers. third, because the unifam families were built from proteins with stringent whole sequence alignment requirement, we believe the genome annotation by unifam is reliable. although it is difficult to rigorously benchmark the accuracy of genome annotation, our manual analysis of selected genomes indicated high quality annotation of unifam. finally, the annotation of a microbial genome takes approximately  <dig> cpu hours on average using unifam, which made it computationally feasible to re-annotate  <dig>  genomes. unifam will be updated in synchronization with the uniprot database. the annotation of the unifam families will improve with the ongoing swissprot curation effort. the sequence diversity of the unifam families will increase with the expansion of the trembl database.

the unifam annotation was compared with annotations by rast  <cit>  and prokka  <cit>  on five representative genomes: two escherichia coli k- <dig> genomes , two pseudomonas aeruginosa genomes , and one finished archaeal genome methanocaldococcus jannaschii dsm  <dig>  the same proteins predicted by prodigal were provided to the three annotation pipelines. the annotation results in gene names, gene product names and ec numbers from the three pipelines are available in additional file  <dig>  only unifam annotations provided go terms. unifam annotated more proteins in the two e. coli genomes and the m. jannaschii genome, but less in the two p. aeruginosa genomes, than prokka and rast . the consistency between the genome annotations were measured based on ec numbers , because two ec numbers can be compared exactly, and the ec number annotation is a primary information source for pathway inference by pathway tools. the ec number consistency between the three pipelines was highest in e. coli, followed by p. aeruginosa, and finally by m. jannaschii. the agreement between unifam and each of the other two methods was better than that between prokka and rast. unifam annotation was more computationally expensive than prokka and rast. the p. aeruginosa m <dig> genome was annotated by unifam using  <dig>  cpu hours, by prokka using  <dig>  cpu hours, and by rast using  <dig>  cpu hours.

metabolic pathways were inferred for all genomes with pathway tools  <cit>  based on unifam annotations. in comparison with pathway inference tools such as kegg  <cit>  and others  <cit> , pathway tools provides a comprehensive coverage of metabolic reactions and pathways  <cit>  and allows automatic processing of a large number of genomes. the pathway inference was facilitated by the extensive ec number and go term annotation by unifam.  <dig> prokaryotic pathways in the metacyc database  <cit>  were found in the studied genomes. the numbers of predicted pathways across genomes are shown in ring  <dig> of figure  <dig>  genomes in the proteobacteria phylum had more pathways inferred than other phyla, whereas the archaeal genomes had much fewer inferred pathways. the number of inferred pathways in a genome correlated with numbers of predicted and annotated proteins of the genome. in addition, the distribution of curated pathways in metacyc among different clades also affected the number of inferred pathways in a genome.

the genome annotation results are provided at http://unifam.omicsbio.org and will be regularly updated to keep pace with the growth of genbank and newer releases of prodigal, unifam and metacyc. although every annotation step was performed with stringent settings to minimize errors, we cannot obtain the ground truth or perform extensive manual curation for such a large set of prokaryotic genomes. thus, it was not the goal of this study to examine the cellular functions of individual organisms. instead, the functional phylogenomics analysis was focused on the aggregate results of a large number of diverse genomes to minimize the adverse effect of occasional errors in the phylogenetic tree reconstruction, genome annotation, and pathway inference.

association of cellular functions with the taxonomic classification
the overall functional profile of a taxon can be represented by the collection of the biological process go terms of the proteins encoded in its genomes. the differentiation between the functional profiles of taxa at a given taxonomic rank was measured using go term enrichment analysis  <cit> . because there were too many bacterial genomes for enrichment analysis and result presentation, archaeal genomes were chosen to showcase the differentiation at the phylum and family levels . the enrichment analysis was conducted only on taxa containing sufficient genomes: ≥  <dig> genomes for a phylum and ≥  <dig> for a family. additional file  <dig> lists the top ten most enriched go terms in each phylum compared to the average in the whole archaeal domain, and the top five most enriched go terms of each family compared to the average in the corresponding phylum.

the crenarchaeota phylum contains many thermophilic organisms. the enrichment of the biological processes in defense response to viruses indicated that crenarchaeota has heavier genomic investment in virus defense than the other phyla, which may suggest prevalent viral infection in its environments. euryarchaeota was specialized in methanogenesis as expected, but it also appeared to have more “intelligence-related” cellular functions, such as signal transduction and transcription regulation. out of eight families in euryarchaeota, the five known methanogen families were found to be specialized in methanogenesis along with different sets of other biological processes.

the metabolic pathway profile of a genome was represented by a 0– <dig> vector of length  <dig> with  <dig> for absence and  <dig> for presence of the  <dig> pathways in this genome. the metabolic pathway profiles of individual genomes in a genus were merged into an aggregate genus pathway profile  to reduce the effect of uneven genera representation on the analysis. the  <dig> genera were hierarchically clustered based on their metabolic pathway profiles and  <dig> metabolic pathways were clustered based on their distribution across the genera . there were some universal pathways clustered in the right section, which were detected in almost all genera. examples included trna charging, utp and ctp dephosphorylation i, adenosine ribonucleotides de novo biosynthesis, and glutamine degradation i. lack of these pathways in the very few genera is likely due to the incompleteness of the genomes. there were also rare pathways that existed only in very few genera, such as quinate degradation ii  and myrcene degradation .figure  <dig> 
hierarchical clustering of genera and metabolic pathways. the heatmap represents the presence  and absence  of all  <dig> pathways  in all  <dig> genera . the dendrograms to the left and on the top of the heatmap represent the clustering results of the genera and the pathways, respectively. higher taxonomic classifications of the genera are marked on the two colored strips: the bacteria/archaea domain classification on the left strip and the phylum classification on the right trip.



the hierarchical clustering of the genera was based on the similarity between their pathway profiles without using the taxonomic or phylogenetic information. the domain and phylum classifications of the genera are marked in the left and right vertical strips, respectively, in figure  <dig>  the archaeal genera are clearly clustered together. they were distinguished by some archaea-specific pathways, such as methanogenesis from co <dig>  trna splicing, starch degradation v, selenocysteine biosynthesis ii, and chitin degradation i. they also lacked some pathways universally found in bacteria, such as trna processing and thiazole biosynthesis i. the clustering of genera was also relatively consistent with their phylum classification, in that the clusters formed continuous blocks of genera from the same phyla. this was a result of many taxa-specific pathways that were commonly found in only a few selected taxa. on the other hand, genera from the same phylum were also often separated into several disjoint clusters, indicating divergence of the functional profiles of genera in the same phylum.

association of cellular functions with the phylogenetic tree
the metabolic pathway profiles of genomes were superimposed on their phylogenetic tree to assess the phylogeny-function correlation. nine representative pathways are shown in figure  <dig>  the trna charging pathway  was found in  <dig> % of the genomes and, therefore, was likely to have been passed from an ancient ancestor to all the descendants. the absence of this pathway in  <dig> genomes can be attributed to the low genome quality, instead of biological effect. the mercury detoxification pathway  existed in only  <dig> % of the genomes, but dispersed among many distant clades of the tree. the phylogenetic distribution of this pathway suggested extensive horizontal gene transfer events across the bacterial domain, probably as a result of the selection force of potentially mercury-contaminated environments and the high transferability of this cellular function. in contrast, the arsenate detoxification pathway  found in  <dig> % of the genomes was much more concentrated on selected clades. it was not clear why the two heavy-metal detoxification pathways have such different levels of correlation with the phylogeny.figure  <dig> 
distribution of selected pathways across the prokaryotic genomes. each ring represents the presence pattern  of a pathway on the phylogenetic tree tips. the pathways and their ring colors are listed in the legend.



a pathway can be viewed as a binary character observed at the tips of the phylogenetic tree, with its presence and absence in a genome as the two states. the parsimony score  <cit>  for a pathway on the tree is the minimum number of state changes  needed along the branches to produce the observed presence/absence pattern of the pathway at the tips. retention index   <cit> , which normalizes the parsimony score of a pathway with the number of its occurrences in the genomes, was also calculated to measure how well a character conforms to the phylogenetic tree. a higher ri indicates a better fit of a character to the tree. for example, aerobic respiration   was found in  <dig> genomes with parsimony score  <dig> and ri  <dig> , whereas methylotrophy  was found in  <dig> genomes with a parsimony score  <dig> and ri  <dig> . this is in line with the previous observation that methylotrophy has undergone extensive horizontal gene transfer, while aerobic respiration is consistent with the phylogeny  <cit> . the parsimony scores and the genome occurrence frequencies of the  <dig> pathways are shown in figure  <dig>  pathways were categorized into consistent pathways with ri >  <dig>  and inconsistent pathways with ri <  <dig> . out of the  <dig> pathways in bacteria and archaea, 31% were consistent pathways and 26% were inconsistent pathways. the complete list of the  <dig> pathways with their parsimony scores, occurrence frequencies in the genomes, and ris is available in additional file  <dig> figure  <dig> 
distributions of parsimony scores and occurrence frequencies of all pathways. the pathways are classified into consistent pathways with ri >  <dig>   and inconsistent pathways with ri <  <dig>  .



phosphate acquisition was an example of consistent pathways . this pathway was found in  <dig> genomes with parsimony score  <dig> and ri  <dig> . it was concentrated in  <dig> bacterial phyla and  <dig> archaeal phyla. of the bacterial genomes, it was mostly found in proteobacteria , firmicutes , actinobacteria , bacteroidetes , and cyanobacteria . nitrogen fixation was an example of inconsistent pathways . it was found in  <dig> genomes with parsimony score  <dig> and ri  <dig> . this pathway is known to have been horizontally transferred between many species  <cit> . although both phosphate acquisition and nitrogen fixation provide essential nutrients for microorganisms, they have very different occurrence frequencies and horizontal gene transfer behaviors in the bacterial genomes.

two biosynthesis pathways are also shown in figure  <dig>  isopenicillin n biosynthesis  occurred in  <dig> genomes with parsimony score  <dig> and ri  <dig> . lysine biosynthesis i , which involves succinylated intermediates, was found in  <dig> genomes with parsimony score  <dig> and ri  <dig> , showing much higher prevalence and consistency. the two pathways were both mostly found in the phyla of proteobacteria, actinobacteria and bacteroidetes. however, isopenicillin n biosynthesis had a very sparse distribution, while lysine biosynthesis i had a nearly uniform distribution in these phyla.

from the presence/absence pattern of a pathway at the tips of the phylogenetic tree, the ancestral states of the pathway at the internal nodes of the tree were inferred with the parsimony method  <cit> . the divergence time of the internal nodes of the tree was also estimated  <cit>  with a scaled reference age of  <dig> for the root. combining the ancestral states of a pathway and the divergence time at internal nodes, the state changes  of the pathway were clocked on the phylogenetic tree.

figure  <dig> shows four pairs of subtrees for the representative pathways examined in figure  <dig>  without considering horizontal gene transfer from eukaryotes, the first red node from the root on the subtree for a pathway marks the first occurrence of the pathway in nature through evolutionary innovation. the subsequent red nodes may result from independent evolutionary innovation or horizontal gene transfer. the first pair  displayed very distinct evolutionary patterns. aerobic respiration had very early first appearance and was well maintained in most clades, whereas methylotrophy was a more recent innovation and underwent many changes. the second pair  had similar parsimony scores , but very different genome occurrence frequencies . the gains of phosphate acquisition were concentrated in only a few clades, while the gains of nitrogen fixation were spread across many clades. the third pair  shows two heavy-metal detoxification pathways. the arsenate one showed a small number of losses and gains in a few clades, while the mercury one had a few ancient gains and losses followed by considerable recent gains and losses in many clades. for the two biosynthesis pathways , isopenicillin n biosynthesis went through frequent gains and losses, probably in response to selection pressure in specific environments; whereas lysine biosynthesis i was maintained stably with few losses in almost all clades since their ancestors first gained this pathway.figure  <dig> 
subtrees of selected pathways. the subtree of a pathway is reduced from the clocked phylogenetic tree of all genomes by collapsing the entire clades without this pathway into tips. the root is colored red for the pathway’s presence and blue for its absence. the colors of non-root nodes mark the pathway’s status changes from their immediate ancestral nodes: red for gains, blue for losses, and none for no change. the branches descending from nodes containing the pathway are colored green. the total number of blue and red nodes in a pathway’s subtree equals the parsimony score of the pathway.  aerobic respiration  with parsimony score  <dig> from  <dig> genomes.  methylotrophy with parsimony score  <dig> from  <dig> genomes.  phosphate acquisition with parsimony score  <dig> from  <dig> genomes.  nitrogen fixation with parsimony score  <dig> from  <dig> genomes.  arsenate detoxification with parsimony score  <dig> from  <dig> genomes.  mercury detoxification with parsimony score  <dig> from  <dig> genomes.  isopenicillin n biosynthesis with parsimony score  <dig> from  <dig> genomes.  lysine biosynthesis i with parsimony score  <dig> from  <dig> genomes.



CONCLUSIONS
the phylogenetic tree and consistent annotations of  <dig>  prokaryotic genomes provided the foundation for a functional phylogenomics analysis across bacteria and archaea. to our best knowledge, this is the first study that systematically examined a wide variety of consistently inferred cellular functions across prokaryotic genomes in a phylogenetic context. the analysis systematically measured the correlation of the cellular function evolution with the organism evolution in terms of function enrichment in taxa, clustering of functional profiles and genera, and parsimony score distribution of metabolic pathways. different evolution patterns of cellular function were showcased using the phylogenetic distributions and subtrees of selected metabolic pathways.

