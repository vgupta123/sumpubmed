BACKGROUND
transcriptional regulation in eukaryotic cells requires highly orchestrated interactions between transcription factors , their co-factors, rna polymerase and the chromatin  <cit> . several classes of regulatory elements, including promoters, enhancers, silencer and insulators, are involved in this process. systematic and precise mapping of these elements in the genome is essential for understanding transcriptional programs responsible for temporal and tissue specific gene expression. a high throughput experimental approach has recently been used to tackle this problem and it involves the chromatin immunoprecipitation assay followed by microarray  <cit>  or large scale sequencing  <cit> . currently, this approach is still limited by the availability of antibody specifically recognizing individual tfs at different regulatory elements. another method involves comparative genomic analysis of related genomes <cit>  and clustering of multiple sequence motifs <cit> . this approach has been successfully applied to a number of eukaryotic genomes including yeast, drosophila and mammal genomes . these methods rely on precise alignment of regulatory elements across multiple genomes which is not necessarily true for all elements, or prior knowledge of a set of cooperative tfs which is not always available.

recently, a chromatin based regulatory element mapping approach has been proposed <cit> . this approach exploits the observation that transcriptional promoters and enhancers are associated with distinct chromatin signatures. specifically, the active promoters are characterized by tri-methylation on lys <dig> in h <dig> , while the active enhancers are associated with mono methylation of this residue and a much reduced or non-existent signal of the tri-methylation  <cit> . currently, it is not yet clear what mechanisms underlie the different chromatin signatures at these two classes of cis-regulatory sequences, but the characteristic chromatin signatures of regulatory elements provide a pragmatic way to systematically identify these elements in the genome without prior knowledge of the underlying sequences. compared with the other methods, there are several advantages of this chromatin-based approach. first, it requires no prior knowledge of the sequence features of the promoters or enhancers; second, the chromatin modification profiles could be obtained for most organisms as the existing antibodies can specifically recognize the characteristic histone modifications in different species. third, this approach does not make the assumption that promoters or enhancers are evolutionarily conserved, thereby can identify fast evolving regulatory elements in the genome.

distinct chromatin signatures at promoter and enhancers have been explored by heintzman et al <cit>  to map promoters and enhancers. in their study, chip-chip analysis using high-resolution tiling array was performed to localize the core histone h <dig>  and monitor the status of five histone modification marks, i.e. h <dig> acetylation , h <dig> acetylation , mono-, di- and tri-methylation of lys <dig> in h <dig> in hela cells before and after treatment with interferon-gamma . in addition, binding sites for components of transcription machinery  and p <dig>  were identified to locate active promoters and enhancers, respectively. using these functional sites, heintzman et al <cit>  determined characteristic chromatin modification profiles at the promoters and enhancers – promoters have both h3k4me <dig> and h3k4me <dig> marks in contrast to the prominent h3k4me <dig> presence at enhancers with much reduced h3k4me <dig> signal. using the average profiles of the promoters and enhancers as templates, heintzman et al. identified additional genomic regions sharing similar profiles and confirmed that many of the predictions indeed correspond to promoters and enhancers. figure  <dig> shows the averaged profile of the histone profiles they studied. by comparing the prediction performance of all possible combinations of the six histone marks using cross-validation, they concluded that the combination of h3k4me <dig> and h3k4me <dig> best discriminated promoters from enhancers.

in spite of the success of this profile-based method in predicting promoters and enhancers, it is limited in two aspects. first, the optimal performance of the method involves only two histone modification marks, therefore the prediction accuracy was sensitive to the noise of measurements of these two marks. the contribution of other chromatin modifications marks to the classification method and the interdependency of the histone marks were not considered. second, the window size of histone modification patterns  was chosen in an arbitrary way. the larger the window size, the smaller the portion of the central regions with the strongest signal intensity. thus, the profiles built for the promoter/enhancer may not be optimal. figure  <dig> shows examples of histone modification patterns and annotated genes in human chromosome  <dig>  the tsss of these genes are well aligned with strong histone patterns of promoters. the profile-based method by heintzman et al. correctly identified the promoter near chr: <dig> but not the one near chr1: <dig> because of the relatively weak h3k4me <dig> signal. an enhancer was also identified close to chr1: <dig> because of weak h3k4me <dig>  in figure  <dig> a dhs region and a p <dig> binding peak overlap at chr6: <dig>  showing strong evidence of enhancer. since the h3k4me <dig> signal is relatively stronger than a typical enhancer profile which almost has no signal, the profile based method missed this site. another example near chr8: <dig> shows weak pattern of h3k4me <dig>  which misleads the prediction ).

to overcome the above limitations, we developed a method coupling hmm with simulated annealing   <cit>   to identify promoters and enhancers based on chromatin signatures. the hmm is capable of extracting more information from the chromatin modification profile signals, is less sensitive to the measurement noise of an individual histone mark, and can automatically select the most informative combination of histone marks as well as the optimal window size. in each run of sa we trained hmms <cit>  using the  <dig> promoters and  <dig> enhancers determined by the chip-chip experiments on rnapii, taf <dig> and p <dig> <cit> . inside each hmm, the histone patterns are regarded as continuous observation densities emitted from the hmm states. the number of histone patterns is the input dimension of the hmm. the optimal combination and window size of histone modifications to discriminate promoters from enhancers were searched using the hmm-sa procedure. we then used the trained hmms to predict promoters and enhancers in the entire encode regions. below, we describe this method and the results comparing the performance of our new method with the previous method. we also demonstrated that including more histone marks can further boost the performance of our method, which is also distinct from the profile-based method. in addition, we showed the usefulness of our method on predicting the activity of promoters in the mouse genome using histone modification data generated by chip-seq  <cit> .

RESULTS
find the most informative combination and the optimal window size of histone modifications
to characterize chromatin signature of promoters and enhancers, one needs to define the histone modifications that can discriminate different regulatory elements. since the chromatin signals from chip-chip analysis typically span thousands of base pairs, a small window may not fully capture the chromatin signature while a large window may include non-informative regions to deteriorate the prediction accuracy. therefore, an optimal window size is critical in predicting promoters and enhancers using histone modification patterns. to find the most informative combination and the optimal window size, we coupled the hidden markov model  with simulated annealing   <cit>  .

to compare with the profile-based method, we considered the  <dig> promoters and  <dig> enhancers determined by the chip-chip experiments on rnapii, taf <dig> and p <dig> in the heintzman et al. study <cit> . the datasets were divided into two equal sets, one for training and one for evaluation. the hmm-sa procedure started with a random combination of histone marks and a random window size chosen from  <dig>   <dig>   <dig>   <dig>   <dig>   <dig> and  <dig> kb centered on the tsss or p <dig> peaks. we have conducted  <dig> independent simulations and collected all the final outputs of the combinations of histone marks and the window size.

we found the window size of  <dig> kb to be the optimal window size in  <dig> out of  <dig> simulated annealing runs. as shown in figure  <dig> the strongest and the most informative signals are close to the center but  <dig> kb-window may be too small to capture the characteristic patterns. we also examined the occurrence of histone modification combinations in the  <dig> runs and compared their prediction accuracy on the evaluation set of  <dig> promoters and  <dig> enhancers . the combination of all six marks was selected by the hmm-sa procedure  <dig> times, which is much higher than the other combinations. this observation is not totally unexpected because more information is included when including more histone marks. we also observed that the prediction accuracies for different combinations of multiple histone modifications are comparable with that of all six marks, which may be due to the small data set we have and the dependency of hmms on the initial conditions. the combination of all six histone marks was chosen most often because it has higher chance to get better result in the sa test and insensitive to the choice of initial conditions. for a larger dataset for training and evaluation, the differences between the prediction accuracies of different histone mark combinations are expected to be more significant.

among the pair combinations, the h3k4me <dig> and h3k4me <dig> pair was chosen six times while the combination of h3k4me <dig> and h3k4me <dig> was not found by hmm-sa. examining the histone modification patterns , it is obvious that h3k4me <dig> is more informative to locate enhancers than h3k4me <dig> because h3k4me <dig> shows stronger signal around p <dig> binding sites than h3k4me <dig>  since we did not just classify promoter against enhancer but rather we predicted promoter/enhancer against background, h3k4me <dig> was selected more often than h3k4me <dig>  we next examined which single histone modification is the most informative by simply counting how many times a histone mark was included in the final combination . consistent with the above observation, h3k4me <dig> and h3k4me <dig> turned out to occur most often . this is not surprising because on average these two marks have the strongest signal among all six histone modifications . h <dig> was included  <dig> times even though its signal is relatively weak, which is surprising at the first glance. further examination of h <dig> signals showed that they are consistent and well aligned , which makes it informative in the sense to help locate the center of promoter/enhancer.

cross validation shows that hmm method predicts enhancers more accurately than the profile-based method
using the optimal combination and the window size the hmm-sa procedure found, we conducted five-fold cross-validation tests to compare the performance of the proposed method with the profile-based method <cit> . there were  <dig> promoter and  <dig> enhancer profiles in our analysis . we used three hidden states to train the hmm for promoters and enhancers separately . in total, we performed  <dig> independent cross-validation tests and the averaged results are shown in table  <dig>  the hmm and the profiles-based method have a comparable accuracy on predicting promoters ) =  <dig>  ±  <dig> % versus 96% using all six histone marks). in contrast, significant improvement over the profile-based method was indeed observed on enhancer prediction:  <dig>  ±  <dig> % using all the six histone marks by the hmm versus 78% using all six marks or 85% using h3k4me <dig> and h3k4me <dig> by the profile-based method. it is not surprising that the hmm using all six marks outperforms the profile-based method using only h3k4me <dig> and h3k4me <dig> because more information is included by using more marks. however, as shown by heintzman et al., the profile-based method achieved the best performance using two but not all the six marks. this may explain that the hmm can capture the characteristic pattern better than using profile, particularly for enhancers that have relatively weaker signals than promoters. this is further supported by the observation that the hmm using only h3k4me <dig> and h3k4me <dig> still achieved much higher prediction accuracy on enhancers than the profile-based method .

apositive predictive value  = true prediction/ and standard deviation are calculated.

b <dig> histone signatures: h4ac, h3ac, h3kme <dig>  h3k4me <dig>  h3k4me <dig>  h3

c <dig> histone signatures: h3kme <dig>  h3k4me3

analysis on the trained hmm
after we validated the hmm model using cross-validations, we further examined the probability density distribution of each state in the hmm. the 3-state hmms with no backward transition were trained on promoters and enhancers separately. this type of structures without backward transitions has been widely used in speech recognition to capture the pattern of speech  <cit> . the second state usually corresponds to the location of tss or p <dig> peaks in this configuration. the first and the third states correspond to the upstream and downstream profiles of chromatin modifications, respectively. figure s <dig>   shows the probability density of gaussian mixtures for the three states of every chromatin mark on promoters and enhancers. it is obvious that promoters and enhances present differences in distributions of probability density, which reflects the chromatin modification patterns in these regions. for example, the probability density of h3k4me <dig> showed peaks in the high chip-chip ratio regions for promoters compared to peaks in the low ratio regions for enhancers , see additional file 5). in addition, examining the probability density distribution of the three states in the promoters suggested that the hmm model also captured the characteristics of the chromatin modification profiles. the probability density functions of the third state for h3k4me <dig> were peaked around  <dig>  of chip-chip log ratio. the second state and the first state peaked at low chip-chip ratios with lower probability. this is indeed a bimodal pattern with higher chip-chip ratios on the downstream, which is consistent with the finding in the previous study  <cit> .

promoter prediction in the encode regions
we then applied our model to predicting promoters in the entire encode regions of hela cells before and after treatment with ifnγ. we examined the classification performance of the hmm classifier by counting how many promoter predictions were supported by the annotated tsss  <cit> , cage tags  <cit>  and active promoters  <cit> . we compared the results with the promoter predictions of heintzman et al. they reported  <dig> and  <dig> tss predictions in the untreated and ifnγ treated hela cells in the encode regions  <cit> . figure  <dig> plots the number of predictions supported by the annotated tsss against the total number of predictions by varying the cutoff c <dig> from  <dig>  to  <dig>  . we observed the same number of promoter predictions as the profile-based method at the cutoff  of  <dig>  in the untreated hela cells, and at c <dig> =  <dig>  in the treated cells . we found that 77% and 73% of predictions by the hmm and the profile based method were common for the untreated and treated cell, respectively . the hmm method  did outperform the profile-based method . the hmm method predicted more annotated tsss when the ppv of the two methods were similar to each other: in the untreated cell ppv = 234/ <dig> =  <dig> % and in the treated cells ppv = 247/ <dig> =  <dig> %. when we further increased the number of prediction the total number of correct predictions reached to around  <dig> tsss using the hmm method, while the maximum number of the correct prediction of the profile method was  <dig> correct predictions .

we calculated p value by generating random predictions on the encode regions.

cage tags <cit>  have been generated to map promoters and we investigated if the predicted tsss were supported by cage tags. ideally, only one cage tag is needed to map a promoter. but due to the noise of generating the tags, confident promoter are usually supported by the overlapping with multiple tags. the larger the number of cage tags overlap with the predicted promoters, the more confident the predictions are. we counted the number of predicted promoters supported by at least  <dig>   <dig>  and  <dig> cage tags. we predicted  <dig> and  <dig> promoters in the untreated and the treated cells, respectively, for both the hmm and the profile-based method . when the cage tag cutoff was  <dig>  the hmm method found  <dig>  and  <dig>  promoters supported by cage tags in the untreated and the treated cell, respectively, compared with  <dig>  and  <dig>  supported predictions by the profile-based method, respectively. it is not surprising that the number of the supported promoters decreased when we increased the minimum number of overlapping cage tags. we found that the performance improvement of the hmm over the profile-based method was more significant in the treated cells. considering both methods were trained using the untreated data, it suggests that the hmm method is more robust than the previous method.

we next compared the performance of the two methods on predicting active promoters. gene expression measurements <cit>  showed that there were  <dig> active and  <dig> inactive promoters in the untreated hela cells, and  <dig> active and  <dig> inactive promoters in the treated cells. the profile based method detected  <dig> active and  <dig> inactive promoters in the untreated cells . the two methods correctly predicted similar number of active promoters  when the number of predictions was around  <dig>  while increasing the number of predictions, the profile based method did not but the hmm method did make more correct predictions of active promoters in both treated and untreated cells .

athe total numbers of predictions in table  <dig> are slightly different from table  <dig> because when multiple predicted sites were supported by the same tss or any enhancer evidence, we merged these predictions .

bthe number of correctly predicted active promoters did not change using a lower cut-off in the profile-based method.

we investigated the sensitivity and specificity of each method . figure  <dig> shows the receiver operator characteristic  curves of the hmm and the profile-based methods in the untreated and treated cells. both methods achieved good performance with high sensitivity and specificity but the performance improvement of the hmm method is prominent.

enhancer prediction in the encode regions
we also used the trained hmm to predict enhancers in the encode regions. we found  <dig>  and  <dig>  common enhancers predicted in the untreated  and treated cells , respectively, by the hmm method and the profile-based method with the same number of total predictions. to compare the performances of the two methods, we checked how many of them were supported  by nearby p <dig> and trap <dig> binding sites as well as dnase hypersensitivity sites . p <dig> is a transcriptional co-activator <cit> . trap <dig> is a component of the mediator complex <cit>  that have been shown to bind to enhancers as well as promoters. dhss are nucleosome free regions that are often occupied by enhancers  <cit> . we only considered p <dig>  trap <dig> and dhs sites that are distal  from any tss to avoid confusion with promoters.

in the untreated hela cells, all three sites have been mapped in the encode regions. we calculated sensitivity = tp/ of the two methods . more predictions by the hmm method were supported by any and all of the three lines of evidences. in total,  <dig> out of  <dig> predictions by the hmm method were supported  by any of the three evidences, while the profile-based method made 206/ <dig> =  <dig> % supported predictions . we should point out that there may exist true enhancers among the predicted ones by hmm but not supported by the p <dig>  dhs or trap <dig> data. this may explain the relatively smaller improvement of our method over the profile-based method on enhancer predictions than on promoter predictions.

sensitivity = ) or ppv = ) was calculated.

in the treated cell, only p <dig> binding data was available and it was used to evaluate the predictions of the two methods. while heintzman et al. had  <dig> out of  <dig> predictions overlapping with p <dig> sites , the hmm method found  <dig>  out of  <dig>  p300-supported predictions . again, the hmm method outperformed the profile-based method in this test set.

including additional histone marks can further improve the performance of the hmm method
recently, hon et al. conducted the same chip-chip experiments on more histone modification marks, h3k9ac, h3k18ac, h3k27me <dig> and h3k27ac, in the encode regions <cit> . a robust method should achieve better performance when including additional data. we applied the hmm method to this larger dataset and evaluated its performance as above. after training the hmm predictor using all ten histone marks and a window size of  <dig> kb, same as in the six histone mark dataset, we predicted promoters and enhancers in the encode regions. we observed a significant improvement in the promoter predictions . the hmm method using  <dig> histone marks was quite close to the ideal line even when other methods reached plateau. for example, the hmm made  <dig>  out of  <dig>  correct predictions  using  <dig> histone marks and only  <dig> out of  <dig> correct predictions using  <dig> histone makers. such improvement became more significant when more predictions were made.

the performance of the hmm method on enhancer prediction was also improved using more histone marks . for example,  <dig> enhancers were correctly predicted  using the  <dig> histone marks, compared with  <dig> correct predictions  among the same number  of the total predictions using the  <dig> histone marks. the improvement was not as significant as in the case of the promoters. it is possibly because the evidences of true enhancers  are not as direct as those for the promoters .

prediction of active and inactive promoters using genome-wide chip-seq data
compared with chip-chip, chip-seq is more costly effective and probably also less noisy on mapping chromatin modifications at the genome-wide scale. we investigated how well our method works with the chip-seq data generated by mikkelsen et al. in the three mouse cell lines <cit> : embryonic stem  cells, neural progenitor cells  and embryonic fibroblasts . we first compared the patterns of the four histone marks, h3k4me <dig>  h9k4me <dig>  h3k27me <dig>  and h3k36me <dig>  around tsss because these four marks were measured in all the three cell lines. we assigned each promoter to one of the four groups based on the gene expression level measured in the same study <cit> . we averaged the sequencing read counts of each group around tss. the active and inactive promoters exhibit distinct patterns of all but h3k9me <dig> marks . strong signals of h3k4me <dig> in the active promoters and h3k27me <dig> in the inactive promoters are consistent with their known functions. h3k36me <dig>  a mark for transcriptional elongation, shows a quite spread out pattern around tss.

next, we trained two hmms on  <dig> active and  <dig> inactive promoters randomly selected from the es cell and predicted the promoters in all three cell lines. because the active promoters contain stronger chromatin modification signals  than the inactive promoters, our method predicted more active promoters than inactive ones. the majority of the predicted promoters were within  <dig>  kb of the annotated refseq tsss : > 81% for active promoters and > 66% for inactive promoters. for the predictions located more than 2b from the annotated tsss, these sites can be unannotated promoters or false positives. we then assessed the prediction accuracy of our model using gene expression. among the genes that could be unambiguously called active or inactive, our method correctly predicted the activity of the majority of the promoters. considering the scale of our predictions, the ppvs of both active and inactive promoter predictions  are satisfactory: > 88% and ≥ 74%, respectively, for the two classes.

a active promoter supported by gene expression and refseq: tp is the number of active genes prediction as active and fp is the number of inactive genes predicted as active. b inactive promoter supported by gene expression: tp is the number of inactive genes predicted as inactive and fp is the number of active genes predicted as inactive. in both cases, we only considered predictions located within  <dig>  kb to annotated genes and the total number of predictions is thus usually larger than the sum of tps and fps. refseq supported ppv shows how much percent of the total active/inactive promoter predictions are supported by refseq.

CONCLUSIONS
we present here an hmm method to predict promoters and enhancers using their characteristic histone modification patterns. we used a hmm-sa procedure to automatically select the most informative and the optimal window size of histone modifications. we showed that the more histone marks are considered, the better the performance of the hmm can achieve. we compared the hmm method with the best prediction results using the profile-based method in the heintzman et al. study. the cross-validation test showed that the hmm method performed better than the profile-based method, especially in the enhancer classification . this observation suggests that the hmm method has a better capability to learn complicated patterns particularly for the weak signals around enhancers. because correct identification of distal enhancers is critical in deciphering transcriptional regulation, this feature of hmm gives it an edge over the profile-based method.

we also found that the window size of  <dig> kb gave the best balance between inclusion of sufficiently strong signals and exclusion of non-informative ones that undermine the prediction accuracy. however, the improvement of using a  <dig> kb window instead of  <dig> kb was rather small compared to the use of hmm . it suggests that the improvement in classification is mainly from the hmm's ability to capture the characteristic patterns of histone modifications for multiple marks.

we demons trated that the hmm method outperforms the previously developed profile-based method on predicting promoters and enhancers using chromatin signatures, particularly on the independent test dataset in the hela cells treated with ifnγ. the profile-based method performed well with small number of predictions. it reached the maximum true positives  when the number of promoter predictions was about  <dig> . beyond  <dig>  tps almost do not increase with the number of predictions. in contrast, the hmm method keeps making correct predictions and it outperformed the profile-based method even more significantly . the improvement in enhancer prediction is not significant , which may be due to the limited knowledge of enhancer positions in the genome. we only evaluated the prediction accuracy using the dhs and the binding sites of p <dig> and trap <dig> that may miss many enhancers.

the hmm method is also less sensitive to noise in individual histone modifications. as shown in figure  <dig> the profile method failed to find a tss where h3k3me <dig> signal is weak. the hmm method predicted this tss by using all the histone marks. in figure  <dig> the hmm method predicted an enhancer that is supported by both p <dig> and dhs sites. weak signal of h3k4me <dig> may cause the failure of the profile based method of identifying this site. an opposite example is shown in figure  <dig> where a relatively stronger h3k4me <dig> signal than typical enhancers prevents identification of dhs site to be enhancers by the profile-based method while the hmm method was not affected.

in the present work, we did not further distinguish sub-clusters of promoters and enhancers as in the study of heintzman et al. to avoid overfitting. it is very likely that promoter and enhancers may have distinct histone modification patterns depending upon their functional state   <cit> . as histone modification data are becoming available on more histone marks and on the entire human genome  <cit> , it is possible to train separate or refined hmms for promoter/enhancer in different functional states, which should further improve the performance of our model.

we also demonstrated the success of our approach on analyzing chip-seq data. by including chromatin marks that are characteristics of transcription, our method could successfully predicted the activities of promoters. if annotated enhancers are available for training the hmms, it is straightforward to extend our predictions to enhancers. with the fast accumulation of chromatin modification data, we believe that our method will provide a useful tool in systematically mapping regulatory elements.

