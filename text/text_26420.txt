BACKGROUND
hierarchical clustering  is widely used as a method of partitioning data and of identifying meaningful data subsets across multiple areas of biology including, prominently, high-throughput genomics. most commonly an application consists of visual examination of the dendrogram and intuitive identification of sub-trees that appear clearly distinct from the rest of the tree. obviously, results of such qualitative analysis and conclusions from it may be observer-dependent. quantifying the interpretation of hierarchical trees and introducing mathematically and statistically well-defined criteria for distinctness of sub-trees would therefore be highly beneficial and is the focus of this work.

the need for such quantification was recognized some time ago, and methods have been designed for  identifying distinct data subsets while  making use of hierarchical tree organization of the data. these methods fall into two categories, depending on whether or not they employ statistical analysis. the simplest approach that does not rely on statistical analysis is a static tree cut, wherein the tree is cut into branches at a given height. this procedure is guaranteed to produce a partition of the data, but provides no way to choose the height at which to cut. moreover, some partitions cannot be produced by a static cut. dynamic tree cut, or dtc in the following  <cit> , is a more sophisticated recipe, capable of generating partitions not achievable by a static cut. however, dtc partitions depend on the minimal allowed number of leaves in a branch, a user-defined parameter that cannot be determined by the method itself.

in addition, there are methods for choosing a tree partition from considerations of branch distinctness and its statistical significance. sigclust, or sc in the following  <cit> , is a parametric approach wherein a two-way split of the data is deemed significant if the null hypothesis that the data are drawn from a single multivariate normal distribution is rejected. the method is designed to work in the asymptotic regime, where the dimensionality of the objects being clustered far exceeds the number of the objects. in application to trees sc works in a top-down fashion, by first examining the split at the root node and proceeding from a parent node to its daughter nodes only if the split at the parent node has been found significant. unlike sc, the sum of the branch lengths method, or slb in the following  <cit>  is designed specifically for hierarchical trees and utilizes a measure of distinction between two nodes joined at a parent node that is linearly related to the heights of the two daughter nodes and that of the parent. similarly to sc, slb adopts a top-down scheme.

a method introduced here is termed tree branches evaluated statistically for tightness  and shares features with the existing approaches. like sc and slb, tbest employs statistical analysis to identify significantly distinct branches of a hierarchical tree. similarly to dtc and slb, it uses tree node heights to assess the distinctness of a tree branch. as with the other three methods, partitions generated by tbest are not necessarily accessible by a static cut.

at the same time, tbest differs from the existing designs in several aspects, two of which are critical. first, unlike dtc, sc and slb, it examines all the tree nodes simultaneously for distinctness. secondly, unlike slb, it combines node heights non-linearly to construct a statistic for distinctness that is better able to handle a tree in which distinct branches of approximately equal numbers of leaves occur at different heights. the key properties of all four methods are summarized in table  <dig>  and a comparison of the methods’ computational complexities is provided in additional file  <dig> table  <dig> 
properties of tbest and of the three published methods




in the remainder of this work we formulate tbest and systematically compare its performance to that of dtc, sc and slb on a number of benchmark datasets originating from a variety of biological sources. in all cases we find that tbest performs as well as or better than the three published methods. we conclude by discussing generalizations of tbest and its relation to other aspects of cluster analysis.

methods
consider a set of objects with pair-wise relations given by a dissimilarity matrix. given a linkage rule, a hierarchical tree can be grown for the set. we will only consider inversion-free linkage rules here. the tree is specified, in addition to its branching structure, by the heights of its nodes. the height of the node quantifies the dissimilarity within the data subset defined by the node. we wish to construct, for each node of the tree, a measure of how distinct the data subset corresponding to the node is from the data set. the special case of the objects being points in a euclidean space, with the dissimilarities defined as distances between the points, may be used for guidance in this construction. the node height then quantifies the linear extent of the data subset defined by the node. accordingly, it has been proposed  <cit>  to make the measure of distinctness of a node n linear in the difference in heights between a parent p of n and that of n itself. an example of a one-dimensional dataset, tabulated in additional file  <dig> and shown in figure  <dig>  illustrates a difficulty with such construction. both the subsets shown in blue and in green are clearly distinct from the rest of the data, but the difference in heights between the blue node and its parent is not as great as that between the green node and its parent. thus, based on the parent to child difference in heights, one would conclude, counter-intuitively, that the blue subset is not nearly as distinct as the green subset. a measure in better agreement with intuition is the relative difference of heights:figure  <dig> 
illustration of the definition of tightness. the data consist of  <dig> points in one dimension, drawn from a normal mixture with the components n , n  and n; . a) a histogram of the input data. b) a hierarchical tree of the input data, grown using the absolute difference of the data values as the dissimilarity measure, and single linkage. thus, the node heights shown in  are equal to the corresponding gaps in the data, as indicated in . nodes n
 <dig> and n
 <dig> are approximately equally tight.



  <dig>  

where h is the height of node n. in the following we refer to s as the tightness of node n. in the absence of inversions, the tightness of any node is a number between  <dig> and  <dig>  in particular, s = <dig> identically if n is a leaf. the two subsets highlighted in figure  <dig> are nearly equally tight by this measure, despite the disparity in their heights.

to enable statistical analysis of tightness, a null distribution of s is required, for making comparisons with the observed s. this null distribution is obtained by randomizing the dataset from which trees are grown. how such randomization is to be performed depends on the type of the data and on the broader context of the study and cannot be specified in general. for example, if the data matrix represents gene expression, with genes as rows and observations as columns, it may be appropriate to randomize the data by permuting values independently within each row. however, in other situations a more restrictive randomization should be adopted. for example, the elements of a binary data matrix may represent the mutation status at a set of genomic positions  in a collection of genomes . the investigator may wish to randomize the data while preserving both the site mutation frequencies  and the overall mutation burden within each genome .

here we design a general procedure for constructing the null distribution of tightness for any given data randomization scheme. to guide this design, we generated distributions of tightness in trees grown from randomized data for multiple combinations of datasets, definitions of dissimilarity, linkage rules and randomization methods, as listed in table  <dig>  as figure  <dig> and additional file 1: figure s <dig> illustrate, the shapes of these distributions generally depend on the number of leaves and, in most cases examined, the peak of the distribution occurs at higher tightness for smaller number of leaves. the identity s = <dig> for single-leaf nodes is consistent with this observation. we therefore conclude that, for a given observed value of tightness, the appropriate null distribution should be sampled by repeated randomization of the data, growing a tree for each randomization, selecting among its nodes the ones with the numbers of leaves matching the observation, and determining the tightness of these nodes. however, it is not guaranteed that, in any tree grown from randomized data, there will be a unique node with a number of leaves exactly equal to that of the observed node. to resolve this difficulty conservatively, we adopt the following procedure. if, for a given data randomization, the tree contains nodes with the number of leaves exactly as observed, the highest s computed for these nodes is added to the sample. otherwise we consider all the nodes with the number of leaves nearest the observed one from above and all those with the number of leaves nearest the observed one from below, and add to the sample the highest s of any of these nodes. note that, since s =  <dig> for all single leaves, the latter can never be found significantly tight, and the analysis as described is only valid for internal nodes.table  <dig> 
combinations of data sets, dissimilarity, linkage and randomization methods, used for testing tbest

null distribution of tightness. the null distribution of node tightness s depends on the number of leaves. the empirical probability density distributions for the simulated <dig> set with  dissimilarity – average linkage combination  and for the organelles set with  dissimilarity – ward linkage combination  are shown, for three different values of the number of leaves in each case. each plot is based on  <dig> randomizations of the respective data set.



with the sampling procedure specified, tests for statistical significance of tightness can be conducted for all the internal nodes of the observed tree, excluding the root, since the latter has no parent. the number of tests is therefore two less than the number of leaves. due to this multiplicity of tests, higher levels of significance are required for rejection of the null hypotheses for trees with larger numbers of leaves. a straightforward way to handle this requirement would be to increase the size of the sample from the null distribution by performing more randomizations. however, for trees with large numbers of leaves this simple-minded approach may be rendered impractical by computational cost. instead, higher levels of significance may be accessed by using the extreme-value theory  to approximate the tail of the null distribution, thereby permitting considerable economy of computational effort  <cit> . we have used the evt-based method alongside the more costly purely empirical computation of significance in our benchmark studies reported in the following, and found the two approaches to be in good agreement, as shown in additional file 1: figure s <dig>  the p-values displayed in the following were computed by applying a multiple-hypotheses correction of the form:
  <dig>  

where pe is the empirical p-value and n is the number of leaves.

we use tbest in the following to identify most detailed significant partitions of the data into branches of a given hierarchical tree. we define a partition to be significant with a threshold α if  every part is a branch and  if for every part at least one of the children of its parent node is tight with the p-value p < α. among the significant partitions with a threshold α we find the most detailed, i.e., the one with the highest number of parts.

availability of supporting data
the dataset tabulated in additional file  <dig> was generated by a computer simulation in the course of this work. the remaining five datasets used in this work, as detailed in the results section, are public, and each was made available with the corresponding publication . our study involved no human participants and required no participant consent.

RESULTS
we evaluated the performance of tbest in comparison to three published methods of identifying distinct subsets of observations, namely, dtc, sc and slb. of the five datasets used in the evaluation one is synthetic, generated to simulate a set of gene expression profiles. the remaining four datasets share two common features: they originate in biological experiments and in each case there is an independently known, biologically meaningful partition of observations into types. we call this known partition “truth”, and the corresponding types the true types, henceforth. the essential properties of the benchmark datasets are summarized in table  <dig>  we also tabulated the execution times of the four methods in additional file  <dig> table  <dig> 
properties of the five benchmark datasets




to better judge the performance of tbest in comparison to the other three algorithms, we considered, for each dataset, more than one combination of dissimilarity and linkage methods used for hierarchical clustering. with the exception of the third benchmark case, randomization of the input data, as required for both tbest and slb, consisted of randomly permuting the observed values, independently for each variable. the degree of agreement between a computed partition of the data and the truth is quantified in terms of corrected-for-chance rand index, or cri in the following  <cit> . briefly, the original rand index is a measure of agreement between two partitions,  <dig> and  <dig>  of n objects, defined as the number of concordant pairs divided by the number of all pairs: , where  and  is the binomial coefficient. here  if objects i and j belong to the same part in partition k and  otherwise. cri corrects this definition by accounting for random concordance: , where the expectation e is computed under the assumption that, for each partition, the assignment of objects to parts is random, while the sizes of all parts are given and fixed. it should be noted that the subsets of the data identified as distinct by tbest and the other three techniques by necessity correspond each to a branch of a tree. this, however, is not necessarily the case for the true types, some of which do not correspond to a single branch. as a result, a perfect match between any computed partition and the truth may not be possible, and the maximal attainable value of cri may be below  <dig>  for this reason, to evaluate the performance of tbest and the published methods across benchmark datasets, we also identify, for each tree considered, a partition into branches that best matches the truth and determine cri between that partition and the computed partitions for each of the methods.

in each of the cases in the following we studied how the most significant detailed partition found by tbest, and its correspondence to the truth, vary with the significance threshold α. in an analogous fashion, we analysed the detailed partitions generated by slb and sc. for dtc, which is not a statistically supported method, we examined the properties of the most detailed partition as a function of the minimal allowed number of leaves in each part.

simulated6
the data are a sample of size  <dig> in  <dig> dimensions  <cit> , represented by a 600 ×  <dig> matrix. the true partition of the data is into six subtypes, with the sizes of  <dig>   <dig>   <dig>   <dig>   <dig>  and  <dig>  each of the  <dig> variables represents a simulation of a gene expression. for  <dig> of these genes the values are sampled from the same “background” normal distribution for all subtypes. the remaining  <dig> genes fall into six non-overlapping subsets of equal size. each subset corresponds to exactly one subtype, and for that subtype only the genes in the subset are up-regulated, i.e., sampled from a normal distribution that differs from the background. column  <dig> of the data matrix is exceptional, with both subtype 1- and subtype 2-specific genes up-regulated. properties of this dataset are summarized in more detail in additional file 1: table s <dig> 

the comparison between the four algorithms is displayed graphically in figure  <dig>  for both combinations of dissimilarity and linkage only tbest and dtc match the truth exactly, while the other two methods either fail to partition the set or do so incompletely. we note that the euclidean dissimilarity – complete linkage combination results in a particularly challenging tree, which cannot be partitioned correctly by a static cut.figure  <dig> 
tbest compared to published methods for simulated <dig>  performance comparison of tbest and the three published methods in simulated <dig> dataset for the euclidean dissimilarity – complete linkage combination  and for the  dissimilarity – average linkage . for each combination the left portion  shows the corresponding dendrogram, under which then true partition and the partition best matching the truth for each of the methods are shown as color bars. in the middle portion , the relative cri of the computed partition is plotted against the required level of significance α for each of the significance-based methods. the customary α =  <dig>  threshold of significance is shown by a dashed vertical. in the right portion , the relative cri of the computed partition is plotted against the minimal allowed number of leaves for dtc.



leukemia
the original leukemia dataset  <cit>  contained mrna level values for  <dig> genes; this number was reduced to  <dig> by feature selection  <cit> . the truth is a partition of patient cases into those of acute myeloid leukemia  and of acute lymphoblastic leukemia , and a further partition of the all subset into the b-cell lineage  and the t-cell lineage  types. performance of tbest is compared with that of the other three methods in figure  <dig>  for the ward linkage, two of the significance-based methods, sc and tbest, attain the highest possible value of the cri. however, sc only does so with low significance , while tbest achieves it best performance with high significance  and maintains performance close to optimal in a wide range of significance thresholds. the performance of slb in this case is similar to that of tbest, but slb does not attain the optimum. with the average linkage, tbest outperforms both sc and slb throughout the entire range of significance thresholds considered and attains optimal performance at high significance. in both cases the performance of dtc is highly sensitive to the minimal allowed size of a branch, especially so for the ward linkage, where this algorithm attains top performance for sizes between  <dig> and  <dig>  but performs substantially below the optimum outside this range.figure  <dig> 
tbest compared to published methods for leukemia. performance comparison of tbest and the three published methods in leukemia dataset for the euclidean dissimilarity – ward linkage combination  and for the  dissimilarity – average linkage . for each combination the left portion  shows the corresponding dendrogram, under which then true partition and the partition best matching the truth for each of the methods are shown as color bars. in the middle portion , the relative cri of the computed partition is plotted against the required level of significance α for each of the significance-based methods. the customary α = <dig>  threshold of significance is shown by a dashed vertical. in the right portion , the relative cri of the computed partition is plotted against the minimal allowed number of leaves for dtc.



t10
the third benchmark dataset originates from dna copy number analysis of  <dig> individual cells harvested from a breast tumor  <cit> . the true partition in this case is four-way, with the subsets differing from each other by ploidy as determined by cell sorting. the rows of the data matrix correspond each to a cell, the columns correspond each to a pre-defined genomic region of recurrent copy number variation called a core, specified by the sign of variation  and the endpoint positions of the region. the entries in the matrix quantify the extent to which copy number alterations observed in the cells match the cores  <cit> .

there are multiple instances of strong geometric overlap between cores. as a result, the corresponding columns in the data matrix exhibit strong pairwise correlations, positive for cores of equal sign , and negative for cores of opposite signs. consistent with these geometric constraints, the null distribution in this case is generated as follows: the data matrix is divided into sub-matrices by the chromosome number , and rows are permuted independently within each sub-matrix. the results are illustrated in figure  <dig>  for the euclidean dissimilarity - ward linkage combination only tbest and slb identify the true partition, with tbest succeeding in a broader range of significance thresholds. for the  dissimilarity - average linkage combination tbest outperforms the other two significance-based algorithms and matches the truth perfectly in a broad range of the values of α.figure  <dig> 
tbest compared to published methods for t <dig>  performance comparison of tbest and the three published methods in t <dig> dataset for the euclidean dissimilarity – ward linkage combination  and for the  dissimilarity – average linkage . for each combination the left portion  shows the corresponding dendrogram, under which then true partition and the partition best matching the truth for each of the methods are shown as color bars. in the middle portion , the relative cri of the computed partition is plotted against the required level of significance α for each of the significance-based methods. the customary α = <dig>  threshold of significance is shown by a dashed vertical. in the right portion , the relative cri of the computed partition is plotted against the minimal allowed number of leaves for dtc.



organelles
next, we consider a dataset derived from proteomic analysis of the content of four cellular compartments in each of six mouse tissues. the analysis is based on  <dig> protein level readings  <cit> .

the true partition of the data is by the cellular compartment, and the two hierarchical clustering methods considered here both have the branch structure organized by the compartment label, to a good approximation. of the three significance-based methods compared, only tbest reproduces the truth to the maximal extent possible for both combinations of dissimilarity and linkage, and it does so stably in the broadest range of the levels of significance .figure  <dig> 
tbest compared to published methods for organelles. performance comparison of tbest and the three published methods in organelles dataset for the  dissimilarity – ward linkage combination  and for the  dissimilarity – average linkage . for each combination the left portion  shows the corresponding dendrogram, under which then true partition and the partition best matching the truth for each of the methods are shown as color bars. in the middle portion , the relative cri of the computed partition is plotted against the required level of significance α for each of the significance-based methods. the customary α =  <dig>  threshold of significance is shown by a dashed vertical. in the right portion , the relative cri of the computed partition is plotted against the minimal allowed number of leaves for dtc.



dtc achieves top performance for the  dissimilarity – ward linkage combination if its minimal allowed number of leaves does not exceed that of the smallest compartment-associated branch of the tree. however, this property is lost for the  dissimilarity – average combination where an additional cluster with two leaves is identified by dtc if the minimal number of leaves is set at or below  <dig> 

chondrosarcoma
finally, we discuss the performance of the four methods on a dataset generated by flow cytometry analysis of cells harvested from human tissues and cell lines. among  <dig> samples, two samples were identified as multivariate outliers and removed before clustering  <cit> . the truth is a four-way partition, with three parts corresponding each to a different tissue of origin and the fourth part formed by cells from tumor cell lines.

we have identified three combinations of dissimilarity and linkage for which the tree structure is fully consistent with the true partition and performed comparative analysis for all three, as shown in figure  <dig>  for two of these combinations  dissimilarity – ward linkage and  dissimilarity – average linkage) partition by tbest matches the truth in a range of acceptable levels of significance. slb does so for the first and, in a narrow range of significance thresholds, for the third combination. sc fails to match the truth. note the data dimension in this case is  <dig>  and it is smaller than  <dig>  the number of observations. this dataset is therefore outside the range of applicability of sc. for manhattan dissimilarity – ward linkage tbest also matches the truth, albeit at low significance . dtc performs well for the first and third combinations, but only matches the truth in a restricted range of numbers of leaves in the second case.figure  <dig> 
tbest compared to published methods for chondrosarcoma. performance comparison of tbest and the three published methods in chondrosarcoma dataset for the  dissimilarity – ward linkage combination ,  dissimilarity – average linkage combination , and manhattan dissimilarity – ward linkage . for each combination the left portion  shows the corresponding dendrogram, under which then true partition and the partition best matching the truth for each of the methods are shown as color bars. in the middle portion , the relative cri of the computed partition is plotted against the required level of significance α for each of the significance-based methods. the customary α =  <dig>  threshold of significance is shown by a dashed vertical. in the right portion , the relative cri of the computed partition is plotted against the minimal allowed number of leaves for dtc.



discussion and 
CONCLUSIONS
as our test results demonstrate, the performance of tbest as a tool for data partitioning is equal or superior to that of similar published methods in a variety of biology-related settings. this is true in particular for datasets with underlying tree-like organization, such sets of genomic profiles of individual cancer cells, of the same type as our third benchmark case above. in a work presently in progress we are applying tbest systematically to a number of datasets of a similar nature. but tbest also performs well on datasets with no underlying hierarchical structure, such as simulated <dig> or leukemia above. in total, tbest was able to recover the true partition of the data on par with or better than the published methods in ten out of eleven combinations of data, dissimilarity and linkage considered here. we further note that for all but one such combination the optimal partition of the data by tbest also was the most significant partition into more than one part. this was not the case for the other significance-based methods included in the comparison.

to guide the future use of tbest, we must note the limitations of the method. tbest is designed specifically for the analysis of hierarchical trees. in this sense, it is not as universal as sc, which is applicable to any partition of the data, including, in the case of hierarchical clustering, to trees with inversions. further, tbest never considers single leaves to be significantly distinct, whereas both slb and dtc  are free of this limitation.

tbest can both be applied and formulated more broadly. the applicability of tbest is not limited to data partitioning that has been our focus here. tbest can be used for finding all significantly distinct branches of a hierarchical tree, regardless of whether these form a full partition. further, alternatives to the test statistic of equation  <dig> can easily be devised, for example, for any non-leaf node n we can introduce:
  <dig>  

where c <dig>  c <dig> are the two children of n. while the discussion of these extensions is beyond the scope of this work, an implementation of tbest as an r language package provides a number of options, both for the definition of tightness and for annotation of significantly distinct branches  <cit> .

finally, we note that tightness of tree branches is complementary to another important notion in clustering, namely, cluster stability under re-sampling of the input data. the latter property can be analysed in a number of ways, such as bootstrap analysis of trees  or methods not directly related to trees  <cit> . existing work provides examples where both distinctness and stability under resampling are prerequisites of a meaningful partition  <cit> . incorporation of tbest into such combined analysis will be addressed in the future.

electronic supplementary material
additional file 1:
a time complexity and performance analysis, figure s <dig>  figure s <dig> and table s <dig>  a pdf file containing 1) a comparison of time complexity and performance for tbest, sc, slb and dtc, 2) figure s <dig>  an 11-panel figure illustrating null distribution of tightness, 3) figure s <dig>  a comparison of empirical p-value estimates for tightness to evt-based estimates and 4) table s <dig>  detailing the properties of the simulated <dig> dataset. 

 additional file 2:
dataset displayed in figure 1
. an excel file containing a set of  <dig> positive real values sampled from a mixture of three normal components: n, n and n. 

 competing interests

the authors declare that they have no competing interests.

authors’ contributions

gs and ak designed the study, wrote software, performed statistical analysis and wrote the manuscript. both authors read and approved the final manuscript.

