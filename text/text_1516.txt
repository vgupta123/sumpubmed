BACKGROUND
a diverse repertoire of t- and b-cell antigen receptors is a critical component of host defense system in vertebrates called adaptive immunity which ensures readiness and ability to detect and mount an effective response against the great variety of encountered pathogens. t- and b-cell receptor repertoire is formed by genomic rearrangement of variable , diversity  and joining  segment loci in a process called v--j recombination  <cit> . each of the resulting segment junctions carry complementarity determining region  <dig>  that plays a key role in antigen recognition and largely defines the specificity of t-cells and immunoglobulins  <cit> . recent advances in molecular methods and high-throughput sequencing allow to profile antigen receptor repertoires using a technique called rep-seq  <cit> . raw receptor sequences produced by rep-seq can be processed by one of the existing bioinformatics software tools  to map v--j junctions and extract cdr <dig> regions, thus forming a set of clonotypes - unique combinations of v, d and j segments, and cdr <dig> sequence. those mappings are then assembled to estimate individual clonotype frequencies that reflect clonal expansions caused by antigen recognition, peripheral selection  <cit>  and convergent v--j recombination processes  <cit> . resulting datasets are inherently complex due to extremely high diversity of t- and b-cell receptor sequences and a plethora of physiological factors that shape the repertoire structure  <cit> .

rep-seq technique has the potential to become a method of choice for biologists studying adaptive immunity  <cit> , however the software framework behind this field is still relatively immature. importantly, this field is in need of tools that can be used by biologists with little or no computational knowledge: while there is a substantial number of tools dedicated to data processing , there is a considerable lack of options to analyze resulting immune repertoire profiles. in order to fill this critical gap we have developed vdjviz, an open-source web-based graphical user interface  software for rep-seq data browsing. main features of vdjviz can be summarized as follows:a parser that supports output from  <dig> commonly used rep-seq processing software: mitcr, migec, mixcr, igblast, imgt highvquest and immunoseq platform; as well as an internal concise tab-delimited format.

an intuitive clonotype table viewer with v--j markup that can be used to navigate through the entire sample and perform complex searches.

comprehensive single sample analysis modules calculating basic repertoire statistics and providing interactive spectratype, v/j segment usage and clonality plots.

extended multi-sample analysis that includes clonotype tracking and sample intersection with a flexible set of clonotype matching rules, repertoire diversity comparison using rarefaction and simple side-by-side comparison of single sample analysis results.

export of analysis results and dataset sharing.



implementation
vdjviz is a web based gui application that uses vdjtools api  as a back-end. the software utilizes play framework  for running the server instance and state-of-art web graphics libraries such as d3js  for visualization. the reason for choosing play framework is its stability and ease of deployment, while d3js allows us to create complex interactive plots. the browser is lightweight and uses around 4gm ram to host several users analyzing  <dig> samples of up to  <dig>  clonotypes, which is the upload limit for the demo version available online. this limit can be removed for local installations to allow browsing large samples using better hardware. in most cases users can also down-sample clonotype abundance tables  to view large samples with commodity hardware.

RESULTS
to the best of our knowledge, in contrast to the rich set browsers available in the field of genomics , the only published software that falls in immune repertoire browser category so far is imex  <cit> . existing unpublished solutions for immune repertoire browsing include vdjserver , vidjil browser  and immunoseq analyzer . in this section we will first compare the functionality of vdjviz with aforementioned web tools and demonstrate vdjviz features on the set of relevant examples further in the text.

imex is a closed-source gui software that allows computing basic repertoire statistics, analyzing v-d-j segment usage, performing diversity estimation and provides some options for comparing clonotype tables. the software is implemented using .net technology and can natively run on windows. running it on unix-based systems requires setting up the mono framework . there are several general limitations of imex compared to vdjviz. first, imex limits its analysis to datasets produced by imgt high-v/quest software while vdjviz allows both imgt high-v/quest input and input generated by other software tools. imgt high-v/quest is frequently used by immunologists, however the current upload batch size of  <dig>  mln reads and variable submission/processing times makes it unfeasible for analysis of large datasets containing tens of millions of reads. next, currently imex is limited to trb and igh loci while no such limitation exists in vdjviz. however the most important issue with imex is the way it estimates one of the key immune repertoire parameters, repertoire diversity  <cit> . imex fits the a × ) + k × n function, where n is sampling depth, a is real number of clonotypes and k is the error rate, using an optimization algorithm to the rarefaction curve obtained by random re-sampling. this empirical model can produce spurious results in some common settings and cannot reliably distinguish rare clonotypes and errors. for example, let us consider a highly diverse and uniform repertoire  and note that corresponding rep-seq data can have negligible error rate if produced using high-fidelity protocols  <cit> . the rarefaction curve in error-free setting is a linear function of sample size  <cit> . on the other hand, the optimal parameters for model used in imex can be selected as k =  <dig> and a = 0/b = any or b = 0/a = any in this setting, thus either rendering all clonotypes as erroneous or providing an arbitrary number of clonotypes in a sample that depends on the seed of the random number generator used by the optimization algorithm. vdjviz, on the other hand implements a robust and commonly used rarefaction algorithm  <cit>  leaving the choice of error correction strategy up to the user.

vidjill browser is an extension of recently published vidjil rep-seq processing software  <cit> . the major difference between vidjil browser and vdjviz lies in the repertoire browsing implementation and repertoire analysis features. vidjil browser operates with v-d-j signatures of clonotype clusters and implements a graphical clonotype tracking interface with an aim to facilitate clonotype tracking for mrd detection and monitoring. vdjviz, on the other hand, lists individual clonotypes in tabular format and all the relevant information such as v,d and j segments and the cdr <dig> region sequence, which allows to directly browse the clonal composition of sample and perform clonotype table searches using pattern-matching and filters. notably, vdjviz implements some of the commonly used analysis modes such as diversity estimation and spectratyping that are not present in vidjil browser. vdjviz also implements basic clonotype tracking functionality in its cross-sample intersection and clonotype search modules. vdjviz doesn’t limit clonotype tracking to samples coming from the same donor, allowing to match clonotypes based on cdr <dig> amino acid sequences and therefore allows exploring clonotypes shared by several different donors.

vdjserver software, being in beta version, incorporates v-d-j mapping engine and requires to upload raw sequencing data, which can be both considered as a benefit and a limitation comparing to vdjviz that accepts processed data in multiple formats. while doing data processing on server side facilitates analysis for data produced using common library preparation protocols, it is unfeasible to implement a general algorithm that covers all possible customizations of those protocols and complex cases such as multiplexing and unique molecular identifier tagging  <cit> . the output provided by vdjtools includes segment usage chart and v-d-j mapping statistics, while clonotype tables are only available as a downloadable plain text file, which is far less than the functionality provided by vdjviz, vidjil browser and imex.

immunoseq analyzer is a commercial software and supports only customer data produced by corresponding commercial assay. immunoseq has a rich feature set, some of which are not present in vdjviz, namely a variety scatterplots for sample comparison, immunoglobulin somatic hypermutation and edit distance analysis. vdjviz, on the other hand, offers more options for diversity estimation including rarefaction analysis and clonality plot, clonotype-level detalization for sample intersection and a powerful clonotype search engine. clonotype search algorithms of vdjviz are also more flexible: various filters such as segment filter can be used in combination, user can search for cdr <dig> sequence patterns and several clonotype matching modes are supported, for example amino acid-not-nucleotide matching that can be used to filter cross-sample contaminations.

below we present six example cases that demonstrate the usability of vdjviz for common immune repertoire analysis tasks, in-depth browsing of repertoire clonal composition and detection of rep-seq artifacts. data for reproducing all the examples presented here is available in the “examples” folder of vdjviz source code repository, all figures in this paper are screenshots of vdjviz browser interface.

example 1: spectratyping
the first example demonstrates a variation of conventional spectratype  analysis that also visualizes the most abundant clonotypes. repertoires of  <dig> and 64 years old healthy donors from our aging study  <cit>  were analyzed. those samples were prepared using a protocol that allows accurate tcr beta cdna molecules quantification, normalized to  <dig>  uniquely labeled  <cit>  tcr beta cdna molecules by down-sampling, and spectratype plots were compared. as expected  <cit> , the repertoire of 6 years old shows a bell-shaped spectratype with almost no clonal expansions. the repertoire of 64 years old donor reveals several substantially expanded clonotypes highlighting significant changes in t-cell repertoire structure .fig.  <dig> spectratypes of  <dig> and 64 years old donors. each bin of the histograms corresponds to the length of cdr <dig> nucleotide sequence, clonotypes were weighted by their frequency and the fraction of top  <dig> most abundant clonotypes is shown with colored bars. note that bars at cdr <dig> lengths that are not a multiple of  <dig> represent out-of-frame clonotypes



spectratype can also be used to spot out-of-frame clonotypes and a thorough look at fig.  <dig> reveals the abundance of out-of-frame clonotypes in  <dig> yo sample . summary report provided by vdjviz shows that the total abundance of out-of-frame clonotypes is ~ <dig> times more for the young donor compared to aged one . out-of-frame tcr sequences are extremely useful for studying v--j recombination mechanics  as they are not subject to thymic selection. however, they are relatively rare in mrna-based samples due to nonsense-mediated mrna decay. the result shown on fig.  <dig> suggests that a deeper sampling is required to detect a sufficient number of out-of-frame clonotypes for repertoires having a high fraction of expanded clonotypes.

example 2: variable and joining segment usage
the next example shows the analysis of immune receptor segment usage. we have first compared repertoires of helper  and cytotoxic  t-cell subsets from a donor that has undergone an autologous hematopoietic stem cell transplantation  using v-spectratype, a histogram of clonotypes binned by cdr <dig> length and variable segment. it has been previously shown that post-hsct t-cell repertoire exhibits clonal expansion associated with cytotoxic t-cell response to cytomegalovirus  . as it can be seen from the spectratype shape in fig. 2a, the clonal expansions are indeed associated with cytotoxic t-cells and result in altered variable segment usage profile. variable segment usage profile changes can be also seen from variable-joining usage analysis while browsing the bulk pbmc repertoires of the donor before and after hsct .fig.  <dig> variable segment spectratype and variable-joining segment usage chord diagram. a distribution of cdr <dig> nucleotide sequence lengths weighted by clonotype frequency. most enriched variable segments are explicitly shown. b chord diagram of variable-joining junction abundance. segment lengths are scaled according to the abundance of a specific segment, arc widths scaled by the abundance of corresponding variable-joining junctions



example 3: clonality analysis
immune repertoire diversity is one of the key characteristics of the state of adaptive immune system that reflects the ongoing inflammatory processes and defines its ability to effectively mount a response to newly encountered antigens  <cit> . the following example shows that diversity estimation from rep-seq data could be a tricky procedure. for this example we have taken samples, hereafter denoted as b and c, representing repertoires of pbmcs from two healthy female donors of the same age described in ref.  <cit> . the samples were normalized to  <dig>  uniquely labeled cdna molecules by down-sampling. the observed diversity computed as the total number of clonotypes is  <dig> for sample b and  <dig> for sample c, thus b appears to represent a more diverse repertoire. however, closer inspection  with vdjviz quantile plot feature reveals that sample c has a single dominant clonal expansion, while sample b is characterized by multiple clonal expansions contributing to a heavy tail of clonotype size distribution and effectively having less diversity than sample c. this can be illustrated by calculating efron-thisted estimate of total diversity which result in  <dig> +/− <dig> for sample b and  <dig> +/− <dig>  for sample c. therefore, given a sufficient profiling depth the immune repertoire of donor c will turn out to be more diverse than the repertoire of donor b.fig.  <dig> vdjviz clonality plot, a nested pie chart divided into the following regions: singletons , doubletons , high order . high order clonotypes are divided into five quantiles . top ten clonotypes of the first quantile are explicitly shown. size of each segment is the cumulative frequency of all clonotypes that fall into corresponding frequency category



example 4: rarefaction and error correction
error correction is a critical data processing step in the context of highly complex immune repertoire data. high number of erroneous clonotypes can result in artificial increase of the observed repertoire diversity  <cit> . here we compare various error correction methods using rarefaction analysis  <cit>  implemented in vdjviz . for this purpose two healthy donor pbmcs replicate samples each carrying ~2000 t cells were taken from  <cit> . those cdna libraries were prepared using unique molecular identifier  tagging approach, and sequenced to a high read-per-umi coverage allowing nearly complete elimination of pcr and sequencing errors  <cit> . the correction resulted in the estimate of ~ <dig> tcr beta cdna molecules and ~ <dig> clonotypes per sample and was used as a gold reference for comparison of various error correction approaches.fig.  <dig> vdjviz interactive rarefaction plot  for t-cell repertoires from two replicate pbmc samples processed with various error correction strategies including quality filtering , elimination of clonotypes encountered only in one of the samples  and frequency-based error correction . solid lines show rarefaction curves computed using observed clonotype frequencies, dashed lines represent their extrapolations. note that the expected sample diversity is ~ <dig> clonotypes according to umi-corrected data



first, we tested quality-based filtering  by removing all clonotypes that have at least one low-quality base  in their cdr <dig> sequence. such filtering has a relatively small effect on the observed diversity which is more than  <dig> times higher than the value expected from umi-corrected results. notably, using only clonotypes that were found in both samples results in observed diversity that is still ~ <dig> times larger than the expected value, confirming the previous observations that errors that result in artificial diversity are highly reproducible  <cit> . this indicates that using replicate-based error correction to investigate repertoire diversity  <cit>  is a strategy that should be applied with a great caution. using frequency-based error correction for quality-filtered sample, namely requiring more than 1: <dig> abundance ratio difference for merging clonotypes that differ by a single mismatch, showed the best result, yet the observed diversity was still ~60 % higher than the expected value obtained using umi-correction.

the accuracy and pitfalls of quality- and frequency-based error filtering strategies were previously characterized using a synthetic dataset  <cit> . as for the comprehensive characterization of the accuracy of umi-based techniques that are considered as gold-standard in present example, the reader should refer to recently published studies  <cit> .

example 5: errors and contamination in repertoire sequencing data
our next example demonstrates the clonotype browser engine. in order to visualize the erroneous clonotypes that were the cause of artificial diversity in previous example we have searched for the cdr <dig> amino acid sequence of the second most abundant clonotype in quality-filtered sample # <dig>  as it could be seen from fig. 5a, there is a tail of erroneous sub-variants that differ from the real cdr <dig> nucleotide sequence by a one or more mismatches and are absent in umi-corrected data. similar results were obtained for other highly-abundant clonotypes.fig.  <dig> vdjviz clonotype browser interface snapshots showing clonotypes matching a given cdr <dig> amino acid sequence in a single sample  and across multiple samples . a a trace of erroneous variants for one of the top clonotypes from sample2_q <dig> dataset described in example# <dig>  b matching the cdr <dig> nucleotide sequence of a cancer clonotype in post-treatment samples. the panel shows presence of minimal residual disease in corresponding patient , as well as cross-sample contamination in two other patients



next, we have browsed samples from recently published minimal residual disease  study  <cit>  to address the issue of cross-sample contamination. in lymphomas, mrd can be monitored by tracking the malignant clonotype sequence in post-treatment immune repertoire. cross-sample contamination, however, can be a serious issue in this case: contamination with the malignant clonotype which is usually highly abundant can lead to false positive mrd detection. we have checked for the cancer clonotype sequence reported for patient pt- <dig> in post-treatment samples of other patients . notably, repertoires of  <dig> out of  <dig> patients appear to contain exactly the same sequence. this can be hardly explained by coincidence, as no other nucleotide variants were found for the dominant clonotype’s amino acid sequence ruling out convergent recombination. high number of added n-nucleotides in v-d-j junction also supports the fact that cdr <dig> nucleotide sequence matching in  <dig> samples simply by chance is highly improbable . notably, the most abundant contamination is present at the level of  <dig> reads per  <dig>  in this example case. thus, while the method is extremely sensitive and can detect mrd at a level of  <dig> read per  <dig> , such contaminations can severely dampen method’s precision.

example 6: public clonotypes
our last example demonstrates detection of so-called “public” clonotypes, that are a fundamental feature of t-cell repertoire implicated in immune responses to common pathogens and autoimmune responses  <cit> . we have searched for shared clonotypes in  <dig> samples each down-sampled to  <dig>  uniquely labeled cdna molecules coming from healthy donors of various ages  <cit>  and required cdr <dig> amino acid, but not nucleotide, sequence matching in at least  <dig> of them for a clonotype to be considered “public” . the total number of unique cdr <dig> amino acid sequences in those samples was  <dig>  and  <dig> of them represented public clonotypes according to aforementioned criterion. we have next compared our list of clonotypes to data reported by freeman et al.  <cit>  for a rep-seq study of pooled pbmcs coming from  <dig> individuals of various sex, age and racial background. we found an exactly matching cdr <dig> amino acid sequences for  <dig> of clonotypes that we consider “public” . many of those clonotypes can be found in other studies  using google search engine. that way we have observed  <dig> of our “public” clonotypes being reported among  <dig>  cancer-specific clonotypes in a recent pancreatic tumor rep-seq study  <cit> . the probability of such overlap occurring by chance is p = 2 × 10− <dig>  due to high number of unique cdr <dig> amino acid variants, highlighting the need for careful statistical testing that account for the presence of clonotypes with a high degree of sharing when dealing with tasks such as tumor-specific clonotype calling. this also suggests that a database of public clonotypes would be a useful resource that can limit the number of false-positives in this case.fig.  <dig> a snapshot of clonotype sharing  across multiple samples. clonotypes of  <dig> healthy donors of various ages were matched by their cdr <dig> amino acid sequence selecting the ones that were present in at least  <dig> repertoires



while the examples demonstrated here mostly deal with tcr beta sequences, vdjviz can also handle tcr alpha , gamma and delta sequences, as well as immunoglobulin sequences , albeit with no support for hypermutations in cdr <dig>  and framework regions. overall the examples presented here demonstrate that the analysis modes provided by vdjviz are highly informative and can be used both for explorative analysis and for quality control. the latter is crucial as a multitude of biases can arise due to complexity of rep-seq data. while those biases can be dealt with using corresponding techniques or removed manually, their extent should be routinely checked every time an analysis of rep-seq data is performed.

while vdjviz web tool can be extended in many ways by adding new analysis types, the most important challenge is to implement intuitive interface for visualizing somatic hypermutations in b-cell repertoires  <cit>  and novel paired-chain rep-seq data .

CONCLUSIONS
as we have demonstrated, vdjviz allows to have a grasp of immune repertoire structure for samples of interest in several clicks and can be easily used by immunologists and biologists with little computational knowledge. vdjviz is not limited to a single library preparation protocol or rep-seq processing software including highly popular imgt highvquest  <cit>  and immunoseq platforms . vdjviz allows great flexibility and can be easily installed as a local server, therefore we believe that in perspective it can become a handy tool-of-choice for immunologists routinely working with immune repertoire data.

availability and requirements
• both standalone and online demo vdjviz versions can be found at https://github.com/antigenomics/vdjviz.

• operating system: platform independent.

• programming language: java, javascript, scala.

• other requirements: java  <dig> , play framework.

• license: free for non-profit and academic use.

additional files
additional file 1: figure s <dig>  shared tcr alpha cdr <dig> amino acid sequences in t-regulatory cells reported in ref.  <cit> . note the highlighted clonotype, that is almost exclusively present in wild-type samples, but not cns3-ko samples that have an altered t-regulatory cell repertoire structure. 

additional file 2: figure s <dig>  a representative view of clonotype table from a sequencing experiment involving a hypermutating raji cell line  showing cdr <dig> hypermutations. 



funding
this work was supported by the russian science foundation project №14-14- <dig>  shugay m and putintseva ev are supported by individual fellowship mol-a-dk rfbr grants 16-34- <dig> and 16-34- <dig>  the funders had no role in study design, data collection and analysis, decision to publish, or preparation of the manuscript. library preparations was carried out in part using equipment provided by the shemyakin–ovchinnikov institute of bioorganic chemistry core facility.

authors’ contributions
dvb and ms developed software. ivz, ovb, mi, and evp prepared the cdna libraries and performed software testing. ms worked on the manuscript. dmc worked on the manuscript and supervised the work. all authors read and approved the final manuscript.

competing interests
the authors declare that they have no competing interests.

consent for publication
not applicable.

ethics approval and consent to participate
not applicable.
