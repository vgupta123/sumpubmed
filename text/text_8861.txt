BACKGROUND
although lateral genetic transfer  has been recognized for many decades as a potentially important force driving the evolution of prokaryotes  <cit> , only in the genome sequencing era has its frequency and importance been fully appreciated  <cit> . lgt mediated by processes of dna transfer and recombination occurs within populations of closely related bacterial strains  <cit> , can operate at great phylogenetic distances  <cit> , and can affect bacteriophage, viruses, protists and multicellular eukaryotes  <cit> . some observed lgt events are obviously transient and likely part of a cycle of saltation and purging  <cit> , while others confer clear adaptive advantages to their host, and have become fixed in a set of descendent lineages  <cit> . the principal evolutionary consequence of lgt is that traits do not need to be invented ab initio within a genome through  neofunctionalization of a paralogous sequence, but can instead be rapidly acquired from another organism and integrated into the host regulatory and metabolic apparatuses  <cit> . grasping the nature and extent of lgt is fundamental to our understanding of evolution, but at the same time is essential if we are to understand how specific microorganisms and communities of microorganisms can change in response to new environmental challenges and opportunities.

the inference of historical events from modern genome sequences is a challenging task that has spurred the development of many phylogenetic and non-phylogenetic methods. technical problems include defining models of sequence similarity and evolution, choosing a sequence data set of interest , and implementing thresholds that demarcate vertical, lateral, and 'uncertain' relationships: each of these will influence the recovered frequency of lgt, the types of genes implicated, and the genomes that preferentially share genes. the very definition of 'vertical' vs. 'lateral' requires that some component of the evolutionary signal recovered from a set of genes be accorded privileged status, tracking a tree of life or, more weakly, a tree of cellular divisions. decisions on which signals are to be treated as vertical are often based on a plurality consensus or a subset of core genes that are thought to be recalcitrant to transfer  <cit> .

the problems with using an aggregated or consensus signal to define vertical inheritance are twofold. first, while overwhelming support for a particular relationship might be taken to indicate vertical inheritance, the phylogenetic signal becomes less clear as deeper and deeper relationships are examined, to the point where little can be confidently said about the relationships among bacterial phyla, either in phylogenetic or phylogenomic terms  <cit> . second, in any case where conflicting phylogenetic signals are combined, the obtained consensus may reflect phylogenetic averaging artifacts that capture none of the input evolutionary signals  <cit> . in such cases, relationships that appear to be lateral in nature may in fact be vertical or vice versa, or the entire set of implied evolutionary connections may be invalid. a frequently cited example of this is the thermophilic bacterium aquifex aeolicus, which has been described as an early-branching bacterium with similarities to thermotoga and other thermophiles including many archaea  <cit> , or as an unusual proteobacterium with strong lgt connections to other thermophiles  <cit> . detailed analysis of many phylogenetic trees can reveal the complex relationships of such lineages, whereas aggregation of these signals conflates the set of affinities they have to other lineages. however, alignments of single genes or proteins may not harbor enough information to recover evolutionary relationships with high confidence.

in spite of these limitations, building a comprehensive profile or map of genetic affinities is a worthwhile goal. recent efforts have characterized phylogenetic discordance without reference to a 'central tendency' tree. puigbò et al.  <cit>  searched for trends of phylogenetic consistency, first among  <dig> large, 'nearly universal' trees and then using several thousand trees with no taxonomic restriction, and found rampant discordance but also a statistically supported central trend of concordance. consistent with previous work  <cit> , concordance was highest among closely related lineages, whereas little or no consistency was found in the deeper relationships within bacteria and archaea. susko et al.  <cit>  used a heatmap approach to characterize the consistency of relationships within the gamma-proteobacteria, and found weak phylogenetic agreement within the data set. however, their results also highlighted a pitfall of many analyses: the majority of genes failed to strongly support any relationship, and treating these genes as if they agreed with the plurality signal would overestimate the support for a single evolutionary path. lima-mendez et al.  <cit>  developed a novel approach for bacteriophage genomes based on markov clustering and graph reconstruction, with nodes representing individual phage genomes and edges representing genes common to both linked genomes. phage relationships are not generally thought of in terms of a phylogenetic tree, and indeed the authors were aiming to define coherent 'modi'  <cit>  for multidimensional classification. it is perhaps natural that such a scheme, which presumes nothing about the laterality or verticality of relationships, was first developed for phage genomes. more recently, a similar network approach was applied to gene sets from >  <dig> prokaryotic chromosomes and >  <dig>  vector  sequences, with analysis of graph connectivity suggesting that plasmids and not phage are key elements linking genomes  <cit> .

while networks that capture all affinities or the best affinities of all genes in a genome can usefully display lateral connections, it is worth considering the entire spectrum of relationships for each gene under consideration. this can be important if, for instance, the best few blast matches to a given query protein are statistically indistinguishable. we have developed an approach to analyze and visualize the affinities among genomes which is based on linear programming . this algorithm considers the relative strength of different matches and aims to recover distinct affinities of different members of a set of genomes. for each genome in turn, the method uses a series of similarity scores  to construct a weighted, directed graph which we term an intergenomic affinity graph with large connection weights reflecting strong affinities between genomes. the use of a directed graph allows us to observe asymmetric relationships in which a given genome a has contributed genetic material to another genome b, but not vice versa. we first demonstrate the utility of our method by benchmarking on genome data simulated under various regimes of lgt, then apply it to two distinct sets of microorganisms: a set of thermophiles with affinities to a. aeolicus, and the pseudomonads, a group with highly plastic genomes that can thrive in many habitats.

RESULTS
we start this section by defining the intergenomic affinity graph, and introducing the idea of 'comparison genomes' that are used as the building blocks for this graph. following this, we formulate several candidate techniques for computing comparison genomes, several variants of which are based on lp. details of the parameter settings used for blast and evolsimulator can be found in the methods section.

intergenomic affinity graphs and optimal comparison genomes
an intergenomic affinity graph g for a set of genomes c = {c <dig>  c <dig>  ..., cm} is defined as a set of vertices v = {v <dig>  v <dig>  ..., vm}, each corresponding to a genome in set c, and a set of edges e. an edge from vertex v <dig> to vertex v <dig> implies that a subset of c1's genome has an affinity to a subset of c2's genome that is relatively strong in comparison to other members of c. a vertex may have multiple outgoing edges if it has strong affinities to several other genomes, or it may have a single outgoing edge if a single other genome in c is its strongest genetic partner. the latter case might arise, for example, if genome ci shares a recent common ancestry with genome cj, and has not been impacted by lgt since that divergence. edges in g are directed because relative affinities are not guaranteed to be symmetric; ci may be a significant contributor to cj, but not vice versa. edges carry weights that reflect the relative contribution of different genomes to the target genome; outgoing edges from a genome are normalized to sum to  <dig> .

the intergenomic affinity graph shows a complete set of genetic relationships among a set of genomes, but the graph formulation is based on a genome-by-genome approach to identifying genetic similarities. the gene content of a genome ci is evaluated against all other genomes to identify elements  of these genomes that are highly similar to elements of ci, and therefore represent likely contributors to the gene content of ci. the union of these contributing elements defines the optimal comparison genome  for ci; the ocg may contain components of one, several, or all members of the set c - ci. in the intergenomic affinity graph, the set of edges leading to vertex vi and their relative weights reflect the relative contribution of other genomes to the ocg. the composition of the ocg and the evolutionary interpretation of the affinity graph depend on the choice of function used to build the ocg; ideally the graph should capture all significant vertical and lateral evolutionary relationships that exist in a set of genomes. we introduce several alternative functions in the next section.

techniques for constructing optimal comparison genomes
lp is a method of maximizing or minimizing a linear equation  subject to a set of constraining linear equations and inequalities. previous applications of lp in bioinformatics include gene and species tree reconstruction  <cit>  and protein structural inference via threading  <cit> . our lp formulation is intended to capture distinct affinities between a reference genome x consisting of n <dig> genes x <dig>  x <dig>  ..., xn, and a set of m comparison genomes y = {y <dig>  y <dig>  ..., ym}, each consisting of nj genes e.g. y <dig> ,y <dig> , ... y <dig> n <dig>  the basis for identifying relationships is an n × m similarity matrix a, with each row ai.corresponding to protein-coding gene i from x, and each entry aij representing the similarity between gene i and the best-matching gene gj from yj,  <dig> ≤ j ≤ m. each row ai. therefore constitutes a weighted phylogenetic profile  <cit>  that captures the relative genetic affinity of xi for each member of y. the aim of our approach is to construct the ocg for x from members of set y. our initial analyses use a transformed matrix of blastp results, with

  ai,j=−log 

where αi,j is the expectation value of the blastp score with xi as query and gj as subject.

a simple approach to inferring genomic affinities from these blastp scores would be to directly use matrix a to identify incoming edges to x in the intergenomic affinity graph, with weights wj computed as follows:

  wj=∑i=0n0aij∑i=0x0∑k=1maik 

repeating this procedure using each genome in  as the reference genome in turn would produce an intergenomic affinity graph showing the complete set of genetic affinities between all pairs of genomes. we term this approach to generating wj the weighted maximum  technique.

however, such an approach ignores the potential for repeated structure in different rows of the blast table: for example, if two genomes y <dig> and y <dig> are both closely related to genome x, with y <dig> and x as sisters and y <dig> a close outgroup to the other two, then we would expect to see many rows in the transformed blast table where ax <dig> is only slightly greater than ax <dig>  based on these rows, wmax would assign weights such that wy <dig> >wy <dig>  but with wy <dig> only slightly greater than wy <dig> the averaging effect of wmax does not distinguish between the case above, where ax <dig> is consistently if only slightly greater than ax <dig> in many rows, versus a situation where ax <dig> is sometimes greater and sometimes less than ax <dig>  but the mean affinity for y <dig> is greater than that for y <dig>  to distinguish these cases, we need an approach that emphasizes the consistently greater similarity of partner genome y <dig> in a weighted network of genome affinities. if we consider construction of the comparison genome as an optimization problem on the set of genetic affinities in a, we can formulate an lp approach to find the optimal weighting of genomes in y with respect to x that achieves this aim. the goal of the strategy is to maximize ε and choose wj such that:

  ∑j∈ywj= <dig> 

  wj≥0 ∀ j∈y 

  a1jw1+...+aijwi+...+amjwm≥ε i≤j≤m. 

a given wj value will be applied uniformly to the corresponding column a.j, and therefore allow aij terms to contribute to the sum  imposes) even when they are not the maximum term from that row.

one potentially misleading implication of the above approach is that rare genetic affinities, i.e. xi genes with best matches to unusual target yj genomes, can lead to a very high wj, since the sum of scores for xi's row is still constrained to be ≥ ε. a large wj in this situation is indicative of very distinctive matching patterns such as an lgt connection between distantly related genomes. to better quantify the relative abundance of different relationships to the various xi, we multiply ε for each row i by the sum of ai,j for all reference genomes j. as a consequence, the limiting constraints will be those with the greatest total distance scores. this reweighting will increase wj values for yj genomes with many strong affinities to x, and will diminish but not eliminate rare affinities. we refer to this reweighting approach as the rlp strategy.

as an alternative to reweighting, we also considered the application of thresholds to matrix a prior to computing the lp solution. in this scenario, any ai,j < threshold t was set to zero, with the effect that any blast matches with e-value > 10t are ignored. we refer to this as the tlp-t strategy, where t = the chosen threshold.

finally, we considered a strategy in which proteins we defined as 'dominated' were removed. given two proteins from the query genome, p <dig> and p <dig>  we say that p <dig> dominates p <dig> if a <dig> m ≥ a <dig> m for all target genomes m. the removal of dominated proteins yields a reduced set that includes  proteins from x that constitute the best overall matches to each of the genomes in y; and  proteins that are not in set , but nonetheless have sufficiently distinct match profiles that they are dominated by no single protein in set . this strategy emphasizes slowly evolving proteins  and is expected to highlight particularly strong  connections between x and members of y. the strategy is analogous to that employed by others  <cit>  to isolate genes that are particularly informative, although our criteria are different, particularly in that we do not require all retained genes to exhibit the same distribution pattern or phylogenetic history. this final strategy is referred to as ndlp.

all lp approaches outlined above have a total of m +  <dig> variables to optimize, with one variable per genome in y in addition to ε. the maximum number of constraints for the problem is equal to m  + n <dig>  +  <dig> . fewer constraints will exist if the number of genes under consideration is less than n <dig> due to some genes having no blast matches, and/or genes being removed by the ndlp strategy. the procedures described above will produce a set of weighted edges originating from genome x and terminating in a subset of genomes in y. to build the intergenomic affinity graph, we repeat the analysis for each genome in .

validation on simulated genomes
we first evaluated the efficiency of the lp approach on data with a similar structure and magnitude to blast comparisons of genomes. the simplex method we use for optimization is exponential with respect to the number of inputs, but runs in polynomial time in the average case  <cit> . for genomic data sets of size k =  <dig> to  <dig> in increments of  <dig>  we generated affinity tables with  <dig> rows and k -  <dig> columns. each table entry was filled with a random number. we then applied the ndlp and rlp techniques using the glpk solver  to these tables and evaluated the total running time. the scaling of runtime  with input number of genomes was slightly greater than linear in the number of input genomes, with times <  <dig>  seconds for k ≤  <dig>  up to  <dig>  seconds for k =  <dig>  this is a tiny fraction of the time needed to generate blast results for a comparable number of microbial genomes, and suggests that the time taken by the lp solver will not be limiting in the analysis of datasets with k much greater than size  <dig> 

evolsimulator  <cit>  is a program that simulates the evolution of genomic lineages via processes of speciation and extinction. each evolsimulator run starts with a single genome containing an ancestral set of genes; as lineages diverge, gene content can change via duplication, loss, and lgt, with different user-specified models of lgt available. we used evolsimulator to generate populations of up to  <dig> genomes  with different regimes of lgt influencing the success of attempted transfer events for a given donor-recipient pair. the simplest scenario allowed no gene content change whatsoever , so all genomes at the end of this simulation contained a single copy of each ancestral gene that was modified through mutation and substitution events. all other scenarios allowed genome sizes to change via duplication or loss at each step of the simulation. a single simulation was run without lgt, but with the possibility of gene duplication and loss . three separate regimes of lgt were then imposed in separate sets of runs:  unconstrained or 'random' lgt , where any donor-recipient genome pair is equally likely to participate in lgt;  divergence-restricted lgt , in which the probability of successful transfer decreases with increasing divergence ; and  habitat-restricted lgt , in which genomes occupy specific habitats and niches with rare switching events, and transfers can occur only between genome pairs that occupy the same habitat at a given iteration. for each regime, we varied the intrinsic rate at which lgt events were proposed by two orders of magnitude in three separate runs. all combinations of regime and rate were repeated  <dig> times, except for the habitat simulations which were replicated  <dig> times each.

since evolsimulator records the complete history of all genomes in a given simulation, we were able to evaluate our network inference strategies in the 'vertical' context of known speciation histories, in light of known lgt events, and with knowledge of currently assigned genomic habitats and complete habitat histories. we devised statistics that characterize the structure of graph g in light of the known connections between genomes.

the treeness score t expresses the match between the reconstructed evolutionary network and the simulated genome tree:

  t=∑i∑jwi→j× 

where i and j are two genomes for which a connection i → j is defined, wi→j is the edge weight from i to j, disti→j is the number of internal nodes in the reference tree that are traversed by the shortest path from leaf i's closest parent  to leaf j's closest parent in the reference tree, and distmax is the largest such distance in the entire tree. the assignment of relatively large weights to siblings in the tree  will minimize the ratio of distances in , leading to large overall values for t. since the treeness score scales with the number of genomes, we divided t by the total number of genomes considered to yield a normalized treeness score, tnorm, with range  <dig>  <tnorm ≤  <dig> .

the habitat score h is defined as:

  h=∑i∑jwi→j××zi,j 

with zi,j an indicator function which is equal to  <dig>  if i and j are in the same habitat and  <dig>  otherwise. since we set habitat changes to occur relatively infrequently in our simulations, habitat similarity and evolutionary history were conflated to a large degree. to minimize the impact of this conflation and to emphasize the detection of habitat-directed lgt connections between distant relatives, we use the raw distance ratio  to maximize the contribution of distantly related genomes from the same habitat. as with the treeness scores, we divided h by the number of genomes to yield the normalized habitat score hnorm, with range  <dig>  ≤ hnorm ≤  <dig> .

the normalized treeness scores tnorm ranged between  <dig>  and  <dig>  across all combinations of simulated lgt regime and network reconstruction method . although tnorm varied across different approaches, the non-lp wmax approach always yielded the lowest treeness scores . in addition to comparing raw treeness scores, we also used the distribution of  <dig> or  <dig> wmax scores as the basis for paired-sample t-test comparisons against the lp-based techniques, with a null hypothesis of no difference between wmax and the lp alternative. of the eleven different rate/regime combinations, the removal of dominated proteins  yielded the best treeness score in eight cases, with reweighting  best in two of the remaining cases, and thresholding at an e-value cutoff of  <dig>  × 10- <dig>  best in one case. in general the tlp-t strategies yielded slightly smaller tnorm scores, with the progressive decrease from t =  <dig> to t =  <dig> suggesting that the genes removed due to thresholding did contain a small additional amount of information about genomic affinities. in ten out of eleven cases, the ndlp treeness scores were significantly better than the wmax scores, with maximal improvements  in cases where the tree signal was strong due to minimal lgt , or lgt that reinforces the vertical signal in the tree . the nolgt-noloss simulations provided a curious exception to this rule; since duplication and loss were the only phenomena that distinguished these simulations from the nolgt runs, it may be that the presence of paralogous sequences in the phylogenetic profile matrix actually reinforced the treelike signal. improved recovery of treelike signals under divergence-biased regimes of lgt has been seen before  <cit> , with preferential exchange between close relatives reinforcing their overall similarity. the tnorm of all approaches decreased in cases where lgt did not explicitly reinforce the reference tree signal, with the effect more pronounced under random lgt than under habitat-directed lgt .

although the performance of ndlp, tlp-t and rlp was roughly similar in most simulations, rlp performed considerably worse in four cases: the three habitat-restricted lgt scenarios, and the unusual nolgt-noloss simulation. it is unclear why rlp performed poorly  in the latter case, but inspection of the habitat scores  showed that reduced treeness in hablgt simulations was due to more-accurate recovery of habitat-driven relationships. the habitat scores were significantly better than the wmax baseline for rlp  and ndlp , with no improvement seen in any of the tlp-t analyses. in both the rlp and ndlp cases, the habitat score increased with increasing rates of lgt, successfully capturing the greater contribution of biased lgt to the composition of genomes under these simulation conditions. based on these results, rlp and ndlp give results that are somewhat complementary, with rlp capturing a broader range of patterns and ndlp focusing on those patterns that are strongest in the data.

to further investigate the relationship between the rlp and ndlp approaches, we chose one simulation run and visualized the corresponding species tree  and constructed graphs for the nolgt  and hablgt-high  simulations. the graphs recovered in the absence of lgt are disconnected, with the rlp approach producing three components and  <dig> links  and ndlp yielding seven components and  <dig> links . in both networks, each genome is connected to at least one genome in the group that is a sister to it. but the rlp graph has many more connections both within and between clades: in the rlp case, clades  <dig>   <dig>   <dig>   <dig>   <dig> and  <dig> identified in figure s <dig> are connected to one another, mostly through the early-branching "lonely lineage"  <dig>  this genome also links clades  <dig> and  <dig> in the ndlp graph, although all other connections are lost. within each identified clade , the number of connections dropped by 28%-56%. the connections lost were predominantly more-distant ones, with the average phylogenetic distance between connected genomes dropping by approximately half.

the habitat-restricted lgt simulations yielded connected graphs with many more links:  <dig> when rlp was used for reconstruction , and  <dig> when ndlp was used . the automated layout performed by cytoscape  <cit>  suggests good separation of genomes based on shared habitats, with higher apparent separation achieved by the ndlp solution. only  <dig> %  and  <dig> %  of links were between members of the same clade, as compared with  <dig> %  and  <dig> %  of links inferred from the nolgt simulation. in assessing the influence of shared habitats, we distinguish between the current habitat of each genome  and the habitat of longest residence  for each genome. two genomes currently occupying the same habitat may have many opportunities to share genes, but if one of the two genomes was until recently present in a different habitat, and was present in that habitat for a long time, then its genomic composition may still be more reflective of its former habitat. although, as indicated above, fewer than 36% of links were to members of the same clade, a great many links could be attributed to shared habitats: in the rlp network reconstruction,  <dig> % of links were between genomes sharing the same current habitat, and  <dig> % of links were between genomes with the same habitat of longest residence. the numbers for ndlp were even higher:  <dig> % of links were between genomes in the same current habitat, and  <dig> % were between genomes sharing the same habitat of longest residence. most strikingly, between 49% and 62% of these links were between members of the same habitat, but of different clades. this demonstrates the ability of the rlp and ndlp approaches to recover complementary vertical and lateral evolutionary signals.

the proportion of the original protein data set retained by the ndlp strategy under different simulation conditions was itself informative about the extent of discordant phylogenetic signal . the largest proportion of proteins  were removed in the datasets simulated without lgt. among lgt-containing datasets, divergence-biased lgt had the highest rate of removal , while approximately 66% of proteins were removed from the datasets simulated with random lgt. low rates of habitat-restricted lgt yielded similar removal rates, but removal decreased for medium  and high  rates of lgt. protein removal therefore appears to correlate with the expected strength of relationships that are in conflict with the species tree: against a baseline established by random lgt, divergence-biased lgt has a higher rate of removal, while habitat-restricted lgt has a much lower rate. given the apparent complementarity of the rlp and ndlp approaches, we applied these two techniques to the inference of evolutionary patterns from microbial genomic data sets.

affinities of aquifex aeolicus and other thermophiles
although aquifex aeolicus is considered to be among the earliest-diverging bacteria on the basis of 16s rdna phylogeny, phylogenomic analyses have identified a number of alternative partner lineages, including the epsilon-proteobacteria and various archaeal lineages  <cit> . lateral genetic transfer appears to have played an important role in the evolution of bacterial thermophily and hyperthermophily  <cit> , and the identification of partner lineages, as well as the different types of molecular functions shared with these lineages, can indicate the route by which a. aeolicus became a hyperthermophile.

we first performed a comparison of  <dig> sequenced genomes covering  <dig> distinct phyla against a. aeolicus, to determine which of these had strong affinities. a total of ten genomes from five phyla were retained in the ndlp solution . two types of organisms are represented in the a. aeolicus solution: other thermophiles and hyperthermophiles, and very large genomes. included among the thermophiles are the other two sequenced representatives of phylum aquificae, hydrogenobaculum sp. y04aas <dig> and sulfurihydrogenibium sp. yo3aop1; two archaea including a methanogen and pyrococcus horikoshii; thermodesulfovibrio yellowstonii, a hot spring bacterium from phylum nitrospirae; and a rare thermophilic proteobacterium. mesophilic genomes in the solution set originate from the acidobacteria and proteobacteria and include the giant  genome of the acidobacterium solibacter usitatus and one member of the delta-proteobacteria, a group often implicated in lgt with other phyla  <cit> . consistently with our benchmarking results above, the rlp solution returned a much larger number of genomes : of these, none was shared between the two lists but two genera  were represented in both solutions. interestingly, while both other aquificae were missing from the rlp solution, thermosipho melanesiensis and nitratiruptor sp. sb155- <dig> which represent alternative affinities for the aquificae lineage were both present. many of the other genomes in the rlp solution set were also thermophiles or hyperthermophiles from groups including crenarchaeota, euryarchaeota, dictyoglomi and clostridia.

we repeated the ndlp analysis for both of the other aquificae in our set, and recovered solution sets consisting of  <dig> genomes  and ten genomes . like the a. aeolicus ndlp solution, both the hydrogenobaculum and sulfurihydrogenibium lists contained the two non-self aquificae genomes. beyond this, however, no single genome appeared in all three solution sets, although all three solutions contained representatives from the delta-proteobacteria . the hydrogenobaculum set included five representatives of phylum chlorobi and two thermophilic chloroflexi, all other non-aquificae genomes belonging to the proteobacteria including two methylotrophs and an acidophile. linkages to chlorobi, chloroflexi and other genomes may reflect lgt related to hot, acidic habitats or to the use of particular compounds as sources of energy and nutrients. genomes in the sulfurihydrogenibium solution set include several soil bacteria and bacteria with large genomes . in addition to the two aquificae, two extremophiles are present in the set: t. yellowstonii and a halophilic euryarchaeote.

different functional classes of proteins show different propensities toward lgt  <cit> , and are thus likely to show different taxonomic affinities if lgt is sufficiently frequent. we explored this question for a. aeolicus by repeating the ndlp analysis on subsets of genes, grouped by tigr role category http://cmr.jcvi.org/cgi-bin/cmr/shared/rolelist.cgi. since these optimizations are performed on distinct subsets of the full dataset, genomes appearing in the full solution may not appear in the functional subset solutions, and vice versa. figure  <dig> shows the breakdown of lp solutions for each category. the aquificae are represented in  <dig> of  <dig> categories, and represent the entire solution in the 'fatty acid and phospholipid metabolism' category. within the informational categories, dna metabolism is dominated by hyperthermophilic thermotogae and archaea, possibly reflecting the effects of recent transfer to assist in stabilization of the bacterial chromosome. the solution for the 'protein synthesis' category includes two thermophiles: the actinobacterium rubrobacter xylanophilus and symbiobacterium thermophilum, a member of class clostridia. while protein synthesis genes are thought to be particularly recalcitrant to lgt, the alternative affinities here may be due to aminoacyl-trna synthetases and other proteins that do not form part of large complexes  <cit> . transcriptional proteins are associated with thermotogae and two delta-proteobacteria in the ndlp solution. cellular process proteins are less closely tied to the aquificae: other important groups include the epsilon-proteobacteria , gamma-proteobacteria, and the alpha-proteobacteria rhodopseudomonas palustris and sphingopyxis alaskensis, which constitute > 50% of the solution in the 'cellular process' category. metabolic enzymes show evidence of heterogeneous origins as well, particularly those involved in cofactor and carrier biosynthesis, which include genomes from phyla cyanobacteria , chlorobi , flavobacteria  and nitrospirae  in their ndlp solution set. not surprisingly, mobile elements and hypothetical proteins show a great deal of heterogeneity as well, including contributions from thermophilic archaea, clostridia, cyanobacteria, and dictyoglomi, as well as a number of mesophiles from across several phyla.

the a. aeolicus solutions indicated a strong contribution of genetic material from other thermophilic and hyperthermophilic lineages. but the broader picture of thermophile evolution may involve gene sharing relationships that do not directly implicate the aquificae. to further investigate the relationships among thermophiles, we inferred an all-versus-all ndlp network for the  <dig> out of  <dig> genomes in our set that were labeled as thermophilic or hyperthermophilic, which included  <dig> bacteria from  <dig> phyla, and  <dig> archaea from four phyla. from this set we removed one genome from each of two named species  that were represented twice. six phyla  had only a single thermophilic or hyperthermophilic representative, while the firmicutes , crenarchaeota  and euryarchaeota  were the largest sets.

the resulting ndlp graph  is connected, with an average node  degree of  <dig>  indicating that genomes are connected to  <dig> % of other members of the set, on average. nodes with a low in-degree have few genomes contributing to their overall solution; these genomes typically had close relatives  present in the data set. for example, thermotoga petrophila  and thermotoga maritima  had large incoming weights from other members of genus thermotoga. the solution for synechococcus sp. ja-2-3b'a included a closely related strain of the same genus, and the actinobacterium thermobifida fusca. the maximum in-degree of any vertex in the graph was  <dig>  which was observed for m. capsulatis , petrotoga mobilis , moorella thermoacetica , and candidatus "korarchaeum cryptofilum" . each of these organisms is among the most taxonomically distinct in its group, with k. cryptophilum the lone representative of phylum korarchaeota. genomes with a large out-degree are significant contributors to the thermophilic gene pool in other organisms: out-degrees in the graph ranged from  <dig>  to  <dig> . a. aeolicus has an in-degree of seven and an out-degree of four: affinities with its sister lineage hydrogenobaculum are retained, but the elimination of the large, mesophilic genomes that were present in figure  <dig> introduces new thermophiles into its solution set, including nitratiruptor and organisms from phyla dictyoglomi, crenarchaeota and firmicutes. no edges connect genomes from phyla aquificae to thermotogae or vice versa.

the thermophiles and hyperthermophiles in our dataset cover a range of optimal growth temperatures  from 45°c to 103°c. we considered whether affinities were stronger between genomes with similar temperature preferences relative to a null model by considering the weight and temperature differential associated with each edge. summing the product of edge weight and ogt difference for each of the  <dig> edges in our graph, we obtained a score of  <dig> . performing the same summation with randomized genomic ogts yielded an average score of  <dig> . <dig>  with a standard deviation of  <dig> . the p-value of  <dig>  × 10- <dig> associated with the resulting z-score strongly suggests that genomes with similar ogt tend to have stronger associations in the lp solution. to remove the effect of taxonomic similarity from this result, we next considered only those edges that connected members of different phyla. the p-value in this case was several orders of magnitude larger  but still supported a stronger association between genomes with similar ogt.

vertical and lateral signal in genus pseudomonas
pseudomonas is a highly diverse genus within the gamma-proteobacteria, comprising >  <dig> named species with a wide diversity of lifestyles, including saprophytes, plant, fungal and animal pathogens, and marine and soil organisms  <cit> . this diversity is supported by large genome sizes and the ready acquisition of plasmids and genomic islands  <cit> . in the case of pseudomonas aeruginosa, pathogenicity and resistance traits can also be rapidly acquired due to the presence of integrons  <cit> . pseudomonas-associated mobile elements can have very broad host ranges, raising the possibility of significant genetic flux between members of this genus and other groups of microorganisms. indeed, the taxonomic affinities of open reading frames in p. aeruginosa islands are extremely broad, mapping to a wide range of phyla  <cit> .

to assess the relative influence of within- and between-species gene flow, we constructed a network based on ndlp weights between  <dig> different members of genus pseudomonas covering a total of seven named species . although table  <dig> indicates the primary ecological motivations for studying the various species of pseudomonas, the niche range of members of this genus tends to be very broad and has not been fully mapped for many of the listed isolates, so the full extent of ecological overlap between the various species and strains cannot be precisely quantified. figure  <dig> shows the connected graph of pseudomonas genomes based on the ndlp solution. a total of  <dig> edges connect the  <dig> nodes in the graph, yielding an average node degree  of  <dig> . each genome is therefore connected  to  <dig> % of the other members of the data set. a considerable amount of vertical signal is captured by the graph, with members of the same species typically connected by edges with strong weights. the exception to this trend is p. fluorescens; although these genomes are weakly connected to one another, strain pf0- <dig> has a strong connection to p. putida f <dig>  and strain pf- <dig> has connections to every other named species except p. entomophila. two of the three species with a single representative  are strongly connected to one other genome, while p. entomophila has affinities to all six other species in the set. the difference in connectivity patterns may relate to the status of p. stutzeri and p. mendocina as the smallest genomes  in our data set, while p. entomophila is considerably larger at  <dig>  mbp. the relatively small genomes and few affinities may also reflect reduced interactions with eukaryotic hosts  relative to other pseudomonas species, diminishing the importance of host-adaptive lgt.

size in megabases, number of predicted proteins , and the number of plasmids  are indicated.

we extended this core network by including comparisons of all  <dig> pseudomonads against the other  <dig> genomes in our data set. all possible pairwise comparisons between pseudomonas genomes were performed, but other genomes were compared only to members of this genus, and not to each other. the ndlp solution includes  <dig> non-pseudomonas genomes  of which  <dig> are other proteobacteria. apart from the chlorobi , no phylum with >  <dig> representative genomes had more than 25% of its genomes retained. major underrepresented groups included the actinobacteria , firmicutes , archaea , and eukaryotes . there is a clear preference for proteobacterial genomes in the ndlp solution: over 64% of beta-proteobacterial genomes were included in the solution, primarily from order burkholderiales. within the gamma-proteobacteria, over 50% of orders alteromonadales, non-pseudomonas pseudomonadales, vibrionales, and xanthomonadales were retained. most of the included alpha-proteobacteria were soil organisms from classes caulobacterales, rhizobiales, rhodobacterales, and rhodospirillales.

the most striking feature of the pseudomonas ndlp graph  is the presence of 'plumes' of non-pseudomonas genomes that are matched by only a single genome within the genus. taxonomic summaries of connecting genomes are shown in figure  <dig>  the most highly connected genome is that of p. mendocina, which is linked to a total of  <dig> non-pseudomonas genomes;  <dig> of these are connected to no other pseudomonas genome and therefore constitute its plume of unique connections. groups that are particularly prominent in the p. mendocina solution include orders burkholderiales , rhizobiales , and alteromonadales . mobile elements and the ~ <dig> hypothetical proteins with no match to other pseudomonads likely account for many of the connected genomes. p. stutzeri has connections to  <dig> other genomes including  <dig> in its plume, which includes genomes of the root-associated organisms bacillus pumilus and sinorhizobium meliloti, other plant-associated bacteria such as xanthomonas oryzae and burkolderia thailandensis, and several marine bacteria. its shared affinities comprise additional nitrogen-metabolising genomes such as azoarcus sp. bh <dig> and nitrosomonas eutropha and several additional marine bacteria. the last uniquely represented species in our dataset, the insect pathogen p. entomophila, connects to  <dig> genomes of which five are not connected to any other pseudomonas genome. its plume covers five different phyla and includes aspergillus fumigatus, the only eukaryotic genome in the solution set; clostridium botulinum; photobacterium profundum; frankia sp. ccl3; and gramella forsetii. of these, a. fumigatus and c. botulinum have pathogenic potential, while g. forsetii is able to degrade large organic compounds. its other partners include nitrogen metabolizers and pathogens.

genomes from the same species differed considerably of the strength of their connections. the most dramatic example of this was seen in p. aeruginosa pao <dig>  which connected to only four other genomes: the other three strains of p. aeruginosa and the metabolically diverse ralstonia eutropha. this dearth of connections may reflect the high degree of similarity between strain pao <dig> and its conspecific isolates, as well as the fact that the genome of strain pao <dig> is 200- <dig> kb smaller than the other p. aeruginosa genomes. other p. aeruginosa genomes match pathogens including serratia proteamaculans, neisseria meningitidis and various enteric bacteria, but include a wide range of environmental bacteria as well. p. putida gb- <dig> has connections to  <dig> other non-pseudomonas genomes: like p. mendocina, many of the connections are to burkholderiales and rhizobiales, with strong representation from the enterobacteriales and genera acinetobacter and geobacter. at the other extreme of connectivity, p. putida kt <dig> connects only to chlorobium chlorochromatii, halorhodospira halophila, and salmonella enterica. similarly, p. putida f <dig> connects to only four non-pseudomonas genomes, from genera aeromonas, proteus, xanthomonas and streptomyces. contrary to the general tendencies of larger genomes to have more connections, strains kt <dig> and f <dig> are the largest and third-largest members of their group. the remaining species, p. fluorescens and p. syringae, had similar distributions of affinities to environmental and pathogenic bacteria.

discussion
we have developed and validated an lp approach to the reconstruction of genomic affinities. based on the evolsimulator results reported above, these lp approaches  are better able to recover strong, distinctive vertical and lateral inheritance patterns than are network approaches that make direct use of blastp similarities. the lp solution can be used to generate graphs of genomes, which carry some advantages relative to genome phylogeny-based approaches. many genome phylogeny approaches generate partitionings of taxa which are visualized as branches and intersecting sets of parallel lines. such graphs are typically subject to a circular compatibility or similar constraints  <cit> , which complicates the representation of long-distance transfer relationships. newer approaches such as cluster networks can circumvent these limitations by adding reticulate nodes, which are not constrained by phylogenetic distance, to a tree, but these approaches are np-complete and have thus far been applied to a relatively small number of gene sets  <cit> . unlike the above approaches, which are explicitly phylogenetic in nature, our approach relies on the inference of directed edges and edge weights by the lp solver to generate a graphical representation of genomic affinities. this approach mirrors most closely the approaches of lima-mendez et al.  <cit>  and halary et al.  <cit>  mentioned in the introduction, but the filtering of data and inference of weighted, directed edges by our lp approach yields more information about the magnitude and direction of transfer.

the lp solution is based on the calculation of weights for different genomes; for a given target genome x, a large weight attached to a comparison genome yj indicates that yj is an important part of the solution. this importance, however, does not necessarily correlate with the number of genes in x that appear to originate from yj; rather, if yj has a small number of genes that are very similar to genes in x, and which cannot easily be accounted by other genomes in the set, then a high weight for yj is likely to be recovered in the lp solution. very recent lgt events will tend to be highlighted by this approach, since the resulting similarity profile will be distinct and the affinity  extremely high. the removal of dominated strategies further accentuates this effect, since genes whose inheritance is mostly vertical and that therefore have 'canonical' patterns of similarity to other genomes will tend to be removed en masse due to the presence of highly conserved proteins that follow the same pattern of similarity and have lower blast expectation values. although the use of our approach inevitably filters out some lateral relationships among the genomes under consideration, filtering is necessary in any approach to try and distinguish signal from noise. splits graphs are often controlled by restricting the dimensionality of the solution, imposing a uniform constraint on all relationships without regard to the number of affinities within any particular set of genomes  <cit> . our approach has the capacity to return many connections where appropriate, as demonstrated in our analyses of data sets with high levels of lgt.

our case studies illustrated particular strengths of the method, as well as highlighting challenges in the interpretation of the results. the analysis of a. aeolicus returned a plausible set of genomes, although the exclusion of groups such as thermotogae and epsilon-proteobacteria from the main solution set  was surprising. it is likely that at least some of the proteins previously observed to support these affinities are also present in hydrogenobaculum and sulfurihydrogenibium, thus making these other aquificae the natural partners for a. aeolicus and eliminating the distinctive contributions of the other two groups. the presence of large genomes in the solution set suggests that large, versatile genomes may act as hubs in the global lgt network  <cit> , since so many of the genes they possess can be adaptive in different environments. although we made no effort to correct for sampling effort in different groups, most of the global and functional results appeared to be driven by genuine affinities rather than raw counts of sequenced genomes. for instance, while the heavily sequenced gamma-proteobacteria were indeed present in the role category solution sets of a. aeolicus , their contribution was limited to a few categories and was similar in importance to much smaller groups such as the epsilon-proteobacteria. conversely, proteobacteria dominated the pseudomonas solution set, with substantial contributions from soil bacteria, marine bacteria and some pathogens. although it is difficult to extract ecological narratives from large lists of genomes, in a broad sense these habitats are consistent with the primary known roles of members of genus pseudomonas. the high degree of heterogeneity seen in the solution sets of some genomes  is interesting and worthy of further exploration using more-explicit phylogenomic techniques.

an important challenge in interpreting the results of an lp analysis is the construction of an appropriate summary of all genomes in the solution set. this was more straightforward for a. aeolicus than for genus pseudomonas. when a particular group such as the burkholderiales is assigned a large weight in a solution set, we can appreciate that this group may have made important genetic contributions to our genomes of interest. but genomes encode a complex set of processes, and the most reasonable hypothesis for a given connection such as the exchange of pathogenesis genes between escherichia coli and p. aeruginosa may not be the correct one; genetic affinities may instead reflect gene transfers related to respiration, metabolism of available compounds, or other cellular processes. also, transfers of genetic material that produce an edge in the lp graph may in fact have no adaptive role, having arisen as a consequence of random integration and rapid but not immediate turnover of introgressed genes, or due to the activity of phages, plasmids and other mobile elements. one way to address the question of which genomes have contributed which functions is to carry out a refined analysis as shown in figure 6; a set of such optimizations can reveal which functions can be attributed to which originating taxonomic groups. another approach is to refer back to the original set of genes, either through inspection of the blast tables and comparison of affinities, or by performing a phylogenomic analysis to identify the affinities of genes in the genome of interest. in such a situation the lp optimization can play the additional role of filtering the initial set of genomes: for example, in the pseudomonas ndlp analysis we reduced the candidate set of 'interesting' genomes from  <dig> to  <dig>  which would accelerate subsequent steps of orthologous set inference, sequence alignment and phylogenetic analysis. another alternative we did not explore here is the pooling of genomes within a particular species or genus prior to performing the lp analysis; such an approach would simplify the solution  while still showing key affinities among the genomes of interest.

in this work we used blast results as the raw material, without attempting to define orthologs and paralogs, to infer genomic relationships. the technique could also be applied to orthologous gene profiles generated using a technique such as cog  <cit> , or to structural indices that can potentially identify homologous genes that are too distantly related to be detected by blast. the efficient nature of the lp solver suggests that much larger data sets can be handled by this technique once the appropriate input affinity data have been generated.

CONCLUSIONS
the intergenomic relationships among microbes are a complex mix of vertical signal and recent and ancient lgt events. our approach does not aim to describe the full set of evolutionary relationships among a set of genomes, but instead emphasizes a genome's closest genetic neighbours. recent events may reflect adaptive changes that are most relevant to an organism's current ecological range and interactions with other organisms. challenges remain in understanding which optimization technique is most appropriate to the question at hand, and how complex sets of intergenomic affinities should be interpreted. future work will aim to refine the optimization techniques to improve their robustness and make the interpretation of connection weights more explicit. an important challenge that is not specific to our approach lies in the use of affinity graphs or networks to explore ecological and evolutionary hypotheses. microorganisms have complex sets of ecological attributes, and in many cases similarities of organisms in their habitat range, uptake of mobile elements, and tolerance of different environmental conditions cannot be precisely quantified. while it is possible to draw some conclusions from the topology of affinity graphs and the functional categories associated with different edges in the graph, more-detailed experimental characterization of microorganism ranges will ultimately be needed to enable a deeper understanding of intergenomic affinities.

