BACKGROUND
in molecular phylogeny, a great deal of attention has gone to computational methods for building phylogenetic trees  <cit> , but much less to methods for selecting phylogenetic characters. most sequence-based studies of prokaryotic and universal phylogeny have used either small-subunit rrna genes  <cit>  or highly conserved proteins such as ribosomal proteins, elongation factors, chaperones, and trna synthetases  <cit> , arguing that these core sequences are unlikely to be horizontally transferred and hence should reflect vertical descent. another sequence-based method relies upon the presence/absence of hand-picked "signature sequences"   <cit>  to infer descent. this method does not specifically handle horizontal transfers, but can sometimes resolve a short internal branch that cannot be unambiguously resolved by a continuous evolutionary model. early phylogenetic studies  <cit> , limited by availability, were forced to use manually selected characters, but with the recent proliferation of full bacterial genomes, this restriction no longer applies, as all genes and genome data have now become potential characters.

whole-genome phylogeny has the potential to discern vertical descent even in the case of widespread horizontal transfer. many recent attempts at whole-genome phylogeny have used automatically computed characters other than sequence, such as gene order  <cit> , dinucleotide frequencies  <cit> , presence/absence of orthologous pairs  <cit> , and presence/absence of gene families  <cit> . these non-sequence studies have given bacterial phylogenies with substantial areas of disagreement, and indeed it has been found that for deep prokaryotic phylogeny, sequence generally carries a stronger signal than dinucleotide frequencies  <cit> , gene order  <cit> , or number of common orthologs  <cit> . hence there arises a need for a phylogenetic methodology that combines the power of sequence-based approaches with the objectivity and completeness of whole-genome approaches.

researchers have responded to this need with a number of approaches that seek a predominant set of "concordant"  <cit>  genes compatible with the same phylogeny. the approaches vary in whether they use gene trees or distance matrices to evaluate the genes, and also in their levels of automation and completeness. the use of gene trees is more common than the use of distance matrices. brochier et al.  <cit>  start with  <dig> translational apparatus proteins, ubiquitous over the set of organisms under study. they automatically screen these genes to obtain  <dig> concordant genes by principal component analysis of vectors of likelihoods for  <dig> test tree topologies; they associate the first principal component with gene length and the second with "incongruence". along similar lines, zhaxybayeva and gogarten  <cit>  evaluate genes by probability mapping of small trees such as four-taxon "quartets". battistuzzi et al.  <cit>  manually curated  <dig> ubiquitous cogs  <cit>  down to  <dig> by rejecting all those that gave unstable gene trees, gene trees with either archaebacteria or eubacteria non-monophyletic, or "deep nesting" of a species from one phylum within another phylum. daubin et al.  <cit>  cluster the topologies of  <dig> computed gene trees in order to find a concordant set of  <dig>  and then combine the concordant trees using the "supertree" approach  <cit> , which can accommodate the missing data resulting from non-ubiquitous genes.

the use of organismal distance matrices to evaluate genes is less common, but as we argue below, it has a number of advantages over the use of gene trees. clarke et al.  <cit>  and gophna et al.  <cit>  compute distance matrices from reciprocal-best blast scores on a large number of genes. they measure the concordance of genes by correlation with the median distance matrix. they then use the consensus distance matrix of the concordant genes  <cit>  or a weighted combination of the gene distance matrices  <cit>  to compute the tree directly, rather than employing a more principled, model-based method such as maximum likelihood  <cit> . novichkov et al.  <cit>  improve upon the distance matrices of clarke et al. by using a linear measure of evolutionary distance rather than blast scores and by assigning rate parameters to correct for the differing mutability of genes. they do not, however, go on to compute phylogenies based on concordant genes.

in this paper, we introduce and validate a fully automatic, whole-genome methodology based on "representative sequences". we start by assembling all of the highly conserved proteins  within the set of genomes. we then use these genes to compute a consensus distance matrix by an algorithm similar to that of novichkov et al.  <cit> . we use the consensus distance matrix to select representative sequences, but not to build the phylogenetic tree directly. representative sequences are contiguous subsequences – typically  <dig> residues – from ubiquitous, conserved proteins, such that each orthologous family of representative sequences taken alone gives a distance matrix in close agreement with the consensus matrix. the phylogenetic tree is then computed using maximum-likelihood methods on a multiple alignment of a concatenation of representative sequences. we validate the methodology on a set of small phylogenetic problems with accepted answers, before going on to compute automatically a phylogeny for all of bacteria. our overall bacterial phylogeny shows striking agreement with the tree produced by battistuzzi et al.  <cit>  using genes that were manually curated for agreement with accepted clades.

we chose to use distance matrices rather than gene trees for the evaluation of gene concordance, because trees are brittle: a small change in sequence can dramatically change tree probabilities or the topology of the likeliest tree.  moreover, distance matrices can more easily incorporate missing data: each sufficiently conserved gene, ubiquitous or not, can contribute to the pairwise distances between the organisms containing that gene. combining trees on different sets of organisms is not as straightforward; indeed supertree methods typically combine matrix encodings  <cit> . our method is conservative in its use of non-ubiquitous genes, including only those well-conserved proteins appearing in at least three-fourths of the taxa under study, but even at this level it can typically use more than three times as many genes as are completely ubiquitous over the taxa. finally, anomalous pairwise distances directly locate likely horizontal gene transfers and other discontinuous evolutionary events , and indeed our method rediscovers a number of previously proposed horizontal transfers.

RESULTS
our computational experiments produced:  an evaluation of the methodology of representative proteins,  findings concerning which proteins make the best phylogenetic characters, and  a fairly complete and well-resolved phylogeny for sequenced bacteria.

methodology
we evaluated our methodology on a test set of  <dig> deep phylogeny problems with known answers, comparing a maximum-likelihood tree-building method using representative sequences with the same method using an identical amount of randomly chosen, highly conserved, ubiquitous protein sequence. the same data-mining program compiled the families of orthologs in each case, but the randomly chosen proteins were picked without regard to their "representativeness", and hence are equivalent to small subsamples from all highly conserved ortholog families. we used small subsamples, because concatenations of  <dig> or more highly conserved genes almost invariably give correct trees for our relatively easy test set problems. as seen in table  <dig> , representative proteins generally outscore randomly chosen proteins in number of correct single-gene trees, number of accepted clades found over all gene trees, and number of correct trees on concatenations of genes. the consensus gene tree  made with representative proteins succeeded  on all problems except  <dig> and  <dig>  and a consensus  concatenated tree succeeded on all problems except  <dig>  randomly chosen proteins succeeded less often. the consensus gene tree made with randomly chosen proteins failed on problems  <dig>   <dig>   <dig>  and  <dig>  and the consensus concatenated tree failed on problems  <dig>   <dig>   <dig>   <dig>  and  <dig>  the one problem on which randomly chosen ubiquitous proteins outscored representative proteins was problem  <dig>  for which representative proteins often divided the organisms as , mycoplasma) ), not finding the relatedness of mycoplasma and staphylococcus. as intended, representative proteins accurately represent the consensus distance matrix, which includes the contributions of many non-ubiquitous genes and has large distances to the endocellular organisms buchnera and mycoplasma, whereas the randomly chosen ubiquitous genes underrepresent the genomic distances to these two organisms and thus do not imply a tree with such long branches. altogether the results on the  <dig> test problems suggest that representative proteins reconstruct short internal branches more efficiently than do randomly chosen ubiquitous proteins, but at the cost of greater susceptibility to long-branch attraction.

proteins as phylogenetic characters
we find that protein representativeness cannot be determined a priori, as many favored proteins such as elongation factors and ribosomal subunits turn out to be poor representatives for certain sets of genomes. for example, ef-g is a relatively weak representative for proteobacteria; the pairwise distance matrix computed from ef-g alone has a correlation coefficient of . <dig> with the 200-protein consensus distance matrix, whereas the best proteins such as groel have correlation coefficients greater than . <dig> as shown in table  <dig>  yet ef-g is an acceptable protein for rooting the bacterial tree or for computing the initial, overall tree for figure  <dig> using a diverse set of  <dig> bacteria; for these tasks its correlation coefficients of . <dig> and . <dig> are not much lower than those of the best proteins. brochier et al.  <cit>  also found ef-g suspect; it fell outside of their main cluster, and with further analysis they found probable horizontal gene transfer  between β- and γ-proteobacteria. ribosomal proteins s <dig>  s <dig>  and l <dig> are poor representatives for the diverse set of  <dig> bacteria, with anomalously small distances between deinococcus and α-proteobacteria, actinobacteria and proteobacteria , and actinobacteria and firmicutes, respectively. yet s <dig> turns out to be a good representative for proteobacteria alone; in this case s <dig> has a correlation coefficient of . <dig>  whereas for the diverse set the correlation coefficient is only . <dig>  generally trna synthetases are less representative than elongation factors and ribosomal subunits.

methionyl-trna synthetase seems to have been horizontally transferred between cyanobacteria and firmicutes, isoleucy1-trna synthetase between actinobacteria and rickettsiales, and at least one domain of alanyl-trna synthetase between aquifex and bacteroidetes/chlorobi. researchers have been somewhat divided about trna synthetases. brown et al.  <cit>  used them as phylogenetic characters, but brochier et al.  <cit>  used them as a gene sample enriched in hgt. by individually screening protein families for representativeness for a specific set of organisms, we can use the representative trna synthetases and avoid the anomalous ones; for example we use threonyl-trna synthetase  for the left half of figure  <dig> 

despite the examples just given, representative proteins do tend to come disproportionately from core functional categories such as transcription and translation, consistent with the hypothesis  <cit>  that hgt is less common for informational proteins than for metabolic proteins. table  <dig> gives the list of representative proteins used to compute figure  <dig>  several poorly characterized gtpases , rarely used in phylogeny, repeatedly turned out to be representative . table  <dig> also lists three different measures of representativeness – agreement with the consensus distance matrix – for the representative proteins. one of these measures, the maximum elementwise difference between the single-gene and the consensus distance matrices, is generally quite large; every protein gave some pairwise distance that differed by at least 10% from the corresponding consensus distance. this observation means that very few proteins land near the center of all pairwise histograms  for a diverse set of bacteria; most proteins are well away from the mode in at least one such histogram. all measures of representativeness improve quite dramatically, however, with decreasing taxon diversity. the computation of figure  <dig> for β- and γ-proteobacteria used only proteins with correlation coefficients at least . <dig>  whereas the overall bacterial phylogeny necessarily used proteins with correlation coefficients as low as . <dig> 

bacterial phylogeny
figures  <dig>   <dig>   <dig>   <dig>   <dig> give our phylogenies for bacteria. these trees provide further validation of the methodology in the sense that they correctly identify all accepted clades, and are fairly robust under bootstrapping and under varying the choices of representative proteins and species. these trees were computed by maximum-likelihood methods on alignments of 5000– <dig> columns, concatenations of  subsequences of the 20– <dig> most representative proteins for the set of genomes under study. the same number – or even a greater number – of columns of randomly chosen ubiquitous proteins gives worse results, not always finding the monophyly of proteobacteria and of γ-proteobacteria, two well-accepted clades that are nontrivial to resolve  <cit> . as explained in the methods section, figure  <dig> was computed all at once with a subsample of organisms, and again in two overlapping pieces , each piece again using 5000– <dig> columns. a separate run with the same subsample of organisms along with two archaea  was used to root the tree, and yet another separate run was used to place chloroflexus, a partially sequenced genome. figures  <dig>   <dig>   <dig>   <dig>   <dig> are in almost complete agreement with each other, as were the several different runs used to compute figure  <dig>  so our results seem to be robust under different taxon samples. one exception is bacteroidetes/chlorobi; if this phylum is omitted as in  <cit>  deep branches rearrange, for example, actinobacteria/deinococcus/cyanobacteria forms a high-level clade with firmicutes. figure  <dig> suggests that chlorobium is the organism that has diverged least from the difficult-to-resolve central area of the tree.

the trees given in figures  <dig>   <dig>   <dig>   <dig>   <dig> show substantial areas of agreement with those of other researchers  <cit> . especially striking is the agreement with the recently published phylogeny by battistuzzi et al.  <cit> , computed from about  <dig> columns from  <dig> manually selected genes. figure  <dig> disagrees with the tree of battistuzzi et al. only at three internal branches with poor bootstrap support in both studies: the root , the edge marked  <dig> , and the edge marked  <dig> between the branches to haemophilus and vibrio .

our study supports a basal position for aquifex as in  <cit> , rather than placing it near bacteroidetes/chlorobi  <cit>  or proteobacteria  <cit> . we place bacteroidetes/chlorobi as a bridge between gram-positive bacteria and proteobacteria as in  <cit>  and in the rrna tree of brochier et al.  <cit> . we form a clade containing actinobacteria, deinococcus, and cyanobacteria  as in  <cit> , but  reject a higher-level clade  <cit>  combining actinobacteria/deinococcus/cyanobacteria with firmicutes. we place planctomycetes  with chlamydiales as in  <cit> . we find that spirochaetes, chlamydiales , and ε-proteobacteria form a close trio, with exact branching order hard to resolve, due to closely spaced branching events and/or numerous horizontal transfers. the bootstrap values at the branches in this trio stand out as weak in our generally well-resolved tree. we also consider the root to be relatively weak, not only because of its bootstrap value but also because it appears next to two thermophilic eubacteria showing the most hgt with archaea. our program rejects obvious cases of hgt as non-representative, but it cannot screen out subtle ancient transfers or genome-wide biases in amino acid composition. we reject grouping δ- and ε-proteobacteria into a clade as in genbank's taxonomy, because such a grouping had zero support out of  <dig> trials. we place buchnera/wigglesworthia farther than haemophilus, vibrio, and shewanella from e. coli, in agreement with  <cit> , but in disagreement with a recent phylogeny of γ-proteobacteria  <cit>  and two more focused studies  <cit> . our placement of buchnera/wigglesworthia, however, may be an artifact related to long-branch attraction as in problem  <dig> of table  <dig>  so the true position of these reduced genomes may indeed be with enterobacteria.

our tree supports the history of photosynthetic organisms determined by signature sequences  <cit> ; moreover it places chloroflexus, chlorobium, and cyanobacteria in close proximity. even so, our tree implies either hgt or a common ancestor with both rc- <dig> and rc- <dig> types of reaction centers  <cit> . one explanation of the paraphyly of rc- <dig> and rc- <dig> would be horizontal transfer from chloroflexus/cyanobacteria to proteobacteria, and indeed our program flags protochlorophyllide reductase, both chlb and chln subunits, as anomalously close between cyanobacteria and photosynthetic proteobacteria. our program does not, however, find an unusually large amount of hgt among photosynthetic bacteria.

discussion
any attempt to screen proteins for anomalous evolution inevitably leads to questions concerning horizontal gene transfer. the rate of hgt is notoriously difficult to estimate  <cit> . one study  <cit>  indirectly estimates that about 30% of genes have been subject to hgt within bacteria, whereas a more direct analysis finds evidence for hgt in about 50% of ubiquitous genes over all prokaryotes  <cit> . a recent study  <cit>  finds that about 30% of single-ortholog cogs deviated significantly from "clock-like evolution" over smaller taxa, such as γ-proteobacteria, with about half of these deviations due to hgt and half due to other anomalies. in what is perhaps the most detailed study to date, lerat et al.  <cit>  found only two strong examples of horizontal transfers among  <dig> genes within γ-proteobacteria.

we did not derive estimates of the rate of hgt from our experiments; however, our finding that representativeness improves dramatically with decreasing taxon diversity suggests that any study relying on a set of bacterial genomes from a single phylum, as in the recent work on γ-proteobacteria  <cit> , is likely to underestimate the rate of hgt. our finding  that unusually large pairwise evolutionary distances are much more common than unusually small distances confirms  <cit>  that many proteins deviate from clock-like evolution due to discontinuous evolutionary events besides hgt.

in a recent study, raymond et al.  <cit>  concluded that hgt has obscured the history of photosynthetic organisms on the basis of widespread disagreement among  <dig> gene trees relating five such organisms: synechocystis, chloroflexus, chlorobium, rhodobacter, and heliobacterium . we think, however, that the phylogeny of these five diverse and sparsely sampled  <cit>  bacteria is simply too hard a problem for single gene sequences to resolve. we found that  <dig> bootstraps from single genes also gave widespread disagreement among resulting trees. an important point is that the number of alignment sites  required to build a robust tree depends not on the number of organisms but rather on the length of the shortest internal tree edge. daubin et al.  <cit>  recently made this same point, and further argued that hgt has been overused as an explanation for the difficulty of bacterial phylogeny. horizontal transfer, however, at the rate of one core gene replaced – "xenologous displacement"  <cit>  – in each genome per  <dig> million years would be sufficient to pose an obstacle to deep bacterial phylogeny, yet remain undetected by the technique of daubin et al., which looked for transfers into exactly one of a closely related pair  such as e. coli and salmonella typhimurium.

CONCLUSIONS
ultimately prokaryotic phylogeny faces many obstacles beyond horizontal transfer. even in eukaryotes, where hgt is extremely rare, rokas et al.  <cit>  found that concatenations of a large number of genes gave more consistent trees and better bootstrap support than single genes and concatenations of fewer than  <dig> genes. representative proteins are clock-like proteins, ubiquitous over the set of genomes under study, selected with reference to a distance matrix computed by robust statistical methods from hundreds of well-conserved, but not necessarily ubiquitous, genes. concatenations of representative proteins give results consistent with much larger concatenations of randomly selected proteins for phylogenetic problems with known answers, so there is reason to believe that representative proteins can also provide the statistical leverage necessary to shed light on deep unresolved branches that remain controversial even with the use of all ubiquitous genes. the method of representative proteins, however, like all phylogenetic methods, has strengths and weaknesses. by incorporating information from many faster-evolving, non-ubiquitous genes, the method may be more susceptible to long-branch attraction and convergent evolution than reliance on ubiquitous genes.

in our view, genes have rich and varied evolutionary histories, contingent upon selective pressures and random events at several different levels. hence genes are likely to show continuous variation in quality as phylogenetic characters, rather than falling into two universal categories, bad and good, "subject to horizontal transfer" and "conserved core"  <cit> . there may well be genes whose entire evolutionary histories are smooth and regular, but there are surely not enough of them to resolve all phylogenetic questions, and we will be forced to use other, locally reliable genes to resolve certain parts of the tree of life. hence we believe that the tools we developed for mining and ranking potential characters fill an important niche in the evolving methodology of phylogenetic inference.

