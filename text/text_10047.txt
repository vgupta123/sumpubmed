BACKGROUND
confocal scanning microscopy is a commonly used method for acquisition of high-quality digital two- and three-dimensional images of molecular biological objects. the high quality of confocal images makes it possible to extract quantitative data at a single cell resolution, the availability of which is a necessary prerequisite for successful systems biology studies. however the data accuracy is limited due to errors that arise in the course of confocal scanning. in our recent papers  <cit>  we analyzed the sources of errors introduced by two-dimensional confocal imaging into the data on gene expression in situ and described algorithms for estimation and correction of these errors. for example, confocal images are inevitably contaminated by photon shot noise  <cit>  and a common way to reduce the noise is the averaging of multiple separate scans. however, the information about the averaged image will be lost if pixels with high or/and low intensities are clipped in single scans. image clipping is a form of signal distortion related to the limited grayscale range of an image. pixel values that exceed an upper threshold of the grayscale range  are cut-off at the threshold value, all the pixels with negative intensities are set to zero. such pixels are referred to as over- and under-saturated, respectively. averaging of clipped scans results in errors in the data extracted from the averaged image. in our previous work we developed a method  <cit>  based on censoring technique for estimation and correction of this kind of errors, however the method implementation requires not only the averaged image but also all the confocal scans which are not provided by the standard procedure of image acquisition.

the degree of image distortion and hence the size of data error caused by clipping depends on microscope parameters, most of all on the values of gain and offset of the photomultiplier tube , the detection device to measure photons. these parameters are adjusted to control the dynamical range of an image: the pmt gain  exponentially amplifies a weak signal, while offset defines the background level of intensities subtracted from the image to increase its brightness. although the pmt parameters are chosen to ensure that in the averaged image pixels take their value inside the grayscale range and do not look clipped, some of the pixels in single scans may be saturated due to photon noise and clipped off. the adjustment of pmt gain affects signal-to-noise ratio  in the image amplifying the noise level exponentially. the severity of clipping increases with the increase of gain and offset values, the distortions being the largest when the photomultiplier is adjusted to the limits of its sensitivity. besides the pmt adjustment snr can be improved by increase of laser power, however, this approach leads to fluorophore saturation and photobleaching. in practice the laser power is kept at a constant high level and the amount of light admitted to the specimen is reduced through aotf control, which does not amplify the noise. we have conducted experiments to estimate to what extent other microscope parameters, besides the pmt gain and offset, influence the size of data error.

in the present work we introduce a regression system for prediction of error magnitude in the data extracted from the averaged image. the learning samples are composed of images obtained at different combinations of gain and offset values of three different microscopes. the experiments were designed in a way that for each learning image all the scans were saved as separate image files. the linear regression model involves the values of gain and offset as independent variables while the error value estimated for the given mean intensity level is a dependent variable.

obviously the magnitude of error may vary among the data obtained with different microscopes and under different experimental conditions, and thus application of the prediction system requires a representative learning sample obtained by the same confocal system and the same scanning experiment as the image subject to error correction. to apply the developed regression system for predicting errors in new data we standardize all our training data obtained with three microscopes; we combine them in one sample and train the system on the combined sample.

the error prediction system was applied to correct errors in the data on expression of segmentation genes in drosophila that are stored in the flyex database http://urchin.spbcas.ru/flyex/. this data are widely used in research labs. our aim was to corroborate the high-precision of the data that was used for construction of the integrated atlas of segmentation gene expression.

the proposed method has important applications. usually it is recommended to adjust the parameters of microscope to almost avoid pixel saturation in single frames; this approach limits the brightness and contrast of averaged images. the newly developed system provides an opportunity to obtain images in a higher dynamical range and thereby to extract more detailed quantitative information from microscope experiments.

the regression system is implemented as a software tool correctpattern freely available at http://urchin.spbcas.ru/asp/2011/emm/.

methods
algorithm
estimation of between-scan noise
the photon shot noise is an inevitable consequence of the basic properties of confocal microscopy. among the main advantages of this imaging technology over conventional optical microscopy is the presence of a confocal pinhole, which let only light from the focus plane to reach the detector. pinhole removes "out of focus" light from the image, thereby decreasing the number of photons reaching detectors. the photon noise arises from a discrete nature and small number of detected photons and in a properly aligned microscope is the major source of errors  <cit> . this noise is signal dependent and follows the poisson distribution.

the noise level in the averaged image may be characterized by between-scan variance defined for each pixel in the image as a variance of values of the same pixel in all the scans. to illustrate how the between-scan variance depends on the pmt parameters the mean variances are plotted in figure  <dig> against the mean pixel values for different combinations of gain and offset. although the offset adjustment does not directly affect the pmt noise, subtraction of the background from an image decreases mean intensities leaving the noise unchanged and thereby decreasing the signal-to-noise ratio. for example, noise in the image obtained at the gain 1000v and offset -4% is noticeably higher than in the image from the same microscope obtained at the same gain and zero offset. as it is predicted by the optical theory the noise increases exponentially with gain and linearly with offset. it is clearly seen from the figure that in accordance with the properties of the poisson distribution the variance linearly depends on the mean pixel value at low and intermediate intensities, while at high intensities the variance values dramatically fall as a result of image clipping.

the degree of the averaged image distortion due to clipping is characterized by the fraction of clipped pixels as a function of the pixel intensity. for each pixel the fraction is computed as a number of scans in which this specific pixel is clipped, divided by the total number of scans. obviously for the pixels with the same intensity in two different images the fraction will be higher for the image with higher noise. the fall of between-scan variances at high intensities is explained by the fact that the fraction of clipped pixels approaches to  <dig> which results in saturation of the pixel value in the averaged image.

estimation of errors due to image clipping
quantitative data are read off from the averaged image. the quantification procedure includes the detection of object  borders and the subsequent averaging of the values of all the pixels assigned to an object. as a result the data are represented by the mean intensity and coordinates of each object in the image.

the error due to image clipping arises in data extracted from confocal images in the event that these images are obtained by means of averaging the clipped single scans. in the presence of all the scans the error magnitude can be estimated using the method based on the censoring technique  <cit> . data errors due to clipping are defined as the absolute difference between the true  value of the mean intensity and the mean intensity corrupted by clipping that is obtained from the observed averaged image.

to estimate data errors we first introduce a pixel error as a value of distortion of the pixel value in the averaged image caused by clipping. due to clipping at the upper grayscale threshold, over-saturation, the pixel intensity is reduced by the value   

where ca is the upper threshold, fa = 1/ exp  is the gaussian distribution density. the parameters μ and σ are estimated for each pixel by the method of moments as described in  <cit> . after that the quantities  are averaged over all the pixels with equal intensities. thus for any intensity k from the grayscale range  the averaged error, uk, is defined. we will name this type of error as upper error. the error in a data object is given by , where the averaging is performed over all the pixels belonging to the object and n is the number of such pixels.

as a result of offset adjustment a certain portion of intensities is subtracted from an image and any pixel value smaller than the subtraction threshold is clipped and set to zero. this type of distortion of single scans, under-saturation, yields the overestimated values of pixel intensities in the averaged image. in this case the pixel error is given by   

where cb is threshold defined by the value of offset,  is the weibull distribution density. the distribution parameters are estimated analogously to those of the gaussian model . the error estimates are averaged over all the image pixels with equal intensities; the averaged pixel error, lower error, is denoted as lk for any k ∈ . the data error is also defined in this case as the averaged value of all the pixel errors computed for all the pixels assigned to an object, .

note, that the magnitude of pixel error is uniquely defined by the level of image noise for a given mean intensity.

theoretically the method works at any degree of clipping but in practice its application is limited: for example the error estimation is infeasible if the true mean values of a pixel are clipped in all individual scans.

construction of the regression model
the method described in the previous section allows to precisely estimate and correct errors in images and data but its application requires the availability of all the confocal scans. in this section we construct a linear regression model for prediction of magnitude of error in the data extracted from the averaged image based solely on information about microscope parameters. the information about image acquisition is normally contained in scanning protocols saved by the microscope software. among the microscope parameters the adjustment of pmt gain and offset exerts the greatest influence on the error magnitude and these parameters are incorporated into the regression system as independent variables. as a learning sample we use confocal images scanned at different combinations of gain and offset, for which all the scans are saved along with the averaged images.

the regression algorithm is implemented in several steps. first, for all the elements of the learning sample pixel errors, uk and lk, are estimated for all the intensities that are present in the images. then the regression functions are constructed for each intensity value from the grayscale range. as signal and hence the degree of image distortions depends linearly on offset and exponentially on gain, independent parameters are chosen as the values of offset and exponent of gain. the regression function involves the total estimated distortion caused by under- and over-saturation, ek = uk + lk, as the dependent variable. for each intensity level, k ∈ , the linear regression function is defined as   

the regression coefficients βoffset,k, βgain,k and β <dig> k are estimated by the least squares method, minimizing   

where the summation is done over all the images, elements of the learning sample. each term includes the values of offset and gain that were applied for the acquisition of the corresponding image.

normally a pixel can be noticeably corrupted either by under- or over-saturation and hence only one kind of error, either uk or lk, can take considerable values .

the results of regression estimation are applied to predict the size of errors in data extracted from an averaged image non-belonging to the learning sample, for which single scans are not saved. as a first step, the regression equation  is used for prediction of error size in each pixel in the averaged image. next the predicted values are averaged over all the pixels within the area of each object detected in the image. the errors estimated in this way are used to correct the data distortions that arise due to clipping of single scans both at the highest and the lowest mean intensities.

image and data acquisition
three learning samples were obtained from three confocal microscopes. all the images are two-dimensional of a size  <dig> ×  <dig> pixels and have 8-bit grayscale resolution.

s <dig> sample
the images were obtained by leica tcs sp <dig> confocal system . in the scanning experiments we used a specimen prepared from the lily of the valley  root, that is highly autofluorescent in wide spectrum. we also scanned three expression patterns of drosophila embryo, that were also scanned on different microscope system when the s <dig> sample was constructed. the specimens were scanned  <dig> times using hcx pl apo  <dig> x/ <dig>  imm lbd.bl objective and three lasers  with different values of pmt gain and offset listed in table  <dig>  the power of argon laser was normally set to 30% of it's maximal value. to check the effect of laser power variation on the noise, one specimen was scanned at  <dig>   <dig>   <dig>   <dig>   <dig>  and  <dig> percent laser power at the same values of gain and offset.

combinations of pmt gain and offset used for the acquisition of  <dig> images. the gain values in parentheses are corrected to combine all the samples . offset values in parentheses are measured in intensity units subtracted from the image. images are obtained in  <dig> microscope channels using different lasers . the table entries are the channel numbers in which images at the corresponding combination of pmt parameters are obtained; if more than one image is obtained the number of images is given in parentheses.

s <dig> sample
the experiments were performed at juc "chromas" of the st.petersburg state university, russia. eight wild-type  drosophila melanogaster blastoderm embryos were immunostained for the expression of hb, gt and eve segmentation genes as described in  <cit> . we used fluorescent labels alexa fluor  <dig>  for detection of hb and cad and alexa fluor  <dig> for detection of eve and gt proteins. the embryos were imaged with a hcx pl apo lambda blue  <dig> x/ <dig>  imm lbd.bl objective of a leica tcs sp <dig> confocal system using argon  <dig> and hene  <dig> lasers. each embryo was stained for the expression of  <dig> genes, each staining was scanned several times with different values of pmt gain and offset, and for each experiment a series of  <dig> individual scans was saved together with the averaged image.

in total  <dig> averaged images  were obtained. to test whether the properties of lasers change with time six stainings were stored and scanned anew with the same values of pmt parameters several months after all the other series of experiments were performed.

the sample is composed of  <dig> images. for notations see caption to table  <dig> 

s <dig> sample
 <dig> embryos were immunostained for expression of one of four segmentation genes gt, eve, hb and bcd applying the same method as described above for construction of s <dig>  each embryo was scanned several times with different combinations of gain and offset settings . fluorescent labels used were alexa fluor  <dig> , alexa fluor  <dig> , and alexa fluor  <dig> . embryo images were taken with the 20x plan apo dry objective  of a leica tcs sp <dig> confocal system at stony brook university, ny, usa.

the sample is composed of  <dig> images. for notations see caption to table  <dig> 

the quantitative gene expression levels in nuclei are extracted from the images belonging to s <dig> and s <dig> with the use of a nuclear mask as described in  <cit> . the mask is a binary image in which all the pixels located within a nucleus are white and the rest pixels are black. the mask is superposed on the image and the values of pixels belonging to a nucleus are averaged. as a result each nucleus in the expression pattern is characterized by x and y coordinates and mean intensity level.

RESULTS
training of the system
the regression system is trained on images acquired from three different confocal microscopes. the learning samples s <dig> and s <dig> contain images scanned by two different microscopes leica tcs sp <dig>  the third sample s <dig> is obtained with a microscope leica tcs sp <dig>  details of image acquisition are given in the methods section. the values of gain and offset used for acquisition of all the samples are presented in tables  <dig>   <dig> and  <dig>  to bring the offset values of different microscopes to the common scale we measure offset in intensity units subtracted from an image. in this way we calculate that 1% offset for microscopes used to acquire s <dig>  s <dig> and s <dig> samples corresponds to  <dig>   <dig>  and  <dig> intensity units, respectively.

first of all, we analyze the photon noise as a function of pmt parameters in all the samples. the noise is estimated as the between-scan variance computed for each element of all the learning samples. the typical behavior of the between-scan variance is shown in figure  <dig> and discussed in detail in the algorithm section. the measured variances are given in figure  <dig> for selected values of pixel intensity and pmt parameters that makes it possible to compare the noise level in images obtained with different microscopes and at different conditions. as expected, due to different properties of electronic devices included into the microscope configuration, the noise is not equally defined by the pmt voltage in different microscopes. for example, images obtained at zero offset and equal gain, 750v, from samples s <dig> and s <dig> have different level of noise . for all our experiments the noise level coincides in images obtained with the same microscope in different channels using different lasers. the power of the laser used for excitation of specimen is another factor that influences the image noise. although this parameter is normally kept unchanged from experiment to experiment the output laser power may slowly decrease with time as the laser tube ages. we compared the noise in images scanned on different days, even separated by long intervals , and have established that the noise has not noticeably changed with time. the results of these tests  allowed us to assemble all the images obtained by the same microscope into one learning sample. however, the system trained on a learning sample can be only used to predict the error magnitude in data acquired with the same microscope. to be able to predict errors in any data we need to standardize all our training data obtained with three different microscopes and combine them into one sample.

the regression system uses the values of pmt gain and offset as independent variables which means that these parameters uniquely define the predicted error magnitude. to bring the values of these parameters to common scale we represent offset as measured in intensity levels subtracted from an image , and further need to find the way how to standardize the values of gain for different pmts used in different microscopes. as it was already mentioned above, the image noise is unequally defined by the pmt voltage in different microscopes, and even using different lasers in the same microscope, while the noise level completely defines the value of pixel error. hence it is sufficient to associate the gain values with the level of between-scan noise in images from different learning samples. as noise is known to exponentially increase with increase of gain, to bring the gain values of two samples to correspondence we used additive correction for the gain value in one of the samples. the correction in sample s <dig> with respect to sample s <dig> is found to be 80v, such that, for example, the gain value 800v in sample s <dig> corresponds to 880v in sample s <dig>  which means that these values of gain generate the same level of between-scan noise in images. the correction shift between the gain values in samples s <dig> and s <dig> is 280v as the pmt of microscope used to acquire s <dig> produces much higher noise. for example the level of between-scan noise almost coincide in images from s <dig> and s <dig> obtained at zero offset and gain 380v and 650v, respectively .

taking into account these corrections we create a common sample consisting of all the learning data obtained from all the microscopes.

regression estimation
the combined learning sample is used to fit the regression model  introduced in the methods section. the regression estimation is separately performed for each intensity level k ∈ . the value of dependent variables for each element of the learning sample is computed as the sum of upper and lower pixel errors uk and lk, if intensity level k is present in the image. all the images are 8-bit files, and hence the upper level ca is equal to  <dig>  however the highest intensities are present just in few images and the upper error values can be estimated for intensities not exceeding ~ <dig>  besides, the highest pixel values are usually very strongly clipped which may lead to unreliable estimates. examples of error estimates for different combinations of gain and offset are shown in figure  <dig> 

the regression coefficients βoffset,k, βgain,k and β <dig> k are estimated by the least square method . the results of regression estimation are summarized in table  <dig>  for the sake of space the estimated values of the coefficients are only given for selected values of intensities k. the regression results are visualized for low and high mean intensities in figure  <dig>  a close to  <dig> value of the determination coefficient r <dig> is an evidence of adequacy of the regression model and its good prediction properties.

results of the regression estimation for selected values of the mean pixel intensity. for each mean intensity the number of valid cases, determination coefficient r <dig>  and estimates of the regression coefficients betas are presented. the significant values of betas are given in bold.

to cross-validate the accuracy of prediction we performed a so-called leave-one-out test. the test uses a single observation from the original sample as validation data and the remaining observations as training data. this procedure is repeated so that each observation in the sample is used once as validation data.

the test was slightly modified since some images were obtained at the same values of pmt parameters; all such images were together excluded from the training dataset to form the validation sample. at each step of the test procedure we apply the regression system to predict pixel errors for an image from the validation sample. for each pixel value the accuracy of prediction is characterized by the absolute difference between the computed and predicted error values. the cross-validation results are presented in figure  <dig>  the test confirms high accuracy of error estimation for samples s <dig> and s <dig>  while for the images from s <dig> the deviation in error estimation attains  <dig> units in absolute value. the lower accuracy of error estimation for sample s <dig> is explained by much higher noise in the images from this sample.

the method was used to predict the sizes of errors in data on expression of  <dig> segmentation genes in drosophila embryo generated in our previous work and stored in the flyex database . this dataset consists of about  <dig> confocal images, of which  <dig> were acquired by microscope and lasers used to generate s <dig> sample , while the rest images were obtained by microscope and lasers applied to scan s <dig> sample  <cit> . the images were used to extract quantitative data on segmentation gene expression by the method presented in  <cit> , however this data is corrupted by clipping because all the images were obtained under the standard image acquisition procedure which precludes saving of single scans along with the averaged image.

the data error is usually computed as an average of errors of all the pixels in a data object . however, at high mean intensities this approach is likely to produce unreliable estimates. due to photon noise the intensities of some pixels in nucleus with high mean intensity may reach values exceeding  <dig>  while estimates of pixel errors are inconsistent at such intensities. in this case it is rather recommended to estimate the data error as the error of a pixel with the intensity equal to the mean intensity of the data object. we have tested this simplified approach on the available data and have observed that the error estimates computed by both methods did not have noticeable differences.

in general, to apply the regression system for prediction of errors caused by clipping in data extracted from a series of 8-bit images scanned by any confocal microscope it is sufficient to bring the values of pmt parameters used for image acquisition to the common scale. for this purpose there is no need to create a full representative learning sample but just to run a specially designed experiment on the same microscope in the same channel and under the same conditions. to measure the value of offset subtracted from images the same staining is scanned twice using the same gain and two different values of offset. the mean difference between the images divided by the difference between the offset values will give the standard measure of offset. to standardize the gain all the confocal scans are saved for an image scanned at zero offset and any given value of gain. then the between-scan noise is computed as described in and its values are put into correspondence with those computed for our combined sample and presented in additional file  <dig>  table s <dig>  the difference between the gain voltage that generates the same level of noise in an image from the combined sample and new experiment will give the correction shift for the gain.

finally we come to the following scheme of the data error prediction algorithm:

 <dig>  bring the values of pmt parameters used for image acquisition to the standard scale.

 <dig>  for any obtained image apply the regression system to to predict pixel errors using the standardized values of gain and offset as input parameters.

 <dig>  compute the sizes of errors caused by clipping by averaging the predicted values over all the pixels within the area of each object detected in the image, or just take the pixel error corresponding to the mean intensity in the object.

software tool
the algorithm for prediction of data errors in gene expression patterns is implemented as a software tool correctpattern freely available at http://urchin.spbcas.ru/asp/2011/emm/. the main function of the program is to predict and correct errors due to pixel saturation in an input gene expression pattern. input parameters of the program are the values of gain and offset used for image acquisition. the program provides a tool for automated parameter standardization. a user should provide a series of confocal scans obtained at zero offset for the gain standardization and two averaged images of the same specimen obtained with the same gain and different values of offset for offset standardization. the program computes and saves the corrections for gain and offset that are further used for standardization of the input parameters for any image obtained using the same microscope laser. output data file is saved in the same format as the input file with the mean intensity values replaced by the corrected ones.

correctpattern is realized as a complex of programs in c, java and javascript languages using the three-tier architecture. program modules are installed on linux server and use image processing libraries. the user interface is realized in the web browser in javascript language on the basis of ajax technology. web server is used as an intermediary between the user interface and functional program modules.

examples of the method application
correction of gene expression patterns
the method application is illustrated on two gene expression patterns. an example of error correction in the data extracted from an image belonging to s <dig> sample is shown in figure 5b. predicted error values reached 15- <dig> units at the highest mean intensities and  <dig> units at the minimal mean intensities present in the pattern.

an advantage of the proposed method is the opportunity to increase the dynamical range of low signal images and acquire accurate quantitative data from them. the second example illustrates the correction of an expression pattern of fushi tarazu  segmentation gene in drosophila blastoderm obtained using a poor quality antibody. the specimen was scanned by the microscope and laser used to generate s <dig> sample.

according to the standard procedure for quantitative data acquisition  <cit>  the gain and offset of the microscope photomultiplier should be adjusted so that the maximum level of gene expression corresponds to the maximum level of fluorescence intensity at an 8-bit scale. for immunochemical detection of the gene product we use rat antibody against ftz  <cit>  and the commercial secondary antibody anti-rat alexa fluor  <dig>  due to the long-term storage, the activity of the primary antibody decreased and even using very high antibody concentrations we had to raise the gain to almost maximum possible value to obtain images of intensity calibrated against the images of flyex embryos stained for the ftz expression. the noise level in such images is very high that gives rise to high errors in the data. the regression system was applied to correct these errors that reached considerable values of about  <dig> units at the intensity  <dig> as shown in figure 5c.

another source of errors in the data obtained with the use of the antibody at our disposal is a high non-specific background signal. we applied the method published in  <cit>  to remove the background and normalize the data. upon the application of this procedure the error magnitudes increased significantly up to  <dig> units at the intensity  <dig>  this example shows that in cases when there is a need to use high values of pmt parameters the error correction method is very important to make the data suitable for analysis.

estimation of error sizes in the flyex dataset
the flyex dataset is a valuable source of information about mechanisms of pattern formation in early development. besides confocal images of gene expression patterns it contains quantitative data extracted from these images, as well as a set of reference images and data representing the most typical expression pattern for a given developmental time. this data attracts attention of many scientific groups, which widely use flyex to study the mechanism of pattern formation, infer regulatory interactions in the segmentation genetic network and develop new mathematical models http://urchin.spbcas.ru/flyex/refs.jsp.

in our recent publication  <cit>  we have shown that this data is corrupted by clipping. notwithstanding the fact that the sizes of the data errors are small due to proper choice of microscope parameters, the errors should be removed as the quality of conclusions drawn critically depends on the data quality. the general-purpose method for correction of pixel saturation requires all the confocal scans to be saved without averaging. the regression system which we have developed allows us to circumvent this limitation, predict the error magnitude in the data extracted from the average image and apply the error correction procedure to the whole dataset.

the important corollary of extension of the method to predict the error sizes on the whole dataset is the opportunity to accurately estimate the sizes of these errors. almost all the images from the flyex dataset were acquired with the gain values within the range from 450v to 680v and offset values under 45%. the predicted error values do not exceed 7-8% of the highest mean intensity present in expression pattern. the lowest value of mean intensity in nucleus is never zero due to inevitable presence of non-specific background staining  <cit>  in the embryo. the background level is determined by the quality of antibodies used for staining, and in our data it varies between  <dig> and  <dig> units. the predicted errors take values not higher than 2- <dig> units in expression patterns with low background and are negligibly small in the case of high background. the detailed results of the error estimation are given in additional file  <dig>  figure s1; additional file  <dig>  figure s <dig> and additional file  <dig>  figure s <dig>  errors at low intensities may slightly affect the estimation of background level but are small enough not to noticeably corrupt the pattern after background subtraction.

discussion
in our recent publication  <cit>  we described a new method for estimation and correction of errors in the quantitative data extracted from clipped confocal images. the method was applied to the data on segmentation gene expression in drosophila. a necessary requirement for the method application is availability of all the individual scans that usually are not saved but directly averaged by the microscope software to reduce the photon noise in images. due to this requirement the method could not be used to correct errors in data obtained by the standard scanning procedure; the method only allows to determine the range of settings that provides acceptable level of errors in a specific microscope.

to extend the applicability of the method we have created a linear regression system and software to predict the magnitude of errors in the data obtained from a confocal image based on information about microscope parameters used for the image acquisition. the system was trained on three samples of images obtained from different microscopes with different combinations of the pmt gain and offset adjustments. as adjustment of pmt gain and offset to the same values in different microscopes produces different level of noise, the scales of these parameter were calibrated to achieve standardization. the standardized parameter values were used by the regression system as independent variables.

to estimate regression function each image in a training sample was saved together with all the individual scans. the computed errors were included as dependent variables into the regression model taking into account a known fact  <cit>  that the error size depends linearly on the offset value and exponentially on the gain value. the system predicts the magnitude of errors in data extracted from an 8-bit image obtained by a confocal microscope using the values of standardized pmt parameters as input. the cross-validation tests demonstrated high accuracy of predictions.

it should be stressed that the standardization of the microscope parameters is very important as it puts into correspondence the properties of images obtained with different microscopes, lasers and under different experimental conditions. all what is needed is to perform a simple experiment to measure the photon noise via the estimation of between-scan variance and standardize the parameter values used for image acquisition against the scale utilized in the training sample. upon that the regression system can be used on the data extracted from a series of images obtained at the same conditions.

we envisage one additional application of the regression system developed in this work. this system allows a user to extract more detailed quantitative information from the images, thereby increasing the accuracy of gene expression data. the confocal scanning experiment directed to the acquisition of quantitative gene expression data possesses certain specific features. for example, images used to acquire data on segmentation gene expression in drosophila embryo are standardized against the image of an embryo exhibiting the pattern characteristic of maximal expression, that is normally observed at the late stages of development of a wild type embryo. the gain and offset values of the microscope photomultiplier are adjusted for this embryo and kept constant in all the series of scanning experiments. because of this arrangement it may happen that images of embryos at early stages of development, and especially of mutants, are of very low contrast since the level of gene expression in these embryos is low. this is especially typical for images of expression patterns in embryos stained with the antibodies of poor quality, that give rise to a high nonspecific background. to be able to extract more detailed information from such images it is necessary to increase their intensity range by setting high values of pmt parameters; however this may lead to pixel saturation and errors in quantitative data extracted from the images. our regression system provides means to estimate and correct errors in data obtained with an extended range of microscope parameters and hereby makes it possible to obtain more accurate quantitative information on gene expression.

CONCLUSIONS
• a regression system is created for error magnitude prediction in data obtained from an 8-bit confocal image. the prediction is based on information about microscope parameters used for image acquisition.

• the method demonstrates high prediction accuracy and was applied for correction of errors in the data on segmentation gene expression in drosophila blastoderm stored in the flyex database .

• an important advantage of the developed prediction system is the possibility of error correction in data obtained from strongly clipped images, thereby permitting acquisition of higher dynamic range images, which would aid extraction of more detailed quantitative information.

• the system is realized as a software tool correctpattern freely available at http://urchin.spbcas.ru/asp/2011/emm/.

competing interests
the authors declare that they have no competing interests.

authors' contributions
all the authors participated in the design of the study and wrote the manuscript together. all authors read and approved the final manuscript.

supplementary material
additional file 1
photon noise. logarithm of the noise level computed at different values of mean pixel intensity in images obtained at zero offset and standardized values of gain. noise values are only given for pixel intensities almost non-corrupted by pixel saturation

click here for file

 additional file 2
predicted errors in the flyex data . error magnitudes predicted for data on expression of segmentation genes in drosophila stored in the flyex database. the embryos were imaged with leica tcs sp <dig> confocal system at stony brook university using argon  <dig> nm laser. the error values are computed at mean intensity levels  <dig> and  <dig>  in gene expression patterns that due to high non-specific background do not contain nuclei with the mean intensity equal to  <dig> the error magnitudes are not shown.

click here for file

 additional file 3
predicted errors in the flyex data . error magnitudes predicted for data on expression of segmentation genes in drosophila stored in the flyex database. the embryos were imaged with leica tcs sp <dig> confocal system at stony brook university using hene  <dig> nm laser. for notations see additional file  <dig>  figure s <dig> 

click here for file

 additional file 4
predicted errors in the flyex data . error magnitudes predicted for data on expression of segmentation genes in drosophila stored in the flyex database. the embryos were imaged with leica tcs sp <dig> confocal system at stony brook university using hene  <dig> nm laser. for notations see additional file  <dig>  figure s <dig> 

click here for file

 acknowledgements
this work was supported by the national institutes of health ; and the civilian research & development foundation ; and russian foundation for basic research . we thank juc "chromas", st.petersburg state university, russia, and center for developmental genetics, stony brook university, usa, for sharing the confocal microscopes.
