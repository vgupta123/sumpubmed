BACKGROUND
faster and economical next-generation dna sequencing  technologies have enabled studies of complex microbial communities which were experimentally intractable in terms of their true microbial diversities only a decade ago . economy of scale and the availability of streamlined data processing pipelines have driven the majority of studies’ estimates of taxonomic and phylogenetic content from 16s ribosomal rna sequencing and inferences of functional content from reference genomes of corresponding or related taxa. on the other hand, whole shotgun sequencing of metagenomic dna arguably provides a more robust and unbiased measurement of the taxonomic and functional content of a microbiome  <cit> , but its use has been limited due to the necessity of greater sequencing depth  and significant computational challenges. the latter is particularly acute, especially in non-human systems where genomic catalogues and reference genomes of representative species are not readily available. as sequencing costs continue to decline, the primary barrier for broad application of whole shotgun metagenome sequencing is largely computational.

in silico functional annotation of proteins exploits their evolutionary relationships with experimentally characterized proteins and uses empirically-defined thresholds of global sequence identity  to assign proteins to the same enzyme commission number   <cit> . in the absence of such relationships, methods like i-tasser  <cit>  and cofactor  <cit>  collectively annotate some protein sequences by predicting and comparing their structures with global and local structural features of well-characterized reference proteins. these powerful techniques, however, have been developed exclusively for full-length molecules, and use of similar approaches for peptides predicted from short-read metagenomic data has generally been avoided due to the belief that such peptides lack enough evolutionary or structural information to accurately identify the orthologous genes from which they originate. these concerns are underscored by the fact that protein domains are redundantly used to perform diverse biochemical activities  <cit> , leading to the expectation that short peptides will simply align to all the proteins carrying their “domains of origin”, resulting in a confounded pattern of functional predictions based on a variety of reference proteins carrying that domain  <cit> .

the three prominent resources for metagenomic data processing  all work similarly, aligning translated peptides from the short reads of ngs platforms to databases of well-annotated reference proteins and using single sets of sequence similarity measures  for functional prediction. the effectiveness of individual sets of ssms used by these protocols was recently questioned by the finding of the pauda study  <cit> , where high variances in the identity profiles of alignment hits were observed even within the same kegg-orthology group   <cit> . these observations resulted in concerns of significant sensitivity losses in assigning ko-families to short ngs reads on the basis of individual sets of ssms. moreover, recent publications using these metagenomic data processing methods also demonstrate absence of any consensus among the community of users regarding individual significance thresholds or sets of ssms elements that can accurately discriminate between true and false-positive function assignments .

given the dearth of empirically-derived data on the alignment behavior of peptides that could even be used to model thresholds for ssms, we were motivated to systematically study the actual alignment behavior of short protein fragments. using random peptides extracted from ko-family members  and hypothetical uncharacterized proteins  extracted from the m5nr database  <cit> , we studied their alignment behavior in bulk using bacterial proteins from the ko-families as a reference database. we observed remarkable behaviors that show clear evidence of structural features of local segments of proteins being evolutionarily constrained. these structural constraints act as natural barriers to random alignment of small peptides, restricting peptide alignments to homologous domains from the domain of origin and evolutionarily related families in which the domain has become associated with a new function. peptides originating from uncharacterized/hypothetical proteins , which typically represent a significant part of the reads in metagenomic ngs data, do not display this characteristic alignment behavior and their parameters can be used as a filter to eliminate their confounding effects on abundance estimates of known protein families in metagenomic data.

RESULTS
to systematize measurements of alignment behavior, we developed sets of peptides from two major cross-sections of proteins that are observed in metagenomic data, namely, peptides from proteins that can be annotated accurately on the basis of experimentally-characterized protein families  and peptides that originate from proteins that share no detectable evolutionary relationship with known protein families . for type  <dig> peptides, eight different sets of peptides were generated from the ko-families with each set having a different peptide length , see methods and table  <dig> for the test case types description. each set contained  <dig> randomly-derived peptides from each of the  <dig> ko-families comprising our reference database. these sets were then aligned to the entire set of bacterial members of the  <dig> kos. viewing the alignments as a whole , the longer query peptides generally yielded a higher frequency of significant hits. with the smallest query peptide length tested , only  <dig>  % found a significant hit when the e-value cutoff was  <dig> . increasing the peptide length dramatically increases the frequency of significant hits, with the highest frequency of significant hits equal to the length of the query peptide . very similar behavior was observed when e-values were plotted for the different query peptide lengths .

because the origin of the query peptides was known, their alignment behaviors to proteins of the parental ko-family  and of the non-parental ko-families  could be quantified independently, as depicted in  for query peptides of length  <dig> amino acids. when comparing the alignment patterns of the queries to parental and non-parental ko-families, the behaviors were very consistent irrespective of the length of the query peptides . to statistically confirm this phenomenon we performed one way anova over differences of alignment-identity values, between parental and non-parental kos, of  <dig> randomly-selected hits from each peptide length . the mean p-value  over  <dig> iterations of this procedure clearly shows that the alignment behavior patterns were independent of the length of the peptides. we noticed that alignments with higher percent identity  or lower e-values  were more frequently observed among alignments to parental ko-families than non-parental ko-families. box and whisker plots of the distributions of percent identity of full-length alignments of each of the query peptide lengths  shows that the majority of alignments to parental kos consistently occur at a higher range of identities than alignments to non-parental kos. however, a more accurate picture emerges when alignments of all lengths are considered. in three dimensions  there is substantial overlap of hits to parental and non-parental kos . the overlap of the three-dimensional contours suggests that no single threshold would easily discriminate between the parental and non-parental ko contours and hence allow consistent resolution of parental and non-parental ko-families. these observations were further strengthened by the analysis of multiple roc curves  generated for multiple peptide lengths  with varying range of alignment parameters . these plots  clearly indicate that none of the combinations of alignment-coverage and identity provided high enough sensitivity  and specificity  to accurately assign short peptides to ko-families.fig.  <dig> alignment profiles of short peptides to parental vs non-parental ko-families. comparison of alignment behavior  when the short peptides align to members of their parent ko-families  when short peptides align to members of their non-parent ko-families. while hits to same ko-family members have high proportion of alignment-identity above 80 %, but a major fraction of hits still remain in the range of 40–80 %  and makes it difficult to discriminate between true and false positive hits. hexbin colors within the graph are proportional to their frequency or members within the bin. member frequency and color relationship is depicted in the arrow-headed color bar

fig.  <dig> three dimensional plot of alignment length, percent identity and hit frequency of type  <dig> peptides. the plot is colored to differentiate values for hits to parental ko  and non-parental ko-family . data for the 61-mer peptides is shown



though the lengths of the most abundant alignments were equivalent to the length of the query peptide, we observed some alignments as long as twice the length of the query peptide and such behavior was equally prevalent among hits to parental as well as to non-parental ko-families . interestingly the hits to non-parental ko-families show similar alignment patterns, hinting that structural and functional similarity may be shared among alignments to non-parental kos and parental ko-families .

error rate using only the best alignment
because the alignment behavior of type  <dig> peptides precludes a simple discrimination between parental and non-parental kos, we estimated the error rate of classification for peptides when an orthologue from a very closely related species is not present in the database. this was estimated by the fraction of peptides  having their best hits with a protein from a different  ko-family, even when the members of their own ko-families were present in the reference database . table  <dig> shows that ~91 % of the peptides of each query length found their best hit among parental kos , while the remaining 9 % of the peptides had their best-hits among non-parental kos. this ratio of true-positive/false-positive was essentially independent of query peptide length and suggests that nearly 10 % of assignments based on best-hits may be incorrect.table  <dig> alignment behavior of short-peptides 


atotal number of short-peptides used in the study


btotal fraction of peptides having significant alignment with at least one other protein 


ctotal count of significant blast hits


dtotal count of significant blast hits to the same ko group 


etotal count of significant blast hits to a different ko group 


ftotal count of best blast hits aligning to the same ko group 


gtotal count of best blast hits aligning to a different ko group 



total number of members within a ko-family influences the quality of true-positive alignments
despite the ever-increasing number of diverse microbial taxa whose genomes have been sequenced and carefully annotated, even the most carefully curated databases such as kegg have unequal representation across taxonomic and phylogenetic space and consequently have corresponding overrepresentation and voids in functional ontologies. given the broad distributions of percent identities, alignment lengths and e-values for alignments of type  <dig> peptides, it seems reasonable to expect that biases in the databases affect these distributions, further confounding assignments based on alignment alone. to model the effects of database bias, the relationships between the number of ko-family members in the database and the median alignment identity of all true positive hits of peptides were plotted. the plots  revealed that the range of alignment identities was quite large for kos with fewer members, but got much smaller as the ko size increased, with median alignment identity decreasing as ko-family size increases. thus, ko-families with higher representation may cover a larger evolutionary space of proteins but the effect is to lower the median score and tighten the distribution of the identities, while the identities at low ko representation are much more dispersed with an inflated median. this trend was independent of query peptide length, although the rate of decrease in the median identity score increased with longer peptide length. this is likely because longer peptides have a higher probability of having medium quality hits that are long enough to cross the blast threshold score.

why do hits to non-parental ko-families have competitive alignments?
though database representation clearly affects alignment distributions and confounds the parental ko/non-parental ko boundary on the alignment behavior landscape, another factor that likely affects the landscape is structural divergence. protein fold space is limited  <cit>  and the same folds are often found in proteins that perform quite different biochemical functions  <cit> . in contrast, the reverse  has occurred in only a small number of cases   <cit> . accordingly, proteins carrying similar ec-numbers  have a high propensity of carrying similar domains/folds. we therefore hypothesized that the ko-families within the boundaries of the alignment landscapes of parental/non-parental ko-families share the same or highly related ec hierarchies.

this hypothesis was examined by querying the ec numbers of the peptides   and the ec numbers of the ‘reference set’  proteins to which they align and developing ec number similarity profiles at each level of the ec hierarchy. if our hypothesis is true, we would expect the ec numbers of the alignments to the non-parental kos to increasingly match the ec numbers of the parental kos at increasing levels of the ec taxonomy. as shown in additional file 1: figure s <dig>  this is indeed the case, as query and aligning non-parental proteins generally shared ec hierarchies at frequency rates of ~80 % , 67 % , 60 %  and finally 20 % across all four levels. thus, even when peptide alignment identities are at the boundaries between parental and non-parental kos, the functions performed by the peptide domains are similar and the the same was suggested by the alignment behavior of peptides to parental and non-parental ko-families. for example, aminoacyl-trna-synthetase proteins like aspartyl-trna-synthetase  and lysyl-trna-synthetase  have different ko-family assignments due to different ligand-specificity of their catalytic-domains but perform similar functions  by sharing the same anticodon binding domain  to bind to trna  <cit> .table  <dig> description of test case notations used in the current study



remarkably, our systematic characterization shows that despite being short in nature , the primary sequences of these short peptides carry information that reflects similarity in protein structure and function.

frequency weighted protein count method
the inherent structural constraints of proteins and the highly selective alignment of peptides to domains which are homologous to their parental kos, even when present in non-parental kos, means that artificial thresholding based on ssm constraints may actually limit the information that could be used for the function assignment. this is especially true given the effects of uneven ko representations in the databases. to correct for the uncertainty in the functional assignments of peptides having many significant alignments, rather than assigning a peptide to a single protein family we weight its contribution to total abundance values of all the protein families having significant alignment with that peptide. the alignment weights can be adjusted relative to the alignment weights of peptides which are highly specific to their parental ko-family . this “frequency weighted read count” protocol provides higher weights to peptides unique to a protein family, and should improve the accuracy of protein abundance profiling by decreasing the noise created by reads with complex alignment patterns.

to test our concept, 31-mer peptides were generated from all  <dig> ko-families, randomly choosing about 10 % of the members from each ko-family, and these peptides were aligned against the complete ‘reference set’ proteins . in our protocol, the blastp outputs were first parsed to calculate and store the weight for each query peptide; once these weights were computed the abundance of each ko-family was calculated by adding the frequency-weight of all the peptides aligned to member proteins of the corresponding ko-family. the frequency-weight based read counts  were plotted against the true  counts from the same ko-families from which the peptides originated . abundance values based on our “frequency-weighted read count” method achieve a very high correlation  with the true abundance values of all the ko-families present in our data set .fig.  <dig> true ko-families abundances are compared with frequency-weighted read counts. evaluation of performance of ‘frequency weighted read count’ method when test case is comprised of peptides originating from those proteins, which have their family members in the ‘reference set



alignment behavior of reads originating from experimentally uncharacterized proteins 
even in some of the best studied bacterial species, significant proportions of the proteins fall into a category with no readily detectable evolutionary or structural relationship with experimentally characterized proteins. as an example of this category, 11 % of the proteins from e.coli do not show significant similarity with proteins of known structures, using even the most sophisticated threading algorithms to detect distant ancestry and predict functionality  <cit> . such proteins have been designated as “hard” cases to assign structural folds or functions. despite the predictable behavior of the full-length hard case proteins, it is quite possible that short fragments derived from hard case proteins can achieve significant alignment with well characterized proteins. since a significant proportion of metagenomic data routinely falls into this hard case category, it is likely that alignment behavior of peptides from hard case proteins could confound quantification when using all alignment information of peptides in conjunction with frequency-based weighting.

to study this potential confounder, we modeled the behavior of peptides derived hypothetical proteins using three different test sets of peptides  derived from hypothetical proteins of known genomes  that were aligned to the ‘reference set proteins’. the alignment data  showed several unique features that were not observed in the alignments to type  <dig> and type  <dig> peptides. first, only one-third of the type  <dig> peptides showed significant alignments . if the fraction of hypothetical proteins with at least one peptide having a significant hit with a reference protein is calculated, the numbers essentially doubled to  <dig>   <dig> and 67 % for type  <dig> ,  <dig>  and  <dig>  test sets, respectively. second, when compared to alignments of type  <dig> peptides studied above, type  <dig> ,  <dig>  and  <dig>  peptides had substantially fewer hits per peptide  as compared to  <dig> hits/peptide for ‘test set type 3’ peptides. among the hits that were obtained, the type  <dig> peptides hit a very large proportion of the reference set , showing the virtually random nature of these alignments. the randomness was also reflected in the percent identities of the best hits, which were far lower for the type  <dig> than for the type  <dig> peptides .fig.  <dig> comparison of alignment-identity profiles of the best hits of peptides from known and unknown protein-space. identity profile of best hits of peptides from uncharacterized proteins  is compared with the same of peptides from proteins having their family members in the reference protein set 



some ‘test case type2’ peptides do achieve significant hits, even in the absence of homologous proteins in the reference set. it seems likely that that the sheer number of reads from genes of this category would affect quantification using our frequency-weighted method as these proteins are among the most commonly encountered in metagenomics data sets.

to measure their effect, the blast results of the ‘test case type3’ dataset were pruned to hits of peptides from only  <dig> randomly selected ko-families, referred to as the ‘selected_4k_ko_hits’. the frequency-weighted abundance profiles for all  <dig> possible ko-families were then measured from only the ‘selected_4k_ko_hits’, or new sets in which the ‘selected_4k_ko_hits’ were composited with hits from peptides of the test case type  <dig> ,  <dig>  and  <dig> . as expected, the ‘selected_4k_ko_hits’ alone showed a very high degree of correlation with their true abundance profiles . in contrast, the massive numbers of hypothetical peptides in the composited ‘selected_4k_ko_hits’ plus type  <dig> peptides generated a large numbers of low per-peptide hits from the hypothetical proteins, inflating the abundances of many proteins substantially from their expected abundances . to filter out the inflation from the random hits of hypothetical peptides we used two of their unique alignment behaviors, namely, their very low per-peptide hits ) and the low alignment-identity profiles from their best hits ). based on these patterns we revised our ‘frequency weighted read count method’ to filter out or ignore the hits from those peptides which have  low per-peptide hit counts  and  a best hit with alignment identity below 55 %. applying this new protocol to the sets of ‘selected_4k_ko_hits’ alone and the ‘selected_4k_ko_hits’ plus type  <dig> peptides  shows that the effects of the type  <dig> peptides are mostly eliminated and the observed and expected abundances of the different ko-families show much greater correspondence. collectively, incorporating systematic analyses of peptide alignment behavior into an approach to accurately assign functions results in more reliable quantification of gene abundances in metagenomic data sets.fig.  <dig> effect of peptides from “unknown protein-space” on the “frequency-weighted” abundance profiles of proteins from “known space”. artificial boost in the abundances of ko-families is elucidated using output of ‘frequency weighted read count’ method when ‘test case type <dig> ’  is added to ‘selected_4k_ko_hits’. red line reflects the true correspondence values

fig.  <dig> corrected abundance profiles of ko-families using “filter-enabled frequency weighted” method. artificial boost in abundance values of ko-families due to peptides from “unknown protein space” is corrected by extending our frequency-weighted method and enable it to filter peptides with characteristics of those from hypothetical proteins. new abundance profile of the same test data used in fig.  <dig> is plotted in this figure . red line reflects the true correspondence values



discussion
foundational studies of protein structure led to an early realization that structural information was influenced substantially by the sequence of the protein  <cit> . the alignment behavior of short peptides was examined in detail by sander and schneider  <cit>  and rost  <cit>  who showed that segments of proteins having alignment lengths between  <dig> and  <dig> aa are structural homologs provided the corresponding minimum alignment identities are 40–80 %. our interest in further examining this behavior has been renewed by the capacity to explore taxonomic and functional content of complex microbial communities by metagenomic sequencing on short-read ngs platforms. remarkably, we find that the alignment-identity threshold range of the vast majority of hits of type  <dig> peptides from the current data set of  <dig> , <dig> million proteins completely overlaps with the threshold ranges observed historically from much smaller data sets. the immediate application to metagenomics, of course, is that short peptides translated from short ngs reads are actually long enough to carry structural signatures causing them to align to their structural homologs.

applications to protein discovery
the tendency of short protein fragments to align to their structural homologs is a confounding factor in functional annotation due to the multiplicity of functions of homologous protein domains . however, the strong bias of type  <dig> peptide alignments to parental and non-parental ko-families that share similar ec number profiles leads to an intriguing idea that small peptides  could be used as markers for predicting protein function or perhaps ec number profiles. in such cases, proteins having limited “global sequence similarity” with well characterized proteins  may nonetheless carry small peptides which can achieve significant alignments with these peptide markers. the most likely candidates for these proteins would be those whose evolutionary constraints are fundamentally different than what is observed in the known space .

applications to microbiome-wide and genome-wide association studies
to accommodate the alignment behaviors of type  <dig> peptides, we weighted significant hits by the frequency of hits to allow higher precision measurements of those peptides for which high-probability assignments could be made. a second improvement in assignment accuracy was to threshold peptides with alignment behaviors resembling type  <dig> peptides from the “unknown” protein space . together, these strategies improved quantitative estimates from type  <dig> data sets by a factor of  <dig> . because these “hard proteins” constitute significant proportions of known genomes  and typically make up peptides that are predicted from  <dig> to 70 % of metagenomic reads, the improvements made by our criteria will have a dramatic effect on metagenomics applications where highly accurate, quantitative measurements of taxa and protein functional categories drive success of the experiments. for example, mwas and gwas experiments focused on microbiome traits depend exclusively on accurate measurements  <cit>  to limit type i and type ii errors. the inherent biological noise, combined with sample error in these experiments, requires significant biological replication to appropriately power such experiments, and even when appropriately powered, false discovery rates still remain relatively high  <cit> .

it should be noted that even with our thresholding designed from type  <dig> peptide behaviors, roughly 10 % of the proteins from the “hard protein” space were removed from the set of reference proteins for generating our type  <dig> peptide data sets because they displayed alignment behavior  bordering type  <dig> peptides. these proteins are likely to occur at similar proportions in most metagenomic data sets. it seems likely that these proteins represent remote homologues of proteins in our database. they will remain a challenge for further improvement and refinement of data filtering and processing. of the remaining hard proteins, >95 % of the peptides could be easily filtered using our criteria . as new protein families are discovered, the alignment landscape will continue to expand, moving more type  <dig> peptides into the type  <dig> category and expanding the continuous landscape of the “known” protein universe. however, it is clear that the gap between the known and unknown portions of the universe is not likely to narrow substantially in the near future. until then, removing the effects of alignments from peptides in this category has the huge advantage of improving the quantitative accuracy of measuring functions in the “known” universe, and that alone is cause for implementation.

CONCLUSIONS
our detailed analysis of short peptides shows that their alignment behavior is non-random and driven by structural properties. although alignment patterns are constrained to structurally-related folds, these folds have been dispersed across proteins with a variety of functions by evolutionary processes, impairing accurate functional assignment even when peptides originate from well-defined proteins. the error-prone nature of functional assignments can, however, be minimized by weighting abundance predictions by the frequency of significant hits. in contrast to known protein families, peptides from hypothetical proteins have very distinct alignment patterns, allowing them to be easily filtered. by filtering out peptides originating from the “unknown protein space” and then appropriately weighting the contributions of remaining peptides, quantification of peptide distributions are much more accurate and will improve quantitative estimates of functions from metagenomic data.

