BACKGROUND
mass spectrometry  is an increasingly important technique in proteomic research, providing insights into protein expression, turnover and metabolism  <cit> . when an organism growing in unlabeled medium is supplied with a pulse of isotopically labeled nutrients such as ammonium ions, glucose or amino acids, metabolic labeling of the proteome occurs, resulting in a mixture of both unlabeled and labeled cellular components. alternatively, two or more samples may be independently labeled and then mixed together for analysis, yielding mass spectra with a combination of unlabeled and labeled species  <cit> . even the mass spectrum of a single unlabeled peptide can be quite complex, due to the natural abundance of heavy isotopes. the small fraction of naturally labeled atoms creates a statistical distribution of peaks rather than just a single peak, as illustrated in figure  <dig>  several other factors can increase the complexity of the observed spectrum, such as the presence of a number of species with different labeling patterns, each with their own distribution of peaks, or the extent of labeling that is achieved. partial labeling compounds the complexity of the mass spectrum by broadening the statistical distribution of peaks for a species. this is especially relevant to the study of higher organisms, where it can be difficult to achieve high extents of labeling  <cit> .

one of the challenges of quantitative mass spectrometry is dealing with this rich and complex distribution of peaks. several software packages exist for the analysis of ms data, including openms  <cit> , mapquant  <cit> , maspectras  <cit> , msinspect  <cit> , mzmine  <cit> , specarray  <cit> , tpp  <cit> , viper  <cit> , superhirn  <cit> , xcms  <cit> , mmass  <cit>  and isodist  <cit> . each of these programs focuses on the high-throughput processing of large datasets, which is crucial to analyzing proteomic ms data. there is a more limited set of tools aimed at calculating and visualizing individual isotope distributions. these include imass  <cit> , isotopica  <cit> , ms-isotope  <cit>  and isotopident  <cit> . however none of these tools are interactive, offer fitting of the entire isotope distribution, and a flexible definition of the labeling pattern.

here, the program envelope is described, offering a more sophisticated approach to the visualization of calculated isotope distributions than any existing software package. any number of different labeling patterns and labeled species can be accommodated for both peptides and oligonucleotides. in addition, envelope offers the ability to interact with data by directly comparing calculated distributions with experimental data. envelope features a user-friendly interface, and the displayed isotope distributions change in near real-time in response to user-controlled changes in the labeling parameters using continuously variable slider controls or text input boxes. envelope is a flexible tool designed to help researchers interpret the complex spectra they may see in their experiments, and to help plan new experiments by illustrating which combinations of labels will yield interpretable spectra. envelope will also be useful in a classroom environment to help explain the principles of ms and isotope distributions since no scripting or command line knowledge is necessary. envelope is a powerful ms analysis package that is well suited for a variety of research and educational purposes.

implementation
source code and algorithms
envelope is an open source desktop application. the user interface and visualization components are written in objective-c, taking advantage of the mac os x; cocoa framework, while the isotope distribution calculation core is written in c. isotope distributions are calculated using the fourier transform convolution  method previously described by rockwood et al  <cit>  and subsequently extended by sperling et al  <cit> . briefly, ms datasets have the mass/charge  ratio as the independent variable , and intensity as the dependent variable. a spectrum of n real points in the m-domain s has a conjugate fourier representation as a frequency in the μ-domain s, where the μ-domain representation is complex. the two representations can be interconverted by forward fourier transforms  and inverse fourier transforms . the isotope distribution for a species with a particular labeling pattern is first calculated in the μ-domain, followed by ift to obtain the m-domain spectrum. ftc was chosen over the polynomial method  <cit>  as it is an exact method, and lends itself well to the calculation of both atom-based and residue-based labeling patterns  <cit> . fourier transforms were implemented using the fftw library  <cit> . the envelope executable  and source code  are both available for download as additional files or from the envelope website.

features
envelope is capable of simultaneously calculating the isotope distributions for any number of different species for a single peptide or oligonucleotide, and experimental labeling patterns of virtually any level of complexity can be handled. calculated spectra for each of the different labeling patterns specified can be visualized individually or all at the same time, and a spectrum containing the sum of all distributions ) is automatically calculated.

 stot=∑i=1naisi 

the isotope distribution for a species with a particular labeling pattern has a unit spectrum si as well as an amplitude ai by which the unit spectrum is multiplied. the labeling patterns are defined in terms of fractional 2h, 13c, and 15n content, and can be further defined in terms of all atoms of a particular type for the entire molecule  or only atoms belonging to specific residue types . in order to account for hydrogen exchange, two categories of hydrogen labeling can be defined for subsets of a residue's hydrogen atoms, each with an independent fraction of 2h. hydrogen atoms beyond the sum of these two categories are assumed to have natural abundance isotope content.

envelope can concurrently load multiple experimental data files that contain pairs of m/z and intensity values. these data are displayed with the calculated spectra in the main window, and the goodness of fit of each data set to the sum of all the calculated spectra is automatically calculated using the reduced chi-squared  formula.

 χ2=1n∑i=1n2σi <dig> 

the average of the squares of the residuals between the experimental intensity idata and the calculated intensity icalc is summed over n experimental data points, while the error estimate σ is arbitrarily set to one for convenience. chi-squared is best used as a relative quantity to compare multiple fits to a single experimental spectrum. it is difficult to directly compare fits to different experimental spectra using chi-squared as it depends on several factors including overlapping peaks and the intensity of the acquired spectra. to obtain a better fit to the experimental data, adjustments can be made to the baseline, peak width and mass offset of a calculated spectrum. the mass offset is a uniform offset in the m/z domain that is applied as a small mass accuracy correction. the gaussian peak width γ is defined in the μ domain by the following function where smaller values of γ lead to broader peaks.

 g=exp⁡2πγ 

both calculated and experimental spectra can be displayed as a combination of lines and/or points with user-definable colors and styles. the range of data displayed is automatically optimized, although the user can manually zoom in to examine specific areas. envelope is capable of high-quality pdf and png output, allowing for the easy generation of publication-quality images. the user interface shown in figure  <dig> is dominated by the graphical display, and a second region contains the bulk of the controls.

it would be useful for envelope to be able to interact with the wide variety of existing ms analysis programs. to this end a subset of envelope's functionality can be manipulated by script, allowing other programs to use envelope as a frontend for the display of calculated and experimental isotope distributions.

usage
upon opening, envelope presents the user with the default peptide nvlp, and two entries in the list of spectra, one entry for a calculated spectrum with natural abundance isotope levels, and one entry for the sum of all calculated spectra, which cannot be deleted. pressing the go button at this point will display the natural abundance isotope distribution for the peptide nvlp, z = + <dig>  the go button may be activated at any point to visualize changes that have occurred, or the live checkbox may be selected and spectra will automatically be recalculated in response to user-initiated changes. the user may add additional calculated spectra using the "+" button, and the labeling pattern may be defined at any time. only one calculated spectrum is needed to begin visualizing isotope distributions, though a distinct calculated spectrum is required for each species generated in an experiment. in quantitative proteomics experiments, there are typically one unlabeled and at least one labeled species. once the necessary calculated spectra have been added, experimental data can be loaded by the "+" button, or via the file menu. the sequence, molecule type and charge will each need to be adjusted to match the data. the user may then adjust the labeling patterns for the calculated species, their amplitudes, and the baseline, gaussian width and offset in order to fit the sum of the calculated spectra to the data by monitoring the decrease in χ <dig>  envelope will display any desired ratio of amplitudes of calculated spectra defined by the user in order to quantitatively compare the amounts of different species. this value dynamically updates during the fitting process, always reflecting the current amplitudes.

RESULTS
15n pulse labeling
to illustrate the features of envelope, a complex isotope distribution was generated using peptide samples with a combination of partial metabolic 15n labeling and uniform 15n labeling. a rapidly growing culture of e. coli in medium with 2so <dig> as the sole nitrogen source was pulsed with 2so <dig>  to a final enrichment of ~50% 15n. after approximately  <dig> minutes of continued growth, ribosomes were harvested from the cells, producing a mixture of unlabeled and 50% 15n labeled ribosomes. fully 15n labeled ribosomes  were then added to the mixture, resulting in three species for each protein: unlabeled protein , partially 15n labeled protein  and fully 15n labeled protein . the ribosomal proteins were purified, and the mixture was digested with trypsin and analyzed by liquid chromatography coupled mass spectrometry  using an esi-tof instrument . the peaks resulting from a single peptide  are shown in figure 3a. the three distinct species with different isotope labeling patterns are clearly observable in the experimental data, and using envelope three calculated distributions can be interactively fit by hand to the experimental data. each of these three peptide species is defined by the user, in this case using atom-based labeling to specify the 15n content. the amplitudes of the unlabeled, partially labeled and fully labeled species  give information about the relative quantities of the three different species present in the mixture for the protein s <dig>  the fraction labeled  is defined as the amplitude of the partially metabolically labeled species  divided by the sum of the amplitudes of the unlabeled  and metabolically labeled species.

 f=alau+al 

for this peptide f =  <dig> , indicating that approximately 40% of the s <dig> protein in the sample was labeled with 50% 15n.

in a similar metabolic labeling experiment the ribosomal rna was purified, digested with rnase t <dig> and submitted for lc/ms analysis in negative ion mode, without the addition of a fully 15n labeled species. the result is a mixture of just two species, one unlabeled and the other partially labeled . the experimental spectrum resulting from these two species, as well as the calculated isotope distribution  are shown in figure 3b. the amplitudes of the unlabeled and partially labeled species are  <dig>  and  <dig>  respectively, and f =  <dig> . the data used is available for download .

pulse labeling with amino acids
in addition to calculating isotope distributions for species with atom-based labeling, envelope is also capable of calculating distributions for species that are labeled with amino acids or nucleotides. rapidly growing e. coli in minimal medium supplemented with each of the  <dig> amino acids was simultaneously pulsed with both 13c labeled isoleucine and 2h labeled leucine, to a final ratio of approximately 3: <dig> labeled:unlabeled amino acids. ribosomes were harvested and ribosomal proteins purified after an additional  <dig> minutes of growth. the result was a mixture with two species, one unlabeled species and one species fractionally labeled with both 2h leucine and 13c isoleucine. the experimental spectrum for one peptide  along with the calculated isotope distributions for the two species is shown in figure  <dig>  since this peptide has just one leucine residue and one isoleucine residue, there are four identifiable groups of peaks, resulting from all four possible combinations of labeled residues: no labeled amino acids, labeled isoleucine only, labeled leucine only, and both labeled leucine and isoleucine. the relative intensities of these four groups of peaks are determined by the fraction of labeled leucine and isoleucine residues in the labeled species, which was observed to be ~72% for both amino acids. this value was determined empirically using envelope to fit the experimental spectrum, starting from enrichment levels expected based on the experimental protocol. the amplitudes of the unlabeled and labeled species are  <dig>  and  <dig>  respectively, and f = <dig> . the data used is available for download .

discussion
while envelope is not intended to replace high-throughput batch analysis programs for the large-scale fitting of data in a research environment, it has its own place alongside them. envelope is useful in planning experiments by visualizing the isotope distributions produced by potential labeling patterns. by exploring the predicted isotope distributions before performing any actual experiments, optimal labeling patterns can be determined which help increase the quality of the final data. envelope also allows the user to fit calculated distributions to experimental spectra that may be poorly fit by automatic fitting routines. this is especially true in the case of spectral overlap, where to the human eye it may be clear that adjacent peaks are overlapping the signal from the peptide of interest, but a computer algorithm cannot resolve this situation. a least-squares fit for example will increase the baseline of the calculated spectrum or amplitude of a species in an attempt to fit overlapping experimental peaks where no calculated distribution exists, skewing the final result. in a case where there is an unknown extent of isotope enrichment, envelope can be used to fit data for a few peaks by hand, determining the actual enrichment to be used as a starting value for a batch fit using another program.

more than just a research tool, envelope is useful as a learning aid, both for individual researchers and in the classroom environment. by defining a labeling pattern and immediately seeing the calculated distribution onscreen, then watching the distribution change in response to adjustments to the labeling pattern, one can easily understand the different factors that contribute to a given isotope distribution. there are two important concepts that must be distinguished in metabolic labeling experiments, which are the concepts of fraction labeled , defined here as the relative amount of the labeled species compared to the unlabeled species, and the isotope abundance which is the fractional isotope content of a particular labeled species. for students being introduced to the subject for the first time, these two distinct quantities can be confusing as they both deal with a different kind of extent of labeling. using envelope, these two concepts can be directly illustrated and explored as a didactic exercise. envelope features slider bars to manipulate the isotope enrichment for a species while observing the effect on the spectrum in the interactive display, and checkboxes to define the fraction labeled in terms of the amplitudes of different species. these changes are displayed in near real-time, dependent on processor speed and complexity of the system. this immediate feedback is very useful to illustrate how the parameters affect the isotope distribution, and has been very effective as a live tool in seminars describing the analysis of lc/ms data from metabolic labeling experiments.

CONCLUSIONS
envelope is a powerful tool for the interactive calculation and visualization of isotope distributions that is capable of simultaneously calculating distributions for an arbitrary number of species of a single peptide or oligonucleotide, each with a different labeling pattern. envelope can visualize experimental mass spectra, allowing the user to perform manual least-squares fits of calculated distributions to real experimental data. envelope is useful for small-scale data analysis and planning experiments. moreover it can be used as a teaching tool, and its user-friendly and interactive qualities make it well suited for use by research groups, in seminars, or in the classroom.

availability and requirements
project name: envelope

project home page: 

operating system: mac os x;  <dig>  or  <dig> , intel and power pc

programming language: c and objective-c

other requirements: executable: none. source: compilation of the envelope source requires the apple developer tools, freely available from . envelope makes use of the fftw library, freely available under the terms of the gnu general public license from .

license: gnu general public license 

any restrictions to use by non-academics: see gpl license for details

abbreviations
ms: mass spectrometry; ftc: fourier transform convolution; ft: fourier transform; ift: inverse fourier transform; lc/ms: liquid chromatography coupled mass spectrometry; esi-tof: electrospray ionization time-of-flight.

authors' contributions
mts designed and wrote the software and built the project home page. mts and jrw both tested the software and contributed to the manuscript.

supplementary material
additional file 1
zip archive of the envelope application.

click here for file

 additional file 2
zip archive of the envelope source code.

click here for file

 additional file 3
zip archive of sample data used in figures  <dig> and  <dig> 

click here for file

 acknowledgements
this work was supported by nih grant r37-gm <dig> to j.r.w. m.t.s. was supported by grant number f32-gm <dig> from the n.i.g.m.s. the authors wish to thank edit sperling for providing the experimental data and stephen chen for help testing envelope and providing valuable feedback on its implementation and design.
