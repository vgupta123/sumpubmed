BACKGROUND
the geometrical shape of a molecule is a key factor for biological activity in computer aided molecular design, rational drug design, molecular docking and function prediction  <cit> . to exploit the shape similarity between molecules, a useful tool is molecular shape comparison  that compares the shapes of two or more molecules and identifies common spatial features  <cit> . in computer aided drug design, for instance, an alternative process of virtual screening takes advantage of such comparison for searching a molecular database for compounds that most closely resemble a given query molecule  <cit> . the underlying assumption is that the molecules similar to the active query molecule are likely to share similar properties. one main advantage of msc is that the molecules with shape similarity can be found without any specification of chemical structure. however, the efficient msc is still a challenge  <cit>  due to the high complexity of 3d molecular shapes.

although many researchers have proposed various methods for shape comparison of molecules  <cit> , most of them only concerned comparison of 3d rigid objects, little attention has been paid on the deformed shapes of flexible objects. nevertheless, many molecules are flexible, and this flexibility is often part of their function, which may lead to significant shape changes. shape similarities between molecules can be missed when different conformations of the same molecule are compared to each other as rigid bodies. several recent methods  <cit>  were proposed for addressing this problem by regarding molecules as flexible shapes, but these methods can not handle well shape deformation of molecules with topological changes. in this paper we developed a new technique for comparing molecular shapes, which is insensitive to shape deformation of flexible molecules, in particular to topological changes.

methods of molecular shape comparison
the msc methods can be roughly divided into two categories  <cit> . one category of msc, called superposition methods, relies on finding the optimal superposition/alignment of two or more molecules compared  <cit> . the superposition methods usually compare molecular shapes in a particular coordinate system by a priori superposition/alignment, which is non-trivial to achieve robustly. another category of msc, called descriptor methods, are independent of molecular orientation and position by using descriptor to represent the shape of molecule. the descriptor methods compute the similarity score by comparing the corresponding descriptors between two molecular shapes without any superposition. a 3d shape descriptor, or named signature, is a compact representation for some essence of the shape. the shape descriptor is often used as an index in a database of shapes and it enables fast queries and retrieval.

the descriptor methods are simpler and much faster than the traditional superposition methods. several recent works related to msc using shape descriptors have been developed such as shape distribution, spherical harmonic descriptor, and 3d zernike descriptor  <cit> . these descriptors are rigid-body-transformation invariant, and they are often effective for capturing rigid objects. nevertheless, most of these methods are not deformation invariant and they can not support flexible molecular shape comparison. deformation invariant representation of nonrigid or flexible shape is a challenging problem in the field of shape analysis. several recent works focus on the problem of comparing non-rigid shapes  <cit>  in computer vision, computer graphics, and pattern recognition. however, these existing descriptors do not perform well for flexible molecules due to their complex shape deformation. it is beyond the scope of the presented paper to give a detailed review of all the existing work; we will only review those most relevant results. the reader may consult  <cit>  for a general introduction to the msc problem.

methods based on distance descriptors
the distance descriptor between sampling point pairs on shape surfaces may be the simplest and most widely used shape descriptor in 3d shape retrieval. the presented paper also belongs to this category. we first introduce three representative distance descriptors: euclidean distance , geodesic distance  and inner distance .

euclidean distance
the ed descriptor  <cit>   is usually represented by a histogram of distance values. it consists of three steps for computing the ed descriptor. first, some point pairs are randomly selected on the shape surface, and the euclidean distances between all sampled point pairs are computed, finally the histogram of all distance distribution is built. the similarity scores between shapes are measured as the differences between their corresponding histograms. the ed descriptor has several advantages. it is both rotation and translation invariant, is computationally cheap , and describes the overall shape, which means that it is not easily affected by minor shape distortions. nevertheless, the ed histogram can not capture the shape similarity of flexible objects.

geodesic distance
to overcome the drawback of ed, one can simply apply the gd  <cit>  as the shape descriptor instead of the ed. the gd between two points on a surface is measured as the length of the shortest path along the boundary surface. although the gd is invariant to surface bending, it is not enable to capture shape articulation deformation well  <cit> , that exists commonly in macromolecular movements .

inner distance
in order to overcome the disadvantages of ed and gd, we recently proposed a new shape descriptor based on inner distance  for comparing the shapes of flexible molecules  <cit> . the id is the length of the shortest path between landmark points within the molecular shape and it reflects the molecular structure and deformation much better than other distance measures. however, the above distances only measure the shortest path between two points in a sense of the single path, and they may be significantly affected by topological changes of shape deformation.

in order to deal with shape deformation of flexible molecules, possibly with topological changes, we propose to use the diffusion distance  as a new shape descriptor. the diffusion distance is related to the probability of travelling on the surface from one point to another in a fixed number of random steps  <cit> . the diffusion distance is an average length of paths connecting two points on the shape, while the gd or id is the length of a shortest path. this naturally makes the diffusion distance less sensitive to topological changes. in our implementation, we combine diffusion distances with the help of inner distances for constructing a new shape descriptor, called diffusion distance shape descriptor , which leads to an average length of paths in a sense of inner distances. the new descriptor is insensitive to shape deformation of flexible molecules, in particular to topological changes, and it is more effective at capturing molecular structures than traditional shape descriptors. our ddsd is stored as a histogram which is a probability distribution of diffusion distances. our approach reduces the 3d shape comparison problem of flexible molecules to comparison of ddsd histograms. the core procedure can be divided into four steps: sampling, calculating inner distances, computing diffusion distances based on diffusion maps, and building descriptors .

methods
in this section, we first review diffusion distances and inner distances. by combining them, we then present a new method for computing the ddsd of flexible molecules.

review of diffusion distances
we recall diffusion distances as described in  <cit> . coifman et al. introduced diffusion maps and diffusion distances as a method for data parametrization and dimensionality reduction. a 3d shape can be embedded into the euclidean space via diffusion maps. the diffusion distance is equal to the euclidean distance in the embedding space corresponding to diffusion maps. informally, the diffusion distance is considered as an average length of all the paths connecting two points on the shape, and it is related to the probability of arriving from one point to another in a random walk with a fixed number of steps. this makes the diffusion distance a bending invariant function of the path length and the shape width between two points. since this distance does not rely on just the single path between two points, it is robust to topological changes.

for the exposition simplicity, we regard the 3d shape as a finite set of 3d points. in the diffusion framework, a nonnegative symmetric diffusion kernel function k, which reflects the similarity between two points x and y, is first constructed over all pairs of points on the shape. the kernel function can lead to a n × n matrix k, where n is the number of available points. the matrix is symmetric and has non-zero values. next, we define

  p=kv, 

where v = ∑y k is the sum of the elements in each row. since we have that p ≥  <dig> and ∑y p =  <dig>  p can be interpreted as the probability for a random walker  on the shape to jump from x to y in a single time step. the corresponding matrix p = {p} is the transition matrix of this markov chain in a single time step. note that p is not symmetric any longer, therefore, we define a symmetric version

  p˜=pvv=kvv. 

the corresponding matrix p˜={p˜} is symmetric. using the random walk formulation, the transition probability from x to y in m time steps is given by the m-th power of the matrix p˜. the element p˜ of the matrix p˜m can be thought of as a "bump" centered at x and of width proportional to m.

then, the diffusion distance between two points x and y is defined as

  dm2=∑z∈x|p˜−p˜| <dig>  

where dm <dig> can be thought of as a distance between two bumps. using eigen decomposition of p˜, we can expand p˜ as

  p˜:=∑i=1nλi2ϕiϕi, 

where {λi} is the sequence of eigenvalues of p˜  and ϕi are the corresponding eigenvectors. therefore, for the elements of the matrix p˜m we obtain

  p˜=∑i=1nλi2mϕiϕi, 

lastly, the eigenmap

  Φm=λ2mϕ2⋮), 

defined by the eigenvalues and eigenvectors of p˜, is diffusion map in m time steps. the link between diffusion maps and distances can be summarized by the spectral identity

  ‖Φm−Φm‖2=dm <dig>  

which means that the diffusion map Φm embeds the data into a euclidean space in which the euclidean distance is equal to the diffusion distance dm in eq. .

diffusion kernels
the diffusion framework is essentially based on a markov random walk on graphs. the first step views all data points on the shape as being the nodes of a graph g, in which two nodes x and y are connected by an edge. once the graph is built, the weight of the edge in g is measured by the diffusion kernel k. in essence, the diffusion distance represents an average length of all the paths connecting node x and node y through g in a measure of k. note that k describes the relationship between x and y, and its choice should be guided by the application. typically, the following gaussian kernel is used

  k=exp/σ2), 

where de = ||x - y|| denotes the length of euclidean distance between x and y, and σ indicates the variance of the gaussian.

it is intuitive that if two nodes x and y are closer  in a sense of euclidean distances, they are more likely transmitted to each other. however, as discussed in  <cit> , the euclidean distance as well as geodesic distance can not capture well the flexible molecular structures. it is easy to see that the euclidean distance is sensitive to shape deformation. for instance, in figure  <dig>  the euclidean distance, that is defined as the length of the line segment between two landmark points x and y , does not consider whether the line segment crosses shape boundaries.

inner distances
to overcome the disadvantage of the euclidean distance used in the diffusion kernel k, we utilize the inner distance metric, as introduced in our previous studies  <cit> . let o be a 3d shape as a connected and closed subset of ℝ <dig>  we denote the boundary surface of o by ∂o. given two points x, y ∈ ∂o, the inner distance between x and y is defined as the length of the shortest path connecting x and y within o. for example, in figure  <dig>  the red dashed line denotes the inner distance, which is the shortest path within the shape boundary surface that connect two landmark points x and y. the right molecule is one deformation to the left one, and the relative change of the inner distances between the corresponding pair of points  during shape deformation are small. note that the euclidean distance does not have the property of deformation invariance in contrast to the inner distance.

based on the above observation, we use the inner distance instead of the euclidean distance de in eq.  as follows

  k=exp/σ2), 

where di measures the length of inner distance between x and y. in other words, p˜ based on eq.  defines the transition probability from x and y in a sense of inner distances.

representations of molecular shapes
molecular representations have various capabilities in terms of applications  <cit> . the surface-based representation of molecular shape is faithful to the actual physics of molecules and convenient for our application. a molecule can be defined by a set of spherical atoms whose exposed surface represents a molecular surface that defines the boundary of the molecular volume. in this paper, we consider the input molecule as a volumetric representation that is popularly used in biological research fields  <cit> . the volumetric model is composed of a uniform 3d lattice and it can be built in three steps as follows  <cit> . first we compute the connolly surface  of the molecule using the msroll program  <cit>  with default parameters. second, we place the triangle mesh in a 3d cubic grid of  compactly. third, each lattice point is assigned either  <dig> or 0;  <dig> for point inside the surface and  <dig> for outside. the inside point is denoted as object point and the outside point is denoted as background point. for each lattice point, there is a set of  <dig> neighbor points. an object point lies on the boundary if at least one of its  <dig> neighbors is a background point.

algorithm of ddsd
the ddsd algorithm for computing the diffusion distance shape descriptor of a volumetric object o is given as follows.

 <dig>  sample uniformly n points s = {q <dig>  q <dig>  ..., qn} on the boundary surface ∂o of o using lloyd's algorithm of k-means clustering.

 <dig>  calculate inner distances of all sample point pairs in s.

 <dig>  calculate diffusion distances of all sample point pairs in s.

 <dig> . first, we define a weighted graph g over all sample points by connecting points qi, qj ∈ s. set edge weights equal to k using eq. .

 <dig> . construct the transition probability matrix p˜ of the markov chain by eq.  and eq. .

 <dig> . compute the diffusion map Φm at diffusion time m using eq. .

 <dig> . compute the euclidean distance in Φm equal to the diffusion distance dm.

 <dig>  build the descriptor of the shape o as the histogram of values of diffusion distances using  <dig> bins.

the implementation details of algorithm will be given next.

sampling the boundary surface
the volumetric shape of a molecule can be considered as a point array. the full boundary point set is too large to compute shape descriptor effectively. in order to save storage and computation costs, we choose a subset of of boundary points but preserve the characteristics of the shape in the same way to  <cit> . we compared two sample methods: random sampling and uniform sampling methods. with random sampling, every point in the boundary point set has an equal chance of inclusion in the sample set. the points picked out by the random sampling method can not yield an informative sample set. in this paper, we utilize the lloyd's algorithm of k-means clustering for obtaining uniform sampling points on a molecular surface.

calculating inner distances
in the second step, we compute inner distances of all sample point pairs in s using our recent work  <cit> . here the inner distance is approximated by finding the shortest path distance in the graph, which is resolved using dijkstra's algorithm. dijkstra's algorithm is a graph search algorithm that solves the single source shortest path problem for a graph. in order to implement dijkstra's algorithm more efficiently, fibonacci heap is used as a priority queue. the code package of dijkstra's algorithm was implemented in  <cit> .

computing diffusion distances
in the third step, our algorithm includes two parameters: σ and m. in our implementation, σ is the average of inner distances between all pairs of points in the shape; the time constant m =  <dig> is used for diffusion time.

the diffusion distance is considered as an average length of paths connecting two points on the shape within m steps . in fact, the diffusion distance is computed by embedding a 3d shape into a euclidean space  in which the euclidean distance is equal to the diffusion distance dm. the parameter m intuitively specifies the amount of "diffusion time" during which paths are explored to discover connectivity between sample points. if m is chosen too large, then only the eigenvector with the lowest eigenvalues are considered during diffusion map, and the result is a distance measure with nice global geometry properties, but poor local geometry properties. on the other hand, if m is too small, then the diffusion process runs for only a short time, and the resulting distance is useful locally, but exhibits unexpected global geometry behavior  <cit> . for our application, the time constant m is suggested to be  <dig> for comparing molecular shapes. this selection  has been used in  <cit>  for non-rigid shape matching, which results in good results.

building descriptors
a challenging aspect of measuring the similarity between two 3d shapes is to find a suitable shape descriptor that can be constructed and compared quickly, while still discriminating between similar and dissimilar shapes. shape distribution  <cit>  is the simplest and most widely used shape descriptor, which represents the shape descriptor of a 3d model as a probability distribution sampled from a shape function measuring geometric properties of the 3d model. in particular, the distance histogram, also called d <dig>  is one example shape distribution, which represents the distribution of euclidean distances between pairs of randomly selected points on the surface of a 3d model. the key idea of shape distribution is to transform an arbitrary 3d model into a parameterized function that can easily be compared with others. in our case, the domain of the shape function provides the parameterization , and random sampling provides the transformation. the primary advantage of shape distribution is its simplicity, where the shape matching problem is reduced to sampling, normalization, and comparison of probability distributions. in spite of its simplicity, the shape distribution is expected to be useful for discriminating the whole objects with different gross shapes, including invariance, robustness, efficiency, and generality. in general, the d <dig> histogram is computed by employing stochastic methods and it is formed by three steps:  first sampling uniformly random points from the shape surface, then  computing the euclidean distance between the sampled point pairs, and finally  constructing a distance histogram by counting how many samples fall into each of fixed sized bins. from the histogram, we reconstruct a piecewise linear function which forms our representation for the shape distribution. in this paper, the main difference between our method and the original d <dig> is that we use diffusion distance in a sense of diffusion distance instead of euclidean distance in  <cit> .

after finishing computation of diffusion distances, we now convert a set of diffusion distances defined on the boundary of the object to a shape descriptor. this is done in a similar manner as d <dig> of shape distribution in  <cit> . given n sample points, the number of diffusion distances of the shape is at most n2/ <dig>  we evaluate specifically n2/ <dig> diffusion distance values from the shape distribution and construct a histogram by counting how many values fall into each of nbin fixed sized bins. in our experiments, we have found that using n =  <dig> samples and nbin =  <dig> bins yields shape descriptors with low enough variance and high enough resolution. note that our distance histogram includes the step of normalization by aligning the maximum and minimal diffusion distance values, which yields invariance under rigid motions .

measuring similarity
a shape descriptor can be used as an index in a database of shapes and it allows for very fast retrieval. therefore, we have to choose an appropriate similarity measurement between two shape histograms to achieve accurate results. osada et al.  <cit>  investigated many standard ways of comparing two histograms, which include lp  norms, bhattacharyya distance, and the χ <dig> measurement. in our work, we have found that using different metrics on different descriptors may affect lightly the query results. although in our experiments we tested all different types of metrics for each descriptor when possible, the metrics l <dig> and l <dig> norms are simple and usually give better results, where l <dig> norm is known as the manhattan distance and l <dig> norm is the familiar euclidean distance.

RESULTS
the ddsd algorithm presented in this paper has been implemented and incorporated into a shape search system of flexible molecules. the assistant program for computing inner distances is available from https://engineering.purdue.edu/precise/idss. to demonstrate the abilities of ddsd, we test it on a benchmark containing abundant conformational changes of molecules.

deformation invariance of shapes
in our first experiment, we select some representative molecules with conformational changes to show that the dd descriptor is insensitive to the shape deformation of flexible molecules. figure  <dig> illustrates comparison among two methods: dd and id. the first row shows the input four molecules  with the same main chain orientation but with different surface shapes. the four molecules are the morph deformation between two conformations of groel: 1aon and 1kp <dig>  the regions in topological changes are highlighted. the second row shows the histogram comparison. although the id descriptors can keep almost consistent histogram for the first three deformed molecules, it is sensitive to shape topological changes for molecule d, which leads to the significant difference in histogram. in contrast, our dd descriptors remain largely consistent for the four deformed conformation shapes of the same protein. figure  <dig> illustrates another comparison of dd and id for the input four molecules with the same main chain orientation but with different surface shapes. the four molecules are the morph deformation between two conformations of ran: 1byu and 1rrp. the second row shows the histogram comparison. the id descriptors is sensitive to topological changes of shapes, while our dd descriptors keep largely consistent for the four deformed conformation shapes of the same protein.

molmovdb benchmark
in order to evaluate the efficiency of the ddsd descriptor, we have incorporated our method into a simple search system for molecular shape comparison  <cit> . the presented method is tested on a benchmark of flexible molecules with conformations. this benchmark can be found in the database of macromolecular movements   <cit> . molmovdb contains a diverse set of molecules that display large conformational changes in proteins and other macromolecules , also including the intermediate morphs. the original benchmark data set has the total  <dig>  pdb files that are classified into  <dig> groups. the molmovdb benchmark has been applied to molecular shape comparison, predicting protein structures, and so on  <cit> . the developed search system retrieves the tested database for molecules that most closely resemble the shape of a given query molecule in terms of their geometrical shapes. in the current search system, the user first chooses a query molecule and the program computes the similarity scores for all molecules in the tested database using the ddsd method described in this paper. the program then ranks all molecules in the database according to their similarity scores. the search system also contains our recent works  <cit> , and the corresponding program and database are available. for the molmovdb benchmark we have pre-computed all dd descriptors of queries on the database. the dd descriptors allow rapid search on the system because a molecular shape is compactly represented by a one-dimensional histogram. the query time to the data set of molmovdb benchmark takes under a second if a query molecule is already transformed into the dd descriptor. for larger databases, more sophisticated indexing methods can further accelerate the performance. even though this simple search system of flexible molecules is rather simple, it shows the potential of ddsd for flexible molecular shape comparison using a single computer and without the need of aligning the molecules before testing for similarity.

evaluation
to evaluate the effectiveness of the proposed descriptors, we compared the dd shape descriptor with some other shape descriptors in terms of the performance on retrieving similar molecular structures. in addition to three distance descriptors: id, gd and ed, we also compare our descriptor to several known descriptors, which have been applied to search rigid shapes in many areas, such as engineering domain, computer graphics, and molecular shape comparison. they are as follows.

spherical harmonic descriptor   <cit>  is a rotation invariant shape descriptor based on spherical harmonics.

solid angle histogram   <cit>  measures the concavity and the convexity of a molecular surface. histograms are computed based on a complete partitioning of the 3d space into disjoint cells which correspond to the bins of the histograms.

shape distribution   <cit>  represents the shape descriptor as a probability distribution sampled from a shape function measuring the geometric properties of a 3d model. here, we use the d <dig> shape measure for the triangle surface of a molecule.

precision-recall curve
the standard evaluation procedures from information retrieval, namely precision-recall curves  <cit> , are often used for evaluating the various shape distance descriptors, but other evaluation criteria also exist  <cit> . precision-recall  curves describe the relationship between precision and recall for an information retrieval method. precision is a measure of exactness or fidelity, and it is the ratio of the relevant models retrieved to the retrieval size. recall is a measure of completeness, and it is the fraction of the relevant models retrieved for a given retrieval size. precision and recall are defined as follows:

  precision=tptp+fp, 

  recall =tptp+fn, 

where tp, the number of true positives, is the number of molecules that are included in the group that are the same as the query molecule correctly retrieved in the search; fn, the number of false negatives, is the number of molecules that included in the group same as the query molecule but missed in the search; fp, the number of false positives, is the number of molecules that are included in a different group from the query molecule but inaccurately retrieved in the search. thus, the denominator in eq.  is the total number of all members in a group and the denominator in eq.  is the retrieval size. a perfect retrieval retrieves all relevant models consistently at each recall level, producing a horizontal line at precision =  <dig> . however, in practice, precision decreases with increasing recall. the closer a precision-recall curve tends to the horizontal line at precision =  <dig> , the better the information retrieval method. for more details, the reader can refer to  <cit> .

other measures
in addition to the precision-recall curves, we also evaluate other quantitative statistics for evaluation of retrieved results for the molmovdb benchmark. specifically, we compute e-measure and f-measure. e-measure is a composite measure of the precision and recall for a fixed number of retrieved results  <cit> . the intuition is that a user of a search engine is more interested in the first page of query results than in later pages, so this measure only considers the first  <dig> retrieved models for every query and calculates the precision and recall over those results. the e-measure  <cit>  is defined as

 e=21precision+1recall, 

where the maximum score is  <dig>  and higher values indicate better results.

f-measure  is a measure of a test's accuracy, and it is the harmonic mean of precision and recall. the f-measure is defined as

 f=2⋅precision⋅recallprecision+recall. 

this is also known as the f <dig> measure, because recall and precision are evenly weighted. we summarize the retrieval statistics in table  <dig> for each method. examining the results, we can see that the dd descriptor is higher in performance compared to other descriptors.

the results show that our descriptor is higher in performance compared to others.

discussion
sampling rate
in the first step of the ddsd algorithm, we sample uniformly n points on the molecular surface for computing diffusion distances. figure  <dig> demonstrates the variation of precision-recall curves with increasing sampling rates n for the molmovdb benchmark, where n ∈ { <dig>   <dig>   <dig>   <dig>   <dig>   <dig>  1000}. the results suggest that the high sampling rate performs better than the low one. in this paper, we choose n =  <dig> sample points which yield shape descriptors with low enough variance and high enough resolution to be useful for our experiments. the higher sampling rate  could be used for pursuing the more accuracy. in addition, some other non-uniform sampling techniques such as curvature-adaptive clustering can also be applied to our work by restricting different stopping criteria, while this leads to an increase in computation time.

comparison with other work
commute time
the diffusion distance metric introduced in this paper is similar to the average commute time by proposed in recent studies  <cit> , in which chennubhotla and bahar presented the markovian stochastic model of information diffusion developed for exploring the inter-residue communication in proteins. the process in  <cit>  is controlled by transition probabilities for the passage/flow of information across the nodes, which in turn is based on the internode affinities derived from atom-atom contacts in the folded structures. its key idea is to measure two basic quantities: hitting time and commute time, during markov process of information transfer across the network of residues. hitting time h is the expected number of steps it takes to send information from residue υi to residue υj, and this may not be the same as h. commute time c is by definition the sum: h + h. hitting time has directionality, while commute time does not.

the diffusion distance is based on the eigenvalue decomposition of the markov transition matrix, whereas the hit/commute times are derived from the graph laplacian. although both our work and  <cit>  are essentially based on a markov random walk on graphs, there are still some differences between the two works. they are as follows.

 <dig>  the application is different. the diffusion distance discussed in our paper deals with the surface-based representation of molecular shape, which is faithful to the actual physics of molecules and convenient for our application. we take advantage of diffusion distances for description of flexible molecular shape. our goal is to discern the similarity between molecules for flexible molecular shape comparison, which is a challenging problem in query-retrieval in molecular databases. in contrast, the commute times in  <cit>  deal with elastic network models for describing protein dynamics. it provides a tool for insights on the topological basis of communication in proteins and design principles for efficient signal transduction.

 <dig>  the definition is different. the diffusion distance in our work is defined by an average length of paths connecting two landmark points on the molecular surface in a sense of inner distances. in contrast, the commute times in  <cit> , also named resistance distance, provide a metric with a means of estimating effective communication distances between residues υi and υj for the mean-square distance travelled by a random walk.

 <dig>  the methods are different. our work is most related to coifman's work  <cit> , and the diffusion distance is based on the eigenvalue decomposition of the markov transition matrix. however the commute times are derived from the graph laplacian  <cit> .

the central idea of our work is a combination of diffusion distance with inner distance. as we argued before in  <cit> , the inner distance as a shape descriptor, is more appropriate for flexible molecular shape comparison. and by combing the inner distance and diffusion distance, we can define a new diffusion distance metric which can be considered as an average length of paths connecting two landmark points on the 3d shape in a sense of inner distances , this can help resolving the topology sensitivity problem for molecular shape deformation.

3d zernike moments
more recently, grandison et al.  <cit>  proposed the use of 3d zernike moments to compare molecular shapes. in contrast to the previous work  <cit> , which used 3d zernike moments for comparing the shapes of ligands and proteins, the enhanced method in  <cit>  shows that not only molecular shapes but also that functions in 3d space can be represented and compared using this 3d zernike technique. in particular, they explored the use of atomic displacement parameters and the diffraction precision index to build a 3d flexibility map of proteins and presented a novel approach to capture this information using 3d zernike moments.

one appealing advantage in  <cit>  is to capture the varying degrees of flexibility within molecules, especially protein structures. their approach works well for small conformational changes in proteins, but performs poorly for large domain movements during protein deformation. the reason is that the flexibility map of proteins with small movements can be captured using 3d zernike moments, but large motion results in missing density map  <cit> .

in contrast, our method based on inner distance and diffusion distance can deal with the comparison between molecules even with large conformational changes. one of the limitations of our implementation is that it only utilizes geometry information of molecular shapes. nonetheless other chemistry features, including atomic displacement parameters and the diffraction precision index used in grandison et al.'s work  <cit> , might be explored in the future. we will discuss the potential application later.

laplace-beltrami operator
in  <cit> , rustamov introduced a deformation invariant representation of surfaces, namely the gps embedding, using the eigenvalues and eigenfunctions of the laplace-beltrami differential operator. the gps representation embeds a surface into a high dimensional space, compared to geodesic multidimensional scaling  embedding  in  <cit> , without using explicit geodesic distances. the gps embedding provides a tool for processing of nonrigid shapes matching, in particular to local topology changes that is the same goal to our purpose. to demonstrate the application of shape matching, rustamov first computed the gps embedding of a given surface, and then found the d <dig> shape distribution in the embedding surface. note that d <dig> shape distribution is the histogram of pairwise distances between the points uniformly sampled from the surface. in the way similar to rustamov's method, our method also embeds a shape into a high dimensional space based on diffusion map, and find the d <dig> shape distribution in the embedding shape.

although the core procedures  between our method and rustamov's method are similar, the embedding step in our method is different. in rustamov's method, the gps distance between two sample points can be considered as a particular diffusion distance in a sense of geodesic distances without explicit computation of geodesic distances. bronstein et al.  <cit>  have shown the relation between rustamov's method and diffusion distances. it is worthwhile to emphasize our differences. the diffusion distance in our work is considered as an average length of paths connecting two landmark points on the molecular shape in a sense of inner distances.

our argument for choosing inner distance  instead of geodesic distance  is that, like id, gd is invariant to shape articulation deformation, but it is also invariant to a broader classes of deformation  which preserves geodesic metric. the shape can be bent drastically and ends up with significant structural changes. therefore, gd is weak in discriminating power for handling molecular shapes. on the other hand, id is more appropriate since it reflects the essential invariant property for 3d shape articulation deformation. meanwhile, id is also sensitive to concavity/convexity changes of molecular shapes. this makes id superior to gd as a flexible molecular shape representation. although gd is insensitive to surface stretching or tearing, it remains invariant to all inelastic deformations as long as the deformation preserves geodesic  on the object boundary. from our experiments we also found that some molecules with one domain are often judged as similar to some ones with two or three domains when using gd descriptors. in the molecule database, gd can not give good search results as well as compared to ed.

interior distance
it is worth noting that rustamov et al.  <cit>  more recently proposed the interior distance that is an interpolation of boundary distance in terms of two points inside the 3d shape. the interior distance is dependent on the choosing of metric for pairwise boundary distance and it propagates the boundary distance into inside using barycentric coordinate. the pairwise boundary distance can be geodesic distance, diffusion distance or even inner distance discussed in  <cit> .

applications of molecular shape comparison
molecular shape comparison  are playing an increasingly important role in a lot of biological activities, and ddsd presented in this paper can contribute to several future applications. one application is to search molecular databases for computer-aided drug design  <cit> . its main goal is to identify compounds that are complementary to the site in molecular shape. an alternative technique for mining the information contained in these databases is msc, which consists of searching the molecular database for compounds that most closely resemble the shape of a given query molecule. some rigid msc methods have been presented for this purpose  <cit> . for instance, zauhar et al.  <cit>  proposed a shape signature method for searching the tripos fragment database and the nci database. ballester et al.  <cit>  applied their fast msc method to retrieve several compound databases, including the vendor database and an independent benchmark from drugbank. however the molecular databases may include some information about the flexibility of the molecule with its possible conformations, the traditional rigid methods can not capture the shape similarity of flexible molecules well. the presented ddsd method may directly replace the existing rigid methods for search the molecular databases.

another application is protein structure retrieval. there have been many protein structural comparison methods presented by computing the similarity scores, but most of them are based on protein structure alignment, such as dali and ce. we recently presented a structural comparison method of flexible proteins using a robust statistics technique  <cit> . in contrast, the work in this paper can be applied to a search for similar protein structures. the main advantage is that the shape-based protein searching method does not produce any alignment between two proteins . the third application may be in cryo-electron microscopy , where sheer shape comparison is important for example in discovery of high resolution structural homologues from cryo-em maps  <cit> . the presented msc method can overcome the different resolutions by considering both the geometrical shape and flexibility. for more explanation, the reader can refer to  <cit> .

limitations
one of the limitations of our method is that it only utilizes geometry information of molecular shapes. nonetheless chemistry features are also useful for matching as in protein-protein or protein-ligand  docking/design. the option of including chemistry will reduce the number of false positive solutions and lead to better ranking. one possible solution is to combine other characteristics of a molecular surface into the ddsd computation. for instance, we can incorporate electrostatic potentials into the diffusion distance descriptor by considering a high dimensional sample point coordinate. in particular, we can describe a molecular boundary surface by a set of four-dimensional  points {qi = }, where xi, yi, and zi denote three geometry coordinates and ci is the corresponding charge value. the inner distance can be computed as the length of the shortest path between two  <dig> d points, so the diffusion distance can be considered as an average length of paths connecting two  <dig> d points on the molecular shape in a sense of inner distances. we plan to consider more chemical features into our descriptor in the future.

CONCLUSIONS
in this paper, we describe a novel method, named ddsd, for molecular shape comparison . it is based on diffusion distances that is an average length of paths connecting two landmark points on the molecular shape in a sense of inner distances. the new method does not require previous alignment of the molecules being compared. we show that the new method is robust to deformation of flexible molecules, in particular to topological changes. in contrast, most existing msc methods are effective for only comparing rigid objects and they can not capture well shape deformation of flexible molecules. we have evaluated and demonstrated the effectiveness of our method within a molecular search engine application for a benchmark on molmovdb. our method achieves good performance and retrieval results for different classes of flexible molecules. furthermore, several potential applications for ddsd were discussed by replacing the conventional rigid shape descriptors.

we finally summarize the central idea of our work in this paper. essentially our work is an improvement of inner distance with the additional step of calculating the diffusion distance and utilizing it as a descriptor instead of the inner distance. the merit of this article comes from the fact that this descriptor is an improvement over the inner distance, especially in the cases where structural topological changes.

the work in this paper only considers the problem of flexible molecular shape comparison using diffusion distance shape descriptor. however it is of interest to address the bigger question of to what degree molecular flexibility is involved in protein structural-functional relationships based on the retrieval results, and we leave this application to for our future work.

authors' contributions
yl generated the original idea, executed the research, and wrote the manuscript. ql implemented the idea, and gz participated in the research. kr identified the underlying opportunity and basis for connecting diffusion to shape analysis. wb helped yl with the understanding of diffusion maps. all authors read and approved the final manuscript.

