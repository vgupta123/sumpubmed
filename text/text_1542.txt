BACKGROUND
protein dynamics plays a central role in cell life. in many cases biological function involves molecular motion  <cit>  and it was recently suggested that intrinsic dynamics also defines the ability of proteins to adapt and evolve new functions  <cit> . therefore, a full understanding of protein function and evolution will require a deeper insight into biomolecular atomistic dynamics.

significant contributions in this direction have come from computational methods, in particular from molecular dynamics  simulations  <cit> , by which a large ensemble of molecular structures can be generated to sample the accessible conformational space of a protein. analysis of this ensemble can provide information about average physico-chemical and geometrical properties, as well as allowing identification of recurring conformations and transitions between them.

as recurrence of and transition between conformations is difficult to extract from the raw ensemble data  <cit> , grouping the conformations becomes a necessity. the most desirable strategy would be to use kinetic clustering  <cit>  where conformations are grouped according to their transition probabilities during the simulation and identified clusters are directly related to the free energy landscape. a limitation to this approach arises from the need of an exhaustive sampling with convergence of all pair-wise transition probabilities  <cit> . a more affordable solution is to use geometrical clustering, because only a representative sampling of the accessible conformations is required. the underlying assumption is that structurally similar conformations lie in the same basin of the free energy surface. while often this is an acceptable approximation, a recent study has suggested caution in interpreting the clustering results  <cit> .

geometrical clustering for conformational analysis was introduced when simulation time increased up to nanoseconds generating tens of thousands of structures  <cit>  and has been extensively used since then  <cit> . several data-mining algorithms have been adopted but according to a recent survey  <cit>  no general strategy is available: clustering results are often influenced by the type of algorithm and the choice of optimal parameters is mostly left to user experience and the specific case. originally adapted to analyse protein folding simulations  <cit> , these algorithms have mainly been implemented for multiple trajectories of the same system. however, recently a great interest has emerged in the comparison of protein flexibility of functionally related proteins as well as in studying the evolutionary conservation and specialization of protein dynamics across distant homologous proteins  <cit> . this new interest emphasises the need for more advanced tools to compare conformational ensembles of different protein domains especially when derived from extensive md simulations  <cit> .

among the data-mining algorithms, self-organising maps   <cit>  were recently applied to conformational analysis of lipid molecules  <cit>  and automatic clustering of protein-ligand docking poses  <cit> . in the context of md analysis, a recent study  <cit>  compared several methods, including soms and traditional clustering algorithms. while the soms were identified among the best performing methods, no algorithm emerged as the optimal solution.

in this contribution, we present the use of a two-level approach  <cit>  combining soms and hierarchical clustering  <cit>  for the analysis and comparison of multiple md trajectories of a protein domain. first we illustrate the protocol we developed to characterize and optimize the parameters of the som learning process for structural ensembles. then we present the application of the proposed two-level approach, with the optimized parameters, to the conformational and functional analysis of a test case composed of the α-spectrin sh <dig>  protein domain and a group of its single-site mutants. this is an interesting study case of a small intra-cellular signaling domain  <cit>  where ligand binding activity is modulated by single-mutations greatly affecting the conformational dynamics  <cit> . this test demonstrated the potential of the proposed approach in the analysis of large ensembles of molecular structures: the possibility of producing a topological mapping of the conformational space embedded in a simple 2d visualisation, given by the som stage, as well as the capability of effectively highlighting differences in the conformational dynamics directly related to biological functions, given by the combination of soms and the post-clustering stage.

methods
conformational sampling and ensemble generation
molecular dynamics simulations
the atomistic dynamics of the set of representative proteins was simulated using the gromacs package   <cit>  with the gromos <dig> 43a <dig> force field. all structures were inserted into an octahedral box with explicit solvent and simulated with periodic boundary conditions. water molecules were described by a simple point charge  model  <cit>  and the box size was set to ensure a distance of at least  <dig>  nm between the protein and the box boundaries. the solvent was relaxed with a  <dig> ps md simulation, then the systems were neutralized by insertion of counter ions, and a short minimization with steepest descent was performed up to convergence on maximum force lower than  <dig> kj/. the resulting systems were simulated for  <dig> ns in the npt ensemble . long-range electrostatic interactions were calculated with the particle mesh ewald  summation method  <cit> , with a  <dig> Å cut-off for the direct space s ums, a  <dig>  Å fft grid spacing and a 4-order interpolation polynomial for the reciprocal space sums. a thermal bath was independently coupled with protein and solvent using a berendsen thermostat at  <dig> k with coupling period of  <dig>  ps. the internal degrees of freedom of water were constrained by the settle algorithm  <cit> , while all bond distances in the protein were constrained by the lincs algorithm  <cit> . the integration step was set to  <dig> fs.

to evaluate the sampling efficiency the overlap between the conformational spaces spanned by different parts of the simulation  <cit>  was calculated. in general, the overlap between two matrices a and b, s, can be defined as:   

where tr is the trace of the matrix. when s is equal to  <dig>  the two spanned subspaces are identical, whereas a value of  <dig> indicates complete orthogonality. in this work, the overlap between the covariance matrix of the atomic coordinates in each half of a simulation and in the overall trajectory  <cit>  was evaluated for each protein.

analysis of conformational flexibility
protein flexibility was calculated on a residue basis using the root mean square fluctuation  of the positions of the cα atoms. the rmsf of the cα atom i measures its deviation from the time-averaged position during the simulation:   

where ri is the coordinate vector for atom i and the < > indicates a time-averaging. to increase the signal/noise ratio, the rmsf calculation was performed after essential dynamics  analysis. ed is a widely applied technique based on principal component analysis  of conformational ensembles  <cit> , aimed to extract informative directions of motion. only cα atoms were included in the analysis  <cit> .

the geometry of the protein binding site was described by a selected set of pair-wise atomic distances and its conformational changes were measured by distance root mean square deviation , i.e. the rmsd between these atomic distances in a selected conformation, a, and the same distances in a reference structure, b:   

where d is the distance value, i and j are the indices of the selected atoms and n is the total number of computed distances.

optimization of the self-organising maps for structural ensemble analysis
in the proposed approach the som input data are large ensembles of conformations extracted from the md trajectories of one or more domains. each conformation is described by the cartesian coordinates of the cα atoms of the protein, after projection of the original data on the eigenvectors that define the essential space. at the end of the som training process  the original conformational ensemble ends up projected on a bi-dimensional feature map where similar elements are associated to neighbour neurons. therefore the whole input space is described by a limited number of vectors . these are then submitted to linkage clustering and the representative conformations are extracted for conformational and functional analysis.

a optimization of the som parameters for the specific type of data is required. the optimization we designed and performed consists of two steps: first, the som parameters were characterized and optimized by experimental design to obtain the optimal som and then these were used to select the optimal sampling rate of the md trajectory.

a diagram of the overall approach, including the optimization steps performed in this work, is shown in figure  <dig>  in the following we report: a brief conceptual introduction to soms, a detailed description of each step of our optimization protocol, and the approach we propose for clustering.

brief introduction to soms
a som is a powerful tool for the grouping and visualization of high-dimensional data. it is a specific architecture of artificial neural networks consisting of a low-dimensional  grid of so-called neurons, called map  <cit> . the number of neurons may vary from few units up to thousands and each neuron is represented by a d-dimensional model vector , where d is the dimension of the input data vectors . the neurons are connected to adjacent neurons by a neighborhood relation, which dictates the topology of the som map.

the som learning algorithm could be divided into five steps: a) initial randomization of each prototype vector; b) random selection of an input vector; c) neurons "competition" to "win" the input vector; d) update of the prototype vector of the "winning" neuron and of its topological neighbors by pulling them closer to the "won" input vector; e) repeat from b) for each input vector for a given number of epochs sufficient to ensure a convergent training of the map. as a result, the prototype vector of each output neuron represents a particular feature  drawn from the input space  <cit> .

a useful tool to analyse the results is a pictorial representation of the trained map. in this work we choose a topographic map where each neuron is represented by an hexagon. to visualize the number of input data won by each neuron , black hexagons with size proportional to the neuron population were superimposed to the map. visual inspection of the map allows the analysis of the final distribution of the original data: neighbor neurons  are associated to similar groups of input data ; map regions with highly-populated neurons represent conformations highly sampled during the trajectory.

the main interpretational advantage over hierarchical clustering is that maps are more easily understood and interpreted by humans than dendrograms, which become already very complex in the case of a few hundred data points.

in this work, the analysis was performed using the som toolbox in matlab  <cit> , but in principle it can be reproduced using other statistical packages, such as r  <cit> . the calculations were performed on an amd opteron  <dig>  <dig>  ghz.

experimental design and map optimization
the result of a som learning process depends on a set of parameters and the problem of finding the optimal som, i.e. the som model which "best characterizes" the underlying input space structure, can be extremely complex. the goal is first to discover the parameters that significantly affect the performance of the som model, and then to find the values of such parameters that define the optimal som. unfortunately this is an ill-posed optimization problem  <cit> , so several efforts have been made to provide an efficient and effective solution  <cit> .

in this work, to reliably represent how well the som model captures the relevant features of the input space, the following performance measure, i.e. index of clustering efficiency, was used:   

where d represents euclidean distance, j and cj are the jth cluster of neurons and the corresponding set of neurons, wij is the weight vector associated with the ith neuron of the jth cluster, μj and μ are the centroid of the jth cluster and of the overall map. the performance measure  is a modification of the clustering efficiency index described in  <cit>  where  measures the average cluster tightness while measures the separation of centroids. however, the term  scales with the number of output neurons and thus it was normalized through rtot to account for different som sizes. the performance measure  has a unique minimum and was successful against expert-based assessment of clustering  <cit> .

the problem of finding the optimal value of the performance measure is computationally expensive and artificial neural networks are generally affected by the curse of dimensionality. this problem can be solved following different strategies  <cit> , among which design of experiments or experimental design  <cit>  was selected in this study. in this technique the experiments are designed to have rational relationships to the purposes, needs and physical limitations of the problem. variables and their values are tested in combinations that ensure to answer the questions of interest as clearly and efficiently as possible. this offers advantages in the economy of the experimentation and provides straightforward estimates of experimental effects and variance  <cit> . in the present study a set of som models with different values of the parameters were selected according to an experimental design plan and the output was used to identify the som's most influential parameters and thus to select the optimal som model .

consistent with previous reports  <cit>  the following som parameters were optimized: map size, learning algorithm, neighbourhood function, lattice type, shape, alpha type, radius, training length and initial value of the parameter alpha . the ranges of tested values are reported in table  <dig>  a commonly used rule to select the map size is based on the dimension of the input data vectors and an estimate of the training data variance   <cit> . instead of testing only this value , a range of map sizes was considered for the optimization .

map size , lattice type, and shape define the topological characteristics of the map. the other parameters are associated to the learning process: learning algorithm, neighbour function, alpha type, radius , training length , starting alpha .

the particular nature of the parameters does not allow the use of either the widely used d-optimality or g-optimality design criteria. instead, a taguchi robust design plan  <cit>  was used, including  <dig> runs with  <dig> replicas each. the design plan is reported in table  <dig> 

map
see table  <dig> for the parameter definition.

the results of the numerical experiments associated with the design plan are used to find a linear regression model of the performance measure  as function of the som's statistically significant parameters. the linear regression is performed in two stages: a stepwise regression  <cit>  to select the statistically significant parameters and a linear regression fitting only on these to actually model the unknown mapping between them and the performance measure . stepwise regression parameters were: prob to enter =  <dig> , prob to leave =  <dig>  and direction = mixed and rules = no rules. the linear regression model is validated by comparing actual and predicted performance. jmp software was used for data analysis and linear regression fitting  <cit> . on the basis of this model the optimal values of the som parameters were derived.

optimal sampling rate of md trajectories
when dealing with a nanoseconds md trajectory, it is desirable to train the som with a minimum number of selected structures while maintaining a reliable picture of the protein dynamics. therefore, the effect of the sampling rate on the som learning process was assessed and the minimum number of frames to extract from a trajectory, without a statistically significant loss of information, was identified.

the rationale of the statistical procedure, applied to discover the "minimum number of frames" , is as follows: if the traini ng data set q is representative of the original data set q, then the som model som, learnt by using the training data set q, when queried with data sets q and q must provide som hit distributions which are not statistically different.

in this study such a test was performed on three replicas by randomly selecting n conformations of the trajectory, each belonging to one of n equal width trajectory intervals. to better clarify the statistical procedure, let qi be the ith random sample extracted from q and somi be the corresponding som trained on it by using the optimal parameters determined by experimental design. furthermore, let hi and hi be the som hit vectors in the case where qi and q are presented to somi. then, the χi chi-square statistic is computed on non-null cells of the som hit vectors hi and hi while the null hypothesis is tested by the n cressie-read chi-square test where the significance level has been set to α =  <dig>   <cit> . a diagram of the overall procedure is shown in figure  <dig> 

cluster analysis of the som prototype vectors
the optimal som resulting from the previous optimization steps summarizes the conformational variability in the input data  through a set of prototype vectors. the next step of our approach consists on combining the prototype vectors  in a reduced number of final clusters, where each original conformation belongs to the same cluster as its nearest prototype. to this end, two hierarchical agglomerative clustering algorithms, the complete linkage and the average linkage, were tested, following what described in  <cit> .

several clustering quality measures and stopping rules have been proposed to select the "optimal" number of clusters. some of them were empirically shown to be more reliable  <cit>  but there is no a universally accepted measure or rule. in this work the mojena's stopping rule  <cit>  was used for the following main reasons: it was placed in the set of the best performing stopping rules  <cit> , especially when the number of clusters is not too big; it determines when a significant change from one stage to the next implies a partition which should not be undertaken; and it is computationally rather simple. however, other stopping rules and measures could have been fruitfully used among the first ten ranked in  <cit> . the mojena's rule is simple and effective: the distances di between the progressively merged clusters are recorded in order; from this set of distances, mean and standard deviation are calculated; the optimal number of clusters is equal to the largest k satisfying the following inequality:   

where sdd is the standard deviation,  is the mean, and z is a specified constant.

a range of values for z were tested:  <dig> ,  <dig> ,  <dig> ,  <dig> ,  <dig> ,  <dig> , and  <dig>  for both complete and average linkage. different values of the optimal number of clusters were obtained: from  <dig> to  <dig> for the complete linkage and from  <dig> to  <dig> for the average linkage. the most informative cluster separation was obtained with complete linkage and z =  <dig> , and with average linkage and z =  <dig> , which agrees with that suggested in  <cit> .

the stability and better performance of the proposed two-level approach, i.e. som and linkage, with respect to other clustering methods, as well as the relative performances of the complete vs. average linkage algorithms were verified by the analysis reported in the methods and results sections on "comparison of cluster analysis methods".

hierarchical clustering was performed using the matlab statistics toolbox  <cit>  and the mojena's rule was applied in its matlab implementation, made available by courtesy of prof. fernández http://ima.udg.edu/~jamf/martin_mf.htm.

comparison of cluster analysis methods
the proposed two-level approach for clustering structural ensembles  was compared with other clustering methods applied to the original input data vectors: gromos nearest neighbour  <cit> , average and complete linkage methods  <cit> . gromos algorithm is implemented in the gromacs package  <cit> : neighbours of each data point are defined according to a cutoff distance c; the point with largest neighbourhood defines the first cluster medoid; this point and its neighbours are removed and the algorithm is iterated until all data have been assigned to a cluster.

the quality of the clustering was assessed by the silhouette  index  <cit>  and the davies-bouldin  index  <cit> . the two indices score the compactness and separations of the clusters, and were previously used in similar studies  <cit> . the s index can also be calculated per data point or cluster. its value is in the range  and is generally interpreted as evidence in support of the cluster structure  <cit> : strong , reasonable , weak  or no significant evidence . the db is a measure of relative scattering of the data points. a lower value of db indicates more compact and separated clusters.

the performance of the methods was compared for the number of clusters ranging from  <dig> to  <dig>  in the case of gromos algorithm, solutions were generated for c ranging from  <dig>  to  <dig>  with increments of  <dig> . then the best solution for each number of clusters was selected according to the relevant quality index.

RESULTS
molecular dynamics of the sh <dig> domain
the test case selected for our analysis is composed of the α-spectrin sh <dig>  domain and a group of its single-site mutants. the crystal structure of the wild-type domain   <cit>  is characterized by two β-sheets, a short  <dig> helix, and three connecting loops: the long rt loop that includes three isolated β-bridges, the n-src and the distal loop . the spc-sh <dig> domain binds the proline-rich decapeptide apsysppppp   <cit> . the complex of the structurally similar r21a mutant with p <dig>  <cit>  reproduces the typical features of the sh <dig> domains' binding  <cit> , and the specificity pocket is formed by residues in the rt and n-src loops, and in the β <dig> strand . several studies demonstrated that the conformational dynamics of these loops plays an important role in defining the binding specificity of the sh <dig> domains  <cit> .

the six mutants of the spc-sh <dig> domain analysed here  are: r21a, r21g, a56g and a56s   <cit> , n47a and n47g   <cit> . these mutants had been designed to explore how the local perturbations produced by single-point mutations affect both the stability and the p <dig> affinity of the domain  <cit> .

in particular, it was observed that mutation of r <dig>  at the tip of the rt loop that flanks the binding specificity pocket , to alanine had favourable effects on the p <dig> affinity, probably due to the replacement of the bulky arginine side chain by a small side chain. on the contrary, a slight reduction in affinity was observed for the r21g mutant. both mutations of n <dig>  in the distal loop , produced significant changes in the stability of the domain and a reduction of p <dig> affinity. finally, while mutation of a <dig>  in the  <dig> helix belonging to one of the hydrophobic binding grooves , to ser did not alter significantly the p <dig> affinity, the mutation to gly produced a great reduction in affinity.

the conformational dynamics of the wild type structure and the six mutated spc-sh <dig> domains were analysed by  <dig> ns md simulations . analysis of the root mean square distance  to the starting structure confirmed a general stability of all trajectories, with an equilibration time around  <dig> ns  and a temperature around  <dig> k during the simulation. the covariance matrix overlap between the conformational spaces spanned by the two halves of the simulation and the overall trajectory for all the sh <dig> systems  shows values in the range  <dig>  -  <dig> , confirming that the conformational subspaces explored in each half are representative of the complete space. similar values were previously reported in cases of satisfactory sampling  <cit> .

the most informative directions of motion were extracted by essential dynamics analysis. analysis of the fraction of total motion described by different subspaces  indicates that in all cases more than 79% is described by the first  <dig> eigendirections , while the first  <dig> directions  can explain more than 85%  of the conformational flexibility of all domains. therefore, the  <dig> dimensional essential space of each system was selected for the following analyses. in this way, the noise given by not informative high-frequency motion was removed.

the choice of projecting the trajectories in the essential space led to an increased signal to noise ratio in the plots of the rmsf on the positions of the cα atoms . a set of comparative rmsf plots is shown in additional file 4: the wt sh <dig> structure is rather constrained, with only a region of flexibility in the n-src and the distal loops , while the effects of single-point mutations in each of the three positions, r <dig>  n <dig> and a <dig> , can be clearly observed. while r21a mutation does not affect the overall domain flexibility, the r21g mutation causes a relevant increase of flexibility in the long rt loop and in the region including β <dig>  the distal loop, β <dig> and the helix  <dig> . these differences suggest that flexibility may have a role in the different binding affinities of the two mutants, that could not be explained only on the basis of the very similar stereo-electronic characteristics of their binding sites  <cit> . the mutation to ala at position  <dig> has little effect on the flexibility, while a change to gly in the same position causes an increased flexibility in the surrounding region as well as in the whole rt loop . this confirms the hypothesis of a long-range propagation of the local perturbation to the binding site, that may have a role in the n47g binding to p <dig>  <cit> . different from previous cases, a mutation to gly in position  <dig>  in the  <dig> helix, does not alter either the local or the global flexibility of the domain; an increase of flexibility in the distal loop region is observed for the a56s mutant . from these results, the conformational freedom of these two mutants does not seem to be related to the p <dig> binding affinity  <cit> .

som optimization to analyse the sh <dig> domain dynamics
following the protocol described in the methods section, a som was optimized for the analysis of the md trajectories of the wt sh <dig> and its six mutants. each sampled conformation was described by the cartesian coordinates of the cα atoms projected on the essential space. the  <dig> cα atoms corresponding to structurally equivalent positions in all the domains were included in the analysis; therefore, the input data presented to the som were vectors of  <dig> elements.

the optimal values for the som parameters were found by experimental design using a taguchi design plan  which consists of  <dig> runs. each run was replicated three times on four data sets:

○ wt

○ r21g

○ wt and r21g

○ all ,

thus resulting in a total of  <dig> experiments. the choice of multiple and combined data sets aimed at optimizing the map both for the analysis of a single trajectory and for multiple comparisons of different trajectories.

the response variable was the minimum normalized distance defined in equation . the summary of the linear regression model and the significance analysis of the single som parameters are reported in table  <dig> and 4: the regression model is satisfactory, with similar values of r <dig> and r2adj . the following som parameters have been judged to be statistically significant at the p-value cut-off of  <dig> : map size, radius, training length, neighbour function and typemol , the latter being a categorical variable, which can take the following values: wt, r21g, wt+r21g and all. it is worthwhile to mention that such parameters are statistically significant for all the values of the categorical variable typemol. furthermore, the optimal setting of the som parameters, for each value of the categorical variable typemol, is the same: map size =  <dig>  radius =  <dig>  training length =  <dig> and neighbour function = gaussian. table  <dig> reports the results of a validation test on the regression model . the difference between the predicted and the actual optimal values is small, confirming that the regression model can reliably predict the value of the performance measure  as a function of the statistically significant som parameters.

see table  <dig> for the parameter definition.

see table  <dig> for the parameter definition.

the som optimization was performed on conformations sampled with a rate of 1/ <dig> ps, randomly selecting a structure in each interval of  <dig> ps to avoid a correlation bias. this initial choice was validated and confirmed a posteriori in a test on the impact of different sampling rates . the analysis was performed with three replicas for each sampling rate: 1/ <dig> ps, 1/ <dig> ps, 1/ <dig> ps, 1/ <dig> ps, 1/ <dig> ps, 1/ <dig> ps, 1/ <dig> ps, 1/ <dig> ps and 1/ <dig> ps :  <dig>   <dig>   <dig>   <dig>   <dig>   <dig>   <dig>   <dig>  and  <dig> conformations. the results for a test set composed by wt, r21g and n47a, are reported in table  <dig> showing that the null hypothesis is not rejected for samples larger than  <dig> conformations. thus, at a rate of 1/ <dig> ps or greater the results of the som analysis are not influenced by the sampling rate.

k =  <dig> and α =  <dig> . statistic, p-value and the output of the hypothesis test are reported;  means that the null hypothesis cannot be rejected while  means that the null hypothesis has been rejected.

comparison of cluster analysis methods
the two-level approach was compared with three cluster analysis methods: gromos  <cit> , average linkage and complete linkage. the tests were performed on the all  data set and assessed by the silhouette   <cit>  and davies-bouldin  indices  <cit>  . the results are reported in figure  <dig> 

the two-level approach proposed in this work  is the best performing: the s  scores are generally higher  for all the number of clusters and the profiles are more stable. this suggests that the som preclustering is reducing the noise and generating more compact and well separated clusters. this is also confirmed by the per-cluster values of s . according to s, only the two-level approach shows reasonable evidence of correct cluster structure  for most values of the number of clusters range.

while from the analysis of the two global s and db indices both the linkage methods appear to be good choices for our two-level approach, a more detailed analysis of the performances on the all dataset revealed some differences. in particular, the complete linkage provides clearer and better separated clusters for conformations related to the most characteristic motions of the domain exploited by specific mutants . accordingly, the complete linkage algorithm was used in association with som for conformational and functional analysis of the sh <dig> domains.

the s and db indices are often employed to identify the optimal number of clusters. in this case they show a rather even profile for the two-level approach, but it has to be noted that the significant values for the som and complete linkage approach range from  <dig> to  <dig>  this is compatible with the optimal value of  <dig> that was selected by the mojena's rule for the all dataset.

additional file  <dig> shows a 2d rmsd matrix of the conformations in the all data set, where the lower triangular part reports the best  <dig> cluster solutions with gromos. while the rmsd maps are powerful exploratory tools for single trajectories, they become increasingly complex when several simulations are reported. additionally the image shows a limitation of gromos nearest neighbour approach: a tendency to generate singletons. this is also a frequent event in single linkage clustering  <cit>  that for this reason was not included in the test.

conformational and functional analysis of the sh <dig> domains by som and complete linkage clustering
the proposed approach  with the som parameters and the sampling rate values set in the optimization stage was used to perform a conformational analysis of the md trajectories of single sh <dig> domains independently as well as groups of simulations to detect similarities and differences in flexibilities among the systems. we will present the results for the following ensembles: r21g, wt and r21g, wt and six mutants.

the map of the r21g ensemble is shown in figure  <dig> as an example of analysis of a single trajectory. as described in the methods section, first, the som learning process produces neuron prototype vectors that are made similar to the input conformations "won" during this phase , second, prototype vectors are subjected to hierarchical clustering. therefore, it is possible to extract information at three different levels: neuron level, i.e. the ensemble of hit conformations in a neuron; cluster level, i.e. the ensemble of hit conformations closest to the prototype vectors in a cluster; centroid level, i.e. the hit conformation closest to the cluster centroid. four clusters  were extracted applying the mojena's rule after complete linkage clustering and they are represented at both the cluster and the centroid levels in figure 5c. all the extracted conformations are superimposed to the x-ray structure of the wt sh <dig>  taken as reference. cluster  <dig>  contains a large group of representative conformations with limited fluctuations mostly localised in the n-src loop. clusters  <dig>  describes a small displacement of the distal loop towards the rt loop, while cluster  <dig>  comprises conformations with a more extended motion of the same loop, a consequent perturbation of the n-src loop, and a motion of the rt loop tip back towards the distal loop. conformations in cluster  <dig>  greatly deviate from the wt structure, with a concerted closure motion of the distal and rt loops.

four clusters of neurons were extracted from the map trained on the wt and r21g sets of conformations. a table of cluster compositions is reported, along with the map, in figure 6a and the representative conformation of each cluster  is shown in figure 6b. the wt ensemble, characterized by low fluctuations, contributes to 78% of cluster  <dig>  that includes conformations similar to its equilibrium structure, and part of cluster  <dig>  whose conformations present small fluctuations in the distal and n-src loops. on the contrary, cluster  <dig> and  <dig> are almost exclusively populated by conformations from the r21g trajectory. cluster  <dig> describes more extended fluctuations in the distal and n-src loops and in part of the rt loop, and cluster  <dig> large concerted motions in the distal and the faced rt loop.

the som obtained through learning from the whole set of ensembles and the resulting five clusters are shown in figure  <dig> at the centroid level. the representative conformations of cluster  <dig> and  <dig>  closely resemble those of cluster  <dig>  and  <dig>  also observed in the som of wt and r21g . clusters  <dig>   <dig> and  <dig> describe intermediate situations. while cluster  <dig> describes a moderate flexibility of the distal loop and cluster  <dig> a large flexibility of the same loop associated with perturbation of the n-src and the rt loops, cluster  <dig> describes a perturbation distributed to the whole domain. for cluster  <dig>  the presence of low populated or empty neurons in the neighbourhood of cluster  <dig> highlights its role in effectively separating clusters  <dig> and  <dig> from cluster  <dig>  the inspection of the per-cluster values of the silhouette index  confirms this role: while strong cluster structure is evidenced for clusters  <dig>   <dig> and  <dig> , a very low value  is associated to cluster  <dig> . the ability of the complete linkage algorithm to clearly separate clusters describing the most characteristic motions of the domain  confirmed the choice of using this method in association with soms.

to complement and confirm this analysis, the drmsd  between the distances of four selected points in the average conformation of each cluster and in the x-ray structure of the wt sh <dig> was calculated. the selected points  are the cα atoms of a constrained residue at the n-term of the rt loop , and three residues in the most flexible regions of the protein . both the visual analysis of the inter-point distances in figure  <dig> and the abcd drmsd values  indicate that clusters  <dig> and  <dig> slightly deviate from the wt structure, where clusters  <dig> and  <dig> have more relevant deformations  and cluster  <dig> departs more than  <dig> Å from the wt structure. in detail deformations in the average structure of cluster  <dig> mainly affect the distal and n-src loops' distances , while in clusters  <dig> and  <dig> the distances of the rt loop from both the other loops and the reference point a  depart from the wt geometry.

the drmsd are calculated as the average distance of the selected points in the conformational ensemble of each cluster and the same distance in the wt sh <dig> structure.

a closer look at the cluster composition shows the ability of the som to group conformations common to all domains, as well as to correctly separate the typical dynamics of each of the three domains with higher flexibility. the contributions of each mutant ensemble to the five clusters  highlights that clusters  <dig> and  <dig> are populated by conformations from all the mutants. the larger contributions to cluster  <dig> are from the wt sh <dig> and the mutants with reduced conformational flexibility , while cluster  <dig> is more representative of r21g and n47g ensembles. each of the remaining three clusters is dominated by one contribution: cluster  <dig> mainly by a56s, cluster  <dig> by n47g and cluster  <dig> is almost completely populated by conformations from the r21g ensemble.

an interesting feature arises from the topological nature of the som. conformational transitions that occur in consecutive times along the md trajectory involve conformations assigned to neighbour clusters on the map. an example for three trajectories is reported in additional file  <dig> where the obtained clusters are annotated on the rmsd plots by colours. in the first part of the wt rmsd plot, frequent transitions occur between conformations in the green and blue clusters that are neighbours in the som. more clearly, in the a56s plot, transitions between conformations in the green and yellow clusters  always occur in the trajectory through sampling of conformations in the violet cluster. in the r21g plot, while some transitions occur between conformations in neighbour clusters , others  are separated by the violet cluster in the map and occur only through brief sampling of conformations of this type.

previous studies suggested a hypothesis of the role of conformational flexibility in reducing the binding affinity  <cit> . to verify this we studied the effects of flexibility on the binding site geometry. as previously described, the binding pocket of the p <dig> peptide is flanked by the rt and n-src loops , whose dynamics affects the binding specificity. therefore, the inter-residue distances in the binding site of the sh3:p <dig> complex  in the representative conformation of each cluster were compared to those in the experimental structure. the drmsd values confirmed that the increase of conformational freedom induced by the n47g and r21g mutations  produces a significant distortion of the binding site geometry , while other mutations did not produce comparable effects . these results correlate well with the binding affinity data reported for the n47g and r21g mutants  <cit> . in fact, even if the site of the former mutation is distant from the binding site, a significant decrease in binding affinity is produced. moreover the r21g mutant that, on the basis of the favorable changes in the binding site stereo-electronic properties, was expected to give a significant increase in binding affinity to p <dig> , indeed produced a slight reduction in affinity.

discussion
we have presented a strategy to compare conformational ensembles of protein domains with the goal of highlighting similarities and differences in functional motions. this strategy uses soms, that have recently been shown to be suitable for the analysis of individual md trajectories  <cit> , but takes also advantage of a two-level approach  <cit>  where complete linkage clustering is performed on the som prototype vectors. to provide the users with optimal som parameters for this specific type of data, we developed a protocol by which we identified a small number of important parameters and calculated their optimal values .

when dealing with large data sets of conformations, a major issue is the computational cost of the analysis. a possible strategy to overcome this problem is to compare only the average geometrical properties of subgroups of data, for example the ensemble rmsf on atom positions. however in this analysis small fluctuations are difficult to detect, the direction of motion associated to each peak is not considered, and comparisons are only pair-wise. these limitations appeared clearly in our analysis of the rmsf profiles of the spc-sh <dig> domains. on the contrary, the proposed som approach retains high sensitivity, is able to differentiate motions with similar average fluctuation and is not restricted to pair-wise comparisons. a second strategy to reduce computational costs involves using geometrical clustering methods in a two-stage or sieved approach  <cit>  by initially clustering only part of the data and then in a second step by adding the missing ones into existing clusters. however, this can lead to the loss or distortion of the topological relations among the original data and eventually to a biased grouping, if the selection at the first stage is not representative. similarly during the som training, each data vector is compared only to the neuron vectors representing all the data already presented to the map, but the topological relations are intrinsically recorded and the representative geometries are dynamically updated avoiding a bias. this comes at increased computational cost in the training stage, but once a map is trained on a group of representative protein domains, it can be used for fast classification of conformational ensembles of similar systems.

in the proposed two-level approach, where complete linkage is applied on the som prototype vectors, the number of neurons identified by experimental design  allows the som model to optimally capture the relevant features of a large input space in a smaller set of prototype vectors. these can be interpreted as an intermediate topological reference , which allows efficient use of clustering algorithms to divide the prototypes into groups. the number of clusters has not to be specified in advance but it is identified only after hierarchical clustering on the prototype vectors by the mojena's stopping rule. this generates a significant reduction in computational time and in noise compared to the direct application of linkage algorithms to the input data  <cit> . this also differs significantly from the approach adopted in a previous study by other authors  <cit>  where only a som was used for clustering the original data and the number of clusters had to be selected in advance by the user, i.e. before the som learning takes place.

the results for the sh <dig> domains highlighted the specific advantages of a som in conformational and functional analysis. the major benefit is the possibility of providing a topological mapping of the conformational space embedded in a simple 2d visualisation that simplifies the identification of differences in the conformational dynamics . moreover, the map can adapt to record differences in both large and small fluctuations, as well as to group conformations associated with different directions of the same motion.

the proposed approach resulted in a very efficient comparison of multiple trajectories: low fluctuations, large concerted motions and intermediate dynamic perturbations were clearly and correctly detected . the comparison of inter-residue distances in the binding site  <cit>  among the cluster representative conformations led to a functional interpretation of the observed differences. the increase of conformational freedom induced by the n47g and r21g mutations induces a distortion of the binding site geometry that explains the decreased ligand binding ability, while other mutations do not produce comparable effects.

the comparison of the two-level approach to other clustering methods showed that adding a som preclustering stage has the benefit of reducing the noise and generating more compact and well separated clusters .

our approach can be reliably used on other study-cases. indeed, the number of statistically significant som parameters is small while their optimal values are expected to be suitable for conformational spaces with similar complexity, i.e. similar number of unique conformations sampled, to the sh <dig> study case. in particular, the optimal values of the three parameters associated with the som training process  are expected to generalize quite well. the map size parameter is more critical; the optimal value we found  allows the summarization of a great number of unique features, but it could be necessary to re-set it specifically for cases with a greater variance in the training data.

the approach presented here is independent from the method used to generate the structural ensemble and is reliable to describe both small and large differences. it is therefore suitable to also analyse combinations of ensembles from computational methods with a more extended sampling of the conformational space and from experiments .

the test-case presented here includes mutants of a single domain that can easily be aligned. a future development of this study is the identification of alternative representations of protein conformations that do not require the preliminary definition of structurally equivalent positions by structural alignment. this will allow an extension to the comparison of different domains, including distant homologous proteins.

CONCLUSIONS
the novel approach presented here to analyse conformational ensembles of protein domains resulted in a very efficient way of comparing multiple trajectories of the test case and analysing the role of conformational flexibility in modulating the domain function. the approach can easily be extended to other study cases. further applications may include the treatment of ensemble of conformations derived from other sources of dynamical data, and the use of a trained map to classify conformational ensembles of similar systems. future directions involve the extension of the approach to the comparison of protein flexibilities also for distant homologous proteins.

authors' contributions
df, ap and lb jointly conceived the study. df performed all calculations and data analysis. fs participated in the design and set up of the som protocol. ap and lb participated in the molecular dynamics studies and in the data analysis. df, ap, fs and lb wrote the manuscript.

supplementary material
additional file 1
plot of rmsd to the starting structure during the md simulations. the plots report, for all the systems, the rmsd values in the whole md trajectory and a snapshot of the first  <dig> ns, to highlight the equilibration time.

click here for file

 additional file 2
overlap of sampling in the md simulations of the sh <dig> domains. the values represent the overlap  between the conformational spaces spanned by each half of the simulation and that of the overall trajectory.

click here for file

 additional file 3
distribution of motion in different subspaces for each md simulation. values refer to the percentage of total space described by the eigenvectors.

click here for file

 additional file 4
plot of rmsf versus residue position in the essential space. md simulations of: a) wt sh3; b) r21a and r21g mutants, compared to the wt; c) n47g and n47a mutants, compared to the wt; d) a56g and a56s mutants, compared to the wt. only equivalent residues in the preliminary structure-based alignment are included and their numbering is modified according to the alignment. secondary structures are reported in the bottom part of each graph for reference; they are attributed according to the dssp program  and labelled following the nomenclature generally adopted for sh <dig> domains.

click here for file

 additional file 5
comparative silhouette plots. the panels report the cluster quality for average linkage, complete linkage and the corresponding two-level approach . in each panel silhouette profiles are plotted for the number of clusters ranging from  <dig> to  <dig>  a silhouette profile is composed by a bar for each identified cluster.

click here for file

 additional file 6
distance matrix and gromos clustering. the distance  matrix for the combined trajectories of the all data set is reported in the upper triangular part of the image. the cluster attribution generated by gromos for a number of clusters equal to five is reported in the lower triangular part.

click here for file

 additional file 7
plot of rmsd versus time during the md simulations. from top to bottom, md trajectories for the wt sh <dig>  a56s and r21g mutants. conformations attributed to the five clusters obtained from the som trained on the entire group of trajectories are coloured according to figure  <dig> 

click here for file

 acknowledgements
we like to thank a fornili, f fraternali, j kleinjung, m sadowski and jw saldanha for insightful discussions and critical revision of the manuscript. this research was supported by the national institutes of health , by a marie curie intra european fellowship within the 7th european community framework programme  and partially by the medical research council .
