BACKGROUND
in comparative dna microarray experiments compared test and control samples are labeled with different fluorescent dyes , mixed up and co-hybridized with the dna clones regularly spotted on the microarray. the array is scanned at a high spatial resolution at the corresponding fluorescent wavelengths, and the fluorescence intensities are recorded in two color channels  for each pixel. the ratio of the measured intensities  for each microarray spot reveals either differential gene expression  or change in dna copy numbers  technology  <cit> ) between the test and control samples for the corresponding gene. each ratio estimate should be accompanied by some measure of quality demonstrating the level confidence in the obtained ratios.

the main components of the microarray image analysis pipeline for spots include localization, quantification and quality control. among these, quality control is the least formalized and least developed. to determine spot quality we need to have a clear definition of a good spot, or a list of all possible distortions that may spoil the spot. the diversity of instrumental platforms and instrumental and biological factors that may influence the result makes formalization difficult and unlikely to be universal.

in this paper, we consider the problem of quantifying spot quality in comparative dna microarray experiments. several attempts have been made to approach the problem  <cit> . generally a number of parameters characterizing the spot, such as signal-to-noise ratio, size, circularity, etc., are introduced. these parameters have to be combined into an overall quality value to be used as a confidence level in the follow-up analysis. there are different methods for deriving such a parameter. for example, in two studies  <cit> , it was assumed that individual quality scores contribute equivalently to the composite quality score. this may not be true, depending on the instrumental setup and experimental design. therefore we need an approach that allows us to evaluate the weights that control the input of each of the marginal quality characteristics into the overall score. for that, different training procedures, in which the user classified a set of representative spots into three   <cit>  or four   <cit>  groups, were proposed. this requires an expert to evaluate at least a couple of hundred spots to achieve a good approximation, which is a difficult and time-consuming task.

here, we develop an automatic training procedure to evaluate the contribution  of each marginal quality characteristic into the overall quality score, together with an original set of quality characteristics and a model that maps this set into an overall quality value. this procedure is based on information from replicated spots, located on the same array or over a set of replicated arrays, and assumes that unspoiled replicated spots must have very close intensity ratios, whereas poor spots yield greater diversity in the obtained ratio estimates. the obtained weights can then be used to establish a critical limit for each quality characteristic, such that if a spot's characteristic exceeds its critical limit, the spot can be declared a "bad" spot.

we demonstrate the applicability of the developed algorithms using simulated artificial images and experimental images of different array designs used within our institute and cgh images obtained from the ucsf cancer center.

RESULTS
we assume that the spots are identified and well localized  <cit> , ] in squares . this involves:  identifying the position of each spot on the array to associate it with the spotted clone; and  establishing the borders between the neighboring spots to allow further independent data processing  for each spot. visually this results in the generation of a grid covering the microarray image.

ratio estimation
we have implemented  <cit>  two approaches for calculating the cy5/cy <dig> ratio for the spot:  based on spot segmentation and  based on linear regression.

spot segmentation
in the spot segmentation approach a direct arithmetic ratio of the background-corrected fluorescence intensity estimates in the two color channels is evaluated. this approach requires the identification of both the foreground – the measured spot – and the background – typically the level of non-specific hybridization. the segmentation procedure, in our implementation, is based on the k-means adaptive pixel-clustering algorithm  <cit>  modified to explicitly take into consideration the geometrical constraints on the spots and to improve identification of the background areas for the spots with smooth edges.

linear regression estimation
in the linear regression approach, the ratio is represented as the slope of the linear regression fit of the pixel intensities in two color channels . as measured fluorescence intensities are statistically distorted in both color channels, orthogonal regression  <cit>  is used to estimate the slope. in this method spot segmentation is unnecessary, as background pixels are concentrated at the origin of the linear regression plot and do not influence the slope of the regression line . however, outlier or aberrant pixels within the spot cells, even in small numbers, can strongly influence the regression line, thus biasing the ratio. we have improved  <cit>  the linear regression approach by developing a statistical filtering procedure that systematically searches and removes aberrant or outlier pixels.

briefly, this procedure can be outlined as follows. suspicious pixels are examined by evaluating the quality of the linear regression fit with and without the suspicious pixel. we quantify the fit quality by the residual variance, s <dig>  <cit> . the smaller s <dig> is, the closer the linear regression line is to the experimental data. the ratio of the s <dig> values is calculated for the fit with the tested pixel and for the fit without. if this ratio is larger than a critical value of the f-distribution at a user-defined confidence level, the pixel will be marked as aberrant. we select pixels with the highest intensity in either of two channels first and then select pixels having the largest deviation from the fitted regression line. to take into account the fact that the distortions caused by pixels from the top of the intensity scale and by pixels lying off of the linear regression line, may be different, we apply different confidence levels for the f-statistics for these pixels.

for the high-intensity pixels we also perform another test to determine how far their intensities are from the averaged intensity of the other pixels within the spot cell. this detects pixels, far away from the other pixels, that do not distort the linear regression line. although these pixels may not change the cy5/cy <dig> ratio, they could be considered as aberrant pixels, as we expect to see an almost continuous distribution of pixels intensity.

the procedure performs iteratively until no more aberrant pixels are detected. an example of the outlier detection is presented in fig.  <dig>  note that the regression approach is capable of detecting contamination pixels that are geometrically inseparable from the spot. therefore, the developed procedure can be considered not only as a procedure for correcting ratio recovery, but also as a procedure to repair the spot and to improve the quality of experimental material. it requires, however, that the contamination clearly deviates from the straight regression line, which is defined by the majority of "good" pixels from the spot.

although this procedure gives a high level of confidence in the linear regression ratio estimates, we still apply spot segmentation, because linear regression estimates may be biased when there is a high level of statistical noise . however, after removing aberrant pixels, the segmentation algorithm also gives more robust estimates, and there is a greater agreement in the ratio values obtained with both methods.

as well as the cy5/cy <dig> ratio estimates, each of these approaches generates a series of parameters that can be used to evaluate the spot quality.

quality characteristics
we define a set of quality parameters, characterizing different features of the spot. these parameters are scaled between  <dig>  and  <dig>  to facilitate further quality analysis.

first, we use the characteristics from the linear regression approach. the coefficient of determination  of linear regression signifies the degree of linear relationship between the intensities in the cy <dig> and cy <dig> channels. high values of cd  are expected for good spots. low values suggest either relatively bright but non-correlated contamination, or strong statistical noise normally characterizing low-level  spots. although the removal of aberrant pixels increases the cd of linear regression, it can still be low for noisy spots. these spots must be either flagged out or assigned a lower quality value. this parameter takes the range : q <dig> = cd.

the durbin-watson statistic   <cit>  evaluates the presence of the first-order autocorrelation in the residuals of the linear regression fit. it ranges from  <dig> to  <dig>   <dig> being a positive correlation and  <dig> being a negative correlation. a dws value close to two indicates that the residuals are uncorrelated and the model is appropriate. large deviations from two, resulting from systematic patterns in the residuals plot suggest that the spot cannot be modeled in terms of a simple linear regression. low dws values typically imply strong contamination that was not removed by filtering . the durbin-watson quality parameter  is obtained from the dws value by the following transformation: q <dig> =  <dig> - |dws - 2|/ <dig> 

one more indicator of the quality directly available from the linear regression is the number  of the aberrant pixels flagged out by the filtering procedure. although aberrant pixels can be found everywhere within the spot cell, we count only those pixels within the spot contours. this value can be used as a quantitative measure of spot contamination. small numbers of aberrant pixels do not influence intensity ratio estimates, whereas the removal of large numbers of pixels from the spot may indicate inconsistency with the linear regression model . we scale n to fit the range  as: q <dig> =  <dig> - n/s, where s is the number of pixels within the spot contour.

we now define three quality parameters from the analysis of the contoured spot. the diameter of the spot is calculated as d = 21/ <dig>  as the true value for the spot diameter may be difficult to establish, we use a typical value taken as the median diameter over all spots on the array. spots with exceptionally small diameters should normally be penalized. we define the diameter quality parameter as q <dig> = exp{d-t}, if d <t and q <dig> =  <dig>  if d > t, where t is the typical diameter.

the geometrical symmetry parameter measures deviation of the contoured spot from the ideal circle. the center and the diameter of the ideal circle correspond to the center and the diameter of the real spot. we divide both the real spot and the ideal circle into eight segments π/4], k =  <dig> ...,7) and we count the number of pixels belonging to the spot  and to the circle  for each segment. the sum of the absolute relative differences gs=∑i=18|nsi−nci|/nci
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwghbwrcqwgtbwucqgh9aqpdaaewbqaamaalyaabawaaqwaaeaacqwgobgtdaqhaawcbagaem4camnaemyaakgabaaaaogaeyoei0iaemota40aa0baasqaaiabdogajjabdmgapbqaaaaaaogaay5bslaawia7aaqaaiabd6eaonaadaaaleaacqwgjbwycqwgpbqaaeaaaaaaaaqaaiabdmgapjabg2da9iabigdaxaqaaiabiida4aqdcqghris5aaaa@46cb@ is then taken as an indicator of quality. for ideal circular spots gs should approach  <dig>  whereas highly deformed  spots can be recognized by high gs values . we transform the gs values as q <dig> = exp to fit the range .

using the same partition of the spot into eight segments, we can also calculate the mean intensities for each of the segments . the intensity symmetry of the spot is defined as is=∑i=18|ii−i|/i
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgjbqscqwgtbwucqgh9aqpdaaewbqaamaalyaabawaaqwaaeaacqwgjbqsdaqhaawcbagaemyaakgabaaaaogaeyoei0iaemysakeacaglhwuaayjcsdaabagaemysakeaaawcbagaemyaakmaeyypa0jaegymaedabagaegioagdaniabgghildaaaa@3f95@, where i is the mean intensity within the spot. we scale the is values in the range  as q <dig> = exp. although a spot may have perfect circular shape, it may contain very bright  and highly concentrated groups of pixels originating from pieces of dust or other contamination . is is calculated for each of two channels  and the maximal value is taken as a final estimate.

we estimate two cy5/cy <dig> ratios; one by the linear regression approach , and the other by the segmentation algorithm . despite the different methods of estimation, the variation between the two obtained ratios should be as small as possible. consistent results should be expected, as most of the contaminating pixels have been removed by the filtering procedure. large variations between the two estimates may indicate a problematic spot. therefore, we use the coefficient of variation of two ratio estimates cvr = 21/2|rr-rs|/ as a characteristic of quality. the cvr quality parameter is defined as q <dig> = exp fitting the range . this measure of quality is the least explicit of all the quality characteristics: we can only determine that there is big discrepancy between the estimates but not why there is a big discrepancy, unless it is accompanied by lower values in any of the other quality parameters.

finally, we introduce two parameters evaluating the quality of the background estimates. the first is the uniformity of the background  around the spot, more precisely, along the grid lines separating neighborhood spots. we divide the grid line surrounding the spot into eight segments and calculate the mean intensity in each segment . the ub parameter is defined as: ub=∑i=18|bi−b|/b
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgvbqvcqwgcbgqcqgh9aqpdaaewbqaamaalyaabawaaqwaaeaacqwgcbgqdaqhaawcbagaemyaakgabaaaaogaeyoei0iaemoqaieacaglhwuaayjcsdaabagaemoqaieaaawcbagaemyaakmaeyypa0jaegymaedabagaegioagdaniabgghildaaaa@3f61@, where b is the mean intensity for the whole grid line around the spot. normally we would not expect to observe a big variability in the fluorescence intensity in the background areas. large ub values may discover presence of relatively bright contamination around the spot, large variability in the background or merged neighboring spots . ub is rescaled to the range  by the exponential transformation: q <dig> = exp.

the second background quality characteristic is the absolute level of the background . we calculated this from the local area around the spot. as for the spot diameter d, there is no predefined ideal value for the absolute background. therefore, as a benchmark for comparisons, we take the typical value as the median background level over all spots on the array. spots with exceptionally high ab values should be treated with care or discarded. of two background estimates obtained in two-color microarray experiments, we use one that gives the highest value as the most indicative of possible problems. we define the ab quality parameter as q <dig> = exp{-/b}, if ab > b and q <dig> =  <dig>  if ab <b, where b is the typical background level.

we cannot claim that the developed quality parameters are the optimal. however, they have led to reasonable results for most of the experimental and simulated situations we tested. of course, there may be a possibility to formalize some of these parameters more precisely and/or to develop new parameters accounting for other types of distortions.

spot quality analysis
we consider two aims of spot quality analysis. the first is to combine the nine marginal quality parameters into an overall quality value. this value can be used either to flag out directly spots with a quality lower than a user-defined threshold, or, in the follow-up image analysis procedures  as a parameter characterizing the level of confidence in the obtained cy5/cy <dig> ratios. the second aim is to identify a critical range  for each quality characteristic. if a certain quality characteristic of the spot falls in this range, the corresponding spot could be classified as a "bad" spot.

overall quality
we used the following definition for the overall quality value:

q=min⁡i= <dig> ..9{qiwi},     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgrbqucqgh9aqpdawfqaqaaigbc2gatjabcmgapjabc6gaubwcbagaemyaakmaeyypa0jaegymaejaeiola4iaeiola4iaeiola4iaegyoakdabeaakmaacmaabagaemycae3aa0baasqaaiabdmgapbqaaiabdeha3naadaaameaacqwgpbqaaeaaaaaaaagccagl7bgaayzfaagaeiilawiaaczcaiaaxmaacqggoaakcqaixaqmcqggpaqkaaa@4733@

where qi = qi ∈ , i =  <dig> ..., <dig> are the marginal quality parameters for x <dig> = cd, x <dig> = dws, x <dig> = n, x <dig> = d, x <dig> = gs, x <dig> = is, x <dig> = cvr, x <dig> = ub, x <dig> = ab, and wi are the weights that control the input of the corresponding quality components into the overall quality value. a link between the weight wi and the critical value xilim⁡
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwg4baedaqhaawcbagaemyaakgajeaybagagiibawmaeiyaakmaeiyba0gaaaaa@3435@ can be established for each quality characteristic i =  <dig> ...,9:

wi=log⁡{qlim⁡}log⁡{qi},  or  xilim⁡=qi− <dig>      
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwg3bwddaqhaawcbagaemyaakgabaaaaogaeyypa0zaasaaaeaacyggsbabcqggvbwbcqggnbwzdagadaqaaiabdgfarnaadaaaleaaaeaacyggsbabcqggpbqacqggtbqbaaaakiaawuhacagl9baaaeaacyggsbabcqggvbwbcqggnbwzdagadaqaaiabdghaxnaadaaaleaacqwgpbqaaeaaaagcdaqadaqaaiabdiha4naadaaaleaacqwgpbqaaeaacyggsbabcqggpbqacqggtbqbaaaakiaawicacaglpaaaaiaawuhacagl9baaaagaeiilawiaagpavlaaykw7ieaacqwfvbwbcqwfybgccaamc8uaagpavlabdiha4naadaaaleaacqwgpbqaaeaacyggsbabcqggpbqacqggtbqbaagccqgh9aqpcqwgxbqcdaqhaawcbagaemyaakgabagaeyoei0iaegymaedaaowaaewaaeaadagadaqaaiabdgfarnaadaaaleaaaeaacyggsbabcqggpbqacqggtbqbaaaakiaawuhacagl9baadaqhaawcbaaabagaegymaejaei4la8iaem4dac3aa0baawqaaiabdmgapbqaaaaaaaaakiaawicacaglpaaacqggsaalcawljagaaczcaiabcicaoiabikdayiabcmcapaaa@7891@

where qlim ∈  is the user-defined overall quality threshold, and qi is the quality parameter calculated for xilim⁡
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwg4baedaqhaawcbagaemyaakgajeaybagagiibawmaeiyaakmaeiyba0gaaaaa@3435@. the critical value xilim⁡
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwg4baedaqhaawcbagaemyaakgajeaybagagiibawmaeiyaakmaeiyba0gaaaaa@3435@ sets up the limit such that if a certain characteristic i exceeds this limit, the corresponding quality parameter qi will become lower than qlim. the correspondence between xi, xilim⁡
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwg4baedaqhaawcbagaemyaakgajeaybagagiibawmaeiyaakmaeiyba0gaaaaa@3435@, qi, qi, wi, q and qlim is demonstrated in fig.  <dig> 

quality weights wi
the experimental quality parameters qi, i =  <dig> ..., <dig> are directly available from the quantification procedure, whereas the weights wi  are unknown and are not easily guessed or derived from theory. therefore, the problem of spot quality analysis becomes a problem of weights  estimation. this can only be solved if additional information is available. here we consider three possibilities:

 <dig>  the additional information may come, for example, from the user expertise. the user has to classify the spots manually  <cit>  and assign a quality value to each spot from a representative subset. these values are then used for training the model  leading to a combination of the weights  such that the overall quality values reproduce the user classification reasonably well.

 <dig>  we can manually apply different combinations of the weights wi and visually appreciate, which spots have been flagged out. the trials must be continued until most of the user classified "bad" spots are eliminated by the chosen combinations of the weights.

 <dig>  the weights can be estimated automatically using information available from replicated spots on the same array or over a set of replicated arrays. unspoiled replicate spots should have very similar estimated cy5/cy <dig> ratio values. large differences between the observed ratios in the replicate spots would signal that some spots from this replicate were irregular. we formalize this approach by first defining the quality value for the replicate:

qk=min⁡j= <dig> ..n{qkj},     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgrbqudaqhaawcbagaem4aasgabaaaaogaeyypa0zaacbeaeaacyggtbqbcqggpbqacqggubgbasqaaiabdqgaqjabg2da9iabigdaxiabc6cauiabc6cauiabc6cauiabd6gaubqabagcdagadaqaaiabdgfarnaadaaaleaacqwgrbwacqwgqbgaaeaaaaaakiaawuhacagl9baacqggsaalcawljagaaczcaiabcicaoiabiodaziabcmcapaaa@4755@

where k indicates the replicates, n is the number of spots in a replicate and qkj is a spot quality value given by eq. . substituting eq.  into  yields

qk=min⁡j= <dig> ..n{min⁡i= <dig> ..9{qkjiwi}},     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgrbqudaqhaawcbagaem4aasgabaaaaogaeyypa0zaacbeaeaacyggtbqbcqggpbqacqggubgbasqaaiabdqgaqjabg2da9iabigdaxiabc6cauiabc6cauiabc6cauiabd6gaubqabagcdagadaqaamaaxababagagiyba0maeiyaakmaeioba4galeaacqwgpbqacqgh9aqpcqaixaqmcqgguaglcqgguaglcqgguaglcqai5aqoaeqaaowaaiwaaeaacqwgxbqcdaqhaawcbagaem4aasmaemoaaomaemyaakgabagaem4dac3aasbaawqaaiabdmgapbqabaaaaagccagl7bgaayzfaaaacagl7bgaayzfaagaeiilawiaaczcaiaaxmaacqggoaakcqai0aancqggpaqkaaa@5984@

where qkji is the i-th quality parameter of the j-th replicated spot in the k-th replicate. the weights wi, i =  <dig> ..., <dig> are the parameters that ensure the best fit of the experimental quality values  to a user-defined ideal quality curve f, where vk is the intensity ratio variation coefficient in the k-th replicate. the best fit of qk to f can be achieved by minimizing the sum of squared differences between qk and f :

∑kψk <dig>      
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaaeqbqaaiabei8a5naadaaaleaacqwgrbwaaeaaaagcdawadaqaaiabdagamjabcicaoiabdafawnaadaaaleaacqwgrbwaaeaaaagccqggpaqkcqghsisldawfqaqaaigbc2gatjabcmgapjabc6gaubwcbagaemoaaomaeyypa0jaegymaejaeiola4iaeiola4iaeiola4iaemoba4gabeaakmaacmaabawaacbeaeaacyggtbqbcqggpbqacqggubgbasqaaiabdmgapjabg2da9iabigdaxiabc6cauiabc6cauiabc6cauiabimda5aqabagcdagadaqaaiabdghaxnaadaaaleaacqwgrbwacqwgqbgacqwgpbqaaeaacqwg3bwddawgaaadbagaemyaakgabeaaaaaakiaawuhacagl9baaaiaawuhacagl9baaaiaawufacagldbaadaqhaawcbaaabagaegomaidaaaqaaiabdugarbqab0gaeyyeiuoakiabcycasiaaxmaacawljagaeiikagiaegynaujaeiykakcaaa@6674@

where ψk are the weights of the contribution of each replicate into the sum . the quality weights wi can be estimated by minimization of eq  using one of the algorithms for non-linear fitting  <cit> .

ideal quality curve f
f defines how fast the overall quality of the replicates should decrease with increasing ratio variation. the shape of the ideal quality curve f is somewhat arbitrary; the only requirement is that it should demonstrate monotonic decay. further formalization for f is hardly possible until more information regarding the ideal quality behavior becomes available. therefore we have to look for empirical approaches to define f. for example, f can be implemented as a non-parametric function, which can be constructed by the user through the properly designed user interface. f can also be represented as a function  = vkα
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgwbgvdaqhaawcbagaem4aasgabagaeqysdegaaaaa@310c@ exp{-βvk} with two adjustable parameters α and β), which can yield different shapes depending on the parameters values. finally, a library of different functional shapes for f can be created. in our work we follow the third approach: three shapes were implemented for testing:

f={exp⁡{−vk/v¯}, exp⁡{−vk2/v¯2}, 1/{1+vk/v¯},      
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgmbgzcqggoaakcqwgwbgvdawgaawcbagaem4aasgabeaakiabcmcapiabg2da9maaceaabaqbaeqabmqaaaqaaigbcwgaljabciha4jabcchawnaacmaabagaeyoei0iaemovay1aasbaasqaaiabdugarbqabagccqggvawlcuwgwbgvgaqeaagaay5eaiaaw2haaiabcycasiabbccagiabcicaoiabdggahjabcmcapaqaaigbcwgaljabciha4jabcchawnaacmaabagaeyoei0iaemovay1aa0baasqaaiabdugarbqaaiabikdayaaakiabc+caviqbdafawzaarawaawbaasqabeaacqaiyagmaaaakiaawuhacagl9baacqggsaalcqqggaaicqggoaakcqwgibgycqggpaqkaeaadawcgaqaaiabigdaxaqaamaacmaabagaegymaejaey4kasiaemovay1aasbaasqaaiabdugarbqabagccqggvawlcuwgwbgvgaqeaagaay5eaiaaw2haaiabcycasiabbccagiabcicaoiabdogajjabcmcapaaaaaaacagl7baacawljagaaczcaiabcicaoiabiada2iabcmcapaaa@6b4e@

and for each shape only the characteristic ratio variation coefficient v¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgwbgvgaqeaaaa@2df9@ must be predefined. a typical example of the quality plot with the exponential f ,a) is shown in fig.  <dig> 

in our quality analysis algorithm, user participation is limited to the definition of the ideal quality curve shape f. this is somewhat simpler than deciding on the quality of several hundred spots, which is used to teach the algorithm in the manual approach. however, as with other solutions, this algorithm requires representative images to train the model. it is impossible to evaluate confidently the weight of the contribution of the diameter quality parameter, for example, if all spots in the array have the same diameter. therefore, a careful selection of training images containing a realistic diversity of all possible distortions and artifacts is needed.

fitting weights ψk
an important issue of the minimization of eq  is reasonable selection of the fitting weights ψk. the easiest way is to set all ψk equal to one. however, most of the replicates are often observed in the initial part of the quality plot , whereas there may be only a few replicates in the tail of the plot . in this case, equalized weights would give a very accurate fit for the initial part of the quality curve while ignoring the tail. however, mainly the tail contains the relevant information  for identifying the quality weights. therefore, we try to increase the input from regions with a smaller number of replicates by defining the weights ψk in the following way:

 <dig>  all replicates are sorted according to their ratio variation vk.

 <dig>  the set of sorted replicates is divided into bins with ten replicates in each bin. the difference λj between the smallest and the largest ratio variation coefficients in each bin j is calculated. the larger this difference, the smaller the concentration of the replicates in the given region of the quality plot.

 <dig>  the weights ψk for eq.  are then calculated as ψk = ψj*10+i = λj <dig> 
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqah7oabdaqhaawcbagaemoaaogabagaegimaajaeiola4iaegynaudaaaaa@32b4@, i =  <dig> ..., <dig>  that is, they are equalized for ten replicates from the same bin j.

follow-up image analysis
as it was mentioned earlier, the overall quality value, q ), can be used as a parameter characterizing the level of confidence in the obtained cy5/cy <dig> ratios. if, for example, n ratios should be averaged, the weighted mean would ensure a more robust estimate for the average:

r¯=∑l=1nqlrl∑l=1nql,     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgsbgugaqeaiabg2da9maalaaabawaaabcaeaacqwgrbqudaqhaawcbagaemibawgabaaaaogaemouai1aa0baasqaaiabdygasbqaaaaaaeaacqwgsbabcqgh9aqpcqaixaqmaeaacqwgubgba0gaeyyeiuoaaoqaamaaqahabagaemyuae1aa0baasqaaiabdygasbqaaaaaaeaacqwgsbabcqgh9aqpcqaixaqmaeaacqwgubgba0gaeyyeiuoaaagccqggsaalcawljagaaczcaiabcicaoiabieda3iabcmcapaaa@4a0a@

where rl is the cy5/cy <dig> ratio and ql, is the corresponding overall quality value . the weighted coefficient of variation is defined as

v=∑l=1nql2/∑l=1nqlr¯.     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgwbgvcqgh9aqpdawcaaqaamaakaaabawaasgbaeaadaaewbqaaiabdgfarnaadaaaleaacqwgsbabaeaaaagcdaqadaqaaiabdkfasnaadaaaleaacqwgsbabaeaaaagccqghsislcuwgsbgugaqeaagaayjkaiaawmcaamaacaaaleqabagaegomaidaaaqaaiabdygasjabg2da9iabigdaxaqaaiabd6gaubqdcqghris5aagcbawaaabcaeaacqwgrbqudaqhaawcbagaemibawgabaaaaaqaaiabdygasjabg2da9iabigdaxaqaaiabd6gaubqdcqghris5aaaaasqabaaakeaacuwgsbgugaqeaaaacqgguaglcawljagaaczcaiabcicaoiabiida4iabcmcapaaa@505a@

note that the ratio variation coefficient vk from eq.  can be determined from eq. , if we set ql =  <dig>  l =  <dig> ...,n, with n being the number of spots in the k-th replicate.

image simulation
in  <cit>  we have described the monte-carlo simulation model for generating artificial microarray images. the advantage of using artificial images is that we always know the exact cy5/cy <dig> ratio values. this allows us to test and compare objectively different image analysis algorithms. the general model for the two-color  microarray image is given by  <cit> :

fcy3=∑k=1ng+∑k=1mg,     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwggbgrdaqhaawcbagaem4qamkaemyeaknaeg4mamdabaaaaogaeiikagiaemieagnaeiilawiaemyeaknaeiykakiaeyypa0zaaabcaeaacqwgnbwzdaqadaqaaiabdiha4jabcycasiabdmha5jabcycasiabdogajnaadaaaleaacqwgrbwaaeaacqwgzbwccqwg4baeaagccqggsaalcqwgjbwydaqhaawcbagaem4aasgabagaem4camnaemyeakhaaogaeiilawiaemocai3aa0baasqaaaqaaiabdohazbaakiabcycasiabdmeajnaadaaaleaaaeaacqwgzbwcaaaakiaawicacaglpaaaasqaaiabdugarjabg2da9iabigdaxaqaaiabd6eaobqdcqghris5aogaey4kasyaaabcaeaacqwgnbwzdaqadaqaaiabdiha4jabcycasiabdmha5jabcycasiabdogajnaadaaaleaacqwgrbwaaeaacqwgkbazcqwg4baeaagccqggsaalcqwgjbwydaqhaawcbagaem4aasgabagaemizaqmaemyeakhaaogaeiilawiaemocai3aa0baasqaaaqaaiabdsgakbaakiabcycasiabdmeajnaadaaaleaaaeaacqwgkbazaaaakiaawicacaglpaaaasqaaiabdugarjabg2da9iabigdaxaqaaiabd2eanbqdcqghris5aogaeiilawiaaczcaiaaxmaacqggoaakcqai5aqocqggpaqkaaa@8214@

fcy5=r∑k=1ng+∑k=1mg,     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwggbgrdaqhaawcbagaem4qamkaemyeaknaegynaudabaaaaogaeiikagiaemieagnaeiilawiaemyeaknaeiykakiaeyypa0jaemouai1aaabcaeaacqwgnbwzdaqadaqaaiabdiha4jabcycasiabdmha5jabcycasiabdogajnaadaaaleaacqwgrbwaaeaacqwgzbwccqwg4baeaagccqggsaalcqwgjbwydaqhaawcbagaem4aasgabagaem4camnaemyeakhaaogaeiilawiaemocai3aa0baasqaaaqaaiabdohazbaakiabcycasiabdmeajnaadaaaleaaaeaacqwgzbwcaaaakiaawicacaglpaaaasqaaiabdugarjabg2da9iabigdaxaqaaiabd6eaobqdcqghris5aogaey4kasyaaabcaeaacqwgnbwzdaqadaqaaiabdiha4jabcycasiabdmha5jabcycasiabdogajnaadaaaleaacqwgrbwaaeaacqwgkbazcqwg4baeaagccqggsaalcqwgjbwydaqhaawcbagaem4aasgabagaemizaqmaemyeakhaaogaeiilawiaemocai3aa0baasqaaaqaaiabdsgakbaakiabcycasiabdmeajnaadaaaleaaaeaacqwgkbazaaaakiaawicacaglpaaaasqaaiabdugarjabg2da9iabigdaxaqaaiabd2eanbqdcqghris5aogaeiilawiaaczcaiaaxmaacqggoaakcqaixaqmcqaiwaamcqggpaqkaaa@8423@

where n is the number of spots and m is the number of dust clusters, cksx
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgjbwydaqhaawcbagaem4aasgabagaem4camnaemieaghaaaaa@326f@ and cksy
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgjbwydaqhaawcbagaem4aasgabagaem4camnaemyeakhaaaaa@3271@ are the coordinates of the center of a spot, ckdx
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgjbwydaqhaawcbagaem4aasgabagaemizaqmaemieaghaaaaa@3251@ and ckdy
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgjbwydaqhaawcbagaem4aasgabagaemizaqmaemyeakhaaaaa@3253@ are the coordinates of the center of a dust cluster, rs and rd are the approximate radiuses of the spot and dust cluster, respectively, is and id are the fluorescence intensity in the center of the spot in the cy <dig> color channel and in the center of the dust cluster, respectively, and r is the ratio of the test and control samples for each spot. dust is represented by the random distribution over the array of clusters of pixels of varying brightness. we consider that these pixel clusters have an identical shape to the spots and therefore the same analytical representation is used for an ideal spot shape and dust cluster:

g=iexp⁡.     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgnbwzcqggoaakcqwg4baecqggsaalcqwg5bqecqggsaalcqwgjbwydaqhaawcbaaabagaemieaghaaogaeiilawiaem4yam2aa0baasqaaaqaaiabdmha5baakiabcycasiabdkhayjabcycasiabdmeajjabcmcapiabg2da9iabdmeajjgbcwgaljabciha4jabcchawnaabmaabagaeyoei0yaasgbaeaadagadaqaamaadmaabawaasaaaeaacqwg4baecqghsislcqwgjbwydaqhaawcbaaabagaemieaghaaagcbagaemocaihaaagaay5waiaaw2faamaadaaaleaaaeaacqai0aanaagccqghrawkdawadaqaamaalaaabagaemyeaknaeyoei0iaem4yam2aa0baasqaaaqaaiabdmha5baaaoqaaiabdkhaybaaaiaawufacagldbaadaqhaawcbaaabagaeginaqdaaogaey4kasyaamwaaeaadawcaaqaaiabdiha4jabgkhitiabdogajnaadaaaleaaaeaacqwg4baeaaaakeaacqwgybgcaaaacaglbbgaayzxaawaa0baasqaaaqaaiabikdayaaakmaadmaabawaasaaaeaacqwg5bqecqghsislcqwgjbwydaqhaawcbaaabagaemyeakhaaagcbagaemocaihaaagaay5waiaaw2faamaadaaaleaaaeaacqaiyagmaaaakiaawuhacagl9baaaeaacqaiyagmaaaacagloagaayzkaagaeiola4iaaczcaiaaxmaacqggoaakcqaixaqmcqaixaqmcqggpaqkaaa@7b17@

the parameters characterizing the spots  are user-defined. for example, the coordinates cksx
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgjbwydaqhaawcbagaem4aasgabagaem4camnaemieaghaaaaa@326f@ and cksy
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgjbwydaqhaawcbagaem4aasgabagaem4camnaemyeakhaaaaa@3271@, the radius rs and the ranges for x and y for each spot are defined from a user-defined array design. the user should also specify the number of dust clusters m on the array. the other parameters characterizing the dust are random variables, and the probability laws for their generation is a matter of choice. we use uniform distributions for rd  and id , where rm and im are a user-defined maximal dust cluster radius and maximal dust intensity, respectively. we also assume that ckdx
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgjbwydaqhaawcbagaem4aasgabagaemizaqmaemieaghaaaaa@3251@ and ckdy
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgjbwydaqhaawcbagaem4aasgabagaemizaqmaemyeakhaaaaa@3253@ are uniformly distributed over the array. statistical laws of the dust characteristics can generally be different in the two  channels.

in the developed simulation model we also account for the nonspecific hybridization and statistical noise:

f˜i=fi+b¯i+ηbib¯igb+σgs,     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwggbgrgaacamaadaaaleaacqwgpbqaaeaaaagccqggoaakcqwg4baecqggsaalcqwg5bqecqggpaqkcqgh9aqpcqwggbgrdaqhaawcbagaemyaakgabaaaaogaeiikagiaemieagnaeiilawiaemyeaknaeiykakiaey4kasiafmoqaikbaebadaqhaawcbagaemyaakgabaaaaogaey4kasiaeq4tdg2aa0baasqaaiabdkeacjabdmgapbqaaaaakiqbdkeaczaarawaa0baasqaaiabdmgapbqaaaaakiabdeeahnaabaaaleaacqwgcbgqaeqaaogaey4kasiaeq4wdmnaeiikagiaemieagnaeiilawiaemyeaknaeiykakiaem4rac0aasbaasqaaiabdofatbqabagccqggsaalcawljagaaczcaiabcicaoiabigdaxiabikdayiabcmcapaaa@5c51@

where i represents either cy <dig> or cy <dig>  b¯i
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgcbgqgaqeamaadaaaleaacqwgpbqaaeaaaaaaaa@2f59@ and ηbi are the user-defined average and noise-to-signal ratio of nonspecific fluorescence intensity in the color channel i, σ is the standard deviation of the pixel statistical noise, and gb and gs are independent gaussian random variables with zero mean and unit standard deviation. the exact representation for σ is defined by the experimental set-up. there are currently three possibilities: σ can be  constant,  proportional to the signal, or  proportional to the square root of signal. the type and quantitative characteristics of the statistical noise are defined by the user.

discussion
software
the developed algorithm for quality control is included in the software package maia, which offers a complete solution for dna microarray image analysis, including automatic spot localization and spot quantification procedures. a demo version of the software can be downloaded from  <cit> .

artificial images
all artificial images were generated using the same array design:  <dig> ×  <dig> blocks and  <dig> ×  <dig> spots within each block with the inter-spot distance of  <dig> pixels. for all spots in the generated arrays the spot radius, r, was about  <dig> pixels, the intensity, i, in the cy <dig> color channel was  <dig> and the ratio, r, of the cy <dig> and cy <dig> channels was  <dig>  non-specific hybridization was generated using b¯i
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgcbgqgaqeamaadaaaleaacqwgpbqaaeaaaaaaaa@2f59@ =  <dig> and ηbi =  <dig> . the standard deviation of the statistical noise, σ, at each pixel was proportional to the signal at the corresponding pixel with the noise-to-signal ratio of  <dig> . the three generated images ) differed in the number of dust clusters. the percentages of dust clusters with respect to the number of good spots were: 0% , 5%  and 25% . in all cases the maximal dust cluster radius, rm, was set to  <dig>  and maximal dust intensity, im, to  <dig> 

as all spots have the same theoretical ratio , they can be considered as replicates and therefore we can use the quantitative characteristics defined in eqs.  and  to characterize the performance of the algorithm. we expect the best estimators to provide the averaged cy5/cy <dig> ratio closer to the true ratio  with the least spread around this value.

for each artificial array we compared the weighted statistical characteristics for the average r¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgsbgugaqeaaaa@2df1@ ) and for the ratio variation coefficient v ) with the un-weighted ones. the un-weighted characteristics were obtained from eqs.  and  by setting all ql, l =  <dig> ...,n to  <dig>  the weighted characteristics were calculated with the overall quality values ql available from the quality analysis algorithm. as all spots from the simulated image can be considered as replicates, we artificially split up the total number of spots into the groups of three closely placed spots. these groups, regarded as independent triplicates, can be used to calculate the experimental quality values qk ) and to build up the corresponding quality plot . three functional shapes ) for the ideal quality curve f were tested.

the results are collected in table  <dig>  the weighted statistical characteristics with the developed quality control eliminated bias in the average cy5/cy <dig> ratio estimates and reduced the ratio variation coefficient. note that for "ideal" image 6a  the applied quality measures retained the estimates unchanged.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgsbgugaqeaaaa@2df1@ ) and the coefficient of variation v ) of the cy5/cy <dig> ratios over all spots for three artificial images a, b, and c from fig 6

f =exp{-vk/v¯
f =exp{-vk2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgwbgvdaqhaawcbagaem4aasgabagaegomaidaaaaa@305f@/v¯
f =1/{ <dig> + 
the three compared ideal quality shapes f ) demonstrated similar performance. a small advantage  of the gaussian-like function ,b) for image 6b  was compensated by the lowest performance for image 6c . the difference between the three shapes can be seen from fig  <dig>  where the corresponding quality plots are drawn for the three generated images. the inverse shape ,c) is the least stringent whereas the gaussian-like shape is the most stringent with respect to the replicates variability. this means that the inverse shape does not require the replicates with higher variability to have lower quality values  as strictly as the gaussian-like one. although it seems that the gaussian-like shape is the best choice, there is still a drawback. due to its relatively abrupt decrease it is difficult to keep the balance in fitting weights ψk between the head and the tail of the shape. despite the adaptive selection of the fitting weights ψk , the fitting procedure, trying to ensure the highest quality for the replicates with the lowest variability, may still overlook the replicates with the higher variability. this depends on the image quality  and can explain why the gaussian-like shape yielded the greatest ratio variation for image 6c. this also indicates that more work is needed to find out an optimal combination of the ideal quality curve and the fitting weights ψk to be used in the training procedure.

the results of simulation study and our experience with the experimental images suggest that the exponential shape ,a) offers a reasonable compromise between the fitting weights used and stringency with respect to the replicates variability. therefore in the further quality analysis we will apply exponential f.

experimental images
we performed quality analysis of two experimental images with different array designs and signal-to-noise levels.

one image   was provided as a demonstration example for ucsf spot  <dig>  . it contains  <dig> ×  <dig> blocks with  <dig> ×  <dig> spots in each block, with a spot cell size of about  <dig> pixels. cy <dig> and cy <dig> color channels are strongly correlated, with the average correlation coefficient for the spots being about  <dig> . bright contamination spots can be seen irregularly scattered over the array. the magnified image of one such spot is shown in fig.  <dig> . each clone was spotted in triplicate. the replicated spots are placed as neighbors in a row .

the second image   contains  <dig> ×  <dig> blocks with  <dig> ×  <dig> spots in each block , with a spot cell size of about  <dig> pixels. the average correlation between the channels for the spots is about  <dig> . this is lower than for the first image, although this image has no obvious contamination spots. each clone was prepared in triplicate, with the replicated spots in three vertically distributed sub-arrays .

we expect the cy5/cy <dig> ratios from the replicates to be similar. therefore it is reasonable to take the coefficient of variation ) of the replicates as a quantitative measure of the ratio estimation consistency. however, this measure may not be totally objective:  the estimates may be consistent, but systematically biased ;  three replicated spots of very poor quality may give very similar ratio values just by chance .

the average over all replicates at the given array coefficient of variation is taken as a global indicator of the cy5/cy <dig> ratio consistency of the array.

we compared two quality characteristics  and the coefficient of variation of two ratio estimates cvr , applied separately) and the overall quality parameter q ) to the case when no quality control was applied. the weights of the marginal quality parameters for q were identified using the exponential ideal quality curve ,a) with v¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgwbgvgaqeaaaa@2df9@ ≈  <dig>  for image 7a, and with v¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgwbgvgaqeaaaa@2df9@ ≈  <dig>  for image 7b. the results are summarized in table  <dig> 

we found a greater improvement for image 7a than for image 7b after applying the quality measures. this was not a surprise, as image 7b is characterized by a reasonably high signal-to-noise level, and it does not contain any obvious contaminated spots. however, even in this case the quality measures cannot be ignored, as there are still a few low-intensity spots that need to be specially treated . by contrast, image 7a has obvious randomly distributed pieces of dust, and the developed quality measures proved to be powerful enough to disregard the contaminated spots, thus increasing the consistency of the cy5/cy <dig> ratio estimates.

the comparison of the different quality measures has shown that they are array-specific. for image 7b, cd, cvr and q gave almost equivalent performance, whereas for image 7a, cd was much better than cvr, and q gave a slightly better ratio consistency than both of these. however, the gain from q was not much greater, so that it would be reasonable to assume that only a single quality measure  could always give good results. unfortunately, this is not the case. although we have found that cd and cvr are indeed the most powerful quality measures they cannot cover every type of distortion.

we demonstrate this with image 7a. there remained, after applying the individual quality measures, several triplicates with high coefficients of variation that were not correctly suppressed. three such replicates are shown in fig.  <dig>  and the main quantitative characteristics of the corresponding spots are listed in table  <dig>  note that table  <dig> contains the quality characteristics from section quality characteristics, which do not need to reside in the interval .

in triplicate a, one spot is clearly contaminated; however, this contamination is highly correlated in the two channels  and the spots cannot be filtered out using cd. a more powerful parameter for this type of problem is cvr , perhaps in combination with is . triplicate b includes low-intensity spots. although cvr quality characteristic does not detect any deficiency in this case, the difference between the estimated intensity ratios  is large, meaning that cvr alone is not sufficient to eliminate the outlier spots. cd seems to be more indicative in this case. triplicate c cannot be confidently recognized either by cd or cvr quality measures. this problem  can be figured out by applying either the uniformity of the background quality parameter  or the durbin-watson quality parameter .

this type of analysis leads to the refined critical values xilim⁡
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwg4baedaqhaawcbagaemyaakgajeaybagagiibawmaeiyaakmaeiyba0gaaaaa@3435@ for each of the quality characteristics. these xilim⁡
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwg4baedaqhaawcbagaemyaakgajeaybagagiibawmaeiyaakmaeiyba0gaaaaa@3435@ values are then recalculated into the corresponding weights wi for the user-selected overall quality threshold qlim, using eq.  . in general, however, the weights are derived automatically from eq.  by the non-linear fitting procedure. if certain quality factors do not influence the shape of the experimental quality curve qe ), the corresponding weights will be set close to  <dig>  if a certain effect shows up in only a small number of spots, it may be neglected by the optimization procedure, and the corresponding weight will be erroneously small. in this case, manual correction of the weights would be necessary.

the quality value of three bad replicates from fig.  <dig> , as well as of many others demonstrating larger deviations in the obtained cy5/cy <dig> ratio estimates , were decreased using the combined criteria q, whereas the quality of replicates with smaller variations remained almost unaffected.

quality measures can signal some of the replicates to be bad despite there being no big difference in the ratios. with a small number of replicated spots all spots from a replicate may indeed have very close ratios, but several of them may be really deficient. therefore, it is more important to consider those replicates demonstrating unusually high diversity in the obtained ratio estimates. this clearly suggests problems in the spots. algorithmically, this can be achieved by assigning larger weights ψk to these replicates in the non-linear fitting procedure ). the fitted parameters wi are then used to flag out all deficient spots, even those that belong to the replicates with the consistent ratio estimates. however, if all spots from a consistent replicate demonstrate poor quality, this can also be an indication that this replicate is actually good, but it was erroneously flagged out by the quality analysis procedure. this would require user intervention to correct for the selected set of quality characteristics and/or for the corresponding quality weight wi. additional procedures for automatic analysis of the replicates with consistent ratios but low quality values can be envisaged.

the fact that overall q does not show up much better performance  is due to rather good general quality of the images, and a few problematic triplicates cannot influence very much the averaged coefficients of variation. for example, in image 7a, we have less than 9% of triplicates with the ratio variation coefficients larger that the selected v¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgwbgvgaqeaaaa@2df9@ , and 7% for image 7b .

replicated arrays
quality analysis can also be performed with replicated spots from different arrays. three replicated images ) were used for quality analysis. although each image contains three replicated spots placed as neighbors in a row , we pretended that there were no replicates within each array. therefore we made available only replicated spots from different arrays for quality analysis. in fig.  <dig> we present three quality plots. black dots correspond to the case when the three replicated images were combined without normalization and the default quality weights were used. relatively large coefficients of variation are due to the bias in the obtained cy5/cy <dig> ratio estimates between the three images. to apply our algorithm of quality analysis in this case the ideal quality curve should account for this bias, i.e. it should implicitly incorporate image normalization model. a simpler way would be to separate the normalization and quality analysis procedures: the image normalization should precede the quality analysis, or we can also envisage an iterative procedure where the steps of normalization and quality analysis are performed in turn. taking into account that a variety of normalization methods  <cit>  are currently available, we leave the detailed development of the quality analysis strategy in this case for the future.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgwbgvgaqeaaaa@2df9@ ≈  <dig> ; blue line  – v¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgwbgvgaqeaaaa@2df9@ ≈  <dig> .

as an example, we applied a global normalization algorithm  <cit> . it is assumed that most genes are not differentially expressed and therefore the expected averaged over all spots of the array cy5/cy <dig> ratio should be close to one. the normalization constant a for each array can be calculated as a=exp⁡{∑i=1nln⁡ri/n}
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwghbqycqgh9aqpcygglbqzcqgg4baecqggwbacdagadaqaamaalyaabawaaabcaeaacyggsbabcqggubgbcqwgsbgudawgaawcbagaemyaakgabeaaaeaacqwgpbqacqgh9aqpcqaixaqmaeaacqwgubgba0gaeyyeiuoaaoqaaiabd6gaubaaaiaawuhacagl9baaaaa@434e@, where n is the number of spots and ri is the ratio estimate for the i-th spot. red dots in fig  <dig> represent the quality curve using the replicated arrays after the global normalization. for comparison, blue dots show the quality curve using the triplicates from the first array. the red-dot cloud spreads wider, because, even after normalization, the variability of replicates from different arrays is higher than from the same array . despite this replicated arrays can be used in the quality analysis since the required tendency – the decrease of the overall quality with the increase of the replicate variability – can be ensured. to account for higher levels of inter-array statistical variability in replicates, we have to apply less stringent ideal quality curve. this can be achieved by selecting larger values for the parameter v¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgwbgvgaqeaaaa@2df9@ in eq. .

quality weight extrapolation
we demonstrate here a possibility to apply quality weights obtained from the analysis of one training image, which should contain replicated spots, to other arrays, which may not contain replicates. we used two images  of the same design as before: each image contains three replicated spots placed as neighbors in a row. image 9a has obvious deficiencies , whereas image 9b is less problematic.

the quality weights were estimated from the triplicates of image 9a, as it contains a wider diversity of possible artifacts and distortions. using the obtained weights the "bad" spots were identified in image 9a. a spot was classified as a bad spot if its overall quality was below  <dig> . fig. 9a shows the same image with the "bad" spots indicated by the white crosses.

to eliminate the "bad" spots  from image 9b, we first applied the quality weights obtained for image 9a. the result is shown in fig. 9b. then we performed quality analysis for image 9b using its own triplicates. the spots flagged out by this approach are indicated in fig. 9b. comparing figs. 9b and 9b, one can conclude that the results are very similar, although not identical, of course.

this example attempts to reproduce an important possibility of designing microarray experiments. a small number of training arrays with replicated spots and representative diversity of possible artifacts can be measured and analyzed. the obtained results can then be used to evaluate the quality of other arrays of similar design, which may not contain replicated spots.

CONCLUSIONS
we have described an algorithm for quantitative spot quality evaluation in dna microarray image analysis that allows the automatic identification of the weights for the marginal quality parameters within the model combining these parameters into an overall spot quality value. the algorithm relies on the assumption that unspoiled replicated spots should have higher levels of consistency in the obtained cy5/cy <dig> ratio estimates than "bad" spots. the user is only required to define an ideal quality curve f establishing how fast the overall quality of the replicates must decrease with increasing ratio variation in the corresponding replicates. for simple models from eq.  only one parameter – the characteristic ratio variation coefficient v¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgwbgvgaqeaaaa@2df9@ – must be specified. in this paper the functional shape for f was empirically selected through numerous experiments with artificial and experimental images. this, however, may not be an optimal choice and further improvements can be expected, preferably using more theoretical approaches. a complementary perspective is to further elaborate the algorithm for estimating the fitting weights ψk, which may be implicitly dependent on the ideal quality curve.

we use nine marginal quality characteristics, which cover a broad range of different deviations from a normal  spot. therefore, it is possible that some of these parameters will not be relevant for a certain image. for example, if there are no clearly un-circular spots, the corresponding parameter  can be omitted. the optimization procedure will however report this, assigning a very low weight to the corresponding quality characteristic. these weights are then converted into the critical levels xilim⁡
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwg4baedaqhaawcbagaemyaakgajeaybagagiibawmaeiyaakmaeiyba0gaaaaa@3435@ using eq. , which will tolerate a big diversity in the possible values of the corresponding parameter. thus, the developed procedure both searches for the weights and implicitly reports on the relevance of the quality parameters to each particular image. however, if the images used to train the model  are not representative enough and do not contain enough spots with certain types of artifacts, some important sources of spot deficiency may be overlooked. in this case, manual adjustment of the weights may be necessary.

another problem is that generally a very small number of replicated spots  are available for the analysis. therefore it is possible that all spots from a replicate, being defective, demonstrate consistent cy5/cy <dig> ratio values. however, we expect that is less probable than to observe unusually high diversity in the ratio estimates for these replicates. if all spots from a consistent replicate are actually good, but they are erroneously assigned low quality values, this is an indication of some problems in the quality analysis itself. this situation would possibly require user participation to correct for the selected set of quality characteristics and/or for the corresponding quality weights wi.

we have demonstrated a possibility to carry out the quality analysis using replicated spots from different arrays. an additional procedure of the image normalization should precede the quality analysis in this case.

authors' contributions
en conceived the algorithm, performed software implementation and drafted the manuscript. eb conceived of the study and participated in coordination. all authors read and approved the final manuscript.

