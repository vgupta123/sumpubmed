BACKGROUND
increased adoption of high-throughput, whole-genome gene expression analysis technologies has led to an increased focus on the reliability of the experimental measurements they produce. several recent articles have provided substantial evidence that systematic noise introduced as a result of batch-processing have a detrimental effect on data derived from microarrays  <cit> . complete confounding of batches of array scans  with the variable under investigation can completely undermine reported results. for example, re-analysis of a study by spielman et al.  <cit>  revealed that samples from each of their studied populations were processed separately  and that after application of a standard batch-correction method  <cit>  none of the genes initially reported remained significantly differentially expressed  <cit> . several studies have attempted to assess reliability and consistency of array measurements and estimate potential sources of confounding systematic noise in an e ort to reduce these vulnerabilities  <cit> . the microarray quality control  project was established to explore inter-platform and inter-laboratory consistency of microarray-derived gene expression datasets using two reference rna samples  <cit> , as well as consistency of differential expression estimates  <cit> . these studies reported generally good consensus between replicate samples across technologies and laboratories, however the latter found the greatest level of consistency in results-lists between platforms was achieved when probes were ranked by decreasing fold-change with a generous p-value cutoff  <cit> . despite this finding, it is still the case that most published studies determine whether or not genes are differentially expressed based on the significance of statistical tests. our own previous studies have reported compelling evidence for the existence of confounding batch effects in affymetrix and illumina experiments performed in the same laboratory using a single platform  <cit> . it has also been shown that batch effects can be mitigated using per-probe batch-correction methods such as mean-centring  <cit> , distance-weighted discrimination   <cit> , or empirical-bayes corrections  <cit> .

awareness of and protection from batch effects is of particular importance in meta- or re-analyses of existing data, collated from multiple sources, where the intention is to exploit increased statistical power to detect subtle differences in expression between well-defined phenotypes. direct comparison and integration of gene expression data through re-analyses is a highly attractive option due to data repositories such as the ncbi gene expression omnibus   <cit>  and array express hosted by the european bioinformatics institute  <cit> . unfortunately appraising the quality of publicly available data is not a trivial task and, even when the submission guidelines are followed completely, it can be difficult to identify technical issues that may lead to systematic noise in subsequent analysis that potentially compromise results. it is important therefore to have an appreciation of the relative sources of systematic error throughout the experiment to prioritise which elements of meta-data should accompany published datasets and, subsequently, how to evaluate the experiment design to enable reliable re-analysis or integration of published data.

given previously reported variation in various array technologies  <cit> , we wished to quantify the relative noise introduced at various stages in the experimental process prior to array scanning; including the choice of experimental protocol, array-version, and study design. in addition, we assess different types of control sample in terms of their ability to model batch effects and also consider correlations to specific properties of array probes. in this study, we present an analysis of in-house affymetrix  and illumina  datasets in addition to those generated as part of the maqc project  <cit>   in order to assess the relative bias introduced in microarray results.

RESULTS
relative sources of systematic noise associated with various stages in the affymetrix experiment workflow
in order to establish the relative impact of different sources of systematic noise we compared the expression profiles and numbers of consistently differentially expressed genes when compensating for variation introduced at a single or at multiple steps in the affymetrix genechip sample-processing workflow. the dataset, previously reported in  <cit> , consisted of mcf <dig> and mcf10a samples for which technical replicates were available at several stages of sample preparation . we previously observed that the variability introduced by different generations of array platform or amplification protocol was larger than that attributed to the choice of scanner used for image-capture. this was also reflected in the number of commonly differentially expressed genes across datasets , which were fewer between platforms/protocols than between scanners. in the current study, we found that when batch correction  is performed to enable integration of these datasets, compensating for the bias introduced by amplification and labelling resulted in much greater consistency in gene-lists  than correcting for the scanner , see figure  <dig>  correction for significant sources of systematic error is required to improve the likelihood of consistently identifying differentially expressed genes from different datasets, but these approaches do not completely remove all sources of technical error.

variance analysis of this dataset provided a more detailed breakdown of the estimated biological and technical error introduced at the various stages of sample-preparation . the majority of the probesets show far greater inter-sample variability than between the two cell-lines. cell-line to cell-line  variability, mean-averaged over all probesets, contributed  <dig> % to the total standard deviation; compared to  <dig> % due to inter-sample variability,  <dig> % due to amplification/labelling,  <dig> % &  <dig> % for inter array and inter-scanner, and  <dig> % at the within-scanner/residual level. the arrays were preprocessed using the popular rma algorithm for background correction followed by quantile normalisation , however not performing any background correction resulted in a similar relative variance pro le but noticeably reduced absolute variances . either with or without background correction, this error pro le is not at all dissimilar to error estimates obtained from the various stages of sample preparation prior to a qpcr experiment in which the sampling step is usually by far the most variable while the noise introduced during reverse-transcription is generally low, but can sometimes be larger than sampling error  <cit> .

technical processing noise across illumina beadarray chip, runs, and experiments
variance estimates were calculated for each of  <dig>  probes at the inter-experiment, inter-run, and inter-chip level using a nested analysis of variance described in methods . the inter-experiment variance was the parameter with the greatest source of measurement noise, accounting for an average  <dig> % of the total variation in reported gene expression. this is likely to be due to the use of a fresh round of amplification and labelling performed on the uhrr samples between experiments. despite an overall reduction in the technical variation between probes, the fraction of the total variance contributed by each level  was unaffected by standard, array-wise, quantile normalisation. specific, probe-wise, batch correction greatly reduces the technical variation due to experiment and run . the slight effect due to the within-batch variance moderation can be measured in the reduction in inter-chip sd after either run of combat. the high inter-chip variation, compared to inter-run variation, appears to be driven by the new samples run on the ht- <dig> chips as this was not observed in the standalone analyses of the ref- <dig> data alone. as with the affymetrix data we explored the effect of background correction on these variances ; the practice of correcting for background signal in illumina arrays is not as common as when processing affymetrix data so we compared variances between preprocessing using quantile normalisation with no background correction to those after using the neqc function in limma package, which uses the various negative control probes on an illumina array to compensate for background signal prior to quantile normalisation. as with the affymetrix arrays it is clear that performing additional background correction has little effect on the relative variance structures but generally inflates the magnitudes of the estimated variances.

a similar variance analysis was also performed, for comparison, using the maqc illumina human- <dig> expression beadchip  dataset  <cit> . expression levels for  <dig>  probes were subjected to the same detection-filtering criteria as our ref- <dig> and ht- <dig> chips and the expressions of  <dig>  surviving probes were quantile normalised prior to variance analyses. the design of the maqc experiment only allowed for variance components to be estimated for the inter-laboratory, inter-chip, and inter-array levels. however, compared to the ref-8/ht- <dig> inter-experiment standard deviations, the maqc inter-laboratory standard deviations were much smaller; less than half as much on average . this is likely to be a result of our use of different array-versions and widely different dates on which the arrays were processed . however it is noteworthy that the majority of the variance in the maqc dataset was attributable to the intra-chip  level and this is the only dataset, for which variance analyses were performed, in which this phenomenon holds. variance analysis of the maqc affymetrix u <dig> plus <dig>  dataset  revealed a more familiar variance pattern, similar to that observed in our experiments, in which the majority of the variation is directly attributable to systematic differences between the different laboratories performing the experiments . the estimated standard deviations at the inter-laboratory level in these data were similar to those observed at the inter-experiment level in the combined ref-8/ht- <dig> data, as were the distributions of the coefficients of variation .

the pearson-correlation heatmaps in figure  <dig> demonstrate that the majority of the variation between replicate uhrr samples in our ref-8/ht- <dig> data was introduced as a result of the three separate experiments . however, somewhat surprisingly, the poorest correlations exist between the two experiments involving the ht- <dig> chips  as opposed to . as previously observed, standard normalisation techniques based on array-wide intensity distributions, such as by quantiles or splines, do little to improve probe-wise correlations between replicate samples  <cit> . there is also an apparent band of poorer correlation corresponding to a single ht- <dig> chip in run  <dig> . for consistency with the control samples hybridised to the ref- <dig> chips, two replicates of the original uhrr were retrieved from storage and added to one chip in each run with the ht- <dig> chips in experiment  <dig>  however, only a marginal improvement was observed in the correlation of these old uhrr samples compared to the freshly amplified and labelled replicates . although, again, the sample on chip  <dig> was more poorly correlated with the uhrr samples on the ref- <dig> chips than that hybridised to chip  <dig>  despite this chip appearing normal in all standard qc checks and internal controls except, perhaps, for slightly smaller bead-level standard errors compared to the other chips .

all uhrr data were subjected to batch-correction using combat and correction at two levels was assessed: experiment-wise and run-wise correction. following combat correction by experiment, all pairwise correlations increased to approximately the same level observed in the quantile-normalised ref- <dig> data obtained from the first experiment . however, we found previously that despite high correlation between uhrr replicates the consistency between lists of statistically significant differentially expressed probes from duplicate sets of samples was poor without specific batch-correction  <cit> . following combat correction by run, correlations in these new uhrr samples approach those observed in the original, combat batch-corrected uhrr samples from the first experiment .

inter-batch calibrators: comparing uhrr with pools of tumour sample rna
two controls of pooled clinical breast-tumour rna were run on each of the four beadchips in experiment  <dig> . one pool was created from a mix of all seven pre-treatment samples run in this experiment and the second pool was created using all seven post-treatment samples . results of pairwise pearson-correlations between these pooled samples identified a large difference between chip  <dig> and the other three chips used in this experiment , consistent with that seen with the uhrr. no obvious differences were observed in the correlations between the different pools composed of either pre- or post-treatment rna. in general, the correlations appeared similar to those observed between replicate uhrr samples illustrated in figure  <dig>  as noted before, quantile normalisation does little to remedy the poor correlation between chip  <dig> and the other chips, but this is remedied with combat by treating the batches either as runs  or, slightly better, as separate chips .

compared to the uhrr samples in experiment  <dig> , variance components estimated by nested-anova between the pooled tumour samples  in experiment  <dig> both show a large inter-chip/intra-batch effect. the larger magnitude of variation supports the increased inter-chip component in uhrr and it is clear from both the correlations and the variance estimates of both the uhrr and tumour pools that the variance in the ht- <dig> data is driven by a particular chip , rather than between runs as was the case in the ref- <dig> arrays.

gene expression in this small group of samples was rather varied, resulting in only  <dig> probes significantly differentially expressed following treatment that also survived multiple-testing correction at q <  <dig> ; the same  <dig> probes appeared in every results list regardless of normalisation or batch-correction. despite the apparent low level of biological variation between the pre- and post-treatment samples and small number of significantly differentially expressed genes, both the uhrr and the pools accurately reproduced the fold-changes between duplicate tumour samples across the two runs . we calculated the differences in expression across the two batches for all duplicate pairs of tumour samples and also between the uhrr/pool replicates. the correlation between differences observed in the tumour duplicates and either the uhrr or pool controls increased with the magnitude of the difference, although both the pre-and post-tumour pools were found to be significantly better correlated compared to uhrr . we also performed an exhaustive comparison of the fold-change in expression due to the different runs between the replicate pools of pre-treatment tumour rna and each of the fold-changes between duplicate tumour samples . in many cases there was strong agreement between absolute expression differences observed in the pool and the individual tumour duplicates, however such agreement is not necessary in order for the effect to be removed by combat, or alternative correction methods, as the absolute magnitude of the effect is explicitly normalised during the correction procedure.

properties of the probes with respect to batch variation
in order to assess if batch effects are uniform across all genes, we investigated whether the properties of the probes themselves were affected by different sources of systematic error . several descriptive statistics were selected to serve as measures of probe- and mapping-specific properties that could conceivably influence probe expression  <cit> . these included compositional properties such as the guanine and cytosine  nucleotide content as well as mapping properties such as the position of the probe as a fraction of the total length of the target gene, the number of  transcripts consecutively probed, and the average number of exons within the probed gene; with the number of known transcripts and number of exons acting as proxies for gene complexity and size, respectively.

the distribution of gc-content over the illumina ht- <dig> probes  clearly shows that they have been designed with a bias such that the nucleotide distribution of the probes themselves favour a greater-than-random fraction of gc-nucleotides. the gc-fraction distribution of the  <dig>  probes used in the analysis of run-induced fold change is plotted as a gaussian-smoothed probability density in figure 6b-top. also plotted is the distribution of the subset of these probes found to be more than 2-fold up- or down-regulated due to the batch effect in any of the  <dig> duplicate sample pairs. these two distributions are very similar, suggesting that a large number of these technical effects are random fluctuations independent of gc-content. however the distribution of any probe found to be more than 2-fold up- or down-regulated due to the batch effect in at least  <dig> of the duplicate sample pairs was significantly biased towards a lower gc-fraction . taking this further, we correlated probe gc-fraction with error estimates from the ref-8/ht- <dig> uhrr replicates , revealing highly significant enrichment for higher standard deviations  at lower gc-fractions  at the inter-experiment  and inter-run  levels, but not at the inter-chip level . no significant association was observed between low-signal probes and gc-content, however a small but significant enrichment for highly-signal-low-gc probes was found .

we also compared probe gc content with our variance estimates from the maqc illumina and affymetrix datasets, both of which have a similar overall distribution of probe-gc content, skewed in favour of higher gc fraction . a significant enrichment for low-gc-high-sd probes was again observed, both at the inter-laboratory level  and at the inter-chip level . as with the ref-8/ht- <dig> data, there was no significant enrichment at the lowest level between replicate arrays. to determine whether this low-gc-high-sd association was resolvable between biological as well as technical replicates, we chose a subset of pre-and post-treatment samples from our illumina ref- <dig> dataset . despite a slightly greater number of probes with low-gc-high-sd in both the pre- and post-treatment sample-sets, the trend was not significant .

the subset of pre-treatment biological replicates from run  <dig> and non-duplicated post-treatment biological replicates from run  <dig> were also used to test for any association between probe-mapping properties and batch effects. for each probe, the standard deviation between the pre-treatment samples and, separately, the post-treatment samples were assessed against probe position in the target gene, number of concurrently probed transcripts, and the number of exons in the target gene. the distribution of probe-location as a fraction of gene length among the ref- <dig> probes is shown in additional file  <dig>  after adjusting for the strand of the target, there was no significant association for increased standard deviations of probes proximal to either the 3' or 5' end. to test whether probe-mapping may correlate with variation between replicate crna-syntheses, a similar analysis was performed using the maqc illumina dataset. these probes have a distribution similar to the ref- <dig> arrays and the analyses again revealed no significant enrichment for estimated standard deviation due to probe position . it is therefore likely that such probe-mapping effects can only be resolved when probes target different regions of the transcript, rather than for probes targeting the same region being affected by biological or technical variability.

discussion
microarrays represent a powerful means of rapidly assessing genome-wide expression patterns. unfortunately confounding technical variation and systematic error in array technologies presents a major obstacle to their adoption for clinical diagnostics in humans. these factors are rarely documented, poorly understood, and their implications for experimental and clinical utility of microarrays frequently ignored  <cit> . building on previous investigations of technical variation between replicate rna samples from breast tumour biopsies, this extended study used both illumina and affymetrix arrays to explore the reliability of reported expressions across a variety of experiment designs. re-analysis of our mcf <dig> and mcf10a affymetrix datasets demonstrated that not compensating for one batch effect, such as the use of a different scanner  would have a much smaller effect on the numbers of genes identified as commonly differentially expressed, than another batch effect .

using a large combined dataset of conserved, reliably-detected probes on illumina ref- <dig> and ht- <dig> beadchips  we found that the correlation between replicate uhrr hybridisations were consistently poorer than correlations previously reported using the ref- <dig> data alone  <cit> . interestingly, we found that labelled uhrr samples from the original experiment, which were stored at -80°c for approximately two years, hybridised to two arrays on the new ht- <dig> chips correlated better with the original ref- <dig> samples than did freshly prepared uhrr replicates. this suggests that even long periods of frozen storage and additional freeze-thaw cycles introduce less noise into experimental measurements than that inherent in creating a new preparation of labeled crna, even from the same rna source.

as in our previous investigation  <cit> , quantile normalisation did little to improve correlation between the uhrr replicates across the ref-8/ht- <dig> dataset. however specific batch-correction using combat  <cit>  once again significantly improved correlations and is a valuable tool for removing systematic error introduced between experiments and/or processing runs. the inter-chip variation in the new ht- <dig> datasets was almost double what it was in the ref- <dig> dataset and due to this increase in inter-chip variation and high-levels of inter-experiment variation, the inter-run variation in the combined dataset was largely obscured. however, as we have previously seen, inter-experiment and inter-run variances were largely eliminated following combat corrections.

variance estimates using the maqc illumina dataset were smaller in magnitude to the variances obtained from our ref- <dig> data, revealing a surprisingly high level of reliability between the three laboratories that performed these experiments. in contrast, the maqc affymetrix dataset was found to be far more variable than their illumina data but similar to the magnitudes of variance observed in both our combined ref-8/ht- <dig> dataset and our affymetrix dataset. the reason for the low variation in the maqc illumina data is unknown, especially since their study design deliberately split the sample replicates before crna synthesis; a much earlier stage in the sample-prep workflow than our replicates . it is possible that the small number of laboratories  performing the maqc illumina hybridisations produced highly concordant data completely by chance, while the larger number of laboratories  performing the affymetrix experiments provided a more realistic reflection of the technical variation in these data.

pooled sample vs. uhrr as batch-effect calibrators
several studies have found the use of replicate control samples such as uhrr to be a useful standard in microarray experiments, suitable for monitoring expression consistency within and across a variety of genome-wide expression platforms  <cit> . however, such commercial controls are deliberately generic and deficiencies have been reported in terms of how well they represent specific cell types  <cit> . clearly uhrr is not representative of breast tumour rna and therefore carries no guarantee of expressing rnas that may be variably expressed in the specific subset of genes changed in breast tumour tissue. therefore, in terms of compensating for confounding technical variation, the very probes for which the correction is most important are those that are most neglected in the uhrr controls.

unfortunately the relatively small degree of legitimate biological differential expression between the pre-and post-treatment tumour biopsies provided little opportunity to assess the relative performance of uhrr and pooled batch calibrators on the consistency of reported differentially expressed probes. however, compared to the uhrr, the pooled tumour rna controls were shown to more faithfully emulate the individual shift in expression between tumour technical-duplicates as a result of variation introduced between runs and between chips. had it been possible to identify more legitimately differentially expressed probes between pre- and post-treatment samples, the pooled rna would almost certainly have made for a better batch-calibrator during combat correction than the uhrr controls. if a similar pooled calibrator was used in our previous study it seems reasonable to speculate that the consistency between the gene-lists reported as significantly differentially expressed would have been noticeably higher than the  <dig> % achieved using uhrr calibrators.

batch effects relative to probe position and composition
we took the opportunity to assess compositional properties of the probes as a potential explanation/surrogate for the technical effects observed in the ref-8/ht- <dig> data. a highly significant trend in favour of low-gc content was identified in the core set of probes consistently affected by inter-run and inter-chip variation between sample duplicates. a similar, but less significant, enrichment for low-gc-high-sd probes was also observed in the maqc illumina dataset. this suggests that the magnitude of error introduced due to low probe gc-content is sufficiently great that it is resolvable between the replicate crna preparations assessed in the maqc study. a similar observation regarding probe gc-content and expression consistency was recently reported in a comparison of rna preservation protocols, using matched samples, in terms of the effect on results of downstream expression analyses  <cit> . a further correlation of probe composition, specifically with respect to gc-content, has been reported previously in a spike-in experiment using illumina beadchips  <cit> , in which it was found that probes with high-gc content tended to have a higher than expected signal intensity, but probes with lower than average gc content had inflated differential expression statistics. we found no such association between low-expression and gc-content, however we did observe a low-signal-low-gc association; therefore the notion of inflated differential expression stats for low-gc probes is supported not by probe intensity, but through greater variability in our data. the low-gc effect is likely to be related to thermodynamic properties of hybridisation favouring high-gc probes/targets, a supposition that is rational given the deliberate high-gc bias in the design of the illumina probesets. probes with low gc-content appear to be inherently more vulnerable to systematic error but, although highly statistically significant, the magnitude of this variation in our data was small relative to that between biological replicates. it is therefore somewhat unlikely that such variation would pose a threat to the accurate classification of samples and, even in an experiment in which groups of biological replicates are poorly distributed across chips and runs, is also unlikely to be a serious confound to statistical tests for differential expression.

the proximity, with respect to the target transcript, of probes has been reported to strongly influence the correlation of expression measurements between technologies  <cit> . the analyses performed here were designed to assess whether such probe-transcript mapping influenced expressions reported by the same platform, however no such correlation was observed either between biological or technical replicate samples. a more thorough analysis of the maqc datasets would provide further insight into any relationship between probe-location and expression between a variety of different platforms and sample-preparation procedures.

CONCLUSIONS
the key source of systematic error in any given microarray experiment is unpredictable, but can generally be attributed to rna extraction and, to some extent, labelling and amplification protocols. the results presented here, including those derived from external data sources, suggest that it is not recommended to analyse individual test samples , but instead to run several at the same time to get a better estimate of the experimental variation in order to be better equipped to compensate for it.

sound experimental design is of critical importance to avoid confounding systematic variation. randomisation of samples over arrays on each beadchip and careful blocking of samples from each group of interest within and across runs is necessary to protect against confounding systematic error. in situations where this is not possible, detailed meta-data should be preserved for each array that includes, at the very least, the date and time of each hybridisation and scan. in either case, diagnostic procedures such as pca or sva should be routinely performed prior to downstream array analyses.

