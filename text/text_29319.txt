BACKGROUND
metabolomics is a discipline dedicated to the global study of metabolites, their dynamics, composition, interactions, and responses to interventions or to changes in their environment, in cells, tissues, and biofluids. concentration changes of specific groups of metabolites may be descriptive of systems responses to environmental or genetic interventions, and their study may therefore be a powerful tool for characterization of complex phenotypes  <cit>  as well as for development of biomarkers for specific physiological responses  <cit> .

study of the variability of metabolites in different states of biological systems is therefore an important task of systems biology. as we are primarily interested in systems responses resulting in metabolite level regulation as related to diverse genetic or environmental changes, it is important to separate such interesting biological variation from obscuring sources of variability introduced in experimental studies of metabolites. since multiple experimental platforms are commonly applied in the studies of metabolites  <cit> , the sources of the obscuring variation are many and platform specific  <cit> . such sources include variability arising from inhomogeneity of samples, their lability and inevitable minor differences in sample preparation. in mass spectrometry based detection, the sources include the variations in the ion source as well as matrix specific effects such as ion suppression  <cit> . following the measurement, the data preprocessing steps such as peak detection, peak integration and alignment may introduce an additional error.

chemical diversity of metabolites, leading for example to different recoveries during extraction or responses during ionization in mass spectrometer, makes separation of interesting and obscuring variation a difficult task. quantitative analytical methods have commonly relied on utilization of isotope labeled internal standard for each metabolite measured. however, in broad metabolic profiling approaches this is not practical. the number of metabolites is large, they are chemically too diverse to afford a common labeling approach, and many of them may not even be known. the availability of stable isotope labeled references is generally also very limited.

strategies for normalization of metabolic profile data can be divided into two major categories:

• statistical models used to derive optimal scaling factors for each sample based on complete dataset  <cit> , such as normalization by unit norm  <cit>  or median  <cit>  of intensities, or the maximum likelihood method  <cit>  adopted from the approach developed for gene expression data  <cit> .

• normalization by a single or multiple internal or external standard compounds based on empirical rules, such as specific regions of retention time  <cit> .

the statistical approach suffers from the lack of an absolute concentration reference for different metabolites. in addition, constraining the data to a specific norm based on total signal affects its covariance structure, therefore requiring special caution when pursuing multivariate analysis of such data  <cit> . metabolites as physiological end-points, largely affected by the environment, do not posses the self-averaging property, i.e. concentration increase in a specific group of metabolites is generally not balanced by a decrease of another group. the figure  <dig> illustrates this statement. two total ion chromatograms from ultra performance liquid chromatography coupled to mass spectrometry  lipidomics profiling of two different mouse liver samples are shown, one from an obese ob/ob mouse model and one from a lean wild type mouse. the ob/ob mouse model was developed by spontaneous mutation in ob gene resulting in lack of leptin  <cit>  and is commonly studied as a model for early onset of severe obesity. both types of mice have similar levels of phospholipids, but the amount of storage fat in the form of triacylglycerols is markedly increased in the obese mouse. if one would normalize this data based on total signal, such approach would lead to a conclusion that the phospholipids are decreased in the obese mouse , while the triacylglycerols are slightly increased . more sophisticated approaches to normalize metabolomics data based on full profile data have been adopted  <cit> , but the fundamental problem as described above remains.

the choice of multiple internal  and external  standard compounds may be a more reasonable choice, but even in that case the assignment of the standards to normalize specific peaks remains unclear. one possible approach is to assign a specific standard to metabolite peaks based on similarity in specific chemical property such as retention time in liquid chromatography  column. for example, bijlsma and colleagues utilize three external standard references for lipid profiling, chosen as mono-, di-, and tri-acyl lipid species representing most abundant lipid classes in their respective region of retention time  <cit> . such approach still suffers from at least two problems:

• the retention time is not necessarily descriptive of all matrix and chemical properties leading to obscuring variation. for example, in the lipid separation based on reverse phase lc diverse lipid species such as ceramides, sphingomyelins, diacylglycerols, and several phospholipid classes, are overlapping in retention time, and it is not reasonable to assume same normalization factor can be applied to all these species. the situation is even more complex when analyzing water soluble metabolites.

• the normalization by a single molecular component is very sensitive to its own obscuring variation, which becomes a problem in very complex samples where matrix specific effects such as ion suppression may play an important role.

recently we introduced a related approach for liquid chromatography – mass spectrometry  that normalizes metabolites based on multiple internal standards, with the normalization factor based on distance to the metabolite peaks both in the retention time and mass-to-charge ratio   <cit> . while such method partially resolves the second issue listed above, it still suffers from the ad hoc assignments of internal standard for each component based on a subset of relevant chemical properties.

none of the normalization methods mentioned above systematically take advantage of the obscuring variability that can be learned from the measured data itself. for example, monitoring multiple standard compounds across multiple sample runs may help determine how the standards are correlated, which variation is specific to a particular standard, and which patterns of variation are shared between the measured metabolites and the standards so they can be removed. in this paper we present a new approach to normalization of metabolomics data aiming to address these issues and develop a mathematical model that optimally assigns normalization factors for each metabolite measured based on internal standard profiles. we demonstrate the approach on mouse liver lipid profiling using uplc/ms, and compare its performance to two other commonly utilized approaches: normalization by l <dig> vector norm and by retention time region specific standard compounds. we discuss method performance and several application possibilities.

RESULTS
formulation of the normalization model
the unnormalized metabolomics data resulting from first stages of preprocessing, usually including peak detection and alignment  <cit> , can be represented by a matrix of n variables  and m objects . for example, in liquid chromatography mass spectrometry  based profiling; each peak is represented by mass to charge ratio  and retention time .

in the rest of the text we will use the following notation:

• i parameterizes peaks: i → {m/z, rt} and i =  <dig> ..n.

• s parameterizes peaks from internal standard compounds: s → {m/z, rt} and s =  <dig> ..s

• j parameterizes experiment runs: j =  <dig> ..m.

• x is n by m intensity matrix of metabolite peak profiles, with elements xij

• z is s by m intensity matrix of standard compound peak profiles, with elements zsj.

variation arising from the above mentioned sources is often intensity  dependent, larger variation being associated with higher intensities. the property that the magnitude of variation is not constant is commonly referred to as heteroscedasticity. therefore, it is reasonable to assume a multiplicative model for the observed intensities:

xij = mi × rij  × eij,     

where mi the intensity independent of the run , rij  is the correction factor, and eij the random error. we assume that the true intensity value depends only on index i. in practice this assumption means that we independently measure several samples from one biological specimen . this assumption is crucial when the normalization model is trained, i.e., when the parameters of the model are learned from the data, but it can be relaxed when the normalization is applied to a new set of data. reasons for this will become clear below.

the basic premise of our approach, abbreviated as nomis method , is that the systematic variation in measured intensities xij for an individual peak i can be modeled as a function of variation of standard compounds . based on this assumption, the correction factors rij can be determined from the profiles of standard compounds. we log transform the mulitiplicative model of equation 

y = log x, Ω = log z, μ = log m, ρ = log r , ε = log e     

to obtain an additive model:

yij = μi + ρij + εij.     

the randomness in the values of y is modeled by the error ρij that is drawn from the normal distribution with zero mean and variance σi2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfdpwcdaqhaawcbagaemyaakgabagaegomaidaaaaa@30f0@:

εij ~ n.     

we aim at removing the effect of ρij in equation  that we presume to represent such variation in the data that can be explained with changes in the levels of the standard compounds. for the sake of simplicity, we treat the observed values of the standards Ω as explanatory variables without modeling their error. we parameterize ρ as a linear function of the levels of internal standards:

ρij=∑sβis ,     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfbpgcdawgaawcbagaemyaakmaemoaaogabeaakiabg2da9maaqafabagae8nsdi2aasbaasqaaiabdmgapjabdohazbqabagcdaqadaqaaiabfm6axnaabaaaleaacqwgzbwccqwgqbgaaeqaaogaeyoei0yaaawaaeaacqqhpowvdawgaawcbagaem4camnaeiola4cabeaaaogaayzkjiaawqyiaagaayjkaiaawmcaaawcbagaem4camhabeqdcqghris5aogaeeiiaaiaeiilawiaaczcaiaaxmaadaqadaqaaiabiwda1agaayjkaiaawmcaaaaa@4cf8@

where the average 〈 〉 is taken over the samples j =  <dig> ..m, i.e. 〈Ωs.〉≡1m∑jΩsj
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaaadaqaaiabfm6axnaabaaaleaacqwgzbwccqgguaglaeqaaagccaglpmiaaypkjagaeyyyio7aasaaaeaacqaixaqmaeaacqwgnbqtaawaaabeaeaacqqhpowvdawgaawcbagaem4camnaemoaaogabeaaaeaacqwgqbgaaeqaniabgghildaaaa@3e3a@. the parameters β therefore relate the variability of internal standard intensities with the variability of intensities of endogenous metabolite peaks, i.e. bigger the parameter βis, bigger is the contribution of internal standard's s variability to the normalization correction factor of metabolite peak i.

from the equations  it follows that yij can be modeled as normally distributed,

yij ~ n,     

therefore the log likelihood l of observing data y under the assumption of normality is

ℒ=log⁡)==−12∑ij+)2σi2) .     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaat0uy0hwztfgdpnwy1egaryqthrhal1wy0l2yhvdaiqaacqwfsectcqgh9aqpcyggsbabcqggvbwbcqggnbwzdaqadaqaamaarafabagaemiuaa1aaewaaeaacqwgzbqwdawgaawcbagaemyaakmaemoaaogabeaakiabcyha8hgaciab+x7atnaabaaaleaacqwgpbqaaeqaaogaeiilawiae4xwdi3aasbaasqaaiabdmgapjabdqgaqbqabagccqggsaalcqgfdpwcdaqhaawcbagaemyaakgabagaegomaidaaagccagloagaayzkaaaaleaacqwgpbqacqwgqbgaaeqaniabg+givdaakiaawicacaglpaaacqgh9aqpcqgh9aqpcqghsisldawcaaqaaiabigdaxaqaaiabikdayaaadaaeqbqaamaabmaabagagiibawmaei4ba8maei4zac2aaewaaeaacqaiyagmcqgfapaccqgfdpwcdaqhaawcbagaemyaakgabagaegomaidaaagccagloagaayzkaagaey4kasyaasaaaeaadaqadaqaaiabdmfaznaabaaaleaacqwgpbqacqwgqbgaaeqaaogaeyoei0iae4hvd02aasbaasqaaiabdmgapbqabagccqghsisldaaeqbqaaiab+j7ainaabaaaleaacqwgpbqacqwgzbwcaeqaaowaaewaaeaacqqhpowvdawgaawcbagaem4camnaemoaaogabeaakiabgkhitmaaamaabagaeuyqdc1aasbaasqaaiabdohazjabc6cauaqabaaakiaawmyicaglqmcaaiaawicacaglpaaaasqaaiabdohazbqab0gaeyyeiuoaaogaayjkaiaawmcaamaacaaaleqabagaegomaidaaagcbagae43wdm3aa0baasqaaiabdmgapbqaaiabikdayaaaaaaakiaawicacaglpaaaasqaaiabdmgapjabdqgaqbqab0gaeyyeiuoakiabbccagiabb6cauiaaxmaacawljawaaewaaeaacqqg3awnaiaawicacaglpaaaaaa@9ce2@

we note that the simple form of equation  is due to the assumption of independence of the random errors in equation , both across different sample measurements and across different metabolites. while the former assumption is easy to accept, the latter assumption is arguable, because it is well known that co-regulated metabolites are highly correlated  <cit> . however, in order to keep the number of parameters in the model moderate, we decided to adhere to the latter assumption, being aware of its possible effect on the precision of the parameter estimates  <cit> .

we solve for the values of parameters μi, βis, and σi2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfdpwcdaqhaawcbagaemyaakgabagaegomaidaaaaa@30f0@ that maximize the log likelihood of observing the data:

arg⁡max⁡μi,βis,σi2ℒ
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadawfqaqaaigbcggahjabckhayjabceganjgbc2gatjabcggahjabciha4bwcbaaccigae8hvd02aasbaawqaaiabdmgapbqabawccqggsaalcqwfyogydawgaaadbagaemyaakmaem4camhabeaaliabcycasiab=n8aznaadaaameaacqwgpbqaaeaacqaiyagmaaaaleqaamrthrhal1wy0l2yhvtyaehbnfgdovwbhrxajfwnagabaogae4nehweaaa@4dd5@

setting ∂ℒ
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbamrthrhal1wy0l2yhvtyaehbnfgdovwbhrxajfwnaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabawaaegaeaaakeaaimaacqwfsectaaa@376e@/∂μi =  <dig>  ∂ℒ
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbamrthrhal1wy0l2yhvtyaehbnfgdovwbhrxajfwnaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabawaaegaeaaakeaaimaacqwfsectaaa@376e@/∂βis =  <dig>  and ∂ℒ
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbamrthrhal1wy0l2yhvtyaehbnfgdovwbhrxajfwnaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabawaaegaeaaakeaaimaacqwfsectaaa@376e@/∂σi =  <dig> leads to the following equations:

μi=1m),     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwf8oqbdawgaawcbagaemyaakgabeaakiabg2da9maalaaabagaegymaedabagaemyta0eaamaabmaabawaaabuaeaacqwgzbqwdawgaawcbagaemyaakmaemoaaogabeaaaeaacqwgqbgaaeqaniabgghildgccqghsisldaaeqbqaaiab=j7ainaabaaaleaacqwgpbqacqwgzbwcaeqaaowaaewaaeaacqqhpowvdawgaawcbagaem4camnaemoaaogabeaakiabgkhitmaaamaabagaeuyqdc1aasbaasqaaiabdohazjabc6cauaqabaaakiaawmyicaglqmcaaiaawicacaglpaaaasqaaiabdqgaqjabcycasiabdohazbqab0gaeyyeiuoaaogaayjkaiaawmcaaiabcycasiaaxmaacawljawaaewaaeaacqai5aqoaiaawicacaglpaaaaaa@5946@

∑j=∑tβit, and     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaaeqbqaamaabmaabagaemywak1aasbaasqaaiabdmgapjabdqgaqbqabagccqghsisliigacqwf8oqbdawgaawcbagaemyaakgabeaaaogaayjkaiaawmcaaawcbagaemoaaogabeqdcqghris5aowaaewaaeaacqqhpowvdawgaawcbagaem4camnaemoaaogabeaakiabgkhitmaaamaabagaeuyqdc1aasbaasqaaiabdohazjabc6cauaqabaaakiaawmyicaglqmcaaiaawicacaglpaaacqgh9aqpdaaeqbqaaiab=j7ainaabaaaleaacqwgpbqacqwg0badaeqaaowaaewaaeaacqqhpowvdawgaawcbagaemidaqnaemoaaogabeaakiabgkhitmaaamaabagaeuyqdc1aasbaasqaaiabdsha0jabc6cauaqabaaakiaawmyicaglqmcaaiaawicacaglpaaadaqadaqaaiabfm6axnaabaaaleaacqwgzbwccqwgqbgaaeqaaogaeyoei0yaaawaaeaacqqhpowvdawgaawcbagaem4camnaeiola4cabeaaaogaayzkjiaawqyiaagaayjkaiaawmcaaawcbagaemidaqhabeqdcqghris5aogaeiilawiaeeiiaaiaeeyyaemaeeoba4maeeizaqmaaczcaiaaxmaadaqadaqaaiabbgdaxiabbcdawagaayjkaiaawmcaaaaa@746f@

σi2=1m∑j) <dig>      
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfdpwcdaqhaawcbagaemyaakgabagaegomaidaaogaeyypa0zaasaaaeaacqaixaqmaeaacqwgnbqtaawaaabuaeaadaqadaqaaiabdmfaznaabaaaleaacqwgpbqacqwgqbgaaeqaaogaeyoei0iae8hvd02aasbaasqaaiabdmgapbqabagccqghsisldaaeqbqaaiab=j7ainaabaaaleaacqwgpbqacqwgzbwcaeqaaowaaewaaeaacqqhpowvdawgaawcbagaem4camnaemoaaogabeaakiabgkhitmaaamaabagaeuyqdc1aasbaasqaaiabdohazjabc6cauaqabaaakiaawmyicaglqmcaaiaawicacaglpaaaasqaaiabdohazbqab0gaeyyeiuoaaogaayjkaiaawmcaamaacaaaleqabagaegomaidaaaqaaiabdqgaqbqab0gaeyyeiuoakiabc6cauiaaxmaacawljawaaewaaeaacqaixaqmcqaixaqmaiaawicacaglpaaaaaa@5e45@

since ∑jΩsj≡∑j〈Ωs.〉
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaaeqaqaaiabfm6axnaabaaaleaacqwgzbwccqwgqbgaaeqaaaqaaiabdqgaqbqab0gaeyyeiuoakiabggmi6oaaqababawaaawaaeaacqqhpowvdawgaawcbagaem4camnaeiola4cabeaaaogaayzkjiaawqyiaawcbagaemoaaogabeqdcqghris5aaaa@3f61@, the equation  leads to

μi = 〈yi.〉.     

the equation  can be written as a matrix product:

Ξis=∑tβitΣts ,     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqqheoawdawgaawcbagaeeyaakmaee4camhabeaakiabg2da9maaqafabaaccigae8nsdi2aasbaasqaaiabbmgapjabbsha0bqabagccqqhjowudawgaawcbagaemidaqnaem4camhabeaaaeaacqqg0badaeqaniabgghildgccqqggaaicqqgsaalcawljagaaczcamaabmaabagaeeymaejaee4mamdacagloagaayzkaaaaaa@4542@

where

Ξis=∑j     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqqheoawdawgaawcbagaemyaakmaem4camhabeaakiabg2da9maaqafabawaaewaaeaacqwgzbqwdawgaawcbagaemyaakmaemoaaogabeaakiabgkhitmaaamaabagaemywak1aasbaasqaaiabdmgapjabc6cauaqabaaakiaawmyicaglqmcaaiaawicacaglpaaaasqaaiabdqgaqbqab0gaeyyeiuoakmaabmaabagaeuyqdc1aasbaasqaaiabdohazjabdqgaqbqabagccqghsisldaaadaqaaiabfm6axnaabaaaleaacqwgzbwccqgguaglaeqaaagccaglpmiaaypkjaaacagloagaayzkaagaaczcaiaaxmaadaqadaqaaiabigdaxiabisda0agaayjkaiaawmcaaaaa@537f@

correlates internal standards and endogenous metabolite peaks, while

Σts=∑j     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqqhjowudawgaawcbagaemidaqnaem4camhabeaakiabg2da9maaqafabawaaewaaeaacqqhpowvdawgaawcbagaemidaqnaemoaaogabeaakiabgkhitmaaamaabagaeuyqdc1aasbaasqaaiabdsha0jabc6cauaqabaaakiaawmyicaglqmcaaiaawicacaglpaaaasqaaiabdqgaqbqab0gaeyyeiuoakmaabmaabagaeuyqdc1aasbaasqaaiabdohazjabdqgaqbqabagccqghsisldaaadaqaaiabfm6axnaabaaaleaacqwgzbwccqgguaglaeqaaagccaglpmiaaypkjaaacagloagaayzkaagaaczcaiaaxmaadaqadaqaaiabigdaxiabiwda1agaayjkaiaawmcaaaaa@5469@

is a covariance matrix for the internal standards. multiplying each side of equation  by the inverse of matrix Σ, the estimates for the parameters β can be written as a product of two matrices:

β^=Ξ^×Σ− <dig>      
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiiqacuwfyogygaqcaiabg2da9iqb=55ayzaajagaey41aqrae83odm1aawbaasqabeaaiiaacqgfsislcqgfxaqmaagccqqgsaalcawljagaaczcamaabmaabagaeeymaejaeeonaydacagloagaayzkaaaaaa@3c20@

where the hat notation means that the matrices are evaluated using the actually observed data y. based on the multiplicative error model from equation, the normalized intensities for each peak are then calculated as

x˜ij=xij×exp⁡).     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgybawgaacamaabaaaleaacqwgpbqacqwgqbgaaeqaaogaeyypa0jaemiwag1aasbaasqaaiabdmgapjabdqgaqbqabagccqghxdatcygglbqzcqgg4baecqggwbacdaqadaqaaiabgkhitmaaqahabaaccigaf8nsdimbakaadawgaawcbagaemyaakmaem4camhabeaakmaabmaabagaeuyqdc1aasbaasqaaiabdohazjabdqgaqbqabagccqghsisldaaadaqaaiabfm6axnaabaaaleaacqwgzbwccqgguaglaeqaaagccaglpmiaaypkjaaacagloagaayzkaaaaleaacqwgzbwccqgh9aqpcqaixaqmaeaacqwgtbwua0gaeyyeiuoaaogaayjkaiaawmcaaiabb6cauiaaxmaacawljawaaewaaeaacqqgxaqmcqqg3awnaiaawicacaglpaaaaaa@5ce3@

once the model has been trained, i.e., the parameter β has been estimated, it can be applied to a new data of samples from a similar biological experiment with arbitrary true metabolite levels, that is, in equation  <dig> the true level, mij, can be sample dependent.

normalization in case of a single internal standard
in order to present an intuitive example of how the nomis method works, we demonstrate it in a hypothetical case of a single internal standard. in this case the intensity matrix of internal standard peaks z is a  <dig> × m vector j =  <dig> .m and the equations

 and  straightforwardly lead to:

x˜ij=xij×1mz1j)ri1σ12;     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgybawgaacamaabaaaleaacqwgpbqacqwgqbgaaeqaaogaeyypa0jaemiwag1aasbaasqaaiabdmgapjabdqgaqbqabagccqghxdatdaqadaqaamaalaaabawaaewaaeaadaqewbqaaiabdqfaanaabaaaleaacqaixaqmcqwgrbwaaeqaaaqaaiabdugarjabg2da9iabigdaxaqaaiabd2eanbqdcqghpis1aagccagloagaayzkaawaawbaasqabeaadawcaaqaaiabigdaxaqaaiabd2eanbaaaaaakeaacqwgabgwdawgaawcbagaegymaejaemoaaogabeaaaaaakiaawicacaglpaaadaahaawcbeqaamaalaaabagaemocai3aasbaawqaaiabdmgapjabigdaxaqabaaaleaaiigacqwfdpwcdaqhaaadbagaegymaedabagaegomaidaaaaaaagccqgg7awocawljagaaczcamaabmaabagaegymaejaegioagdacagloagaayzkaaaaaa@598c@

where

ri1=∑j=1m, and     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgybgcdawgaawcbagaemyaakmaegymaedabeaakiabg2da9maaqahabawaaewaaeaacyggsbabcqggvbwbcqggnbwzcqwgybawdawgaawcbagaemyaakmaemoaaogabeaakiabgkhitmaaamaabagagiibawmaei4ba8maei4zacmaemiwag1aasbaasqaaiabdmgapjabc6cauaqabaaakiaawmyicaglqmcaaiaawicacaglpaaadaqadaqaaigbcygasjabc+gavjabceganjabdqfaanaabaaaleaacqaixaqmcqwgqbgaaeqaaogaeyoei0yaaawaaeaacyggsbabcqggvbwbcqggnbwzcqwgabgwdawgaawcbagaegymaejaeiola4cabeaaaogaayzkjiaawqyiaagaayjkaiaawmcaaawcbagaemoaaomaeyypa0jaegymaedabagaemyta0eaniabgghildgccqggsaalcqqggaaicqqghbqycqqgubgbcqqgkbazcawljagaaczcamaabmaabagaeeymaejaeeyoakdacagloagaayzkaaaaaa@6a93@

σ12=∑j=1m <dig>      
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfdpwcdaqhaawcbagaegymaedabagaegomaidaaogaeyypa0zaaabcaeaadaqadaqaaigbcygasjabc+gavjabceganjabdqfaanaabaaaleaacqaixaqmcqwgqbgaaeqaaogaeyoei0yaaawaaeaacyggsbabcqggvbwbcqggnbwzcqwgabgwdawgaawcbagaegymaejaeiola4cabeaaaogaayzkjiaawqyiaagaayjkaiaawmcaamaacaaaleqabagaegomaidaaaqaaiabdqgaqjabg2da9iabigdaxaqaaiabd2eanbqdcqghris5aogaeiola4iaaczcaiaaxmaadaqadaqaaiabikdayiabicdawagaayjkaiaawmcaaaaa@5285@

we write the internal standard levels as

log z1j = c + ωj,     

with c = 〈Ω <dig> 〉 being the mean and ωj deviation of sample j from the mean:

ωj = Ω1j - 〈Ω <dig> 〉. we model the endogenous metabolite peaks as:

log xij = ti + βiωj + εij,     

where ti is the true log intensity of metabolite i's peak, βi is a parameter that describes by how many units the log intensity of peak i changes when the log intensity of the standard increases by one unit, and εij is a random error drawn from a normal distribution with zero mean. the coefficients ri <dig> and σ12
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfdpwcdaqhaawcbagaegymaedabagaegomaidaaaaa@3085@ from equations  and  can then be written as

ri1=βiσi2+∑j=1mεijωjand     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaafaqabeqacaaabagaemocai3aasbaasqaaiabdmgapjabigdaxaqabagccqgh9aqpiigacqwfyogydawgaawcbagaemyaakgabeaakiab=n8aznaadaaaleaacqwgpbqaaeaacqaiyagmaagccqghrawkdaaewbqaaiab=v7alnaabaaaleaacqwgpbqacqwgqbgaaeqaaogae8xydc3aasbaasqaaiabdqgaqbqabaaabagaemoaaomaeyypa0jaegymaedabagaemyta0eaniabgghildaakeaacqqghbqycqqgubgbcqqgkbazaagaaczcaiaaxmaadaqadaqaaiabikdayiabiodazagaayjkaiaawmcaaaaa@5150@

σ12=∑j=1mωj <dig>      
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfdpwcdaqhaawcbagaegymaedabagaegomaidaaogaeyypa0zaaabcaeaacqwfjpwddaqhaawcbagaemoaaogabagaegomaidaaaqaaiabdqgaqjabg2da9iabigdaxaqaaiabd2eanbqdcqghris5aogaeiola4iaaczcaiaaxmaadaqadaqaaiabikdayiabisda0agaayjkaiaawmcaaaaa@4229@

if we ignore the effect of the residual term in the ri1/σ12
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfdpwcdaqhaawcbagaegymaedabagaegomaidaaaaa@3085@ ratio:

ri1σ12=βi+ ∑j=1mεijωj∑j=1mωj <dig>      
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadawcaaqaaiabdkhaynaabaaaleaacqwgpbqacqaixaqmaeqaaagcbaaccigae83wdm3aa0baasqaaiabigdaxaqaaiabikdayaaaaagccqgh9aqpcqwfyogydawgaawcbagaemyaakgabeaakiabgucariabbccagmaalaaabawaaabcaeaacqwf1oqzdawgaawcbagaemyaakmaemoaaogabeaakiab=l8a3naabaaaleaacqwgqbgaaeqaaaqaaiabdqgaqjabg2da9iabigdaxaqaaiabd2eanbqdcqghris5aagcbawaaabcaeaacqwfjpwddaqhaawcbagaemoaaogabagaegomaidaaaqaaiabdqgaqjabg2da9iabigdaxaqaaiabd2eanbqdcqghris5aaaakiabcycasiaaxmaacawljawaaewaaeaacqaiyagmcqai1aqnaiaawicacaglpaaaaaa@59a3@

then the equation  reduces to

x˜ij≈xij×βi,     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgybawgaacamaabaaaleaacqwgpbqacqwgqbgaaeqaaogaeyisisraemiwag1aasbaasqaaiabdmgapjabdqgaqbqabagccqghxdatdaqadaqaamaalaaabagaemyta0eabagaemowao1aasbaasqaaiabigdaxiabdqgaqbqabaaaaagccagloagaayzkaawaawbaasqabeaaiigacqwfyogydawgaaadbagaemyaakgabeaaaagccqggsaalcawljagaaczcamaabmaabagaegomaijaegonaydacagloagaayzkaaaaaa@484d@

where m = exp. from equation  we see that βi = ci/c <dig>  with ci <dig> and c <dig> being estimators for the covariance between metabolite i and the standard and the variance of the standard respectively. the interpretation of the result is now straightforward. for example, if βi =  <dig>  i.e. the covariance of metabolite i with the standard is of the order of the variance of the standard, then the equation  describes a simple correction by the internal standard

x˜ij=mxijz1j .     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgybawgaacamaabaaaleaacqwgpbqacqwgqbgaaeqaaogaeyypa0jaemyta00aasaaaeaacqwgybawdawgaawcbagaemyaakmaemoaaogabeaaaoqaaiabdqfaanaabaaaleaacqaixaqmcqwgqbgaaeqaaaaakiabbccagiabb6cauiaaxmaacawljawaaewaaeaacqqgyagmcqqg3awnaiaawicacaglpaaaaaa@4159@

such correction is commonly applied to specific metabolites when their corresponding isotope labeled standards are available. in contrast, if a specific metabolite is uncorrelated to the internal standard, βi =  <dig>  and the normalization factor is  <dig>  leading to x˜
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgybawgaacaaaa@2df4@ij = xij. thus, if the linear association between a metabolite and the standard is weak, the nomis method reduces the extent of normalization.

in the following section we demonstrate the nomis method using the multiple internal standard applications in real biological samples.

method performance and comparison to other methods: mouse liver lipidomics dataset
in order to evaluate the performance of the nomis method, we performed uplc/ms analysis of mouse liver using lipidomics platform as described in methods. we run  <dig> replicates of the same biological sample in repeatability conditions, corresponding to  <dig> different extracts of  <dig>   <dig>  and  <dig> sample injections each, respectively. total  <dig> internal standard compounds of distinct chemical and functional characteristics were injected prior to extraction. total  <dig> monoisotopic peaks were detected using mzmine  <cit>  software version  <dig> . the processed dataset with partial identification is available as additional file  <dig> and the internal standards are listed in table  <dig> 

the performance of the nomis method is compared to two other methods. the first is a commonly utilized normalization by l <dig> vector norm   <cit> :

x˜ij=xij×〈∑i= <dig> ..nxi.2〉∑i= <dig> ..nxij2 ;     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgybawgaacamaabaaaleaacqwgpbqacqwgqbgaaeqaaogaeyypa0jaemiwag1aasbaasqaaiabdmgapjabdqgaqbqabagccqghxdatdagcaaqaamaalaaabawaaawaaeaadaaeqbqaaiabdifaynaadaaaleaacqwgpbqacqgguaglaeaacqaiyagmaaaabagaemyaakmaeyypa0jaegymaejaeiola4iaeiola4iaeiola4iaemota4eabeqdcqghris5aagccaglpmiaaypkjaaabawaaabuaeaacqwgybawdaqhaawcbagaemyaakmaemoaaogabagaegomaidaaaqaaiabdmgapjabg2da9iabigdaxiabc6cauiabc6cauiabc6cauiabd6eaobqab0gaeyyeiuoaaaaaleqaaogaeeiiaaiaee4oasjaaczcaiaaxmaadaqadaqaaiabbkdayiabbida4agaayjkaiaawmcaaaaa@5cc3@

where the average 〈 〉 is taken over the samples j =  <dig> ..m. the second method is essentially the same as in  <cit> , based on the application of three internal standard compounds  with the choices of retention time ranges reflecting the analytical method used: lpc standard is applied for peaks with rt < 300s, pc standard for 300s <rt < 410s, and tag standard for rt > 410s.

we utilize coefficient of variation  as the main performance measure for normalization methods. the cv is defined as the ratio of the standard deviation and the mean:

cvi=〈yi.〉 .     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgdbwqcqwgwbgvdawgaawcbagaemyaakgabeaakiabg2da9maalaaabawaaoaaaeaadaqadaqaamaaamaabagaemywak1aa0baasqaaiabdmgapjabc6cauaqaaiabikdayaaaaogaayzkjiaawqyiaiabgkhitmaaamaabagaemywak1aasbaasqaaiabdmgapjabc6cauaqabaaakiaawmyicaglqmcadaahaawcbeqaaiabikdayaaaaogaayjkaiaawmcaaawcbeaaaoqaamaaamaabagaemywak1aasbaasqaaiabdmgapjabc6cauaqabaaakiaawmyicaglqmcaaagaeeiiaaiaeeola4iaaczcaiaaxmaadaqadaqaaiabbkdayiabbada2agaayjkaiaawmcaaaaa@4d23@

as the overall measure of variability we apply median cv:

mcv ≡ median {cvi}i = <dig> ..n     

distributions of cv for different normalization methods for a liver lipidomics dataset are shown in figure  <dig>  the distribution after application of nomis method is notably narrower, and the mcv is lower than in raw data or in other normalization methods. replacement of pc standard with pe in 3std method did not alter the mcv, with mcv =  <dig>  for pe included, compared to mcv =  <dig>  with pc. the cvs at individual peak level are shown in figure  <dig> in a two-dimensional plot of m/z vs. the retention time. one can clearly observe the variability drop across the complete spectrum range for the nomis method. in contrast, no specific improvement is observed for the l2n method in any section of the spectrum. the 3std method performs particularly poorly in the region normalized by the tag standard, while in other two regions the improvement appears only slight. the tag standard was found highly variable , which we believe is a result of the suppression effects due to high number of different triacylglycerol species in that part of the spectrum. we observed the same problem using the stable isotope labeled external standard tg13c <dig> . therefore, increased variability of the triacylglycerol standard is not due to variability in sample extraction.

heteroscedasticity
calculation of the β matrix using the log transformation is of potential concern because such transformation, while efficient in correcting for heteroscedasticity, may also amplify the high variability of low abundance metabolites  <cit> . the log transformation is also unable to deal with value zero.

in order to study the effect of different normalization methods on heteroscedasticity in data, we divided the sorted mean intensity values for  <dig> peaks into six bins defined by the quantiles for the following cumulative probabilities: p = . the first bin therefore contains the low abundance peaks on the left tail of the intensity distribution, with cumulative probability p <  <dig> , the second contains peaks with cumulative probability  <dig>  = p <  <dig> , etc. the median coefficients of variance were calculated within each bin and compared across different normalization methods . the cv for the low abundance peaks  is expectedly highest as compared to other peaks for the unnormalized data as well as for the three normalization methods. the nomis method has the lowest mcv within each bin, providing evidence that the use of log transformation in calculation of the β matrix does not lead to worse performance for low abundance metabolites relative to the other normalization methods. this can be also seen more directly in the scatter plot of cv and mean values for the unnormalized and nomis normalized data .

we deal with the problem of zeros in log transformation by utilizing the post-alignment peak picking algorithm from the mzmine software  <cit> . in case of datasets utilized in this paper no exact zeros were found among the  <dig> peaks following such processing. application of the nomis method to selection of the internal standard mixture. the systematic study of the results obtained by the nomis method can also be utilized for selection of standard compound mixture used in the analytical method. this may be useful in practical analytical work as more standards do not necessarily guarantee better quality of normalization. it is also important to gain understanding of how each individual standard affects the variability of individual molecular species across the full spectra.

to illustrate such an application of nomis, we normalized the liver dataset described above using different combinations of the internal standards. coefficients of variance within a selected region of m/z and retention time values, corresponding mainly to diacyl-phospholipids, diacylglycerols and sphingolipids, are shown in figure  <dig> for six such combinations. from the results one can conclude that the removal of pe standard has the largest negative effect on normalization performance, while the cer standard has least effect. however, the application of all  <dig> standards still gives best results. the application of a combination of three standards  performs worse than any of the other combinations shown, with median cv of  <dig> . interestingly, one spectral region where this standard combination performs poorly is for retention times of 3203–340s, where one can find mainly the long fatty acid chain phosphatidylcholines containing high total number of double bonds . therefore, our results suggest the variability  of the saturated medium fatty acid chain length pc used as a standard is different as for the unsaturated long chain pcs, and therefore is not a good standard for these components. replacing pc with pe in a three-standard combination  leads to better performance of the nomis method, with median cv of  <dig>  .

while the variability of the tag standard is high , its inclusion with the other standards still improved the mcv from  <dig>  to  <dig> . the tag standard in combination with other standards can therefore model the variability of some metabolites better than the four other standards alone. for example, the correlation of the triacylglycerol levels with the tag standard is higher than with other standards. the median pearson correlation coefficient between the internal standard levels and each of the  <dig> identified tag species is  <dig> , compared to - <dig> ,  <dig> , - <dig> , and - <dig>  for lpc, cer, pc, and pe standards, respectively.

the results from analysis of different internal standard combinations above suggest the nomis method can be a valuable tool in analytical development. different biological matrices and different analytical platforms may require different combinations of standards for optimal normalization and systematic evaluation of different standards as illustrated above may provide the necessary clues.

investigation of the results in context of the identified molecular species
in order to gain insight into the nature of the nomis method in the context of compounds studied, we identified several lipid molecular species in the dataset,  <dig> in total. as expected, we found that the composition of the β matrix correlates well with the composition of lipid functional groups. the elements of β for each of the standards are shown in figure  <dig> for some of the most abundant representative molecular species from different lipid classes. the normalization factor, dependent both on the β matrix and the internal standard concentration, is dominated by the lpc standard for mono-acyl lipid species such as lysophosphatidylcholines, lysophosphatidyletahnolamines, and monoacylglycerols. the sphingomyelin species is affected mostly by a combination of the ceramide and pc standards, while the triacylglycerol normalization factor curiously does not include the major influence of the tag standard. this may be largely due to high variability of the tag standard, with matrix-effects dominating the lipid class specific effects.

we also studied how the normalization by an internal standard for a specific functional lipid group would compare to normalization with the nomis method. we normalized the identified lysophosphatidylcholine, phosphatidylcholine, and triacylglycerol lipid species with the lpc, pc, and tag standards, respectively. as shown in table  <dig>  the nomis method clearly outperforms the normalization of species from a specific molecular class based on appropriate internal standard.

normalization using β matrix obtained independently
the matrix β relates the variability of each individual metabolite with that of internal standards for a specific platform and biological matrix. therefore, it is possible that the parameters β are obtained from a separate repeatability experiment involving large number of repeated measurements. this may often be desirable due to a large number of normalization parameters n x  determined by the method. the correction factors from equation  in a real biological application then include the matrix β obtained independently and the measured levels of internal standards Ωsj from the biological experiment.

we tested this concept by utilizing the matrix β obtained from  <dig> identified lipid species in the above described  <dig> sample run experiment in a new experiment in repeatability conditions utilizing the same analytical platform but different biological sample . the results for the cvs for individual peaks are shown in figure  <dig>  even in that case the nomis method outperformed the others, even though the differences as judged by median cv within each dataset were small.

these results provide evidence that the nomis method may also be used to develop a "reusable" β matrix for studies utilizing the same biological matrix and analytical platform. as evident from equation

  and demonstrated in figure  <dig> for the case of lipids, the β matrix captures the variation of all detected metabolites in biological matrix as modeled by selected standard compounds. in case of repeatability runs demonstrated in this paper, the variability modeled is due to the obscure variation introduced in experimental studies of metabolites. we therefore believe the best usage of the nomis method should include a large run in repeatability conditions for a specific platform and specific biological matrix  in order to obtain a β matrix, which would then be applied to normalization of other samples using the same standard compounds and peak lists. the latter requires that the analytical method is sufficiently accurate and precise so that one can reliably track a specific set of peaks within a specific biological matrix even if some peaks remain unidentified. the β matrix may even be updated when new runs are made and we believe there are opportunities to develop sophisticated probabilistic methods to model and update the β matrix based on new experimental data.

the nomis normalization model is derived from the variabilities and correlation structure observed in data measured under repeatability conditions and does not specifically model different sources of systematic variation, incl. ion suppression. therefore, as long as the assumption of multiplicative error model is valid to a reasonable extent, the nomis approach may be applicable. the heteroscedasticity of gc/ms spectra has in fact already been studied and demonstrated earlier  <cit> . we therefore believe the nomis approach may be applicable to analytical platforms other than lc/ms demonstrated in this paper.

CONCLUSIONS
we introduced a new method for normalization of metabolomics data which utilizes variability information from multiple internal standard compounds to find optimal normalization factor for each individual molecular species detected . the method proved superior to two other commonly utilized normalization strategies in its ability to reduce variability across the full spectrum of metabolites.

the nomis method can be used directly as a one-step normalization method or as a two-step method where the normalization parameters containing information about the variabilities of internal standard compounds and their association to variabilities of metabolites are first calculated from a study carried in repeatability conditions. additionally, the method can be used to select standard compounds for normalization and evaluate their influence on variability of all detected metabolites.

while we focused on applications of nomis to lc/ms based approaches; we believe the same strategy can be applied to other analytical platforms used in metabolomics, as well as to other levels of molecular profiling such as mass spectrometry based proteomics.

