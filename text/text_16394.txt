BACKGROUND
a cell’s metabolic behavior is tightly coupled to its local microenvironment; with it the cell exchanges both food and waste, and from it the cell detects useful information such as shifts in substrate availability. cells have evolved complex biochemical networks in order to respond to environmental changes, including regulatory systems that enable them to feed on a diverse range of substrates. for diffuse populations living in well-stirred conditions the depletion of food and accumulation of metabolic waste can be slow and spatially uniform, meaning that the behavior of any given cell is largely independent of the others. in contrast, within a colony the close proximity of nearby cells competing for the same diffusing resources can create steep chemical gradients capable of significantly altering each cell’s metabolism. under these conditions, the behavior of neighboring cells can be strongly interdependent  <cit> , and understanding their interactions requires a detailed picture of both the shared environment and the cells’ metabolic responses to it.

several approaches have been developed in the past to analyze the intercellular interactions of large numbers of microbes in close spatial proximity . in general, these models have employed highly simplified kinetic descriptions of nutrient uptake and cell growth. despite the numerous successes of these methods, oversimplification—especially of complex cellular networks like metabolism—can fail to capture important collective behavior. e. coli metabolism alone involves thousands of reacting substrates and enzymes, and while many individual metabolic pathways are well characterized, understanding how these pathways interact on a systems level remains a challenge. flux balance analysis   <cit> , which uses linear programming techniques to find the set of reaction fluxes that optimize growth, has proven to be a powerful tool for investigating the genome-scale metabolism of bacteria and other organisms under different environmental conditions and in different gene-expression states  <cit> . recently, a method using fba in both a spatially- and temporally-resolved manner was described in  <cit> . this approach made iterative use of the gpu-accelerated lattice microbes software  <cit>  to model the diffusion of substrates throughout a cluster of fixed cells, and fba to model each individual cell’s metabolism. while refinements to the method predicted the emergence of a large region of anaerobically-growing cells within a modeled e. coli colony and significant acetate production  <cit> , the single molecule resolution of the method made it better suited to studying the interactions of a small number of cells  in low concentrations of metabolites.

in order to simulate larger and denser colonies over long timescales with higher metabolite concentrations, we have developed a coarse-grained method in which both cell density and substrate concentrations are discretized to a cubic lattice. we model the 3d diffusion, uptake, and efflux of substrates within and around a growing colony of e. coli  by coupling a reaction-diffusion simulation with a genome-scale flux balance metabolic model. this technique, which we call 3ddfba , offers powerful insight into how spatial localization within microbial colonies can impact metabolism at the level of individual pathways and reactions. our simulations reveal how steep glucose and oxygen gradients emerge within the modeled colonies and give rise to four well-defined metabolic phenotypes—a fast-growing ring of cells near the edge making use of the tca cycle and electron transport chain, a large region of nearly dormant cells in the colony interior, and a pair of spatially distinct crossfeeding subpopulations comprised of acetate-producing fermentative cells near the colony base and acetate-consuming cells higher up. imaging experiments involving fluorescently labeled e. coli strains strongly support these predictions. we also find that the spatial distribution of growth rates within the simulated colonies lead to 3d cross-sections and a linear radial expansion that agree with experimental results.s3ddfba methodology at a glance.
 cells, agar, and air are discretized to a 3d cubic lattice.  substrate diffusion is accounted for using a seven-point stencil finite difference scheme.  substrates can be passively or actively taken up by the cells. those that cannot passively penetrate cell membranes experience hindered diffusion around cells in the extracellular space  flux balance analysis predicts substrate usage and cell growth.  cell volume grows exponentially until it surpasses a maximum volume fraction, ρ
max, at which time intercellular forces create pressure that pushes cell volume outward into neighboring lattice sites of lesser volume fraction.  cells of different species or in different regulatory states can be simultaneously simulated. those in different states can transform back and forth at rates that can depend on up to two local substrate concentrations, .



RESULTS
we simulated  <dig> hours of e. coli colony growth on an agar plate containing m <dig> minimal medium supplemented with  <dig>  g l − <dig> glucose and trace elements. the e. coli k- <dig> mg <dig> strain was modeled using the ijo <dig> metabolic reconstruction  <cit> . the simulations were initialized with the equivalent volume fraction of a single cell in the center of an approximately  <dig>  ×  <dig>  mm agar surface of depth approximately  <dig> mm. oxygen was allowed to diffuse into the colony directly from the air as well as through the agar, while glucose was allowed diffuse through the agar alone. the m <dig> salts and trace elements were not assumed to be growth-limiting, and so their concentrations were not modeled explicitly in the 3d spatiotemporal simulation, but they were allowed to be freely taken up by the cells of the colony. expecting significant fermentation on the interior of the growing colony  <cit> , preliminary fba calculations were performed in order to anticipate which fermentative products may play an important role in the cells’ collective metabolism. formate, acetate, and ethanol were all predicted to be produced in significant amounts, with formate being produced at roughly twice the rate of acetate and ethanol. succinate was predicted to be produced at roughly 1% of the acetate production rate, while lactate was not predicted to be produced by the modeled cells at all. because neither formate nor ethanol are used by wild-type e. coli as a carbon source and because succinate was produced in such small quantities, the only fermentation product that was ultimately tracked in the spatiotemporal model was acetate. dirichlet boundary conditions were imposed for the simulated oxygen, glucose, and acetate. the glucose concentration on the walls and floor of the agar was held fixed at  <dig>  g l − <dig>  while the oxygen concentration on all boundaries was fixed at  <dig> μm . the acetate concentration on the boundaries was fixed at  <dig> , ensuring that all acetate within the simulation was created by the cells themselves. there are no free parameters in our simulations—all are either taken from the literature or fit to experimental results. all parameters used in our calculations are summarized in table  <dig> parameters used in our 3ddfba simulations



parameter
description
value
units
reference or rationale

d
glc, aq
m
2
s
−1

do <dig>  aq
m
2
s
−1

d
ace, aq
m
2
s
−1

d
glc, agar
m
2
s
−1

do <dig>  agar
m
2
s
−1

d
ace, agar
m
2
s
−1

λ
μ
m

l
x
mm

l
y
mm

l
z
mm

h
agar
mm

Δ
τ
s
Δτ≪λ22do <dig>  aq

t
ss
s

t
grow
s
[o
2]air
m
[o
2]agar, boundary
m
agar, boundary
m

ρ
max

Δ
ρ

m
cell
g

v
cell
m
3

v
max, glc uptake

k
m, glc uptake
mm

v
max, ace uptake

vmax, o2uptake


3ddfba methodology
a major result of this study was the development of the 3ddfba methodology used to perform the simulations; it is outlined in the pseudocode provided in algorithm  <dig> and in figure  <dig>  both the colony and its surrounding environment are discretized to a 3d lattice . chemical species—represented by a lattice of local concentrations—can diffuse throughout the simulation volume and be taken up or produced by the cells of the colony. within the colony, the number of cells in a given lattice site is expressed in terms of a local volume fraction, ρ, which can range continuously up to some user-defined ρmax. this ρmax represents the maximum cell volume fraction capable of being packed into a given lattice site before intercellular forces begin to shove some of the cells outward into neighboring sites. fba is used in order to predict how the cells in each lattice site will respond to the concentrations of substrates available to them—they may take up some of one substrate and produce some of another, and grow at some rate as a result. these predictions are used to update the local substrate concentrations and the local cell volume fractions. cells are allowed to be of different species and/or in different regulatory states. these different cell types or states may use different flux balance models or the same model but with different constraints imposed .

our implementation exploits a natural time-scale separation between the rate at which small molecules like glucose or oxygen diffuse and the rate at which a colony grows. because the physical size, shape, and regulatory state of a colony changes relatively slowly, fairly long time steps, tgrow, can be safely taken between updates. these time steps can be on the order of minutes  to hours . substrate concentration profiles, on the other hand, can approach steady state in as short as a few seconds or less. this means that these concentration profiles always remain effectively at steady state with respect to the growth of the colony. this is important for two reasons. first, the assumption that fba is a valid description of the behavior of a cell hinges on the cell and its environment being at steady state. second, and more practical, it allows for significant simulation speedup. simulation of the diffusion, uptake, and utilization of substrates can be performed for relatively short times, tss≪tgrow, until they come to steady state, and the results can be used to project forward until the next colony size update. our own simulations used values of tgrow= <dig> s and tss= <dig> s in order to ensure moderate colony growth between updates and ample time for the concentration profiles of all simulated chemical species to relax to steady state.

substrate profiles are brought to steady state through the iterative application of the code’s diffusion, active substrate uptake, and fba kernels . the diffusion kernel employs a seven-point stencil finite-difference scheme to account for the diffusion of substrates between lattice sites . the active substrates uptake kernel allows for substrates known to be actively imported by the cells of each lattice site to be taken up in accordance with assumed michaelis-menten kinetics . finally the fba kernel is used to predict how much of each substrate the cells of each lattice site produce or consume, as well as those cells’ average growth rate . steady state fba solutions have been used in the past in iterative time-stepping ways similar to this  <cit> , but never with the full 3d spatial resolution described here.

once brought to steady state, the substrate concentrations and cellular growth rates are used in subsequent colony size and regulatory state calculations. this is done by application of the growth, expansion, and regulation kernels . the growth kernel updates the values of the local volume fraction ρ within the colony in accordance with an exponential growth law and the local growth rates predicted by fba. then, in the event that some lattice sites contain values of ρ greater than ρmax, the expansion kernel iteratively redistributes some of these sites’ excess volume fractions to neighboring sites with lesser volume fractions until every site falls within a small cutoff of ρmax. this process effectively expands the colony  and ensures that the cell density and intercellular pressure remain relaxed throughout the colony. finally, the regulation kernel updates the regulatory states of the cells in each lattice site in accordance with assumed first-order kinetics. because the cells’ regulatory state can be strongly influenced by environmental factors, the local rates at which they change are assumed to be functions of the local substrate concentrations .



diffusion kernel
each lattice site in the simulation volume is specified as one of three types: air-type, agar-type, or cell-type . the air-type lattice sites behave essentially as a source for gaseous substrates like oxygen. the concentration of a substrate in an air-type site is fixed at the concentration of the dissolved gas in water at standard laboratory temperature and pressure. this choice approximates the adsorption of particles from air to agar  as a simple diffusive process. in effect, it is assumed that right at the boundary between the air and the agar or cells there exists a thin film of water that remains at equilibrium  with the air above it. the oxygen concentration in the air-type sites was computed using henry’s law to be  <dig> μm . diffusive flux is allowed from the air-type sites into the agar- and cell-type sites, but it is disallowed from the cells and agar into the air, ensuring that aqueous substrates like glucose and acetate cannot escape. the cell- and agar-type lattice sites are allowed to diffusively exchange substrates, but their local diffusion coefficients differ. in agar, substrates diffuse at rates taken from the literature, which for glucose and oxygen in  <dig> % agar, are approximately 95% of their diffusion rates in water . the diffusion rates of substrates in cell-type sites depend on the local cell volume fraction and the substrate. oxygen, for example, readily diffuses through cell membranes  <cit> , and is assumed to diffuse at a similar rate through cells as it does through water. conversely, glucose, which cannot diffuse passively through the cell membrane  <cit> , is assumed to have to diffuse around cells, and thus experiences a crowded environment and correspondingly slowed diffusion . the effective diffusion rates of these hindered substrates are given approximately by  <cit> :
  deff=1−ρ1+ρ2d 

where d is the diffusion rate of the substrate in water and ρ is the instantaneous local cell volume fraction at lattice site x.

among the cell- and agar-type lattice sites, diffusion is modeled using a seven-point stencil finite difference approach. the extracellular concentration of a substrate ϕ in site i is updated as:
  ϕi=ϕi+Δτλ∑jjϕ,j→i 

where λ is the lattice spacing, j indexes over the  <dig> lattice sites neighboring site i, and jϕ,j→i represents the diffusive flux across the boundary seperating sites j and i. this flux is computed as:
  jϕ,j→i=dϕ,j+dϕ,i2ϕj−ϕiλ 

where dϕ,i and dϕ,j are the diffusion coefficients for the substrate in sites i and j, respectively. here it is important to note that we have averaged the diffusion coefficients for sites i and j rather than using one or the other; this helps to ensure continuity when dϕ,i≠dϕ,j.

a lattice spacing of  <dig> μm was used in our simulations. this was chosen in order to resolve the oxygen profile within the colony which is known to fall to nearly zero within approximately  <dig> μm from the surface  <cit> . this, coupled with the diffusion rate of oxygen—the fastest diffusing species in the simulation—set a maximum theoretical value for Δτ≤λ22do2≈2×10− <dig>  although a more conservative value of 1×10− <dig> s was used in order to ensure convergence.

active substrate uptake kernel
as the cells of the colony actively import glucose, the local extracellular and intracellular glucose concentrations change. this process is assumed to be governed by a michaelis-menten-type chemical reaction :
  ϕext=ϕext−kΔτϕint=ϕint+kΔτ 

where ϕext and ϕint are the instantaneous local concentrations of the extracellular and intracellular forms, Δτ is the time step, and k—the instantaneous local uptake rate—is given by:
  k=ρekcatvcellϕextkm+ϕext 

michaelis-menten kinetics has been applied in the past to the enzymatic uptake of substrates by cells . in the above expression, ρ again represents the instantaneous local cell volume fraction, e represents the number of enzymatic transporters on a cell membrane, vcell represents the volume of a cell, kcat represents the enzyme turnover rate, and km is the so-called michaelis constant for the reaction. in the case of glucose, the parameters ekcatmcell and km were fit to experimental measurements  <cit> , yielding  <dig>  mmol gdwt − <dig> hr − <dig>  and  <dig>  mm, respectively. literature values for the average dry weight, mcell, and volume, vcell, of a single cell were then used to transform ekcatmcell to ekcatvcell .

flux balance analysis kernel
fba is used to model substrate utilization and production in the simulation. the maximum instantaneous specific  uptake rate, vmax, of a given substrate by a cell in lattice site x during the time interval Δτ is assumed to be given as:
  vmax=ϕvcellmcellΔτifϕis passively transported into the cellϕintρvcellmcellΔτifϕis actively transported into the cell 

this simply requires that during the time interval Δτ the cells have access only to the substrate lying within their volume— ϕvcell for passively diffusing substrates , and ϕintρvcell for actively imported substrates − <dig> reflects the fact that ϕint is known to be confined entirely within the local cells). constraints of this type are calculated for each metabolite that is tracked in the spatially-resolved simulation , and used with a genome-scale flux balance metabolic model in order to predict the behavior of the cells in each lattice site . the local substrate concentrations are then updated accordingly as:
  ϕ=ϕ−vfbamcellΔτvcellρ 

where vfba represents the exchange flux for the substrate predicted by fba. the second term on the right hand side can be thought of as the product of the predicted uptake rate per cell, vfbamcell, the number-density of cells in the lattice site, ρvcell, and the time step.

because simulations can easily involve on the order of  <dig> million cell-type lattice sites , and because each site requires frequent updates to its substrate concentrations , a single second of typical simulation time can require on the order of  <dig> or more individual fba solutions. many of these will be similar to each other; the behaviors of cells in adjacent lattice sites or in the same site in subsequent time steps will often not change appreciably, meaning that the same or nearly the same solution can be used over and over again, avoiding the need for redundant fba solving. to that end we have approximated the local instantaneous fba solution in a given lattice site using a precomputed lookup table .

cell growth kernel and colony expansion kernel
the local instantaneous growth rates, g, predicted by fba are used to update the volume fraction in each lattice site in accordance with an assumed exponential growth law:
  ρ=ρegtgrow 

the volume fraction within a lattice site is allowed to increase until it surpasses ρmax. at this point the site is considered “over-filled,” and the force of the cells in the lattice site pushing against each other create an outward pressure through each of the lattice site’s six walls . because the growth of the colony is slow, the cells are assumed to have ample time to redistribute themselves in responce to these intercellular forces, and as a result the cell volume fraction is assumed to remain relaxed throughout the colony at all times. this relaxation is performed immediately after application of the growth kernel and involves the iterative movement of cell volume from over-filled sites to neighboring sites with lower volume fractions until the highest volume fraction in the entire colony is within some small user-defined cutoff, Δρ, of ρmax . the amount of volume fraction, ρi→j, moved from lattice site i to a neighboring site j in a single iteration is proportional to the difference in the sites’ respective degrees of over-filling:
  ρi→j= <dig> 

here, the factor of 112=12× <dig> accounts for the fact that each lattice site has six faces through which cell volume can be moved, and the factor of  <dig> ensures convergence. in cases where ρi→j< <dig>  cell volume is moved from site j to site i. when multiple cell types are present in the same lattice site, the total volume fraction is used to determine how much cell material is moved across each face, and this is then divided up among the cell types according to their relative fractions.

for spherical cells, the maximum packing fraction, ρmax, might be set to approximately  <dig> —the close-packing fraction of uniform spheres. the simulations presented here use the value  <dig>   in accordance with a model of the growth of colonies of rod-shaped salmonella typhimurium  <cit> .

regulation kernel
multiple different cell types can to be simulated simultaneously. these can be either different species or different regulatory states of the same species. in the latter case, the cells’ regulatory state is allowed to change over time in response to its environment . this is performed straightforwardly assuming first order kinetics:
  ρi=ρi+∑jkj→i,ϕn)ρjtgrow−ki→j,ϕp)ρitgrow 

where ρi represents the instantaneous local volume fraction of cell type i in lattice site x, and kj→i,ϕn) represents the instantaneous local switching rate from regulatory state i to j. these switching rates are assumed to depend on the local substrate concentrations  and, for simplicity, be polynomial in form:
  ki→j,ϕn)=max+α2ϕn+α3ϕm2+α4ϕn2+α5ϕmϕn) 

where the constants {αk} are fit to experimental data or a known model. the simulations presented here include a “regulated” model  that involves the switching of cells between glucose- and acetate-consuming states. the switching rate parameters for this model were fit to data from  <cit> , .

3ddfba predicts e. coli in colonies engage in cooperative acetate crossfeeding
unregulated model
initially, simulations were performed without any form of regulation. the cells were assumed to engage in the metabolism that optimized growth solely in response to the substrates available . a form of cooperative crossfeeding was found to emerge within the simulated colony wherein one subpopulation produced acetate while another consumed it. this behavior resulted predominantly from oxygen depletion in the colony interior. the penetration depth of oxygen  was calculated to be between  <dig> and  <dig> μm—in strong agreement with previous experimental and theoretical values  <cit> . beyond this depth, extreme hypoxia prohibited cells from making use of the tricarboxylic acid cycle  and electron transport chain, and as a result they engaged in a form of fermentative metabolism that produced acetate as a byproduct . because the availability of glucose fell dramatically with height above the agar, these cells formed a broad flat disk near the base of the colony. as the acetate diffused outward, some of it was taken up by aerobic cells nearer the periphery, which formed a thin shell of syntrophic acetate-consumers . this shell was approximately  <dig> μm thick and accounted for a colony-wide average acetate uptake rate of about  <dig>  mmol gdwt − <dig> hr − <dig> at  <dig> hours of simulation time. this was nearly 85% of the colony’s average acetate production rate. because crossfeeding among e. coli is generally associated with either multi-species consortium or long-term evolutionary experiments where genetically distinct crossfeeding sub-strains arise over many generations  <cit> , its emergence within an isogenic colony on time scales as short as a few days is of particular interest.metabolic behaviors within the “unregulated” and “regulated” colony models.
 the unregulated model in cross-section after  <dig> hours of growth; cells were assumed to engage in their own optimal metabolism solely in response to the metabolites available.  the regulated model in cross-section after  <dig> hours of growth; cells were allowed to be in either a glucose-consuming or acetate-consuming state.  cartoon of e. coli central metabolism. the purple color indicates flux through the metabolic network. some cells of the unregulated model were predicted to engage in simultaneous glucose and acetate consumption; this highlights the necessity of accounting for resource regulation within the simulations.  acetate production within both models occurred near the agar in the anoxic interior of the colony; there glucose was available but the lack of oxygen prevented use of the tca cycle and electron transport chain.  acetate consumption occurred as a thin dome within the unregulated model and as a wider and more diffuse dome in the regulated model. also indicated are the acetyl-coa synthase, malate synthase, and isocitrate lyase reaction steps. these are associated with acetate consumption and are catalyzed by acs, aceb, and acea , respectively.  oxidative phosphorylation occurred near the agar at the outer edge of the colony.



regulated model
however these “unregulated” simulations yielded some unrealistic behavior. many of the cells predicted to be taking up acetate were also predicted to be taking up glucose at the same time . experimentally, glucose and acetate consumption are known to be differentially regulated, and e. coli in batch culture generally exhaust almost all of the glucose available to them before switching over en masse to acetate metabolism  <cit> . in order to ensure that the crossfeeding observed was not merely an artifact of the inability of the model to account for this effect, a more refined model was constructed. cells were allowed to be in either a glucose-consuming state  or an acetate-consuming state , and could interconvert between the two at rates that depended on the local glucose and acetate concentrations. these rates were fit to experimental batch-culture data  <cit>  using a simple growth model:
  dmglcdt=gglcmglc+kace→glcmace−kglc→acemglcdmacedt=gacemace+kglc→acemglc−kace→glcmaceddt=−mglcvglcddt=mglcεace−macevace 

where mglc and mace represent the biomass of the glucose-consuming and acetate-consuming cells, respectively, gglc and gace represent their growth rates, vglc and vace represent the uptake rates of glucose and acetate, respectively, and εace represents the acetate production rate by glucose-consumers. because the experimental data includes growth curves for cultures growing in only glucose and only acetate, gglc and gace were easily fit assuming an exponential form . using these values and the glucose and acetate concentration curves from the same single substrate experiments, values for vglc, vace, and εace were fit . finally, with these values fixed, the switching rate parameters, {αi}, that appear in equation  <dig> were fit.

overall, the modeled dynamics fit well with the experimental behavior, especially in the low-acetate regime where our spatially-resolved fba simulations primarily exist. the glucose concentration curves show very good agreement , but at intermediate acetate concentrations the model overestimates acetate uptake . we attribute this to the fact that real cells should experience some lag in switching from glucose-consuming to acetate-consuming behaviors. this lag is not represented in the model; the modeled cells switch out of the glucose-consuming state directly to acetate-consuming behavior. we expect that the addition of a third non-growing “retooling” state between these glycolytic and acetoclastic states might bring the model into better agreement. nevertheless, because the highest acetate concentration recorded in our 3ddfba simulations is approximately  <dig> ×10− <dig> m—laying well within the range of the blue curve in additional file 1: figure s <dig> b where the model best matches experiment—a more refined model would likely add significant computational complexity without offering much in the way of accuracy in return. the switching rate parameters ultimately used in the model are summarized in additional file 1: table s <dig> 

simulation of this “regulated” model again yielded acetate crossfeeding . as before, the acetate-producing subpopulation consisted of glucose-consuming cells located within the anoxic interior of the colony near the agar. the acetate-consumers again formed a shell, but it was wider and more diffuse than in the unregulated model. this shell extended all the way to the edge of the colony, and was comprised of a mixture of both acetate-consuming cells  and slow- or non-growing glucose-consumers. little acetate-consumption occurred at the colony periphery near the agar surface; this was because the high glucose concentration in this region strongly suppressed the acetate-consuming state and instead drove the cells toward use of the tca cycle and electron transport chain . in total, the acetate-consumers accounted for a colony-wide average uptake rate of approximately  <dig>  mmol gdwt − <dig> hr − <dig> at  <dig> hours of simulation time. this was only about 39% of the colony’s acetate production rate.

the ability to crossfeed acetate imparted a fitness advantage to the colony as a whole, and after  <dig> hours the model with regulation had outgrown a non-crossfeeding model  by about  <dig> %. this faster growth derived from the crossfeeding colony’s cells’ collective ability to aerobically metabolize glucose even when they would not have been able to individually. the acetate-producers lacked the oxygen necessary to fully metabolize glucose, and as a result could only partially metabolized it to acetate. the acetate-consumers higher up in the colony, which had access to oxygen but not glucose, were then able to complete the process by metabolizing the acetate. the cells of the non-crossfeeding model could not complete the second part of this two-step metabolism, and grew slower as a result.

because high glucose availability strongly suppresses the acetate-consuming state, it was initially unclear if the crossfeeding observed could be disrupted by increasing the concentration of glucose in the agar. additional simulations were performed with glucose concentrations spanning from  <dig>  g l − <dig> up through  <dig> g l − <dig>  in each case acetate crossfeeding emerged within the simulated colony  indicating that this behavior is fairly robust across a range of glucose concentrations.

3ddfba with molecular crowding
a cell’s finite volume places an inherent upper limit on the total number of metabolic enzymes that the cell can contain. because every enzyme takes up some portion of this volume, and because the maximum flux through a given enzyme-mediated reaction is proportional to the number of enzymes that are present inside the cell, increasing the flux through a given metabolic pathway results in an increase in demand for the cell’s available space. flux balance analysis with molecular crowding  was developed to account for this effect, and has been shown to reproduce the bacterial warburg effect in fast-growing e. coli populations, as well as the preferential utilization of some carbon sources over others   <cit> . additional 3ddfba simulations—both with and without regulation—were performed using lookup tables generated with the fbawmc approach .

the addition of crowding constraints did not disrupt the simulated colonies’ ability to crossfeed acetate. in fact, fairly little changed between the simulations using the standard fba formulation and those accounting for molecular crowding. the greatest qualitative difference occurred among the fast-growing aerobic cells of the colony periphery near the agar surface. without regulation, standard fba speciously predicted that these cells would engage in simultaneous glucose and acetate utilization . in the fbawmc formulation, no such simultaneous glucose and acetate utilization was observed . this is because acetate, which has a lower metabolic yield than glucose, requires a comparatively larger total enzyme-mediated reaction flux in order to produce the same amount of biomass. this in turn means that an increase in growth rate due to acetate utilization costs more in terms of enzyme volume than the same increase in growth rate due to glucose utilization. fast-growing cells, which are at or near their crowding limit, are therefore driven to utilize glucose exclusively, and only begin to scavenge acetate when glucose availability drops.

crowding constraints also drove a small subset of the same fast-growing peripheral cells toward acetate production, even in the presence of ample oxygen. without crowding constraints, these cells had engaged in rapid glycolytic growth that made heavy use of the cells’ oxidative phosphorylation machinery. this led to doubling times of around  <dig> minutes for the fastest-growing cells and no appreciable acetate production. when crowding constraints were introduced, the volumetric cost associated with the enzymes of the tca cycle and electron transport chain drove the fastest-growing of these cells toward a mixed strategy of partial oxidative phosphorylation and partial overflow metabolism . this led to slower growth rates  and significant acetate generation .

experimental support for the predicted crossfeeding behavior
a simple set of experiments was devised in order to test for the predicted crossfeeding behavior. e. coli k- <dig> strains containing a plasmid expressing gfp under the control of the malate synthase a  promoter were grown on agar plates containing m <dig> salts supplemented with  <dig>  g l − <dig> glucose and trace elements. this gene is part of the acetate operon, acebak, and is associated with acetate consumption . colonies were grown over a period of two days during which time they were periodically  imaged at a series of focal planes above the agar surface. imaging was performed using a zeiss axio zoom.v <dig> microscope equipped with a zeiss apotome. <dig> structured illumination device for optical sectioning  <cit> . the resulting heights, widths, and spatial distributions of fluorescence—indicative of the distribution of acetate-utilizing cells within the colonies—were then compared against those of the simulated colonies .plot of simulated and experimental colony heights and diameters. plot of simulated and experimental colony heights and diameters. at  <dig> hours ,  <dig> hours ,  <dig> hours , and  <dig> hours  after inoculation onto agar plates,  <dig> colonies of each of our fluorescent strains, paceb-gfp , pacs-gfp , and pgapa-gfp , were imaged and measured. the lines indicate the height and width of modeled colonies  over  <dig> hours of growth. these colonies were simulated with different values for ρ
max ranging from  <dig>  to  <dig> . the main simulations presented in the text use a value of  <dig>  taken from the literature  <cit> , and appear as the black line. the step-like features along these lines are artifacts of the discreteness of the spatial model. the simulations overestimate colony height early on, but their height-to-width ratios shows strong agreement at later time points.



within the experimental colonies, rings of fluorescence— indicating the presence of cells on the colonies’ peripheries rapidly expressing the aceb gene—were observed. these rings narrowed at higher focal planes and eventually closed to a spot, indicating the height of the colony . compiled together as a z-stack, these rings form domes of fluorescence on the colonies’ peripheries that show strong qualitative agreement with the simulated results . comparison with reference colonies expressing gfp from the promoter of the highly-expressed housekeeping gene gapa  indicated that aceb expression was over seven-fold higher in our experimental colonies than in published results for cells grown in liquid culture  <cit>  . similar spatial patterns were also obtained using strains expressing gfp under the control of the acetyl-coa synthase  promoter which, like aceb, is associated with acetate consumption . in this case the ratio of acs-associated to gapa-associated gfp fluorescence was approximately 50-fold higher than published values for liquid-cultured cells.comparison of experimental acetate-associated reporter expression with predicted acetate consumption.
 brightfield image of a representative colony expressing gfp under the colntrol of the aceb promoter. this image was taken approximately  <dig> hours after innoculation when the colony was approximately  <dig>  mm in diameter.  paceb-gfp fluorescence in the same colony imaged  <dig> μm above and parallel to the agar surface.  paceb-gfp fluorescence imaged  <dig> μm above the agar surface.  paceb-gfp fluorescence in a plane bisecting the colony and perpendicular to the agar surface; this was reconstructed from the entire compiled z-stack of fluorescence images.  gray-scale plot of the height of a simulated colony. this image was produced after approximately  <dig> hours of simulation time when the colony was around  <dig>  mm in diameter.  predicted acetate uptake rate imaged  <dig> μm above and parallel to the agar surface.  predicted acetate uptake rate imaged  <dig> μm above the agar surface.  predicted acetate uptake rate in a plane bisecting the simulated colony and perpendicular to the agar surface.



estimating the colony acs expression based on the fluorescence ratio computed above and published gapa expression data  <cit>  yields an average value of approximately  <dig> acs proteins per cell, most of which should be concentrated at the top and sides of the colony . the product of this and a published value for the acs turnover rate  yields a maximum acetyl-coa synthase reaction flux of  <dig>  mmol gdwt − <dig> hr − <dig>  in strong agreement with the maximum value of  <dig>  mmol gdwt − <dig> hr − <dig>  predicted by the regulated models . the unregulated models, by contrast, overestimated this value by approximately an order of magnitude. a similar calculation using the aceb fluorescence ratio and a published value for the aceb turnover rate  <cit>  yields values of approximately  <dig>  proteins per cell and a maximum flux of  <dig>  mmol gdwt − <dig> hr − <dig>  also in agreement with the regulated models.modeled three-dimensional
e. coli
 colony. this colony, approximately  <dig> hours after innoculation on an agar plate , is colored by acetate uptake rate.



taken together, these experiments largely support the simulated results. not only do the observed aceb and acs to gapa ratios indicate upregulation of genes associated with the predicted crossfeeding behavior, but this upregulation also occurs in spatial patterns similar to those seen in the simulations.

additional control experiments are described in the additional file 1: sections  <dig> .2– <dig> . <dig>  the first of these shows that the lack of fluorescence seen in the colonys’ interiors is not an artifact of the low oxygen concentration in these regions preventing gfp maturation. colonies of e. coli expressing the flavin-based fluorophore ilov  <cit> —which does not require oxygen to mature—show similar fluorescence patterns , meaning that the gfp fluorescence we see is likely indicative of gene-expression and not oxygen availability. the second control experiment addressed whether scattering of the excitation or emission photons as they passed through the colony might have obscured fluorescence in the interior. fluorescent colonies were physically bisected and imaged at their cut plane . the resulting images show the same dome-like distribution of fluorescence seen using the non-disruptive structured illumination imaging technique , indicating that this distribution is not simply an artifact of the imaging technique used. a third control experiment involved colonies containing the promoterless plasmid pua66—the same plasmid used to study aceb, acs, and gapa except without a promoter region upstream of the gfp gene. no appreciable fluorescence was seen, indicating that the fluorescence of our experimental colonies is not simply misattributed autofluorescence or leaky transcription of the plasmid gfp . finally, we performed a preliminary two-color experiment using a plasmid containing the gene encoding mcherry under the control of the ptsg promoter  and gfp under the control of the aceb promoter . although we note that the growth of the resulting colonies was slow and the gfp fluorescence we observed was noticeably less intense than that of our single-color experiments, we found that the resulting images strongly indicate the existence of distinct glucose- and acetate-consuming subpopulations.

3ddfba predicts realistic colony growth dynamics
the physical growth of the simulated colonies was found to proceed through two phases. during the initial  <dig> hours, the dimensions of the colonies grew approximately exponentially. beyond this time, however, the colonies’ radial expansions slowed to a constant rate of about  <dig>  μm s − <dig> . these findings agree extremely well with an experimental study of e. coli growth under nearly identical conditions  that reported an exponential-to-linear transition occurring around  <dig> hours after inoculation onto agar plates and a radial expansion rate of around  <dig>  μm s − <dig>  <cit> . our own experimental colonies  grew slightly slower with a radial expansion rate of approximately  <dig>  μm s − <dig> .growth rates and substrate profiles over time.
 the colony is colored by growth rate and shown in cross-section. the fastest-growing cells  inhabit the colony periphery, while much of the interior shows little or no growth  due to nutrient depletion. the grey diagonal line shows the linear radial growth of the colony.  oxygen concentration within the same colony in cross-section at  <dig>   <dig>  and  <dig> hours. between  <dig> and  <dig> hours, a well-defined anoxic region forms in the center of the colony. the penetration of oxygen into this colony is between  <dig> and  <dig> μm.  glucose concentration in cross-section at  <dig>   <dig>  and  <dig> hours. beyond  <dig> hours, the glucose concentration in the colony interior rapidly falls, and beyond  <dig> hours, much of the colony interior, in addition to being anoxic, is also glucose-starved.



the observed shift toward linear expansion was, like the predicted acetate crossfeeding, the result of nutrient depletion in the interior of the colony, and both oxygen and glucose starvation were found to contribute. after approximately  <dig> hours of simulation time, the colony had grown large enough to permit the emergence of clearly defined aerobic and anaerobic regions . roughly commensurate with this drop in oxygen availability in the colony interior came a drop in glucose availability . the concentration of diffusing glucose at the center of the colony  fell to approximately half its initial value within  <dig> hours and about 4% of its initial value within  <dig> hours. combined, these oxygen and glucose gradients gave rise to a relatively compact ring of fast-growing “pioneer” cells at the colony edge and almost no growth among the cells of the colony center, in agreement with experimental observations  <cit>  . because this ring’s height, width, and growth rate were controlled by the penetration depths of oxygen and glucose, they remained relatively constant over most of the latter part of the simulations. for this reason, the rate at which the biomass of the colony increased was proportional to its radius alone, and in turn, its radial expansion rate remained approximately constant .

the transition from exponential to linear growth also affected the shape of the colony. early on, when oxygen and glucose were essentially ubiquitous, the simulated colony grew hemispherically in shape. later, as the majority of the growth shifted to the periphery, the colony’s radial expansion outpaced its vertical growth, and it took on a more broad and flat appearance. experimentally, the early growth of a colony is predominantly two dimensional across the agar  <cit> , meaning that our simulations significantly overestimate the height of small colonies. despite this initial divergence, later time points show better agreement with the height-to-diameter ratios of the experimental colonies . varying the maximum local volume fraction, ρmax, toward higher values brings the simulations into even better agreement . it is worth noting that our model does not require any sort of height parameterization; the agreement we see emerges naturally from the way the colony growth and expansion is handled in the simulation.

CONCLUSIONS
the application of the 3ddfba method described here focused on the growth and collective metabolism of e. coli colonies. its integration of 3d reaction-diffusion simulations with a flux balance model of metabolism that involves thousands of reactions and metabolites enabled us to generate new hypotheses that we then tested directly in the laboratory.

the most striking result of this work was the prediction that subpopulations within e. coli colonies naturally engage in cooperative acetate crossfeeding. this was not due to the evolution of distinct crossfeeding genotypes, as is known to occur in long-term continuous culture experiments, but rather it emerged from the cells’ own regulatory responses to their local microenvironments within the colony. depending on location, some cells experienced a glucose-rich anoxic environment that drove them toward acetate-producing fermentative metabolism, while others experienced a glucose-poor aerobic environment that favored acetate-consumption. this behavior remained robust over a range of common agar glucose concentrations, meaning that it may be occurring—completely unnoticed—in laboratory incubators the world over.

the simulated colonies exhibited realistic growth dynamics. the same glucose and oxygen gradients that gave rise to acetate crossfeeding also gave rise to a ring of fast-growing pioneer cells at the colony’s edge, and significantly hindered the growth of much of the colony interior. the pioneer ring had a profound impact on the macroscopic shape and growth of the simulated colony, leading to both its broad and flat appearance and its linear radial expansion .

several features of our modeling technique proved essential to our study. the first, and most critical, was its ability to perform 3d simulations with fine spatial resolution. the concentration profiles of oxygen and glucose within the colony changed dramatically over short distances in both the radial and vertical directions. the penetration depth of oxygen, for example, was only around  <dig> μm from the edge of the colony, while the penetration depth of glucose at the colony center was only around  <dig> μm upward from the agar. accurately accounting for these steep gradients required the use of a 3d lattice with a spacing of on the order of  <dig> μm. although a similar method was recently reported  <cit> , it was restricted to two spatial dimensions and its reliance on costly on-the-fly fba calculations severely limit its practicality for performing the millions of metabolism evaluations per-timestep necessary to resolve these profiles. in contrast, our use of precomputed fba lookup tables enabled us to preform our simulations at nearly real-time speeds. our code, running on the keeneland supercomputer  and on a linux desktop machine  performed the simulations presented here at speeds of approximately  <dig>  and  <dig>  simulated minutes per wall-clock hour, respectively. the second feature that proved critical was our method’s ability to account for the regulation of resource use by the modeled cells. naively using fba alone led to some cells simultaneously taking up glucose and acetate in a manner at odds with experimental data. by requiring the colony to obey a phenomenological model of the acetate switch, this pathological behavior was ameliorated, and the potential for acetate crossfeeding to emerge within wild-type e. coli colonies was more realistically modeled.

it is worth noting that our use of precomputed fba tables, while offering vast speedup over on-the-fly evaluation, does carry some drawbacks. the most pressing of these is that the modeler must have some notion of the substrates that are likely to play a role in the colony’s collective metabolism before a simulation can be launched. our choice to model only glucose, oxygen, and acetate was informed by earlier work simulating significantly smaller clusters of cells  <cit>  and some preliminary fba calculations. nevertheless, this choice can in some ways limit the scope of the simulations. for example we knowingly ignore the potential for succinate crossfeeding  as well as possible toxic effects due to the production of ethanol within the colony . incorporating larger numbers of substrates into a lookup table is straightforward, but can be time consuming as it increases the dimensionality of the table, and in turn, the number of fba calculations required to produce it. ultimately, the choice of using table lookups or on-the-fly fba solving comes down to a choice between computational speed/resolution and model flexibility/universality. with enough prior knowledge of the phenomenon to be simulated, a table-based method vastly out-performs on-the-fly solving, but for purely exploratory simulations in which large numbers of metabolites are simulated simultaneously, an on-the-fly method may potentially yield novel behaviors that the modeler did not anticipate.

although our methodology represents an important step in using fba in both a spatially- and temporally-resolved manner, neither it, nor any other current implementation, can fully account for all biologically significant phenomena. one important example stems from the inherent determinism of the method which yields only average behaviors. stochastic gene expression has been shown to give rise to significant metabolic variability, even among cells in otherwise identical environments  <cit> . the method we present does not account for this type of cell-to-cell variability; the cells in a given lattice site are assumed to behave identically, engaging in the optimal metabolism possible given their local substrate availability. additional uncertainties arise in the number of cells that actually seed a given colony; our simulations assume a single cell, but it is difficult to experimentally verify the exact number of cells left in a given location when an agar plate is streaked. these effects are evident even at the macroscopic level—while the heights and widths of experimental colonies show considerable variability , our simulated colonies show none. a natural way forward in this regard is to shift toward an agent-based modeling approach where individual cells may be represented within a continuous field of diffusing substrates. this could allow for stochastic gene expression to be explicitly accounted for within each cell; the gene expression state of a cell might be sampled from experimental distributions and used to apply constraints within the cell’s metabolic network in a manner similar to that of  <cit> . additionally, by resolving individual cells and their intercellular forces, an agent-based approach may better account for the early development of the colony as it transitions from 2d to 3d growth  <cit> —a behavior that is poorly accounted for in our current implementation.

our modeling technique can be applied to the study of communities involving many different microbial species. several different cell types—each employing their own metabolic model—can be simultaneously simulated, and because the different cell types can transform into each other, regulation systems much more complex than the acetate switch described here can be studied. beyond obvious future studies of biofilms, perhaps the most exciting applications of this technique may come in the form of tissue and tumor modeling. like the colony models presented here, steep oxygen gradients are known to form within cancerous tumors that profoundly affect their metabolism  <cit> . within certain cancers these oxygen gradients have even been reported to give rise to lactate crossfeeding in a manner strikingly similar to the acetate crossfeeding seen in our simulations  <cit> . there are already several flux balance models of different human cancers available in the literature  <cit> . these can be leveraged to build new 3d models capable of studying everything from environmental fluctuations and metabolic reprogramming within a cancer to the interactions between cancers and their surrounding tissues.

