BACKGROUND
the process of protein synthesis inside the cells begins with the transcription of a gene sequence from dna to messenger rna  in the cell nucleus. the mrna is then transported outside the nucleus and the sequence encoded in the mrna chain is translated into amino acids that form the corresponding protein for that particular sequence. since proteins are translated directly from mrna chains, the quantity of each mrna chain that is present in a cell is indicative of the corresponding protein synthesis, i.e. the gene expression. the goal of a microarray experiment is the quantification of the amount of mrna present in a test sample compared to that of a reference sample.

the first step of such an experiment is the isolation of the test and reference mrna samples. these two samples are reverse-transcribed into complementary dna , amplified using polymerase chain reaction and labelled, usually by means of two distinct fluorescent dyes such as the red cy <dig> and the green cy <dig>  the labelled cdna is hybridized on a microarray device that consists of a solid substrate and a large number of spots, where single-stranded chains of known dna sequences are attached. each of these sequences corresponds to a part of a specific gene. the sample cdna can only be hybridized with its complementary sequence. the hybridized microarray is then scanned at the wavelength of each dye and the output of the experiment is a high resolution greyscale digital image for each wavelength. such an image consists of a matrix of blocks, each of which contains a number of rows and columns of spots. the grey level intensity of each spot signifies the degree of hybridization of the labelled cdna sample to the known dna sequences, thereby indicating the expression levels of the respective genes.

the gene expression levels are extracted from microarray images in three steps. the first step of this process is the separation of the blocks present in the image. the next step is gridding, i.e. the construction of a grid covering each block so that it isolates each spot into a distinct cell, enabling the localization of each spot. the last step involves the segmentation of the spots from the background of the image and the quantification of the intensity of each spot, which corresponds to the expression level of the respective gene.

the distance between the blocks of each image is significantly larger than the distance between the spots of each block, thus the blocks can easily be separated. a variety of approaches have been proposed for block separation and have achieved accurate results. these include the analysis of the distances between neighbouring spots  <cit>  and the use of projections of the image pixels to the x and y axes  <cit> . in contrast to the block separation step, the process of gridding poses several challenges and has a significant impact on the accuracy of a microarray experiment  <cit> . a gridding algorithm should be able to grid images that include spots of various shapes, sizes and intensities, while being robust to noise and artefacts introduced at a microarray preparation stage, as well as rotation due to slight misalignments of the scanning robot coordinate system to the image coordinate system  <cit> . furthermore, it is desirable that the gridding be automatically performed, without any user intervention that would possibly affect the microarray experiment, as well as limit the processing throughput of large amounts of microarray images.

several methods have been proposed for microarray image gridding; they can be viewed in terms of automation as manual, semiautomated and fully automated  <cit> . however, most of the proposed methods are not fully automated and require manual tuning of parameters or other user intervention. for example, the state of the art method implemented in imagene  <cit>  is semiautomated, requiring the tuning of a multitude of parameters, whereas in the manual gridding methods implemented in scanalyze  <cit>  and spotfinder  <cit> , the process of gridding is performed interactively by the user. the method proposed by brändle et al.  <cit>  is parametric, requiring estimated values for several parameters.

only a few state of the art methods have been proposed as providing automatic gridding, but most of them do not address all requirements of fully automatic gridding, i.e. handling of irregular spots and robustness against noise, artefacts and image rotation. the state of the art method proposed by angulo et al.  <cit>  is based on mathematical morphology and requires that grid rows and columns are strictly aligned with the x and y axes of the microarray image. the same requirement is imposed by the hill-climbing approach proposed by rueda et al.  <cit> . a fully automatic region segmentation approach based on markov random fields was proposed by katzer et al.  <cit>  but the results showed that its performance is diminishing in the presence of weakly expressed spots. the bayesian grid matching method proposed by hartelius et al.  <cit>  employs an iterative algorithm to solve a complex deformable model for accurate microarray gridding, whereas methods producing simpler linear grids such as  <cit>  and  <cit>  have been proved highly accurate as well. blekas et al.  <cit>  proposed a method based on gaussian mixture model, whereas later a methodology combining a stochastic search approach for the grid positioning and a markov chain monte carlo method was proposed by antoniol et al.  <cit>  to account for local deformations of the microarray image. however, this approach cannot be considered as fully automatic since it requires prior knowledge about the number of rows and columns of the spots in the microarray image. another method based on voronoi diagrams was proposed by giannakeas et al.  <cit> , however it requires that artificial spots are introduced in place of the spots that are very weakly expressed. recently, a heuristic gridding approach based on a genetic algorithm was proposed by zacharia et al.  <cit> . this algorithm provides a near optimal gridding outperforming the method proposed by blekas et al.  <cit> , while being robust to both noise and rotation. however, it is well known that the genetic optimization processes tend to require long processing times to converge, since a multitude of possible solutions has to be created and evaluated.

in this paper we propose a novel methodology for automatic cdna microarray gridding based on a computationally efficient optimization approach. the proposed methodology is based on the maximization of the margin between the consecutive rows and columns of the microarray spots, which is implemented by training a linear maximum margin classifier with an automatically detected subset of spots on the microarray image. the classifier determines the optimal positioning of each grid line, whereas the use of the soft-margin variant provides robustness to outliers. this methodology, named m3g  is supported by a non-parametric radon-based rotation estimator of general applicability for cdna microarray images. the novel contributions of the proposed method include:

• optimal grid line determination through margin maximization

• fully automatic gridding without user intervention

• robustness to a wide range of image imperfections, including rotation, artefacts, noise and weakly expressed spots

• higher accuracy than the state of the art methods

all algorithms have been implemented under a gnu/linux environment. the m3g software is publicly available  <cit>  and also provided along with the manuscript . a preliminary version of the proposed methodology, which involved an arbitrary threshold setting in the spot detection process and a crude rotation estimator, has been presented in  <cit>  along with a limited experimental evaluation.

methods
the proposed method consists of the steps illustrated in the flowchart of fig.  <dig> 

rotation estimation
the 16-bit greyscale microarray image  is initially analyzed by the radon transform , which is applied to estimate the image rotation angle. the radon transform has been the method of choice for microarray rotation estimation in approaches such as  <cit> .   

in the above equation, the grey level intensity of the image in pixel  is denoted by i. in the transformed image illustrated in fig. 2b, the intensity of each pixel with coordinates  is equal to the integral of the image brightness over a straight line with an angle a to the x axis and a distance r to the origin. the rotation angle θ of the microarray image is estimated by locating the column with the highest mean brightness in the transformed image, which is denoted by the arrow. the image is subsequently counter-rotated by angle θ as illustrated by fig. 2c.

preprocessing
the next step involves the pre-processing of the microarray image by linearly normalizing it so as to fit the intensity histogram to the full dynamic range of the 16-bit image. the image is then quantized to  <dig> grey levels in order to reduce the computational complexity of the next steps. subsequently, the edges of the spots are detected by the application of the sobel operator  <cit>  on the normalized image. a threshold is determined automatically using the otsu method  <cit>  in order to binarize the image and isolate the sharpest edges that correspond to spots, as illustrated in fig. 2d.

since the image has been normalized to the full dynamic range and the result of the preprocessing step is a binarized image, the quantization error is expected to affect a very small number of pixels. indeed, in the data set used for the evaluation of the proposed method , the percentage of the affected pixels in each binarized image was less than  <dig> %, having no effect on the subsequent grid placement.

spot detection
the binarized image is then analyzed so as to locate all the groups of consecutive white pixels that reside on the same spot edge. each of these groups is characterized by the location of the center pixel and the size of the group. fig. 2e illustrates the detected groups by representing them as rectangles that circumscribe the pixels of each group. ideally, each rectangle should contain the edge pixels of a single microarray spot, however depending on the threshold used, it might also include artefacts or multiple merged spots, due to the noise present in the image and the inter-spot proximity. a spot selection step is introduced in the next subsection, in order to refine the spots based on their shape and size characteristics resulting in the rectangles shown in fig. 2f.

spot selection
the spot selection process aims to the removal of false spots introduced by noise and artefacts. in the spot selection step, the aspect ratios of the detected pixel groups are first evaluated. considering that the ideal spot shape is circular, the rectangles  should not deviate much from being square, so that each rectangle contains only one microarray spot. therefore, the aspect ratio of each spot must be close to unity. then, a lower bound smin and an upper bound smax of the spot sizes are calculated so as to maximize the similarity of the spot size distribution to the normal distribution. the spots that have sizes out of the calculated bounds are considered false and discarded.

in order to quantify the similarity of the distribution of the spot sizes to the normal distribution, it has to be taken into account that the spot sizes can only be positive, in contrast to the normal distribution n   that also spans into the negatives. the comparison should therefore be made to a normal distribution for which the negative values are explicitly set to zero. such a distribution nm  can be derived by nullifying the probability of n  for x <  <dig> and scaling it accordingly so that the total probability remains equal to unity. the corresponding cumulative distributions c and cm are expressed by eqs.  <dig> and  <dig> respectively.   

a measure of dissimilarity e between the discrete probability distribution of the spot sizes and the continuous probability distribution nm can be established based on their respective cumulative distribution functions. the cumulative histogram of the spot sizes ch is defined as a function of the histogram h as shown in eq.  <dig>  the dissimilarity e is defined as the total area between ch and cm as shown in eq.  <dig>    

the optimal bounds smin and smax are calculated so as to minimize the dissimilarity e defined above. by selecting the spots with sizes within the range defined by these bounds, the resulting cumulative spot size distribution closely resembles the normal distribution, as illustrated in the example of fig.  <dig>  in this case, any spot that is smaller than smin =  <dig>  pixels or larger than smax =  <dig>  pixels is considered false and discarded. it is evident that the cumulative histogram of the selected spots almost coincides with the cumulative normal distribution , whereas the original cumulative distribution  differs substantially from the respective cumulative normal distribution.

distance estimation between consecutive rows and columns
the optimal distance between spot rows is calculated by segmenting the input microarray image into horizontal stripes with a height of dr pixels, as shown in fig. 2g, which are then averaged. if dr is selected so that it is equal to the distance between the rows, the spots of all rows will be in the same relative positions in the horizontal stripes, therefore they will be highly overlapping in the resulting average stripe. thus, the average stripe will contain well defined spot areas, as illustrated in fig. 4a. if a suboptimal value of dr is selected, the spots will reside in different relative positions in the horizontal stripes and will thus blend with the background in the average stripe . the optimal value of dr is selected by maximizing the standard deviation of the pixel intensities of the average stripe. the standard deviation can be used as an effective measure of spot overlap, since high values of the standard deviation indicate distinct dark and bright areas, whereas low values of the standard deviation indicate abundant grey areas. thus, the standard deviation should be maximized with respect to dr in order to obtain the optimal value of dr. the optimal column width dc is likewise estimated using vertical stripes.

a wide range of dr values is tested in order to find the optimal value, ensuring successful estimation without any user intervention. the standard deviation  of the average stripes is calculated for all values of dr within that range, using a small real valued step. from all the tested values of dr, those that result in local maxima of the standard deviation are selected. these local maxima are most often located on multiples of the optimal dr, since such an estimation also results in highly overlapping spots. for each of the selected dr values, the mean of the resulting standard deviation  in its neighbourhood is calculated. the neighbourhood for the calculation of each  is equal to the range between its adjacent local maxima. the value of dr that results in the highest value of the  ratio is selected as optimal.

another method for estimating the distances between rows and columns of spots has been proposed by ceccarelli et al.  <cit> . it employs the orientation matching  and radon transforms in order to extract the spot positions and grid rotation respectively. subsequently, the spot locations are projected on the axes of the grid and the distance between rows and columns is estimated. this method requires prior knowledge about the radii of the spots and uses a filter for noise reduction. in contrast to this approach, the proposed method performs distance estimation without any parameters or arbitrarily selected filters, based on the maximization of the standard deviation of the average stripe. this maximization over a wide range of dr values allows successful estimation without any user-defined parameters, whereas the use of the average stripe acts as a low pass filter, allowing high tolerance to noise. an evaluation of the distance estimation for noisy images has been included in the results section.

maximum margin gridding
in order to determine the optimal grid lines, each spot that has been selected by the spot selection step  is represented by a vector , i =  <dig> .. n, where n is the total number of selected spots in the image and the components of each vector  are the coordinates of the spot centre. these vectors are assigned into distinct rows and columns, based on the distances dr and dc, which were previously estimated. each pair of consecutive rows or columns of spots can now be separated by a single separating line. the optimal separating line is positioned so as to maximize the margin between the rows or columns of the spots. for a pair of rows numbered k and k +  <dig>  the vectors that belong to row k or to any row above it are assigned a class label ci = + <dig> and the vectors that belong to row k +  <dig> or to any row below it are assigned a class label ci = - <dig>  these vectors , along with their respective class labels ci are provided as a training set to a linear support vector machine  classifier  <cit> , which produces the maximum margin grid line.

in this particular application, the svm classifier is provided with the aforementioned training set . by solving a quadratic programming optimization problem, it produces the normal vector  and the parameter b of the separating line , which maximizes the margin between vectors  of different classes, i.e. the margin between spots of distinct rows or columns. the width of the margin is equal to 2/||w||, therefore the widest margin is found by minimizing ||w|| under the constraints ci ≥  <dig>  i.e. requiring that all the spots lie on the correct side of the resulting grid line.

the support vector machine described above is called a hard-margin svm and does not take into account any outliers. one of its properties is that the separating line is solely determined by the vectors that that lie on the edges of the margin, called support vectors. in a linear svm, a very small number of support vectors determine the separating line and the margin. in the case of outliers present inside the margin, the positioning of the separating line will be exclusively determined by the outliers and will thus be suboptimal for gridding. this problem can be solved using the soft-margin svm, where a slack variable ξi is introduced for each vector . the constraints are then formulated as  and the separating hyperplane can be found by minimizing   

where c is a cost parameter that determines the effect of outliers on the positioning of the resulting grid line. large values of c result in a grid line that is mostly determined by any outliers, while on the other hand, smaller values of c result in a grid line that follows the general trend of the spot locations given to the classifier, virtually ignoring any outliers. the hard-margin classifier is equivalent to a soft-margin classifier with an infinitely large c  <cit> .

the soft-margin svm is employed, in order to diminish the effects of misdetected spots that result from artefacts or noise. a small fraction of these outliers might have a shape and size similar to valid spots and could therefore pass through the selection step without being discarded. the soft-margin svm ensures that such outliers will not have an impact on the produced grid lines. for ideal microarray images, where all spots could be successfully detected and no outliers are present, a hard-margin svm could be used as well, but a gridding application for real microarray images requires robustness against outliers. furthermore, in ideal noiseless images, the training set for the svm classifier would consist only of the necessary spots, i.e. those residing on rows k and k +  <dig>  however, in real microarray images, there are cases where several consecutive spots might be very weakly expressed and therefore not detected. in order to cope with this problem, spots from rows above k and below k +  <dig> are included in the training set, providing redundant data to the classifier to ensure successful gridding. using an algorithm based on the sequential minimal optimization  to solve the svm optimization problem  <cit> , the additional data introduces only a small computational overhead, since such algorithms evaluate vectors that are far from the separating line in only the first few iterations of their outer loops  <cit> . the svm has been selected over similar methods for the determination of the grid lines, such as a least squares fit, because the soft margin svm is adjustable with regards to its tolerance to outliers through the cost parameter c  <cit> .

in the case that row k contains less than two detected spots, the two grid lines that separate this row from rows k -  <dig> and k +  <dig> cannot be determined by the use of the svm classifier. this is a rather rare case considering that the image is normalized during the preprocessing step. to cope with this limitation, the endpoints of the two grid lines are positioned equidistantly between the endpoints of the first neighboring grid lines above and below them. in the case where the top or bottom rows of spots contain less than two spots, the endpoints of the grid lines that cannot be determined are positioned dr pixels further from the nearest grid lines.

fig.  <dig> illustrates the case of gridding in the presence of an obvious outlier, denoted by the arrow. it is evident that for a small value for the cost parameter c  the margin is determined by the other spots in the row and the outlier is ignored, whereas for larger values of c  the outlier affects the positioning of the separating line by moving it significantly closer to the vectors of the top row, reducing the margin and rendering it suboptimal for gridding.

RESULTS
data sets and evaluation method
two data sets were used for the evaluation of m3g. the first data set consists of  <dig> cdna microarray images from the stanford microarray database  <cit> . the images are tiff files with a resolution of  <dig> ×  <dig> pixels and 16-bit grey level depth. each image includes  <dig> blocks of  <dig> spots each, resulting in a total of  <dig> , <dig> spots in the data set. these images have been produced for the study of the gene expression profiles of  <dig> specimens of bcr-abl-positive and -negative acute lymphoblastic leukemia  <cit> . this data set is a superset of the one used by the preliminary version of the proposed method  <cit>  and the genetic algorithm approach proposed in  <cit> . this data set is accompanied by ground truth annotations regarding the positions and the sizes of the spots. fig.  <dig> visually validates the resemblance of the distribution of the sizes of the spots in the data set to the nm distribution.

the second data set consists of  <dig> microarray blocks selected from distinct microarray images that were artificially created or obtained from public microarray databases. the blocks are stored in tiff files with 16-bit grey level depth. this data set has been used for the evaluation of the method proposed by blekas et al.  <cit>  and has been obtained from the authors of  <cit> .

in order to produce directly comparable results with the aforementioned methods, the same statistical analysis is performed. each spot was evaluated as being perfectly, marginally or incorrectly gridded when the percentage of its pixels contained within its grid cell is 100%, more than 80%, or less than 80% respectively.

comparative evaluation
the evaluation results of m3g for the first data set are shown in table  <dig>  along with the corresponding results of the preliminary version of the proposed method and the genetic algorithm approach. in order to evaluate the sensitivity of the proposed method to missing spots, two experiments were conducted: in the first, all selected spots were used for the svm training process, whereas in the second, half of the selected spots were randomly discarded. both experiments resulted in perfect gridding for more than 98% of the spots in the data set, whereas only up to  <dig> % and  <dig> % of the spots were marginally and incorrectly gridded respectively. these results illustrate that the proposed method can achieve almost perfect gridding, even in the case of significantly fewer detected spots.

the evaluation results for the second data set are shown in table  <dig> and reveal that the proposed method achieves a significantly lower percentage of marginally and incorrectly gridded spots compared to the user-guided approaches  <cit>  and the automatic approaches  <cit> .

in comparison to the preliminary version  <cit> , several improvements allow a significant enhancement of gridding accuracy:

• automatic selection of spots based on the distribution of their sizes

• automatic determination of the operating parameters, such as the edge detection threshold and the upper and lower bounds of the sizes of the spots

• inclusion of all selected spots into the training set of each svm classifier instead of only pairs of rows or columns of selected spots

• more accurate rotation detection using the radon transform

the method used for the evaluation of the gridding accuracy by  <cit>  involves the measurement of the distance between each spot center and the center of its respective grid cell. the mean value and standard deviation of these distances are used to evaluate the localization of the spots by the grid. the results of m3g as compared to the ones presented in  <cit>  are shown in table  <dig>  the proposed method achieves a 50% smaller mean distance and a 33% smaller standard deviation as compared to the best results presented in  <cit> , illustrating the advantageous performance of the proposed method with regards to the localization of the spots. even when half of the selected spots are randomly discarded to simulate the case of significantly fewer detected spots, m3g still achieves a better localization than the best results of  <cit> .

the gridding performance of m3g was evaluated by following a grid search approach for the determination of the optimal value for the svm cost parameter c. the results are presented in fig.  <dig>  the svm cost parameter c determines the effect that outliers or noise might have on the positioning of the separating lines produced by the svm, therefore a small value of c should be selected for successful gridding. the choice of c = 10- <dig> is supported by the results, as it produces the most accurately gridded spots compared to the other values of c. lower values of c do not increase the achieved accuracy, but the choice of a larger value results in a reduction of the achieved accuracy due to the corresponding increase of significance of outliers.

fig.  <dig> illustrates the gridding that results from the application of m3g on a microarray image area that includes a large and bright artefact. even in the vicinity of the artefact, the gridding is not affected by its presence. fig.  <dig> illustrates the resulting gridding for three more such images, including a detailed view of the area around each artefact. despite the presence of these artefacts, the proposed method achieves successful gridding in all those cases.

time performance
the proposed method was also evaluated with regards to its computational time requirements. the evaluation platform is based on an athlon  <dig> x <dig> 3800+ processor and includes 3gb of ram, whereas the blocks used belong to the first data set and their dimensions are roughly  <dig> ×  <dig> pixels. for the first block in each microarray image, our method requires  <dig> seconds of processing time, most of which is used for estimating the distance between consecutive rows and columns of spots. for any subsequent blocks of the same image, the range of possible values for dr and dc is reduced, resulting in  <dig> seconds of processing time. it is worth noting that the processing times mentioned above can be significantly reduced by optimizing the implementation and by using multiple cores of the processor, as the most time consuming parts of the gridding process can be efficiently parallelized. the genetic algorithm approach  <cit>  requires a processing time of  <dig> seconds for each microarray image block, which is nearly one order of magnitude larger than the time required by m3g.

evaluation of the rotation detection
in order to assess the performance of the rotation estimation step, the images in the first data set were randomly rotated by angle θreal ranging from -25° to +25°. the proposed rotation detection method was then used to compute an estimate θest of the rotation for each image. based on that estimate, the images were counter-rotated and subsequently gridded. the evaluation was performed based on the mean and standard deviation of the difference between the real and estimated rotation of the images Δθ = θreal - θest. both the mean difference μΔθ and the standard deviation σΔθ were below  <dig> °. the accuracy achieved when gridding the counter-rotated images was within  <dig> % of the accuracy obtained using the original images, thus the introduction of rotation results in only negligible variation of the gridding accuracy.

evaluation of the distance estimation
the distance estimation step was evaluated with regards to its tolerance to noise. additive gaussian noise was introduced to fifty randomly selected blocks from distinct real microarray images of the first data set. the standard deviations used were σ =  <dig>   <dig> and  <dig>  resulting in mean signal to noise ratios of  <dig> db,  <dig>  db and  <dig> db respectively, whereas in several cases the introduced noise was stronger than the signal in the image. for all the images and noise levels tested, the distance estimation step displayed a negligible variance of up to  <dig>  pixels, illustrating that the use of the average stripe for distance estimation provides very high tolerance to noise.

CONCLUSIONS
in this paper we presented m3g, a novel method for gridding cdna microarray images without user intervention, based on the maximization of the margin between consecutive rows and columns of spots. the proposed method involves several preprocessing steps, including a radon-based rotation estimation for the microarray image, as well as spot detection and selection. the distance between rows and columns of spots is then estimated and the positions of the selected spots are used to train a set of linear soft-margin support vector machine classifiers. the use of soft-margin svms allows high tolerance to outliers that result from artefacts and noise, whereas the use of redundant vectors in the svm training set and the automatic determination of the operating parameters facilitate a substantial increase in gridding accuracy. overall, the proposed method achieves successful automatic gridding of cdna microarray images in the presence of irregular spots, noise and artefacts, as well as image rotation.

the experimental results on reference dna microarray images containing more than two million spots showed that the proposed method outperforms the most accurate state of the art methods, providing the potential of achieving perfect gridding for the vast majority of the spots.

competing interests
the authors declare that they have no competing interests.

authors' contributions
all authors were equally involved in the conception and design of the m3g method, as well as the writing and revision of the manuscript. db developed the implementation of m3g and performed the experiments.

supplementary material
additional file 1
m3g software. all algorithms have been implemented under a gnu/linux environment. the m3g software is publicly available at the downloads page of http://rtsimage.di.uoa.gr/ and also provided along with the manuscript as an additional file.

click here for file

 acknowledgements
the authors would like to thank k. blekas, n. p. galatsanos, a. likas and i. e. lagaris for providing one of the data sets used for the evaluation of the proposed gridding method. the authors would also like to thank the anonymous reviewers for their constructive and insightful comments.

this work was realized under the framework of the reinforcement program of human research manpower , co-funded 25% by the general secretariat for research and technology, greece, and 75% by the european social fund.

this work was partially funded by the special account of research grants of the national and kapodestrian university of athens .
