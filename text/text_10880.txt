BACKGROUND
a central problem in molecular biology is to understand how proteins and dna interact to regulate genes that lead to phenotypic diversity. given massively parallel second generation sequencing technologies  <cit> , huge collection of data are being generated for a wide diversity of regulatory elements genome-wide . the huge datasets enable us to comprehensively study the mechanics of gene regulation among multiple factors across many cell types and experimental conditions simultaneously  <cit> . key regulators functioning in specific cells/conditions and their impacts to gene expression can therefore be pinpointed with substantially improved power and specificity than conventional approaches  <cit> . new hypotheses about the dynamics of the epigenetic landscape during differentiation can consequently be derived and tested to illuminate previously intractable issues in the genetics of disease susceptibility  <cit> .

how to effectively analyze the huge collection of epigenetic data sets is a major challenge. many computational methods have been developed to make binary presence-absence calls for detecting protein-dna interaction events in a single condition  <cit> , which are then used in down-stream analysis to study gene regulation and differentiation  <cit> . although the binary calls of interaction events, such as transcription factor  binding, have been shown to aid the study in gene regulation, such an approach is problematic because the same event may be called differently due to the choice of thresholds and the data scale in different samples. alternatively, quantitative methods   <cit>  have been used to study differential or condition-specific binding variations. such an approach is often overly simplistic that does not account for the possible heterogeneity in the real data. when there are few replication data available, it is also difficult to obtain good estimates of the heterogeneous variance of the noise, which then greatly reduces the sensitivity of the study.

more recent approaches have been developed to quantify binding variations among multiple features or samples  <cit> . kasowski et al. used pairwise anova to study the genome-wide binding strengths of pol <dig> and nfkappab between each pair of the  <dig> individuals at merged binding regions  <cit> . in addition to using traditional statistical tests, some other studies adopted methods developed previously to identify differential expressed genes to detect differential bindings in chip-seq experiments  <cit> . for example, a gene stability measure m was defined by vandesompele et al. as the average pairwise standard deviation between any particular gene and all other genes  <cit> . ozer et al. adapted the stability measure to determine most variable regions binding regions across all  <dig> chip-seq experiments. however, this stability measure does not provide a measure for statistical significance and it's also difficult to interpret the value m across different experiments. taslim et al. developed dime that takes normalized differences of chip-seq counts in each genomic bin as input and used a finite mixture model  to identify genes with differential binding for a specific protein in two conditions  <cit> . instead of using genomic bins in taslim et al. for normalization, shao et al.  <cit>  later proposed a method called manorm to improve data normalization in chip-enriched regions  based on the assumption that most common peaks have the same binding strength to build the rescaling model similar to dime. they used a bayesian model developed for detecting differential gene expression to determine the significance of differential binding  <cit> . while dime and manorm have been developed for comparing binding signals for a single protein, a more recent method dpca  <cit>  uses a small number of principle components to summarize the pattern of difference in multiple proteins between two samples.

these methods, however, are limited to two-sample comparisons. as the number of conditions increases, pairwise comparison will become computationally expensive. combining and interpreting the data from pairwise results can also be inconsistent. to overcome the limitation of pairwise comparison, dbchip was recently developed to allow comparison in multiple conditions  <cit> . the method first clusters nearby predicted binding sites into consensus sites across multiple conditions, and then uses a generalized linear model with negative binominal distribution to detect differential tf binding across samples. dbchip however only considers one protein at a time. biologically, protein-dna interactions are correlated among regulators. combined patterns of signals for different epigenetic features can provide more insights towards the regulatory mechanisms in cells. a most recent method, jmosaic  <cit> , jointly analyzes multiple epigenetic features in multiple samples. jmosaic internally partitions signals into presence or absence events, and hence only detects qualitative variation.

in need of a systematic, powerful and flexible method for simultaneous integration and comparison of chip-seq data for multiple epigenetic features in multiple conditions, we introduce a unified method, dcap , to detect and quantify protein-dna interaction events and their variations by treating multiple tracks of features as multivariate samples sequenced in multiple conditions. here, a "condition" can be an experimental condition, or more broadly, a tissue, a cell type, or a sample with phenotypes. dcap uses locally weighted smoothing to estimate the heterogeneous variance of noises in the data, such that it is free from the unrealistic constant variance assumption, but at the same time it retains power even for small sample experiments. dcap can work with or without replicates. after normalization, dcap utilizes a three-step log-likelihood ratio test  to jointly identify multiple protein-dna interaction events in multiple conditions genome-wide, detect regions with significant signal variations in at least one feature across conditions, and classify the detected regulatory loci for condition-specificity. while existing methods detect condition-specific events via binary calls, dcap detects quantitative variations.

we applied dcap to two real studies to demonstrate the power and the utility of dcap. the first data set consists of  <dig> data tracks  from the human encode consortium. we chose five human cell lines: gm <dig>  huvec, hela-s <dig>  hepg <dig>  k562; and three regulatory factors in each cell line: transcription factor ctcf, rna polymerase ii  and dnasei sensitivity of the chromatin   <cit> . each factor in each cell type has  <dig> replicates. by applying dcap, we identified  <dig>  statistically significant occupancy regions genome-wide, among which  <dig>  contained differential signals and  <dig>  were further cell-type specific. clustering analysis revealed two major clusters of occupancy patterns in the five cell lines. one cluster showed consistently enriched signals for all three factors and they were enriched near genes showing functions highly relevant to each of the cell types. the other cluster showed depleted signals for all three factors and they were strongly associated with homozygous deletions in the three cancer cell lines . the results by dcap indicated potential regulatory regions responsible for cell-type specific biological behaviours. we further applied dcap to detect differential tal <dig> occupancy in response to gata <dig> restoration in two mouse erythroid cell lines. conventional approaches use peak callers  to identify binary binding events in each cell line separately and then take the difference between cell lines. such solutions are sensitive to the peak calling thresholds and cannot detect quantitative variation in tal <dig> occupancy. using dcap, we identified a large set of novel differential tal <dig> occupancy missed by the binary peak calling method, and they were highly significantly associated with gata <dig> occupancy as well as differential gene expression. dcap is simple but powerful. it can be widely applied to many studies for simultaneous comparison of multivariate chip-seq data across multiple conditions.

methods
datasets
human encode data: mappings of short reads of ctcf, pol <dig> and dnasei to the human genome  were collected from the encode open chromatin data from the duke/unc/ut-austin/ebi encode group for  <dig> selected cell lines  <cit> . the five chosen cell lines are: k <dig> erythroleukemia cells  <cit> , hela-s <dig> cervical carcinoma cells  <cit> , hepg <dig> hepatoblastoma cells  <cit> , gm <dig>  a b-lymphoblastoid cell line  and primary  human umbilical vein endothelial cells   <cit> . among the  <dig> cell lines, the first three are cancer cell lines and the last two are relatively normal cell lines. we used two replicates in each of the  <dig> data types , resulting in  <dig> tracks of data in total.

mouse enocde data: we obtained read counts by the chip-seq experiments of tal <dig> in two mouse erythroid cell lines  from wu et al.  <cit> . each cell line contains two data replicates. the union of tal <dig> binding peaks reported from wu et al.  <cit>  in the two conditions were used to detect the differential binding by dcap. the cell line g1e is derived from in vitro differentiated gata1-null mouse es cells, proliferates as committed erythroid progenitors and undergoes terminal differentiation upon restoration of gata <dig> expression  <cit>  and its subline g1e-er <dig> expresses an estrogen-activated gata1-estrogen receptor  transgene.

data pre-processing
human encode data: we used f-seq  <cit>  to generate continuous tag sequence density estimation in 1-bp resolution for all  <dig> data tracks. we then computed the sum of tag sequence density in 1-kb tiled windows across the human genome for hypothesis testing of common and differential occupancy across cell lines. blacklist regions from ucsc assembly gaps and the duke excluded regions were found to have the anomalous high signals and thus excluded in our analysis. this resulted in  <dig> , <dig> windows for testing across the human genome, excluding the y chromosome. we further took log2-transformed density to reduce the skewness of the data. a small constant  was added to the value when taking the log <dig> to avoid numerical problems. based on the log <dig> density values in 1-kb windows, we further performed quantile-normalization  <cit>  on the  <dig> data tracks  for each factor to make datasets across cell types comparable.

the quantile normalization does not necessarily remove the systematic bias within replicates. we further applied loess  normalization  <cit>  on the log <dig> transformed density of each data track. let xj,k,ri denote the data value in window i, cell line j, factor k and replicate r, and let x ¯k denote the mean of factor k across all cell lines and replicates in window i. we applied loess function by regressing  on the factor mean x ¯k, for data in all windows in each data track. the loess estimate x ˜j,k,ri was then subtracted from xj,k,riso that the new values ) has mean  <dig> across windows. for large datasets, loess computation can be slow, and the fitted curve can be overly smooth or curvy at different values using a fixed smoothness parameter. to increase computing speed and to fit local curves better, we partitioned the data values into bins and we subsampled data with equal frequency from each bin. this prevented the fitting curve being biased by the unbalanced data where the data points were much denser at low signals and sparser at high signals. we sampled 1% of the total data using  <dig> bins and the maximum number of data points per bin was bounded by the total number of sampled points divided by the number of bins. for the loess parameters, we used span =  <dig>  with locally linear fit .

mouse enocde data: we obtained the processed data  from wu et al. . we took the average log <dig> value of the read counts within each detected binding region and performed quantile-normalization. the values were then used as the input to dcap for testing differential binding.

method notations
we propose three log likelihood ratio tests  under asymptotic multivariate normality assumption. for notation consistency, we use lowercase/uppercase bold letters to denote vectors and matrices, respectively, and we use uppercase regular letters for constants. although negative binomial distributions or other distributions with over-dispersion parameters are often used for modeling *-seq data, they cannot be easily adopted to model the joint distribution of multivariate signals with covariance structures. in our case, covariance is abundant among related proteins, and multivariate normal distributions can conveniently account for the covariance among signals. multivariate normality is also reasonable when testing the means of samples over many conditions, and when proper data transformation is used on the *-seq data, such as log-transformation, averaging signals over intervals, or quantile transformation to z-scores.

let x= denote a c by p data matrix containing log2-transformed signals after proper normalization in c conditions with p variables, for condition j =  <dig> ... c, variable p =  <dig> ... p, and windows i =  <dig> ... n across the genome . for each condition j in window i, the column vector xji consists of k factors with r replicates , and therefore xji has length p = k*r and is represented as xji=xj, <dig> ,ixj, <dig> i,…,xj,k,r-1i,xj,k,ri=xj,1ixj, <dig> i…,xj,pi. we assume that each vector xji follows a p-dim multivariate normal distribution, xji~n with a condition specific mean ûji and a covariance matrix ∑^ji in the ith window, for j =  <dig> ... c. the mean vector ûji has a restriction that the means of replicates of the same factors are identical. we first estimate ûji,∑^ji along with û0i under the null hypotheses. we then use log-likelihood ratio tests to detect potential common and differential regulatory binding events across the genome. hereafter, we use "binding" to denote a protein-dna interaction event, even though our method is technically applicable to detect any signal enrichment and variation in general.

estimation of covariance matrix
to obtain the covariance matrix for condition j in window i, we first estimate a condition specific  correlation matrix r ^j, which is a p by p matrix that captures potential relationships between different factors and replicates. let xj denote the n by p data matrix in condition j in all genomic windows. we want to compute r ^j=cor, where xjbk denotes a data matrix from genomic background  and cor denotes correlation. since xj contains a mixture of binding and non-binding data and binding regions are unknown, estimating background xjbk from xj is not straightforward. directly estimating r ^j by cor will lead to bias, because the binding signals can greatly inflate the correlation between factors/replicates.

assume that xj=xjbk+m, where m denotes an unknown vector of the means of binding signals independent of genomic background. we have

  covxj=covxjbk+cov 

we estimate m by x ¯j, which is an n by p matrix containing the mean of each factor across conditions . as a result, we obtain

  cov ^xjbk=covxj-cov 

and then we compute r ^j by standardizing cov ^xjbk. on the other hand, if input controls are available, r ^j can be obtained directly from the controls. when pre-defined binding regions are available for directly testing differential binding, xj became a n by p data matrix containing the binding signals in all binding regions in condition j. to obtain r ^j in this case, we first subtract mean of each factor across conditions in each row, then we take the bottom 50% of rows ranked by the total variance of centred data to calculate the correlation matrix.

given r ^j, we compute the window-specific covariance matrix, which we assume to be a function of window means. we define the covariance matrix for condition j in window i as

  ∑^j=diagσ^ji×r ^j×diagσ^ji 

where diagσ^ji denotes a diagonal matrix in which the diagonal entries are the estimated standard deviations for the p variables specific to window i. we denote the diagonal entries as

  σ^ji= 

to estimate the standard deviation σ^jpi for each of the p variables in condition j, we assume that the variances of replicates of the same factor are identical, and thus estimating σ^jpi for variables p =  <dig> .. p reduces to estimating σ^j,ki for factors k =  <dig> ..k.

for each factor k in each condition j, we calculated the replicate mean x ¯j,ki and the unbiased estimate of the variance σj,k <dig> of replicates in each window i. due to possible correlation between replicates, the commonly used sample variance estimator may under estimate the true variance. instead, we used the following de-correlated values to estimate the replicate variance σj,k2:

 xj,ki-x ¯j,ki′*chol 

here xj,ki is a vector of length r and r ^j,k denotes a sub-correlation matrix for replicates of factor k in condition j, obtained from the full correlation matrix r ^j. chol denotes cholesky decomposition.

we fitted a loess curve to the ) pair of all windows using the same loess setting described previously in the normalization section. the fitted smooth curve represents a function between replicate mean and variance. at each window i, we estimated σ^j,ki by the square root of the fitted value given by the curve at x ¯j,ki. we do this for every factor k in every condition j to generate diagσ^ji in equation 

log likelihood ratio tests
test  <dig>  detect binding versus non-binding
we first detect binding events of any factor in any condition. we performed a log likelihood ratio test on the null hypothesis h0:

  h0:u1i=…=uci=ubcki 

against the alternative hypothesis h1: at least one uji differs from the background meanubcki. both uji and ubcki denote p-dim vectors of means, and we estimated ubcki as the median signals across all conditions in the ±5kb neighbourhood of window i, for each factor respectively.

under a multivariate normal distribution, the mle ûji in condition j can be obtained by

  ûji=aûjai 

where  a denotes a p by k matrix of 0s and 1s. for each column k =  <dig> ..., k, there are r 1s in rows r+. ûjai is a column vector of length k containing the means for k factors. derivations of the mle of ûji in equation  can be found in additional file  <dig> 

we then fit the parameters obtained previously ) to multivariate normal distribution and computed maximum of the likelihoodsl0i,l1i under the two assumptions h <dig> h <dig> by

  l0i= ∑j=1c-p2ln2π-12ln∑^j-12′∑^j- <dig> 

  l1i= ∑j=1c-p2ln2π-12ln∑^j-12′∑^j- <dig> 

consequently, the standard likelihood ratio is given by lnl0il1i. then we can compute the likelihood ratio test statistic t for the null hypothesis  for window i by

  t=-2lnl0il1i= <dig> 

under the null hypothesis that there are no binding events in window i of all factors in all conditions, t follows an asymptotic chi-square distribution with ck degrees of freedom. note that this test is bi-directional, i.e., both enriched and depleted binding signals relative to the background can be detected. to detect enriched signals only, we can replace xji-ûji by  <dig> whenever it is negative.

test  <dig>  detect differential binding versus common binding
to identify potential regulatory differential binding regions across conditions, we performed a 2nd lrt test on the null hypothesis h0:

  h0:u1i=…=uci=u0i 

against the alternative hypothesis h1: at least one uji differs from the rest, where u0i denote the averaged mean signals across conditions within window i . while we used the same values of uji as used in the 1st test, we estimated the mle û0i by

  û0i=aû0ai 

again, û0ai is a column vector of length k containing the means for k factors, and derivations of the mle of û0ai in equation  can be found in additional file  <dig>  the lrt statistic for the null hypothesis  has the same form as , but with ubcki replaced by û0i in  and . under the null hypothesis that the binding  signals for all factors are consistent across conditions in window i, the test statistic follows an asymptotic chi-square distribution with k degrees of freedom.

test  <dig>  identify condition specific binding
the p-values of our log likelihood ratio tests are given by the tail probabilities of the chi-square distribution with ck degrees of freedom for the 1st test and k degrees of freedom for the 2nd test, respectively. to call statistically significant regulatory regions  and differential binding regions , we used bonferroni correction to adjust p-values and then used  <dig>  as the cutoff. only the windows rejected by the 1st test are further tested by the 2nd test. after the 2nd test calling significant regions that have at least one condition showing differential binding in at least one factor, we further want to evaluate which regions have differential binding in one and only one condition. to check if the differential binding event in window i occurs only in condition j, we applied a 3rd test, which is equivalent to the 2nd test but leaving out the data in the current condition j, for all j =  <dig> ... c. we obtained another statistics t-j based on the log likelihood ratios using data in only c- <dig> conditions.

  t-j= <dig> 

the t-ji statistic can be treated as the deviance obtained by the other conditions while leaving out j. since we already know that window i has differential binding signals, we can decide if the differential binding event only occurs in condition j by checking the significance of t-ji. in particular, we say that window i has differential binding only in condition j if t-ji is the only statistics, compared to the statistics for other conditions, with adjusted p-value >  <dig>  in window i .

data simulation
to evaluate the performance of our method, we applied dcap to a simulated dataset containing  <dig> data tracks including  <dig> conditions,  <dig> factors in each condition, and two replicates per factor. each data track consists of  <dig>  data points. since the variances of the log <dig> signals in the non-binding and binding regions in the human encode data set were about  <dig> and  <dig>  respectively, we used the same values in the simulation. for each data track, non-binding background signals were sampled independently from a normal distribution with mean  <dig> and variance  <dig>  we then randomly selected  <dig>  windows as binding regions in any of the five conditions, and we simulated the binding signals from a normal distribution with mean  <dig> and variance  <dig>  among the  <dig>  binding windows,  <dig>  were simulated as common bindings that appeared in all five cell lines and three factors. for the remaining  <dig> bindings, we randomly assigned an integer m  to each window and assigned binding signals to all three factors in m out of the  <dig> conditions. as a result, these  <dig> bindings can be treated as differential bindings. correlations among the three factors were also simulated to mimic those observed in the human encode data. in addition to the simulated data described above, we generated two more datasets in the same setting except that we changed the mean and variance of the binding signals to  and , respectively. accordingly, we call the three simulated datasets strong, medium and weak binding data, respectively. as negative binomial distribution was found to provide better fit to the count data in chip-seq experiments  <cit> , we conducted another simulation using data from negative binomials. details can be found in additional file  <dig> 

RESULTS
simulation study
using the simulated data described in methods, we first evaluated the performance of dcap test  <dig> for joint peak calling. we compared the results of dcap test  <dig> using  <dig> conditions together  with the union of the results obtained from each condition separately . figure 2a shows the receiver operating characteristics  curves generated by dcap-t1-all and dcap-t1-single for the three data sets at different levels of binding strengths . we found that the performance of dcap-t1-all is consistently better than dcap-t1-single at all levels of binding strengths, indicating the power gain of joint peak calling versus separate peak calling. particularly, the power of dcap-t1-all  is substantially better than the merged results from dcap-t1-single  for the weak binding data .

we next evaluated the performance of dcap test <dig>  for detecting differential binding of multiple factors in multiple conditions. we compared dcap-t2-all to multivariate analysis of variance  and the resulting roc curves are shown in figure 2b. again, we observed that dcap-t2-all is substantially more powerful than manova at all levels of binding strengths. we further compared the performance of dcap-t <dig> in a two-sample-one-factor scenario  with anova and dime  <cit> . the roc curves  again show that dcap-t2-pair performs consistently better than the other two methods at all levels of binding strengths, and the performance of dime is better than anova in the strong and weak binding data. in addition to using simulated multivariate normal data, we also compared the performance of dcap-t2-all with the above methods  along with dbchip using simulated negative binomial data. except for manova/dcap, the output statistics for other methods were obtained from each pairwise comparison on a single factor between all pairs of conditions. after combining the pairwise statistics using fisher's method, we used roc curve to compare their performance. detailed methods can be found in additional file  <dig>  our findings showed that while dcap-t2-all, dime, and dbchip outperformed manoava/anova at all levels of binding strengths, these three methods performed equally well at the strong and medium binding sites. for the weak binding sites, dcap-t2-all outperformed the others .

application to human encode data
by applying dcap to the encode data sets of three epigenetic factors  in five cell lines , we detected  <dig>   significant occupancy regions genome-wide  at bonferroni adjusted  <dig>  significance level. among those significant regions,  <dig>   showed differential signals of the  <dig> factors among the  <dig> cell lines. furthermore,  <dig>   of the differential regions were cell-type specific. after merging the contiguous regions, we obtained  <dig>  cell-type specific intervals. a majority of cell-type specific intervals have length 1-kb. yet, we found a set of signal-enriched regions with length longer than  <dig> kb . these long cell-type specific intervals were mostly due to the long span of pol <dig> signals, and they are consistent with the cell-type specific gene expression . examples of these regions include genes ashg, afp, gpc <dig> in hepg <dig> cell line, thbs <dig> in huvec cell line, bc <dig>  loc <dig> and a  <dig> kb region close to 7q <dig>   in k <dig> cell line. we also observed clusters of cell-type specific depleted signals in local intervals, which were mostly due to large genomic deletions.

to explore the binding patterns in each group of the cell-type specific regions, we centred the binding signals of the  <dig> factors by their means across all cell types. we then used these relative binding signals to perform k-means clustering to the cell-type specific windows to identify co-occupancy patterns of the  <dig> factors in the corresponding cell types. we varied the number of clusters k from  <dig> to  <dig> and chose the optimal k using the calinski-harabasz index, which evaluates the cluster validity based on the average between- and within-cluster sum of squares  <cit> . the clustering results showed that each of the five groups of cell-type specific windows mainly demonstrated two distinct patterns: one with enriched signals of all  <dig> factors in the corresponding cell, and the other with consistently depleted signals. to visually examine the epigenetic signals in each group of cell-type specific regions in each cluster, we generated heatmaps of relative binding signals across cell types, their corresponding copy number variations , and scatter plots, in figure  <dig> , respectively.

cell-type specific depletion in tumor cell lines is associated with cnvs
dna copy number variation is a common genetic alteration observed in solid tumors, and it contributes to tumor evolution by alterations of the expression of genes within the region  <cit> . as shown in figure  <dig> , compared to the normal cell lines, the cell-type specificity in the cancer cell lines  is strongly associated with copy number variations of various kinds   <cit> . there are many more cnvs in the cancer cell lines than in the two relatively normal cell lines. k <dig> has the most cnvs with a genome-wide coverage of  <dig> mb, and the cnv coverage of hela-s <dig> and hepg <dig> are around  <dig> mb and  <dig> mb, respectively. in contrast, the cnv coverage in the two normal cell lines are both < <dig> mb.

consistent with the genome-wide cnv distribution, 37% of the k562-specific binding windows co-occurred with the cnvs, which accounted for the most cnv overlap among the  <dig> groups of cell-type specific windows. among the  <dig> cell types, k <dig> also had the largest number of depleted binding windows  overlapping with homozygous deletions . as expected, homozygous deletions were only found in the cell-type specific non-binding regions, but not in the enriched regions. on the other hand, heterozygous deletions were found in both enriched and depleted cell-type specific regulatory regions. in hela-s <dig> and k <dig> cell lines, heterozygous deletions occurred 2- <dig> times more frequently in the depleted binding regions than in the enriched ones. conversely, there were  <dig> times more heterozygous deletions in hepg2-specific enriched binding regions than in the depleted ones.

cell-type specific enriched binding are enriched for cell-type specific functions
the functional categories detected using great version  <dig> . <dig>   <cit>  revealed that our cell-type specific intervals of enriched signals were significantly associated with genes carrying cell-type specific functions. we show the top  <dig> significant functional terms in gene ontology , disease ontology, mouse phenotypes, cancer neighbourhoods and pathway commons in figure  <dig>  we associated each cell-type specific binding window to its single nearest gene up to  <dig> mb and required that the significant terms satisfy both binomial and hypergeometric fdr <5% and region fold enrichment >= <dig>  the -log <dig> binomial fdrs were used to generate the heatmap of the function annotation terms, where black denotes no significant terms found by the above criteria. below we elaborate the enrichment analysis results for the cell-type specific binding regions in each of the five cell lines, which demonstrate strong evidence that dcap can pinpoint the genomic loci that play important roles in regulating cell-type specific functions and diseases.

gm <dig> : gm12878-specific enriched  binding windows were found to be near genes with go terms specially in immune response, regulation of immune system process, regulation of cell/lymphocyte/leukocyte/t-cell activation, defense response, cellular response to cytokine stimulus and cytokine mediated signaling pathway . in addition, the gm-enriched windows were also close to genes in mhc class ii receptor activity, sh <dig> domain binding . an enrichment analysis of disease ontology highlights many lymphoid diseases, such as lymphoid cancer, lymphoma, lymphoblastic leukemia and also other auto-immune diseases  . similar lymphoid/immune related terms were also reported in mouse phenotypes  and were highly related to the cell type of gm <dig>  from the msigdb cancer neighbourhood ontology, we found that the gm-enriched binding windows were in proximity to cancer-associated genes, cd <dig>  vav <dig>  inpp5d, stat <dig>  hla-c, etc . great also reported gm-enriched windows involved in t cell/b cell activation , and gm-enriched windows were close to genes involved in bcr, tcr, pd- <dig> signaling, intestinal immune network for iga production, costimulation by the cd <dig> family, antigen processing and presentation, etc . there were also other pathways specific to gm <dig>  for examples, cytokine signaling in immune system and interferon alpha/beta/gamma signaling pathway . an enrichment analysis of hgnc gene families showed that the gm-enriched windows were close to members of the hla and cd family. the interpro ontology also reported that genes with immunoglobulin/major histocompatibility conserved site, mhc class i/ii antigen recognition protein domain, and sh <dig> motif, were close to gm-enriched windows. the predicted promoter motifs ontology reveals that the motifs of spi <dig>  etv <dig>  elf <dig>  irf <dig> , runx <dig>  etv <dig>  stat <dig> , and nfkb, were found in the promoters of genes associated with gm-enriched windows. this result suggests that the above tfs could be potential co-regulators of genes near gm-enriched windows.

huvec : the enriched go terms for huvec-enriched binding windows were also relevant to its tissue type. targets of the huvec-specific enriched windows were found to be enriched in angiogenesis, blood vessel, vasculature development, blood vessel morphogenesis, and regulation of endothelial cell migration, etc . the disease ontologies enriched in genes near huvec-enriched windows highlighted many vascular-related diseases, including arteriopathy, arteriosclerosis, diabetic angiopathy, eye diseases  and heart diseases . the interpro ontology also reported genes with the epidermal growth factor-like type  <dig>  egf-like conserved site near huvec-enriched windows. enrichments from the pathway commons ontology highlighted beta <dig> integrin cell surface interactions, vegf specific signaling, and many others .

hela-s <dig> : the top enriched go terms for the helas3-enriched windows were associated with hela-s3's epithelial cell type, such as epithelium development, epithelial cell differentiation/development and skin development. other terms including smad protein signal transduction and canonical wnt receptor signaling pathway were also found to be enriched around the hela-enriched windows. besides, a few go terms and mouse phenotypes related to vessel development  were shared between hela-s <dig>  huvec, and hepg <dig> . since hela-s <dig> is derived from a human cervix adenocarcinoma, compared to gm <dig> and huvec, we found that many enriched disease phenotypes detected by great in this group were related to different types of cancer, including bone, prostatic, urinary tract, pancreatic cancer . among those, papillary epithelial carcinoma was found strongly associated to hela-s <dig> 

hepg <dig> : the hepg <dig> cell line is derived from a male with a well differentiated hepatocellular carcinoma. among the  <dig> cell types, we observed that hepg <dig> has the largest number of enriched binding windows  in the amplification cnvs. the enriched go terms of genes close to the hepg2-enriched windows were unique from the other cell types. top enriched go terms  showed enrichment in peptidase inhibitor/regulator activities, enzyme inhibitor activities, and endopeptidase inhibitor/regulator activities. the go terms in biological process show more detailed terms in regulation in the above activities and also including terms relevant to kidney development, such as mesonephric tubule morphogenesis. . most of the top disease terms detected in hepg2-enriched windows are all related to liver diseases, including hepatoblastoma, liver cirrhosis, hepatitis, fatty liver, hepatocellular carcinoma. great also reported that hepg2-enriched windows were close to many cancer genes hpx, hpn, lcat, tst, gstm <dig>  cepba, cyp2b <dig>  . unique pathways, such as foxa <dig> and foxa <dig> transcription factor networks, lipoprotein metabolism  were also reported by great . among these pathways, the foxa <dig>  foxa <dig> and foxa <dig> transcription factor networks were reported to be expressed early in embryonic endoderm and play important roles in the regulation of gene expression in liver and pancreas  <cit> . the msigdb predicted promoter motifs ontology showed that hepg2-enriched windows were close to genes whose promoters contain binding sites for tcf1/hnf <dig>  and foxa1/ hnf3α. the transcription factor targets ontology has compiled data from chip experiments that link transcription factor regulators to downstream target genes. great revealed that the hepg2-enriched windows were located near genes regulated by master regulators of hepatocyte and islet transcription, such as hnf1α and hnf4α in human liver and pancreatic islets   <cit> . furthermore, the strongest term in msigdb perturbation ontology showed enrichment in liver selective genes. particularly,  <dig> % of hepg2-enriched windows were within the neighbourhoods of liver genes. the hgnc gene families ontology also indicated that  <dig> hepg2-enriched windows were located near 13/ <dig> serpin gene families.

k <dig> : the targets of k562-specific binding windows were enriched in mouse phenotypes, such as microcytosis, decreased erythrocyte/hematopoietic cell number, anemia, abnormal homoglobin, abnormal iron hemostasis, etc . the msigdb cancer neighborhood highlighted cancer-associated genes, tal <dig>  ank <dig>  sptb, spta <dig>  prdx <dig>  map2k <dig>  etc. . the msigdb perturbation ontology also showed enrichment of the top  <dig> genes from cluster  <dig> of acute myeloid leukemia  expression profile in a previous study  <cit> .

application to mouse encode data
we further applied dcap test  <dig>  to detect differential tal <dig> occupancy before and after restoration of gata <dig> in two mouse erythroid cell lines  reported in wu et. al  <cit> . since tal <dig> and gata <dig> are critical erythroid transcription factors and often co-bind during erythroid differentiation, studying the differential binding of tal <dig> in these two cell lines allows us to understand the mechanisms of erythroid gene induction and repression by transcription factor occupancy.

among the  <dig>  and  <dig>  tal <dig> peaks called in g1e and g1e-er <dig> cell lines  <cit> , respectively, we obtained  <dig>  differential peaks  of tal <dig> as determined by the unique binding sites called in each of the two cell lines . in comparison, we ran dcap-t <dig> on the union of tal <dig> peaks from the two cell lines. at a fdr 10% threshold, dcap reported  <dig>  dps of tal <dig>  we then compared the results between dcap-t <dig> and the binary method.

by intersecting the dps from dcap and the binary calls, we assigned the dps into three categories:  dps only called by the binary method ;  dps only called by dcap ; and  dps called by both methods . the venn diagram of these dps is shown in figure 7a. there are many more dps called by the binary method  than by dcap . we observed that 85% of the dps by dcap agreed with the dps by binary intersection, and 40% of the dps by the binary method agreed with the dps by dcap.

to evaluate the tal <dig> dps in the three categories, we generated a scatter plot showing the binding signals of all tal <dig> occupancy  and a boxplot of their absolute binding differences  between the two cell lines, for each of the three groups of dps. figure 7b shows that most of the binary-only dps are distributed along the diagonal line and many of them tend to have lower binding signals in both cell lines compared to the other two dp groups. figure 7c further shows that the dps in the binary-only group have the least binding variation between g1e and g1e-er <dig>  in fact, most  of the binary-only dps had tal <dig> peaks identified in g1e but not in er <dig>  when considering the magnitude of binding signals instead of the binary peak calls, however, only 77% of the binary-only dps showed stronger tal <dig> signals in g1e than in er <dig>  this inconsistency is created by calling peaks in each cell line separately. in addition, around 70% of the binary-only dps are the weaker binding events with log <dig> signals < <dig>  therefore, these dps were not considered as differential occupancy by dcap after taking the signal magnitude into account.

in contrast to the binary-only dps, the cap-only dps showed significant signal variations. the cap-only dps were missed by the binary method because they were called as binding in both cell lines. in total, we detected  <dig> cap-only dps, which accounted for 16% of tal <dig> "common" binding in g1e and g1e-er <dig> by the binary method. in contrast to the 77% for binary-only dps, only 40% of the cap-only dps had stronger binding signals in g1e than in er <dig>  as a reference, among the common dps detected by both methods, 38% of common dps had stronger signals in g1e than in er <dig>  therefore, the percentage of cap-only dps is very close to percentage observed in the common dps. in addition, the binding variation of cap-only dps is much larger than that of the binary-only dps, and is similar to the binding variation of common dps .

we further intersected the dps in the three groups with relevant biological features to explore their functional importance, including features relevant to tal <dig> differential occupancy, such as gata <dig> binding in g1e-er <dig>  differentially expressed genes , snps, and features not relevant to tal <dig> differential occupancy, such as non-differentially expressed genes and cpg islands. we expect that the true tal <dig> dps should be highly overlapping with the features relevant to tal <dig> differential occupancy, but not so with the irrelevant features.

significance of difference in proportions between group a and b is denoted by * for each biological feature examined. ** denotes p-values between 5e- <dig> and 5e- <dig>  *** denotes p-values < 5e- <dig>  the p-values were obtained from the fisher's exact test. the differential expressed genes in g1e and g1e-er <dig> were obtained from the transcriptome data in g1e and g1e-er <dig> cells <dig>  <cit> . gata <dig> binding peaks were obtained from  <cit> . gata motifs <dig> were identified by meme relevant tools  <cit> . annotation data such as cpg islands <dig> and snps <dig>  were from database of ucsc genome browser  <cit> .

in summary, our results indicate that it is important to consider quantitative variation when studying differential regulation. the cap-only dps were not detected by the binary method because they were called as peaks in both cell lines, despite of the fact that they demonstrated significant signal variation that may have important indication of biological functions.

CONCLUSIONS
we have proposed a new powerful method called dcap that incorporates the quantitative information of multiple epigenetic features to detect both constitutive and variational protein-dna interaction events in multiple conditions. given that epigenetic features are highly correlated, the combinatorial effects of multiple proteins may only be detectable using a joint approach, i.e., the signal variation of one factor may only be observable by conditioning on the data of other factors. the variance of binding signals is frequently heterogeneous for different factors at different genomic positions. to gain power, we estimated the variances of noise as a function of the means within each pair of condition and factor using local smoothing techniques. we explicitly used replicates to estimate binding variances. if there are no replicates, we can utilize data across conditions to estimate the variances for each factor. we then designed a 3-step log likelihood ratio test to detect joint, differential, and condition-specific events in a multi-cellular context. the log likelihood ratios generated in each condition can also be used to quantify the contribution of each condition to the total variations. when binding regions are available, instead of running all  <dig> tests, one can directly apply dcap-test <dig> and dcap-test <dig> on the binding peaks to test the differential and condition-specific binding.

in an application to human encode data set, we detected cell-type specific regulatory regions that mainly demonstrated two patterns: all signals are either enriched or depleted. in general, this may depend on the factors being studied. the cell-type specific enriched regions were strongly associated with functional terms, pathways and diseases relevant to the corresponding cell types. in contrast, the cell-type specific depleted regions, particularly in cancer cell lines, were strongly associated with the cnvs. among those depleted regions overlapping with homozygous deletions, approximately  <dig> % were from the three cancer cell lines, and over  <dig> % were found in k <dig> alone. similarly,  <dig> % of the enriched regions with amplification cnvs were in the three cancer cell lines, with  <dig>  % in hepg <dig>   <dig> % in k <dig>  and  <dig> % in hela-s <dig>  our results suggest that the cell-type specific depleted signals in cancer cell lines may be under genomic alterations and can be located near genes associated with different types of cancer . other possible causes for the depletion of signals may include genetic mutations, alternative promoters, and epigenetic silencing through methylation that leads to aberrant silencing of normal tumor-suppressor function in cancer cell lines  <cit> . while we detected many cell-type specific regulatory regions showing consistent binding patterns near a target gene, we also observed some loci near a target gene showing complementary binding patterns. the latter may suggest binding turnover or alternative promoters that are recognized for creating transcript diversity in a cell. to explore the functional consequences of different binding patterns within a local region, future work could incorporate rna-seq data into consideration.

in a second application to tal <dig> occupancy in response to gata <dig> restoration in mouse erythroid cell lines, dcap detected a unique set of tal <dig> differential occupancy sites that were missed by the binary method by wu et al. . those sites were called in both g1e and g1e-er <dig> cells as occupant, yet their binding signals were significantly different. such quantitative variation is only detectable when considering the magnitude of binding rather than binary presence or absence calls. on the other hand, there were a large portion of "differential binding" called by the binary method alone, which were likely false positives given their small differences in the magnitude of binding between the two cell lines. by further overlapping the dps with biological features, we observed that the dcap-only dps were highly enriched near differentially expressed genes and gata <dig> binding sites, while the enrichments for the binary-only dps were much less significant.

chip-seq data is being rapidly generated not only for many tfs and epigenetic marks, but also in multiple conditions, tissues, cell types, and individuals. using dcap, both constitutive and variational regulatory regions can be powerfully detected by integrating information in a statistically consistent and efficient way. after finding significant loci of differential regulation and cell-type specificity, the users can intersect the loci with other biological data and functional annotations to derive hypotheses. clustering analysis of the patterns of signals followed by functional enrichment analysis can also help elucidating the dynamic epigenetic landscapes underlying regulation in multi-cellular contexts. besides clustering, one can use unsupervised methods like pca analysis to explore the binding pattern across conditions. pca loadings can be further used to identify leading factors that contribute most to the difference in the overall binding patterns. as the number of data tracks under comparison increase, directly apply unsupervised methods may not be a good way since they do not provide statistical significance, the increasing noises may confuse clustering results, and pca does not directly detect differential signals. our approach is flexible and general. the users can define their own sets of factors and conditions of interest and apply dcap in a similar way as used in this study. for example, tf binding variations can be detected among individuals by treating each individual as a "condition". association between epigenetic factors and disease phenotypes can be directly tested by treating groups of individuals with the same phenotype as "conditions" and individuals within groups as "replicates".

list of abbreviations
encode: encyclopedia of dna elements; chip-seq: chip-sequencing, chromatin immunoprecipitation followed by massively parallel dna sequencing; rna-seq: rna-sequencing; lrt: log likelihood ratio test; mle: maximum likelihood estimation.

competing interests
the authors declare that they have no competing interests.

authors' contributions
kc and yz conceived and designed the experiments. kc performed the analyses and wrote the manuscript. yz supervised the study and revised the manuscript. all authors read and approved the final manuscript.

declarations
the publication charges of this article were funded by nih grant r <dig> hg <dig> 

supplementary material
additional file 1
mle derivations of ûjiand û0i.

click here for file

 additional file 2
simulation using data from negative binomial distribution.

click here for file

 acknowledgements
kc and yz are supported in parts by nih r <dig> dk <dig> and nih r <dig> hg004718-04a <dig>  t we thank the duke/unc/ut-austin/ebi encode group and other laboratories involved in the encode project for making their data publicly available.

this article has been published as part of bmc genomics volume  <dig> supplement  <dig>  2014: thirteenth international conference on bioinformatics : computational biology. the full contents of the supplement are available online at http://www.biomedcentral.com/bmcgenomics/supplements/15/s <dig> 
