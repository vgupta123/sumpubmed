BACKGROUND
detection of differential gene expression at the cell type-specific level  aims to provide deeper insight into underlying biological causes of a given pathology. investigators studying disease mechanisms benefit from knowing which genes in which cell types are differentially expressed. yet, deconvolution is complicated by the prohibitive cost of extraction of pure cell type specimens, and non-linearity of amplified pure samples  <cit> . statistical methods of quantifying cell type-specific differential gene expression  are a viable alternative to deconvolve heterogeneous gene expression signal into the cell type-specific measures that can be compared for significant differences .

there are two rationales behind cde. one is that group-wise differential expression analysis on heterogeneous measures provides no information about which cell types are the source of any detected differences  <cit> . the other is that differential expression detection analysis applied only to heterogeneous tissue may miss the true cell type-specific expression differences. thus, cde analysis may uncover cell type-specific signal not seen at the heterogeneous level  <cit>  .

previous efforts primarily focused on quantifying cell proportions from heterogeneous tissue is by using a priori known cell signatures as predictors in a linear regression model . the other, less developed approach focuses on cell specific gene expression detection. it relies on linear regression to deconvolve heterogeneous gene expression measures using cell proportions as predictors. the coefficient estimates in this setup represent average cell type-specific expression levels, comparable if two groups are analyzed . both approaches require two pieces of information: 1) the heterogeneous gene expression measures, and 2) either the cell signatures , or cell proportions .

two algorithms addressing the second approach have been published   <cit> . the cssam approach uses heterogeneous observations as outcomes in a linear regression model, and the measured cell proportions as predictors. two regressions, one per study group , are performed and the difference between coefficient estimates represents the cell type-specific differential expression estimates. group label permutations are performed and false discovery rates  are estimated across the range of effect sizes per cell type. the cssam authors acknowledge that increasing sample variability will improve cell type-specific expression accuracy, and we quantified the effect of such variability.

dsection assumes that cell proportion measures are imprecise and that this imprecision must be accounted for. dsection uses a bayesian approach to “de-noise” cell proportion measures prior to linear regression deconvolution. the authors of dsection contrast their method to a “gold standard” of using linear regression when cell proportions are precisely known. the dsection authors correctly point out that, in real settings, no exact knowledge of cell proportions is known and that measurements are presumed to be estimates. they also acknowledge that the choice of prior information to use with their bayesian approach has a subjective component.

in this study, we investigated the sensitivity of linear regression to detect cell type-specific gene expression differences on per-gene basis. parameters affecting the variability of cell type-specific expression estimates , and the sensitivity of cell type-specific differential expression, include, 1) sample size per study group, 2) average spread of heterogeneous measures around a linear regression prediction fit , and 3) variability of cell type-specific proportions across samples. we tested the effect of each parameter in simulation settings, while controlling other parameters . for fixed values of sample size and cell proportion variability, any modification of mse or cell type-specific differential expression affected the sensitivity of lrcde. since mse and cell type-specific differential expression are gene-dependent, we conclude that any evaluation of sensitivity of cell type-specific differential expression detection must be assessed on per-gene basis, instead of a global significance threshold. we implement our approach in the lrcde r package that utilizes variability of the per-gene cell type-specific expression estimates, and is more sensitive in detecting true cell type-specific differentially expressed genes as compared with the global significance cutoff.fig.  <dig> differential expression detection sensitivity is primarily affected by two factors: cell type-specific expression estimate  variability and cell type-specific differential expression . a two-sample t-statistic is computed using the observed effect size . if the t-statistic does not exceed the t-critical value, which is based on the alpha significance threshold, then we cannot conclude that a significant difference has been observed between the two groups. given an observed difference which is determined to be significant, then we may reject the null hypothesis of no difference between controls and cases and calculate sensitivity for this observed difference, based upon the distance from the case group expression estimate to the t-critical value . bell curves represent distribution of cell type-specific expression estimates . the cell type-specific differential expression estimate  corresponds to the distance between vertical dashed lines for cases and controls 


fig.  <dig> parameters affecting sensitivity of cell type-specific differential expression detection. the effect of  per-group samples sizes ;  cell proportion sd ;  mse ;  log2-transformation vs. as-is data. unless specified otherwise, log2-transformed data was used, and the following parameters were held constant: per-group sample size -  <dig>  condition number -  <dig>  cell proportion sd -  <dig>  , mse -  <dig> 




methods
modeling heterogeneous gene expression measures using linear regression  given sample specific cell proportions 
we model heterogeneous gene expression measures across samples as cumulative contributions of cell type-specific gene expression measures weighted by the corresponding cell proportions of p cell types. a biologically meaningful constraint of this model is that cell proportions for any given sample should sum up to  <dig>  or 100 %  <cit> . as proposed, heterogeneous gene expression measures  are modeled using a linear regression approach:  <dig> ymn=∑k=1pβknxkm+εmn where β
kn is the average theoretical cell type-specific gene expression for the k
th of p total cell types, x
km is the cell proportion , and ε
mn is a normally distributed random error defined as the difference between the observed values y
mn and values predicted by the linear regression ŷ
mn, . this allows obtaining linear regression coefficient estimates β^kn, interpreted as cell type-specific gene expression estimates. intuitively, eq.  <dig> describes a linear relationship between heterogeneous gene expression level y
mn and contribution of cell type-specific gene expression estimates β^kn weighted by the corresponding cell proportions x
km. the model in eq.  <dig> contains no intercept term since we assume zero heterogeneous expression  in the absence of individual cell contributions. thus, for each gene we have a total of p cell type-specific gene expression estimates  in the model. model in eq.  <dig> is more compactly represented in matrix form, for a single gene j:  <dig> yj=xβj+ε the matrix form eq.  <dig> suggests the form in which β
j is estimated:  <dig> β^j=x'x−1x'yj fitted regression estimates are then given by:  <dig> y^j=xβ^j which are required in order to calculate residual values needed to estimate the variance of β^j.

obtaining cell type-specific gene expression estimates carries a quantifiable level of uncertainty. this uncertainty can be expressed as a function of sample size, number of cell types, the size of the residuals, and the variability of cell type proportions. the formula for the theoretical variance of the linear regression coefficient for simple linear regression  provides an intuitive illustration of how various parameters affect the variance:  <dig> varβ^1=σ2∑i=1mxi−x¯ <dig> in practice, the estimated variance of β^ <dig> in eq.  <dig> uses the mean squared error  as an estimate of σ
 <dig>  represented as s
2:  <dig> s2=mse=∑i=1myi−y^i2m−p in this simple linear regression context of eq.  <dig> and eq.  <dig>  m is the sample size and p is typically equal to  <dig>  since there are two parameters being estimated: an intercept term β^ <dig> and the coefficient of the predictor variable: β^ <dig>  thus, the estimated variance of β^ <dig> in simple linear regression is represented as:  <dig> varβ^1^=∑i=1myi−y^i2/m−p∑i=1mxi−x¯ <dig> where y
i − ŷ
i is the residual for sample i, and xi−x¯ is the difference between the predictor for sample i and the mean of x across all m samples. in this way, predictor variability is captured in the denominator of eq.  <dig>  as is sample size m. residual variability is captured in the numerator of eq.  <dig>  each component of eq.  <dig> affects the estimated variance of β^ <dig> .

in multivariate linear regression, matrix notation simplifies representation of the variances of all p regression coefficients. the theoretical variance-covariance matrix Σ of linear regression coefficients is represented as:  <dig> ∑=σ2x'x− <dig> where the variances of the k
th individual β^k regression coefficients are found on the diagonal of Σ. in eq.  <dig> it is less intuitive to see the way in which individual parameters affect the variances of the individual β^k in matrix form, yet the principles are the same as in eq.  <dig>  predictor variability is captured in the inverse of the design matrix: −  <dig>  analogous to the denominator of eq.  <dig> 

as with simple single variable regression, σ
 <dig> is estimated by mse, represented by s
 <dig> providing the estimated covariance matrix:  <dig> ∑^=s2x'x− <dig> where s
 <dig> is:  <dig> s2=y−xβ^'y−xβ^m−p=y'y−β^'x'ym−p=y'y−y'xx'x−1x'ym−p the primary focus of this paper is to evaluate the effects of sample size, residual variability, and mse on the estimated variances ∑^ of the cell type-specific expression estimates β^k and the effect this has upon differential expression detection sensitivity.

.

linear regression-based estimation of differential expression at the cell type-specific level
differential expression analysis implies comparison of two or more groups for detectable gene expression differences. for simplicity, we consider two-group design, such as a case–control study.

to obtain group specific cell type-specific gene expression estimates β^kn, we apply linear regression separately to each group of heterogeneous gene expression measures . the linear regression coefficient estimates are taken as surrogates for estimated cell type-specific average gene expressions. a difference between these cell type-specific estimates represents the level of gene expression change between the two groups in a given cell type:  <dig> δ^kn=β^kncases−β^kncontrols where δ^kn is estimated effect size, k is the specific cell type and n is the genomic site.

measuring the cell type-specific gene expression differences between groups using linear regression  requires accurate cell type-specific gene expression estimates. any factors affecting the variability of cell type-specific gene expression estimates per group will affect the sensitivity to detect cell type-specific differences between groups  .

testing for significant differential expression using two-sample t-test
we used welch’s two-sample t-test to determine if the observed effect size  is significant . a per-gene t-statistic is compared against the 1-α critical t-value . a t-statistic exceeding the t-critical value is determined to be evidence to reject the null hypothesis of no difference between groups. if a significant difference is determined, sensitivity is then calculated as the upper tail probability beyond the critical t-value. if no significant difference is determined, then sensitivity is the alpha level threshold . lrcde sensitivity is based upon calculated t-statistic.

simulation of cell type-specific expressions with known differential expression
simulated data was used to assess performance of lrcde under controlled conditions in which the cell type-specific differential expression was known. to establish a “gold-standard” of known cell type-specific differential expressions to benchmark lrcde estimates of cell type-specific differential expressions, synthetic data with controlled changes  <cit>  was constructed in three steps.

first, we created synthetic p cell proportions with known standard deviation across m samples per group for the target cell type p. for the sake of comparable per-group regressions, we simulate the condition where both groups have identical cell proportions . second, we created synthetic matrixes of cell type-specific gene expression estimates for both control and case groups. we applied a uniform range of effect sizes  to half of the “genes” in the target cell type p of the case group . finally, the cross-product of both synthetic cell type expression and synthetic cell proportion matrices was taken for each group to produce simulated matrices of heterogeneous “fitted values” analogous to the predicted values obtained from linear regression. normally distributed “noise” was added to the “fitted values” to simulate residual values obtained from a linear regression . having these a priori known cell type-specific expressions and differential expressions provided us with a benchmark against which to compare the results of lrcde analysis.

synthetic data is assembled by joining the two heterogeneous gene expression matrices  into one 2 m by j heterogeneous gene expression matrix with a vector of group labels. the two cell proportion matrices, identical for groups of “cases” and “controls” were joined to obtain one 2 m by p cell proportion matrix.

assessing lrcde sensitivity from simulated data
simulations over the parameter space were compared using sensitivity based upon simulated  cell type-specific differential expression. to quantify sensitivity, the total number of detected differentially expressed genes was divided by the total number of a priori known differentially expressed genes. the sensitivity from simulation using various levels of parameters was compared in order to illustrate the effects of sample size, mse, and cell proportion variability.

parameters affecting cell type-specific expression estimate variance
parameters that directly impact the variability around cell type-specific expression estimates  include sample size, mse, and cell type-specific proportion variability across sample . for simulations, all but one parameter is held constant. a single simulation is performed for each of a series of discrete values of the parameter of interest. sensitivity is assessed at each level of the parameter of interest and sensitivity curves are plotted against significance level thresholds for each simulation.

assessing the effect of high condition number of cell proportion matrix
a source of variability of cell type specific expression estimates is the “conditioning” or invertibility of the dot-product of the cell proportions predictor matrix. multivariate linear regression relies upon the dot-product of the predictor matrix, which must be invertible:  <dig> dotproduct=x'x where x is the m by p matrix of cell proportion predictors and x’ is the x matrix transpose. the inverted matrix is denoted:  <dig> invertedxmatrix=x'x− <dig> a non-invertible matrix is referred to as “singular”. a least squares linear regression solution cannot be obtained when the predictor matrix is singular and thus non-invertible. the condition number  of a matrix x ' x is the ratio of the absolute values of the largest to smallest eigenvalues:  <dig> cd=maxeigenx'xmineigenx'x and x ' x can be factored as:  <dig> x'x=aΛa' where Λ is a diagonal matrix with eigenvalues of x ' x on the diagonal. thus, a singular matrix, which has at least one zero eigenvalue, has an undefined condition number. in the case of cell type-specific differential expression detection, the linear regression predictor matrix is the matrix of cell proportions. it is near-singular squared cell proportion predictor matrices which result in unreliable cell expression estimates, and thus unreliable differential expression estimates  <cit> . thus, a near-singular cell proportions predictor matrix is a source of cell expression estimate variability  <cit> . the instability of cell type-specific expression and subsequent differential expression estimates cannot be observed from a single linear regression based upon a single cell proportions predictor matrix. the instability becomes apparent when observing estimates based upon different cell proportions predictor matrices, each with identical standard deviations across samples of the target cell type and identical condition numbers of the squared predictor matrix. it is the exact values comprising the matrices, which vary slightly between matrices  resulting in increasingly greater fluctuations of cell type-specific expression estimates with increasing condition numbers. we aimed at investigating the effect of the condition number for cell proportion on the sensitivity of lrcde analysis.

cell proportions were simulated with the target cell standard deviation of  <dig>  over samples and a condition number of  <dig> with  <dig> total cell types. group samples sizes were fixed at  <dig>  mse was fixed at  <dig> . effect size was fixed at  <dig> . allowing the random seed generator to float, this same set of parameters was simulated over  <dig> iterations. note that the random seed set prior to the initial iteration in order to allow for replicable results. thus, a cell proportions predictor matrix with identical target cell standard deviation and condition number of approximately  <dig> was re-created once for each of the  <dig> iterations. letting the random seed float between iterations allowed small perturbations of the cell proportions across all iterations. each calculated sensitivity observation was collected into a vector and stored for plotting.

condition numbers of  <dig>   <dig>   <dig>   <dig>   <dig>   <dig>   <dig>   <dig>  and  <dig> were simulated and sensitivity was recorded using the same 100-iteration method. the resulting vectors of sensitivity observations for each of the  <dig> iterations at distinct condition numbers were plotted in adjacent boxplots and variability of sensitivity at each level of condition number was visually compared.

dropping cell proportion predictors to address high condition number
as the inherent biological restriction of cell proportions to sum up to  <dig> leads to high multicollinearity and, consequently, high condition number, reducing multicollinearity may improve the sensitivity of linear regression. we tested the effect of dropping at least one cell proportion predictor with the lowest mean cell in order to reduce multicollinearity. using target cell proportion standard deviation of  <dig> , we tested a model with  <dig> cell proportions which sum identically to  <dig> across each sample. these properties of the cell proportion matrix are identical to the model in  <cit> , and result in a condition number of ~ <dig> 

using simulated conditions, we dropped cell proportions of cell types without introduced differential expression. as dropping a cell type will ultimately affect biological interpretation, we dropped cell types with the lowest mean cell proportions. intuitively, this may be considered as ignoring potential “noise” in cell proportion measurements.

comparing sensitivity of cell type-specific differential expression detection using lrcde vs. false discovery rate-based methods
false discovery rates  calculations implemented in the cssam method  <cit>  rely upon repeated permutation of group membership labels and subsequent repeats of the linear regression cell type-specific differential expression step. a series of  <dig> cut points is constructed between zero and the greatest cell type-specific differential expression effect size. differences associated with all genes in a given cell type are then compared against each successive cut point, and the total number of gene differences larger than the cut point is the number of “calls”. the average number of permutation differences across all genes is also compared to this sequence of cut points. for each cut point in each cell type, a potential fdr is calculated by dividing the average number of permutation differences greater than the cut point by the number of calls at the cut point. fdrs are subsequently assigned per gene per cell type by comparing differential expression estimates against cut points and assigning the fdr associated with the greatest cut point smaller than the estimated expression difference.

we contrasted the cell type-specific fdrs with t-statistics p-values calculated by the lrcde approach, which performs analysis on a cell type by cell type gene-by-gene basis. significance thresholds of  <dig>  to  <dig>  for fdr and  <dig>  to  <dig>   for t-statistic p-value were used to compare true positive rates  for both methods tested on the same simulated data over a range differential expression from  <dig>  to  <dig> . tprs versus threshold values were then compared graphically for both fdr and t-statistic calculated p-values.

functional enrichment analysis
lists of cell type-specific differentially expressed gene names were analyzed using toppfun module of the toppgene suite  <cit>  using default settings.

software used for analysis
rstudio  <cit>  v. <dig> . <dig>  r packages: geoquery  <cit>  v. <dig> . <dig>  proc  <cit>  v. <dig> , cellmix  <cit>   <dig> . <dig>  cssam  <cit>  version  <dig> . <dig>  computer specifications used: hardware: intel i7-6700 k 4-core  <dig>  ghz,  <dig> gb ram. operating system: ubuntu v. <dig> , linux kernel v. <dig> .0-35-generic.

RESULTS
parameters affecting sensitivity of linear regression for cell type-specific differential expression detection
sensitivity  of linear regression cell type-specific differential expression  detection is affected in two ways. either, 1) the size of the true differential expression between study groups is changed , or 2) the variability of cell type-specific expression estimates is changed in one or both study groups.

variability around cell type-specific expression estimates is affected by three main parameters: sample sizes, residuals sizes , and cell type-specific proportion variability across samples. the latter is also dependent on the total number of cell types, five in our study. we found that small changes around this total number of cell types included as predictors had a negligible effect on lrcde sensitivity . yet, increasing the number of cell types increases the number of predictors in the linear model, making it less parsimonious with respect to the sample size. furthermore, larger number of cell types decreases cell type-specific proportion variability, and should be avoided. in summary, the variability of cell type-specific expression estimates relative to the size of actual cell type-specific differential expression  drives the sensitivity of differential expression detection .

increased group sample sizes increases sensitivity of lrcde
increasing the number of samples in one or both study groups resulted in overall increased sensitivity of differential expression detection, as quantified by tpr curves. as before, other parameters were held fixed. increasing sample size increases lrcde sensitivity by reducing variability around cell type-specific expression estimates. since sample size m is in the denominator of the mse , this result is not surprising. figure 2a depicts typical increases in tpr observed as sample sizes are increased .

increased cell proportion variability across samples increased lrcde sensitivity
each cell type used as a predictor in lrcde always exhibits some degree of variability in its relative proportions across samples. variability of the proportions of any particular cell type can be quantified by standard deviation. smaller standard deviation indicates lower variability across samples and conversely larger standard deviation indicates higher variability. in the biologically improbable case of all proportions of a given cell being identical across all samples, then there would be zero variability making linear regression unfeasible.

cell type-specific differential expression detection sensitivity increases with increased variability of cell type-specific proportions across samples. we simulated cell proportions and tested lrcde detection sensitivity for several levels of cell proportion variability  while holding other parameters fixed . as cell proportion variability across samples is increased, sensitivity of cell type-specific differential expression detection for all genes in that particular cell type improved.

reducing mean squared error  increases sensitivity of lrcde
residuals are the differences between actual heterogeneous expression measures  and those same measures as predicted by a regression line . each gene will have a unique set of residuals from linear regression. sums of squared residuals divided by degrees of freedom  is mean squared error . overall size of residuals as quantified by mse is one measure of “goodness of fit”, i.e., how well the observed data is predicted by the regression. when other parameters are held fixed  and mse is decreased , the result is increased differential expression detection sensitivity .

increase in sensitivity is due to the fact that cell type-specific expression estimate variances are decreased proportionately as mse is decreased . we confirmed this relationship between mse and variability around cell type-specific expression estimates by simulations . as variability around group-wise cell type-specific expression estimates cover less of a significantly detected difference between these estimates, the sensitivity of differential expression detection increases.

changes in cell proportion variability for cell type p affect the variance  of cell type-specific expression estimates. since cell proportion variability is captured in the inverse of the design matrix , any increase in cell proportion variability results in a decrease in cell type-specific expression estimate variability. this decrease in cell type-specific expression estimate variability improves sensitivity of lrcde.

high condition number of cell proportions predictor matrix results in inconsistent sensitivity
comparing sensitivity over  <dig> iterations for each of cell proportions dot product condition numbers of  <dig>   <dig>   <dig>   <dig>   <dig>   <dig>   <dig>   <dig>  and  <dig> resulted in fluctuations of t-statistic based sensitivity plotted in fig.  <dig>  with a condition number of  <dig>  sensitivity remains within a consistent range of values between  <dig>  and  <dig> . when condition number reaches  <dig>  we noticed fluctuations of sensitivity from a high of  <dig>  to a low of  <dig> . at condition number of  <dig>  the range from maximum sensitivity to minimum had broadened with maximum of  <dig>  to minimum of  <dig> . when condition number is  <dig> maximum sensitivity remains at  <dig>  while minimum is  <dig> . this loss of consistency of sensitivity with increasing condition number illustrates the instability of an “ill-conditioned” cell proportion matrix.fig.  <dig> large condition number of the cell proportion matrix negatively affects stability of sensitivity. cell proportion matrixes were simulated to obtain condition numbers  <dig>   <dig>   <dig>   <dig>   <dig>   <dig>   <dig>   <dig>  and  <dig>  each condition number was simulated  <dig> times by small perturbations of the cell proportion values. the following parameters were held constant: sd for the target cell proportion –  <dig> , per-group sample size –  <dig>  mse –  <dig> , cell type-specific effect size –  <dig> 




dropping cell proportions with the lowest mean reduces multicollinearity and improves sensitivity
dropping a single cell type with the lowest proportion mean while retaining ~98 % of total proportions across all samples resulted in reduction of condition number  from ~ <dig> down to ~ <dig>  this resulted in noticeable improvement in sensitivity of t-statistic p-values . however, dropping  <dig> cells while retaining ~94 % of total proportions produced cd of ~ <dig>  and, consequently, further improved sensitivity of both fdr and t-statistic p-values . although dropping cell types with the lowest proportion mean appears a viable statistical method to improve sensitivity of linear regression-based cell type-specific differential expression analysis, it warrants further investigation of how biological interpretation of the cell proportion estimates is altered.fig.  <dig> dropping cell proportions reduces condition number and improves sensitivity. effect of dropping   <dig> cell type;   <dig> cell proportions with the lowest proportion mean. the following parameters were used: log2-transformed data, per-group sample size –  <dig>  mse –  <dig> , cell type-specific effect ranged from  <dig>  to  <dig>  over  <dig> genes out of  <dig> simulated genes, sd of the cell type with introduced changes –  <dig> , condition number  – 75000




summary of the parameters affecting sensitivity of cell type-specific differential expression
the principal metric driving the sensitivity of lrcde is the relationship between cell type-specific expression estimate variance and estimated group-wise differential expression. the only way to increase sensitivity of linear regression differential expression detection is to either 1) reduce variances around cell type-specific expression estimates or 2) increase size of cell type-specific differential expression . while the latter is an experimentally given parameter, the former is affected by several parameters: sample size, sizes of residuals per linear regression as quantified by mean squared error , or cell type proportion  variability across samples. these three parameters are the components of variance eq.  <dig> 

lrcde accounts for cell type-specific variability of differential gene expression estimate, missed by fdr-based analysis
figure  <dig> shows the difference in sensitivity between the fdr-based approach vs. the t-statistic p-value approach. using simulated data, we tested cell type-specific differential expression detection over a range of known effect sizes ranging from  <dig>  to  <dig>  spread over the  <dig> changed genes in the target cell. at lower sample sizes, fdr fails to detect any of the known differences below a  <dig>  threshold. with sample size of  <dig> per group , at all but the  <dig>  effect size, the t-statistic p-value indicates significant changes with sensitivity greater than  <dig>  at an alpha significance threshold of  <dig>  . at  <dig> samples per group, fdr sensitivity increases from  <dig> up to  <dig>  at a  <dig>  threshold. under the same conditions, t-statistic p-value has maximum sensitivity of  <dig> , indicating the per-gene significance testing using two-sample t-test improves sensitivity of cell type-specific differential expression detection.

all panels in fig.  <dig> are representative of the increased sensitivity of the per-gene t-statistics p-values vs. fdr. in all cases, the t-statistic p-value is more sensitive than fdr to differential expression, particularly in smaller sample sizes. our results demonstrate that fdr is insensitive to gene-specific variability of cell type-specific expression estimates, leading to higher overall fdrs and thus decreased sensitivity. in contrast, the t-statistic incorporates the variability captured in eq.  <dig> on a cell-by-cell and gene-by-gene basis.

ignoring significance thresholds for fdr and t-statistic p-values gives the illusion of perfect discrimination or a 100 % true positive rate and 0 % false positive rate  when analyzing simulated data . in simulated data, we created the situation in which normally distributed residuals are mean centered around zero. since linear regression coefficient estimates are unbiased estimates, both regression-based methods will precisely target the known differential expression values, regardless of coefficient variability. for this reason, any known differential expression will always have a lower fdr and a lower t-statistic p-value than genes with no differential expression. thus, in order to truly measure the merits of either method, any measure of differential expression detection performance must be viewed in light of significance thresholds for both fdr and t-statistic p-value.

biological significance of cell type-specific differentially expressed genes
we compared the performance of per-gene lrcde analysis with the global fdr threshold-based analysis  by analyzing the human whole-blood gene expression measures from  <dig> kidney transplant patients used by the authors of cssam  <cit> . we used liberal fdr <  <dig>  threshold for the cssam method, and the bonferroni-corrected α =  <dig>  level for the p-value cutoff in the lrcde method .table  <dig> the number of cell type-specific differentially expressed probes  identified in kidney transplant gene expression data from  <cit> 

mean/sd – overall mean and standard deviation of a cell type-specific proportion




we identified  <dig>  upregulated genes in monocytes at an fdr  <dig> , and zero upregulated genes in the other four cell types. using fdr < <dig> ,  <dig>  monocyte-specific genes were detected. in contrast, lrcde analysis was able to identify significant differentially expressed genes in all five cell types .fig.  <dig> venn diagram of overlaps among cell type-specific differentially expressed unique gene names in the kidney transplant data set




notably, genes detected as differentially expressed in neutrophils were enriched in two functional categories: ion channel activity/membrane and extracellular matrix/adhesion . genes detected in lymphocytes and monocytes were enriched in rna binding/transcription factor activity. despite being measured in blood, these genes were also enriched in genes involved in kidney regenerative processes .

despite many genes were identified as differentially expressed in eosinophils and basophils, they were marginally enriched in processes without obvious biological scheme. this may be attributed to the fact that both cell types had very low mean and sd, making detection of cell type-specific differentially expressed genes less reliable. it remains to be further investigated how the mean/sd of the cell types affect biological outcome of cell type-specific deconvolution.

discussion
this paper addresses several key issues of cell type-specific differential expression detection methods based on linear regression . one is the fact that there is a level of uncertainty attached to any detected differential expression at the cell type-specific level, which will change depending upon values of several parameters. furthermore, this level of uncertainty is different for each gene, and should be accounted for on a per-cell type per-gene basis. the other is the severe multicolinearity of predictors quantified in the condition number of the cell proportions matrix .

one of the primary goals of our work has been to quantify the parameter space affecting the sensitivity of lrcde. one source of variability, the cell proportion measures used as predictor values, affects detection sensitivity within that particular cell type for all genes in the heterogeneous data set. the other source of variability, the mean squared error  for a given regression, affects the sensitivity for each gene individually.

characteristics of the cell proportion measures across samples also affect lrcde detection sensitivity for each gene in the data set. there are two measures of interest. one is the degree of variability for any single cell type across samples. greater variability of proportion measures across samples will result in higher differential expression detection sensitivity for that specific cell type. thus, sensitivity will vary from cell type to cell type. this need for variability across samples is acknowledged by the authors of cssam  <cit> : “…accurate estimates of rare cell types may be aided by sample enrichment or inclusion of highly variable samples”. in this work we have demonstrated the effect of cell type-specific proportion variability upon sensitivity of cell type-specific differential expression detection.

the other measure attached to the cell proportion matrix is a condition number. the condition number of the cell proportion matrix is a global measure of multi-collinearity across all samples and all cell types. it is a function of the ratio of the maximum and minimum eigenvalues of the design matrix. lower values of the condition number closer to  <dig>  indicate lower multicollinearity resulting in stable cell type-specific expression estimates . as the condition number and the variability around cell type-specific estimates are increased, variability of sensitivity also increased. when the condition number associated with the cell proportion predictor matrix is in the tens of thousands then the confidence intervals on the observed sensitivity will increase to the point that conclusive differential expression detection is questionable . conditioning of the predictor’s design matrix is therefore a non-trivial source of instability of cell type-specific expression estimates  and should not be dismissed. caution is urged when evaluating results of any analysis of linear regression cell type-specific differential expression detection when the cell proportions predictor matrix has a “high condition number” . such “ill-conditioned” cell proportions produce cell type-specific expression estimates which may be unreliable  <cit> , resulting in untrustworthy differential expression estimates. future use of linear regression techniques for estimation of biological values should take into consideration the condition number of the cell proportion matrix as a source of estimate variability.

our preliminary investigations of a high multicollinearity and condition number problem suggest that the solution may be simply to drop at least one cell type with the lowest proportion mean. our results show decreasing condition number and increasing sensitivity of the linear regression-based cell type-specific differential expression analysis. yet, we have not investigated the biological implications of dropping cell types on cell type-specific expression estimates. we expect that the heterogeneous signal previously allocated to the dropped cell types will then be distributed across the remaining cell type-specific expression estimates. furthermore, we have only tested the effects of dropping cell types under simulated conditions, when only one cell type contains a priori known differentially expressed genes, which is an exception in real biological data. we aim at further investigating the effect of dropping cell types as a means of effectively handling the multicollinearity and large condition number issues without harming biological relevance or cell type-specific differential expression detection.

the practice of log <dig> transformation of heterogeneous microarray gene measures prior to linear regression deconvolution has been criticized on the basis that log <dig> transformation of the outcome variable breaks the linear relationship between outcomes and predictors . it has been shown that without applying some back-transformation after performing lrcde to log <dig> transformed heterogeneous observations, the cell type-specific expressions will be underestimated  <cit> . furthermore, linear regression coefficient estimates may be difficult to interpret in the absence of a linear relationship between the outcome heterogeneous observations and the cell proportion predictors. we tested the effect of log <dig> transformation on the sensitivity of both fdr-based and lrcde analyses, but did not identify any measurable sensitivity increase in either method . we aim to further investigate the effect of log <dig> transformation post hoc linear regression by quantifying normality of the residuals and other diagnostic parameters of linear modeling.

the primary drawback of the lrcde sensitivity calculation is that is relies upon a single linear regression step per group to compute t-statistic based on the standard error estimates of the cell type-specific expressions. this approach carries the implicit assumption of a known distribution of linear regression coefficient estimates. other algorithms rely upon multiple iterations of the linear regression step in which permutations of group membership labels provides an estimated “null distribution” against which to compare initial estimates. the advantage of these permutation methods is that they do not rely upon assumptions as to the distribution of coefficient estimates. a way to overcome this limitation may be to include facility for a permutation method in which two-sample t-statistics may then be based upon a similar comparison of initial observation versus permuted null observations.

we demonstrated the greater sensitivity to detection of known cell type-specific differential expression using a per-gene two-sample t-test approach to differential expression detection. we have drawn attention to parameters affecting gene-specific variability of cell type-specific expression estimates and thus the sensitivity of cell type-specific differential expression detection. our approach is implemented in an r package, lrcde, available on github , which performs cell type-specific differential expression analysis on a cell type-by-cell type, and gene-by-gene basis. lrcde estimates cell type-specific differential expression, calculates two-sample t-statistic, t-statistic p-value, and, given a significantly detected difference, outputs sensitivity based upon t-statistic .

CONCLUSIONS
linear regression-based cell type-specific differential expression  is more sensitive to detect significant cell type specific differential expression than fdr approach. the gene-specific lrcde sensitivity is a function of sample size, cell type-specific proportion variability, and mean squared error of linear regression for that gene. larger sample sizes, lower mse for a linear regression for a given gene, and greater cell type specific proportion variability are needed to achieve greater sensitivity in detecting smaller significant cell type-specific differential expression . the greater the cell proportion variability across samples results in the greater the sensitivity of lrcde. the magnitude of cell type-specific expression estimate variability relative to size of actual cell type-specific differential expression  drives the sensitivity of differential expression detection. finally, when the cell proportion matrix has a condition number greater than  <dig>  then results of lrcde may be unreliable given the instability introduced by the “ill-conditioned” cell proportions. preliminary investigation suggests that dropping cell types with low proportion mean increases the sensitivity of linear regression-based cell type-specific differential expression, and should be further investigated.

additional files

additional file 1: supplementary methods and notes. 


additional file 2: table s <dig>  an example of lrcde and cssam analysis results of simulated data with  <dig> samples per group. target condition number  –  <dig>  target mean squared error –  <dig> , target cell proportion sd –  <dig> . range of the effect sizes introduced in the first  <dig> genes –  <dig>  to  <dig> . “site” – probe id; “gene” – gene label; “base” – estimated non-negative control group cell type-specific expression level; “case” - estimated non-negative case group cell type-specific expression level; “diff.est” – estimated cell type-specific differential expression between case and base; “mse.control” – observed mean squared error of the control group regression; “mse.case” – observed mean squared error of the case group regression; “cell” – cell type name; “cell.sd” – cell type-specific standard deviation of cell proportions across samples; “kappa.1/2” – observed condition number of squared cell proportions matrix for the case/control group, respectively; “t.crit” – critical t-value against which observed t-statistic is compared; “t.stat” – observed t-statistic; “p.val.t” – unadjusted p-value for t-statistic; “se1/2”– standard error of the control/case group cell type-specific expression  estimate, respectively; “se.p” – welch’s combined standard error calculated for t-statistic; “t.power” – observed power calculated from t-statistic and critical t-value; “fdr” – false discovery rate as reported by cssam. 


additional file 3: table s <dig>  an example of lrcde and cssam analysis results of simulated data with target cell proportion standard deviation of  <dig> . sample size –  <dig>  target condition number  –  <dig>  target mean squared error –  <dig> . range of the effect sizes introduced in the first  <dig> genes –  <dig>  to  <dig> . column names legend as in additional file  <dig>  


additional file 4: table s <dig>  an example of lrcde and cssam analysis results of simulated data with target mse of  <dig>  per regression. sample size –  <dig>  target condition number  –  <dig>  target mean squared error –  <dig> , target cell proportion sd –  <dig> . range of the effect sizes introduced in the first  <dig> genes –  <dig>  to  <dig> . column names legend as in additional file  <dig>  


additional file 5: table  <dig>  lrcde and cssam analysis results of the kidney transplant dataset. column names legend as in additional file  <dig>  


additional file 6: table s <dig>  functional enrichment analysis of lrcde significant differentially expressed genes in kidney transplant dataset. “category” – general functional category; “id” - unique identifier of the functional category; “name” – category name; “source” – database reference; “p-value” - non-adjusted p-value; “q-value fdr b&h” – fdr-adjusted p-value; “hit count in query list/genome” – number of differential genes/genes in the whole genome annotated with a functional category, respectively; “hit in query list” – names of differentially expressed genes annotated with a functional category. 




abbreviation
cdecell type-specific differential expression

cssamcell-specific significance analysis of microarrays

fcfold change

fdrfalse discovery rate

fprfalse positive rate

geogene expression omnibus

lrcdelinear regression cell type-specific differential expression

msemean squared error

rocreceiver operator characteristic 

sdstandard deviation

tprtrue positive rate

