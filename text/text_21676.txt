BACKGROUND
phylogeny in a context of lgt
the tree of life has long been a central metaphor of evolutionary theory, and is a useful framework upon which to build a natural classification. however, understanding the phylogeny of species from gene trees is a very challenging task, both technically and conceptually.

first, not all genes are useful phylogenetic markers. paralogs resulting from gene duplications occurring prior to the divergence of the organismal lineages being studied can easily confuse an analysis, as would happen, for instance, when unknowingly constructing a tree for mammals based on hemoglobin sequences from some species and myoglobins from others. for different reasons , orthologs themselves must be scrutinized carefully. notably, the phylogenetic signal in genes can be reduced by their limited size, radiative  evolution they may have undergone or the phenomenon of mutational saturation. much of the time, the quality of phylogenetic signal is too low to resolve all of the problems under consideration in a single analysis. multiple gene trees are often then exploited because interestingly, in each gene tree, some nodes may in fact receive significant support. increasing the number of markers might then resolve the full tree, piecemeal. however, before accepting these individual relationships as solid, the phylogenetic quality and congruence between markers must also be tested.

artifacts of tree reconstruction or the use of an inappropriate evolutionary model can lead to robust but artifactual groupings in gene trees. recombination events producing mosaic genes can also blur phylogenetic trees and may produce controversial groupings. as a consequence, software has been developed to test that the signal carried by a single gene is not self-contradictory  <cit> . but even non-mosaic orthologs for different genes can be in conflict, when one of them has been laterally transferred.

this last source of conflicting signal is a major concern. all living systems from viruses  <cit>  to eukaryotes  <cit>  can participate in the transfer of genetic material. lateral transfer occurs within domains of life, but also across domains, for different markers. there is now broad general agreement that lateral gene transfer  is a major force in the evolution of prokaryotes  <cit> . additional evidence suggests that gene transfer might also be an important evolutionary mechanism in protist evolution  <cit> . for instance, andersson et al.  <cit>  recently reported that alanyl-trna synthetase had been transferred from nanoarchaeota to diplomonads and parabasalids. the same authors  <cit>  showed that lgt has affected both eukaryotes and prokaryotes with respect to glutamate dehydrogenase.

one may choose to ignore conflicting signal as if it were noise, even if legitimate evolutionary events underlie it. if such a choice is made, incompatibilities between different trees can be resolved by supertree  <cit>  or a posteriori consensus approaches  <cit> . supertree methods assemble an input set of separate phylogenetic trees with shared taxa into a larger tree  <cit>  . by fitting variously supported clades together, they allow large phylogenies based on different characters to be constructed rapidly and have been applied to a broad range of species  <cit> . consensus approaches, such as obtained by concatenating sequences  <cit>  or by averaging over a large number of genes  <cit>  produce resolved phylogenies by overwhelming noise with signal that is presumed to be systematically congruent and historically true, though weak.

however, if this "noise" is in fact bona fide phylogenetic signal, then the tree cannot display a historical picture of evolution: internal nodes do not accurately represent the evolutionary process. it might be useful in taxonomy, indeed represent the best possible compromise for taxonomic purposes, but such a graph could do little to satisfy our understanding of molecular evolution. the averaging employed by these methods irons over what are perhaps the most interesting wrinkles.

however, it should still be possible to make progress towards the deeper goal of understanding genome and organism history, if we are willing to abandon the formalism of the tree, itself just a convenient metaphor for genealogical relationships. horizontal inheritance, as complicated as it is to deal with within the constraints of the tree paradigm, is simply a facet within a more realistic model of genealogy yet to develop fully. splitstree  <cit>  and its kind are excellent at representing this higher dimensionality, though the webs that it draws are still just graphs of relationships. little about evolutionary history can be gleaned from these graphs, though they do suggest compelling hypotheses.

here, we are interested in retracing evolutionary history as much as possible, attending to both the vertical and horizontal axes of inheritance. we do not think that lgt should be dismissed as noise and discarded in the construction of a phylogeny, but neither do we wish to abandon the concept of vertical inheritance, which by the very nature of cell division, must be a factor in genealogy, overwhelmingly so in the short term. instead of forcing each gene to fit a given model, therefore, our aim is to extract as much of a gene's phylogenetic information as we can, vertical and horizontal inheritance modes included, and cross-reference the information with that obtained from other genes. we call the resulting graphs syntheses, because they have both tree-like and web-like parts  <cit> . in doing so, we reckon as the supertree users, consensus makers or concatenation advocates do that recognizing the vertical backbone of a synthesis graph is an important part of the task, but nevertheless, just a part of the ultimate goal of phylogenetics.

using phylogenetic tree comparison to suggest lgt
this exercise requires an accurate identification of lgt. many methods researching similarity/dissimilarity among genes exist to assess the occurrence of lgt  <cit> , with varying reliability. koski and golding  <cit>  showed that best blast hits do not necessarily represent the closest sequence relatives, casting doubt on the reliability of blast based approaches . while daubin et al.  <cit>  showed that, in the bacterial realm at least, results from genome content and compositional approaches to detect lgt cannot always be taken as evidence for genetic exchange. in fact, it seems that phylogenetic analysis, even if it is more time consuming and might fail to detect transfers between more closely related organisms  <cit> , is still one of the most reliable ways to investigate lgt  <cit> . indeed, observing a close and robust phylogenetic relationship between gene sequences of distantly related organisms to the exclusion of gene sequences of more closely related organisms likely indicates lgt  <cit> . alternative explanations, still possible a priori, would be artifacts of tree reconstruction, or complicated cases of reciprocal gene loss.

highlighting conflicting signal between presumably correct gene trees is necessary in identifying lgt, although tree comparison is not trivial. broad comparisons can be conducted between pairs of trees to determine if they are significantly different  <cit> . for instance, the incompatibility of different topologies can be assessed by an au test for a given gene, using maximum likelihood estimates  <cit> . however, such global comparisons only indicate that there is a disagreement between the history of genes, not what this disagreement is. an alternative pruning of selected taxa and subsequent statistical tests of incongruency  <cit>  can be attempted to identify the species misplaced in one of the two trees, considering one tree as a reference. species to be pruned are generally chosen after an observation of bootstrap support values  <cit> , as those robustly located in different parts of the trees under comparison. if the incongruence persists after these taxa have been removed, those species are then generally not considered responsible for the incompatibility between the trees. conversely, if the pruning of species with significantly different locations in the trees eliminates incongruence, then these species could be considered as recipients of lgt, if no artifact is otherwise suspected of causing their odd placement in one of the topologies. in practice, this pruning approach is generally time-consuming and inefficient, due to the high number of possible pruning combinations, exacerbated by a possible misinterpretation of results due to taxon-sampling effects.

recently, addario-berry et al.  <cit>  implemented a promising comparison between a reference tree and a gene tree, overcoming some of these difficulties. interestingly, their program posits lateral transfer schemes and scenarios to rationalize the differences between trees. these evolutionary scenarios, based on lgt, provide an explicit and accurate description of possible transfer events. in addition to the identification of a recipient species, they suggest a donor species, in the reference tree or outside of it. to do so, they estimate the minimum number of transfers necessary to explain disagreements between the pair of trees. this is done using the following criterion: since a and b are siblings in the gene tree, either the ancestral gene ab must have been present in the last common ancestor of a and b in the species tree or a lateral transfer event has occurred from the a lineage to the b lineage . at present, this method compares only one gene tree against the reference tree, and only if they include exactly the same taxa. in addition, it works only for rooted directed trees, which unfortunately limits its application. notably, the requirement of strictly bifurcating trees forbids the collapse of unsupported nodes, thus greatly exaggerating the difference between trees.

in this paper, we revisit addario-berry et al.'s search for evolutionary scenarios to describe lgt but also insist on the detection of common vertical features among trees. we propose a pair of programs for dealing with multiple phylogenetic tree comparison, against a given reference tree. these trees may  differ in their species content, topological relationships, label positions, bootstrap support, and branch lengths.

implementation
horizstory
comparing trees for two different genes amounts to exchanging branches within the first genes' tree  to match another's, and assessing the relative likelihood of this scenario. the topological comparison of phylogenetic trees is inherently difficult, as the number of possible edit paths  increases rapidly with the number of differences between trees. where edits are individually independent, they may furthermore occur in any order within an edit path , thus exploding their number factorially. without resorting to heuristics and its inherent approximations, and without constraining the types of possible edits , we are therefore limited to comparing trees that are relatively similar. however, if one abandons the constraint of assuming that trees are fully resolved  <cit> , which is most often not the case, then many apparent differences disappear and the problem becomes more tractable. one should be concerned with explaining only robust differences between trees, which can be determined by bootstrap support, for example, in ml phylogenies.

it is also important to compare the right trees, which amounts to a wise choice of reference tree against which test trees  are compared. a good reference tree may be one that minimizes the overall number of differences it finds when matched with a variety of test trees; thus references based on concatenated sequences, supertrees, or genomic phylogenies should be most suitable for this purpose. still, one might be uncertain about the exact choice of reference tree , where alternatives are equally attractive. one could then use each candidate reference tree in turn as a reference against the set of test trees, and measure the extent of lgt predicted with each choice. this may suggest that one reference tree is better than another in this context, a result interesting on its own with respect to the issue of organismal phylogeny and the "true" tree.

our approach to the comparison of phylogenetic trees, with the purpose of detecting lateral gene transfer  as well as determining the degree of concordance of vertical inheritance relationships, makes use of a recursive procedure of consolidation and rearrangement. consolidation involves the simplification of identical topological features  by collapsing such features . this is followed in a second step by the collapse of compatible topological features. a compatible feature is, for example, a relationship of ,"c") in the reference tree and an unresolved relationship of  in the candidate tree, leading to " ,c]". compatible features do not necessarily support vertical relationships, but neither do they provide evidence for lateral gene transfer. once the pair of trees to be compared is thus simplified, each of the candidate tree's leaves is moved to every alternative node in its tree in turn, with each move being tested by consolidation. where simplification is possible , the move is productive and launches another pathway of rearrangement, where further rearrangements and simplifications are tried until the pair of trees can converge to identity, or until the pathway is abandoned. a pathway is abandoned, if, for example, it would require more steps than another pathway already explored.

we suppose that a rearrangement that can bring a pair of trees closer to one another topologically, is equivalent to "undoing" an event of lateral gene transfer. the position from which a taxon had to be moved in order to make the trees more similar is taken to be the lgt donor, whereas the taxon being moved is then the recipient. given that rearrangement reconstitutes reference topologies , presumed lgt targets are disqualified from suggesting such relationships by being pruned from the trees prior to the next recursive rearrangement.

last but not least, rearrangement pathways must go to completion in order to be reported, resulting in full convergence of the pair of trees, but some edit distances are shorter than others, and suggest a smaller number of lgt events. for reasons of evolutionary parsimony as well as computational economy, this conservative route should be preferred.

our scenarios can include different kinds of lgt events. events of lgt may be nested, or otherwise intertwined, needing reversal by multiple rearrangements. the clade founded by an lgt donor may have subsequently had its species membership obfuscated by later exchanges of genetic material, yielding an unnatural assemblage of nomenclatural tags  in a presumed lineage. we distinguish such intermediary groupings in our output using an asterisk, indicating an ambiguity in deducing the root taxon, that being the actual organism that served as lgt donor. we also found it necessary to indicate  when an lgt event cannot be attributed directly to a clade found in the reference tree, but rather to a phantom sister of that clade. this signals a 'basal transfer', which is observed when a taxon migrates out of its own clade to sit just outside of that clade in the candidate tree. since lgt cannot occur with one's ancestor, the best explanation in a context of lgt is that the taxon received genetic material from a sister clade which happens not to be represented among the taxa in the dataset under investigation. other nomenclatural marks in our program's output, mentioned above, include the parenthesis indicating an identical topological feature, and the square bracket indicating a compatible topological feature. the program's output thus consists of a list of the rearrangement pathways and the consequently deduced vertical and lateral  features. the frequencies of these features are also summarized in the output for each the pair of trees, and a global summary is presented for all pairs of trees analyzed.

for various reasons, a user might have a collection of trees to compare that include different taxa, or a user might more generally wish to exclude specific taxa from certain individual phylogenetic analyses. where trees have different complements of taxa, pruning of taxa outside of the intersection of the two sets is done automatically. where a pair of trees includes common taxa that the user wishes to exclude from analysis explicitly, he or she need only supply files listing which taxa should be excluded, either globally , or locally . pruning might be prescribed if, for example, one suspects causes other than lgt to be responsible for some of the differences between a pair of trees, such as long branch attraction. absence of such files indicates that no pruning is desired.

we have successfully tested horizstory with many different sets of real data, including hundreds of trees with  <dig> species and several dozen trees with over  <dig> species. simple and nested lgts simulated by manual modifications of a reference tree were also correctly reported in the scenarios.

lumbermill
lumbermill is a phylogeny editor, written in java, for drawing trees and syntheses, using horizstory output as input. it realizes our notion of synthesis  by first representing a vertical phylogram as its backbone. line thickness is drawn in proportion to the percentage of genes supporting a given grouping; common patterns of vertical inheritance are thus easy to identify. . overlaid onto this backbone are links that represent presumed lgts, completing the synthesis.

the images trees or syntheses are highly editable, allowing the user to change fonts and line colours to provide a customized view of the data. the order of a node's descendants can be swapped. the backbone can be rerooted on another node or even unrooted. to help describe events in the synthesis, nodes are labeled numerically by distance from the root then alphabetically from top to bottom. in addition to this, each link is interactive, and when clicked on, displays information such as the proportion of genes inherited along this link, and their names.

often, multiple equally parsimonious lgt scenarios are proposed by horizstory in order to explain differences between a given gene tree and the reference topology. lumbermill allows the user to restrict the display of individual lgt events to those suggested by a specified minimum fraction of the scenarios, such as  <dig>   or values greater than  <dig>  . one can also elect to omit the display of specific lgts for some genes in lumbermill, such as when the conflicting signal involving this gene is found to be due to some cause other than lateral gene transfer.

putative lgt events are drawn as arrows originating from a donor  and terminating at a recipient. since the exact time at which a transfer occurred cannot be determined, the relative order of multiple arrows on any given segment is irrelevant, as is the position of an arrow on the segment. in order to avoid clutter in busy regions of the tree, we chose to extend segments to provide more room. such artificially extended segments are drawn as dotted lines so as not to confuse them with actual branch lengths .

when genes have apparently been inherited from a taxon missing from the reference tree, we insert a basal group in the tree where appropriate. this donor, a contemporary clade absent from the current dataset and that may or may not have since gone extinct, collects all of the lgt events originating from outside of a represented clade. it is meant as a convenient catchall, and where multiple lgts appear to originate from such a given basal group, it is understood that different donors may actually have contributed genes independently.

our method allows for nested lgt scenarios, where a compound donor in the evolutionary scenario for a gene is not represented as an organismal clade in the reference tree. in this case, one cannot therefore point to an actual donor for the gene at this intermediary step in the scenario, since its identity is ambiguous, appearing to parent species from different clades. lumbermill deals with such organismal assemblages by indicating several candidate donors all leading to the same target. it is assumed that the lgt event in question involved a single donor parenting one or more species in this assemblage, or when a basal group is also indicated, a single donor related to the parent of one or more of the species in the assemblage. these lgt involving such intermediate assemblages are represented using a double-headed arrow.

RESULTS
we provide an example for four genes of the gamma-proteobacterial core compared with the gamma-proteobacterial species tree  <cit> , deduced from a simultaneous study of  <dig> genes by lerat et al. . in order to illustrate the workings of horizstory on a simple example, figure  <dig> displays the analysis of a tree for the virulence factor mvin against this proposed gamma-proteobacterial species tree. the two steps required to transform the mvin tree into one compatible with the reference tree are in fact equivalent in the two scenarios shown , and can thus be represented more simply in the user-interface layer of our software, lumbermill, described above.

among their  <dig> markers, lerat et al.  <cit>  identified two proteins, the virulence factor mvin and the biotin synthase biob, for which the position of pseudomonas aeruginosa conflicted with the species tree. our example  includes these two genes, with two more randomly chosen from among the remaining  <dig> of lerat et al.'s set: a putative orf and n6-adenine-specific methylase. it shows that some but not all recent divergences are reasonably supported by the set of four genes that contributed to this synthesis , whereas deeper nodes are generally not so well supported, suggesting that this reference tree is not robust. this is consistent with the fact that mutational saturation of molecular sequences contributes to the erasure of phylogenetic information as time progresses  <cit> , and several reports indicate that even with large amounts of data, the resolution of deep phylogenies will continue to be elusive  <cit> .

lumbermill displays both the support for a clade as well as the putative shuffling of genes with other clades, and can therefore begin to address this issue. for instance, figs.  <dig> and  <dig> show that the ancestor of enterobacteria  acquired its copy of mvin from a sister group of the gamma-proteobacteria by lgt, and subsequently the non-endosymbiotic enterobacteria donated this gene to p. aeruginosa. fig.  <dig> also shows that a copy of biob was laterally transferred from a sister group of the gamma-proteobacteria to the ancestor of p. multocida and h. influenzae.

many estimates, described in the help file of lumbermill , are also implemented in lumbermill to help investigate the distribution of the phylogenetic signal in the synthesis, to get information about the processes of lgt and a rough description of genetic mosaicism by node, as presented in fig.  <dig>  this last feature of lumbermill addresses concerns raised by important publications  <cit> , describing organisms as chimerae. although a tree-like framework can still be appropriate to relate species for which no mosaicism is detected, a web  <cit>  or a synthesis such as ours is required where mosaicism is evident. fig.  <dig> displays the relative proportion of vertical inheritance  and of lateral transfer , phylogenetically assessed for each node of the synthesis. the information is displayed in two columns: the first represents lateral transfer occurring since the previous node only, while the second shows a cumulative estimate of all lgts since the origin. such summaries can address the issue relating phylogenetic distance with propensity for exchange, known to exist within "species"  <cit>  and postulated for larger clades  <cit> .

CONCLUSIONS
horizstory and lumbermill constitute a pair of phylogenetic tools to compare multiple trees, and to display this comparison in a useful and flexible format. the software is freely available to the community and downloadable from , and it will continue to be built upon in order to add further summary analyses. already, we believe that they provide important information to the evolutionary biologist such as the frequency and direction of putative lgt events. we also gain information on the number of lateral exchanges undergone by each gene, the uniqueness of the lgt event  or the fact that some species exchanged multiple genes on a regular basis . finally, we can assess the robustness of a tree's backbone. one could use these analyses in order to explore the evolution of phylogenetic signal and the relative power of phylogenetic methods to solve a given taxonomic issue. by proposing specific lgt events, our system may furthermore bracket the temporal coexistence of lineages, given that lgt can only occur between contemporary species. otherwise, one cannot know much about the temporal coincidence of anything but extant species, where fossil evidence is lacking. this may be combined with ecological and biogeochemical hypotheses, and thereby help to understand the propagation of biological innovation throughout evolutionary time.

availability and requirements
*project name: horizstory and lumbermill

*project home page:  

*operating system: platform independent 

*programming languages: horizstory – c++, lumbermill – java

*other requirements: c++ compiler , java  <dig> . <dig> or higher 

*license: horizstory – gnu gpl, lumbermill – none

*any restrictions to use by non-academics: horizstory – none, lumbermill – none

note: horizstory was designed and tested using gcc  <dig> , available at 

application details
whereas lumbermill has an intuitive graphical user interface, horizstory is a command-line c++ program whose options we describe below. its signature is:

horizstory -f listoftreefiles -r indexofreferencetree -m minimumbootstrap    

where square brackets indicate optional parameters; the default fraction threshold is  <dig> , the default bias is none, the default time limit is  <dig> s , and the default verbose mode  is false.

-f: names a file that first specifies the number of entries , then specifies that number of file names, representing a reference tree and trees to be tested against it, in any order. non-reference trees must include bootstrap values for each node , but the reference tree need not include such information. our method requires trees to be rooted, but can deal with multifurcated trees.

-r: the index, within the listoftreefiles, of the reference tree's file. the reference tree is assumed to be topologically resolved and rooted; where the user wishes an unresolved feature  within the reference tree, a branch length of  <dig>  can be specified. bootstrap values may or may not be present in the tree; if present they are ignored unless  <dig>  which again serves to collapse a node.

-m: branch lengths of  <dig>  in a candidate tree are automatically unresolved; otherwise bootstrap values are compared with this integer parameter in order to decide whether or not the node should be collapsed. for example, a weak feature  below threshold in ,c) collapses to .

-t: when trees are quite different, many pathways of rearrangement might be found that can transform a candidate tree into a topology compatible with the reference tree. in some of these pathways, exotic lgt events might be proposed that are not proposed by the majority of other pathways. this parameter, therefore, allows one to limit the summary output of the program to lgt that are suggested by at least a certain fraction of the pathways, e.g.  <dig> .

-bias: one may wish to minimize or to maximize proposed events of lgt involving nested groups or basal groups. the analysis is first done to minimize the length of a rearrangement scenario, but then the output can be filtered by one of the following options if desired.

n: consider paths with the minimum number of nested groups, from among the set of shortest edit paths.

np: consider paths with the minimum number of nested groups, and of those, with the minimum number of phantom sisters.

np: consider paths with the minimum number of nested groups, and of those, with the maximum number of phantom sisters.

n: consider paths with the maximum number of nested groups.

...and so on .

-s: the user may specify a time limit for the analysis of each tree, in seconds. tests on pairs of randomly generated trees indicate that processing time is exponential, o, with the number of differences in the trees after initial consolidation, n, with c =  <dig> , and on our test system , with o being approximately  <dig>  μs. where a pair of trees must be compared, but the required time is prohibitive, the user may opt to increase the minimum bootstrap  requirement, in order to compare only the most resolved portions of the trees.

-v: when specified, this parameter enables verbose output to the terminal window. it does not affect the output printed to file.

"pruning files" are given the identical name of the referencetree, but appended with ".pru", for global prunings, or are given the identical name of a candidate tree  for local prunings. the file specifies the number of taxa to be pruned, followed by that number of taxon names.

authors' contributions
eb originated the study and provided critical feedback to dm, who implemented lumbermill, and to rlc, who implemented horizstory. wfd contributed to the writing of the manuscript.

