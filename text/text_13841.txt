BACKGROUND
the analysis of "enrichment" of gene sets is a natural extension of the study of differential expression of individual genes. focusing on sets of genes rather than on individual genes has several benefits. from a statistical point of view the analysis of groups instead of individual genes is advantageous as this typically increases power and reduces the dimensionality of the underlying statistical problem. from the biological perspective gene set enrichment analysis allows one to ask  questions that are of direct interest to the understanding of the functional mechanism in a cell: is a certain pathway activated in a given tissue under some treatment x? is the pathway more active than other pathways? these questions directly relate to various null models for gene sets.

therefore, for good reason a substantial number of statistical procedures to assess gene set enrichment have been introduced in the last few years – see table  <dig> and references  <cit>  for an overview. given this extensive literature, biologists are now confronted with the difficult choice of a gene set method that is best suited to analyze their data at hand. so far, a "taxonomy" of enrichment analysis approaches and a systematic comparison is lacking.

the objective of the present work is three-fold. first, we present a meta-theory of gene set enrichment analysis in the form of a general modular framework . this modular scheme encompasses most if not all published approaches for gene set analysis, and hence allows to study the interplay among the various methods. second, based on this framework we conduct a principled comparison investigating  <dig> variants of gene set enrichment procedures. from extensive computer simulations and the analysis of two experimental data sets, we offer specific recommendations for conducting an effective gene set analysis. third, we present an extensive survey of existing statistical methods for detecting enriched gene sets. this is found in the appendix and forms the basis of the proposed modular framework.

methods
in this section we describe the key result from our studies: a modular framework that provides a taxonomy for gene set analysis. in the appendix we have compiled a very comprehensive overview of the respective approaches that underlie our proposed meta-theory of gene set enrichment.

modular structure underlying procedures for gene set enrichment analysis
our suggestion for a common modular framework for gene set enrichment analysis methods is depicted in fig.  <dig>  the scheme consists of five distinct modules: the calculation of a gene-level statistic, an optional transformation of these statistics, the choice of a null hypothesis, the computation of a gene set statistic and the significance assessment. the first two modules correspond to an analysis of differential expression on the individual gene level. the remaining three modules process these results further to obtain an assessment of gene set enrichment. a separate track in this diagram is provided for a module for conducting global tests.

we will now describe each module in more detail. note that the scheme presented in fig.  <dig> is both descriptive as well as generative: by selecting a method in each box one arrives at some specific approach for detecting gene set enrichment. to our knowledge, all enrichment approaches published so far fit into this scheme. in addition, there are also many combinations of modules that will lead to a "novel" method . however, note that some modules are tightly interconnected, e.g., the choice of null hypothesis and of significance assessment. these dependencies need to be kept in mind when setting up a gene set analysis.

description of individual modules
gene-level statistics
in all the univariate approaches , the first step in conducting a gene set enrichment analysis is to assess the amount of differential expression of the individual genes. choosing a suitable test statistic for this purpose has been discussed extensively in the literature, for an overview we refer, e.g., to  <cit>  and references therein.

typically, the gene-level statistic will be selected from the following list:

• fold change,

• signal-to-noise ratio,

•  t-statistics,

•  correlation coefficient,

• coefficient of anova or linear/logistic regression, and

•  log-likelihood ratio.

due to the small sample size found in genomic data in most instances the regularized versions of these test statistics  are preferable.

transformation of gene-level statistics
the second step of univariate procedures for detecting gene set enrichment consists of the transformation of the local gene statistic. suitable options suggested in the literature include:

• no transformation,

• absolute values,

• squared values,

• binary transformation,

• ranks,

• p-values or bayesian posterior probabilities, and

•  false discovery rates.

there are many instances when a transformation is beneficial, for example in order to improve robustness, or to account for both up- and down-regulation. the binary transformation is an extreme case of ranking considering only two classes . many of the adhoc procedures used by biologists to declare differential expression  fall into this category. also note that binary transformation combined with testing gene set membership is equivalent to the contingency table approach .

the influence of the transformation of the gene-level statistics on the results of gene set enrichment procedures is shown by newton et al.  <cit> . these authors compare the power properties of averaging and selection test statistics, i.e. methods based on the mean of local statistics like the t-statistic and methods where the mean over the binary indicator of differential expression is used. newton et al.  <cit>  find that selection methods work better when the gene set enrichment is characterized through a small number of highly differentially expressed genes, whereas averaging is able to detect enriched sets consisting of a large number of genes with subtle increase or decrease of the expression levels.

null hypotheses
a factor that strongly influences the general setup of an enrichment procedure is the choice of the null hypothesis. the two most common choices are termed q <dig> and q <dig>  <cit> .

q <dig> is called the "competitive null hypothesis" and corresponds to the case where the association between the genes in the set and the phenotype is compared with the association of the remainder of the genes and the phenotype. note that this implies a model where the genes are the sampling units and the association between the samples and the phenotypes is fixed. thus, testing this hypothesis is conditional on the gene-level scores. the "complete null hypothesis"  <cit>  that all the gene sets under consideration have the same differential expression can be seen as a special case of q <dig> 

in contrast, q <dig> is the "self-contained null hypothesis" that focuses on the given gene set without considering genes outside of this group. it compares the association of the gene set and the phenotype with that of random phenotypes. under q <dig> the sampling units are the phenotypes while the gene set membership is fixed. a special case of the self-contained null hypothesis is the "global hypothesis" that there are no differentially expressed genes at all.

a third possible null model, here called q <dig>  is the "nested null hypothesis", where differential expression of the genes in the gene set is compared to the differential expression of all genes under consideration . this model is motivated by the fdr-based approach described in efron  <cit> , where fdr and conditional fdr values are compared.

for understanding gene set enrichment procedures it is absolutely essential to understand the implications of the various null models  <cit> . for instance, if there are many differentially expressed genes in all gene sets, testing under the self-contained model q <dig> is quite likely to indicate enrichment, even though the particular gene set under investigation might not show any special "enrichment" compared to other gene sets.

furthermore, as goeman and bühlmann  <cit>  point out, the aim of a gene expression experiment is to assess whether the transcript levels of the genes differ between the different phenotypes. thus, it is based on a model where the phenotypes are the sampling units. consequently, one would repeat the experiment with different samples and not with different genes to verify the results. in contrast, the competitive hypothesis q <dig> assumes that the genes are the sampling units, turning the experimental design upside down. therefore, some authors  <cit>  consider q <dig> only to be "of limited utility" for statistical analysis.

gene set statistics
a further step in an enrichment analysis is the computation of a gene set statistic. examples include:

• the sum or the mean of the  single gene statistics,

• the median of the  single gene statistics,

• the  kolmogorov-smirnov statistic,

• the maxmean statistic,

• the wilcoxon rank sum test statistic,

• the sign test statistic, and

• the conditional local fdr.

the question of which gene set statistic is optimal in a given setting is subject to ongoing discussion. for example, efron and tibshirani  <cit>  show that their maxmean statistic is more powerful than a kolmogorov-smirnov test or an average of local statistics. jiang and gentleman  <cit>  call attention to the problem of robustness against outliers and advocate summaries such as the median or the sign test statistic.

significance assessment
the last step of both the univariate and the global and multivariate procedures  for enrichment analysis is the assessment of significance of the observed gene set statistics. the calculation of the p-value can be done in three different ways:

 <dig>  gene sampling: a large number of random gene sets of the same size as the set under investigation is drawn from all the genes and the global statistic is recomputed for every random set. the p-value is calculated as the fraction of resampled gene set statistics that exceed  the observed value.

 <dig>  sample label permutation: the phenotypes of the subjects are permuted a large number of times and the local and global statistics are recomputed. the p-value is the fraction of permutation gene set statistics that exceed  the observed value.

 <dig>  restandardization: both gene sampling and sample label permutation are conducted. then each permutation statistic is standardized with the mean and standard deviation of all permutation statistics. to obtain the restandardized value, the standardized permutation statistic is multiplied with the standard deviation of the gene sampling statistics and the mean of the gene sampling statistics is added. the p-value is the fraction of restandardized gene set statistics that exceed  the observed value.

note that the choice of the null hypothesis and the pursued sampling strategy are interconnected: q <dig> implies gene sampling, and q <dig> sample label permutation. furthermore, gene resampling implicitly assumes independent genes in the group, a prerequisite that is unlikely to hold, e.g., for genes within a pathway. the restandardization strategy put forward in  <cit>  combines the two very different sampling schemes into a single procedure. therefore, this approach mixes the two null hypotheses q <dig> and q <dig> which may lead to difficulties in the interpretation of the resulting p-values. interestingly, note that the gsea algorithm  <cit>  implicitly also considers both permutation approaches. while the gsea null distribution itself is found by permuting sample labels, the kolmorogov-smirnov-type test statistic equally carries information on the whole set of genes . thus, gsea implements something in effect related to restandardization, albeit not in the extent of the method by  <cit> . finally, a computational consideration is whether the chosen null distribution may be approximated by a parametric distribution. this is fundamentally tied to the choices made earlier, and is possible only in very rare circumstances, e.g., in the method of kim and volsky  <cit> .

global and multivariate approaches
enrichment approaches that do not follow the structure introduced above are the global and multivariate procedures. these directly define one model for the whole gene set. nevertheless, the globaltest of  <cit>  and the globalancova of  <cit>  also allow to obtain a score for every gene as well, since the gene set models can be written as a combination of the models for each gene. for the t2-based tests this is only possible when the covariance matrix is diagonal.

in a simulation study,  <cit>  showed that the globaltest and their globalancova perform equally well for independent genes but that the globalancova outperforms the approach of  <cit>  when there are strong gene-gene dependencies. kong et al.  <cit>  show that their combination of pca and hotelling's t2-test detects more gene sets than the globaltest. they explain this finding with the multivariate nature of their test. however, the assumption is only made on the basis of the evaluation of one data set and further analyzes are needed to show the superiority of this procedure.

RESULTS
employing the developed taxonomy and modular framework we now compare the various gene set enrichment approaches by a principled simulation study and exemplary data analysis.

simulation study
general set-up
all necessary programming and calculations were implemented using the free software environment r  <cit> . we simulated data in a fashion to represent stylized yet typical constellations of gene set structures found in real gene expression data. we considered gene sets with different levels of differential expression  and with varying levels of intra-group correlation . furthermore, we also constructed mixed sets, i.e. gene sets that included both differentially expressed and non-differentially expressed genes, and also sets containing both up and down-regulated genes.

each generated data set consisted of p =  <dig> genes with n =  <dig> samples . the data were generated from a 600-dimensional multivariate normal distribution, with variances set to  <dig> and means and correlations specified as follows:

• background :  <dig> genes were simulated with μ =  <dig> and ρ =  <dig> 

• set  <dig> :  <dig> genes with Δμ =  <dig>  and pairwise correlation ρ =  <dig>  between the genes in the set.

• set  <dig> : same as set  <dig> but with zero correlation among genes.

• set  <dig> :  <dig> genes selected randomly from the  <dig> background genes.

• set  <dig> :  <dig> genes with Δμ =  <dig>  and ρ =  <dig>  from set  <dig>  the other  <dig> randomly selected from the background set.

• set  <dig> : same as set  <dig>  but with zero correlation among genes .

• set 6: :  <dig> genes with Δμ =  <dig> and  <dig> genes with Δμ = - <dig>  the pairwise correlation between the genes with the same direction of differential expression is ρ =  <dig> , between the up- and down-regulated genes it is ρ = - <dig> .

• set  <dig> : same as set  <dig>  but without any correlation among genes.

• set  <dig> :  <dig> genes from set  <dig> , mixed with  <dig> genes from the background set.

• set  <dig> : same as set  <dig>  but without any correlation among genes .

thus, the  <dig> simulated genes are constituted by the background set, set  <dig>  set  <dig>  set  <dig> and set  <dig>  any well working procedure for gene set enrichment analysis should be able to detect at least the pure sets  <dig>   <dig>   <dig> and  <dig>  but ideally also the sets  <dig>   <dig>   <dig>   <dig> where only half of the genes are differentially expressed. gene set  <dig> serves as a negative control.

using this data we conducted gene set enrichment analysis by considering combinations of the following module methods:

• gene-level statistics: two-sample t-statistic, moderated t-statistic, pearson correlation coefficient.

• transformation of gene-level statistics: none, squared values, ranks, binary transformations, local fdr.

• gene set statistics: mean, median, maxmean statistic, es , conditional fdr , wilcoxon rank sum test.

• significance assessment: resampling, permutation, restandardization ; parametric .

the gene set statistic es was not combined with a binary transformation since the latter does not allow a sensible ranking of the genes. hence, in total  <dig> ×  <dig> ×  <dig> ×  <dig> –  <dig> =  <dig> variants of gene set analysis were considered. for each combination of modules we simulated  <dig> data sets, and determined the false positive rate for set  <dig> and the true positive rates for the remaining sets.

gene-level statistics and their transformations
first, we studied the effect of the choice of a specific gene level statistic and the corresponding transformation. specifically, we varied the gene level statistic and the transformation and fixed the gene set statistic to the mean and computed p-values by resampling. the results are summarized in table  <dig> 

the values indicated are the proportion of significantly enriched gene sets  for various combinations of test statistics and their transformations, with fixed global statistic  and the use of resampling for computing the significance.

in general, the choice of the gene-level statistic does not seem to have a great impact on the results of the enrichment analysis. in our simulation setting we obtained roughly the same results, regardless whether the conventional or the moderated t-statistic or the correlation was used. we note that the small differences might be explained with the rather large number of samples per group  which is already sufficient to properly estimate the variance of each gene without using a regularization approach. for smaller sample sizes, the merits of regularization or borrowing information across genes is likely to be more pronounced. in contrast, we find that the choice of a transformation has quite a substantial effect on the detection rates. it is striking that all three investigated gene level statistics fail to find sets containing both up- and down-regulated genes. in this situation applying an appropriate transformation instead of using the original scores is indispensable. in this regard, a very useful transformation is the calculation of squared values. although in table  <dig> it can be seen that this results in slightly lower true positive rates for sets  <dig>   <dig>   <dig> and  <dig> compared to untransformed gene-level scores, it enables the detection of the sets  <dig>   <dig>   <dig>  and  <dig>  which are not recognized using the untransformed gene level statistics. interestingly, if the squared transformation is combined with the rank transformation, this further improves the true positive rates and offers the best overall performance of all transformations under study . furthermore, the  quadratic transformations outperform the binary and the fdr transformations, which are two approaches that also detect sets containing both up and down-regulated genes.

gene set statistics
next, we considered in our simulations the impact of the choice of the gene set statistic. to facilitate comparison, we used as underlying gene level statistic the moderated t-statistic and employed a quadratic transformation. for significance assessment we applied the resampling. table  <dig> shows the results.

the indicated values correspond to the proportion of p-values ≤  <dig>  for squared moderated t and resampling.

overall, the gene set statistics all behave as expected for the nine sets. they assign high p-values to the uninteresting set  <dig> and relatively low p-values to the other sets. all approaches have some difficulty to reliably detect gene sets  <dig> and  <dig>  where there is relatively weak differential expression and half of the genes belong to the uninformative background.

performance-wise, the test statistics may be grouped as follows. the mean and the maxmean statistic produce rather similar and overall very good results. the median and the wilcoxon rank sum test, which are coarsened and more robust location estimators for the change in transcript level, perform markedly better than the mean or maxmean for the correlated sets. however, if phenotype permutation instead of resampling is used, this effect vanishes and the performance of the median and the wilcoxon test deteriorates . thus, the usage of the median and the wilcoxon test is primarily advantageous if the competitive null hypothesis is tested, or if there are many outliers in the data. the conditional fdr procedure compares well to the mean and maxmean procedures in the simulations. however, we find that the results of this approach vary strongly with the choice of the gene-level statistic, transformation and permutation approach. since it is not markedly better than the other approaches for any gene set and it is computationally expensive, it might not be the best overall choice for an enrichment analysis. perhaps surprising is the comparatively weak performance of the popular es score, which yields results that are worse than that of the sum or the mean.

significance assessment
in a further simulation experiment, we compared four approaches for obtaining significance values . in this study we used moderated t as the gene level statistic, employed a quadratic transformation, and used the mean as the gene set statistic.

the values indicated are the proportion of p-values ≤  <dig>  using the gene set statistic mean of the individual squared moderated t-statistics.

first, the parametric approximation of the null distribution yields the best results. however, the assumption of independence of the individual genes is clearly violated for sets  <dig>   <dig>   <dig> and  <dig>  thus, the corresponding p-values are over-optimistic.

the resampling procedure that investigates the competitive null hypothesis q <dig> also performs quite well. sets  <dig> and  <dig> are correctly categorized for almost all the  <dig> repetitions of the simulation. for sets  <dig> and  <dig> this is achieved in more than 90% of the cases. the correlated sets  <dig>   <dig> and  <dig> achieve lower true positive rates. resampling performs worst for the difficult sets  <dig> and  <dig>  where only half of the genes are differentially expressed.

testing the self-contained null hypothesis q <dig> using sample label permutation appears to be slightly easier than testing q <dig> , especially for the uncorrelated gene sets. note that permutation preserves the correlation structure among genes. since the effective gene set size is smaller in a correlated set compared to a set where the genes are independent, it is more difficult to detect enrichment in these situations. for this reason it is surprising that in most of the cases the permutation works still better for the correlated sets than resampling.

the restandardization procedure performs very similar to resampling. this was the case in almost all of the combinations of enrichment methods that were investigated in this work, so the benefits of restandardization are likely to be small in general. however, we note that  <cit>  showed in their paper that there might be some special situations where restandardization is advantageous.

comparison with global and multivariate approaches
in order to compare the modular univariate approaches with the global and multivariate procedures, we additionally analyzed the simulated data using the globaltest and hotelling's t2-test with a shrinkage covariance matrix  <cit> .

the results for the globaltest under different significance assessment approaches are summarized in table  <dig>  clearly, the performance of this procedure is not better than that of the less sophisticated univariate methods, especially the sum or mean of the squared gene-level statistics. indeed, the results are very close to these two approaches. hence, using the globaltest does not improve the results, but it is computationally a little bit faster, especially when the parametric approximation of the null distribution is used. since it leads to comparable results, it might be a useful alternative when a large number of sets is to be investigated.

the indicated values are the proportion of p-values ≤  <dig> .

the corresponding results for the hotelling t2-test can be found in table  <dig>  using this approach the uncorrelated sets are found with the same reliability as with univariate approaches. however, in stark contrast, the sets with correlation  are hardly detected. the reason is clear from a statistical perspective: the hotelling test statistic penalizes correlation . specifically, it is much more likely that genes in a set are all simultaneously differentially expressed if there is correlation. while the hotelling statistic corrects for this bias accordingly, this implicit penalization is clearly not desired from a biological point of view. a clear advantage of the hotelling t2-test is its improved performance with sample label permutation as opposed to gene sampling. since the approach does by definition test the self-contained null hypothesis, this is a positive result. nevertheless, the overall very poor performance of this multivariate approach raises the question whether taking into account the dependence structure between the genes is at all useful in the context of enrichment analysis.

the indicated values are the proportion of p-values ≤  <dig> .

analysis of p <dig> cancer data
in order to verify our conclusions from the simulations we reanalyzed the p <dig> cancer data from subramanian et al.  <cit> . the protein p <dig> is a tumor suppressor preventing the development of cancer cells. it regulates genes involved in the cell cycle and the induction of apoptosis after dna damage. gene set enrichment analysis allows to study which pathways are involved in these cellular mechanisms.

the p <dig> data is used as a benchmark data set in a number of papers  and contains expression profiles of  <dig> cancer cell lines that can be found in the data base of the international agency for research in cancer . the gene expressions were measured with the affymetrix hgu95av <dig> chip which contains  <dig>   <dig> probe sets. for each cell line, the mutational status of the p <dig> protein was reported.  <dig> cell lines were found to have normal p <dig> status while the remaining  <dig> samples showed a mutation of p <dig>  the analyzes in  <cit>  and  <cit>  recovered several gene sets that are differentially expressed between the mutation and wildtype cell lines. five functional groups were mentioned in all three publications:

• the p <dig> pathway,

• the down-stream targets of p <dig> 

• genes induced by radiation,

• genes induced by hypoxia, and

• the heat-shock protein signaling pathway.

dinu and co-workers presented  <dig> additional gene sets found with the sam-gs method  <cit> .

in our preprocessing of the data we filtered out genes that showed maximum signal intensities of less than  <dig> on log <dig> scale and a variation of less than 2-fold over all samples to reduce the noise in the data. the resulting data set contained  <dig>  genes. from the biologically chosen gene sets of  <cit>  we focused on sets with sizes between  <dig> and  <dig> genes. this left  <dig> gene sets of varying size, each containing between  <dig> and  <dig> genes.

in the following we report only our main findings. a much extended analysis of the p <dig> data set including detailed tables of significant gene sets and pathways can be found in  <cit> .

gene-level scores and transformations
as in the simulation study, in order to compare the various gene level statistics and their transformations we employed as gene set statistic the mean and use resampling for computing p-values.

concerning the choice of gene statistics, there was little difference in the overall ranking of the gene sets. the  <dig> top ranked gene sets are nearly the same for all three statistics in combination with a specific transformation. the significant findings are in broad accordance with the results published previously  <cit> . specifically, we also recover the additional sets reported by dinu et al.  <cit>  if a squared gene transformation is used . for this data set we noted a distinct difference when positive and negative scores were analyzed separately, instead of combined. in particular, taking squared values of the individual gene scores appears to give more weight to gene sets that are not high scored in a separate analysis for up- and down-regulated genes. this is probably due to the fact that summing up the squared values leads to the detection of gene sets with many subtle expression changes in both directions instead of sets where some constituents are either up- or down-regulated.

when ranks or the binary transformation are used, fewer of the dinu and subramanian gene sets are detected. furthermore, the number of significant gene sets is decreased compared to using the original or squared scores. thus, for this data the results based on the rank and binary transformations appear to suffer substantially due to the loss of information. in contrast, the transformation to local fdr values  performs much better than in the simulation study.

gene set statistics and significance assessment
next, we investigated the impact of the gene set statistic and the choice of the significance procedure. in this analysis we used the squared moderated t-statistic as the gene level statistic.

the results are summarized in fig.  <dig>  for this data, both phenotype permutation as well as resampling lead to the same number of significant gene sets regardless of the p-value cutoff, the only exception being the wilcoxon statistic. the hotelling statistic and the conditional fdr approach consistently found the largest number of significant gene sets for any cutoff, followed by the global test and the mean and maxmean. the es, median, and wilcoxon statistics typically resulted in the least number of gene sets. note, however, that we do not know the ground truth for the p <dig> data. therefore, one needs to keep in mind that the larger power of the mean or the global test compared, e.g., to the es score might be due to a higher specificity of the latter. this is in concordance with our simulation study  where es and the median were the only two statistics that never declared the negative control  significant. the outcome of the hotelling t2-test is in very good accordance with the findings of  <cit> . thus, in contrast to the simulated data the hotelling approach gives meaningful results for real data. we investigated this discrepancy more closely by inspecting the correlations among the genes in a gene set. as can be seen from fig.  <dig> the correlations within a gene set are comparatively weak. this explains the good result of the hotelling approach, which for vanishing correlation essentially reduces to the sam-gs  <cit> .

analysis of hedenfalk breast cancer data
to complement the study of gene expression data we analyzed the breast cancer gene expression data from hedenfalk et al.  <cit> . this well-studied data set includes  <dig> cancer patients carrying the brca <dig> genetic mutation and  <dig> other patients carrying the brca <dig> mutation. microarray measurements were taken on  <dig>  genes.

a peculiar feature of this data set is that on the gene level there is virtually no signal to distinguish the two groups  – see for example  <cit> .

in our preprocessing for gene set analysis we considered a subset of  <dig>  genes  and a catalog of  <dig> gene sets from  <cit>  relevant for these genes.

gene set statistics and significance assessment
the p <dig> and the hedenfalk cancer data behave strikingly different, as can be seen in fig.  <dig>  for the hedenfalk data employing resampling resulted in very few gene sets detected as significant, regardless of gene set statistic. in contrast, when phenotype permutation was applied a substantial number of significant gene sets were found. as for the p <dig> data set, the gene set statistics can be divided into two groups. the hotelling, mean, maxmean and global statistics resulted in larger numbers of significant set, whereas median, es, wilcoxon and conditional fdr detected fewer gene sets. thus, for this data the conditional fdr approach is as conservative as in the simulations.

the difference between results for permutation and resampling may be explained as follows. if most of the active genes show only small expression changes, then the interesting sets do not differ markedly from random sets. consequently, they cannot be found by the resampling approach. but still, in the hedenfalk data the subtle changes of the interesting genes between the phenotypes are large enough when they are accumulated over the active gene set to be detected with sample label permutation.

enriched gene sets
finally, it is also instructive to inspect the list of detected gene sets. for gene set statistic mean with gene-level statistic moderated t, transformation squared values and sample label permutation all significant  gene sets are listed in table  <dig>  note the enrichment of many cancer-related sets as a result of the gene set analysis.

it is noteworthy here that using the es as gene set statistic does not yield the set breast_cancer_estrogen_signalling among the  <dig> top ranked gene sets, whereas in our table  <dig> it is ranked number  <dig>  we remark that this is a biologically important finding, in concordance with hedenfalk et al.  <cit>  who state that tumors with brca <dig> mutations are generally negative for estrogen receptors, whereas brca <dig> mutations are positive, implying that brca <dig> and brca <dig> genes induce the formation of breast tumors through separate pathways.

as gene set statistic we used the mean combined with the squared moderated t-statistic on the gene level and sample label permutation.

overall, it appears that the hedenfalk data is an exemplary case where merits of gene set enrichment over analyzing individual genes can be most prominently seen.

CONCLUSIONS
in this work we have investigated statistical procedures for detecting enrichment of gene sets. by conducting an extensive survey of corresponding approaches we found that all procedures in current use may be fit into a simple modular framework as depicted in fig.  <dig> 

the identification of this modular structure greatly facilitates the systematic comparison of the diverse methods. based on simulations and data analysis we arrive at a number of guidelines for conducting a gene set enrichment analysis. we believe that these will contribute to the establishment of best practices for gene set enrichment analysis.

perhaps the most surprising result from our study is that the simple univariate procedures appear to work best under a large variety of conditions. specifically, using the mean of the squared  t-statistics and assessing the significance with one of the two permutation approaches reliably detects gene sets of diverse types of expression and correlation structures. this procedure was proposed, e.g., in  <cit> . intriguingly, this simple approach typically outperforms  the in biological circles very popular gsea method  <cit> . thus, we strongly disagree with the recommendation put forward in  <cit>  which was primarily given on grounds of software availability.

with regard to the choice of the best approach for each module in fig.  <dig>  our conclusions can be summarized as follows:

• gene-level score: the choice of the gene-level score is not crucial. all different kinds of scores lead to very similar results. however, it is recommended to use a statistic that is standardized by the variation of the gene expression, as this makes the measure of differential expression comparable across genes. scores with this characteristic are t-statistics, correlation coefficients or standardized regression coefficients. if the sample size is small, using one of the regularized t-statistics is the best choice since they are designed to stabilize small variances.

• transformation: the choice of transformation has a substantial impact on the overall results. in our study the  squared transformation was most accurate. the application of absolute values instead of squared values gives comparable results. note that using the squared values essentially corresponds to using a modified version of hotelling's t2-test with a diagonal covariance matrix. binary transformations often lead to satisfying results but also imply a loss of information. if the focus is put on gene sets that are concertedly regulated in one direction the untransformed scores should be used.

• gene set statistics: overall, the simple approaches such as the mean or the median work very well. using the median instead of the mean was proposed by  <cit>  as an approach that is less sensitive with regard to outliers. however, using the median may also lead to a smaller number of significant findings. similar arguments apply to the rank-based wilcoxon test. the gsea, or more precisely the enrichment score, is not as reliable as the other gene set test statistics. furthermore, the construction of the gsea is rather complicated since it mixes the competitive and the self-contained null hypotheses.

• significance assessment: the choice of the permutation approach for significance assessment is mainly determined by the null hypothesis that is tested. hence, it has to be decided carefully which procedure is used. if a self-contained test is conducted, the phenotypes have to be permuted. in this way, the null distribution of the gene set statistic under the assumption of no difference between the treatment groups is obtained. if the gene set is to be compared to other sets, gene sampling is the correct approach. then the null model is based on the assumption that the gene set membership is random. depending on the data structure, both approaches can yield quite different results.

• multivariate procedures: using a multivariate procedure such as the globaltest or the hotelling approach not necessarily yields better results than the best univariate approaches. however, for the globaltest a parametric approximation of the null distribution is available, which might be beneficial if a large number of gene sets are analyzed. the hotelling-type approach is not appropriate for the detection of gene sets containing genes that are highly correlated. from a statistical perspective this is straightforward to understand, as it is more unexpected to find a group of independent genes that are co-regulated than a group of correlated genes which behave similarly.

in conclusion, we find that despite the large variety of available gene set enrichment procedures there is a common core among all procedures. in order to reliably detect enriched gene sets it is in general sufficient to use a univariate approach, in combination with either resampling or sample label permutation, depending on the desired underlying null model.

in the present study, we have focused on methods for detecting enrichment of a single prespecified gene set. a topic not investigated here is the issue of multiple testing of gene sets. in this context, standard corrections for multiplicity need to be refined in order to account for dependencies among gene sets, which may be due to the underlying gene ontology graph structure or because genes may belong to several gene sets at once  <cit> .

authors' contributions
both authors contributed equally to the development of the modular framework, the design of the study, and to writing the paper. ma conducted all simulations and data analysis.

appendix
in this section we provide an overview of various currently employed statistical methodologies for detecting enrichment of gene sets. we distinguish between univariate and multivariate approaches. the univariate procedures first calculate a score for differential expression for each single gene. subsequently, a gene set summary statistic is computed and its significance is assessed by different parametric and permutation approaches. in contrast to the univariate approaches, the global and multivariate procedures directly infer the enrichment of the gene set without referring back to the gene-level. the multivariate approaches are distinguished from the global procedures by explicitly taking the correlation matrix of the genes into account when calculating the test statistic

univariate procedures
overrepresentation analysis
one of the simplest methods to investigate enrichment of predefined gene sets is based on testing a  <dig> ×  <dig> contingency table. correspondingly, this approach has been employed by many authors, e.g.  <cit> . in this setting, each gene is classified according to both membership in a gene set s and whether it is differentially expressed . subsequently, one investigates overrepresentation of genes belonging to s in the group of the differentially expressed genes. this is done by testing for the independence of the two criteria "differential expression" and "gene set membership". for instance, one can use the test statistic

 χ2=n2n <dig> n <dig> n.1n. <dig>  

which for sufficiently large n follows a χ2-distribution with one degree of freedom. alternatively, one may compute fisher's exact test  <cit>  for the hypergeometric distribution  <cit> . it is also possible to determine the distribution of the test statistic nonparametrically using sample label permutation  <cit> , which has the benefit of respecting the correlation between the genes. vêncio and shmulevich  <cit>  introduce an approach to account for categorization uncertainty, employing the goodman-kruskal  <cit>  measure of statistical association between the two margins of the contingency table.

gsea algorithm and related methods
one of the most popular methods for detecting enrichment is the "gene set enrichment analysis"  introduced in  <cit>  and improved by the same group only a short time later  <cit> .

this method starts with a list l of n genes ranked by their correlation with the phenotype of interest, e.g., using the t-score or the signal-to-noise ratio. in order to test the null hypothesis that the m genes in a set s are randomly spread in the list l a so-called enrichment score  is computed. this equals the maximum deviation from zero of a running sum  that increases every time a gene in the list l is in s and decreases every time a gene is not in s . additionally, every gene set member is weighted by its absolute value of correlation with the phenotype. as a result, genes with very low correlations do not contribute to the enrichment score of the set. the running sums for the genes in the set s and the complementary set s¯  are calculated separately as follows:

 ess=∑gj∈sj≤l|rj|pns,where ns=∑gj∈s|rj|p,ess¯=∑gj∉sj≤l1n−m. 

rj is a measure for the correlation of the individual gene gj with the phenotype, for example a t-statistic. the es is defined as the maximum deviation of ess  - ess¯ from zero . this test statistic is similar to a kolmogorov-smirnov statistic in that it compares the deviation between two cumulative distribution functions. but contrary to the kolmogorov-smirnov statistic, the es is signed and uses weights.

the choice of the exponent p in the above formula determines the influence of the single genes on the score. for p =  <dig> an unweighted statistic is obtained. when p =  <dig> the genes in s are weighted by their absolute value of correlation with the phenotype according to the chosen correlation measure. other values of p can also be used . the authors suggest p < <dig> if one wishes to penalize a lack of coherence in a set or p >  <dig> if correlation of a small subset of s with the phenotype is sufficient to call a set enriched. additionally, the summands are normalized by the sum of all test statistics in s. the summands for the genes in s¯ are constant.

other authors presented similar statistics, see for example  <cit>  who use xj = n - m and xj = -m as the contribution of the genes in s and s¯ to the running sum respectively. all the choices result in a score that assumes the value  <dig> when the running sum reaches the end of the list l.

significance of the test statistics is assessed by permuting the class labels and recalculating the es for every gene set in every permutation. this necessitates correction for multiplicity when a larger number of sets is tested.

an approach related to gsea but more general is "significance analysis of function and expression"  as described by  <cit> . this is a two-step procedure, where in the first step a local test statistic is computed for each gene  and in the second the statistics of the genes in the gene set s are combined to give a global statistic. this is done in order to compare the distribution of the local statistics in the gene set with that of the local statistics of the rest of the genes. however,  <cit>  leave it to the user to decide which global statistic is to be applied. they propose rank-based statistics as the wilcoxon rank sum test or the kolmogorov-smirnov test since they do not require any assumptions about the joint distribution of the local statistics. significance in the safe algorithm is evaluated by permuting the sample labels and recalculating the local and global statistics. for taking account of multiplicity when testing for several gene sets at a time  <cit>  suggest to control the false discovery rate and related criteria. 

yet another modification of the gsea method is introduced in  <cit> . these authors employ regression coefficients of the interesting outcome  to rank the genes. instead of taking a kolmogorov-smirnov statistic as the gene set statistic,  <cit>  use a van der waerden statistic

 y=∑gj∈sΦ− <dig>  

where Φ- <dig> is the quantile function of the standard normal distribution n  and rj is the rank of gene gj in the list of all genes. under the null hypothesis the test statistic y is approximately normally distributed with mean zero.  <cit>  employ a bootstrap sampling approach to estimate the variance of the null distribution.

averaging methods
another natural approach of combining information of a group of genes pursued by many authors is to simply average over the test statistics of the individual genes. specifically, let tj, j =  <dig>  ..., n, be the association measure of gene gj with the phenotype. furthermore define gkj as the binary indicator of whether gene gj belongs to gene set sk  or not . then the test statistic is given by

 wk=1mk∑j=1ngkjtj, 

where mk=∑j=1ngkj is the number of genes in set sk.

a crucial point noted by  <cit>  is that one needs to distinguish between two types of null hypotheses, which in turn necessitates different ways of assigning significance. the two hypotheses are:

 <dig> q1: "the genes in a gene set show the same pattern of association with the phenotype compared with the rest of the genes."

 <dig>  q2: "the gene set does not contain any genes whose expression levels are associated with the phenotype of interest."

these correspond to the "competitive" and "self-contained" hypotheses discussed in  <cit> . note that the first hypothesis compares the genes in the set with the remaining genes, thus implying that in a permutation test the genes are the sampling units. q <dig> tests the association between the genes in the set and the phenotype regardless of the genes that are not in the set. therefore, here the phenotype labels are the sampling units. when testing q <dig>  <cit>  employ a permutation approach whereas for testing q <dig> they apply a normal approximation to compute p-values.

an averaging approach based on the moderated t-statistic is described in the documentation of  <cit> . further discussion regarding the averaging of gene-level statistics can be found in  <cit>  and  <cit> . the "category" software of  <cit>  also implements a general form of the averaging approach.

the maxmean statistic and restandardization
 <cit>  propose several improvements of the averaging approach and gsea. first, they introduce a new test statistic called the "maxmean" statistic which leads to more effcient tests. it is defined as

 tmaxmean=max⁡,s¯s), 

where s¯s=1m∑gj∈ssj and s¯s=1m∑gj∈ssj are the averages of the positive and negative parts of the scores in the set s containing m genes. the separation of positive and negative scores facilitates the detection of gene sets containing both up- and down-regulated genes. furthermore, the form of the test statistic prevents that sets with only very few unusually large z-values are called significant, yet it allows to detect sets with both moderately large positive and negative z-values.

second,  <cit>  show the necessity not only to incorporate sample label permutation as in the gsea method but also gene sampling into the analysis. this idea is implemented in a procedure called "restandardization" which combines gene sampling and phenotype permutation.

let μ† and σ† be the mean and standard deviation of the distribution obtained by gene label permutation and μ* and σ* the corresponding parameters of the sample label permutation distribution. for a general test statistic t, for example the es used in gsea, the restandardization can be written as

 t∗∗=μ†+σ†σ∗t∗−μ∗m. 

it corrects the phenotype permutation statistics for the estimated distribution of the individual genes in the data set. the corresponding p-value can then be calculated in the usual way as the fraction of a large number of restandardized test statistics exceeding the observed test statistic.

when the gene set score is simply the average of the individual gene scores in the set, the restandardization formula can be simplified to

 tave∗∗=μs+σstave∗−μ∗σ∗. 

here tave denotes the gene set statistic obtained by an averaging approach, μs and σs are the mean and standard deviation of the scores sj of all n genes and μ* and σ* are the mean and standard deviation of the gene set test statistics tave∗ obtained by sample label permutation. in this special case, it is not necessary to conduct gene sampling before doing the restandardization since the mean of the gene sampling distribution is the same as the overall mean of the single genes and the standard deviations only differ by the factor 1m.

extensions to gsea and averaging methods
some further variations to the gsea and methods using the average of gene-level statistics are reported in jiang and gentleman  <cit> . they propose using the median or a sign test for robustly averaging over the scores in a gene set.  <cit>  also suggest an alternative test statistic for the individual genes when there are other covariates such as gender or age which might influence the expression levels. in essence, this test statistic is based on fitting a linear model where the gene expression is the response and the phenotype and other covariates are the independent variables.

a similar approach was proposed by  <cit>  who additionally incorporate a measure for co-expression in the gene sets, the mean of the pairwise correlation coefficients, and a measure for the distinctiveness of the sets based on a nearest neighbors classifier.

in their paper,  <cit>  also propose a bayes approach for the investigation of gene set enrichment. the procedure is somewhat similar to the two groups empirical bayes model described in  <cit> . another issue addressed by  <cit>  is the potential overlap of gene sets. they also investigate dimension reduction  to find gene sets with co-regulated genes.

parametric method
another very simple approach to detecting gene set enrichment is page  suggested by  <cit> . essentially, this approach proceeds by averaging over fold changes or other gene-level statistics and comparing this test statistic with the standard normal distribution. since the approach is fully parametric and because no permutation is required this procedure is very time saving and computationally efficient. using the normal approximation is justified by  <cit>  via asymptotic arguments. in a similar fashion, the "category" averaging approach  <cit>  also employs  a normal approximation for significance assessment.

random-set method
newton et al.  <cit>  aggregate some ideas from the averaging methods, the parametric models, and the  <dig> ×  <dig> table methods. instead of only counting the number of differentially expressed genes present in the gene set, as done when applying  <dig> ×  <dig> table methods, they allow for more general test statistics similar to the es introduced by  <cit> . however, they do not apply sample label permutation to assess significance but consider the genes to be the sampling units.

starting with the measures of differential expression sj, j =  <dig>  ..., n for each gene, an unstandardized score for a gene set s consisting of m genes is calculated as the average of the gene scores of these genes

 x¯=1m∑gj∈ssj. 

as the method aims to compare the enrichment in a gene set s with the enrichment of all other  distinct randomly drawn gene sets of size m, a so called random-set model is introduced. that means that the gene set s is now considered as a random collection of m genes whose scores sj are fixed. for most choices of the gene-level statistic, the exact distribution of x¯ becomes intractable.  <cit>  propose to approximate it with the normal distribution with mean and variance as follows:

 μ=e=1n∑j=1nsjσ2=var=1m. 

the score can then be standardized with these two quantities, resulting in the test statistic

 z=x¯−μσ. 

under the null hypothesis of no enrichment, z is approximately normally distributed with mean zero and unit variance.

a false discovery rate-based method
another approach to enrichment analysis is presented by  <cit> . this procedure is based on estimating the false discovery rate  of a gene conditional on belonging to a given gene set. in this analysis two subgroups of genes are considered – the genes in the gene set and the rest of the genes – and a mixture model for computing false discovery rates is fitted separately to these two subgroups. in addition, the false discovery rate is also computed without consideration of subgroups.

efron  <cit>  showed that the conditional local fdr and the unconditional local fdr are linked by the simple relation

 fdrs=fdr⋅πs0πs, 

where πs <dig> is the probability for a null case of being in s given that its z-value is equal to z. πs  is defined analogously.

in this framework the null hypothesis of no enrichment corresponds to the statement that fdrs  is equal to the overall fdr, implying that the genes in s do not behave differently compared to all the n genes together. if the set is enriched, then fdrs  will be smaller than fdr for very large  z-values indicating differential expression in the set. note that this assumes that the densities for the non-expressed genes are the same for the genes in s and those in s¯  = fs¯0).  <cit>  describes a corresponding test based on logistic regression.

global and multivariate procedures
globaltest
goeman et al.  <cit>  approach the problem of enrichment analysis from the perspective of class prediction. they point out that if the gene set is associated with the phenotype, then its constituents will have different expression patterns in the two types of the response and thus will serve as reliable predictors for the clinical outcome. testing for enrichment can therefore be done in the framework of generalized linear models. let y be the vector of the phenotypes of the n samples. for simplicity it is assumed that y only takes the two values  <dig> and  <dig> for the two phenotypes although in this setting y could also be continuous, for example the survival time of a patient. furthermore, let x =  be the n × m matrix of expression patterns of the genes, where m is the number of genes in the gene set under investigation and n is the number of samples. in a generalized linear model, the influence of the gene expression on the phenotype can be modeled as

 e=h− <dig>  

where βj is the regression coefficient of gene gj, α is the intercept and h is the link function. this can for example be the identity or the logit function, resulting in a simple linear model or a logistic regression model respectively. if the set is not enriched, then the genes do not have a predictive potential. hence, a null hypothesis for the enrichment problem is

 h <dig> : β <dig> = β <dig> = ... = βm =  <dig>  

however, the size of the gene set may be quite large, so that m is greater than n. in this situation, the hypothesis above cannot be tested in the usual way. the solution proposed by  <cit>  is to assume that the regression coefficients all follow the same distribution with mean zero and a common but unknown variance τ <dig>  then the test problem can equivalently be expressed as

 h <dig> : τ <dig> =  <dig>  

goeman et al.  <cit>  develop a corresponding score test called "globaltest". it is particularly powerful for alternative hypotheses where all the βj are not equal to zero but do not deviate too much from the null hypothesis either. thus, the globaltest seems very useful with regard to the underlying biological question about whether the set of genes as a whole influences the phenotype, i.e. whether or not a large proportion of the genes in the set have a moderate influence on the response.

we note that the globaltest is implemented assuming a diagonal covariance matrix. this means that the genes are considered to be uncorrelated and the test statistic can therefore be expressed as the average of the gene-wise test statistics for the individual genes. thus, the method is comparable to the averaging procedures that first calculate a score for each gene and then summarize these scores for each set.

globalancova
the linear model can also be used for enrichment analysis when the roles of gene expression and phenotype are exchanged. this was shown by mansmann and meister  <cit> . the authors call their method globalancova, referring to methods for the analysis of covariance. as the globaltest, the procedure of  <cit>  does not explicitly model the correlation structure in the gene set when constructing the test statistic as a combination of gene-wise models. however, the correlation structure is still implicitly maintained because of the use of the sample permutation procedure. furthermore, a refined follow-up model allows for the explicit inclusion of an estimated correlation matrix  <cit> .

hotelling's t2-test and related methods
other procedures for gene set enrichment analysis which are also directly based on the gene set information can be derived from the well-known multivariate extension of the t-test, the hotelling's t2-test. the corresponding test statistic is

 t2=t−1=ttr−1t, 

where x¯ <dig> and x¯ <dig> are the mean vectors of the gene expressions in the set for the two phenotypes, and n <dig> and n <dig> are the sample sizes in both groups. s is the pooled empirical covariance matrix of the genes in the set, and r is the corresponding correlation matrix. with t we denote the vector containing all local two-sample equal variance t-statistics. note that as a weighted sum of the gene-wise t-statistics hotelling's t <dig> explicitly incorporates the dependence structure among the genes – unlike most other test statistics for gene set enrichment.

under the null hypothesis that the mean vectors in both groups are equal, n−m−1⋅mt <dig> follows an f distribution with m and n - m -  <dig> degrees of freedom, where m is the gene set size. however, in the analysis of gene expression data it is rarely the case that the number of samples is greater than the number of genes in the set, so the above procedure needs to be modified appropriately.

kong et al.  <cit>  propose to use dimension reduction by means of singular value decomposition. in effect, their approach amounts to using the moore-penrose pseudoinverse for inverting the singular empirical covariance matrix in the definition of hotelling's t <dig> 

another hotelling-like statistic can be found in  <cit> . these authors substitute the usual t-statistic with the sam statistic  <cit> 

 dj=x¯j1−x¯j2sj+s <dig>  

where s <dig> is a regularizing constant, and assume a diagonal correlation matrix. this leads to the sam gene set  statistic

 sam-gs=∑gj∈sdj <dig>  

for a gene set s. significance is assessed by permuting sample labels.

a further possibility is to substitute the empirical covariance matrix in the hotelling t <dig> statistic with a more efficient estimator. this is important if the sample size is small  <cit> .

further procedures
rahnenführer et al.  <cit>  present procedures to investigate enrichment whilst taking into account known pathway structures and co-regulations of gene sets. adewale et al.  <cit>  extend the approach of  <cit>  to account for diverse phenotypes including survival and count data. lewin and grieve  <cit>  developed special methods considering the connections between gene sets derived from the graph structure of the gene ontology  <cit> . procedures to infer the enrichment of gene-gene and gene-protein networks have been presented by nacu et al.  <cit> .

läuter et al.  <cit>  describe a procedure for detecting gene set enrichment and the simultaneous selection of suitable gene sets. this utilizes an exact high-dimensional multivariate spherical test  <cit> . note that in this procedure the gene sets are not fixed a priori, but are chosen according to the correlation among genes. as gene set statistic a weighted average of univariate beta statistics is employed.

edelman et al.  <cit>  present an approach similar to the gsea of  <cit> . a key feature of their method is that it is constructed to measure the enrichment of gene sets in individual samples. this aims at investigating the variation of the activity of functional groups of genes in the population so that the expression profile of relevant gene sets can be used for predicting the phenotype of an individual. as local test statistic the log-likelihood ratio is used.

