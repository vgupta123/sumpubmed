BACKGROUND
methods for statistical analysis of gene expression microarrays are maturing rapidly, and there are a variety of approaches to normalization, detection of differential expression, clustering, and class prediction  <cit> . in many experiments, a statistical test is performed to identify genes significantly associated with experimental condition, clinical response, or other sample attributes. the resulting list of significant genes may be so large that it defies easy interpretation, and it is natural to seek a concise, biological summary of results. one such approach is gene set testing , which detects over-representation of gene sets among the list of significant genes. gene sets may be curated  <cit> , or derived from databases such as gene ontology   <cit>  or kyoto encyclopedia of gene and genomes   <cit> .

the simplest approach to gene set testing relies on  <dig> ×  <dig> tables of gene set membership  vs. significance . gene set testing is often performed using a χ <dig> or fisher's exact test  <cit> , which rely critically upon the assumption that individual genes, and their associated test statistics, are independent, hereafter referred to as the independence assumption  <cit> . many software tools use independence assumption methods  and these tools are employed by the majority of publications using gene set testing . however, independence of genes is a false assumption for expression microarrays: indeed, correlation forms the basis for informative techniques such as hierarchical clustering  <cit> . several authors have noted, via simulation or analysis of a few experimental data sets, that correlation adversely affects the selection of significant gene sets  <cit> . investigators who have recognized this problem employed resampling-based approaches that maintain the correlation structure of the expression data and produce an empirical estimate of gene set significance  <cit> . resampling approaches have also been integrated into many software tools to address this problem  <cit> . nevertheless, the use of independence assumption-based methods continues to increase .

as the independence assumption is clearly violated for gene expression microarrays  <cit> , how can we explain the persistent use of independence methods? independence assumption methods may appeal to the belief that the occurrence of multiple members of a gene set on a list of significant ones "cannot be due to chance." indeed, in a post-hoc interpretation, the fact that the genes within a set are correlated is often, incorrectly, viewed as reinforcing the biological plausibility  <cit> , despite evidence presented here and elsewhere that the presence of correlation increases false-positive rates. it is conceivable to argue that correlation within a gene set itself provides additional information, if such correlation varied substantially across different experiments. however, as we show here, correlation within a gene set is largely a persistent property that is preserved across a wide variety of sample sources and experimental conditions.

here, we clearly demonstrate that the correlation between genes inflates the false positive rate, that the magnitude of this inflation is quite high, and that a simple resampling method for gene set testing produces the correct false positive rate. we use a large number  of real experimental datasets, not simulated data, to show that 1) inter-gene correlation is a pervasive feature of gene sets, regardless of experimental condition, 2) inter-gene correlation inflates the apparent significance of gene set statistics, leading to an increase in false positives, and 3) array resampling approaches can correctly address the problem of inter-gene correlation. as there are several existing tools that use resampling approaches to determine functional enrichment among significant gene lists, we argue that the naïve approaches should no longer be used and should be replaced by tools employing a resampling approach.

RESULTS
we investigated the degree to which correlation within gene sets is preserved across multiple experiments by analyzing gene expression omnibus  <cit>  data from two human , and two mouse  arrays. datasets with  <dig> or more samples were used, resulting in  <dig> datasets and  <dig>  arrays. for each dataset we calculated the mean correlation for genes within each go category or kegg pathway. the results give strong evidence of the reproducibility of internal correlations , with strong agreement of gene set correlations between platforms  . correlation within gene sets is thus closely associated with gene set membership, regardless of experimental condition  <cit> . the samples represent a wide variety of experiments, including in vitro cell lines, sex comparisons, multiple cancer sub-types, tissues, and diseases. clearly, in contrast to previous assertions  <cit> , mere correlation of genes within gene sets and pathways is commonplace, and does not necessarily reflect unique features of the experiment at hand. as figure  <dig> shows, correlation within gene sets covers a wide range, and is generally higher than correlation of randomly selected genes. the correlations within gene sets are much higher than the correlation of all transcripts on each platform with each other . of course, genes from different sets can be correlated , but we confine our focus here to pre-defined gene sets.

one simple way to describe the effect of correlation is through a standardized enrichment test statistic. let z be the signed square root of the independence assumption χ <dig> statistic . under the null hypothesis , z should have approximately mean  <dig> and variance  <dig>  however, the true variance can be much greater, with an increase proportional to ρ , where m is the number of genes in the set, and ρ is the average correlation among genes in the set . independence assumption methods assume ρ =  <dig>  implying that the variance equals  <dig>  however, if the average internal correlation of a gene set is positive, then the variance of z can be greatly inflated, even if this correlation is modest, depending on the gene set size m.

to empirically demonstrate that variance inflation results in the false significance of gene sets, we randomly permuted the sample labels associated with each of the  <dig> gene expression omnibus data sets  <dig>  times, and then performed a gene set analysis on each permutation using a common independence assumption method. for each permutation a list of "significant" genes with p ≤  <dig>   was created in order to have a meaningfully-sized gene list, and the standard χ <dig> statistic was used to assess the significance of each gene set. a gene set was called significant if it had a bonferroni-corrected  χ <dig> p-value ≤  <dig> . note that this is a highly conservative threshold, intended to guarantee that no more than 5% of the permutations result in one or more gene sets  called significant. the gene set null hypothesis is that each gene set has the same pattern and proportion of differentially expressed genes as any other set  <cit> . permutation of the sample labels induces the null hypothesis for each gene, and thus no gene sets should exhibit enrichment for differential expression. hence, any gene set declared significant is a false positive.

to determine the overall experiment-wise increase in false positives, we counted the number of permutations in which at least one gene set was declared significant, using the bonferroni-corrected  <dig>  threshold. if the independence assumptions were true, no more than 5% of the permutations would give rise to significant gene sets. however, the observed proportion is much higher . false positive rates often exceed 50%, and in some cases are above 80%, and are even higher when the false discovery rate  is used as a multiple comparison correction. clearly such high false positive rates have serious implications for the conclusions drawn by any study which uses independence assumption methods to provide biological interpretation of microarray data.

in addition, as predicted, we found that variance inflation is directly related to the false-positive rate for a gene set. for each go biological process  or kegg pathway , we show that the empirical variances of the standardized enrichment statistic  are highly correlated with the per-category false positive rates. specifically, for each gene set, we calculated the variance of the square root of the χ <dig> statistic across all permutations, and plotted it against the number of permutations in which that gene set was called "significant" using a bonferroni correction.

fortunately, the shortcomings of independence assumption methods can be addressed through the use of resampling-based methods. these methods use the resampling data to construct an empirical null distribution for the gene set test statistics, taking into account the correlation structure between genes and providing a more accurate assessment of statistical significance. several existing tools use resampling based approaches  <cit> , either permuting sample labels relative to gene expression, or performing bootstrap resampling  <cit> . we empirically investigated the performance of the permutation approach, which we will refer to as "resampling" to avoid confusion with the permutations described above. the sample labels for each data set were resampled without replacement  <dig>  times, and the resulting enrichment statistic distribution was used to obtain an empirical p-value for each gene set. for example, if the observed enrichment statistic for a gene set was greater than or equal to 99% of the resampled enrichment statistics, a p-value of  <dig>  was assigned to that gene set. as the resampling units are entire arrays, correlation between genes is maintained under resampling. therefore the effects of correlation within gene sets apply to both the resampled and observed data, properly controlling the false positive rate. to demonstrate that the resampling approach correctly controls the false positive rate, we applied the resampling procedure to all permutations of all  <dig> datasets, using the same χ <dig> statistic as above. using the empirical distribution of test statistics under resampling to generate the gene set p-value, proper control of the false positive rate was obtained .

while the analyses above clearly show that gene correlation increases the false positive rate for independence assumption methods, it may be tempting to argue that correlation does not affect false positive rates in real datasets, which presumably include true enrichment. to investigate this, we computed the proportion of observed datasets in which each gene set was declared significant by the independence assumption method, and compared these values to the previously generated proportions observed under random permutation. the results for go biological process categories  and kegg pathways  demonstrate a strong relationship. in other words, categories declared statistically significant by independence assumption methods in actual datasets are often declared significant when treatment assignments are made purely at random. this strongly calls into question the biological conclusions drawn from such analyses, as we have demonstrated that such correlation is a predominant source of misinterpretation, rather than a biological confirmation. indeed, some gene sets have such high false positive rates  under independence assumption that one or more sets may be found significant in multiple studies, further enhancing apparent biological confirmation.

discussion
the most straightforward strategy for gene expression analysis is to focus on individual genes for which expression differs among samples of interest. such approaches often consider the genes selected based on significance thresholds, with the goal of predicting or finding associations with disease prognosis  <cit> , adverse response to a chemical  <cit> , disease pathogenesis  <cit> , or identification of key genes in a pathway that may serve as biomarkers  <cit> . although useful, gene-by-gene analyses may not account for the complex underlying biology where the transcriptional programs are distributed across an entire network of genes, and may involve only subtle changes among individual genes. even for gene-by-gene analysis, the presence of strong correlations is increasingly recognized as a potentially complicating feature. for example, surrogate variable analysis  <cit>  attempts to reconstruct latent variables which explain variation in gene expression, which rely on gene-gene correlation in an essential manner.

gene set testing, in which enrichment of significant differentially expressed genes is sought among gene sets, is by now a standard method to provide biological interpretation for gene expression data. groups of genes with a common biological function, cellular localization, regulation, or chromosomal location may hold additional clues regarding underlying biology, or potentially improve prediction or classification. while many easy-to-use tools have been developed to facilitate pathway- or gene set-based analysis, inter-gene correlation within gene sets violates the independence assumption that underlies many gene set analysis methods. indeed, our meta-analysis demonstrates that the correlation patterns persist across a wide variety of mouse and human experiments. thus, we argue that correlation patterns should largely be viewed in terms of their effects on false positives, as we find no evidence that correlation within the gene set confers additional plausibility to a gene set finding.

though it may be viewed as a technical matter, violation of the independence assumption is not a mere statistical detail. it is a tangible phenomenon that increases the chance of falsely declaring a gene set significant. the false positive rates established by our study are very high - sometimes an order of magnitude beyond the intended false positive rate. array resampling methods correctly handle inter-set correlation and are not subject to these high false positive rates. barry et al.  <cit>  describe investigations of power and provides context on the meaning of type i error control for resampling-based methods. the null distribution induced by permutation here is a special case of the expanded definition in  <cit> , because the null hypothesis holds for each gene. bootstrap resampling methods were shown in  <cit>  to have more power than array permutation methods in simulated and real data sets, and expansions beyond the existing resampling approaches are worthy of investigation. there are a wide number of available packages that implement these methods, such as gsea  <cit> , catmap  <cit> , safe  <cit> , erminej  <cit> , and sam-gs  <cit> .

several methods have been proposed which use multivariate modeling of array data to perform gene set testing  <cit> . although comparisons using such approaches were not a main focus, we briefly tested whether these methods correctly control the false positive rate, by permuting the sample labels for one data set   <dig>  times and counting the number of permutations in which at least one go bp category was called significant using a 5% fdr. the globaltest procedure  <cit>  uses a score-based test statistic to test for correlation of an entire set of genes with clinical outcome, and can be used for gene set testing. the parametric version of globaltest incorporates the observed correlation structure, and is compared to a χ <dig> distribution. however, we found that 94% of permutations called at least one go bp category significant, with a median of  <dig> categories called significant in each permutation, suggesting difficulties in proper control of the false positive rate. it is worth noting that use of empirical covariance estimates is extremely challenging, especially when gene sets are larger than the sample size. globalancova  <cit>  fits a linear model between each gene and the experimental covariates, and uses permutation testing to obtain empirical p-values. we found that globalancova found no significant go bp categories under permutation, suggesting that globalancova properly controls the false positive rate, and is perhaps conservative. several related methods have been proposed  <cit>  that test for differential expression or predictive ability of sets of genes. many of these approaches attempt to incorporate gene-gene correlation structure parametrically, and are thus computationally appealing. however, until more comprehensive investigations have been performed for the multivariate procedures, it seems prudent to examine the false positive rate in  <dig>  permutations of their data before accepting the results at face value. other investigators have explored more complex procedures involving stochastic dependence  <cit> , while deeper explorations of random-set methods  <cit>  may be valuable, but still essentially rely on independence assumptions. several other methods are reviewed and compared in  <cit> . in summary, despite the availability of software and a wide array of methods that address inter-gene correlation, the literature on microarray analysis is rife with studies that use independence assumption methods.

as the use of independence assumption methods in gene array studies is widespread, we conclude that published false gene set findings may be common. the precise impact of the overly optimistic statistical support for many gene set findings is difficult to assess, because we do not know the underlying truth; however, a basic requirement of a valid statistical test is that it controls false positives under the null hypothesis, and we have clearly demonstrated here that methods that rely on independence assumptions are therefore invalid in this sense.

it should be acknowledged that very small microarray studies may have too few samples to support permutation. for such studies, a strong statistical result from an independence assumption-based method should be supported by corroborating biological evidence, and even then be interpreted with caution.

CONCLUSIONS
here, we have demonstrated, using over  <dig> real experimental data sets that independence assumption methods for gene set enrichment suffer from such a high false positive rate that they should not generally be used. array resampling methods, which correctly control the false positive rate, should be used by investigators, incorporated into existing routines and workflows, and insisted upon by reviewers of scientific manuscripts. we strongly encourage the use of tools such as gsea  <cit> , safe  <cit> , catmap  <cit> , erminej  <cit> , sam-gs  <cit>  or others which employ resampling-based methods to determine gene set significance.

