BACKGROUND
although genome-scale expression experiments are performed routinely in biomedical research, understanding the data they generate remains a major challenge. a widely used approach to relate such data to biology is gene set enrichment analysis <cit> . this shifts focus from the regulation of individual genes to the regulation of gene sets, i.e. pre-defined sets of genes that share a common biological function or feature such as chromosomal location. one motivation for the approach is that if genes in a set are closely related, they can be expected to have similar expression patterns, and exploiting this may increase power. another is that analysis at the level of individual genes may often be difficult to interpret biologically, whereas higher-level analyses hopefully allow a more coherent picture of the involved biological processes to emerge. many methods of gene set enrichment analysis have been proposed  and there exists a burgeoning literature on the topic. very commonly, gene sets are defined on the basis on gene ontology  <cit>  or pathway membership  <cit> , using resources such as the kyoto encyclopedia of genes and genomes  <cit> .

recently there has been intense interest in methods that build on the information in biological networks, that is to say, methods that exploit the topology rather than just the set of genes in the network. we briefly summarize some of the methods proposed.

one approach extends gene set enrichment analysis by defining scores that build on network topology. for example, gene set scores that can be expressed as sums of pairwise weights between genes in the set may be modified by weighting gene pairs by the inverse of their path distance in the network  <cit> . significance tests using the scores are then constructed, to assess whether the pathway is regulated. similarly, scores that take the proximity of differentially expressed genes in the pathway into account have been proposed  <cit> .

another approach makes explicit use of network models for the expression data. in  <cit> , fold changes are discretized into two levels: differentially expressed or equally expressed, and a markov random field model  for the fold changes whose parametrization utilizes pathway topology is adopted. bayesian inference is used in which prior distributions for the parameters are assumed and posterior distributions derived using gibbs sampling. these are used to identify differentially expressed genes. a similar approach has recently been proposed to relate genes/markers to disease for genome-wide association studies  <cit> . as an alternative to gibbs sampling, which is computationally intense, the bayesian score criterion  <cit>  can be used as an approximation to the posterior probability of the network, and the significance of the pathway may be assessed on the basis of a randomization test of the score  <cit> .

an alternative network-based approach  <cit>  represents a network as a directed acyclic graph to which a latent variable  for each gene representing its baseline level is added, allowing a mixed effect model for the expression levels to be derived. this allows inference to be based on linear mixed effect model techniques. for example, tests of treatment effect on a node set can be derived as wald tests, making use of standard approximation methods.

methods exploiting pathway structure have also been proposed for other, related purposes. for classification, knowledge of an undirected gene network has been used to develop classifiers of gene profiles by performing a spectral decomposition of the expression profiles with respect to the eigenfunctions of the graph  <cit> . for prediction, a modified lasso algorithm using a penalty function that takes pathway structure into account has been proposed  <cit> . similarly, a modified boosting algorithm which incorporates the pathway structure has been proposed  <cit> .

in the following section we describe a simple way to incorporate a known network or pathway into the analysis of gene expression data. this entails augmenting the network with a discrete node, representing the treatment or class variable. we show that this leads to a simple modification of conventional differential expression analysis. the augmented network contains a discrete as well as multiple continuous  nodes: networks containing both types of node are usually called hybrid networks. with a few recent exceptions  <cit> , hybrid networks have been little used in network biology. they may be useful, for example, when modeling expression data from comparative experiments  or when seeking to integrate such data into a wider biological context . since hybrid networks may be unfamiliar to some readers we describe the framework carefully in the next section, but stress that no novel theory is involved.

methods
the model framework
we suppose that data from a gene expression study are available, in the form of an n × p data matrix x = {xg : g ∈ v}, where n is the number of observations and v is a set of p genes, together with an n× <dig> vector t containing the treatment group information. the key assumption we make is that the steady state  distribution of the gene expression levels follows a given bayesian network model, specified in the form of a dag  g=v,e, where e is a set of directed edges between the nodes in v. this network is assumed to have been obtained from external sources, as we illustrate below.

under such a model, the joint distribution of the data x = {xg : g ∈ v} factorizes into a product of conditional distributions 

  f=∏g∈vfxg|xpag 

where pagg is the parents of node g ∈ v in g, that is, the set of nodes with an arrow to g in g. one of the strengths of bayesian network methodology is the freedom to use any univariate models for the conditional distributions. in this paper we assume gaussian models, in which the conditional distributions are linear regressions of xg with covariates given by the variables xpag: the gaussian assumption is not critical for the approach, as we further discuss below.

another strength of the methodology is the ability to read from the graph which conditional independences hold under the model, using the property of d-separation  <cit> . for disjoint variable sets u, v, w ⊆ vwe write 

 xu╨xv|xw 

 to mean that xu and xv are conditionally independent given xw.

to model the effect of the treatment or class variable t, we add a node labeled t to v, and suppose that the treatment directly affects a set of genes vt⊆ v. thus we consider dags of the form

 g= 

 where et is a set of additional edges of the form  for g∈vt. we suppose that the object of the analysis is to find  vt.

we assume that ge defines a bayesian network model for . since ge contains both discrete and gaussian nodes, it is a hybrid bayesian network  <cit> . from  we have that 

  f=∏y∈v∪{t}fxy|xpag=f∏g∈vf) 

comparing  with  we see two changes: firstly, a term f=pr is introduced. since we usually condition on t this term is of little interest. secondly, for those genes g in vt we need to let the conditional distribution of xgdepend on xt as well as xpag. the simplest way to do this is to include an additive treatment effect term, corresponding to a simple shift in the conditional distributions, so that the coefficients of the remaining covariates xpag do not depend on the treatment. this implies that the treatment may affect the mean gene expression values but not their covariances. in some applications it may be more appropriate to let the coefficients vary by treatment, by specifying treatment by covariate interactions, but in the following we assume additive treatment effects.

maximum likelihood estimates under the model  can be obtained by maximizing the likelihood for each factor separately: since these are all standard models, this is easily done. the likelihood ratio test  statistic for testing ge <dig> under ge <dig> when e0⊆e <dig> is  <dig>  where l^ <dig> and l^ <dig> are the maximized log-likelihood values under ge <dig> and ge <dig>  under ge <dig> the deviance has an asymptotic χf <dig> distribution where f  is the difference in the number of parameters of the two models.

an important special case occurs when e0and e <dig> differ by one edge only, say t →g. observe that in , removing  only affects the component f). thus a test for the removal of the edge t → g from ge <dig> is a test of 

  xg╨xt|xsversusxg╨xt|xs 

where s=pagg. that is, it is a test of the hypothesis, say hg, that xg is conditionally independent of xt given the parents of g in g. it is natural to evaluate such a test in the conditional distribution of xg given xs∪{t}. this follows a linear regression model for xgwith covariates xs and a discrete term for xt, and so to test hg we test whether the coefficient of the discrete term are zero in this model. this is a classical f-test  which is valid in small samples under the usual distributional assumptions. since it does not depend on which other edges are in e <dig>  we can associate each edge t →gwith an f-test. this is in contrast to, for example, variable selection in linear models where evidence for the presence or absence of a term depends on which other terms are taken to be present in the model.

testing the conditional independence of each gene and treatment, given the parents of the gene in the network can be regarded as a simple modification of conventional methods for differential expression analysis that are based on tests of marginal independence between treatment and genes. to compare and contrast the conditional and marginal approaches, consider the two models relating a treatment t to the expression levels of two genes, g <dig> and g <dig> shown in figure  <dig>  conditioning increases power when there is a direct treatment effect, and reduces type ii error when there is an indirect but no direct effect, so making the inference more precise.

note also that the marginal approach can be regarded as the special case of the conditional approach that occurs when g=, so that pag=∅ for all g∈v.

since multiple hypotheses are tested, use of conventional significance level thresholds would inflate the false positive rate. many approaches to correct for multiplicity are available  <cit> . when the number of genes in the network is large, control of the false discovery rate may be desirable. however, when the number of genes is small, most methods for control of false discovery rate perform badly  <cit> , and other methods have been suggested  <cit> . one option is to use a classical multiple test procedure such as holm’s step-down procedure  <cit> , as we illustrate in the next section.

RESULTS
in this section we describe two applications of the method.

hepatotoxicity and the ppar pathway
here we describe the analysis of data taken from a hepatotoxicity study in rats  available from the gene expression omnibus  <cit> , a public data repository under the auspices of the national center for biological information. the study has id gse <dig> 

the stated objective of the study was to use microarray gene expression data acquired from the liver of rats exposed to hepatotoxicants to build classifiers for prediction of liver necrosis. in the study  <dig> rats were exposed to one of eight compounds . all eight compounds were studied using standardized procedures, i.e. a common array platform , experimental procedures and data retrieving and analysis processes. for each compound, four to six male,  <dig> week old f <dig> rats were exposed to a zero dose, low dose, mid dose or a high dose of the toxicant and sacrificed at  <dig>   <dig> or  <dig> hrs later. at necropsy, liver was harvested for rna extraction, histopathology, and clinical chemistry assessments.

for simplicity we use the subset of data from the study pertaining to  <dig> -dichlorobenzene, and compare active with control treatments . the preprocessing steps are described on the geo website. in all there were  <dig> arrays in the subset:  <dig> animals were in the control group, and  <dig> animals were exposed to active drug.

peroxisome proliferator-activated receptors  are a group of nuclear receptor proteins that function as transcription factors, playing essential roles in the regulation of cellular differentiation, development, and metabolism of higher organisms. several types have been identified, denoted ppar-α, ppar-δ and ppar-γ. the signalling pathway controlling the expression of the ppars and their targets has been well-studied. we are interested in studying the effects of the hepatotoxicant on this pathway.

we obtained a copy of the kegg  <cit>  ppar signalling pathway for rattus norvegicus using the spia package  <cit> . all edges correspond to transcription factor/ target gene relations. excluding genes that are not present on the array, we obtain a dag with  <dig> nodes and  <dig> edges, which is used in the analysis.

to examine the effect of treatment on the network, the network-based tests of xt⊥⊥xg|xpa for each gene g were compared to marginal t-tests, that is, of xt ╨ xg. in both cases, to correct for multiplicity we use holm’s step-down procedure  <cit>  to obtain simultaneous  p-values, denoted {pg~,g∈v}. if we reject precisely those hypotheses hg for which p~g<α, the family-wise error rate is controlled, i.e. the probability that this procedure results in any false rejections is less or equal to α. this is true irrespective of which hypotheses in h={hg,g∈v} are true or false. here false rejections equate to false edge inclusions. this is a cautious approach, that aims to identify the edges which are certainly present in e: see  <cit> .

using the network-based tests, p~< <dig>  for seven genes, but none using the marginal tests. figure  <dig> shows the augmented ppar pathway showing the seven genes affected by treatment. using the same criteria, the marginal analysis detects no treatment effects. thus in this example, conditioning on the parents of each gene in the network results in a substantial increase in power.

the effects of smoking
here we describe the analysis of data taken from a study of the effects of cigarette smoke on the human oral mucosal transcriptome  <cit> . these are available from the gene expression omnibus  <cit> : the study has id gse <dig>  in all  <dig> current smokers and  <dig> age- and gender- matched never smokers participated in the study, the primary objective of which was to determine the effects of smoking on gene expression in oral epithelial cells. one subject was excluded from the analysis due to poor data quality. for further information on the study and data preprocessing we refer to  <cit>  and  <cit> .

here we use the data to characterize the effect of smoking on gene expression, making use of a global transcription network constructed using information on human transcription factors  and their putative target genes  obtained from the transfac database  <cit> . using the gseabase package  <cit>  we downloaded data on  <dig>  pairs for in all  <dig> putative tfs and  <dig> putative tgs. of these, the expression levels of  <dig> genes were recorded in the gse <dig> study. the  pairs for these genes generate a directed graph, say g <dig>  with  <dig> nodes , and  <dig> edges. since some tfs are targets of other tfs, g <dig> contains cycles. the subgraph g <dig> of g <dig> induced by the tfs has  <dig> nodes and  <dig> edges. we derived an acyclic subgraph of g <dig> by omitting edges with the least strength of evidence, in the following way. to derive a measure for the strength of evidence for each edge in g <dig>  we fit a linear regression model for the expression of each gene, including its parents in the network as covariates, and use standard significance tests for zero coefficients as a measure of strength of evidence. starting with the null graph we added edges, ordered in terms of decreasing strength of evidence , that do not generate cycles. this resulted in an acyclic subgraph of g <dig>  say g <dig>  with  <dig> nodes and  <dig> edges. we then added the nodes and edges in g <dig> but not in g <dig> to g <dig>  resulting in a dag, say g, with  <dig> nodes and  <dig> edges.

we applied the method to g, correcting for multiplicity using the method of  <cit> . figure  <dig> compares the adjusted p-values from the analysis with the corresponding adjusted values from the marginal analysis not exploiting the network topology. clearly the conditional tests have substantially greater power. the numbers of genes satisfying the false discovery rate at 1%,  <dig> % and 5% were  <dig>   <dig> and  <dig> respectively. in comparison, for a marginal analysis the corresponding numbers were  <dig>   <dig> and  <dig> 

it is instructive to relate the differentially expressed genes to the network topology. for purposes of illustration we consider the  <dig> genes that satisfy the false discovery rate at  <dig> %, of which  <dig> are transcription factors. the subnetwork of g induced by these  <dig> genes has one connected component with  <dig> genes, the remainder being isolated nodes. figure  <dig> displays the connected subnetwork, which contains all  <dig> transcription factors. thus the analysis has identified a highly connected transcriptional module that is strongly affected by smoking.

discussion
we have described a simple way to exploit network information in the analysis of gene expression data, using tests for the conditional independence of each gene and treatment given the parents of the gene in the network. this method can be regarded as an extension of conventional methods of gene expression analysis, that takes the network structure into account. we demonstrated using two examples that the method can result in a substantial increase in power.

in a related approach to the analysis of genetics of gene expression data  <cit> , when relating a marker to the expression of a gene, all expression levels were considered as potential regressors; model selection methods were used to choose the regressors for each marker-gene pair. this is in contrast to the method proposed here, in which an external biological network determines the regressors. we remark that if the regressors for a gene under study include some that are causally downstream of the gene, this may dilute or remove evidence of a direct marker effect on the expression of the gene.

as described above, some authors  <cit>  incorporate a dichotomous treatment into a network by letting the network nodes represent discretized fold changes rather than expression levels. we prefer our approach for several reasons. firstly, the use of fold changes does not appear to be biologically motivated. for example, as we discuss below, it is expected that the mrna abundance of a transcription factor affects the mrna abundance of its target genes, but there seems no reason for this to be true for the corresponding fold changes. secondly, our framework allows direct and indirect treatment effects to be distinguished, and thirdly, it may easily be extended to handle multiple treatment variables, although we do not consider such extensions here.

the approach builds on some assumptions that may or may not be unwarranted. the key assumption is that the steady state distribution of the gene expression levels follows a given bayesian network. gene regulation is extremely complex and as yet imperfectly understood, so such an assumption can at best be tentative. we have illustrated the approach using two networks, one based on a signalling pathway and the other constructed using transcription factor/target gene data. biochemical pathways represent phenomena occurring at the protein level, which are not necessarily reflected at the transcript level: see figure  <dig>  thus caution is required when using such pathways as models for gene expression data.

as we have described the method, it assumes that the expression data are gaussian distributed, but this is not critical. expression data from microarrays are typically taken to be gaussian after log transformation  <cit> . other technologies such as rna-seq generate discrete count data that are better modeled using poisson or negative binomial distributions  <cit> . this can be handled in the current framework by using the appropriate univariate conditional models in . what is essential in our context is the availability of an appropriate test for , that is, for the conditional independence of treatment and the level of expression of a gene, given the expression levels of its parents in the network. if the correct form of the conditional distribution is in doubt, a permutation test may be used.

an assumption, implicit in both the marginal and the network-based analyses, is that the treatment variable is causal rather than reactive in respect to the gene expression data. ideally the treatment should represent a randomized intervention, allowing secure causal interpretations, but gene expression studies are rarely randomized. in poorly designed studies, treatment allocation may be confounded with other factors  <cit> . when this is true, the interpretation of edges t  →  gas representing effects of treatment is compromised. the hepatotoxicity study described above is an example of a well-designed study in which treatment represents an non-randomized intervention that is orthogonal to other sources of variation. it is reasonable to interpret treatment effects as causal in such studies. in observational studies, such as the study of the effects of smoking described above, allocation to treatment group  could in principle be determined by factors that also influence gene expression, so jeopardizing the interpretation of edges t →  gas treatment effects. in the actual study, however, it is natural to interpret edges in terms of the effects of tobacco smoke on epithelial cells.

similar remarks apply to the use of the terms direct effects and indirect effects: a causal interpretation of these may be unwarranted.

finally, it is assumed that the treatment affects the parameters of the network but not its topology. in some applications this may not be appropriate. for example, interventions affecting chromatin structure may alter the accessibility of dna binding sites and hence patterns of regulatory control due to transcription factors.

CONCLUSIONS
a straightforward way to exploit network information in the analysis of gene expression data is to assume that the network models the steady state distribution of the gene expression levels, and that the treatment affects the parameters but not the topology of the network. in this framework, genes whose expression is directly affected by the treatment may be identified using tests for the conditional independence of each gene and treatment given the parents of the gene in the network. this method can be regarded as an extension of conventional methods of gene expression analysis that takes network structure into account. it is simple to implement, gives rise to substantial power gains, and may give insight into the biological processes involved.

competing interests
the authors declare that they have no competing interests.

author’s contributions
de conceived the methods, performed the analyses and drafted the manuscript. lw participated in the analyses. all authors read and approved the final manuscript.

