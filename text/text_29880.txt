BACKGROUND
biochemical and structural properties of chromatin are implicated in the function and maintenance of genomes . chromatin immunoprecipitation followed by deep sequencing  is becoming the standard method for the genome-wide mapping of histone modifications and transcription factor  binding sites
 <cit> .

the analysis and interpretation of chip-seq data sets is a difficult task
 <cit> . most of the existing analysis tools are focused on the delineation of enriched sites from a single sample with optional "input control"
 <cit> . for histone modifications this task becomes more challenging as their enrichments are often weaker and less localized. a number of groups have extended the peak-calling approach to identify broad domains
 <cit>  or analytically represent chip-signals beyond read-counts
 <cit> . in order to link epigenetic marks to biological functions and processes, peak calling has also been adapted to paired experimental designs
 <cit> . individually, each epigenetic mark provides some data towards understanding the structure and biochemistry of the underlying genome. however, it has been argued that the cooperative action of multiple histone modifications, variants, and tfs is functionally most informative
 <cit> . unfortunately, none of the standard peak-based method deals with multiple marks and the reconciliation of several sets of peaks is an added challenge
 <cit> .

an alternative, and orthogonal, approach is to integrate individual histone modification maps to discover latent relationships between epigenetic marks. broadly, these approaches fall into two categories: genome-wide segmentation and locus-based clustering. for example, chromhmm and segway
 <cit>  partition the genome into epigenetically-similar regions and have been able to reliably associate chromatin profiles with transcription start sites and putative enhancer regions
 <cit> . similarly, clustering approaches, such as chromasig, attempt to identify loci with globally congruent "chromatin signatures". although the two types of methods differ greatly in the statistical modeling of data, they make the general assumption that a small set of "chromatin states" is sufficient to annotate the genome
 <cit> . experimental results suggests that these models are too restricted to capture the genome-wide variability of chromatin patterns
 <cit> . the number of global "chromatin states" has been estimated to be in the several hundreds even when only a small set of marks is used to define each pattern
 <cit> .

both clustering and segmentation results in the hard assignment of a single "chromatin signature" to each locus. this allows for certain types of functional enrichment analyses
 <cit> , but is not, in general, conductive to quantitatively link "chromatin state" to genome biology. regression and other supervised machine learning technique are needed to move from descriptive annotations to quantitative and predictive models
 <cit> . in most of these approaches, levels of epigenetic signals are linked to a biologically important readout . unfortunately, histone modifications tend to be highly correlated, which makes it difficult to asses the relative importance of the variables 
 <cit> . since these problems are further exacerbated during stepwise regression, it is difficult to explain how, in terms of direction and strength, combinatorial interactions between marks are linked to the biological readout
 <cit> .

here, we describe a novel method based on non-negative matrix factorization  to discover combinatorial patterns of epigenetic marks from integrated epigenetic data sets. locus-specific weights of these mark co-occurrence patterns are used as quantitative variables, suitable for regression and supervised machine learning. we are able to demonstrate that basis patterns are quantitative predictors of biochemical activity, discriminate between classes of genomic regions, and are associated with molecular pathways. hence we propose to call these patterns bona fide epigenetic "codes". in the remaining sections we describe the basic algorithm and its extensions , investigate important statistical properties of basis patterns , and show their utility in regression, classification, and gene set analysis . a reference implementation of the method is available at
https://github.com/mcieslik-mctp/epicode and in .

RESULTS
formulation
the total number of distinct "chromatin states" in the genome is likely inestimable, but clearly specific combinations of a small number of marks are associated with distinct functions or region classes
 <cit> . rather than trying to delineate global "chromatin states", we attempt to identify patterns of marks that frequently co-occur in subsets of genomic regions. we anticipate marks within a combinatorial pattern to be "written" or "erased" by the same chromatin remodeling complex or during the same reprogramming event, which results in their high correlation. along the lines of the original "histone code" hypothesis
 <cit>  we expect these patterns to either, encode biochemical signals that are recognized by multivalent epigenetic "readers"
 <cit> , or to represent coordinated epigenetic regulation
 <cit> . we introduce a method which represents the full set of histone modifications or variants occurring at a selected annotation class  across a genome in terms of a small set of co-occurring "basis" patterns. we will refer to these basis patterns as "codes". in contrast to previous approaches
 <cit>  we attempt to represent the unique "chromatin signature" at each locus as a weighted superposition of multiple basis patterns . we formulate the task of epigenetic code discovery in the framework of non-negative matrix factorization 
 <cit> . this method transforms an input matrix v into two factor matrices h and w:

 v≈wh 

in the context of epigenomics v is a matrix of the observed "chromatin signatures". each row of this matrix is an arbitrary user defined locus e.g. a region of  <dig> kbp flanking a transcription start site . each column quantifies the level of a histone modification and is a function of the number of reads mapping to at least one base pair within this locus. h is a small matrix of sparse basis patterns, technically called basis vectors, which we refer to as codes, and w is a matrix of weights to reconstruct v using the codes in h . within a single basis pattern highly correlated input variables have positive values. we observed that for epigenetic marks the nmf algorithm yields a sparse matrix h. the resulting basis vectors in h are dissimilar and interpretable e.g. . unlike other matrix factorization methods, nmf is suitable for this particular task because it constrains both h and w to be non-negative. given a factorization v ≈ wh we can assign code labels to genes by finding, for each gene, the code with the highest weight in w, which is analogous to "hard" cluster assignment in k-means
 <cit> .

the basic nmf procedure randomly initializes matrices w and h and minimizes the reconstruction error v-wh – difference between the actual and model output values of the epigenetic factor levels – by updating w and h using a projected gradient algorithm
 <cit> . this algorithm finds only local optima that depend on the starting conditions, analogously to the common k-means algorithm. for the initialization of the nmf algorithm we propose to use the deterministic non-negative double singular value decomposition  technique
 <cit> . the nmf algorithm depends on a single parameter c - the rank of the factor matrices, which is the expected number of basis patterns. as with most unsupervised algorithms the choice of c is not straightforward. a large c results in sparse codes and few combinatorial interactions. sparsity of the output is a prominent feature of nmf, but is further enhanced by additional constraints
 <cit> . in our implementation the constraints are applied to the matrix h and thus favor combinatorial patterns of only few histone marks. to illustrate the sensitivity of nmf to initialization and the relative performance of nndsvd for epigenomic data we compared the default factorization with a random initialization approach . we found that this approach has the smallest reconstruction error  and largest sparsity. further, randomly initialized solutions tend to have a smaller reconstruction error if their h matrix is more similar to the nndsvd solution . together, these results show that nmf output is sensitive to initialization. however, the nndsvd approach yields a solution that outperforms even a large number of random runs.

we develop three complementary approaches which apply the nmf algorithm on epigenomic profile data for distinct tasks of prediction, classification and association:  absolute,  discriminatory and  differential . as shown in , the absolute algorithm performs nmf on the quantified levels of epigenetic marks at one annotation class . the discriminatory algorithm performs nmf on quantified levels of the same set of epigenetic marks at two classes of loci  . as depicted in figure
1d, the differential algorithm performs nmf on normalized differential epigenetic levels – gains and losses – between two cell lines or cell states .

to construct v from genome-wide maps of multiple histone modifications, we individually quantify and scale "absolute" signals of epigenetic marks at each queried locus . each row of the input matrix v represents scaled levels of epigenetic marks within a single locus. some form of column normalization, or scaling, is usually necessary to account for the differences in magnitudes and dynamic ranges of histone modifications, and to reveal the patterns of interest
 <cit> . by default we use a sigmoid function to normalize all signals to  <dig> to  <dig> range as this has been shown to accelerate and improve nmf
 <cit> .

different classes of genomic regions, such as promoters and enhancers, show discriminatory epigenetic patterns
 <cit> . regulatory mechanism operating at distinct classes often have a unique epigenetic component, such as the activity of a specific chromatin remodeling complex . thus, it is reasonable to assume that specific or enriched combinatorial patterns could discriminate between classes of sites. to identify such specific codes we propose the "discriminatory" algorithm . in this mode we first apply the "absolute" algorithm at each set of k genomic regions separately and next reconstruct a single weight matrix. specifically, we partition input matrix v into k sub-matrices v
i
, each of these matrices is independently factored v
i
 = w
i
h
i
, next we concatenate the kh
i
 matrices into a single matrix h. finally the matrix w is obtained using non-negative least squares from matrices v and h. intuitively, we first discover optimal codes for each class of genomic regions and next allow all codes to be used to describe the "chromatin signature" at each locus regardless of its class. if the epigenetic patterns at different classes of sites have the same latent structure, the discovered class-specific codes will be very similar or interchangeable. in both cases codes discovered for one class of sites will be useful to encode the epigenetic features of other classes of loci. on the other hand, if the latent epigenetic structure of the different region types is dissimilar, some of the discovered codes will be discriminatory and not useful to encode epigenetic features of other classes.

histone modification levels are dynamic and are due to net changes in the activity of modifying enzymes called "writers" and "erasers"
 <cit> . relative to a second sample a locus might show "gain", "loss", or, if it is sufficiently large, both "gain" and "loss" of a histone mark. although chromatin remodelling complexes often have multiple catalytic activities and substrate cross-reactivities
 <cit> , simultaneous changes to multiple marks at a subset of loci might suggest a shared regulatory mechanisms or function
 <cit> . therefore, we define basis patterns in the dynamic context as coordinated changes to histone modification levels. analogously to the "absolute" and "discriminatory" cases, in "differential" mode , mark levels are quantified within each query locus. however, because paired samples are typically sequenced to different depths, the mapped read counts are normalized using the deseq algorithm
 <cit> . within each locus absolute signals are transformed into differential "gain-loss" scores . this approach results in twice the number of columns in v –two for each epigenetic mark. histone modification levels are spatially auto-correlated. in "absolute" and "discriminatory" modes we rely on this property to calculate average enrichment levels within a possibly large locus. much less is known about the auto-correlation of differential  levels. therefore we divide each locus into adjustable windows . for each window paired chip signals are subtracted resulting in a net "gain" or "loss" of a histone modification. we obtain the final per-locus "gain" score by summing the windows with a net "gain", and the "loss" score by summing windows with a net "loss". if the differential signal is strongly auto-correlated most windows within a locus will show "gains" or "losses" and the whole locus will show only "gain" or "loss". a simple example shows that this is not always the case. if a peak is broadened it results in "losses" at the summit but "gains" at the slopes. integrating over windows with sizes in the range of chip-seq resolution  allows us to differentiate these two cases. the per-locus columns are likewise scaled to the  <dig> –  <dig> range before entering the nmf method. the output is similar : h contains basis "gain-loss" patterns w contains the weights associated with each pattern at each locus. the difference is that now rows in the matrix h correspond to patterns of correlated changes – not patterns of absolute levels.

algorithm properties
to illustrate important properties of nmf when applied to epigenomic data we ran the "absolute" algorithm on a relatively simple publicly available chip-seq data set. we analyzed  <dig> histone modifications and one histone variant  mapped by the encode project in the a <dig> adenocarcinomic alveolar basal epithelial cell line
 <cit> . we focused on regions of tss-proximal gene bodies since they contain epigenetic traces of transcription initiation and elongation, and prominently feature all probed marks.

to illustrate the dependence of c on the factorization we ran the "absolute" algorithm with all default parameters and scanned c values from  <dig> to  <dig>  first, we quantified the average sparsity of matrices h and w using hoyer’s formula
 <cit>  . hoyer’s sparsity takes on values between  <dig>  and  <dig> . we observed that the sparsity of h increases linearly up to a knee-point at c =  <dig>  whereas the sparsity of w is much lower and has a minimum at c =  <dig>  this means that if c is  high the h matrix will contain many rows that have only a single mark with positive values. matrix w contains weights that optimally use all codes to reconstruct the observed "chromatin signature" at each locus . the relatively constant sparsity of w suggests that at most loci multiple basis patterns are used and superimposed . an empirical property of nmf is that the higher-rank  solutions are largely consistent with the lower-rank  solutions. for example, in one study involving microarray clustering, higher resolution clusters are in general subsets of lower resolution clusters
 <cit> . to illustrate this for basis patterns, we visualized matrices h for c =  . this showed that codes obtained for higher c values are, in general terms, obtained by splitting one of the lower resolution codes into two. for example code  <dig> at c =  <dig> is split into code  <dig> and  <dig> at c =  <dig> while the latter is further split into code  <dig> and  <dig> at c =  <dig>  this suggests that for nmf specifying a c which is  small yields a solution which is consistent with a higher  rank factorization. this type of stability is particularly useful when analyzing the hierarchical dependencies between histone modifications
 <cit> . the lower-bound of c is determined by the diversity of histone modifications.

the most important property we would like to highlight is that nmf basis patterns are less correlated than the input features. correlation heatmaps are often used to reveal patterns of associations between histone modifications e.g. <cit> . as exemplified in  these heatmaps show typically little structure beyond the general split into marks associated with permissive or closed chromatin, which limits their interpretability. more importantly, the high correlation between histone modifications is problematic for regression and some classification methods
 <cit> . high correlation among multiple variables in a regression model, referred to as multicollinearity, leads to poor interpretability of multiple regression slopes
 <cit> . in particular, it is important to test for multicollinearity when attempting to use regression coefficients to assess the importance of variables . we compared correlations of histone modifications to correlations between basis patterns  and found that codes are remarkably less correlated. according to a rule of thumb variables that have correlation coefficients larger than  <dig>   should not be included together in a single model
 <cit> . only two pairs of nmf codes exceed this threshold and only a single code would need to be dropped. this is compared to  <dig> pairs of individual epigenetic marks that are exceedingly correlated. if all affected marks were dropped, the pruned model would contain only three independent variables. in additional file
3: figure s <dig> we show an analogous comparison with the difference that mark levels are calculated at promoters and in a different cell type .
 <cit>  and the cosine metric
 <cit> .

another important feature of the nmf algorithm in absolute mode is the similarity of the h matrices across cell lines. in  we show the h matrices from human embryonic stem  cells , myoblasts , and myotubes  derived from a set of  <dig> common epigenetic marks with c set to  <dig>  in general, rows of each h matrix are in no particular order and equivalent codes obtained from two or more data sets have to be found using  the munkres assignment algorithm
 <cit> . the nndsvd approach initializes rows of matrix h using svd eigenvectors and indirectly ranks basis patterns by their variance. this order is likely to be similar between different cell lines. we observe that the matrices are essentially the same for myotubes and myoblasts and only slightly different for h1escs. this suggest that the co-regulation of epigenetic marks is not drastically changing during differentiation. to get further insight on the complexity epigenetic patterns in terms of combinations of the h basis patterns we applied k-means clustering to the w matrix . we clustered the w weight matrix corresponding to the c =  <dig> factorization from . the majority of clusters  is dominated by at most  <dig> of the  <dig> codes, which means that for the majority of genes a simple weighted sum of two codes from  is  optimal to reconstruct relative levels of epigenetic marks. this should be contrasted with the hypothetical case, where most loci have highly variable and unique code weight patterns and the w matrix displays a second level of combinatorial complexity.

case studies
regression pol <dig> binding
in our formulation epigenetic patterns are quantitative i.e. each locus has a specific non-negative weight for each of the basis patterns. this enables us to quantitatively link the weights of codes to functional or biochemical properties of the underlying loci. to illustrate this we tried to predict levels of pol <dig> binding at promoters of protein-coding genes in human embryonic stem cells . we compared ridge regression models, which either included basis patterns  or individual histone marks  as independent variables. levels of histone modifications and pol <dig> were calculated within 5k kbp window centered at the tss.

to obtain the code  and weights  we applied the algorithm in "absolute" mode on  <dig> histone modifications with default parameters and c =  <dig>  the discovered codes are shown in . as expected , we found that codes are not significantly correlated and that all of them should be included in the multiple regression . on the other hand, six pairs of individual epigenetic marks are exceedingly correlated . the primary reason why highly correlated variables should not be included in a multivariate model is that their beta regression coefficients become unreliable both in magnitude and sign, and thus their biological or physical role is difficult to interpret. this suggests that at least three marks out of  should be dropped. unfortunately, it is not a priori known which ones . the mark-model’s performance dropped significantly from r2 =  <dig>  to r2 =  <dig>  when we kept two marks that are known to be associated with both recruited , and actively transcribing  pol2
 <cit> . although the code-based regression includes fewer independent variables it has almost the same performance  as the mark-based model . an inspection of the regression slopes  and code values  reveals that high weights of code  <dig>  and code  <dig>  are most positively associated with pol <dig> levels, which fully confirms a recent study
 <cit> . due to multicollinearity, coefficients of the mark-based regression are not reliable to rank variable importance. for example, the negative beta for h3k4me <dig> is inconsistent with numerous reports that link h3k4me <dig> to pol <dig> binding and transcription
 <cit> , which idictates overfitting although a penalized regression approach was employed.

ridge regression of pol <dig> levels in promoters of protein coding genes. beta – regression coefficients; mse – mean squared error.

to differentiate active transcription from promoter-proximal pol <dig> pausing we assigned each gene to the basis pattern with the highest weight  and plotted genes from select codes in the gene expression – pol <dig> level plane. this projection revealed that genes from code  <dig>  featuring most prominently high levels of h3k9ac and h3k27ac, have all moderate to high levels of pol <dig>  in contrast, genes associated with code  <dig>  which is dominated by h3k27me <dig>  have uniformly low levels of pol <dig>  remarkably, high levels of these activating acetylations are not significantly correlated with gene expression, while h3k <dig> tri-methylated genes tend to be expressed at a low level. this suggests that high levels of h3k27me <dig> are incompatible with pol <dig> binding, and that high levels of pol <dig> are associated with k3k9ac and h3k27ac at gene promoters but not necessarily high gene expression.

in this example we have shown that quantitative weights of the "absolute" basis patterns can be used instead of individual histone modifications levels as independent variables in the prediction of pol <dig> binding. the code-based model had equal performance to the mark-based regression, but included a smaller number of independent variables and alleviated problems of multicollinearity. hard assignment of genes to codes allowed visualization of the regulatory differences in pol2-recruitment and active transcription.

classification pol2-bound enhancers vs. promoters
polymerase ii  is known to localize both at promoters and within intragenic regions. in h1esc preferential association of pol <dig> was observed for promoter-distal sites enriched for p <dig>  h3k4me <dig>  and h3k27ac
 <cit> . genes in the vicinity of these regulatory regions showed increased expression levels, while genes that were activated during differentiation gained pol <dig> at close enhancers
 <cit> . in differentiated cells pol <dig> levels at enhancers have been shown to change in response to stimuli and to be associated with h3k4me <dig> and bidirectional transcription
 <cit> . these findings established that enhancers actively engaged in transcription are occupied by the polymerase. the chromatin patterns of this class of enhancers show relatively high levels of h3k4me <dig> and are more similar to patterns at promoters of protein coding genes. we decided to test whether pol2-bound enhancers and pol2-bound promoters can be distinguished based on levels and multivariate patterns of epigenetic modifications.

in the same line of human embryonic cells we divided pol2-enriched regions into two classes. the promoter-proximal class was defined as  <dig> kbp regions centered on an pol <dig> peak, that overlapped any gencode annotated tss site. all remaining  <dig> kbp sites centered on an pol <dig> peak were classified as promoter-distal. we performed the analysis using all promoter and enhancer regions, but found the classification was relatively trivial because the largest pol <dig> peaks are preferentially associated with promoter regions
 <cit> . thus, we challenged the classification algorithm by rerunning the analysis excluding the top  <dig> percent of peaks i.e. those with a very high p-value of 1e- <dig>  first, we compared the overall distribution of histone modifications at the promoters and putative enhancers.

we found that some marks showed relatively similar levels . as expected we found substantial h3k4me <dig> levels at pol2-bound putative enhancers. strikingly, levels of h3k4me <dig> and h3k4me <dig>  which are often associated with poised or active enhancers, were markedly higher in tss-proximal sites. on the other hand, h3k27ac, which is associated with permissive chromatin, and h4k20me1/h3k79me <dig>  which are associated with transcriptional elongation, had similar levels at both classes of sites. in agreement with recent discoveries, we found that a significant portion of intragenic pol <dig> sites occurred within "poised" enhancers that were enriched for h3k27me <dig> . notably, while there were some informative level differences, the distributions significantly overlapped for the majority of marks.

to discriminate enhancer from promoter regions we first built a series of logistic regression models. the simplest models  included only a single independent variable . these zero-order correlations directly measure the shared variance between two variables, since they reflect the amount of variance in the binary outcome variable that is explained by a single continuous predictor. in addition a "multivariate" model was built that included levels of all marks as predictors. an analogous set of zero-order and multivariate models was built using nmf codes. this new set of models differed from the previous in that they used weights from the w matrix rather than levels of individual marks to perform the classification. we applied the "discriminatory" algorithm and discovered optimal codes for enhancers and promoters independently . intuitively, we attempt to identify codes that are useful to encode histone modification levels at enhancers, but not promoters . we combined all codes into matrix h and re-derived the weight matrix w. therefore, weights for certain codes should discriminate between promoters and enhancers.

we trained all models using 10-fold cross-validation and evaluated model performance on  <dig> percent of the observations never used for training . we found that both multivariate models had very good performance  as judged by the matthews correlation coefficient , whereas among zero-order models only some code-based regressions showed good performance  curve  in figure
 <dig>  mcc in additional file
8: table s2). the multivariate code-based model outperformed the mark-based model in both performance measures and achieved an almost perfect score auc  <dig>  . the majority of the mark-based zero-order models had similar and average performance, whereas the auc scores of zero-order code-based models were highly variable . single code models either outperformed all histone modifications  or were close to the performance of random assignment . importantly, the two best single-code regressions  had significantly better performance than all individual histone modifications including h3k27me <dig>  while code  <dig> contained h3k27me <dig> together with h2a.z, code  <dig> was dominated by marks associated with elongation including h3k36me <dig> and h4k20me <dig>  this shows that the codes had discriminating power beyond that of the best mark .

to assess the relative importance of independent variables in multivariate regression it is important not to rely only on regression coefficients
 <cit> . one approach is to compare the ranking and signs of variables from zero-order and multivariate models. we found that mark-based logistic regressions have incongruent slope estimates. for example beta coefficients of three marks change signs between the two models. also the ranking of the beta coefficients are not even approximately maintained and do not track model aucs . in the mark-based case it was difficult to ascertain which histone modifications discriminate enhancers from promoters. in contrast regression on codes yields models that are easier to interpret. specifically, codes with large zero-order coefficients were also relatively important in the multivariate model, which largely maintained the rank-order of variables . also, codes with the largest multivariate coefficients consistently showed the best zero-order predictive performance . several codes have very small zero-order coefficients and aucs, but relatively large multivariate slopes. likely, these codes are not important and could be dropped from the multivariate model.

the code-based approach allowed us to identify which patterns of histone modifications discriminate between pol2-bound promoters and enhancers . most strikingly, we found that promoters and enhancers were separated by codes with high levels of h2a.z. in the context of promoters h2a.z is linked to h3k4me <dig> and h3k4me <dig>  at enhancers h2a.z frequently co-occurs with h3k27me <dig> or in a complex pattern with h3k4me <dig>  h3k9ac, and h3k27ac. this explains why the variant on its own is unable to differentiate sites . recent findings on the functional and mechanistic roles of h2a.z allow us to give plausible interpretations of the codes: at the tss h2a.z levels and close positioning have been shown to positively correlate with gene expression and pol <dig> occupancy
 <cit> , also high levels of h3k4me <dig>  and in particular h3k4me <dig>  are generally associated with active promoters. hence, code  <dig> is likely associated with genes that are transcriptionally active in the esc state. h2a.z has been shown to be associated both with poised and active enhancers in esc
 <cit> . it has been proposed to act as a general facilitator of genome accessibility due to its role in the maintenance of pluripotency and differentiation
 <cit> . the two h2a.z-loaded enhancer codes  seem to reveal this context dependent role of h2a.z. in code  <dig>  h2a.z is in a repressive context with h3k27me <dig> and presumably identifies enhancers poised for expression during differentiation while in code  <dig> h2a.z co-occurs with permissive acetylations and the base-line enhancer mark h3k4me1
 <cit> . code  <dig> highlights features of enhancers active in the pluripotent state.

surprisingly, both enhancers and promoters, are associated with codes dominated by histone modifications associated with transcription elongation. at promoters this code is very sparse and contains non-zero values for h3k36me <dig>  h4k20me <dig> , and h3k79me <dig> . at putative enhancers the code is slightly different as it does not contain h3k79me <dig>  but includes h3k9ac and h3k27ac at low levels. recently it was shown that h3k79me <dig> is most enriched at 5’ ends of genes, slightly downstream of h3k4me <dig>  but before the classic elongation associated mark h3k36me3
 <cit> . thus, it is expected to occur at promoter proximal pol2-bound regions. to the contrary, active enhancers are sometimes found in introns of transcribed genes. this dependency between active transcription and activation of enhancers in the gene body appears to be captured via code  <dig> 

in total, these results suggest that the discovered basis patterns capture dependencies between marks that discriminate pol2-bound enhancers or promoters. the factorization approach successfully de-correlated epigenetic marks, which resulted in an interpretable multivariate classification model. further, the discovered codes are consistent with known epigenetic mechanisms and features that regulate pol2-dependent transcription in pluripotent cells.

gene set enrichment analysis
in the previous analysis we have compared "absolute" levels of histone modifications at multiple classes of loci to discover patterns of co-occurring marks that discriminate among them. somewhat analogously, histone modification levels can be compared between two experimental conditions. intuitively, the idea is that patterns of co-occurring changes to mark levels could be used to identify loci that are subjected to coordinated epigenetic regulation. differentiation is a highly regulated process and specific reprogramming mechanisms could result in similar epigenetic changes at functionally related genes. in other words, genes that share combinatorial patterns of changes could have some common molecular functions or participate in related pathways.

to test this hypothesis we applied the "differential" algorithm  to histone modification data in myoblasts and myotubes. the alignment of myoblasts into myotubes represents an important step in myogenesis and is an example of differentiation. thus, by comparing the epigenetic state of myotubes to myoblasts we hope to discover patterns of epigenetic changes that are associated with genes that undergo coordinated epigenetic reprogramming during myogenesis
 <cit> . we obtain basis "gain-loss" patterns from the observed epigenetic changes at promoters of protein coding genes . the number of codes represents a significant reduction from the  <dig> input variables – the  <dig> gains and  <dig> losses of epigenetic marks . still, the codes are relatively sparse and most variables take significant values in only a small number of codes. it should be noted that the codes are not gain- or loss-specific and gains of certain marks are linked to losses of other marks. for example, one pattern highlights h3k4me <dig> and h2a.z loss linked to an increase in dnase i accessibility and gain of h3k4me <dig> .

we tested whether any of the basis patterns are enriched for gene ontology  terms, biochemical pathways, or experimental molecular signatures
 <cit> . specifically, we evaluated the strength of positive association between the weights of each code at each locus with functional annotations of the underlying loci . we have chosen the random-set method
 <cit>  to quantify the enrichment, but other methods including the gene set enrichment analysis 
 <cit>  and the fisher’s exact test are equally applicable. surprisingly, we found only one statistically significant  correction) go term: code  <dig> was found to be associated with genes involved in the cell cycle . several codes are significantly associated with specific pathways . broadly, membrane proteins and specifically g protein-coupled receptors  have increased weights of the repressive code 2; code  <dig> is linked to genes involved in transcription; splicing and translation; finally, genes involved in the cell cycle are, again, associated with higher levels of code  <dig>  these pathways are critical to myogenesis. during differentiation myoblasts exit the cell cycle and increase protein synthesis to expand the myofibrillar muscle cell compartment
 <cit> . fully mature muscle cells express tens of different gpcr receptors
 <cit> . many of which have been shown to enable muscle function by regulating growth, contractility, and glucose uptake. however, the genes associated with code  <dig>  and olfactory  gpcrs) are transcriptionally silenced as cells transition from myoblasts to myotubes. among molecular signatures we found over  <dig> highly enriched terms  . the most significant association was between targets of e2f <dig> and the "gain-loss" code  <dig> . e2f <dig> is a transcriptional regulator with a specific role in the repression of cell-cycle genes and ability to recruit hdac1-containing co-repressor complexes
 <cit> . it is notable that the most prominent feature of code  <dig> is the loss of h3k9ac and h3k27ac. although hdacs have relatively low substrate specificity, which is dependent on their co-factors, hdac <dig> has been recently implicated in the specific deacetylation of h3k9
 <cit> . a prediction based on this analysis is that h2a.z levels increase at cell cycle genes repressed during myoblast differentiation. taken together these results suggest that during myogenesis distinct patterns of net gains or losses of epigenetic marks are associated with functional classes of genes.

for each of the "gain-loss" basis patterns only the most significant  terms are shown for each code. pathway gene annotations and identifiers are from msigdb, but are originally sourced from kegg and reactome. codes that did not have any significant terms at the 1e- <dig> level were omitted.

myoblasts are embryonic progenitor cells with myogenic potential. they are more differentiated than es cells, but markedly less than myotubes. expression of pluripotency factors can either abrogate differentiation into myotubes or elicit reprogramming of myoblasts into induced pluripotent stem cells 
 <cit> . we hypothesized that targets of pluripotency factors which are silenced during differentiation will share an epigenetic signature of their repression. we found that experimental targets of several pluripotency factors, including myc , nanog, pou5f <dig> , and sox <dig>  are all strongly associated with the repressive "gain-loss" code  <dig> . further significant enrichments were observed for other "pluripotent" gene categories including the protein-protein interaction network shared among pluripotent cells 
 <cit> , and the core esc-like module
 <cit> , which includes genes coordinately up-regulated in a compendium of escs. we decided to test whether these enrichments are due to the specific combinatorial pattern of gains and losses captured by code  <dig>  or alternatively could be explained by any of the individual marks . we found that each category of pluripotent genes is more strongly associated with code  <dig> than with any of the single epigenetic marks. further, the association of other epigenetic marks within the six categories was inconsistent and no single mark could be chosen as a strong proxy for code  <dig>  this suggests that promoters of genes that maintain the pluripotent state are epigenetically silenced in a coordinated way and that this is captured by one of the "gain-loss" epigenetic "codes". other patterns of silencing i.e. codes  <dig> and  <dig> which display loss of h3k4me3/h2a.z and h3k4me2/h3k4me1/h2a.z, respectively are not consistently associated with the pluripotency categories.

discussion
we have introduced a new computational technique to discover combinatorial patterns of histone modifications. at its core this method relies on non-negative matrix factorization  to separate the complex "chromatin signatures" at genomic loci into small basis patterns we refer to as codes. these simple parametrizations of the data reveal frequently co-occurring marks, which could potentially be read by multivalent chromatin complexes, or represent differential signatures of coordinated epigenetic reprogramming. most importantly, the application of nmf results in dimensionality reduction and de-correlation, but maintains the quantitative aspect of epigenetic mark levels.

nmf is one among many matrix factorization algorithms. results from alternative methods are different due to the difference in the imposed factorization constraints and objectives. principal component analysis  constrains h to be a set of orthonormal vectors; vector quantization , which is equivalent to k-means, constrains w to contain vectors with one non-zero value; while nmf imposes that w and h are non-negative. these constraints result in fundamentally different outputs. pca favors global reconstruction, which means that every element in v is reconstructed through complex cancellations of positive and negative values in w and h. pca allows basis vectors  in h to be ranked by importance. the reconstruction error increases when the least important pc is omitted, but the "coarse" global features of input data are preserved. on the other hand nmf basis vectors cannot be dropped, since it would result in the loss of important parts of  the reconstructed vectors.

while pca dimensions do not resemble any particular data point or combination of data points, nmf basis vectors can be readily interpreted as patterns of frequently co-occurring histone modifications. only a small number of these codes is sufficient to reliably reconstruct the observed "chromatin signatures" at thousands of loci and, as shown by our analyses, to preserve, or even boost, biological information. although with respect to the mean squared error  pca is theoretically optimal for reconstruction, nmf can perform better for classification
 <cit>  or recognition
 <cit> . in some sense nmf returns results that are in between pca and vq. in vq each data point is locally approximated by a single cluster centroid, pca uses all available components, while in nmf typically few, but not all, basis vectors are required to represent a single data point. if the goal is to assign loci to epigenomic states a form of clustering is preferred as cluster centroids are often intuitively understood. pca will perform best if the number of histone modifications is large but one desires only few basis vectors . as illustrated in this paper nmf basis vectors perform well in supervised machine learning. an alternative and analogous approach, known as principal components regression, is to use weights of principal components instead of weights of nmf basis vectors. an advantage of nmf is the physical interpretability of the its basis vectors. conversely, the optimal reconstruction error of pca might be important for very simple models.

CONCLUSIONS
we have shown that nmf applied to epigenetic marks yield sparse codes with an important nesting property. further we have demonstrated the benefits of using codes over individual marks in predictive modeling of pol2-binding. in particular, dimensions obtained from nmf are less correlated than the individual marks, and problems resulting from multicollinearity are alleviated. in addition we developed two variants of the basic algorithm which extended its applicability to multiple classes of genomic regions and paired experimental samples. we have shown the excellent performance of codes for the classification of pol2-bound enhancers and promoters. the most discriminatory codes highlighted the context-dependence of h2a.z, which is consistent with current knowledge on the role of this histone variant in the regulation of transcription in es cells
 <cit> . to showcase the algorithm for paired experimental samples, we analyzed chromatin remodeling during myogenesis. we established that genes from pathways involved in protein synthesis , the cell cycle, and signaling from g protein-coupled receptors show unique patterns of chromatin activation or silencing. finally, we were able to show that target genes of pluripotency factors are also associated with the same chromatin remodeling pattern
 <cit> .

in summary, we have introduced a general nmf-based approach to represent combinatorial patterns of epigenetic marks as quantitative variables. we have shown the utility of this representation for predictive modeling, supervised machine learning and gene set analysis. hence, this technique is complementary to more descriptive methods aimed at "chromatin pattern" discovery such as genome-wide segmentation and clustering.

