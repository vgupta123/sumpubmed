BACKGROUND
human leukocyte antigen  molecules, encoded by a dense cluster of genes located on chromosome 6p <dig> , present antigen peptides to lymphocytes and mediate key immunological events including self-antigen tolerance and immune responses to pathogens or tumors . hla molecules can be classified by function. class i hlas express ubiquitously and present cytosolic antigens to cytotoxic t cells, whereas class ii hlas mainly express in immune cells and present extracellular antigens that stimulate t helper cells and subsequently antibody-producing b cells.

hla loci are highly polymorphic. polymorphisms in the hla loci often result in differences in the amino acid sequences of hla proteins. this hla diversity allows a wide range of different antigens to be presented to immune cells within a population. however, these variations in hla sequence also result in histoincompatibility of organs and tissues between individuals, greatly complicating surgical transplantation of organs and tissues. the risk of graft-versus-host disease and organ or tissue rejection can be minimized if the alleles present at the hla loci of a perspective donor and recipient encode matching hla proteins, to the extent possible  <cit> . in order to determine whether there is a match, it is necessary to determine what hla alleles are present at each of the hla loci in the donor and recipient, a process known as hla typing. an individual’s hla type at an hla locus is made up of the two hla alleles  present at the individual’s two copies of the hla locus.

hla types are also increasingly recognized as a factor that plays a significant role in numerous diseases. for instance, there are strong associations between specific hla types and autoimmune disorders, including lupus, inflammatory bowel diseases, multiple sclerosis, arthritis and type i diabetes . as one example, class ii hla-dqa1*02: <dig> and hla-drb1*03: <dig> are frequently present in systemic lupus erythematosus patients and significantly associated with the disease susceptibility  <cit> . presence of other class ii hla proteins also correlates with either the resistance or susceptibility to breast and cervical cancers  <cit> . in cancer immunotherapy and vaccination, activation of the cytotoxic t lymphocytes requires the well-fitting interaction between class i hla molecules and the epitopes. knowing the correct hla types is therefore critical to the success of these immunoncology therapies  <cit> .

the pathological and therapeutic indications of hla molecules highlight the need for accurate and efficient methods of hla typing. hlas have been resolved at low resolution by distinguishing two-digit antigen groups that approximate serologic specificities in peptide binding . however, for many applications, two-digit hla typing is insufficient. increasing evidences suggest that t cells can recognize both a peptide and its binding hla as a whole  <cit> . different hla proteins, even if they present the same antigen peptide, can lead to allogeneic responses. for example, a single amino acid difference between two hla proteins of the same antigen group  can result in altered t-cell recognition specificity and allograft rejection . consequently, high resolution hla typing at the amino acid level can be critical . for example, resolving hlas at high resolution substantially improves the clinical outcome in unrelated cord blood transplantation and in cancer vaccination trials  <cit> . in addition, amino acid variations may lead to diverse functional perturbations. hla proteins of the same two-digit type can express at either normal or abrogated levels, impose either predisposing or protective effects in disease, or place different immune selection pressures  <cit> . these differences can only be elucidated via high resolution hla typing.

the highly polymorphic nature of hla genes renders accurate, high-resolution typing a considerable challenge, particularly at high throughput. more than  <dig> four-digit class i and ii hla alleles are present at the major class i and class ii hla loci in the human population, as documented by the international immunogenetics project  database  <cit> . existing hla typing methodologies capable of resolving hla types at four-digit or higher resolution, such as group-specific polymerase chain reaction  by sequencing specific priming  and sequence-based typing , have low throughput  <cit> . recently, high-throughput typing protocols are established to specifically target the hla loci via pcr-amplification, followed by deep sequencing . such targeted amplicon methods yield long reads  and a high coverage, allowing accurate  assignment of four-digit hla alleles. nevertheless, due to cost and efficiency considerations, genome-wide sequencing, such as transcriptome or whole exome/genome sequencing, generally produce much shorter reads  and lower coverage. the reduced read length and coverage limit the accuracy of methodologies that attempt to use genome-wide sequencing data for hla typing. for instance, the four-digit hla type identification from short reads below  <dig> bp has been reported to be between 32% and 84%  <cit> . although genome-wide sequencing data are suboptimal for hla typing, the data availability increases explosively in both fundamental research and clinical practice. it will be beneficial to uncover hla genotypes from such resources to enrich the data interpretation, screen immunogenetic risks or stratify patients for vaccination.

current algorithms to identify hla types from genome-wide data follow two major directions. one is to assemble reads into contigs and report the alleles or allele pairs best matching the contig sequences  <cit> . the other is to map the reads against a collection of allele sequences and predict true alleles based on the number, quality and sequence consistency of the reads aligned to them . the assembly approaches are error-prone with short reads or versatile coverage and are computationally costly. the mapping approaches are more flexible with read length, yet often face ambiguous read alignments against the highly homologous hla alleles. consequently the four-digit allele identification remains challenging. for example, seq2hla only identifies 32% of the four-digit hla types correctly using short read transcriptome data  <cit> . the four-digit accuracy of hlaforest is enhanced but stays moderate in most of its applications   <cit> . hlaminer offers a contig assembly option that yields a seemingly high four-digit sensitivity  when applied to several datasets of ~ <dig> bp reads  <cit> . however, the ambiguity in hlaminer predictions is substantial. reporting more than two alleles per hla locus  occurs over half of the time, leaving the true hla types essentially unresolved. another assembly-based method althlates is designed mainly for exome sequencing but not transcriptome sequencing. its application on reads shorter than  <dig> bp is unclear. it also functions only if specific coverage requirements are met  <cit> . overall, there is a lack of methods to accurately identify four-digit types over diverse read lengths and depths, and suit both rna and dna sequencing inputs.

we here present a new algorithm named phlat  that improves substantially the four-digit typing accuracy using genome-wide rna or dna sequencing data and with various read lengths and depths. the key strategy is a read-mapping based selection of candidate alleles followed by a likelihood based ranking over all pair-wise combinations of the selected alleles. the final result is the most probable pair of alleles given the observed data at each locus. the candidate allele selection serves as a filter to clean up many false alleles and the error-prone reads associated with them. the likelihood scores consider the sequence agreement between the observed reads and the alleles at individual single nucleotide polymorphism  sites , the sequence consistency across snps , as well as the known prevalence of the alleles. similar likelihood scores were applied earlier to hla typing using targeted amplicons and  <dig> sequencing  <cit> . nevertheless, they have not been tested in genome-wide sequencing data. moreover, the integration of the allele selection and the likelihood scoring in phlat is unique. this strategy effectively boosts the four-digit precision. we have observed consistently a leading performance of phlat, compared to most of the existing methods, throughout a comprehensive set of benchmarking data. phlat achieves 92%-95% four-digit accuracy with both rna and dna sequencing and over diverse read lengths and depths. phlat is also applicable to targeted amplicon data obtained by illumina miseq.

in the following sections, we describe the phlat algorithm and benchmark its performance together with most of the existing methods. we further systematically explore the applicability of phlat with respect to the read length, coverage and sequencing protocols. the potential extensions and future improvements of the algorithm are also discussed. with the high performance and flexibility, we believe that phlat can help bridge the fast growing sequencing data and the high resolution hla typing. eventually it may facilitate understandings of the hla loci in fundamental biology and in diseases, and aid numerous clinical applications including genetic risk screening, transplant donor-recipient matching and personalized vaccines.

methods
overview of benchmarking datasets
we have applied multiple public genome-wide sequencing datasets and one in-house targeted amplicon sequencing dataset to benchmark the performance of phlat. the results are also compared with those of the previous methods. for each dataset, we executed some published methods locally if their original publications did not report the corresponding predictions. all results and associated running parameters are documented in additional file 1: table s <dig>  additional file 2: table s <dig>  additional file 3: table s <dig>  additional file 4: table s <dig>  additional file 5: table s <dig>  additional file 6: table s <dig>  additional file 7: table s <dig> and additional file 8: table s <dig> 

hapmap rnaseq dataset
the hapmap transcriptome profiling data of lymphoblastoids using paired-end short reads  is obtained from embl european bioinformatics institute  database . it includes sixty utah residents with ancestry from northern and western europe  in the hapmap project  <cit> . fifty of these samples have been genotyped at major class i and ii hla loci at four-digit resolution initially by de bakker et al. and subsequently validated by different investigators  <cit> . given the large sample size and the well-established genotypes for both class i and ii hlas, this dataset is ideal for benchmarking the performance of hla prediction algorithms. one sample  is excluded due to an abnormally low rate of reads that can be mapped to human genome . the remaining forty-nine subjects are used for analysis and comparisons in this work .

geuvadis rnaseq dataset
the new rnaseq data of a massive collection of samples over  <dig> populations were released by lappalainen et al. in  <dig>  <cit>  as part of the geuvadis project . the study employed longer sequence reads of 2× <dig> bp, compared to the original hapmap rnaseq. such a read length is more prevalent than  <dig> bp in current rnaseq studies such as the illumina human body map  <dig>  project and the genotype-tissue expression  project  <cit> . the sequencing coverage and data quality also hold at a high standard. we therefore include it as a more up-to-date transcriptome sequencing data source. we have selected  <dig> ceu subjects from the new study whose hla types are available in de bakker et al.  <cit> . the data is downloaded from ebi under study accession of erp <dig> .

colorectal cancer  transcriptome sequencing dataset
the transcriptome sequencing data for sixteen colorectal cancer  samples are obtained from ebi database under accession number srp <dig> . the study uses  <dig> bp paired-end reads. two previous algorithms have used this dataset to predict class i hlas in comparison with the experimentally determined results  <cit> . we therefore cover the crc dataset as well. nevertheless, tumor transcriptomes may not be ideal for hla typing, owing to unforeseeable alterations in sequences and in expression levels. in addition, we find that the quality of the reads drops significantly beyond  <dig> bp and the coverage is low .

 <dig> genome whole exome sequencing  dataset
the 2× <dig> bp whole exome sequencing  data of a subset of the  <dig> genome samples is downloaded from ebi database under study accessions prjna <dig>  prjna <dig>  prjna <dig>  prjna <dig>  prjna <dig> . this cohort includes three subjects from kinh in ho chi minh city, vietnam , two from peruvian in lima , two from african caribbean in barbados , two from iberian populations in spain , and one from african ancestry in southwest us . the corresponding class i and ii hla types of total  <dig> alleles are taken from an earlier publication  <cit> .

hapmap whole exome sequencing  dataset
the hapmap whole exome sequencing  dataset and the accompanying class i hla types at four-digit resolution have been gathered for fifteen individuals from utah residents with ancestry from northern and western europe , japanese in tokyo, japan  and yoruba in ibadan, nigeria . the sequencing is processed with paired-end 101 bp reads. the wxs data are downloaded from ebi database , and the hla genotypes are taken from earlier publications  <cit>  .

targeted amplicon sequencing data generation
the targeted amplicon sequencing data  is generated by targeting the class i hla-a and hla-b loci in five human cell lines. the method is similar to a protocol described earlier that used  <dig> sequencing  <cit> . briefly, in the first round of pcr, amplicons are generated for the exon  <dig> and  <dig> at hla-a and b loci and the partial illumina sequencing adapters are added simultaneously. we then pool all four amplicons per sample with a 1:1:1: <dig> ratio and proceed with a second round of pcr to add the full adapter and the barcodes for multiplexing sequencing. finally, we sequence the pooled five samples on illumina miseq  by a multiplexed paired-end run with 2× <dig> cycles. the protocol is illustrated in additional file 9: figure s <dig> and the primers are provided in additional file 7: table s <dig>  de-multiplexed fastq files of the five samples are acquired by miseq reporter software and submitted to ebi under accession number prjeb <dig> 

the hla-a and b loci of the five samples are also genotyped by sanger sequencing as described below. genomic dna is extracted from the five cell lines by qiaamp® dna mini kit  at the optimal concentration of 15– <dig> ng/μl, and subsequently pcr-amplified and purified using secore sequencing kit . the sequencing reactions are set up on the 3730xl automated abi sequencing instrument. the utype® sbt software  is used to process the sequence files and create the hla typing report. a commercial vendor  have independently executed the hla typing of the five samples and returned matching results.

hla allele sequences
phlat includes a total of  <dig> alleles for major class i and ii loci hla-a , hla-b , hla-c , hla-dqa <dig> , hla-dqb <dig>  and hla-drb <dig> . the genomic and coding dna sequences  of the alleles are obtained from imgt release  <dig> . <dig>  <cit>  in a coordinate that is consistent with the human reference genome build 37/hg <dig>  the genomic dna sequences are used for bowtie  <dig> mapping  whereas the cds sequences are for other following procedures . for simplicity, we only keep the genomic sequences from the transcription start site  to the stop. for any allele with only cds but not genomic record, we fill in the non-coding regions with the genomic sequence of the reference allele used in the hg <dig> genome at the corresponding locus , given that no data have suggested variations in the non-coding regions of that allele. we expected that the genomic sequence imputation has limited impact to hla typing in practice, as polymorphisms in non-coding regions do not alter hla types at the amino acid level.figure  <dig> 
phlat algorithm workflow. the algorithm consists of read mapping via bowtie  <dig> to a reference sequence comprising the human genome and a plurality of genomic sequences of hla alleles , selection of candidate alleles based on the number of mapped reads , and log-likelihood scoring  over every pair of selected candidate alleles . the pair of alleles with the best likelihood score is reported as the inferred hla type at a given locus.



prediction accuracy
the accuracy measurements of hla typing were not consistent among previous work. here we use a simple definition of accuracy to evaluate all the algorithms accordingly. the human hla loci possess two alleles per locus, which can be either identical or different for homozygous or heterozygous types, respectively. at a given resolution, we count two alleles per locus as long as the corresponding reference hla types are available. the predictions are compared to the reference types for each allele and any inconsistency is counted as a mistake. for instance, a heterozygous prediction for a homozygous reference  with one mismatched allele is recorded as one mistake out of two typed alleles. if only one allele is reported at a locus, as in some algorithms, the prediction is considered as homozygous. if more than one prediction exists for an allele at a locus, this allele is considered unresolved and thus incorrect. the accuracy is then calculated as the ratio between the number of correctly predicted alleles and the total number of the alleles.

some algorithms  deliver multiple predictions for an allele at a locus. though the true answer may be included, the ambiguous results are considered incorrect according to our definition of accuracy. for reference purpose, we also calculate an apparent accuracy for hlaminer predictions that is defined the same as above except ignoring the ambiguity. that is, an allele with multiple predictions is considered correct if the true solution is included.

phlat algorithm
phlat starts with a reference-based read mapping  using bowtie  <dig>  <cit> . the reference genome is constructed by extending the human genome with a collection of artificial chromosomes, each presenting the genomic dna sequence of one hla allele. the corresponding genomic sequences at hla-a, b, c, dqa <dig>  dqb <dig> and drb <dig> loci on the chromosome  <dig> of the human genome are masked by n’s to avoid redundancy. it is logical to consider the regions outside the hla loci as part of the reference during the initial mapping, as the input sequencing reads are originated genome-wide. the running parameters for bowtie  <dig> are set at --very-sensitive in the --end-to-end mode and otherwise remain default. after the mapping, the coordinates of the mapped reads and all hla alleles are converted to their corresponding genomic positions on chromosome  <dig> in preparation for the subsequent procedures. we chose bowtie  <dig> for its flexibility to handle various read lengths. we find that changing the mapping engine to bowtie  <cit> , when the read lengths are applicable to it, do not alter the performance of phlat significantly .

the following hla type prediction consists of two major steps: a selection of candidate alleles  and a likelihood based ranking over all pairs of the candidate alleles . this combination aids both the accuracy and the efficiency of the algorithm. the allele selection eliminates the majority of the false alleles and their accompanying reads to minimize the mapping errors at a given locus. it also reduces the computational cost in the subsequent likelihood based ranking in which every pair-wise combination of the alleles is evaluated.

the candidate allele selection involves a few iterations of read counting. first, upon the bowtie  <dig> mapping results, the number of reads mapped to each allele is counted. a coarse pre-selection of possible alleles is executed according to a simple upper quantile threshold  of the read counts . to be conservative, we retain all alleles sharing the same four-digit identity as long as one member of such alleles is selected. these alleles will be refined in following steps.

next, we re-compute the number of reads mapped to each of the retained alleles as following . every mapped read is evaluated against all retained alleles that overlap with it. the read can only be counted for the allele to which it matches best , judging by the sequence identity over the snp sites covered by this read at a given locus. in addition, the sequence identity over the snps is required to be at least 99% to count a read for any allele. the snp sites of a locus refer to the union of the polymorphic sites in the retained alleles at that locus, excluding the sites that coincide with any indels in the kept alleles to avoid bias in calculating mismatches . a read is considered optimal for its target alleles if it satisfies all above criteria. otherwise, it is suboptimal. we find that excluding the suboptimal reads helps reduce false alleles in the selection.

last, the read counts of the alleles in the same protein group are summed non-redundantly and used for candidate allele selection . a protein group refers to the set of alleles that encode the same protein with identical amino acid sequences. in other words, these alleles are identical at the four-digit resolution. as we aim for the four-digit hla typing, it is convenient to use the protein group as a unit to select or drop candidate alleles. the grouping is only applied at this selection step. afterwards, the selected alleles are considered individually regardless of their protein groups. to start the candidate allele selection, for a given locus, the protein groups are first sorted in descending order by their read counts, referred here as the level  <dig> ranking. the top group  with the largest read counts are recorded and all associated alleles are selected as candidates. to tolerate uncertainties in the read mapping and counting, especially when the sequencing depth is limited or the true and false alleles are much alike, we also include the alleles from the second top ranking protein group at level  <dig> if it holds a non-negligible amount of unique reads  that are not shared with the top group. next, the read counts in the remaining protein groups are adjusted by excluding the reads shared with all selected alleles at level  <dig>  the adjusted read counts are sorted in a descending order  and the new top groups are selected. if the alleles selected by the level  <dig> and level  <dig> ranking do not explain most of the reads mapped to the locus , the procedure is repeated  and the alleles from the new top protein group that can effectively account for the remaining reads  are selected. though the thresholds are empirical, they function well according to the results in our large collection of benchmarking tests.

the statistical significance of the selected candidate alleles is estimated based on the read counts. sequencing count data usually follow poisson or negative binomial  distributions. in our case, we observe that gaussian distributions are good approximations as the number of reads mapped to the alleles is sufficiently large after the pre-selection . in terms of read counts, the top ranking protein groups at each level  essentially represent the outliers at the high extreme with respect to a gaussian distribution formed by the lower ranking groups. we model the gaussian distributions at each level by estimating means and variances of the read counts, and derive one-tailed z-test p-values for the selected protein groups accordingly. all candidate alleles within each group share the same p-value. note that we do not use p-values to determine final hla types. nevertheless, we report them for the most likely pair of alleles to illustrate how significantly they surpass the background regarding to the read counts.

at the end of the selection, we only include the candidate alleles and their associated reads for the subsequent analysis. typically a few tens of alleles remained. this number is small enough for an exhaustive likelihood calculation over all pair-wise combinations  of the alleles to discover the most likely pair. phlat is designed to report a prediction at the highest resolution that is resolved upon the input data, as described below. to start, each allele in the pair-wise likelihood evaluation is kept at its nucleotide  resolution. at the end of the evaluation, if one single pair of full-digit alleles has the highest likelihood, phlat will output it as is. on the other hand, if multiple pairs are equally likely, phlat will sequentially go over different resolutions from high to low  and check if the multiple pairs converge at each of the descending resolutions. it stops when a consensus allele pair is achieved and outputs it as the final result. for example, if a locus has multiple valid allele pairs that diverge at the six-digit, phlat produces a consensus four-digit call as the final outcome. as we are targeting the four-digit hla typing in this study, any locus with a consensus allele pair that is achieved at four-digit or higher resolution is considered unambiguously typed. if a consensus allele pair is not obtained at a resolution of at least four-digit, phlat will report the multiple allele pairs and hence the locus is considered unresolved . subsequently, the unresolved predictions are considered incorrect in our accuracy calculation.

the likelihood score model is constructed as following. as shown in eq.  <dig>  the total log-likelihood score  for a pair of alleles integrates the likelihoods of the allele pair given the observed data over individual snp sites  and across multiple sites , together with the baseline probability of the allele pair in human . the likelihood model is inspired by a previous work  <cit> . here we have modified the calculation of llgeno by considering only the snp sites instead of all available sites at a locus. further, we formulate llphase differently .  <dig>  

based on a widely-used bayesian model  <cit> , the posterior log-likelihood  is proportional to the conditional log-likelihood logp, which is the log-probability of observing the piled up bases  given the genotype of the allele pair interested  at site i. the marginal prior logp is assumed constant for any genotype and therefore is not shown explicitly. p is the product of individual conditional log-likelihoods of observing a base j at site i,  .  <dig>  

where qj is the error rate converted from the phred score of the base j.

the phase likelihood across snp sites is modeled analogously to the genotype likelihood of one snp site. for two sites, there are  <dig> possible mismatch  states and  <dig> matching  state, in contrast to the  <dig> mismatches and  <dig> match for a single site .

the allele frequencies for the major class i and ii loci are retrieved from the allele frequency net, which is presumably the most reliable source of hla allele frequencies up to date  <cit>  and has been used in previous studies  <cit> . all alleles in one protein group share the same frequency that equals to the maximum frequency reported for any allele in that protein group among europe, north america, asia and africa populations. llfreq is computed as the sum of the log-frequencies of the two alleles.

in the likelihood model, llfreq is a component based on prior knowledge other than the input data. incorporating prior knowledge is a common strategy in building probabilistic models. for example, integrating known pathways or protein-protein interactions together with the data from perturbation measurements is often used to infer probable regulatory networks  <cit> . prior knowledge of the possible movements among protein residues and backbones also improve the efficiency and accuracy of protein folding predictions via monte carlo simulations  <cit> . in the case of the hla typing, the probability model utilizes the prior frequency to capture the fact that the distribution of hla alleles in human population is uneven to start with. notably, the prior probabilities are never used alone. the complete likelihood model combines the prior probability with the sequencing data to derive the posterior probability of the alleles. in the model, we find that llfreq is significantly smaller than the data-driven llgeno and llphase terms by a few orders of magnitude. thus, it may impact the prediction only when the data cannot provide sufficient information to distinguish different alleles at four-digit resolution. in this situation, the basic logic of a probability model is to output the most likely allele according to the prior probabilities, as no evidence from the data suggests otherwise. we have conducted an experiment to access whether the phlat predictions are driven by the data or by the prior probabilities. more specifically, over the hapmap rnaseq, the  <dig> genome wxs and the hapmap wxs datasets , eliminating the llfreq component from the likelihood model introduces nine alleles that are unresolved  at four-digit . as unresolved predictions are considered incorrect, it corresponds to a small overall accuracy drop of  <dig> %. the results suggest that including the llfreq term does not significantly affect the phlat predictions, as there are only limited circumstances where the data are inadequate to infer the alleles at four-digit. we choose to keep llfreq for the completeness of the model.

RESULTS
accurate four-digit hla typing is critical in fundamental research, diagnosis, treatment, and prevention of immunological and other diseases, as well as in many clinical applications. the massive accumulation of genome-wide sequencing data provides a new rich source for hla analysis. nevertheless, few existing bioinformatics tools can infer accurately the four-digit hla types from various genome-wide “omics” data with diverse read lengths and depths. compared to the amplicon sequencing, genome-wide sequencing faces more difficulties in mapping a read to the allele that originates it. thus, inferring hla alleles based on the number of mapped reads, as taken by some earlier approaches  <cit> , can be error-prone. in contrast, phlat utilizes but not limits to the read counting. it first pins down to the candidate alleles by the read counts, which helps minimize the false alleles and the unreliable reads as well as reducing the complexity in the subsequent computations. phlat then examines the posterior likelihoods of the alleles given the observed data. combining the allele selection and the likelihood scoring marks the uniqueness of the phlat algorithm. below we benchmark the performance of phlat together with other methods using multiple public and in-house datasets. we observe that phlat outcompetes most of the existing methods over a wide range of read lengths and coverage.

phlat leads the four-digit typing accuracy using transcriptome sequencing data
the hapmap rnaseq data employs paired-end  <dig> bp reads. with the rapid advances in sequencing technology, such short read length may not be often implemented in transcriptome studies nowadays. nonetheless, this dataset represents one of the largest cohorts with experimentally validated hla genotypes available at both class i and ii loci and at high resolution. for this reason, it has been used to benchmark hla prediction algorithms in multiple studies. in addition, we consider the case of the  <dig> bp reads for the purpose of evaluating the algorithms in a systematic manner. the results may also provide a useful reference for hla predictions using historical rnaseq data that more often applied short reads. rnaseq datasets with longer sequence length  are examined as well .

it is often difficult to infer genotypes using very short reads , as they are at the low extreme of mappable read lengths  <cit> . the difficulties augment at the highly polymorphic hla loci. four-digit predictions by previous algorithms using the hapmap rnaseq data are not very accurate . the seq2hla method is not designed to resolve four-digit hla types and only reports a 32% accuracy  <cit> . there is no published result from hlaminer on this data so we apply the program locally. we only execute the alignment mode of hlaminer because the contig assembly mode fails to run on the short reads. the resulting apparent accuracy, if ignoring the ambiguities, is low . the accuracy calculated by the standard definition in this work is lower . hlaforest reaches a higher but still moderate prediction accuracy of  <dig> %  <cit>  .table  <dig> 
prediction accuracy of phlat and other methods in benchmarking datasets


the accuracies and apparent accuracies are calculated as described in methods. the accuracies of the existing methods are taken from their original publications if the datasets were examined therein, otherwise are derived by applying the methods locally . the four-digit accuracy of seq2hla in hapmap rnaseq dataset  is taken from the main text of its publication  <cit> . for all other datasets, seq2hla is applied only at two-digit resolution. the accuracy of seq2hla predictions is calculated without any p-value threshold. it produces less false negatives and hence higher accuracies than if imposing a p-value cutoff of  <dig>  as described earlier  <cit> .



using the same data, phlat infers  <dig> % of the four-digit hla types correctly at the class i loci and  <dig> % overall for both class i and ii loci , outcompeting the existing methods significantly. phlat controls very well the homozygous calls. among  <dig> homozygous loci  at four-digit resolution, merely  <dig> are mistyped to be heterozygous . on the other hand, majority of the mistyped alleles are accurate at the two-digit resolution. overall, only  <dig> out of the total  <dig> alleles at two-digit resolution are incorrect, corresponding to an accuracy of  <dig> %. in comparison, the two-digit accuracy of previous methods is no more than  <dig> % .

the advantage of phlat is confirmed in two additional transcriptome datasets with longer sequence length : the geuvadis rnaseq data , and the crc rnaseq data . details of the two datasets are described in methods. compared to the original the hapmap rnaseq, the new geuvadis study provides a more up-to-date data resource for the cohorts whose four-digit hla types are available at the major class i and ii hla loci. the ~ <dig> bp read length is also widely adopted in current transcriptome sequencing studies  <cit> . we therefore repeat the evaluation of the algorithms using the geuvadis rnaseq data. we observe that phlat remains the best performer . the four-digit typing accuracy of phlat is  <dig> %, whereas it is no greater than  <dig> % in other programs. the two-digit prediction by phlat is also the highest  among the tested programs. similar conclusions hold for the crc rnaseq data using reads of  <dig> bp . phlat outputs a four-digit accuracy of  <dig> %. the number is slightly better than that of hlaforest   <cit> . it notably surpasses the accuracy of hlaminer according to our standard definition . in addition, phlat continues to lead the two-digit prediction with an accuracy of  <dig> %, followed by hlaforest and seq2hla then hlaminer at  <dig> %,  <dig> % and  <dig> %, respectively.

phlat offers a high precision in hla typing using exome sequencing data
we next evaluate phlat and other methods using two whole exome sequencing  datasets from the  <dig> genome and the hapmap projects. both studies employed paired-end sequencing reads of ~ <dig> bp. using the  <dig> genome wxs data, we are able to evaluate one hundred alleles of both class i  and class ii  loci. genotypes of these alleles by sanger sequencing from a previous study are used as the reference  <cit> . the subjects in the  <dig> genome wxs data are from khv, pel, acb, ibs and asw ethnic groups.

as shown in table  <dig> and additional file 4: table s <dig>  five out of the one hundred alleles are mistyped by phlat at the four-digit resolution, corresponding to an accuracy of 95%. three of the five mistyped alleles are incorrect at the two-digit resolution, giving a two-digit accuracy of 97%. the predictions from other tested algorithms are less accurate. for example, the second best four-digit and two-digit accuracies, which are both offered by hlaforest, are  <dig> % and 95%, respectively. notably, the four-digit accuracy of hlaforest drops compared to that in the hapmap rnaseq data above , despite the longer read length in the  <dig> genome wxs . nonetheless, it has been acknowledged that hlaforest is optimized for transcriptome sequencing such that its accuracy on exome data can be lower  <cit> . the results of hlaminer are taken from an earlier publication  <cit> . therein it was feasible to apply the assembly mode, as the  <dig> bp read length is significantly longer than the  <dig> bp used in the hapmap rnaseq data. with the longer reads, hlaminer reaches an accuracy of  <dig> %, better than that in the hapmap rnaseq data .

the hapmap wxs data contains fifteen hapmap individuals from ceu, jpt and yri populations. compared to the  <dig> genome wxs data, the sequencing depth in hapmap wxs is reduced despite the similar read length . at the hla loci, the post-mapping fold coverage is ~60x, whereas the  <dig> genome dataset has a ~190x coverage. although this fold coverage is considered decent for genotyping in general, its adequacy for hla typing may vary in different algorithms.

the performance of all methods in the hapmap wxs data is summarized in table  <dig> and additional file 5: table s <dig>  for hlaminer we report the results from the assembly mode because it delivers better predictions than the alignment mode. the improvement may be attributed to the longer contigs assembled  that produce better sequence alignments with the hla alleles than the individual reads. at four-digit resolution, the standard accuracy of hlaminer is  <dig> %. hlaforest is also executed locally on the same data with default settings, resulting in an accuracy of  <dig> %. the reduced read coverage may have impacted the performance of hlaforest and further lowered its accuracy relative to what is noted in the  <dig> genome wxs data above . in comparison, phlat handles the hapmap wxs data better than the other methods, yielding a higher four-digit typing accuracy of  <dig> %. phlat gives a two-digit accuracy of  <dig> %, slightly exceeding seq2hla  and considerably better than hlaminer  and hlaforest .

application of phlat to targeted amplicon sequencing data
phlat uses bowtie  <dig> to handle reads up to a few hundreds of base pairs. it is thereby readily applicable to targeted amplicon sequencing data. we test phlat on a paired-end 250 bp amplicon sequencing dataset of five samples generated in-house . for a total of  <dig> experimentally validated alleles at hla-a and hla-b loci, phlat is 100% correct at both two-digit and four-digit resolutions . none of the previous methods tested here except hlaminer are able to process the data, because the bowtie aligner used therein does not operate on such long reads. the amplicon reads are flanked by intron sequences at the 3’ or 5’ ends. when using hlaminer to predict hla types, we first trim the intronic portions and then apply the assembly mode with a cds reference. this procedure yields better results than other attempts using the alignment or assembly mode with a genomic reference on either the trimmed or original amplicon reads. we have obtained an accuracy of 50%  at the four-digit resolution for hlaminer. it is considerably lower than that of phlat. it is worthwhile to point out that these prediction accuracies are obtained for only the hla-a and hla-b loci tested here and are also limited by the sample size. from the results, it is encouraging to see that the algorithm can handle both genome-wide and targeted sequencing data.

characterization of the mistyped alleles
mistyped four-digit alleles in phlat are collected from the hapmap rnaseq,  <dig> genome wxs and the hapmap wxs datasets, and are summarized per allele type . in particular, we are interested to investigate whether certain allele types are enriched, and if so, whether the algorithm or other reasons introduce them. at the hla-a, b, c and drb <dig> loci, almost all the alleles have a limited sample size  and mistyping incidents . thus, we do not conclude any enriched allele type. most of these incorrect predictions appear to be due to the general difficulty in distinguishing alleles with high sequence similarity, and in dealing with data noise due to limited coverage or read length. for instance, a*23: <dig> diverges from a*23: <dig> only at chr6:  <dig> position , c*16: <dig> varies from c*16: <dig> at chr6:  <dig> , and a*02: <dig> is different from a*02: <dig> at chr6:  <dig> and  <dig> positions . other similar incidents are from a*25: <dig>  b*81: <dig>  b*35: <dig>  c*03: <dig>  c*07: <dig>  c*15: <dig>  drb1*14: <dig> alleles and one of the c*12: <dig>  and drb1*15: <dig>  alleles. the incorrect predictions of alleles a*02: <dig>  a*66: <dig> and drb1*04: <dig> occur in samples with the coverage at the low end . the misidentifications of the b*08: <dig>  b*55: <dig> alleles and the rest incidents of c*12: <dig> and drb1*15: <dig> alleles occur in the 2× <dig> bp hapmap rnaseq data but are resolved in the 2× <dig> bp geuvadis rnaseq data, suggesting that they are likely due to noise in certain input data. in fact, majority of the errors at the class i and hla-drb <dig> loci from the hapmap rnaseq  are corrected in the geuvadis rnaseq. all the mistyping errors of the drb1*15: <dig> allele are among them. thus, despite observing a prediction accuracy below 90% for the drb1*15: <dig> allele , we expect that phlat can type this allele more accurately when longer sequence reads are adopted.figure  <dig> 
analysis of frequently mistyped alleles.  the histograms illustrate the type  and the number  of the misidentified alleles at the hla-dqa <dig>  and hla-dqb <dig>  loci, summarized over the hapmap rnaseq, the  <dig> genome wxs and the hapmap wxs datasets.  visualization of the mapped reads in one representative sample  where the hla-dqa1*03: <dig> allele is mistyped as the hla-dqa1*03: <dig> allele. the mapped reads are shown around the single snp position  that distinguishes the two alleles. the hg <dig> reference sequence of the hla-dqa <dig> gene is shown at the bottom of the panel. the nucleotide bases a, c, g, t are colored in green, red, blue grey and blue, respectively. the bases in the reads, if different from the reference sequence at the aligned positions, are visualized in the same color code. the pileup counts of the a, c, g, t bases at the highlighted snp are  <dig>   <dig>   <dig> and  <dig>  respectively.  the alignment of a 135-nucleotide segment from the hla-dqa1*03: <dig> allele, noted as the query, with the hla-dqa <dig> reference sequence in human genome hg <dig>  the query sequence is simplified as a horizontal bar with only the mismatches indicated. the existing dbsnp record at the mismatch is labeled with a red vertical marker and the associated identification numbers  followed by a parenthesis indicating the major and the alternative base sequences. the alignment of the snp that differ the dqa1*03: <dig> and dqa1*03: <dig> alleles is boxed.



nonetheless, at the hla-dqa <dig> and hla-dqb <dig> loci, we observe a few specific alleles dominant the observed prediction errors. as shown in figure 2a, among a total of twenty faulty predictions at hla-dqa <dig>  ten hla-dqa1*03: <dig> alleles are typed as hla-dqa1*03: <dig>  and six hla-dqa1*05: <dig> alleles are mistaken as hla-dqa1*05: <dig>  at the hla-dqb <dig> locus, five hla-dqb1*02: <dig> alleles are called as hla-dqb1*02: <dig>  these mistakes account for >80% of all false predictions at the hla-dqa <dig> and hla-dqb <dig> loci. these alleles also exhibit low prediction accuracies in this study . although the real and predicted alleles are highly homologous in sequence , a few observations below suggest that these errors may not be random.

first, we find that other algorithms, hlaforest and hlaminer, exhibit a similar tendency to mistype dqa1*03: <dig> as dqa1*03: <dig> in the same samples miscalled by phlat . hlaforest makes identical errors as phlat in seven samples. the output from hlaminer, dqa1*03:01p, is a p-designation annotation  <cit>  that groups dqa1*03: <dig>  dqa1*03: <dig> and a few other alleles. rerun of hlaminer without the p-designation reveals that indeed dqa1*03: <dig> is the most confident prediction in all the samples mistyped by phlat. as the same mistakes occur in the algorithms that implement different aligners, e.g. bowtie  <dig> for phlat, bowtie  <cit>  for hlaforest and bwa  <cit>  for hlaminer, we may rule out that the errors are caused by a specific alignment engine. indeed, changing the aligner to bwa in phlat does not alter the output in any affected sample. these results suggest that the problem may not be due to the computational strategy or aligner choice in the algorithm.

we next find that the dqa1*03: <dig> inference is supported by a decent amount of reads in all cases. figure 2b illustrates the read mapping details around the single snp site differentiating the dqa1*03: <dig> and dqa1*03: <dig> alleles  in one representative sample where such a mistyping occurs . the second allele in this samples is dqa1*02: <dig>  whose sequence is c at this position. these reads have passed through the phlat pipeline and are used for the hla prediction. in sample na <dig>  about half of the bases are a’s, resulting a heterozygous genotype of ac. hence, inferring a dqa1*03: <dig> allele, together with a dqa1*02: <dig> allele, is convincing given the data. similar observations hold for all other samples with dqa1*03: <dig> predictions. further, phlat reports the same mistakes for the corresponding samples in the geuvadis dataset . it suggests that the errors may not simply due to random noise in the data.

it is possible that the reads supporting the alternative allele are originated from elsewhere in the genome. a blast query using a 135-nucelotide segment  harboring the snp site  from the hla-dqa1*03: <dig> allele returns the top full length hit located at the exon  <dig> of the hla-dqa <dig> gene. there is no other mismatch except the very snp site between the two alleles within this region . imgt database does not include any hla-dqa <dig> entry due to the limited knowledge of its alleles. consequently, all previous algorithms have no hla-dqa <dig> sequence in their mapping reference. phlat extends the reference to the whole genome. yet it only includes the sequence of one specific hla-dqa <dig> allele used in the hg <dig> genome and thereby not fully capturing its polymorphisms either. given the high sequence homology and the lack of complete allelic references of hla-dqa <dig>  misaligning the reads of the hla-dqa <dig> gene to the hla-dqa <dig> gene is a non-negligible possibility. in fact, there is a common c-to-a missense snp of the hla-dqa <dig> gene  at chr6:  <dig>  the matching site in the sequence alignment for the dqa1*03: <dig> allelic snp. thus, if a subject happens to carry a specific hla-dqa <dig> allele with the rs <dig> snp, the resulting reads may be falsely taken as from an hla-dqa1*03: <dig> allele.

analogous observations exist for other two frequently mistyped alleles, hla-dqa1*05: <dig> and hla-dqb1*02: <dig>  phlat, hlaminer and hlaforest  all misidentify them as hla-dqa1*05: <dig> and hla-dqb1*02: <dig>  respectively, in five samples . there are three snps driving the dqa1*05: <dig> calls at chr6:  <dig>  chr6:  <dig> and chr6:  <dig>  each of them has a significant number of mapped reads supporting the dqa1*05: <dig> allele . further, each snp is located within an exon segment  homologous to the hla-dqa <dig> gene . these segments are of 72– <dig> nucleotides in length and differ from the hla-dqa <dig> sequence  at 2– <dig> chromosomal positions. all the positions in the hla-dqa <dig> gene have a dbsnp record wherein the alternative base matches the sequence in the dqa1*05: <dig> allele. thus, it is possible to confuse the reads from the hla-dqa <dig> and hla-dqa <dig> loci regarding to these regions. similar story holds for the snp favoring the hla-dqb1*02: <dig> allele over the hla-dqb1*02: <dig> allele . it is inside a homologous region of  <dig> nucleotides between the hla-dqb <dig> and hla-dqb <dig> genes . hla-dqb <dig> alleles are poorly studied and not recorded in imgt database either.

collectively considering the results above, we reason that misaligning the reads from the minor hla-dqa <dig> and dqb <dig> loci to their homologous major hla-dqa <dig> and dqb <dig> loci, respectively, may have led to the unusual high frequency of the mistyped hla-dqa <dig> and dqb <dig> alleles. this limitation is independent of the algorithms and thereby explaining their consistent mistakes. experiments may be conducted in the future to examine the sequence of the hla-dqa <dig> and dqb <dig> loci in the indicated samples. algorithm wise, incorporating the allelic sequences of hla-dqa <dig> and dqb <dig> in the mapping reference may alleviate the problem. currently implementing this fix is difficult due to the lack of allelic information of the hla-dqa <dig> and dqb <dig> genes. nevertheless, it may be less a concern when using data with paired-end reads of 100 bp or longer, as the homologous regions discussed here are around  <dig> nucleotides. long sequencing reads may extend into surrounding less homologous regions to reduce the misalignment. for now, we recommend users of phlat or other existing algorithms to validate hla-dqa1*03: <dig>  hla-dqa1*05: <dig> and hla-dqb1*02: <dig> allele types by sanger or targeted amplicon sequencing, if they observe such predictions and are interested to follow up their biology significance. we may also include intronic snps and allow read mapping across splicing junctions in the future to leverage the distinguishing power between the alleles.

candidate allele selection contributes most to the prediction accuracy
phlat implements three major procedures to help leverage the prediction accuracy: extending mapping reference to include genome sequences outside the hla loci of interest, applying stringent criteria to define the optimally mapped reads for an allele, selection of candidate alleles based on the counts of the optimal reads. we here estimate the contributions to the accuracy from the three components in order to highlight the most important one. the impact of the candidate allele selection is estimated by disabling the corresponding procedure in phlat and measuring the consequent decrease in accuracy. using a genome-wide mapping reference and identifying the optimal reads are pre-processing steps before the selection of candidate alleles. we therefore estimate their contributions by the further decrease in the prediction accuracy when revoking these procedures in the absence of the candidate allele selection. to void the genome-wide mapping reference, we change to a reference genome that consists of only the interested hla loci. for the optimal read identification, we relax the sequence mismatch stringency to 10% per read, which approximates the mismatch rate allowed in bowtie  <dig> 

over the hapmap rnaseq, the  <dig> genome wxs and the hapmap wxs datasets, the average accuracy contributions by mapping to a genome-wide reference, identifying optimally aligned reads, and selecting candidate alleles are  <dig> %,  <dig> %, and  <dig> %, respectively. the selection of candidate alleles appears to be most influential. phlat selects candidate alleles by the number of the reads optimally mapped to them. this procedure does not intend to determine precisely the best pair of alleles for a locus. instead, the purpose is to eliminate the likely false alleles and their associated reads. keeping the false alleles and their reads introduce more noise to the likelihood score calculations and eventually yield more faulty predictions. given the largest impact to the prediction accuracy, we consider that the candidate allele selection is the key component of the phlat algorithm.

in the pre-processing stage, phlat applies a genome-wide reference for bowtie  <dig> mapping, and refines the mapped reads using a stringent threshold for mismatches. including the genomic sequences outside the hla loci in the mapping reference is one unique feature of phlat. when the reads are generated genome-wide, it is rational to search the best alignment position over the whole genome, in order to reduce mapping errors in the first place. indeed, the contribution of a genome-wide reference to the prediction accuracy is notable . this design is especially useful for hla typing using genome-wide sequencing data. it may not be a significant factor for the targeted sequencing where the reads originate specifically from the hla loci. as a test, the prediction accuracy in our miseq amplicon sequencing dataset remains unchanged with either the genome-wide or hla-specific mapping references. phlat also focuses on the optimally mapped reads that hold the most power in differentiating various alleles. in particular, only the reads that are optimal for a given allele are considered for the subsequent analysis. an optimal read requires that no more than 1% of the snp sites covered by the read are mismatches. the accuracy drops by  <dig> % without this stringent threshold. analogous observations have been reported in a few earlier studies, wherein accepting fewer mismatches in the alignment generally improved the typing accuracy  <cit> . one study also applied a similar, small mismatch rate  during the read alignment  <cit> .

these results highlight that pre-processing is important for the quality of hla type inferences. as the pre-processing is often the first step of a hla typing algorithm, noise induced by the incorrectly mapped reads may mislead all downstream processes. many standard alignment tools and pipelines, such as bowtie, bwa, tophat and gatk  <cit>  have been established with vast successes in general analysis of genome-wide sequencing data. nevertheless, simply following these standards may not be enough when dealing with the hla loci that are the most polymorphic regions in the human genome. we have shown that it is useful to reduce misaligned reads originated from non-hla loci, and to use only the best reads with very limited mismatches. in the future, improvement of the existing strategies and development of new ones are expected to further advance the hla typing quality. for instance, it may be helpful to extend the reference with multiple copies of the regions outside yet homologous to the hla loci to capture their polymorphic variations, together with the better documented allelic sequences of the minor hla genes, improve the general mapping sensitivity of the aligners, and reduce amplification induced bias in the reads.

practical factors in data generation that impact the hla inference
the benchmarking data offer us test cases with read lengths ranging from  <dig> to 250 bp and fold coverage from ~60x to ~330x. in addition, the pair-end reads can be used as the single-end reads to evaluate the allele identification under different sequencing protocols. we consolidate the outputs of phlat from these datasets to systematically investigate how the sequencing parameters impact the accuracy of the hla inference. such knowledge not only summarizes the performance of our algorithm, but also provides a guideline for future experiment design and data generation. figure  <dig> illustrates the results from three datasets: the hapmap rnaseq , the  <dig> genome wxs  and the hapmap wxs  . for each dataset, the samples are binned by their post-mapping fold coverage at the hla loci . the y-coordinates of the symbols represent the mean accuracy at four-digit resolution of the samples within each bin, with error bars indicating the variance. we also process each paired-end sequencing dataset  under the single-end assumption  by ignoring the paired relationship between the reads. the trend of the symbols is illustrated via spline interpolation.figure  <dig> 
impact of read length, coverage and sequencing protocols on hla typing accuracy. the plot summarizes the hla typing accuracy of phlat using samples from the hapmap rnaseq , the  <dig> genome wxs  and the hapmap wxs  datasets. prediction accuracies are calculated by considering the sequencing data as either paired-end  or single-end . the symbols represent the mean accuracy at four-digit resolution of the samples that are binned by their fold coverage at the hla loci, with the error bars indicating the variance. the post-mapping fold coverage is calculated regarding to the cds regions of the major class i and ii hla loci, excluding the reads suboptimal or not aligned to the candidate alleles. the smooth lines by spline interpolation illustrate the trend of the symbols.



figure  <dig> shows an ascending trend of the accuracy with the fold coverage. it suggests that the hla prediction accuracy positively correlates with the fold coverage, consistent with previous observations  <cit> . this dependency may help estimate an empirical threshold of the coverage for phlat to reach a desired performance. for instance, to achieve an accuracy of no less than 90% in the paired-end sequencing , around 50x coverage may be needed, with a safer choice of about 100x coverage.

by ignoring the paired relationship and thereby treating the reads as single-ended, we observe a non-negligible systematic reduction in the prediction accuracy for all datasets. earlier studies observed a similar accuracy decline by changing the reads from paired-end to single-end  <cit> . in addition, the decrease augments by shortening the read length. in figure  <dig>  the accuracy in the hapmap wxs data drops from >90% for the paired-end reads to ~85% for the single-end reads . the decrease is more dramatic in the hapmap rnaseq data: from 90-95%  to 70-90% . these observations highlight the importance of the paired-end sequencing protocol in hla typing. the advantage of the paired reads primarily originates from the effectively doubled read length that leverages the mapping accuracy. on the other hand, when the length of a single read becomes sufficiently long, the difference between the paired-end and single-end protocols may diminish. in the 250 bp targeted amplicon dataset, we mistype merely one allele by treating the reads as single-ended  instead of pair-ended.

future extensions
phlat outputs the allele types at the highest resolution that is resolved upon the input data. currently phlat uses a cds-based reference for hla inference steps and thereby typically delivering a four- to six-digit prediction that corresponds to the non-synonymous and synonymous coding variants, respectively. nevertheless, the algorithm itself permits full resolution typing, as long as the reference sequences and the observed data are available at the genomic regions that differentiate one allele from the others. in the future, it is straightforward to include introns and utr sequences for more accurate or higher resolution typing when such data become more complete. phlat can also be applied to the minor class i and ii hlas by appending the corresponding reference sequences.

CONCLUSIONS
high resolution hla typing is essential in many areas of immunology, such as hematopoietic stem cell transplant, immunogenic screening and vaccine design. recent technology advances and cost reductions in next generation sequencing have led to a rapid replacement of the locus-specific genotyping by the genome-wide sequencing in both fundamental research and clinical applications. thus, inferring hla types from transcriptomic, exomic or genomic data will not only take good usage of the rich information embedded therein, but also supplement the genetic interpretation of the “omics” data themselves. though a few computational methods have emerged, accurate high resolution hla typing remains challenging. few method can perform consistently well for both rna and dna sequencing and with various read lengths and sequencing depths.

to help overcome the limitations in the typing accuracy and flexibility, we have developed the phlat algorithm and benchmarked it in comparison with most of the methods published previously. the benchmarking data include a large number of hla alleles with experimentally validated four-digit genotypes , from both rna and dna sequencing and with various read lengths  and coverage . these data allow us to rigorously access the quality of different methods and develop practice guidelines for hla inference. in all tested datasets, phlat holds the best prediction accuracy at four-digit and two-digit resolutions. the accuracy improvement is substantial in many cases . phlat also succeeds in a targeted amplicon study and predicts the hla types with zero mistakes, whereas other methods either cannot process the long amplicon reads or mistype half of the alleles. considering collectively the accuracy and flexibility, phlat appears to be a leading method for hla typing based on genome-wide sequencing.

our algorithm has a few unique features. in the pre-processing stage, two approaches are taken to reduce possible mapping errors. one is to incorporate the genomic regions outside the hla loci in the reference for the initial bowtie  <dig> mapping. the other is to apply a stringent criterion to recognize the optimally mapped reads for analysis. we have estimated that the prediction accuracy can decline by 6%-7% without either of the procedures. moreover, phlat implements a candidate allele selection prior to the calculation of the likelihood scores. the selection effectively eliminates a large number of the false alleles and their associated reads that are likely unreliable. this step appears to contribute most to the prediction accuracy. in the absence of the candidate allele selection,  <dig> % reduction in the accuracy is observed. the selection also greatly reduces the number of alleles such that the pair-wise evaluation becomes tractable. it permits phlat to infer a pair of alleles simultaneously. some existing methods infer each of the alleles sequentially  and thus may miss the best solution when both alleles are considered as a whole. the advantage of predicting a pair of alleles has been recognized in a recent publication  <cit> . the combination of these attributes has led to the high performance of phlat as well as distinguishing it from the previous methods .

the systematic evaluation of phlat helps develop some best practices for hla typing using the genome-wide data. for example, a paired-end protocol is highly desirable. a fold coverage of 100x or higher is ideal. the read length can be flexible given a paired-end protocol and under an applicable coverage. such information may assist optimizing the experimental design in the future for the best utilization of the data.

the framework of phlat is suitable to support the hla typing at up to the nucleic acid level . currently it focuses on the variations within the cds regions and therefore the four- to six-digit typing. nevertheless, it is straightforward to extend phlat to higher resolution in the future by including the intron and utr sequences of the alleles into the reference. other future improvements may be to construct a better mapping reference with more complete polymorphic sequences in regions homologous to the hlas, remove amplification artifacts in the data, and utilize the reads across the splicing junctions.

as the field moves quickly into a personal genomics era, genome-wide sequencing progressively becomes a routine for individuals participating in research projects, medical practices, and clinical trials. we expect that phlat, as a useful method for high resolution hla typing, help leverage the application of the massive sequencing data in the existing and future human genetics studies. especially, our method will add value to the studies where next generation sequencing data are available and hla type information is essential but not available. the resulting genotype of the hla loci will facilitate the fundamental research in immunology and associated diseases. high resolution hla typing is also essential in many clinical procedures as discussed in the background, such as organ and hematopoietic stem cell transplantations, peptide-based vaccines and adoptive t cell transfer approaches for cancer immunotherapies. although pcr-based typing method is a common choice in the current practice, the ngs-based typing techniques gain growing attentions given the significantly higher throughput, continuous cost reduction and increasing read length and quality. our phlat algorithm has many features suitable for the needs of the ngs-based hla typing. it offers a good typing accuracy. it handles both rna and dna sequencing data with various read lengths. besides genome-wide sequencing, phlat also supports targeted amplicon sequencing input. accurate and flexible bioinformatics tools such as phlat may assist the further transition from the low throughput methods to the ngs-based typing techniques. eventually, the high throughput hla typing may accelerate the treatment procedures and benefit the patients.

availability of supporting data
the data sets supporting the results of this article are available in the ebi repository, under accession numbers erp <dig> , erp <dig> , prjna <dig> , prjna <dig> , prjna <dig> , prjna <dig> , prjna <dig> , srp <dig> , srp <dig> , srp <dig> , srp <dig>  and prjeb <dig> .

an implementation of phlat algorithm can be obtained for academic users at https://sites.google.com/site/phlatfortype.

electronic supplementary material
additional file 1: table s1: a ms excel file presents supplementary tables s <dig> referred in the main text. 

 additional file 2: table s2: ms excel file presents supplementary tables s <dig> referred in the main text. 

 additional file 3: table s3: a ms excel file presents supplementary tables s <dig> referred in the main text. 

 additional file 4: table s4: a ms excel file presents supplementary tables s <dig> referred in the main text. 

 additional file 5: table s5: a ms excel file presents supplementary tables s <dig> referred in the main text. 

 additional file 6: table s6: a ms excel file presents supplementary tables s <dig> referred in the main text. 

 additional file 7: table s7: a ms excel file presents supplementary tables s <dig> referred in the main text. 

 additional file 8: table s8: a ms excel file presents supplementary tables s <dig> referred in the main text. 

 additional file 9: figure s1-s4: table s <dig> and equation s <dig> referred in the main text. 

 abbreviations
ngsnext-generation sequencing

hlahuman leukocyte antigen

imgtinternational immunogenetics project database

ebieuropean bioinformatics institute

wxswhole exome sequencing

crccolorectal cancer.

competing interests

the authors are employees of regeneron pharmaceuticals inc. the authors yb and wf filed a provisional patent application for the method described in this work.

authors’ contributions

yb and wf designed the research. yb developed and benchmarked the method. yb and wf drafted the manuscript. bc provided the samples for the targeted amplicon sequencing and generated the sanger sequencing data of the samples. mn and yw generated the targeted amplicon sequencing data. all authors read and approved the final manuscript.

