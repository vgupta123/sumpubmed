BACKGROUND
electron tomography is a rapidly growing technique that produces structural information of organelles and cell compartments at a resolution between  <dig> and 20Å  <cit> . this kind of information helps structural biologists to understand how macromolecular machines interoperate in the cell to perform their functions and is giving rise to what is called "visual proteomics"  <cit> .

this technique relies on the tomographic reconstruction of the object under study from the projection images acquired by the electron microscope. the most popular data collection geometry is a single-axis tilt series  <cit> , although other geometries are also possible like multiple-axis  <cit>  or conical tilt  <cit> . in this article we concentrate on single-axis tilt series. with this technique the sample is tilted around an axis to provide different projection views of the object under study. as the object is tilted electrons have to traverse thicker sections. thus, this technique is normally restricted to a maximum tilt of about 70°. due to mechanical instabilities of the sample holder during rotation, it is possible that some of the images of the series exhibit a large shift with respect to the rest. besides their shift, their relative projection directions must be established before entering the three-dimensional reconstruction process. this basically amounts to determining the tilt axis in each of the images since its exact position may not be the same on each projection.

alignment of the tilt series is usually performed by aligning gold beads that serve as fiducial markers  <cit> . although quite effective when these markers are available, this technique is not always applicable since markers are not always visible or trackable, or because, simply, they are not available  <cit> . alternatively, image corners can be used as fiducial markers  <cit> , or the image information content itself can be used through cross-correlation  <cit> . the image information has been proven to be the most valuable information in image registration  <cit>  and, therefore, algorithms based on cross-correlation with a reference volume or similar techniques are supposed to provide the best results as is the standard case in electron microscopy of single particles  <cit> . however, when aligning tilt series there is no a priori volume that can be used as reference, and for this reason, the algorithm employed must align the images with information exclusively contained in the image series. there are three main possibilities to use cross-correlation in this context of tilt series alignment. the first possibility is to serially align the first image with the second by cross-correlation, the second with the third, etc. this approach compares similar images, although it has the drawback of serious potential drifts  of the alignment parameters resulting in inaccurate estimations of the tilt axis and shift parameters in each of the images. the second option is to use cross-correlation to track features within the tilt series. features are defined as fiducial points in the images  that are searched by cross-correlation in neighboring images. the feature tracking allows to define markers that are visible in only a subsequence of the whole tilt series. the third approach constructs a rough reconstruction of the tomogram and realigns the tilt series with respect to reprojections of the rough reconstruction  <cit> .

we exploit the second option by searching for image regions that can be tracked within a subseries of the tilt series. an overall affine image registration is performed to be able to predict the position of any image region in any of the adjacent images. if all images are numbered according to their tilt angle in the tilt series, a region of image i is sought in image i +  <dig>  first predicting its position through the affine transformation, and then by local refinement of the cross-correlation. once, the region is found in image i +  <dig>  the equivalent region in image i +  <dig> is sought in image i +  <dig>  the algorithm thus propagates a coordinate in image i to images i +  <dig>  i +  <dig>  until the region sought cannot be found anymore because it becomes obscured by other objects, it changes its shape, or the noise does not allow to find it. the same is done backwards. all the coordinates corresponding to equivalent image regions form a landmark chain which most likely does not cover the whole tilt series. landmark chains are further refined to guarantee that they correspond to equivalent image regions. finally, all landmark chains are used to perform a robust regression of the image alignment parameters. an advantage of this approach is that it is fully automatic and it can produce thousands of landmark chains which are used to align the images. we have tested our algorithm with synthetic data as well as experimental cryo electron microscopy data.

the method proposed in this paper differs from other published methods in a number of ways. the algorithm proposed by penczek et al. in  <cit>  is very similar in its basics to the one presented in this paper. our main differences are that we provide a mechanism to automatically estimate landmark positions, our algorithm is based on the use of thousands of short landmark chains , we perform a robust estimation of the alignment parameters, and we provide matrix closed forms of the parameter estimates which are more convenient for implementation. the algorithm described by mastronarde in  <cit>  differs also mainly in our automatic estimation of the landmark positions yielding thousands of short landmark chains. the optimization procedure is also different, ours being more analytical. the approach of brandt in  <cit>  and castaño-díez in  <cit>  differ from ours in the way landmark chains are automatically detected and refined, and the posterior optimization procedure followed to estimate the alignment parameters. their algorithms also perform a robust optimization, although in a different way to ours.

RESULTS
before reading this section we strongly suggest to read the methods section to get acquainted with the terminology and different parameters of the algorithm.

simulated data
in order to test the accuracy of the new alignment algorithm we created a phantom built with mathematical descriptions of cylinders and spheres . the phantom size is  <dig> ×  <dig> ×  <dig> voxels. for the first experiment  <dig> images of size  <dig> ×  <dig> were simulated with a maximum tilt of 60° and a step of 3° between images. the tilt axis passed through the coordinate origin and its direction was defined by the angles α =  <dig> and β =  <dig> . no in-plane transformations were applied to the projections. landmark regions had a size of  <dig> % the total size of the images , a grid of  <dig> ×  <dig> evenly spaced points in each projection image were considered as centers of the landmark regions .

landmark chains were accepted if the correlation coefficient between any two regions being compared was higher than  <dig> , and the total length of the chain was larger than  <dig> images.  <dig> landmark chains were identified with an average length of  <dig>  images.  <dig> landmark chains were used in the last regression iteration. there was an average error between the projection of the 3d landmarks and its observed projections of  <dig>  pixels . to objectively evaluate the quality of the reconstruction performed with the alignment parameters produced by our algorithm, we computed the correlation index of this volume with the volume reconstructed with the ground-truth alignment parameters. the result was  <dig> .

for the second experiment  <dig> images were simulated with a maximum tilt of 60° and a step of 2° between images. the rest of the conditions were as in the previous example except that α =  <dig> . the parameters for our algorithm were identical as in the first experiment.  <dig> landmark chains were identified with an average length of  <dig>  images.  <dig> landmark chains were used in the last regression iteration. there was an average error between the projection of the 3d landmarks and its observed projections of  <dig>  pixels. the correlation between the volume reconstructed with the estimated parameters and the reconstruction performed with the ground-truth parameters was  <dig> .

in the third experiment, images were collected as in experiment  <dig> except that α =  <dig>  the collected images were randomly shifted in x and y by a displacement following a gaussian distribution with zero mean and standard deviation  <dig> .  <dig> landmark chains were identified with an average length of  <dig>  images.  <dig> landmark chains were used in the last regression iteration. there was an average error between the projection of the 3d landmarks and its observed projections of  <dig>  pixels. the correlation between the volume reconstructed with the estimated parameters and the reconstruction performed with the ground-truth parameters was  <dig> .

the fourth experiment was aimed at characterizing the performance of the algorithm under slowly varying drifts. the  <dig> images of the second experiment were used for this last experiment. the first image was rotated - <dig> degrees, the second image was rotated - <dig> degrees, the third image was not rotated, the fourth image was rotated  <dig> degrees, and the fifth image was rotated  <dig> degrees. this sequence  was repeated along the rest of the series. after rotation, the first image was shifted - <dig> pixels in each direction. then, the rest of the images were shifted one pixel vertically and horizontally with respect to its predecessor so that the last image was shifted  <dig> pixels with respect to the first one. our algorithm was run with chain lengths of  <dig>  a correlation threshold of  <dig> , local regions of a size of  <dig> % the total size of the images.  <dig> landmark chains were identified with an average length of  <dig>  images.  <dig> landmark chains were used in the last regression iteration. there was an average error between the projection of the 3d landmarks and its observed projections of  <dig>  pixels. the correlation between the volume reconstructed with the estimated parameters and the reconstruction performed with the ground-truth parameters was  <dig> .

in the last experiment, we checked whether the algorithm was able to work in a noisy environment. the experimental setup was the same as in the previous experiment but we added white noise to the simulated images . the presence of noise significantly lowers the correlation between patches. for this reason we reduced the patch size to only 4% of the image size and lowered our correlation threshold to  <dig> .  <dig> chains were automatically extracted, out of which  <dig> participated in the last regression iteration. the average of the error between the projection of the 3d landmarks and the observed projections was  <dig>  pixels. finally, the correlation between the volume reconstructed with the estimated alignment parameters and the reconstruction performed with the ground-truth parameters was  <dig> .

experimental data
for testing the algorithm with real data a tilt series of a pyrodictium abyssi cell strain tag <dig>  <cit> , which was embedded in a vitreous ice layer  <cit>  on a holey carbon-coated grid, was used. electron tomography was performed using a cm <dig> biofilter  at an accelerating voltage of  <dig> kev. it was equipped with a postcolumn energy filter , operated in the zero-loss mode  <cit> , resulting in increased image contrast  <cit> . the tilt series ranged from -70° to +67° with a tilt increment of  <dig> ° and a total number of  <dig> images. data acquisition was carried out using fully automated procedures under low-dose conditions  <cit> . the images, which were  <dig> ×  <dig> pixels each, were recorded at  <dig> × magnification, with a pixel size at the specimen level of  <dig>  nm. the defocus was set to - <dig> μm; the first zero of the phase-contrast transfer function was at - <dig>  the images collected were not lowpass filtered or deconvolved with the microscope contrast transfer function. our algorithm was run with chain lengths of  <dig>  a correlation threshold of  <dig> , local regions of a size of 4% the total size of the images .  <dig> landmark chains were identified with an average length of  <dig>  images.  <dig> landmark chains were used in the last regression iteration. there was an average error between the projection of the 3d landmarks and its observed projections of  <dig>  pixels. the resulting reconstruction can be seen in fig.  <dig>  for comparison purposes we performed a reconstruction from the same dataset using the standard alignment algorithm based on manual selection of fiducial markers which is shown in fig.  <dig>  for the manual alignment four landmarks were identified along the whole tilt series and tom toolbox was used for the alignment and 3d reconstruction  <cit> . as can be seen, the two reconstructions are not significantly different, although they are not identical. the correlation between the two volumes after registration was  <dig> , however, as can be seen in fig.  <dig>  these differences are not located where the archaeobacteria is and are mainly located in the surrounding structure .

discussion
in this article we have presented a new algorithm for the automatic alignment of electron tomographs. the main idea is the identification of thousands of small landmark chains that clearly correspond to the same point in a number of images. in contrast to previously published papers, our objective is to detect many short chains instead of a few long ones. this has the advantage of providing much more information to the alignment process and simplifies at the same time the task of identifying corresponding points within the tilt series. in fact, that is currently one of the limiting steps in image alignment in electron tomography: even if gold beads are available , sometimes they are so much clustered that it is difficult to identify the same gold bead within the whole tilt series since in some of the images it is among many other gold beads clustering in the same region. moreover, this process of identifying corresponding landmarks within the tilt series is many times done by the user, or done automatically by cross correlation of correlative image pairs and refined/corrected by the user. the main reason for the need of user interaction is that tracking the same point within the whole series is a difficult problem to be solved automatically. placing the focus on thousands of short landmark chains makes the problem much more computationally tractable and reliable. furthermore, the robust regression step tends to remove those possibly wrongly identified chains.

our treatment of the chain identification is quite strict and it is one of the keys of the algorithm. the idea is to have a first rough idea of corresponding landmarks using the affine transformation between any pair of correlative images. given the size of the images there is enough information to determine the six parameters of the affine transformation quite faithfully. moreover, a careful global and accurate search of the parameters is performed through the combined use of a global optimizer  and a local optimizer . this initial guess of the landmark chain is improved by locally shifting the image regions to maximize the correlation between corresponding regions. this allows for elastic local deformations that cannot be taken into account solely by the affine transformation . once the landmark chain is identified by using correlative image pairs, it is carefully refined by forcing each region to be similar not only to the equivalent regions in adjacent images, but to equivalent regions all along the image chain. this is also one of the key steps of the algorithm that greatly improve the landmark chain identification, and discards many slowly drifting chains. for the success of the algorithm it is recommended that a "dense" grid of landmark chains is available, meaning by this that there are enough landmark seeds in the image  so that the local significantly overlap . we also suggest to use as small local patches as possible . poor coverage of the image by the local patches will most likely result in the miss of many landmark chains, and consequently missing much of the information available in the image series.

finally, our derivation of the equations governing the optimization of the alignment parameters, although equivalent to the previous derivation of penczek et al.  <cit> , is much more compact and provides further insight in the nature of the multivariate optimization. this fact facilitates the algorithmic implementation of the optimization procedure.

CONCLUSIONS
in this paper a new algorithm for automatic alignment of electron tomographs has been presented. the algorithm is based on the automatic detection of thousands of short landmark chains identifying image regions that clearly correspond to the same point in a relatively small number of images. regions identified in this way must correlate well  among all the corresponding pieces in the landmark chain, and the average of all of them. after these corresponding regions have been identified, a robust regression process is performed to finally find the relative alignment between all images. the process has been shown to successfully align images under conditions of random shifts between image pairs, and under conditions of slow but sustained drift between images. it has also been successfully applied to experimental images. the algorithm is available from the xmipp package  <cit>  and will be soon incorporated into tomoj  <cit> .

