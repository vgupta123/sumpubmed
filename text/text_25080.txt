BACKGROUND
the admixture program  <cit>  estimates individual ancestry proportions for admixed individuals from genomic datasets. it uses a likelihood model  <cit>  that assumes the diploid genotype nij for individual i at biallelic snp j, which represents the number of type “1” alleles observed, is generated by binomial sampling from a weighted sum of ancestral allele frequencies. for each individual, the weights are given by the proportions of ancestry derived from each ancestral population. given k ancestral populations, genotypes are sampled as nij∼binomial <dig> ∑k=1kqikpkj where qik the fraction of individual i’s ancestry attributable to population k and pkj is the frequency of the type  <dig> allele at snp j in population k. admixture maximizes the resulting biconcave log-likelihood  using a block relaxation algorithm. 
  <dig> ℒ=∑i,jnijlog∑k=1kqikpkj+2−nijlog1−∑k=1kqikpkj 

we describe two extensions to the admixture program that accelerate the analysis of large datasets and enable ancestry estimation for sex chromosomes. the first extension  allows admixture to estimate ancestry for a new set of individuals using ancestral populations from an earlier admixture run. it enables efficient inference of ancestry on large genomic datasets using ancestral populations estimated from reference panels like the  <dig> genomes project. it can also be used to correctly infer individual ancestry in pedigrees. the second extension allows admixture to model the log-likelihood for haploid chromosomes. this can be used to correctly estimate ancestry on sex chromosomes and therefore estimate sex bias in ancestry between the autosomes and sex chromosomes. we demonstrate the utility of these extensions using data from the  <dig> genomes project  <cit>  and the hapmap project  <cit> .

implementation
projecting new samples on existing population structure
a number of large genome-wide datasets of human populations such as the hapmap project,  <dig> genomes project etc. are now publicly available. many studies  use these datasets as reference panels in combination with the study sample to estimate individual ancestry using admixture since these large datasets summarize worldwide human population structure. for study samples which do not include a novel population, an efficient way of estimating individual ancestry is to “project” the new samples on to the population structure learned from the reference panels. this is intuitively similar to the projection operation used in principal components analysis, though the mathematical details differ. we extended the admixture code to allow loading of trained models . for two datasets with the same set of snps, clusters can be learned using the unsupervised mode of admixture on the first dataset and ancestry proportions can be inferred for the second dataset using these learned clusters. the same approach can be used to infer ancestry on a set of related individuals. first, we infer the largest set of unrelated individuals in the dataset using pedigree information or methods such as plink  <cit> , king  <cit>  or primus  <cit> . then, admixture is run on this set in unsupervised mode and the remaining individuals are projected on the resulting population structure.

mathematically, this requires solving the likelihood maximization problem of eq.  <dig> with respect to q for a fixed p. this problem can be solved efficiently using the optimization described by alexander et al.  <cit> .

analyzing haploid sex-chromosomes
admixture between populations is often sex-biased, i.e., different proportions of males and females from the source populations contribute to the admixed populations. in human populations, sex-biased admixture has been observed in african-americans and latinos, often using evidence from y-chromosome or mitochondrial dna . an alternative way to study sex-biased admixture is to examine individual ancestry estimates on the autosomes vs the sex chromsomes  <cit> . therefore, we are interested in inferring individual ancestry using admixture on the sex chromosomes, in particular on the haploid x-chromosome in males.

for a haploid sex-chromosome snp, we assume that hemizygous genotypes are coded as homozygotes for the observed allele. then, using the same notation as before, genotypes can be sampled as nij2∼binomial. the corresponding log-likelihood for a haploid sex-chromosome snp in an individual is half of that for a homozygous autosomal diploid snp in eq.  <dig>  as described in eq.  <dig>  we account for this in admixture by keeping track of the sex of each individual and the chromosome each snp belongs to and adjusting the log-likelihood accordingly. 
  <dig> ℒhaploid=∑i,jnij2log∑k=1kqikpkj+2−nij2log1−∑k=1kqikpkj 

to enable correct handling of haploid sex-chromosomes in multiple species, we implemented the --haploid option, which takes a single colon-separated argument describing the haploid sexes and the haploid chromosomes. for instance, for human data, sex-chromsomes can be supplied as an argument for admixture as --haploid=“male: <dig> ” with  <dig> and  <dig> representing the x and y chromosomes respectively.

RESULTS
we demonstrate the utility of the newly implemented options using experiments on human genomic datasets.

using reference panels for inferring ancestry proportions with projection
we duplicated data from phase  <dig> of the  <dig> genomes project to create a dataset with  <dig>  individuals. the data was filtered to include only snps with minor allele frequency  ≥ <dig> % and thinned for linkage disequilibrium  to have pairwise r2≤ <dig>  in  <dig> kb windows. we compared the running time and accuracy of two analyses, with the number of clusters  ranging from  <dig> to 10: 
unsupervised: unsupervised admixture was run on the entire dataset of  <dig>  individuals.

projection: unsupervised admixture was first run on the original  <dig> individuals from the  <dig> genomes project and the remaining  <dig> individuals were projected on to the learned population structure.



each analysis was performed with  <dig> random starts, with running time limited to  <dig> h. all experiments were run on a single core of a server with xeon e5- <dig> processors, using  <dig>  gb memory.
fig.  <dig> running time comparison. running times for admixture on a dataset of  <dig>  individuals constructed from the  <dig> genomes project



comparison with iadmix
the projection step we describe has been recently independently implemented by bansal et al.  <cit>  in the software iadmix, using a different optimization algorithm. we compared our admixture projection implementation to the iadmix projection implementation by running unsupervised admixture on the first  <dig> individuals from the previous analysis and using the learned allele frequencies to infer ancestry for the remaining  <dig>  individuals by projection using either admixture or iadmix. figure  <dig> shows that projection using admixture is approximately  <dig> times faster than using iadmix <dig> 
fig.  <dig> running time comparison with iadmix. running times for the projection step using admixture and iadmix on a dataset of  <dig>  individuals constructed from the  <dig> genomes project. allele frequencies were inferred from the first  <dig> individuals using admixture



ancestry estimation for related individuals using projection
admixture infers individual ancestry proportion and ancestral population allele frequencies simultaneously in an alternating optimization  <cit> . inferring allele frequencies  from related individuals without suitable correction for relatedness can lead to high variance in estimates  <cit> . we demonstrate that relatedness can affect the inferred population clusters when admixture is run on related individuals using the ceph  and yoruba in ibadan, nigeria  individuals from hapmap phase  <dig>  we also show how projection can be used to obtain more accurate af estimates.

we used  <dig> ceu individuals  and  <dig> unrelated yri indviduals to construct a dataset with  <dig> individuals. after filtering for ld  and maf > <dig> , the dataset had  <dig>  snps. the dataset then was then analyzed using admixture with k= <dig> population clusters in two ways: 
all individuals: admixture was run on the entire dataset.

unrelated individuals: the dataset was divided into two sets - one containing only the  <dig> unrelated ceu and yri individuals and another containing the  <dig> related ceu individuals. admixture was run on the unrelated set. the related individuals were then projected on the allele frequencies inferred from the unrelated set.



for both analyses, we then compared the inferred allele freqencies for the european components to af estimates from the exome aggregation consortium  data at a common set of  <dig> snps . we find that european component af estimates are closer to exac allele frequencies for the unrelated analysis  than for the analysis using all individuals , with p =  <dig>  for a one-tailed paired t-test when the squared errors are compared for each snp. however, this error includes  the variance of the estimate due to the sample size from which the af is estimated and  the variance of the estimate due to the relatedness of the samples. assuming the exac af f to be the true underlying frequency, a normal approximation for the sample af fn estimated from n unrelated diploid samples is given by fn∼normalf,f2n  <cit> . therefore, we can construct a z-score that accounts for sampling variance as z=2nf. comparing z-scores, we find that the z-score for the analysis using only unrelated individuals  is smaller than the z-score for the analysis using all individuals , with p<  <dig> e– <dig> for a one-tailed paired t-test. the z-score using only unrelated individuals also has a smaller variance  =  <dig> ) than that for the z-score using all individuals  =  <dig> ). this suggests that the allele frequency estimates from the analysis using unrelated individuals are more accurate than those using all individuals. an alternative way of evaluating the accuracy of estimated allele frequencies is discussed in additional file 1: section s <dig> 

inference of sex bias from autosomal and x-chromosome ancestry
to demonstrate the utility of ancestry inference on haploid sex chromosomes, we examine sex-biased admixture in the african-american population in the southwestern united states . we used  <dig> individuals from phase  <dig> of the  <dig> genomes project including the asw with populations from europe, africa, asia and the americas. we removed  <dig> asw individuals  who had very high  native american ancestry based on results reported by the  <dig> genomes project  <cit> . snps were filtered to include only those with maf ≥ <dig> % and then thinned for ld to have pairwise r2≤ <dig>  in  <dig> kb windows.

sex bias was analyzed by running admixture on the  <dig> individuals with k= <dig> clusters on the autosomes and x-chromosome separately and comparing ancestry proportions for each individual on the two chromosome subsets. if there was no sex-bias during admixture, then the ancestry proportions on the two chromosome sets should be  equal.

we compared two ways of analyzing sex bias: 
females only: since admixture  requires diploid data, we subset the dataset to  <dig> females and ran admixture on the autosomes and x-chromosome separately.

males and females: using the --haploid option , we ran admixture separately on the autosomes and x-chromosome on the entire set of  <dig> individuals.


table  <dig> comparing ancestry proportions for african-americans on the autosomes and the x-chromosome: differences in individual autosomal and x-chromosome ancestry proportions are represented by the mean of the difference over all individuals

 <dig>  
– <dig>  
in parentheses are the raw p-values calculated using a wilcoxon signed rank test comparing the autosomal and x-chromosome ancestry proportions. p-values <  <dig>  are shown in bold



discussion
we have described two extensions to the admixture program. the projection extension allows admixture to estimate ancestry for a new set of individuals using pre-defined ancestral population frequencies . this functionality is similar to that implemented in iadmix  <cit> , which uses a different optimization method, and that implemented by sikora et al.  <cit>  for ancestry inference for ancient individuals using an expectation-maximization algorithm. this extension enables efficient inference of ancestry on large genomic datasets using ancestral populations estimated from reference panels like the  <dig> genomes project. the allele frequencies inferred by admixture have been used previously to simulate individual genotypes  <cit> . the resulting individual genomes have been used in subsequent admixture  <cit>  or other  <cit>  analyses to enable a “supervised” analysis  <cit> . our extension provides an efficient and principled framework for this approach.

the projection approach is useful when a new dataset is strongly unbalanced in its distribution of populations, since an unbalanced dataset can affect the accuracy of ancestry inference  <cit> . another advantage of the projection approach is that individual ancestry can be inferred in parallel for each individual. thus, if a user has access to multiple computers , then ancestry can be estimated for hundreds of thousands of individuals in a few hours. our results on a dataset of  <dig>  individuals constructed using the  <dig> genomes project show how projection improves the efficiency of admixture. the projection approach can also be used to infer the ancestry of ancient dna samples, as in sikora et al.  <cit>  and other work. a limitation of the projection approach is that if the projected data contains a novel population which was not present in the initial  set, the projection results may not be identical to those obtained from running admixture on the combined dataset. the fit of the projected data to the population structure in the training set can be evaluated using the posterior predictive checks  of mimno et al.  <cit> . this framework uses the inferred model parameters from admixture to generate simulated datasets whose similarity to the original dataset is assessed through a set of population genetics summary statistics such as identity-by-state, linkage disequilibrium, fst etc. if the projected individuals belong to a population not present in the training set, the ppcs will indicate a high discrepancy between the summary statistics for the projected individuals and the generated datasets. an alternative way of examining fit between the projected individuals and the training set is to examine the cross-validation error of the projection step using the “–cv” option of admixture. a high cross-validation error would indicate that the projected individuals belong to a population not present in the training set.

through experiments on hapmap ceu and yri individuals, we showed that the projection approach is also useful for accurate ancestry inference on related individuals. this approach allows us to infer allele frequencies for ancestral populations with reduced error. a limitation of this approach is that if the number of founders in a pedigree is small, then the error in allele frequencies estimated from running admixture only on the unrelated individuals may be large due to a larger sampling variance. in such cases, the method may not produce more accurate estimates than those obtained by running admixture on the entire dataset.

the second extension we have developed correctly models the log-likelihood for haploid chromosomes. this can be used to estimate ancestry on sex chromosomes and thus estimate sex bias in ancestry. our analysis of sex bias in the asw african-american population shows that accurate ancestry inference on the haploid x-chromosome in males can improve power of tests for sex bias that use ancestry proportions as a test statistic. while the test we described based on a difference in ancestry has a number of limitations , it is only intended to demonstrate the advantage of ancestry inference on haploid chromosomes for more power in tests for sex bias and is applicable to other tests of sex bias.

CONCLUSIONS
admixture is widely used for analysis of ancestry in genomic datasets. the extensions we have described increase the efficiency of admixture and increase its versatility. the projection operation allows more efficient analysis of large datasets by using available reference panels. it also allows analysis of ancestry in pedigrees. ancestry analysis of haploid sex-chromosomes improves power to detect sex bias in populations using autosomal and x-chromosome ancestry. we expect that with the growing number of populations being sequenced and large amounts of individual-level genotype data being generated, these extensions will make admixture more useful to researchers.

endnote
 <dig> we only show results for one replicate since iadmix produces  <dig> gb of output files for one replicate of such a large dataset.

additional file
additional file  <dig> supplementary text. 



