BACKGROUND
the genomic revolution of the 1990s has yielded almost a thousand sequenced microbial genomes. more recently, the explosion of random community genomics, or metagenomics, where dna is sequenced directly from environmental samples has provided insights into microbial communities. currently, two approaches to sequencing metagenome samples are commonly used. in the traditional approach, dna is cloned into bacs, or small plasmids, and dideoxy chain termination sequencing  is used to determine the sequences  <cit> . in the alternative approach, dna is sequenced without cloning, using one of the so-called next-generation sequencing techniques, usually pyrosequencing. both approaches have advantages and disadvantages. for example, sanger sequencing generates longer sequence reads but has inherent biases due to the cloning. pyrosequencing has much higher throughput and a lower error rate per base sequenced compared to sanger sequencing, but those errors are biased toward certain mistakes  <cit> .

regardless of the sequencing approach used to generate the data, the first steps in analysis of any metagenome involve comparing those sequences to known sequence databases. this computationally intensive task provides the basic data types for many subsequent analyses, including phylogenetic comparisons, functional annotations, binning of sequences, phylogenomic profiling, and metabolic reconstructions.

here we describe the development of a freely available, fully automated open source system for processing metagenome sequence data to generate these basic elements. a public implementation of this system has been provided for all researchers to analyze their metagenomes. our service, the metagenomics rast server , is available over the web to all researchers, and access is not limited to specific groups or data types. almost  <dig> metagenomes have been processed through the beta version of the pipeline so far.

implementation and 
RESULTS
the mg-rast server is an open source system based on the seed framework for comparative genomics  <cit> . users can upload raw sequence data in fasta format; the sequences will be normalized and processed and summaries automatically generated. genome annotation systems are ever evolving; therefore, in order to accommodate new methods that may be developed, the pipeline was designed with a modular framework that allows the rapid addition of new analysis steps or comparative data at any stage of the analysis. the server provides several methods to access the different data types, including phylogenetic and metabolic reconstructions, and the ability to compare the metabolism and annotations of one or more metagenomes and genomes. in addition, the server offers a comprehensive search capability. access to the data is password protected, and all data generated by the automated pipeline is available for download and analysis in variety of common formats. here we describe the key components of the pipeline, which are summarized in figure  <dig> 

user registration and management
the user registration serves two functions: to limit access to each data set to the user and their colleagues and to secure a valid email address in case correspondence is required, for example if a data-processing problem occurs. once logged in, users can view their own metagenomes, those to which the owner has granted them rights, and the default set of publicly available metagenomes. the system supports delegation of authorization so that users can allow others to access one or more of their metagenomes. in addition, data owners can release their metagenomes to the public at any point, allowing all users of the system to view their data.

data types
the pipeline accepts data in a number of formats:  <dig> reads may be uploaded directly in the format delivered by  <dig>  <cit> , and fasta files typical of sanger-sequences and used by other platforms may also be uploaded. the pipeline will also accept assembled sequences in fasta format. sequence data may be compressed by one of several common computer programs to speed upload.

users may choose to upload raw unassembled reads or assembled contigs. as discussed below, each approach has advantages and disadvantages. users with a limited number of larger contigs, where the average contig length exceeds  <dig> kb, should consider using the rast server for the analysis of complete bacterial and archaeal genomes  <cit> .

the genomics standards consortium has proposed a minimal set of data, called the minimum information about a genome sequence   <cit> , that should be collected with every metagenome sequence. although this is an evolving standard, the metagenomics-rast server is migs-compliant. metadata, accessory data about the metagenome , is requested from the user at the time of sequence submission. this data is stored with the user's data and can be provided to the gsc genome catalogue, and other archives, when the sequence data is ready for public release.

implementation and core analyses
the pipeline is implemented in perl by using a number of open source components, including the seed framework  <cit> , ncbi blast  <cit> , sqlite, and sun grid engine  <cit>  as components. the system also uses the publicly available seed subsystems, seed nr, and figfam protein families .

the distinct steps are implemented to provide a flexible, extensible processing pipeline. the steps incrementally add data to a self-contained "job directory" that contains all job-relevant data in flat file and sqlite  <cit>  format. relational database technology is used to efficiently provide a mapping of sequences in a metagenome to both organisms and metabolic functions and at the same time allow the user to change the parameters for the underlying sequence matches. the user interface enables the download of the user's job directories, and a future version of the software will allow uploading of user-created directories into the server.

after uploading the data, a normalization step  is executed, generating unique internal ids and removing exactly duplicate sequences from  <dig> data sets. 

in the second step, the sequences are screened for potential protein encoding genes  via a blastx  <cit>  search against the seed comprehensive nonredundant database sourced from the insdc databases, sequencing centers, and other sources  <cit> . an expect value  cut-off of  <dig>  is used to pick up potentially coding elements.  in parallel with the blastx searches, the sequence data is compared to all accessory databases by using the appropriate algorithms and significance selection criteria. these databases include several rdna databases, including greengenes  <cit> , rdp-ii  <cit> , and the european 16s rna database  <cit> , and boutique databases such as the chloroplast database, mitochondrial database, and aclame database of mobile elements  <cit> . the search criteria are specific for each database. for example, screens for ribosomal rna genes are performed by using blastn against the rdna databases, but much more stringent selection criteria are used to identify candidate rna genes than for identifying protein-encoding genes .

in the third step, these matches to external databases are used to compute the derived data. first, a phylogenomic reconstruction of the sample is computed by using both the phylogenetic information contained in the seed nr database and the similarities to the ribosomal rna database. functional classifications of the pegs are computed by projecting against seed figfams  <cit>  and subsystems based on these similarity searches  <cit> . these functional assignments become the raw input to an automatically generated initial metabolic reconstruction of the sample, providing suggestions for metabolic fluxes and flows, reactions, and enzymes.

one of the design goals of this server was easy accessibility via a web-based interface. the interface provides views for browsing and analysis of the data, as well as a means to download all result tables and the sequences for every subset displayed. figure  <dig> provides an overview of the various elements of the user interface and highlights the options for downloading various subsets. the user interface provides a means to alter some of the parameters used to compute the functional, metabolic, and phylogenetic reconstruction. this allows more stringent match criteria ; and, by restricting the matches, the derived data is dynamically changed. the default parameters have been chosen by empirical testing and represent a tradeoff between accuracy and specificity.

comparative metagenomics
the abundance of comparative metagenomics tools is central to the utility of the mg-rast platform. various tools have been built into the framework, allowing users to compare their data against other metagenomes or complete genomes taken from the seed  <cit>  environment. the subsystems heat map and the taxonomic heat map provide comparative metagenomics summaries that encapsulate the differences between samples.

the subsystem comparison tools identify the number of pegs in each metagenome that are connected to a subsystem via protein level similarity. based on these connections, each subsystem present in a sample is scored by counting the number of sequences that are similar to a protein in each subsystem. this score is divided by the total number of sequences from the sample that are similar to any protein in a subsystem, to give a fraction of sequences in subsystems that are in a given subsystem. this approach allows comparisons between samples that have different numbers of sequences. since the fractions tend to be small , the scores can be factored for display purposes. furthermore, a nonquantitative approach is provided to group the subsystem scores, emphasizing those subsystems that are most different between the samples. moreover, the display can be limited to specific areas of metabolism, or other subsystem groups, as desired by the user.

the taxonomic heat map works in an analogous fashion but highlights the different taxonomic profiles in each sample, as determined by the phylogenetic or phylogenomic approaches selected by the end user . again, samples may be grouped in a nonquantitative fashion to rapidly highlight particular phylogenetic groups that predominate in different samples.

often a metagenome comprises a few dominant organisms, and many of the pathways in the metagenome can be predicted. the automatically generated metabolic reconstructions can be compared to any given metagenome or complete microbial genome. this approach highlights subsystems that are unique to a metagenome, a comparative genome, or the subsystems common to both. with these tools, users can identify shared metabolism present in their samples.

discussion
a completely new public metagenome annotation system has been developed and released. the process is the result of several years of planning and engineering. designed to leverage the seed microbial genome annotation platform, the mg-rast platform provides seamless integration of metagenome data, microbial genomics, and manually curated annotations. each metagenome project has its own requirements for stringency, datasets to be analyzed, and output format for results. the metagenomics seed pipeline was designed to allow alterations to the parameters for the sequence matches underlying both the phylogenetic and metabolic reconstructions to restrict matches. it has been built by using an extensible format allowing the integration of new datasets and algorithms without a need for recomputation of existing results.

the mg-rast service handles both assembled and unassembled data. each approach has advantages that should be considered when comparing metagenomes. for example, if one is carrying out comparative metagenomics or if statistics are being used to compare samples  <cit> , the sequences cannot be assembled, since the assembly process loses the frequency information critical for determining differences between samples. in contrast, assembled sequences tend to be longer and therefore more likely to accurately identify gene function or phylogenetic source from binning  <cit> .

the analytical methods integrated into the pipeline provide core annotation and analysis tools to compare and contrast a diverse set of metagenomes  <cit> . the approach underlying the subsystems-based functional analysis of metagenomes has been validated with  <dig> different samples from nine major biomes. the analysis demonstrated that the biomes could clearly be separated by their functional composition  <cit> . all of the metagenomes present in that study are included in the publicly available datasets visible in the mg-rast server.

although the service contains core functionality for the annotation and analysis of metagenomes, many of the techniques traditionally used for genome analysis  either do not work with metagenomes or show a significant performance degradation  <cit> . many of the differences between complete genome annotation and metagenome annotation are reminiscent of those encountered previously with the analysis of expressed sequenced tags  <cit> . therefore, new analytical methods are needed to fully understand metagenomics data. the most obvious problem is with the large number of unknown sequences in any sample. depending on the specific sample processed, as few as 10% of the sequences or as many as 98% of the sequences may have no known similarity to anything in the database  <cit> . we and others are developing new binning, clustering, and coding region prediction tools to handle these unknown sequences, and effective tools will be incorporated into the pipeline when available. another problem is that the rapid pace with which sequence data is being generated outpaces increases in computational speed, and therefore improvements in common search algorithms are required to ensure that sequence space can be accurately and efficiently searched. a third problem, common to all annotation platforms, is that metabolic reconstructions and analyses are dependent on the underlying quality of the data. the seed has the most consistent and accurate microbial genome annotations of any publicly available source because of the subsystems approach to annotation. however, the seed subsystems are necessarily focused on core metabolism and pathogenesis of a select few organisms. comprehensive subsystem coverage of secondary metabolism, and especially of metabolism specific to diverse environments, is required to truly comprehend those data sets.

CONCLUSIONS
we have provided a free, public resource for the analysis of metagenome sequence data. our service does not require a specific type of sequence data and has no requirement for release or control of the data. all sequence data remains protected by a password mechanism and is visible only to permitted users. this metagenomics annotation pipeline was specifically developed to handle pyrosequencing data and accommodate some of the nuances associated with that data. however, the tools and approaches we have developed are applicable and available for any metagenome project, regardless of sequence type. this service has removed one of the primary bottlenecks in metagenome sequence analysis – the availability of high-performance computing for annotating the data.

availability
the service is available to all users after a simple registration process. in addition to being available through the integrated seed-viewer  <cit>  interface, all results are available for download in variety of formats, including gff <dig>  genbank, and flat text formats . the server is made available on a best-effort basis, and all underlying data and software are open source .

plans include the development of novel tools to allow systematic data mining in the samples and improved support for in-depth analysis of 16s-based metagenome data sets.

abbreviations
rast: rapid annotation using subsystems technology; mg-rast: rast for metagenomes.

