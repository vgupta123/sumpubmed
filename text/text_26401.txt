BACKGROUND
dna methylation is an epigenetic phenomenon that adds a methyl group to the nucleic acid cytosine in dna. methylation impacts evolution and inheritance  <cit> , embryonic development  <cit> , and cancer  <cit> . discovering where dna methylation occurs can be accomplished with the sequencing of bisulfite treated dna. bisulfite transforms unmethylated cytosine into uracil. the methylated cytosine sterically hinders the sulfite ion preventing transformation of methylated cytosine into uracil. the dna is amplified with polymerase chain reaction  where the uracil is converted to thymine. differences between a reference genome and the bisulfite treated dna can be used to search for methylated cytosines.

to identify such differences, the most important step is to map the bisulfite treated short reads to the reference genome. mapping software takes a dna sequence and finds a matching position for it in a reference genome. many mapping programs suitable for bisulfite treated short reads exist. these include bismark  <cit> , bsmap  <cit> , biss from ngm  <cit> , batmeth  <cit> , and bs-seeker <dig>  <cit> . these programs work by first finding a potential location for the read using hashing or a string index. the next step is to compute a score for the read.

this can be done by counting mismatches and indels. some programs use the smith-waterman algorithm  <cit>  or the needleman-wunsch algorithm  <cit> . the best scoring read location is reported as the location for that read. despite continued and intense effort in creating new or improving existing bisulfite read mappers, the proportion of mapped reads remains low, commonly around 40%  <cit> , and sometimes as high as 80% especially with read trimming  <cit> , which is much lower than regular short reads mapping . it is unclear what leads to the reduced efficiency in bisulfite reads mapping.

in this work, we use a sequencing strategy called genome-wide hairpin sequencing of bisulfite-treated short reads to investigate factors that may adversely influence mapping efficiency of bisulfite reads  <cit> . unlike previous bisulfite sequencing methods that destroy knowledge of the original  sequence, the hairpin technology  allows for the recovery of the original sequences by putting a connector between the watson and crick strands and then using pcr and paired end technology to sequence short reads  <cit> . the resulting sequences give paired strands that can be mapped to recover the original untreated read and to detect sequencing error.

this study focuses on the read mapper bismark, which is popular, easy to use, and reasonably accurate  <cit> . it converts all cs to ts in the read and the reference genome, and then calls bowtie <dig> as a sub-process to do the mapping. bowtie <dig> uses an fm-index, a compressed string index, of the reference genome to find read positions on the reference genome. bowtie2's scoring function weights mismatches, indel starts, and indel extensions. it can report the score for the best mapping as well as the next best mapping  <cit> . because the hairpin method enables recovery of the original sequences from bisulfite converted reads, the effects of bisulfite treatment on a mapping program can be studied by mapping bisulfite converted reads with bismark and recovered  reads with bowtie <dig>  this isolates bisulfite treatment as the only variable affecting mapping quality. we also used the bisulfite mapper bsmap, one of the first bisulfite mapper programs, for comparison. it creates a hash table of the reference genome of all possible c to t conversions in a sliding window of  <dig> base pairs in the reference genome  <cit> . the following have been published by the same authors in an extended abstract: some results on original sequence recovery and entropy, most of the methods section, and figure  <dig> <cit> .

methods
genome-wide mouse hairpin bisulfite-sequencing data creation
we first generated genome-wide hairpin bisulfite-sequencing data for mouse es cells  using the technology developed by our lab   <cit> . to induce differentiation, the mouse es cells were cultured in es cell culturing media for six days without lif . genomic dna isolated from the undifferentiated  and differentiating  states of mes cells were used for library construction. briefly, after dna sonication, end repair, and da tailing, the dna fragments were further ligated to biotin-modified hairpin adapter and illumina truseq adapters. adapter-ligated dna was digested with msei and mluci  to enrich regions with high cpg density, and then pulled down using dynabeads ® myonetm streptavidin c <dig> beads . after bisulfite conversion and pcr, size selection of 400- <dig> bp fragments was conducted to yield longer sequences that are more amenable for unambiguous mapping to the reference sequence.

unconverted sequence recovery
software installation and use
all software development and analysis was performed on the bioinformatics clusters hosted by the virginia bioinformatics institute and the virginia tech cs department. two of the machines consist of two quad core processors  xeon cpu e5- <dig>  <dig> @  <dig>  ghz) each with  <dig> gigabytes of memory. two other machines consisted of three eight core processors  xeon cpu e5- <dig>  <dig> @  <dig>  ghz) each, where one machine has  <dig> gb of memory and the other has  <dig> gb of memory. bowtie <dig>  was compiled with the gnu compiler collection. bismark  was run with perl  with the non-directional flag and default settings. blastn  was run with default settings on a c-to-t converted reference genome to map unmapped bismark reads, where all of the reads had cs converted to ts. bismark reports unique mappings, which are mappings that have a unique best score, ambiguous mappings, which are reads with locations that have multiple best scores, and unmapped reads, which had scores that were too low or reads where a location couldn't be assigned.

file processing and statistical calculation
custom python  <dig>   <cit>  scripts using biopython  <cit>  were created to process files and calculate statistics such as sequence entropy and sequence length. file manipulation included randomly sampling from fasta files.

sequence entropy was calculated for each sequence in each of the mapping categories . entropy for a sequence, s, is calculated by taking the negative sum of the frequency of each base, fb, times the logarithm of the frequency of each base. more formally,

 ents=-∑b∈a,c,t,gfblogfb 

entropy gives a measure of sequence randomness  <cit> . this measure of sequence complexity was chosen since it is simple and fast to compute. a sequence of all ts will have an entropy of  <dig>  but a sequence with  <dig> percent of each base will have an entropy of  <dig>  we hypothesized that entropy would affect mapping quality. highly random-seeming sequences should uniquely map while non-random sequences, for example, a sequence with mostly ts, will map ambiguously or be discarded since the string of ts could map to many portions of the genome that have cs at indeterminate locations in the string of ts. bisulfite treatment tends to reduces entropy since most c's will be converted to t's since cytosine methylation is usually rare.

for comparing the unique mapping efficiency for converted and unconverted reads,  <dig> bootstrap replicates with replacement were created from all of the mouse data . each replicate had  <dig>  million reads. each replicate had the t-enriched pair and the a-enriched pair so that the untreated original sequence could be recovered. reads that aligned exactly  were extracted and mapped with bismark on default settings for both the t-enriched and the a-enriched reads. about 68%  of the reads in each replicate aligned exactly. the original read was recovered and mapped with bowtie <dig> using the same settings as bismark. bismark reports a uniquely mapped percent, and the recovered sequence mapping categories from bowtie <dig> was used to calculate a uniquely mapped percent in the same way as bismark. read mappings were done for all  <dig> bootstrap replicates so that a p-value could be computed.

for a single bootstrap replicate for the day  <dig> data, reads were extracted that had  <dig>   <dig>   <dig>  and  <dig> mismatches somewhere in the read. mapping using bismark was done for all of them. bismark mappings for reads with mismatches only in the first  <dig> bases were compared with reads with mismatches only in the latter right-most part. this comparison was done for  <dig>   <dig>  and  <dig> mismatches.

with illumina pair-end sequencing technology, a total of  <dig> "lanes" of data was produced. lane  <dig> data was used throughout except in the two cases mentioned above that used bootstrap replicates drawn from all of the data. both t-enriched and a-enriched strands were used for analysis, and the day  <dig> and day  <dig> data was used. the day  <dig> lane  <dig> data has  <dig> , <dig> reads and the day  <dig> lane  <dig> data has  <dig> , <dig> reads.

to understand what the best possible bisulfite mapping efficiency was, a simulation was performed where simulated bisulfite reads were sampled from the mouse reference genome at random and read sequencing error was introduced. this simulation represented the best possible mapping scenario since the reads did not include natural variation. the simulation sampled sequences of length  <dig>   <dig>  and  <dig> bp in the same proportions that were in the lane  <dig> data and compared mapping efficiency to the real hairpin data with sequences of only  <dig>   <dig>  and  <dig> bases. simulations with sequencing error of 1% and 10% were created.  the program sherman from babraham bioinformatics was used to do the simulation with methylation rates set to cpg = 80% and cph = 2%. these rates were chosen since they were consistent with the literature  <cit> . both bsmap and bismark were used to do the mapping.

to investigate the benefit of using different algorithms, blast was run on default settings on  <dig> percent of the bisulfite-treated reads unmapped by bismark for the t-enriched day  <dig> lane  <dig> data. the reads and the reference genome had all c's converted to t's. only  <dig> percent of the reads were used since blast took a long time to complete and produced a lot of data.

RESULTS
bisulfite treated reads have low mapping efficiency
bismark uniquely mapped  <dig> - <dig> percent of the bisulfite converted reads in the mouse data, ambiguously mapped 27- <dig> percent, leaving 16- <dig> percent unmapped. therefore, around half of the reads don't give a strong signal for their position, rendering them less biologically useful.

sequence entropy relates to mapping efficiency
we examined the average sequence entropy by mapping category for both day  <dig> and day  <dig> data when mapped with bismark or bsmap . both mappers show a trend of increasing average entropy when going from unmapped to ambiguous to unique mappings.

recovering the original sequence improves mapping efficiency
we hypothesized that the hairpin sequencing technology can improve the mapping efficiency by recovering the original sequences, which have higher entropy. for the undifferentiated data, recovering the untreated sequence improved unique mapping efficiency by an average of  <dig> %  compared to the average unique mapping efficiency of the t-enriched and the a-enriched reads. for the differentiating data, the unique mapping efficiency was improved by  <dig> % . this shows the benefit of recovering the information lost from bisulfite treatment and is consistent with the notion that more entropic reads map better.

different hairpin sequences may map differently
we next checked whether mapping efficiency can be improved without sequence recovery but with mapping information from additional sequence read, since one sequence from the hairpin sequences may uniquely map while the other doesn't. bismark was run on the lane  <dig> data for both day  <dig> and day  <dig>  both the t-enriched and the a-enriched sequences were compared to see if one sequence uniquely mapped while the other didn't. if one sequence uniquely maps, then the other sequence can be considered to uniquely map as well. this improves the overall mapping efficiency. for the day  <dig> data, about  <dig> percent of the t-enriched sequences that uniquely mapped did not uniquely map in the a-enriched sequences, and vice-versa. for the day  <dig> data, about  <dig> percent of the t-enriched sequences that uniquely mapped did not uniquely map in the a-enriched sequences, and vice-versa. this suggests that the hairpin sequencing strategy can improve mapping efficiencies by uniquely mapping one sequence to find the position of the other sequence.

sequencing error adversely affects mapping efficiency
the number of mismatches in reads could be determined by mapping two pair-end sequences together. we observed a downward trend in mapping efficiency with increasing mismatch count . figure  <dig> shows the results of mapping reads with mismatches in the first  <dig> bases compared with mapping reads with mismatches only in the other bases. the unique mapping efficiency is consistently lower when mismatches are in the first  <dig> bases, and it is worsened with increased mismatch count. thus, mismatches correlate with low mapping efficiency, especially in the 5' end. the hairpin sequencing technology can be used to identify mismatch areas of a read for removal so that unique mapping efficiency can be increased.

bismark and bsmap mappings are highly overlapping
the t-enriched sequences for the day  <dig> data were mapped with bismark and bsmap. combining the uniquely mapped sequences of both mappers  resulted in only about a  <dig> percent increase over bsmap alone. other work has shown greater differences between these programs for other data  <cit> . therefore using multiple mappers may improve mapping efficiencies. using multiple mappers increases the confidence that a read is mapped correctly when the mappers map to the same location.

longer sequences tend to map uniquely
reads in the mouse hairpin data ranged from  <dig> to  <dig> bases. day  <dig> lane  <dig> data had  <dig>  percent reads with lengths either  <dig> or  <dig>  and day  <dig> lane  <dig> data had  <dig>  percent reads with 100- <dig> bases. we suspected that longer nucleotide sequences would have higher unique mapping efficiency since the probability that a longer sequence is repeated in the genome is low. for example, the sequence consisting of only "a" is often found, but the sequence "atcggtgccat" will be found less often.

the programs bsmap and bismark were used to do mapping, and then the percentage of reads of a given length that belong to each mapping category was calculated as can be seen in figure  <dig> for bismark. for bismark, there is a generally upward trend with longer sequences more often mapping uniquely and longer sequences less often unmapped. there are noticeable spikes at lengths  <dig> and  <dig>  however, bsmap's mapping efficiency remains about flat  until longer reads are mapped where there is a slight increase in mapping efficiency. these results confirm the hypothesis that longer reads tend to map uniquely.

sequencing error simulation suggests an upper bound on mapping performance
blasting unmapped reads produces hits
last, we investigated the benefit of using different algorithms for mapping by using blast to map reads unmapped by bismark. blast significantly mapped around  <dig> percent of these unmapped reads. blast is noticeably slower and its output is not in a convenient format for variant calling; nonetheless, this result shows that more computationally intense methods improve mapping efficiency.

CONCLUSIONS
in this study, we observed low sequence entropy co-occurs with low unique mapping efficiency, and high entropy co-occurs with high unique mapping efficiency. this suggests that lost entropy from bisulfite treatment causes worse mapping efficiency. in addition, mismatches in the seed region for a mapper correlate with worsened performance. the hairpin sequencing strategy is useful in improving mapping performance of bisulfite treated reads. with sequence information from two dna strands, the original sequence can be recovered and pcr or sequencing error mismatches can be identified. hairpin data can be used to ameliorate lost entropy by recovering the original sequence and improving unique mapping efficiencies.

additional coping strategies involve using multiple read mappers or more computationally intense software such as blast to improve mapping results since they can be used to map reads that are unmapped by less computationally intense software such as bismark and bowtie <dig> 

competing interests
the authors declare that they have no competing interests.

authors' contributions
jp conceived and carried out most of the data analysis and wrote the scripts, and he wrote much of the manuscript. ms prepared the dna bisulfite hairpin data and contributed to the writing pertaining to data preparation. hx supervised the data preparation and contributed to the manuscript. lz contributed to the manuscript and the conception of the data analysis.

