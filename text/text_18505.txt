BACKGROUND
in multiparametric flow cytometry, fluorophore-conjugated antibodies are used to measure the expression of multiple markers expressed on the surface and within the interior of cells in a given sample. as cells flow in a fluid stream, excitation by laser causes the fluorochrome with the attached antibodies to emit light of a specific wavelength, and the detected fluorescence intensity gives a measure of the identity and amount of expression of the different markers per cell  <cit> . thus a flow cytometric sample consists of the quantitative measurement of particular cell characteristics such as its lineage, state or function in terms of the expression of the selected markers under the given experimental conditions. it can be represented as a matrix of size n Ã— d, where n  is the number of cells, and d, the number of markers measured in the experiment, also called the dimension of the sample, is in the range 4- <dig>  for a given set of markers, a population is a group of cells in a sample with similar marker expression, and thus biologically similar to other cells within the group but distinct from those outside the group. identifying cell populations in a sample  is a well-studied clustering problem that summarizes a sample with population parameters  <cit> . from an algorithmic point of view, populations may be described as multivariate clusters of d-dimensional points where each cluster is represented by its distribution parameters such as location , variance, size, etc. in this paper we will use the term population and cluster interchangeably depending on the context.

the idea of characterizing a sample - a collection of cells - with clusters can be extended to characterizing a cohort or class - a collection of samples - with a higher-level technical description. towards this end, we assume that samples belonging to a particular class show homogeneous clustering, by which we mean that at least some of the populations correspond from sample to sample. such clusters have small distances from corresponding clusters in other samples of that class, when an appropriate measure of distance is used. we note that clusters from samples belonging to different classes might not have such correspondences. under this assumption, we can summarize the samples of a class with a class template by algorithmically merging similar populations from different samples into meta-clusters. a meta-cluster is an abstract population formed by grouping together similar cell populations across samples, and the template of a class is the collection of all the meta-clusters constructed in this manner. for convenience, an illustration of these concepts is shown in figure  <dig> 

recently developed computational methods for flow cytometry have focused on automating gating via clustering  <cit> , but not on the equally important problem of constructing and matching meta-clusters for heterogeneous samples. here we report the design of a hierarchical algorithm, flowmatch, to construct class templates consisting of a set of meta-clusters summarizing a set of samples from a particular class, and to study how these meta-clusters change under different experimental conditions.

the ability to systematically characterize a class of multi-dimensional samples with a well-defined template - in terms of its meta-cluster components - is useful in applications of flow cytometry. in addition to providing a cogent description of the core population structure that is shared among samples within a class, the templates also allow an objective way to assess the overall differences in those structures across classes. here we applied the concepts of template and meta-cluster in quantifying tyrosine phosphorylation differences in different cd4+ t cell populations in a cohort of thirty human subjects, before and after stimulation of whole blood with anti-cd <dig> monoclonal antibody   <cit> . previous studies have shown that different t cell subsets  show different overall phosphorylation responses upon stimulation  <cit> . in these approaches each sample was gated to identify cell populations of interest, and pairs of samples, before and after stimulation, were compared to detect the phosphorylation responses. however, maier et. al. reported that the autoimmune disease-associated allele at ctla <dig> gene on chromosome 2q <dig> alters phosphorylation responses in naive and memory t cells  <cit> . thus depending on the genetic profile of the subject, samples may differ in their response upon stimulation. it is therefore challenging to summarize the phosphorylation responses of all the samples in a class from manual observations of the phosphorylation effect in individual samples. in this setting, the samples belonging to each class  can be described by a class template, and by matching meta-clusters across templates we can better assess the population-specific effects of the stimulation experiment.

to address the problem of systematic template construction, we designed and developed an agglomerative hierarchical meta-clustering algorithm, flowmatch, that is similar in spirit to the well-known upgma clustering algorithm  <cit> . the algorithm begins with clustered samples obtained from a dirichlet process mixture  model as described in  <cit> . it then proceeds hierarchically by selecting the closest pair of samples, merging them into an intermediate template, and repeating until all the samples of a class are merged into a final template consisting of a set of meta-clusters for the class. after computing the class templates, we match meta-clusters from one template to another using a generalized edge cover in an underlying bipartite graph  <cit> .

in a recent approach, flame, pyne et. al.  <cit>  formed class templates from many samples of a particular class by first clustering the locations of all clusters using partitioning around medoids . then they refined the clusters by comparing each sample with the templates using an integer programming formulation of a weighted b-matching in a bipartite graph. the templates of the two classes  were then compared by using weighted bipartite matching. however, this approach has a few drawbacks. first, in a collection of heterogenous samples, multiple templates might be necessary to effectively model the whole class, whereas flame tries to form a single pam-based template for a class assuming limited heterogeneity. a hierarchical merging of samples can tackle the problem by using a threshold value to create a merge forest . second, flame uses within-class euclidean distances between the mode of a cluster and the medoid of a meta-cluster as edge weight, ignoring the underlying distributions. to address this, we used kullback-leibler divergence from the distributions as a dissimilarity measure, which takes into account both the location and the shape of the distributions. third, in their bipartite b-matching formulation, flame uses the population size as the capacity of a vertex to match multiple clusters to a meta-cluster. this could cause a problem if the number of cells within clusters varies widely across the samples. finally, possible outlier populations present in only a few samples seem to be ignored by their model. in contrast, we use a generalized edge cover  formulation  <cit> , where a meta-cluster is allowed to match with zero, one, or multiple clusters from the other class, while minimizing a suitable objective function.

RESULTS
dataset
we analyzed raw flow cytometric data generated ex vivo by maier et. al. originally intended to determine the allelic variation of the phosphorylation responses  <cit> . in their work, whole blood samples from thirty subjects was stained using phospho-site-specific labelled antibodies against cd <dig>  cd45ra, slp <dig> , and zap <dig> , before and after stimulation with anti-cd <dig> antibody. of these antibodies, cd <dig> and cd45ra were used to differentiate among different t cell subpopulations, and the tyrosine phosphorylation sites slp <dig> and zap <dig> were used to detect the effect of stimulation. following the convention of maier et al., we used the cd4+ clusters cd4+cd45rahigh and cd4+cd45ralow to represent the naive and memory t cell populations respectively  <cit> . 

clustering
we consider each sample as a mixture of gaussian components and used dirichlet process mixture  model for the clustering  <cit> . one reason for selecting dpm over other clustering methods is its ability to detect the number of clusters automatically. we used a publicly available matlab implementation of dpm clustering by teh  <cit> . we observed that the dpm clustering was not able to obtain well-separated clusters in several samples. we are currently exploring the use of other clustering methods for the entire data set. meanwhile, here we choose to study in detail a subset of ten samples for which well-separated clustering structure could be obtained. we also report the results from all thirty samples and compare them with the ten well-clustered samples in our discussion.

class templates
we first construct templates from the ten well-clustered samples before stimulation  and after stimulation . the two templates are shown in figure  <dig>  the average number of clusters present in a sample before stimulation is  <dig> , and after stimulation it is  <dig> . the flowmatch algorithm identifies six meta-clusters in both templates, indicating that the algorithm does not over-split or merge populations within a class. however, the small difference in the number of meta-clusters is because flowmatch combines a few clusters within a sample that were possibly incorrectly split by the initial dpm clustering.

the composition of each meta-cluster: each entry denotes the list of samples that contribute a cluster to a particular meta-cluster. a '+' in the superscript of a sample s indicates that multiple clusters from s appear in a meta-cluster  matching meta-clusters across templates are shown in same row, and the known cell population types are also shown.

effect of stimulation on phosphorylation responses
from figure  <dig>  most cd4+ t cell populations display overall increased slp <dig> phosphorylation upon stimulation with anti-cd <dig> antibody, which agrees with the observations in  <cit> . similar results were obtained for zap <dig>  we consider meta-clusters representing naive cd4+cd45rahigh and memory cd4+cd45ralow t cell populations, and show the effect of stimulation on these subsets in figure  <dig>  previous studies performed with individual samples  <cit>  reveal that memory cd4+ t cells display a lower baseline slp <dig> phosphorylation level than naive cd4+ t cells. our approach obtains this result with the entire class of samples  and 3), by identifying corresponding meta-clusters between the two class-templates. we also notice the low phosphorylation shift in zap <dig> residues  and 3) relative to the slp <dig> residues upon stimulation. this demonstrates that flowmatch can match corresponding meta-clusters across templates despite the variable amount of phosphorylation shifts.

stability of templates
the flowmatch algorithm builds a binary merge forest with the class templates at the roots of the trees, by merging a pair of samples or sub-templates at a time. let t be a sub-template  constructed by merging tleft  and tright . then, ct, the cost of the template t, is the cost of merging tleft and tright, which is the cost of the generalized edge cover, given in equation  <dig> . we show the merge tree for the templates before and after stimulation in figure  <dig>  and indicate the cost associated with each internal node in that tree.

a large template cost indicates heterogeneity among the samples participating in the template construction. how much heterogeneity  should we tolerate while building a template? we argue that any pair of samples taken from different classes  should be more heterogenous than a pair of samples in the same class. for example, when we consider the ten samples that are well-clustered, the pre-stim template and post-stim template costs are respectively  <dig> and  <dig>  in figure  <dig>  whereas the minimum cost of merging any pair of cross class samples is  <dig> . we call the former stable templates since they compactly represent all samples in the class. however, if we construct a single template from all the thirty samples  the cost is approximately  <dig> for both pre-stimulation and post-stimulation templates, whereas the minimum cost of merging any pair of cross-class samples is 23: <dig>  this suggests that we need more than one template to represent all of the samples. we use the minimum merge-cost among all cross class pairs as a cut-off value for all thirty samples to decompose the merge tree into a merge forest, and declare all sub-templates constructed up to that point as the templates of the cohort of samples. in figure  <dig> we denote unstable merges by broken red edges, and removing those edges will produce six templates for the thirty samples.

CONCLUSIONS
we concisely represent each class of samples by a template consisting of a collection of meta-clusters . we have developed a hierarchical template formation algorithm, flowmatch, that is able to construct representative class templates in the presence of tolerable variations in the samples. using flowmatch, the meta-clusters across samples can be matched to assess overall differences among the samples of various phenotypes or time-points.

