BACKGROUND
large-scale phenotyping studies have recently gained considerable attention in biomedicine. phenotypes occur in various forms and at different levels as enumerated in  <cit> . histology images offer an important source of knowledge for phenotyping studies at the cellular and tissue levels. pathologists have been traditionally cataloging and studying the morphology of cellular phenotypes arising from genomic alterations and adverse conditions  <cit> .

since the morphological phenotypes that manifest in histology images are highly heterogeneous and variable, the analyses and annotation of these images require well-trained experts  and rely on specific abstract patterns that they glean through extensive experience. still, there is much variability in annotations obtained from various experts, especially given the uncertainty that exists in the underlying biological mechanisms. with the development of high-content and high-throughput acquisition methods, there is an ever increasing availability of high-resolution digital histology images  <cit> , requiring the use of effective tools to explore and annotate the entire dataset efficiently. it is, therefore, necessary to gain a global overview of the morphology while being able to discern differences between images from individual samples.

consider the zebrafish histology image data subset presented in figure  <dig>  each image depicts the retina of a zebrafish of a specific genotype. a typical phenotypical study involves differential comparison of these images to identify common and distinctive characteristics across the genotypes and identify the various subtypes in the collection  <cit> . a common approach towards the study and the annotation of images is realized by placing them side-by-side in a 2-d grid-layout . however, due to limitations in the human perceptual capacity, these approaches do not scale well. in addition, a 2-d grid-layout provides no information about how the images are similar or different, making it very difficult to learn the correlations across the image collection and to further annotate large repositories of data.

we believe that an interactive visualization tool that allows for the tangible organization of image collections can lead to a better overall understanding of the studied datasets as well as facilitate the image annotation processes. we present our visual analytics tool, graph based histology image explorer or graphie, designed to assist pathologists and systems biology researchers to explore, annotate and reveal potential relationships of phenotypical properties within a biologically relevant context. graphie employs the bag-of-features  approach  <cit>  to capture visual patterns from a given collection of histology images, thus allowing a semantic organization of unstructured image collections. by further using a proximity graph and a flexible graph layout, graphie provides a visual representation of the entire image collection, which in turn enables the intuitive exploration of the underlying structure of the dataset as well as the capability of drilling down to subgroups of interest. our tool provides a rich set of interactive functions which make exploring and annotating on the graph more efficient and consistent. graphie also allows interactive feature selection, permitting users to examine subsets of image features and iteratively refine the graph visualization.

in summary, the main contributions of graphie include:

 <dig> an interactive visual analytics tool to efficiently explore and annotate histology image datasets.

 <dig> a framework which supports interactive comparison of subgroups and selection of features in histology images.

to evaluate graphie, we conducted two case studies. in the first study, we acquired histological images of  <dig> mutant specimens of the model organism danio rerio, commonly known as the zebrafish. the mutant fish were the results of direct genetic alterations. graphie offers users a flexible way to explore distinctive morphological features and thus glean the structural changes wrought by genetic alterations. the second case study is concerned with histology images from a human breast cancer study. the task here is to explore image collections and annotate regions of the images if they predominantly contain specific tissue types .

related work
efforts have been expended to employ visual analytics approaches to explore image datasets. for instance,  <cit>  visualizes an image collection using a multidimensional scaling layout based on semantic similarities between images. in  <cit>  a method called clustered album thumbnails  was presented towards the hierarchical browsing of large image collections allowing users to interactively explore different levels of details. both 2d grid and spiral layouts were used in  <cit>  to present search results of images resembling an example image. while these methods support data exploration, they lack the ability to interactively assist users to spot differences among images, let alone glean subtle patterns in the more content-rich and complex histology image collection.

on the other hand, since manual annotation and analyzes of histology images requires well-honed expertise, the study of quantitative image-based assessment has attracted attention  <cit> . there is a considerable amount of work leveraging advances in the semantic content analysis to study histology images  <cit> . the shiraz  project  <cit>  proposed a content-based image retrieval system designed to rapidly annotate both histological phenotypes and identify potentially confounding imaging artifacts. in spite of their high performance, most of these automated systems do not allow users to incorporate domain knowledge in the annotation process. our approach adopts semantic content analysis to facilitate exploration and annotation of the histology image collection. additionally, graphie also allows the user to interactively evaluate the significance of image features.

little work has been reported on the use of interactive visualization techniques to aid domain experts explore histology image collections. a web application for remote visualization and collaborative annotation of histology images was proposed in  <cit> . jeong et al. introduced a visualization framework that targets interactive examination of histology image stacks  <cit> . while facilitating the annotation and analysis of histology images, these approaches still put the emphasis on individual images. in contrast, our approach systematically organizes image data and helps users discover implicit and latent relationships among phenotypes manifest as images.

there are many approaches to visualize the internal relationship of high-dimensional data. techniques like the classic multidimensional scaling  and the heatmap have been used to visualize the similarity between images  <cit> . these techniques share the advantage of compactly displaying a large amount of data in an intuitive format. our approach uses graphs to visualize the similarity structure of image collections. graph representations are widely used in large population studies  <cit> . interactive methods to explore and analyse network topology as well as the multivariate data are presented in  <cit> . in  <cit> , palmer argues that node-link representations are powerful to display the internal relationship. for this purpose, a graph has a more perceptual impact especially on gleaning proximal and similitude relationships  <cit> . compared against the mds technique, graph-based approaches maintain the topology and relationships among data entries, while, this information is difficult to glean after embedding in lower dimensional 2d planes or even 3d spaces. additionally, graphie provides a much richer set of interactive analysis functions than the above approaches, allowing a more effective and efficient browsing of images. to the best of our knowledge, our prototype is the first system that allows users to focus on the entire histology image collection instead of an individual image.

task analysis and design
to better understand the needs in exploring histology data collections, we worked closely with domain experts. the domain experts expressed an interest in a visual analytics system to aid them in exploring and annotating histology images. through our interactions with the analysts, we derived three main tasks that guided the design and implementation of graphie:

task  <dig> overview of the histology image collection. with a large histology image collection, it is important to gain an expedient overview, so that users can glean the similarities inherent in an image collection at a glance. before analyzing an individual image, researchers often would like to have an overview of the entire image collection to learn the basic contents of a collection, their distributions, and their relationships at a glance.

task  <dig> selection and comparison of images subgroups. selection is extremely important in an image-based phenotypical study. our collaborators mentioned that during analysis that searching for images sharing the same morphological features and viewing images back-and-forth is time-consuming and tedious. researchers seek more efficient ways to select desired images and scrutinize the morphological difference between subgroups of images.

task  <dig> efficient annotation of images. the annotation set is one of the key outputs of the histology image collection analysis. our collaborators expect that the tool allows users to record the annotation while exploring the image collection.

graphie was designed to support these three tasks by providing a visualization overview of the image collection and an interactive user interface to examine individual images and the entire collection. without such visualizations, the researchers' ability to explore and annotate the image collections is ineffective. after several iterations of discussions, we agreed upon using graph visualization to represent the image collection: that is each node in the graph represents an image and the layout of the graph reflects the multivariate distribution and depicts the similarity relationships present in the image collection. in addition, the selection and annotation of individual images can also be achieved by interacting with the graph visualization. we further justify the tasks and our approaches below.

image representation
in order to create a visualization of the histology image collection , one first needs to define a way of measuring the similarity between images. thus, it is necessary to use an image representation to summarize the images' content quantitatively. however, analyzing histology images is particularly challenging, since visual patterns are generally complex combinations of fundamental visual features associated with texture, color and shape  <cit> . even with experienced pathologists, the visual inspection process often suffers from the disadvantages of being subjective, laborious, and insufficient when complex information is needed or is simply unknown. in this work, we employed the bag-of-features   <cit>  approach to represent a collection of histology images. this approach is an evolution of texton-based representations and is also influenced by the bag-of-words representation for text classification and retrieval. briefly, the bofs approach works as follows: first sample images from the entire image collection are collected, image features are extracted from this subset, then a visual codebook is built as a summary of these feature vectors, finally, each image in the collection is represented by the frequency of the elements in the visual codebook that it contains. an important advantage of the bofs approach is that it models image content in a robust way. the bofs approach examines small characteristic image regions, allowing the representation of complex image contents without explicitly modeling objects and their relationships. in doing so, we simultaneously obviate the need for segmenting images-which is often in itself a formidable challenge. it should be noted that the bofs approach has found much success when deployed on images and towards general computer vision tasks  <cit> . further, the bofs representation has been successfully applied to some problems in medical imaging  <cit> .

graph visualization of image collection
the overview should display the image collection in a visually meaningful manner using sensible layouts . in this work, we employ interactive graph visualization to provide an overview of the dataset and allow users to explore the entire image collection. in our case, the similarity between images is defined by the distance between corresponding image representations. the graph is constructed such that each node in the graph represents an image and nodes are only connected by an unweighted edge when two images are similar. therefore, images with similar contents tend to be closer in the graph thus providing a convenient way to compare and analyze groups of subjects. there exist many similarity graph construction algorithms. in graphie, we choose k-nearest neighbor which has been widely used in many visualization and machine learning applications  <cit> .

feature selection
our collaborators observed that data-driven graphs may not capture the entire set of relationships of the target phenotype population. in other words, image representations generated in an unsupervised manner often contain a large amount of irrelevant and redundant features. this makes it very difficult to depict the true relationship between nodes in a given graph. for meaningful exploration, it is useful to find features that are highly correlated with distinct semantic classes. we have thus implemented a functionality via which a user can select arbitrary regions of the graph and examine which features can separate images into different classes. users then can select the feature subset with higher distinctive power and use them to refine the graph visualization.

interactive user interface
interactivity is an essential requirement given the complex nature of heterogeneity of histology image data. as stated in task  <dig>  the tool should allow users to select arbitrary subgroups in the graph visualization, and display them to help users to analyze differences or similarities among groups. we designed and implemented a web-based application with four interactive components, enabling flexible, efficient and adequate analytical functionalities for histology image data exploration.

image annotation
scoring and annotating histology images plays an essential role in phenotype study . the annotations provided by the pathologists could guide researchers to discover phenotype-relevant biomarkers  <cit> . nevertheless, the annotated histology image collections are an important source of information and knowledge, which may support educational activities and various research studies. from a machine learning point of view, accurate annotations are considered to be valuable labels which directly influence the quality of automated histology image annotation systems. given the complexity of visual patterns in histology images and the lack of rigorous phenotypical definitions, the traditional side-by-side manual annotation is often subjective, and sometimes an error-prone process  <cit> . thus, the proposed tool allows users to interact with the constructed graph and enable the annotation of the image collection in a consistent fashion.

graphie-graph based histology image explorer
graphie is an interactive visual analytics tool designed for the exploratory analysis of histology image collections. we first describe the workflow that graphie realizes. our workflow consists of two main parts:

 <dig> back-end generation of image representation: generate visual codebook and encode images as bofs representations.

 <dig> front-end visualization interface: enable users to efficiently explore and annotate images collection by creating and manipulating a graph that accentuates similarities and distinctions across images.

back-end image representation generation
as we stated earlier, we choose the bag-of-features  approach to represent a collection of histology images. this workflow of bofs is summarized by the schematic in figure  <dig>  now, we describe the specific steps of our image representation process:

preprocessing
generally, histology image data is replete with noise, artifacts and non-informative regions. appropriate preprocessing of data is necessary for robust analysis. the choice of appropriate preprocessing methods will depend on the nature of the given image collection. in this work, the images were converted into gray scale and processed for noise removal using anisotropic diffusion filter  <cit> .

feature extraction
a scale-invariant feature transform   <cit>  is employed towards the histology images in our study. sift descriptors are local and based on the appearance of objects or artifacts at particular interest points  and are invariant to image scale and rotation. they are also robust to changes in illumination and noise. additionally, they are highly distinctive, relatively easy to extract and allow for robust object identification with a remarkably low probability of mismatch. mikolajczyk and schmid  <cit>  suggested that sift-based descriptors tend to outperform the other descriptors  in many situations. here we used the following parameter configurations to compute sift features:  <dig> orientations and  <dig> ×  <dig> blocks of cells, resulting in a descriptor of  <dig> dimensions.

visual codebook training
given the feature descriptors extracted above, a visual codebook characterizing extant visual patterns is generated in an unsupervised manner. we use a clustering approach to prune down the data features to a core set of representative features  that constitute the visual codebook. the k-means algorithm is used in this work to find a set of cluster centroids that correspond to visual words. although it has been reported that learning large numbers of k can improve supervised classification results  <cit> , we observed that finding the appropriate number of k depends on the size of the image collection and the specific phenotypes present in the image collection.

image representation
given the visual codebook, a candidate image is represented as follows. features are extracted from candidate image and then assigned to bins, where the bins are obtained by quantifying the feature space using the words in the codebook. the resulting histogram- where the count for each bin gives the frequency of occurrence of the words-is now the representation of the histology images.

front-end visualization interface
the design of graphie visualization interface follows the principles of creating efficient visualization systems suggested by well-known infovis mantras  <cit> . particularly, we further deploy shneiderman's general abstract tasks  <cit>  to the following essential components. the front-end visualization interface consists of four main components:  graph visualization of the image collection,  individual image view,  subgroups gallery, and  feature selection view . our interface uses multiple coordinated views  <cit>  to visualize the given data collection. we aim to keep our user interface and interaction design as simple as possible.

graph visualization of the image collection
with the bofs histogram summarizing the content of images, all pairwise distances between images are computed using the bofs histograms. euclidean distance is used in this work. the resulting similarity matrix reveals the inner relationships of the entire image collection. the similarity matrix provides a fully connected graph, which is pruned down for effective visualization. the goal of pruning the graph is to extract and summarize the topology of the underlying feature space. as mentioned previously, graphie adopts the k-nearest neighbour  to construct the unweighted graph. in a k-nn graph, each node only keeps edges which connect to the k closest nodes, where the euclidean distance between corresponding bofs features defines closeness. given the graph, we visualize it using force-directed graph layout-a method that has been shown to be effective in creating uncluttered visualizations  <cit> . the layout is fully interactive; users can adjust the graph layout by clicking and dragging the node. users can also interactively browse a single image by clicking nodes to examine them in more detail in the individual image view. in order to avoid clutter, users can adjust the size of the nodes and the parameters pertaining to the metaphorical charges and forces that constitute the graph's layout. nodes can be further colored with categorical annotations, thus allowing one to explore the structure of the data more easily. we provide more specific examples when we later discuss the two case studies.

individual image view
the individual image view allows users to inspect individual images and annotation of them. users can either select images by clicking nodes in the graph or by searching for them by name. this view also contains the preview and annotation of the selected image. users can inspect the full resolution of selected images in a pop-up window by click the zoom-in button. there are two options to annotate the selected image: users can either select the corresponding score or qualifier by interacting with a drop down button or input notes in a text box at the bottom. once, the entire image collection is annotated users could export the annotation by clicking the save annotation button.

subgroups gallery
the subgroups gallery component enables browsing and comparing subgroups when needed. each row in the subgroups gallery represents a subgroup of images. users can select/update subgroups of the image collection by interacting with the derived graph visualization. further, users can interactively browse the images by moving the scroll bar and clicking a thumbnail to examine each on the individual image view. the subgroups gallery also enables users to batch annotate all images in the subset by selecting the corresponding score with the drop down button on the left side.

feature selection view
although bofs representation could effectively characterize the histology image, it is generated in an unsupervised manner and can inadvertently generate irrelevant phenotypical features. we implement the feature selection view which enables users to examine the distinctiveness of visual words for selected groups of images, therefore enhancing the visualization. users can define the groups by selecting nodes from the graph visualization according to target phenotypes, or by using existing annotations. in order to select visual words that are most different between two groups of images, we conduct the student's t-test for features to test hypotheses for group discrimination. we list features in ascending order using their p-values, computed according to student's t-distribution. the features with more significant mean differences between selected groups are more likely to distinguish the images in those groups. besides the significant statistic, we also provide boxplots for each feature to display summary information of feature distribution in selected groups. these plots help in better estimating the separability of the groups by the selected feature. in order to further investigate the quality of features, graphie enables users to select a feature subset from the given bofs features. then, users can regenerate the graph with the selected feature subset for the entire image collection to further inspect the changes in the new feature space.

implementation details
the visualization interface is developed in javascript and r using the r/apache module running on an apache server. the data processing is implemented with r script which is triggered by javascript. the interactive visualization is created using d <dig> js  <cit> , a visualization javascript library.

RESULTS
in this section, we demonstrate the efficacy of our methods using two case studies. we described two repositories of data in our possession in the introductory section. the first case study serves the basic science community where the variety in histology of a specific animal model is examined. we especially focused on a portion of the zebrafish retina given that the structure is well understood and that we have labeled descriptions of the morphology. the second case study serves clinical practice where clinicians and pathologists classify patient biopsies to grade and diagnose diseases such as cancers. in this case study, epithelialstromal tissue slides were examined.

zebrafish retina histology images
in biomedical research, the use of animals such as zebrafish as a genetic model is useful for understanding the basic mechanisms that underlie human disease  <cit> . the heterogeneity expressed by the morphology in the eye of the zebrafish also makes the eye a perfect object for our phenotypical study. like most classes of extant vertebrates, the retina of a zebrafish is composed of seven major cell types derived from the neural ectoderm, six types of neurons and one type of glial cell  <cit> .

our examples are obtained from the zebrafish repository. a total of  <dig> images of larval zebrafish eyes were manually extracted from 20× magnification virtual slides acquired by the zebrafish functional imaging core facility at the pennsylvania state college of medicine. image dimensions measure  <dig> ×  <dig> pixels. each slide is a well-stained with hematoxylin and eosin ; the nuclei are the targets of hematoxylin while eosin stains the cytoplasmic and stromal regions. each image is marked with a score  which represent the level of phenotypical abnormality. a score of  <dig> indicates that the image has no visible abnormality while a score of  <dig> indicates an extremity of occurrence of corresponding abnormality. this ground truth scoring is manually recorded by pathologists with expert knowledge of the vertebrate anatomy. with the traditional slide-by-slide inspection, it is extremely difficult for a user to capture the subtle differences and annotate these images consistently and objectively. even with the abnormality annotation made by a domain expert, it is still hard to comprehend the abstract visual pattern characteristics.

we now demonstrate how one can explore the zebrafish dataset with graphie. first the bofs-based image representation was computed. in order to cover most of the visual patterns,  <dig> images were manually selected from each score subset  as representative images. we built the visual dictionary with features extracted these from  <dig> representative images. we tested with several visual dictionaries using k-means clustering, varying the value of k. the resulting graph visualization did not improve significantly when k given larger than  <dig>  thus we chose k =  <dig> as the dictionary's size in this study. with the bofs histograms, the similarity distance between images was calculated using the euclidean distance metric.

however, the absolute separation between wild-type and mutant-type images remains unclear in the initial graph visualization. the small cluster in the upper left corner is connected to the main cluster of mutant-type images but is distinct from the main cluster of wild-type. therefore, we performed feature selection in order to remove visual words that are irrelevant to the target groups. in this particular case, we used the abnormality annotations as the group labels. in order to pick the visual words that are most different between two groups of images, we conducted a student's t-test on each visual word, computed per group to indicate the ability of separating the two groups. as the initial visualization is not optimal, a new graph is regenerated with the top  <dig> ranked visual words. as noted in figure  <dig>  the newly created graph has a much more clear separation between wild and mutant-types. we took a closer look at these images interspersed between distinct wild-type clusters. interestingly, the abnormalities of these eyes are relatively subtle. when confirmed with our collaborators, some of these images were mis-annotated. with the graph visualization and subgroups gallery components, we could easily spot potential mis-annotated images which is a challenging task with the traditional 2-d grid-layout.

through this case study, we can note that graph visualization is superior to a 2-d grid-layout for exploring image collections due to its ability to organize the images based on its content and reveal relationships between groups. by interacting with subgroups gallery and individual image view, one could efficiently compare and spot the differences between subgroups of images, therefore, form hypotheses regarding phenotypes. in addition, graph visualization can be improved by interactively selecting features with feature selection component.

epithelial-stromal tumor tissues
in a second case study, we deployed our methods on digitized tumor tissue slides. an important application of histology images is the examination of cancer tissue slides, wherein pathologists evaluate the composition of epithelial and stromal tissues and their interactions. tissue slide analysis is the standard approach for the analysis of diagnostic, prognostic and predictive morphology biomarkers  <cit> . a majority of solid tumors are composed of epithelial cells. classifying the tissue as epithelial or stromal is an important part of the automated cancer diagnosis  <cit> . in this case study, we demonstrate that through graphie researchers can gain a better perspective of the underlying structure of the tumor microenvironment that is composed of both epithelial and stromal tissues.

here, we present our visualization of the epithelial-stromal distributions. the histological images we used in this case study are collected from the ohio state university  pathology core facility. in order to view the datasets in more detail, we use the super-pixel method to divide each image into  <dig> patches  <cit>  where each patch contains an approximately homogeneous visual pattern and homogeneous tissue .

the visualization workflow adopted here is similar to the one used in the previous case study. we randomly sample and select superpixel patches, and train a codebook. a superpixel patch represents a region of homogenous tissue. for each patch, we again generate a bofs histogram to summarize the image. here, each node represents a patch. due to the large amount of nodes, clutter and costly computation are inevitable with the use of a straightforward force-directed layout scheme. to better interact with the visualization and to allow for the examination of the quality of visual words, we randomly sample  <dig> patches from the collection. in this case study, we carried out the following two explorations:

exploration 1: figure  <dig> is the resulting graph which consists of  <dig> nodes. the color of each node represents the type of tissue in that patch. a blue-colored node indicates a patch containing mainly epithelium; an orange-colored node indicates a patch that mainly contains stroma. we observe that the blue and orange nodes form two clusters. however, the graph visualization shows that clusters of mixed tissue prevail. investigating the content of patches, we find that these patches contain both stromal and epithelial tissue. this artifact occurs because of the lack of quantitative control and subjective bias in our own manual labeling process.

exploration 2: in another exploration, we perform the feature selection over the samples and create a new graph ) by using only the top  <dig> visual words. comparing with the initial graph, the new graph shows an equally good separation between the two types of tissue patches with less visual words. thus, the classification task can be efficiently achieved with a much lower feature dimensional space. it should be further noted that distinct groups are delineated. for instance, subgroup i ) includes purely stromal patches while subgroup iii includes only epithelium patches. in addition, subgroup ii includes patches with a mixture of stromal and epithelium.

discussion and 
CONCLUSIONS
in this paper, we presented graphie, a visual analytics application designed to explore the histology image collection. by taking a data-driven approach, we developed an unbiased way for visualizing the entire collection. graphie not only provides an intuitive overview of the data but also enables users to use domain knowledge to improve the visualization through interactive feature selection. the visualizations and interactions of graphie are seamlessly integrated to allow users to effectively explore and annotate images, with a rich set of interactive functions. the use of graphie was evaluated with two datasets.

the current prototype implementation suffers from a lack-of-scalability, the size of the image collection that can be meaningfully explored is limited. we believed this problem can be tackled by applying different techniques pertaining to graph layout including semantic zooming, focus+context exploration techniques and sparse sampling strategies. in the future, we plan to test graphie with more histology image datasets and improve the image representation with more options of feature descriptors. we also aim to integrate with other types of data  to enable an integrative phenotypical study. finally, we plan to make our tool publicly available in the near future.

competing interests
the authors declare that they have no competing interests.

authors' contributions
hd carried out the system design and implementation, and drafted the manuscript. cw participated in the system design. kh and rm conceived of the study, designed the graphie, and contributed to discussions and suggestions to complete the manuscript. rm supervised the project. all authors read and approved the final manuscript.

