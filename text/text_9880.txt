BACKGROUND
in a diploid organism, each somatic cell has two copies of the genome. at certain genomic loci, gene expression, dna methylation, transcription factor  binding or histone modification  can be allele-specific. in other words, the two alleles can behave differently. these phenomena, also known as allele-specific expression , allele-specific dna methylation  and allele-specific binding , can contribute to phenotypic diversity and may play important roles in adaptive evolution  <cit> . many allele-specific  events have been found to correlate with variants in genomic sequences  <cit> . comprehensively characterizing allele-specificity therefore can help with linking genotypes to phenotypes. abnormal as events have also been linked to various diseases  <cit> . for instance, loss of imprinting in igf <dig> has been associated with increased risk of colorectal cancer  <cit> . this again highlights the importance of studying allele-specificity.

early methods for analyzing as events rely on low-throughput technologies such as real time quantitative pcr  <cit> . later, application of snp arrays has made the as analysis high-throughput  <cit> . more recently, the rapidly evolving high-throughput sequencing technologies opened the door to produce digital read-out of as events genome-wide without being constrained by any specific array design  <cit> . this brings many new opportunities as well as analytical challenges.

chip-seq, a technology that couples chromatin immunoprecipitation with high-throughput sequencing, has become the state-of-the-art approach for mapping genome-wide tf binding sites and hms  <cit> . however, so far the value of this technology for studying asb has not been fully utilized. detecting asb from a single chip-seq dataset often suffers from low statistical power. this is because only a small fraction of reads in each chip-seq sample are mapped to heterozygote snps, and only these reads are informative for inferring allele-specificity. to make the chip-seq based asb analysis more useful, it is important to have either experimental or analytical innovations to increase the power for detecting allele-specificity.

chip-seq data in public domains grow rapidly. a recently developed database hmchip, for instance, has compiled over  <dig> human and mouse chip-seq datasets representing approximately  <dig> samples from 140+ different tfs and hms  <cit> . the large volume of data provides a new opportunity to improve detection of asb. conceptually, an integrative analysis of chip-seq data for different tfs and hms from the same individual and cell type may allow one to discover the synergistic correlation patterns of allele-specificity among different proteins. these correlation patterns can then be utilized to integrate information from multiple datasets to improve the asb detection. for example, if the allelic imbalance of tf a and hm b always co-occur, then analyzing their chip-seq data jointly will increase the effective number of reads available for allelic inference which will then increase the statistical power. unfortunately, existing data analysis tools cannot deal with this emerging opportunity. methods available for analyzing ase or asb using the next-generation sequencing data are all designed for analyzing one dataset at a time. while a few methods are developed for solving problems such as read mapping biases  <cit> , construction of individualized genome sequences  <cit> , and combining multiple snps in the same gene to infer ase  <cit> , no methods and software tools are available for jointly analyzing multiple chip-seq datasets together to discover synergy patterns of allele-specificity among multiple proteins and then use the correlation patterns to increase the power of asb detection by borrowing information across datasets.

in this article, we present an integrated solution to this problem by developing a new approach, iaseq, for jointly analyzing allele-specificity in multiple chip-seq datasets. iaseq uses a bayesian hierarchical mixture model to describe unknown correlation patterns of allele-specificity among multiple datasets. these patterns can be discovered automatically from the data by fitting the model using an expectation-maximization  algorithm. using the identified correlation patterns, the model allows one to integrate information from multiple datasets to improve the asb detection. applying this approach, we analyzed  <dig> encode  <cit>  chip-seq datasets in gm <dig> cells, representing a total of  <dig> samples from  <dig> tfs and hms. the analysis demonstrates the ability of iaseq to automatically integrate information from multiple datasets to significantly improve the detection of allelic imbalance. iaseq is implemented as an r package which is freely available from bioconductor  <cit> .

methods
data structure
suppose there are d chip-seq datasets generated using cells from the same individual and the same cell type. each dataset d corresponds to one tf or hm, and has jd replicate samples . different datasets represent different tfs or hms, or data generated by different labs. for the individual in question, assume one is interested in analyzing i heterozygote snps with known genotypes. we want to know whether the two alleles of each snp behave differently in each dataset, and if possible how the as events are correlated among datasets. for each snp, the allele consistent with the reference genome is called the reference allele, and the other allele is called the non-reference allele.

after read mapping and data preprocessing , we count reads for each allele at each heterozygote snp. for snp i, dataset d and replicate sample j, let xidj and yidjbe the read counts for the reference allele and non-reference allele respectively. let nidj=xidj + yidj be the total read count . protein-dna binding can be skewed to the reference allele , skewed to the non-reference allele , or not allele-specific . we use a binary variable bid to indicate whether snp i is sr  or not  in dataset d. if bid= <dig>  then snp i is assumed to be sr in all replicate samples in dataset d. similarly, we introduce another binary indicator cid to indicate whether snp i is sn or not in dataset d. bidand cid cannot be equal to one at the same time. if bid= <dig> and cid= <dig>  then snp i is ns in dataset d. the configuration at each snp i can be described by two vectors bi= and ci= . based on these notations, , or equivalently , are the observed data for snp i in sample , whereas the indicators bid and cid are unobserved.

main intuition and challenge
our primary goal is to infer for each snp whether there is allelic imbalance in each dataset. this is equivalent to inferring bid and cid. a simple solution to this problem is to analyze each individual dataset separately, but this approach has low statistical power since the counts  usually are small.

if one knows how different datasets are correlated in terms of allelic imbalance, this knowledge may be used to improve the data analysis. for instance, if the allelic imbalance of two proteins a and b are closely correlated, then observing skewed read counts for protein a will provide information for inferring the allelic imbalance of protein b. integrating the data from both a and b will increase the effective number of reads available for statistical inference, which will then lead to increased statistical power.

in reality, how different proteins are correlated is usually unknown. however, one may learn it by studying the data from many snps. each snp has three possible states in each dataset: sr, sn and ns. for d datasets, there are 3d possible configurations in total. from studying many snps, one can know the relative frequencies  of these 3dconfigurations. the mixing proportions will tell how different datasets are correlated. for instance, let  be the skewness configuration of a snp in the d datasets. if the mixing proportions for three configurations ,  and  are  <dig> ,  <dig>  and  <dig> , then no other configurations exist in the data and all datasets are perfectly correlated in terms of the allelic imbalance. in other words, at a particular snp, if one dataset is sr, then all the other datasets are also sr. if one is sn, then all the others are also sn. on the other hand, if other configurations have non-zero mixing proportions, then not all datasets are perfectly correlated, and at a particular snp, one allows the possibility that only a subset of datasets are correlated. for instance, if the mixing proportion for a configuration  is  <dig> , then there will be 3% of snps that are skewed to the reference allele in the first two datasets but not skewed in the other datasets. therefore, knowing the mixing proportions of all 3dconfigurations will tell one the correlation structure in the data. this knowledge can then be used to improve statistical inference at each individual snp by facilitating information sharing across datasets. for example, if the configuration  has a much higher mixing proportion than , then observing strong skewness towards the reference allele of a snp in the first two datasets will imply that, a priori, the snp is highly likely to be skewed to the non-reference allele in the third dataset and has much lower probability to be non-skewed for both alleles. the principle here is the same as the principle represented by the bayesian hierarchical models in the statistical literature.

a limitation of this approach is that one has to enumerate all 3d as configurations in order to describe the correlation. as the number of datasets increases, the number of possible configurations increases exponentially. thus this approach does not scale well with the increasing d. later, in our analysis of gm <dig> data, d= <dig> and 3d> <dig>  this simple approach is clearly intractable.

to circumvent the difficulty of documenting the frequencies of all 3dconfigurations, iaseq employs a technique that can describe the major correlation patterns in the data using a few probability vectors whose values vary from  <dig> to  <dig> rather than being dichotomous . this approach significantly reduces the model complexity but keeps the flexibility to account for all 3dconfigurations. it is easily scalable to increasing dataset number. the correlation structure in the model can then be used to improve the statistical inference of allelic imbalance at each snp in each individual dataset.

probability model
iaseq is based on the bayesian hierarchical mixture model below that uses several probability vectors to describe the major correlation patterns among multiple datasets . the model assumes that snps can be grouped into k +  <dig> classes with different allele-specificity patterns , and the observed data are viewed as generated as follows: 

● first, a class label aiis randomly assigned to each snp i according to a probability vector Π=. here, Πk=pr is the prior probability to assign a snp to class k. ∑kΠk= <dig> 

● if the class label ai= <dig>  then bi= and ci=. in other words, all snps in class  <dig> are background snps, and they are ns in all datasets. if ai=kand k≠ <dig>  then snp i can be skewed, and its s in different datasets are generated independently according to the following probabilities: pr=vkdand pr=wkd. we assume vkd + wkd< <dig>  i.e., pr=1−vkd−wkd> <dig>  the model implies that each class is associated with two vectors of probabilities vk= and wk=. for snps in class k, biand ciare generated according to the probabilities in vkand wk.

● next, the observed read counts are generated based on the as configurations specified by bis and cis. consider snp i and dataset d. if bid= <dig>  then  in each replicate sample  is generated according to a probability distribution pr=prpr≡prfidj <dig>  here we assume that the marginal distribution of nidjdoes not depend on bidand cid, and we use fidj <dig> to denote the conditional distribution pr. data in different replicate samples are assumed to be generated independently. similarly, if cid= <dig>  then s are generated according to pr=prfidj <dig>  if bid= <dig> and cid= <dig>  then s are generated according to pr=prfidj <dig> 

for snp i and dataset d, we organize data from all replicates j= <dig> ⋯,jd into xid= and nid=. for snp i, xi= and ni= contain data from all datasets. the final observed data are x= and n= which are the ensemble of data from all snps.

let a= be the collection of class membership indictors of all snps, and let b= and c= be the sr and sn indictors for all snps. a, b and c are the unobserved missing data one wants to infer.

organize the probability vectors vkand wk from different classes into two matrices vk×d=t and wk×d=t. v, w, and the probability vector Π that describes the class abundance are the unknown model parameters. k is assumed to be fixed. the choice of k and specification of data generating distributions pr, fidj <dig>  fidj <dig> and fidj <dig> will be discussed later.

based on this model, each snp class k  is associated with two vectors of probabilities vkand wk which characterize the allelic imbalance preferences in different datasets for snps belonging to class k. for example, if a class has  = , then snps in this class have high probability to be sr in datasets  <dig> and  <dig>  and high probability to be sn in dataset  <dig>  but they have low probability to be allele-specific in dataset  <dig>  since vk and wkare probabilities rather than 0- <dig> vectors, each class k can generate all 3d as configurations. therefore, snps in the same class are not required to have the same as configuration , although they usually have similar as configurations because snps in the same class are all generated using the same probability vectors. meanwhile, there are k different classes, and each class has a different  which specifies a different preference to generate the skewing configurations. thus, whereas snps in the same class tend to have similar  configurations, snps from different classes tend to have very different configurations. conceptually, this is similar to a model-based clustering analysis in which snps are grouped into k +  <dig> clusters based on their  configurations. however, an important difference here is that s are unknown.

our model assumes that s of the same snp in different datasets are a priori independent conditional on the class membership ai. however, s from different datasets are not independent marginally if one integrates out the class label ai. for example, the marginal probability pr=∑kprpr=∑k=1kΠkvkd. on the other hand, the joint probability pr;])=∑k=1kΠk, which is clearly different from the product of the marginals ∏dpr=∏d. this explains why our model can be used to describe the correlation among multiple datasets despite the conditional independence assumption. intuitively, if one views the model as a clustering analysis of snps based on , then each cluster will represent a co-occurrence pattern of allele-specificity across multiple proteins. the marginal correlation among multiple datasets is described by multiple clusters, whereas within each cluster the data in different datasets are generated independently. in real data, a small k  usually is sufficient to describe the major correlation structure among datasets. using Π, v and w to describe the correlation among datasets only requires o parameters, which is significantly less complex than o parameters. at the same time, the iaseq model still provides the flexibility to accommodate all 3d possible  configurations as all of them have non-zero probability to occur.

data generating distributions
to fully specify the model, one also needs to specify the data generating distributions pr=prpr. the primary goal of iaseq is to infer whether two alleles are different. we assume that information on allele-specificity is only contained in pr, and therefore the exact form of pr, i.e., the marginal probability distribution of the total read count, is irrelevant for our purpose. as such, we mainly focus on modeling the conditional distribution of xidjgiven nidj, bid and cid, i.e., the three distributions fidj <dig>  fidj <dig> and fidj <dig> 

iaseq models these distributions hierarchically in two steps. first, xidj is assumed to follow a binomial distribution xidj|nidj,pidj∼bin, where pidj is the probability that a read generated at snp i in sample  represents the reference allele. next, we model pidjdepending on the values of bidand cid.

if bid= <dig> and cid= <dig>  snp i is ns in dataset d. in this case, we assume that pidjfollows a beta distribution beta with mean pdj0=αdj/. note that a simpler model for pidj would be to set it to a constant pdj <dig> which reflects the background ratio of read counts between two alleles. however, previous studies have shown that many background snps can have pidj slightly different from the average background pdj0even though they do not have biologically meaningful allele-specificity  <cit> . as a result, a constant pdj <dig> is not sufficient to describe the background variation. for this reason, we adopt the beta distribution to describe pidj instead of setting it to a constant  in figure 1c). in the ideal world, the mean of the beta distribution, pdj <dig>  would be equal to  <dig> . however, in reality pdj0may be slightly different from  <dig>  due to various sources of read mapping biases. for example, allowing the same number of mismatches, reads from the reference allele are easier to be mapped back to the reference genome than reads from the non-reference allele. therefore, in iaseq pdj0may take values different from  <dig> . indeed, it is determined by the parameters αdj and βdj in the beta distribution which are estimated from the data using a moment matching approach . once estimated, αdj, βdj and pdj0are treated as fixed and known parameters. based on the model for pidj, we integrate out all possible values of pidj to obtain the distribution of xidjconditional on bid= <dig> and cid= <dig>  which is a beta-binomial distribution: 

  fidj0=prxidj|nidj,bid= <dig> cid=0=∫01pr×fpidj|bid= <dig> cid=0dpidj=cnidjxidjbαdj,βdj∫01pxidj+αdj−1nidj−xidj+βdj−1dp=cnidjxidjbxidj+αdj,nidj−xidj+βdjbαdj,βdj 

here cnk is the binomial coefficients “n choose k”, and b is the beta function.

if bid= <dig> and cid= <dig>  snp i is sr in dataset d. in this case, we assume that pidj follows a uniform distribution u in figure 1c). here pdj0=αdj/ is defined as above. after integrating out pidj, the distribution of xidjconditional on bid= <dig> and cid= <dig> is 

  fidj1=pr=∫01pr×fdpidj=cnidjxidj1−pdj0∫pdj01pxidjnidj−xidjdp 

if bid= <dig> and cid= <dig>  snp i is sn in dataset d, and we assume that pidj follows a uniform distribution u  in figure 1c). after integrating out pidj, the distribution of xidjconditional on bid= <dig> and cid= <dig> is 

  fidj2=pr=∫01f×fdpidj=cnidjxidjpdj0∫0pdj0pxidjnidj−xidjdp 

joint probabilities and model fitting
based on the model above, the complete data likelihood can be derived as: 

  pr=prpr=pr∏i=1ipr 

define lid0=∏j=1jdfidj <dig>  lid1=∏j=1jdfidj <dig> and lid2=∏j=1jdfidj <dig>  define δ to be an indicator function. δ= <dig> if its argument is true, and δ= <dig> otherwise. we have 

  prxi,ai,bi,ci|ni,Π,v,w=prai|Π∏d=1dprbid,cid|ai,v,wprxid|nid,ai,bid,cid=Π0∏d=1dlid0δai=0∏k=1kΠk∏d=1dvkdlid1bidwkdlid2cid×lid01−bid−cidδai=k 

to infer Π, v and w, we employ a bayesian approach by imposing a dirichlet prior d on Π and imposing independent dirichlet priors d on all triplets . the joint posterior distribution of unknown parameters and indicators given the observed data is: 

  pra,b,c,Π,v,w|x,n∝prx,n,a,b,c|Π,v,wfΠ,v,w∝∏i=1iprxi,ai,bi,ci|ni,Π,v,w∏k=0kΠkη−1×∏k=1k∏d=1dvkdη−1wkdη−11−vkd−wkdη− <dig> 

conditional on the observed data, pr is a constant that does not contain parameters of interest, therefore it is absorbed into a proportionality constant not shown in the formula above. using this joint posterior, an em algorithm can be derived to search for posterior mode  of pr=∑a,b,cpr in which the missing indictors a, b and c are all integrated out .

for the dirichlet prior, we use η= <dig> . in the em algorithm, we assume that the class number k is given. in order to choose the optimal k, we run the algorithm multiple times using different values of k. we choose the best k using the bayesian information criterion  .

statistical inference of allele-specificity
the estimated Π, v and w can describe the correlation patterns of allele-specificity among datasets. given Π, v and w, one can infer whether snp i belongs to class k based on the posterior probability pr . one can then infer whether each snp i is skewed in each individual dataset d based on the posterior probability pr=∑aipr after summing over all possible values of ai. note that 

  prbid,cid|xi,ni,Π,v,w=∑kprai=k|xi,ni,Π,v,wprbid,cid|ai=k,xi,ni,Π,v,w 

define 

  p~id=maxprbid= <dig> cid=0|xi,ni,Π,v,w,prbid= <dig> cid=1|xi,ni,Π,v,w 

using p~id, snps can be rank ordered for biologists to choose candidates to design follow-up studies. for each top ranked snp, one can determine its skewing direction by comparing pr and pr. the one with the larger value determines the direction. finally, the posterior probabilities of top n snps can be converted to an estimate of false discovery rate  using fdr=∑i∈topnsnps/n.

formula  <dig> shows that two types of information contribute to pr:  pr, which is determined using information from all d datasets, and  pr, which only uses information specific to dataset d conditional on Π, v and w. thus for each particular dataset d, the dataset-specific information is weighted by information obtained from other datasets to determine the snp ranking. intuitively, if allelic imbalance in two datasets are correlated, then observing an as event in one dataset will suggest that a relatively weak skewing event observed at the same snp in the other dataset is very likely to be a true as event. in contrast, if no as event is observed in one dataset, then a relatively weak skewing event observed at the same snp in the other dataset is likely to be a false positive. this is the underlying nature of using pr to re-weigh information in pr, and it provides the foundation for improving snp ranking by borrowing information across datasets. in real applications, Π, v,w are unknown, and they are replaced by the posterior mode obtained from the em algorithm.

RESULTS
gm <dig> data and preprocessing
we collected  <dig> encode  <cit>  chip-seq datasets with a total of  <dig> samples together with a genomic dna sample in gm <dig> lymphoblastoid cells . gm <dig> is a female and is one of the most extensively studied cell lines in encode. within each dataset, the number of replicate samples varied from  <dig> to  <dig>  we downloaded the raw sequence reads of all  <dig> samples and mapped them to human genome  . we removed repeated sequences from the chip-seq datasets to avoid pcr duplicates, which may skew the determination of allelic biases. in other words, if multiple reads have exactly the same sequence, only one copy is retained. we obtained the genotype data for gm <dig> from  <cit> .

as previously described in  <cit> , there are two different types of read mapping biases that may affect the analysis of as events: the reference bias and the inherent bias. the reference bias often occurs when one maps sequence reads to a reference genome. if one allows the same number of mismatches in the alignment, a read from the non-reference allele is less likely to be mapped back to the reference genome compared to a read from the reference allele, since the non-reference read has one more mismatch to the reference genome. this phenomenon is known as the reference bias. this type of bias, if it exists, is automatically taken care of by the iaseq model through the parameter pdj <dig> which models the background skewing probability and is estimated using all reads mapped to heterozygote snps in each sample. if there is reference mapping bias, pdj0will take a value different from  <dig>  to adjust for the bias. one may remove reference bias before the analysis by masking snps in the reference genome during the alignment or by aligning reads to a diploid personal genome. this situation will also be automatically recognized by iaseq through the estimation of pdj <dig> from the data . therefore, regardless of whether the reference bias has been removed from the data in the preprocessing or not, the iaseq model is able to automatically handle it and adjust the inference accordingly.

the intrinsic bias is a different type of bias. as shown by  <cit> , even if the reference bias is removed , the inherent bias still exists. for example, suppose sequence  <dig>  and sequence  <dig> are two reads that differ only in one position . it is possible that sequence  <dig> is easier to be mapped back to its correct location in the genome than sequence  <dig> if the second sequence has many repeats in the genome. this bias reflects the inherent characteristics of the genome and cannot be removed by masking variants in the reference genome or by mapping reads to a diploid personal genome. in the above example, masking a and t in the original reads is also not a solution, since a priori one does not know which position in a read corresponds to a snp position and therefore should be masked without first aligning the read to the genome. when a heterozygote snp has inherent bias, one allele will have higher read counts than the other even if the two alleles have the same binding level. to avoid this bias, we used the approach described in  <cit>  to remove snps with the inherent bias.

we began with  <dig> , <dig> heterozygote snps and filtered out  <dig>   snps with inherent bias. next, we eliminated snps that were not bound by any tf or associated with any hm in any dataset . after applying these filters,  <dig>  heterozygote snps remained. these  <dig>  snps were then analyzed by iaseq.

a simulation study
before we apply iaseq to the real data, we first tested its performance in simulations that took into account real data characteristics. our simulations kept the same design as the real gm <dig> chip-seq data, with the same number of datasets and the same number of replicates within each dataset, except that the genomic dna sample was not used here since we knew the truth in the simulations and did not need genomic dna as a control for potential bias. to create the simulation data, we first applied iaseq to the real gm <dig> data to identify  <dig>  snps that were not skewed in any dataset using pr> <dig>  as cutoff. to mimic the real background noise, these snps were resampled by a bootstrap procedure to create the background snps in the simulations, and we kept the read counts  of each background snp as is in the simulated data. next, we simulated asb snps and added them to the background. simulations were carried out under two different scenarios . 

● scenario 1: two types of asb snps  were created in addition to the background snps . the snp number for class  <dig>   <dig>  and  <dig> was  <dig> ,  <dig>  and  <dig>  respectively. thus the true Πkfor the three classes was  <dig> ,  <dig>  and  <dig>  respectively. snps in class  <dig> were sr in datasets  <dig> to  <dig> . snps in class  <dig> were sn in datasets  <dig> to  <dig> . in datasets  <dig> to  <dig>  no snps had allelic imbalance. class  <dig> can be viewed as the mirror image of class  <dig>  this symmetric design reflects the symmetry of allele-specificity, that is, the skewing to the reference allele and to the non-reference allele is approximately symmetric. the class abundance  roughly matched the abundance observed in the analysis of real gm <dig> data.

● scenario 2: four correlation patterns  were created in addition to the background class . class  <dig> and class  <dig> were the same as in simulation  <dig>  classes  <dig> and  <dig> were two new patterns. snps in class  <dig> were sr in datasets 21- <dig>  and sn in datasets 1- <dig>  class  <dig> was the mirror image of class  <dig>  the abundance of the classes  <dig> to  <dig> was .

given the simulated  configurations, we then simulated the read count data for asb snps as described in detail in additional file 1: supplemental methods s. <dig>  simulations done in this way was able to keep the major characteristics of real data while allowing us to benchmark the performance of different methods since we knew the truth.

we applied iaseq to both simulations. in both cases, iaseq was able to identify the correct number of snp classes using bic . figures 2c and 2f show that the asb patterns reported by iaseq matched the true patterns well. in order to test whether iaseq can improve the statistical power of detecting snps with allelic imbalance, we compared the snp ranking provided by iaseq with rankings provided by five other methods that analyze each dataset separately . in iaseq, snps were ranked in each dataset d according to the posterior probability p~id defined by formula  <dig>  since we know the truth, we can count how many of the top n snps were true positives. here the true positives were defined as snps that were truly allele-specific and also had the skewing direction correctly inferred. the five single-dataset based methods for ranking snps include a deviation statistic d, naive z statistic, naive bayes statistic, empirical bayes statistic and single dataset em. these methods were applied to each individual dataset. for each dataset d, we merged data from all replicates to obtain xid=∑j=1jdxidj and nid=∑j=1jdnidj. we then computed the statistics used for snp ranking as described below. 

 <dig>  deviation statistic : snps were ranked based on |xid/nid−pd0|. here we estimated pd0=1i′∑i:nid≠0pid=1i′∑i:nid≠0xidnid, where i′is the number of snps for which nid≠ <dig> 

 <dig>  naive z statistic : snps were ranked based on |xid/nid−pd0|/nid). here pd0was estimated as in the deviation statistic d.

 <dig>  naive bayes statistic : snps were ranked using |/−p~d0|. here p~d0=1i∑ixid+2∗pd0nid+ <dig> where pd0was estimated as in the deviation statistic d. the implicit assumption here is that xid|pid∼bin and pid∼beta with αd=2p~d <dig> and βd= <dig>  the posterior mean of pidis used to construct the ranking statistic.

 <dig>  empirical bayes statistic : snps were ranked using |/−pˇd0|. we estimated pˇd0=α^dα^d+β^d. the implicit assumption is the same as the naive bayes statistic, but now we estimate αdand βdbased on the observed data using the method of moments as in iaseq .

 <dig>  single dataset em : we fitted a mixture model of sr, sn and ns with distributions fidjp,p= <dig> , <dig> and mixing probabilities vd, wdand 1−vd−wdfor each dataset d without considering other datasets. snps were ranked using a posterior probability similar to p~id, but now determined based on information in dataset d only .

in general, the observed differences between iaseq and the d, z, b and b statistics could be caused by many factors such as use of different statistical models, ranking statistics, or methods for parameter estimation. however, the comparison between iaseq and the single dataset em represents a well-controlled comparison since these two methods used exactly the same distributional assumptions and parameter estimation methods. the only difference between them was that iaseq used information from multiple datasets whereas singleem was based on one dataset only. this well-controlled comparison shows that jointly modeling multiple datasets is able to improve the allelic inference.

to examine whether iaseq was able to bring improvement in all datasets, we computed the area under the receiver operating characteristic  curves  for each method in each dataset using the top  <dig> ranked snps. in each dataset, we computed the proportion of improvement in terms of auc brought by iaseq over the best single-dataset based ranking method . dauc> <dig> means iaseq is able to bring improvement. figures 3d and 3h show the distribution of dauc across all  <dig> datasets as a histogram. the results show that iaseq was able to improve the snp ranking in almost all datasets.

in figure  <dig>  we converted the iaseq posterior probabilities of top n snps to fdr estimates and plotted the estimated fdr against the true fdr. the figure shows that iaseq was able to provide reasonable fdr estimates as well. shown in the figure are a few representative datasets. results in all other datasets were similar.

analysis of real data
our simulation study demonstrates the ability of iaseq to discover correlation patterns of allele-specificity and improve the detection of skewed snps. next, we applied iaseq to analyze the  <dig> real datasets  in gm <dig> cells. in real data, we do not have comprehensive knowledge about the truth. therefore, unlike simulations, we were not able to assess the fdr estimates. for this reason, we mainly focused on analyzing the correlation patterns of allele-specificity and testing whether iaseq can improve the snp ranking.

correlation patterns of allele-specificity
figures 5b and 5c show the posterior mode of vkand wk for the two non-background classes. it turned out that these two classes corresponded to two global directions of allele-specificity, sr and sn, respectively. since the assignment of reference or non-reference allele depends on the reference genome, the assignment per se is not of biological interest. however, recall that gm <dig> is a single person, therefore at each single snp, the nucleotide representing the reference or non-reference allele is the same across all datasets analyzed here. given this fact, what these results essentially tell is that at each single snp, most tfs and hms in our analysis were highly correlated in terms of allele-specificity, and if they are skewed, they tend to be skewed toward the same direction . for instance, for snps in class  <dig>  both h3k4me <dig>  and h3k27ac  had high probability to be sr, with  equal to  and  respectively . the probability that one is sr and the other one is sn was small. similarly, for snps in class  <dig>  both h3k4me <dig> and h3k27ac were highly likely to be sn simultaneously = for h3k4me <dig>  and  for h3k27ac ). while the allelic imbalance of most tfs and hms were highly correlated, h3k27me <dig>  a hm involved in gene repression, was an exception. in both non-background classes, h3k27me <dig> had much lower skewing probabilities compared to the other proteins . within each class, the difference in the skewing probability between the two alleles was also much weaker for h3k27me <dig> as compared to the other proteins. for instance, in class  <dig>  while most other proteins showed strong preference to be skewed toward the reference allele, h3k27me <dig> can be skewed to the reference allele at some snps and skewed to the non-reference allele at many other snps. therefore, the allelic imbalance in h3k27me <dig> is not strongly correlated with the allelic imbalance of the other proteins analyzed here. for the genomic dna which was used as control here, the skewing probabilities  in both classes were fairly low as shown in figure 5b-c. in both classes, the probability for not being skewed in the genomic dna  was bigger than  <dig> . this indicates that the high probability of skewing observed in the other datasets was not an artifact.

the coordinated allelic imbalance of different proteins toward the same allele has also been observed in a recent study  <cit> . in that study, the authors analyzed as of  <dig> tfs and found that when multiple tfs bind to the same snp, they frequently bind to the same allele. moreover, those authors did not observe any pair of tfs that regularly bind the same position on alternate alleles. our observation here therefore is consistent with their finding.

increased power for detecting allele-specificity compared with single dataset analysis
we ranked snps based on the posterior probabilities p~id in each dataset. the iaseq ranking was compared with the rankings provided by the five single-dataset based methods described above. since we do not know the truth, we used two types of independent information as gold standard to benchmark the ranking results.

first, we evaluated different methods by counting how many of their top ranked snps were located in the non-pseudoautosomal regions of chromosome x  . gm <dig> is a female lymphoblastoid cell line. in gm <dig>  snps in chrx-npa are expected to be allele-specific due to cells rapidly become clonal in culture leading to a skewed x-inactivation  <cit> . therefore, given a fixed number of top snps, the more chrx-npa snps one can find, the more powerful a method is. figure  <dig> shows that iaseq clearly increased the power for detecting allele-specificity in each dataset compared to the single-dataset based analysis. for example, figure 6a shows that in the h3k27ac dataset generated by the broad institute, iaseq was able to identify  <dig> chrx-npa snps among the top  <dig> snps. this represents 126% improvement compared to singleem, the best single-dataset based ranking method in that dataset, which only identified  <dig> chrx-npa snps. figures 6a-g show results in a few representative datasets. figure 6h shows the distribution of dauc  in all  <dig> datasets. these plots clearly show that iaseq outperformed all single-dataset based methods in all datasets and the average improvement in auc was 354%.

second, we evaluated different methods by using independent rna-seq data. from rna-seq, one can identify exonic ase snps and use them as gold standard. we collected two rna-seq datasets in gm <dig>  one from the california institute of technology  and the other from the yale/stanford university  . from each dataset, we identified the top  <dig> exonic ase snps using the naive bayes statistics. using the other methods to identify the gold standard ase snps produced similar results which, for simplicity, will not be shown here. based on these exonic ase snps, we defined a snp in our chip-seq analysis as truly allele-specific if there was an exonic ase snp in its xkb neighborhood. here we tried both x=10kb and x=1kb and obtained similar results. below we illustrate the results using x=10kb as an example. the corresponding results for x=1kb are shown in additional file 4: figures s3-s <dig>  among the  <dig>  snps analyzed in the chip-seq data,  <dig>  had one or more exonic snps within its 10kb neighborhood and therefore could potentially be linked to an exonic ase snp. figure  <dig> and additional file 5: figure s <dig> compare rankings of these snps provided by different methods in terms of how many of the top ranked snps are true positives . iaseq again outperformed all the other single-dataset based ranking methods. for instance, based on the caltech gold standard, iaseq on average identified 144% more true positive snps among the top  <dig> snps . according to the yale gold standard, iaseq achieved an average of 149% improvement in terms of the true positive rate among top  <dig> snps . the average improvement in terms of auc  across all  <dig> datasets was 148%  and 165%  for the caltech and yale gold standard respectively.

to ensure that the increased statistical power was not completely attributed to x chromosome snps, we repeated the benchmark analysis based on rna-seq using only snps in autosomal chromosomes, and we obtained similar results . this shows that the increased power is not only contributed by chrx snps.

comparisons with other methods
most existing studies on allele-specificity were conducted using in-house data analysis pipelines. a tool developed by skelly et al.  <cit>  and alleleseq  <cit>  are two software tools accessible to third-party users for as analysis. the method proposed by skelly et al.  <cit>  is designed for analyzing ase in rna-seq data. it first fits a background model using genomic dna and then feeds the estimated parameters into a bayesian model that combines information from multiple snps within a gene to infer ase. when we applied this method to analyzing the gm <dig> chip-seq data, two problems occurred. first, the method uses markov chain monte carlo  to fit the background model from the genomic dna which, as alerted by  <cit> , is well-known for its slow speed and difficulties for users to monitor the convergence. our genomic dna data had  <dig>  snps which covered  <dig>  genes. running this algorithm on this data using the parameter settings recommended by  <cit>  on a machine with  <dig>  ghz cpu and  <dig> gb ram took more than  <dig> days. second, after feeding the background model parameters obtained from the first step to the inference model in the second step, the algorithm stopped execution after a few iterations. this is because the original model was developed for deeply sequenced rna-seq rather than chip-seq, where the average read count covering a heterozygote snp in a chip-seq dataset is only  <dig> . as a result, the model developed in  <cit>  did not fit the real data in chip-seq experiments. this lack-of-fit caused the program to stop early, likely due to the abnormally fitted parameters causing various computation problems . for this reason, although the method proposed by  <cit>  represents an advanced solution for analyzing rna-seq ase, it cannot be directly used to analyze asb in chip-seq data without significantly redesigning the model and algorithm. for this reason, it is not further compared here.

alleleseq  <cit>  is another tool for as analysis. it has been used to analyze asb of several tfs in gm <dig>  <cit> . alleleseq is more focused on the preprocessing step. its pipeline first constructs a diploid personal genome sequence according to family trio data and then maps chip-seq reads to this personal genome. after removing various biases, the method then analyzes allele-specificity in each individual chip-seq dataset separately.  <cit>  applied alleleseq to analyze  <dig> different tf datasets in gm <dig>  among them  <dig> were also included in our iaseq analysis. we compared iaseq and alleleseq using these same  <dig> datasets. we first obtained the asb snps reported by alleleseq from  <cit> . let tddenote the number of reported asb snps for each tf dataset d. we next obtained the top tdsnps ranked by iaseq. we then compared these two methods based on how many of their top td snps were in chrx-npa, and how many of them were associated with exonic ase snps determined by rna-seq. for the benchmark analysis based on rna-seq, we associated exonic ase snps with chip-seq snps using both 10kb and 1kb neighborhood. we also performed the comparison after excluding the chromosome x snps. table  <dig>  additional file 7: table s <dig>  additional file 4: tables s4-s <dig> and additional file 8: figure s <dig> show that iaseq either outperformed or performed comparable to alleleseq in all datasets. sometimes, the improvement was substantial .

column 1: tf name. column 2: tdis the number of alleleseq reported asb snps. columns 3-4: the number of non-pseudoautosomal region x chromosome snps among the top tdallele-specific snps reported by alleleseq and iaseq. column 5: tdis the number of alleleseq reported asb snps that had an exonic snp within their 10kb neighborhood. columns 6- <dig> show among the top tdallele-specific snps reported by alleleseq and iaseq, how many snps had ≥ <dig> exonic ase snp in their 10kb neighborhood according to the caltech rna-seq experiment. column 8: tdis the number of alleleseq reported autosomal asb snps that had an exonic snp within their 10kb neighborhood. columns 9- <dig> show among the top tdautosomal allele-specific snps reported by alleleseq and iaseq, how many snps had ≥ <dig> exonic ase snp in their 10kb neighborhood according to the caltech rna-seq experiment. additional file 7: table s <dig> contains similar results using yale rna-seq exonic ase snps as gold standard.

discussion
interpretation of the correlation patterns
when analyzing the real data in gm <dig>  iaseq found two non-background as patterns, representing two opposite directions of allelic imbalance. since the assignment of reference and non-reference allele depends on the reference genome, whether a snp is skewed toward reference or non-reference allele per se does not have direct biological meaning. what these two patterns essentially suggest is that the allelic imbalances of multiple proteins at a single snp are correlated and have high preference to be skewed toward the same allele. in other words, the two patterns should be viewed as a pair and interpreted together.

in general, although one may view different allelic imbalance patterns in iaseq as different clusters of snps, these clusters only describe the similarities among snps in terms of their skewness directions, rather than the similarities in terms of their functions. the direction is defined using the reference/non-reference allele. the reference or non-reference allele for different snps can have different meanings . therefore within each cluster, even though snps have similar skewness pattern, they are not necessarily functionally related to each other. one should not confuse the snp clusters here with the clusters obtained from the traditional gene expression microarray data analysis, where co-expressed genes in a cluster often have similar functions. in iaseq, the clusters only serve as a tool to describe the correlation structure among different datasets , rather than the functional correlation among different snps. the correlation patterns among datasets are used by iaseq to inform one how to integrate information across datasets  to improve detection of as events for each individual snp and dataset. in order to understand functions of the detected as events, one needs to further correlate the iaseq results with other information .

our observation that different proteins prefer to be skewed in the same direction is consistent with a recent observation reported in  <cit>  that as of  <dig> different tfs are skewed toward the same allele. a number of factors could contribute to the observed correlation. first, biologically it is plausible that functionally related hms and tfs have correlated allele-specificity. for instance, both h3k4me <dig> and h3k4me <dig> are markers for active transcription. therefore, for a specific snp, if the reference allele is associated with a gene with active transcription but the non-reference allele is not, then it is very likely that both h3k4me <dig> and h3k4me <dig> will be skewed toward the reference allele. for another snp, if the non-reference allele is transcribed but the reference allele is not, then both h3k4me <dig> and h3k4me <dig> will have high probability to be skewed toward the non-reference allele. in the genome, h3k4me <dig> and h3k4me <dig> are skewed toward reference allele for some snps, and skewed toward non-reference allele for some other snps. therefore the skewed snps could naturally fall into two clusters, representing two opposite as directions. second, as pointed out by  <cit> , the coordinated as could also occur as a result of the difference in the chromatin landscape between the two alleles. for instance, if the chromatin on one allele is more open and accessible, it could increase the overall binding probability of multiple different proteins, leading to correlated allelic skewing.

while our results show that most analyzed tfs/hms tend to be skewed toward the same direction, these results do not imply that these proteins are perfectly correlated in terms of allele-specificity at each and every snp. in iaseq, the correlation patterns vkand wkare probabilistic patterns rather than 0- <dig> vectors. each correlation class k can generate all 3d as configurations. for instance, for a class with = , it is possible to have one snp with configuration  and at the same time another snp with configuration . therefore, snps in the same class are not required to have the same as configuration, even though they tend to have similar as configurations. the probabilistic patterns are used here to provide a parsimonious description of the complex correlation structure in the data, so that one can circumvent the difficulty of handling 3d as configurations whose complexity increases exponentially. as a consequence of using this parsimonious model, multiple weak correlation patterns without strong enough data support could be merged into a bigger class. for instance, consider two as patterns =  and = . suppose both patterns are equally likely to occur in the data. if each pattern is only associated with a small number of snps, then a parsimonious model will prefer merging them together into one single class with =. for this reason, iaseq only discovers correlation patterns that have sufficient data support so that they can be distinguished from other patterns. it will not report weak patterns, which could be real but do not have enough data support to allow them to be robustly recovered. for users, this means that at the cluster level, they may not be able to see weak but real as correlation patterns if these patterns are not associated with enough number of snps. on the other hand, for the purpose of inferring whether or not each snp is allele-specific in each dataset, these parsimonious correlation patterns are sufficient for describing the correlation structure in the data and serving as a prior to guide the information sharing across datasets. the information sharing will lead the increased asb detection power, and the eventual as configuration at each individual snp will be determined by the posterior probabilities of   rather than the cluster-level prior probabilities . therefore, in the final as calls, the model still allows each snp to have its own as configuration which may not necessarily be the same as the as configurations of other snps from the same cluster.

consistent with  <cit> , in the two non-background as patterns discovered here, proteins skewed toward the same direction did not always correspond to known protein-protein interactions. as pointed out by  <cit> , this could happen as a result of allelic imbalances of different proteins being caused by a common underlying factor such as allelic difference in chromatin landscape. it could also reflect unknown protein-protein interactions. for iaseq specifically, there is a third reason, that is, multiple small patterns can be merged into a bigger probabilistic class as described before. for example, because of the use of probabilistic patterns, two patterns  and  may be merged into a single snp class ;]). as a result, only looking at the pattern represented by vk;wk, one cannot tell the details of protein-protein interactions, such as these interactions only exist between datasets  <dig> and  <dig>  or between  <dig> and  <dig>  but not between the other pairs of datasets. what one can tell from this merged pattern is that, when the allelic imbalance occurs in these four datasets, they will be skewed toward the same direction, i.e., the reference allele in this example.

in summary, while the correlation patterns in iaseq provide some insights on the correlation of allelic imbalance among different datasets, one should not over-interpret them. the primary goal of these patterns is to describe the correlation structure in the data so that information from different datasets can be shared in a principled way to increase the power of statistical inference. this also points to an important difference between this study and previous studies that reported coordinated allele-specificity among multiple proteins. the previous studies only reported the correlation as a biological finding, but did not provide a statistical method to further utilize the correlation structure to improve the statistical inference. in contrast, iaseq provides a general and rigorous statistical method that utilizes the automatically discovered correlation patterns to increase the statistical power of as detection. as such, it represents a novel development for the analysis of allele-specificity.

model, algorithm, and possible extensions
unlike tools such as alleleseq which mainly focus on the preprocessing steps for the as analysis , iaseq is developed as a general model working downstream of the preprocessing pipelines. the input data for iaseq are the read counts in the format shown in figure 1a. with this design, iaseq can be easily coupled with different data preprocessing protocols. for instance, some investigators may map their reads to a reference genome, while others may map their reads to a diploid personal genome. both types of investigators can use iaseq to integrate information from multiple datasets once they obtained the allelic read counts.

in iaseq, we used an em algorithm to find the posterior mode of parameters and carried out statistical inference accordingly. in principle, one may also use a full bayesian approach and markov chain monte carlo  to perform the posterior inference. however, since mcmc usually takes much longer to run for a big dataset and it is not easy for users to monitor convergence, we decided to use the posterior mode and em-based approach in our implementation. for analyzing the gm <dig> data with  <dig>  snps, iaseq took  <dig> hours to run the em algorithm to fit a single model with k= <dig> on a machine with  <dig>  ghz cpu and 4gb ram. to fit a single model with k= <dig> on the same machine, the em took  <dig> hours. running the em for all  <dig> ks between  <dig> and  <dig> on a single core took  <dig>  days. however, when we run these  <dig> jobs in parallel on  <dig> cluster nodes, we were able to select the best model within  <dig> day. therefore, running the algorithm on a single machine is a little time-consuming, but the computation time can be reduced by parallelization. also, our analysis of gm <dig> data indicates that the optimal k in that real data was  <dig>  for a k not extremely large, even if running the full bic selection on a single machine takes some time, it usually requires less than a week, which is acceptable compared to the time devoted to preparing samples and generating data.

in principle, the statistical model developed in iaseq may also be applied to analyze other types of as events, such as ase and asm. in the future, we plan to improve the model by incorporating information from the spatial correlation among closely located snps. for example, for the ase analysis, one may jointly model snps from the same gene, similar to  <cit> .

implications on future studies
the analysis of as events using the high-throughput sequencing data frequently faces the problem of low statistical power due to the limited amount of information available at heterozygote snps. one way to increase the power is to increase the sequencing depth for one data type . an alternative approach is to spend the same amount of money to generate data for multiple different but related data types , each with a lower coverage. one can then integrate the multiple datasets to increase the statistical power of allele-specificity analysis. the merit of the second approach is that one can collect multiple different types of information which might be useful for other purposes . if the second approach is used in the study design, then iaseq will offer a flexible, powerful and scalable framework for better analyzing the as events in the data. as chip-seq data continue to grow rapidly, this integrative approach will allow us to use the data more efficiently to characterize the allele-specificity.

CONCLUSIONS
in summary, we have proposed a bayesian hierarchical mixture model iaseq to integrate multiple chip-seq datasets for analyzing allele-specificity. the primary goal of iaseq is to increase the statistical power of as detection, and it does so by taking the advantage of correlations among datasets. since the correlation structure may not be known before the data analysis, iaseq learns it from the data automatically. application of iaseq to the encode gm <dig> data shows that allelic imbalance of most analyzed tfs and hms have strong preference to be skewed toward the same direction. analysis of both the simulated and real data show the effectiveness of iaseq to improve detection of allele-specificity compared to single-dataset based methods.

abbreviations
as: allele-specific; asb: allele-specific binding, including both allele-specific tf binding and allele-specific histone modifications; ase: allele-specific expression; asm: allele-specific dna methylation; auc: area under receiver operating characteristic curve; em: expectation-maximization algorithm; fdr: false discovery rate; hm: histone modification; ns: not allele-specific; roc: receiver operating characteristic curve; sn: skewed to the non-reference allele; sr: skewed to the reference allele; tf: transcription factor.

competing interests
the authors declare that they have no competing interests.

authors’ contributions
conceive study: hj. develop model: hj, yw. implementation: yw. data collection: xl, qw. data analysis: yw, xl. write paper: hj, yw, xl, qw. all authors read and approved the final manuscript.

supplementary material
additional file 1
supplemental methods. a pdf file including: data preprocessing procedures; method of moment estimation in the beta distribution; parameter choice for the dirichlet prior; derivation of the em algorithm for iaseq; bayesian information criterion for choosing k; data generation procedure in simulation studies; single dataset based em analysis.

click here for file

 additional file 2
table s <dig>  description of all gm <dig> chip-seq and rna-seq studies. an excel file showing the name of tf and hm, the number of replicates for each dataset in gm <dig> cells.

click here for file

 additional file 3
table s <dig>  raw read count data for  <dig>  analyzed snps.

click here for file

 additional file 4
supplemental comparison of defining allele-specific snps as snps that have rna-seq exonic ase snps in their 1kb neighborhood. supplemental figure  <dig> — roc curves for gm <dig> using caltech exonic rna-seq ase snps as gold standard. supplemental figure  <dig> — roc curves for gm <dig> using caltech autosomal exonic rna-seq ase snps as gold standard. supplemental figure  <dig> — roc curves for gm <dig> using yale exonic rna-seq ase snps as gold standard. supplemental figure  <dig> — roc curves for gm <dig> using yale autosomal exonic rna-seq ase snps as gold standard. supplemental table  <dig> — comparison of iaseq and alleleseq using caltech rna-seq exonic ase snps as gold standard. supplemental table  <dig> — comparison of iaseq and alleleseq using yale rna-seq exonic ase snps as gold standard.

click here for file

 additional file 5
figure s <dig>  roc curves for gm <dig> using yale exonic rna-seq ase snps as gold standard.

click here for file

 additional file 6
figure s <dig>  roc curves for gm <dig> using yale autosomal exonic rna-seq ase snps as gold standard.

click here for file

 additional file 7
table s <dig>  comparison of iaseq and alleleseq using yale rna-seq exonic ase snps as gold standard.

click here for file

 additional file 8
figure s <dig>  the roc curves for comparison between alleleseq and iaseq.

click here for file

 acknowledgements
this work was supported by the national institute of health grant r01hg <dig> to hj, the strategic priority research program of the chinese academy of sciences, grant no. xda <dig> and hundred talents program of the chinese academy of sciences to qw. the authors would like to acknowledge dr. joel rozowsky and dr. mark gerstein for providing alleleseq data on gm <dig> for the method comparisons.
