BACKGROUND
modeling and simulation of biochemical networks as well as the integration of experimental data provide powerful tools to gain insight into the complexity of living systems  <cit> . possibly even more important and seen as the next step is the transition to a predictive biology  <cit> , which has been accomplished in physics long ago  <cit> . but many biochemical networks are hard to treat and describe explicitly. they are too complicated to be overseen just by listing all the reactions. this happens especially fast when effects of combinatorial complexity are involved, for example, in cases of post-translational modification of multiple sites on a protein or large multi-subunit complexes  <cit> . a new species would then have to be used for every state or combination of the molecules. unfortunately, this complexity seems to be an integral part in living systems. most important cellular functions like atp synthesis or transcription involve the cooperation of multiple proteins forming complexes  <cit> . examples are the death-inducing signaling complex   <cit> , the epidermal growth factor receptor   <cit>  with  <dig> phosphorylation sites or the tumor suppressor protein p <dig> with  <dig> phosphorylation sites. the latter one could theoretically assume up to  <dig> =  <dig>   <dig>   <dig> different phosphorylation states  <cit> . microtubules  <cit> , viral shells  <cit>  or hybridizing dna strands  <cit>  constitute additional examples for structures formed by complex interactions. to cope with this combinatorial complexity, reactions systems have to be defined implicitly  <cit> , i.e., by using implicit reaction rules operating on molecules possessing a structure.

rule-based modeling
rule-based modeling approaches share the idea of subdividing molecules into their components, denoting protein domains, active sites or any other feature of the particle  <cit> . these sites can then be modified post-translationally or bind to subdomains of other molecules. this concept is referred to as the domain-oriented approach  <cit> . among others, available software packages for rule-based modeling are moleculizer  <cit> , stochsim  <cit> , bionetgen  <cit> , pathway logic assistant  <cit> , biocham  <cit>  or cellucidate.

in this paper, we assume that a complex molecule is described by a molecule graph, which consists of elementary molecules that are connected with each other. each elementary molecule can further possess a set of subdomains called components . subdomains serve either as connectors between elementary molecules or can be modified, e.g., phosphorylated.

the set of all possible reactions is implicitly defined as the rule-based reaction system  with the set of rules r. r is based on the assumption, that there are groups of chemical species s ∈ s, sharing a common property  p ∈ p. hence they can be subject to a related set of reactions, summarized by a reaction rule r ∈ r. in our case, the common property might be the containment of a similar subgraph structure, for example. each pattern p defines an equivalence class of species from s by the function eqs ⊆ s.

for a start, we return to a non rule-based reaction system . for a simpler description, we will only consider bimolecular reactions. each reaction r' ∈ r' would then consist of a quadruple of molecular species s ∈ s.  

an instance of this reaction r' happening in the simulation of the reactor would then consume one molecule of the species s <dig> and one molecule of the species s <dig>  on the other hand, it would produce one molecule of the species s <dig> and one molecule of the species s <dig>  the species participating in the reactions and the process of exchanging the molecules are defined unambiguously. to define reaction rules instead of the reactions themselves, we only have to exchange the set of species s with the set of patterns p, giving:  

an instance of the reaction rule r happening in the simulation of the reactor would consume one molecule of a species from the equivalence group eqs and one molecule of eqs. in exchange, it would produce one molecule of a species from eqs and one molecule of eqs. now the product site of the reaction rule is not specified unambiguously. the exact species to be produced has to be derived from the actually consumed species and from the type of reaction rule.

non rule-based reaction systems typically allow only the one type of reaction that consumes one set of molecules and/or creates another. these are called exchanging rules in our approach. in contrast, there are more delicate types of rules conceivable for rule-based systems. one typically starts with the assumption that molecules do not usually vanish or emerge. instead, their components are connected, disconnected or modified. hence the most important rules for our approach form or break bonds between molecules' components or modify them . these rule types are called modifying-, binding- and breaking rules.

different rule types that are not yet supported in our simulator might for example exchange subsets of molecule-graphs specifically or change some molecule's conformations.

spatial modeling
spatio-temporal heterogeneous distributions of biomolecules have an important impact on the function of biochemical systems  <cit> .

for that reason, a variety of spatial simulation techniques for reaction networks was developed ranging from macroscopic systems like  partial differential equation  <cit>  to brownian dynamics  <cit>  and molecular dynamics  <cit>  approaches at the micro scale. a rich set of software packages is available for the spatial simulation of explicitly defined reaction networks. examples are mcell  <cit> , cell++  <cit> , virtual cell  <cit> , smartcell  <cit> , mesord  <cit> , smoldyn  <cit> , project cybercell  <cit>  or chemcell  <cit> . while our notion of "space" in this paper focuses on the particle and macromolecule geometry, also the geometric aspects of the reactor might be of interest  <cit> .

but the combination of spatial and rule-based representations has only been addressed by few approaches. an interesting development is stochsim  <cit>  that can operate on a two-dimensional lattice and offers multistate molecules but no multimerizations. another system, the event-based simulator for spatial assembly problems  <cit>  focuses on self-assembly mechanisms. instead of rules and reactant patterns as described before, it uses "local rules"  <cit>  to assign each type of binding site a set of other site types it can bind to. nonetheless, there is more potential in the combination of spatially heterogeneous concentrations, spatially structured molecules and rule-based modeling than covered by these methods. the spatial features of the molecules, in particular the volume exclusion, their geometrically constrained interactions and hence also their ability to form three dimensional structures, might severely influence various further effects in a combinatorially complex reaction network. examples are molecular crowding  <cit> , orientation dependent reaction probabilities and steric effects  <cit> , various polymerizations and self-assembly processes  <cit>  including hierarchical assembly pathways  <cit>  or the function of molecular machines  <cit> .

in the next section we will present our approach for rule-based modeling in space and describe our actual implementation called srsim. afterwards, results of our in silico studies will be presented, revealing the qualitative assets of the combination of rule-based and spatial modeling. finally, we discuss the implications for the analysis of complex bio-chemical systems and open issues for rule-based modeling in space.

methods
rule-based modeling in space
independent of our own implementation that is described in the next section, we suggest the following general features for a spatial, rule-based reaction system: similar to the domain-oriented  <cit>  and rule-based modeling approaches, a molecule consists of elementary molecules , that are compiled to a complex molecule graph. each em belongs to an elementary species, which we extend by further information, such as size, mass, diffusion coefficients, geometry and orientation of binding sites - dependent on the particular chosen spatial simulation model. note that we use space in a broader sense than other approaches that utilize partial differential equations  <cit>  or spatial variants of the gillespie algorithm  <cit>  for the simulation of a heterogeneous distribution throughout the reactor. in what we consider a spatial, rule-based model, a complex molecule should also have a form and volume due to the geometry of its em. this does not only imply possible geometries for the complex molecule graphs, but also constrains the possible reactions. that is, only those molecules can undergo a reaction that  are geometrically compatible and that  fit in the pattern of a reaction rule. in spite of that, the definition of the reaction rules is the same as in "conventional" rule-based modeling approaches. what has to be provided additionally is the geometry of the em and parameters for the spatial simulation, such as diffusion rates and reactor properties. if the number of complex species is bounded, the set of all possible complex molecule graphs  and reactions can be generated in advance. alternatively, new complex species can be generated just in time, when a reaction occurs that generates this species. the dynamical simulation takes place in euclidean space, where each complex molecule graph has a location and orientation that is given implicitly  or explicitly .

the simulation tool srsim
we developed an integrated spatial and rule-based simulation software called srsim. it combines the modeling-strengths of a rule-based software like bionetgen  <cit>  or stochsim  <cit>  with a stochastic, diffusing-particle-based simulator like smoldyn  <cit>  and force-mediated interactions, which are possible in molecular dynamics software packages like lammps  <cit> . the supplied prototypic software is meant as an exemplary and extensible implementation of this modeling approach and certainly has to be adapted for particular problems.

the description of the rule system is extracted from files in the bionetgen language   <cit>  to allow an easy im- and export of models from bionetgen. the description of the reactor properties and the molecular geometries are specified independently. nonetheless, since the reaction system operates on pattern subgraphs, there is no need to generate all possible complex species or reactions in advance, which saves computational ressources. the spatial model aimed at by srsim is settled in the meso-level, between microscopic all-atom molecular dynamics simulations and the macroscopic use of partial differential equations. similar to a viral shell model used in  <cit> , each complex molecule graph is composed of spheric elementary molecules . the species of the em then reveals information about the mass, radius, diffusion rate, geometric properties and the set of components that are attached to this em.

em move through continuous 3d space, while time is discretized in small steps typical for molecular dynamics simulators. an em's movement is influenced by brownian motion using langevin dynamics  <cit>  as well as by forces arising from interactions with other em through bonds and volume-exclusion effects. the positions of complex molecule graphs are not considered explicitly in the spatial simulation but move implicitly with the movement of their constituting elementary molecules' particles.

software layout
srsim is realized as extension to the open source molecular dynamics simulator lammps  <cit> . the new set of c++ classes uses a self-contained part for the treatment of the implicit reaction system, called the rule system. the other part is a simulator dependent set of connecting lammps modules. therefore a possible later adaption of srsim based on different spatial simulators is already prepared. the sources for the rule system and the lammps modules are released under the gpl and are included in the additional file  <dig> - srsimsrc.zip. the most recent versions of the simulator will be available on our website http://www.biosystemsanalysis.de.

geometry model
from the broad range of possibilities to implement a spatial simulation , we chose an individual representation of each elementary molecule in continuous space and discretized time steps, typical for molecular dynamics simulations. the location, form and orientation of complex molecule graphs are not described but are given by the positions of their elementary molecules. similarly it would not be necessary to describe the position and form of a house if the position of every brick was known. the simulation is running in a cuboid box of selectable dimensions and boundary conditions. even so, more elaborated reactor geometries can be defined through the scripting language of the molecular dynamics simulator. every elementary molecule  mi of the elementary species mi is represented by a single sphere with a given mass gi, radius ri and position xi. each component cij of an em mi can be imagined as a vector starting from the center of the sphere xi. it is given in polar coordinates, by a distance dij and two angles θij, φij . bonds between two em are the straight connection of two component vectors cij and ckl with the length dij + dkl. by forming bonds between the components of the em, complex molecule graphs can be assembled. we plan to introduce the option to use further geometric features like dihedral angles or rotational orientations for the em as well, at the price of more complex computations and more possibly unknown parameters. implications of the current detail level are described in the discussion section.

the basic cycle of molecular dynamics simulations propagates the time by the small time step Δt in the following way: starting from a time t with known positions x, forces f and velocities v of all particles, the positions x at the time t + Δt are calculated as a function of f and v. then the forces f and velocities v for the next time step are computed.

several force calculations are employed to sustain the bond radii and bond angles as undamped harmonic springs. so for each connected component, there's a harmonic force term with the potential  

added to lammps' force calculation. where kd is the spring constant and d is the current distance between the connected elementary molecules. imagine the following molecule graph built from three elementary molecules mi - mj- mk. when two or more connections to the molecules mi, mk set out from one central elementary molecule mj, a harmonic angular force term with the potential  

is added to lammps' force calculations for each combination of two connected elementary molecules mi and mk. here, kα is the spring constant, α is the current angle between the em mi, mj and mk. αijk is the ideal angle calculated from the geometry definition. so the central em mj with n attached em implies a set of  angular force terms. kα and kd can only be set generally for all bond types together at the moment but will be set per elementary species in the next srsim version. the ideal bond angles αijk are calculated by srsim from the specified components' polar coordinates  in the initialization phase of the simulation.

the minimal distances between two em are maintained by a soft-sphere potential:  

with the distance r between two molecules mi and mj, the cutoff distance rc and the maximal potential a. . the result of this potential is a repulsion between molecules, once they move closer together than the sum of their radii. to simulate the brownian movement of a particles mi, langevin dynamics  <cit>  is employed by adding a term for random fr and a term for viscous fd forces to the systematic forces  of the model.  

where  is the friction coefficient, vi is the particle velocity, kb is the boltzmann constant, t is the temperature, ξi is a gaussian random function and d is the diffusion coefficient. while the magnitude of the random and viscous forces are correlated by the fluctuation-dissipation theorem, the strength of the repulsive, bond and angular forces can be varied independently. the diffusion rate can be adjusted for each em individually, whereas the diffusion of complex molecule graphs will emerge from the diffusional behavior of its compounds and the bond forces. as the em cannot pass through each other, larger complexes' volume-exclusion behavior is also accounted for, given that no large free spaces are left between connected em.

reaction model and kinetics
after each update of the particle positions x in the spatial simulator, the rule system evaluates the reactor for possible reactions that can happen in the interval [t, t + Δt). please note that the movement of the particles within this time is not considered for the calculation of reaction probabilities . our simulator currently supports mono- and bimolecular modifying, binding and breaking reactions . here, even reactions happening inside of one complex molecule graph may be seen as bimolecular reactions, if different subgraphs of the complex are considered . we renounced from implementing exchange rules that would delete one set of reactants while creating another so far. hence all reactants have to be present in the simulator from the beginning. sets of new molecules can be added at predefined time steps, but cannot be annihilated yet. this restriction is not an implication of our simulation approach but was simply not needed in our examples so far. it will be implemented in the next version of our software. we do not pre-generate all possible reactions and species but directly apply the reaction rules to the molecules in the reactor that belong to certain reactant patterns. this procedure saves memory and computation time, especially when potentially infinite reaction systems are involved and when the specified geometries constrain the subset of reactions that is actually possible . similar to bionetgen  <cit>  versions later than  <dig> , srsim internally uses a graph-based representation  <cit>  of reactant patterns and molecule graphs. basically, all choices whether and what reactions are to be executed are performed on the set of reactant patterns instead of the actual species. therefore, all reactant patterns that are present in the rule definitions are enumerated and associated with indices, during the initialization phase. in the running simulation, each elementary molecule stores the indices of the reactant patterns that it currently belongs to.

eventually two neighboring elementary molecules mi and mj can quickly be checked against bimolecular reaction rules that could possibly happen between them, once they are positioned closer together than a threshold sigma in the current time step. if their assigned reactant patterns allow the application of at least one reaction rule, both molecules are tested for their "geometric compatibility", which is depending on the values of their component tolerances. a reaction may occur only, if the relative positions of mi and mj are deviating less than the given component tolerances tdist and tang from the ideal bond distance and bond angle. hence, for each molecule mi there exists a defined reactive volume  that a possible reaction partner mj can lie in  and vice versa. this concept is similar to the model of "reactive patches"  <cit>  on spheric molecules or the existence of energy funnels for protein docking  <cit> . when both molecules are lying in each others reactive volumes, we treat these molecules like existing in a microscopic, non-spatial reactor on their own. the probability of a reaction between mi and mj in the infinitesimal small time interval dt is then k2micdt. considering the current time step of the length Δt, the probability is then exponentially distributed and sampled from p =  <dig> -  <cit> . see the additional file 2--kineticsandapplicability.pdf for a discussion on how to convert macroscopic reaction rates to the microscopic reaction rates that are employed here.

when a reaction occurred, the reactant pattern indices for all involved molecule graphs have to be updated. this might sound like a huge computational effort for each reaction, when large polymers or complex molecular networks are considered. the actual work necessary to perform this operation is mostly quite tractable, though: the important value here is the maximum graph diameter dmax of all the reactant pattern graphs. there can be no two elementary molecules in one reactant pattern that are more than dmax nodes apart. hence it suffices to recalculate the reactant pattern indices up to a distance of dmax from the elementary molecules that were modified by the reaction.

for monomolecular reactions, gillespie's algorithm  <cit>  is operating on the vector of occurrences of the reactant patterns. at the beginning of time step t, the time τ until the next monomolecular reaction happens is sampled in dependence on the monomolecular reaction propensities . if τ is smaller than the time step Δt, an arbitrary molecule that belongs to the reaction's reactant pattern is selected and modified according to the reaction rule. this procedure is repeated until τ is greater than the spatial simulation's time step Δt, in which no reaction occurs in this time step. even if no reaction occurs over several time steps Δt, this fragmented execution of gillespie's algorithm is equivalent to the original, since the process is "memoryless".

while we calculate the time until first order reactions happen independent from the spatial simulation, the effective macroscopic reaction rates of second order reactions depend on further parameters: to begin with, the diffusion rate d influences the movement of the simulated particles and thus determines the collision probability causing an upper bound for the macroscopic reaction rates. we introduced another parameter, the refractory time, to solve a problem in the interaction between binding- and breaking rules. after a breaking reaction occurred, two molecules will still be located very close to each other and a secondary binding reaction might reconnect the molecules again quickly in most cases. thus, to reach a single net dissociation, a series of many successive breaking and binding reactions would have to occur ineffectively. the same problem is encountered in the stochastic spatial simulator smoldyn  <cit>  and solved by placing both molecules a certain distance apart after cleaving the connection. because this approach would lead to nonlinear particle movement, which is impractical when the forms and structures of assembling complex molecule graphs are constantly considered, a different solution is used in srsim. we assign a refractory time to a molecule after one of its bonds is deleted. for this period, the molecule cannot undergo a new binding reaction and has time to move away by diffusion. please see the additional file 2--kineticsandapplicability.pdf for a closer analysis of possible influences of the refractory time on the system behavior.

RESULTS
to demonstrate the emergent effects arising when diffusing, geometrically constrained particles are used in relative simple models, four exemplary applications will be presented. these models were engineered to test and demonstrate our approach, rather than to deliver a highly detailed representation of a special biological system. consequently, the parameters are kept as simple as possible with arbitrary units. in order to allow rapid experimentation, kinetic parameters, diffusion rates and concentrations are chosen high enough to create results in short simulated times, leading to experiments which can be calculated on a single workstation in computation times of some minutes to hours.

the input files for the presented experiments are included in the additional file 3--examplessrc.zip and short avi movies showing the simulated reactor can be found at http://users.minet.uni-jena.de/~dittrich/tmp/srsim/.

scaffold proteins
scaffold proteins bind other proteins and are thought to help isolating different signaling pathways but also to catalyze reactions by co-localizing their ligands . the following example is not intended to be an exact simulation of the biological process, but to present the potential impact of spatial features on a reaction network model.

simulations were carried out with two different molecular species. particles of the first species a can phosphorylate each other's components when they meet in the reactor. phosphorylations are lost over time. larger spheric scaffold proteins s can bind up to four particles a with a rate of ks . while unphosphorylated proteins a stick to the scaffold, phosphorylated particles dissociate quickly. to allow a smaller protein to bind from any direction onto s, we set the angular tolerance to 180°. since geometrically all the component vectors of s face towards one pole, all bound particles a would be forced to this one pole as well. to facilitate free diffusion for the molecules a on the surface of s, we initially reduce the angular force term to zero.

by choosing a high ks value now, several particles a bind to the scaffold proteins. since their diffusion is limited to the surface of the scaffold protein, they can phosphorylate each other with a higher probability than when diffusing in the whole reactor. a higher concentration of phosphorylated a can thus be measured. when switching on angular forces that push scaffold-bound proteins a to one pole, the effect is further amplified. a zero value for ks results in slower phosphorylation of a. when simulating the same model without the inclusion of space in bionetgen  <cit> , the level of phosphorylation is independent of ks .

certainly the same effect could be achieved in non-spatial simulations by adding reactions with higher rates for scaffold bound species. the important difference here is that in the spatial, rule-based approach, a higher phosphorylation rate for bound molecules emerges from the given rules, but is not explicitly defined. it can also be argued, that a phosphorylation occurring between two molecules a that are already part of a complex with the scaffold s, is actually an intra molecular reaction. hence it would constitute a monomolecular reaction with a completely different reaction rate. however, in our approach, the same bimolecular reaction rate that is measured from freely diffusing particles a can even be applied to the related reaction that happens in a larger complex. two subgraphs of a complex molecule graph then behave like independently diffusing molecules to the reaction executing algorithm of srsim . simultaneously, they are linked together for the spatial simulator, which leads to higher interaction frequencies. ultimately, the effective monomolecular reaction rate is a function of the bimolecular reaction rate and the correct description of the particle geometries and the diffusion on the scaffold molecule's surface. practically, it might still be at least as complicated to determine the correct geometry parameters as to measure the monomolecular reaction rate experimentally. the other way round, geometric properties might be estimated from bimolecular reaction rates or might even be reusable for different molecular species.

growth of filaments and active transportation
atp driven transportation of cargo molecules along the tracks constituted by microtubules  or actin filaments has an important impact on the function of many processes from intracellular material transport to muscle contraction and cell division  <cit> . in this context, a simplified model demonstrates the possibility of using the srsim system to describe the self-assembly and function of complex intracellular structures and molecular machines. a hollow tube representing a microtubule is first grown in the simulation and then used as a track for motor proteins like kinesin- or dynein proteins, which move cargoes from one end of the reactor to the other .

in the first simulation phase, α- and β-tubulin heterodimers are assembled to form a tube of  <dig> protofilaments, starting from a cyclic set of capping molecules at the minus end. the biological counterpart to this structure is the γ-tubulin-containing ring complex  in the microtubule-organizing centers   <cit> . eventually, a 3-start helix is formed with a seam as it can be observed in vivo and in vitro  <cit> .

in the second phase, motor proteins are added to the simulator, which can bind to the microtubules and to a heavier freight molecule. like kinesin  <cit> , the motor proteins move along the mts in the direction of the growing plus-end of the mt. motion is generated by binding and breaking bonds between the tubulin and kinesin dimers. one part of the motor always stays attached to the mt, while the other part diffuses to bind to the next position of the mt lattice  <cit> .

the model description comprises  <dig> rules:  <dig> of them for the polymerization of the microtubule including the seam, four to allow the processive steps of the kinesin motors and another  <dig> rules to control the binding and release of cargo and the microtubule lattice by the motors.

elaborate spatial simulations concerning mt dynamics have already been carried out by others  <cit> , whereas our microtubule/kinesin simulation was kept simple and was rather used as a toy model to test the simulation software and show its versatility. nonetheless, it might easily be extended to include effects like dynamic instability  <cit>  or atp and gtp turnover. it might also serve to evaluate the effect of divergent protein geometries and different models for the assembly and decay of mt lattices on various levels of detail.

spheric self-assembly
self assembling, spherical structures in real living cells are for example viral shells  <cit>  or pml-bodies  <cit> . though the simulations presented here are not intended to be realistic representations of these biological entities, related processes might still be involved in their formation. hence, this exemplary application focuses on the emergence of macroscopic spherical, self-assembling structures as a result of diffusing, geometrically constrained molecules.

the employed "monomers" are more complex now, being composed of six elementary molecules of two different types . we use the notion of monomers here, because there is no reaction rule in this simulation that can further disassemble the basic complex of six elementary molecules. consequently, to save computational resources, the compounds of our monomers are treated as rigid bodies by the spatial simulator. when two monomers are connected, this can only happen between two components of the same type. hence, to obtain the curvature of the spheres, the bond lengths  of the "outer" components are set to a distance of  <dig>  units, while the bond distances for the inner components  are set to  <dig> . varying these distances, different sized spheric structures can be obtained. due to the modeled flexibility of the molecules, the resulting sphere diameters are not fixed, but lie within a certain range of values.

to describe the self-assembly process, eight rules and four parameters are used in this example. they are organized in pairs, as there is always one rule for the "inner" and one for the "outer" components. while the first pair of rules describes the coupling of two free monomers, the next pair handles the more likely event of the addition of a monomer to an already formed complex. the two remaining rule pairs specify the dissociation behavior.

when the on- and off-rates are chosen carefully, the dynamic formation of cyclic pentamers and hexamers can be observed in an early simulation phase . later on, larger assemblies close into spherical complexes , which occasionally form and close fissures, leading to the exchange of particles with the environment. while a regular hexagonal lattice would create a planar structure and a regular assembly of pentagons created an dodecahedron, the spheres observed here irregularly accommodated cycles of five, six or seven monomers.

in contrast to the tubular structure of the microtubules in the last example that was predetermined by the capping molecules, the formation of these spheric structures is an emergent effect of the monomer geometry and flexibility. the spatial rule-based approach might be used to help in the analysis and formation of hypotheses concerning the assembly pathways, kinetics and geometries of related problems.

dna sierpinski triangles
another short example from the area of biomolecular computing  <cit>  shows a simplified in silico reproduction of the self-assembly of sierpinski triangles from dna-tiles  <cit> . the original experiments were conducted by rothemund and co-workers  <cit> , highlighting the similarity of the process to the function of a cellular automaton calculating the xor function ⊕.

the calculation happens by asynchronous addition of layers of dna-tiles on "top" of a one-dimensional nucleating structure . considering the binary xor function ⊕, there are four types of dna-tiles corresponding to the truth table entries .

basically every dna tile to be added to a present assembly should be connected to two other tiles. but since we can only form one new connection in a single reaction step , the effective trimolecular reaction is separated into two distinct bimolecular reactions .

although there are simulation techniques more specialized in tile-based dna self-assembly  <cit> , we think that spatial rule-based simulation might help planning experiments also from the field of biomolecular computing by examining various sources for errors in silico on different levels of detail.

while the possible interactions between the dna-tiles are described on the level of rules in the presented simulation, it might for example be interesting to use individual nucleotides. only two rules would then be necessary to implement a watson-crick complementarity at the expense of more detailed dna-tiles.

discussion
higher order reaction kinetics
because we simulate individual, diffusing particles, the number of collisions between the particles approximately leads to mass action kinetics. but how could more elaborated kinetic laws like hill or michaelis-menten kinetics be realized? though these would not typically be used in particle simulations, many biomodels are specified relying on these laws. higher order kinetics also constitute a valuable tool to simplify reaction systems, e.g. by saving the trouble of explicitly simulating otherwise irrelevant enzymes. the main problem for the use of these kinetics is probably the measurement of concentrations that are included in the kinetic law's formula. while our approach uses information about individual particle's  behavior, a concentration dependent law would need the particle density counted in a subvolume. the size of this volume lies in between the two extremes of the whole reactor and tiny volume elements hardly containing single particles. then, the elaborated kinetic laws could dynamically change the propensities of the dependent reactions.

analyzing simulation runs
how can simulation runs of spatial and rule-based systems be analyzed? next to counting the numbers of molecules in the reactor or regions of it, also the appearance of certain reactant patterns seems important. different approaches as well as our own use this technique up to a certain extent  <cit> . for example, one might be interested in the amount of tubulin dimers, that have bound gtp and both lateral neighboring tubulin proteins. however, many different modes of counting patterns are conceivable, as for instance imagine a complex molecule being composed of three elementary molecules ma - mb - ma from two elementary species. dependent on the mode of counting, the observed pattern ma - mb can now be found either once or twice in the complex molecule graph. hence combinatorial effects have to be considered carefully.

simulation timescales
at the moment, when using single desktop pcs, we can achieve simulated times in the order of some milliseconds. when assuming a system of about  <dig> thousand particles, a simulation for  <dig> *  <dig> time steps took one of our desktop pcs about four hours.

when we consider a protein in the size of the hemoglobin tetramer with a diameter of about  <dig>  nm, its diffusion coefficient should be in the range of . here we used the stokes-einstein relation  <cit> , with the boltzmann constant kb, the absolute temperature t, the solvent's viscosity η and the particle's radius r. the error in the kinetics should be quite low when we choose our time step Δt so that the mean expected translation of a particle  is about a 10th of the particle diameter. that would result in a time step of about 0:5ns and a total simulated time of  <dig>  milliseconds.

though the scale of some thousand particles and some milliseconds may be sufficient only for special problems, the srsim approach will be applicable in more complex situations as well. in our simulations, the bottleneck of the computations is the calculation of forces and the displacement of the particles, but not performing the reactions. given we do not want to simplify the spatial model, computers are still becoming faster and use dedicated hardware like parallel graphic processors . molecular dynamics systems are predestined for parallel computations since the processes in the reactor can be split up into independent, local sub-problems. the simulator lammps that underlies srsim is already fully parallelized via the message passing interface  and can be run on large computer clusters.

another means to speed up the computations is to abstract away aspects of the simulation that do not seem important for a certain system. inflexible molecule graphs and delocalized particles can be used in an event-based simulation as done in the self assembly simulator by zhang et al.  <cit> . the focus is on the formation and structure of complex macromolecules instead of the positioning or the elasticity of the molecules. a different approach would be to preserve information about local dynamics within a complex molecule, but speeding up the calculations by running embedded simulations. that would lead to an efficient stochastic model for the conformations of large but stable complexes. larger time steps might also be used by sacrificing the detailed brownian movement of every particle. green's function reaction dynamics  <cit>  calculates the time until the next reaction occurs from the positions of all molecules at a time step. then all the particles can be displaced by this dynamic time step instead of having many smaller time steps that involve no reactions. nonetheless, this technique would ignore the effects of steric hindrance between complex molecules. systems involving small molecules like atp occurring in high amounts could be simulated as continuous concentrations in the background to relieve the particle-based simulation engine of high particle numbers. similar separations of scales were used in the simulator cell++  <cit> .

implications of the chosen geometric level of detail
in our current exemplary implementation of a spatial, rule-based reaction system, we chose a level of detail that allows angles but no dihedral angles. here, with angles we denote the angle between a central molecule mi and two further molecules mj, mk adjacent to mi. dihedral angles describe the torsion around the axis mj - mk , if the molecules mi, mj, mk, ml are linearly connected. alternatively, dihedral angles can be imagined as the angle between a plane p <dig> through the first three molecules mi, mj, mk and another plane p <dig> through the second three molecules mj, mk, ml. consequently, it is not trivially possible to specify or inhibit the torsion around a bond. this would for example be necessary to distinguish a helix as displayed in figure  <dig> from a circle in a single plane. to specify complicated geometries in the present level of detail, one could employ combinations of elementary molecules as building blocks, as it was done in our spheric self-assembly simulation.

another aspect of our chosen level of detail is that unbound elementary molecules  do not posses a rotational orientation. hence, the molecule is expected to rotate diffusively so that all possible orientations are considered to be equally possible for the calculation of geometric compatibilities. this treatment of single em is similar to orientation-less particle models as used in approaches by gillespie  <cit>  or chemcell  <cit> . as soon as an em mi is bound in a complex molecule graph, there are bonds that realize component vectors of mi. when a new bond to an em mj should be formed, this is only allowed if the angles between the present component vectors of mi and a potentially new component vector pointing towards mj are deviating less than the tolerance value tang from the ideal bond angles. in other words, this means that the reactive volume  to bind another em mj can change, dependent on other em that are connected to mi. this has to be considered when specifying reaction rates.

CONCLUSIONS
the spatial, rule-based simulation approach, represented by our exemplary tool srsim, constitutes a versatile, rule-based simulation system, which accounts for inhomogeneous distributions, volume-exclusion, structure and geometry of diffusing particles. it is able to tackle a variety of problems from the scope of self-assembling biomolecules and molecular processes exhibiting combinatorial complexity. for some of these areas problem-specific simulation systems have already been developed  <cit> . our approach might help to integrate the description and treatment of many such problems under a common, effective formalism.

though molecular dynamics studies of interacting proteins are considered the most physically accurate representation of biochemical processes  <cit> , they are not always achievable or desirable. the computational effort is immense even for only two involved macromolecules, and high resolution 3d structures have to be known for each involved particle. in contrast, the level of geometric detail in spatial rule-based models can be chosen dependent on the present level of knowledge and the aspired scale of the system under consideration. similar to coarse grained molecular dynamics  <cit> , one spheric particle of the simulation can represent anything from a single atom to a big macromolecular complex.

another important point of our approach is the fact that the dynamics of reaction networks can quantitatively and qualitatively change as an effect of heterogeneous spatial concentrations as well as in dependence of the employed particle geometries. combinations of structural parameters for the involved particles as component angles, distances, component tolerances and reaction rates can be varied, trying to reproduce observed macroscopic behavior. thus, possible candidates for macromolecule geometries and hypotheses on the cooperation of complex system's compounds are generated for an efficient experimental evaluation. let us assume a simple polymerization of identical monomers with two binding sites. in each step, any two monomers could be connected. but whether they form complexes as cycles, rod shapes, helices or something unstructured depends on the geometries of the particle's binding sites . when considering all reactions that were possible based on the rule-based system, the geometric properties can implicitly disallow or inhibit a subset of reactions and favor others. some binding sites may be blocked by particles, while others may be co-localized or brought close together, practically forcing a reaction. though this is not the focus of this paper, also the shape of the reaction container can severely influence the reaction kinetics  <cit> .

eventually, the dynamics may then diverge drastically from reaction-diffusion systems that consider space by using partial differential equations or spatial variants of gillespie's algorithm  <cit> . in particular, a set of chemical species that can in principle form a stationary state in a reaction-diffusion model derived from a rule-based reaction system may not have this property when geometry is considered. this implies that applying algebraic methods like elementary mode analysis  <cit>  or chemical organization theory  <cit>  to the reaction rules while neglecting geometric information can lead to misleading results. the organization theory operates on the binary presence or absence of species in a reaction system. an organization is formed by a subset of all possible species, if this subset cannot generate new species but can replenish its own species from itself by means of the system's reactions. for example, a set of species reversibly forming tetrameres as displayed in figure  <dig>  d) that is not an organization with respect to the reaction rules, is an organization when geometry is also considered, because the geometric effects hinder the formation of further species but allow the formation of the tetramers and their preliminary compounds. note that, obviously, also a set of species that is an organization given just the reaction rules can become no organization when considering geometry.

in addition to pure geometry, the flexibility of the proteins  <cit>  to strain, torsion and bending will influence the rates, pathways and structures of formed complexes. for example in the experiment of spheric self-assembly, the exact structure is not pre-determined but emerges dynamically as a function of geometries and flexibilities.

while we have been highlighting the assets of only the spatial features of srsim so far, it is the combination with the rule-based reaction system that leads to the modeling strength of our approach. in a conventional but spatial reaction system, it would not be possible to easily model complex and highly structured self-assembly reactions including an almost infinite number of species like in the example of growing sierpinski triangles. also it would not be possible to describe elaborated processes as the successive binding and dissociation reactions that are necessary for the dynamic description of molecular machines like in the example of our molecular walkers along the microtubules. we want to point out in this paper, that it is necessary to combine both, the flexibility of the rule-based reaction system as well as the spatial simulation technique to describe and model a variety of complex biochemical systems.

further work will also address the incorporation of more powerful rule types. patterns that allow wildcards for subsets of molecule types might constitute valuable helpers for the model description as well as rules allowing the exchange of whole subgraphs in molecule complexes.

next to enhancements concerning the rule evaluation and execution system, also different levels of spatial and geometric detail should be considered. different ways to a more abstract but faster system were shown in the discussion section. when, on the other hand, the level of detail should be elevated, there is a range of conceivable changes to the srsim system. torsional angles and binding energies might be included in the geometric model, for instance, or the possibility to break bonds not only because of reaction rates but also as a result of applied forces.

the authors believe that advanced modeling of biomolecular systems in future will necessitate both, the treatment of spatial aspects as well as the ubiquitous combinatorial complexities arising from multiprotein complexes and multistate molecules. therefore, in addition to more corse-grained or analytic approaches  <cit> , we advocate the use of versatile, spatial rule-based simulation systems like srsim, specifically designed for these modelling demands.

authors' contributions
conceived and designed the experiments: gg bi th pd wrote the software: gg performed the experiments: gg analyzed the data: gg bi tl ml th pd wrote the paper: gg bi tl ml th pd all authors read and approved the final manuscript.

supplementary material
additional file 1
c++ source files to compile srsim, including the slightly modified lammps sources.

click here for file

 additional file 2
additional text discussing how to convert macroscopic kinetic rates from non-spatial biomodels to the microscopic reaction rates that are applicable only, when two reacting particles are already within the geometric tolerance values. also, possible sources for inaccuracies as the use of the refractory time will be discussed.

click here for file

 additional file 3
contains the source files for the simulations presented in the results section. makefiles to run the simulations are readily included.

click here for file

 acknowledgements
we acknowledge funding by the dfg , by the eu esignet project  and a daad scholarship  to bashar ibrahim. the authors gratefully acknowledge the fruitful discussions provided by stephan peter and christian beck.
