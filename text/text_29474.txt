BACKGROUND
microarray technology has been widely adopted in many genomic related studies in the past decade. despite its popularity, it is well known that various technical noises exist in microarray experiments  <cit>  due to the limitation of technology. as a remedy, many normalization procedures have been proposed to remove these systematic noises, thus improving the detection of differentially expressed genes. some efforts have been made to evaluate different normalization procedures  <cit> . interested readers are referred to  <cit>  for background and more detailed reviews of normalization procedures.

quantile normalization is perhaps the most widely adopted method for analyzing microarray data generated by affymetrix genechip platform. motivated by quantile-quantile plot, it makes the empirical distribution of gene expressions pooled from each array to be the same  <cit> . it is the default option of bioconductor  <cit> , which is a very popular open source software for analyzing microarray data implemented in r <cit> , the de facto standard statistical computing language in the statistical research community. this algorithm is also used for normalizing affymetrix exon arrays  <cit> , illumina beadchip arrays  <cit> , illumina transcriptome sequencing  data  <cit> , illumina infinium whole genome genotyping  arrays  <cit> , and solexa/illumina deep sequencing technology  <cit> , etc. in addition, several other popular normalization procedures are variants of quantile normalization, such as the enhanced quantile normalization  <cit>  and subset quantile normalization  <cit>  designed for microarrays, and the conditional quantile normalization  <cit>  designed primarily for normalizing rna-seq data.

rank normalization is an alternative to quantile normalization. it replaces each observation by its fractional rank  within array  <cit> . this normalization procedure achieves robustness to non-additive noise at the expense of losing some parametric information of expressions.

after normalization, a pertinent statistical test such as student’s t-test  <cit>  is applied to these normalized gene expression levels. the resulting p-values are adjusted by a multiple testing procedure  in order to control certain quantity of per-family type i error, such as family-wise error rate   <cit>  and false discovery rate   <cit> . differentially expressed genes are identified based on a pre-specified threshold of adjusted p-values. more detailed introduction of statistical methods for detecting differentially expressed genes can be found in  <cit> .

without compromising the control of type i error, better testing power can be achieved by either increasing sample size or improving the strength of gene differentiation effect . sometimes large expected differential effects based on biological considerations are invoked as a reason to justify a microarray study with very small sample sizes.

in this study, we find that one cannot “trade” differentiation effects with sample size. when the sample size is small, the statistical power for a gene differentiation analysis will not reach 100% even when the effect size approaches to infinity. this counter-intuitive phenomenon is due to the nature of the normalization procedures, which alters both sample mean difference and pooled sample standard deviation of the normalized expressions. as a result, they both grow at most linearly as functions of effect size and their effects cancel out. our findings provide new insights into microarray experimental design which may help practitioners in selecting appropriate normalization procedures.

methods
notations and biological data
notations
we assume that all expression levels are log-transformed. for convenience, the words “gene” and “gene expression” are used interchangeably to refer to these log-transformed random variables. these genes are indexed by i =  <dig> ,…,m, where m is the total number of genes.

let c = a,b be two different phenotypic groups. for simplicity we assume that the number of arrays in both groups are the same and denoted by n. without loss of generality, phenotypic group a is set to represent the phenotype of interest  and group b the normal phenotype. so up  regulation of a gene refers to its over  expression in group a. we denote by yijc the observed expression level of the ith gene recorded on the jth array sampled from the cth phenotypic group. the normalized counterpart of yijc is written as yij∗c.

the mean and standard deviation of yijc are denoted by eyijc=μic and var=σic <dig>  respectively. their normalized sample counterparts are denoted by y¯i·∗c=1n∑k=1nyik∗c and σ^i∗c2=1n-1∑j=1n <dig>  respectively.

in practice, the true level of gene differentiation is not a constant. it depends on the biological settings. the variance of gene expressions is nor constant either — it depends on the accuracy of measuring instruments and the homogeneity of biological subjects, just to name a few factors. in terms of statistical power, the decrease of gene expression variance is equivalent to the increase of mean difference. for simplicity, we consider gene expression variance to be fixed and define the effect size, our analysis tuning parameter, to be the expected mean difference of the ith gene expression between two phenotypes ei:=μia-μib.

we divide genes into three sets: 

• g <dig>  the set of non-differentially expressed genes . for all i ∈ g <dig>  ei:=μia-μib= <dig> 

•  g1+ , the set of up-regulated genes. for all i∈g1+, ei >  <dig> 

• g1-, the set of down-regulated genes. for all i ∈ g 1-, ei <  <dig> 

the set of differentially expressed genes  is the union of both up-regulated and down-regulated genes, which is denoted by g1=g1+∪g1-. we write the size of these gene sets by m <dig> = |g0|, m1+=|g1+|, m1- = |g1-|, and m <dig> = |g1|. apparently m1=m1++m1- and m <dig> + m <dig> = m.

biological data
the biological dataset used in this study is the childhood leukemia dataset from the st. jude children’s research hospital database  <cit> . we select three groups of data:  <dig> patients  with hyperdiploid acute lymphoblastic leukemia ,  <dig> patients  with a special translocation type of acute lymphoblastic leukemia  and  <dig> patients  with a t lineage leukemia . each patient is represented by an array reporting the logarithm  of expression level on the set of  <dig> genes.

analytic analysis of the impact of normalization procedures on differential expression analysis
in this section, we evaluate the impact of quantile and rank normalization on t-test. we are especially interested in studying the asymptotic property of the t-statistic as the effect size of differentiation approaches infinity while other parameters such as n and σi <dig> are fixed. empirical evidences in section “results and discussion” show that our findings are also valid for other statistical tests such as wilcoxon rank-sum test and permutation based test.

to simplify theoretical derivation, we assume that the mean expression levels in the normal phenotype  are zeros . this assumption implies that μia=μib+ei=ei. this simplification is reasonable because many hypothesis testing procedures such as t-test and wilcoxon rank-sum test are invariant under shift transformation, so the mean difference between two groups, ei, is much more important than the normal level of gene expressions. for simplicity, we also assume that the effect size is a constant e+ >  <dig> for all up-regulated and e- <  <dig> for all down-regulated genes. in summary, 

  eyijc=e+c=a,i∈g1+,e-c=a,i∈g1-,0c=a,i∈g <dig> c=b, 

therefore, the expected group differences of non-normalized gene expression data are 

  eyi·a-yi·b=e+i∈g1+,e-i∈g1-,0i∈g <dig>  

we must point out that all these assumptions are made only for the simplification of the theoretical derivations. our findings essentially do not depend on these assumptions. this has been confirmed in our biological simulation study in section “results and discussion” .

for the ith normalized gene expression, its t-statistic is defined as 

  ti∗=n2·y¯i·∗a-y¯i·∗bσ^i∗, 

where σ^i∗=σ^i∗a2+σ^i∗b <dig> is called the pooled sample standard deviation.

the testing power of a two-sided t-test is determined by the absolute value of t-statistic. based on equation , it is clear that the testing power converges to 100% when n approaches infinity. for a fixed n , the testing power is determined by the absolute sample mean difference, |y¯i·∗a-y¯i·∗b|, and the pooled sample variance, σ^i∗ <dig>  below we study the asymptotic properties of these two quantities for quantile and rank normalized expressions separately.

quantile normalization
with quantile normalization , a reference array of empirical quantiles, denoted as q = , is first computed by taking the average across all ordered arrays. let y,jc≤y,jc≤⋯≤y,jc denote the ordered gene expression observations in the jth array  of the cth  group, the rth  element of this reference array is 

  qr=12n∑k=1ny,ka+∑l=1ny,lb. 

the original expressions are replaced by the entries of the reference array with the same rank. denote rijc as the rank of yijc in the array to which it belongs. the normalized gene expressions are 

  yij∗c=qrijc=12n∑k=1ny,ka+∑l=1ny,lb. 

we refer the reader to  <cit>  for more details.

in group a, over-expressed genes tend to have high  ranks in each array. when the effect size is small, the ranks of degs in group a are mixed with those of ndegs and the downstream testing power will be low. when the effect size is large, the degs in group a effectively take up all the top and bottom ranks, so the ndegs in group a can only compete for ranks between m1- +  <dig> and m-m1+. we assume that the m1+ up-regulated genes almost always take the top m1+ ranks with equal chances and the m1- down-regulated genes almost always take the bottom m1- ranks with equal chances. we will show that the student’s t-statistic of quantile normalized gene expressions follows a mixture distribution in which the doubly noncentral part converges to a distribution with finite all order moments instead of infinity when the true effect size becomes large.

we first investigate the asymptotic properties of sample mean difference y¯i·∗a-y¯i·∗b. roughly speaking, quantile normalization ranks gene expressions first and then replace them by a reference quantile computed from all arrays. for an up-regulated deg , its rank can be among the top m1+ genes for all arrays in the normal group  with probability m1+mn. in this case, the expectation of sample mean difference is zero; otherwise it grows linearly as a function of e+. more specifically, by using conditional expectation, we obtain that for i∈g1+, 

  e∝o,with probabilitym1+mn,o,with probability1-m1+mn. 

similarly for down-regulated degs , 

  e∝o,with probabilitym1-mn,o,with probability1-m1-mn. 

detailed derivations can be found in section  <dig> in the additional file  <dig> 

similarly, σ^i∗·, the pooled sample standard deviation, can either grow linearly as a function of e+ and e- or  stay as a constant. heuristically speaking, σ^i∗· does not depend on e+ or e- if the ranks of expressions are all in the top group , middle group , or the bottom group  because all expression levels have the same effect sizes so they are canceled out. if the ranks are from different groups, some will have high expressions and some are low, the standard deviation will be “stretched out”. since we assume up-regulated  genes in group a almost always take up the top  ranks, 2∝∑j=1n <dig> does not depend on e+ or e-. for group b we have 

  eσ^i∗b2|ri1b,⋯,rinb∝o,allri·b∈topm1+,or middlem <dig> or bottomm1-with probabilitym0mn+m1+mn+m1-mno <dig> ),otherwise with probability1-m0mn-m1+mn-m1-mn. 

more detailed derivations can be found in section  <dig> in the additional file  <dig> 

according to equations ,  and , the sample mean difference and pooled sample standard deviation both grow at most linearly as functions of e+ . as a result, the  t-statistics ti∗ in   for up-regulated degs  approximately have the following mixture of central, noncentral and doubly noncentral forms: 

  ti∗|ri1b,⋯,rinb∼oo,allri·b∈topm1+with probabilitym1+mn,oo,allri·b∈middlem0or bottomm1-with probabilitym0mn+m1-mn,oo,otherwise with probability1-m0mn-m1+mn-m1-mn. 

similarly, the t-statistics ti∗ for down-regulated degs  approximately have the following mixture forms: 

  ti∗|ri1b,⋯,rinb∼oo,allri·b∈bottomm1-with probabilitym1-mn,oo,allri·b∈middlem0or topm1+with probabilitym0mn+m1+mn,oo,otherwise with probability1-m0mn-m1+mn-m1-mn. 

to see this mixture under the normality assumption, we assume that all observed gene expressions yijc follow a normal distribution. then, the normalized gene expressions yij∗c approximately follow a normal distribution . according to equation , the t-statistics ti∗ for up-regulated degs  approximately follow a mixture of central, noncentral and doubly noncentral t-distributions with a density function 

 fti∗≈m1+mnft+m0mn+m1-mnft+1-m0mn-m1+mn-m1-mnft. 

here ft, ft and ft are the density functions of central, noncentral and doubly noncentral t-distributions, respectively, with ν =  <dig> n -  <dig> degrees of freedom. γ ∝ o is the numerator noncentrality parameter and λ ∝ o <dig> ) is the denominator noncentrality parameter   <cit> . similarly, according to equation , the t-statistics ti∗ for down-regulated degs  approximately follow a distribution with a density function 

 fti∗≈m1-mnft+m0mn+m1+mnft+1-m0mn-m1+mn-m1-mnft. 

in microarray analysis it is reasonable to assume m <dig> ≪ m, i.e., the proportion of degs is small . so the central t-distribution part in the mixture is negligible. empirical density functions of ti∗ for quantile normalized deg expressions with different effect sizes are shown in figures  <dig>  and . for effect sizes  <dig> and  <dig>  the two peaks in the center represent the doubly noncentral t-distribution part t and the two peaks to the far left and right sides represent the noncentral t-distribution part t. the doubly noncentral t-distribution converges to a distribution with finite all order moments when e+  approaches infinity. figure  <dig> shows the convergence of ti∗. furthermore, we let e+ and -e- vary from  <dig> to  <dig>  and the medians of the t statistic absolute values for degs with and without quantile normalization are plotted in figure  <dig>  clearly, the median for data without normalization grows linearly while the median for data with quantile normalization is upper-bounded by a fixed constant when effect size becomes large. therefore, the testing power associated with a two-sided t-test cannot reach 100%. the derivation of this convergence can be found in section  <dig> in the additional file  <dig>  this result suggests that even if certain genes are known to have dramatically different expression levels for different phenotypes, a typical differential expression analysis based on quantile normalized expressions may not be able to detect them. in this case, combining the results obtained from differential expression analysis without normalization may provide new insight to the underlying biology.

empirical evidences in section “results and discussion” also show that the statistical power converges to a fixed number strictly less than  <dig> ; and this convergence is independent of the hypothesis testing methods and mtps being applied. heuristically speaking, quant “borrows” information from both ndegs and degs to reduce data variation, and as a result the normalized expressions are complex mixture of both ndegs and degs with possibly very high true group differences. consequently, the variances of normalized degs are asymptotically dominated by the differences between the ndegs and degs and become increasing functions of effect sizes. asymptotically, the increased variances cancel out the contributions of the increased effect sizes to the testing power.

rank normalization
with rank normalization , we replace each entry in one array by its position  in the ordered array counted from the smallest value divided by the total number of genes. denote rijc as the rank of yijc in the array to which it belongs, the normalized gene expressions are 

  yij∗c=rijcm. 

this method was proposed by  <cit>  and discussed further in  <cit> .

compared with quant, rank goes even further in the nonparametric direction. it removes the noise by only preserving the ordering of observations. we know m is usually very large in a typical microarray study. if the effect size is large such that the over-expressed genes always take up the top m1+ ranks and the under-expressed genes always take up the bottom m1- ranks in group a, yij∗c approximately has the following uniform distribution: 

  yij∗c∼u,c=a,i∈g1+,u,c=a,i∈g1-,u,c=a,i∈g <dig> u,c=b. 

here for simplicity, again we assume that the genes take the specified ranks with equal chances within each group. therefore, the normalized gene expressions no longer depend on the effect size. the expected group differences for rank normalized genes are 

  eyi·∗a-yi·∗b≈12-m1+2mi∈g1+,m1-2m-12i∈g1-. 

it is easy to check that the pooled standard deviation is also independent of the effect size. as a result, the testing power with rank normalization converges to a constant strictly less than  <dig>  as the effect size increases. more details can be found in section  <dig> in the additional file  <dig> 

simulation studies
extensive simulations are conducted to verify above theoretical predictions. we document these simulation studies in this section.

simulation data
two sets of simulated data are used in this study. each set of data has two groups of n arrays representing gene expressions under two phenotypic groups . the numbers of up and down regulated genes are denoted by m1+ and m1-, respectively. without loss of generality, group b is set to represent the normal phenotype, so up  regulation of a gene refers to its over  expression in group a. 

• simu: each array has m =  <dig> genes. the number of differentially expressed genes  is set to be  <dig>  which implies that the number of non-differentially expressed genes  is m <dig> =  <dig>  for both groups, all genes are normally distributed with standard deviation σ =  <dig>  which is estimated from the biological data. every two distinct genes have correlation coefficient  <dig>  which is estimated from the biological data. as a reference, the sample pearson correlation coefficient averaged over all pairs of genes for biological data used in this study are:  <dig>  for hyperdip,  <dig>  for tel, and  <dig>  for tall. the algorithm used to generate these correlated observations is stated in  <cit>  and is similar to the method used in  <cit> . this high correlation between non-normalized gene expressions can introduce high correlation between the test statistics  <cit>  and result in high instability of the list of degs. this phenomenon was documented and discussed in  <cit> . we also conduct simulations with non-homogeneous gene correlation structure and the results are similar to that of simu. details can be found in section  <dig> of the additional file  <dig> 

• the expectations of degs in group a  are set to be a constant e for over-expressed genes  and -e for under-expressed genes . here the effect size e takes value in { <dig> , <dig> ,⋯,  <dig> , <dig> }.  is set to be either   or  . for all genes in group b and ndegs in group a, their expectations are set to be  <dig>  the sample size in each group is set to be n, taking values in { <dig> }.

• simu-bio: to match the statistical properties of real gene expression more closely and mimic other noise sources such as non-additive noise, we apply resampling method to the biological data to construct an additional set of data.

• we apply t-test to hyperdip and tel  without any normalization procedure or multiple testing adjustment. at significance level  <dig> ,  <dig> genes are detected as degs with an unbalanced differential expression structure . we record the mean difference across hyperdip and tel for each deg as its effect size . then we combine hyperdip and tel data and randomly permute the arrays. after that we randomly choose 2n arrays and divide them into two groups a and b of n arrays each, mimicking two biological conditions without differentially expressed genes. here the sample size n takes value in { <dig> }. we add the recorded effect sizes to  <dig> genes  in group a. we also add addition effect size e to  <dig> up-regulated genes and -e to  <dig> down-regulated genes in group a where e takes value in { <dig> . <dig> . <dig>  ⋯,  <dig> , <dig> }. these  <dig> genes are defined as our degs in this simulation. similarly, we apply this resampling procedure to tall and tel  and  <dig> genes are defined to be degs with a balanced differential expression structure . the sample size n takes value in { <dig> } and the additional effect size e takes value in { <dig> . <dig> . <dig> ⋯, <dig> , <dig> }.

hypothesis testing methods
we use student’s t-test to compute unadjusted p-values and then apply the bonferroni multiple testing adjustment to compute the adjusted p-values and control the family-wise error rate  at  <dig>  level.

two alternative tests, namely the wilcoxon rank-sum test and permutation n-test are also used in this study. the results are largely consistent with those obtained from the t-test and can be found in section  <dig> in the additional file  <dig>  the n-test is a multivariate nonparametric test which has been used to successfully select differentially expressed genes and gene combinations in microarray data analysis  <cit> . a brief introduction of this test can be found in section  <dig> in the additional file  <dig> 

RESULTS
we randomly generate  <dig> sets of data per tuning parameter for simu and simu-bio. we apply normalization procedures first and then conduct hypothesis tests to obtain raw p-values. after that, we apply the bonferroni multiple testing adjustment to get adjusted p-values. we declare a gene to be differentially expressed if its adjusted p-value is less than a prespecified significance level  <dig> . the estimated mean and standard deviation of the true positives are reported in figures  <dig> and  <dig>  various results with additional tests , sample sizes  and non-homogeneous gene correlation structure including false positive plots can be found in section  <dig> in the additional file  <dig> 

by removing the noise from the observed gene expressions, quantile and rank normalization procedures improve the statistical power of the subsequent differential expression analyses when effect size is small. however, when e becomes large, the testing powers based on the normalized expressions converge to fixed numbers strictly less than  <dig> . this confirms our previous theoretical derivations.

CONCLUSIONS
microarray technology has been used in many areas of biomedical research. biomedical researchers rely on this technology to identify differentially expressed genes. due to the “large p, small n” nature of the microarray data, multiple testing correction must be applied in differentially expression analysis. as we all know, stringent control of type i error invariably comes with the price of reduced testing power. however, the success of most microarray studies depends critically on the ability of differential expression analysis to identify the “right genes” and researchers cannot afford to miss many these targets.

high statistical power can be achieved in a study with the following properties. 

 <dig>  an adequate sample size. clearly, this is a reliable way to increase statistical power. everyone seems to agree on it but not everyone practices it. many years ago this was due to the high cost of conducting microarray experiments. currently it only costs a fraction to obtain the same number of arrays. in a sense, the myth that “five arrays per group should be good enough” only reflects the fact that it takes a long time to change old, perhaps even anachronic habits.

 <dig>  small variance. it is well known that a large proportion of the variance of gene expression is induced by undesirable systematic variations and various technical noise. microarray technology has been evolving very fast in the past years and we think it is not unreasonable to assume that the technical noise level is getting lower. however, variance induced by biological heterogeneity will not be affected by the advances of technology. for certain data, using a normalization procedure, such as quant or rank, can reduce this variance and help detect degs. we must point out that these elegant variance reduction procedures can also alter the mean expression and increase sample variance when the true effect size is large. this bias-variance trade-off is common in different branches of statistics and should not be conveniently ignored.

 <dig>  strong true effect size. based on our experience, this is often invoked as a reason to justify the use of small sample size in a study a priori. in our study, we demonstrate that one cannot simply “trade” sample size by effect size. both our theoretical derivations and simulation studies indicate that as long as the sample size is small, the testing power of a typical gene differential expression analysis based on quantile or rank normalized data never reaches 100% no matter how large the effect size is. a large n is still critical for finding informative genes in this situation.

one main motivation of our study is to dismiss the dangerous idea that “five arrays per-group ought to be good enough for my study”. our somewhat counter-intuitive findings suggest that if data with dramatic gene differentiation have only limited sample size , rank and quantile normalizations may not be able to improve testing power as one expects. for such a scenario we recommend conducting an additional differential expression analysis with other normalization procedure or even without normalization first, and then compare/combine the results with the original analysis with quantile or rank normalization.

although we choose to focus on the affymetrix genechip platform throughout this paper, we believe our conclusions should be valid for other array platforms which require/recommend normalization, such as affymetrix exon arrays, illumina beadchip arrays and many others. we hope this study can help biological researchers choose an appropriate normalization procedure in their experiments or even develop novel normalization procedures with better downstream testing power when the gene differential expression is dramatic.

competing interests
the authors declare that they have no competing interests.

authors’ contributions
all three authors have equal contribution to this paper including the original idea, study design, theoretical derivations, simulations and summary of the findings. all authors read and approved the final manuscript.

supplementary material
additional file 1
supplementary material.

click here for file

 acknowledgements
this research is supported by the university of rochester ctsa award number ul <dig> rr <dig> from the national center for research resources and the national center for advancing translational sciences of the national institutes of health; nih/niaid hhsn272201000055c/n01-ai- <dig> from the national institutes of health; nih  <dig> r <dig> ai087135- <dig> from the national institutes of health; and nih  <dig> r <dig> hl062826-09a <dig> from the national institutes of health. the content is solely the responsibility of the authors and does not necessarily represent the official views of the national center for research resources or the national institutes of health. we appreciate ms. christine brower’s technical assistance with computing. in addition, we would like to thank ms. malora zavaglia and ms. jing che for their proofreading effort.
