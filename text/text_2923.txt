BACKGROUND
the pcr  method of dna amplification has had a profound impact on biotechnology and biological research. multiplex pcr is an extension of the standard pcr protocol in which multiple loci are amplified simultaneously in order to save time, improve throughput, and reduce the total cost of reagents. applications for pcr and multiplex pcr abound including quantitative gene expression  <cit> , haplotyping  <cit> , whole-genome closure  <cit> , detection of genetically modified organisms  <cit> , forensic analysis, including human identification and paternity testing  <cit>  diagnosis of infectious diseases  <cit> , and for anti-bioterror applications aimed at detecting biological agents such as anthrax  <cit> 

multiplex pcr has recently emerged as a core enabling technology for high-throughput snp genotyping  <cit> , and variations on the standard protocol are being actively explored and in some cases more widely commercialized. it is in this context of genotyping that we focus our discussion of multiplex pcr assay design. thus we will typically refer to multiplexing snps  but our treatment is readily applicable to most other pcr applications. genomic variations in the form of single nucleotide polymorphisms  and associated haplotypes continue to garner tremendous interest particularly in the context of pharmacogenomic initiatives aimed at understanding the connection between individual genetic traits, drug response, and disease susceptibility  <cit> . broad adaptation of genotyping technologies in clinical settings will depend on their cost and inherent clinical value and may be significantly impacted by ethical and legal considerations. recent technological developments in pcr-based genotyping based on primer extension with universal pcr primers  <cit>  have demonstrated very high  multiplexing levels, although the use of common primers does introduce other issues including the greater potential for cross-contamination.

multiplex pcr assay design is a multi-objective optimization problem involving intrinsic performance tradeoffs. the key objectives we consider in this paper include the number of snps per tube  and the percentage of snps assigned to full tubes . we further require that all resulting tubes achieve uniform levels of multiplexing with the idea that doing so facilitates automation in a high-throughput environment. while lower coverage may be acceptable in initial survey studies involving many  snps, achieving high  coverage becomes obviously more important when the focus of investigation has been narrowed to a relatively small  set of snps each of which is suspected of having some biological or pharmacological impact.

the question we address in this paper is whether there are fundamental limitations to our ability to design assays that achieve multiplexing levels of arbitrary size using standard multiplex pcr protocols. while multiplex pcr is an established technique, its usefulness as the basis for future high-throughput platforms depends critically on scalability. we introduce a new framework of "multi-node graphs" to model the multiplex pcr problem. we show that the problem of finding high-multiplexing/high-coverage designs is subject to a computational phase transition, becoming dramatically more difficult when the probability that two primers are mutually compatible drops below a critical threshold. this probability depends on fundamental primer selection criteria typically selected to avoid the formation of primer dimers. for standard criteria, we can identify where such a transition occurs, and show that it is consistent with typical multiplexing levels. the precise location of this critical transition point will also depend on n, the number of available snps. for a given level of coverage, the level of achievable multiplex is proportional to log. we further quantify design performance tradeoffs using two best-fit tube assignment algorithms on human snp data.

RESULTS
phase transitions in multiplex pcr complexity
our first main result reported in this section can be succinctly stated as follows: for an assay with n snps and approximately s candidate primers for each snp we devise a relatively efficient algorithm that can achieve almost perfect coverage with tubes of size approximately o. unfortunately the coverage drops dramatically if the multiplex level is increased.  this result is similar in spirit  to related observations made about other graph problems.

in recent years, it has been shown that for broad classes of computationally intractable problems, there exist certain phase-transition boundaries across which the nature of the solutions and the computational effort needed to identify a solution changes dramatically  <cit> . when attempting to design multiplex pcr assays with high coverage, we observe a similar computational behavior on simulations using a novel graph formulation we call a multi-node graph . this graph representation consists of nodes representing snps and edges connecting two multiplex-compatible snps. two snps are multiplex compatible if none of their associated primers interact. to model the fact that snp compatibility depends on the assigned primers, we allow for the presence of an edge matrix euv. in a multi-node graph, euv =  <dig> when node u with primer set i is compatible to node v with primer set j. we induced a random multi-node graph by setting euv =  <dig> with probability p for all node pairs u and v, in states i and j respectively. using a simple greedy algorithm  we find that our ability to achieve high  coverage for randomly generated multi-node graphs critically depends on the compatibility probability, p, ) as well as the target level of multiplexing. these results are presented in figure  <dig>  by sampling from chromosome  <dig> of the human genome, the actual probability that two snps are compatible is approximately  <dig> . figure  <dig> would suggest, therefore, that designing 10-plex assays from n =  <dig>  snps is generally straightforward, but that increasing multiplex performance to 15- to 20-plex or beyond becomes extremely problematic. this appears to be consistent with current design practice though we emphasize that the location of the phase transition depends on both the total number of snps and the number of candidate primer pairs per snp. we recognize, furthermore, that random multi-node graphs only approximately model the multiplex assay design problem because primer pair candidates derived from real sequence data are not truly independent. for example, primer pairs may share a forward or reverse primer, or they may significantly overlap. in addition, in the process of assay design optimization, primers within a single tube may take on certain sequence characteristics  that are intrinsically less likely to interact, and thus make higher-than-expected coverage possible for a given multiplexing target.

multiplex pcr performance on human snp data
next we implemented two multiplex pcr assay design algorithms and applied them to real snp data obtained from the dbsnp database. we prescreened the  <dig>  chromosome  <dig> snps contained in build  <dig> of dbsnp  <cit>  for class  <dig> snps  containing at least  <dig> bases of non-low-complexity sequence both upstream and downstream from the target snp. this reduced our working set to  <dig>  snps,  <dig> % of the original total, from which  <dig>  snps were randomly selected for experimental purposes. the gc content of the 401-base flanking sequence surrounding  was  <dig> % +/-  <dig> % in line with a 41% gc content for chromosome  <dig> and for the human genome as a whole  <cit> .

our two best-fit greedy algorithms are designed to simultaneously assign primer candidates to snps and to partition snps into individual tubes in an effort to maximize both multiplexing level and coverage. see methods for complete details. while best fit algorithms are relatively simple, one can actually show theoretically that these results appear to be as good as expected  in graphs with this level of density. one version which we call "fixed-assignment best fit" assigns snps in random order to the fullest compatible tube, and as the name suggests, once a snp is assigned to a tube it is fixed. neither its assigned tube nor its associated primers are ever modified. if no compatible tube can be found, the snp is left unassigned, reducing total coverage. we considered a second variation on the best-fit approach called "flexible assignment best fit" in which snps already assigned to a tube can be removed under special conditions in order to accommodate a new snp assignment. special rules of the algorithm guarantee that the algorithm will eventually terminate with increasingly high probability. figure  <dig> demonstrates the precise nature of the tradeoff between multiplexing and snp coverage for a fixed number of snps  for both best fit methods.

multiplex pcr coverage performance tradeoffs
next we employed the fixed-assignment best-fit algorithm to generate coverage curves for target multiplexing levels m =  <dig>   <dig>   <dig> while varying numbers of snps. we considered snp sets containing between  <dig> and  <dig> snps. figure  <dig> presents our results. with  <dig> snps, 80% coverage could be achieved with 10-plex assays, but this drops to 40% coverage using 20-plex assays. however, if we increase the number of snps to  <dig>  then for 20-plex assays, coverage increases from approximately 40% to 80%. this graph shows that regardless of the multiplexing level desired, coverage increases with the number of snps but with diminishing returns. more precisely, for fixed multiplexing level m, coverage is roughly proportional to log.

discussion
there is extensive literature on the general principles of pcr primer design  <cit> . this work has led to a number of software applications, most notably primer <dig> and various extensions  <cit> . a fast dynamic programming formulation for testing primers for pair-wise compatibility has also been developed  <cit> .

the application of multiplex pcr has increased steadily over the past decade, requiring more sophisticated primer selection protocols. different algorithms may favor particular objectives, or may be designed for particular technology platforms. in general, the problem of identifying primer pairs to maximize the multiplexing level of a single assay has been shown to be np-complete by nicodeme and steyaert  <cit>  who also present an approximation algorithm that eliminates 3' base complementarity while addressing product size constraints. they also consider electrophoresis distance constraints that require two amplicons to have some minimum length difference so that they can be distinguished after being processed through an electrophoresis gel. additionally, snp detection methods based on primer extension protocols in conjunction with mass spectrometry must take into account the resolution of the mass spectrometer as for example with the matching algorithms presented by aumann, manisterski, and yakhini  <cit> .

whereas this paper focuses on the dual problem of assigning primers and partitioning snps into multiplex-compatible tubes, an entirely different multiplex pcr problem is concerned with finding a minimal number of primers necessary to amplify a maximum number of targets over a single experiment  <cit>  or over multiple experiments  <cit> .

our best fit approach is motivated by the theoretical analysis provided by alon and furedi  <cit>  who show that a greedy algorithm in standard graphs produces an independent set of size log n, and moreover this approach can be extended to produce a full cover of the graph. the multi-node graph is, in practice, substantially more complex to cover, however theoretical analysis suggests that the behavior is similar to standard graphs. the sketch of the proof is as follows. formal details are provided elsewhere  <cit> .

 <dig>  for a multi-node graph with n nodes and s states per node, we create a corresponding standard graph with ns nodes. 

 <dig>  we add random edges with probability p getting o edges. then we remove all the edges between nodes that are connecting representatives of the same node. the total number of edges removed is n s <dig> p. this means independently of the number s of representatives per node we remove roughly 1/n of the total number of edges.

 <dig>  if 1/n << p then this removal does not greatly effect the resulting graph and the probability that their exists a clique of size k on a graph of size ns applies to a multi-node graph of size n with s representatives per node.

CONCLUSIONS
in this paper, we quantified some of the critical tradeoffs involved in the multi-objective design of multiplex pcr assays and demonstrated a phase transition suggesting that achieving high-coverage designs becomes dramatically more difficult when snp compatibility probabilities fall below a certain critical threshold. explicit consideration of tradeoffs in multiplex pcr design is useful in helping researchers to design effective and reliable assays within the computational limits of the problem. furthermore, such tradeoffs provide a natural basis for comparing and contrasting novel computational techniques aimed at improving one or more objectives. although we have attempted to rely on standard design criteria, further laboratory testing is required to validate the design criteria used as the basis of this analysis. in the future we will seek to further improve our current tradeoff benchmarks with the development of novel algorithms and to apply our techniques to the design of high-multiplexing assays that achieve broad coverage of the complete human genome. we have also developed a web-enabled multiplex pcr assay design system known as muplex  <cit>  that also serves as a testing ground for on-going algorithmic development.

