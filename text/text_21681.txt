BACKGROUND
horizontal gene transfer  is believed to be a very important phenomenon in prokaryotic evolution, as it enables the acquisition of new genes or sets of genes that can accelerate evolution and adaptation to new environments or changing conditions.

in recent years, the availability of complete genome sequences from a wide range of prokaryotic species has made it possible to find many instances of potentially transferred genes in different genomes  <cit> . nevertheless, the actual extent and importance of these events, and therefore the relevance of hgt in the evolution of prokaryotes, is still a matter of debate  <cit> .

hgt has been extensively studied for sequenced genomes, but its real extent in natural populations in different environments remains unknown. many of these communities are interesting from the ecological, biotechnological and/or clinical points of view, and therefore it is very important to understand how their members interact, evolve and innovate. hgt can be a very relevant factor since it may influence the dynamics of a community, and a recent report emphasises its important contribution to niche specialisation and adaptation  <cit> . however, the real impact of hgt in natural populations is unknown, and to date we do not know whether these events preferentially influence communities in particular environments. the advent of metagenomic sequencing  <cit>  provides enough environmental dna sequences to address the study of global patterns of prokaryotic evolution in natural communities, including hgt.

two types of methods have been used to detect hgt events in genomic sequences: phylogenetic methods, based on the examination of the phylogenies of individual genes or proteins; and compositional methods, based on the analysis of dna composition, which is assumed to contain some evolutionary information in the form of species-specific signatures.

in theory, phylogenetic analysis is a powerful tool used to recognize hgt events. on building the phylogenetic tree of a family of sequences from different species, putative hgt can be identified when the position of a specie in the tree does not match that of a reference phylogeny, which can be obtained in different ways: from universally conserved genes such as 16s rrna or some trna synthetases, or by supertrees of conserved genes merged together  <cit> . phylogenetic methods are therefore usable with individual genes, as long as a set of orthologues is known. in the practice, phylogenies are often noisy and/or inconclusive for several reasons . therefore, the results of a phylogenetic analysis must be carefully examined before proposing hgt. this task is more difficult for metagenomic sequences because the origin of the sequence is almost always unknown  and, consequently, the construction of a reference tree is not straightforward. nevertheless, at least one attempt has been made to study environmental sequences by means of the comparison of individual phylogenies  <cit> , which must be taken as a valuable proof of concept.

several authors have used these phylogenetic approaches to detect and quantify hgt in genomes, orthologous groups of genes and protein families  <cit> . these methods estimate a rather low extent of hgt in all cases, usually below 2%. a possible explanation for this is that, since the barriers to hgt seem much easier to overcome when closely related species are involved  <cit> , it is likely that most hgt events are produced between species belonging to the same taxon. these events are much more difficult to detect using phylogenetic analysis as the resolution of the trees decreases for such a small range. consequently, it is likely that specific hgt events cannot be conclusively determined using phylogenetic approaches, leading to an underestimation in the frequency of hgt.

compositional methods are based on the assumption that individual genomes have characteristic features regarding their dna composition, which has been termed dna or genomic signatures. each genome has its own pattern of gc content and codon usage due to a combination of environmental and genetic factors  <cit> . recently transferred regions can be detected since they possess a different dna signature to that of the host genome which reflect their foreign origin  <cit> . therefore, hgt events in complete genomes could be detected by recognising zones of different or unusual compositional patterns. in these cases, the genomic signature will be closer to those of the donor genomes, which in some cases can reveal the phylogenetic origin. as time passes, the foreign sequence is shaped by the biases in the replication and reparation machinery, which causes its signature to progressively resemble that of the host. this process is known as amelioration, and implies that the original sequence can no longer be recognised as that from a foreign origin on the basis of nucleotide composition alone  <cit> . therefore, these methods perform better to detect recent hgt events, where genomic signatures differ significantly between the donor and recipient genomes.

many compositional methods based on several approaches and algorithms exist  <cit> . the percentage of hgt estimated by compositional methods is significantly higher than by methods based on phylogenies. in addition, different methods have been shown to predict very different sets of genes as having been horizontally transferred  <cit> . this apparently discouraging result has been recently interpreted to mean that each method is tuned to detect gene transfers of different ages  <cit> . normally, compositional methods have been used to analyse large genomic sequences since a significant amount of sequence is needed to extract the global features. this is a serious drawback for its use with metagenomic sequences.

both the phylogenetic and compositional approaches have their advantages and drawbacks, even though the two are complementary since they use independent sets of information. they make predictions based on different features and can, therefore, be combined to provide a more comprehensive insight into the relevance of hgt processes.

here, we propose a double approach to measure the incidence of hgt in short sequences of unknown origin as these are obtained by metagenomic sequencing of natural prokaryotic communities. both a compositional and phylogenetic method were derived and tested in order to apply them to complex mixtures of sequences. the methods were then used to study the sequences of several available metagenomic projects.

methods
obtaining sequences
several metagenomic projects have deposited dna sequences of contigs in the genbank database. the metagenomes analysed in this work are representative of different environments. two of them are from marine locations: whale fall, the prokaryotic community living in whale carcasses at the bottom of the sea   <cit> , and the sargasso sea metagenome from surface sea water samples   <cit> , representing a planktonic community. another is terrestrial, sampled from the soil of a farm   <cit> , and the last is a host-associated community, the human gut microbiome   <cit> . the average length of the contigs is close to  <dig> kb for all metagenomes .

due to the intensive computational resources and the time needed to completely analyse the larger metagenomes , we only worked with a representative fraction of these which consisted in  <dig>  contigs randomly selected from these metagenomes.

generating random metagenomes
to benchmark the ability of the phylogenetic method to accurately assign taxa to the sequences, we created artificial metagenomes taking random sub-sequences from completely sequenced genomes. sequences of  <dig> bps were selected from random positions of the approximately  <dig> complete genomes available when the study was performed, while overlapping sequences were discarded. the complete taxonomy for the genomes was also retrieved to be used in the automatic evaluation of the results. genomes and taxonomy were downloaded from ncbi  <cit> . the original species and taxa for the random metagenome referenced in the text show a very heterogeneous composition, and are seen in additional file  <dig>  the goodness of the assignments was estimated by means of the precision and recall measures .

data set for rare taxa
to evaluate method performance when poorly studied taxa are present, a new data set was generated. we focused on taxa having at least one fully-sequenced genome  and a low number of sequences in the genbank non-redundant protein database  <cit>  of march  <dig> . we selected three taxa at the 'class' taxonomic rank for the test: the bacterial planctomycetacia , with  <dig> sequences in the genbank database and one sequenced genome ; also the bacterial dehalococcoidetes  with  <dig> sequences and two closely related sequenced genomes ; and the archaeal methanopyri , with  <dig> sequences and one sequenced genome . a test data set was created, comprising  <dig> sequences of  <dig> nucleotides long for each taxon, which were randomly extracted from the complete genomes belonging to these taxa.

analysing contigs
to find putative orfs, we performed homology searches for each contig in the metagenome, by means of blastx runs against the non-redundant genbank protein database. only prokaryotic hits with e-values below 1e- <dig> were considered. identical hits were found when benchmarking with data sets derived from complete genomes since the corresponding proteins have already been deposited in genbank. this artificially eases the assignment to produce an inaccurate measure of method performance. when benchmarking, we removed all hits from the same species as the original sequence  to match the situation in which the identical sequence is unknown.

query and hit must align in at least 50% of the full length of both proteins. in this way, partial hits that could correspond to, for instance, single domains, are discarded. an exception is made when the hit is located on the extreme of the contig, and is truncated because of this. in this case, it is required to find one end of the protein. if the hit is interrupted by both ends of the contig, the alignment must span the full length of it. all hits not fulfilling these criteria are discarded.

after this step, the hits occurring in the same position and frame are considered homologues. we consider that two hits are in the same position if they overlap by at least 75%. note that according to this definition, two hits that overlap completely but where one is much shorter than the other, will not be recognised as the same hit. the smaller hit is considered a fragment and is, therefore, dismissed. after grouping this step, the remaining hits or groups of homologue hits identify the putative orfs in the contig, that are functionally characterised by means of blast homology searches against the cog database  <cit> . a depiction of the procedure can be seen in additional file  <dig> 

detection of hgt
we have developed two different methods to detect possible hgt events, both of which aim to find transitions in the dna sequences. the first is a phylogenetic method that relies on the taxonomic assignment of the orfs found in the contig to identify the instances of orfs assigned to disparate taxa . the second is a compositional method that scans dna, and looks for zones of differential oligonucleotide usage. we now go on to describe both methods in detail.

phylogenetic assignment method
for the homologues found for a given putative orf, a distance score is calculated as the inverse of the bit score of their alignment. the taxonomy for each homologue is obtained from the genbank database and chopped to the desired taxonomic rank , phylum , class , order  and family ). when more than one homologue is found for the same species, only the best hit is kept, thus effectively excluding paralogues. the orf is assigned to a given taxon if the lowest distance scores are those that correspond to the homologues from it. only two homologues from other taxa are allowed to have a lower score. if this is not the case, we often find that the orf has many close homologues from a single taxon, in addition to several others from different taxa. this could be the consequence, for instance, of a high degree of transfers in that particular protein family. in such cases, the orf is assigned to the taxon whose average distance score is at least 15% lower than that of any other. examples of this procedure are depicted in additional file  <dig> 

in any case, an orf requires at least three homologues with the taxon to be assigned to it. to avoid assignments when only distant homologues are found, a minimum identity is required between the orf and the homologues , and a minimum distance score is also needed. all homologues below these levels are not considered.

if the orf could not be assigned by this procedure, a list of candidate taxa is kept for it, containing the average distance scores for all taxa for which at least one homologue has been found. this list will be subsequently used to improve the assignments.

usually, between 10–40% of the orfs of real metagenomes can be accurately assigned in this way. it is possible to take advantage of the fact that the contigs often contain more than one orf to increase the number of assignments while maintaining a very high accuracy. for instance, let us suppose that a contig contains three orfs, and we can clearly assign a common taxon for two of them. if the third orf could not be assigned, we could assume that it belongs to the same taxon, provided it has close homologues from it . therefore, we have introduced an additional stage that takes into account the assignments for the neighbouring orfs. the unassigned orf is scored in the following way: the first five taxa in the list of candidate taxa are scored with 1/r, where r is their rank in that list. the scores of the neighbouring orfs are then added to this. if the neighbouring orf has already been assigned to a given taxon, a score of one is added only to that taxon. an orf is assigned to the taxon with the highest score, given that this is higher than  <dig> . for instance, a frequent scenario is that of an unassigned orf having both its closest homologue and a neighbouring orf belonging to a given taxon. in this case, the final score for that taxon will be equal to two, and the orf will be assigned to it. an orf cannot be assigned to a taxon that it is not in its candidate list, which implies that the orf must have at least one homolog belonging to the taxon.

this procedure increases the number of assignments in 10–12% for random metagenomes, and precision remains unaltered. for real metagenomes, the increase in the number of assignments depends greatly on the average number of orfs in the contigs , which ranges between 3% for soil and 20% for sargasso sea metagenomes.

once the orfs have been assigned in this way, a possible hgt event will be predicted when a contig contains sequences from different taxa . unassigned orfs are not considered.

in addition, a contig is assigned to a particular taxon if 75% of its orfs, or more, belong to it, which can be used to study the taxonomic composition of metagenomes.

compositional method
standard compositional methods for detecting hgt rely on detecting unusual characteristics in the compositional profile of the sub-sequences in comparison with a reference profile, normally that of the whole genome. the compositional profiles are usually expressed as a measure of the frequency of the constituent oligonucleotides. these standard methods cannot be readily used in this scenario since the sequences are too short to derive a reference profile. therefore, we have followed a different approach, which works as follows: we count all oligonucleotides of size n for each putative orf, using a sliding window of that size, which is moved through the sequence. the best results are achieved when n =  <dig> . the procedure creates a compositional vector for each orf, containing the frequencies of all possible oligonucleotides. complementary oligonucleotides are also included to eliminate any strand bias. the orfs are then compared to each other by calculating pearson's correlation coefficient between their compositional vectors. a low correlation coefficient indicates a dissimilar composition for these two orfs. the correlation values between all orfs in the contig are used to create a distance matrix, which is hierarchically clustered using the cluster v <dig>  program  <cit> . the resulting tree reflects the similarities between the dna compositions of the orfs in the contig . the clusters of sequences are obtained by chopping the tree at a fixed correlation value.

when only one cluster is obtained, all orfs in the contig are compositionally similar, and there is no indication of hgt. otherwise, the contig shows compositional transitions that can be the result of hgt events. the correlation value at which clusters are extracted, which we will refer to as the "clustering parameter", is critical for the performance of the method. when it is set at low values, a high divergence in composition is needed to fall below the threshold. therefore, we obtain few transitions, but these are very reliable in terms of compositional dissimilarity. on the other hand, using high values of the clustering parameter yields many possible transitions, but diminishes reliability .

compositional diagrams
we have created a way to depict the dna composition of a given sequence for visually inspecting the presence of compositional transitions. these compositional diagrams are generated in the following way: for a given dna sequence, sub-sequences of a given length  are extracted, starting in the first position of the sequence and advancing ten nucleotides each time. therefore, each sub-sequence overlaps the previous one by  <dig> base-pairs. as before, we create a compositional vector for each sub-sequence which contains their oligonucleotide frequencies . then all pairs of vectors are compared by calculating their pearson's correlation coefficient. the correlation values are transformed into colour intensity , which are shown in a dot plot in the coordinates corresponding to the central position of both sub-sequences . in this way, a sharp transition in dna composition is clearly visible as a zone of light colours  in the diagram.

benchmarking the compositional method on the escherichia coli genome
to assess the accuracy of the compositional method in detecting transitions that could correspond to hgt events, we used the e. coli k- <dig> complete genome because many different methods have provided hgt predictions for it. we created artificial contigs, segments of the e. coli genome containing four consecutive orfs. contigs were obtained by sliding a window, orf by orf, through the complete genome. orfs shorter than  <dig> base pairs were excluded. in this way, we obtained  <dig> artificial contigs. for these, we counted the number of methods that predict hgt for each orfs contained in the contig, according to the compilation of compositional hgt predictions by dufraigne and colleagues  <cit>  that gathers the results for six different methods. we considered that it contains a compositional transition  if consecutive orfs differ by two or more in the number of methods predicting it as hgt. for instance, if a orf is not predicted as being transferred by any method, but the next orf is predicted by two methods or more, the contig is considered to contain a compositional transition that can correspond to the boundary of an hgt event. the highest value of the differences in predictions for consecutive orfs in the contig is called "difference in methods" . in this way,  <dig> contigs are predicted to contain a boundary of a putative hgt event .

RESULTS
taxonomic assignment method
benchmarking
to assess the accuracy of the results produced by the taxonomic assignment method, we created data sets composed of sequences taken randomly from complete genomes. in this way, the assignment is easy to check since the original taxon is known. those cases in which the assignment does not match its original taxon will be carefully inspected to assess whether it was produced by an error in the assignment, or if it could be a genuine case of hgt. the results are shown in table  <dig> for a set of  <dig> sequences, and are classified into three different taxonomic ranks .

assignments were done at three different taxonomic depths . the table shows the number of predictions carried out, and how many of these match the original taxon, both for orfs and contigs. the homology searches for four contigs did not provide any hits and were, therefore, not considered

the results indicate that the method is highly accurate at these taxonomic ranks. precision  was  <dig> ,  <dig>  and  <dig> % for class, order and family ranks, respectively. recall  was also acceptable . by inspecting the  <dig> assignments that do not match their original taxon for the class rank, we found that  <dig> could correspond to real instances of hgt : two orfs in a contig of treponema denticola which, according to their phylogenies, are monophyletic with clostridia; an orf in streptococcus pyogenes, that is closely related to the neighbouring taxa of bacillales, is flanked by a transposase, and shows a rather different dna compositional profile as compared to the rest of its contig; another orf in a contig of archaeoglubus fulgidus that finds very close homologues only with the pyrococcus clade; and two orfs in contigs from neisseria gonorrhoeae and listeria innocua, which show an atypical dna composition and are predicted to be involved in hgt-related functions .

assignments were done at three different taxonomic depths . the table shows the number of predictions carried out, and how many of these match the original taxon, both for orfs and contigs. the homology searches for four contigs did not provide any hits and were, therefore, not considered

hgt is less likely in the four remaining cases. they belong to the cyanobacteria prochlorococcus marinus , and are assigned to their closest taxon . as we will describe carefully in the next section, these assignments are probably due to database incompleteness: no homologues from the original taxon can be found, and the orf is assigned to a different but close taxon. this occurs when the taxon is rare or poorly known, which is the case for prochlorales.

three contigs will be proposed to belong to a taxon that differs to the original, since all its orfs have been assigned to it: the two contigs of prochlorococcus marinus, and that of treponema denticola. since the method detects hgt only when a transition is present , a possible transfer will not be suspected for these contigs.

therefore, the method will detect just three putative hgt events in the contigs of streptococcus pyogenes, neisseria gonorrhoeae and listeria innocua, since the rest of the orfs in these contigs have been correctly classified. all of them are very likely to be the product of hgt; two of them contain zones of atypical composition, and one corresponds to a transposase.

database incompleteness and rare taxa
in the previous section we have shown an example of the effect that incomplete knowledge of the universe of prokaryotes can have on the performance of this method. to further investigate the influence of this factor, we have performed two different tests: a deletion experiment, in which a percentage of the database is removed to simulate a reduction in our current knowledge, and a test of assignment involving sequences from rare taxa, which probably represent the most serious challenge to the method.

in the deletion experiment, we randomly removed a percentage of the entries of the non-redundant database used for homology searches, and then performed the full procedure of taxonomic assignment for the data set of random sequences from complete genomes and an "order" taxonomic division. the results are shown in additional file  <dig>  and indicate that precision is not greatly affected until a large fraction of the database has been deleted. it is necessary to delete more than 80% of the database to lose just 10% precision, while almost 90% of correct assignments remain. the deletion mainly affects recall, which decreases slightly until 60% of the database has been removed, when it drops rather rapidly. this is probably related to the taxonomic distribution of the entries in the database. removing a few entries only has a slight effect on the best known groups  since it is likely that closely related sequences can still be found. this result also indicates that the phylogenetic method is expected to improve over time since the completion of the databases will increase the number of predictions that can be made.

it is important to test the performance of the method when working with sequences of poorly known taxa since many metagenomes could be enriched in these rare taxa. there are three possible outcomes, which from best to worst are: the method can produce an assignment only when the case is clear and leaves it unassigned otherwise; or it can fail systematically, by always assigning orfs to the same close taxa; or it can fail completely and assign orfs to different and incorrect taxa.

the results of the assignment for a data set of rare taxa  are shown in additional file  <dig>  once more, they indicate a high precision of the assignments. dehalococcoidetes is the taxon that achieves the best results: 63% of the orfs and 85% of the contigs were assigned with almost 100% precision. only two orfs were assigned to a different taxon , a likely candidate for hgt since compositional analysis indicates that the contig presents a marked transition. the good results for this taxon are due to the availability of two closely related complete genomes, and they illustrate the situation well in which having a single complete genome can be of great help in the analysis of environmental sequences.

for planctomycetacia, the method classified just 10% of the orfs and contigs, but did so with utmost precision . in this case, a prediction was made only for clear cases in which reliable homologues could be found.

in the case of methanopyri, all sequences in the database belonging to that taxon originate from a single organism:methanopyrus kandleri. since sequences from the same species are excluded for benchmarking , it is clear that any possible assignment will be incorrect. in this extreme case, the method produces very few results: only five orfs  are assigned, all of them to other euryarchaeota.

in summary, the results of these tests indicate that the method is very accurate in all cases and quite sensitive when enough information is available. when the original taxon is not well known, the method acts conservatively and produces very few assignments.

composition of the community
the taxonomic assignments for real metagenomes can be used to study the composition of the different communities. the percentage of sequences assigned to different taxa for the four metagenomes under study is shown in figure  <dig> and in additional file  <dig>  the results for all metagenomes are in good agreement with the compositions based on 16s rdna libraries reported in the original papers, which can also be seen as an additional support to the quality of the assignments. all communities are rich and diverse, and are representative of many different taxa. a single taxon, alpha-proteobacteria, seems to be ubiquous and is the most abundant one in soil and sargasso sea metagenomes, but is also very abundant in the whale fall sample. in contrast, some taxa seem to be very environment-specific, such as planctomycetales in soil, prochlorales in sea or lactobacilli in the gut.

in the gut and sargasso sea metagenomes, two taxa are clearly predominant . the whale fall metagenome is dominated by proteobacterial taxa, particularly alpha-, gamma- and epsilon-proteobacteria. the soil metagenome shows the most balanced composition. no taxon dominates clearly and many taxa are represented in substantial amounts, which is in agreement with the highly diverse distribution found in 16s rdna sequences  <cit> . the farm soil metagenome also has the largest amount of sequence for which no homologues can be found; that is, the highest number of putative orphans . in contrast, a recent study of 16s samples from different environments concludes that soil samples are less diverse, which we believe to be the result of the biases in the method used for estimating diversity  <cit> . our study confirms the phylogenetic richness and diversity of the prokaryotic soil community.

quantifying possible hgt events in metagenomes by taxonomic assignment
as mentioned above, a possible hgt event in a metagenomic contig is predicted whenever it contains orfs assigned to different taxa. we analysed the number of such cases found in the four metagenomes. as these metagenomes come from very different environments and conditions, their communities could reflect rather different lifestyles. we wanted to test whether there were significant differences in the relative amount of putative hgt that can be detected in these metagenomes by this procedure.

the results  show that the number of detected hgt events was low in all cases, and that it matched well with what was found when analysing hgt in protein families using other methods based on phylogenies  <cit> . obviously, the putative transfers within taxa must be much more abundant; however, they cannot be detected by this method. a higher number of events was detected for the gut and sargasso sea ones. interestingly, one of the marine metagenomes  almost doubled the quantity of hgt found for the other .

only contigs with two orfs or more were considered. the total number of contigs considered is also shown.

we can also study the taxa involved in the transferences, although it is not possible to know the direction of the transference in the small metagenomic sequences, that is, distinguishing donor from the receptor. the most frequently involved taxa in putative transferences are presented in additional file  <dig>  as expected, the involved taxa are either those most abundant in the metagenome, or those for which evidence of frequent transferences exist  <cit> . an interesting exception can be found in the sargasso sea metagenome, where many transfers involving a flavobacteria and either gamma- or alpha-proteobacteria are detected, a trend that has not been found before.

compositional method
benchmarking
the objective is to provide an estimation of the accuracy of the compositional method to detect changes in dna composition that could correspond to hgt events. the method has been tested on artificial contigs extracted from the genome of e. coli, and the results of different hgt predictions in that genome  <cit>  have been used to assess the goodness of the results . the results can be seen in table  <dig> and in additional file  <dig> 

number of true negatives, false positives, false negatives, true positives, and the measures of precision, recall, specificity and accuracy are shown. different values of the clustering parameter have been used.

when an intermediate value of the clustering parameter is chosen , the method is able to detect approximately one third of the transitions with a high precision . as expected, the method underestimates the number of compositional transitions given the lack of contextual information, and therefore that of putative hgt events. it must be remarked that the number of wrong predictions is low, and therefore this method can be used to measure the relative number of possible hgt events in different sets of sequences. it should also be noticed that according to additional file  <dig>  many of the false positives correspond to cases in which one of the reference methods predicts hgt, while the other does not. in the event of considering these instances as likely cases of hgt, the performance of the method will improve substantially with regard to precision and recall. precision will reach values of 98%, 87% and 81% for clustering parameters  <dig> ,  <dig>  and  <dig> , respectively.

quantifying hgt in metagenomes by dna composition
we have used the compositional method to analyse the number of likely hgt events that can be found in the metagenomes under study. the results are shown in table  <dig> 

only contigs with two orfs or more that are longer than  <dig> base pairs were considered. three different values of the clustering parameter were used, but the trend of the results remains the same.

three different values of the clustering parameter have been used. lower values show low recall and high precision, while higher values balance both measures. the range of hgt percentages found  is consistent with those reported for complete genomes  <cit> . the trend remains the same for all values of the clustering parameter: the highest percentage of compositional transitions was found for the whale fall metagenome, followed by the human gut and farm soil metagenomes, which revealed very similar percentages; then finally, sargasso sea, which is well below the others and shows the lowest number of compositional transitions.

although both methods presented herein are apparently quite accurate in the detection of putative hgt events, most of their predictions are not coincident, and less than 5% of the predictions are shared by both methods. this can be explained if we consider that the hgt events detected by dna composition are often undetectable by taxonomic assignment because their phylogenies are noisy or inconclusive . this can indicate that these genes have a complex history of multiple acquisitions and losses in different genomes. notice that, in the context of a complete genome, these events would easily be detected by phylogenetic methods since we could see that the evolutionary history of the orf is rather different to other orfs in the genome. in this scenario, compositional and phylogenetic methods would agree in the prediction, as already proposed  <cit> . in addition, those events detected by phylogenies are often not detected by composition. this is likely because these are old events involving distant taxa that have already been ameliorated .

nevertheless, the results from both methods are consistent and show a similar trend: the whale fall metagenome presents the highest number of detectable hgt events. the soil metagenome comes second, closely followed by the human gut metagenome. finally, and perhaps unexpectedly, the sargasso sea metagenome is the one in which less hgt events can be identified by both methods. this low amount of hgt found for the sargasso sea metagenome is remarkable since it has been proposed that the high quantities of bacteriophages found in sea waters can promote hgt significantly  <cit> .

CONCLUSIONS
the task of detecting hgt in metagenomic sequences is difficult. the available methods are designed to work with complete genomes , and it is assumed that one knows the species from which the sequences are taken: phylogenetic methods attempt to identify deviations with regard to the expected phylogeny, while compositional methods detect differences in the compositional profile of each orf as compared to that of the complete genome. these methods are not applicable to metagenomic sequences. metagenomes are usually composed of a complex mixture of short sequences belonging to many different species.

not knowing the source species for each sequence in the metagenome is the most serious hurdle for all metagenomic studies. one of the most relevant advances in metagenome analysis will be to solve the problem of binning, that is, the assignment of metagenomic sequences to source species or taxa. although some attempts have been made by compositional methods to address this task  <cit> , the problem remains unresolved. as it stands, more complete genomes would be required for training, as would longer sequences than those currently supplied by metagenomic projects  <cit> . nevertheless, it is likely that the length of the sequences obtained in these projects will not change very much in the near future since metagenomics is tightly linked to the use of fast and cheap pyrosequencing machinery  <cit> , which currently obtains short readings and contigs . therefore, either more powerful methods or different approaches will be needed to address the task of assigning sequences to species or taxa. we have presented herein the usage of a highly precise method, based on sequence homology, which can provide an interesting alternative for complementing compositional approaches. the advantages of methods based on sequence homology and phylogenies are that they are unaffected by the short length of the contigs, they can work with partial sequences, and can even classify relatively unknown taxa with high accuracy. it is also possible to take advantage of the presence of several orfs in the contig to support the assignments, thus increasing precision and, especially, sensitivity.

it is very likely that both methods presented herein significantly underestimate the number of hgt events. compositional methods can only detect recent transferences before amelioration erases the distinctive signatures of the sequences. when dealing with metagenomic sequences, the situation is even more challenging since the analysis must only be done for a very short segment of the sequence, and we lack the contextual information provided by the rest of the genome. on the other hand, phylogenetic methods usually rely on distinguishing incongruent phylogenies, identifying the branches of a tree that are in atypical positions with respect to a reference. once again, this is a difficulty for metagenomic sequences because the species source for the sequence is unknown. therefore, it is not possible to assess its position in the tree. we rely on assigning the most probable taxon for each orf to distinguish instances of neighbouring sequences of different likely origins. the main disadvantage of this procedure is that it has a limited sensitivity. it is very difficult and risky to perform assignments at deep taxonomic ranks, and it is probably impossible to do so at the species level. therefore, we will only detect events involving distant taxa, and will overlook those that happen between closely related species or taxa, which are probably the most abundant.

the results presented in this work must be taken as an indication of possible trends for hgt events in prokaryotic samples from diverse environments. however, it must be taken into account that many different factors, some yet unknown, can influence the prevalence of hgt in a community. for instance, we do not know how the composition of the community shapes the likelihood of hgt events. hgt could be expected to be widespread in a very diverse community in which many different genes and subsystems are present, and transferences could greatly accelerate evolution and adaptation to environmental challenges  <cit> . on the other hand, hgt might be easier in a community composed of closely related species for which the barriers to the transference can be more easily surmounted  <cit> . furthermore, some species seem to be more prone to hgt events than others  <cit> . the prevalence of hgt events is certainly influenced by both environmental characteristics and the composition of the community, and as yet, we do not know the balance between both factors. furthermore, we must realize that we are observing putatively transferred genes in the genomes of the species present in these communities. obviously, these species are present in other communities and environments, and the putative hgt events may have occurred in any of these. for instance, we have found transferences between different archaea in the human gut metagenome . the only archaea that has been found in measurable amounts in the human gut is methanobrevibacter smithii. this indicates that these putative transfers could have happened in some other environment in which m. smithii can co-exist with other archaea, for example, sewage waters. a similar circumstance has been found in another study of bacteria from the human intestine  <cit> .

this study attempts to provide the first methodological step for the study of the dynamics of hgt in prokaryotic communities. further studies should deal with the influence that community composition and environmental factors have on hgt rates by addressing questions such as: is hgt more widespread in more diverse communities? or is it favoured in cases where the community is dominated by a few closely related taxa? to what extent do environmental challenges affect the rate of gene transfer? is there a correlation between the amount of transferences and the presence of bacteriophages?

the answer to these questions will shed light on the true role of hgt in adaptation and innovation, and will greatly improve our understanding of the dynamics of natural prokaryotic communities.

authors' contributions
jt conceived the study and performed the analyses. am participated in the coordination, and helped to draft the manuscript. both authors participated in the discussion of the biological implications of the results, and they read and approved the final manuscript.

supplementary material
additional file 1
metagenomic data. this figure shows the contig length and number of orfs per contig in different metagenomes.

click here for file

 additional file 2
supplementary tables. supplementary table 1: species and taxonomic classes for the contigs in the random dataset; supplementary table 2: results of the phylogenetic assignment of  <dig> sequences from rare taxa; supplementary table 3: number of assignments  for the contigs of different metagenomes. supplementary table 4: length of sequence analyzed, length of sequence with homologues, and percentage of sequence for which no homologues could be found supplementary table 5: taxa involved in possible hgt events . supplementary table 6: number of contigs proposed to contain a compositional transition 

click here for file

 additional file 3
orf determination. blastx run of a metagenomic contig, indicated by the red bar on the top. eleven hits  have been found, shown in black. grey segments in the hits indicate the part of the homologue protein that has not been found. in the merging step, protein hits 1– <dig> are considered homologues since they are in the same position and frame containing the full length of the protein hit. therefore they are merged in a single hit. hits 7– <dig> are also in the same position and frame, but the alignment covers less than 50% of the protein hit because it is truncated by the end of the contig. in this case, as the other extreme of the protein has been found, the hit is considered valid, and homologues merge as before. protein hit  <dig> is in the same frame as hits 1– <dig>  but is much shorter. therefore, it does not merge with hits 1– <dig>  and is removed in the filtering step where all short hits overlapping with others in the position and frame are removed. note that protein hit  <dig> overlaps slightly with hits 1– <dig>  but it is considered a different orf since they overlap by less than 50% of the length of both proteins. protein  <dig> is removed in the filtering step since it covers less than 50% of the protein hit and is not truncated by the extremes of the contig.

click here for file

 additional file 4
example of the phylogenetic method. three examples of the procedure for the taxonomic assignment by the phylogenetic method. phylogenetic trees have been created with the homologues found for three different metagenomic orfs. homologues are coloured according to their taxonomic affiliation. the position of the query metagenomic orf is signalled by the black arrows in the trees. the tables at the bottom of the trees show the sorted list of the homologues and their distances to the query orf. a) the query orf is monophyletic with the epsilon-proteobacteria taxon. therefore, the lowest distance scores are those for the homologues belonging to that taxon, and the query orf is automatically assigned to it. b) the orf is closely related to alpha-proteobacteria, but there are some homologues belonging to that taxa that are distantly related. nevertheless, the average distance score for alpha-proteobacteria is more than 15% lower than the average distance for any other taxon, thus allowing its assignment to it. c) in this case, neither the orf is monophyletic with any taxon, nor the average distance scores allow the assignment, and the query orf remains unassigned.

click here for file

 additional file 5
example of the compositional method. compositional analysis of several contigs. the upper left panel corresponds to the usual pattern for a compositional homogeneous contig. the other three panels show compositional transitions.

click here for file

 additional file 6
influence of database size. effect of the deletion of a variable percentage of the database used in the performance of taxonomic assignments. the ordinate axis shows the percentage of entries deleted from the database, while the abscissa axis shows the percentage of precision  and sensitivity  for the assignment of the orfs.

click here for file

 additional file 7
full analysis of a single contig. analysis of contig aafy <dig> from the whale fall metagenome. homology searches indicate that the contig contains three orfs. a: the compositional method identifies a transition in the contig. the first two orfs show a similar composition, but the third differs. in addition, the second orf is a transposase, which supports the idea of a probable hgt. b: taxonomic assignment provides a result for the two first orfs , but not for the third. the third orf finds only one distant homologue  with a gamma-proteobacteria , and therefore an assignment cannot be made. as a result, this contig is recognised as a probable hgt only by the compositional method.

click here for file

 acknowledgements
jt wishes to acknowledge miguel pignatelli for technical support, and iakes ezkurdia and iñaki comas for discussions. financial support was provided by projects bfu2006- <dig> from the spanish ministry of education and science  and gv/2007/ <dig> from the generalitat valenciana, spain. jt is a recipient of a contract in the fis program from isciii, the ministry of health, spain.
