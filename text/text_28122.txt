BACKGROUND
massive parallel sequencing of rna has provided researchers a powerful tool for transcriptome analysis. the protocols of gene expression analysis using the sequencing approach fall into two major categories. the traditional approach is 3' tag digital gene expression , in which oligo-dt was used for synthesis of cdna libraries, resulting in enrichment in the 3' end of polyadenylated mrnas. these polyadenylated fragments were further digested by certain restriction endonucleases to produce short cdna tags. the short tags were then sequenced by massive parallel sequencing technologies to give "digital counts" of the mrna molecules originated from each gene. a variety of dge approaches differ in their choices of restriction enonuclease, cdna cloning step, and usage of barcodes  <cit> . these approaches were adapted from the original serial analysis of gene expression   <cit>  and expressed sequence tag   <cit>  approaches, and revolutionized by the ultra-high throughput brought upon by next-generation sequencing platforms. the more recent method is rna-seq, in which the entire transcriptome is randomly fragmented into pieces of a few hundred nucleotides, and reverse transcribed into cdna libraries. these cdna fragments are then pcr amplified and sequenced in parallel  <cit> . this technology requires considerably higher coverage to reach similar power in detecting lowly abundant transcripts. however, rna-seq provides more information than dge on transcript structure and dynamics by surveying whole transcripts instead of 3' tags. with rapid reduction of sequencing cost and ever growing sequencing depth, rna-seq has gained more popularity over dge approaches in recent years.

compared to microarray-based gene expression analysis, dge and rna-seq have essentially no background, and therefore overcome the ratio compression problem  persists in microarray technology; the dynamic range of sequencing based approaches also expands with higher sequencing depth  <cit> . moreover, sequencing based gene expression measurement shows higher reproducibility between technical replicates than microarray based approaches  <cit> . furthermore, it is possible to identify novel transcripts and isoforms with sequencing-based methods.

despite these advantages, a comprehensive understanding of the characteristics and potential artefacts in the data is needed to most appropriately analyze rna-seq data. in an important study of rna-seq data characteristics, oshlack et al. found transcript length biases in rna-seq data  <cit> . specifically, the authors argued that due to the random rna fragmentation and sampling nature in rna-seq, the aggregated read counts on a gene may follow a poisson distribution, where the sampling rate is proportional to true expression level multiplied by gene length. measures to normalize the aggregated read counts by gene length, such as reads per kilobase of exon model per million mapped reads   <cit>  or similarly fragments per kilobase of exon model per million mapped reads   <cit> , can potentially lead to unbiased estimate of the true expression level of a gene. however, the distribution of these normalized read counts no longer possesses the overall nice feature of equal mean and variance, and shorter genes have larger variance than longer ones. as a result, statistical power to detect differential expression will be a function of gene length. this phenomenon is inherent to the nature of rna-seq because there are essentially larger sample sizes for longer genes. on the other hand, dge may not suffer from this issue because only one tag is counted for each gene. to overcome such gene length effect in detecting differentially expressed genes or enrichment of particular gene sets, a recent study proposed to use the square root of gene length as weights to adjust the gene level test statistic for differential expression, or to adjust the identification probability of each gene in the null distribution for the fisher's exact test in gene set analysis  <cit> .

in addition to length biases, other factors such as read mapping uncertainty and sequence base composition may also confound results from rna-seq experiments. read mapping uncertainty across different isoforms  <cit>  and different genes  <cit>  have been addressed in rigorous statistical framework by recent methods in the field and improved estimation of gene expression levels from rna-seq experiment. in contrast, investigation of sequence base composition effect in rna-seq data is still exploratory  <cit> . the correlation between gene expression level and dna base composition is an important and extensively studied issue. in mammalian genomes, the dna base composition is correlated with gene density  <cit> , recombination  <cit> , methylation  <cit> , and many other genomic features. but there is no clear evidence suggesting correlation between dna base composition and gene expression pattern  <cit> . base composition of microarray probes has been found to introduce variations to probe-target hybridization strength, and in turn affect the gene expression level measured by microarrays  <cit> . in high throughput dna sequencing, it has been shown that various technical artefacts are correlated with base composition. dohm et al.  <cit>  clearly demonstrated a strong relationship between read counts and the gc content in  <dig> kb windows along the genome from solexa dna sequencing experiments. recently, two groups independently examined the nucleotide-level read counts in rna-seq data and found strikingly similar non-uniform patterns in the reads distribution along genes; and the pattern is strongly associated with base compositions surrounding the investigated base position  <cit> . hansen et al.  <cit>  further showed that the pattern is specific to rna-seq libraries made by random hexamer priming, and proposed a random hexamer based re-weighting approach to adjust for the nucleotide composition bias in read counts. alternatively, li et al.  <cit>  regressed the read counts at a particular base on the identities of nucleotides around the base, using parametric and non-parametric regression tools. besides random hexamer priming efficiency, the base composition may affect rna secondary structure or priming efficiency in other enzymatic steps, and lead to uneven sequence read coverage from the cdna sequencing library. we expect that the base-level composition bias may also affect our estimation of gene expression levels. overlooking such biases may mislead downstream biological interpretations.

in this article, based on multiple publicly available rna-seq data sets, we showed that the commonly used measures of gene expression levels, such as raw read counts or rpkm/fpkm, are biased in transcript length, gc content, and dinucleotide frequencies. we also investigated the effects of biological sources, experimental protocols and data processing methods on these bias patterns systematically. we found that the bias patterns are specific to experimental protocols but not specific to biological sources, suggesting that they are technical artefact rather than biologically relevant patterns. it motivated us to develop a generalized additive model based algorithm to jointly correct for these biases. in contrast to  <cit>  and  <cit>  where base-level read counts were investigated, we focused on aggregated read counts for each gene and aim to remove the bias trend across genes. our method can effectively correct for gene-level biases, and the corrected estimates of absolute gene expression levels agree better with gold-standard expression measures such as taqman rt-pcr and quantigene. compared to the random hexamer bias correction method in  <cit>  and multiple additive regression trees  in  <cit> , our method is computationally less demanding, yet performs more favourably in correcting for gene-level biases. our work not only contributes to understanding of potential technical artefacts in rna-seq experiments, but also provides more accurate gene expression measures. the correction method will be useful in meta-analysis of data sets using different platforms or experimental protocols, and may also help correcting for tissue/cell-type heterogeneity in rna samples. obtaining accurate absolute gene expression levels is also of inherent biological interest, and help answering various biological questions, such as estimating enzyme reaction rates for genetic network modelling, comparison of isoform levels, and evolutionary comparisons across species.

methods
data sets
maqc data sets
microarray quality control  data sets  <cit>  contain gene expression data from multiple quantitative platforms and are widely used in assessing platform performance and testing for different data processing methods. we used data collected through three platforms for two samples: the ambion human brain reference rna and stratagene universal human reference rna. the three platforms are solexa  <dig> g genome analyzer sequencing platform  <cit> , taqman qrt-pcr platform, and quantigene platform  <cit> .

the two samples are labelled maqc <dig> and maqc <dig>  maqc <dig> contains  <dig> technical replicates of brain reference rna samples and  <dig> technical replicates of uhr rna samples sequenced on  <dig> lanes of two flow cells. maqc <dig> contains uhr rna samples from  <dig> different library preparations sequenced on  <dig> lanes of two flow cells.

all experiments used standard illumina rna-seq protocol. the raw sequence files were downloaded from the sequence read archive http://www.ncbi.nlm.nih.gov/sra/ with accession numbers srx <dig>  srx016368-srx <dig>  taqman quantitative rt-pcr technology first reverse transcribes rna transcripts into cdna, and then measures concentration of each cdna template at each cycle of pcr by detecting the fluorescent signals released from a target-specific fluorogenic hybridization probe that is hydrolyzed by taq polymerase during the extension phase. it is often used as gold standard for microarray studies. taqman qrt-pcr data for  <dig>  probes, corresponding to  <dig>  refseq genes, were obtained from geo database with accession numbers gsm129638-gsm <dig>  which represent  <dig> technical replicates of taqman qrt-pcr for each of the two samples. reported values are normalized expression values as . the expression of each measured gene was compared to the housekeeping gene polr2a by delta ct  calculations, a ct value of  <dig>  was used for any replicate that had ct >  <dig>  quantigene is a highly sensitive assay based on dna-rna hybridization and does not involve any reverse transcription step. the amount of rna molecules is measured by luminescence signals released during branched dna amplification. the detection threshold of quantigene data is background +  <dig> sd of background. background signals were determined in the absence of rna samples and subtracted from signals obtained in the presence of rna samples. quantigene data for  <dig> refseq genes were downloaded from geo database with accession numbers gsm129654-gsm <dig>  representing  <dig> technical replicates for each of the two samples. reported values are background-subtracted luminescence signal. both taqman and quantigene data sets labelled genes above detection threshold with a flag "p" and those below the threshold with "a", and we only used genes with flag "p" in downstream analysis. to compare with rna-seq data, we matched refseq gene ids with ensembl gene ids  using bioconductor, and only used genes with unambiguous one to one match in downstream analysis.

rna-seq data from kidney and liver
this dataset was generated in  <cit>  and used widely in the literature on rna-seq data analysis approaches. raw sequence files from liver  and kidney  were downloaded from the sequence reads archive. to compare with the data processing method used in the original publication, read counts for each ensembl gene were downloaded from http://bioinf.wehi.edu.au/resources/ 
  <cit> .

yeast rna-seq data
this dataset was described in  <cit>  and also used in  <cit>  to demonstrate sequencing biases caused by random hexamer priming. we downloaded raw sequence files of two technical replicates of the isogenic wild-type strain from the sequence read archive with accession numbers srr <dig> and srr <dig> 

yeast rna-seq data using alternative protocols
this dataset was described in  <cit>  through different library preparation procedures. standard rna-seq library preparation involves rna fragmentation followed by cdna synthesis with random hexamer priming. in this study, cdna synthesis before fragmentation and different priming chices was tested. we downloaded raw sequence files of two libraries prepared by random hexamer priming and cdna fragmentation by dnase i , and oligo-dt priming and cdna fragmentation by dnase i  from the sequence reads archive.

frt-seq data
this dataset was generated in  <cit>  for human placental poly+ rna sample, using both the standard rna-seq library preparation protocol and a novel approach called frt-seq. this new approach does not involve pcr amplification and the reverse transcription step is performed right on flow cell . we downloaded the raw sequence files for frt-seq  and standard rna-seq  from the european nucleotide archive. to compare with data processing method used in the original publication, read counts for each refseq gene were also downloaded from ftp://ftp.sanger.ac.uk/pub/transseq/.

all the data sources, accession numbers, characteristics of the techniques and related information are listed in table  <dig>  the differences between sample preparation protocols in these data sets are summarized in figure  <dig> 

data processing procedure
three procedures were performed in processing sequence data to obtain estimates of expression levels. for procedure  <dig>  we used tophat   <cit>  to align the raw sequencing reads to reference genome, using gene model annotations to direct the mapping of reads spanning splice junctions. in this default setting, reads that can be mapped to multiple  genomic locations had all alignments reported and their contributions in estimating gene expression were proportionally down-weighted by cufflinks. the specific reference genome and gene model annotation used for each data set are listed in additional file  <dig>  cufflinks   <cit>  was then used to estimate gene expression levels based on the same gene model annotations. by specifying the known gene structure annotations, we suppressed cufflinks from de novo transcript assembly, and only allowed it to assign reads to different isoforms probabilistically, estimate isoform-level expression using maximum likelihood method similar to rseq  <cit> , and summarize isoform-level expression into gene-level expression measures in fpkm unit. the gene expression levels estimated from cufflinks agreed well with those from rseq . for procedure  <dig>  we directly extracted read counts per gene or rpkm from original publications if they are available and compared them with corresponding gene model annotations. due to the limited availability of intermediate data and ambiguity of originally used gene model annotations, we only implemented this procedure for marioni et al. liver and kidney data set and mamanova et al. frt-seq data set. for procedure  <dig>  we directly counted reads whose starting positions fall in exon regions of all transcripts from mapping results obtained in procedure  <dig>  and converted them to rpkm units. the procedures applied to each data set are listed in additional file  <dig> 

bias corrections by generalized additive models
we consider the bias of gene expression levels in terms of gene length, gene gc content, and the frequencies of the  <dig> possible dinucleotides. let yi be the inferred gene expression level for gene i , and x be a matrix with the i-th row xi ≡  representing the values of  <dig> potential bias factors for gene i. specifically, xi,  <dig> is the gene length on log scale, and  are bias factors related to nucleotide composition. our goal is to obtain a less biased estimate of expression level  by removing the biases due to these factors. since some of the bias factors are correlated , we first performed a principal component analysis on the 2nd to 18th columns of x, denoted as x, and obtain the first k principal components pi,  <dig>  pi,  <dig> ..., pi, k that can explain more than 95% variation in x. then we used these principal components to fit the following generalized additive model : log = αi + xi,  <dig> + s + s +⋯+ s + εi. finally we obtain the bias corrected expression as the sum of the grand mean of y and the residual from fitted model, i.e. .

definition of "gene" units to summarize expression levels
in mammalian genomes, one gene may contain multiple transcript isoforms, and sequencing reads can fall on a genomic region corresponding to different isoforms or even genes. what is more, there is no consensus on "gene" unit to summarize gene expression. for example, oshlack et al. defined gene length as the median of all transcript length related to that gene, which is a simple high level summary but may not be accurate when different isoforms have very different expression levels  <cit> . hansen et al. defined region of constant expression  by dividing genomic regions based on which gene and transcript isoform the regions are associated with  <cit> . this definition avoids the ambiguity in assigning sequence reads to different transcript isoforms, but loses the biological interpretation for each unit. li et al. avoided ambiguity in overlapping genes/isoforms by focusing on single isoform non-overlapping genes  <cit> . this definition inevitably loses information from the data. in this study, we examined different units  to summarize expression level and detect biases, and therefore alleviate the potential artifact associated with each definition. we used the median cdna length, cdna gc content and dinucleotide frequencies as gene-level summaries.

software package
the gam correction method and facilitating functions were implemented in an r package  and this package can be obtained as additional file  <dig>  and also from http://bioinformatics.med.yale.edu/group/. this gam-based correction method is computationally efficient. it takes ~4- <dig> seconds on a  <dig>  ghz xeon cpu to correct ~ <dig>  gene expression levels for human genome with ens  <dig> annotation.

RESULTS
rna-seq biases in length, gc content, dinucleotide frequencies
to detect potential biases in the gene expression levels, we grouped genes into bins according to each of the potential bias factors, e.g. gene length, gc content, and dinucleotide frequencies, and plotted the median expression levels versus median bias factors for the five data sets in figure  <dig> and additional file  <dig>  maqc data set showed strong linear relationship between expression levels and gene length, gc content and dinucleotide frequencies that are related to gc content . moreover, the patterns from two different biological samples  were very similar. in the marioni data set, the expression levels showed negative linear correlation with gene length and ca dinucleotide frequency, and mostly quadratic patterns for the other nucleotide composition variables. again, the patterns from two different biological samples  were very similar. the mamanova data set showed similar patterns as the marioni data set, with mostly quadratic patterns and negative linear correlation between expression and gene length. the patterns for frt-seq and std-seq are different mainly in ca and ac dinucleotide frequencies. the two yeast studies showed similar linear patterns although different library preparation protocols were used. in both studies, expression level had negative correlation with gene length, at, ta, positive correlation with gc content, tg, gt, gg, gc, cc dinucleotide frequencies. in summary, there are clear non-random patterns between estimated expression levels and gene length and nucleotide composition, and the patterns were not specific to the biological samples being sequenced, which indicated that the patterns were caused by technical issues rather than biological features.

many data processing tools have been developed for rna-seq data analysis in the literature. to evaluate whether the bias pattern we observed in rna-seq data is due to certain data processing methods involved in the processing of these data, we implemented multiple processing procedures for each data set, and summarized expression levels using different "gene" unit definitions . procedure  <dig> differs from procedure  <dig> in that reads will be double counted instead of being assigned to different isoforms probabilistically for overlapping transcripts or genes. even for single isoform non-overlapping  genes, procedure  <dig> may be different from procedure  <dig> due to two features of cufflinks. first, when gene model annotation  file is provided, cufflinks only counts fragments that fall on gene model features for the "total number of fragments mapped". second, cufflinks uses each fragment's map quality to down-weight reads that were mapped to multiple genomic locations. by comparing bias patterns from these different procedures, we examined whether different mapping policies, gene model annotations and expression estimation methods have any effect on the observed bias patterns. we found that all three data processing methods and both gene level and transcript level expression estimates yielded similar patterns . however, the patterns were less obvious when we focused only on expression estimates of sino genes, probably for the reason that the proportion of sino genes is low in protein coding genes . out of  <dig>  annotated ensembl  <dig> chromosomal genes, there are  <dig>  sino genes; out of  <dig>  protein coding genes, there are only  <dig>  sino genes. since most rna-seq experiments enriched for poly+ mrnas transcribed from protein coding genes, investigation using only sino genes may lose considerable amount of information, and patterns learned from sino genes may not be applicable to general protein coding genes.

relationship between gene-level biases and base-level biases
in the previous section, we examined bias patterns between estimated expression level and nucleotide composition across genes. to examine bias patterns between base level read counts and nucleotide composition, we compared the percentage of dinucleotides at the starting position of all mapped reads from different data sets . mamanova et al. sequenced the same biological sample using two different protocols, and clearly showed protocol-specific biases. std-seq protocol was also used in data sets from marioni et al., bullard et al, and lee et al., and these data sets all showed significant over-representation of dinucleotides starting with c and g, but the extent of over-representation depended on different studies. nagalakshmi et al. used two different types of primers  in cdna synthesis but they showed similar patterns, which were different from those using std-seq protocols, indicating that choices of primers were not the main cause of the bias patterns in this study. instead, the library preparation step that is common in the nagalakshmi study but different from std-seq caused the biases, i.e. fragmentation of cdna instead of rna.

percentage was calculated by samstat  <cit> . uniquely mapped reads and multi-mapped reads were separated in the calculation but showed similar pattern. bold numbers indicates significantly over-represented dinucleotide with p-values less than or equal to 10- <dig> from a binomial test described in  <cit> .

the base-level and gene-level bias patterns from the same study  tended to have similar patterns although different biological samples or library preparation protocols were used, which indicates experiment-specific biases. in the maqc data set, both base-level and gene-level patterns indicate strong gc content related bias. however, they do not always agree well, and probably capture different characteristics of the data. for example, there are strong base-level biases for reads starting from ct and gt, but this is not reflected in the gene-level bias patterns.

generalized additive model to correct for gene-level biases
to correct for the observed gene-level biases, we calculated principal components of dinucleotide compositions and gene length, and fitted a generalized additive model of log on the eigenvectors . as shown in the bias plots , gam can effectively reduce the correlation between gene expression and gene length or nucleotide compositions. we also found that gam correction is robust to sequencing depth and corrected gene expression level estimation. we used seven lanes of maqc <dig> uhr data to perform gam correction by adding one lane at a time. the log fold change of estimated gene expression levels before and after gam correction was calculated for genes with high, medium and low expression. fractions of genes with log fold change within ± 5% of the final value were plotted . overall the correction is robust to sequencing depth, with ~80% genes showing the fold change within ± 5% of the final estimates using only one lane. moreover, genes with lower expression were slightly more sensitive to sequencing depth.

comparing rna sequencing data with other quantitative platforms
we compared the expression estimates from rna-seq data with taqman rt-pcr and quantigene platforms, which measure gene expression levels using different technologies. the purpose is two-fold. first, by comparing the patterns of expression levels across genes from different platforms, we could distinguish technical bias from biological patterns. technical bias should be specific to certain platforms, whereas biological patterns should be consistent across platforms. second, by comparing the estimated expression levels for each gene from different platforms, we could evaluate whether the gam correction is able to reduce technical biases. if the corrected expression estimates from rna-seq data are less biased, we would expect it to correlate better with other quantitative platforms.

we compared the patterns of gene expression levels in terms of gene length, gc content and dinucleotide frequencies for  <dig> and  <dig> genes measured by both taqman rt-pcr and rna-seq platforms and expressed above the detection thresholds in brain and uhr samples . similarly, we compared  <dig> and  <dig> genes that were measured by both quantigene assay and rna-seq platforms and expressed above the detection thresholds in brain and uhr samples. a linear model was built to regress expression levels  unit) on each variable , including an indicator for platforms  and an indicator for samples . then we tested whether the indicator terms affected the linear relationship between expression and each factor by t-tests and reported the p-values . we found that the linear pattern between expression and gene length together with all dinucleotide frequencies were significantly different between rna-seq and rt-pcr platforms, and pattern with gc content, aa, at, ta, tt, gg, gc, cg, cc dinucleotide frequencies were significantly different between rna-seq and quantigene platforms. on the other hand, all but one comparison between brain and uhr samples were not significantly different. the linear relationship between expression levels and gene length was significantly different between rna-seq and rt-pcr platforms, but only marginally significant between brain and uhr samples. there are fewer significant terms in rna-seq vs. quantigene platform comparison than those in the rna-seq vs. rt-pcr platform comparison. one possible reason is that there are fewer genes in the former comparison. nonetheless the significant terms were all related to gc content, consistent with the most significant biases in figure  <dig> 

to examine the relationship between expression measurements from different platforms, we performed a series of pair-wise comparisons through pearson's correlations. multiple technical replicates were averaged for each platform, and the units for expression levels were Δct for rt-pcr, log for quantigene, and log for rna-seq. we first considered  <dig> and  <dig> genes that were measured by both taqman rt-pcr and quantigene assays and expressed above the detection thresholds in brain and uhr samples respectively. the correlation was  <dig>  for brain sample, and  <dig>  for uhr sample. then we compared genes present on both taqman rt-pcr and rna-seq platforms. the correlation coefficients  were  <dig>   and  <dig>   before gam correction, and increased to  <dig>   and  <dig>   after gam correction. furthermore, when we stratified genes into three quartiles by the absolute value of log fold change between corrected and uncorrected expression levels, the relative improvement in correlation increased as correction magnitude increased . similar results were obtained when we compared genes that were present on both rna-seq and quantigene platforms . the improvement trend is consistent but less obvious in uhr sample, probably because uhr sample is a mixture of ten human tissue cell lines with heterogeneous splicing patterns. these results suggested that gam correction for rna-seq data may improve the consistency in gene expression estimates across quantitative platforms.


to investigate how many of these components are actually important in our model, we calculated the nonparametric f-statistic and corresponding p-value for each predictor  from the fitted generalized additive models for the same  <dig> examples as above . gene length and the first principal component are almost always highly significant, and additional principal components are also significant in some examples. in addition, for data sets with similar correlation structures among predictors, such as maqc brain and maqc uhr data sets, the marginal significance of each pc is different, indicating that gene length and gc content  alone may fail to capture the bias patterns in the estimated gene expression levels in some cases.

we also investigated the effect of including different number of principal components in the gam model on the cross-platform correlations in maqc <dig> data sets with rna-seq, rt-pcr and quantigene platforms. in these cases, correction using gene length and the first principal component in general shows the best performance. including more principal components has little effect on cross-platform correlations . however, we note that this may not be a general phenomenon for other data sets. as shown in table  <dig> maqc data sets have a distinct pattern that reads starting with c or g are highly enriched whereas no other dinucleotide distribution bias was detected. this is not the case in other data sets such as lee, nagalakshmi and mammanova frt-seq data sets. unfortunately due to the lack of information from "gold-standard" platforms, we cannot directly assess the improvement in accuracy in these data sets.

to explore the correction effect of using gams, we calculated the correlation between corrected gene expression levels using only length and gc, and corrected gene expression levels using length plus  <dig>   <dig>   <dig> or minimal number of principal components explaining 95% of variance . for all  <dig> data sets tested, the correlations are very high , indicating that at least for these data sets, the correction is insensitive to the number of principal components included in gam, and that their performances are similar to the correction using only gene length and gc content in gam. on the other hand, the gc bias patterns observed in the original data and corrected by gam are actually very different across  <dig> data sets . for example, the marioni data sets and mamanova data sets showed quadratic bias patterns in gc content, maqc data sets showed almost linear bias patterns in gc content, lee data sets and nagalakshmi data sets showed non-linear bias patterns in gc content; and these different forms of bias patterns can all be corrected by the gam model, indicating that gam is flexible enough to detect and correct for different bias patterns specific to each experiment. this property is particularly useful when we try to apply a general correction method to sequencing data from different experimenters or protocols that may carry different technical biases.

comparison with other methods
we compared the gam correction method with two other methods correcting for base-level nucleotide composition biases. we first implemented the random hexamer bias correction method proposed by hansen et al. using the r package genominator  <cit> . sine this method corrected read counts at each base position along the gene according to nucleotide composition at the first several nucleotides along the mapped reads, we compared it with gene expression estimated from procedure  <dig>  the corrected base level counts were summed over each gene, and divided by the sum of weights to represent gene expression levels comparable to rpkm units. from the bias plots we can see that the random hexamer bias corrected gene expression levels did not change the original levels much, and still showed the same bias patterns .

we also implemented the regression methods proposed by li et al. using the r package mseq  <cit> . since this method was designed for sino genes, and required extensive computation time, we only tested it on the yeast data set from lee et al. the most highly expressed  <dig> sino genes were used as training set and all other genes were used as testing set. forty nucleotides were trimmed from both ends of genes, and nucleotide compositions in  <dig> upstream and downstream bases around the starting position of each mapped read were included in the poisson linear model. the coefficients were larger at positions closer to the read starting position as expected, but the cross validated r <dig> was only  <dig> . based on the coefficient plot, we chose  <dig> upstream nucleotides and  <dig> downstream nucleotides to fit a mart model. the cross-validated r <dig> for mart model was  <dig> . we then obtained gene-level expression estimates by dividing the sum of read counts over the gene with the sum of mart fitted sequencing preferences at each position of the gene . similar to the random hexamer bias correction method, the mseq-corrected gene expression levels were very close to uncorrected expression levels, and yielded the same bias patterns across genes .

we further compared the reweighted expression levels with measurements from the taqman rt-pcr and quantigene platforms. we first confirmed that the gene expression levels calculated using procedure  <dig> agreed better with rt-pcr after gam correction by increasing the pearson's correlation from  <dig>  to  <dig>  for brain sample, which is consistent with the observation made from procedure  <dig>  we then compared the gene expression levels calculated using procedure  <dig> before and after the random hexamer bias correction, and calculated their correlation with rt-pcr measured gene expression. the random hexamer bias correction method didn't improve the cross-platform correlations. however, when we applied gam correction on random hexamer bias corrected expression levels, the correlation with rt-pcr data improved from  <dig>  to  <dig>  . these results suggested that the bias patterns across genes were not adequately addressed by the base-level bias correction methods, and gam correction is necessary to further remove these biases.

discussion
in this article, we examined the gene-level expression estimates from several published rna-seq data sets, and found systematic biases related to nucleotide composition and gene length. we proposed a generalized-additive-model based method to correct for these biases and achieved better cross-platform comparison results.

the major difference between our method and previous studies exploring the biases in rna-seq data is that we summarized and corrected for the biases at the gene level instead of the base level. previous studies  employed parametric or non-parametric regression techniques to relate base-level read counts to local nucleotide composition. while achieving better uniformity in read distribution within genes, these methods only corrected for gene level expression estimation to a limited extent, as shown in additional files  <dig> and  <dig>  moreover, the biases detected on gene level and base level are likely to be complementary to each other. for example, the frt-seq data from mamanova et al. showed gene-level biases that were different from standard sequencing data , whereas no base level biases in nucleotide compositions were detected in hansen et al.  <cit> . in fact, combining gam correction for gene level biases and random hexamer bias correction scheme for base level biases performed better than random hexamer bias correction alone in cross-platform comparison of gene expression measures .

during the review of our manuscript, a related correction method for rna-seq data was published  <cit> . this method was built on top of the maximum likelihood based algorithm for isoform/gene expression level estimation in cufflinks  <cit> , and modified the original likelihood function by introducing  <dig> weights parameters that measure positional biases. the estimation of the relative transcript abundance and bias parameters can be jointly estimated using an iterative coordinate ascent procedure, although in practice only one iteration was used. this method focuses on adjusting the base-level positional biases similar as  <cit> , and therefore complements our focus on gene-level bias correction. in another newly published eqtl study with rna-seq platform  <cit> , the authors observed gc bias on sequencing depth across different sequencing lanes, and proposed a direct correction of gc content by fitting a spline to the plot of log <dig> relative enrichment of exon level read counts in each gc bin against the mean gc content for the bin. the binning and curve fitting strategy is similar to our method but it is simply applied to one bias factor and does not involve principal component regression. moreover, in contrast to their usage of the log enrichment of read counts in multiple lanes as response variables, our method is able to correct for the absolute gene expression levels even when there is no technical replicates on multiple lanes.

it is well known that due to the random sampling nature of rna-seq data, length normalized gene level expressions exhibit larger sample variance for shorter genes  <cit> . since our method considered each sample separately, we have not solved the unequal variance problem, which is important for detecting differentially expressed genes between samples. moreover, the length bias we detected here is different from the bias detected by oshlack and wakefield  <cit> . we observed a general trend of lower median rpkm/fpkm for longer genes, whereas oshlack and wakefield reported lower variance of gene level read counts for longer genes. under the assumption of random sampling, the gene expression level in rpkm/fpkm unit  should be unbiased in terms of gene length, therefore our observation indicates potential deviation from random sampling model.

CONCLUSIONS
in summary, our work identified several potential biases in rna-seq data, and proposed a bias correction method that can provide a more accurate gene level expression estimate. we believe this method will help meta-analysis of rna-seq data with other quantitative platforms and alternative protocols.

competing interests
the authors declare that they have no competing interests.

authors' contributions
wz performed statistical analysis, wrote the rnaseqbias package and drafted the manuscript. lc participated in the data analysis and r package development. hz conceived of the study, designed and coordinated the study and helped to draft the manuscript. all authors read and approved the final manuscript.

supplementary material
additional file 1
summary of data processing procedures for each data set.

click here for file

 additional file 2
r package rnaseqbias developed in this study.

click here for file

 additional file 3
bias plots for marioni, mamanova, lee and nagalakshmi data sets .

click here for file

 additional file 4
bias plots for maqc data using transcript level expression summaries.

click here for file

 additional file 5
bias plots for marioni data using procedures  <dig> and  <dig> 

click here for file

 additional file 6
bias plots for sino genes in maqc data.

click here for file

 additional file 7
p-values of testing whether bias patterns are platform-specific or sample-specific.

click here for file

 additional file 8
pca plots for  <dig> data sets. the left panel shows the variance explained by each principal component. black bars are pcs included in the gam model , and gray bars are pcs not included. the right panel shows the biplot for the first two pcs. the length of each red vector represents the standard deviation of each predictor, and the angle between any two vectors represents the correlation between them. the relative orientation to x and y axis shows the relationship between individual predictors and the first two pcs. the inset table shows the non-parametric f-statistic for each predictor in the fitted gam model and the corresponding p-value.

click here for file

 additional file 9
improvement of cross-platform correlations with different number of pcs in gam. gam models using gene length only or length plus 1- <dig> pcs were fitted to correct the maqc <dig> brain and uhr rna-seq data set, and the correlations  between uncorrected/corrected seq data and rt-pcr/quantigene data were calculated.

click here for file

 additional file 10
scatter plots with different gam terms. correlations between corrected log using  and corrected log using  <dig>   <dig>   <dig>  or minimal number of pcs explaining 95% of the variance. subfigures a-h are plots for  <dig> data sets in the same order as in additional file  <dig> 

click here for file

 additional file 11
plots of the component smooth functions that make up the fitted gam objects with two predictors: gene length and gc content. the left panel shows the 1-d smooth for log gene length, and the right panel shows the 1-d smooth for gc content. the rug plot at the bottom of each panel shows the values of each predictor. the dotted lines are 2-standard errors above and below the estimated smooth . subfigures a-h are plots for  <dig> data sets in the same order as in additional file  <dig> 

click here for file

 additional file 12
bias plots for maqc data using procedure  <dig> and comparing with random hexamer bias correction method.

click here for file

 additional file 13
bias plots for sino genes in lee data using procedure  <dig> and comparing with random hexamer bias correction method and mseq method.

click here for file

 additional file 14
comparison of correlations between rt-pcr and maqc <dig> rna-seq data. gene expression levels from rt-pcr are compared with original rna-seq data , rna-seq data with random hexamer bias correction, and rna-seq data with gam correction.

click here for file

 acknowledgements
we thank the reviewers for their insightful comments. we also thank yale university biomedical high performance computing center  for providing computation resources. research was funded by in part by the national institutes of health  grants to the authors.
