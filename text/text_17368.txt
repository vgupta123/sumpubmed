BACKGROUND
metagenomics, the culture-independent isolation and characterization of dna from uncultured microorganisms  <cit> , has facilitated the analysis of the functional biodiversity harbored in the large reservoir of uncultured bacteria and archaea  <cit> . although early metagenomic studies identified individual genes or activities of interest, recent advances in genome sequencing technologies have made obtaining a complete metagenomic sequence more tractable. sequence-based approaches combined with functional expression approaches have the potential to identify novel genes important for industrial and ecological applications. sequence-based approaches have recently been applied to dna obtained from viruses  <cit> , seawater  <cit> , wastewater  <cit> , sediment  <cit> , sponges  <cit> , acid mine drainage  <cit> , marine worms  <cit> , human gut  <cit> , soil  <cit> , and decomposing whale carcasses  <cit> . the analysis used to describe these communities has primarily focused on the descriptive characterization and comparison of the relative abundance of proteins that belong to specific functional categories.

attempts to analyze metagenomic sequences have proven that a metagenomic sequence is more than just a large genome sequencing project. first, the goal of most genome sequence projects is a closed genome sequence where every nucleotide is represented by a desired number of independent sequence reads. in metagenomics, the probability of finding overlapping sequence reads is low in most environments  <cit> . the probability that overlapping sequence reads are from the same population of bacteria or archaea is even lower so that contigs that are formed are out of necessity chimeras of different genomes that may not even be from the same phylum  <cit> . second, a closed genome represents a statistical population of the genes harbored by that organism; therefore, comparing genome sequences for the presence or absence of genes is straightforward. since it is not possible to close a metagenome, every metagenomic sequence collection represents a statistical sample of the genomes in an environment. therefore, it is necessary to treat the comparison of communities as a statistical problem. third, although lab-based cultures that are sequenced do evolve, the differences between lab stocks is minimal compared to the changes faced by natural communities over short periods of time. this makes it difficult to reanalyze a community once a genome sequence has been obtained to improve annotations and understand gene expression.

five general approaches have been taken to bring statistical analysis to the analysis of metagenomic sequences. the first adapts genomics-based approaches to metagenomics by constructing and curating databases to aid in the annotation and analysis of genes and the contigs they reside on  <cit> . unfortunately, although such databases provide a critical infrastructure, given the large number of orfs that have no known function  and the paucity of contigs formed from many sequencing projects , such database searches will be of limited value for comparative metagenomics. the second approach to analyzing metagenomic sequences has been based on the comparison on the relative abundance of annotation categories within the different sequence collections and within databases of assembled genomes  <cit> ; these methods implicitly assume that the metagenomic sequences represent a statistical population and/or that the reference databases represent the normal distribution of genes in communities. a third set of approaches attempts to assign a phylogenetic origin for a sequence fragment in the absence of a phylogenetic anchor  using nucleotide frequency analysis or sequence signatures  <cit> . such methods are limited for use with most environments because of the difficulty in forming contigs that are long enough to carry out a robust analysis and assume that the contigs that form are not chimeric. a fourth approach has attempted to compare communities without an annotation. these have attempted to quantify the species richness of communities based on the distribution of sequence read depth among contigs  <cit>  and to compare the diversity of communities based on the relative frequency of different length oligonucleotides in the dna sequence pool  <cit> . finally, there have been attempts to using traditional population biology by analyzing the diversity of specific families of genes found in metagenomic collections  <cit> .

based on previous metagenomic sequencing efforts, we were interested in developing statistical tools to compare the richness, membership, and structure of the complement of orfs from multiple communities in which assembly of the entire genomes is not possible. to address this problem, we adapted a set of statistical tools designed to analyze collections of 16s rrna gene sequences to the analysis of protein coding genes  <cit> . our goal was to provide additional tools to make statistical and ecological inferences using metagenomic sequence data. instead of using a traditional pairwise dna distance matrix obtained from a sequence alignment of homologous genes as is done with 16s rrna genes, we used blast score ratios  to develop a distance matrix that represents the similarity of orfs across homologous groups  <cit> . to make comparisons among communities, we propose grouping orfs into operational protein families  which are analogous to operational taxonomic units  derived from 16s rrna gene sequences.

RESULTS
a new distance matrix
the goal of this aspect of the work was to develop a method to compare sequence alignments that circumvented the considerable computational effort required to obtain every possible global sequence alignment and pairwise distance. we used local alignments provided in blast and the resulting pairwise blast scores to generate bsrs. the bsrs approximate the fraction of identical amino acids between two peptide fragments so that a bsr value of  <dig>  between two fragments means that they are approximately 30% identical over their full length. by analogy to the analysis of 16s rrna gene sequences of uncultured bacteria where otus are developed based on a distance matrix, we propose using bsr values to define opfs. depending on the goals of the analysis an opf can be defined as necessary. for illustrative purposes and based on previous implementations of bsrs for comparative genomics applications  <cit> , unless otherwise indicated we will operationally define an opf as a collection of fragments that have a bsr greater than  <dig> .

to assess the feasibility of using peptide fragments from individual sequence reads, we identified peptide fragments from the individual sequence reads used to assemble the bacillus anthracis, str. ames genome , which contains  <dig>  orfs that were longer than  <dig> aa. from the individual sequence reads, we identified  <dig>  peptide fragments longer than  <dig> aa. the computational effort required for the pairwise alignment and distance calculation among  <dig>  orfs was prohibitive. because we expected a majority of the peptide pairs would not have significant similarity, we used blast to identify those comparisons that had significant similarity and to calculate bsrs as a surrogate for similarity or distance values . instead of generating a  <dig>  ×  <dig>  matrix with  <dig>  ×  <dig> values, we took advantage of the sparseness of the matrix to simplify the calculations and construct a set of three linked-lists in which each list contained the row, column, and bsr values of the full bsr matrix. since the bsr for a peptide fragment compared to itself is  <dig>  and the bsr for a non-significant comparison is  <dig> , the corresponding entries in the linked lists could be removed. once this was completed, there were  <dig>  ×  <dig> values, which represented a significant reduction in the memory required to store the data.

mg-dotur
to assign peptide fragments to opfs we rewrote the computer code for dotur to be compatible with sparse bsr matrices. dotur is used to assign collections of 16s rrna gene sequences and to use the resulting frequency distribution of sequences among otus to estimate richness and diversity . by analogy, mg-dotur assigns peptide fragments to opfs and estimates the richness and diversity of opfs for any desired opf definition. two classes of methods are available to estimate richness based on frequency distributions. the first uses parametric distributions such as the lognormal distribution to predict the number of unseen groups in a community  <cit> . although it is often assumed that microbial communities follow a lognormal distribution, there are no published examples in the microbial ecology literature for which the observed data support such an assumption. this is primarily due to the difficulty in obtaining a sufficient number of observations to implement these methods. an alternative approach uses non-parametric estimators that do not assume an underlying frequency distribution and are relatively easy to compute. these estimators are implemented in dotur and mg-dotur.

based on the observed frequency distribution of peptide fragments in each opf <dig> , we applied the chao <dig>  ace, and interpolated jackknife richness estimators to predict the opf <dig>  richness. the predicted opf richness was approximately three times greater than the opf richness that was observed in the assembled b. anthracis genome . when we mapped each opf from the closed genome to the opfs from the individual sequence reads we found that each opf from the closed genome was linked to an average of  <dig>   opfs from the sequence reads. further inspection showed that the multiple opfs from the sequence reads corresponded to different regions of long orfs from the closed genome sequence. similar results have been observed when attempting to estimate the number of expressed genes using expressed sequence tags  <cit> .

to overcome this problem, we developed a method of merging opfs from the sequence reads to obtain a more meaningful opf distribution. for two opfs to merge, we required that the carboxyl-terminus of at least one sequence in the first opf overlap with the amino-terminus of at least one sequence in the second opf by at least  <dig> amino acids. furthermore, we incorporated a bsr penalty so that for two opfs to merge the overlapping region had to have a bsr greater than the bsr currently being used to form clusters. we used penalties of  <dig> ,  <dig> ,  <dig> ,  <dig> , and  <dig>  . we then applied this merging scheme to the opfs from the sequence reads and calculated two types of error  <cit> . type i errors corresponded to the fraction of opfs from the closed genome that mapped to multiple opfs from the sequence reads. type ii errors corresponded to the fraction of opfs from the sequence reads that corresponded to different opfs from the closed genome . we found that as we increased the penalty, the type i error decreased and the type ii error increased. based on this analysis, we decided to implement a penalty of  <dig>  because both types of error were  <dig>  and  <dig> %, respectively. when the resulting frequency distribution was used to calculate collector's curves using the observed and predicted richness, the curves converged towards the true opf richness . this was used to further validate the choice of penalty. a limitation of this approach is that the resulting number of peptide fragments in a merged opf is a product of the length of the complete orf and the relative abundance of the orf in the metagenome. therefore, we will report opf richness from merged analysis and annotations from both merged and non-merged analyses.

comparing membership and structure using opfs
other tools have been developed to compare the membership  and structure  of microbial communities using 16s rrna gene sequences. again, by analogy we were interested in using opfs and bsrs to compare microbial communities using metagenomic sequences. sons uses the output of dotur and mg-dotur to complete its analysis and required no further modification for use with metagenomic sequences. ∫-libshuff and amova were modified to use the sparse matrix data representation used in mg-dotur. the resulting programs were designated mg-libshuff and mg-amova. to test these programs, we randomly divided the  <dig>  b. anthracis peptide fragments into two artificial communities that were each represented by  <dig>  peptide fragments.

we first applied sons to these two communities to compare the membership and structure of the artificial communities using opfs. we calculated the shared opf richness using the chao non-parametric estimator of shared richness and obtained a value of  <dig>  opfs. although this estimate of shared richness is lower than 95% confidence interval observed for the total collection of peptide fragments using the chao <dig>  ace, or jackknife estimators, the shard chao estimator was still increasing with additional sampling . this indicates that if sequencing had continued the estimate of shared richness would have probably overlapped eventually. the abundance-based jaccard  estimate of similarity was  <dig> , which predicted that all of the peptide fragments belonged to shared opfs <dig> . yue and clayton's measure of community overlap, θ, was  <dig> , which indicated that the distribution of peptide fragments among opfs was the same in both artificial communities. these results indicate that sons is amenable to analyzing opfs to detect similarity between the memberships and structures of different communities.

an alternative approach to comparing community structures is to perform hypothesis tests. amova uses an analysis of variance -type framework to test the hypothesis that the difference in genetic diversity between two or more communities is not significantly different than the diversity within each community. we implemented this analysis in a program designated mg-amova to perform a single-classification analysis. our comparison of two randomly generated b. anthracis peptide fragment pseudo-communities revealed that the observed differences between the two pseudo-communities were not statistically significant . next we modified the program ∫-libshuff to create mg-libshuff to test the hypothesis that two communities have the same structures. as expected, the differences in structure between the two pseudo-communities were not statistically significant . each of these comparisons indicate that we can make statistical comparisons between the membership and structure of microbial communities using peptide fragments identified in single sequence reads from metagenomic data.

acid mine drainage
tyson et al.  <cit>  used metagenomic sequencing to analyze a biofilm growing in acid mine drainage  that had a ph below  <dig> . they obtained  <dig> archaeal and bacterial 16s rrna gene sequences and  <dig>  random paired sequence reads, which represented  <dig>  gbp of dna. we used dotur to assign 16s rrna gene sequences to nine otus and predicted there were an additional three otus  that were not observed . the most abundant otu was similar to leptospirillum ferriphilum  16s rrna gene sequences.

next, we used mg-dotur to assign  <dig>  peptide fragments to  <dig>  merged opfs. the dominant merged opf  did not have a homolog in genbank and the next most abundant merged opfs' were most similar to a conserved hypothetical protein from leptospirillum sp. group ii uba  and a transposase . the dominant non-merged opf did not have a homolog in genbank  and the next most abundant opfs were most similar to an hnh nuclease  and a mutator-type transposase . the chao <dig> richness estimator predicted that there were a minimum of  <dig>  merged opfs <dig>  in the community . considering the lack of a known function for two of the most abundant opfs in the amd community, this analysis shows the importance of including such sequences in metagenomic sequence analyses and may indicate that subsequent analysis of this group of sequences would reveal important physiological information about the community.

soil
tringe et al.  <cit>  used minnesotan farm soil to build libraries and sequence  <dig>  bacterial 16s rrna gene fragments and  <dig>  random dna fragments, representing  <dig> gbp of dna. we previously showed that the otu richness was approximately  <dig>   <cit> . the three most abundant otus were representatives of the chloroflexi.

using mg-dotur to analyze the random metagenomic sequence reads, the  <dig>  peptide fragments clustered into  <dig>  merged opfs. the members of the dominant merged opf had similarity to a putative two-component response regulator . the next most abundant merged opfs had similarity to a histidine kinase  and a serine/threonine protein kinase . the three most abundant non-merged opfs in the soil community had homology to a putative response regulator , a padr-like transcriptional regulator , and a cu2+-transporting atpase . because of the considerable diversity in the soil sample, an insufficient number of peptide fragments were sampled to obtain a reliable opf richness estimate; however, using the chao <dig> richness estimator we predicted that the opf richness was at least  <dig>  . although considerable additional sequencing effort is required to obtain a reliable estimate of opf richness, it is interesting that in spite of the relatively large otu and opfs richness, it was possible to assign a large number of peptide fragments to the same opf.

whalebone communities
tringe et al.  <cit>  compared three bacterial communities growing on the bones of two whales  at the bottom of the pacific ocean using 16s rrna and metagenomic sequence analysis. based on 16s rrna sequence data, the three communities designated agzo , ahaa , and ahai  had a chao1-estimated otu richness of at least  <dig> ,  <dig> , and  <dig> . the most abundant otu <dig>  from each of the three communities affiliated with members of the arcobacter sp. , bacteroidetes , and flavobacteriales , respectively. we estimated that each of the three communities shared between  <dig> and  <dig> otus <dig>  with any of the other communities. the lack of conservation of membership between the three communities resulted in low jabund coefficients , θ values , and statistically significant p values when comparing the communities using amova and ∫-libshuff . although the three communities each came from similar environments, the taxonomic membership and structure of the three communities were considerably different.

we applied the newly developed statistical tools to the metagenomic sequences of the three communities to assess their genetic and functional similarities. the three communities, agzo, ahaa, and ahai, yielded approximately  <dig>  ,  <dig>  , and  <dig>   sequence reads and  <dig> ,  <dig> , and  <dig>  peptide fragments, which were over  <dig> aa long, respectively. the dominant merged opfs in each community were similar to a histidine kinase  and an abc transporter . the most abundant non-merged opf found in each community was homologous to a conserved hypothetical protein , recr , another conserved hypothetical protein , and a putative transposase . the chao <dig> opf richness estimates for each of the communities continued to increase with additional sampling, indicating that the communities had a minimum opf richness of  <dig>  ,  <dig>  , and  <dig>   for the agzo, ahaa, and ahai communities, respectively.

although there was an insufficient number of peptide fragments to obtain a reliable estimate of the fraction of opf membership that was shared between any two of the three communities, we estimated that they shared at least between  <dig> and 20% of their opf membership . the "core" whalebone opf membership that was shared among the three whalebone communities had a richness of at least  <dig>  opfs ;  <dig>  of these were actually observed in the sequence collection. the most commonly shared opfs among the three communities represented a variety of activities including metal transport, sensors, and housekeeping functions .

comparison of the community structures using the peptide fragments using mg-libshuff  and mg-amova  found that the structures of these three communities were significantly different. using opfs, θ varied between  <dig>  and  <dig>  indicating that there was some similarity in community structure. the ability to quantify and assess the differences in communities without exhaustive sampling of the three whalebone communities indicates the importance of applying statistical methods to metagenomic sequence data. such analyses make comparative metagenomics amenable to ecologically-based hypothesis testing.

comparison of the three environments
to assess the relative similarity of otu <dig>  membership between environments, we used dotur to cluster the  <dig>  16s rrna gene fragments from the amd , soil , and whalebone communities . no otus were shared between any two of the three communities; however, additional sampling may have identified otus that were shared between environments.

we compared the relative similarity of opf membership between environments by clustering the  <dig> -peptide fragments from the amd , soil , and whalebone communities  using mg-dotur and then we estimated the membership and structure overlap among the three communities . measuring the overlap of opfs measurement among the three communities resulted in the estimate that more than  <dig> opfs were shared among the five communities; this represents less than  <dig> % of the total opf richness found in the five communities. of this pool,  <dig> merged opfs and were actually observed with functions including metal transport, housekeeping, and various dehydrogenase activities . applications of the statistical tools to these types of comparisons will enable researchers to investigate the problem of biogeography using genome-based methods.

for comparison, we compared the complement of orfs from the fully sequenced bacillus anthracis str. 'ames ancestor' , bacillus cereus atcc  <dig> , escherichia coli k <dig> , methanosarcina acetivorans c2a , methanosarcina barkeri str. fusaro  genomes. we used mg-dotur to assign orfs to opfs and then we used sons to compare the opf <dig>  overlap between these genomes, which we selected for their phylogenetic similarity and breadth. as predicted based on current understanding of phylogenetics, the more closely related organisms had the greatest opf <dig>  overlap. the comparison between b. anthracis and b. cereus yielded jclas and θ values of  <dig>  and  <dig> , e. coli and y. pestis yielded values of  <dig>  and  <dig> , and m. acetivorans and m. barkeri yielded values of  <dig>  and  <dig> . all of the other pairwise comparisons yielded values below  <dig>  for both parameters. this analysis suggests that the comparisons between the opfs <dig>  identified in the metagenomic sequences represent the level of differences expected between phylogenetically disparate groups of bacteria. furthermore, analyses using completed genome sequences may enable investigators to define the size and boundaries of so-called "pan-genomes."

CONCLUSIONS
we present a statistical toolbox to estimate the functional richness and overlap among communities based on peptide fragments deduced from dna sequence data. these statistical approaches are necessary, in part, because the immense genomic diversity contained in most communities precludes the formation of contigs. there is also considerable question regarding the robustness of sequence assembly  <cit> . although understanding these complex communities is tantalizing, it may prove useful to identify more communities similar to the amd and whalebone communities that have a relatively low diversity to develop and test tools that can then be applied to soil. as sequencing technologies improve, the feasibility of obtaining nearly complete sequence coverage of the more diverse communities will improve. the rapid advances in sequencing short dna fragments  in a highly parallelized manner  <cit>  presents many new opportunities, but the method may not be amenable to metagenomic sequencing because the short sequence reads produce peptide fragments less than  <dig> aa long, which could make a meaningful orf identification and analysis of functional diversity difficult.

innovative methods have been developed to compare collections of 16s rrna sequences, and analogous new methods are needed for comparing metagenomic sequences. for example, improving our ability to estimate and interpret the biological meaning of opf richness will be helpful for describing the relative functional capacity of a community. our analysis does not address the possibility that distant opfs might serve the same biological function and that members of the same opf might have different functions. therefore, further work is needed to unify studies of functionally active clones into a statistical framework. for example, comparing the collection of genes conferring antibiotic resistance found in multiple environments would enable us to understand better the diversity of these genes as well as their biogeography.

our analysis moves beyond previous attempts to compare microbial communities at the genomic level by not being dependent upon reference databases and introducing statistical rigor to the description and comparison of microbial communities. for example, previous analyses formed clusters based on similarity to reference databases and excluded those peptide fragments with no significant matches, which limited the scope of the analysis. here, we formed opfs using the observed data, in essence allowing the data to "speak for themselves", which allowed for a comprehensive comparison of the data. previous analyses also based the level of similarity between communities on the observed peptide fragments as though they represented a statistical population. here, we treated the data as a statistical sample and employed statistical tools to estimate the level of similarity between community membership and structure. these tools enable a quantitative, comprehensive, and statistically robust analysis of microbial communities at the genomic level.

shotgun sequencing of metagenomic communities is becoming increasingly popular and routine. the results of these efforts will provide more insight if they are wrapped in robust ecological and statistical frameworks. tools are needed to advance data analysis beyond the frequency of different cogs or kegg categories that are found within a community. this study is a step in building such a framework to compare microbial communities functionally at the genomic level. in addition to estimating community relatedness based on metagenomic data, our approach accounts for present but unsampled peptide fragments, is independent of a subjective annotation process, and includes peptide fragments with no known function.

