BACKGROUND
when comparing structures of related proteins with different amino-acid sequences it is necessary to first perform a structural alignment, i.e. to define an equivalence map between the residues in the different structures based on their relative position in space. once structures have been successfully aligned in three dimensions, similarities and differences can be studied in order to understand function and behaviour of the molecules under consideration.

it has been demonstrated that the problem of defining an equivalence map for residues in protein structures has no unique optimal solution  <cit>  and that it remains computationally hard  <cit>  even when it is described by a well defined optimization function. nevertheless, many tools have been created for the pairwise and the multiple alignment of protein structures using different heuristics to produce results on acceptable time-scales .

alignment methods can be classified based on whether the two structures to be aligned are considered as rigid bodies or whether internal flexibility between domains or subdomains is accommodated in the alignment. methods belonging to the group of 'rigid aligners' are ssap  <cit> , ce  <cit> , prosup  <cit> , kenobi  <cit> , mammoth  <cit> , topofit  <cit> , tm-align  <cit> , sabertooth  <cit>  and tetrada  <cit> . dali  <cit>  allows for limited molecular flexibility through the use of an elasticity term in its similarity function, but nevertheless is considered to be a rigid aligner  <cit> . the group of rigid aligners also includes algorithms like vast  <cit>  and ssm  <cit>  that, in order to produce alignments rapidly, first identify correspondences between secondary structure elements  and then extend the alignment to the residue level. several rigid aligners have been extended for addressing the multiple alignment problem .

as it is well known, protein molecules are flexible entities with internal movements ranging from the displacement of individual atoms to movements of entire domains or subdomains  <cit> . large-scale movements of groups of atoms complicate the correct identification of structural equivalences between related proteins when rigid structural aligners are used.

the molecular chaperon groel is an interesting case of protein molecules exhibiting pronounced molecular flexibility between structurally conserved domains. by comparison of crystal structures of different functional states, the groel molecule can be divided into three domains  separated by hinge regions  <cit> . due to the large relative motion of the domains between different functional states, rigid body aligners will typically fail to align crystal structures of groel with different sequences in different conformational states.

in recent years, tools for the flexible alignment of protein structures have been introduced. these tools find an equivalence map between the residues of two molecular structures even when substantial intramolecular movements occur around molecular hinges. the regions between hinge points are commonly considered as rigid bodies and the alignment is usually optimized to minimize the number of hinges. the group of 'flexible aligners' includes, flexprot  <cit>  and fatcat  <cit>  and their corresponding extensions to multiple alignment multiprot  <cit>  and posa  <cit> .

however, in alignments of molecules such as groel where the polypeptide chain folds back onto itself  and thereby creates structural domains in which parts of the polypeptide chain that are distant in sequence space engage into stable contact in three-dimensional space , many of these aligners meet difficulties in recognizing the spatial continuity as will be illustrated below.

here we introduce a new algorithm for the flexible structural alignment of proteins called rapido . rapido is capable of aligning related protein molecules in the presence of large conformational differences while at the same time groups of equivalent parts of the polypeptide that are distant in sequence but nevertheless form spatially continuous domains are identified correctly as such. as a first step rapido creates an equivalence map between the two structures by taking into account flexibility, with a procedure that is similar to the one used by fatcat  <cit> . this step is followed by the application of a genetic algorithm  <cit>  for the identification of structurally conserved regions that can be continuous in space but not in sequence . the result of the procedure is a description of a protein in terms of structurally conserved regions connected by localized hinges or by flexible linker regions. we have chosen the standard parameter settings for rapido such that more emphasis is placed on the geometric similarity of the structurally conserved regions  than on their size . with this choice, the resulting structurally conserved regions will have a high level of similarity allowing their usage for robust coordinate-based structure superpositions.

in the following, we describe the algorithm used and the application of rapido to a number of test cases. for all test cases, rapido produces results that are in agreement with previous analyses. regions identified as structurally conserved furnish subsets of atoms whose relative positions between different structures are very well maintained. superpositions based on these subsets of atoms are particularly revealing when molecular flexibility is studied.

RESULTS
algorithm
the alignment algorithm consists of four steps:

 <dig>  search of short structurally similar fragments in pairs of structures, so called matching fragment pairs 

 <dig>  chaining of the mfps through a graph-based algorithm

 <dig>  refinement of the alignment

 <dig>  identification of rigid bodies

in the remainder of this section we will refer to two structures being compared as structures a and b. the i-th residue in structure x  is represented by the coordinates of its cα atom and will be indicated by xi .

finding matching fragments
we define a fragment as an ungapped stretch of residues and a matching fragments pair  as a pair of structurally similar fragments of the same length in two structures being compared. the search for mfps is in fact implemented in a number of alignment tools as the initial step  <cit>  because it significantly reduces the complexity of the search space for the alignment. pairs of similar fragments named matching fragment pairs  here, have been named aligned fragment pairs  in other publications  <cit> . in the context of the rapido aligner, we prefer to use the notation of matching fragment pairs in order to clarify that in a later stage of the alignment algorithm, a subset of the matching fragment pairs forming the initial set is selected to assemble the actual alignment, and the selected mfps thus become aligned fragment pairs.

while many algorithms use the rmsd to measure the similarity between two fragments  <cit> , we use an alternative measure, the sum of the absolute values of the elements of the difference distance matrix between the cα-atoms of the two fragments .

at first an exhaustive search for mfps of length ml  is performed, followed by a clustering step in which overlapping mfps are joined to form longer ones.

chaining matching fragment pairs and refining the alignment
the mfps identified in the first step constitute a set of potential building blocks for the final alignment from which, in the second step, a subset of mfps representing a structural alignment is assembled. this is done by casting the problem into a graph representation to which a standard algorithm for identification of the longest path is applied. the mfps are represented as vertices of a graph and two mfps  are connected by an edge if they are topologically ordered, i.e. if they are composed of two pairs of fragments that appear in the same order in the two residue sequences. every path in the graph represents a possible alignment and by choosing an appropriate weight function for the edges, the problem of finding the best alignment is translated into the problem of identifying the longest path on a graph. we solve this problem by applying a dynamic programming algorithm for the identification of the longest path. the alignment obtained in this way is a preliminary alignment that is then refined  resulting in the raw alignment.

identification of rigid bodies and flexible superposition
once the raw alignment has been calculated, the algorithm performs a search for structurally conserved regions. structurally conserved regions relate to conformationally invariant regions detected in different conformations of the same molecule as described in  <cit> . conformationally invariant regions can be defined as subsets of equivalent atoms whose interatomic distances are identical within error between the different conformations of the same molecule  <cit> . in the comparison of different molecules, the concept can be generalized by considering subsets of aligned residues for which distances between cα-atoms are identical within a tolerance as structurally conserved regions. these subsets can be identified using a genetic algorithm operating on scaled difference distance matrices  <cit> . in our previous work the elements of the difference distance matrix were scaled by propagated coordinate errors resulting in error-scaled difference distance matrices  <cit> . the parameters necessary for the estimation of the coordinate errors were extracted automatically from the pdb files and if necessary corrected manually. this approach is not applicable when very many pdb-files are being investigated in the context of searching for related structures in large data bases as the values extracted can be unreliable mostly caused by human errors made when the parameters where entered in the first place. for the purpose of structural alignment, we therefore use a simplified approach in which the estimate for the coordinate error of an atom i with a b-value of bi is replaced by an analogous quantity σ˜i calculated as follows

  σ˜i=k⋅η, 

where the constants k and η have been empirically optimized to  <dig>  Å and 2/ <dig>  σ˜i can then be propagated into a scaling-factor for difference distance matrix elements in a manner similar to the previous treatment.

the algorithm searches iteratively for structurally conserved regions in analogy to the approach presented in  <cit> ). aligned residues that cannot be assigned to structurally conserved regions are marked as flexible.

to characterize the agreement between two structures after the equivalent residues have been divided into structurally conserved and flexible regions, separate least-square superpositions are performed for the different structurally conserved regions.

based on this superposition allowing flexibility between conserved parts of a three-dimensional structure, we define the 'flexible rmsd'  as the standard rmsd calculated for all pairs of equivalent cα-atoms after separate least-squares superposition for the different structurally conserved regions.

testing
in order to assess the functionality of the method, we applied it to various test cases. here, we describe the analysis of two structures of different topologies with known hinge-motions  and we compare the results of rapido with those obtained by fatcat  <cit>  and flexprot  <cit> . second, we compare the results obtained with rapido with those given by dali for  <dig> pairwise alignments between  <dig> crystal structures of protein kinases from human.

ran
ran is a small gtpase belonging to the ras superfamily that plays an important role in several nuclear functions, including nucleocytoplasmic transport, cell-cycle progression and nuclear envelope assembly  <cit> . here we compare two structures of ran proteins from two different organisms: the first one is the structure of a q69l mutant of ran from dog with a bound gdp molecule ; the second structure corresponds to ran from human in complex with human ranbp <dig> and a non-hydrolysable gtp analogue .

the rapido alignment shows that major parts of the two structures are very similar.  <dig> residues are aligned,  <dig> of which are assigned to two rigid bodies. the first rigid body covers more than 70%  of the entire protein, can be superposed with an rmsd of  <dig>  Å  and corresponds to the main body of the protein. two fragments in this region are either not aligned or aligned but marked as flexible. they correspond to the well-known switch i and switch ii regions, which exhibit different conformations depending on the type of bound nucleotide and regulate the interactions of the protein with nuclear trafficking components  <cit> . the c-terminal regions of the two structures have been aligned although they are located in very different positions with respect to the main body of the protein in the two structures. this region is composed of an unstructured loop followed by a helix that is known to assume a different conformation depending to the gtp/gdp-binding state of the protein  <cit> . the c-terminal helix is attached to the main body of the protein in the ran*gdp complex while in the ran*gppnhp complex, it interacts with a groove on the surface of the ranbd1-domain approximately  <dig> Å distant from the ran main body. while the helix is recognized as a second rigid body, the part of ran connecting its main body with the c-terminal helix in different conformations is marked as a flexible region.

the alignments between the two structures as produced by fatcat and flexprot are slightly longer . the separation between the two rigid bodies is similar in the three alignments but the rmsd for the superposition of the single rigid regions is higher in fatcat and flexprot alignments than in the rapido alignment. this is due to the fact that in these two aligners all aligned residues are used for the superposition while rapido distinguishes between structurally conserved and flexible aligned residues and uses only the residues in structurally conserved regions to perform the superposition. in fact, in the fatcat and flexprot align fragments the switch i and ii loops are attributed to the first equivalent region yielding an rmsd for the superposition of this first rigid part of  <dig>  Å for fatcat and  <dig>  Å for flexprot. the unstructured loop connecting the main body and the c-terminal helix is partly assigned to the first equivalent region and partly to the second adding to the increased rmsd-values for the respective superpositions.

although, for this case, the alignments are mostly equivalent, the one provided by rapido highlights the different conformations of three important functional elements corresponding to the switch i and ii loops and to the c-terminal loop and produces an accurate superposition of the two structures in which these differences can be clearly analyzed.

groel
groel is a bacterial chaperonin that, together with its co-chaperonin groes forms a system helping newly synthesized polypeptides to reach their native state in the crowded cellular environment. groel consists of  <dig> identical subunits that are assembled as two heptameric rings stacked back to back, forming a cavity in the centre in which a newly formed polypeptide can find a protected environment for refolding  <cit> . each subunit corresponds to a single protein molecule with three domains called the equatorial, apical and hinge domain . during its activity, the groel complex undergoes dramatic conformational changes correlated with different relative arrangements of the three domains in each subunit. here we align the structure of one groel subunit from escherichia coli  with one from thermus termophilus in complex with adp .

the structural alignment produced by rapido covers 98% of the molecule , with a flexible rmsd of  <dig>  Å. four structurally conserved regions are identified  corresponding to the three canonical domains of the groel subunit plus the stem loop in the equatorial domain comprising approximately  <dig> residues. the three structurally conserved regions are in different relative positions with respect to each other in the two structures as highlighted by the rmsd of  <dig>  Å for the rigid superposition. however, by examining the superposition of the structurally conserved regions separately, the structural conservation of major parts of groel can be well appreciated both from the rmsds ranging between  <dig>  and  <dig>  Å and the actual superposition . in addition to the three large canonical domains, the so-called stem loop in the equatorial domain is found to constitute a small structurally conserved region assuming different orientations in the two structures. this dependence of the positions of the stem loop on the functional state had already been observed by xu et al.  <cit> .

the alignment produced by fatcat has approximately the same length  and a flexible rmsd of  <dig>  Å. two hinges are identified and the structure is divided into the three regions shown in figure 3d. while the apical domain is identified by both rapido and fatcat as an equivalent region, the equivalent regions for the other two domains display marked differences. the hinge domain is, in the fatcat alignment, joined to the equatorial domain and the resulting superposition is thus an average between the superposition of the two single subunits, leading to a higher value for the rmsd. due to the sequential constraint imposed by fatcat , the block corresponding to the equatorial-hinge domain is split into two fragments corresponding to the n- and c-terminal parts. the stem loop is in the fatcat alignment included in the first rigid region.

flexprot creates an alignment of  <dig> residues with a flexible rmsd of  <dig>  Å. three hinge-points dividing the structure in four fragments are identified. as in the fatcat alignment, the apical domain is kept separate from the rest of the structure. even if the c-terminal parts of the hinge and equatorial domains are separated by a hinge point, their n-terminal counterparts are kept together including the stem loop. in general, the alignments produced by fatcat and flexprot tend to underestimate the number of hinges for this pair of structures and cannot be used to highlight the difference between the equatorial and hinge domains, nor the different conformation of the stem loop.

a correct delineation of the domains is of particular interest in this case. in fact, the identified domains can be used as rigid bodies for the interpretation of low-resolution electron density maps for groel in different functional states as determined by electron microscopy. in this way, they allow to derive conclusions at the atomic level from lower resolution data .

human kinase structures
protein kinases are multi-domain proteins catalyzing the phosphorylation of proteins and play important roles in controlling many cellular processes . the protein kinase catalytic domain consists of two lobes, a small n-terminal lobe and a large c-terminal lobe connected by a hinge region and is often augmented by other domains that serve in regulation of the kinase activity. prominent examples of such domains are the sh <dig> and sh <dig> domains present in protein kinases such as src hck kinase  <cit>  and bcr-abl kinase  <cit> . in protein kinases, the relative positions and orientations of the different domains are very variable and depend on many factors such as the binding of ligands in the active site and/or the presence of regulating factors.

we used rapido to perform an all-against-all alignment for  <dig> structures of human protein kinases . for comparison, for every pair of structures, an alignment was also determined using dalilite ver.  <dig> . <dig> .

alignments produced by rapido and dali are compared in figure  <dig> and summarized in additional file  <dig>  in terms of overall length, the majority of the alignments are comparable. however, for some cases, the rapido alignments are substantially longer than the dali alignments .

three of these cases  correspond to alignments between the structures of hck from human , c-src from human , csk from rat  and c-abl from mouse . in these four structures, the kinase domain was crystallized in the presence of sh <dig> and sh <dig> domains. depending on the functional state of the kinase, the sh <dig> and sh <dig> domains can be in substantially different positions with respect to the kinase domain. such different positions can cause rigid aligners not to recognize all domains as similar. for the case of the alignments between hck and csk, and between c-src and csk , dali aligns only  <dig> and  <dig> residues respectively with the aligned residues being located in the protein kinase domain and in the sh <dig> domain. the sh <dig> domain is not included in the alignment. for the alignment between csk and c-abl  dali aligns only the protein kinase domain. the alignment produced by rapido in all three cases is longer  and comprises the kinase domain as well as the sh <dig> and sh <dig> domains .

to illustrate different positions of domains in protein kinase structures, figure  <dig> shows the alignment between the structures of hck  and csk . although the positions and orientations of the sh <dig> and sh <dig> domains with respect to the protein kinase domain are substantially different in the two structures , rapido manages to align the two structures for almost their entire length identifying three separate structurally conserved regions . the largest structurally conserved region corresponds to the conserved core of the protein kinase domain, while the two smaller structurally conserved regions are the sh <dig> and the sh <dig> domain. superposition on the conserved part of the protein kinase domain clearly reveals the different positions and orientations of the sh <dig> and sh <dig> regulatory domains with respect to the catalytic domain . by superposing the three regions separately  the structural conservation of the different domains in the two protein structures becomes clear and a flexible rmsdf of  <dig>  Å on  <dig> residues indicates the close relation between equivalent domains in different protein.

other cases for which the rapido alignment assigns more equivalent atoms than the dali alignment concern alignments of structures with large differences in the opening angles measured between the n- and the c-terminal lobe of the kinase domain . for the alignment between the structures of the protein kinase domains of cdk <dig> , mapk p <dig> , src , igf <dig> receptor , egfr , hgfr  and jak <dig> , the algorithm implemented in dali can cope with many cases of different relative domain orientation. however for the cases marked in figure  <dig>  the residues in the n-terminal domain are not aligned due to the large differences in opening angle between the lobes. in one of these cases , parts of the small lobe are in fact included in the alignment but at the cost of a very large rmsd between the equivalent atoms . in all these cases, rapido correctly determines the equivalences between atoms both for the c- and the n-terminal lobe, independently of their relative positions.

there are cases where the 'rigid rmsds' measured for the superposition based on all atoms aligned by rapido is substantially higher than the rigid rmsd for the corresponding dali alignments although the alignments are of comparable length . these are cases where taking into account flexibility in the rapido algorithm results in an alignment including small fragments that are locally very similar but structurally not equivalent when their surrounding environment is considered. a typical situation of this kind is the erroneous alignment of periodical structural elements such as α-helices or β-strands with a shift in register. such fragments are included in an alignment because they exhibit high local similarity and their different positions with respect to neighbouring structural elements is assumed to be due to conformational change. although for the majority of cases, these situations are remedied, it is generally not possible to avoid them without an unacceptable loss in sensitivity. however, such incorrectly aligned fragments will not be included into structurally conserved regions as their positions in different structures are inconsistent and therefore such fragments will be marked as aligned but flexible – this is the reason for the number of residues assigned to rigid bodies by rapido being usually smaller than the number of residues aligned by dali . when the flexible rmsd is calculated for all atoms assigned to structurally conserved regions , it is substantially lower than the standard rmsd calculated for the corresponding dali alignments  thus indicating the presence of similarities more clearly.

finally, in some cases the alignment produced by dali is longer than the one produced by rapido . however, careful analysis reveals that in these cases, the dali-alignments comprise some small fragments that are locally similar but when put in the context of their structural neighbours should actually not be considered as equivalent. the presence of such inconsistencies is also reflected in the higher values for the rigid rmsd when compared to the rapido alignments .

implementation
the algorithm has been implemented in c++. for academic use, executables for various platforms can be obtained from the corresponding author upon request. a web server for aligning structures using the rapido-algorithm is available at .

typical execution times with the inclusion of the pre-processing step  range from  <dig>  sec to  <dig>  s for pairs of structures between  <dig> and  <dig> residues. without pre-processing, execution time ranges between  <dig>  and  <dig> s for the same structures .

on output, the program generates different files. a textual representation of the alignment is generated in an html file. different types of superpositions are available: rigid superposition on all aligned atoms, superpositions on individual rigid bodies and flexible superposition. the latter is obtained by subdividing the structures into pieces centred on the rigid bodies identified in the alignment procedure. the parts of the structures falling between the boundaries of two rigid bodies are moved together with the rigid body closest in sequence during the superposition.

the superposed structures with their modified coordinates are stored as pdb files. pymol- and rasmol-scripts for displaying the superposed structures are generated by the program. all output information is consistently color-coded based on the rigid body assignments so that conformationally invariant parts can be easily inspected.

CONCLUSIONS
in this paper, we have introduced a new method named rapido for the alignment of proteins in the presence of conformational changes. aligned residues are grouped into subsets that can be considered as rigid domains with respect to the structures being compared; aligned residues not assigned to a rigid domain are considered flexible.

when applied to structures with known hinge motions, rapido produces results that are consistent with manual analyses presented in the literature. by using a genetic algorithm operating on scaled difference distance matrices  <cit> , structurally conserved regions are assembled consistently even when composed of fragments that are not continuous with respect to the polypeptide chain.

with standard settings, rapido identifies subsets of residues whose cα-atoms can be superimposed with rmsds of typically less than  <dig> Å for structurally conserved regions. given the tight conditions in terms of similarity, the individual structurally conserved regions are generally smaller than those obtained by other alignment algorithms. however, as other regions that are in different relative positions in the structures under comparison will be aligned with high accuracy as part of different rigid bodies, the overall length of the combined alignment taking flexibility into account will be increased in many cases.

in the context of structure comparison and analysis, superpositions of structures based on atoms located in rigid domains can highlight conformational differences that, when superpositions are based on atoms sets accidentally containing flexible regions, can be difficult to identify.

the application of rapido to a dataset of kinase structures showed how allowing for flexibility can help to detect similarities that are not found by rigid aligners.

to evaluate the limits of rapido, we have applied the algorithm to ten 'difficult cases' of low sequence and structural similarity from fischer's  <cit>  dataset for benchmarking fold-recognition methods. the results obtained  indicate that for distantly related structures rapido alignments are generally shorter and exhibit larger rmsds than alignments produced by other algorithms. rapido should therefore be used preferentially for cases were closely related structures are sought for.

a definite advantage of rapido is the short time required to calculate an alignment. e.g., a total of  <dig> alignments on a set of  <dig> kinase structures was completed by rapido in  <dig> minutes. this allows applying the method presented to problems of substantial size such as querying a large set of structures for similarities with a structure of interest or all-against-all alignments of entries in structural databases.

