BACKGROUND
the construction of multiple sequence alignments  from individual sequences is fundamental to nearly all aspects of post-genomic biological research. in addition to the role these alignments play in progressing our understanding of the evolution and diversity of life, they also provide a platform from which algorithms that predict protein structure and function can be based. given their pivotal role, the development of improved msa algorithms and matrices of sequence evolution has been an active area of research for more than 20 years. the result of this research has been the production of many different msa methods whose performances on diverse data types can vary considerably .

the rationale for the continued improvement of alignment methods is that reduction in error in multiple sequence alignment will thus lead to reduction in error in all subsequent downstream bioinformatic analysis. for example, in phylogenetic analysis it has been demonstrated that alignment error leads to tree inference error regardless of the inference method used downstream of alignment construction  <cit> . in addition to reducing error by improving alignment accuracy, independent methods have been developed to identify and discard alignment data which may contain errors. as information gaps are a major source of alignment error a common approach adopted in phylogenetic analysis is to discard information when it exceeds a threshold value of gap-characters. popular methods such as gblocks  <cit>  have been developed to automate this error reduction process and thereby reduce the amount of possibly erroneous data in msas. these strategies are hard-lined with regard to gap characters and hence even correctly aligned insertion and deletion events can be discarded. due to the high occurrence of insertions and deletions in real biological sequence data,  the danger of gap parsing is that one can reduce the usable phylogenetic information to a level which can be insufficient to facilitate a robust resolution of phylogenetic relationships. moreover, some phylogenetic inference methods ignore or misinterpret gaps as additional character states which can lead to errors in phylogenetic inference. as an alternative strategy to discarding gap-rich data methods such as prank  <cit>  have been developed which incorporate the phylogenetic implications of gaps and treat insertions and deletions as separate evolutionary events.

it has been demonstrated that for some msas, different methods correctly align different regions whilst no current method correctly aligns the entire sequence  <cit> . this work showed that it is possible to improve the accuracy of msas by creating consensus msas based on multiple independent msas of the same sequence  <cit> . m-coffee is such a meta-method which uses msas generated by individual msa methods to generate consensus alignments that are more accurate, on average, than any of the individual alignment methods used  <cit> .

here, we provide a novel algorithm called mergealign that uses a dynamic programming approach to efficiently construct consensus msas from any number of independent alignments of the same sets of sequences. to generate input msas for this method we use a single alignment methodology and multiple different matrices of amino acid substitution. we use standard alignment benchmark tests to show that the consensus alignments produced in this way are more accurate than those produced using any individual matrix of amino acid substitution. we further show that our method is suitable for combining alignments generated using different methodologies. creating consensus alignments from large numbers of constituent alignments allows us to assign a score to each column in the final msa. we show that the mergealign column score is related to alignment error rate and hence provide a novel method for data selection based on expected alignment error rate. in addition to improving performance on msa benchmarks we demonstrate that mergealign alignments improve performance of downstream phylogenetic analysis. the mergealign algorithm is provided as additional file  <dig> and is available at http://www.mergealign.com.

RESULTS
a novel method for constructing the consensus of multiple sequence alignments
we developed a novel method for constructing consensus multiple sequence alignments  from any number of input multiple sequence alignments. in brief, we create a weighted directed acyclic graph that represents each of the constituent msas . in this graph, each node represents a column found in at least one of the constituent msas and each edge represents the transition between two columns. the weight of each edge is equal to the number of msas that contain that transition. a dynamic programming approach is then utilised to find the path through the graph that maximises the mean weight of the edges traversed . this path is converted into a consensus msa and the edge weights used to score each column.

multiple substitution matrices achieve near equivalent performance on alignment benchmarks
to generate a set of input alignments for use for consensus msa construction we chose to adopt a novel approach which involves creating multiple msa using different matrices of amino acid substitution. we first assayed the msa performance of a set of  <dig> previously characterised amino acid substitution matrices to identify how each substitution matrix performed on benchmark msas. the mafft  <cit>  msa method was used with the fft-ns- <dig> strategy to align each of a randomly selected set of  <dig> benchmark sequences , using each amino acid substitution matrix. the f-score for each alignment was determined by comparison of the inferred alignment to the benchmark msa, which is assumed for this purpose to represent the true alignment . the amino acid substitution matrices were then ranked according to the mean f-score obtained over all msas .

this analysis identified johm <dig> as the highest scoring substitution matrix with a mean f-score of  <dig>  over the  <dig> randomly selected benchmark msas. interestingly this matrix did not obtain significantly higher scores than the next  <dig> best substitution matrices assayed by paired t-test . moreover, the f-score of the first  <dig> matrices decreased approximately linearly with each subsequently ranked matrix . beyond the substitution matrix ranked 91st, the mean f-score of subsequent matrices reduced rapidly. we therefore selected these top-scoring  <dig> amino acid substitution matrices for generating input alignments for the mergealign method.

mergealign alignments are more accurate that alignments based on any individual amino acid substitution matrix
in order to test how mergealign consensus msas perform compared to msas generated with a single substitution matrix, we selected a second set of  <dig> randomly selected benchmark msas . we aligned each member of this set using both mafft fft-ns- <dig> and the more accurate mafft l-ins-i method  <cit> . individual msas were generated for both methods using each of the  <dig> top-scoring substitution matrices from the previous test. the mean f-score observed using each substitution matrix is highly correlated between fft-ns- <dig> and l-ins-i alignment methods and the rank order of amino acid substitution matrices is near identical . having selected  <dig> msas for each benchmark msa, we used mergealign to generate a consensus of these individual msas. consensus mergealign msas were generated from all  <dig> msas or subsets of the  <dig> msas. subsets consisted of those msas generated by the top  <dig>  or multiples of  <dig> up to  <dig>  substitution matrices according to rank order of the mean f-score shown in figure  <dig>  we scored each msa, including the mergealign consensus msas, using the mean f-score of the  <dig> independent msa inferences.

the msas generated by mergealign scored consistently high, whether using msas generated from all  <dig> amino acid substitution matrices or a subset of them . as expected the average score of the constituent msas generally decreased as more alignments were included, however the score of the consensus alignments made by mergealign did not follow the same trajectory. for example, when using fft-ns- <dig>  the mean f-score for mergealign ranged from  <dig>  for a consensus of  <dig> msas to  <dig>  for a consensus of  <dig> msas while the mean f-score of those  <dig> msas was only  <dig> . all of the mergealign consensus msas also scored higher than the msas generated by the previously identified top scoring substitution matrix . when using the l-ins-i method to generate input msa for mergealign, the mergealign method also outperformed all individual substitution matrices, though the effect was less pronounced . the maximum f-score for mergealign was  <dig> , which was obtained by generating a consensus msa of the top  <dig> ranked substitution matrices identified by the training set.

to provide a direct comparison to an existing method which produces a consensus from msas in a different way, we aligned the  <dig> benchmark msas above with m-coffee  <cit> . here, m-coffee creates a consensus alignment using  <dig> independent msa methods  <cit> . to compare the methods directly the same  <dig> constituent msas were also combined using mergealign. starting from the same raw input alignments the mean time taken to construct a consensus alignment was  <dig>  s  and  <dig>  s  for m-coffee and mergealign respectively. the mean score for m-coffee was  <dig>   whereas the mean score for mergealign was  <dig>  . thus on small numbers of input alignments mergealign is significantly faster than m-coffee  however the accuracy of the two methods is not significantly different .

analysis of the accuracy of all tested msa methods as a function of the percentage identity of the reference msa revealed that mergealign outperforms all tested methods across nearly all levels of sequence identity . interestingly, the most pronounced improvement in accuracy occurs for sequences with low percentage identity . for the lowest category  mergealign achieves ~3% improvement in accuracy. the difference between the accuracy of mergealign and other methods is less pronounced at higher levels of sequence identity .

mergealign column score is related to alignment accuracy
when mergealign generates a consensus msa from multiple input msas it assigns each column a score equal to the proportion of constituent msas in which that column is present. to determine the relationship between mergealign column score and msa error rate, the alignment precision and mergealign column score for all aligned columns were compared. the individual columns from all msas inferred using mergealign were binned into categories based on their mergealign column score with a score bin width of  <dig> . for each category, the mean precision of the aligned letter-pairs for the constituent columns was evaluated. the relationship between the mergealign column score and the precision of the aligned letter pairs contained within that column was fit to a power function of the form f = xm. this was subject to least squares fitting and a value of  <dig>  was selected as the optimal value for m . this analysis revealed that mergealign column score is related to alignment precision and hence, one can estimate the error rate of an individual column in a mergealign msa as a function of its mergealign column score. for example, columns obtaining a mergealign column score of ≥  <dig>  will have an expected false positive alignment error rate of ~1%. similarly columns obtaining a mergealign column score of  <dig>  will have an expected false positive error rate of ~5%.

increasing alignment f-score on benchmark tests improves phylogenetic tree performance
as the use of msa benchmarks for evaluating msa performance has recently been called into question  <cit>  we developed an alternative test to validate that mergealign msas were better than those generated by single matrices of amino acid substitution. this test involved measuring the effect of the msa method on two aspects of phylogenetic tree inference. 1) the topological agreement between single gene phylogenetic trees obtained from the same set of organisms. 2) the fraction of partitions in those trees which received a sh-like support value of > <dig> . a large set of single gene orthologous protein families from the same set of organisms were downloaded from a previous analysis  <cit> . each of these sequence families containing four or more sequences  was aligned using each of the  <dig> substitution matrices selected above. mergealign alignments were constructed from subsets of the  <dig> alignments using the rank order derived from the benchmark test as described before. each alignment was then used to infer a phylogenetic tree and the degree of topological agreement between trees was calculated. comparison of the topological agreement with f-score from the benchmark tests revealed that there is a significant positive correlation between these two scores . there is also positive  correlation between the fraction of partitions which receive a sh-like support of > <dig>  and the f-score in the benchmark tests . there was no significant correlation between the fraction of partitions which receive a sh-like support of > <dig>  and the level of topological agreement between trees  hence these two tree-based tests can be considered to be independent. this analysis demonstrates that substitution matrices which performed better in msa benchmark tests produce trees which are both more resolved and more consistent with each other.

merge align improves performance on structural measure of multiple sequence alignment accuracy
to determine whether mergealign also performs well on structural measures of multiple sequence alignment accuracy the benchmark multiple sequence alignments were subject to benchmark free accuracy evaluation using the irmsd method  <cit> . this analysis revealed that merge align also scored very highly using this method of evaluation . to put this result in context and evaluate and compare the performance of mergealign across all tests the score obtained in each test was ranked and the average rank across all tests was calculated . this revealed that on average across all tests presented mergealign using all  <dig> input alignments was the highest ranked method.

CONCLUSIONS
we present a novel method for improving multiple sequence alignment  performance by constructing consensus msas from multiple individual msas. in all tests performed on benchmark msas the precision, recall  and irmsd score of the mergealign method is better than that observed for any individual matrix of amino acid substitution. this is the first demonstration that combining of msas using different models of amino acid substitution can improve msa accuracy. we also demonstrated in two independent tests that did not use benchmark msas that mergealign alignments increase the resolution of phylogenetic trees and increase the topological agreement between phylogenetic trees inferred from individual gene families.

this method for improving msa has broad general applicability in biological research. the method is also extensible: as more matrices of sequence substitution become available they can be incorporated into the mergealign procedure. similarly, mergealign will benefit from improvements in underlying msa technology; as these improve mergealign will improve. independent of its use for inferring consensus msas, mergealign is also suitable for identifying the consensus columns between msas generated under different alignment methods. mergealign also provides an estimate of the precision of a msa on a column-by-column basis. we demonstrated that the mergealign column score is related to msa precision and propose this as an additional and independent method for data selection for downstream bioinformatic applications.

