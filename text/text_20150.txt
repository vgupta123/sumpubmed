BACKGROUND
most stochastic models of biochemical reactions are based on the fundamental assumption that no more than one reaction can occur at the exact same time. a consequence of this assumption is that only elementary chemical reactions can be converted directly into stochastic analogues  <cit> . these include: 1) zero-order reactions, such as the generation of molecules at a constant rate; 2) first-order reactions, with examples including elemental chemical reactions as well as transport and decay processes; and 3) second-order reactions, which include heterogeneous and homogeneous bimolecular reactions . reactions with integer kinetic orders other than  <dig>   <dig> and  <dig> are to be treated as combinations of sequential elementary reactions. the advantage of the premise of non-simultaneous reaction steps is that the stochastic reaction rate can be calculated from a deterministic, equation-based model with some degree of rigor, even though the derivation is usually not based on first physical principles but instead depends on other assumptions and on macroscopic information, such as a fixed rate constant in the equation-based model. the severe disadvantage is that this rigorous treatment is not practical for modelling larger biochemical reaction systems. the reasons include the following. first, in many cases, elementary reaction rates are not available. secondly, even in the case that all reaction parameters are available, the computational expense is very significant when the system involves many species and reactions, and this fact ultimately leads to a combinatorial explosion of required computations. within a deterministic modelling framework, the common practice in this situation is to fit the transient and steady-state experimental data with a phenomenological,  equation-based model, which explicitly or implicitly eliminates or merges some intermediate species and reactions. the best-known examples are probably michaelis-menten and hill rate laws, which are ultimately explicit, but in truth approximate a multivariate system of underlying chemical processes.

similar model reduction efforts have been carried out for stochastic modelling. for instance, the use of a complex-order function  was shown to be justified for some types of stochastic simulations. a prominent example is again the michaelis-menten rate law, which can be reduced from a system of elementary reactions to an explicit function by means of the quasi-steady-state assumption . however, model reduction within the stochastic framework has proven to be far more difficult than in the deterministic counterpart. the difficulties are mainly due to the fact that the reduction must be carried out on the chemical master equation . this process is nontrivial and has succeeded only in simple cases.

in general, the construction of a stochastic model for a large biochemical network requires the use of information available from an equation-based model. in the past, several strategies have been proposed for this purpose and within the context of gillespie's exact stochastic simulation algorithm  and its variants  <cit> . for example, tian and burrage  <cit>  proposed that a stochastic model could be directly formulated from the deterministic model through a poisson leaping procedure. however, a rigorous mathematical justification for such a conversion is lacking. typical moment-based approaches  <cit>  derive odes for the statistical moments of the stochastic model from an equation-based model where the 0th, 1st and 2nd order reactions follow mass action rate laws. more recently the moment method was extended to cover models consisting of rational rate laws  <cit> . moreover, it was realized that the moment method is complementary to, but cannot fully replace, stochastic simulations, because it does not cover situations like genetic switches  <cit> .

in this article, we explore the mathematical connection between deterministic and stochastic frameworks for the pertinent case of generalized mass action  systems, which are frequently used in biochemical systems theory . specifically, we address two questions: first, under what conditions can a deterministic, equation-based model be converted directly into a stochastic simulation model? and second, what is a proper way of implementing this conversion? we will develop a method to answer these questions and demonstrate it for functions in the canonical power-law format of gma systems. however, the results are applicable to other functions and formats as well, as we will demonstrate with several examples.

representations of systems of biochemical reactions
consider a well-stirred biochemical reaction system with constant volume and temperature, where ns different chemical species {ss}s=1ns, interact through nr unidirectional reaction channels {rr}r=1nr. each reaction channel can be characterized as

 rr:v-r1s1+…+v-rnssns→krv¯r1s1+…+v¯rnssns, 

where v-rs and v¯rs are the counts of molecular species ss consumed and produced due to reaction rr, respectively, and kr is the rate constant. the changed amount of ssvrs=v¯rs-v-rs, which is due to the firing of reaction rr, defines the stoichiometric coefficient of ss in rr. the stoichiometric coefficients of all species can be summarized according to each reaction rr in the stoichiometric vector

 vr≜vr1⋮vrns∈ℤns. 

the stoichiometric vectors of all reactions can further be arranged as the stoichiometric matrix of the system

 v≜∈ℤns×nr. 

the size of the system is defined as Φ = au, where a is the avogadro number and u is the reaction volume.

the modelling of biochemical reaction networks typically uses one of two conceptual frameworks: deterministic or stochastic. in a deterministic framework, the state of the system is given by the a non-negative vector x=x <dig> …,xnst∈ℝns, where component  represents the concentration of species ss, measured in moles per unit volume. the temporal evolution of the state of the system is modelled by a set of ordinary differential equations, which in our case are assumed to follow a generalized mass action  kinetic law. by contrast, in a stochastic framework, the state of the systems is characterized by a vector x=t∈ℤns, whose values are non-negative integers. specifically, xs = Φ  is the count of ss molecules, which is a sample value of the random variable xs. the system dynamics of this process is typically described with the chemical master equation . both gma and cme will be discussed in detail in the following sections.

motivation for the power-law formalism: reactions in crowded media
power-law functions with non-integer kinetics have proven very useful in biochemical systems analysis, and forty years of research have demonstrated their wide applicability . generically, this type of description of a biochemical reaction can be seen either as a taylor approximation in logarithmic space or as a heuristic or phenomenological model that has been applied successfully hundreds of times and in different contexts, even though it is difficult or impossible in many situations to trace it back to first mechanistic principles. a particularly interesting line of support for the power-law format can be seen in the example of a bimolecular reaction occurring in a spatially restricted environment. savageau demonstrated that the kinetics of such a reaction can be validly formulated as a generalization of the law of mass action, where non-integer kinetic orders are allowed  <cit> . neff and colleagues  <cit>  showed with careful experiments that this formulation is actually more accurate than alternative approaches.

within the conceptual framework of power-law representations, the rate of the association reaction between molecules of species s <dig> and s <dig> is given as kf1f <dig>  here, k is the rate constant and f <dig> and f <dig> are real-valued kinetic orders, which are no longer necessarily positive integers as it is assumed in a mass action law. as an example, consider the reversible bimolecular reaction s1+s <dig> ⇌kbkfs <dig>  like neff and colleagues  <cit> , we begin by formulating a discrete update function for the population of s <dig> molecules as

  x3 - x3=fΔtx1x2 - gΔtx <dig>  

the first term on the right-hand side of this equation, f Δt x1x <dig>  describes the production of s3: it depends on the totality of possible collisions x <dig> x <dig> and also on some fraction f Δt that actually reacts and forms the product. in a dilute environment, f  equals a traditional rate constant, and the reaction obeys the law of mass action, while in a spatially restricted environment, such as the cytoplasm, one needs to take crowding effects into account. as shown in savageau  <cit> , the desired fraction of a reaction in a crowded environment becomes a rate function that depends on the current concentrations of s <dig> and s <dig>  the second term, g  Δtx <dig>  describes the fraction g  Δt of species s <dig> that dissociates back into s <dig> and s <dig>  this fraction may depend on some functional form of  because in a crowded environment the complex may not be able to dissociate effectively. thus, rate constants in the generalized mass action setting become rate functions .

by taking the limit Δt →  <dig>  one obtains the differential equation

  dx3dt=fx1x2 - gx <dig>  

savageau used taylor series expansion to approximate the functions f and g in the logarithmic space  around some operating point . the result for f is

  logf≜f=f+∂f∂+∂f∂+hot≈kf+αlog+βlog, 

where kf, α, and β are constants related to the chosen operating point . the final step is achieved by ignoring all higher order terms  beyond the constant and linear terms. transformation back to the cartesian space yields

  f≈kaαβ,ka=ekf. 

the same procedure leads to the power-law expression for the degradation term: g  ≈ kd γ. by combining constants we arrive at a power-law representation for the dynamics of species s <dig> as

  ddt=kaαβ-kdγ=kaab-kdc, 

where a = α +  <dig>  b = β +  <dig>  and c = γ +  <dig>  as long as kf, kd, a, b and c remain more or less constant throughout a relevant range, the power-law model is mathematically well justified. in actual applications, the values of rate constants and kinetic orders can be estimated from experimental data  <cit> . when the functions f and g are originally not in power-law format, they can be locally approximated by power-law functions with a procedure similar to the one shown above  to ). an illustration will be given in the example section.

the generalized mass action  format
in the gma format within biochemical systems theory, each process is represented as a univariate or multivariate power-law function. gma models may be developed de novo or as an approximation of some other nonlinear rate laws. gma models characterize the time evolution of the system state given that the system was in the state x  at some initial time t <dig>  generically, the state of the system is changed within a sufficiently small time interval by one out of the nr possible reactions that can occur in the system. the reaction velocity through reaction channel rr is:

  ′vr1=…=′vrns=kr ∏s=1nsfrs 

for those vrs=v¯rs-v-rs≠ <dig>  s =  <dig>  ..., ns. as shown in the example of a bimolecular reaction, the kinetic order frs associated with species ss captures the effects of both reactant properties  and environmental influences . therefore frs does not necessary equal an integer vrs, which is assumed to be the case in mass action kinetics, but is possibly real-valued and may be negative. summing up the contributions of all reactions, one obtains a gma model describing the dynamics of ss as

  ddt= ∑r=1nrvrskr ∏s=1nsfrs 

for every s =  <dig>  ..., ns. each reaction contributes either a production flux or a degradation flux to the dynamics of a certain species. positive terms  represent the production of ss, while negative terms  describe degradation. if frs is positive, then ss accelerates the reaction rr; a negative value represents that ss inhibits the reaction, and frs =  <dig> implies that ss has no influence on the reaction. the rate constant kr for reaction rr, is either positive or zero. both, the rate constant and the kinetic order, are to be estimated from data.

proper use of equation-based functions for stochastic simulations
the fundamental concept of a stochastic simulation is the propensity function α, and αdt describes the probability that a reaction will change the value of a system variable within the next  time interval . while a formal definition will be given later , it is easy to intuit that the propensity function is in some sense analogous to the rate in the corresponding deterministic model. in fact, the propensity function is traditionally assumed to be α = fs, if the deterministic model is xs' = fs, s =  <dig>  ..., ns. however, a proper justification for this common practice is by and large missing. indeed, we will show that the direct use of a rate function as the propensity function in a stochastic simulation algorithm requires that at least one of the following assumptions be true:

1) f is a linear function;

2) the reaction is monomolecular;

3) all xi in the system are noise-free variables, i.e., without  fluctuations, which implies that the covariance of any two participating reactants is zero .

each of these assumptions constitutes a sufficient condition for the direct use of a rate function as the propensity function and applies, in principle, to gma as well as other systems. the validity of these conditions will be discussed later. specifically, the first condition will be addressed in the results section under the headings "0th-order reaction kinetics" and "1st-order reaction kinetics, " while the second condition will be discussed under the heading "real-valued order monomolecular reaction kinetics." the third condition will be the focus of equations  and their associated explanations.

in reality, the rates of reactions in biochemical systems are commonly nonlinear functions of the reactant species, and fluctuations within each species are not necessarily ignorable. therefore, to the valid use of an equation-based model in a stochastic simulation mandates that we know how to define a proper propensity function. the following section addresses this issue. it uses statistical techniques to characterize estimates for both the mean and variance of the propensity function, and these features will allow an assessment of the validity of the assumption α = fs and prescribe adjustments if the assumption is not valid.

methods
deriving the mean and variance of a power-law function of random variables
consider a generic power-law function of random variables xs with the format pl=k∏s=1nsxsfs. estimates of its mean μpl and variance σpl are given as

  μpl≈k∏s=1nsμsfs exp∑i<jnsfifjcovlogxi,logxj 

  σpl2≈μpl2Ω 

. here,

  Ω= ∑s=1nsfsμs-2σs2+2∑i<jnsfifjcov1ogxi,logxj 

and μs = e and σs2=e <dig> are the mean and variance of random variable xs, respectively. if we choose to express cov  as a function of μs, σs <dig> and covariance σij = cov , using a taylor approximation, we obtain

  μpl≈k∏s=1nsμsfs exp-12∑s=1nsfsσs2/μs2+12Ω 

  σpl2≈μpl2Ω, 

where

  Ω≈∑s=1nsfs2+2∑i<jnsfifjσij/+12logσj/μj2+12logσi/μi2-14σi/μi2σj/μj <dig>  

since many biochemical variables approximately follow a log-normal distribution  <cit> , it is valuable to consider the special situation where is log-normally distributed  is normally distributed). in such a case, a simpler alternative way to calculate cov  is

  cov1ogxi,logxj= log1+σijμiμj. 

 <cit> . by substituting this result into -, one obtains

  μpl≈k∏s=1nsμsfs ∏i<jns1+σijμiμjfifj 

  σpl2≈μpl2Ω, 

where

  Ω= ∑s=1nsfsσsμs2+2∑i<jnsfifj log1+σijμiμj. 

the approximation formulae for μpl and σpl <dig> in eqns. - provide an easy numerical implementation if observation data are available to estimate cov . furthermore, equations - demonstrate how μpl and σpl <dig> are related to μs, σs <dig> and σij; however, the price of this insight is paid by the possible inaccuracy introduced through the taylor approximation. equations - also provide a functional dependence of μpl and σpl <dig> on , but it is only valid if the additional assumption of log-normality is acceptable.

deriving proper propensity functions for stochastic simulations from differential equation-based models
assuming that the gma model faithfully captures the average behaviour of a biochemical reaction system and recalling x=x <dig> …,xnst, the expected metabolite numbers are defined as the expectation

  ex=xΦ, 

where Φ is the system size as defined above.

to describe the reaction channel rr stochastically, one needs the state update vector vr and must characterize the quantity of molecules flowing through of reaction channel rr during a small time interval. the key concept of this type of description is the propensity function αr, which is defined as

  αrdt=theprobabilitythatexactlyonereactionrrwilloccursomewhereinsideuwithininfinitesmalinterval,givencurrentstatex=x. 

 <cit> . because of the probabilistic nature of the propensity function, x is no longer deterministic, and the result is instead stochastic and based on the transition probability

  p=prob{x=x,givenx=x0}, 

which follows the chemical master equation 

  ∂p∂t= ∑r=1nr 

updating cme requires knowledge of every possible combination of all species counts within the population, which immediately implies that it can be solved analytically for only a few very simple systems and that numerical solutions are usually prohibitively expensive  <cit> . to address the inherent intractability of cme, gillespie developed an algorithm, called the stochastic simulation algorithm , to simulate cme models  <cit> . ssa is an exact procedure for numerically simulating the time evolution of a well-stirred reaction system. it is rigorously based on the same microphysical premise that underlies cme and gives a more realistic representation of a system's evolution than a deterministic reaction rate equation represented by odes. ssa requires knowledge of the propensity function, which however is truly available only for elementary reactions. these reactions include: 1) 0th order reactions, exemplified with the generation of a molecule at a constant rate; 2) 1st order monomolecular reactions, such as an elemental chemical conversion or decay of a single molecule; 3) 2nd order bimolecular reactions, including reactive collisions between two molecules of the same or different species. the reactive collision of more than two molecules at exactly the same time is considered highly unlikely and modelled as two or more sequential bimolecular reactions.

for elementary reactions, the propensity function of reaction rr is computed as the product of a stochastic rate constant cr and the number hr of distinct combinations of reactant molecules, i.e.

  αr=crhr,r= <dig> …,nr. 

here hr=∏s=1nsxsv-rs≈∏s=1nsxsv-rs∏s=1nsv-rs!,forxs≥v-rs> <dig> otherwise, where xs is the sample value of random variable xs. the approximation is invoked when xs is large and , ...,  are approximately equal to xs.

in gillespie's original formulation  <cit> cr is a constant that only depends on the physical properties of the reactant molecules and the temperature of the system, and crdt is the probability that a particular combination of reactant molecules will react within the next infinitesimally small time interval . the constant cr can be calculated from the corresponding deterministic rate constants, if they are known.

since the assumption of mass action kinetics is not valid generally, especially in spatially restricted environments and in situations dominated by macromolecular crowding, we address the broader scenario where cr is not a constant but a function of the reactant concentrations. thus, we denote cr as a stochastic rate function, while retaining the definition of hr as above. knowing that any positive-valued differentiable function can be approximated locally by a power-law function, we assume the functional form of the stochastic rate function as

  cr=κr ∏s=1nsxsεrs. 

here, κr and εrs are constants that will be specified in the next section, and r =  <dig>  ..., nr. note that εrs are now real-valued. once the stochastic rate function is determined , the propensity function can be calculated as

  αr=crhr=κr∏s=1nsv-rs!∏s=1nsxsv-rs+εrs. 

in order to identify the functional expression for a stochastic rate function, and thus the propensity function, we consider the connection between the stochastic and the deterministic equation models. by multiplying cme with x and summing over all x, we obtain

  ddtex= ∑r=1nrvreαr). 

similarly, the expectation for any species xs is given as

  ddtexs= ∑r=1nrvrseαr),s= <dig> …,ns. 

the details of these derivations are shown in additional file  <dig> 

we can use these results directly to compute the propensity function for a stochastic gma model, assuming that its deterministic counterpart is well defined. specifically, we start with the deterministic gma equation for xs,

  ddtxs= ∑r=1nrvrskr ∏s′=1nsxs′frs′,s= <dig> …,ns, 

where vrs, kr and frs' are again the stoichiometric coefficients, rate constants, and kinetic orders, respectively. by substituting xs=exsΦ from equation  into this gma model, we obtain a "particle-based" equation of the format

 ddtexsΦ= ∑r=1nrvrskr ∏s′=1nsexs′Φfrs′,s= <dig> …,ns. 

elementary operations allow us to rewrite this equation as

  ddtexs= ∑r=1nrvrskrΦ1-fr ∏s′=1nsexs′frs′,s= <dig> …,ns, 

where fr= ∑s′=1nsfrs′. in this formulation, the differential operator is justified only when large numbers of molecules are involved. the assumption that the deterministic equations precisely capture the average behaviour of the biochemical reaction system directly equates the stochastic cme  to the deterministic equation based model 

  eαr)=krΦ1-fr ∏s′=1nsexs′frs′. 

now we have two choices for approximating the expectation of the propensity function on left-hand side of equation :

1) adopt a zero-covariance assumption as was done in  <cit> , which implies ignoring random fluctuations within every species as well as their correlations. this assumption is only justified for some special cases such as monomolecular and bimolecular reactions under the thermodynamic limit , but is not necessary valid in generality. here the thermodynamic limit is defined as a finite concentration limit which the system reaches when both population and volume approach infinity. under this assumption, the left hand side of  becomes

  eαr=eκr∏s=1nsv-rs!∏s=1nsxsv-rs+εrs=κr∏s=1nsv-rs!∏s=1nsev-rs+εrs 

for every r =  <dig>  ..., nr, and equation  yields

  εrs=frs-v-rsκr=krΦ1-fr ∏s=1nsv-rs!cr=krΦ1-fr ∏s=1nsv-rs!xsεrs 

and

  αr-0=krΦ1-fr ∏s=1nsxsfrs. 

here, the index r_ <dig> is used to distinguish this 0-covariance propensity function from a second type of propensity in the next section.

with the zero-covariance assumption, one can substitute  back into the equation for the expectation for each species, which yields

  ddtexs= ∑r=1nrvrskrΦ1-fs ∏s=1nsμsfrs 

for every s =  <dig>  ..., ns.. note that this result is exactly equivalent to the equation-based model .

equation  is based on assumption that both the fluctuations within species and their correlations are ignorable, which is not necessarily true in reality. if one uses it in simulations where the assumptions are not satisfied, it is possible that the means for the molecular species are significantly different from the corresponding equation-based model values. this discrepancy arises because the evolution of each species in the stochastic simulation is in truth affected by the covariance which is not necessarily zero, as it was assumed. this phenomenon was observed by paulsson and collaborators  <cit>  and further discussed in different moment-based approaches  <cit> . to assess the applicability limit of the propensity defined by , we can apply approximation techniques as shown in eqns. - on the functional expression of αr_ <dig> and obtain mean and variance as

  μαr-0=eαr-0)≈krΦ1-fr ∏s′=1nsexs′frs′exp∑i<jnsfrifrjcov1ogxi,logxj 

  σαr-02≈μαr-02Ωr, 

where

  Ωr= ∑s=1nsfrsμs-2σs2+2∑i<jnsfrifrjcov1ogxi,logxj, 

for every s =  <dig>  ..., ns. these expressions demonstrate that even with large numbers of molecules the mean of cme does not always converge to the gma model. indeed, the convergence is only guaranteed in one of the following special situations: 1) the reaction is of 0th order; 2) the reaction is a real value-order monomolecular reaction, with 1st order reaction as a special case; 3) the covariance contribution in  is sufficiently small to be ignored for all participating reactant species of a particular reaction channel. except for these three special situations, the covariance as shown in  significantly affects the mean dynamics. therefore, stochastic simulations using zero-covariance propensity functions will in general yield means different from what the deterministic gma model produces. how large these differences are cannot be said in generality. under the assumption that the gma model correctly captures the mean dynamics of every species, this conclusion means that αr_ <dig> is not necessarily an accurate propensity function for stochastic simulations, and the direct conversion of the equation-based model into a propensity function must be considered with caution.

moreover, there is no theoretical basis to assume that there are no fluctuations in the molecular species or that these are independent. therefore, we need to consider the second treatment of the expectation of the propensity function and study the possible effects of a non-zero covariance.

2) we again assume that the gma model is well defined, which implies that information regarding the species correlations and fluctuations has been captured in the parameters of the gma model on the left hand size of equations  and . to gain information regarding correlations, we use taylor expansion to approximate the propensity function :

  e=e≈κr∏s=1nsv¯rs!∏s=1nsev¯rs+εrs×exp cov) 

after substitution of  in , one obtains

 κr=krΦ1-fr ∏s=1nsv-rs!exp-∑i<jnsfrifrjcov1ogxi,logxjεrs=frs-v-rs. 

given the state x of the system at time t, the stochastic rate function of reaction rr is

  cr=κr ∏s=1nsxsεrs=krΦ1-fr ∏s=1nsv-rs!× exp-∑i<jnsfrifrjcov1ogxi,logxj∏s=1nsxsfrs-v-rs. 

here it is important to understand that although the random variables {xs}s∈s appear in the expression cr, cr is not a function of random variables but a deterministic function. the reason is that the cov  in the composition of cr, which as the numerical characteristic of the random variables {xs}s∈s, is deterministic. therefore, the stochastic rate function cr is a well-justified deterministic function that is affected by both the state of the system  and cov , the numerical characteristic of fluctuations in the random variables {xs}s∈s.

given the expression cr, the propensity function is

  αr=crhr=krΦ1-fr ∏s=1nsxsfrs× exp-∑i<jnsfrifrjcov1ogxi,logxj. 

these results are based on the assumption that there are large numbers of molecules for all reactant species participating in reaction rr. for simplicity of discussion, we define the propensity adjustment factor  of reaction rr as

  paf≜ exp-∑i<jnsfrifrjcov1ogxi,logxj. 

paf is a function of time t and represents the contribution of the reactants to correlations among species in the calculation of the propensity function for reaction rr. we denote the propensity function in , which accounts for the contribution of the covariance, as αr_cov, in order to distinguish it from the propensity function αr_ <dig> , which is based on the assumption of zero-covariance, i.e.,

  αr-cov=pafkrΦ1-fr ∏s=1nsxsfrs. 

remembering that cov , which is a component in both the stochastic rate function cr and now in the function paf, is a deterministic function rather than a function of random variables, paf is a deterministic correction to the kinetic constant kr in the construction of αr_cov in , which corrects the stochastic simulation toward the correct average.

in contrast to the propensity function αr_ <dig>  αr_cov leads to accurate stochastic simulations. to illustrate this difference, we analyze ddte as follows: we apply the approximation techniques in eqns. - in order to obtain the mean and variance of the propensity function αr_cov:

  μαr-cov=eαr-cov)≈krΦ1-fr ∏s′=1nsexs′frs′ 

  σr-cov2≈μαr-cov2Ωr. 

here

  Ωr= ∑s=1nsfrsμs-2σs2+2∑i<jnsfrifrjcov1ogxi,logxj. 

by substituting  back into the derivation of cme , one obtains

  ddtexs= ∑r=1nrvrseαr-cov)≈∑r=1nrvrskrΦ1-fr ∏s′=1nsμs′frs′ 

for every s =  <dig>  ..., ns, which is equivalent in approximation to the gma model . in the other words, the mean of every molecular species obtained by using αr_cov in the cme derived equation  is approximately identical to the corresponding macroscopic variable in the gma model.

calculation of cov 

when data in the form of multiple time series for all the reactants are available, it is possible to compute cov  directly from these data. once this covariance is known, the function paf, αr_cov and the mean dynamics can all be assessed. alas, the availability of several time series data for all reactants under comparable conditions is rare, so that cov  must be estimated in a different manner.

if one can validly assume that the covariance based on αr_ <dig> does not differ significantly from the covariance based on αr_cov, one may calculate cov  by one of following methods.

method 1:

one uses αr_ <dig> to generate multiple sets of time series data of all reactants and then computes cov .

method 2:

first, cov  is expressed as a function of mean and covariance in one of the following ways; either as

  cov1ogxi,logxj≈σij/+12logσj/μj2+12logσi/μi2-14σi/μi2σj/μj <dig> 

or as equation :

 cov1ogxi,logxj= log1+σijμiμj. 

the first functional expression of cov  is achieved by taylor approximation, whereas the second expression is obtained by the additional assumption that the concentrations  are log-normally distributed  <cit> . the consideration of a log-normal distribution is often justified by the fact that many biochemical data have indeed been observed to be log-normally distributed .

second, one uses αr_ <dig> to approximate the mean and covariance either by direct simulation, as shown in method  <dig>  or by a moment-based approach, which is explained in additional file  <dig>  and which yields the differential equations

 ∂μs∂t≈∑r=1nrvr,sαr-0+12∑m,n=1ns∂2αr_0∂xm∂xnσmn∂σij∂t≈∑r=1nrvr,i ∑s=1ns∂αr_0∂xsσjs+vr,j ∑s=1ns∂αr_0∂xsσis+vr,ivr,jαr-0+12∑m,n=1ns∂2αr_0∂xm∂xnσmn 

for convenience of computational implementation, the above equations can be written in matrix format

 ∂μ∂t≈vtα+12α″⊙σ∂σ∂t≈σα′vt+σα′v+vtΛv. 

here for r =  <dig>  ..., nr, and s, m, n =  <dig>  ..., ns, μ=μ <dig> …,μnst, rs = vrs, α=t, α″=αr″,...,αnr″t, mn=∂2αr∂xm∂xn, αr″⊙σ= ∑m,n=1ns∂2αr∂xm∂xn|x=μσmn, α″⊙σ≜α1″⊙σ,…,αnr″⊙σt, α′=, αr′=∂αr∂x <dig> …,∂αr∂xnst, and Λ is a diagonal matrix with rr=αr+12∑m,n=1ns∂2αr∂xm∂xnσmn.

statistical criteria for propensity adjustment
suppose an equation-based model captures the average behavior of a stochastic system and one intends to find the propensity function for a stochastic simulation that will reproduce that means. one can use the 95% confidence interval to evaluate the need for a propensity adjustment. specifically, for stable systems that will reach a steady state, we use the reversible reaction model as an example. if the steady state of the ode xst is within the 95% confidence interval of n runs of stochastic simulations, i.e. xst∈μst- <dig> δstn,μst+ <dig> δstn, then the rate function in the original odes can be used as the propensity without adjustment; otherwise propensity adjustment is needed. here μst and δst can be attained from either a moment-base method or from n independent runs of stochastic simulations using propensity without adjustment. an example discussing a reversible reaction with feedback controls can be found in the results section.

for other systems that do not reach a steady state, but where instead transient characteristics are of the highest interest, one can judge the need of propensity adjustment by whether the pertinent characteristics of the odes are within the 95% confidence interval of the corresponding characteristic, which is given by a prediction from the moment-based method or from n runs of stochastic simulations. the repressilator example in the result section will serve as a demonstration.

RESULTS
generic special cases
it is generally not valid to translate a rate from a deterministic biochemical model into a propensity function of the corresponding stochastic simulation without adjustment -). however, in some situations, the propensity adjustment -) is not needed, and in some other cases it becomes relatively simple.

1) 0th-order reaction kinetics

consider a very simple equation-based model of the type

  dxsdt=krordexsdt=krΦ, 

for all s =  <dig>  ..., ns, frs =  <dig>  according to equations -, one obtains

 Ωr=0σαr2≈0μαr≈ explogkrΦ=krΦi.e.eαr≈αrexαr_cov≈krΦ=αr_ <dig>  

thus, for a 0th-order reaction, its rate equation can be taken directly as the propensity function in stochastic simulations.

2) 1st-order reaction kinetics

direct application of equations - yields

  dxidt=krxjordexidt=krexj, 

frs = δsj, i, j =  <dig>  ..., ns. therefore, according to equations -

 Ωr=σj/μj2σαr/μαr2=σj/μj2μαr≈ explogkrμj=krμji.e.eαr≈αreαr-cov≈krxj=αr- <dig>  

thus, for 1st-order reactions, the rate equation can again be taken directly as the propensity function in stochastic simulations.

3) real-valued order monomolecular reaction kinetics

consider a reaction with kinetics of the type

  dxidt=krxjfrjordexidt=krΦ1-frjexjfrj, 

frj ≠  <dig>  frs =  <dig>  for any s ≠ j, s =  <dig>  ..., ns. equations - lead to

 Ωr=σj/μj2σαr/μαr2=σj/μj2μαr≈krΦ1-frjμjfrji.e.eαr≈αreαr-cov≈krΦ1-frjxjfrj=αr- <dig>  

thus, for reaction kinetics involving a single variable and a real-valued order, the rate equation can again be taken as the propensity function in stochastic simulations.

4) 2nd-order reaction kinetics

this type of reaction can be expressed as

  ddtxs=krxixjordexsdt=krΦ-1exiexj, 

i, j ∈ { <dig>  ..., ns}, i ≠ j, fri = frj =  <dig>  and frs =  <dig>  for all s ≠ i, j. therefore, according to equations -

 Ωr=σi/μi2+σj/μj2+2cov1ogxi,logxj=σi/μi2+σs/μs2+2covxi/μi,xj/μj+12logσj/μj2+12logσi/μi2-14σi/μi2σj/μj <dig> 

 σαr/μαr2=Ωr∂=σi/μi2+σj/μj2+2cov1ogxi,logxjμαr≈kr-1μiμjαr-cov=krΦ-1xixj exp-cov1ogxi,logxj≠αr- <dig>  

thus, the proper propensity function for 2nd-order reactions is different from the rate equation. the difference can be ignored only if the contribution from the covariance is insignificant. in general, the rate equation yields only an approximate propensity function for stochastic simulations, and the approximation quality must be assessed on a case-by-case basis.

5) bimolecular reaction with real-valued order kinetics

this type of reaction can be formulated as

  dxsdt=krxifixjfjordexsdt=krΦ1-fi-fjexifiexjfj, 

i, j ∈ { <dig>  ..., ns}, i ≠ j, fri, frj ≠  <dig>  and frs =  <dig>  for all s ≠ i, j. according to equations - we obtain

 Ωr=σi/μi2+σj/μj2+2fifjcov1ogxi,logxj=σi/μi2+σj/μj2+2fifjcovxi/μi,xj/μj+12logσj/μj2+12logσi/μi2-14σi/μi2σj/μj <dig> 

 σαr/μαr2=Ωr=σi/μi2+σj/μj2+2fifjcov1ogxi,logxjμαr≈krΦfi+fj-1μifiμjfjαr-cov=krΦfi+fj-1xifixjfj exp-fifjcov1ogxi,logxj≠αr- <dig>  

for bimolecular reactions of complex order, the propensity function is different from the rate equation. the difference can be ignored only if the contribution from the covariance is insignificant.

power-law representation of a reversible reaction with feedback controls
we consider a reversible reaction with feedback controls  whose average behaviour is accurately described by the following gma model

  dx1dt=dx2dt=-dx3dt=-kfΦ1-f1-f2-f3x1f1x2f2x3f3+kbΦ1-g1-g3x1g1x3g <dig>  

here s <dig> feeds back to inhibit the forward reaction and s <dig> feeds back on the reverse reaction and accelerates it. the task is to develop a stochastic model whose performance converges to that of the deterministic gma model. we can see from equations  that three variables x <dig>  x <dig> and x <dig> contribute to the forward flux kfΦ1-f1-f2-f3x1f1x2f2x3f <dig> and two variables x <dig> and x <dig> contribute to the backward flux kbΦ1-g1-g3x1g1x3g <dig>  because several variables are involved, their covariance has the potential of affecting the forward and the backward propensity functions in a stochastic simulation. to obtain the covariance information, we formulate the moment equations  from the ode model .

to simplify the calculation, as explained in detail in additional file  <dig>  we set the third central moment to zero and obtain a closed-form set of odes. expressed differently, the rate of change in mean and covariance depends only on the functions of mean and covariance themselves, but not on higher-order moments. thus,

  ∂μ∂t≈vtα+12α″⊙σ∂σ∂t≈σα′vt+σ+vtΛv. 

here μ = t, v=-1-1111- <dig>  α=α <dig> α2t=kfΦ1-f1-f2-f3x1f1x2f2x3f3kbΦ1-g1-g3x1g1x3g <dig> 

moreover, for r =  <dig>   <dig> and m, n =  <dig>   <dig>   <dig>  mn=∂2αr∂xm∂xn, α" = t, σ=σ11σ12σ13σ21σ22σ23σ31σ32σ <dig>  αr″⊙σ≜∑m,n=13∂2αr∂xm∂xn|x=μσmn, α"⊙σ ≜ t, α' = , αr′=∂αr∂x <dig> ∂αr∂x <dig> ∂αr∂x3t, and Λ=α1+12∑m,n=13∂2α1∂xm∂xnσmn00α2+12∑m,n=13∂2α2∂xm∂xnσmn.

two initial conditions are chosen for representative simulations; they differ by a factor of  <dig> in species populations and reaction volume between the upper and lower panels of figure  <dig>  the purpose is to observe the thermodynamic limit of the systems: both scenarios have the same initial concentrations, but the system in the lower panel case has a larger species populations and reaction volume and can thus be regarded as the thermodynamic limit sample of system in the upper panel. as demonstrated by the figures in the first column, the moment approach predicts that for both population sizes the average trajectories of the stochastic model  dynamics is lower than that of the equation-based model: the differences are about 10% of the steady-state value of the equation-based model in the upper figure and 1% in the lower figure; for  <dig> runs of the stochastic simulation, the steady-state value of the equation-based model lies outside the 95% confidence interval in the upper figure, while it is inside the interval in the lower figure. therefore, we can expect that the propensity adjustment will significantly contribute to the stochastic simulation for the upper case while not for the lower case. this expectation is confirmed by the simulation results in the third and fourth columns. with the common assumption that the deterministic equations precisely capture the system's average behaviour, the case in the upper panel represents the situation where propensity adjustment is needed, while the lower panel represents the situation that a propensity without adjustment is sufficient when the system approaches its thermodynamics limit. this example furthermore demonstrates that either the moment approach or the stochastic simulations without propensity adjustment can be used to estimate whether there is a need to construct a propensity adjustment function for stochastic simulations.

repressilator
interestingly, a propensity function may even be obtained through power-law approximation of some function that describes complex transient behaviours of a reaction network. as an example, consider the so-called repressilator  <cit> , which is a three-component genetic circuit where each component represses its downstream neighbour. more specifically , gene g <dig> codes for protein x <dig>  whose dimer y <dig> subsequently represses the transcription of the gene g <dig>  similarly, y <dig>  the dimer of gene g2's protein product x <dig>  represses the transcription of gene g <dig>  and y <dig>  the dimer of gene g3's protein product x <dig>  represses the transcription of gene g <dig>  the corresponding differential equation model following mass action kinetics is given by  <cit> 

  xi′=-2κ+xi2+2κ-yi+σmi-γpxiyi′=κ+xi2-κ-yi-k+yid <dig> j+k-dr,jd <dig> i′=-k+ykd <dig> i+k-dr,idr,i′=k+ykd <dig> i-k-dr,imi′=d <dig> i-γmmi, 

where i =  <dig>   <dig>  3; j =  <dig>   <dig>  1; k =  <dig>   <dig>  2; the rate constants are explained in the diagram below

 xi+xi ⇌κ-κ+yid <dig> i+yk ⇌κ-κ+dr,id <dig> i→αd <dig> i+mimi→αmi+xixi→γpϕmi→γmϕ 

assuming that the reversible dimerization and the dissociation/association of a protein dimer from/to the promoter are much faster than other processes, the full systems can be reduced to

  xi′=σp-1mi-γpp-1ximi′=αd1+cdcpxk2-γmmi 

 <cit> . here Φ =  <dig>  p=1+4cpxi+4cdcpdxi <dig>  cp = κ+/κ-, cd = k+/k- and d = d <dig>  i + dr, i for i =  <dig>   <dig>   <dig>  it has been shown that the simplified odes rather accurately approximate the transient dynamics of the full system by retaining the original oscillation period and amplitude.

in  <cit> , the system  is further rescaled by setting t˜=γmt,x˜i=cdcpxi and mi ˜=σcdcpmi/γmβ, which yields

  dx˜idt˜=βp-1mi ˜-βp-1x˜idmi ˜dt˜=κd′1+x˜k2-mi ˜. 

intriguingly, one makes the following observation. the scaled ode system  is consistent with the original system  in oscillation amplitude and period. however, its corresponding stochastic model produces results that deviate substantially from the average responses. to see the effects of the transition from a deterministic to a stochastic model, we apply ssa to the scaled system . the main result is that the oscillation periods of both xi and mi are reduced to half . the reason is that, in the stochastic simulation, the oscillation period is very sensitive to the ratio of xi and mi, which has been altered by the scaling operation. therefore, in general one needs to pay attention to how scaling may affect the stochastic performance when the model is generated through the conversion of an ode model.

we can see from equations  that two variables xi and mi contribute to the production of xi; hence, their covariance could affect the propensity function of xi in the production reaction of a stochastic simulation. similar to the example of a reversible reaction , it is therefore necessary to evaluate covariance effects and to judge whether the propensity function needs adjusting. thus, we need to compare the difference between the dynamics of the phenomenological model  and the dynamics under the influence of covariance, which can be produced by either stochastic simulation or the moment approach.

the influence of the covariance on the dynamics of the stochastic simulation is relatively easy to assess: we simply use the terms on the right-hand side of the differential equations  as the propensity functions in ssa and obtain simulation results shown in the 2nd and the 4th panels of figure  <dig>  obtaining the covariance-influenced dynamics with the moment-based approach is more complicated, and we need to discuss some implementation issues.

first, the moment-based approach requires information regarding the first and the second derivatives of p- <dig>  which have rather complicated functional forms. to simplify the calculation, we replace the function p- <dig> with an approximating power-law function. specifically, suppose the original parameter values are κ+ = k+ =  <dig>  κ- = k- =  <dig> and d =  <dig>  plotting the data -1)in log-log space  indicates that the original function is represented well by a straight line:

 logyi= log <dig> - <dig> logxi. 

for xi ∈  <cit> . in cartesian space, this line corresponds to the power-law function

 yi= <dig> xi- <dig> , 

which models the original function very well . for xi ∈  <cit> , this power-law function does not fit the original function precisely; the effect of this imprecision can be evaluated later at after we use this power-law function in the moment-based method. moreover, using the truncated moment equations to estimate the mean and variance involves multiple approximations: first, the function p - <dig> on the right-hand side of  is replaced by a power-law function . second, the result is approximated by taylor expansion to the second order. third, similar to the example of a reversible reaction, the central moment of the third degree is assumed to be zero, which leads to a closed-form ode for the first two moments.

solving the technical issues as described, one obtains the corresponding moment-based model of   with results shown in figure  <dig>  suppose one is particularly interested in the period and amplitude of the oscillation within a time interval between  <dig> and  <dig> seconds. as shown in figure  <dig>  the gma approximation  fits the original odes   very well at the beginning, but as time goes on, the approximation error accumulates. as seen in the time interval  <cit> , the gma approximation deviates from the original odes significantly. however, this does not mean that the gma approximation cannot be used as a propensity function for stochastic simulations; the moment-based method with the gma approximation shows that, when the gma approximation is used as propensity function  for stochastic simulations, the resulting mean  consistently fits the trajectory of the original odes  very well up to about t =  <dig> seconds. the oscillation period and amplitude in the stochastic simulation based on the gma approximation  are almost identical to those of the original odes. therefore, a propensity adjustment for the gma approximation is not needed, and the gma approximation can be used as a propensity function for stochastic simulations. in other words, a stochastic model for the repressilator system can be generated by using the scheme in  without propensity adjustment. moreover, the imprecision caused by the power-law approximation can be tolerated when its corresponding moment-based mean matches the original odes sufficiently well with respect to the features of highest interest.

enzymatic reaction using a quasi-steady state assumption 
we consider an enzymatic reaction following the michaelis-menten mechanism:

 e+s⇌k-1k1es→k2p+e. 

here enzyme e reacts with substrate s through a reversible reaction to form complex es, which can proceed to yield product p and to release the enzyme e. by assuming the law of mass action for the reaction kinetics we obtain a set of differential equations for the system dynamics:

  ddt=k-1-k1ddt=k1-ddt=k <dig>  

where the total amount of enzyme in the form of free enzyme and complex  <dig> ≜  +  is assumed to be constant. in addiction, by making the so-called quasi steady state assumption   <cit> , assuming that the complex es is essentially in steady state, we can assert ddt≈ <dig>  as it has been discussed many times in the literature, qssa reduces the system and leads to the approximate form

  ddt=-vmaxkm+ddt=vmaxkm+, 

which is known as michaelis-menten kinetics  <cit> . the characterizing parameters are vmax = k <dig> and km = /k <dig> 

applying qssa, rao and arkin  <cit>  were able to reduce the cme of s and es to a cme only containing s. for the reduced cme, the propensity function for the overall reaction s → p is

  α=vmaxskm+s, 

where the volume was scaled so that Φ =  <dig> and the lower-case letter s denotes the molecule count of species s. instead of reviewing the relatively complicated manipulations with cme, we show in the following that the techniques described above lead directly from the equation-based model to the propensity function for the reduced system.

first, we recast the equation-based model into the gma format  <cit> , by introducing an auxiliary variable  ≜ km + . the result,

  ddt=-vmax-1ddt=ddt=-vmax- <dig> 

is exactly equivalent to the reduced system in  with the initial condition  <dig> and  <dig> = km +  <dig>  the corresponding stochastic model has only one reaction channel and the propensity function is

  α=vmaxst- <dig>  

the propensity adjustment factor can be set to  <dig> because t is a function of s and its covariance with s is therefore  <dig>  by applying t = km + s, the propensity function can be simplified as

  α=vmaxst-1=v
maxs-1=α. 

thus, we arrive at the propensity function for the reduced system, which is identical to the result of rao and arkin obtained through manipulations of cme.

in the above derivation, we used the simplest type of recasting, where a new, auxiliary variable simply consists of an old variable plus a constant. this reformulation of the michaelis-menten process as a pair of gma equations is a special case of a much more general recasting technique that permits the equivalent conversion of any system of ordinary differential equations into a power-law format  <cit> . however, this equivalence transformation imposes constraints on the variables of the gma equations, and it is at this point unclear whether there are mathematical warranties ensuring that the proposed transition from differential to stochastic equations in general preserves these constraints in all cases. this question will require further investigation.

stochastic focusing
stochastic focusing  <cit>  describes the phenomenon that the fluctuations of a chemical species can drive the system to reach a different steady state than what a deterministic ode model predicts. to demonstrate the utility of propensity adjustment, we derive a stochastic model which produces consistent results with those of the deterministic model.

following  <cit> , we consider the following reactions system

  ϕ→k1i→k2p→k3ϕi+s→k4ss⇌k5k6ϕ 

this system can be interpreted as follows: the intermediate species i is produced at constant rate k <dig> from some source Φ and degrades with rate k <dig> through the catalysis with signalling molecule s; the end product p is converted from species i at rate k <dig> and degrades at rate k3; the signalling molecule s is produced and degrades at rates k <dig> and k <dig>  respectively. moreover, the value of k <dig> is reduced to half at a certain time point to achieve a significant divergence effect. in order to capture the average dynamics of the system accurately, we use a power-law model in gma format instead of the mass action rate law in  <cit> .

  didt=k1-k2i-k4ifisfsdpdt=k2i-k3pdsdt=k5-k6s 

the system size is set to  <dig>  we can see from equations  that two variables i and s contribute to the degradation of i and that their covariance could therefore affect the propensity function of i in the degradation reaction of a stochastic simulation. to calculate the propensity adjustment function paf <dig> = exp , log s]) for reaction r4:i+s→k4s, we formulate equations ) for the moments as

  ∂μ∂t≈vtα+12α″⊙σ∂σ∂t≈)t+σ+vtΛv. 

here μ = t, v=100-1100-10-10000100- <dig>  α=α1α2α3α4α5α6=k1k2ik3pk4ifisfsk5k6s.

moreover, for r =  <dig>  ...,  <dig> and m, n = i, p, s, mn=∂2αr∂m∂n, α" = t, σ=σ11σ12σ13σ21σ22σ23σ31σ32σ <dig>  αr″⊙σ= ∑m,n=i,p,s∂2αr∂m∂nσmn, α"⊙ σ ≜ t, α' = , αr′=∂αr∂i,∂αr∂p,∂αr∂st, and the diagonal matrix Λ is defined by rr=αr+12∑m,n=i,p,s∂2αr∂m∂nσmn.

the stochastic focusing model without propensity adjustment yields results quite different from those of the deterministic model, as is illustrated in figure  <dig>  in this figure, the blue lines in the 1st panel are predicted from the moment equations  and the blue error bars for μp in the 2nd panel are obtained from ten independent stochastic simulations. both diverge systematically from the black line predicted by ode model . by contrast, the stochastic model with propensity adjustment produces results consistent with the deterministic model, as shown by the 4th panel.

discussion
it is often implicitly assumed that the rate of a dynamic process can be directly taken as the propensity for a corresponding stochastic process. we have shown here that this is sometimes, but not always, true. our results fall into three categories. the first develops conditions for a valid conversion of a rate to a propensity, the second presents a general conversion procedure, and the third discusses computational issues of propensity adjustment.

conditions for the direct use of a rate constant  as propensity function
we have shown that the direct use of a rate constant or a rate function f as the propensity function in a stochastic simulation algorithm requires that at least one of the following assumptions be true:

1) f is a linear function; this assumption has been validated in the results sections addressing 0th-order and 1st-order reaction kinetics.

2) the reaction is monomolecular; this assumptions was evaluated in the results section describing real-valued order monomolecular reaction kinetics.

3) all xi in the system are noise-free variables, i.e., without  fluctuations; this assumption implies that the covariance of any two participating reactants is zero . this assumption is assessed in equations .

each of these three conditions is a sufficient condition for the direct use of a rate function f as the propensity function. moreover, these statements are valid for functions of a general format, not just for gma. this is so because the functional formats in cases  <dig> and  <dig> above are special cases of the gma format. for the third case, a formal proof is only given for functions in gma format, because this structured format allows us to give an explicit estimation on how the covariance can affect the average behavior of a stochastic simulation through equation . for functions not in gma format, the conclusion is still holds, although an analogous explicit estimation is lacking. the argument is as follows. the bimolecular reaction e contains at least one quadratic moment of the form e . therefore, by definition of the covariance, e = ee + cov , xj), we obtain

 exixj=exiexj⇔covxi,xj= <dig>  

this result implies the following: if the covariance between every pair of random variables is zero , we have e = ee and therefore e = αr]). expressed in words, the expectation of the propensity function on left-hand side of equation  equals its rate function, and the rate function can be directly used as propensity function in stochastic simulations.

if at least one of the three assumptions is satisfied, the stochastic simulation algorithm  is applicable without changes.

a general procedure for converting an equation-based model into a stochastic analogue
in the past, efforts have been made to manipulate the chemical master equation  in order to achieve a proper propensity function for a reduced system . however, manipulations of cme are usually complicated, and successes have been modest and rare. here we propose an alternative strategy for converting a reduced dynamical model into a stochastic analogue. to achieve this conversion, we addressed two fundamental issues: first, under what conditions can a deterministic, equation-based model be validly used in stochastic simulations? and second, what is a proper strategy to implement such a conversion?

to address the first question, we showed that the following steps are necessary:

 a concentration-based model needs to be converted into a particle-based model by accounting for the size of the system; if the concentration-based model is scaled , it may first have to be un-scaled in order to render the conversion valid;

 the difference between the mean of a stochastic model without propensity adjustment and the corresponding quantities of the equation-based model should be evaluated. the mean of the stochastic model is obtained either through stochastic simulations or through a moment-based approach. if the difference is significant, then an adjustment of the propensity function for a non-elementary reaction is necessary.

to answer the second question, we need to execute the following steps

 compute a propensity adjustment function, either through simulated or experimental data or through a moment-based approach, in order to achieve the corrected propensity function ;

 apply ssa or one of its variants using a propensity function with adjustment to obtain valid simulation trajectories.

computational issues of propensity adjustments
when the propensity needs adjusting, an accurate propensity adjustment function  is essential for obtaining the proper correction of the propensity. it is usually impossible to compute paf exactly, which necessitates a suitable approximation. the approximation error in paf originates from the following sources:

1) the expression of paf in equation  is a function of the mean, variance, and covariance, which are computed with a 2nd-order taylor expansion in log space.

2) the moment-based approach, from which the functions of mean, variance and covariance are usually derived, is an approximation method that yields a closed ode system for the moments. in the method used here, the propensity function is approximated by a 2nd-order taylor expansion, and the moments up to a certain degree  are retained, while all higher moments are assumed to be zero. one might expect that a higher-order taylor expansion would improve the accuracy of paf, but it would come with a much higher computational cost. the error control of paf and the relative computational issues should be addressed in future studies.

since computation cost is a major concern with the stochastic simulation of large biochemical reaction networks, another issue has yet to be addressed. namely, how does the propensity function of a reduced system affect the accuracy and efficiency of various leaping methods that have been proposed to speed up ssa? moreover, the question of molecular population sizes requires further analysis. our derivation assumed large reactant populations, but simulations of a reversible pathway indicated that the method works rather well even for small populations. a more careful investigation of this issue of population size in different scenarios is still needed and should be the subject of further research.

CONCLUSIONS
gillespie's stochastic simulation algorithm , as well as later variants, permits three kinds of elementary reactions to be modelled: 0th, 1st and 2nd order reactions that are assumed to follow the law of mass action. all other types of reactions, containing non-integer kinetic orders and/or following other types of kinetic law, are assumed to be convertible to one of these three kinds, so that ssa can validly be applied. however, the conversion to elementary reactions is often difficult, infeasible, or simply impossible. first, the kinetic parameters of the underlying elementary reactions are in many cases unknown for a complex-order reaction. second, even when all elementary kinetic parameters are available, the multitude of reaction channels and participating species creates a combinatorial complexity that renders ssa simulations computationally impractical. within a deterministic framework, model reduction is a possible and often-used strategy to address such challenges. for example, a reduced mechanistic model, such as the michaelis-menten rate law, is often proposed to fit the experimental data, at the cost of sacrificing the original mechanistic interpretation. the reduction in these cases simplifies the original formulation by approximating, merging, or omitting intermediate reaction steps and reactants.

in this article, we propose a rather general strategy for converting a deterministic process model into a corresponding stochastic model and characterize the mathematical connections between the two. the deterministic framework is assumed to be a generalized mass action system and the stochastic analogue is in the format of the chemical master equation. the analysis identifies situations: where a direct conversion is valid; where internal noise affecting the system needs to be taken into account; and where the propensity function must be mathematically adjusted. the conversion from deterministic to stochastic models is illustrated with several representative examples, including reversible reactions with feedback controls, michaelis-menten enzyme kinetics, a genetic regulatory motif, and stochastic focusing. the construction of a stochastic model for a biochemical network requires the utilization of information associated with an equation-based model. the conversion strategy proposed here guides a model design process that ensures a valid transition between deterministic and stochastic models.

authors' contributions
jw developed the mathematical derivations, designed and performed the simulation, and drafted the manuscript. bv contributed to the statistical reasoning and revised the manuscript. ev supervised the research and revised the manuscript. all authors read and approved the final manuscript.

supplementary material
additional file 1
derivation of the mean and variance of a power-law function of random variables.

click here for file

 additional file 2
computation of approximate mean and covariance for a generic propensity function to be used in stochastic simulations.

click here for file

 acknowledgements
the authors thank dr. yi jiang for useful comments and for providing seminal references. the authors also appreciate dr. mukhtar ullah's and dr. olaf wolkenhauer's insightful comments and conceptual clarifications. this work was supported in part by a molecular and cellular biosciences grant  from the national science foundation. any opinions, findings, and conclusions or recommendations expressed in this material are those of the authors and do not necessarily reflect the views of the sponsoring institutions.
