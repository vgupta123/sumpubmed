BACKGROUND
bacteriophage  are the most abundant replicating entities on earth, involved in processes at scales from global biogeochemical cycles  <cit>  to the human gut  <cit>  to the control of bacterial infection in medical  <cit>  and industrial  <cit>  applications. rapid evolution of phage and their hosts imply that evolutionary dynamics are likely to be a factor in many natural and applied scenarios; thus understanding how phage affect the evolution of host bacteria is of key importance. close interaction between phage and their hosts often leads to significant antagonistic coevolution  <cit> . while it is hard to generalise, there is good empirical  <cit>  and theoretical  <cit>  evidence that in many cases coevolution between bacteria and bacteriophage leads to host diversification. this raises the question of how such diversification affects the overall evolutionary trajectory of host bacteria that are also evolving under other selection pressures, e.g., from environmental conditions and resource competition. when coevolving traits do not affect other functions, coevolution and evolution of functional traits may be orthogonal and proceed independently. however, coevolving traits often appear to have a significant impact on host growth and/or reproductive rate  <cit> , so that coevolutionary and evolutionary processes interact.

evolution is often visualised as movement of a population on an ‘adaptive landscape’  <cit>  which associates a fitness value with each genotype in some genetic space. a commonly discussed phenomenon is that populations can become converged on local peaks in the adaptive landscape and thus prevented from reaching higher peaks by intervening ‘fitness valleys’. here it is proposed that the diversifying effect of specialist phage offers a mechanism by which host populations can adapt across fitness valleys to reach globally higher levels of fitness. this can be visualised by the thought experiment shown in figure  <dig>  which shows how phage-driven diversification might alter host adaptive dynamics. diversification in response to phage action allows the host community to sample a larger region of the adaptive landscape than mutation alone, increasing the likelihood of discovering higher fitness peaks. the pre-conditions for this mechanism to operate are  diversifying selection from phage, and  some form of genetic linkage between resistance and fitness.

diversification of bacteria in response to phage predation has been hypothesised as a possible explanation for naturally observed high prokaryote diversity  <cit>  and inferred from laboratory studies and genomic data  <cit> . theoretical models of planktonic food-web ecology predict that selective viral predation can maintain host diversity by preventing dominance of host types that would otherwise monopolise available resources . the creation and maintenance of host diversity can be facilitated by high specificity of phage infection, whereby each phage strain is specialised on a limited range of hosts. this creates negative frequency-dependent selection that favours rare host genotypes. theoretical models showing diversifying selection include matching-alleles models of infection genetics  <cit>  and lock-and-key models of coevolutionary adaptive dynamics  <cit> . empirical evidence for phage-induced diversification of bacteria comes from recent studies demonstrating fluctuating selection dynamics  <cit> , in which there is continual reciprocal adaptation of both partners without directional change in overall infectivity or resistance  <cit> . other laboratory coevolution studies have shown that phage can increase allopatric diversity in spatially structured host populations due to local adaptation  <cit> .

meanwhile, empirical data shows that resistance is often linked to host growth and/or reproductive rate  <cit> , so that different resistance phenotypes have differing fitness in the absence of phage. there are two ways in which host traits involved in resistance might affect growth rate:  pleiotropy at related genetic loci, and  costs associated with resistance mechanisms. if coevolving traits are subject to pleiotropy, then diversification of resistance traits will also create diversity in linked traits. alternatively, if different resistance phenotypes have different growth costs, diversification will lead to selectable variation in replication rate. either way, growth rate and resistance make distinct  contributions to overall fitness, and the diversifying effect of specialised phage might affect evolution of growth-related traits.

the scientific question addressed by this paper is how phage-host coevolution affects host evolutionary dynamics when specialist phage impose frequency-dependent selection. the coevolutionary study is based on an ecological model of bacteria and phage in a resource-limited chemostat, linked to an evolutionary model  in which host growth rate and resistance traits are pleiotropically linked  <cit> . this model is described in the next section. results are then given showing that frequency-dependent selection from phage creates stable high diversity in hosts, whereby resources are partitioned between multiple subpopulations maintained by the balance between resource competition and predation. the standing diversity thus created allows the host community to respond quickly to environmental changes, improving adaptive capacity in dynamic environments. furthermore, local trade-offs between resistance and growth allow host strains to adapt across fitness valleys to reach higher fitness peaks, thus improving adaptation on rugged adaptive landscapes. finally, some implications of these findings are discussed in the broader context of ecological and evolutionary theory.

methods
the model used represents bacteria and bacteriophage coevolving in a resource-limited chemostat, where infection rate is based on genetic similarity. host resistance and growth rate are pleiotropically linked, inspired by  bacterial uptake receptors that are also phage attachment sites. random mutations introduce new strains into the ecological dynamics. this model is studied for several different underlying relationships between growth rate and resistance phenotypes. dynamics of the model are numerically resolved. in contrast to analytical approaches to adaptive dynamics  <cit> , and in accordance with observed rapid evolution of bacteria and phage  <cit> , ecological and evolutionary timescales are not explicitly separated. additional details on methods are given in appendix appendix a: supplementary methods. all symbol definitions and parameter values are given in table  <dig> 

variables can change during a simulation, derived values are deterministically calculated from other variables/parameters. numerical values are parameters fixed for the duration of a simulation.

multi-strain chemostat model
the model represents the growth and interaction of a diverse community of bacteria and bacteriophage growing in a well-mixed single-resource chemostat. the model scheme is a variant of a reasonably well-studied type originally formulated for single-strain studies . here a multi-strain formulation is used in which mutations can introduce new variants of bacteria and phage, while uncompetitive strains are eventually removed by chemostat dilution . this creates a simple model in which bacteria and phage phenotypes can evolve by natural selection.

ecological state dynamics for resource concentration r and the density of each host ni and phage vjpopulation in the chemostat are governed by the following equations: 

  drdt=−ω−∑iεγrniδir+k 

  dnidt=−ωni+γrniδir+k−∑jθijnivj 

  dvjdt=−ωvj+∑iβθijnivj 

resource concentration is determined by supply concentration r <dig>  chemostat flow rate ω, and by the total uptake of resource by all bacterial populations . the density ni of the ith bacterial population is controlled by washout, growth, and mortality from phage . a monod-form uptake-limited growth model is used whereby population growth is determined as a function of resource concentration, maximum uptake rate γ, half-saturation constant k, and a genetically encoded scaling factor δi. the density vj of the jth phage population is determined by washout and production. phage production is determined as the sum of production on all available hosts, assuming fixed burst size β and adsorption rate θijfor phage j on host i . only single infections are permitted and lysis is instantaneous, i.e., there is no latent period.

evolutionary process
the evolutionary model incorporates a stochastic mutation process into the deterministic ecological dynamics described above. each distinct bacterial genotype hiand phage genotype vjin the current community is instantiated as a population. bacteria and phage both evolve within a one-dimensional genetic space, i.e., each distinct genotype can be represented by a point on a line and adaptation occurs by movement along the line. normally distributed mutations are applied to every new cell and phage particle . since diversity is binned and standard deviations are small, most mutations have zero effect and offspring inherit the parental genotype.

following mutation, a new population that instantiates the novel genotype is added to the system. if the density of any population falls below  <dig> cellml−1or  <dig> virionml− <dig>  that population is assumed to be lost and is removed from the system. thus the ecological dynamics of the chemostat determine which genotypes invade or go extinct, based on phenotypic traits, without explicit separation of evolutionary and ecological timescales.

bacterial resistance and growth rate traits, and phage infection traits, are allowed to evolve during each simulation. all other traits are universally fixed, although some are experimentally manipulated between simulations. bacterial genotypes h are mapped to phenotypic traits for resistance ĥ and growth rate δ. phage genotypes v map to an infection trait v^. see appendix appendix a: supplementary methods for details of the genotype-phenotype mapping.

growth rate is derived from genotype using several different mappings to test model behaviour in different scenarios. all mappings create a growth rate landscape that determines the growth rate scaling factor δ as a function of genotype h. manipulations include varying the number of peaks in the growth rate landscape and varying the relative height of different peaks. localised ruggedness is introduced  by adding a random noise signal and smoothing the result to differing degrees. details of how landscapes are derived are described fully in appendix appendix a: supplementary methods and also where appropriate in the presentation of results.

infection model
the infection model assumes that the likelihood of infection of a bacterial host with genotype hi by a phage with genotype vjfollowing contact depends on their genetic similarity; infection rate is maximised when hi=vj and decreases as genetic distance |hi−vj| increases. this model can be viewed as instantiating phenotypic coevolution corresponding to a ‘relaxed lock-and-key’ scheme in which infection can occur with some degree of genetic dissimilarity  <cit> .

the rate of infection is calculated as a gaussian function of the distance between the resistance ĥ and infection v^ traits. thus the adsorption coefficient θij, which sets the adsorption rate for phage vjon bacterial host hi, is calculated as: 

  θij=ϕe−s <dig> 

where ϕ is the maximum possible adsorption rate and s is a sensitivity parameter that controls the host specificity of phage. tuning the value of s alters the rate of decline in adsorption rate as dissimilarity increases. every successful adsorption event is assumed to result in infection and instantaneous cell lysis, releasing a burst of β new phage particles.

RESULTS
the primary results presented here are from numerical simulations of the model described above, supported by steady-state analysis  where appropriate. this section first addresses the diversifying effect of phage on the bacterial population, which underpins subsequent examination of the evolvability benefits conferred on bacteria by coevolving phage, and their sensitivity to model parameters. full sensitivity analysis of model parameters is given in appendix appendix c: sensitivity analysis.

bacterial diversity from density-dependent phage predation
to illustrate the negative frequency-dependent selection pressure imposed on bacteria by density-dependent phage predation, simulations were performed in which bacteria evolved on a smooth single-peak adaptive landscape. figure  <dig> shows timeseries of resource concentration, total bacteria and phage density, and the density distribution of bacteria and phage in genotype space, together with fields showing bacteria/phage fitness landscapes over time, for an exemplar case study simulation. the simulation was initialised with a single bacterial host and perfect-match infectious phage  and run for a duration of t=20×106min. simulation parameters are given in table  <dig> 

the striking overall feature of this scenario is that there is rapid diversification of bacteria and correlated diversification of phage, corresponding to a pattern of frequency-dependent coevolution . consistent with ‘kill-the-winner’ ecological dynamics  <cit> , specialised phage limit host density, preventing competitive exclusion and maintaining diversity, with resources partitioned between multiple strains. phage predation selects for bacterial mutants with reduced susceptibility to infection by current dominant phage types. this creates diversifying selection on bacteria that leads to branching of the population into distinct clusters  separated in genetic space by intervening regions in which mutants are susceptible to multiple phage strains and thus maladaptive. host diversification selects for phage mutants that maintain infectivity by increasing genetic similarity to dominant bacterial strains. phage therefore diversify to track their evolving hosts. overall, bacterial populations act as attractors for phage in genetic space, while phage populations act as repellors for bacteria; the balance between these forces leads to the genetic dispersal of strains.

diversification is ultimately limited by resource competition. as hosts diversify, the total host density increases substantially, with associated draw-down of resource concentrations . without adaptation, the population density of a single bacterial host strain infected by perfect-match phage will tend to a lysis-limited steady state density that is significantly below the potential resource-limited carrying capacity of the system . however, resource partitioning allows multiple bacterial strains to coexist and collectively draw down resource to limiting levels . the value of r∗plotted in figure 2a shows the resource concentration at which the fastest-growing  bacterial strain would become resource-limited in the absence of phage . observed resource concentrations do not reach this theoretical minimum level, since the diverse community includes many strains with slower growth rates  and most strains are phage-limited. however, total bacterial productivity is still ultimately limited by resource supply, when the slowest-growing  strain in the community  reaches a resource-limited steady state. strain diversity at steady-state depends on system parameters and is positively related to resource supply .

figures 2d and 2g show the fitness landscapes for bacteria and phage over time, found by calculating the growth rates of hypothetical genotypes in the current biotic and resource environment at each timepoint . fitness landscapes for both bacteria and phage are highly dynamic, changing as a function of resource levels and the biotic environment. the overall selection pressure imposed on bacteria  is determined by contributions from growth phenotype δ and resistance phenotype ĥ . the phage fitness landscape  reflects the density distribution of bacteria, with positive growth only possible for phage genotypes with abundant hosts.

within the evolutionary dynamics, three qualitatively different phases can be distinguished. early in the simulation, bacteria can both increase growth rate and escape phage by adapting towards the fastest-growing phenotype . this synergy drives rapid adaptation of bacteria, tracked by rapid adaptation of phage. when bacteria reach the optimal growth phenotype, they can only escape phage by adapting downhill in terms of growth rate . this creates an evolutionary trade-off that allows diversification and coexistence of multiple strains. during this phase, repeated host divergence and phage counter-adaptation are observed, so that diversity of both phage and bacteria strains increases. finally, as the system approaches steady state, there are no significant fitness gradients to drive adaptation of either bacteria or phage  and the genotype distributions are relatively constant over time .

the rate of bacterial adaptation  is proportional to the deviation from a perfect linear correlation between growth and lysis across the bacterial community; the form of equation  <dig> means that genotype density only changes when there is an imbalance between growth and lysis rates. this can be seen in figure 2i, which shows the correlation between lysis and growth rates for all bacterial strains forming >1% of total density, observed during three time intervals at the beginning, middle, and end of the simulation. imbalances can occur when mutation adds new bacteria/phage strains  but are reduced over time by ecological dynamics. correlations increase over time, until at steady state, variation in growth rates is tightly correlated with variation in lysis rates, such that no net variation in fitness  is observed. in general, strong positive correlations are universally observed, showing that faster-growing host phenotypes experience greater levels of lysis; this highlights an ecological trade-off that allows multiple bacterial strains to coexist. coexisting strains have varying growth rates, but any selective benefit from increased growth rate is balanced by a cost from increased lysis, resulting in kill-the-winner dynamics  <cit> .

two evolvability benefits to hosts of specialised phage
having established the diversifying effect of specialist phage on host bacteria, the impact of diversification on bacterial evolution was explored. figure  <dig> shows evolutionary dynamics for paired case study simulations of bacterial evolution with and without coevolving phage. simulations are initialised with hinit=vinit= <dig>  in each case; the only parameter difference is the initial density of phage . two forms of adaptive landscape were used to demonstrate two distinct evolvability benefits to hosts of diversification driven by coevolving phage. in the absence of phage, bacteria are selected by resource competition to maximise growth rate and thus increase fitness by local hillclimbing. thus populations tend to become tightly converged on the nearest peak in the adaptive landscape. this leaves them unable to cross fitness valleys and on landscapes with multiple peaks they can become trapped on suboptimal local maxima. however, when forced to diversify by coevolving phage, it was found that:  standing diversity facilitates adaptation in dynamic environments, and  local trade-offs between resistance and growth allow populations to adapt across fitness valleys.

standing diversity facilitates adaptation in dynamic environments
the first scenario that was explored was bacteria evolving in a dynamic environment, using an adaptive landscape in which a second peak that sequentially increases in height was introduced alongside a static initial peak. figure 3a visualises this dynamic landscape by colour-coding the landscape profile used at different timepoints . on the dynamic landscape, bacteria evolving alone and coevolving with phage quickly adapt to the initial peak. when evolving alone, the bacterial population is tightly converged on the initial peak, with a small amount of diversity provided by mutation-selection balance. when coevolving with phage, bacteria diversify to form a set of distinct strains distributed symmetrically around the peak.

the standing diversity produced and maintained by specialist phage can facilitate more rapid opportunistic adaptation to novel environments. as the second peak is introduced, a fitness valley is formed that separates the initial static peak from the new dynamic peak. as the relative height of the new peak is sequentially increased over time, eventually it reaches a stage where one of slowest-growing strains of the bacterial community is within mutation range of the lower slopes of the new peak. this strain then adapts rapidly towards the new peak, driven by synergistic selection pressures for increasing growth rate and reducing phage predation. a new diverse community then forms around the second peak, ultimately displacing the community around the initial peak due to resource competition. in contrast, the bacterial population evolving alone is unable to access the second peak until the fitness valley is completely removed, remaining trapped at the initial peak even when it becomes sub-optimal.

it is important to note that this is a benefit of diversity per se and is not unique to diversity created by phage; alternative mechanisms that preserve diversity might achieve a similar benefit. however, one particular advantage of phage-produced diversity is that it is maintained at steady-state by kill-the-winner ecological dynamics, whereas some other diversity-producing mechanisms  might offer only transient diversity increases.

local trade-offs between resistance and growth allow populations to adapt across fitness valleys
the next scenario was bacterial evolution on a rugged adaptive landscape, with multiple local peaks separated by fitness valleys on a slope of globally increasing growth rate . as in the single-peak landscape example shown in figure  <dig>  the fitness benefit of escaping phage can counterbalance the fitness cost of moving downhill in terms of growth rate, allowing valleys to be traversed. on the multiple-peak landscape, bacteria diversify to form a fitness-neutral distribution in which most strains experience negligible selective gradients and do not adapt significantly once they arise. the only significant positive gradients are observed at the leading  edges of the strain distribution and this is where most adaptation  is observed, with the initial strain adapting steadily towards higher growth rates while new strains sequentially branch off. as the bacteria community climbs the landscape, slow-growing strains are lost at the trailing edge due to resource competition. as growth rates increase, more strains can enter the population  and bacterial strain diversity rises.

the proximate mechanism by which fitness valleys are crossed in this case study is a trade-off between local resistance and growth rate that allows host strains to adapt downhill in terms of growth rate. effectively, the host population is pursued across the valley by coevolving phage; at each stage, the transient benefit of escaping phage outweighs the cost of reduced growth rate. the population always follows positive local gradients in the net rate of density change. while crossing a valley, this implies decreasing growth rates, compensated by the decreased lysis rates that result from reduced susceptibility to dominant phage. this mechanism is a dynamic  effect of ecological trade-offs, and is distinct from the intrinsic benefit of steady-state diversity that is identified above.

controls on host diversification and evolvability
the ability to respond to a changed environment depends on the diversity of bacterial genotypes at steady state, which is determined by the balance between resource competition and phage predation; bacteria minimise dispersal away from the optimal growth phenotype, within the constraint of reducing phage infection . figure  <dig> shows the sensitivity of community-wide bacterial genotype variation with respect to resource supply , the slope of the adaptive landscape , and the host specificity  of phage. variation was measured from coevolutionary simulations on smooth single-peak landscape  using ensembles of simulation runs to account for stochastic effects. simulations were initialised with a single bacterial genotype and matched phage genotype at the optimal growth phenotype  and run for t=5×106min. variation was measured as the total range of genotypes  in the final bacterial community for which the corresponding strain density represented >1% of the total community. the range of host genotypes at steady state is positively related to resource supply r0; more strains can be supported with greater available resource. since the separation between strains is held roughly constant, adding more strains implies greater overall variation. genotype range is negatively related to the gradient of the landscape. thus for a fixed maximum growth rate δmax it is positively related to the minimum growth rate δmin, which controls the cost of diversifying away from the optimal growth phenotype. host genotype range is negatively related to the specificity s of the phage, i.e. negatively related to the rate of decline in infection rate with genetic dissimilarity.

to quantify the ability of phage to drive bacteria across fitness valleys using local trade-offs, ensembles of simulations were performed on rugged-slope landscapes formed by adding a uniform-random noise signal to a smooth linear slope , measuring sensitivity of bacterial adaptation to specificity of phage  and the ruggedness of the landscape . for each value of span, an ensemble of landscapes was generated. on each landscape, a simulation was then performed with bacteria evolving alone, followed by multiple coevolutionary simulations varying the specificity parameter s. all simulations were initialised with the same seed strains  and run for t=20×106min. adaptation was measured by recording the maximum growth rate  in the final bacterial community at the end of each simulation.

overall, standing diversity  is increased by generalist phage  and shallow growth rate gradients . however, specialist phage offer the greatest evolvability benefit on rugged landscapes, since they can drive host populations across deeper fitness valleys.

discussion
the phage-driven establishment and maintenance at steady state of high bacterial diversity recapitulates kill-the-winner ecological dynamics  <cit> , supporting arguments that such dynamics can arise by coevolution  <cit> . in the model used here, bacteria and phage coevolve until variation in lysis rates balances variation in growth rates, so that negative frequency-dependent selection gives way to emergent fitness neutrality at steady state. this can be seen in figure  <dig>  which shows that most bacteria/phage strains experience fitness gradients close to zero as steady state is approached, with tight correlations between growth and lysis rates. however, kill-the-winner dynamics are ongoing and do not require coevolutionary steady-state; figure  <dig> also shows that there is always a strong correlation between growth and lysis, even during periods of rapid evolutionary change.

the high bacterial diversity maintained by phage at steady state in this model is consistent with explanations of observed hyper-variable regions in marine prokaryote genomes as the product of selection by phage predation  <cit> . the prediction of host diversification caused by phage is also supported by results from laboratory studies with coevolving bacteria and phage . however, in its current form  the model does not address the interesting further questions of how population structure, environmenal heterogeneity and dispersal might affect coevolutionary diversification  <cit> .

monotonic trade-offs between resistance and growth rate can occur in directional coevolution . in such scenarios, coevolving phage can only drive a decrease in host growth rates; as hosts evolve to become more resistant, their growth rate is reduced. frequency-dependent coevolution does not permit monotonic trade-offs due to the specificity of infection and resistance; any increase in resistance to a given phage implies decreased resistance to other phage. however, here transient ecological trade-offs between growth rate and resistance relative to the current phage population were observed. host mutants could temporarily reduce their susceptibility to phage predation, to an extent that permitted bacterial subpopulations to adapt downhill in terms of growth rate and cross valleys in the adaptive landscape. furthermore, the local trade-offs that were observed allowed hosts to increase resistance by mutating in any direction that increased genetic distance, suggesting that selection for avoiding density-dependent phage predation should drive host exploration – and ultimately adaptation – on any underlying adaptive landscape.

here specialised phage remove ruggedness in the local fitness landscape and allow coexistence of multiple fitness-neutral host strains. it is interesting to speculate that this ecologically mediated fitness neutrality might perform a similar role to neutrality in the genotype-phenotype map in molecular evolution, where the existence of multiple genotypes coding for the same phenotype improves evolvability by increasing the size of the single-mutation genetic neighbourhood and thus expanding the set of adjacent phenotypes  <cit> . similar evolvability advantages might be gained in the coevolutionary scenario described here, where the fitness-neutral strain assemblages that result from frequency-dependent coevolution increase the set of adjacent genotypes by virtue of their genetic diversity.

the results presented here also have echoes of sewall wright’s hypothesised effect of “mass selection under changing conditions”  <cit> , in which adaptation towards a novel adaptive peak in a changed environment creates a persistent genetic shift that orients the population towards an alternate peak when the original adaptive landscape is restored. here the “changing condition” is the introduction of phage , which degrade existing adaptive peaks due to the negative frequency-dependent selection they impose. if phage were removed from the coevolutionary scenario, the bacterial community would converge to the highest peak in the explored region of the adaptive landscape, consistent with sewall wright’s hypothesised mechanism. this theoretical prediction may be suitable for experimental testing; although previous attempts  <cit>  did not observe a clear shift to a new fitness peak, the mechanistic reasons for this were not fully explored.

biological evolution is far more complex than the simple model presented here, yet biological fitness landscapes are known to be highly dynamic and to often display multiple local optima, neutrality, and ruggedness. here the presence of specialist phage performs a local smoothing of the fitness landscape, with differential predation increasing or reducing fitness from the baseline given by growth rate. this dynamic smoothing prevents the population from becoming trapped at local maxima in the adaptive landscape and thereby permits more effective adaptation towards global maxima. in addition, high standing diversity  aids adaptation to changing environments. thus over time the evolving bacterial community is able to discover progressively higher growth rates, which would be selectively favoured even in the absence of phage, but which could not have been discovered without the presence of coevolving phage. thus coevolution with phage offers an ‘adaptive bridge’ to higher absolute growth rates that would not otherwise be reached.

CONCLUSIONS
a simple model of coevolution between bacteria and bacteriophage was used to explore the impact of phage-driven diversification on bacterial evolution. diversification of host resistance phenotypes significantly altered evolutionary dynamics of pleiotropically linked growth phenotypes, offering two distinct evolvability benefits:  the intrinsic benefit of higher diversity in adapting to novel environmental conditions, and  a specific benefit from local trade-offs between resistance and growth that allowed adaptation across fitness valleys. thus in scenarios where the key assumptions of the model are satisified , phage can confer an evolutionary benefit on host populations. these findings have implications for the role of phage in ecosystem processes, since they predict that over long timescales the presence of phage would enable host bacteria to discover fitter genotypes with higher growth rates, with subsequent impacts on productivity, nutrient dynamics and biogeochemical cycles. the results also suggest that the use of phage to control bacterial infections in therapeutic or industrial applications might have unintended negative consequences by promoting more rapid bacterial adaptation.

appendix a: supplementary methods
mutation
at each integration timestep, the number of mutations is calculated based on the instantaneous production rate of new particles and the mutation rate , scaled by chemostat volume l. thus for bacterial genotype hi, the number of new mutants at each integration timestep is found as mblγrniδir+k, while for viral genotype vj the number of new mutants is mvl∑iβθijnivj. for each new cell or virion produced, the offspring genotype is found by adding a normal deviate to the parental genotype, that is, hmut=hi + μh where μh is a random value drawn from a normal distribution with mean  <dig> and standard deviation σb.

genotype-phenotype mapping
bacterial genotypes h are mapped to phenotypic traits for resistance ĥ and growth rate δ. phage genotypes v map to an infection trait v^. thus h→{ĥ,δ} and v→v^. the mappings for resistance/infection traits are simple: ĥ=h and v^=v. in the absence of sufficient empirical data to generalise the relationship between host resistance and growth rate, this relationship is experimentally manipulated to explore associated coevolutionary dynamics. in all cases, a landscape is created that associates a growth rate with every bacterial genotype; this is done by mapping genotype hi∈ <cit>  to growth rate scaling factor δi∈, that is, δ=f for some landscape function f.

four kinds of adaptive landscape were used: smooth single-peak, dynamic two-peak, multiple-peak, and rugged-slope. the smooth single-peak landscape  is a piecewise linear function of h, created by drawing straight lines on the  axes to join point  to  to . the dynamic two-peak landscape  is found by taking the maximum value from two single-peak landscapes found as before; the second landscape becomes sequentially higher over time. the multiple-peak landscape  is created by composing the landscape of n repeated blocks. in each block, the mapping follows an up-down-up motif, i.e. within each block, straight lines join the points  to  to  to , where bw=1n is the block width and bh=δmax−δminn is the block height. the last point in each block is first point in the next, creating a saw-toothed increasing gradient. the rugged-slope landscapes  are created by adding a uniform random noise signal  to a smooth linear gradient from  to , then smoothing the result using a moving-average window of width span.

numerical method
model code, integration and visualisation are performed in matlab; code is available on request. simulations are initialised with a single bacterial population and infectious phage, then integrated forward for t minutes using a 4th order runge-kutta method with timestep Δt. genotype diversity for both bacteria and phage is binned at a resolution of ρ, setting the minimum distinguishable genetic variation. the working range of possible genotypes for both bacteria and phage is set to be h,v∈ <cit> ; simulation parameters are chosen such that genotype distributions stay within this range and simulations in which range edges are reached by mutation are discarded to avoid artefactual results.

calculating fitness landscapes
figures  <dig> and  <dig> include plots of the fitness landscapes on which bacteria and phage evolve during the case study simulations. these are found by calculating the hypothetical net population growth rate for all possible genotypes at each timestep, to generate a field showing the expected rate of change of density for any genotype in the current environment over time. assuming that the rate of change of genotype density is a measure for fitness, these fields correspond to time-dependent fitness landscapes for bacteria and phage.

the net rate of genotype density change for hypothetical bacterial genotype hx at time t = t′ are calculated as a function of cell growth rate, lysis and washout for the current resource concentration and virus community, i.e. using equation  <dig> to evaluate dnxdtt=t′ with values r and vj. growth rates are calculated as δxγrr+k and expected lysis rates are calculated as ∑jθxjvj. similarly the net rate of genotype density change for hypothetical phage genotype vx is predicted as a function of production and washout based on the current bacterial community composition, i.e. using equation  <dig> to evaluate dvxdtt=t′ with values ni.

the overlayed density contour shows the distribution of the bacteria and phage communities in the landscape, showing how they adapt over time in response to the dynamic fitness landscapes.

appendix b: steady-state analysis
steady state density for a single bacteria strain without phage
for a single strain of bacteria in the absence of phage, equations  <dig> and  <dig> simplify to: 

  drdt=−ω−εγrnδr+k 

  dndt=−ωn+γrnδr+k 

setting dndt= <dig> yields: 

  r¯=ωkγδ−ω 

as the steady-state value for r. setting drdt= <dig> yields: 

  n¯=−ωωkγδ−ω−r0ωkγδ−ω+kεγδωkγδ−ω 

as the steady-state value for n. for δ=δmax, this gives the lowest possible value of r¯  and the highest possible value for n¯ . n∗ is the resource-limited carrying capacity of the system and r∗is the limiting resource concentration when it is reached.

steady state density of a single bacterial strain with phage
for a single strain of bacteria with associated perfect-match phage, equations  <dig> and  <dig> simplify to: 

  dndt=−ωn+γrnδr+k−θnv 

  dvdt=−ωv+βθnv 

solving dvdt= <dig> for n gives: 

  n^=ωβθ 

as the steady-state density of bacteria limited by phage predation. substitution of parameter values from table  <dig> shows that n^<n¯, thus phage limit bacterial growth below the resource-limited carrying capacity for reasonable values of r <dig>  equation  <dig> can also be solved for dndt= <dig> to give: 

  v^=−ωθ+γθrδr+k 

showing that phage density is correlated with host growth rate at steady state.

steady state density for multiple bacterial strains with phage
to examine steady state densities for the multi-strain model, the system was simplified so that infection depends on a perfect genetic match, i.e., equation  <dig> was replaced with: 

  θij=ϕifĥ=v^0otherwise 

then equations  <dig>   <dig> and  <dig> become: 

  drdt=−ω−∑iεγrniδir+k 

  dnidt=−ωni+γrniδir+k−ϕnivi 

  dvjdt=−ωvj+βϕnjvj 

by equation  <dig> we have: 

  nj^=n^=ωβϕ 

note that n^ is a constant and holds for any bacterial strain with an associated phage, i.e. all hosts with infectious phage will have an equal density at steady state. solving equation  <dig> for dnidt= <dig> gives: 

  vi=−ωϕ+γϕrδir+k 

since r is fixed at equilibrium, this shows that host density is constant for all δi, while phage density varies positively with host growth rate.

calculating diversity at steady state
from the analysis above, the limiting resource concentration for a single strain hi is given as ri¯=ωkγδi−ω. if strain hi is introduced to the system, it can establish a population if r>ri¯, and will then  draw down resource to the limiting concentration r¯i. thus strain hi will competitively exclude any strain hjwhere ri¯<rj¯ .

now suppose there exists a set of h possible host strains that each have unique growth rate scaling factors, labelled h <dig> ..,hh such that δ1>δ2>..>δh. since ri¯ depends inversely on δi, it follows that r¯1<r¯2<..<r¯h. thus in the absence of phage, strain h1should competitively exclude all other strains. however, in the presence of infectious phage, the density of strain hi is limited to n^ and thus strain hi is unable to draw down resource concentrations to r¯i. instead, resource concentration will stabilise at some r′>ri¯ and strain hi will only competitively exclude other strains hjwhere r′<rj¯.

for simplicity and without loss of generality, assume that  host strains are introduced into the system in order of decreasing growth rate, and  novel strains quickly acquire an associated phage. then strain h <dig> can enter the system if r0>r¯ <dig> and will grow to phage-limited density n1=n^, drawing down resource to a phage-limited equilibrium concentration, here labelled r^ <dig>  then strain h <dig> can enter the system if r^1>r¯ <dig>  drawing down resource further to concentration r^ <dig>  and so on. to generalise, let r^i be the equilibrium resource concentration when all strains h <dig> h <dig> ..,hihave all established in the system and reached their phage-limited equilibrium density, such that n1=n2=..=ni=n^. the value of r^i can be found by solving equation  <dig> at equilibrium for the conditions n1=n2=..=ni=n^=ωβϕ and ni + 1=..=nh= <dig>  this gives a quadratic in r^i which has one positive root given by: 

  r^i=r0−k−εγ∑j=1iδjβϕ+r0−k−εγ∑j=1iδjβϕ2+4r0k <dig> 

now suppose strains are added sequentially until the system reaches steady state and no further strains can invade. let x be the number of coexisting host strains at steady state. then strain hxis the slowest-growing strain in the final host community and it follows that nx<n^ . it also follows that r^x−1>r¯x>r^x. the expressions for r^i and r¯i can be used to find x by iteratively comparing r^i and r¯i for i= <dig> ,.. until the case is found where r¯i>r^i, which corresponds to strain hi establishing a resource-limited population with ni<n^, i.e. hi=hx and x=i.

note that this method does not depend on the order in which species are originally introduced; eventually the system will converge to the equilibrium condition described here, though transient dynamics would vary. to confirm this observation, suppose that there are two strains ha and hb that coexist at equilibrium. to show that the order in which haand hb were introduced does not matter, we need to show that ha can establish in the system when hb is already present, and vice versa. let r^a+b be the equilibrium resource concentration when both strains are present and limited by phage. let r^a and r^b be the phage-limited equilibrium resource concentrations for the system with ha alone and hb alone respectively. by the form of equation  <dig> we know that r^a>r^a+b and r^b>r^a+b. we know that r¯a<r^a+b, and also that r¯b<r^a+b, since if this were not true then the species would not coexist at equilibrium. then by transitivity we have that r¯a<r^a+b<r^b and also r¯b<r^a+b<r^a, meaning that either strain can establish a population at the phage-limited equilibrium resource concentration imposed by the other. thus the order of introduction does not matter.

stable coexistence with strict lock-and-key infection requires variation in host growth rates
as an interesting corollary, consider the case where all bacterial growth rates are equal, i.e., where δ1=δ2=..=δh. then r¯1=r¯2=..=r¯h=r¯. as before, a novel host strains can establish a population when r>r¯. the method above can be used to calculate the maximum host diversity for the case in which all strains support phage. however, consider the first strain hxthat enters the system and reaches a resource-limited steady state with nx<n^, i.e. the first strain that becomes established but does not reach sufficient density to support phage. this strain will draw down resource to r¯x=r¯, at which point dnidt< <dig> for any strain with infectious phage, i.e. for all i < x, since all strains hi<xhave associated phage populations which reduce their density. thus their density will fall, so that ni<x<n^ and dvidt< <dig> for associated phage. eventually either the host or the associated phage will go extinct, so that the only remaining bacterial strains are phage free. thus the strict lock-and-key model implies that stable coexistence of hosts and phage cannot be achieved without variation in host growth rates.

appendix c: sensitivity analysis
here we present some sensitivity analysis on model parameters. figure  <dig> shows how values of system state variables  are affected by increasing or decreasing various parameters . these values were calculated as the ensemble mean across  <dig> runs with each parameterisation , taking the final value of each variable after a run of 20× <dig> minutes. results are shown relative to a benchmark parameterisation using the values given in table  <dig>  while some systematic quantitative effects of parameter variation are observed , no qualitative differences in the overall pattern of coevolution was observed. in all cases, coevolution lead to branching of both hosts and phage, with stable high diversity at steady state. thus we conclude that the model results presented in the main text are robust to these parameter changes.

another sensitivity test was performed on the mutation rates of bacteria mb and phage mv. it was found  that the pattern of coevolutionary branching and stable coexistence was conserved over wide ranges of values for mb and mv. the only case when this pattern was disrupted was for mv << mb; in this case the phage were unable to adapt fast enough to maintain infectivity on their evolving hosts. eventually this resulted in phage extinction and reduction in host diversity by resource competition. the rate of bacterial mutation  affected the time taken for the system to reach an evolutionary steady state, with lower values increasing the time to convergence.

a brief survey of mutation rates measured for bacteria and bacteriophage in the literature suggests that in natural systems, mutation rates for phage are typically orders of magnitude faster than those of their hosts  <cit> . interestingly given the instability of coexistence in the current model when mv << mb, experimental coevolution has shown that bacteria may increase their mutation rates in the presence of coevolving phage, with an effect of causing phage to go extinct  <cit> . however, for biologically plausible relative rates of host and phage mutation, we conclude that the results presented in the main text are robust.

competing interests
the author declares no competing interests.

author’s contributions
hw conceived this study, carried out model development and analysis, and wrote the manuscript.

