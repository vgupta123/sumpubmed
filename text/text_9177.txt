BACKGROUND
genomic selection  is a method for predicting genomic breeding values using molecular markers covering the whole genome  <cit> . gs is fast becoming popular in plant and animal breeding  <cit> , because of recent advances in high-throughput marker technologies and accompanying reduction in the costs of genotyping.

the performance of genomic selection  procedures is often assessed by k-fold cross-validation   <cit> . accurate evaluation of the performance of genomic selection is difficult in practice because true breeding values are typically unknown. as result, simulation modeling is often used to generate breeding values as a basis for assessing the accuracy of genomic prediction  <cit> . once the true breeding values are available, the accuracy of genomic prediction can be expressed as the correlation between the true and the predicted breeding values. in this paper, we use simulated true breeding values to directly compute the true correlation  between the true and the predicted breeding values rg,g^ as a benchmark for evaluating the performance of seven contending methods. four of the seven methods  first estimate heritability h <dig> <cit>  and then divide the cross-validation sample correlation between the predicted breeding values  and the observed phenotypic values , predictive ability, by the square root of heritability h <dig> <cit>  to obtain an estimate of predictive accuracy rg^,p/h. the remaining three methods  estimate the predictive accuracy directly without having to first estimate heritability, even though method  <dig> also estimates heritability. here, we investigate the relative merits of the seven methods for estimating predictive accuracy using simulated breeding values. for five of the seven methods for estimating predictive accuracy , we comparatively evaluate their predictive accuracies using three-fold cross-validation. of the seven methods, two direct methods  and one indirect method  for estimating predictive accuracy are proposed and described here for the first time whereas the remaining four methods were obtained from the literature. methods  <dig> to  <dig> assume uncorrelated genotypes in the model for estimating heritability but assume correlated genotypes in the model for estimating predictive ability.

methods
we denote the standard deviation of a sample with s and that of a population with σ and the sample and population variance of the true genetic breeding values g with sg <dig> and σg <dig>  respectively. further, we denote with r, rg^,p, ρ and ρ
g,p
 the sample correlation, the sample correlation between the blup of g and the observed “phenotypes” p, the population correlation and the population correlation between the true genetic breeding values g and the observed “phenotypes” p, respectively. also, we use rg,g^, sg,g^, sg^ <dig> and sp <dig> to denote the sample correlation between the true and the predicted genetic breeding values, the sample covariance between the true and the predicted breeding values, and the sample variance of the predicted breeding value and the phenotypic sample variance, respectively. in this paper, the sample will generally refer to a trial with n genotypes, real or simulated, assumed to have been obtained from an infinite population of genotypes.

true correlation
the true correlation is given by the correlation between the true  and the predicted  breeding values

  rg,g^=sg,g^sg2sg^ <dig>  

where

  sg,g^=1n-1∑i=1ngi-g¯g^i-g^¯ 

is the covariance between the true and the predicted breeding values. further,

  sg2=∑i=1ngi-g¯2n- <dig>  

where g¯ denotes the estimated mean of g
i
  and

  sg^2=∑i=1ng^i-g^¯2n- <dig>  

where g^¯ denotes the estimated mean of g^ii= <dig> …,n, are sample variances of the true and the predicted breeding values, respectively. we take the unobservable correlation rg,g^ to be the main quantity of interest to the breeder or geneticist. seven alternative procedures are evaluated, by simulation, regarding the accuracy and precision with which they are able to estimate rg,g^.

two-stage approaches
we consider the case of a trial conducted in a single location. the analysis can be done in two stages  <cit> . the model for the observed plot data can be written as

  y=x1μ+f, 

where y is the vector of the observed phenotypic values, μ is a vector containing the adjusted genotype means to be estimated from a model in which genotype enters as a fixed effect and x <dig> is an associated design matrix and f combines all the fixed, random design and error effects .

the first stage of the two-stage approaches
at the first stage, means  for the testcross genotypes are estimated using model  and submitted to the second stage. the adjusted means of the standard varieties are excluded from the dataset before submission to the second stage.

the second stage of the two-stage approaches
the adjusted means from the first stage are used in the second stage to predict the true breeding values g. the second stage model is given by

  μ^i=φ+gi+ei, 

where μ^i is the adjusted mean of the i-th genotype , φ is the general effect or mean, g
i
 is the random effect of the i-th genotype and e
i
 is the residual error associated with μ^i, e = 
t
 assumed to follow e~n <dig> r=iσe <dig>  the random vector g = 
t
 is modelled by a linear random regression on the snp markers with random regression coefficients or marker effects u = 
t
 as

  g=zu 

where z is the matrix of snp marker covariates, u~n <dig> ipσu <dig>  i
p
 is the p -dimensional identity matrix and σu <dig> is the variance of marker effects.

thus, we simulated the random snp marker effects as random draws from a normal distribution with zero mean and variance σu <dig>  genotyping of all the genotypes was done by snp markers  and the information stored in a matrix z
snp
 = {z
ik
}. the marker covariate z
ik
 for the i-th genotype  and the k-th marker  for biallelic snp markers with alleles a <dig> and a <dig> was set to  <dig> for a1a <dig>  - <dig> for a2a <dig> and to  <dig> for a1a <dig>  a2a <dig> and missing values. thus, the genotypic effect g has variance

  varg=zu=g=zztσu <dig>  

where z
t
 is the transpose of z. alternatively, for computing some of the heritability measures, we also fitted model  with varg=g=inσg <dig>  i.e., assuming that genotypic effects are uncorrelated for methods  <dig> to  <dig>  where σg <dig> is the genetic variance and i
n
 is the n-dimensional identity matrix. in general, when fitting model  <dig>  assuming a linear variance-covariance model for g as defined in  it can sometimes happen that the estimated marker variance  is negative, yet it should not be. to ensure that the estimated σ^u <dig> is nonnegative it is necessary to specify a zero lower boundary constraint for σ^u <dig>  this can be accomplished using the lower b=value-list option of the parms statement of the mixed procedure when using the sas system.

simulation of datasets

assumed field design and model

to simulate block and plot effects using variance components from the real maize  dataset provided by agreliant we generated a dataset with  <dig> genotypes distributed over  <dig> incomplete blocks per replicate, each with  <dig> plots according to an alpha-design with two replicates. an appropriate model for this design must have an effect for the complete replicates, and another effect for the incomplete blocks, nested within replicates. we therefore simulated the field trial data according to an alpha design  <cit>  using the model:

  yijk=φ+γk+bjk+gi+eijk 

where y
ijk
 is the yield of the i-th genotype in the j-th block nested within the k-th complete replicate, φ is the general effect or mean, γ
k
 is the fixed effect of the k-th complete replicate, b
jk
 is the random effect of the j-th block nested within the k-th complete replicate, g
i
 is the random effect of the i-th genotype, and e
ijk
 is the residual plot error associated with y
ijk
. we similarly simulated the block and plot effects using variance components estimated from the real maize dataset with  <dig> genotypes provided by kws according to an alpha-design with two replicates based on model . the complete simulated datasets contained true genetic, block and plot effects. we used these datasets to compute the true correlation between the predicted and the true breeding values, true heritability as the square of the correlation between the predicted and the true breeding values and estimates of heritability for each of four different indirect methods. we considered four simulation scenarios defined by the parameters in tables  <dig> and  <dig> 


description of the real datasets and estimation of variance-components

we used two real datasets to get marker information and estimates of the marker, block and error variance components, which we needed to simulate the true breeding values and phenotypic data, assuming correlated genotypes . for scenarios  <dig> and  <dig> we divided the marker variance for scenarios  <dig> and  <dig> by  <dig>  respectively, to obtain smaller estimates of heritability .

the agreliant maize dataset
the first data set we used was a small dataset provided by agreliant genetics. it consisted of  <dig> doubled haploid maize lines derived from biparental crosses. the hybrid performance for kernel dry weight per plot of testcross genotypes was assessed with the same common tester using an unreplicated augmented trial design with incomplete blocks. although the testcross genotypes were tested in six locations in one year, not all testcross genotypes were tested in each location. furthermore, three to five incomplete blocks, each having one single row of plots, were used per location. standard varieties connected the different blocks in the sense that they allowed estimation of the inter-block variance and separation of the block from the error variance. the standard varieties themselves were not used in predicting g but were used merely to facilitate analysis of the testcross genotypes. markers with more than 20% missing values, or more than 5% heterozygous genotypes, or with minor allele frequency less than  <dig> % were discarded  <cit> . we used the data for only one of the six locations with the rr-blup model to obtain variance components needed to simulate the random marker, block and plot effects for scenarios  <dig> and  <dig>  the selected location had a single unreplicated trial,  <dig> blocks,  <dig> checks and  <dig> lines, all of which were genotyped. since the two checks had markers, just like all the other genotypes, they were treated in the exact same way as the other genotypes in the rr-blup model.

the rr-blup model assumed a linear variance model for the correlation between the genotypes:

  yij=φ+bj+gi+eij, 

where y
ij
 is the yield of the i-th genotype in the j-th block, φ is the general effect or mean, b
j
 is the random effect of the j-th block, the random vector g = 
t
 is modeled as in equation  <dig> and also has variance varg=zu=zztσu <dig>  the terms z, z
t
, u and σu <dig> are defined as in equations  <dig> and  <dig> whereas e
ij
 is the residual plot error associated with y
ij
.

the kws-synbreed maize dataset
the second data set was extracted for one location from a larger data set provided by kws for the synbreed project  <cit> . it had a total of  <dig> doubled haploid maize lines of which  <dig> testcrosses were genotyped while the remaining  <dig> were not, six hybrid checks and five line checks. the genotypes were crossed with four testers . the testcross genotypes were tested using  <dig> trials each laid out according to a 10× <dig> lattice square design with incomplete blocks. each trial had two replicates. there were a total of  <dig> observations,  <dig> of which had no yield measurements.

grp = grouping factor for checks , testers  and groups  of genotyped lines. z1= <dig> for genotyped lines and  <dig> otherwise. z2= <dig> for non-genotyped lines and  <dig> otherwise. gena denotes all the individual genotypes. genb=gena for genotyped lines and  <dig> otherwise. genb helps specify the vector of random effects of genotyped lines with a length that matches the dimension of the covariance matrix of genotypes.

fitting a linear variance model  to these data requires using a variance-covariance matrix of dimension n <dig> × n <dig>  where n <dig> is the number of genotyped lines. the vector of effects of genotyped lines must therefore be of dimension n <dig>  this presents a challenge for the kws- data set because the vector of random effects of all the genotypes  contains both the vector of effects of the n <dig> genotyped lines  plus the vector of the effects of the n <dig> non-genotyped lines  and so has a larger dimension  than n <dig>  to facilitate fitting the linear variance model for the genotyped lines we proceed as follows. first, we create a dummy variable in our dataset  equal to one for genotyped lines and zero otherwise. second, we create a variable called gena in the dataset with a unique level for each of the genotyped and the non-genotyped lines. third, we create a second variable called genb equal to gena for the genotyped lines but equal to the level for any one of the genotyped lines for all the non-genotyped lines. thus, the variable genb has n <dig> levels, corresponding to the n <dig> genotyped lines. for example in table  <dig>  the variable genb, whose effect is modelled by g <dig>  has been set equal to  <dig>   <dig> …,  <dig> for the  <dig> genotyped lines and to  <dig>  the label for the first genotyped line, for all the  <dig> ungenotyped lines. the genetic effect g1i
 of the i-th genotyped line will be represented in the mixed model by the term z1im
g1i
. this term will become zero for all the records corresponding to the non-genotyped lines, because for these records we have set z1im
= <dig>  this ensures that the number of random genotypic effects to be predicted for g <dig> equals the dimension of the linear variance-covariance matrix . the non-genotyped lines therefore make no contribution at all to the estimated variance-covariance matrix of the genotypes. they are, in other words, switched off.

the vector of random effects for the genotyped lines g <dig> is modelled by rr-blup as g1 = zu with varg1=zu=zztσu <dig>  where z is the n <dig> × p design matrix for snp markers for the n <dig> genotyped lines and u = 
t
 is the vector of p random snp marker effects, with u~n <dig> ipσu <dig>  i
p
 is the p-dimensional identity matrix and σu <dig> is the variance of snp marker effects.

we represent the genetic effects g2i
 of the i-th non-genotyped line in a similar fashion as for g1i
, i.e., we use the term z2im
g2i
, where z2i
 is a dummy variable that is equal to one for all the non-genotyped lines and equal to zero for all the genotyped lines. the effects g2i
 are assumed to be independent normally and distributed with variance σg <dig> 

the following mixed model, assuming that the genotyped lines are correlated according to the rr-blup model , was used to estimate the variance components used in the simulations for scenarios  <dig> and 4:

  yijklmn=φ+tl+rkl+bjkl+δm+τn+z1img1im+z2img2im+eijklmn, 

where y
ijklmn
 is the response of the i-th genotype in the j-th block nested within the k-th replicate in the l-th trial in the m-th group tested against the n-th tester. φ is the general effect, t
l
 is the random effect of the l-th trial, assumed iid n <dig> σt <dig>  r
kl
 is the random effect of the k-th replicate nested within the l-th trial, assumed iid n <dig> σr <dig>  b
jkl
 is the random effect of the j-th block nested within the k-th replicate in the l-th trial, assumed iid n <dig> σb <dig>  δ
m
 is the fixed effect of the m-th group of checks, testers and genotypes, τ
n
 denotes the effect of the n-th tester  and e
ijklmn
 is the residual plot error associated with y
ijklmn
 and is assumed to be iid n <dig> σe <dig>  where σe <dig> is the error variance.

to implement the model using the reml package proc mixed of the sas system  <cit> , the random genotypic effects were coded using the variables defined in table  <dig>  the random genotypic effect of the i-th genotyped line in the m-th group, z1im
g1im
, was coded as  using the variables tester , group , genotypes , and z <dig>  where the last variable was specified as a quantitative variable, while the first three variables were declared as categorical variables . the variable z <dig> corresponds to the switch variable z1im
 in the model . the random effect z2im
g2im
 of the i-th non-genotyped line in the m-th group was coded as  using the variables tester , group  and genotypes  described in table  <dig>  z <dig> is a second quantitative variable corresponding to the switch variable z2im
.

estimating predictive accuracy from predictive ability and heritability
four of the seven approaches indirectly estimate predictive accuracy rg^,p/h as the correlation between the predicted genetic and phenotypic values rg^,p, called predictive ability, divided by the square root of heritability   <cit> , separately for each of  <dig> three-fold cross-validation replicates. predictive ability can be estimated from cross-validation as

  rg^,p=sg^,psg^2sp <dig>  

a key assumption of the approach is that sg^,p=sg,g^ <cit> , which implies that the genotypic effect estimate g^ is not correlated with environmental components in the phenotypic value p. this suggests  <cit>  that in practice we can replace  with

  rg,g^=sg^,psg^2sg <dig>  

the other assumption is that sg2=h2sp <dig>  so that

  rg,g^=sg^,psg^2sg2=sg^,phsg^2sp2=rg^,ph. 

an important question is how to estimate heritability h <dig>  the fact that the definition of g^ used in rg,g^ requires a marker-based model for g suggests that the same model should be used for defining heritability h <dig>  the problem in practice is that the true model is not known, so that different methods for genomic selection  are usually applied and their predictions compared empirically via cv  <cit> . to make any progress, some model must be chosen for defining predictive accuracy, and if the chosen model is close to the model for some gs method, then that same method would potentially be preferred for the estimation of predictive accuracy. moreover, some methods for gs do not have an explicit underlying model. this is the case for some methods, for example, in the machine learning realm.

the difficulty in choosing a model for heritability h <dig> makes it hard to devise an unambiguous definition for h <dig>  thus, any estimate of predictive accuracy should be taken only as a rough indication of precision. we suggest that the model underlying ridge regression blup be used to define heritability h <dig>  this is because this method is the most commonly used one for gs and has been shown to have good properties. it is based on a specific mixed model, so an estimate of h <dig> can be obtained in various ways  <cit> .

cross-validation
we used cross-validation  to obtain an estimate of the correlation between the predicted breeding values and the observed phenotypic values rg^,p, which we needed to compute predictive accuracy rg,g^ for methods  <dig>   <dig>   <dig>   <dig> and  <dig>  we used a three-fold cross-validation to evaluate predictive accuracy for both datasets because of the small number of genotypes  in the agreliant dataset. the dataset with the adjusted means for the testcross genotypes was split into three random subsamples, one of which was held out as a validation set at a time. the remaining two subsamples were combined into one training set. the three-fold cv procedure was replicated five times, yielding a total of  <dig> replicate datasets. we then fitted a ridge regression model  to each of the  <dig> replicate validation and training sets. we next computed predictive ability, the correlation between the predicted breeding values and the phenotypic values rg^,p across all the genotypes. this procedure was repeated for each of the  <dig> datasets simulated for each of the four scenarios. the correlation between the predicted and the true breeding values rg,g^, the predictive accuracy, was computed by dividing predictive ability rg^,p by the square root of estimated heritability for each of the four indirect methods. the estimates of predictive accuracy were compared using the simulated true breeding values. moreover, we directly computed predictive accuracy using methods  <dig>   <dig> and  <dig> as described below. table  <dig> summarizes the key properties of the seven methods.

methods  <dig> to  <dig> that require heritability to estimate predictive accuracy are called indirect methods whereas methods  <dig> to  <dig> that do not are called direct methods in the text. the symbol  means the question is not applicable for a particular model.

methods for estimating predictive accuracy
we used the following five methods  to estimate heritability . the first approach is the standard method for estimating heritability that is commonly used by plant breeders  <cit> . the second and the third approaches are modifications of the ad hoc measure based on blue and blup  <cit> . the fourth approach is based on a new proposal for estimating heritability. this approach uses the ratio of the expected value of the genetic variance to the expected value of phenotypic variance. the fifth approach is our second new method for estimating heritability without cross-validation using similar ideas to those used in computing the ad hoc measures of h <dig> . methods  <dig> to  <dig> assume that the genotypes are not correlated, while methods  <dig> and  <dig> assume correlated effects according to the model underlying the rr-blup. we then used the quantity rg^,p/h to compute predictive accuracy, where h is the square root of heritability computed using each of the first four methods  only. this is because even though method  <dig> also computes heritability, it calculates predictive accuracy directly, similar to methods  <dig> and  <dig>  the three methods  <dig>   <dig> and  <dig> were thus used to estimate predictive accuracy directly without first dividing predictive ability by the square root of heritability. the three direct methods assume correlated effects of genotypes according to the model underlying rr-blup.

†
methods  <dig> to  <dig> but not  <dig> use cross-validation. m <dig> is the square of the true correlation between the predicted and the true simulated breeding values used as the benchmark for assessing the estimated heritability.

†msd=mean squared deviation and h2 =  <dig> is the number of datasets for which the estimated heritability was zero. *the number of the equation used in the text is in parenthesis.

method 1: standard measure

plant breeders often compute heritability for a single trial using

  hm12=σg2σg2+σe2/r, 

where σg <dig> is the genetic variance, r is the number of replicates and σ2
e
 is the variance of plot error  <cit> . this estimator is valid for randomized complete block designs, but is an ad hoc approximation for incomplete block designs. also, the estimator is not applicable with spatial methods of analysis  <cit> .

method 2: a measure proposed by  <cit>  that uses the blues and is computed as

  hm22=σg2σg2+υ¯/ <dig>  

where υ¯ is the mean variance of a difference of two adjusted genotypic means  and σg <dig> is the genetic variance estimated from  assuming independent genotypic effects.

method 3: an ad hoc measure proposed by  <cit>  that is based on blup assuming independent genotypic effects and is computed as

  hm32=1-υ¯blup2σg <dig>  

where υ¯blup is the mean variance of a difference of the blup of two genotypic effects g^i. we used the blup of μ
i
 = φ + g
i
 as the phenotypic data in the mixed model for method  <dig>  further details on the computation of υ¯blup and υ¯ are in additional file  <dig> 

method 4: a new proposed measure for estimating heritability

the sample variance sg <dig> of the true genetic breeding value g <dig>  can be written as

  sg2=1n-1∑i=1ngi-g¯2=gtpug, 

where pu=1n-1in-1njn, i
n
 is the n-dimensional identity matrix and j
n
 = n × n is a square matrix of ones. in a similar way, we may represent the phenotypic sample variance as

  sp2=1n-1∑i=1npi-p¯2=ptpup, 

where p=μ^=μ^ <dig> μ^ <dig> …,μ^nt is the vector of observed phenotypes. the observed phenotype μ^i of the i-th genotype is the adjusted mean computed for this genotype for a single location.

we cannot compute the sample variance of g for real data because these are not observed. but if we assume a mixed model with linear variance structure for g taking the form varg=g=zztσu <dig>  where g is the vector of g
i
 of all tested entries , and σu <dig> is the snp marker variance, then we can compute the expected value of the sample variance of g
i
 in equation  <dig>  from standard results on the expected value of quadratic forms  <cit>  we have

  esg2=tracepug. 

thus, we may define heritability as the expected genetic sample variance sg <dig> over the expected phenotypic sample variance:

  hm42=esg2esp <dig>  

the expected value esp <dig> is now derived. the variance of phenotypes  is given by varp=v=g+r, where r is the variance-covariance matrix of the error term in equation . therefore

  esp2=tracevpu=esg2+tracerpu. 

an estimate of this is easy to compute, as is an estimate of sg <dig>  by plugging in estimates for the variance-components in g and r. for illustration of the new method  <dig>  we consider three special cases in additional file  <dig> 

method 5: a new direct method for estimating rg,g^

this method uses the rr-blup of g as the “phenotype” to compute an alternative estimator of predictive accuracy unlike that produced by the methods that require cross-validation and use the adjusted means as the phenotypes. heritability can be computed as the square root of the estimated predictive accuracy.

using equation  <dig>  we have

 blupg=zu=g^=gv-1p-1φ^ 

and φ^=1tv-11-11tv-1p. thus, blup = gv- 1qp, where q = i - 1- 11
t
v-  <dig>  or in an even more compact form blupg=zu=g^=cp with c = gv- 1q.

now consider the sample correlation of the true genotypic value g = zu and its estimator g^, the blup of g. the sample covariance sg,g^ is given by

 sg,g^=gtpug^=gtpucp, 

where p
u
 is defined as in equation  <dig>  we cannot compute this sample covariance directly, because g is not observable. but we can compute its expected value as follows:

 esg,g^=egtpucp=egtpucg=etracegtpucg=etracepucggt=traceepucggt=tracepucg 

in the same vein, we find for the sample variances of the true  and the predicted  breeding values:

 sg2=gtpug 

 esg2=tracepug 

 sg^2=ptctpupucp=ptctpucp 

 esg^2=tracectpucv 

the sample true correlation from equation  <dig> is then given by

 rg,g^=sg,g^sg2sg^ <dig>  

we want to estimate the expected value of this correlation. approximately, we have

  erg,g^≈esg,g^esg2esg^ <dig>  

note that the correlation involves a function of three correlated random variables  and we must acknowledge that the expected value of a function of random variables is not usually exactly equal to the same function evaluated at the expected values of the random variables  <cit> . some improvement of the approximation may be possible using the delta method, but we will not pursue this here. instead, the closeness of the approximation  will be investigated in our simulations. from a practical point of view, the advantage of  is its simplicity. with this approximation, we may replace the expected values with their explicit expressions to yield the estimated predictive accuracy:

  erg,g^≈hm5=tracepucgtracepugtracectpucv. 

method 6: a further new direct method for estimating 

 rg,g^ 

our objective is to estimate rg,g^ by evaluating . it is straightforward to compute sg^,p and sg^ <dig> in  directly from the data  and the predicted breeding values . the only difficulty is the estimation of sg <dig>  if we could observe the g of all entries, we would compute their sample variance sg <dig>  just as we compute the sample variance sg^ <dig> and the sample covariance sg^,p. note that we similarly computed the sample correlation between the predicted breeding values g^ and the observed phenotypic values p for each cross-validation replicates. our proposed estimator becomes

  r^g,g^,m6=sg^,psg^2×esg <dig>  

where esg <dig> was computed using equation  <dig>  a problem with this method as well as with methods  <dig>   <dig>   <dig> and  <dig> is that r^g,g^,m <dig> can exceed one. we have therefore presented values of r^g,g^,m <dig> truncated at  <dig> in the main body of the paper and the untruncated values in additional file  <dig> .

†
*
all the methods except  <dig> and  <dig> use cross-validation. m <dig> is the correlation between the predicted and the true simulated breeding values used as the benchmark for assessing the estimated predictive accuracy. n is the number of data sets out of a possible total of  <dig> for which estimates were available for all the seven methods. means for pairs of methods within each scenario with the same superscript letter are not significantly different at the 5% level of significance based on the t-test.

†msd=mean squared deviation, q <dig> is the lower quartile and q <dig> is the upper quartile. * the number of the equation used in the text is in parenthesis.

method 7: this method is commonly used in animal breeding  <cit> 

we used the linear mixed model:

  y=χβ+ζu+e, 

where x is the design matrix for the fixed effects, β is the vector of regression coefficients for the fixed effects, u~n <dig> g˜=ιpσu <dig> is the random marker effects with variance σu <dig>  the residual errors e = 
t
 are assumed to follow e~n <dig> r=inσe <dig> with variance σe <dig> and z is the marker matrix. the random vector g = 
t
 is obtained from a linear regression on the random marker  effects u
k
, i.e. u = 
t
 as

  g=zu. 

a common approach to the evaluation of predictive accuracy  in animal breeding is the use of the squared correlation between the true and the predicted breeding values , called reliability  <cit> . we used the approach of  <cit>  as implemented by  <cit> . the calculation of ρ <dig> requires a solution to the mixed model equations  <cit>  given by  <cit> 

  β^u^=χtr-1χχtr-1ζζtr-1χζtr-1ζ+g-1-χtr-1yζtr-1y=c11c12c21c22χtr-1yζtr-1y, 

where ()- denotes a generalized inverse of the coefficient matrix of the mme  <cit> . if the variance-covariance matrix of the random effects u and the genetic effects g = zu is given by

  vargu=dfftg, 

where d=zztσu <dig> and f=zσu <dig>  then it follows that  <cit> 

  blupg=fg-1u^=zu^, 

where 

 u^=blupu. 

the distribution of g and g^ is then multivariate normal with zero mean and variance-covariance matrix

  vargg^=zztσu2zmg-1ztσu2zmg-1ztσu2zmg-1ztσu <dig>  

where m=varu^ <cit> . the reml estimate of m can be computed from a mixed model package by noting that

  varu^=m=g-c <dig>  

after substituting for m, equation  <dig> reduces to

  vargg^=ζζtσu2ζζtσu2-zc22ztζζtσu2-zc22ztζζtσu2-zc22zt, 

from which the reliability ρi <dig> for each genotype is calculated as

  ρ^i2=covgi,g^i2vargi.varg^i, 

where we extract only the corresponding diagonal elements from the block matrices var, varg^ and covg,g^. the reliability of all genotypes in each dataset is then estimated by

  ρ^m72=1n∑i=1nρ^i <dig> 

and the accuracy by its square root, where n is the total number of genotypes in the data set. the sas  code used to simulate the phenotypic data and fit all the seven models is provided in additional file  <dig> 

evaluation of simulated data
we used the two-stage analysis and the methods described above to estimate the correlations between the predicted and the true breeding values rg,g^. we computed the true heritability as the square of the correlation between the predicted and the true breeding values and estimated heritability using the five different approaches. we then computed the ratio of the expected value of the genetic variance to the expected value of the phenotypic variance and used this to compute heritability based on the new proposed method  for estimating heritability. moreover, we estimated the adjusted least square means of genotypes from the first stage using simulated data. the adjusted least square means were used in the second stage in cross-validations as the phenotypic data. also, the variance-covariance matrix of the adjusted means was used to compute an ad hoc measure of heritability according to equation  <dig>  because the kws maize dataset had many genotypes  the mixed models were computationally very demanding to fit. so, for example, the slowest method, method  <dig>  took only  <dig>  hrs to fit all the  <dig> small data sets in one scenario in sas version  <dig>  running on a 64-bit windows  <dig> workstation with  <dig> gb ram and an intel core quad  <dig> , but it took  <dig> hrs to fit the same model to  <dig> large data sets. hence, we first estimated the start values for the variance-components of the mixed models using the hpmixed procedure of sas to enhance computational efficiency.

comparing heritabilities
we computed true heritability as the square of the correlation between the predicted and the simulated true breeding values:

  htrue2=rg,g^ <dig> 

to compare the true heritabilities h <dig> with their estimates computed using each of the four different indirect methods  and method  <dig> we computed the mean squared deviation  of each estimate from the true heritability for each simulated dataset and method combination as

  msd=∑j=1nh^j2-rg,g^,j22n 

where n is the total number of the simulated datasets and j=  denotes the j-th simulated data set. moreover, we computed descriptive statistics for the true and estimated heritabilities.

comparing predictive accuracies
for each simulated dataset we computed the “true” correlation rg,g^  as the correlation between the predicted and the simulated true breeding values and compared this with estimates of the same correlation computed using each of the seven different methods. to compare the true correlation rg,g^ with its seven estimates r^g,g^ we computed the mean squared deviation  of each estimate from the true correlation for each simulated dataset and method combination

  msd=∑j=1nr^g,g^,j-rg,g^,j2n, 

where n is the total number of the simulated datasets and j=  denotes the j-th simulated dataset. we recall here that msd integrates information on  the correlation between the predicted and the true accuracy,  the slope of the regression of the predicted against the true accuracy and  the bias between the predicted and the true accuracy  <cit> . nevertheless, the correlation and bias between the predicted and the simulated true accuracies are displayed or can readily be inferred from figures  <dig>   <dig> and  <dig> and additional file 3: figures s1-s <dig> in the supplementary materials. further, we calculated descriptive statistics for the true correlation and all its seven estimates. we also compared the estimated predictive accuracies between pairs of the seven methods.

for each scenario we compared the simulated true and the estimated predictive accuracies for the seven methods using t-tests  adjusted for multiplicity using simulation adjustment. the t-tests were derived from a mixed model with fixed effects for method and scenario and their interaction and a random effect for simulation replicates nested within scenarios  <cit> .

RESULTS
heritability
heritability was estimated by methods  <dig> to  <dig> only. the estimated heritability was closer to its true simulated value for methods  <dig>   <dig> and  <dig> than for methods  <dig> and  <dig> in terms of its minimum, maximum, mean, standard deviation and mean squared deviation for all the four scenarios. all the five methods  underestimate the minimum, maximum and the mean true heritability in all the scenarios. method  <dig> produced estimates closest to the true heritability for all the four scenarios. across scenarios based on the same data set, the estimated heritability tended to be closer to its true value in scenario  <dig> than in  <dig> and in scenario  <dig> than in  <dig> , implying that reducing the genetic variance by a factor of  <dig> in scenarios  <dig> and  <dig> reduced the accuracy of estimated heritability.

predictive accuracy
in general, all the seven methods produced reasonable estimates of predictive accuracy across all the four scenarios. the estimated predictive accuracy was more precise for scenarios  <dig> and  <dig>  based on the large dataset, than for scenarios  <dig> and  <dig>  for all the seven methods . reducing the genetic variance by a factor of  <dig> while leaving all the other variance components unchanged degrades the precision of the estimated predictive accuracy more for the smaller of the two datasets . methods  <dig> and  <dig> were the best overall and gave the least biased and most precise estimates of predictive accuracy, most notably for scenarios  <dig>   <dig> and  <dig> . even so, method  <dig> tended to be more precise than method  <dig> for both the scenarios  based on the larger dataset. all estimates of predictive accuracy for methods  <dig> and  <dig> were between  <dig> and  <dig> for all scenarios. also, the models for methods  <dig> and  <dig> converged for all the  <dig> simulated datasets in all the scenarios . unlike methods  <dig> and  <dig>  the performances of the other methods were more varied across scenarios. in particular, there was a greater tendency for the estimated predictive accuracy to exceed one  or to be smaller than zero  and a higher frequency of failure of the algorithms used to fit the rr-blup models to converge .

for scenario  <dig> overshooting was most frequent and severe  for method  <dig>  followed by methods  <dig> ,  <dig>  and  <dig> . in contrast, all estimates of predictive accuracy for methods  <dig>   <dig> and  <dig> fell between  <dig> and  <dig>  moreover, all the seven models converged for all the  <dig> simulated datasets .

compared to scenario  <dig>  overshooting and undershooting were more common for methods  <dig>   <dig>   <dig>   <dig> and  <dig> in scenario  <dig>  generally, overshooting was more serious  than undershooting, particularly for methods  <dig> ,  <dig> ,  <dig>  and  <dig>  . the problem of overshooting or undershooting did not occur for any method in scenario  <dig>  although the problem of overshooting still persisted for methods  <dig> ,  <dig> ,  <dig>  and  <dig>  in scenario  <dig>  these methods had three further drawbacks in scenario  <dig>  the first was the breakdown of the method for computing predictive accuracy because estimated heritability was zero, most especially for methods  <dig>  and  <dig> . the second was that the genetic variance estimate was zero for method  <dig> . the third was the failure of the mixed model used to compute predictive ability required by methods  <dig>   <dig>   <dig>   <dig> and  <dig> to converge . as a result, predictive accuracy could not be computed for  <dig> datasets for each of the methods  <dig>   <dig> and  <dig> in scenario  <dig>  undershooting was rather rare by comparison and was noted only for method  <dig>  in scenario  <dig> . aside from overshooting and undershooting, deviation of the predictive accuracy from its expected values was also caused by overestimation and underestimation. considering only the values of predictive accuracy between  <dig> and  <dig>  the seven methods tended to underestimate the true accuracy across all the four scenarios. underestimation tended to be more severe for methods  <dig>   <dig>   <dig>   <dig> and  <dig> than methods  <dig> and  <dig>  this was most evident in scenario  <dig>  by comparison, overestimation was far less common .

for  <dig> datasets from scenario  <dig> the estimated true accuracy was smaller than zero because the estimated variances of the blups were zero and the estimated genetic variances were nearly zero. we expect plant breeders to discard genotypes for which the estimated genetic variance is nearly zero in making selection decisions in real applications. consequently, we excluded the  <dig> simulated datasets with negative true accuracies from all the comparisons to mimic what plant breeders do in practice. there was therefore no estimated true accuracy to compare with the corresponding estimated predictive accuracy for all the seven methods. similarly excluded from all the comparisons were four further datasets in scenario  <dig> for which the mixed models for estimating the true accuracy did not converge.

a comparison of the performances of the methods showed that methods with similar performances clustered into two distinct groups in each of the four scenarios. one of the two groups identified by regressing the estimated predictive accuracies for each pair of the seven methods on each other comprised methods  <dig>   <dig>   <dig>   <dig>  and  <dig> whereas the other consisted of methods  <dig> and  <dig> . results of the t-tests reaffirmed this general pattern besides showing that the estimated true accuracies for methods  <dig> and  <dig> are generally closer to the true predictive accuracy than the estimates for the other methods, especially for the two scenarios based on the large data set .

we expected the predictive accuracies of pairs of methods that accurately estimate the true predictive accuracy to be positively and not negatively correlated with each other. however, correlations between estimated predictive accuracies for some pairs of the seven methods were, surprisingly, negative even though the predictive accuracies for the individual methods were themselves high and positive . this was the case, for example, for method  <dig> versus  <dig> and  <dig> in scenario  <dig>  and for method  <dig> versus  <dig> in scenarios  <dig> and  <dig>  this is due to the fact that some methods  tended to produce large values of predictive accuracy while others  tended to produce small values when the estimated genetic variance was very small because of the way the genetic variance enters the denominators of the estimators used by these methods to compute predictive accuracy.

the number of simulated datasets out of a possible total of  <dig> for which estimates of predictive were available for each pair of methods was taken as the minimum for the pair.

discussion
heritability
one possible definition of heritability  <cit>  is based on the squared correlation between “genotype” and “phenotype”. in our current work, we use various ad hoc measures of heritability. the one proposed by  <cit>  assesses the squared correlations between blups of genotypic values and the true genotypic values using method  <dig>  another measure, proposed by  <cit> , considers the correlation between adjusted means  and the true genotypic values using method  <dig>  so, one may argue that these different measures use different definitions of “the phenotype”.

in this paper, we use estimates of heritability to compute “predictive accuracy” as rg^,p/h, where rg^,p is the correlation between genomic selection estimators of the true breeding values g and the “phenotypic values” in the validation set and h is the square root of heritability. in this application, the “phenotypes” are adjusted means , so estimators of the square root of heritability h that take blues to be the phenotype are appropriate.

it is important to note that rg^,p/h is itself an estimator of the square root of heritability if we take the rr-blups as the “phenotypes”. an important property of the procedures we consider  is that rg^,p is obtained from cross-validation. alternatively, we also estimate heritability h <dig>  without cross-validation using similar ideas to those used for the ad hoc measures of heritability h <dig> and for the “direct method” . the quantity hm <dig>  provides an alternative estimator of heritability when the rr-blup of the genetic variance  is considered as the “phenotype”. this estimator  was the most accurate of the five we used to compute heritability. but in our cross-validations, the phenotypes are always the adjusted means. so, we just use  as an alternative estimator of predictive accuracy.

the strikingly poor performances of methods  <dig> to  <dig> as indicated by all the estimated mean heritabilities falling below the minimum of the true heritability may seem surprising at first sight but in the case of methods  <dig> to  <dig> may reflect the fact that these three methods assume that genotypes are uncorrelated. if this is true then we would expect the performance of these methods to improve considerably if the true heritability used as the benchmark were also estimated using a model that assumes uncorrelated genotypes. to test this expectation, we re-calculated the true heritability assuming that the genotypes are uncorrelated for each of the four scenarios by setting all the covariances in the variance-covariance matrix of genotypes to zero. using the new benchmark led, as expected, to a much better agreement between the new true heritability and its estimates by methods  <dig> to  <dig> . this demonstrates compellingly that methods  <dig> to  <dig> are all reasonably good at estimating heritability when genotypes are not correlated but are severely biased downwards when they are. the downward bias implies, furthermore, that methods  <dig> to  <dig> are not suited for estimating heritability used to divide predictive ability to obtain predictive accuracy in genomic prediction for which genotypes are typically assumed to be correlated. by contrast, method  <dig> that assumes correlated genotypes performs much better at estimating heritability even though the estimated heritability is merely a by-product and not needed for estimating predictive accuracy.

method  <dig> differs from methods  <dig> to  <dig> in assuming that the genotypes are correlated, unlike the latter methods that assume that genotypes are independent. this suggest that there must be yet another reason that the estimated mean heritability for method  <dig> falls below the minimum expected true heritability estimated assuming that the genotypes are correlated. we can think of two plausible explanations for this discrepancy both of which apply equally to all methods  <dig> to  <dig>  the first is that all the heritability estimators for methods  <dig> to  <dig> are constructed as ratios of the genetic and the phenotypic variances such that the greater is the phenotypic variance the smaller is the estimated heritability, whereas we defined the true heritability in terms of the squared correlation between true and estimated genotypic effect. the second relates to the observation that despite its poor estimates of heritability relative to those for methods  <dig> to  <dig>  the estimated predictive accuracy for method  <dig> is generally closer to the estimated true accuracy than the estimates for methods  <dig> to  <dig>  this is quite intriguing because methods  <dig> to  <dig> calculate predictive accuracy as the ratio of predictive ability to heritability. since all the four methods use the exact same values of predictive ability and since method  <dig> yields somewhat poorer estimates of heritability than methods  <dig> to  <dig>  we would not logically expect method  <dig> to produce better estimates of predictive accuracy. that it actually did suggests that the reliability of approximating predictive accuracy by dividing predictive ability by the square root of heritability is questionable, at the very least for the specific configurations of the phenotypic and genotypic variances we used in our simulation scenarios.

predictive accuracy
we compared the performances of seven methods for estimating predictive accuracy in genomic selection using  <dig> datasets simulated according to an alpha-design for each of four scenarios based on genetic and residual variance estimates calculated from two real datasets. the results show that, of the seven methods, a new proposed method  and a method which is well established in animal breeding programs , consistently gave the least biased, most precise and stable estimates of predictive accuracy across all the four scenarios. method  <dig> was at least as good as or better than method  <dig> for estimating predictive accuracy. the other methods performed somewhat inconsistently across scenarios and suffered varying degrees of overshooting, undershooting and convergence problems. all the methods were more likely to underestimate than overestimate the true predictive accuracy when only datasets for which the estimated predictive accuracies fell between  <dig> and  <dig> were considered. the 0– <dig> truncation of the estimated predictive accuracy reflects the fact that we should not use the ratio of predictive ability to heritability  in practice if it does not fall within the interval  <cit> .

in summary, methods  <dig> and  <dig> had the best performance followed by method  <dig>  method  <dig> was the third best whereas methods  <dig>   <dig> and  <dig> had rather similar and the worst performance. methods  <dig> and  <dig> had rather similar performance in all scenarios despite the theoretical expectation that method  <dig> should do better than method  <dig> for the scenarios with small sample size. this expectation arises from the fact that whereas method  <dig> assumes that the focal genotypes are derived from an infinite target population, method  <dig> assumes that the sampled genotypes arise from a finite population. consequently, the two methods may be expected to perform well for large sample sizes and method  <dig> to perform better than method  <dig> in small sample situations. the similar performance of methods  <dig> and  <dig> is therefore tentative and its generality will be explored for a wider range of sample sizes in a sequel to this paper focusing on the influence of sample size on the predictive performance of the seven methods.

although their empirical performances in the simulations were often reasonable, methods  <dig>   <dig> and  <dig> involve dividing two quantities computed using two different models with conflicting assumptions. specifically, they involve dividing predictive ability computed from an rr-blup model, assuming that genotypes are correlated, by the square root of heritability computed from a model assuming that genotypes are uncorrelated. the computation of predictive ability using the model assuming that the genotypes are correlated, when heritability is computed assuming uncorrelated genotypes, would seem unavoidable when using rr-blup. this is because genomic breeding values cannot be predicted using rr-blup if the genotypes are assumed to be independent. this theoretical inconsistency undermined the performance of these three methods in several instances when the genetic variance estimated assuming uncorrelated genotypes was zero or nearly zero. this rendered predictive accuracy inestimable for methods  <dig>   <dig> and  <dig> in these cases.

despite the inferior performance of methods  <dig> to  <dig>  linked to the inconsistency in the definitions of their numerators and denominators, relative to the methods that estimate predictive accuracy directly, this theoretical inconsistency has not deterred plant breeders from using these approaches. in fact, methods  <dig> to  <dig> are the most frequently used by plant breeders. these three methods are not very similar by construction, despite the similarity of their performance. hence, the similar performance could not necessarily have been anticipated a priori. accordingly, by studying the properties of these methods alongside those of the other contending methods, we have ascertained whether and when their theoretical inconsistency may lead to inferior performance. our findings suggest that these methods should be used with care, especially when the genetic variance is very small, so that predictive accuracy is likely to be either inestimable or overestimated.

although rare and probably relatively simple, there are instances in which the theoretical inconsistency is immaterial. for example, an independent model can be obtained in such simple special cases as a doubled haploid population, resulting from a single cross  <cit> , if the dependent model is a conditional model that considers genetic variance-covariance conditioning on the marker genotypes whereas the marker genotypes are taken as random variables. in complex pedigrees, however, the unconditional model will also involve correlations, so that the impact of the theoretical inconsistency is more likely to be consequential.

we emphasize also that while our simulation results hold for the rr-blup model, their applicability to other models than rr-blup remains to be investigated.

influence of the size of genetic variance
the size of the estimated genetic variance and hence heritability exerted the strongest influence on the variation in estimates of predictive accuracy. the estimated predictive accuracy was closer to its true value for all the methods in scenarios  <dig> and  <dig> than in scenarios  <dig> and  <dig> for all the  <dig> datasets, because the simulated genetic variances for scenarios  <dig> and  <dig> were  <dig> times larger than those for scenarios  <dig> and  <dig>  when the simulated genetic variance was small , there was a higher likelihood of obtaining extremely high values of estimated genetic variances than when a higher genetic variance was simulated . methods  <dig>   <dig> and  <dig> were the most sensitive to variation in the estimated genetic variance because they all divide predictive ability by the square root of heritability to obtain predictive accuracy and hence break down when genetic variance estimate is zero, since the estimated heritability is then also zero. for method  <dig>  in particular, predictive accuracy becomes infinitely large when the estimated genetic variance is zero and extremely large when this variance is very small. since method  <dig> also computes predictive accuracy in the same way as methods  <dig>   <dig> and  <dig> do, it also breaks down when the estimated genetic variance and hence estimated heritability is zero.

influence of the number of genotypes
increasing the number of genotypes, for example from  <dig> for scenarios  <dig> and  <dig>  to  <dig> for scenarios  <dig> and  <dig>  increased the time required to compute predictive accuracy by all the seven methods from a few minutes to several days, most notably for the methods that require cross-validation .

simplicity of implementation of methods
methods  <dig>   <dig>   <dig>   <dig> and  <dig> that use cross-validation are computationally much more intensive to implement than methods  <dig> and  <dig> that do not involve cross-validation. as a result, methods  <dig> and  <dig> are the simplest and computationally most efficient to implement of the seven methods. this argues for their routine use in assessing predictive accuracy in genomic selection studies.

considering only estimated correlations between zero and one, methods  <dig> and  <dig> gave the best estimates of predictive accuracy among the five methods that use cross-validation, followed by methods  <dig>   <dig> and  <dig>  in that order.

design considerations
we considered a single trial laid out as an alpha-design in a single location for simplicity. hence, a more extensive simulation with more trials, locations and trial designs would be required to establish the generality of our results. further, we considered only two data sets with different numbers of genotypes  and markers . however, variation in the number of genotypes and markers probably also affects the estimated predictive accuracy and thus also merit further investigation. some breeders compute heritability using methods assuming that the datasets are balanced and that the genotypes are independent. four of the seven methods  relax these restrictive assumptions by allowing for both balanced and unbalanced datasets as well as for independent and correlated genotypes.

CONCLUSIONS
methods  <dig> and  <dig> were the most computationally efficient to implement and gave consistently the most accurate, robust and stable estimates of predictive accuracy of the seven methods across all the four scenarios. these properties argue for their routine use in assessing predictive accuracy in genomic selection studies. among the five methods that use cross-validation, methods  <dig> and  <dig> performed better than methods  <dig>   <dig> and  <dig> but were clearly inferior to methods  <dig> and  <dig>  both the genetic variance and the number of genotypes exerted strong influences on predictive accuracy. thus, predictive accuracy was higher for the larger data set. furthermore, reducing the genetic variance degraded predictive accuracy much more for the smaller of the two data sets. we are investigating the influences of genetic variance and the number of genotypes on predictive accuracy in genomic selection in greater detail in a sequel to this paper.

abbreviations
gs: genomic selection; rr-blup: ridge-regression blup; blue: best linear unbiased estimation; blup: best linear unbiased prediction; reml: restricted maximum likelihood; snp: single nucleotide polymorphism; cv: cross-validation; h2: heritability; mme: mixed model equations;  g^ : blup of the genetic effects g; p: the blue of genotype means ; s: sample standard deviation; sg2: sample variance of the true genetic breeding values g; sg^2: sample variance of the predicted breeding value; sp2: phenotypic sample variance; σ: population standard deviation; σg2: population variance of the true genetic breeding values g; r: sample correlation; rg,g^: sample correlation between the true and the predicted breeding values; rg^,p: sample correlation between the blup of g and the observed “phenotypes” p; ρ: population correlation; ρg,p: population correlation between the true genetic breeding values g and the observed “phenotypes” p; sg,g^: sample covariance between the true and predicted breeding values.

competing interests
the authors declare that they have no competing interests.

authors’ contributions
sboe and joo participated in the design of the study, conducting the simulations, interpreting the results, drafting and editing the manuscript. tss participated in conducting the simulations. ck and mo conceived and designed the field trials and supervised the collection of the synbreed data set. ag conceived and designed the field trials and supervised the collection of the agreliant data set. hpp conceived the study, participated in its design, writing and editing the manuscript and oversaw the project. all authors read and approved the final manuscript.

supplementary material
additional file 1
how to compute the average variance of a difference from the variance-covariance matrix of adjusted means.

click here for file

 additional file 2
three special cases for the new method  <dig> 

click here for file

 additional file 3
descriptive statistics for predictive accuracy by scenario , descriptive statistics for the estimated true heritability assuming that genotypes are not correlated for each of the four scenarios , box whisker plot of all the predictive accuracies for scenario  <dig> , box whisker plot of all the predictive accuracies for scenario  <dig> , frequency histograms for the true  versus the estimated  predictive accuracy for all the seven methods and four scenarios , scatter plots of estimated predictive accuracy against the true accuracy for all the seven methods and four scenarios , scatter plots comparing the estimated predictive accuracies for pairs of the seven tested methods for scenario  <dig> , scatter plots comparing the estimated predictive accuracies for pairs of the seven tested methods for scenario  <dig> , scatter plots comparing the estimated predictive accuracies for pairs of the seven tested methods for scenario  <dig>  and scatter plots comparing the estimated predictive accuracies for pairs of the seven tested methods for scenario  <dig> .

click here for file

 additional file 4
sas  code used to simulate phenotypic data and implement all the seven methods.

click here for file

 acknowledgements
we thank agreliant and kws for providing the datasets used in this study. we are grateful to two anonymous reviewers for suggestions that helped improve an earlier draft of this paper. this research was funded by kws saat ag, agreliant genetics and the german federal ministry of education and research  within the agroclusterer “synbreed-synergistic plant and animal breeding” .
