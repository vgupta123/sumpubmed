BACKGROUND
terminal restriction fragment length polymorphism  analysis is a dna-fingerprinting method that can be used for comparison of the microbial community composition in a large number of samples  <cit> . in t-rflp analysis a gene, or a section of a gene, is amplified by pcr with at least one of the primers labeled with a fluorescent marker. the amplified genes are cut into fragments by a restriction enzyme and the resulting restriction fragments are separated by size using polyacrylamide or capillary gel electrophoresis. the terminal restriction fragments , which are labeled with the fluorescent marker, are detected by an automated dna sequencer. each t-rf results in a peak in an electropherogram, where the peak height and area are determined by the strength of the fluorescent signal which in turn is determined by the amount of the t-rf in the sample, i.e. the number of genes with that particular t-rf length. by including reference fragments of known lengths, a size standard, the lengths of the t-rfs can be derived from the migration time through the gel. the set of t-rfs of different lengths obtained from a sample is referred to as a t-rf profile and can be regarded as a dna-fingerprint of the microbial community in the sample. the length of a t-rf is defined by the presence and position of restriction enzyme recognition sites and different gene sequences therefore generate t-rfs of different lengths. as the presence of a t-rf of a certain length indicates the presence of certain gene sequences, differences in microbial community composition between samples can be inferred by differences in detected t-rfs in the t-rf profiles of the samples. to what extent the differences in microbial community composition between two samples are detected depends on the choice of primers and enzymes. to evaluate the suitability of different primers and enzymes for t-rflp analysis several tools are available  <cit> .

the analysis of t-rflp data can be cumbersome and time-consuming, and for large datasets manual data analysis is not feasible. to ensure that the observed differences in t-rf profiles are due to differences in community composition and not introduced by the sample handling or data processing, there are three important steps in the data analysis:  the removal of noise or false peaks,  the alignment of the t-rfs and  the standardization, or normalization, of the t-rf profiles. different approaches for removal of noise in the literature include the application of a high peak detection threshold  <cit> , only considering t-rfs that are reproducible in several replicates  <cit>  and statistical methods  <cit> . during alignment of the t-rf profiles it is determined which t-rfs that are the same in two or more samples. estimation of the t-rf sizes is not exact and can vary between samples. because of this, alignment can be both difficult and time-consuming, especially when analyzing large datasets. the alignment can be done manually  but several non-subjective alignment methods have also been presented . normalization of t-rf profiles aims at removing differences in t-rf profiles due to variations in the amount of dna that was loaded on the gel and several different approaches have been proposed . another aspect of t-rflp data analysis is whether to base the analyses on peak height or peak area data. the argument for using peak area data is that peak heights decrease with increasing migration times in the gel and the abundances of long t-rfs will therefore be underestimated if peak height data is used  <cit> . however, the calculation of peak areas may be skewed by overlapping peaks while peak height calculations are not. furthermore, peak height data has been shown to better reflect the ratios of defined sample concentrations than peak area data  <cit> . in summary, there is no absolute consensus on how t-rflp data should be treated and analyzed before comparisons between samples are made.

a number of different tools have been made available for the automated analysis of t-rflp data, all with their own merits. t-align  <cit>  can be used for alignment of duplicates, generation of consensus profiles and alignment of the consensus profiles. however, the number of replicates is fixed to two, and there are no options for normalization. t-rex  <cit>  has two options for alignment: either simply replacing the observed t-rf sizes with the value of the nearest integer or using an adaptation of the t-align alignment method. however, there is only one option for noise removal, the method by abdo et al.  <cit>  and there is no flexibility in the generation of consensus profiles. the t-rflp stats scripts by abdo et al.  <cit>  only perform the methods described in the paper without any other options. none of the available tools enable easy comparison of different normalization strategies. they also lack options for consensus profile generation and tools for the evaluation of the t-rf alignment. to meet this need, the collection of visual basic macros and the analysis template presented here, from now on referred to as the tools for t-rflp data analysis, were developed. the procedures allow for automated normalization and alignment of replicate profiles, creation of consensus profiles from replicate profiles and normalization and alignment of the consensus profiles. included are also procedures to evaluate the accuracy of the resulting alignments, to calculate association coefficients between t-rf profiles and a diversity index. the macros and the analysis template sheet are designed so that adjustments of the parameters for noise baseline, t-rf analysis range, normalization and alignment can easily be made. in addition, all analyses can be based on either peak height data or peak area data.

implementation
the tools for t-rflp data analysis is provided as an excel file , which includes the necessary visual basic macros. all calculations and storage of data in intermediate and final steps are done in the spreadsheets. this may not be the fastest or most efficient way, but it allows the user fast access to the data and enables easy additional manipulation of the data in a, for many researchers familiar, spreadsheet application.

although excel is software written for the windows operating system, it can also be used on computers with other operating systems through the use of virtualizers, which enables more than one operating system to be run at the same time.

input data
the input t-rflp data must be given in the sheet ”input data”. the data must be in the format as given by the example in table  <dig> or in the sheet ”input data example”. this format is easily obtained directly from programs such as genemapper , which is common for the analysis of raw data.table  <dig> 
input data format with example data



sample name
sample  <dig> 
sample  <dig> 
sample  <dig> 
sample  <dig> 
sample  <dig> 
sample  <dig> 

t-rf 1

t-rf 2

t-rf 3

size 1

size 2

size 3

height 1

height 2

height 3

area 1

area 2

area 3
an example of six samples with at most three t-rfs each. columns are samples and rows are sample names, presence or absence values , t-rf sizes, peak heights and peak areas.



input parameters
initial parameters regarding data range, alignment, normalization, consensus profile generation and number of profiles, samples and replicates must be given in the sheet “input”. the parameters and examples of values are given in table  <dig>  parts of the results of the analyses will also be written in the ”input” sheet.table  <dig> 
required input parameters with example values



parameter
value

 <dig>  total number of profiles

 <dig>  number of samples

 <dig>  number of replicates per sample

 <dig>  number of t-rfs

 <dig>  sample names on row

 <dig>  consider t-rf if present in x replicates. x=

 <dig>  align t-rfs with a size difference shorter than y bases. y=

 <dig>  add t-rfs less than z bases longer than the average size of the alignment. z=

 <dig>  peak height detection threshold. pdt =

 <dig>  lower t-rf size limit

 <dig>  upper t-rf size limit

 <dig>  fixed percentage threshold. fpt=
parameters 1– <dig> and 9– <dig> are used for the initial preparation of the data. parameters 1– <dig> are also used by procedures that need the number of samples or replicates to be specified. parameter  <dig> is used for the generation of consensus profiles. parameters  <dig> and  <dig> are used in the alignment of t-rf profiles. parameter  <dig> is used for normalization with the fixed percentage threshold procedure.



analysis
the different steps of the data analysis are outlined in the sheet ”analysis protocol - all tools” in the analysis template  and in table  <dig>  figure  <dig> shows the order and possible combinations of the analysis steps. rather than having one procedure performing all steps the user must run the macros for the different steps. this allows for flexibility regarding what steps to include in the analysis. between the steps the user also has the option to change the data that is going to be used, by copying the relevant data to the sheet “indata”. this allows for flexibility regarding what data to use in each step of the analysis. the corresponding procedures and input and output data sheets for the different analysis steps are shown in table  <dig> table  <dig> 
analysis steps and the corresponding procedures



step
macro name
input sheet
output sheet

prepare the data

normalize replicate profiles

2

 <dig> alt. 1

 <dig> alt. 2

 <dig> alt. 3

 <dig> alt. 4

 <dig> alt. 5

align replicate profiles

4

5

correct the alignment

6

check and correct for systematic differences in size estimation between replicates

7

8

9

create consensus profiles

10

 <dig> alt. 1

 <dig> alt. 2

normalize consensus profiles

12

 <dig> alt. 1

 <dig> alt. 2

 <dig> alt. 3

 <dig> alt. 4

align consensus profiles

14

15

16

check and correct for systematic differences in size estimation between consensus profiles

17

18

19

calculate the relative abundances of the t-rfs

20

 <dig> alt. 1

 <dig> alt. 2

calculate association coefficients

22

23

24

calculate diversity index

25

26order and possible combinations of analysis steps. the analysis steps outlined in the figure correspond to the headings in table  <dig> 



documentation
as the typical analysis of t-rflp data includes several different steps involving a number of different parameters it is good practice to document the analysis. an analysis history including information about input data, applied procedure and output data is automatically created in the sheet “run history”.

restrictions and limitations
the maximum number of fragments is  <dig> per profile. however, this number can be changed by changing the appropriate numbers in the code for the macros.

if the dataset contains sample replicates it is assumed that all samples have the same number of replicates.

the procedures do not check that the given data has the right format. if the data is formatted the wrong way or parameters are not given an error message will be given by excel.

if a procedure is run more than once an error message will appear that says: “cannot rename a sheet to the same name as another sheet…”. this is because the procedure tries to create a new sheet with the same name as a sheet which was created during the first run. to run a procedure more than once the user must delete or rename the sheets that were created by the procedure the first time.

description of procedures
preparation of the data
macro: a_prepare_alignment
this procedure uses the data in the sheet “input data” and the parameters in the sheet “input”. note that the value  <dig> and blank cells are treated indistinctively. the procedure applies the peak detection threshold and t-rf length restrictions given in the “input” sheet and copies sample names, peak sizes, heights and areas to a new sheet called ”appliedpdtandanalysisrange”. three new sheets that are used in the following analyses are also created: ”indata”, “tempindata” and “tempworking”. the maximum observed number of t-rfs in a profile after application of threshold and t-rf length restrictions is written in the “input” sheet. the data in the sheet ”appliedpdtandanalysisrange” is copied to the sheet “indata” for further analysis.

normalization of replicate profiles
there are five options for the normalization of replicate profiles.

three of the available procedures use the total fluorescence normalization  procedure described by dunbar et al.  <cit> . this procedure normalizes the profiles so that all profiles will have the same, or similar, total fluorescence. the total fluorescence is defined as either the sum of all peak heights or peak areas in a profile. all t-rfs of a profile with a total fluorescence, tf, higher than the lowest total fluorescence in the dataset, tfmin, are multiplied with a factor tfmin/tf. t-rfs that fall below a defined threshold after the multiplication are removed and a new tf is calculated with the remaining t-rfs. the new tf is compared with tfmin once again and the procedure is reiterated until the new tf is equal to tfmin. if the new tf oscillates between two states, higher than and lower than tfmin, due to the inclusion or exclusion of a t-rf close to the threshold, the profile is calculated taking the average of the two states.

the two remaining procedures use an approach where all t-rfs with a relative abundance below a fixed percentage threshold  are removed. the fpt must be given in the “input” sheet. the relative abundance of a t-rf is the peak height  divided by the total fluorescence, i.e. the sum of all peak heights  in that profile. the fpt approach has previously been described and applied by li et al. using peak areas  <cit> .

macro: b_normalize_replicates_tfnareas
tf is defined as the sum of all peak areas. the minimum allowed peak area is the minimum observed peak area among all profiles in the dataset, not just among the replicates that are normalized. the procedure uses the sheet “tempworking” for calculations, the data in the sheet “indata” and the parameters in the sheet “input”. creates a new sheet called ”normalizedreplicatestfnareas”. the data in the sheet ”normalizedreplicatestfnareas” is copied to the sheet “indata” for further analysis.

macro: b_normalize_replicates_tfnareas_lt
tf is defined as the sum of all peak areas. the minimum allowed peak area is the minimum observed peak area among the replicates that are normalized. this procedure is equivalent to the normalization procedure described by kaplan et al.  <cit> . the procedure uses the sheet “tempworking” for calculations, the data in the sheet “indata” and the parameters in the sheet “input”. creates a new sheet called ”normalizedreplicatestfnareaslt”. the data in the sheet ”normalizedreplicatestfnareaslt” is copied to the sheet “indata” for further analysis.

macro: b_normalize_replicates_tfnheights
total fluorescence is defined as the sum of all peak heights. this procedure is identical to the procedure by dunbar et al.  <cit> . the minimum allowed peak height is the peak detection threshold given in the “input” sheet. the procedure uses the sheet “tempworking” for calculations, the data in the sheet “indata” and the parameters in the sheet “input”. creates a new sheet called ”normalizedreplicatestfnheights”. the data in the sheet ”normalizedreplicatestfnheights” is copied to the sheet “indata” for further analysis.

macro: b_normalize_all_fptareas
this procedure normalizes all samples using a fixed percentage threshold given in the “input” sheet. as each profile is normalized independent of the other profiles in the dataset the same procedure can be applied for both replicate and consensus profiles. the relative abundances of all t-rfs are calculated using peak areas and values are only copied for t-rfs with a relative abundance above the threshold. the procedure uses the data in “indata” and creates a new sheet called ”allnormalizedfptareas”. the data in the sheet ”allnormalizedfptareas” is copied to the sheet “indata” for further analysis.

macro: b_normalize_all_fptheights
this procedure normalizes all samples using a fixed percentage threshold given in the “input” sheet. as each profile is normalized independent of the other profiles in the dataset the same procedure can be applied for both replicate and consensus profiles. the relative abundances of all t-rfs are calculated using peak heights and values are only copied for t-rfs with a relative abundance above the threshold. the procedure uses the data in “indata” and creates a new sheet called ”allnormalizedfptheights”. the data in the sheet ”allnormalizedfptheights” is copied to the sheet “indata” for further analysis.

alignment of replicate profiles
the replicate profiles are aligned using the moving average procedure described by smith et al. for t-align  <cit> . the shortest t-rf of all profiles is identified and placed in an alignment bin. all other t-rfs that are at most y bases longer than the first t-rf are also included in the alignment bin. the average length of all t-rfs within the alignment bin is then calculated and any additional t-rfs that are at most z bases longer than the average length of the bin are also included. if a t-rf is added a new average length is calculated and a new search is done to see if more t-rfs are now within the distance z from the new average and thus should be added. if no additional t-rfs are added a new alignment bin is created and the process starts over with the remaining t-rfs, identifying the shortest t-rf of all profiles that is not already in an alignment bin. a t-rf profile is only allowed to have one t-rf in each alignment bin. the parameters y and z must be given by the user in the “input” sheet.

the resulting alignment is not always accurate. if one replicate has a t-rf with a size in between two t-rfs that both are within the alignment range in the other replicates, the shortest t-rfs will always be aligned together, even if the longest t-rfs are more similar in size . this happens because the alignment process works from shorter t-rfs to longer t-rfs, without checking if alternative ways of binning the t-rfs are more accurate. for duplicates this can easily be resolved, by binning the t-rfs that are most similar in size . for more than two replicates the same correction procedure can be applied but what the correct alignment really is, is not always as easily determined .table  <dig> 
examples of automatic and corrected alignment of two profiles with four t-rfs



automatic alignment
sample 1
sample 2

t-rf 1

t-rf 2

t-rf 3

t-rf 4

corrected alignment
sample 1
sample 2

t-rf 1

t-rf 2

t-rf 3

t-rf 4
the given numbers are the t-rf sizes in bases.
an example of automatic and corrected alignment of four profiles with two t-rfs



automatic alignment
sample 1
sample 2
sample 3
sample 4

t-rf 1

t-rf 2

corrected alignment
sample 1
sample 2
sample 3
sample 4

t-rf 1

t-rf 2
the given numbers are the t-rf sizes in bases.



macro: c_align_replicate_profiles
this procedure aligns the replicate profiles using the moving average procedure as described above. the procedure uses the sheet “tempworking” for calculations, the data in the sheet “indata” and the parameters in the sheet “input”. creates a new sheet called ”replicatesamplesaligned”. the number of alignment bins after alignment is written in the “input” sheet. the data in the sheet ”replicatesamplesaligned” is copied to the sheet “indata” for further analysis.

macro: d_findandcorrectambiguousalignments
this procedure identifies t-rfs that are within the alignment range y of both a shorter and a longer t-rf in the other replicates. the t-rfs are then aligned with the t-rf that is closest in size and size height and area data are adjusted accordingly. the data from ”replicatesamplesaligned” is copied and a new sheet called ”correctedrepsamplesaligned” is created. cells with t-rfs that are within the alignment range of t-rfs in another alignment bin are highlighted in yellow and cells with t-rfs that have been changed to new alignment bins are framed. the number of possibly ambiguous t-rfs and the number of corrected alignments are written in the “input sheet”. the data in the sheet ”correctedrepsamplesaligned” is copied to the sheet “indata” for further analysis.

detection and correction of systematic differences in size estimation between replicates
there are always variations in the size estimation of the t-rfs, even between subsequent loadings of the same sample, and this variation can cause errors in the alignment of the t-rfs. the following procedures first checks if the differences in t-rf sizes between two replicates are due to a systematic shift, i.e. if all t-rfs in one of the replicates are shorter than all t-rfs in the other. the systematic shift is then corrected for and new t-rf sizes are calculated and the profiles are re-aligned. finally, the new alignment is compared with the original alignment and t-rfs that are binned differently in the two alignments are identified. the calculation of new t-rf sizes and re-alignment of the profiles is done for all replicates, regardless if there was a systematic shift in t-rf sizes between them. if the comparison with the alignment of shift-corrected t-rfs shows that the alignment of the replicate profiles needs to be corrected, the correction must be done manually, changing the corresponding size, height and area data.

macro: e_checkreplicatesystematicshifts
in this procedure pairwise comparisons are made between all replicates of the same sample. the sizes of the t-rfs in all alignment bins of the two replicates are compared. if all t-rfs in one of the replicates are shorter than all t-rfs in the other, there is a systematic shift in size estimation between the two. the procedure uses the data from the sheet “indata” and “input” and creates new sheets called ”repsystematicshiftcheck” and ”repsystematicshiftmatrix”. in ”repsystematicshiftcheck” the result of all t-rf size comparisons are given and in ”repsystematicshiftmatrix” there is a matrix showing which profiles that display a systematic shift towards one another.

macro: f_shiftcorrectedreplicatesizes
this procedure calls the procedures f <dig> to f <dig>  described below, for calculation and analysis of systematic shift corrected t-rf sizes.

macro: f1_relativereplicatesizes
this procedure calculates new t-rf sizes using a t-rf common to all replicates as a reference which is set to size  <dig>  relative sizes, i.e. the difference in size between a t-rf and the reference t-rf, are calculated for all other t-rfs and the standard deviation of the t-rf sizes is calculated for all alignment bins. all common t-rfs are tested as references and the t-rf which results in the lowest size variation within the alignment bins, i.e. the lowest sum of the standard deviations of all alignment bins, is chosen. the chosen reference t-rf is given the same value in all replicates, the average of the original sizes, and new sizes are calculated for the other t-rfs based on their relative sizes. the procedure uses the sheet “tempworking” for calculations and the data in the sheet “indata”. creates a new sheet called ”replicaterelativesizes” with the sizes relative to the reference t-rf and a sheet called ”newreplicatesizes” with recalculated sizes based on the average size of the reference t-rf.

macro: f2_alignreplicateswithrelativesizes
this procedure aligns the replicate profiles with new t-rf sizes using the moving average procedure described above for the alignment of the original replicate profiles. the only data used here is the size data, not peak height or area data. the procedure uses the sheets “tempworking” and “tempindata” for calculations, the data in the sheet “indata” and the parameters in the sheet “input”. creates a new sheet called ”newreplicatesizesaligned”.

macro: f3_findandcorrectambiguousalignments
this procedure is identical to d_findandcorrectambiguousalignments, described above, except that no new sheet is created and the corrections are made in the ”newreplicatesizesaligned” sheet. the number of possibly ambiguous t-rfs and the number of corrected alignments are written in the “input sheet”.

macro: f4_comparenewrepsizesalwithindata
this procedure compares the alignment of the systematic shift corrected t-rf sizes with the original alignment. the procedure uses the data in the sheet “indata”, which is the original alignment, and “newreplicatesizesaligned”, which is the new alignment. cells in ”newreplicatesizesaligned” that differs from “indata” are highlighted in red. the number of replicate t-rfs placed in different bins when relative sizes are used is written in the “input sheet”.

generation of consensus profiles
these procedures combines the aligned replicate profiles into one consensus profile. the t-rfs are considered for the consensus profiles if they are present in at least x replicates. the parameter x must be given in the “input” sheet. the t-rf sizes of the consensus profile are the average sizes of the t-rfs in the replicates. the peak heights and areas can be calculated as either the average or the sum of the peak heights and areas of the replicates.

macro: g_repconsensus_average
this procedure creates consensus profiles from the replicates. a t-rf is considered if it is present in x number of replicates as specified in the “input” sheet. the new size, height and area data is the average value of all replicates. the procedure uses the data in “indata” and creates a new sheet called ”repconsensus”. the data in the sheet ”repconsensus” is copied to the sheet “indata” for further analysis.

macro: g_repconsensus_sum
this procedure creates consensus profiles from the replicates. a t-rf is considered if it is present in x number of replicates as specified in the “input” sheet. the new size is the average value of all replicates but the height and area data is the sum of all replicates. the procedure uses the data in “indata” and creates a new sheet called ”repconsensussum”. the data in the sheet ”repconsensus” is copied to the sheet “indata” for further analysis.

normalization of consensus profiles
there are four options for the normalization of consensus profiles. two use the tfn procedure described above for the normalization of replicate profiles with total fluorescence defined as the sum of either all peak areas or all peak heights. the other two use the fpt threshold described above for the normalization of replicate profiles. for the fpt threshold approach the previously described procedures b_normalize_all_fptareas and b_normalize_all_fptheights can be used. note that if these procedures have already been used for the normalization of replicates the sheets that were created, ”allnormalizedfptareas” and ”allnormalizedfptheights”, must be renamed before running the procedures.

macro: h_normalize_all_tfnareas
this procedure normalizes all samples using the tfn procedure, defining the total fluorescence as the sum of all peak areas. the minimum allowed peak area is the minimum observed peak area among all profiles in the dataset. the procedure uses the sheet “tempworking” for calculations, the data in the sheet “indata” and the parameters in the sheet “input”. a new sheet called ”allnormalizedtfnareas” is created. the data in the sheet ”allnormalizedtfnareas” is copied to the sheet “indata” for further analysis.

macro: h_normalize_all_tfnheights
this procedure normalizes all samples using the tfn procedure, defining the total fluorescence as the sum of all peak heights. the minimum allowed peak height is the defined peak detection threshold in the “input” sheet. the procedure uses the sheet “tempworking” for calculations, the data in the sheet “indata” and the parameters in the sheet “input”. a new sheet called ”allnormalizedtfnheights” is created. the data in the sheet ”allnormalizedtfnheights” is copied to the sheet “indata” for further analysis.

alignment of consensus profiles
the consensus profiles are aligned using the moving average procedure as described above for the alignment of replicate profiles. the number of t-rfs and the minimum, maximum and average t-rf size is then calculated for all alignment bins. the alignment bins are also checked and bins that are possibly ambiguous are highlighted. the alignment of the t-rfs is what determines how similar the profiles are and since the purpose of a t-rflp analysis often is to identify differences in microbial community composition between samples it is important that the alignment is done in an adequate way. here, an alignment bin is considered ambiguous if the longest t-rf of the bin is within the alignment range of the shortest t-rf in the following alignment bin. this means that a pair-wise comparison of the samples, or an analysis of a subset of the samples, would result in a different alignment. table  <dig> shows an example of an alignment bin that was classified as ambiguous. after the automatic alignment of the profiles in table  <dig> sample  <dig>   <dig> and  <dig> were determined to share one component  of the bacterial community while sample  <dig>   <dig> and  <dig> shared another. however, as detected by the control procedure, j_check_alignedconsensus, this does not seem entirely correct. the t-rf in the profile of sample  <dig> is outside the alignment range of the t-rfs of the profiles of sample  <dig> and  <dig> and within the alignment range of the t-rfs in the profiles of samples  <dig>   <dig> and  <dig>  but it was only aligned with the profiles of sample  <dig> and  <dig>  furthermore, if we would exclude the profiles of sample  <dig> and  <dig> from the analysis, the t-rfs in all remaining profiles would be aligned together and not in different bins, as in table  <dig>  as the alignment bins cannot be separated in a convincing unambiguous way they are classified as ambiguous. as in the correction of the alignment of replicate profiles, alignment bins may be marked as ambiguous although they are accurate .table  <dig> 
example of two alignment bins classified as ambiguous



samples
1
2
3
4
5
6
no of t-rfs
min size
max size
mean size
ambiguous

t-rf 1

t-rf 2
the table replicates the output of the procedure “j_check_alignedconsensus”. following the columns of the six samples, where the given numbers are the t-rf sizes in bases, are columns for the number of t-rfs, the minimum t-rf size, the maximum t-rf size and the mean t-rf size in each alignment bin. the last column is either “yes” or “no”, indicating whether the alignment bin is ambiguous or not.
examples of correct alignments that are classified as ambiguous



samples
1
2
3
4
no of t-rfs
min size
max size
mean size
ambiguous

t-rf 1

t-rf 2

t-rf 3

t-rf 4
the table replicates the output of the procedure “j_check_alignedconsensus”. following the columns of the six samples, where the given numbers are the t-rf sizes in bases, are columns for the number of t-rfs, the minimum t-rf size, the maximum t-rf size and the mean t-rf size in each alignment bin. the last column is either “yes” or “no”, indicating whether the alignment bin is ambiguous or not.



macro: i_align_consensus_profiles
this procedure aligns the consensus profiles using the moving average procedure described above for the alignment of replicate profiles. the procedure uses the sheet “tempworking” for calculations, the data in the sheet “indata” and the parameters in the sheet “input”. a new sheet called ”alignedconsensus” is created. the number of alignment bins is written in the “input sheet”. the data in the sheet ”alignedconsensus” is copied to the sheet “indata” for further analysis.

macro: j_check_alignedconsensus
this procedure checks the alignment, counts fragments and calculates minimum, maximum and average sizes. alignment bins that are considered ambiguous are marked as such in the sheet “alignedconsensus”. the number of possibly ambiguous t-rfs is written in the “input sheet”. the data in the sheet ”alignedconsensus” is copied to the sheet “indata” for further analysis.

detection and correction of systematic differences in size estimation between consensus profiles
as in the analysis of the replicate profiles, all consensus profiles are compared pair-wise to detect if there are systematic differences in the estimation of t-rf sizes. the systematic shift is corrected for, new t-rf sizes are calculated and the profiles are re-aligned. the calculation of new t-rf sizes and re-alignment of the profiles is done for all profiles, regardless if there was a systematic shift towards any other profile or not. the comparison with the original alignment must be done manually. if the alignment of the consensus profiles should be corrected after comparison with the alignment of shift-corrected t-rfs the correction must be done manually, changing the size, height and area data.

macro: k_checkconsensussystematicshifts
pairwise comparisons are made between all consensus profiles. if all t-rfs in one of the profiles are shorter than all t-rfs in the other, there is a systematic shift in size estimation between the two. the procedure uses the data from the sheet “indata” and “input” and creates new sheets called ”consrepsystematicshiftcheck” and ”consrepsystematicshiftmatrix”. five columns after the last sample in the “indata” sheet there must be a column with information about which alignment bins that should be disregarded for the analysis, i.e. if the alignment is correct or ambiguous . the value should be ”yes” for ambiguous bins and ”no” for correct bins. in ”consrepsystematicshiftcheck” the result of all t-rf size comparisons are given and in ”consrepsystematicshiftmatrix” there is a matrix showing which profiles that display a systematic shift towards one another.

macro: l_shift_corrected_consensus_sizes
this procedure calls the procedures l <dig> to l <dig> for calculation and analysis of systematic shift corrected t-rf sizes.

macro: l1_relativeconsensussizes
this procedure calculates new, relative, t-rf sizes. a t-rf common to all consensus profiles is chosen as a reference fragment and the size of the t-rf is set to  <dig> for all profiles. relative sizes, i.e. the difference in size between a t-rf and the reference t-rf, are calculated for all other t-rfs and the standard deviation of the t-rf sizes is calculated for all alignment bins. all common t-rfs are tested as references and the t-rf which results in the lowest size variation within the alignment bins, i.e. the lowest sum of the standard deviations of all alignment bins, is chosen. the chosen reference t-rf is given the same value in all profiles, the average of the original sizes, and new sizes are calculated for the other t-rfs based on their relative sizes. the procedure uses the sheets “tempworking” for calculations and the data in the sheet “indata”. three new sheets are created: ”consrelativesizesstdevs”, which lists all reference fragments and the corresponding standard deviations, ”consensusrelativesizes”, which contains the sizes relative to the reference t-rf and ”newreplicatesizes”, which include the recalculated sizes based on the average size of the reference t-rf.

macro: l2_alignconsensusrelativesizes
this procedure aligns the consensus profiles with the new t-rf sizes using the moving average procedure described above for the alignment of replicate profiles. the procedure only handles size data and do not align or use peak height or area data. the procedure uses the sheets “tempworking” and “tempindata” for calculations, the data in the sheet “indata” and the parameters in the sheet “input”. a new sheet called ”alignedconsshiftcorrsizes“ is created.

macro: l3_check_alignedconssystshiftcorrsizes
this procedure checks the alignment, counts fragments and calculates minimum, maximum and average sizes. alignment bins that are considered ambiguous are marked as such in the sheet ”alignedconsshiftcorrsizes“. the number of possibly ambiguous t-rfs is written in the “input sheet”.

calculation of the relative abundances of t-rfs
the relative abundances of the t-rfs, instead of the absolute numbers, are often used for the analyses of the t-rf profiles. the relative abundance of a t-rf is calculated as the peak height  divided by the sum of all peak heights  of the t-rf profile.

macro: m_relative_abundance_heights
this procedure calculates the relative abundance of the t-rfs of all profiles. the total fluorescence is defined as the sum of all peak heights. the procedure uses the data from “indata” and creates a new sheet called ”relativeabundanceheights”. the data in the sheet ”relativeabundanceheights” is copied to the sheet “indata” for further analysis.

macro: m_relative_abundance_areas
this procedure calculates the relative abundance of the t-rfs of all profiles. the total fluorescence is defined as the sum of all peak areas. the procedure uses the data from “indata” and creates a new sheet called ”relativeabundanceareas”. the data in the sheet ”relativeabundanceareas” is copied to the sheet “indata” for further analysis.

calculation of association coefficients
using the relative abundance data two common association coefficients can be calculated: the bray-curtis distance coefficient, which takes the relative abundance of the t-rfs in consideration, and the jaccard similarity coefficient, which put equal weight on all t-rfs, regardless of their relative abundance.

macro: n_braycurtis_matrix
this procedure calculates the bray-curtis distance  for all pair-wise comparisons of the t-rf profiles. the procedure uses the data in “indata” and creates a new sheet called ”braycurtismatrix”. the formula for the calculation is: \documentclass{minimal}

macro: o_jaccardcoeff_matrix
this procedure calculates the jaccard similarity coefficient  for all pair-wise comparisons of the t-rf profiles. the procedure uses the data in “indata” and creates a new sheet called ”jaccardcoeffmatrix”. the formula for the calculation is: \documentclass{minimal}

calculation of diversity index
using the relative abundance data the widely used shannon diversity index can be calculated. note that the diversity index should only be used for comparison with other profiles in the same dataset that have been analyzed the same way. the number of t-rfs in the profile is highly dependent on the applied peak detection threshold, the normalization and how the consensus profile was generated. therefore, the diversity index should not be used as an absolute value and should not be compared with diversity indices of samples from other analyses.

macro: p_shannonindex
this procedure calculates the shannon diversity index  for all profiles. the procedure uses the data in “indata” and creates a new sheet called ”shannon index”. the formula for the calculation is:

\documentclass{minimal}

example dataset
the dataset used here was taken from a study of bacterial dynamics in a wastewater treatment plant  and is provided in additional file  <dig> 

sample collection and dna extraction
samples were collected at the end of the aerated basins at the rya wwtp, a wwtp treating both industrial and municipal wastewater  <cit> . permission to enter the rya wwtp and to collect activated sludge samples were granted by gryaab ab . 50 ml of sample were centrifuged and the resulting pellet was stored at −20°c within  <dig>  h from collection. dna was extracted using power soil dna extraction kit . the frozen sludge pellets were thawed, 15 ml sterile water were added and the samples were homogenized by 6 min of mixing in a bagmixer  <dig> minimix . water was removed by centrifugation and dna was extracted from  <dig>  g of homogenized sludge pellet according to the manufacturer’s instructions.

pcr
16s rrna genes were amplified using hotstartaqplus pcr kit  according to the manufacturer’s instructions. the bacteria-specific primer pair 63 f  and m1387r  were used. the primer pair was based on the sequences 63f and 1387r  <cit> , which were previously evaluated using strains of all major bacterial groups, including gram-positive bacteria, and was found to be more successful than the commonly used primer pair 27f&1392r  <cit> . the primer 1387r has a mismatch for some bacterial sequences at position  <dig>  <cit>  and was therefore modified. the forward primer 63f was labeled at the 5’-end with the fluorescent dye  <dig> – carboxyfluorescein. pcr reactions were carried out in the provided pcr buffer with  <dig>  u hotstartaqplus, 200 μm dntp mix,  <dig>  μm of each primer and 2–5 ng dna. the cycle profiles had an initial 5 min at 95°c for taq polymerase activation followed by 35 cycles of denaturation at 94°c for 1 min, annealing at 60°c for 30 s and elongation at 72°c for 1 min. the reactions were ended with a final elongation step at 72°c for 7 min.

t-rflp
the pcr products were purified using the agencourt ampure system  and digested with  <dig> units of restriction enzyme hhai or rsai  in the manufacturer’s provided buffers  <dig> or  <dig>  respectively. digestion was carried out at 37°c for at least 16 hours and the restriction digests were purified using the agencourt ampure system. for each reaction, 2 μl purified restriction fragments were added to  <dig>  μl formamide and  <dig>  μl of the size standard liz <dig> . the fragments were analyzed by capillary gel electrophoresis  using a 20s injection time, a  <dig>  kv injection voltage and a 9 kv run voltage. the software genemapper  was used to quantify the electropherogram data and to generate the t-rf profiles. the settings used for the raw data processing in genemapper was a peak detection threshold of  <dig>  default peak detection settings and the local southern size calling algorithm. data for presence/absence, size, peak height and peak area was retrieved for all t-rfs in all samples using the genemapper report manager.

data analysis
the dataset was prepared with analysis range  <dig> to  <dig> bases and peak detection threshold  <dig> and  <dig>  separately. for the data generated with peak detection threshold  <dig>  sample duplicates were normalized using all five normalization methods. after normalization with tfn-heights, sample duplicates were aligned, checked for systematic differences in t-rf size estimation, and used to generate consensus profiles, considering t-rfs present in both or only one of the two replicate profiles. the height and area of the consensus t-rfs were calculated as the average of the heights and areas of the replicate profiles. the consensus profiles with only t-rfs present in both replicates were then normalized using all four methods. the consensus profiles normalized with the tfn-heights procedure were used for calculations of the relative abundances of the t-rfs and for calculation of association coefficients and diversity index. as a comparison a matrix of jaccard coefficients was also calculated for the dataset treated without alignment correction and without normalization. the example data was also analyzed using t-rex with the following settings: noise filtering was performed using the procedure described by abdo et al.  <cit>  for all samples based on peak heights. the standard deviation multiplier was set to  <dig>  the t-rfs were aligned using the t-align method  <cit>  with a clustering threshold of  <dig>  allowing at most one peak per plot in each t-rf. after alignment a data matrix was constructed using the average peak height data of the replicates. the resulting peak heights were relativized within samples. the data was exported and the jaccard coefficients were calculated using the tools for t-rflp data analysis.

RESULTS
the functionality of the provided procedures in the tools for t-rflp data analysis was compared with the available software t-align  <cit> , t-rex  <cit>  and the script package t-rflp stats  <cit> . a dataset of 76 t-rf profiles from  <dig> activated sludge samples were used to illustrate the procedures .

data preparation
using the tools for t-rflp data analysis peak detection thresholds of the users choice can be applied before any other analysis is carried out. at this stage the user also specifies the analysis range, i.e. restricting the analysis to only include t-rfs of lengths between a minimum and maximum value. neither of these two options is available in any of the other three programs. instead of using a fixed baseline threshold to remove noise and false peaks, both t-rex and t-rflp stats use the noise filtering method presented by abdo et al.  <cit> .

with an applied peak detection threshold of  <dig>  as for example culman et al.  <cit> , the average number of t-rfs of the  <dig> profiles in the example dataset were 32 ±  <dig>  increasing the threshold to  <dig>  as osborn et al.  <cit> , decreased the average number of t-rfs to 20 ±  <dig>  the threshold level should be set high enough to exclude noise peaks from the analysis but how high the threshold needs to be to ensure this may vary between different analytical platforms and analyses. a wide range of peak detection thresholds can be found in the literature, from as low as  <dig>  <cit>  to as high as  <dig>  <cit> .

normalization of replicate profiles
neither t-align, t-rex or t-rflp stats include any normalization method. the tools for t-rflp data analysis provide five different methods for the normalization of the replicate profiles. having various available options for normalization allows for comparisons of the different methods.

in the example dataset, the number of remaining t-rfs in the profiles after normalization was different for all five methods . the methods included the previously published methods tfn-heights  <cit> , tfn-areas-lt   <cit>  and fpt-areas  <cit>  as well as the variants tfn-areas and fpt-heights.figure  <dig> 
number of remaining t-rfs after normalization of replicate profiles. each of  <dig> replicate profile pairs was normalized using the procedures tfn-heights , tfn-areas , tfn-areas-lt , fpt-heights  and fpt-areas . as a result of normalization, t-rfs are removed from the profiles. the figures show the number of t-rfs in each profile after normalization.



alignment of replicate profiles
the tools for t-rflp data analysis implements the same alignment procedure as t-align and t-rex, with the exception that the user can specify two of the parameters for the alignment instead of just one. this enables the user to adjust the algorithm so that it best suits the properties of the data, i.e. the observed range of variation in t-rf size estimations. another improvement of the alignment procedure is the correction of the alignment. the alignment produced by the algorithm used in t-align does not always align the t-rfs correctly  and in tools for t-rflp data analysis an option to automatically correct the alignment of replicate profiles is provided .

in the example dataset four alignment bins had to be corrected after alignment of the replicate t-rf profiles.

detection and correction of systematic differences in size estimation between replicates
the tools for t-rflp data analysis also implements an additional approach for evaluation and correction of the alignment of the t-rfs. this is not provided by any of the other available programs. if the number of replicates is only two, the automatic correction of the alignment is enough, but for higher number of replicates the procedures can be of value, as for the alignment of consensus profiles .

although the alignment of the replicate profiles in the example dataset already was corrected, the data was checked for systematic differences in t-rf size estimations. five replicate pairs showed a systematic difference in t-rf lengths. however, the alignment obtained after adjusting for the systematic shift was exactly the same as the original corrected alignment.

generation of consensus profiles
in t-align the default setting for generation of consensus profiles is to only consider t-rfs present in all replicates and the average value of the peak heights and areas corresponding to those t-rfs are then calculated. in t-rex consensus profiles are generated by averaging the values of all t-rfs in the replicates, independent of the number of replicates that the t-rfs are present in. the tools for t-rflp data analysis allows the user to specify how the consensus profiles are generated: which t-rfs to consider and if the average or the sum of the peak height and area values should be used. the option to use the sum of the peak heights and areas of replicates could be used to emulate the effect of pooling replicates before the loading on the gel.

consensus profiles generated by only considering t-rfs that were present in both of the two replicates, as suggested by dunbar et al.  <cit> , had fewer t-rfs than the consensus profiles generated considering all t-rfs in both replicate profiles, as in the program t-rex .figure  <dig> 
number of t-rfs in the consensus profiles. t-rfs were included in the consensus profiles if they were present in one  or both  of the two replicates.



normalization of the consensus profiles
there are four options for the normalization of consensus profiles. as stated before, neither t-align, t-rex or t-rflp stats include any normalization method.

all four available normalization methods were applied in the analysis of the example dataset. the tfn-heights method  <cit>  reduced the number of t-rfs the most .figure  <dig> 
number of remaining t-rfs after normalization of consensus profiles. the consensus profiles were normalized using the procedures tfn-heights , tfn-areas , fpt-heights  and fpt-areas .



alignment of the consensus profiles
the consensus profiles are aligned the same way as the replicate profiles. there is no correction procedure for the alignment of the consensus profiles, but a control function is provided where potentially erroneous alignment bins are classified as ambiguous and highlighted.

in the example dataset the alignment resulted in  <dig> alignment bins of which  <dig> were classified as ambiguous. by inspection,  <dig> of the ambiguous alignment bins were determined to be correct  and  <dig> were manually corrected . however,  <dig> alignment bins still remained ambiguous .figure  <dig> 
example of correct alignment bins classified as ambiguous. the symbols represent the alignment bins created in the automatic alignment procedure.
example of correction of an ambiguous alignment bin. alignment bins created in the automatic alignment  and after manual correction . the symbols represent the two alignment bins. only sample  <dig> had t-rfs in both alignment bins. the correction was motivated by the observation that the t-rfs in the profiles of all other samples were closer in size to the longer t-rf than the shorter t-rf in sample  <dig> 
example of systematic shift correction. alignment of original t-rf sizes  and systematic shift corrected t-rf sizes . the symbols represent the alignment bins created in the automatic alignment.



detection and correction of systematic differences in size estimation between consensus profiles
the detection and correction of systematic differences in t-rf size estimation between consensus profiles is done the same way as for the replicate profiles. there are generally more systematic differences between the consensus profiles than between the replicate profiles and consequently the differences between the original and the systematic shift-corrected alignment are often greater for the consensus profiles than for the replicate profiles.

by adjusting for the systematic differences in size estimation, the alignment could be resolved for six of the nine remaining ambiguous alignment bins  in the example dataset.

calculation of the relative abundances of t-rfs
the relative abundances of the t-rfs can be calculated using either peak heights or areas. this is possible both in t-rex and in tools for t-rflp data analysis.

calculation of association coefficients and diversity index
neither one of the three available programs  provides an option to compare the t-rf profiles by calculating association coefficients or diversity indices. in the tools for t-rflp data analysis there are two association coefficients available: the jaccard similarity coefficient and the bray-curtis distance coefficient, and one diversity index: the shannon diversity index. there are other programs dedicated to statistical analysis which provide a wide range of association coefficients and diversity indices, for example past  <cit> . however, for convenience these two common association coefficients and one diversity index were included in the tools for t-rflp data analysis.

the jaccard similarities between all profiles and the profile of the first sample in the dataset were calculated for three different treatments of the example dataset . figure  <dig> clearly shows that how t-rflp data is treated has an impact on the final comparisons of community composition. to evaluate which treatment approaches that are the most accurate the tools for t-rflp data analysis presented here can be of great use.figure  <dig> 
jaccard similarity between all profiles and the profile of the first sample. the data was treated in three different ways. x: pdt  <dig>  no normalization, no alignment correction. squares: pdt  <dig>  tfn-heights, normalization of both replicate and consensus profiles. circles: t-rex based on peak heights. in all three treatments consensus profiles were generated only considering t-rfs present in both replicates.



CONCLUSIONS
the tools for t-rflp data analysis provide easily adjustable and expandable tools for the analysis of t-rflp data. it enables evaluations of the impact of different data treatment methods on the final outcome of sample comparisons, combinations of different treatment methods and provides tools to evaluate the accuracy of the alignment of t-rfs. the tools for t-rflp data analysis is implemented in microsoft excel and therefore requires a purchased license for use. although this is a drawback, it is likely to be a both familiar and accessible environment for many researchers.

availability and requirements
project name: tools for t-rflp data analysis

project home page:http://sourceforge.net/projects/toolsfortrflp

operating system: microsoft office

programming language: visual basic for applications 

license: gnu lesser general public license

availability of supporting data
the tools for t-rflp data analysis template is provided in additional file  <dig>  the dataset used to illustrate the procedures is provided in additional file  <dig> 

additional files
additional file 1: 
tools for t-rflp data analysis.


additional file 2: 
supporting data.




abbreviations
fptfixed percentage threshold

tftotal fluorescence

tfntotal fluorescence normalization

t-rfterminal restriction fragment

t-rflpterminal restriction fragment length polymorphism

competing interests

the authors declare that they have no competing interests.

authors’ contributions

bmw collected the samples. njf carried out the experimental analyses, designed and implemented the program, performed the data analyses and drafted the manuscript. bmw and mh contributed to the design and development of the data analysis procedures and revised the manuscript critically. all authors read and approved the final manuscript.

