BACKGROUND
in recent years, time course analyses of metabolic perturbations have become more important to understand metabolic networks based on experimental data  <cit> . one way to analyze metabolic networks is by systematically investigating linear relationships between all analyzed metabolites  followed by constructing networks from positively identified components, and eventually comparing network topologies  <cit>  between different physiological or genetic conditions  <cit> . simulations of metabolic reactions have shown that even stochastic influences on metabolism may result in linear metabolic co-regulation because initial metabolic perturbations can be propagated and enhanced through the cellular biochemical network  <cit> . such linear co-regulation of pairs of metabolites may point to changes in biochemical control  as well to transcriptional regulation  <cit> . variance in metabolite levels can be caused by three different factors:

 concentrations alter and hence increase variance due to intentionally changing the experimental conditions, for example by altering environmental parameters like external nutrients or by using different genotypes  <cit> ,

 metabolite data will found to vary in a stochastic manner caused by the imprecision of the analytical method  <cit>  used for acquiring metabolite data and

 interestingly, even under very controlled environmental conditions, a high degree of biological variation is found for metabolite levels due to stochastic biological events that trickle through the biochemical network and thus reflect the underlying control structure at this particular biological condition  <cit> .

therefore, if enough biological replicates are analyzed for a given organism at a given physiological situation, the metabolic phenotype can be investigated not only by its corresponding average metabolic values, but also by a snapshot of its corresponding metabolic network. however, biologists often do not know the inherent biological variability in advance and hence tend to use just a few independent biological replicates based on preliminary power analysis. resulting data may be sufficient to estimate arithmetic means of metabolic levels but do not enable analyzing the linear control structure between different biological conditions. one of the challenges for calculating linearity networks is to compute the likelihood or significance of the presence of a truly linear relationship, with the aim of excluding both false negative and false positive detections of linearities.

estimating optimal linearity parameters has been solved decades ago for cases, for which linear dependence of variables could be reasoned based on background knowledge. however, in metabolic data sets, the control structure of metabolites is unknown a priori. therefore, two fundamental questions need to be answered:

 for which pairs of variables can a linear relationship be hypothesized?

 are there sub sets of data that reflect differences in linear behavior of variables? for example, linearity may be given for only a group of data but absent in another group, or the linearity parameters between these groups may be different.

an unbiased analysis of linear relationships between pairs of variables needs to test whether there is one or more valid linear hypotheses that could explain data in complex data sets. this procedure defines a novel approach for testing biological data: instead testing pre-defined hypotheses  <cit> , the likelihood of hypotheses is calculated that may be used to explain complex process. this hypothesis-building is fundamentally different from estimating the best parameters of an assumed linear relationship by regression equations  <cit>  for which various software packages exist, and solutions for estimating parameters for multiple linear relationships <cit> . however, regressions do not test the probability of the presence of linear relationships, especially in high-dimensional data sets. instead, regressions are founded on the presence of linearity that is justified by background knowledge. in biochemistry, the existence of linear relationships cannot generally be assumed trivial but must receive thorough statistical evaluations. in addition, regressions usually do not account for technical errors  <cit>  that are critical in practice. all measurements comprise technical errors which are due to inadequacy of the total chemical-analytical method, specifically the extraction, sample preparation and the instrumental data acquisition. hence, the degree of technical errors will vary between the chemical nature of the metabolites, their absolute concentrations and influences of different sample matrices. furthermore, outliers and missing data further obscure detection of linear hypotheses. for regressions, on the other hand, the impact of outliers has been studied extensively, and multiple measures to assess and weigh the influence of outliers have been developed. assumptions on the degree of technical errors may further refine weighting factors in regression analysis, and such factors can be optimized for example using the em-algorithm. nevertheless, regression is not an explorative tool for data analysis. additionally, metabolomic data do not distinguish between dependent and independent variables. all variables are subject to varying degree of noise . no controlled observations of supposedly independent variables can be acquired  <cit> . consequently, the control structure of metabolic linearity networks can only be assessed with a tool that solves the following tasks:

 linear relationships must be detected in an unbiased and observer-independent manner.

 sub sets of data need to be grouped according to presence of  linear relationships.

 criteria have to be applied that verify linear hypotheses based on test statistics.

 technical errors: varying degree of analytical-chemical measurement errors and missing data have to be accounted for.

especially, the potential presence of multiple linear relationships and independence of both variables poses problems for simple regression analyses. as a substitute for regression, the degree of correlation has been used for detecting linear relationships despite the fact that correlation only relates the covariance to the total variance, but does not verify genuine linearities. moreover, pearsons' correlation coefficients lack robustness against outliers, especially for multivariate datasets, and a number of different approaches have been suggested to link estimates to better test statistics  <cit> . in practice, however, empirical or heuristic thresholds are taken to distinguish strong or weak correlations, but no mathematical basis exists on which such thresholds can safely be founded. in some cases, student's statistics p-values have been taken in an effort to validate pearson's correlations  <cit> . unfortunately, such p-values only describe the significance of the non-randomness of data pairs but do not test hypotheses if data pairs can be described by a  linear functions. consequently, correlation networks based on pearsons correlations may be strongly distorted  <cit> .

a further approach has been taken using partial correlations that deconvolute contributions by additional parameters in order to reduce the list of correlations to basic dependencies  <cit>  which may present a link from correlation to causality  <cit> . this method is valuable to investigate the control structure within a given correlation network but it does not remove the principle robustness problem of correlation estimates. simple correlations coefficients always decline with increasing variance that is introduced by method errors during data acquisition. in contrary, partial correlation coefficients may be increasing, decreasing or even change the algebraic signs with increasing method errors  <cit> . in order to remedy this situation, scientists tend to select high pearson's correlation thresholds  <cit>  which imply that the variance caused by method errors is small in relation to the biological variance. the latter assumption is often true when comparing widely different metabolic phenotypes such as certain mutant genotypes, or severe stress conditions such as acute  diseases in comparison to healthy states. however, metabolic theory predicts that even incremental changes in enzymatic properties can have large effects on metabolic control, especially when multiple enzymes are affected  <cit> . such changes might be too subtle to cause large differences in average concentrations but would still effect the pathway control structure and hence, linearities in pairs of metabolite data. consequently, the metabolic control structure can only be assessed with a robust tool for linearity detection.

we here present a different approach. using the bayesian law  <cit> , a likelihood formula is derived that is based on information about the measurement error using a specific technical method. this formula is then transformed in way that allows searching for local maxima of linear parameters within the total hypothesis space. such likelihood maxima are subsequently assessed for residuals of the corresponding linearity parameters using simulated test statistics. we demonstrate the power of this approach using a synthetic data set with a given set of true linear relationships which are subsequently subjected to both increasing technical errors and increasing number of samples.

RESULTS
 a model for the technical error in metabolomic data
let {xij } denote the entirety of n metabolite measurements in a collection of m samples. the measurements can be arranged in a matrix xij with rows i =  <dig>  ..., n that refer to the metabolites and columns j =  <dig>  ..., m that refer to the samples. each measurement results from the sum of the true metabolite content x′ij
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwg4baegaqbamaabaaaleaacqwgpbqacqwgqbgaaeqaaaaa@3115@ and a technical error,

 xij=x′ij+eij.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwg4baedawgaawcbagaemyaakmaemoaaogabeaakiabg2da9iqbdiha4zaafawaasbaasqaaiabdmgapjabdqgaqbqabagccqghrawkcqwglbqzdawgaawcbagaemyaakmaemoaaogabeaakiabc6cauaaa@3c93@ 

the technical errors eij include the chemical-analytical error, but can also include a contribution from different storage manners or times of the biomaterial after its extraction. the technical variance of the jth measurement can be derived by a probability density function ρj that reflects knowledge about sample storage and data acquisition. for missing data, it is only known that these can be expected in a defined range but with uniform probability distribution. for non-missing data, the technical error is modeled by a multivariate normal distribution that is centered around zero. more precisely, the probability density for the technical error ej = t of the jth metabolic profile is given by

 ρj=nexp⁡. 

in principle, the variance matrices Σj can be estimated from the covariance matrix of replicated measurements of the same biomaterial. in practice, correlations between the technical errors of different metabolites are often disregarded, leading to a model with diagonal variance matrices Σj=diag
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqqhjowudawgaawcbagaemoaaogabeaakiabg2da9iabbsgakjabbmgapjabbggahjabbegannaabmaabaaccigae83wdm3aa0baasqaaiabigdaxiabdqgaqbqaaiabikdayaaakiabcycasiabc6cauiabc6cauiabc6cauiabcycasiab=n8aznaadaaaleaacqwgubgbcqwgqbgaaeaacqaiyagmaaaakiaawicacaglpaaaaaa@46ed@. further one often works with fixed absolute or fixed relative errors,

 σij=ai or σij=rixij,
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfdpwcdaqhaawcbagaemyaakmaemoaaogabagaeiikagiaeeyyaemaeeoyaimaee4camnaeiola4iaeiykakcaaogaeyypa0jaemyyae2aasbaasqaaiabdmgapbqabagccqqggaaicqqgvbwbcqqgybgccqqggaaicqwfdpwcdaqhaawcbagaemyaakmaemoaaogabagaeiikagiaeeocainaeeyzaumaeeibawmaeiola4iaeiykakcaaogaeyypa0jaemocai3aasbaasqaaiabdmgapbqabagccqwg4baedawgaawcbagaemyaakmaemoaaogabeaakiabcycasaaa@54e5@ 

respectively.

 maximum likelihood  function for a general linear problem
using the bayesian law, the likelihood for parameters of a given linear hypothesis can be calculated. the bayesian law allows to interconvert the conditional probabilities of cause  and effect   <cit> ,

 p=ppp
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgwbaccqggoaakcqwgbbqqcqgg8bafcqwgcbgqcqggpaqkcqgh9aqpdawcaaqaaiabdchawjabcicaoiabdkeacjabcyha8jabdgeabjabcmcapiabdchawjabcicaoiabdgeabjabcmcapaqaaiabdchawjabcicaoiabdkeacjabcmcapaaaaaa@4376@ 

the general form of a linear relationship in the metabolomics data is

 α1x′ij+...+αnx′nj=βfor all samplesj= <dig> ...,m.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaafaqabeqadaaabaaccigae8xsde2aasbaasqaaiabigdaxaqabagccuwg4baegaqbamaabaaaleaacqwgpbqacqwgqbgaaeqaaogaey4kasiaeiola4iaeiola4iaeiola4iaey4kasiae8xsde2aasbaasqaaiabd6gaubqabagccuwg4baegaqbamaabaaaleaacqwgubgbcqwgqbgaaeqaaogaeyypa0jae8nsdigabagaeeozaymaee4ba8maeeocainaeeiiaaiaeeyyaemaeeibawmaeeibawmaeeiiaaiaee4camnaeeyyaemaeeyba0maeeicaanaeeibawmaeeyzaumaee4camhabagaemoaaomaeyypa0jaegymaejaeiilawiaeiola4iaeiola4iaeiola4iaeiilawiaemyba0maeiola4caaaaa@6017@ 

in what follows we collect the coefficients of the above equation in a vector α = t and express the linear relationship as αt x•j = β. by x•j we denote the metabolic profile of the jth sample. the entirety of the parameters α and β results in a. the probability p  is the a priori probability of the parameters α and β before the measurement has been performed. because no preference can be given, the a priori probability is constant for all a. the same is true for p  with b representing the measured metabolite concentrations. therefore, p  is the likelihood for parameter a if the pair of variables b is given. we have used an unbiased approach here assuming random and unrelated technical errors, and we cannot know beforehand if a certain metabolite will be detectable or not, and how large the concentration of such metabolite could be. these assumptions result in a constant probability for p and p, because otherwise certain values for a and b would be more likely than others. from the bayesian law it can be concluded

 p  = c · p . 

the constant value c can be neglected because the objective is to compare different linear hypotheses. consequently, a hypothetical metabolic profile has the same probability at a given linear hypothesis as a hypothetical linear hypothesis at a given metabolic profile. the expression p  is therefore the probability that the measured metabolic profile b is determined at a given set of parameters a, which can be calculated using the function which describes the probability distribution of the technical error. we are now in position to state the following general theorem:

let x = t include the measurements of n metabolites in a biological sample with technical errors that follow a gaussian distribution with covariance matrix Σ. let a -dimensional surface in the n-dimensional metabolite space be defined by the equations

 αk <dig> x <dig> + ... + αkn xn = βk   for k =  <dig>  ..., n. 

the coefficients of these equations comprise a matrix α =  and a vector β = t. the matrix elements can also be arranged in vectors αk :t. it is assumed the hyperplanes defined by  are orthogonal in pairs with respect to the covariance matrix, i.e.

 αk tΣ αl = 0   for k, l =  <dig>  ..., n and k ≠ l. 

then, the likelihood for the metabolite concentrations to lie on the -dimensional surface is given by

 p=exp⁡2αktΣαk).
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgwbaccqggoaakcqwg4baecqgg8bafiigacqwfxoqycqggsaalcqwfyogycqggpaqkcqgh9aqpcygglbqzcqgg4baecqggwbacdaqadaqaaiabgkhitmaalaaabagaegymaedabagaegomaidaamaaqahabawaasaaaeaadaqadaqaaiab=f7ahnaadaaaleaacqwgrbwaaeaacqwg0badaagccqwg4baecqghsislcqwfyogydawgaawcbagaem4aasgabeaaaogaayjkaiaawmcaamaacaaaleqabagaegomaidaaagcbagae8xsde2aa0baasqaaiabdugarbqaaiabdsha0baakiabfo6atjab=f7ahnaabaaaleaacqwgrbwaaeqaaaaaaeaacqwgrbwacqgh9aqpcqaixaqmaeaacqwgobgta0gaeyyeiuoaaogaayjkaiaawmcaaiabc6cauaaa@5e67@ 

the theorem is proven in additional file  <dig>  however, the result for the likelihood has a simple interpretation: it is proportional to the density of the normal distribution taken at the distance of the measurement from the surface. this distance has to be calculated by taking the covariance matrix of the technical errors as metric of the metabolite space. next, let us illustrate the theorem by a special case that is especially interesting for applications: consider two metabolite concentrations that are measured with technical standard deviations σ <dig>  σ <dig> and technical covariance σ <dig>  then, the likelihood for the metabolite concentration to lie on the straight line α <dig> x <dig> + α <dig> x <dig> = β is given by

 p=exp⁡2σ12α12+2σ12α1α2+σ22α22).
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgwbaccqggoaakcqwg4baedawgaawcbagaegymaedabeaakiabcycasiabdiha4naabaaaleaacqaiyagmaeqaaogaeiifawhccigae8xsde2aasbaasqaaiabigdaxaqabagccqggsaalcqwfxoqydawgaawcbagaegomaidabeaakiabcycasiab=j7aijabcmcapiabg2da9igbcwgaljabciha4jabcchawnaabmaabagaeyoei0yaasaaaeaacqaixaqmaeaacqaiyagmaawaasaaaeaadaqadaqaaiab=f7ahnaabaaaleaacqaixaqmaeqaaogaemieag3aasbaasqaaiabigdaxaqabagccqghrawkcqwfxoqydawgaawcbagaegomaidabeaakiabdiha4naabaaaleaacqaiyagmaeqaaogaeyoei0iae8nsdigacagloagaayzkaawaawbaasqabeaacqaiyagmaaaakeaacqwfdpwcdaqhaawcbagaegymaedabagaegomaidaaogae8xsde2aa0baasqaaiabigdaxaqaaiabikdayaaakiabgucariabikdayiab=n8aznaabaaaleaacqaixaqmcqaiyagmaeqaaogae8xsde2aasbaasqaaiabigdaxaqabagccqwfxoqydawgaawcbagaegomaidabeaakiabgucariab=n8aznaadaaaleaacqaiyagmaeaacqaiyagmaagccqwfxoqydaqhaawcbagaegomaidabagaegomaidaaaaaaogaayjkaiaawmcaaiabc6cauaaa@76ec@ 

returning to the general line of the text and the bayesian reasoning we obtain for the likelihood for a linear relationship described by a = {αki, βk} after measurement of the metabolomic data b = {xij} the result

 p=∏j=1mlj
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgwbaccqggoaakcqwgbbqqcqgg8bafcqwgcbgqcqggpaqkcqgh9aqpdaqewbqaaiabdygasnaabaaaleaacqwgqbgaaeqaaogaeiikagcccigae8xsdemaeiilawiae8nsdimaeiifawnaemieag3aasbaasqaaiabl+y6njabdqgaqbqabagccqggpaqkasqaaiabdqgaqjabg2da9iabigdaxaqaaiabd2gatbqdcqghpis1aaaa@4b10@ 

with

 lj=p=exp⁡2αktΣjαk)
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgsbabdawgaawcbagaemoaaogabeaakiabcicaoggaciab=f7ahjabcycasiab=j7aijabcyha8jabdiha4naabaaaleaacqwipm+zcqwgqbgaaeqaaogaeiykakiaeyypa0jaemicaanaeiikagiaemieag3aasbaasqaaiabl+y6njabdqgaqbqabagccqgg8bafcqwfxoqycqggsaalcqwfyogycqggpaqkcqgh9aqpcygglbqzcqgg4baecqggwbacdaqadaqaaiabgkhitmaalaaabagaegymaedabagaegomaidaamaaqahabawaasaaaeaadaqadaqaaiab=f7ahnaadaaaleaacqwgrbwaaeaacqwg0badaagccqwg4baedawgaawcbagaes4jpfmaemoaaogabeaakiabgkhitiab=j7ainaabaaaleaacqwgrbwaaeqaaagccagloagaayzkaawaawbaasqabeaacqaiyagmaaaakeaacqwfxoqydaqhaawcbagaem4aasgabagaemidaqhaaogaeu4odm1aasbaasqaaiabdqgaqbqabagccqwfxoqydawgaawcbagaem4aasgabeaaaaaabagaem4aasmaeyypa0jaegymaedabagaemota4eaniabgghildaakiaawicacaglpaaaaaa@77da@ 

the corresponding likelihood function is a sum of contributions from each of the biological samples,

 l=ln⁡p=∑j=1mln⁡lj
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgmbatcqggoaakcqwgbbqqcqgg8bafcqwgcbgqcqggpaqkcqgh9aqpcyggsbabcqggubgbcqwgwbaccqggoaakcqwgbbqqcqgg8bafcqwgcbgqcqggpaqkcqgh9aqpdaaewbqaaigbcygasjabc6gaujabdygasnaabaaaleaacqwgqbgaaeqaaogaeiikagcccigae8xsdemaeiilawiae8nsdimaeiifawnaemieag3aasbaasqaaiabl+y6njabdqgaqbqabagccqggpaqkasqaaiabdqgaqjabg2da9iabigdaxaqaaiabd2gatbqdcqghris5aaaa@581e@ 

maximizing p  or l  gives the maximum likelihood. the resulting estimator for the considered linear relationship is called the simple ml-estimator. the likelihood takes values between  <dig> and  <dig>  likelihoods are different to probabilities  <cit>  with respect to p  which is maximized in order to find the most likely parameters for a given hypothesis, here: a linear hypothesis.

 an adapted maximum likelihood estimator for robust verification of linear hypotheses
the product p  can never become larger than one of its factors, and it comprises exactly one global maximum. consequently, just a single outlier may decrease p  significantly. unfortunately, outlier data are frequently found in biological data sets due to both the multitude of factors in biological cells and the complexity of data acquisition methods that may result in false positive data points. furthermore, it is still unclear, how many linear relationships exist for a given pair of variables. both questions are reflected by introducing a decoupling term, the constant c, to the likelihood function,

 lc=ln⁡pc=∑j=1mln⁡+c)
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgmbatdawgaawcbagaem4yamgabeaakiabcicaoiabdgeabjabcyha8jabdkeacjabcmcapiabg2da9igbcygasjabc6gaujabdchawnaabaaaleaacqwgjbwyaeqaaogaeiikagiaemyqaekaeiifawnaemoqaikaeiykakiaeyypa0zaaabcaeaacyggsbabcqggubgbcqggoaakcqwgsbabdawgaawcbagaemoaaogabeaakiabcicaoggaciab=f7ahjabcycasiab=j7aijabcyha8jabdiha4naabaaaleaacqwipm+zcqwgqbgaaeqaaogaeiykakiaey4kasiaem4yammaeiykakcaleaacqwgqbgacqgh9aqpcqaixaqmaeaacqwgtbqba0gaeyyeiuoaaaa@5f0b@ 

additional file  <dig> gives the impact of the magnitude of the constant c on the total likelihood. it is demonstrated in an empirical way that the total likelihood is not decreased by any c ≥  <dig>  in what follows we fix the constant at the value c =  <dig> und consider an adapted ml-estimator that is constructed by maximization of l <dig> 

the adapted likelihood function is a sum, to which every data point adds a contribution between zero and a maximum value of ln  <dig> if it coincides with the linear hypothesis that is under investigation. this step alters the impact of the bayesian law. it results in assessing each individual variable pair by a likelihood of contribution to a  hypothesis, and not by assessing the entirety of all variable pairs. consequently, the contribution of outliers is evanescent as demonstrated in figure  <dig> and is limited to a reduction of l of ln  <dig> in the worst case. figure  <dig> shows two plots, each representing  <dig> data pairs. in the upper panels, the  <dig> data pairs shall follow a hypothetical linear function with an additional modeled analytical measurement error. the lower panels represent a data set in which  <dig> of the  <dig> data points are transposed by a constant value, so that two linear functionalities exist. for each of the two examples, likelihood distributions are given across a part of the hypothesis space for the simple ml estimator  and the adapted ml estimator . for the case of a dataset that comprised two likely linear functions, the simple ml estimator only recognizes a shift in the local maximum but fails to detect two local maxima according to the two linearities. in contrary, the adapted ml estimator correctly identifies both local maxima and is thus able to detect the most likely parameters for both linear functions. in fact, the local likelihood maximum of the original single linear function does not shift for the adapted ml estimator when  <dig> data points are shifted by a constant factor but it just leads to a decrease of the maximal possible likelihood. if all measured data are assigned to different linear hypotheses according to their corresponding likelihoods, the criterion  as given above in the section 'background' is fulfilled: sub sets of data are now grouped according to presence of  linear relationships.

additional considerations are outlined for the case of missing data  which are often found in metabolomic data sets. in such cases, the probability function p  needs to be adapted. this function then represents the information about the missing value: for example, data could get lost due to measurement instrument malfunctions or the variable  might be below the limit of detection in a given biological situation. in both cases, the probability density function is uniform, i.e. the probability is constant in a certain range. for the case of 'below detection limit', the probability density is limited, for the case of 'instrument malfunction' the probability density is zero at all levels. however, for both cases, the undefined integral is one . if we knew the true cause of the missing value , the correct probability density function could be modeled. for now, however, we need to assume an infinite technical error which demands to add the maximal likelihood of ln <dig> to these data points. accordingly, missing data do not have a diminishing impact on l. an extreme case of data set that exclusively comprises missing data would result in a maximal likelihood for arbitrary linear hypotheses. this interpretation is correct because all hypotheses would be equally probable and could not be denied, which, however, results to an interpretive power of zero. consequently, for real cases a maximal number of missing values needs to be defined in order to deny any linear hypothesis that might be due to missing explanatory power. the upper limit of the number of such missing data has to be set by the user who may call in further biological or analytical background information for individual metabolite pairs.

concluding, the following properties are observed for the adapted ml-estimator:

 the adapted ml-estimator considers technical errors.

 the adapted ml-estimator detects linear patterns and groups sub sets of data accordingly.

 the adapted ml-estimator is robust against outliers.

 the adapted ml-estimator relies on background information on missing values and therefore does not distort interpretations.

therefore, the adapted ml-estimator realizes a solution to several of the challenges of unbiased and robust detection of multiple linear hypotheses in complex data sets.

 algorithm for the detection of linear relationships
in order to assign measured data to a hypothetical linear relationship without contradictions, corresponding residues have to be analyzed. one condition is that these residues are randomly distributed; otherwise, additional systematic errors would have to be assumed. secondly, the residues have to be explainable by the technical errors in a statistical manner. the adapted ml-estimator already realizes a measure for agreement between  model and data under consideration of the corresponding technical errors. thresholds can now be determined for rejecting specific linear hypotheses using the distribution of l, resulting in false discovery rates for which limits can be set. the core of the algorithm determines the local maximum of a likelihood distribution which is subsequently compared to limits of a test statistics. it can be assumed that this maximum will be the global maximum since all measured data will be explained by the tested linear relationship. however, outliers will reduce the likelihood drastically. consequently, data are only considered if residues are small to the hypothetical linearity. the  <dig> σ interval was chosen to exclude outliers at 95% confidence. the data inside the  <dig> σ confidence interval is denoted by breturn. the likelihood is subsequently normalized to the number mreturn of this data. the parameter mreturn comprises the number of samples that were returned to belong to a linear function despite deviation that is due to the contribution of unrelated variance. each data point contributes a value of ln  <dig> to the likelihood function, resulting in the normalized likelihood

 lreturn=l1mreturn×ln⁡2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgmbatdawgaawcbagaeeocainaeeyzaumaeeidaqnaeeydaunaeeocainaeeoba4gabeaakiabg2da9maalaaabagaemitaw0aasbaasqaaiabigdaxaqabagcdaqadaqaaiabdgeabnaabaaaleaacyggtbqbcqgghbqycqgg4baeaeqaaogaeiifawnaemoqai0aasbaasqaaiabbkhayjabbwgaljabbsha0jabbwha1jabbkhayjabb6gaubqabaaakiaawicacaglpaaaaeaacqwgtbqbdawgaawcbagaeeocainaeeyzaumaeeidaqnaeeydaunaeeocainaeeoba4gabeaakiabgena0kgbcygasjabc6gaujabikdayaaaaaa@5bb9@ 

we now have two parameters, mreturn and lreturn, for which test statistics can be determined based on randomly selected true linear relationships. amax denotes the parameters for which the maximum likelihood is assumed. the distributions of mreturn and lreturn were assessed by monte carlo simulations: for each sample size ranging from  <dig> to  <dig> data points we have generated  <dig>  random data sets, and test statistics were derived for each sample size m. the data set were generated by selecting an arbitrary linear function and a random selection of data points corresponding to this linear function. technical errors were sampled from gaussian distributions and added to the data points. after localizing the maximum value of l <dig> one determines all samples which belong to the corresponding linear function. based on l <dig> and mreturn, the value of lreturn is determined as given above. the frequency distributions of lreturn for different values of mreturn are shown for the example of m =  <dig> samples . figure  <dig> demonstrates that the lreturn distributions varied for different mreturn values, and consequently, corresponding test statistics were established that set the limits for rejecting the null-hypotheses at a false negative error rate of ≤ 5% for each of the mreturn values.

 determination of false positive and false negative error rates
the degree of noise can be described in terms of the reliability that is defined as ratio of biological variance and total variance. the later is just the sum of biological and technical variance if both variances are not correlated. in that case the reliability of the measurement of metabolite x is given as

 ρx=σbiol2σbiol2+σtech2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfbpgcdawgaawcbagaemieaghabeaakiabg2da9maalaaabagae83wdm3aa0baasqaaiabdkgaijabdmgapjabd+gavjabdygasbqaaiabikdayaaakiabcicaoiabdiha4jabcmcapaqaaiab=n8aznaadaaaleaacqwgibgycqwgpbqacqwgvbwbcqwgsbabaeaacqaiyagmaagccqggoaakcqwg4baecqggpaqkcqghrawkcqwfdpwcdaqhaawcbagaemidaqnaemyzaumaem4yammaemiaaggabagaegomaidaaogaeiikagiaemieagnaeiykakcaaaaa@549c@ 

the average reliability can easily be obtained from the simulations, and hence, the degree of noise can well be described as

 r=1−ρ¯x.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgsbgucqgh9aqpcqaixaqmcqghsisliigacuwfbpgcgaqeamaabaaaleaacqwg4baeaeqaaogaeiola4caaa@352e@ 

we here assume that linear relationships between two metabolites are only confused by technical errors, but not by other biological factors, so the degree of noise here is only induced by technical errors. in order to test the algorithm described above, a data set was simulated that closely describes the problem. this model data set comprised  <dig> variables which were grouped into  <dig> clusters of equal size. all variables within a cluster were described by a linear relationship y = ax + b, but between clusters, no linearity was modeled apart from random relationships. for each test, a different number of samples was taken to assume experimental data from metabolomic snapshots, with further and various levels of technical errors that were added to the modeled measurements. technical errors were assumed to follow a gaussian distribution. in total, the total data set was investigated for  <dig>  pair-wise relationships of which  <dig> were modeled to be described by linear relationships in order to assess false positive and false negative error rates. the parameters were varied in an exhaustive permutation of the sample size from 3– <dig> samples and relative technical errors from  <dig> –100%. error rates were determined four times for each combination of ,number of samples' and ,technical errors', and the average of these four determinations was taken. technical errors may be divided into the absolute error and a relative error. the absolute error, for example, is constituted by the resolution of an analytical instrument or constant background through chemical impurities of reagents and solvents. such errors can be carefully controlled in validated chemical procedures and are usually less important than relative errors. in most cases in metabolomics, the total technical error is dominated by relative errors that relate to the true value, originating for example by sample storage, extraction and sample preparation procedures, and by cross-contamination and carry over between samples. technical errors can be estimated by reproducing all sample preparation steps multiple times from small aliquots of a larger homogenized pool, and subsequent data acquisition. the magnitude of relative errors varies by the vulnerability of the compounds to be altered during the sample preparation and measurement process. however, for the sake of clarity, identical technical errors were used in the simulations for each pair of metabolites.

the error rate of the algorithm is exemplified for selected sample numbers in figure  <dig> , using the algorithm described so far. the null hypothesis used here was assuming the existence of a linear relationship between any pair of metabolites. this is in opposite to classical use of null-hypotheses, reversing the meaning of false positives and false negatives in our work. therefore, in our case rejecting the null hypothesis when it is actually true means rejecting true linearities or generating false negative errors. it is important to note that the count for false negative detections  stays below 5% except for sample numbers smaller than five. the minimal error rate corresponds to the limits that resulted from constructing the test statistics. for the false positive error rates , a different trend is observed. except for very low technical errors or large numbers of samples, the type ii errors quickly exceed the 5% error thresholds. generally, the sample size required to cope with higher technical errors rapidly increases for maintaining acceptable false positive rates. for high technical errors, the pattern between any two variables resembles a scatter around a constant value. in such cases, the number of false positive linearity detections increases because any constant value can be explained by a discretionary linear function. if higher limits were used for the parameters lreturn and mreturn, the 5% threshold for the false positive rates would be reached at higher technical error rates. however, simultaneously, the minimal error rate for of false negatives would increase. consequently, type i and type ii error rates could in principle be balanced by adapting the thresholds for lreturn and mreturn in a qualitative manner. nevertheless, the total error rate can only be influenced by decreasing the technical error or increasing the number of samples taken into account.

as outlined above, increasing levels of technical errors cause higher false positive error rates of detections of linearities. however, the number of false positive detections can be shifted towards false negative error rates, if desired for a specific biological study. therefore, a filter has been developed that filters out all potential false positives . the filter has been tested on the same simulated data as the algorithm before. results are shown in figure  <dig>  for false negative and false positive linearity detections. compared to figure  <dig> , a reverse order for false linearity discoveries was observed. technical errors in metabolomics are usually in the range around 20–25%, although for certain compound classes, these may be lower. for a given biological situation, experimental biologists rarely use more than  <dig> biological replicates , often even less. with other words, for such a combination of technical errors and low number of replicates, the algorithm yields either the accurate identification of all true linearities , but for the price of a high number of false positives, or the algorithm results in the full deletion of false positives , but for the price of not detecting a high number of the true linearities. we therefore have compared the results with and without filter in order to determine, how many samples would be needed to stay reliably at a false error rate ≤  <dig>   for both false negatives and false positives. figure  <dig> demonstrates that false positive detections without activating the filter obey a more favourable response to the combination of sample size and technical errors than the false negative error rates with active filter. consequently, at technical errors of 20%, a minimum of about  <dig> samples is needed to stay reliably below 5% error rates for both false positive and false negative detections of linear metabolic relationships. this is an important result for practical use of this algorithm for robust generation of metabolomic networks. as default, the filter is not needed to be applied unless researches want to be very strict on the false positive error rates. the simulation presented here demonstrates that it is possible to remain at a total error rate of less than 5% if more than  <dig> samples are analyzed at the 20% technical error rate. the entirety of linear relationships of metabolites may subsequently be visualized as network graphs. such graphs can be compared between different physiological or genetic conditions, in order to generate novel functional hypothesis on regulation of metabolic networks in a robust manner.

the robustness of the algorithm was tested on a model dataset with  <dig> samples . the thresholds for lreturn and mreturn were adjusted to tolerate an outlier rate of 5% . outliers were modelled with a distance from  <dig> σ to  <dig> σ away from the true linearity. it was found that outliers were generally easier recognized when these were very distant from the linearity. despite the additional outliers, false positive and false negative error rates were found to almost identical as in figure  <dig>  the number of false negative linearity detections remained below 5% without filter in all cases, and conversely, the false positive rate remained unchanged with activated filter. hence, the use of bayesian likelihood estimations enables robust detection and verification of linear relationships in an unbiased way and in complex datasets. if more outliers are present in a data set, these may actually constitute several local likelihood maxima as shown in figure 1c  or in the figures in additional file  <dig>  such additional linear relationships may be revealed if several outliers follow a different linear function and hence yield unexpected hypotheses of cellular regulation. finding and validating such multiple linearities has so far been hard to accomplish with classical tools but is now amenable with the algorithm presented here. the algorithm has been implemented in a stand alone software solution. for data sets of a size of  <dig> variables ×  <dig> samples, robust linearity networks are generated in around  <dig> min computing time using a  <dig> mb ram and  <dig>  ghz personal computer. the actual computing time will vary from  <dig> – <dig> min, depending on the actual linearity structure of the data set. improved implementations of the algorithm, specifically for the search of global likelihood maxima, may certainly be worked out more effectively with respect to computational run time. however, acquiring metabolomic data of the size of  <dig> samples  will take time on the order of weeks which surely justifies computational efforts on standard personal computers on the order of minutes.

CONCLUSIONS
use of the technical error concomitant with a maximum likelihood assessment of linearity parameters and verification by simulated test statistics enables a robust detection and verification of liner relationships in complex data sets. an implementation of this algorithm will enable biologists to calculate and compare linearity networks in metabolomic or other multivariate data sets, from which biological hypotheses may be derived. the algorithm can be modified with respect to the ratio of type i and type ii errors depending on the biological focus of a study. it is highly advised to use more than  <dig> biological replicates for each condition that is to be tested in a biological experimental design of genotypes x environments , unless advances in analytical chemistry and instrumentation decrease the overall technical error to very low levels, i.e. below 5%. even the existence of more than one linear relationship per pair of variables can be detected using the maximum likelihood algorithm, which has so far been hard to compute with classical approaches.

authors' contributions
fk has worked out, tested and implemented the algorithm. mh had initially advised on the mathematics of likelihood estimations. jb eventually revised and improved the mathematical description of the algorithm and contributed to writing the paper. of conceived the study, participated in developing and testing the algorithm and drafted and wrote the manuscript.

supplementary material
additional file 1
 additional file 2
 additional file 3
 additional file 4
 acknowledgements
the work was funded by the niehs through the r <dig> project es <dig> granted to of and by a fellowship granted to fk by the max-planck society, germany. helpful comments by joachim selbig are appreciated.
