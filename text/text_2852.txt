BACKGROUND
association studies for complex diseases can require thousands of samples to detect genes with small effect  <cit> . a minimum of  <dig> to  <dig> samples have been suggested for genes conferring a 1–8% increase in susceptibility to a disease, and the failure of many complex disease studies has been attributed to insufficient sample size  <cit> . as increasing the sample size for a genetic analysis improves the statistical power and therefore the ability to detect a genetic effect, complex disease studies are increasingly employing collaboration. collaborative genetic studies often distribute genotyping among several different laboratories. if the genotyping for a family-based linkage study is distributed by assigning complete families to each laboratory , logarithm of the odds  scores can be computed for each data set separately and then simply added to achieve a combined lod score for the linkage study. while the analysis for distributed genotyping is often manageable for family-based linkage studies, there is no straightforward method to combine multiple association results. consequently, an association study is best powered by combining data sets prior to analysis. if combining data sets is attempted manually without the aid of a merging algorithm, it is cumbersome at best and subject to error.

in a previous publication we described statistical methodology, implemented in our software micromerge, for aligning microsatellite and multiallelic marker data sets  <cit> . micromerge v <dig> has been successfully applied by chen et al.  to linkage data  <cit> . micromerge aligns data sets marker by marker, matching each marker's allele frequencies while preserving size order. figure  <dig> illustrates this alignment concept for a marker x that was genotyped on two different sets of dna samples . an allele frequency histogram is shown for each data set, where the x-axis indicates the allele size in base-pairs, and the y-axis gives the frequency of each allele within the relevant data set. note that seven unique alleles were observed in each data set, and the alleles had similar frequencies. we conclude that the alleles match consecutively, that is the smallest allele in data set one is the same as the smallest allele in data set two, and so on. however, in addition to allele frequency similarity, this conclusion relies on both data sets meeting the following criteria. first, each data set must consist of samples from the same ethnic group, as allele frequencies may vary among populations. second, the sample size of each data set must be large enough to obtain accurate allele frequency estimates. in our experience, matching consecutive alleles with similar frequencies between data sets is an effective strategy for increasing genetic analysis power if the aforementioned criteria are met.

the concept of aligning microsatellite marker alleles based on frequency information rather than size  was first proposed by dorr et al. in  <dig>  <cit> . in  <dig>  weeks et al. illustrated the danger of aligning data sets using base-pair size information alone by sending the same set of dna samples to two different genotyping facilities  <cit> . when these two data sets were merged marker by marker, according to allele sizes, the resulting merged data set had a genotype error rate of  <dig> %. this is because allele sizes are only estimates that can differ between laboratories, instruments or experimental protocols. the consistency of estimating allele size within a particular facility, platform and protocol enables precise grouping of similarly-sized dna fragments into a 'bin', which represents an allele. there are multiple methods for defining these bins, so that different grouping strategies can alter allele names for the same raw genotype data  <cit> . for a more thorough discussion of the difficulties of merging microsatellite data and prior research in this area, we refer the reader to our previous micromerge publication  <cit> .

for reasons mentioned above, allele calls may only approximate the true alleles present in a set of dna samples. micromerge uses a bayesian model to align the observed bins to a proposed set of true theoretical alleles, where the number of theoretical alleles is estimated from the model. for clarity we will use the term 'bin' to distinguish an observed data set allele from an actual theoretical allele. micromerge uses mcmc methods to sample from the posterior distribution of possible alignments given the genotype data. each micromerge alignment is characterized by three parameters  the number of theoretical alleles,  the theoretical allele frequencies, and  the partition. figure  <dig> gives an example of a partition aligning bins from two data sets to four theoretical alleles. the vertical bars in this figure indicate correspondence between the data set bins and theoretical alleles. for example, bin a in data set  <dig> aligns with theoretical allele  <dig>  and bin c' in data set  <dig> aligns with both theoretical alleles  <dig> and  <dig>  on each iteration of the mcmc chain a change is proposed to one of the three alignment parameters, and the proposal is accepted or rejected by comparing the likelihoods of the proposed and current states.

the focus of this paper, like our previous micromerge paper, is on merging multiallelic marker data . merging multiallelic marker data sets is more challenging than merging snp data sets because multiallelic markers may have ten or more alleles of varying fragment lengths. in comparison, a snp marker usually has only two alleles whose identities are often known. in the conclusions section we describe how micromerge might be applied to snp data sets. but, in spite of the increasing popularity of snp data, multiallelic markers continue to be widely used for genetic analysis. in a survey of annual publication records in the ncbi pubmed database  since the year  <dig> there have consistently been more than  <dig> articles per year containing keywords pertaining to multiallelic markers . in comparison, the number of articles in a single year containing keywords pertaining to snp markers  did not exceed  <dig> articles until  <dig>  in the last three years  there were  <dig>   <dig> and  <dig> annual multiallelic marker articles, and  <dig>   <dig> and  <dig> snp articles. while there is clearly an increasing trend in the number of snp articles, the multiallelic marker articles have been holding constant over the past three years and have only been outnumbered by snp articles in the past year. as a result, the importance of this marker type should not be discounted by the increasing interest in snp data.

while micromerge v <dig> was able to successfully merge and create output files which could be analyzed by some programs such as mendel, we realized a need for more flexible merging options  <cit> . micromerge v <dig> includes seven new features that significantly extend the capabilities of v <dig>  in the next sections we describe these features and present results from both simulated and real data sets. finally, we show how micromerge can increase the statistical power of a genetic analysis by comparing association results from three separately analyzed familial dyslipidemia data sets to the association result obtained from analyzing the combined data sets.

methods
before describing the new micromerge features and their underlying methodologies, we define some terminology and introduce the data sets used to test micromerge. "overlap" and "distance" are two measures of alignment accuracy that were described in our previous publication  <cit> . overlap is a measure that quantifies the certainty of each bin pair within an alignment. a bin i defined by lab  <dig> and a bin j defined by lab  <dig> overlap if they both align with one or more of the same theoretical alleles. the overlap probability for this pair oij can be approximated by the fraction of the sampled alignments where overlap occurs. the "average overlap" for an alignment a is just the average of the overlap probabilities for each bin pair within the alignment.

"distance" quantifies the accuracy of a micromerge alignment in relation to a manually obtained alignment. each manual merge was obtained by aligning data set bins marker by marker using frequencies, relative base-pair size differences, eight samples common to both data sets, and aligning the data by eye. consider a binary indicator overlap matrix l for an alignment a, where the dimensions are defined by the number of bins in each data set. unit entries lij in l indicate whether bins i and j overlap in alignment a.

the distance between a micromerge alignment a and manual alignment m, is given by

 ||a−m|| =∑i∑j|lij−lij|. 

note that we only report alignment accuracy  results when a reference alignment is available. the micromerge v <dig> algorithm ascribed differences in observed bins for a particular marker between data sets typed at different laboratories to allele-calling differences. this assumption often produces 'lumped' alignments where a bin from one data set may align with more than one bin in another data set. while it is more flexible than forcing a bin from one data set to align with only one bin in another data set, or creating a 'one-to-one' alignment, the resulting merged data files pose a problem to most genetic analysis programs. this is because if a bin in data set  <dig> aligns with two bins in data set  <dig>  their relationship is coded as a phenotype in the merged locus and pedigree files. in order to generalize the output files so that they can be understood by the majority of genetic analysis programs, we include an option to create merged files with one-to-one alignments. interpretations of the two alignment types are described in the following two sections.

lumped alignment
a lumped alignment assumes that for a particular marker all of the same unique bins exist in both data sets, but that genotyping differences or genotyping errors may have caused the reported number of unique bins to differ between the data sets. for example, data set  <dig> in figure  <dig> observes four bins, but data set  <dig> observes only three bins because theoretical alleles  <dig> and  <dig> are lumped into bin c'. in the pedigree file for the above example, the c'/c' genotype in data set  <dig> would be coded as a phenotype 2: c' + c', where "2" corresponds to data set  <dig>  and the bin names are included for clarity. the 2: c' + c' phenotype would be consistent with any of the following genotypes: 3/ <dig>  3/ <dig>  and 4/ <dig>  and this correspondence would be included in the locus file. the data set resulting from this alignment includes genotypes expressed as non-codominant phenotypes, and must be analyzed by capable software such as mendel  <cit> .

one-to-one alignment
the one-to-one alignment format explains discrepant numbers of bins between data sets for a particular marker by assuming that an allele observed in one data set is missing from the other data set. figure  <dig> shows a one-to-one alignment similar to the lumped alignment from figure  <dig>  except that c' in data set  <dig> was paired with only theoretical allele  <dig>  and thus with only bin c in data set  <dig>  the zero indicates that bin d in data set  <dig> was not present in the data set  <dig> dna samples, and there were no '4' alleles observed in that sample. the c = c genotype in data set  <dig> would correspond to a single genotype 3/ <dig> in the merged locus and pedigree files, hence the merged one-to-one format data can be analyzed by any program that handles genotype data such as genehunter  <cit> , merlin  <cit>  and linkage  <cit> . we detail how the one-to-one alignment is translated from a lumped alignment after describing the test data sets.

test data sets
we tested the accuracy of our new micromerge v <dig> features on both simulated data and the real genotype data that was described in our previous publication, which we refer to as the 'real data project'  <cit> . in the following methods and results and discussion subsections the test data was simulated unless otherwise noted.

the real data project consisted of a pair of data sets with approximately  <dig> and  <dig> samples, typed with  <dig> microsatellite markers. the correct alignment between these data sets was known for  <dig> of the markers based on a manual merge, where each manual alignment was obtained by eye without the aid of a computer or merging algorithm . in order to assess the accuracy of both lumped and one-to-one alignment formats, a corresponding one-to-one reference alignment was manually translated from each lumped manual merge alignment. "bin spacing" information refers to the base-pair differences between bins of consecutive size. while the actual base-pair size is unreliable, generally genotyping is consistent within a laboratory. for example, a dinucleotide marker typically has bins spaced in increments  of approximately two base-pairs.

the lumped and one-to-one alignments require different manually obtained alignments. after manually obtaining a lumped alignment by eye, we then manually selected the corresponding one-to-one alignment with the best allele frequency match between the data sets. in a few cases it was difficult to determine the best manual alignments. for example, if the number of unique alleles differed by ≥  <dig> alleles between data sets.

we use a familial dyslipidemia study sample containing dinucleotide repeat microsatellite genotypes from chromosome  <dig> markers to illustrate micromerge v2's ability to improve association analysis. the familial dyslipidemia study sample consists of dutch  and two finnish  data sets genotyped with the weber screening set version  <dig> for the purpose of studying familial dyslipidemia   <cit> . the dutch data set consisted of  <dig> samples genotyped on applied biosystems' abi prism®  <dig> platform. the finn <dig> data set comprised  <dig> samples genotyped at the ucla genotyping and sequencing core on li-cor  <dig> dna analyzers. finn <dig> consisted of  <dig> samples genotyped at the national public health institute of finland on applied biosystems' abi prism®  <dig> platform. we considered a set of ten markers d11s <dig>  d11s <dig>  d11s <dig>  d11s <dig>  d11s <dig>  d11s <dig>  d11s <dig>  d11s <dig>  d11s <dig> and d11s <dig> that were genotyped on all three data sets. the range for the number of unique bins per marker in the dutch data set was 6– <dig> , 6– <dig>  in the finn <dig> data set and 6– <dig>  in the finn <dig> data set. on average the number of unique bins per marker differed by one between data sets. marker d11s <dig> had the greatest difference in number of unique bins observed among the data sets with  <dig> unique bins in the dutch data set,  <dig> unique bins in finn <dig> and  <dig> in finn <dig> 

now that we have covered some terminology and described the test data sets, we move to details of the micromerge v <dig> features. in the remainder of this section and in the following results and discussion section, each new micromerge v <dig> feature is numbered and titled for clarity. to assist the reader, we have also summarized these features and their usage in table  <dig> 

feature 1: one-to-one alignment format
to retrieve a one-to-one micromerge v <dig> alignment, the original micromerge algorithm is preserved, but the lumped alignments are translated to one-to-one alignments. in both micromerge versions lumped alignments are saved every  <dig>  iterations after a burn-in period, and a default value of  <dig>  alignments are saved to determine the alignment between the data sets. when the user selects the one-to-one alignment option, each lumped alignment is translated to all possible corresponding one-to-one alignments. the default setting chooses the one-to-one alignment with the highest likelihood to represent the lumped alignment. the likelihood is computed from the product of the data set genotype frequencies, where the genotype frequencies are computed assuming hardy-weinberg equilibrium values and the bin frequencies are obtained from the theoretical allele frequencies. the frequency of each zeroed theoretical allele is divided among the remaining alleles. figure  <dig> shows an example of the two one-to-one alignments corresponding to a lumped alignment with three theoretical alleles.

feature 2: controlling one-to-one alignment translation
the default setting for the one-to-one alignment option selects the most probable one-to-one alignment translation for each lumped alignment. we allow some control over this translation process to offer flexibility when a lumped alignment has many one-to-one translations with competing likelihoods. in the case where x one-to-one alignment translations are saved for each lumped alignment, each one-to-one alignment t is weighted by its likelihood with weight wt=lt∑v=1xlv. lt is the likelihood of alignment t and for each set of x alignments ∑t=1xwt= <dig> so that for each lumped alignment the count of saved one-to-one alignments is incremented by one.

feature 3: re-merging markers with low posterior probabilities
a limitation of micromerge v <dig> was that about 20% of markers had low posterior probability alignments, and we recommended against analyzing the merged results for these markers. these low posterior probabilities were often due to frequency differences among rare bins. to see how this problem could arise, consider a rare bin occurring once in one data set, and twice in another data set of the same size. while this could easily happen by chance, bin frequencies differing by a multiple of two or more are considered to be substantially different. in this case the presence of one or two rare alleles can result in a low posterior probability, rejection of the alignment, and the loss of data for an entire marker.

in micromerge v <dig> we developed a method for zeroing rare bins and re-merging the data sets for qualifying markers. when a marker's top alignment posterior probability falls below a threshold, it is considered for re-merging. then if a pair of aligned bins  has an overlap probability below a threshold value and its corresponding theoretical allele frequency qualifies as rare, the theoretical allele is zeroed. zeroing a theoretical allele means that all corresponding data set bins with only one instance in the alignment  are zeroed in their pedigree files. the data for this marker are then re-merged.

ta is an abbreviation for "theoretical alleles" and tf is an abbreviation for "theoretical frequencies".

feature 4: adjusting the prior on the theoretical allele number
another enhancement of micromerge v <dig> is an option allowing control over the number of theoretical alleles. this is useful for situations where data set bin frequencies do not match well, but it is expected that the same bins have been observed within each data set. for example, if one data set is several times larger than the other, it seems likely that the larger data set would observe all bins present in the smaller data set. in this scenario, it may be useful to put stronger emphasis on alignments with fewer theoretical alleles. the number of theoretical alleles n is allowed to vary between the maximum number of unique bins observed in a single data set  to the sum of all unique data set bins . the geometric prior distribution of n with success probability τ

 τn∑m=nmin⁡nmax⁡τm=τnτnmin⁡−τnmax⁡+ <dig> 

encourages smaller values. in micromerge v <dig> the user can adjust the default value for τ within a reasonable range. while all allowable values for τ emphasize alignments with a small number of theoretical alleles, this option allows control over the strength of this emphasis.

we test this option on the real data, and present results for several selected markers. results are reported for markers with a) top alignments containing potentially excess theoretical alleles , b) similar posterior probabilities among the top alignments and c) incorrect alignments. the idea behind this test was to show that while the minimum value might increase the posterior probability of set b) and increase the accuracy of set c), it could weaken results for set a).

feature 5: using population allele frequencies to align data
if a data set is too small to obtain accurate estimates of bin frequencies, the user can now merge the data using specified allele frequencies rather than allele frequencies estimated from the data set. when reliable allele frequencies of ethnically matched populations are available, these population frequencies can be substituted for the calculated bin frequencies of any data set to be merged. we implement this feature by listing population frequencies in the locus file and alerting micromerge v <dig> with an option in the control file to use these frequencies. these population frequencies are then used to generate a pedigree file that is used in place of the original pedigree file to align the data sets. once the optimal alignment is known, the original pedigree files are merged. this feature would also be useful for users who wish to simulate pedigree files based on a given sample size and locus file.

micromerge v <dig> allows some control over the construction of the generated pedigree file. the default sample size is equal to the average size of the other data sets , but the user can specify an alternative sample size using this feature  <dig> option. in addition to choosing the sample size the user also has a choice between two different data generating schemes. the nearly exact number of genotypes can be computed from the predicted genotype frequencies under hardy-weinberg equilibrium , or each genotype can be sampled according to the hwe genotype frequencies. the data generating process is controlled by an option in the control file, where the default method is to sample from the genotype frequencies.

this option was tested for the one-to-one alignment format on six real data markers. half of these markers had incorrect alignments when the bin frequencies were estimated from the pedigree files. the larger data set bin frequencies were used as population frequencies for the smaller data set to demonstrate the utility of this option.

feature 6: aligning multiple data sets
in the case where there are more than two data sets, micromerge v <dig> is able to merge them simultaneously . simulated data sets were used to test the success of aligning multiple data sets simultaneously. table  <dig> shows the population bin frequencies that were used to create the three simulated data sets da, db, and dc. da consisted of  <dig> samples and observed all four population bins. db and dc both had a sample size of  <dig> and were missing one bin each. we tested the multiple data set alignment feature by first merging db with dc, merging the resulting data set with da, and then contrasting this alignment result with the simultaneous alignment of data sets da, db, and dc. this test was conducted on both the lumped and one-to-one alignment options.

these data sets were used to test the success of aligning multiple data sets simultaneously. data set b was aligned with data set c, and then the combined data set was aligned with data set a. this alignment was then compared to the simultaneous alignment of data sets a, b, and c.

feature 7: likelihood ratio test for assessing alignment quality
three alignment quality assessment measures were presented in the first micromerge release: posterior probability, average overlap, and the difference between the posterior probabilities of the top two alignments. we include an additional score in micromerge v <dig>  based on a maximum likelihood criterion. we implement a likelihood ratio test by comparing  the likelihood computed using sample counts as the bin frequency estimates to  the merged data likelihood, where the data set bin frequencies are derived from the theoretical allele frequencies. the likelihood ratio statistic  <cit>  is 2ln, where q <dig> is the merged data likelihood and q <dig> is the original data likelihood. this statistic follows the chi-square distribution χv, with degrees of freedom v equal to the difference in the number of independent parameters between the two models ∑jd|bj|− .

association analysis of familial dyslipidemia study sample
we illustrate micromerge's utility for association analysis using the familial dyslipidemia  study samples. for both lumped and one-to-one formats, we created merged data sets for all three fd data sets and all pair-wise combinations of the fd data sets, resulting in a total of eight different merged data sets. we then ran mendel's option  <dig> gamete competition analysis  <cit>  on each data set independently and on the eight combinations of merged data sets. the gamete competition option was selected for its ability to handle the phenotype data generated by bin lumping.

RESULTS
for the results presented here, feature 3: re-merging markers with low posterior probabilities was run in combination with each of the other micromerge v <dig> features. this option creates the standard set of output files as well as an additional set of files for any markers that were re-merged. because feature  <dig> expands micromerge v2's merged data output, we recommend using a more conservative posterior probability threshold of  <dig>  with this option  rather than the previously published  <dig>  threshold for micromerge v <dig>  both of these thresholds were empirically determined based on the accuracy of the real data project alignments in comparison to the manually-obtained alignments. the results described below are based on this more conservative threshold for defining acceptable alignments.

feature 1: one-to-one alignment format
in order to test the success of the one-to-one alignment format, we compared the accuracy results for both the one-to-one and lumped formats for the  <dig> real data project markers. plots of the top alignment posterior probabilities versus the number of unique data set bins are shown in figure  <dig> for both formats, where markers with top alignments in disagreement with the manual alignment are indicated with white circles. the lumped alignment format resulted in eight markers with discrepancies between the micromerge and manual alignments , whereas the one-to-one format had only three . the  <dig>  posterior probability threshold discarded ten markers in the lumped format of which only six had alignments in disagreement with the manual alignment. this threshold also failed to flag two markers with small distances of one and two from the manual alignment. the  <dig>  threshold discarded all three one-to-one format alignments that conflicted with the manual alignment. while the one-to-one format performed better for this data set in terms of the number of accurately aligned markers, the lumped alignment distance was lower on average .

feature 2: controlling one-to-one alignment translation
as mentioned in the method's section, the one-to-one alignment is translated from the lumped alignment, and each lumped alignment may have many possible one-to-one alignment translations. the default setting is to choose the highest likelihood translation, but we allow the user to save more than one translation per lumped alignment.

we tested this option by saving the top three  one-to-one alignment translations from each lumped alignment for the real data project markers. the alignment for d4s <dig> was marginally improved from a distance of  <dig> to  <dig>  but this alignment also had a low posterior probability, so this improvement could be due to chance. while saving only one one-to-one alignment per lumped alignment performed best on our test data sets, the user has the option of testing this feature.

feature 3: re-merging markers with low posterior probabilities
ao is the original micromerge alignment, mo is its corresponding manually obtained alignment, ad is the re-merged micromerge v <dig> alignment, and md is its corresponding manually obtained alignment.

*posterior probability remained low after dropping problematic alleles and thus these markers' values were excluded from the 'average' and 'total' summaries.

ten markers were rejected due to low alignment posterior probabilities . nine of these markers also had at least one rare theoretical allele . micromerge v <dig> zeroed the data set bins corresponding to these low frequency theoretical allele if the overlap probability was also low . after re-merging, seven markers had top alignment posterior probabilities exceeding the minimum threshold of  <dig>  . in all cases, the micromerge v <dig> alignment agreement with the manual alignment either improved  or remained the same . only two markers continued to have alignment posterior probabilities below the default threshold . the re-merge option improved the yield of merged bins from 75% to 88%, with only a 1% reduction in accuracy to  <dig> % . for comparison, merging all of the data had an accuracy of  <dig> %.

while this feature worked well for lumped alignments, it was less successful for the one-to-one format. according to the same lumped format criteria, three low posterior probability markers in the one-to-one alignment format were eligible for re-merging. d4s <dig> and d4s <dig> were re-merged correctly with posterior probabilities greater than  <dig>  , but d4s <dig> was less accurate after re-merging. the distance for this marker increased from  <dig> to  <dig>  while the posterior probability also increased from  <dig>  to  <dig> . if the re-merging option is selected for the one-to-one alignment format, it may be useful to raise the accuracy threshold to about  <dig> . in the real genotype data project the one-to-one format aligned  <dig> % of bins with 100% accuracy, outperforming the lumped alignment format which aligned 88% of bins with  <dig> % accuracy. when all data is merged with the one-to-one method, the overall accuracy is still high at  <dig> %.

feature 4: adjusting the prior on the theoretical allele number
to offer some control over the prior distribution on the number of theoretical alleles without risking much accuracy we allow a range of values for τ . table  <dig> indicates how the default , minimum  and maximum  τ values affect results for the one-to-one alignment format using the real data project markers. results are presented for four sets of real data project markers with the following attributes under the default τ a) top alignment a <dig> having n = nmin +  <dig> theoretical alleles, b) the second best alignment a <dig> having a competitive posterior probability to a <dig> and n = nmin +  <dig> theoretical alleles, c) incorrect alignments, and d) a marker with a correct alignment under the default τ that sometimes had an inaccurate alignment for the minimum τ.

group a.) consists of markers where the top alignment contained nmin +  <dig> theoretical alleles, the markers in b.) had a 2nd best alignment that had nmin +  <dig> theoretical alleles, set c.) consists of markers with incorrect alignments, and d.) was an additional marker found to vary in alignment accuracy for different priors.

the results in table  <dig> show that the group a) markers with a top alignment containing nmin +  <dig> alleles, were virtually unaffected by different τ values. the markers in group b) benefited from smaller τ values because their competing alignments a <dig> consisted of nmin +  <dig> alleles. this trend was also true for many other real data markers . the incorrectly aligned markers had slightly varying alignment accuracy for different τ's, but this could be attributed to chance as the low posterior probability alignments have variable top alignment accuracies for different start seeds.

feature 5: using population allele frequencies to align data sets
since there were no population allele frequencies available to test this feature, we constructed the following test scenario based on six real data project markers d4s <dig>  d4s <dig>  d4s <dig>  d4s <dig>  d4s <dig> and d4s <dig> . we selected the larger of the two real data project data sets to represent the population allele frequencies for each marker. when feature  <dig> is selected, micromerge v <dig> uses the allele frequencies provided in the locus file rather than estimating bin frequencies from the pedigree file. the locus file frequencies were used to generate a simulated pedigree file, and the simulated pedigree file was used in place of the original small data set pedigree file in the merging algorithm. once the alignments were obtained, the two original data files were combined to produce a merged pedigree file.

we used the larger data set's bin frequencies as population frequencies for the smaller data set. the result was a high posterior probability with perfect alignment in each case . this was expected because the smaller data set's locus file and simulated pedigree file consisted of the same set of unique bins with very similar frequencies to the larger data set. while this example is admittedly simplistic, it illustrates the potential of this feature. if a set of population allele frequencies for a small data set is similar to the allele frequencies of a larger data set, we can expect that micromerge v <dig> will find an accurate, high posterior probability alignment.

feature 6: aligning multiple data sets
results for aligning three simulated data sets are shown in figure  <dig>  data set a  has two rare bins,  <dig> and  <dig>  and the two smaller data sets db and dceach observed one of these bins. when the three data sets were aligned in one micromerge v <dig> run , the correct alignment was obtained with an acceptable posterior probability. figure 6b shows that if the data sets were merged using two micromerge runs, ie first merging db and dc and then merging this result dbc with da, the resulting alignment would be incorrect. this is because merging db with dc ignores the information available in da. these results show that aligning three or more data sets in one micromerge v <dig> run has the potential to achieve a more accurate alignment than conducting a series of pairwise merges.

feature 7: likelihood ratio test for assessing alignment quality
the likelihood ratio  test result was useful for the lumped alignment format to evaluate genotype data quality and alert the user to control file problems. this statistic tested the null hypothesis that the unmerged model fit the data equally as well as the merged model. there are three columns in the output summary file related to this statistic. for each marker, the actual lr test statistic is reported, along with the chi-square test statistic for the  <dig>  significance level, and then a column indicating rejection  or failure to reject  the null hypothesis. while posterior probability was generally the best quality measure for individual markers in the real data project, the lr statistic correctly flagged marker d4s <dig> as incorrect.

the lr statistic gives a useful indication that the alignment process has run smoothly. in a successful set of micromerge v <dig> runs using default parameters for our  <dig> real data project markers, 92% had alignments that rejected the null hypothesis. when we ran this same set of markers with  <dig>  iterations , drawing  <dig> samples  and the maximum τ, only 85% of alignments rejected the null hypothesis. under these same sampling conditions, but now setting τ to the minimum value, the percentage rejecting the null dropped to 75%. as the new micromerge v <dig> features enable more control over the alignment algorithm, it is useful to have additional assurance from the likelihood ratio test that the specified alignment options are appropriate.

association analysis of familial dyslipidemia study samples
the posterior probability of the top alignment for each marker is included in parentheses. marker d11s <dig> is emphasized because its association significance improved in the one-to-one merge of the two finnish data sets. this marker was recently discovered to have the strongest linkage among these markers to familial dyslipidemia in a larger fine-mapping analysis.

interestingly, for the pairwise alignments between the dutch and finnish data sets  the d11s <dig> association was stronger for the lumped alignment format  than the one-to-one format . one explanation is that the differences in allele frequencies between the dutch and finnish ethnic groups is more consistent with the lumped format theory. that is, rather than unobserved alleles being missing, they are explained by genotyping differences. these results indicate that the lumped format may be desirable for combining data sets of differing ethnicity.

in practice, it is best to use micromerge to align data sets containing samples from the same ethnic group. however, micromerge v2's feature 5: using population allele frequencies to align data sets can offer an effective solution if the appropriate population allele frequencies are available. furthermore, the posterior probability can alert the user to alignment errors.

CONCLUSIONS
tools for increasing power in association analysis are becoming increasingly important for complex disease research. micromerge software enables a higher-powered analysis of multiallelic marker data projects containing genotype data generated from different laboratories, platforms or protocols. here we describe extensions to micromerge that increase its flexibility and accuracy for merging genotype data sets. we added seven new features to micromerge v <dig>  feature 1: one-to-one alignment format creates output files analyzable by most genetic analysis software. while in the real data project the one-to-one format had fewer alignment errors than the lumped alignment format, this is likely because it was a more appropriate format for this test data. both data sets had fewer than  <dig> samples, and one data set was about 60% smaller than the other data set. as a result, differences in observed bins between these data sets was likely due to missing alleles in the smaller data set. we recommend using the lumped format if the user intends to analyze the resulting data sets with mendel software and the data sets meet one of the following four criteria:  <dig> ) only a small percentage  of unique data set bins have rare frequencies, where we define a rare bin as having five or fewer instances in any one data set;  <dig> ) most of the markers have different numbers  of unique bins between any pair of data sets;  <dig> ) genotyping was done on platforms with different resolving power and  <dig> ) other situations where bin frequencies do not match well. otherwise we recommend using the micromerge v <dig> default one-to-one alignment format as it performed better on our test data sets and produces more flexible output files.

feature 3: re-merging markers with low posterior probabilities identifies low confidence regions of an alignment, zeroes rare bins within these regions, and re-merges the adjusted pedigree files. this feature recovers data from markers that might otherwise be discarded due to low confidence alignments because low posterior probability alignments are typically due to a few rare bins.

for markers where the expected alignment should contain n = nmin alleles, the user can quantify this preference using feature 4: adjusting the prior on the theoretical allele number, which allows adjustment of the n prior parameter τ. this feature may be useful when one data set is several times larger than the other data set, as the larger data set likely observes all alleles that were present in the smaller data set. also, in a mixed data set containing both multiallelic and snp markers this option could obviously be useful for the snp markers since two alleles are expected. adjusting the prior to strengthen emphasis on fewer theoretical alleles would improve alignment posterior probability in the case where a particular snp marker's minor allele frequencies differed by several-fold between data sets.

feature 5: using population allele frequencies to align data sets should be useful for situations where bin frequencies estimated from the data are unreliable. this feature could be used for small data sets, family data, or to align data sets typed on different ethnic groups. for example, consider a genotyping laboratory x with data available on both ethnic groups a and b for the same marker set. if a research project had genotyped samples with ethnicity a at laboratory x and wished to combine these samples with a set of ethnicity b genotyped at another laboratory y, the x laboratory might be able to provide the ethnicity b bin frequencies corresponding to ethnicity a's bins. using the b frequencies to represent the a pedigree file data would likely improve the alignment of these data sets.

association analysis of two merged finnish data sets gave stronger evidence for association than tests conducted on each data set individually. marker d11s <dig> had a moderately significant p-value of  <dig>  in finn <dig> and a p-value of  <dig>  in the combined finnish data sets under the one-to-one alignment option. indeed, linkage near this locus was found recently in a fine-mapping study . the association test p-value for the lumped alignment merge of the two data sets was  <dig> , which was the most significant p-value among the ten markers. since the one-to-one alignment format uses more information and we were confident in the allele frequency agreement between the two finnish data sets, it is reasonable that the one-to-one format outperforms the lumped alignment format in this case.

micromerge was designed to merge data sets of multiallelic markers, which are more difficult to align than snp data sets due to the greater number of alleles. the micromerge alignment algorithm preserves the allele fragment size order indicated in each locus file, which is not directly applicable to snp data. however, micromerge can be used to merge snp data sets if the major and minor alleles are ordered in the same way in both sets. the correspondence between the alleles of two data sets for a snp marker is usually known, since the markers are designed to detect specific nucleotides. however, there are several situations in which the application of micromerge to snp data would be of value. i. merging recoded alleles: the most common snp markers are biallelic, with the two possible nucleotide substitutions known. the snp allele can be reported as the nucleotide base observed. however, snp data may be recoded in a variety of ways. snps in taqman data files are often coded by the snp probe dye label, e.g., fam or vic, which may need to be aligned to nucleotide codes from another data set. in addition, if primer probes for a snp are redesigned during the course of a study, it is possible that the dye label may be assigned to the opposite allele in the new probe. another common coding system is using  <dig>   <dig>  and  <dig> to designate the major allele homozygote, the minor allele homozygote, and the heterozygote, not always in the same combination. a third difference in snp allele calling in different labs could be a result of differences in primer design. if the snp primer in one lab is designed to anneal to the opposite dna strand, the resulting snp nucleotide will be the base complementary to the nucleotide on the strand in the original design. in any of these cases, where the alleles are called correctly but named differently in the two data sets, it is a fairly straightforward task to use the allele frequencies to identify the corresponding major and minor alleles between the two datasets. however micromerge can simplify and streamline this task, particularly for large snp data sets which can number in the hundreds of thousands to millions of snp markers. ii. error detection/quality control: because micromerge gives an alignment posterior probability for every merged allele, using micromerge to merge snp data sets even when it is believed that the correspondence between the alleles is known can identify errors or poor quality data. because micromerge uses allele frequencies to merge alleles, and assigns a confidence for each merge, any problems in the data that result in poorly matched frequencies between the data sets would give low posterior probabilities. these problems could include the following: 1) genotype miscalls, for example those due to errors in clustering by allele calling software allele, 2) different naming schemes between the datasets, for example due to primers designed to opposite strands or probes labeled with different dyes, 4) population stratification between or within data sets. micromerge can be applied as a quality control step within a lab, to check between data sets generated at different times or on different platforms. while testing hardy-weinberg equilibrium would catch many of these frequency errors, errors might escape detection in the case where a small data set is merged with a large data set. in this situation, the large data set's allele frequencies would likely mask any frequency errors from detection by hardy-weinberg analysis performed on the merged data set. micromerge would flag frequency differences between the data sets as alignments with poor posterior probabilities. error detection at each marker is particularly critical for association analysis since a true signal will often not extend beyond a single marker. we plan to illustrate the value of micromerge for merging large-scale snp data sets and flagging potential errors in a future publication.

we have added seven useful new features to micromerge v <dig>  and tested them on real and simulated data. in addition, we have used micromerge v <dig> to merge three previously published familial dyslipidemia study samples that were analyzed separately for association. micromerge confirmed a genetic association with familial dyslipidemia in the fd study sample. these results show that micromerge can effectively increase statistical power in genetic association analysis. micromerge v <dig> software can be run with a simple command line interface. it is available with supporting documentation at  .

availability and requirements
project name: micromerge

project home page: 

operating system: linux  on intel and windows  on intel

programming language: fortran 90

other requirements: none

license: none

any restrictions to use by non-academics: none

authors' contributions
app, ems and jcp conceived of and developed most of the micromerge v <dig> features. dew and kÅ developed the one-to-one alignment method and debugged the software. pp and cp provided the familial dyslipidemia data. the manuscript was written by app and all authors revised and approved the manuscript.

supplementary material
additional file 1
micromerge v <dig> software for windows. this file contains a copy of micromerge v <dig> software for windows  on intel. versions of micromerge v <dig> developed for linux and macintosh systems, as well as current releases of micromerge can be found here: .

click here for file

 acknowledgements
we would like to thank marja-riitta taskinen, leena peltonen and tjerk de bruin for the familial dyslipidemia sample collection, the previously published genotype data of which was used to develop this software. we would like to thank the ucla genoseq core  for the finn <dig> raw data.
