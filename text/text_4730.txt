BACKGROUND
next-generation transcriptome sequencing promises to reveal the underlying complexities of gene expression. lagging behind the technology is a generally accepted approach to the analysis of rna-seq data, including the experimental design, normalization, and statistical analysis approach  <cit> . one issue is whether low levels of read counts qualify as a rare transcript, or whether they should be discarded due to the uncertainty in their quantification  <cit> . both rna-seq and microarrays are problematic for the detection of rare transcripts, although for different reasons  <cit> . in rna-seq technical replicates of the same biological sample may not contain a given transcript if it is rare  <cit> . low-expressed transcripts can skew the results when certain types of statistical analyses, such as t-statistics, are used  <cit> . furthermore, differences in library preparation across samples , sequencing errors  <cit> , and mapping and annotation errors  <cit>  can all contribute to inaccuracies in read count data. complicating matters further are well-known biases in rna-seq data, such as sequence composition and similarity  <cit> , gene length  <cit> , and sequencing depth  <cit> . in addition, the best choice of statistical model for differential gene expression is not straightforward. differences due to technical variation in read count data have been modeled with a poisson distribution, which assumes that the variance is equal to the mean  <cit> . however, differences among biological replicates of rna-seq read count data are far more variable than would be expected under a poisson distribution, a phenomenon known as over-dispersion  <cit> . to account for over-dispersion, a generalized linear model  using a negative binomial distribution has been proposed  <cit> . these issues leave the experimenter with several choices to make regarding data analysis: 1) which read counts to include in the analysis and which to discard; 2) which normalization methods will mitigate bias across samples; and 3) the best choice of statistical model to identify differentially expressed genes. systematic comparisons of these choices as well as other experimental parameters have been made previously with microarray data. large-scale comparisons using microarrays found that some experimental parameters were more critical than others in the analysis and interpretation of gene expression data. these studies use spike-in rna standards, similar sample preparation and handling procedures, and/or known mutations as benchmarks to examine potential technical differences in sample preparation and analysis . the maqc consortium identified and quantified the degree of variability and reproducibility both within and across different microarray platforms  <cit> . comparisons of analytical models, normalization methods, and team performance have also been made  <cit> . the results of differential gene expression analyses were often strongly influenced by the choice of normalization method . differential gene expression was also dependent on the analysis model used  <cit> ; interestingly, differences in model performance could also be traced to the practices and experience of the team doing the analysis  <cit> . furthermore, studies of gene expression-phenotype associations revealed that the phenotypic trait itself often had a large effect on the performance of the analysis model  <cit> . finally, the distribution of false discovery rates used to control the type i error rate in multiple testing can be altered by the analysis methods  <cit> . comparison studies such as these have provided biologists with the most critical parameters to consider when designing microarray gene expression studies and analyzing the results.

recently, we generated rna-seq data sets for  <dig> individual drosophila melanogaster. we froze  <dig> individual flies of each sex from  <dig> drosophila genetic reference panel  genotypes. we replicated this experiment at three different calendar times, maintaining the same environmental conditions for each replicate. environmental controls included parental culture density; rearing environment including food, temperature, and light: dark cycle; mating status; social exposure; and the circadian time of rna extraction. furthermore, we checked for technical sources of variation in our sequence data by adding ercc spike-in control rna during library preparation, and prepared duplicate libraries for  <dig> flies. these procedures enabled us to determine that the differential gene expression we observed was due to largely biological rather than technical sources. in addition, we used the sequence data itself to verify the sex and genotype of each fly. these sex and genotype analyses in combination with other considerations  led us to exclude the rna-seq data for  <dig> flies, yielding  <dig> data sets . we were interested in studying the effects of genotype, environment, and sex on gene expression in individual flies; we were also interested in characterizing the first- and second-order interactions . this large dataset is also valuable for understanding the impact and sensitivity of different analysis strategies on the ability to detect differential gene expression, in the spirit of previous comparison studies performed using microarray and rna-seq data. we wanted to optimize our strategy in order to detect differential gene expression using the number of read counts per gene as a proxy. several decisions must be made with regard to the filtering, normalization, and statistical analysis of read count data; any of these decisions may change the number and identity of differentially expressed genes. we therefore systematically examined the impact of three different filtering strategies, eight normalization methods, and two statistical approaches.

first, we wanted to remove genes having read counts below a reliable threshold of detection  <cit> . we derived an empirical threshold from the read count data  <cit>  and examined the impact of removing read counts below this threshold both before and after normalizing the data.

second, we wanted to choose the best normalization method for our read count data. we applied eight different normalization strategies to our read count data as in  <cit> : total counts ; upper quartile   <cit> , median   <cit> , trimmed mean of m-values   <cit> , normalization using the deseq package   <cit> , quantile normalization   <cit>  rpkm  <cit> , and remove unwanted variation   <cit> . we evaluated their effectiveness at reducing sources of bias as well as their impact on differential gene expression.

third, we wanted to evaluate the ability of different statistical models to accurately detect differential gene expression. we applied a generalized linear model  to read counts fitted with a negative binomial distribution and compared this model to an analysis of variance  of read counts fitted with a log-normal distribution. we employed three software packages--edger, deseq, and sas-- <cit>  to estimate differential gene expression.

these evaluations revealed important considerations to be made regarding the analysis of rna-seq read count data. failing to consider these issues has a profound effect on the number and identity of genes designated as differentially expressed. the best analysis scheme for our data was to first normalize using the deseq method and apply a generalized linear model assuming a negative binomial distribution using either edger or deseq software. we found that the removal of low-expressed genes after the normalization and data distribution fitting procedures was the most flexible filtering strategy. two normalization methods, deseq and tmm, properly aligned the distribution of our data across samples and accounted for the dynamic range of our data  <cit> ; however, tmm was sensitive to filtering strategy. in addition, we found that at least  <dig> biological replicates per genotype/environment/sex condition were required to have sufficient statistical power to detect gene expression differences, particularly among the three-way interaction of these factors.

RESULTS
application of low gene expression threshold
it is well known that rna-seq read counts, which are presumed to be the signal of gene expression, contain a certain degree of uncertainty. this uncertainty is due to differences in library preparation among samples, sequencing error, sequence composition, and mapping/annotation errors. very low read counts cannot be reliably distinguished from background noise  <cit> . genes with very low expression might not be adequately represented across all fly samples; if this is the case, they are more likely to be incorrectly identified as differentially expressed. we therefore wanted to define an appropriate read count threshold from our data. we determined the low read count threshold for each normalization method separately . we compared the distribution of intergenic read counts to those within the gene coding region  <cit> . we set the 95th percentile of the intergenic read counts as the threshold of detection  <cit> . low threshold values were comparable for all of the normalization methods, and were  <dig>  log <dig>  for tc,  <dig>  for uq,  <dig>  for med,  <dig>  for tmm,  <dig>  for deseq,  <dig>  for q,  <dig>  for rpkm, and  <dig>  for the un-normalized read count data. genes having read counts below these threshold values in all samples were removed from further analysis. note that genes having read counts above the threshold level in one fly would be retained in the analysis using this criterion, even if all of the counts for the remaining  <dig> flies were below the threshold level. normalization strategies often require the use of the entire data set to calculate the parameters for normalization. whether the removal of genes from the analysis takes place before or after normalization could therefore potentially impact the number and identity of differentially expressed genes. we examined these effects using three workflows . we normalized read count data and estimated distribution parameters first, then removed genes with read counts below the threshold value; we called this filtering strategy workflow  <dig>  we removed genes having read counts below the threshold value from the analysis first, then normalized the read count data and estimated distribution parameters; we called this filtering strategy workflow  <dig>  in addition, we analyzed the data without removing any low-expressed genes from the analysis; we called this filtering strategy workflow  <dig>  figure  <dig> shows the impact of filtering out low-expressed genes before or after normalization and distribution parameter estimation for each statistical analysis approach. as fig.  <dig> shows, the generalized linear model analysis using deseq was the most sensitive to filtering strategy, while the anova model was the least sensitive. fewer genes overlapped between workflow  <dig> and workflow  <dig> for the generalized linear model than for the anova model. most of the normalization methods were robust to filtering strategy, particularly when the main effects of genotype, environment, and sex were considered. however, the med, tmm, and q normalization methods were sensitive to whether the removal of low-expressed genes occurred before or after the normalization/distribution parameter estimation step. first-order interaction terms normalized using these three methods were the most sensitive to filtering approach. in the case of med-normalized read counts, the agreement of differentially expressed genes between workflows  <dig> and  <dig> was as low as 59 % . thus, some model terms and normalization methods were sensitive to low-expression filtering strategy. in contrast, the tc, uq, deseq, and rpkm normalization methods were robust to filtering strategy.fig.  <dig> flow chart showing analysis approach

fig.  <dig> effect of removing low-expressed genes before or after read count normalization on differential gene expression. the cell plot shows the percentage of agreement between workflow  <dig> and workflow  <dig>  a generalized linear model using deseq. b generalized linear model using edger. c anova using sas. abbreviations for normalization methods are the same as defined in fig. 1




comparison of normalization strategies
we compared the performance of seven popular normalization methods for rna-seq read count data as in  <cit> : tc, uq, med, tmm, deseq, q, and rpkm. the tc method consists of dividing the read counts by a ratio of the library size for a given sample to that of the average library size across samples  <cit> . similar strategies are employed for the uq and med methods, where the ratios are the upper quartile and median read counts, respectively; these values are computed after removing genes having zero read counts for all samples  <cit> . the tmm method scales read counts by the weighted log-fold-change values of a reference sample with genes that have extreme log-fold-changes  and extreme absolute expression levels  removed from the data. usually, the sample whose upper quartile is closest to the mean upper quartile is chosen as the reference sample  <cit> . likewise, deseq scales the read counts by a reference sample based on the geometric mean of read counts across all samples  <cit> . q normalization aligns the distribution of read counts across samples by ranking the read counts and then re-assigning the read counts for each gene to the average read count across ranked values  <cit> . finally, rpkm normalization multiplies read counts by a factor constructed from the gene length and read depth  <cit> . we compared these normalization strategies to the un-normalized read count data . we used boxplots to display the data before and after normalization for each fly within genotype, environment, and sex . one of the purposes of normalization is to align the distribution of read counts across samples  <cit> ; however, not all of the normalization methods successfully met this goal. notably, the tc and rpkm methods did not improve the distribution of the data in many instances. for example, ral- <dig> males of environment  <dig> do not show a change in distribution of read counts after normalization with either the tc or rpkm methods, consistent with previous observations  <cit>  . a second purpose of normalization is to reduce the within-condition variability due to background noise. the q normalization method behaved differently from the other normalization methods in this respect. in some cases, q normalization decreased within-condition variability for some samples , but added new variation to the data in other samples . in general, the uq, med, tmm, and deseq methods improved some of the systematic biases in rna sequence data. however, the number and identity of differentially expressed genes varied greatly across normalization procedures, as discussed below.fig.  <dig> examples of differences observed in normalization methods. a boxplots of individual ral- <dig> males of environment  <dig>  b boxplots of the coefficient of variation for ral- <dig> females of environment  <dig>  c boxplots of the coefficient of variation for ral- <dig> males of environment  <dig>  a complete set of box plots can be found in additional files  <dig> and  <dig>  abbreviations for normalization methods are the same as defined in fig.  <dig>  it has come to our attention that the line number designation for the drosophila genetic reference panel has been officially changed in flybase. specifically, the lines used to have a “ral-” prefix; they now have “dgrp-” as the prefix . we have used the “ral-” prefix several times in our manuscript, in fig.  <dig>  and in additional files  <dig> and  <dig>  future usage would be with the “dgrp –“prefix



we noted that some of the highest read counts in our data set came from those aligned to non-protein coding genes. high read counts from rrnas, pseudo-rrnas and other rna species were present in the data set; these species are present in the total rna of each sample and may persist after library preparation if they have poly-a tails and/or poly-a selection is incomplete. we examined the impact of these species on differential gene expression. first, we removed all non-protein-coding genes from the data set of workflow  <dig> deseq- and tmm-normalized data, and compared the differential expression analysis results to that of the original data, which contained all of these species. the results were quite similar for deseq-normalized data; 85 % or more of the differentially expressed genes overlapped. the results were somewhat less similar for tmm-normalized data; 73 % or more of the differentially expressed genes overlapped. most of the differences in analysis were due to the removal of non-protein-coding genes that had significant differential expression in the original analysis . the number and identity of differentially expressed protein-coding genes was robust to the removal of non-protein-coding genes from the analysis. thus, the deseq and tmm normalization methods can compensate effectively for rna-seq data with a large dynamic range.

in addition, we explored the possibility of using the remove unwanted variation  normalization method  <cit>  for our data. this method uses spike-in  control genes to remove sources of technical variation such as differences in library preparation or variation among flow cells. the method considers these sources of technical variation as a covariate in the differential expression model. with this technique, a principal components analysis performed after normalization should reveal differences among experimental factors rather than the sources of technical variation  <cit> . a principal components analysis using the un-normalized data revealed that the first principal component, which explained  <dig>  % of the biological variation among flies, was able to distinguish between the two sexes . the second principal component, which explained  <dig>  % of the biological variation, was able to distinguish among the three environmental conditions to a very limited extent . we therefore used only the first principal component in the models for differential expression analysis. we found, however, that the sex and environmental conditions overlapped in the pca plot using ruvg normalized read counts . this suggests that the technical variation is not the same between the spike-ins and the experimental sample. these differences may be a result of differences in our experimental approach and library preparation to that of  <cit>  . as the technical variation between spike-ins and sample must be equivalent to use the ruvg method, we did not pursue this method further.

comparison of dispersion estimation methods
unlike microarray data, rna-seq read count data do not have a continuous distribution. one common procedure is to use a poisson distribution to model the data. however, a poisson distribution assumes that the mean and the variance are equal, which is not an ideal fit to rna-seq data as they exhibit over-dispersion  <cit> . to apply the generalized linear model, we therefore modeled our read count data with a negative binomial distribution  <cit> . this distribution relies on an estimated dispersion parameter, which controls the relationship between the mean and the variance of the count data. the estimation of the dispersion parameter will affect the detection of differential genes reported by the generalized linear model. we used both deseq and edger software to estimate the dispersion parameter for each gene. deseq first calculates a dispersion value for each gene, and then fits a curve through the estimates  <cit> . dispersion values are then assigned to each gene based on a choice between the greater of the per-gene estimate or the fitted value. edger estimates a common dispersion based on the cox-reid adjusted profile likelihood and then applies an empirical bayes method to estimate the per-gene dispersion  <cit> . the dispersion estimations for each normalization method using deseq have a similar shape, with the exception of rpkm-normalized read counts . rpkm-normalized counts also have a different pattern of dispersion when calculated by edger . we also noted that dispersion estimations using q normalization were different from the other normalization methods. we examined the effect of filtering strategy on dispersion estimates by plotting dispersion estimates of workflow  <dig> versus workflow  <dig>  in most cases, the dispersion estimates for each workflow were well correlated, as expected. however, the correlations were different for rpkm- and q-normalized data . workflow  <dig> dispersion estimations were higher than those of workflow  <dig> for q-normalized data regardless of the algorithm employed. however, workflow  <dig> dispersion estimates were higher for rpkm-normalized data using deseq, while workflow  <dig> dispersion estimates were higher for rpkm-normalized data using edger. this suggests that dispersion estimates using q and rpkm normalized data are sensitive to the filtering strategy. however, it should be noted that rpkm values cannot be directly input into either deseq or edger; both programs expect read count data as input. we therefore input rpkm data as the normalized read counts rounded to be integers. this common practice impacts the dispersion estimates, which use the read counts for all samples to get each per-gene estimate. because q and rpkm normalization procedures use the entire data set, filtering and rounding effects are more apparent. the remaining normalization methods  had good agreement in dispersion parameters across workflows, and the resulting statistical analyses using edger and deseq were also comparable .

comparison of differential gene expression models
we used two different models to determine differences in gene expression among flies: a generalized linear model using a negative binomial distribution and an analysis of variance  using a log-normal distribution. we used the deseq and edger packages to estimate gene expression differences using a generalized linear model, and sas to calculate the anova parameters. our models consider the main effects of genotype, environment, sex, and their interactions. table  <dig> shows the numbers of differentially expressed genes calculated for each factor in the generalized linear model using deseq with the workflow  <dig> strategy; these are compared across all normalization methods. the overlap of differentially expressed genes across all normalization methods was surprisingly low. even when the un-normalized data were removed from the comparison, the agreement among normalization methods was as low as 10 % . the lack of overlap stresses that the choice of a proper normalization method is crucial. we compared the deseq-derived results from table  <dig> to the numbers of differentially expressed genes calculated for the generalized linear model using the edger package. we compared the differences among software packages for workflow  <dig> , workflow  <dig> , or if the low-expression genes were left in the data set . there were few, if any, differences in differentially expressed genes identified using these two programs across model factors, workflows, or normalization methods. virtually every comparison was 96 % or greater in agreement. only q normalization showed any discrepancy in the genes identified by the two programs, and the differences were predominantly in the first- and second-order model terms. thus, while deseq and edger employ somewhat different algorithms, the number and identity of differentially expressed genes were in good agreement.table  <dig> numbers of differentially expressed genes called by deseq using the workflow  <dig> generalized linear model. numbers of genes are listed by analysis factor and normalization method

 <dig> 
9469
 <dig> 
3463
7163
2725
3611

tc total counts, uq upper quartile, med median, tmm trimmed mean of m-values, deseq deseq normalization method, q quantile, rpkm reads per kilobase per million mapped, rc un-normalized count data


a numbers of overlapping genes among all methods


b numbers of overlapping genes among all methods except rc, the un-normalized count data


cbold indicates preferred normalization method

fig.  <dig> comparison between the number and identity of differential genes estimated by deseq and edger. the cell plot shows the percentage overlap between the two programs for each normalization method. a workflow  <dig>  b workflow  <dig>  c no filtering. abbreviations for normalization methods are the same as defined in fig. 1




striking differences were observed in the comparison of the generalized linear model with the anova model. we compared the second-order term  among these methods as the significance test has the same structure. figure  <dig> shows the differences in differentially expressed genes identified by these methods for workflows 1– <dig> and for each of the normalization methods. as fig.  <dig> shows, the agreement across model types is quite low; as expected, the un-normalized read count data was the least consistent across models, averaging only  <dig>  % agreement in differentially expressed genes. for every normalization method, there was better agreement between the edger glm and the anova than the deseq glm and the anova. the greatest agreement was  <dig>  % between the edger glm and the anova for med-normalized data. thus, the differences observed in the number and identity of differentially expressed genes hinge on the assumption of the underlying data distribution, and the assumption of a normal distribution, while robust in many types of data analysis, does not capture the dynamic range of rna-seq read count data.fig.  <dig> comparison of the number and identity of differentially expressed genes obtained using the generalized linear model  with those obtained using the anova model. the graph shows the percentage of differentially expressed genes for the genotype × environment × sex term that agree between the glm and anova methods. dark blue bars, overlap of deseq glm and anova for workflow 1; light blue bars, overlap of deseq glm and anova for workflow 2; medium blue bars, overlap of deseq glm and anova for workflow 3; dark red bars, overlap of edger glm and anova for workflow 1; light pink bars, overlap of edger glm and anova for workflow 2; medium pink bars, overlap of edger glm and anova for workflow  <dig>  abbreviations for normalization methods are the same as defined in fig. 1




the application of the generalized linear model necessitated decisions about the order in which the first-order interaction terms  were evaluated in the model. however, the number and identity of differentially expressed genes can change depending on the order in which these terms are fitted to the model. we evaluated three different approaches to model these terms. in the first approach, we tested each first-order interaction term by sequentially adding it to the main-effect model . we added genotype × environment first, genotype × sex second, and environment × sex third. in the second approach, we fitted each first-order interaction term separately, using a model of main effect terms as the reduced model . in the third approach, we used a model with the main effects and all first order interaction terms, with the reduced model having each first order interaction term removed in turn . we compared the number and identity of differentially expressed genes for each of these approaches for both workflows, the deseq and edger analysis programs, and all normalization methods. the results of these comparisons are of additional file 1: table s <dig>  it can be readily seen that the second approach yields the same answers for the genotype × environment interaction term as the first model; the third approach yields the same answers for the sex × environment interaction term as the first model. the number of differentially expressed genes for the genotype × environment interaction term was substantially reduced when all of the first-order interaction terms were fitted to the model ; thus, it explained less variation in the data. also, after quality control, some of our samples were removed from the data set, giving us an unbalanced data set; a balanced data set would give us the same overlap using the first and third approach . each of these approaches has merit, depending on the overall goal of the experiment; for example, if one is particularly interested in genotype × environment interactions, it would make sense to use the first approach in order to identify the largest potential subset of genes having significant genotype × environment effects.

statistical power calculations
we based our differential expression analysis on eight individual flies per genotype/environment/sex. this is a higher number of samples per condition than would normally be anticipated in an rna-seq experiment. this approach ensured that we could detect subtle differences in gene expression. however, we wished to determine whether similar results could be obtained using a smaller sample of flies. figure 6a shows how the statistical power to detect second-order differential gene expression varies with sample sizes of  <dig>   <dig>   <dig>   <dig>   <dig>   <dig>  and  <dig> flies per genotype/environment/sex. for a statistical power of 80 %, it can be seen that a sample size of  <dig> flies per condition would reliably detect gene expression differences only if those differences were  <dig> -fold or greater. three flies would detect  <dig> -fold or greater changes. estimated variance is reduced for  <dig> flies per condition versus  <dig> flies per condition when fold-change was held constant . the required number of flies for detection of differential gene expression is somewhat lessened for first-order terms . two flies per condition would detect  <dig> -fold or greater changes; three would detect  <dig> -fold changes. these results indicate that using three flies per condition would be adequate for detecting large  changes among experimental factors. our data were far more sensitive, however; we could detect  <dig> -fold differences in expression for the three-way interaction term.fig.  <dig> statistical power analysis. a detectable fold-change versus statistical power for n =  <dig>   <dig>   <dig>   <dig>   <dig>   <dig>  and  <dig> flies per genotype/environment/sex. b estimated variance



our power calculation was based upon the ln&anova approach so that we could calculate the statistical power for the first and second-order terms we were interested in . current methods to calculate the statistical power for rna-seq read counts assuming a negative binomial distribution are limited to a single factor  <cit> . however, it is possible to examine the impact fewer flies would have on the on the number and identity of differentially expressed genes using an empirical approach, as has been applied previously to microarray data  <cit> . we randomly sampled our data for  <dig>   <dig>  and  <dig> flies per genotype/environment/sex condition and ran the generalized linear model for workflow  <dig> using deseq-normalized read counts. we compared the percentages of differentially expressed genes that overlap with the full data set for different false discovery rate thresholds  <cit>  . this analysis shows a greater level of agreement with the complete data set when greater numbers of flies are analyzed per condition, as expected. the percentage agreement tended to drop slightly as the false discovery rate was reduced. note also that the percentage of overlap depended upon the factor being studied. for example, using even  <dig> flies per condition would be sufficient to produce the same estimate of differentially expressed genes between males and females as the full data set, but at least  <dig> flies per condition would be required to estimate differential expression for the first-order environment × sex interaction term. thus, while we were not able to calculate the statistical power directly for a negative binomial distribution, the empirical approach indicates that at least  <dig> flies per condition would be required to sufficiently estimate differential expression for most of the factors we considered.fig.  <dig> empirical analysis approach using a reduced data set. the percentage of genes overlapping with the full data set is plotted against different false discovery rate thresholds for n =  <dig>   <dig>  and  <dig> flies per genotype/environment/sex



discussion
here we applied three different filtering strategies, eight normalization methods, and two statistical models to rna-seq read count data. we derived an empirical low gene expression threshold using both genic and intergenic read count data, and we estimated the numbers of biological replicates necessary to detect differential gene expression. in most instances, the number and identity of differentially expressed genes were robust to the method employed. however, certain manipulations of the data can profoundly alter the results. our comparisons reveal the key decisions to be made in the analysis of rna-seq data and the consequences of ignoring those decisions. we address filtering strategy, normalization methods, model comparison, and statistical power considerations below.

filtering strategy
whether the statistical analysis results were robust to filtering strategy  depended upon the factor of interest in the statistical model. the main effects of genotype, environment, and sex were not sensitive whether low-expressed genes were removed before or after normalization. however, the first- and second-order interaction terms were sensitive to filtering; in particular, the med, tmm, and q normalization methods showed less agreement in the number and identity of differentially expressed genes between workflows  <dig> and  <dig>  the sensitivity of these normalization methods in particular results from the fact that all of the read count data in the data set is used to calculate normalization parameters. clearly, the median of the data set will change if the low-expressed genes are removed before normalization, making the med read count data different in workflow  <dig> versus workflow  <dig>  likewise, the tmm method uses subsets of genes in the middle 40 % and 90 % of the read count data to calculate the normalization parameter; the removal of low-expressed genes changes how the middle 40 % and 90 % are defined. finally, the q normalization assigns new read count values based on the rank order of the read counts. removal of the smallest read counts will change this data set as well. in contrast, use of the remaining normalization methods lead to very similar results whether using workflow  <dig> or workflow  <dig>  we prefer the workflow  <dig> strategy of removing low-expressed genes after the normalization step, because it gives us the option to apply different low-expression thresholds without the necessity of repeating the statistical analysis; only the false discovery rates need be re-calculated. the removal of low-expressed genes may constitute a de facto statistical test, resulting in an increase in the true false-positive rate  <cit> . however, we found that the majority of differentially expressed genes in our data set were the same whether the data were filtered or not, which is likely due to 1) the increased statistical power from the large sample size in our data set, and 2) the fact that the filter did not remove many genes. for example, only  <dig>  % of the genes were removed from the analysis in workflow  <dig> deseq-normalized data. . it is not necessary to devise a filtering strategy for all rna-seq experiments. for example, some rna-seq experiments profile small numbers of genes, or focus on rare transcripts. in these cases, a filtering strategy would not be warranted. however, there is a risk of an increased number of false positives if small numbers of read counts for a gene are detected in only one sample.

normalization methods
we noted that the tc and rpkm normalization methods were not effective at aligning the distribution of read counts across samples, an issue reported previously  <cit> . one reason for this lack of improvement can be observed in the distribution of our read count data. fifty percent of the read counts for males align to only  <dig> genes, while fifty percent of the read counts in females align to only  <dig> genes. similar distributions of read counts have been observed in other rna-seq data sets, including data from other species  <cit> . using simulated data,  <cit>  noted that tc, uq, med, q, and rpkm normalization methods were not able to control false positives in data having a small number of genes with very high read counts. in contrast, the deseq and tmm normalization methods are designed to account for these extreme differences in read count number  <cit> . tmm in particular has adjustable parameters that could be used to account for data with a large dynamic range  <cit> . note that here we used only the default settings of these parameters, but we could have adjusted the parameters to improve the alignment across samples. many of the genes having the highest read counts in our data set are non-protein coding genes such as rrnas, pseudo-rrnas, etc. the presence of these additional types of rna is due to non-specific binding of poly-a rna species to the oligo-dt beads used during library construction; we did not completely eliminate these species in our rna-seq library preparations. this issue could potentially be alleviated in the future with double polya isolation, which would require the use of more total rna, or by using protocols that would eliminate ribosomal rna species. we found good agreement in the number and identity of differentially expressed genes in the deseq- and tmm-normalized data sets whether these non-protein coding genes were retained in the data set or not. thus, it is important to use a normalization method that will account for extreme values in the data if the specific rna extraction and library preparation processes used cannot eliminate other, potentially abundant species that may be present in the library due to non-specific binding. alternatively, these species may be of interest biologically, and it would be advantageous to have methods that can account for them in the event they are retained in the data set.

ruvg normalization has the advantage of producing the same normalized read counts no matter what filtering strategy is used because the normalization parameters are constructed using only spike-in rna. however, the technical variation did not affect both spike-ins and experimental sample equivalently in our data, which is a key assumption of the method  <cit> . we note that there are differences between our experiment and that of  <cit>  that might have contributed to the differences in technical variation between the spike-ins and the experimental sample in our data. they systematically varied both library preparation and flow cell designation in their experiment, while our experiment did not. further, they added spike-ins during the rna isolation step, while we added the spike-ins after the polya isolation step. we were thus unable to fully evaluate this normalization method.

in summary, we found that the tc and rpkm methods were not effective at aligning the read count distributions across samples  <cit> . use of the uq method may produce false positives  <cit> . the med, tmm, and q methods were sensitive to filtering strategy, although tmm is able to account for the large dynamic range in rna-seq read count data. for our data, the deseq normalization method had the best properties: it aligned read count distributions across samples, reduced background noise, and accounted for the large dynamic range present in our data.

model comparison
we observed many differences in the number and identity of differentially expressed genes across the seven normalization methods. this is in contrast to  <cit> , who documented more consistent results across normalization methods. we propose that there are two reasons for this difference. first, the data they used for their comparisons contained at most three replicates per condition. our data had  <dig> flies per genotype/environment/sex condition, which greatly magnified the sensitivity of our data to the normalization method chosen. second, the data they used examined differences in a single condition; our statistical model tested differences in gene expression across three main factors and their interactions. the additional complexity in our model revealed interacting factors that were more sensitive to normalization strategy. these observations suggest that comprehensive data sets used to address multi-factor conditions will be more sensitive to the choice of normalization. we observed very little difference between differentially expressed genes identified by the deseq and edger programs using the same generalized linear model, regardless of normalization method and filtering strategy. only the q normalization method, which is an appropriate method commonly used for normalizing microarray data  <cit> , exhibited any substantive differences. perhaps not surprisingly however, the differences between the generalized linear model and the anova model were much higher. the underlying assumption for the generalized linear model is a negative binomial distribution  <cit> , while the assumption for the anova is a normal distribution. rna-seq read count data have a very wide dynamic range that is typically skewed towards low read count end of the distribution; such data do not fit a normal distribution very well  <cit> . in addition, our read count data were not homoscedastic for the log-normal distribution, which violates one of the basic assumptions for the use of an analysis of variance  <cit> . thus, modeling rna-seq read count data with a negative binomial distribution is the most appropriate approximation.

dispersion estimation
dispersion estimates were different for rpkm and q normalized data, whether using either deseq or edger software. but these normalization methods cannot be properly implemented using either deseq or edger. because both of these programs expect read count input, an integer value, a common practice is to perform the normalization step using another program and then round the normalized read count data to the nearest integer value. the dispersion estimates per gene are different whether using workflow  <dig> or workflow  <dig>  so the rounding procedure in effect increases sensitivity. the authors of the deseq and edger programs  caution against using rpkm or q-normalized data as input, yet the practice persists. the downstream effects of this practice can be seen by comparing the tc and rpkm normalization methods for unfiltered data. the only difference between these two normalization methods is the gene length, which is constant for a given gene across samples. further, our generalized linear models compare the effects of genotype, environment, and sex within a gene rather than among genes. thus, we would expect the tc and rpkm normalization methods to give identical lists of differentially expressed genes when the data are unfiltered. however, this is not what we observed. the newer deseq <dig> program can be used to implement rpkm  <cit> . note, however, that we were unable to use deseq <dig> with our large data set due to limitations in the program. although edger and deseq use different algorithms to estimate dispersion, the number and identity of differentially expressed genes were the same for deseq- or tmm-normalized data , indicating that either software package could be used for these estimates.

statistical power considerations
we calculated the sample sizes necessary to control the risk of making both type i and type ii errors post-hoc. here we used the ln&anova model assuming a balanced design as the calculations for a three-factor model are relatively straightforward. methods have been developed for the calculation of statistical power for rna-seq data using a negative binomial distribution  could only detect differences in expression of  <dig> -fold or greater for the three-way interaction term, genotype × environment × sex. detection of differences was somewhat better for the genotype × environment term; two replicates could detect  <dig> -fold or greater differences. the empirical study using  <dig>   <dig>  and  <dig> flies per condition supports the notion of using three or more biological replicates in rna-seq experiments. this approach also shows a dependency on the factors being analyzed; for example, differences between male and female expression were more robust than differences across replicate environments. often the choice of the number of biological replicates is not a function of statistical considerations, but economic ones. furthermore, there is often a trade-off between experimental parameters such as the number of biological replicates, the number of genotypes or treatments, and the amount of sequence coverage. previous studies have noted that adding biological replicates to the experiment is a more effective way to increase the statistical power to detect differential gene expression than increasing sequence depth  <cit> . increased biological replication can mitigate the number of false positives  <cit> ; though both increased replication and sequencing depth improves the detection of genes with characteristically low expression  <cit> . we demonstrated that three biological replicates produced a substantial improvement in fold-change detection over two; we recommend using at least three biological replicates if possible.

CONCLUSIONS
our investigation revealed that the most critical considerations for the analysis of rna-seq read count data were the numbers of biological samples, normalization method, and underlying data distribution assumptions. the statistical power analysis suggests that at least three replicates are required to detect differential expression among a three-way interaction of experimental factors. the sensitivity of our data set to differences in normalization method indicates that this is a crucial choice and that the normalization method chosen should account for the large dynamic range observed in rna-seq read count data. we recommend the deseq or tmm normalization methods, noting that tmm is more sensitive to filtering strategy. a generalized linear model using a negative binomial distribution can be readily adapted to multi-factor comparisons using deseq or edger software as we demonstrated here. the size and complexity of these data enable it to serve as a benchmark for rna-seq analyses. future challenges include the incorporation of alternative splicing and polymorphism data into this analysis.

