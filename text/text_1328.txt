BACKGROUND
evolutionary analyses of gene sequence data are increasingly reliant on model-based phylogenetic approaches. in recent years, this has been given substantial impetus by the surge in genome-scale data, improvements in computational power, and the application of bayesian statistical methods to phylogenetics  <cit> . statistical models are typically used to describe the substitution process in nucleotide or amino acid sequences  <cit> , diversification and demographic processes  <cit> , and patterns of evolutionary rate variation among lineages  <cit> . in a bayesian framework, the various components describing different aspects of the evolutionary process collectively form the hierarchical model.

the accuracy of phylogenetic inference depends on the fit of the bayesian hierarchical model to the data set being analysed. this includes the extent to which the assumptions of the model are met, and whether the model reasonably describes the data  <cit> . for example, if a data set sampled from an exponentially growing population is analysed using a model that assumes a constant population size, the estimate of the population size will be highly misleading. model misspecification can also result in errors in the estimates of other parameters, including the phylogenetic tree and branch lengths  <cit> . for this reason, model selection forms a critical component of phylogenetic analyses  <cit> .

likelihood methods for model selection include likelihood-ratio tests and information criteria. the likelihood-ratio test has been widely used in phylogenetics to select substitution models and to test for the strict molecular clock  <cit> . this method uses the difference in log-likelihoods between two competing models multiplied by  <dig> as a test statistic. the test statistic follows a χ <dig> distribution with degrees of freedom equal to the difference in number of parameters between the two models. a limitation of this approach is that only nested models can be compared. the akaike information criterion  and bayesian information criterion  are also popular methods in phylogenetics. their advantage over the likelihood-ratio test is that it is possible to compare non-nested models. both of these methods use the maximum likelihood of competing models and penalise the number of parameters to obtain a score. to select a model, the aic or bic score is calculated for all the models considered and that with the lowest score is selected  <cit> . in the case of substitution model selection, the bic appears to have a better performance than the aic  <cit> .

bayesian model selection is usually based on comparison of the marginal likelihoods using bayes factors  <cit> . calculating the marginal likelihood involves integrating the likelihood across parameter values of the model, and weighting by the prior. in phylogenetics, an analytical solution to calculate the marginal likelihood is intractable. consequently, it is common to use approximate methods of estimating marginal likelihoods, such as importance sampling, path sampling, and generalised stepping-stone sampling  <cit> . estimators based on importance sampling, including the harmonic mean and the aicm , are computationally efficient but unreliable because they have an unacceptably high variance . path-sampling approaches include thermodynamic integration  <cit>  and stepping-stone sampling  <cit> . although these estimators are more accurate, they require additional calculations beyond those used to estimate the parameters in the model. to estimate the marginal likelihood, these approaches draw samples from a series of distributions between the posterior and the prior, such that the prior should be carefully selected. in particular, the prior distributions for all parameters should integrate to  <dig>  known as ‘proper priors’  <cit> .

conceivably, even when the priors are proper, their arbitrary choice can lead to different models being selected. although this is well documented in the statistical literature, the effect of the prior in clock model choice remains largely unexplored. a recently developed path-sampling method, known as generalised stepping-stone sampling  <cit> , involves drawing samples from distributions between the posterior and a working distribution, instead of the prior. however, the prior still affects the model selected because it is part of the calculation of the posterior. importantly, the working distribution for continuous parameters can take a gaussian shape, but for discrete parameters, such as the genealogy, there are several strategies available to select the working distribution  <cit> .

lartillot et al.  <cit>  first proposed the use of a cross-validation approach for selecting amino acid substitution models. its performance was found to be similar to that of bayes factors using marginal likelihoods. the motivation behind this method is to select models according to their predictive power by splitting the data into ‘training’ and ‘test’ sets. for sequence data, these sets are generated by randomly sampling sites without replacement from the alignment. the training set is used to estimate the parameters of the models being compared. the likelihood of the test set is calculated for each model using the parameter estimates from the training set. the model with the highest likelihood for the test set is regarded as the best-fitting.

in a bayesian framework, the parameter values are sampled from the posterior distribution obtained from the training set and are used to estimate their likelihood for the test set. the resulting likelihoods are effectively the probability of the test data given the model and parameter estimates under the training set. the model that has the highest mean likelihood for the test set is then regarded as providing the best fit. because the likelihood of the models is evaluated using a data set that has not been observed , artefacts due to over-parameterization are alleviated  <cit> . thus, it is not necessary to penalize explicitly for excessive parameters, as in the case of information criteria  <cit> . to reduce sampling error, the cross-validation procedure can be repeated a number of times, with the likelihood for each model averaged over replicates.

we extend the cross-validation method proposed by lartillot et al.  <cit>  for substitution models to other components of the bayesian hierarchical model: the molecular clock model and the demographic model. we also test whether the performance of the method depends on the length of the sequence alignment, because the probability of identifying the optimal model should improve with the amount of data .

methods
cross-validation implementation
in our implementation of cross-validation, we randomly sample half of the sequence alignment without replacement. one half is the training set and the other is the test set, such that the two sets have no overlapping sites. we then analyse the training set using the bayesian markov chain monte carlo method in beast v <dig>   <cit> . this program requires the specification of a clock model as well as a demographic or speciation model. it estimates the posterior distribution of parameters in the model, including rooted phylogenetic trees with branch lengths in units of time . we draw samples from the posterior and use p <dig> v <dig>   <cit>  to calculate the phylogenetic likelihood of the test set given these samples. however, to calculate the phylogenetic likelihood it is necessary to use phylograms . we convert the chronograms into phylograms by multiplying branch lengths  and substitution rates. we draw  <dig>  samples from the posterior estimates of the training set, then use each set of sampled parameters to calculate the mean phylogenetic likelihood for the test set. the mean likelihood is compared for different models, and we consider the best model to be that with the highest mean likelihood for the test set. the computer code to conduct our analyses is available online .

simulations
we used a simulation approach to test the accuracy of cross-validation in selecting clock and demographic models. we considered three molecular clock models; the strict clock , the relaxed uncorrelated lognormal  clock, and the relaxed uncorrelated exponential  clock. first, we sampled from the prior within the beast framework to generate ten phylogenetic trees, each with  <dig> taxa and a root node age of 100 years. the tree topology and relative ages of internal nodes were based on a constant-size demographic model. we simulated branch rates according to the three clock models using nelsi v <dig>   <cit> . for the sc model, we used a rate of 10− <dig> substitutions/site/year, which broadly reflects the substitution rates that have been estimated in a range of rna viruses, such as hiv  <cit>  and dengue virus  <cit> . for the ucln and uced models, we used a mean of 10− <dig> substitutions/site/year and a standard deviation of 10 % of the mean for the ucln . we then used pyvolve  <cit>  to simulate the evolution of sequences of length  <dig> ,  <dig> , and  <dig>  nt under the jukes-cantor substitution model.

we compared all three clock models using the cross-validation method described above, with test and training sets of 50 % of the alignment length. for the beast analysis, we used a chain length of  <dig> steps, with samples drawn every  <dig>  steps, and discarding 10 % of the chain as burn-in. whenever the effective sample size for any of the parameters was below  <dig>  we doubled the chain length and halved the sampling frequency.

we also conducted simulations using two different demographic models: the constant-size coalescent  and the exponential-growth coalescent . we obtained trees in beast by sampling chronograms from the prior under the two demographic models. for the egc model, we set the growth rate to  <dig> , which is similar to that observed in some viruses  <cit> . we used the strict-clock model with a rate of 10− <dig> substitutions/site/year and simulated sequence evolution as described above.

analyses of empirical data
we analysed four nucleotide sequence data sets to illustrate the performance of cross-validation  enterovirus a <dig> , with  <dig> partial polyprotein sequences of 858 nt sampled between  <dig> and  <dig>   <cit> ;  west nile virus , with  <dig> complete sequences of  <dig>  nt sampled between  <dig> and  <dig>  <cit> ;  rabbit hemorrhagic disease virus , with  <dig> capsid gene sequences of  <dig>  nt sampled between  <dig> and  <dig>  <cit> ; and  whole-genome single-nucleotide polymorphisms of the bacterium shigella sonnei, with a total of  <dig> sequences of  <dig>  nt sampled between  <dig> and  <dig>  <cit>  . the alignments are available online .table  <dig> details of four viral and bacterial data sets analysed in this study


shigella sonnei


we used the cross-validation method to compare four combinations of clock model and demographic model: sc + csc, sc + egc, ucln + csc, and ucln + egc. these analyses were conducted in beast using the same settings as in our analyses of simulated data. we used the gtr + Γ substitution model, accounting for rate heterogeneity among sites which is expected in the empirical data. the sampling times of the sequences were used to calibrate the clock; the four data sets have previously been found to have sufficient temporal structure according to the date-randomization test  <cit> . for each analysis, we performed ten replicates of the cross-validation procedure, which appears to be sufficient in empirical studies  <cit> . we conducted two sets of analyses, in which we specified the training set as either  <dig> or 80 % of the alignment length. we used the mean likelihood across the ten replicates to select the optimal hierarchical model. for comparison, we estimated marginal likelihoods for these model combinations using stepping-stone sampling in beast  <cit> .

to investigate potential differences between the models selected using marginal likelihoods and cross-validation, we analysed the complete data sets using ucln + egc. under this model combination, it is possible to obtain a measure of clock-like behavior   <cit>  and the population growth rate. the data display clock-like behavior if the mode of the posterior is close to zero, and a constant population size if the 95 % credible interval of the growth rate includes zero.

RESULTS
simulations
the cross-validation methods yielded mixed results when attempting to distinguish between data generated under the strict- and the relaxed-clock models. in all simulations under the sc model, cross-validation correctly identified the model used to generate the data . similarly, the sc model had no support when the data were generated under either of the relaxed-clock models. this result did not depend on sequence length, suggesting that even the smaller data sets, of  <dig>  nt and a training set of  <dig>  nt, were sufficiently informative. in contrast, distinguishing between the ucln and the uced models was more difficult. the ucln model had the strongest support for most of the data sets, even for those generated under the uced model. interestingly, an increase in sequence length led to a greater frequency of the uced model being correctly chosen for data generated under the same model. for the simulations performed using the uced model and with an alignment length of  <dig> ,  <dig> , and  <dig>  nt, the uced model was selected with a frequency of  <dig> ,  <dig> , and  <dig> , respectively. notably, in a previous study using marginal likelihood, an alignment of  <dig>  nt from  <dig> taxa was sufficient to distinguish between relaxed-clock models  <cit> .table  <dig> molecular-clock models selected for data sets simulated with three different sequence lengths  and using three different clock models: the strict clock , uncorrelated lognormal relaxed clock , uncorrelated exponential relaxed clock 

the numbers indicate the frequency with which each model was selected, out of ten simulation replicates



for the simulations under different demographic models, the cross-validation method incorrectly supported the egc model for the data generated under the csc, with a frequency of  <dig>  for alignments of  <dig>  nt, and  <dig>  for those of  <dig>  and  <dig>  nt. the method was much better at identifying the egc model, which was supported with a frequency of  <dig>  for all sequence lengths . this result indicates that under these simulation conditions, cross-validation is more efficient at detecting under- than over-parameterization for demographic models. similar results have been reported in the context of clock-model adequacy  <cit> .table  <dig> demographic models selected for replicate data sets simulated with three different sequence lengths  and using two different demographic models: the constant-size coalescent  and exponential-growth coalescent , with a growth rate of  <dig> 

each row corresponds to simulations performed using one of the two demographic models



empirical data
in our analyses of empirical data, we found that the sc + egc model was supported for ev-a <dig> and wnv, using either  <dig> or 80 % of the data for the training set . this result is consistent with the findings of the studies that originally analysed these data sets using marginal likelihoods  <cit> . for ev-a <dig>  the model selected using cross-validation matched that chosen by comparison of marginal likelihoods. for wnv, however, ucln + egc had the highest marginal likelihood. the ucln + egc model had the highest support for the rhdv data set according to both cross-validation and marginal likelihoods, which is again consistent with the findings of the original study  <cit> . for shigella sonnei, cross-validation supported the sc + csc model, whereas marginal likelihoods supported the ucln + egc model. there was some overlap in the standard errors of the mean likelihoods in some of the model comparisons, suggesting relatively weak support for the model with the greatest statistical fit. for example, in wnv using a training set of 80 % of the sites, the two models with highest statistical fit, sc + csc and sc + egc, had likelihoods of − <dig>  and − <dig> , with standard errors of  <dig>  and  <dig> , respectively . this result underscores the importance of conducting a large number of cross-validation replicates, particularly when assessing demographic models.table  <dig> comparison of molecular clock and demographic models for four empirical data sets: enterovirus a <dig> , west nile virus , rabbit hemorrhagic disease virus , and shigella sonnei


− <dig> 
− <dig> 
− <dig> 

shigella sonnei
− <dig> 
− <dig> 
− <dig> 
− <dig> 

shigella sonnei
− <dig> 
− <dig> 
− <dig> 
− <dig> 

shigella sonnei
− <dig> 
the models correspond to four combinations of clock and demographic models: strict clock , uncorrelated lognormal clock , constant-size coalescent , and exponential-growth coalescent . mean log likelihoods across ten replicates are given for the test set from each data set, using training sets of  <dig> and 80 % of the total alignment length. marginal log likelihoods using stepping-stone sampling are also shown for comparison. values in bold correspond to the highest log likelihood in each case. values in parentheses indicate the standard error around the mean likelihood for ten cross-validation replicates



our analyses under the ucln + ecg demonstrated that ev-a <dig> and wnv display clock-like behavior, whereas rhdv and shigella sonnei have substantial rate variation among lineages. all of the virus data sets displayed evidence of population growth, whereas shigella sonnei appeared to have had a constant population size . this indicates that neither model-selection method has a specific bias towards or against parameter-rich models, at least in these data sets.fig.  <dig> posterior distributions of the coefficient of variation of branch rates and the population growth rate for four empirical data sets: enterovirus a <dig> , west nile virus , rabbit hemorrhagic disease virus , and shigella sonnei. estimates were made using the uncorrelated lognormal clock  and the exponential-growth coalescent . a coefficient of variation of branch rates that approaches zero indicates that evolution has been clock-like. a growth rate including zero indicates that population size has been constant



discussion
the cross-validation method was effective in detecting rate variation among lineages. however, distinguishing between different relaxed-clock models was more difficult. out of the two relaxed-clock models being compared, the ucln was selected in most cases. for the data simulated under the uced model, increasing sequence length appeared to increase the frequency with which the uced was selected. however, our longest sequence alignments contained  <dig>  nt, such that even large amounts of data might be insufficient to distinguish between the ucln and uced models. although previous studies have also described the difficulties in distinguishing between relaxed-clock models  <cit> , in most cases marginal-likelihood estimation using stepping-stone sampling and bayesian model averaging proved accurate  <cit> . in practice, however, the uced has a mode at zero, such that it may be unsuitable for most data sets. an additional factor that might warrant further study is whether using data sets with many taxa improves clock model selection  <cit> .

our simulations demonstrated that cross-validation could detect population size growth over time. however, for data generated under a constant population size, it often selected an exponential growth model, a problem that was not alleviated by using longer sequence data. in contrast, previous studies suggest that using marginal likelihoods is more efficient at detecting both constant and growing population sizes  <cit> . one potential reason for this result is that marginal-likelihood methods are more effective than cross-validation at penalising excessive parameters. however, the egc model has one parameter more  than the csc. if the estimate for this parameter has a mode at, or near, zero, then the inferences from the egc model might be indistinguishable from those using csc. under these circumstances, cross-validation selects these models with similar frequency.

marginal likelihoods and cross-validation selected the same models for two of our four empirical data sets. however, for wnv and for shigella sonnei the two methods selected different models. in both of these data sets, we found very large differences in mean likelihoods using cross-validation for the different models, especially when comparing the ucln + csc and the ucln + egc with either sc + scs or sc + egc . importantly, these differences in likelihoods depended on the size of the training set. as an example, for shigella sonnei, the mean log-likelihoods for sc + scs and sc + egc with a training set of 50 % were thousands of log-likelihood units higher than those for ucln + scs and ucln + egc. in contrast, using a training set size of 80 % resulted in log-likelihood differences of  <dig> log-likelihood units or less between these models. this might occur because a training set of 50 % in these data is not sufficiently informative to estimate the parameters in the more complex models. for this reason, the size of the training set should be selected according to the complexity of the model. if the training set is very small, it will be difficult to estimate a large number of parameters, leading to excessive penalisation for parameter-rich models. in empirical studies it might be helpful to explore different sizes for the test and training sets to ensure that the results are statistically consistent. for example, if the size of the training set is very small, the likelihood of the test set will be extremely low for complex models and with very high variation among replicates. in such a case, increasing the size of the training set might be beneficial. finally, an important consideration of marginal likelihood methods is the additional computational time required. in our empirical data analyses we found that most marginal likelihood estimates required only ten more hours of computational time than our cross-validation replicates with 80 % of the sites . however, the recently developed generalized stepping-stone method has been shown to yield accurate marginal likelihood estimates in a more timely fashion  <cit> .

CONCLUSIONS
our analyses of simulated and empirical data show that cross-validation provides a useful model-selection method for bayesian phylogenetics. although marginal-likelihood methods are more effective in many cases, one potential advantage of cross-validation is that as long as the data are sufficiently informative model choice is not affected by the prior, such that it might be more readily applied than complex hierarchical bayesian models where selecting appropriate priors for all parameters is difficult. further research into cross-validation methods has the potential to improve the reliability of model selection in bayesian phylogenetics.

abbreviations
sc, strict clock; ucln, uncorrelated lognormal clock; uced, uncorrelated exponential clock; csc, constant-size coalescent; egc, exponential growth coalescent; aic, akaike information criterion; bic, bayesian information criterion

additional files
additional files 1: table s <dig>  spreadsheet with computation times in hours for all analyses. for cross-validation analyses we report the mean value over ten cross-validation replicates. for marginal-likelihood calculations we report the computation time of a single analysis. 



