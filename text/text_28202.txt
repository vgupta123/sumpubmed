BACKGROUND
gene duplication has long been recognized as a major driving force in evolution. both the extent of gene duplications in genomes and the theoretical formalization describing the process by which duplicate genes may contribute to genetic novelty by neo-functionalization lead to an intense interest for the subject . the recent discovery of a previously unexpected dynamic of gene family expansion and contraction observed in complete genome sequences has called new attention on the phenomenon of gene duplication  <cit> . moreover, recent studies of gene copy-number polymorphism in various organisms provide evidence of an ongoing mechanism of gene duplication and loss within species  <cit> . the different studies underline that this “revolving door” of gene gain and loss largely contributes to intra and interspecific phenotypic variability  <cit>  and is therefore likely to have played an important role in shaping phenotypic differences among species  <cit> .

analysis of the genomes of arabidopsis, human, mouse and rat revealed that tandemly arrayed duplicates account from 10% to 20% of all genes  <cit> . in addition, the contribution of tandem duplication to gene duplicates ranges from one-third in mammals  <cit>  to almost 70% in caenorhabditis elegans <cit> , highlighting the predominant role that tandem duplication plays in gene duplication. tandem duplication contributes also to the evolution of other classes of functional elements such as exons within genes  <cit>  or rna genes  <cit> . in this respect, the detection of recent tandemly duplicated segments in complete genome sequences is a question of foremost interest.

tandem duplication has been extensively studied at the protein coding gene level  <cit>  or at the much smaller scale of serial repeats , based on local dna similarities  <cit> .

all studies based on protein similarity analysis are naturally biased by the available genome annotation. in addition, such analyses automatically exclude duplicated segments with rna genes or degenerated copies from the scope of the study. despons and colleagues  <cit>  have recently proposed an approach combining protein and dna sequence comparison, enabling to detect degenerated paralogous copies, but the method still relies on an existing annotation and is additionally, as acknowledged by the authors, essentially limited to the analysis of compact genomes. using dna sequence comparison only, eichler and colleagues  <cit>  have significantly contributed to the understanding of dynamics of duplication in primates by studying highly identical duplicated dna fragments greater than 1kb, termed segmental duplications. this latter work is however limited to the study of very recent duplications.

on the other side of the size spectrum, different algorithms have been devised to detect so-called serial repeats at the dna level. initially targeted at short  repeats, these algorithms have been considerably improved, leading to tools such as trf  <cit>  or mreps  <cit>  which are capable detecting short tandem repeats on whole genomes. but, as shown in our experiments, the underlying definition of a serial repeat  is not suitable for detecting large duplications that may contain disrupted similarities and which, despite being close, are far from contiguous.

despite the fundamental role of tandem duplication of large dna fragments in the process of duplication-driven evolution, there is no existing method nor software to detect all identifiable tandemly duplicated segments from a dna sequence. in principle, these tandemly duplicated segments could be any paralogous dna segments that are tightly clustered on a chromosome. we propose the operational definition of tandemly duplicated segments as alignable, in a sense described below, paralogous segments with a minimum length of ℓ and with adjacent copies separated by a maximum distance t .

in this paper, we introduce red tandem, a tandem duplication detection tool that works from the genomic dna sequence of the considered organism. in order to identify tandem duplicated segments, we start from short similar regions  that have been detected by a fast whole genome self-alignment software. these anchors are then chained into larger  segments, similarly to what is done in synteny or segmental duplication detection tools such as dagchainer  <cit>  or osfinder  <cit> , modified to account for the specific properties of tandem duplications. in the next step, we analyse these chains to find tandem regions and an associated duplication unit. this duplication unit is used as a seed to locate further tandem duplications defining what we call a tandem array .

in the first section, we present the formal definition of anchors and chains and the algorithm that enables to detect tandemly duplicated regions and the associated duplication unit. we next apply our method on arabidopsis thaliana and we show that a large number of tandem gene arrays, that can be derived from a cds based family analysis, are detected by red tandem. we analyse how the detection sensitivity varies with the evolutionary distance between genes. finally we discuss the ability of the agnostic approach of red tandem to detect duplications of rna genes, duplications families involving different functional categories such as protein-coding genes together with long non-coding rnas, as well as duplications of unannotated regions.

RESULTS
tandem duplications typically include several copies of the same sequence. in the usual situation, these duplications have been obfuscated by evolution, leaving only local similarities. in this section we show how a specific chaining algorithm  can reconstruct sets of duplicated regions that can be further analyzed to identify tandem arrays and associated duplication units. to test this approach, we apply it on the arabidopsis thaliana genome and analyze its performance on characterized fraction of tandem coding gene duplications. finally, we also explore the non coding fraction of the predicted tandem duplicated regions and show that red is also able to discover duplicated regions involving pseudo-genes, small or long rna genes and other specific regions in the arabidospis thaliana genome.

algorithm
to properly identify tandem arrays and their associated duplication unit, we follow a multiple steps procedure which is succinctly described now and described in more detail in the “methods” section.

in a first step, adjacent sequence similarities are identified. these local similarities are next chained to identify a set of pairwise duplicated regions that could belong to tandem duplications. in a third step, the resulting chains are used to identify regions that could define tandem arrays together with the corresponding duplication unit. in the final step, in each such region, this duplication unit is used as a seed to reconstruct the structure of the complete tandem array.

anchors detection
given an initial dna sequence, the analysis starts with the identification of all local self similarities, called “anchors” inside the sequence. because of the specific situation of sequence self-alignment where self-overla pping alignments should be proscribed , we adapted an alignment program developed by one of the authors  for this purpose. each anchor a =  relates two regions of the genome. the first region a <dig>  is assumed, for simplicity, to be on the forward strand. dotplots offer a simple representation of a set of anchors .

anchors chaining
similarly to what has been done for the reconstruction of homologous regions  <cit>  or whole-genome alignment  <cit> , our aim is to reconstruct duplicated regions as consistently ordered sequences of close anchors. by consistent order, we mean that each of the two sequences of regions defined by the sequence of anchors is either increasing  or decreasing . to characterize close anchors, we use a distance introduced in  <cit>  and defined in the “methods” section.

the usual approach to identify large pairwise duplicated regions is to build a graph whose vertices are the detected anchors and where a directed edge  is created when a and b are consistently ordered and sufficiently close to each other. a score is affected to the nodes and edges, reflecting the alignment score and the physical distances between anchors, and a minimum cost  path in this graph defines the regions sought  <cit> .

by repeatedly extracting shortest paths from this acyclic graph, denoted as g <dig>  one obtains a set of predicted duplicated regions, called chains, with an overall cost defined as the sum of the costs of all its paths.

tandem arrays however present specific properties: they typically contain several close duplicated regions that can not overlap, which means  that the two regions defined by a chain should not overlap and  that for any pair of predicted chains, either their first regions do not overlap or their second regions do not overlap. these conditions are illustrated in figure  <dig> and described in more detail in the “methods” section.

enforcing conditions  and  is difficult, especially because condition  is a global condition on the set of predicted chains and not only on each chain. instead of using the usual process of repeated extraction of shortest chains, we therefore shift to a more sophisticated minimum cost flow based algorithm that will be able to produce a set of k chains that satisfy the constraints above and minimize their overall cost.

to use flows, the previous graph g <dig> is transformed in a transportation network and the problem of identifying a set of chains representing duplicated regions is reformulated into a minimum cost flow problem .

compared to the usual iterated greedy shortest path approach, this approach is able to “reconsider” previous chains and reallocate an anchor that was previously used in a chain to a new chain if this is needed to get an overall optimal cost. it therefore has a global view on the set of predicted chains. by iterating until  and  are satisfied we guarantee that the set of predicted chains are “non-overlapping” chains.

tandem array and duplication unit identification
in order to delineate tandem array regions from the previous set of chains, we build a second graph g <dig> whose vertices are the predicted chains and remaining anchors and where two vertices are connected iff the associated regions of the two vertices on the genome overlap sufficiently on one of their sub-regions, i.e. the two chains/anchors share at least one sub-region.

every connected component of this graph collect regions that share paralogous relationship and defines therefore a predicted tandem array region. the actual predicted tandem region is obtained by extending the minimum and maximum coordinates inside the connected component by a small margin. every chain inside the connected component is a duplication unit candidate and the longest of all minimum cost chains in the array is used to identify the reference duplication unit .

final reconstruction
in order to increase sensitivity, the previously identified duplication unit is used as the query sequence in a tblastx  <cit>  search against the tandem array region. all the candidate regions that align with the duplication unit on a sufficient length are kept as additional occurrences of the duplication unit and define the output of the prediction by the global “red tandem” approach.

testing
the evaluation of the proposed method was performed using the arabidopsis thaliana genome sequence as a test case. this genome and its internal gene duplications have been extensively studied providing an excellent standard for evaluation  <cit> . we used ncbi build  <dig> , preprocessed using the low complexity filter dust , anchors are produced using our own genome wide aligner, glint , using standard alignment scoring scheme . our aim is to test if tandem duplications identified by similarities between protein sequences can be recovered by red tandem using the dna sequence only. the first step therefore involves the construction of a reference set of tandem gene arrays against which the tandem duplications detected by red will be compared.

creating a reference set of tandem gene arrays
in order to construct a reference set of tandem gene arrays we proceed essentially like other published methods  <cit> . considering the tair <dig> version of the arabidopsis thaliana genome annotation, for each coding gene of length >  <dig> bp , the longest annotated transcript is selected as the reference transcript. an all-against-all blastp comparison is conducted on the corresponding set of proteins. two genes are considered to share a tandem paralogous relationship  if they are less than t  apart and exhibit a blastp hit with an e-value of at most 10− <dig> covering at least 70% of both sequences. these tandem paralogous relationships between genes are used in turn as anchors to create an overlap graph following the method described in “methods”. each connected component of this graph defines a tandem duplication array with genes as elementary duplication units. these connected components are essentially equivalent to the tga defined in  <cit> , with the difference that the notion of spacer genes between duplicated copies is replaced here by the physical distance threshold of t between copies to enable the comparison with our annotation-free approach.

these reference tandem duplication arrays will be called tandem gene arrays , and the associated duplication unit tandem gene unit . conversely, the regions and units detected by red tandem from dna alone will be respectively denoted as tandem arrays , and associated tandem unit .

evaluation criteria
in our analysis, we consider that a tgu is detected if it is overlapped on at least 70% of its length by a red tu. for ta and tga, the criteria is more stringent and requires that the tga is overlapped by more than 70% by the ta and that at least one of the tgu in the tga is detected as a tu.

scanning arabidopsis thaliana genome
from  <dig>  dna anchors, red tandem built  <dig>  chains with a mean of  <dig>  anchors per chain, underlining the importance of chaining here. these chains define  <dig>  tandem array  covering  <dig> % of the a. thaliana genome, made up of  <dig>  tandem unit  covering  <dig> % of the sequenced genome. this is consistent with the estimated 10% of tandem gene duplications in the arabidopsis genome  <cit> .

comparison with the reference set: sensibility
we compared the results of red with the reference set to evaluate its sensitivity. the sensitivity is defined as the percentage of elements of the reference set which are detected by predictions of red tandem. results are given in table  <dig>  overall, with  <dig> % of the genome covered by tus, ≃ 68% of all tgus are detected.

the table below gives the total number of tga and tgu and the corresponding number and fraction of detected regions. a region is considered as detected if it is both overlapped by a ta on more than 70% of its length and one of its tgu has been detected. more than two thirds of all tgas are detected. the fact that all tgus cannot be detected is not surprising given that the oldest duplications cannot be detected at the dna level.

since it relies only on dna information, without annotations, the capacity of red tandem to detect tandem gene array  and tandem gene unit  is influenced by the age of the duplication. the later has been measured using ds  on tandem duplicated paralogous genes estimated using the method of yang-nielsen  <cit>  as implemented in the paml program  <cit> . figure  <dig> shows how duplication age influences the detection power of our method. with a ds >  <dig>  our algorithm hardly detects duplication unit. however, more than ≃ 79% of pairs of tgus with ds ≤  <dig> are detected . figure  <dig> shows the influence of family size on sensitivity. most of the missing tgas correspond to arrays with only two duplication units. indeed, the score of such tgas is shadowed by the extra bonus given to highly duplicated units . these results however show that red tandem can effectively detect tandem duplicated regions, at least when traces of the duplication are still observable at the dna level. to give more flesh to these numbers, figure  <dig> gives a typical example of a perfectly detected tga with six tus.

the results we have obtained on a. thaliana show that red tandem, without relying on a predicted proteome, is able to correctly detect a large fraction of reference tandem duplicated genes provided they are sufficiently close from an evolutionary point of view .

the real added value of red tandem is precisely its ability to perform its analyzes purely from dna. although it is restricted to “recent” duplications, red tandem has the ability to identify duplicated regions which are implicitly censored by pure proteome based approaches, therefore helping to analyze the evolutionary history of the region. the only existing software that we know that provides related capabilities is  <cit>  which uses blastx comparison in the immediate vicinity of every gene to identify possible pseudo-genes and gene relics. this approach, while still depending on an annotation, is, as acknowledged by the authors, essentially restricted to compact  genomes. because it relies on a direct comparison of the genome vs. itself that can be achieved using fast whole genome index based software, red tandem is not restricted to the analysis of compact genomes. serial repeat finders such as trf or mreps are also able to deal directly with dna sequences, including large genomic sequences, but are instead restricted by the underlying definition of serial repeats . to verify this, we applied both trf  and mreps  to the a. thaliana genome. trf and mreps identified respectively  <dig> and  <dig> serial repeats containing duplication units with a size above 500 bp , compared to the  <dig>  ta identified by red tandem. by chaining local similarities, red tandem is instead able to reconstruct large duplicated regions that may be interrupted by local loss of similarities.

among the  <dig>  tu predicted by red tandem, around half of them correspond to protein genes. this leaves a large number of tus essentially unknown in nature. to try to better understand the contents of these extra tus, we compared them to the tair annotation of the genome  to evaluate if other annotated elements could be present in tus. this comparison is presented in table  <dig>  we observe that tus are more specifically enriched in pseudo-genes and pre-trna genes . to give some flesh to this table, we now give illustrative examples of various situations involving either non coding or unannotated regions.

the different types of annotated elements detected by tus. the first column gives the number of annotated elements of each type in tair <dig>  the second column gives the number of such element that are covered by tus. the detected percentage of regions is indicated in the last column. the predicted tus are enriched in pseudo-genes and pre-trna which often appear in clusters.

pseudogenization
it has been widely accepted, for a long time, that pseudogenization is the most probable fate for duplicate coding gene copies, leading ultimately to gene relics  <cit> . in figure  <dig>  we give an example of a detected duplicated region containing annotated genes and one pseudo-gene. here, the first duplicated region contains a complete gene and the partial 3′ extremity of a coding gene . if the complete gene still appears as a gene in the second copy, the partial gene has, unsurprisingly, turned into the pseudo-gene at3g <dig> 

gene fusion
in figure  <dig>  a ta with six tus is represented. four tus among the six cover one coding gene each. these four genes are annotated as galactose oxidase/kelch repeat proteins. the two remaining tus do not cover  any functional element. instead, they appear inside a single protein coding genes which seems to be the result of a gene fusion. this gene is also annotated as a galactose oxidase/kelch repeat protein. existing evidence  seems to indicate that this is a real fusion and not the result of a mis-annotation.

rna clusters
a famous tandem duplication in the a. thaliana genome contains  <dig> trna genes in  <dig> tandem repetitions of a sequence containing three trnas . this duplication is almost perfectly detected by red with  <dig> tu detected . red actually detects several other rna tandem duplications. as an example, we provide in figure  <dig> an example of a detected tandem duplication with three copies of a pair of mirnas.

lncrna and cds
the rich repertoire of long non coding rnas has only been recently unveiled and little is known about their origin. existing scenarios include both origination from scratch and transformation of protein genes into lncrna  <cit> . the ta represented in figure  <dig> shows two tus matching respectively one lncrna and one protein suggesting a possible protein-coding gene origin for this lncrna gene. according to  <cit> , such a metamorphosis has already been documented in mammals  and drosophilia. this region could be an example of a similar transformation in plants.

orphan tus and tas
these examples illustrate the fact that red tandem ability to predict tandem duplications extends beyond pure tandem protein gene arrays. still, tus remain which do not cover any annotated element in a. thaliana genome. among the  <dig>  tus predicted by red,  <dig>  are orphan tus. this is expected since red tandem is just targeted at detecting dna level tandem duplications. however, when such orphan tus appear in a ta, other tus in the same ta may provide extra information. some of these orphan tus may be of interest for improving the existing genome annotation.

we note in addition that red tandem is also able to detect intertwined tgas and to separate the duplication units belonging to the different families. 

finally, around a quarter  of all the tas predicted by red tandem are orphan tas, that do not contain a single tu that covers or is covered by at least one tair <dig> annotation. these orphan tas look genuinely different from the rest of all tas in terms of tu size and number . the largest ta detected by red  appears on chromosome 1:15088006 −  <dig>  interestingly, this region has been recently identified as a cnv hotspot <cit> .

this table compares orphan tas with other tas in terms of their size . orphan tas tend have less and smaller tus than the remaining tas.

this section gives just a short extract of all detected tas. a full list of detected tas, with associated tus and tair <dig> annotation for the a. thaliana genome with direct links to the corresponding region on gramene web site is available from http://narcisse.toulouse.inra.fr/redtandem.

availability and requirements
the full packaged software from anchor detection to final ta/tu prediction is distributed under a cecill open-source licence at http://narcisse.toulouse.inra.fr/redtandem. the software archive is also available as additional file  <dig>  you can either download a set of executable linux  <dig> bits binaries wrapped in a perl script or the set of sources. red tandem is implemented in c++ and its execution time on arabidopsis thaliana genome is around 4 hours on a single core computer. its execution requires the availability of ncbi blast and a perl interpreter with the bioperl package.

CONCLUSIONS
in this paper we have introduced red tandem, which, in our knowledge, is the first software targeted at predicting large partially conserved tandem duplications directly from dna. this allows red tandem to work directly on unannotated genomes. the analysis of red tandem output and examples show that a pure dna based analysis of tandem duplications unveils a large variety of phenomenons that cannot be revealed by usual protein based analysis. this uncensored vision of tandem duplication should be of great interest to address specific questions on duplication driven genome evolution such as the evolutionary fate of duplicated segments regarding their functional content  <cit> .

from a pure evolutionary point of view, the tandem arrays and tandem units predicted by red tandem and the usual protein gene based analysis  <cit>  complement each other nicely. while a protein gene based analysis allows to identify distant evolutionary relationships, it implicitly censors all non coding elements that may be involved in the evolutionary process . conversely, we have shown that red tandem is able to reliably detect relatively recent tandem duplications  and can uncover a variety of duplications involving coding and non coding regions . it is therefore useful even if a current genome annotation exists and may help identify spurious or missing annotated elements. more importantly, it offers unprecedented direct raw access to tandem duplicated regions, directly bringing to light a variety of situations that were inaccessible in protein gene based approaches.

