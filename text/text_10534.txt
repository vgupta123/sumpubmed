BACKGROUND
changes in the overall metabolite composition of living cells  reflect a key end point in gene expression and make a major contribution to organism phenotype  <cit> . although, no single analytical platform can offer a fully comprehensive survey of the chemical diversity representing the metabolome, continuous improvements in mass spectrometry  instrumentation have allowed development of relatively standardised metabolite profiling or fingerprinting procedures  <cit> . a fundamental principle of mass spectrometry is the representation of metabolite features in any biological matrix by measurement of the spectrum of signals reflecting the mass to charge ratios  of their ionisation products. one advantage of ms over alternative spectroscopic methods such as nuclear magnetic resonance  and fourier transform infrared  is the opportunity to putatively annotate directly a spectral component by virtue of its atomic mass. in the context of a metabolomics experiment these 'first pass' annotations may be used to develop hypotheses relating to metabolite identity which are then tested by subsequent, more targeted, analytical chemistry methods. traditional hyphenated ms profiling approaches provide simultaneous detection and quantification of discrete metabolite-derived peaks after chromatographic separation. in gas chromatography ms  a couple of hundred well resolved metabolite peaks are identified where possible by matching their positively charged ion spectrum  and column retention time to those of known standards  <cit> . gc-ms methods are well established and robust but are limited to analysis only of volatile metabolites. although derivatisation can increase the volatility of a wide range of metabolite classes such chemical modification further increases the complexity of any annotation process based on atomic mass.

alternative profiling methods utilising liquid chromatography coupled to mass spectrometry  provide sensitive tools for the analysis of a wider range of metabolites with higher polarity, lower volatility and much larger mass range without a need for derivatisation  <cit> . resolved metabolite peaks can only be efficiently ionised when outside of the liquid phase under atmospheric pressure. typical approaches include atmospheric pressure chemical ionisation  and electrospray ionisation . in contrast to electron impact, both methods allow 'soft' ionisation with little fragmentation in which a major product may be a pseudo-molecular ion comprising the protonated  or de-protonated  parent molecule.

peak detection and particularly spectral deconvolution in gc-ms and lc-ms are both technically challenging, time-consuming and very difficult to automate; lc-ms particularly has been hampered by poor analyte peak resolution and retention time variability which confound metabolite peak alignment  <cit> . as a consequence, recent approaches to lc-ms profiling have concentrated on the non-targeted quantification of all detected ionisation products above a pre-set noise threshold which are compiled subsequently as several thousand un-annotated variables  <cit> . the variables in this high dimensional data consist simply of an ion mass and its retention time. such data tables will contain much redundancy as the data acquisition rate of most instruments will be sufficient to generate at least 3â€“ <dig> scans across each eluting peak. in addition, even with the extra resolving power of ultra high pressure liquid chromatography  a large number of peaks will still overlap or even co-elute in many regions of the chromatogram which demands the use of powerful signal alignment software for data pre-processing.

an alternative approach to lc-ms profiling is to generate a metabolite fingerprint representation without using the chromatographic dimension in which data variables are simply the detected mass values  <cit> . in such approaches  <cit>  the sample may be dissolved in an appropriate solvent and injected directly into the ion source  or infused as a 'plug' flow using a hplc system without a chromatography column . data representations may take two forms depending mainly on the accuracy and subsequent resolving power  of the system mass analyser. in nominal mass fingerprinting methods the intensities of all masses from all scans are integrated within pre-defined ranges . linear ion traps with quadrupole  detectors are extremely robust and offer rapid scanning over large m/z ranges. however, as full-scan mass resolution is often less than  <dig> all signals are binned to the nearest nominal mass value from around m/z  <dig> up to as high as m/z  <dig>  depending on instrument; under these circumstances metabolites are considered to be mono-isotopic and each mass bin could obviously contain signals derived from several metabolites. despite these limitations nominal mass fingerprinting methods have attracted considerable interest as a first pass investigation tool as data pre-processing is quick and trivial with minimal likelihood of error and with a short cycle time  they are suitable for experimental designs which require a high throughput of samples  <cit> . time-of-flight  and hybrid q-tof mass analysers exhibit an average resolving power as high as  <dig>  which, with internal calibration, may be sufficient to allow binning of signals in finer mass ranges . this level of resolution however is not sufficient to distinguish between a large proportion of metabolites of different elemental composition which remain effectively isobaric at the maximum mass resolution achievable. with the advent of ultra-high accuracy mass analyzers such as the orbitrap  and fourier transform ion cyclotron resonance  analyzer  this latter problem is greatly reduced  <cit> . particularly using ft-icr-ms instruments there is the opportunity to generate an accurate mass fingerprint  of an infused sample extract  <cit> . in such data representations mass 'peaks' are detected in the raw data and the centroid mass intensity calculated. the resolving power and sensitivity of these ultra-high accuracy mass analyzers is such that metabolite signals from molecules containing naturally abundant elemental isotopes  are visible in the data  <cit> .

the past few years has witnessed a rapid increase in the number of publications describing experiments using particularly electrospray ionisation mass spectrometry  profiling or fingerprinting at a range of mass accuracies. this activity has been accompanied by the recognition that the majority of m/z variables in most complex biological matrices cannot be matched unambiguously to metabolites of identical elemental composition found in publicly accessible databases  <cit> . with the ultra-high mass accuracy achievable using ft-icr-ms methodology  <cit>  this might seem surprising for metabolites with a mass <  <dig> da for which the number of isobaric molecules based on calculated elemental composition should be very limited. several factors contribute to this problem. in the simplest situation, given that many natural metabolites  remain to be structurally identified, the relevant molecules may simply not be present in current databases. a more complex issue stems from the fact that all metabolites have a chance of containing one or more natural isotopes  <cit>  of constituent atoms ; metabolite signals thus are rarely present as a single mono-isotopic peak and the spectral isotope distributions often results in measured masses of significant intensity that by chance are undistinguishable  from completely unrelated chemistry  <cit> . a final factor relates to the diversity of potential ionisation products generated in the ion source in addition to parental pseudo-molecular ions . thus, in both fingerprinting and profiling approaches it is common to find adducts with either sample matrix components  or mobile phase solvents . additionally, although esi is traditionally considered a 'soft' ionisation method a number of more sensitive metabolites will rearrange and fragment with neutral loss of common moieties such as water from a hydroxyl group 1+ or ammonia from an amine group 1+ or formate from a carboxyl group 1+. clearly, it is possible also that a range of potential ionisation products will contain various combinations of isotopes, adducts and neutral losses. finally, ionisation products also can carry more than one charge  or can, through non-covalent interactions, produce stable molecular clusters, for example dimers, in which only one component is charged . the potential to form different ionisation products will be dependent on the structure and physical properties of individual metabolites.

it can be concluded that a key aspect of any variable annotation strategy is to assess the relationships between signals and to base putative annotations on models that best fit all of the data. the presence of isotopic atoms and either loss, or gain, of selected chemical moieties all afford specific changes in accurate mass which mean that the exact mathematical relationships between detected ions are informative. natural isotope abundances in metabolites reflect the percentages at which isotopes of an element occur naturally in the environment. thus analysis of isotope relative abundance patterns provide a useful approach to 'filter' unlikely annotations based on molecular formulae calculated from accurate mass measurements  <cit> . annotation strategies have been reported recently incorporating algorithms interrogating some, but not all, of these atomic mass mathematical relationships  <cit> . in most instances the adopted strategy centred on an analysis of the full spectrum of aligned peaks resolved at ultra-high mass accuracy in the biological matrices under comparison. a less computationally intensive strategy more suitable for high throughput experiments is to focus the annotation exercise on m/z signals which make significant contributions to models explaining the metabolome differences between two biologically different sample classes  <cit> . in nominal mass metabolite fingerprint data  <cit>  such experiments make the simple assumption that 'explanatory' metabolites will be represented by several mathematically-related ionisation products  which additionally exhibit tight co-variance in a simple correlation analysis; where lc-ms profiling is used ionisation products related to the same metabolite should additionally be found at the same retention time  <cit> . similar approaches are clearly possible using accurate mass data  <cit> .

it is time consuming and often computationally intensive to pre-process lc-ms profile/fingerprint data to a level where the researcher is absolutely confident of understanding the origin of any ionisation product . this is a particular problem when high-throughput is required or for exploratory analyses of a new biological matrix. an alternative approach described here is the use of a database strategy that will allow searching based on all potential ionisation products that may be predicted to form during electrospray ionisation.

searching for likely annotation candidates based on accurate mass information in publicly accessible databases is in itself time consuming as individual database coverage of natural chemistry varies and so a comprehensive search requires query of several. unfortunately, with few exceptions, databases with appropriate metabolite mass information can contain much redundancy, resources for curation are often limited  and some of the entries relate to ionic states, often from interactions with salts. to overcome some of these problems we have developed mzeddb  <cit>  a database which uses an archive in a common format of all metabolite 'structures' derived from several widely used and publicly accessible databases. the value of such an approach to avoid ontology problems was recognised recently by a consortium of yeast researchers  <cit> . using a set of 'rules' derived from structural information and physical properties  mzeddb will generate a list of potential adducts and neutral loss fragments that are likely to form for each structure and calculates on the fly the accurate mass of every potential ionisation product which provide targets for searches based on accurate mass. starting with a list of m/z signals mzeddb supports a range of manual or semi-automated annotation strategies based on either m/z mass or predicted molecular formulae at a range of mass resolutions. in the present article we describe the development of mzeddb and illustrate several typical applications relating to annotation of esi-ms data which take into account both predicted and measured ionisation behaviour.

RESULTS
developing mzeddb construction strategy
a major objective of mzeddb was to develop an annotation tool capable of calculating the accurate mass of all likely ionisation products derived from a comprehensive list of natural chemistry represented in a range of web-accessible databases. a first step in this process was to analyse the content of information fields with value for m/z annotation and develop a strategy for conversion of the molecular information from targeted repositories into a common format. once this had been achieved lists could be compiled of all database entries representing molecules with identical structures . a preliminary web-search identified many well-populated metabolite databases ranging from chemical class specific , species-specific  and multi-species databases  containing information related to measured chemistry. a subset of databases with links to genome sequence data, metabolic pathway representations and in some cases literature provide further information which help annotation decisions related to known or predicted natural chemistry . finally there exist very large repositories, such as pubchem  <cit>  and chemspider  <cit> , which contain information on large numbers of metabolites which are not necessarily all of natural origin. detailed examination revealed that the data fields useful for signal annotation could be divided broadly into four categories: origin, analytical information, physical properties and metabolite relationships . all databases had a standard molecular formula for each metabolite entry and the most common structural information sufficient to discriminate between the majority of molecules was clearly a simplified molecular input line entry system representation , which could also be generated from the more complex iupac international chemical identifier  or an mdl molfile.

h = human metabolome database 

mt = moto 

k = kegg 

p = pubchem 

ch = chebi 

cy = metacyc ,

mb = massbank 

mc = metacrop 

ml = metlin 

cs = chemspider 

kp = knapsack 

* these data are often predicted from structural information.

information on atomic mass was much more varied ; for example databases such as metacyc  did not provide accurate mass data. accurate mass information was presented in different databases as either the average molecular weight or mono-isotopic molecular weight, ranging from  <dig> to  <dig> decimal places. annotation success increases more or less linearly with mass accuracy  <cit> ; with oribitrap and ft-icr-ms capable of operating at or above  <dig>  mass resolution then mono-isotopic mass information down to 4â€“ <dig> decimal places will be required to optimise annotation success. additionally, in several databases  metabolite information was not always represented as a single neutral charged molecule which will potentially complicate most automated annotation procedures which assume a signal is derived from a single molecular entity composed of pre-selected common atoms ; an example is shown in figure 1b of choline which is represented in ionic form on its own, or together with separate common or more exotic salts. based on this analysis it was decided that a comprehensive coverage of natural metabolites could be achieved by downloading molecular information from the targeted repositories and then processing  all chemical entries to remove salts  and to remove molecules with less than  <dig> atoms or exotic elements. when possible all charged entities were converted to neutral compounds by addition or removal of hydrogen. the processed molecular information was then represented as smiles, each of which had a unique identifier code in mzeddb and a hyperlink to the entry in the database of origin.

development of 'rules' to link metabolite structures represented in mzeddb to potential ionisation products
smiles, a unique id and hyperlinks are the only information permanently stored in mzeddb for each metabolite entry accessed from external databases. smiles can be used to generate a structural representation of the metabolite in question using the java applet jmol if required. automated analysis of smiles following a set of simple 'rules' can be used to detect the presence of specific moieties that are likely to effect potential ionisation behaviour; for example the possession of nh <dig> or cooh groups which could be lost as ammonia or formate respectively, or the presence, for example, of hydrogen bond acceptor or donor groups which could affect adduct formation. additionally, the smiles can be used to create a molecular formula from which an accurate monoisotopic accurate mass can be calculated.

using information derived from 'rules' concerning likely ionisation behaviour, an accurate monoisotopic mass can be calculated on the fly for all putative m/z signals  that potentially represent the molecule in question in any metabolite fingerprint or profile. for the whole range of potential ionisation products calculations are based on the formula

  

in which the m/z of the ionisation product  of a metabolite with a specific mass  relates to the number of molecules involved in the ionisation product  divided by its overall charge  plus the mass, including charge and electrons, to be added  to get the final m/zip . the add functions clearly differ depending on the particular ionisation products and a number of mass calculation rules for common adducts and neutral losses are displayed in table  <dig>  mzeddb is fully flexible in that the ionisation product calculations  <cit>  can be extended for example if a new solvent is used and solvent adducts are expected, or if samples are likely to contain high levels of unusual salts  or unusual amounts of specific molecules able to form adducts. these lists of calculated accurate masses will provide targets for queries in experiments to annotate m/z signals.

addat: formula of the atoms to be added to the molecular formula of one m.

remat: formula of the atoms to be removed to the molecular formula of one m.

addex: formula of the atoms to be removed to obtain the final ip molecular formula

.

remex: formula of the atoms to be removed to obtain the final ip molecular formula

.

nelec: number of electron to be added when calculating isotopic patterns .

rule: set of rules to be applied on one m.

nacc: number of h-bond acceptor in m.

noh: number of -oh groups in m.

ncoo: number of -coo- groups in m.

naci: number of acidic h in m.

nch: number of charges in m.

ndon: number of h-bond donor in m.

ncooh: number of -cooh groups in m.

nnhh: number of -nh <dig> groups in m.

nbas: number of basic o- in m.

pmzedbd architecture and functionalities
the basic architecture of mzeddb is illustrated in figure  <dig>  the metabolite search function can be used to search mzeddb for entries with information in linked repositories related to a specific metabolite name/synonym or a molecular formula or mass  of an uncharged metabolite. for example, molecular formulae generated by instrument software can be used for direct query of mzeddb, which provides links to a range of external databases to investigate further details on potential annotations. alternatively, the mzeddb mf generator offers the opportunity to predict the likely molecular formula of any accurate mass  <cit>  whilst taking into account the fact that many signals may in fact be adducts, isotopes or neutral loss fragments of a parent molecule. of more value for m/z signal annotation in accurate mass esi-ms data is the putative ionisation product  function. searches can be restricted to one, several or all of the external data repositories. either nominal mass information  or accurate mass information  can be used to query mzeddb for putative ionisation products  derived from known metabolites. complex queries involving lists of discriminatory masses from data mining experiments  or processed signals from ft-icr-ms analysis of an entire biological matrix  can be automated in r using the r < - > mzeddb function.

parameterisation of mzeddb searches on the basis of potential ionisation behaviour
the parameterisation of mzeddb searches by selection of different pips has a significant effect on the outcome of the annotation exercise. for example table  <dig> illustrates a typical result when attempts are made to annotate  <dig> accurate mass signals that were highly ranked, using the random forest decision tree algorithm  <cit> , for discrimination between healthy and infected leaves in an interaction between the model grass brachypodium distachyon and the rice blast fungal pathogen  <cit> . searching only for 1+ signals provides potential annotations only for  <dig> of the  <dig> ions at <  <dig> ppm  <cit> , whereas searching for an increasingly diverse range of potential ionisation products provides a small number of hits in mzeddb for all but one of the selected signals . the potential identity of metabolites matching the measured exact mass signals are also shown in table  <dig>  together with their theoretical calculated monoisotopic accurate mass. using the default setting for potential adducts/neutral losses there are two potential ionisation products  with masses of  <dig> ; as ammonium adducts are generally extremely rare in this matrix  it is likely that the 1+ product is correct. the 1+ suggestion at  <dig> ppm for m/z  <dig>  is phosphoglycolohydroxamate which has a calculated monoisotopic mass of  <dig> , whereas a salt adduct  of aspartic acid or 2-hydroxysuccinamate are actually exact matches, and indeed much more common metabolites. a sodium adduct of proline betaine is an exact match for m/z  <dig>  and as it is a naturally charged molecule it will almost certainly predominantly be found as a salt adduct. several isobaric metabolites are suggested for m/z  <dig>  when additional adducts were queried after initial annotation attempts using default pips found no matches. the importance of considering that major ionisation products could represent adducts or isotopes is highlighted further in table  <dig> where the mathematical relationships between all ft-icr-ms signals in several biological matrices are examined. in spectra derived from biological tissues such as fish liver and human urine greater than 40% of the routinely measured m/z signals are likely to be common salt adducts or isotopes. the pre-analysis of a biological matrix can thus help to refine annotation exercises using mzeddb by including only adducts found to be prevalent in the specific matrix. in line with this ethos the mzeddb adduct manipulator function allows the investigators to expand the generation of possible adducts for a mzeddb entry or a given molecular formula , with or without applying adduct formation rules. the reverse transformation  can also be performed so that given the molecular formula of a potential ionisation product, all possible formulae of the parent compound can be enumerated.

target m/z
4-methylene-l-glutamine; 1+ m/z  <dig> :
2-aminomuconate semialdehyde
or gentianaine or 6-oxo-
phosphoglycolo-hydroxamate;
1+ m/z  <dig> :
masses highlighted in bold represent perfect accurate mass matches.

* alternatively, the pips selected can reflect prior knowledge of the biological matrix and/or hplc solvent as in table  <dig> 

ideally, mzeddb should be customised intelligently by selection of a subset of pips known to be abundant in the matrix under study and searches constrained to databases representing the organism in question. in circumstances where new biological matrices are investigated it may be helpful initially to use the mzeddb default settings in which three parameterisation boxes are automatically 'checked'  and a search of all database entries is activated from the drop down menu. if negative ion data is under investigation then adducts default selection should be changed to negative mode. it may be helpful to change the default mass accuracy of  <dig> ppm to  <dig> ppm if accurate mass data from time-of-flight  or hybrid q-tof instruments is used. if large numbers of annotation suggestions are returned then searches can be customised initially by restricting to entries in specific external databases by selecting one or more  from the dropdown menu. further reduction in numbers of annotation suggestions can be achieved by 'unchecking' the default selection boxes and then selecting a customised list of adducts from the pull down menu. typically, in positive ion data selected adducts would include 1+, 1+, 1+ and + and in negative ion data 1-, 1-, 1- and 1- and 1-. customisation could be extended sequentially as desired to include less common neutral losses , ion clusters  or ions with multiple charges.

guiding m/z annotation decisions by examination of m/z signal relationships
signals derived from the same parent metabolite will not only exhibit strict mathematical relationships, but, when two relatively similar matrices are compared, the behaviour of related ions should also be correlated in terms of their intensity relationships. the left hand panel of figure  <dig> shows a ranked list of the top  'explanatory' positive ion m/z signals discriminating healthy from infected brachypodium distachyon leaves  <dig> hours after infection with the rice blast fungus  <cit> . a hierarchical cluster analysis revealed that many of the signals fell into small clusters  of highly correlated m/z . a simple calculation of the accurate mass differences between individual pairs of correlated signals indicates their likely relationships allowing any annotation suggestions to focus on potentially the correct ionisation product. for example, annotation of signals present in cluster  <dig> should focus on 1+ or 1+ adducts which are likely to be derived from proline betaine . notably the potential ionisation products with masses of  <dig>  and  <dig> , which are both predicted to be isotopes, had no matches in mzeddb  and so would have been uninformative if pursued further.

mass spectrometers capable of high accurate mass measurement often have instrument software dedicated to the identification of molecular isotopes and common adducts in spectra. in most cases only single, simple relationships  are searched for. in addition to a standard isotope ratio calculator as part of mzeddb development we have developed an 'adduct calculator'  which may be tailored to search for masses linked to any number of combinations of adducts, isotopes and neutral losses  <cit> . using pre-determined  thresholds arithmetically related signals within a single biological matrix can be tentatively placed into clusters that are potentially all derived from a single parent molecule. figure 4a demonstrates a typical predicted cluster of mathematically related ions in the full matrix of signals derived from ft-icr-ms analysis of the model grass brachypodium distachyon and the rice blast fungal pathogen  <cit> . in this instance the cluster centres on m/z  <dig>  which is predicted to be a potassium adduct of m/z  <dig> . mzeddb can be used to query the likelihood that the m/z species highlighted in this cluster of signals are predicted to be derived from a single metabolite based on the pip 'rules' used to construct the database. figure 4b shows the output of a pip search  for m/z  <dig>  in which two salt adducts  as well as a neutral loss of water  are predicted to be possible in addition to the parental pseudo-ion . further investigation using the isotope calculator confirmed that signals m/z  <dig>  and m/z  <dig>   had the highest probability of being isotopes of m/z  <dig>  and additionally were present at the correct relative intensities . a pip search of all databases used to construct mzeddb with the molecular formula c5h11kno <dig> gave  <dig> entries corresponding to  <dig> metabolites; restriction of the database searches to just grass potentially annotated this cluster of signals as being derived from either betaine or valine .

CONCLUSIONS
in high throughput lc-ms fingerprinting/profiling techniques utilising electrospray ionisation  it is a common precaution to use analytical instruments at lower than maximal mass resolution to avoid problems with data alignment  <cit> . as a result, m/z annotation suggestions may often include a large number of structurally diverse but effectively isobaric candidates when only parental pseudo-ions  are considered as ionisation products. although recent papers have stressed the importance of recognising isotopes to avoid miss-annotation of m/z signals in accurate mass lc-ms data  <cit>  the present paper shows clearly that ionisation products other than parental pseudo-ions in reality can account for upwards of 40% of the signals in many accurate mass spectra. against this finding it is unsurprising that many accurate mass m/z signals lack annotation 'hits' if structures other than parental pseudo-ions are not included in the searchable databases. thus we conclude that annotation decisions can be usefully guided by both determining from the outset whether any signal in question is actually an adduct, isotope or neutral loss fragment or indeed any combination of all three. takahashi et al.  <cit>  report the ability to modify a search of the species-specific knapsack database dependent upon the presence of sodium, potassium or ammonium adduct ions derived from the solvent used for sample preparation. other researchers have downloaded the general metabolite database kegg ligand and calculated the exact mass of  <dig> possible adduct ions for each entry to provide query targets in a customised database  <cit> . mzeddb consolidates and expands on this strategy by harvesting smiles and calculating the accurate mass of a much more comprehensive list of metabolites from a range of databases, as well as including hyperlinks to rapidly access detailed information from entries in the original databases. by restricting mzeddb searches to entries derived from only a selected number of the original databases m/z annotations can be refined in a species specific context. an additional advantage of mzeddb centres on the ability to extend annotation searches to include a much larger range of adducts, neutral loss fragments and clusters by implementation  of a simple set of potential ionisation product 'rules' which effectively filter searches to exclude unlikely candidates based on smiles information and which can be customised in line with any prior knowledge concerning the matrix under analysis . ultimately, metabolite identity assignment is crucial to derive biological meaning from metabolome modelling experiments and thus data annotation tools such as mzeddb which allow more intelligent searching need to be expanded to cover more comprehensively a wider range of natural chemistry and take into account the characteristics of new biological matrices. for example, to improve the analysis of human urine samples it is anticipated that future implementations of mzeddb will be extended to include any common biotransformations of parent metabolites  in attempts to link ionisation products to original metabolites.

