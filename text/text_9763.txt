BACKGROUND
untargeted profiling of small molecule metabolites using mass spectrometry has the potential to aid in the functional annotation of genomes. comprehensive metabolite identification in untargeted metabolomics experiments would greatly improve downstream analyses, including metabolic network reconstruction  <cit>  and metabolomics-aided genome annotation  <cit> . specifically, detection of a compendium of metabolites in given organisms or communities can improve confidence in pathway-extension or hole-filing for sparsely annotated pathways  <cit> . in this manner, metabolomics provides an orthogonal resource that can complement sequence homology-based methods of genome annotation.

identification of metabolites in untargeted mass spectrometry-based metabolomics using retention time, mass, and fragmentation pattern information remains a challenge  <cit> , and validation of possible identifications by comparison to commercially available chemical standards is only possible for a subset of cases  <cit> . de novo identification of metabolites from spectral features or fragmentation  spectra is a tedious process and is currently not reliably scalable to large experiments  <cit> . however, the identification of a metabolite's chemical formula is a more tractable challenge, and formula assignment provides partial information about the identity of the observed metabolite. typically, mass alone is not sufficient to specify the chemical formula  <cit> .

the most common approach begins with combinatorial generation of possible chemical formulae that might correspond to a detected mass spectral feature. the astronomical number of possible formulae means that heuristic limitations are required to guide this combinatorial search. the most common restriction is to limit the elements that might comprise a detected ion to only those that are most biologically relevant: carbon, hydrogen, nitrogen, oxygen, sulfur, and phosphorus. thus, formula generators must explore all possible formulae of the form cahbncoxsypz, which spans a six dimensional space, where the dimensions are a, b, c, x, y, and z. for small molecule metabolites, maximal values for these dimensions might be close to  <dig> carbons and hydrogens, and lesser numbers of heteroatoms , which still allows for a search space of  <dig> , <dig> possible formulae.

further heuristic restrictions, for example based valence requirements, have been used in some formula generating algorithms  <cit> . relative isotope abundance patterns are reproducible and can be used to constrain likely chemical formula  <cit> . however, even when using restricted chemical formulae and isotopic data, the degeneracy around a mass value can still be high. a conceptual way to understand this point is to view mass as a single-dimensional projection of the six dimensional chemical space. other information embedded in mass spectral data can serve as non-mass-based criteria to restrict the range of possible chemical formulae. the development of certain heuristics for prioritizing the likelihood of chemical formulae reduces the number of possible chemical formulae, but leaves some ambiguity that can be reduced through additional experimentation  <cit> .

modern mass spectrometers can constrain compound masses to within a few parts per million . such accurate measurements assist in the task of determining chemical formulae  mass spectrometers), especially when the mass of the target compound is large. fourier transform icr  mass spectrometers have sufficient mass resolution and accuracy to enable use of isotopic fine structure for direct formula assignment. however, the majority of instruments used for untargeted metabolomics do not have such high resolution. in addition, to accurate mass measurements, accurate measurements of isotopic peak intensities are critical if natural isotopic abundance information is to be used. the importance of accurate intensity information increases as the mass of the target compound increases.

notably, the use of stable isotope labeling has been shown to reduce the ambiguity of chemical formula assignment and has tremendous potential to aid in the comprehensive profiling of small molecules to better understand physiology  <cit> . stable isotope labeling methods allow counting of c and n per formula unit and can lead to identification of the chemical formula without reliance on the natural isotopic abundance patterns and without using a restricted chemical formula generator.

in the current study, we compare chemical formula identification using natural isotopic abundance patterns to stable isotope labeling methods. we compare direct measurement of the counts of carbon and nitrogen atoms in an empirical formula to natural isotopic abundance information as a way to restrict chemical formula assignment. in addition, we show that simply identifying chemical formulae is sufficient to infer biological pathways. thus untargeted metabolomics studies can inform genome annotation.

RESULTS
linking empirical formulas to metabolic pathways
to test the hypothesis that empirical formulae alone could pinpoint the presence of a particular metabolic pathway, we examined the metacyc collection of pathways and metabolites  <cit> . this analysis showed that many unique  metabolites and compounds with unique chemical formulae participate in a small number of reactions or pathways . taking into account metabolites consisting of c, h, n, o, s, and p, there are  <dig> pathways in metacyc that are not “super-pathways” . of these pathways,  <dig> have at least one unique metabolite . additionally,  <dig> of these pathways have at least one metabolite with a unique chemical formula . identification of specific metabolites or merely the chemical formulae of detected metabolites may thus indicate the presence of specific reactions or pathways. this evidence cannot be considered conclusive, as specific metabolites can participate in reactions or pathways not covered by metacyc. also, specific chemical formulae may correspond to metabolites not covered by metacyc or any known biological database. that said, mapping sets of experimentally identified chemical formulae on to genome-scale metabolic network reconstructions or databases of metabolism offers an attractive, first step approach for the evaluation of the quality of genome annotation. the approach can also highlight gaps in the annotation when unexpected metabolites are identified  <cit> .

chemical degeneracy around a local mass-value
shown in figure  <dig> are two approaches for reducing chemical degeneracy around an observed value in chemical space. high mass accuracy mass spectrometers achieve an uncertainty of approximately  <dig> ppm . because of this uncertainty, there can often be a range of chemical formulae that could correspond to an "inexact mass". to demonstrate, the hr <dig> chemical formula generator was used to find points in chemical space that are within  <dig> ppm of folate    <cit> . due to the large number of possible chemical formulae associated with this mass value, biological inference is impractical. however, the ratio of the monoisotopic peak intensity  to the peaks with  <dig>  or  <dig>  more neutrons can be used to prioritize the likelihood that points in chemical space correspond to the measured mass . this widely used approach is described in the seven golden rules. alternatively, knowledge of the number of carbon atoms and nitrogen atoms can be used to reduce the number of chemical formulae in the search space .

chemical formula generation as the first step in restricting chemical space
in figure 3a, hr <dig>  was used to estimate the degeneracy in mass at  <dig> ppm for a library of unique mass values. in addition, figure 3b shows the increase in degeneracy for an unfiltered  formula generator. the restrictions reduce the degeneracy, but some compounds are lost when formula generators are restricted by heuristics such as lewis senior rules and ring/double bond equivalents, and allowable element ratios. in both cases, the degeneracy becomes unmanageable as the mass of a compound increases.

accurate mass alone is insufficient to identify the chemical formula for high mass metabolites. the degree to which degeneracy increases with mass was evaluated for  <dig>  compouds, each having a unique mass. these masses were selected from the pubchem database by including only chemical compounds comprised of less than  <dig>   <dig>   <dig>   <dig>   <dig>  and  <dig>  atoms of the elements c, h, n, o, s, and p and having a mass of less than  <dig> da. the formulae of all these compounds could be generated by brute force. hr <dig>  by design, uses heuristic filters to reduce the chemical formula search space; and therefore, it did not generate  <dig>  of these formulae . most of these are unlikely to be biologically important . however, others, including atp, taurine, and malate are of biological importance. these compounds are excluded by the compiled version of hr <dig> by restricting the oxygen to carbon ratio. this variable can be easily changed in the source code of hr <dig> to a more liberal value as described in the seven golden rules  <cit> . we conclude that some metabolomics experiments can benefit from a less restricted formula generator, though use of an unrestricted chemical formula generator greatly increases the search space around a mass value. it is important to note that in cases where a compound has constitutional or stereoisomers and therefore lacks an unique chemical formula, the formula can provide valuable information to narrow the search, often to a given class of compounds , providing biological considerations.

defined c & n atom count for identification of a unique chemical formula
by determining two dimensions in chemical space  the degeneracy of possible formulae is reduced. for the  <dig>  chemically representative unique masses, we determined the degree to which specifying the c and n count determines a unique chemical formula . using only knowledge from the hr <dig> chemical formula generator, unique mass defines chemical space location only for compounds less than approximately  <dig> da , and only for 5% of all compounds. when the unconstrained chemical formula generator  was applied to the same masses, very few could be localized to a specific coordinate in chemical space . however in figure  <dig> b & c, determining only the number of carbon and nitrogen atoms for each mass reduces the degeneracy to a practical level .

comparison to relative isotopic peak intensities
the third of the seven golden rules requires that the relative intensities of the peaks with one  and two  more neutrons compared to the monoisotopic  peak are within a specified deviation compared to the pattern predicted for a chemical formula according to natural isotopic abundance. to determine the degree to which specifying the c and n count reduces degeneracy in comparison to this rule,  <dig>  masses were selected at random from the library of  <dig>  unique masses. for each selected mass value, formulae were generated within  <dig> ppm; and for each, the relative intensity of the m <dig> and m <dig> isotopic peaks as compared to the monoisotopic peak  was calculated. this was done using both hr <dig>  and brute force . furthermore, to test whether sil knowledge was able to reduce the degeneracy better than the ratios of isotopic peak intensities, the number of possible chemical formulae remaining when the n and c count are known was also determined. this analysis was carried out as a function of the uncertainty in relative isotopic peak intensity. at zero-uncertainty, the ratio of the isotopic peaks uniquely defines a location in chemical space. however, realistically, there will be uncertainty associated with intensity  <cit> . at 10% uncertainty in the intensity ratios, the distribution of masses that were better localized by sil or relative isotopic peak intensities is shown . beyond approximately  <dig> da, natural isotopic abundance information fails to achieve the improvement in chemical localization that sil is capable of .

CONCLUSIONS
while mass spectrometry alone often cannot determine which isomer of a metabolite is present, our analysis has shown that pathway-specific metabolites and metabolites with unique chemical formulae exist. thus, if the entire spectrum of chemical formulae for an organism’s metabolites could be identified, clear designation of some metabolic pathways can be made.

to facilitate interpretation of metabolomics data, methods for identifying the chemical formula of detected features are greatly needed. a key deterrent to the identification of chemical formulae has historically stemmed from degeneracy, which increases with mass. we demonstrate here that the sil method is better than existing methods at identification of chemical formulae for metabolites larger than  <dig> da. this is achieved through determination of the c and n atom count. an additional advantage of the sil method is that it functions well even when the relative error of the isotopic peak intensities is > 10%, however, this method has the disadvantage that it requires additional experimentation. we have shown that the use of heuristic filters in chemical formula generation, while effective at reducing degeneracy and do not require additional experiments, runs the risk of ignoring biologically relevant metabolites. this study demonstrates that the sil method reduces degeneracy enough that unfiltered chemical formula generation is feasible.

