BACKGROUND
microarrays allow researchers to examine the expression of thousands of genes simultaneously. affymetrix arrays use groups of oligonucleotide probes, called probe sets, to represent genes of interest on an array. the primary goal of many experiments using affymetrix expression arrays is to identify a group of genes that is differentially expressed between two or more conditions.

when microarray experiments first started gaining popularity, a simple  <dig> fold cutoff was used as a threshold to identify differentially expressed genes. currently, a common approach to identifying differentially expressed genes is to calculate an expression index for each probe set and array and use these expression indices as the basis for statistical testing. in other words, the probe level information is combined into a summary value by probe set and array, then this summary information is used to test for differential expression. the most popular methods for calculating expression indices include affymetrix microarray suite  <dig>   <cit> , model based expression index   <cit>  and robust multi-chip average   <cit> . examples of statistical tests to identify differentially expressed genes based on expression indices include the t-test, the non-parametric wilcoxon rank sum test, bayesian methods  <cit>  and permutation based methods  <cit> .

recently a number of authors have presented testing methods based on probe values. individual probes contain information about the abundance of a particular transcript. a two-way anova model of probe values can be used to test for differential gene expression  <cit> . the chipstat algorithm tests for differential gene expression using probe level comparisons  <cit> . the median t-statistic from all probes in a probe set has been used as a test statistic for differential expression of the whole probe set  <cit> . the s-score was developed for detecting differentially expressed genes based on pm-mm differences without replication  <cit> . the pplr  method uses information about probe level variability  <cit> 

clearly there are many methods available for analyzing data resulting from microarray experiments. furthermore, different methods generally lead to different groups of genes identified as differentially expressed. the availability of spike-in datasets makes it possible to compare methods in a setting where the truth is known. a "good" method will have high power to detect differentially expressed genes but low false discovery rate . the false discovery rate is defined as the ratio of the expected number of falsely rejected hypotheses to the total number of rejected hypotheses  <cit> . for microarrays, where thousands of genes are being tested simultaneously, it is reasonable to focus on fdr instead of false positive rate .  it has also been noted that when identifying differentially expressed genes is the primary objective of the experiment, the aim of the corresponding analysis should be to rank the genes in order of evidence of differential expression  <cit> . the focus on power, fdr and rank have lead many investigators to rely on receiver operator characteristic  curves  <cit>  and fdr plots  <cit>  when comparing methods for detecting differentially expressed genes. diagnostics can be employed to identify outlying probe sets or to understand why a gene of interest was not identified as differentially expressed.

we propose using fisher's combined p method  <cit>  to combine probe level tests of differential expression. using three spike-in datasets and array data from a biological study, we compare the combined p method to the anova method  <cit> , cyber-t  <cit> , median t method  <cit> , moderated t-test  <cit>  and the original t-test. in addition to a comparison of methods, some suggested diagnostics based on probe level tests are also presented.

RESULTS
in order to compare the performance of the methods, we use three different spike-in datasets  and array data from a biological study validated with qrt-pcr. the focus of this paper is on detecting differentially expressed genes, so the background correction and normalization methods are kept constant for each of the datasets considered. high power to detect differentially expressed genes and low false discovery rate  are desirable. with these measures in mind we consider roc curves and fdr plots for each of the methods and datasets. all rankings are based on p-values. the rankings are calculated across comparisons for each dataset. we also use selection curves to examine what genes are selected in common between combined p and other methods. all programming was done in r  <cit>  using bioconductor  <cit> .

data used for comparison
the "golden spike" data employs the affymetrix drosgenome <dig> genechip  <cit> . the drosgenome <dig> genechip has a total of  <dig>  probe sets, typically with  <dig> probe pairs. three control arrays and three spike-in arrays were used. a total of  <dig>  probe sets have an increased concentration between the control and spike-in samples,  <dig>  probe sets have equal concentration and the remaining  <dig>  probe sets were empty on both the control and spike-in arrays. for the  <dig>  true positives, the log <dig> fold changes range from  <dig>  to  <dig>  all methods were applied to mas background corrected and probe level loess subset normalized data, since this combination performed best in the original comparison. tests based on probe values  were carried out on the background corrected, normalized and log <dig> transformed pm-only values. expression indices were computed using tukey biweight average  applied to background corrected and normalized pm-only values. tests based on expression indices  were carried out on the log <dig> transformed expression indices. all methods except the two-way anova method and cyber-t used t-tests assuming equal variance.

the gene logic spike-in tonsil data employs the affymetrix hg-u95a genechip  <cit> . the hg-u95a genechip has a total of  <dig>  probe sets, typically with  <dig> probe pairs. this data consists of  <dig> technical replicates of  <dig> different hybridization mixtures each with  <dig> spiked crna transcripts. the spiked transcript concentrations range from  <dig>  pm to  <dig> pm. there are  <dig> pairwise comparisons with  <dig> true positives per comparison for a total of  <dig> true positives with log <dig> fold changes between - <dig>  and + <dig> . tests based on probe values were applied to rma background corrected, quantiles normalized data and log <dig> transformed pm-only values. tests based on expression indices were carried out on the rma probe set summary values. the rma probe set summary algorithm uses only pm values and employs rma background correction and quantiles normalization. rma expression indices are reported on the log <dig> scale. all methods were based on fitting an anova model and then using contrasts to estimate and test pairwise "treatment" differences.

the affymetrix latin square data is based on the affymetrix hg-u133a genechip  <cit> . the hg-u133a genechip has  <dig>  probe sets, typically with  <dig> probe pairs. this dataset consists of  <dig> technical replicates of  <dig> separate hybridizations with  <dig> spiked transcripts in a complex human background. the spiked transcript concentrations range from  <dig>  pm to  <dig> pm. there are  <dig> pairwise comparisons with  <dig> true positives per comparison for a total of  <dig> true positives with log <dig> fold changes between - <dig> and + <dig>  due to concerns about cross-hybridization,  <dig> probe sets suspected of cross hybridizing with the spike-in transcripts were removed from the analysis. the list of likely cross hybridizing probe sets was obtained from the affycomp package from bioconductor  <cit> . according to the affycomp help file, "the sequences of each spiked-in clone were collected and blasted against all hg-u133a target sequences. target sequences are the  <dig> bp regions from which probes were selected. thresholds of  <dig>   <dig> and  <dig> bp were used." we used a  <dig> bp threshold for removal. tests based on probe values were applied to rma background corrected, quantiles normalized data and log <dig> transformed pm-only values. tests based on expression indices were carried out on the rma probe set summary values. all methods were based on fitting an anova model and then using contrasts to estimate and test pairwise "treatment" differences.

finally, we consider the mcat data from qin et al.  <cit>  which includes data from affymetrix expression arrays as well as corresponding qrt-pcr results. rna samples were collected from heart tissue from  <dig> mice in an unbalanced  <dig> ×  <dig> factorial design. the  <dig> mice were young or old, wild-type or carried the mcat transgene. there were  <dig> young wild-type  mice,  <dig> young mcat  mice,  <dig> old wild-type  mice and  <dig> old mcat  mice. twenty four affymetrix mg-u74av <dig> genechips were employed. the mg-u74av <dig> genechip has  <dig>  probe sets, typically with  <dig> probe pairs. quantitative rt-pcr measurements from  <dig> genes were taken on the same  <dig> rna samples. qrt-pcr is often considered a "gold-standard" method of measuring gene expression. we note that the  <dig> genes assayed with qrt-pcr were not randomly selected, but selected based on "primer availability, initial evidence of differential expression, signal intensity, and biological interest"  <cit> . we consider three comparisons: ymcat versus ywt, omcat versus owt and ywt versus owt. tests based on probe values were applied to rma background corrected, quantiles normalized data and log <dig> transformed pm-only values. tests based on expression indices were carried out on the rma probe set summary values. all methods except the two-way anova method and cyber-t used a t-test assuming equal variance.

roc curves
the roc curves show the true positive rate, or power, plotted against the false positive rate . the roc curves for the each of the spike-in datasets are shown in figure  <dig>  the ideal situation with full power and no false positives corresponds to the upper left corner of the plot. we do not show the full range of false positive rates as we feel that this would be misleading. for example, for the gene logic tonsil data, a false positive rate of  <dig>  with full power would correspond to a false discovery rate of  <dig> !

the roc curves show that the performance of each of the methods is dependent upon the dataset. all methods perform best on the affymetrix latin square data. however, we are primarily concerned with the relative performance of the methods.

fdr plots
curves depicting the false discovery rates for the different gene selection statistics for the each of the spike-in datasets are shown in figure  <dig>  these curves indicate the number of false discoveries when a given number of top ranked genes is selected as differentially expressed. this graph is a useful comparison representing the scenario where the investigator is primarily interested in ranking genes and choosing a number of the top ranked genes for further follow up and verification, typically using rt-pcr.

the fdr plots focus on the performance of the methods when the fdr is reasonably small. this is the range of practical interest. all methods perform best for the affymetrix latin square data, but the relative performance is of primary concern.

ranks of differentially spiked transcripts
the interquartile range  of ranks by method for known differentially spiked transcripts are shown in table  <dig>  the ideal ranking where all true positives are ranked above any false positives is also shown for each of the datasets. the rankings are based on the calculated p-values for each of the methods. we expect differentially spiked transcripts to have small p-values and be ranked high. for the gene logic tonsil and affymetrix latin square data, for which we consider multiple pairwise comparisons, we rank the p-values from all comparisons together. although it is possible to rank the p-values from each comparison separately, we feel that ranking the comparisons together reflects realistic experimental protocol. the combined p method comes closest to the ideal ranking for all three spike-in datasets.

power over the range of intensity
in order to examine the power of each of the methods over the range of intensity values, the intensity of each of the true positives was calculated as the average of the log <dig> values. the power was calculated as the proportion of the true positives that was detected while maintaining an overall false discovery rate less than or equal to  <dig> . the power for each of the four intensity quartiles as well as overall power for each of the datasets and methods is shown in table  <dig> 

for the golden spike and gene logic datasets, combined p yields the highest power overall and for each of the intensity quartiles. for the affymetrix latin square data, cyber-t yields the highest power overall and for each of the intensity quartiles. we note that the power is calculated at a specified false discovery rate and that relative performance of the methods might vary based on the chosen value of the false discovery rate.

observed false positive rates
the observed false positive rates for each of the methods when a raw p-value cutoff of  <dig>  is used to identify differentially spiked transcripts are shown in table  <dig>  because the combined p method uses the minimum of the two one-sided p-values, we use a p-value cutoff of  <dig>  for the combined p method only. if we are interested in determining whether a specific gene is differentially expressed, the raw p-values instead of multiple testing adjusted values are appropriate and the comparisonwise error rate is of interest.

in order to better control the false positive rate and to adjust for variability between methods, we propose calibrating the p-values. specifically, our calibration set is comprised of those probe sets called "absent" on all arrays according to the mas absent/present call algorithm . since transcripts for these probe sets do not appear to be present above background, it seems reasonable to assume that they are not differentially expressed. a calibrated p-value of  <dig>  corresponds to the first percentile of the p-values from the calibration set. for the golden spike data, 66% of probe sets were called absent on all six arrays. for the gene logic tonsil data, 25% of probe sets were called absent on all  <dig> arrays. for the affymetrix latin square data, 39% of probe sets were called absent on all  <dig> arrays. the observed false positive rates for each of the methods when a calibrated p-value cutoff of  <dig>  is used to identify differentially expressed genes are shown in table  <dig>  a p-value cutoff of  <dig>  was again used for the combined p method.

none of the methods maintain a false positive rate close to the stated α level of  <dig>  when using raw p-values. using a calibrated p-value reduces the false positive rates for all methods except median t.

selection curves
the selection curves show that the anova and median t methods seem to agree well with combined p in most cases. this agreement is most likely due to the fact that these three testing methods are based on probe values instead of expression indices. the affymetrix latin square data provides an exception – the median t method does not agree well with combined p for the initial group of genes selected. from the fdr and roc plots we see that all methods are accurately detecting differentially spiked transcripts. also, from the selection curves we see that the agreement between methods is good when the top  <dig> genes are compared. this indicates that while the differentially spiked transcripts are being ranked high by all methods, the ranking within the group of differentially spiked transcripts varies by method. this is not surprising when we consider that the p-values for the top ranked probe sets are very small – less than 10- <dig> for the  <dig> top ranked genes from any method.

comparison of methods using the mcat qrt-pcr validated genes
a total of  <dig> genes from the mcat study were validated using qrt-pcr. in table  <dig> we show the proportion of qrt-pcr assayed genes ranked in the top  <dig>   <dig> and  <dig> genes for each method and each comparison. note that we do not expect all  <dig> genes to be selected for any one comparison. the combined p method is consistent with the other accepted methods.

we also examined the spearman correlation between p-values calculated using the affymetrix array data with each of the six testing methods and qrt-pcr data for the  <dig> qrt-pcr assayed genes. we note that because the testing methods are based on information from the same subjects, we expect dependence among p-values and consistency in ranking for the most significant p-values. the  <dig> genes were not selected randomly and tend to have smaller p-values and higher rankings when compared to the full distribution. spearman correlation captures the level of agreement of the rankings by the different methods. for the ymcat vs ywt comparison, the correlation between p-values from the six testing methods applied to the array data is greater than  <dig>  for any pair of methods, while the correlation between p-values from the array and qrt-pcr data is less than  <dig>  for any of the testing methods. for the omcat vs owt comparison, the correlation between p-values from the six testing methods applied to the array data is greater than  <dig>  for any pair of methods, while the correlation between p-values from the array and qrt-pcr data is less than  <dig>  for any of the testing methods. for the ywt vs owt comparison, the correlation between p-values from the six testing methods applied to the array data is greater than  <dig>  for any pair of methods, while the correlation between p-values from the array and qrt-pcr data is less than  <dig>  for any of the testing methods. this shows that the testing methods  are ranking the  <dig> qrt-pcr validated genes similarly. however, the correlation between p-values based on qrt-pcr data and affymetrix array data are only weakly correlated.

combined p and probe level tests as diagnostics
combined p-values and probe level p-values can be used as diagnostics. it is appropriate to apply the combined p method for both of the one-sided tests. for diagnostic purposes it is interesting to compare the two one-sided combined p-values for each probe set. if all probes consistently indicate a change in one direction , then we would expect one of the combined p-values to be close to zero and the other to be close to one. however, if some probes indicate differential expression in opposing directions, it is possible to obtain small combined p-values in both directions. these probe sets can be easily identified by plotting the combined p-values against each other.

probe level tests can also be used as a diagnostic. specifically, we can examine the t-statistics for each probe of a probe set. the number of probes indicating up-regulation and down-regulation can be tabulated. for some probe sets, we might find probes indicating differential expression in opposing directions. for a given probe set, let nup be the number of probes exhibiting statistically significant evidence of up-regulation and ndown be the number of probes exhibiting statistically significant evidence of down-regulation at a specified false positive rate. then the level of discordance for the probe set can be summarized by d = min.

we illustrate the use of the combined p-value and probe level tests as diagnostics using the golden spike data. recall that for the golden spike data there are  <dig> probe sets that correspond to differentially spiked transcripts. all of the log <dig> values for the differentially spiked transcripts are positive. the combined p-values  for each probe set were calculated. probe set 154940-at has small combined p-values in both directions 

we performed a t-test for each of the probes. using a p-value cutoff of  <dig> , the number of probes indicating up-regulation  and down-regulation  were tallied by probe set. the majority of probe sets have discordance values of zero  or one . only  <dig> probe sets have discordance values of four or greater; three of these correspond to differentially spiked transcripts. probe set 154940-at has a discordance value of five – the largest observed for this dataset.

probe set 154940-at corresponds to a differentially spiked transcript with known log <dig> =  <dig> . the probe level t-statistics and rankings for this probe set are shown in table  <dig>  five consecutive probes have significant t-statistics ranging from - <dig>  to - <dig> . eight of the probes have significant positive t-statistics ranging from + <dig>  to + <dig> . the probe sequences for this probe set were obtained from affymetrix and a nucleotide-nucleotide blast search against ncbi transcript reference sequences was performed. the eight probes with positive t-statistics mapped only to cg <dig> . the five probes with significant negative t-statistics mapped to cg <dig> and cg <dig> . probe set 152984-at was differentially spiked with log <dig> =  <dig> , so it is not clear why these probes would be exhibiting evidence of down regulation.

probe level t-statistics can also be used to screen for outlying probes. a probe that is acting differently than other probes within the same probe set could be indicative of cross hybridization or alternative splicing. as an example, we consider probe set 146788-at for which the majority of the probes have t-statistics between - <dig>  and + <dig> , but one probe has a t-statistic of + <dig> . the probe level t-statistics and rankings for this probe set are shown in table  <dig>  this probe set does not correspond to a differentially spiked transcript and the majority of probes seem to reflect this. however, a single probe seems to be showing strong evidence of differential expression. the sequence for this probe was obtained from affymetrix and a nucleotide-nucleotide blast search was performed. a  <dig> bp match to the probe sequence was found. the matching sequence corresponds to cg <dig> which is represented by probe set 154310-at on the drosgenome <dig> array. furthermore, for the golden spike experiment, this transcript was differentially spiked with known log <dig> =  <dig>  so, in this case, there is a plausible explanation for the behavior of the outlying probe.

illustration of differences between median t and combined p methods
the combined p and median t methods are both based on probe level tests of significance and seem to rank genes similarly in many cases. to examine the instances when the combined p and median t methods diverge, we consider probe sets 151862-at and 153401-at from the golden spike data. the t-statistics and rankings for these probe sets are shown in table  <dig>  for probe set 151862-at, the median t method ranks this probe set as  <dig> while the combined p method ranks it as  <dig>  eight of the probe level tests have t-statistics ranging between  <dig>  and  <dig> . hence more than half the probes indicate up-regulation of the corresponding gene. in contrast, for probe set 153041-at, the combined p method ranks this probe set as  <dig> while the median t method ranks it as  <dig>  seven of the probe level test have t-statistics ranging from  <dig>  to  <dig> . here half of the probes indicate up-regulation, some with very large t-statistics. this demonstrates that although the combined p and median t methods perform similarly, they weight evidence in different ways. large t-statistics which are greater than the median have no effect on the median t, while the combined p method gives them higher weight.

discussion
there are two possible objectives of testing for differential gene expression using microarray data. one goal is to determine whether or not a particular gene is differentially expressed. another goal is to rank the genes in order of evidence of differential expression. all methods considered here produce p-values which can be used for testing and ranking.

if we are interested in determining whether a particular gene is differentially expressed, then it is important to control the false positive rate. in practice, this is difficult. the observed false positive rates for each of the methods when a raw p-value cutoff of  <dig>  is used to identify differentially expressed genes are shown in table  <dig>  none of the methods maintain a false positive rate close to the stated α level of  <dig> . in addition to calculating the error rates based on raw p-values, we also examine the error rates based on a calibrated p-value. specifically, our calibration set is comprised of those probe sets called absent on all arrays according to the mas absent/present call algorithm. using a calibrated p-value reduces the false positive rates for all methods except median t. however, the only way to precisely control the false positive rate would be to calibrate using all or a randomly selected set of equally expressed genes. of course, if we knew which genes were differentially expressed, we would not have to test for differential expression.

in practice, investigators are often more concerned with ranking genes in order of evidence of differential expression. for this objective, the correctness of the ranking is more important than maintaining the stated false positive rate. the roc curves, fdr plots and rankings of the true positives illustrate the relative abilities of each of the methods to rank the true positives. while roc curves allow us to examine the power over a range of false positive rates, they do not tell us what p-value cutoff to choose to achieve a desired false positive rate.

when reviewing the results from tables  <dig> and  <dig>  it is clear that methods do better at ranking genes rather than maintaining stated false positive rates. in addition, method performance based on false positive rate is highly dependent on the dataset. to remedy this, we believe that some type of data specific calibration is necessary. we have proposed one such calibration approach, but this is an area for further research. in contrast, ranking appears to be more consistent across methods and datasets. this explains why many authors look at roc curves. we note that calibration of p-values using monotonic transformations will not affect rankings. so, while we may not know the correct threshold value for declaring significant differential expression, we are better able to identify top candidates for differential expression. we can see from tables  <dig> and  <dig> that the relative performance based on false positive rate is distinct from relative performance based on ranking. considering all of these factors, we place more emphasis on ranking genes in order of differential expression.

with the goal of ranking genes in order of differential expression in mind, the combined p and median t methods perform well for all three datasets considered. based on the rankings of known true positives and power by intensity we see that the combined p method offers slightly improved power as compared to the median t method for the golden spike and gene logic tonsil datasets. for the affymetrix latin square data, cyber-t offers improved power when a false discovery rate of  <dig>  is desired.

the selection curves shown in figure  <dig> show that gene rankings based on combined p are highly correlated with the rankings by anova and median t. the one exception is seen in the selection curves for the affymetrix latin square data, where combined p and anova methods seem to be ranking very similarly to each other, but different from the other methods. however, all of the methods yield high rankings and very small p-values for the differentially spiked transcripts for this dataset. this implies that the ranking within the group of differentially spiked transcripts varies by method.

our comparison employs spike-in datasets for which the truth is assumed to be known. we include results based on the golden spike data. recently deficiencies of the golden spike data have been noted  <cit> . the most relevant issue for this study is that the null distribution of p-values  is not uniform. this problem is not unique to the golden spike data. we have observed a non-uniform null distribution in the other spike-in datasets. in our experience, even "real" biological datasets can exhibit evidence of a non-uniform null distribution. since we are only interested in the relative performance of the methods we feel it is appropriate to include the golden spike data in our comparison. we note that in the original golden spike comparison, a probe set level normalization was performed  because "many of the expression summary data sets that were produced still show a dependence of fold change on the signal intensity"  <cit> . we acknowledge that, in all likelihood, testing methods based on probe set summary values would have exceeded the performance of the methods based on probe level tests had a probe set level normalization been performed for the golden spike data. however the dependence of fold change on signal intensity seems to be an artifact of the golden spike data and not typical of other datasets  <cit> . the probe set normalization improved the performance of the methods based on roc curves, but not necessarily estimated fold change. it would seem that if the combination of probe and probe set level normalizations really offered improved performance for a variety datasets, then both types of normalization would be implemented in commonly used algorithms. instead, algorithms include either a probe level normalization  <cit>  or probe set level normalization  <cit> . it should be clear that a probe set level normalization does not apply to methods based on probe level tests of significance.

we note that the median t method is a special case of the chipstat algorithm. the chipstat algorithm uses probe level comparisons to detect differential gene expression  <cit> . specifically, pm-mm differences are used to perform individual probe level significance tests using the t-test. the number of probe pairs changing in a given direction, with p-values less than a fixed value , is tabulated and used as a measure of the significance of change in gene expression. it is up to the user to choose both the value of pps and the number of probe pairs required in order to declare a probe set differentially expressed. if the pm values, instead of the pm-mm differences, are used and at least half of the probes within a probe set must be statistically significant to declare the probe set differentially expressed, then this method reduces to the median t method.

the combined p method is particularly well suited as a diagnostic tool for exploratory analysis of microarray data. in particular, the two one-sided combined p-values can be used to screen for outlying probe sets. in addition, probe level t-statistics, upon which the combined p method is based, can be used to identify outlying probes within a probe set. unusual probe sets can be flagged for further examination. in some cases, this type of behavior may be an indication of alternative splicing or cross hybridization. a discussion of methods for detecting alternative splicing using microarray technology is given by  <cit> .

CONCLUSIONS
the combined p method is a promising alternative to existing methods of testing for differential gene expression. the combined p and median t methods are both based on probe level tests of significance and perform well based on ranking genes in order of evidence of differential expression. one exception is the affymetrix latin square data where the combined p and median t do not agree well for the rankings of the top  <dig> genes. however, the main difference between the combined p and median t methods lies in how they weight evidence. large t-statistics which are greater than the median have no effect on the median t, while the combined p gives them higher weight. the combined p method also leads to useful diagnostics. in particular, it allows us to examine conflicting information provided by probes within a probe set. a further examination of such conflicting information may point to outlying probes or lead to interesting discoveries. the median t on the other hand, makes its decision regarding differential expression based on the "median probe" and does not pay attention to any discordance that may be present among probes. this presumably makes the median t more robust at the expense of missing interesting phenomena, such as alternative splicing or cross hybridization.

