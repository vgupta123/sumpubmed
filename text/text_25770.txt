BACKGROUND
rna sequencing  – the unbiased sequencing of random cdna fragments  <cit>  – has many applications, the most common of which are to quantify expression level, identify allelic imbalance, and discover novel genes, transcripts and splice variants . rna-seq has benefitted from decreasing sequencing costs which, since  <dig>  have declined at a rate faster than expected given moore’s law   <cit> . as lower material costs help overcome limitations of breadth  and depth  in a given study, an increasing number of gene expression atlases – large-scale compendia of transcript abundance across a range of tissues and cell types – have been developed, including atlases for the rat  <cit> , sheep  <cit> , maize  <cit> , soybean  <cit> , the string bean phaesolus vulgaris  <cit> , the pea pisum sativum  <cit> , and humans   <cit> .

despite the growing volume of rna-seq data, it cannot easily be integrated into new projects because relative expression estimates depend upon methods of library preparation. most notably, rna-seq libraries vary in how rna is extracted from the cell line or tissue  and in how rnas are selected for sequencing.

all rna-seq libraries must effectively remove the highly abundant ribosomal rna. the two most commonly used selection methods, polya-selection  and rrna-depletion , selectively omit a distinct set of rnas  to sequence different fractions of the transcriptome  <cit> . these generate incompatible datasets, despite both methods performing the same task of removing highly abundant rrnas to allow mrna detection . polya+ libraries exclude rrna because rrnas are not polyadenylated – they lack the polya tail added post-transcriptionally to the 3′ end of almost all eukaryotic mrnas . however, polya+ selection also excludes, aside from rrnas, many other mrnas that are either polya-   <cit> , and bacterial mrna  <cit> ) or bimorphic   <cit> . by contrast, ribo-minus libraries characterise both polya+ and polya- rnas  <cit>  – a more thorough profile of the transcriptome – but they also capture nascent  transcription  <cit>  and so contain a larger proportion of intronic sequence from pre-mature mrna  <cit> .

current microarray platforms are sufficiently resilient that data generated from the same platform can be compared between labs, for example to generate a comprehensive expression atlas of human primary cells  <cit> . similar consolidation of selected rna-seq data would increase statistical and analytic power, and in the case of animal-based research, would meet the objective of reducing numbers used  <cit> .

by contrast to microarrays, where each transcript is detected independently, in rna-seq, expression is quantified in relative terms – for a given number of sequenced reads, the abundance of one transcript affects the relative abundance of the others. this can be accounted for by reporting expression level with a universal proportionality constant, i.e. in units of tpm, the number of transcripts per million. tpm is independent of transcript length  and so is in principle comparable across samples  <cit> . however, its use assumes that a million reads from one experiment are equivalent to a million reads from another, which is clearly not the case with different library preparation methods.

rna-seq data is commonly processed by aligning the sequenced reads to a reference genome, reconstructing transcripts from this set of alignments and quantifying their expression as a function of the reads aligned  <cit> . this alignment process is slow enough to cause an analytic bottleneck  <cit> . alternative ‘lightweight’ algorithms  utilise a pre-defined reference transcriptome, instead of a genome, for quantification. for instance, kallisto builds an index of k-mers from a reference set of transcripts and then estimates expression level from the reads directly. rather than aligning reads to each transcript , k-mers  are instead matched exactly to each read  <cit> .

to test whether polya+ and ribo-minus datasets can be meaningfully combined, we used kallisto to characterise the expression profiles of differentially selected rna-seq datasets from libraries generated using each method – these have the same cell type ), the same rna and are run on the same sequencing platform  at a depth of > <dig> million reads per sample. these samples form part of an ovine transcriptional atlas of multiple tissues and primary cells, developed at the roslin institute  <cit>  as an expansion of efforts to provide functional annotation of the sheep genome  <cit> . the atlas combines the two methods, with a subset of samples based upon ribo-minus selection and sequenced at greater depth, to ensure comprehensive capture of alternative splice isoforms and non-polyadenylated transcripts.

we describe here the development and validation of an approach to data integration that enables quantitation of the sets of transcripts detected by both methods and their integration into a single dataset.

RESULTS
rna selection method affects estimates of expression level
in other species, including mice and humans  <cit> , pigs  <cit>  and horses  <cit> , pure populations of macrophages can be generated by cultivating precursors in the macrophage growth factor, csf <dig> , with these cells undergoing a profound and rapid change in gene expression when exposed to bacterial lipopolysaccharide . this response varies greatly between species. the same approach was developed for sheep, producing bone marrow derived macrophages  and analysing their response to lps with the objective of a detailed comparative analysis of responses relative to other ruminants and species . rna was prepared from sheep bmdms, before and after lps treatment for 7 h, and libraries were prepared from the same rna following either polya+ selection or rrna-depletion by standard protocols.

expression was quantified using the high-speed transcript quantification tool kallisto v <dig> . <dig>  <cit>  as the median tpm  of  <dig> replicates . transcript-level abundances were summarised to the gene-level. this analysis requires that a k-mer index  first be generated from a reference transcriptome: ovis aries v <dig>  .

expression level estimates for all genes in the ovine bmdm transcriptome, both before and after treatment with lps, are shown in additional file 1: table s <dig>  based upon data from unstimulated bmdms, the expression levels estimated by alternative library preparation methods are correlated , but ribo-minus libraries  systematically produce a lower estimate of the relative expression of protein-coding genes . quantitatively similar findings were found when comparing data generated from lps-stimulated bmdms .fig.  <dig> differential transcriptome sampling by polya+ and ribo-minus rna selection methods leads to variance in tpm estimates. each point is a gene, coloured by type: black points represent protein-coding genes, pseudogenes and processed pseudogenes ; blue points represent rna genes . the line y = x is shown in red. as ribo-minus libraries capture rna genes that polya+ libraries do not , expression can be systematically underestimated for the remaining, mostly protein-coding, genes . the data shown is for bmdms prior to lps stimulation. the same pattern was observed for bmdms 7 h post-lps stimulation . the confounding effect of selection method can be corrected mathematically 


fig.  <dig> the expression level of protein-coding genes was systematically underestimated in ribo-minus compared to polya+ libraries . only data from protein-coding genes with detectable expression  in both library types is shown. bins have width  <dig> 




although both methods detect an equivalent number of genes in both conditions , the ribo-minus libraries capture  <dig> rna genes that the polya+ libraries do not  . conversely, the polya+ libraries capture  <dig> protein-coding genes that the ribo-minus libraries failed to detect above the tpm >  <dig> threshold . this differential gene detection is likely due to sampling noise. for the set of genes uniquely captured by only one selection method, expression is low both pre- and post-lps stimulation. for polya-selected libraries, 75% of these genes are < <dig> tpm; for rrna-depleted libraries, <  <dig> tpm . notable exceptions were the highly expressed polya- genes – such as the set of u <dig> spliceosomal rnas  <cit> , at > <dig>  tpm – which could only be quantified here in rrna-depleted libraries.

the summed tpm for genes specific to the ribo-minus libraries is in the region of 40- <dig>  tpm, i.e. 4-5% of the total sequenced transcripts have no counterpart in a polya+ library . the disparity between the two tpm distributions arises because k-mers unique to this subset of reads can be matched to transcripts in the kallisto index .

k-mers do not always match transcripts on a one-to-one basis: numerous reads  will map with equal validity to multiple loci. these reads are enriched amongst gene families which have many members with identical or near-identical sequence  <cit> , and although they can be excluded from analysis to minimise ambiguity, this is at the cost of biologically meaningful data  <cit> . for both library types, approximately one fifth of the alignments are non-unique . to quantify expression level in these cases, kallisto fractionally assigns the reads amongst the set of possible transcripts using an expectation-maximization algorithm . as such, reference transcriptomes with a higher number of non-unique kmers will have a higher number of non-unique alignments, potentially skewing the tpm of certain genes – by fractionally assigning reads to their probable locations, some genes will be under- and some over-counted. pseudogenes in particular are enriched for multi-mapped reads, as many also map to their functional counterpart  <cit> .

to eliminate the impact of multi-mapping and differential detection between library types, the reference transcriptome was filtered to remove those subsets of transcripts differentially detected by library type. this increased the fraction of unique k-mers distributed amongst the remaining transcripts. this correction was sufficient to reduce the effect size of the difference between the polya+ and ribo-minus distributions to negligible levels . furthermore, when expression was quantified using an index of protein-coding transcripts alone, >  <dig> extra genes met a threshold of  <dig> tpm compared to an index of all known transcripts . this is particularly important given many genes are only expressed at low levels – for instance, of the  <dig>  genes with non-zero expression in unstimulated bmdms , approximately half  have a tpm <  <dig>  for these genes, there could still be a large effect in absolute terms from small differences in read/k-mer assignment .fig.  <dig> the absolute difference in tpm between polya+ and ribo-minus libraries was reduced if expression was quantified against a smaller reference transcriptome. although the difference was significant , it had a negligible effect on the shape of the distribution . the data used is from bmdms prior to lps stimulation. only genes quantified at tpm >  <dig> against both reference transcriptomes are shown . bins have width  <dig> 




expression levels estimated using ribo-minus libraries can be made equivalent to those using polya+ libraries
filtering the reference transcriptome before quantifying expression reduces the difference in tpm estimates caused by differential transcriptome sampling. however, this is at the cost of useful data – filtering the reference transcriptome excludes those transcripts that contribute most to the variance. we considered whether mathematical correction - applied to all transcripts - could resolve tpm underestimation in ribo-minus compared to polya + libraries . a ratio-based correction of the ribo-minus estimates greatly reduced the absolute difference between polya+ and ribo-minus tpm in bmdms . those genes with greater differences in tpm, even after correction, tended to have fewer unique k-mers , fewer exons , shorter average exon lengths , shorter average transcript lengths , and a greater number of paralogues  . as such, erroneous tpm estimates are more likely when fewer possible reads can be derived from a gene, and when fewer of these reads are unique.fig.  <dig> variance in tpm estimates introduced by the differential transcriptome sampling of polya+ and ribo-minus methods can be corrected mathematically. the same data is shown as in fig.  <dig>  except that all ribo-minus tpm estimates were multiplied by the ratio of the median tpm across all polya+ libraries to the median tpm across all ribo-minus libraries. should the median tpm across all ribo-minus libraries be  <dig>  this ratio was considered  <dig> also. each point is a gene, coloured by type: black points represent protein-coding genes, pseudogenes and processed pseudogenes; blue points represent rna genes. the line y = x is shown in red. pearson’s r =  <dig> , p <  <dig>  × 10−16



fig.  <dig> the absolute difference in tpm estimates from polya+ and ribo-minus libraries was reduced when applying a ratio-based correction to the latter. the line y =  <dig> is shown in red. the data shown is for bmdms prior to lps stimulation, quantified using the full oar v <dig>  transcriptome . as data is shown on a logarithmic scale, values of  <dig> are excluded. to reduce noise, genes with tpm <  <dig> either before or after correction were excluded




variance in expression estimates introduced by rna selection method can also influence downstream analyses. for instance, those protein-coding genes with the greatest absolute difference in uncorrected tpm estimates  are enriched in a variety of biological processes, most notably as structural components of the cytosolic ribosome .

transcriptome filtering and tpm correction together minimise differences between polya+ and ribo-minus libraries
to apply both methods, we devised a two-step pipeline for using kallisto . this involves, as the first step, pseudoaligning all reads to the complete reference transcriptome , parsing this output to create a revised version, and then quantifying expression using that revised reference . this revised transcriptome was intended to include those transcripts that are absent from the original reference , and to exclude misleading or incorrect reference transcripts . filtering non-expressed isoforms from the reference transcriptome has previously been shown to reduce the false discovery rate in studies of differential transcript usage  <cit> . when this analysis is applied to a broader sample – such as the range of tissues comprising an expression atlas – unexpressed transcripts would likely be spurious models arising from poor assembly. alternatively, and more likely in the context of the present data, they could be tissue-specific for a tissue not sampled, or expressed below a detection threshold.

taken together, these filters increased the proportion of unique k-mers in kallisto’s index, and by extension the accuracy of tpm estimates.

using this method, we compared the sets of lps-inducible transcripts detected using each library method, either like with like, or with the reciprocal cross-over . the venn diagram for the four sets is shown in fig.  <dig>  showing that after filtering the transcriptome and correcting the tpm estimates, the number of lps-inducible genes in the intersection of all sets is doubled.fig.  <dig> different library types detect different sets of lps-inducible transcripts, although a greater number can be captured when merging datasets. counts are of the number of protein-coding genes with > <dig> tpm both pre- and post-lps stimulation  and a log <dig> fold change in expression > <dig>  data was creating either by  quantifying expression against the complete oar v <dig>  transcriptome, and  employing a filtered reference transcriptome for quantifying expression , and then applying a ratio-based correction to tpm estimates from ribo-minus libraries. after this process of filtering and correction, the number of lps-inducible genes in the intersection of all sets is doubled. p = polya+, r = ribo-minus. figure created using venny  <dig>   <cit> 




this method can also be applied more generally. to demonstrate, we expanded the scope of an existing human tissue expression atlas by merging two publicly available sets of paired-end strand-specific rna-seq data  . the polya+ dataset sequences a corresponding set of tissues as those in the larger ribo-minus dataset, and aside from selection method both used broadly similar protocols .

as a reference transcriptome, we used only the set of multi-exonic protein-coding transcripts  with a transcript support level of  <dig> ,  <dig>  or  <dig> . transcripts with lower support level scores either have no mrna supporting the model structure or with the best supporting est being suspect. single-exon transcripts are also excluded as these do not yet have a transcript support level score. together, this represents  <dig>  genes. tissue trees were then constructed from the euclidean distances between gene expression level vectors. these show that prior to tpm correction, the majority of the polya+ samples group with each other, rather than with the equivalent tissues from the ribo-minus libraries . this suggests that, in general, library-specific variation confounds a comparative analysis of the two datasets. after correcting tpm estimates as described here, more meaningful biological groupings were obtained for the set of analysed tissues, irrespective of library type . furthermore, on a tissue-by-tissue basis, the expression profiles from the two datasets became more tightly correlated after tpm correction .

discussion
large transcriptomic datasets can be used to infer the function of genes based upon the transcriptional company they keep  <cit> . the information content of such co-expression networks depends to a large extent upon the size and diversity of biological states sampled; the more states that are sampled, the more stringently one can state that a pair of genes share strict co-expression. with the increasing reproducibility of microarray platforms, many studies have combined data from multiple sources – for example, in a global meta-analysis of human and mouse datasets  <cit> . sequence-based expression profiling has emerged rapidly as an alternative to microarrays. the fantom <dig> consortium produced comprehensive expression atlases for mouse and human based upon tag sequencing of 5′ ends   <cit> . to date, there have been few efforts to produce meta-datasets from rna-seq data. a recent study of human lung cancer provides an example of the potential power of combining data  <cit> , although the focus was on the detection of novel fusion transcripts rather than expression quantitation.

in conjunction with decreasing sequencing costs, the number of available rna-seq datasets has increased substantially in recent years, with gene-level expression estimates available for many species across a range of tissues, cell lines, and developmental stages.

in order to combine microarray datasets from different laboratories, the data must first be normalized and quality-checked  <cit> . this study outlined a two-part processing pipeline that would allow the combination of rna-seq data generated from either the same or different cell types and tissues but with different approaches and from different laboratories. although simple to implement, it has specific requirements and makes several assumptions.

central to this approach is the transcript quantification tool kallisto  <cit> , which builds an index of k-mers from a set of reference transcripts. rna-seq reads are sheared into k-mers, with exact matches of these k-mers to the index used to quantify expression. use of kallisto assumes the reference transcriptome is sufficiently high quality for generating a k-mer index: poorer quality annotations will be more likely to have missing transcript models  and miscalled bases . incomplete annotation catalogues are known to negatively affect the detection of differential transcript usage  <cit> .

a means of distinguishing high from low-quality transcripts, using transcript support level  scores, is only available for limited model species , although this is likely to change rapidly as major animal genomes are completed to much higher quality and supported by deep transcriptomic data. tsl scores have been assigned to all multi-exon gencode annotations and evaluate the level of support for a transcript across its full length. the highest scoring transcripts are those with all introns supported by an mrna alignment to each splice junction  <cit> .

in principle, a reference transcriptome could be derived from the reads directly, by performing a de novo assembly. in practice, this is unreasonable, effectively trading one computational bottleneck for another – kallisto is quick to quantify expression  but confidence in its estimates depend on an accurate reference transcriptome, the creation of which is slow . once created, a de novo transcript assembly will also need annotating, as not all isoforms can be considered separately: some may instead be variants of previously annotated genes  <cit> . within the proposed two-step pipeline, the ambiguity of the de novo transcripts is minimised  because only unmappable reads are input to the assembler. these reads are unlikely to be assembled into variants of an existing gene because if such a gene existed, kallisto would have mapped reads to it.

based upon our analysis of much larger datasets in the sheep atlas, the variance introduced by the rna selection method is much greater than from any other batch effect, although these must still be accounted for as a matter of best practice . batch effects are inevitable unless the entire set of data comprises a single batch  <cit> . this is implausible for a given large rna-seq project, such as an expression atlas – data will inevitably be collected over a lengthy period, introducing the confounding effects of differing laboratory conditions, personnel, equipment, reagents and preparation method . although batch effects are widespread in rna-seq studies  <cit> , numerous design strategies – such as replication , randomisation and blocking  – are routinely used to minimise their impact  <cit> . technical variation is of particular importance with rna-seq as the sampling fraction of the total number of molecules per sequencing lane is small   <cit> . the likelihood of detecting genes, particularly lowly expressed genes, is influenced by sequencing depth, with variance in gene detection consistent with sampling error. as such, a number of genes will likely remain below detection thresholds because of their low expression level relative to sample size , estimated to be up to 10% of the genes per library in many studies  <cit> .

based upon 5′ end tag sequencing, expressed transcripts in mammalian cells follow a power law distribution  <cit> , which means that the large majority of rna-seq reads in any dataset derive from the small number of most highly-expressed transcripts. at the lower end of the expression profile, there is a bimodal distribution of transcript detection, where the very low detection of transcripts correlates with the absence of detectable functional chromatin marks  <cit> . transcripts with low tpms will be particularly susceptible to factors that could skew these estimates. as demonstrated by our analysis, lowly expressed transcripts are differentially captured by polya+ and ribo-minus rna-seq libraries. arguably, when one is dealing with relatively pure populations of cells, these transcripts are very unlikely to have a functional impact, being less than  <dig> transcript per cell, but in tissues they might be more abundant in a subset of rare cells. in the absence of a way to increase read length  or read depth , we filtered the set of reference transcripts  to increase the proportion of unique k-mers within it. in conjunction with a mathematical correction for library-specific noise, this also minimised the likelihood that reads will map to multiple loci. this improved the accuracy of tpm estimation to the extent that equivalent estimates can be made from polya+ and ribo-minus libraries, most notably for protein-coding genes .

CONCLUSIONS
although polya-selected and rrna-depleted libraries capture different fractions of the transcriptome, a combination of reference transcriptome filtering and a ratio-based correction can generate equivalent expression levels from both. this could conceivably assist in the novel re-use of existing rna-seq data.

