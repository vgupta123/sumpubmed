BACKGROUND
viruses are the most abundant biological entities in the biosphere  <cit>  and are now considered as major players in natural ecosystems and their associated cycles and balances  <cit> . viral communities are known to be mostly composed of new strains  <cit>  and are difficult to characterize as  most micro-organisms are still impossible to cultivate in the lab for now, hence preventing the culture, isolation and study of their associated viruses and  the absence of a single gene common to all viral genomes prevents the monitoring of uncultured viral diversity using approaches analogous to ribosomal dna profiling.

metagenomic approaches, consisting in a random sequencing of the genetic pool isolated from natural samples, circumvent these limitations. experimental protocols to extract and isolate the encapsidated fraction are now well established  <cit> , and viral metagenomes  have been generated from a broad range of ecosystems. beyond the description and characterization of the viral genomic diversity, viromes are useful towards more general questions such as biogeography and dispersion of viral particles  <cit> , evolution and origin of viruses  <cit>  or epidemiology  <cit> .

advances in next-generation sequencing and in sequence assembly techniques recently led viral metagenomics a step further, by providing access to large genomic fragments rather than only short reads  <cit> . indeed, contigs representing complete or near-complete viral genomes were assembled from  <dig>  <cit>  and illumina hiseq  <cit>  generated viromes. these large assembled sequences  provide access to the genome content and architecture of uncultured viruses and offer the possibility to gain unique insights into the main viral families in the environment.

two web-servers are currently available for a comprehensive virome analysis: metavir  <cit> , and virome  <cit> . a pipeline  was also described but to our knowledge is not available neither as a standalone software or through a web page. yet, none of these bioinformatic tools were designed for the analysis of assembled datasets and the absence of adapted tools for such assembled viromes was pinpointed as a major bottleneck for viral metagenomic studies  <cit> . moreover, the growing number of generated viromes calls for the development of comparison strategies to go beyond individual analysis of each dataset. here, we introduce a new version of metavir that tackles these two limitations. metavir  <dig> includes  new ways to compare datasets and  a whole new section which forms the first tool designed for a comprehensive analysis of assembled virome sequences.

implementation
input and metadata
registered users can upload their own sequence datasets, either short reads or assembled contigs, in a private space. input data are checked for being only composed of dna sequences in fasta format . due to the size of illumina’s raw datasets  and computing time required for assembling each dataset, the assembly step cannot be computed through metavir. furthermore, a wide range of softwares are available for this step and the choice depends on the type of the sequencing and the nature of the sample: newbler  is the main software used so far for  <dig> data  <cit> , and illumina data can be assembled with idba_ud  <cit> , soap  <cit> , metavelvet  <cit>  or optidba  <cit> .

a set of public viromes is also already available for users to compare with their dataset. these viromes are sorted into projects, and linked to the manuscript describing their analysis when available. various metadata can be added, such as the type of sample from which the virome was sequenced, the location, depth, and temperature of sampling point, and the sequencing technology used to generate the dataset.

section 1: tools to analyze raw datasets 
taxonomic composition
virome reads are first compared to the complete viral genomes of the refseq virus database using blast. the taxonomic composition is then determined using either raw number of best hits or number of best hits normalized by genome length using gaas  <cit> . krona  <cit>  is now used to generate interactive charts representing taxonomic composition of one or more viromes. a custom-designed javascript program has also been implemented to visualize these compositions as interactive heatmaps, with each column representing a dataset and each row a group of viral species. columns can be switched by mouse drag and drop. viral species are classified according to the up-to-date ncbi taxonomy, and viral groups can be folded and unfolded with a mouse click.

k-mer frequency bias
a virome comparison based on k-mer frequency bias  has been implemented as described by willner and collaborators  <cit> . unlike the other available comparison method, based on sequence similarity  and requiring datasets containing at least  <dig>  sequences of 100bp, k-mer nucleotide frequencies can be computed for all datasets without size restriction. briefly, k-mer frequency distribution bias are computed by a custom perl script and then compared for each pair of viromes. pairwise euclidian distances between viromes are stored in a matrix, which can be used as input either in a hierarchical clustering or a non-metric multidimensional scaling. both analysis are computed with r  <cit>  using pvclust  <cit>  and vegan  <cit>  libraries respectively. the non-metric multidimensional scaling  is now also available for virome comparison based on sequence similarities, available in metavir  <dig> 

phylogenetic analyses
to speed up the phylogenetic pipeline, phylogenetic trees are now computed with fasttree  <cit> . using the jsphylosvg javascript plugin  <cit> , phylogenetic trees are now interactive: they can be displayed as circular or linear, subtrees can be merged, and informations on the origin and affiliation of the sequence of each node can be obtained by clicking on the associated leaf.

individual viral genome recruitment plots
using the best blast hit results against refseqvirus, each virome sequence with a hit is affiliated to a unique viral genome, i.e. each read is recruited by a reference virus. for any selected viral genome, two types of recruitment plots are then available:  a scatter plot displaying each recruited read as a dot depending on the position on the genome  and the identity percentage of the blast hit , and  an histogram presenting the number of recruited reads for each 500-nt long genome part. these plots are generated using the ggplot <dig> r library  <cit> . additional viromes that contain sequences recruited by the selected genomes are also listed and can be added to the current plot. when several datasets are selected, a color is attributed to each virome, used to color dots  or stacked histograms .

section 2: assembled viromes annotation and display
contig annotation
open reading frames  are first predicted for each contig through metageneannotator  <cit> . a custom perl script was designed to detect circular contigs by looking for identical k-mer at the two ends of the sequences. each circular contig is then trimmed to remove all redundant parts. in order to be able to predict genes spanning the origin of circular contigs, a temporary version of circular contigs is used in the orf prediction software, in which the first  <dig>  nucleotides are duplicated and added at the contig’s end. it has to be noted that this detection of circular contigs will not be effective for contigs computed with assembler like newbler which already detect and remove such similarity between contig ends.

all predicted translated orfs are then compared to several databases, namely the refseqvirus protein database from the ncbi using blastp  <cit> , with a threshold of 10− <dig> on e-value, and the pfam database of protein domains  using hmmscan  <cit> , with a threshold of  <dig> on score. a direct comparison of orfs within a virome is also computed through a blastp with the same threshold of 10− <dig> on e-value.

the taxonomic composition and sequence diversity are not calculated the same way for datasets made of long genomic sequences compared to those made of short reads. using the blastp results against reference viruses, three types of taxonomic compositions are computed for each dataset. these compositions are based on  best blast hit affiliation of each predicted gene,  best blast hit affiliation of each contig, and  lowest common ancestor affiliation of each contig. this lca affiliation is designed to take into account the multiple hits on a single contig: up to five affiliated genes  are considered for each contig, and the affiliation is made at the highest common taxonomy level of the best blast hit from these selected genes.

finally, different clusterings of the predicted orfs are computed. a global protein sequence clustering with three different thresholds  is performed using uclust  <cit> . another clustering is based on protein domain alignments: orfs are first ordered by size, and used iteratively as a seed for a jackhmmer search  <cit> . all orfs recruited by the seed are gathered in a cluster with this seed, and removed from further iterations. once computed, the domain-based orfs clusters are affiliated to one or more pfam domain based on the affiliation of their members. these clusterings are displayed through the rarefaction curve tool, and cluster affiliations can be downloaded in a csv file.

contig display
when an assembled virome is selected, a new “contig maps” page now provides general informations about orf prediction and contig affiliations, as well as an inset that allows to filter the contig list and access contigs of interest for further analysis . this interactive filter, developed using jquery, let users select contigs based on taxonomic or functional affiliations of predicted genes, and contig size, name or taxonomic affiliation.

an interactive genomic map can be displayed for each contig, this map being drawn using raphaelsvg and the raphael-zpd plugin. each gene affiliation to refseq viral genomes and pfam protein domains is indicated when available. genes can be further investigated as nucleotide and protein sequences are displayed by clicking on the gene either on the map or on the gene table below. contig annotations can also be downloaded as csv tables, summarized by contig or detailed for each orfs.

similarities between contigs and viral genomes and between different contigs can be visualized as an interactive network. in order to take into account all relevant similarities and not only the best blast hit for each orf, all blast hits with an e-value lower than 10− <dig> and having a bit-score within a 10% margin from the best blast hit bit-score for this orf are used to build the contig network. in the resulting networks created with cytoscape-web  <cit> , contigs and reference genomes are represented as nodes, and sequence similarities as edges. different options are available to customize the network, such as the coloring of edges based on blast bit-score, the display of only one edge between two similar contigs or of one edge for each orfs similarity, or the coloring of genome nodes based on the taxonomy. another set of filters is also proposed to reduce the number of nodes or edges displayed on screen.

associated with this network, a contig map comparison tool can be used to display collinearity between contigs and genomes or other contigs selected on the network. this comparisons are displayed through raphaelsvg and raphael-zpd. name and affiliation of each gene is displayed when clicked, and a jquery pop-up is used to change the sequence order within the plot.

common framework
automatic database update
as the refseqvirus database is quickly growing , each new release is automatically downloaded and used as the new reference database. taxonomic composition, gene affiliation , and recruitment plots of public projects are automatically updated with each release, whereas the update of private projects must be requested by the user.

results and graphics download
all sequence datasets used in a metavir analysis are available for download in fasta format . all tables  can be downloaded as csv files that can be imported in spreadsheet softwares.

contig annotations are available in genbank file format, which can be used in many downstream tools like artemis  <cit>  or easyfig  <cit> . these genbank files contain the lowest common ancestor affiliation of the contig, as well as the best blast hit affiliation of each orf, the functional annotation of each orf in pfam domain, and the sequences of each predicted cds.

all interactive charts and pictures  can be downloaded in svg format, a publication-ready vectorial format easy to modify using graphics softwares. static charts generated with r are available to download in pdf and png file format.

finally, the contig networks can be downloaded in a set of different formats, including graphml and xgmml, ready to be imported in the desktop version of cytoscape for further analyses and annotations.

case study: using metavir to analyze the human gut virome
two different datasets from the human gut viral community were chosen to illustrate the results that can be obtained with metavir  <dig>  first, a set of  <dig> viromes was used to illustrate the section dedicated to unassembled datasets . these metagenomes, sequenced with  <dig> gs titanium , were initially designed to study the dynamics of human gut viral community during a perturbation by a dietary intervention. two individuals were fed a high fat/low fiber diet , three were fed a low fat/high fiber  and one was on an ad-lib diet . samples were collected at up to four time points . the second dataset is an assembled virome, resulting from the assembly of illumina hi-seq  <dig> reads  from healthy individuals . this assembled dataset was used here to illustrate the possibilities offered by the new section dedicated to the analysis of contigs.

RESULTS
metavir, a web server dedicated to the analysis of viromes uploaded by registered users, can now be used to analyze the two existing types of datasets:  viromes composed of raw reads, mostly generated using pyrosequencing technology and  viromes assembled into contigs, a strategy possible with datasets sequenced with either pyrosequencing or illumina technology. the novelties of version  <dig> of metavir will be illustrated here using both types of datasets , all from human gut samples.

additions to the unassembled datasets section
most published viral metagenomes are still analyzed at the read level. indeed, pyrosequencing technology is often chosen to generate viromes, as this technology produces long reads and several samples can be easily multiplexed in a single run. thus, the number of reads in each multiplexed dataset is generally insufficient to produce an assembly. furthermore, the multiple datasets generated make it possible to study spatial or temporal dynamics in environmental communities  <cit>  or different individuals subjected to different conditions for eukaryote-associated viromes . in this context, the comparison of multiple datasets was our major focus while extending the section dedicated to unassembled datasets. in addition to the rarefaction curves and reciprocal tblastx comparison available in the initial version of metavir, taxonomic compositions and phylogenetic analyses can now be used to compare viromes. furthermore, most of these tools were improved with special attention to the display of results. a brand new tool was also added: the recruitment plot analysis, which makes it possible to accurately study the similarities between virome reads and a viral genome of interest.

taxonomic composition
taxonomic composition of viromes is determined by sequence similarity between virome reads and complete known viral genomes, and can be displayed as either raw number of hits or number of hits normalized by genome length  <cit> . virome composition can now be visually compared in two ways:  merging multiple compositions on the same krona chart  <cit>  and  an in-house developed interactive heatmap, which allows a more hierarchical view. as an example of the latter, a taxonomic heatmap was generated for the  <dig> datasets from the human gut . this heatmap allows the user to quickly visualize that these datasets only exhibited similarities with bacteriophages, in accordance with the results presented in minot et al. . even when the same bacteriophage groups are found in the different datasets, their proportion differ between each virome: myoviridae constitute between  <dig> and 42% of each virome, podoviridae  <dig> – 35%, siphoviridae  <dig> – 55% and microviridae  <dig> – 31%.

k-mer frequency bias
a recurrent observation in analyses of virome data is that the majority of reads has no similarity to any known viral sequence  <cit> , as can be noted for human gut viromes . therefore, methods that consider viromes in their entirety rather than only the small fraction affiliated with known sequences are of particular interest. analysis of k-mer nucleotide frequency bias is such a method and was proved to distinguish viromes from different biomes. this analysis, now available in metavir, was here applied to the  <dig> human gut datasets using 4-mer nucleotides  and a non-metric multidimensional scaling . results are again similar to those obtained in minot et al. : even though viral communities seem to be affected by diet , the different samples from each subject  are gathered indicating that each individual contained a unique virome. however, the k-mer analysis does not support the conclusion that viromes from subjects on the same diet converge over time.

phylogenetic analyses
phylogenetic analysis is of particular interest to study specific viral groups and such analysis was implemented in the first version of metavir  <cit> . as no gene is common to all viruses, several marker genes are needed to study the major viral groups. the list of markers, initially made of  <dig> genes, has been expanded to  <dig> markers, mostly following users’ requests. in metavir  <dig>  reads from a chosen virome detected as homologous to a selected marker were used to compute a tree including both these virome reads and reference sequences. however, the lack of reference strains close to most environmental viruses limits the efficacy of such analyses and often results in the generation of environmental clades far from references. however, samples from similar biomes often harbor closely related viruses  <cit> . to gain a better view of the diversity in each sample and of the relationships between samples, metavir  <dig> now offers the opportunity to compute phylogenetic trees that include reads from other viromes. as an example, we conducted such an analysis on the picovirinae, a subfamily of podoviridae . indeed, this group is one of the most abundant in  <dig> of the  <dig> human gut viromes . a protein primed dna polymerase, conserved in this family, was used to determine the phylogenetic relationships of the viruses retrieved in these human gut viromes . as expected, all sequences retrieved are most closely related to bacteriophages, and no virome reads appear to be linked to either archeal  or eukaryotic viruses . interestingly, virome sequences from each individual are clustered on the tree, highlighting that the picovirinae-like phages of subject l <dig> are distinct from those of h <dig>  such specificity of viral strains to each individual was noted on a more general scale through virome analysis of genetically linked individuals  <cit> . in this example, phylogenetic analysis of an abundant viral family confirmed the conclusions drawn from the comparisons of whole viromes.

individual viral genome recruitment plots
besides the analysis of single reads through blast or phylogenetic tools, plots of metagenomic sequences recruited by reference genomes of interest can give a sense of how well this genome is represented in a metagenome . indeed, visualizing a chosen genome and the distribution of its associated reads is useful to determine which genes of a known virus are found in an environmental dataset and the similarity level between reference and virome sequences. recruitment plots can be generated in metavir, and here again, several datasets can be included in a single plot in order to compare the gene conservation of a virus in different samples. as an example, this tool was here used to further study lactococcus phage  <dig>  one of the most abundant phages in the  <dig> datasets from the human gut. as this phage has been isolated from bacteria involved in milk fermentation and not directly from gut microbes, its actual presence in human gut samples is questionable. the plot of virome reads recruited by lactococcus phage  <dig> shows that most characterized genes  are retrieved whereas most of the unknown genes  are not . this suggests that even though phage  <dig> is the nearest neighbor of abundant human gut phage in the current state of the reference databases, these gut phages do not have a gene content entirely similar to phage  <dig>  furthermore, a gene cassette made of two putative tail proteins and two other structural proteins known to be major players of phage–host specificity in phage  <dig> is scarcely retrieved in these datasets . thus, it is very likely that the phages retrieved in the human gut viromes, even though similar to this lactococcus phage, infect an alternative host. this example illustrates how recruitment plots help in further understanding the genomic content of environmental viruses and their genomic relatedness with known viruses.

analyzing assembled datasets using the new contig section
even though unassembled viromes proved to be useful for a better characterization of environmental viral communities, long genomic fragments generated through the assembly of metagenomic datasets are usually more informative. indeed, complete orfs predicted out of such contig sequences  are more often similar to known viruses than short reads  <cit> ,  provide more robust phylogenies than using reads representing only a portion of a gene, and  are more appropriate than short random reads in determining the gene content and genetic diversity of a viral community  <cit> . moreover, analysis of the genomic content and architecture can provide decisive insights into virus classification and evolution of viral groups  <cit> .

a new section dedicated to the annotation and navigation within sets of contigs has therefore been implemented in metavir. when assembled viromes, i.e. sets of contigs, are uploaded by users, orfs are predicted  <cit>  and then annotated using sequence similarity results against viral genomes and protein domains. in addition to the general taxonomic composition, contig maps and annotations can be displayed for every contig. as datasets can consist of tens of thousands contigs, users can choose to visualize contigs  longer than a defined threshold,  predicted as circular or linear,  affiliated to a particular viral family, and/or  possessing a particular gene. finally, tools available for read analysis were specifically adapted to assembled datasets: taxonomic compositions are computed using either gene or contig affiliation, phylogenies are generated using predicted orfs and genetic diversity is computed using either predicted orfs or domain conservation.

for the assembled human gut virome used as an example in this section ,  <dig>  orfs were predicted on the  <dig>  uploaded contigs. furthermore,  <dig> contigs were predicted as circular and represent potential complete viral genomes. using the “contig selection” panel, large contigs  similar to lactococcus phage  <dig> were selected and further examined. for each selected contig, a summary of its annotations is available as an interactive map. the largest sequence  seems to be composed of two sets of genes associated with known viral genomes , whereas a third and central part is made of shorter and uncharacterized genes  . all genes but three are on the same strand , as is generally observed in phage genomes. moreover, no partial gene is predicted at either end of the sequence, indicating that this contig may represent a complete genome.

relationships between selected contigs and viral references to which they are affiliated can be displayed as an interactive network, where contigs and reference genomes are represented by nodes and sequence similarities as edges. for example, the network containing contigs associated with lactococcus phage  <dig> helps to rapidly identify that these contigs are related both to each other and to several siphoviridae genomes . contigs and references can then be selected in this network and a genome comparison of the chosen sequences can be displayed. this map-to-map comparison allows the user to identify collinearity between different genomes or genomic fragments. when compared to the complete genome of lactococcus phage  <dig>  contig_187_ <dig> can definitely be considered as a putative complete genome closely related to this phage, as both their sizes and gene organizations are very similar . interestingly, the similarities between this contig and clostridium phage phicd <dig> are limited to two genes which are part of the host-associated cassette previously discussed. thus, contig_187_ <dig> likely originates from a phage closely related to lactococcus phage  <dig>  but which could instead infect members of the clostridium genus. the second contig displayed on figure 6b, contig_289_ <dig> , only shares one core gene module with phage  <dig> and harbors several similarities to a distinct clostridium phage. these two contigs, that both exhibit similarities to lactococcus phage  <dig>  are here shown to be heterogeneous in nature. furthermore, genes of contig_187_ <dig> similar to lactococcus phage  <dig> correspond to the genes frequently retrieved in unassembled datasets , indicating that this contig might represent a prevalent virotype of the human gut. this genomic analysis of large assembled sequences exemplifies how such datasets can provide further insights into viral communities and viral species.

CONCLUSIONS
this new release of metavir provides a wide range of tools to analyze either raw or assembled viral metagenomes in a comprehensive way. as virome projects now regularly encompass multiple samples and as more and more viromes are being published, a special effort was made towards virome comparison. two new large scale methods were implemented and all existing metavir tools were modified so that they can be used to compare datasets. furthermore, a new section has been specifically developed to handle sets of large genomic contigs. as these datasets can be large and as all individual sequences can be of interest, we paid special attention to the interface, with filtering panels and network visualization. selected contigs can then be analyzed in detail by comparing their automatic annotations in terms of gene content and genomic maps. finally, with its extended or new tools and sections, metavir  <dig> provides a comprehensive framework with a user-friendly interface to explore any kind of viromes, and should help virologists to make the most of their metagenomics data.

availability and requirements
project name: metavir

project home page: http://metavir-meb.univ-bpclermont.fr

operating system: platform independent

programming language: perl, php, javascript, css, r

other requirements: javascript installed on user side

licence: gnu gpl3

any restrictions to use by non-academics: no.

competing interests
the authors declare that they have no competing interests.

authors’ contributions
sr, dd and fe designed the tools. sr, jt and am developed the different scripts. sr and fe wrote the manuscript. all authors read and approved the final manuscript.

