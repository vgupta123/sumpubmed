BACKGROUND
the amount of protein-coding dna sequences in the public data bases is steadily increasing. this data is mainly generated by the sequencing and annotation of entire genomes and by numerous est sequencing projects. approaches to resolve the evolutionary relationships of eukaryotes on a molecular basis -frequently referred to as molecular systematics- particularly benefit from this data. recent studies on the evolution of metazoans and fungi present trees with  <dig> to  <dig> taxa, reconstructed from more than  <dig> genes  <cit> . still, these studies consider only a small fraction of the data available. for example, as of may  <dig> dbest contains  <dig> eukaryotic taxa with more than  <dig>  ests each, and  <dig> taxa have more than  <dig>  ests . despite the potential value of ests especially for molecular systematics  <cit>  this data has rarely been used in phylogenetic studies so far. this is due to the fact that ests are redundant, short and of low sequence quality. plenty of solutions exist to improve data quality by cleaning and clustering of ests sequences prior to analysis  <cit> . however, annotating ests and more importantly inferring their relationships to known genes in other taxa is still problematic.

for most molecular systematics approaches only sequences are admissible for which the orthology  <cit>  or co-orthology  <cit>  to the other sequences in the dataset is known, or at least reasonable to assume  <cit>  . a variety of tools exist to define groups of orthologous proteins. among these, phylogeny-based programs, such as rio  <cit> , reveal the lowest fraction of false positives in a comparison of  <dig> programs for orthology/homology inference  <cit> . it is obvious that methods depending on a known species tree are not applicable if the aim is to infer the phylogenetic relationships of taxa. however, more recent approaches have found solutions to overcome this strict dependence on a known species tree, e.g.,  <cit> . the reciprocal best blast hit criterion  between pairs of sequences from two taxa, is frequently used to infer orthology when the species tree is unknown. orthology predictions from the rbh method have a very low false positive rate  <cit> . however, ortholog groups are ultimately confined to two sequences. thus, co-orthologs resulting from gene duplications after the separation of the compared taxa are missed. several variations exist to extend rbh ortholog groups to allow for the addition of co-orthologs  <cit>  and/or to extend the prediction to more than two taxa  <cit> .

orthology prediction methods based on the rbh criterion have been designed for, and successfully applied to, inference of ortholog groups for taxa for which the entire genome has been sequenced. their application to est based data sets, however, is not straightforward. incomplete representation of a species' gene set, especially in small est projects, depreciates a reciprocal best blast hit as an indicator of orthology. moreover, the coding sequence of a gene can be tagged by two or more non-overlapping ests. methods such as inparanoid  <cit>  or orthomcl  <cit>  will in most cases add only one of the ests to the ortholog cluster. both programs allow for more than one sequence per species in an ortholog cluster, only when the intra-specific similarity for the sequences in the cluster is higher than the sequence similarity between species. however, the intra-specific similarity between non-overlapping ests derived from the same gene is approximately that of two randomly chosen and unrelated sequences.

to use est data in molecular systematics, sequences have been initially blasted against a protein sequence database, e.g., the non-redundant protein database at ncbi, and the highest scoring hits are taken to tentatively annotate the est sequences  <cit> . post-processing of the blast results to infer the orthology status of the query-hit pair ranged then from the application of simple e-value cutoffs, e.g.,  <cit> , to more complex procedures including markov clustering and visual inspection of individual sequence trees  <cit> . problematic to these approaches is that they unduly substitute e-values of a blast result with evolutionary relationships, involve too many human interactions to be routinely applied, or suffer from the conceptual problem of markov clustering when applied to non-overlapping sequence fragments representing the same protein.

here we present a novel approach, hamstr, to extend predefined groups of orthologous genes derived from taxa, whose genomes have been fully sequenced with data from further taxa. we show that the joint application of a profile hidden markov model  based similarity search and a subsequent re-blast of the hit sequences against a reference proteome identifies candidate orthologs. hamstr exhibits a very low false positive rate and good sensitivity. the resulting collection of orthologous sequences provides an excellent basis for phylogeny reconstruction.

RESULTS
algorithm
step  <dig> defining a gene set for the ortholog search
 <dig>  generation of core-orthologs
as input we introduce the primer-taxa  where each taxon is completely sequenced and where the phylogeny of the primer-taxa is undisputed. standard orthology prediction tools such as inparanoid  <cit>  or orthomcl  <cit>  can be applied to identify genes with orthologs present in all primer taxa, the so called core-ortholog groups. for this study we compute orthologs for each pair of taxa with inparanoid  <cit> . the pair-wise orthology predictions are subsequently extended to include all primer taxa by using a criterion of transitive closure . we end up with a collection of core-orthologs where in each individual core-ortholog every primer taxon is represented exactly once. details about this procedure are provided online .

 <dig>  generation of profile hidden markov models
for each sequence cluster in the core-orthologs, the sequences are aligned using mafft  <cit>  with the options --maxiterate  <dig> and --localpair. the resulting multiple sequence alignments, comprising the n sequences from the primer-taxa are then converted into a profile hidden markov model   <cit> . the programs hmmbuild and hmmcalibrate from the hmmer package  are used for building, training and calibrating the phmms. each core-ortholog is now represented by a phmm.

step  <dig> extension of core-orthologs
we now extend the core-orthologs with data from additional taxa, the query-taxa. as data may serve translated ests, or protein sequences inferred from either complete or partially sequenced genomes.

 <dig>  phmm search
we use a fast implementation of the hmmsearch algorithm  to search protein sequence data from the query-taxon for matches to the individual phmms. if ests are the data for the query taxa, the individual ests are translated in all six reading frames prior to the search.

 <dig>  re-blast and orthology prediction
to determine the orthology status of the hmmsearch hits, we use a reciprocity criterion . each hit is compared by blastp  <cit>  to the proteome of one of the primer-taxa, the so-called reference-taxon . ideally, the reference-taxon should be the closest related primer-taxon to the query-taxon. if the protein of the reference taxon that contributed to the phmm provides the best blastp hit, then the hmmsearch hit is added to the corresponding core-ortholog. otherwise, it is discarded. please note that the reciprocity criterion is also fulfilled when the reference protein is among the lower ranking blastp hits, but has the same score as the top listed hit in the blastp output.

 <dig>  post-processing of ests
to account for possible frame shifts caused by sequencing errors in ests we use genewise  <cit>  to generate a codon-alignment for the est and the protein sequence of the reference-taxon. this alignment determines the coding part together with the reading frame in the est.

testing
we next test the versatility of hamstr. the data for this step are summarized in table  <dig> 

a

b

c

d 

e . the numbers of ests per organism are given in parenthesis.

f . the numbers of tentative consensus sequences are given in parenthesis.

we analyze three scenarios. in all cases we wanted to detect orthologs in the human proteome, where the primer-taxa set consists of opossum , sea squirt , fruit fly , worm , and a fungus . the corresponding core-ortholog set  represents  <dig> genes.

in the first scenario, we carried out step  <dig> of hamstr and extracted the opossum proteins from the  <dig> core-orthologs. then we used inparanoid to infer the corresponding orthologs in the human proteome. inparanoid identified  <dig> human-opossum ortholog clusters. for  <dig> opossum genes inparanoid did not find a human ortholog.

in the second scenario, we applied step  <dig> of hamstr with the opossum as reference-taxon instead of using inparanoid. if hamstr predicts more than one ortholog, we use clustalw  <cit>  to align all candidates individually to the opossum protein in the corresponding core-ortholog. the human proteins are then ranked according to their alignment score. hamstr predicted  <dig> human orthologs. for the remaining  <dig> core-orthologs no human counterpart was found.

for  <dig> core-orthologs the top ranking hamstr ortholog is the same as those found with inparanoid . four human genes that have been found with inparanoid were not detected in step  <dig> of hamstr. in all instances, inparanoid identified several proteins as co-orthologs to the human gene. however, only one of these opossum sequences was used to train the corresponding phmms. during the re-blast , a different co-ortholog from the same inparanoid-ortholog cluster was obtained as the best blastp hit. thus, the reciprocity criterion was not fulfilled and hamstr did not make an orthology prediction.

a different denotes those instances where either both programs predict a different human protein as ortholog, or where an ortholog is predicted only by one program.

one human gene was found with hamstr but not with inparanoid.

for three core-orthologs inparanoid and hamstr suggested different human proteins. for the core-ortholog represented by the opossum protein ensmodp <dig> inparanoid and hamstr suggest as orthologs the proteins ensp <dig> and ensp <dig>  respectively. both proteins are inparanoid co-orthologs with respect to ciona and with respect to fishes. it appears plausible, that the gene duplication giving rise to the protein pair ensp00000363169/ensp <dig> occurred recently, and presumably around the same time as the split of the human and opossum lineages. this view is supported by the observation that the blast score  of ensmodp0000017416/ensp <dig> exceeds the score of ensmodp0000017416/ensp <dig>  whereas the scores of the global alignment  produce the opposite result. moreover, orthomcl  <cit>  groups both human proteins together with the opossum protein in the same ortholog cluster. a similar scenario applies to the second case where inparanoid and hamstr disagree . in the third case, ensp <dig> is according to hamstr ortholog to the m. domestica protein ensmodp <dig> whereas it is ortholog to ensmodp <dig> according to inparanoid. the latter protein, however, is present only as a truncated sequence in our set of opossum proteins, lacking  <dig> amino acids. this truncation results in the same blastp score in the re-blast  between ensp <dig> and both opossum proteins. again, orthomcl groups these proteins into the same ortholog cluster.

in summary, the hamstr strategy is suitable for identifying orthologs for a pre-defined gene set. the results are consistent with those obtained with one of the most efficient existing orthology prediction programs. for  <dig> core-orthologs, more than  <dig> human protein was assigned as a putative ortholog. a detailed description of these lower ranking hits is given in the online supplementary material .

the hamstr approach is efficient in identifying orthologs when the entire sequence of the query protein is known. in scenario  <dig>  we assess the performance of hamstr when using translated ests. in many molecular systematics studies, est projects are typically small  <cit> . to assess the performance of hamstr in such cases, we did not cluster the ests. each single est is now an input for hamstr.

as a typical example we selected  <dig>  ests derived from human chromosome  <dig>  according to the following criteria: a blat search  <cit>  with each est against the human genome sequence must obtain a best hit on chromosome  <dig> covering at least 90% of the est. moreover, the best blat hit must be located between the annotated start, and the end of the transcript of an annotated gene , and must overlap with a coding exon. the  <dig>  ests  map to  <dig>  genes. from the analyses in scenario  <dig> and  <dig> we know that only  <dig> of these are represented by core-orthologs in the pop primer-taxa set. this set of  <dig> human chromosome  <dig> genes is tagged by  <dig>  ests .

from the  <dig>  hchr2-ests that served as hamstr input,  <dig>  were not assigned to any of the  <dig> core-orthologs . the remaining  <dig>  ests are highly enriched  with ests tagging the  <dig> genes that are represented in the pop set. more precisely,  <dig>  ests were assigned correctly to  <dig> core-orthologs. the remaining 3% were assigned to two core-orthologs for which the human gene is not located on chromosome  <dig> 

a total denotes the number genes/ests in the chr2-est data.

b intersection of the genes represented in the chr2-ests and the human orthologs for the genes in the pop set obtained with the human proteome data .

c relative to the results using the human proteome data.

in summary, only  <dig> out of  <dig> core-orthologs were wrongly extended with est sequences. also, on the est level only  <dig> ests were assigned to the wrong ortholog cluster. thus, the false positive rate was in both cases very low .

the sensitivity for detecting an ortholog was also good. from the  <dig> orthologs present on human chromosome  <dig> and represented by at least  <dig> hchr2-est, hamstr identified  <dig> . on the level of individual est sequences, however, the sensitivity was substantially reduced. the  <dig> genes for which hamstr predicted orthologs correctly are represented by  <dig>  hchr2-ests. hamstr detected only  <dig>   of these. the ests, that hamstr failed to assign, covered on average less than 13% of the coding sequence of the corresponding gene. thus, the encoded protein fragment is too short to result in a significant hit in the hamstr search. figure  <dig> displays the dependency of the search result on the fraction of the coding sequence  covered by an est. the length distribution of the missed ests explains why  <dig> core-orthologs represented by  <dig> hchr2-ests have been missed entirely. for these ests the average coding sequence coverage was in the range of 13%.

some ests, however, have not been assigned even though the encoded protein fragment should be of sufficient length . a visual inspection of a subset of these ests indicates that most of them comprise splice variants lacking one or several exons .

in summary, the false positive rate of hamstr is convincingly small and the sensitivity depends strongly on the fraction of the cds covered by an est.

to increase the sensitivity of hamstr, we re-designed the phmms such that local alignments between sequence and phmm are generated during the search . using hamstr with the modified phmms, it assigned  <dig>  ests correctly to all  <dig> core-orthologs. compared to the search with the default phmm structures, this indeed results in a substantially higher sensitivity both on the level of detected genes and ests . however,  <dig> ests were incorrectly assigned to  <dig> core-orthologs for which the human ortholog is not located on human chromosome  <dig>  thus, the gain in sensitivity leads to a pronounced increase of false positive predictions .

proof of principle: an est based phylogeny of fungi
we have shown that hamstr efficiently extends core-orthologs with protein or translated est sequences from further taxa. now we explore the applicability of the hamstr approach for large-scale phylogenomic analyses. to this end we analyzed the proteome from  <dig> completely sequenced fungi and est data from further  <dig> fungi . for taxa where ests and an annotated proteome are available, we use the ests. the collection of  <dig> taxa, including yeast, is a subset of the taxon set in fitzpatrick et al.   <cit> .

hamstr with h. sapiens, c. intestinalis, d. melanogaster, c. elegans, and s. cerevisiae as primer taxa was used to compile the sets of orthologs. s. cerevisiae was used as the reference-taxon. please note that we replaced m. domestica that was used in the pop set with h. sapiens, since the human genome sequence is considered finished. after running hamstr with  <dig>  core-orthologs and the data from  <dig> fungi, we obtained a set of extended core-orthologs. for completely sequenced taxa orthologs to almost all genes in the core-ortholog set were found , max:  <dig> , mean: 973). for taxa represented by only a few ests, the number of detected orthologs ranges from  <dig>  to  <dig>  with a mean of  <dig>  thus, we have an incomplete taxa-gene matrix.

for the subsequent maximum likelihood tree reconstruction we used  <dig> genes. each gene represents at least 40% of the taxa and at the same time each taxon is represented by at least 60% of these genes. the resulting tree has excellent branch support  and is by and large congruent to the phylogeny of these taxa, that was inferred from an analysis of their entire genomes  <cit> . only two taxa are differently placed. staganospora nodorum, a dothideomycete, is placed as a sister taxon to the eurotiomycetes, whereas it is sister to the sordariomycetes/leothiomycetes clade in fitzpatrick et al.   <cit> . aspergillus nidulans is positioned basal to the other aspergillus species instead of grouping together with a. fumigatus. we cannot rule out the possibility that the differences might be due to erroneous orthology predictions by hamstr. however, the following explanations argue against a wrong prediction.

for s. nodorum, the entire annotated proteome was used. as exemplified in our validation of hamstr , errors in the orthology prediction are unlikely for entire proteomes. the discrepancy between both trees may be caused by the fact that s. nodorum is the only representative of the dothideomycetes. together with the short internal branches in this region of the trees an accurate placement of this single taxon is difficult  <cit> . moreover, as of today, the fungi section of the itol-project  considers the placement of dothideomycetes as still unresolved.

a. nidulans, the second problematic taxon, is the only aspergillus species in our data for which orthologs are derived from ests. no quality information was available for these sequences, indicating that sequencing errors could interfere with the correct placement of a. nidulans in our phylogenetic tree. however, our a. nidulans placement agrees with other results  <cit> .

our example clearly shows that hamstr is well suited to compile phylogenomic datasets, including incomplete sequence data like ests or unfinished whole genome sequencing projects.

implementation
we offer the hamstr tool online and for download at . currently, the users can search est data for orthologs to core-orthologs derived from six predefined sets of primer-taxa, covering different regions of the metazoan tree. the reference-taxon for the re-blast can be selected from the taxa that constitute the primer-taxa. to increase est data quality, we provide options to clean and cluster est data, taking into account user information about base qualities  <cit>  of the uploaded sequences. the output gives information to which core-ortholog set a particular est was assigned to. links to detailed information about the protein of the chosen reference taxon for the re-blast are also provided. a fasta-file containing the sequences of the proteins in the core-ortholog cluster together with a tentative translation of the annotated est sequence can be downloaded. an example-output is provided on the hamstr web pages.

discussion
ests constitute a paradigm of a random sample of fragments from a species' gene set. we show that hamstr is capable of automatically predicting orthologs for a pre-defined set of genes  in such data. the results are consistent with orthology predictions obtained with reciprocal blast based orthology prediction tools, which however require completely sequenced and annotated genomes. hamstr performs a targeted search to extend predefined ortholog clusters derived from the analysis of complete genome sequences. this approach has three major advantages.

first, we search for orthologs only to genes for which whole genome comparisons provide prior evidence that orthologs can be identified. for example, core-orthologs including sequences from fungi and animals represent evolutionary old genes that were already present in the last common ancestor of both groups. thus, an ortholog search for these genes in incomplete and fragmentary data, such as ests, from fungi or animals has a good chance of success. in the other extreme, genes with predicted orthologs confined to e.g. vertebrates are presumably of evolutionary recent origin or have diverged beyond recognition in taxa outside the vertebrates. thus, a search for orthologs in ests from non-vertebrates will probably fail.

second, the phmms constructed from the core-orthologs allow for a more refined ortholog search compared to a conventional blast. in our case example with the human ests hamstr has a very low fraction of false positives . the low fraction of false positive orthology predictions by hamstr comes at the price of low sensitivity. this is due to the fact that we try to match the phmm over its entire length to the individual query sequences. ests, however, are generally short and cover in most cases only a fraction of the coding sequence. our search may, therefore, be too stringent. clustering ests prior to the hamstr search is an obvious strategy to address this problem. however, especially in small est projects many genes will have only a small fraction of their cds covered by ests, even after clustering. performing local alignments between sequence and phmm substantially increases the sensitivity both on the level of detected genes and ests . thus, the gain in sensitivity leads to a pronounced increase of false positive predictions . still, this false positive rate is substantially smaller compared to that of other orthology prediction programs based on a reciprocal best blast hit when used with ests . however, this emphasizes that short local similarities between sequences make orthology inference hard. most studies -particularly in molecular systematics- rely on an accurate orthology prediction and results can be severely compromised by false positives in the data set. it is a major advance of hamstr that it automatically filters sequences for which the orthology prediction is unreliable and we suggest using the global phmm search as default.

third, hamstr is computationally efficient. the use of core-orthologs limits the search to only those genes where we expect to find orthologs. moreover, also targeted ortholog searches are possible.

the performance of hamstr depends on the choice of the primer-taxa and on the method to determine the core-orthologs. primer-taxa should cover the diversity of the taxa of interest and thus constitute a scaffold of the corresponding phylogenetic tree. to address the evolutionary relationships of  <dig> fungal taxa we have used h. sapiens, c. intestinalis, d. melanogaster, c. elegans, and s. cerevisiae as primer-taxa. in principle, a primer taxon set including several fungi is more appropriate. it would minimize the evolutionary distance to the taxon in which the hamstr search will be performed. it would also allow searching for orthologs to genes that emerged on the fungal lineage or got lost in metazoa. however, we deliberately did not adapt the primer-taxa. by doing so, we addressed the question of how phylogenomic datasets compiled with hamstr perform, when no or only a single completely sequenced genome exists for a taxon group of interest. the reconstructed tree for the  <dig> fungi is entirely resolved, highly supported and compatible to other published phylogenies  <cit> . this indicates that hamstr, together with this primer-taxon set serves in general as a good starting point for any phylogenomic study within fungi and animals.

for building and training of the phmms, a large number of diverse primer-taxa is favorable. however, this holds only if the annotation of genes in the individual genomes is comprehensive. despite the small set of primer-taxa, each core-ortholog was extended by at least one fungal sequence. thus, the considerably small set of sequences used to train the phmms appears not to impair the sensitivity of the ortholog search in this particular case.

we determined the core-orthologs with inparanoid-tc . however, hamstr allows the use of core-orthologs determined with any orthology prediction method, e.g., orthomcl  <cit> . by that hamstr can be adapted to the particular evolutionary problem one is interested in. if the hamstr output serves as a data basis for a standard phylogenomics study, many approaches require that each taxon should be represented only by one sequence per gene. in such cases core-orthologs determined with inparanoid-tc or the recently developed oma-algorithm  <cit>  are a good starting point for hamstr. on the other hand, if one is interested in the evolution of a gene family, it may be desirable that the ortholog cluster used by hamstr also contains co-orthologs. in such cases ortholog groups from more inclusive orthology prediction programs can be used as core-orthologs.

CONCLUSIONS
hamstr extends in a standardized manner a pre-defined set of orthologs with proteins or ests from further taxa. a profile hidden markov model that captures the essential features of the known orthologs is used in the ortholog search. the introduction of a reciprocity criterion into the ortholog search makes the orthology predictions symmetric, as is the case when complete proteomes are compared. variation of the phmm structure allows searches at different stringency. one may either carry out an alignment of part of the est- or protein sequence against the entire profile , or a local alignment of the sequence against part of the profile . profile hmms used in the hamstr search can be based on arbitrary primer-taxa and any source of initial orthology predictions. thus, our procedure is applicable regardless of the molecular systematics problem one is interested in. testing the performance of hamstr on a test set of human est sequences revealed a remarkably low false positive rate of the orthology predictions with good sensitivity. the reconstruction of a phylogenetic tree for  <dig> fungal taxa based on  <dig> genes shows that hamstr can compile informative data sets for contemporary phylogenomic studies. our procedure may help to standardize data acquisition for studies in molecular systematics, allowing for a better comparability between individual results.

