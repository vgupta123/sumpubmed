BACKGROUND
liquid chromatography-mass spectrometry  is a popular technique for elucidating the composition of liquid samples. data processing considerations are essential to accurately determine the identity of molecules  contained in the sample , as well as their quantity in sample .

information about sample quantity is captured directly in survey scans, or ms  data. fragmentation spectra of one or more analytes constitute ms/ms  data, and this information is typically used to corroborate or ascertain the identity of a molecule. partitioning/clustering ms <dig> signal from complex samples and mapping the signal to other analyses  is challenging. some quantification strategies bypass these challenges by using information derived directly or indirectly from ms/ms data. these methods include spectral counting  <cit>  and isobaric tags for relative and absolute quantification   <cit> . though these methods have been successful, the amount of quantifiable signal embedded in ms <dig> data is estimated to far exceed what is currently available by ms/ms  <cit> ; however, most ms <dig> data remains unused by current software. hence, improving methods for partitioning and mapping ms <dig> signal stands to significantly  increase the sensitivity of a typical label-free or isotope-labeling ms-omics experiment, both for experiments currently being run and for past experiments where raw data is still available.

subdivision of raw mass spectrometer output data into smaller signal partitions attributed to specific analytes in the sample is critical prior to achieving analyte identification and quantification. the larger partition unit, called an isotopic envelope trace, is the signal pattern generated by each analyte/charge combination . because mass spectrometers can only detect charged analytes, the sample must be subjected to an ionization method, which imputes a charge on each detected analyte. since multiple instances of each component exist in the sample, and since each instance is charged independently, there exist in each output the signals of multiple analytes, each with  multiple charge states. these create a distinct signal--the isotopic envelope trace--for the total signal detected for each analyte/charge state combination. each isotopic envelope trace is composed of a series of isotope traces, which are manifestations of the fact that each analyte is composed of chemically similar compounds that differ in the weight of certain isotopes . at each charge state, each molecular variant of the analyte is detected at a particular m/z offset, creating one isotope trace per molecular variant/charge-state/analyte combination.

mass spectrometry data, in its raw form, is not ideal for isotope trace extraction or subsequent processing. after internally accumulating signal over discrete time slices, the mass spectrometer outputs raw data condensed into the form of many narrow profiles wherever signal is present. conversion to centroid mode integrates the abundance of each of these profiles into a single tuple called a centroid. this is considered a routine conversion for which ample software is readily available. we adopt the typical convention of using centroid data.

despite the ubiquity of lc-ms experiments, to the best of our knowledge, no concise, complete description of the lc-ms isotope trace and isotopic envelope extraction problems exists. here, we describe constructs for isotope traces and isotopic envelopes, as well as formally describe the relationship of centroids, isotope traces and isotopic envelopes. in this context, we review extant objective functions for isotope trace extraction, isotopic envelope extraction, and correspondence. finally, we propose novel objective functions for each of these tasks that address shortcomings in current approaches.

RESULTS
isotope trace extraction
the most important data processing step in a typical quantitative lc-ms pipeline is isotope trace extraction  <cit> . clustering centroids into isotope traces is a non-trivial problem due to the many sources of noise affecting centroid mass and abundance. sources of noise affecting centroids include chemistry effects due to chromatography, abundance inaccuracy due to ionization efficiencies, m/z deviation due to machine calibration, occlusion/adulteration of low-abundance signal due to dynamic range limitations, and compounded inaccuracies in mass-to-charge ratio  and abundance due to centroid construction. of course, these complications are propagated from the clustering of isotope traces to the clustering of isotopic envelopes to the identification of cross-experiment correspondence.

a centroid is denoted as c =  where µ, τ, α are values for m/z, retention time , and abundance, respectively. a single ms run produces a set of centroids c={ci}i=0n, where n can readily reach into the millions.

an isotope trace f ⊂ c is defined as a set of centroids: f={ci}i=0m, with each set f constrained so that all members of a given isotope trace f are within a distance threshold θ from other centroids in their neighborhood ϒ :

  maxj∈ϒiδf<θμ,α,τ 

where θ is a function of centroid m/z, rt, and abundance, δf is a distance function based on m/z, rt, and abundance, and ϒ is a neighborhood demarcated by m/z, rt, and abundance. additionally, the slope of a  linear regressor estimate for an isotopic trace is very nearly infinite . one way to formalize this is to use a weighted, inverse variant of the theil-sen estimator as follows :

  ∑ci,cj∈fcjμ-ciμcjτ-ciτcjαciα∑ci,cj∈fcjαciα≈ <dig> 

where cα is the abundance of centroid c and cµ is the m/z of centroid c.

note that the behavior of isotope traces are dependent on all three ms dimensions although many common approaches to isotope trace extraction ignore one or more of these dimensions. for example, most proprietary ms software uses hard m/z bins for isotope trace extraction.

extant objective functions
the prominent algorithms for isotope trace extraction include centwave  <cit> , matchedfilter  <cit> , centroidpicker  <cit> , massifquant  <cit> , and maxquant  <cit> .

matchedfilter operates on the simplifying assumptions that 1) isotope traces are completely contained within pre-processed hard m/z bins and 2) the shapes of all isotope traces in a run can be fit to the same shape. matchedfilter minimizes the error of a gaussian fit over prospective isotope traces, by attempting to find the set of isotope traces  f, a scaling factor bf , and mean retention time ft for each isotope trace that minimizes the summed abundance error over all isotope traces. note the use of a single, global variance σ, an average rt width for all f ∈ f:

  λf=∑f∈f∑c∈fbfe-22σ2-cα 

the centwave algorithm extracts isotope traces that fit a scaled and translated ricker wavelet ζ . the fit is calculated as a convolution between the shape function and the signal intensity , so the goal is to maximize the objective function:

  λf=∑f∈f∑c∈fcαζ 

where

  ζ=1bf23π141-cτ-tfbf2e-cτ-tfbf <dig> 

with isotope trace-specific scaling parameter bf and translation parameter tf chosen to maximize the convolutional fit over isotope trace f .

the algorithm centroidpicker uses heuristic operations on a neighborhood graph to separated the data into connected components. it connects an undirected graph g =  of centroids where the edges n are constrained such that:

  n=δcci,cj<δcci,ck∀k≠jciα>θ and ciα>θ 

for some intensity threshold θ and centroid distance function δc, resulting in g being composed of one or more connected components, each considered one isotope trace. thus, f={fi|∀ck∈fi,∃cl∈fi{cl∈ϒ}}, where the neighborhood function ϒ  returns the set of nodes connected to c .

the objective functions for massifquant and maxquant define  f as the set of all f formed by iterating over values of time t, and adding c if cτ = t and cμ-c*μ<∈, where c∗ ∈ f and cτ-c*τ≤cτ-cjτ for all cj ∈ f. for massifquant, ∈ is prescribed by a kalman filter induced from the variance in cµ and cα for all cj ∈ f such that cjτ<t, with the added constraint that cτ be unique in f . maxquant defines ∈ simply as a distance threshold of  <dig> ppm m/z.

proposed objective functions
we define fµ, the m/z of isotope trace f, given by the weighted m/z of its component centroids:

  fμ=∑c∈fcαcμ∑c∈fcα 

and using it propose an alternative objective function for isotope trace extraction:

  λf=∑f∈f∑c∈fbfe-22σf2afe-22h2-cα 

where, again, centroid clustering  f and retention time means ft are chosen to minimize the gaussian fit error; however, rather than using a single global variance in the rt dimension, each isotope trace f has a local variance σf; in addition, the scaling factors have become time-dependent scalar functions bf. the second gaussian factor, parameterized by mean fµ and variance function h, models the m/z width of the isotope trace, which is a function of the abundance α. isotope traces splay at low abundance and narrow at high abundance; thus, both the variance h and the scaling factors af are modeled as functions dependent on the abundance α. note that while variance is trace-independent , each isotope trace has its own scaling function .

alleviating current limitations in isotopic trace extraction
current objective functions for isotopic trace extraction fail to capture isotopic trace behavior formalized in this section: namely, a pattern of centroids forming a generally tight distribution through time around a specific m/z, with variation occurring as a factor of abundance, with normal abundance traces splaying at the beginning and end of elution, and lower abundance traces displaying high m/z variance in general. moreover, isotope traces are skewed in time, with sharp onset of intensity followed by a post-peak long tail. the shape of traces is almost never strictly gaussian , as chromatography almost always deviates from the gaussian in heading  and in tailing . our objective functions account for each of these behaviors.

isotopic envelope extraction
the lc-ms clustering problem is defined as a two-step partitioning problem. in the first step, isotope trace extraction, we require a partition ϕ of the set of all centroids c into the set of isotope traces  f, ϕ={fi}i=1r=fwith the properties:

  ∪i=1rfi=candfi∩fj=∅∀fi≠fj∈f 

in other words, 1) all centroids are assigned to an isotope trace; 2) isotope traces can't share centroids. because any sensor's detection of a physical system will deviate somewhat from the true physical system, we can expect ms detections to contain extraneous centroids. however, all signal ought to be accounted for  and, in a platonic model, ought to be assigned to an isotope trace.

in the second step, isotopic envelope extraction, we require a partition ψ of the set of isotope traces  f into the set of isotopic envelopes ε,ψ={ei}i=1p=εwith the property

  ∪i=1pei=f 

the choice of partitions φ and ψ is guided by a set of distance functions Δ that define distances between centroids, isotope traces, isotopic envelopes, etc. and objective functions λf and λe that describe "good" isotope traces and isotopic envelopes, respectively. the choice of distance and objective functions, along with choice of optimization procedure, characterizes an algorithmic approach for solving this clustering problem. a defining general property of isotopic envelopes, however, is the regular spacing between component isotope traces. in addition, for virtually all molecules from biological sources we expect that if there is an isotope with index j and an isotope with index j +  <dig>  then there exists an isotope with index j +  <dig> 

an isotopic envelope e is the set of isotope traces fi that are produced by a given analyte/charge state combination: e={fi}i=0q subject to the constraint that the m/z difference between each consecutive  isotope trace in e must be equivalent to kze+∈, where k is the mass of a neutron, ze is the integer charge of e and ∈ is a noise tolerance parameter. that is, assuming an indexing function ιµ:ε×n→f that returns the ith least massive isotope trace in an isotopic envelope:

  lμ=lμ=kze+∈,1≤i≤|e|- <dig> 

the m/z m of the jth isotope trace in e must be roughly equivalent to

  m=m˜+jkz 

where m˜ is the uncharged molecular weight of the ion.

every isotope trace consists of signal from at least one isotopic envelope, and, in the case of overlapping isotopic envelopes, an isotope trace may be composed of signal from more than one isotopic envelope.

extant objective functions
featurefinder  <cit>  is an isotopic envelope extraction algorithm in openms that searches directly for e. although the details are not completely clear, it appears that the algorithm attempts to minimize

  λe=∑e∈ε∑c∈ege 

where the ge compute a comparison between the  values for a centroid and the expected centroid values obtained from a heuristic isotopic envelope shape. note that isotopic trace extraction is ignored.

msinspect  <cit> , another approach to isotopic envelope extraction, groups all coeluting signals and compares them to a simulated envelope calculated from a poisson distribution parameterized by m/z, with the goal being to minimize the kl divergence between the poisson distribution and the "distribution" of abundance in an instantaneous profile of the envelope at time τ :

  λe=∑f∈e,c∈τfp^logp^pm 

where the notation c ∈τ f means that c ∈ f at time τ, e is the maximal intensity  isotopic envelope , p^ is the ratio of the intensity of isotope trace f  to the total intensity of all isotope traces f ∈ e , and pm is the value of the poisson distribution at cµ.

proposed objective functions
we propose an alternative objective function for isotopic envelope extraction:

  λe=βie+je,0≤β≤ <dig> 

where β is a relative importance weighting coefficient. the first term computes the deviation of member isotope traces from the expected charge-based m/z interval--we want the isotope traces in envelope e to fit expected m/z spacing:

  i=∑fi,fj∈e∧fiμ<fjμ∧∀fkμ∈efkμ>fiμ⇒fkμ>fjμ∨fk=fj|-kze| 

the second term computes the deviation in elution time of member isotope traces--we want all the isotope traces in isotopic envelope e to co-elute within a small time window:

  j=∑fi,fj∈efiτ-fjτ 

where fτ could be defined analogously to equation  <dig>  could be the maximum intensity for isotopic trace f or could be some other reasonable definition for isotopic trace elution time.

we want to optimize ε and the ze so that λe is minimized; that is, we want to find charge-state/isotopic-envelope pairs such that the errors in expected m/z and co-elution time are minimized.

the isotopic envelope extraction segment of the maxquant  <cit>  algorithm is one of the possible instantiations of this objective function, though many possibilities exist for how to set the allowable m/z and rt error and how to generate the prerequisite list of isotope traces.

alleviating current limitations in isotopic envelope extraction
isotopic envelopes are rich with data: the expectation of contiguous isotope traces with a uniform m/z charge gap, and similar maximal abundance across all isotope traces. accounting for this behavior is not possible without adopting an isotope trace-centric approach to data extraction. reliance upon maximal elution time alone--an approach that is susceptible to conflation with overlapping envelopes in complex samples--is not a sensitive approach in envelopes of lower abundance, where maximal elution times are not pronounced. moreover, by first finding the isotope traces, the exact m/z of each isotope trace can be calculated using a weighted average, alleviating the need for larger than theoretically justified isotope trace gaps, which will not be sensitive in complex samples with overlapping isotopic envelopes. instead, the proposed objective functions leverage a precise and reliable m/z charge gap and adjacency of isotope traces along with maximal elution times, using all the information in the data.

correspondence
the final objective of almost every ms experiment is the differential analysis of more than one ms run. this comparison allows the identification of significant quantity and component differences, useful for applications such as drug design, disease treatment, biological processes research and chemical forensics. correspondence yields a mapping between isotopic envelopes in different runs , a prerequisite for differential analysis.

the combination of noise from within one run  and noise from run to run--most notable in retention time shifts, where an isotopic envelope appears at a different retention time or with a compressed or stretched rt length compared to another run--make lc-ms correspondence non-trivial.

the correspondence mapping should again optimize an objective function which, in turn, characterizes an algorithm choice for solving the correspondence problem.

extant objective functions
according to a recent review on lc-ms correspondence algorithms  <cit> , all extant approaches use either centroid data or a reduction of isotopic envelope traces into a single centroid. of the almost sixty algorithms reviewed there, nearly all use the same objective function--finding a family of one-to-one partial functions χr : εr → ε∗ , where ε∗ is the set of envelopes from a reference run, that minimizes global rt and m/z distance between isotopic envelopes :

  λcorr=∑e∈εrδ)τ,μ 

where δ()τ,µ is a distance function defined over rt and m/z.

the continuous profile model   <cit>  uses a different objective function, and thus is free from the reference requirement that most other algorithms have, allowing for a symmetric solution . additionally, the mapping is somewhat more localized than that of most correspondence algorithms. cpm minimizes the log likelihood of differences between a hidden markov model mτ of the rt of a latent run and observed runs:

  λcorr=logp 

where d is the set of observed runs.

proposed objective functions
in contrast to existing lc-ms correspondence objective functions, the objective functions suggested here use the entire isotopic envelope. this allows greater discrimination by using isotope trace quantity and spacing to match isotopic envelopes from different runs. this extra discrimination is essential given the amount of rt variance and  m/z variance present in the data.

let r be a set of runs, each of which has an associated set of isotopic envelopes εr={eir}i=1pr,1≤r≤|r| and let ε˜=∪rεr. we seek to find a binary equivalence relation ρ that induces a set of correspondence classes over ε˜ that is reflexive , symmetric  and transitive ; and if ρ=true, then for k ≠ i, ρ=false and for k ≠ j, ρ=false .

this relation should minimize

• the difference in charge state between corresponding isotopic envelopes, δcharge.

• the difference in m/z between isotope traces in corresponding isotopic envelopes, δmzit.

• the difference in elution duration between isotope traces in corresponding isotopic envelopes, δdur.

• the difference in isotope abundance ratios between corresponding isotopic envelopes, δratio.

• the difference in m/z between corresponding isotopic envelopes, δmzie.

• the number of singleton correspondence classes, δorphan.

• the difference in retention time between corresponding isotopic envelopes, δrt.

an objective function incorporating all of these variables can take many forms, with perhaps the simplest generalization being a weighted linear combination, with weighting coefficients ω allowing relative prioritization:

  λcorr=∑ρωchargeδcharge+ωmzitδmzit+ωdurδdur+ωratioδratio+ωmzieδmzie+ωorphanδorphan+ωrtδrt 

with the summation over ρ meaning a summation taken over all pairs of envelopes e <dig>  e2∈ε˜ for which ρ = true. given the weighting coefficients ω, the most desirable correspondence would be that induced by the relation ρ* that minimizes λcorr ,

 ρ*=argmin λcorrρ 

alleviating current limitations in correspondence
recently, several ubiquitous shortcomings were identified in a review of over  <dig> lcms correspondence algorithms  <cit> . the most significant of these shortcomings was the fact that all current lc-ms correspondence algorithms make model assumptions that fail to capture common behavior. in other words, each algorithm is constructed in such a way that the algorithm is guaranteed to get the wrong answer under certain conditions that are common to real lc-ms data. the behaviors discussed included the ideas that:

• not all analytes appear in all replicates.

• elution order can swap.

• shifts occur in m/z as well as in rt.

some correspondence methods reduce isotopic envelopes to a single point representation. this deprives the method of a rich source of distinguishing data found in full isotopic envelopes--the expectation of contiguous isotope traces with a uniform m/z charge gap, number of isotope traces, and relative abundance ratio of isotope traces. similarly, most correspondence algorithms conduct an initial rt alignment, where signals  are shifted up or down in rt  in order to most closely match a reference run. this is invariably followed by direct matching. the problem is that the initial warping is a lossy procedure that adulterates the original rt time, which would be useful to probabilistically ascertaining the closest corresponding isotopic envelope.

the proposed objective function does not force matches between runs, as it is very common for species to either not be present or fall below the signal-to-noise ratio in differential studies. instead, the proposed objective function leverages the full breadth of isotope envelope information, allowing a rigorous direct comparison of candidate correspondences based on all available data to select the most likely correspondence , or no correspondence at all if that is the most likely case given the data.

CONCLUSIONS
we present a concise attempt to formalize lc-ms data clustering problems, describing the constructs of isotope traces and isotopic envelopes and their relational structure. we provide a review of current approaches to isotope trace extraction and lc-ms correspondence, and propose novel objective functions for both tasks that address shortcomings in current methods.

competing interests and declarations
the authors declare that they have no competing interests. the publication costs for this article were funded by the university of montana office of research and sponsored programs.

this article has been published as part of bmc bioinformatics volume  <dig> supplement  <dig>  2015: selected articles from the 11th annual biotechnology and bioinformatics symposium : bioinformatics. the full contents of the supplement are available online at http://www.biomedcentral.com/bmcbioinformatics/supplements/16/s <dig> 

authors' contributions
rs, jtp and dv all contributed in writing this manuscript.
