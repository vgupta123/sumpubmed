BACKGROUND
the application of microarray technology to study the expression of thousands of genes in biological samples has become commonplace. the diversity of technologies initially explored has been replaced by a landscape dominated by a small number of proprietary platforms, which differ principally in the type of probe used for hybridisation. each platform has advantages and disadvantages, and knowledge of technical reproducibility and sources of data variability is crucial to optimising experimental design and data analysis. the reproducibility and comparability of several different platforms has been rigorously examined in the maqc project, and overall the different platforms give reassuringly similar results, with similar accuracy and sensitivities  <cit> .

we have collected a large number of array data sets from agilent human genome arrays  <cit> . the latest releases of these arrays have approximately  <dig> features, which include various control oligonucleotides, and a set of  <dig> different oligonucleotide  <dig> mers complimentary to unique human mrna sequences. of these  <dig>  the latest agilent annotation lists  <dig>  as corresponding to known genes and/or orfs, of which  <dig> are unique. around  <dig> probes correspond to as yet unannotated stretches of human genome. the agilent platform is designed to be used as a two colour system, probing and then detecting hybridisation of two different cdna samples labelled with different fluorescent dyes on the same array .

although there are now many published studies using the agilent arrays, there is a paucity of studies systematically investigating the reproducibility and sources of variation in this microarray platform. there is also relatively little software for implementation of data preprocessing for this platform. using a set of data generated from this array platform, we dissect the major contributors to experimental variability within the data. we develop a new r package  to extract data from agilent raw data files, and implement a robust loess normalisation to a mean of multiple experiments. this reduces variability to a level which allows accurate and informative comparisons between array data sets collected at different times and by different operators. we also demonstrate that the low level expression detected by the agilent arrays for the majority of genes in any one cell type likely corresponds to a genuine high degree of transcriptomic complexity, and is unlikely to arise from weak non specific cross-hybridisation. the results of the study thus give confidence to studies which use this technology and quantify important performance parameters which can be used to optimise the design and interpretation of future transcriptomic experiments.

RESULTS
impact of logarithimic transformation
we initially examined a set of  <dig> data sets  collected in our laboratory over a period of about three years. in each experiment the agilent human whole genome expression arrays were probed with a mixture of two cdna preparations labelled with cy <dig> and cy <dig> respectively. the cy <dig> sample in every experiment was a sample of "reference" cdna prepared from the stratagene universal human reference reagent. the same batch of reference rna was used in all cases, although several different batches of labelled cdna were made. the cy5-labelled cdna was prepared from rna extracted from monocyte derived macrophages or dendritic cells, or the mutz- <dig> leukaemic cell line cultured and/or stimulated in a variety of different ways. a summary of the cell type/experimental stimulus for each array is provided in additional file  <dig> table s <dig>  the cy <dig> channel for this first set of arrays therefore always provided data for the experimental sample, while the cy <dig> provided data for the reference.

the raw output from the scanner shows a large dynamic range from around  <dig> to  <dig> arbitrary units. these data are commonly log transformed prior to manipulation, in order to make the standard deviation  independent of magnitude, and improve the fit to a gaussian normal distribution. both these assumptions were therefore tested on the set of reference arrays.

the relationship between sd and mean magnitude of signal across the arrays for each array feature, using raw and log <dig> transformed data is shown in fig 1a. using a simple linear model, the sd of the raw data can be seen to be magnitude dependent . log <dig> transformation substantially stabilises the sd . further loess normalisation as described in detail below stabilises the sd even further .

the normality of the distribution of the signal across the arrays was tested using the shapiro wilk test for each probe individually. the fit varied widely for different probes. however, the proportion of probes whose distribution did not differ significantly from normality  increased from 55% to 78% when log <dig> transformed data were analysed. log <dig> transformed data were therefore used for all further analysis.

variation attributable to intra array "experimental error."
variation in signal between features with the same probe sequence  provides a good measure of intra-array variation. this variation can be evaluated using  <dig> oligonucleotides which are replicated  <dig> times in different positions of the  <dig> ×  <dig> human genome agilent arrays, and a "negative control" oligonucleotide  which is present  <dig> times. the average sd for each set of  <dig> replicates for each of these  <dig> probes  was calculated. the calculation was repeated for data from five randomly chosen arrays. the average sd was  <dig>  log <dig> units for the cy <dig> signal, and  <dig>  log <dig> units for the cy <dig> signal . the cy <dig> and cy <dig> signal within each set of replicates within a single array was highly correlated, suggesting the variation was due to local differences . however, the sd represented only 2% of the mean log signal for all these replicate probes, highlighting the reproducibility and homogeneity of array construction. further analysis used the within array average of replicate probes.

 <dig>  the sd for cy <dig> and cy <dig>  and the correlation and covariance between cy <dig> and cy <dig> signals, was calculated across all replicates for each probe which is represented by multiple within array replicates. the table shows the average of these sds for all this subset of replicated probes, from a random sample of five arrays.

 <dig>  the sd for cy <dig> and cy <dig>  and the correlation and covariance between cy <dig> and cy <dig> signals, was calculated for each probe across all  <dig> arrays, and then averaged across all probes.

 <dig>  the data were first normalised as detailed in text and legend to fig 2

 <dig>  the sd of the ratio of cy5/cy <dig> signal was calculated using equation  <dig> in text.

variation attributable to inter array experimental "error."
we next examined the variation which arises from experiments involving different arrays. in order to isolate the variation arising from technical variables  from variation arising from differences in the biological samples being tested, we first analysed variation in the cy <dig> signal, which represents hybridisation of an identical biological sample  <dig> times . the average sd for each probe across the arrays for the cy <dig> signal was  <dig> , representing  <dig> % of the mean signal. by comparison, the sd for the cy <dig> channel, which includes additional variation from biological variables , as well as unknown intrinsic biological variability was  <dig>  .

reduction in variability by normalisation via linear regression
in order to reduce variability by correcting for systematic differences between arrays we normalised the data by simple linear or loess local linear regression against the mean signal of all the samples .

to illustrate the effect of the normalisation, the cy <dig> probe signal intensities from two sample arrays are plotted against the average probe signal calculated from all the arrays . it is evident that for the first array, the linear fit is relatively good across the whole range of data, but there is a systematic decrease in signal intensity across the whole range relative to the mean . the normalisation of this array by subtraction of the regression model provided appropriate correction of the signal values . in the second example, the linear fit is less good , and a local linear regression model  gives a better overall fit . the normalisation of this array by subtraction of the regression model provided appropriate correction of the signal values .

x is the mean cy <dig> signal from each probe across all  <dig> arrays.

 is the linear corrected cy <dig> signal from each probe from array n given by:

= yn-- x) where α and β are the intercept and slope of the linear regression of yn on x.

 is the loess corrected cy <dig> signal from each probe from array n given by:

 where α and β are the set of intercepts and slopes of the loess linear regression of yn on x, dividing the range of x into  <dig> equal segments.

panels a) and b) show data for n =  <dig>  c), d) and e) show data for n =  <dig>  the dashed line shows x = y; the solid line shows the fitted linear regression. the thick solid line shows the fitted loess regression.

we applied both simple linear and loess local linear regression  across the whole set of arrays. using the normalised data, we calculated the average sd for each probe  across the set of arrays . linear regression normalisation decreased the average sd of the cy <dig> reference array data set to  <dig> . loess normalisation decreased the sd further to  <dig>   . 95% of genes had a sd <  <dig>  log <dig> units. the equivalent sd values for the experimental  data were also correspondingly decreased . we also evaluated quantile normalisation, the preprocessing normalisation implemented in the widely used affymetrix rma  <cit>  method, which reduced the average sd for the cy <dig> channel to  <dig> .

further reduction of variation by normalisation via ratio to the reference sample
we next examined whether using the ratio of experimental to reference signal for each probe introduces significant further benefit, as reflected in a further reduction in variation of the data. the sd of the difference between the two data sets "reference" and "experimental" is given by:   

the covariance between experimental and reference signal was therefore calculated for each probe across the set of arrays . the average covariance for all probes was then used to calculate the corrected sd of the difference  between experimental and reference data sets. using the ratio for each probe slightly decreased the overall sd of the normalised data . the "probe specific" normalisation therefore provides an additional small benefit  over and above the global normalisation introduced above.

unexpectedly, for probes showing the biggest stimulation indices , the stimulation index in the green channel is positively correlated to the stimulation index observed in the red channel. this effect is only seen at high stimulation indices, and the correlation is lost once the difference in signal is less than  <dig> log <dig> units.

the phenomenon is illustrated in fig  <dig>  loess normalised data was obtained from two sets of arrays of human macrophages, one from a sample of unstimulated macrophages and one from macrophages stimulated for four hours with interferon beta. the signal obtained in the presence of interferon was then subtracted from that in the absence of interferon  for each gene. the top  <dig> stimulation indices obtained in this way  were plotted against the ratios observed for the corresponding green reference channel for the same probe  . a similar apparent interference  of the green signal by a large change in red signal was observed in several other independent experiments. in order to test that the enhancement was not a result of optical crossover , an array was hybridised with cy <dig> labelled dna only. the maximum signal observed in the green channel was less than 1% of the equivalent red signal, even at the highest levels of red fluorescence. the molecular basis for the interference between binding of the two differentially labelled samples remains unknown, but the phenomenon has implications both for using red/green ratio measurements, and for experimental design which are discussed further below.

low intensity signals in agilent array hybridisation
one feature of agilent arrays is a very large number of probes have a low signal value, close to, but significantly above background. this is illustrated by a comparison between the signal distribution obtained from one representative sample compared to the distribution of the signal from the "negative control" probe provided by agilent .

these data might support a hypothesis that a large number of genes are being transcribed in any one cell type. however, the conclusion is reliant on the the negative control supplied by agilent. we therefore tested the hypothesis independently. in view of the very large evolutionary distance between arabidopsis and humans, and the process of agilent selection of probe sequences so as to avoid repetitive elements or highly conserved common sequences, we predicted that the plant rna samples should show very little true hybridisation to the arrays. in contrast, if the low level signals were as a result of random low stringency interactions, this should occur to a similar extent using the plant as the human samples. the log signal frequency distribution for the average of three arabidopsis samples  was compared to the signal distribution for human samples . the majority of the probes from the arrays hybridised to the arabidopsis samples gave signals close to or just above the background probe.

the data from the arabidospis samples could be used to calculate an upper limit for "false positive" detection, and hence estimate the proportion of probes showing real positive signals with the human samples . in order to analyse the data, we calculated the% of probes showing a positive signal at a range of arbitrary cut-offs above the background probe signal. as discussed above, the % probes showing a positive signal falls off slowly as the cutoff is increased, remaining above 60% up to  <dig>  log units above background. in contrast, the % probes showing a positive signal with the plant array samples fell off sharply with cut-off. for example, at a cutoff of  <dig>  log units above background, less than 5% probes gave a positive signal, in contrast with 65% when using the human sample.

array reproducibility viewed through multidimensional scaling
having established the basic parameters of error/variability, we examined whether global patterns of gene expression were reproducible and robust when comparing data collected over a time period of several years, and by different operators. the same data set of arrays log <dig> transformed and loess normalised as detailed above were analysed using classical multidimensional scaling , a powerful unsupervised approach to identify relationships between sets of arrays. since the distance matrices are based on euclidean distance metrics this analysis is mathematically equivalent to principal component analysis.

a first step in mds is to establish the number of dimensions which provides a reasonable compromise between preserving the main features of the data, and minimising complexity. one common approach is to plot the principal eigenvalues  to look for an obvious "step" in the slope . there appear to be discontinuities at dimension  <dig> and again at 10/ <dig>  we therefore calculated the goodness of fit parameter pk for different numbers of dimensions :   

k is the number of dimensions, n is the number of arrays, and λi is the ith eigenvalue. a value of around  <dig>   has been proposed as a good cut-off for adequately representing the original data . ten dimensions were therefore analysed. the justification for including this unusually large number of dimensions is discussed further below.

we first examined the distribution of arrays from the point of view of cell type . the range of y values decreases with increasing dimension, illustrating the expected decrease in overall variance. the major cell types are clearly segregated within the first few dimensions. dendritic cells and macrophages are well separated in the first dimension, irrespective of stimulus, or other experimental variable. the dendritic cells derived from the mutz <dig> myeloid leukaemic cell line  <cit>  map with dendritic cells in the first dimension but segregate away in dimension  <dig>  the variance in dimension  <dig>  in contrast, seems to reflect differences largely unrelated to cell type.

we next examined the distribution in relation to stimulus . the dendritic cell response to lps is clearly identified in dimension  <dig> and  <dig>  interestingly, a set of  <dig> non-stimulated dendritic cell cultures also co-cluster with the lipopolysaccahride  activated cells. further inspection revealed that these three cultures were derived from monocytes all from the same individual, suggesting that these dendritic cells may have been already "activated" prior to addition of lps. such "spontaneously activated" dendritic cells are a common observation in our experience. a second interesting observation is that the impact of lps on macrophages  is seen in dimensions different to that for dendritic cells  . these results suggest that the transcriptional response of macrophages and dendritic cells to the same stimulus is made up predominantly of different sets of genes.

we carried out two additional sets of hybridisations to test the reproducibility of the arrays over time. two old samples of macrophage rna  were relabelled in cy <dig>  and hybridised to new arrays together with old stored cy <dig> labelled samples . the old and new arrays cocluster, irrespective of dye labelling or long term storage . in particular, all three sets clearly cocluster with the lps response group within the key "macrophage lps response " dimensions  <dig> and  <dig>  interestingly, the different repeats do segregate away from each other in other dimensions , suggesting that differences due to experimental protocol can be distinguished from true biologically interesting changes using this multidimensional approach to data analysis.

in addition, we analysed a set of  <dig> newly prepared mutz- <dig> derived dendritic cell arrays  including a set of three additional unstimulated cultures . all twelve sets cocluster with the old mutz- <dig> dendritic cells in dimensions  <dig> and  <dig> . experimental variation which may reflect batch differences between the first and second set of experiments is also detectable in higher dimensions .

discussion
in this study, we have developed a pipeline for processing and analysis of data obtained using the agilent human  <dig> k expression array platform. we have assessed commonly adopted preprocessing computational procedures, tested reproducibility of the method and the determinants of variability. interestingly, investigation of the true background signal intensity, suggested that there is low-level transcriptional activity across most of the genome even in highly differentiated macrophages and dendritic cells. finally, we have illustrated the application of multidimensional scaling to interrogate complex relationships between individual expression profiles in a large data set.

we confirmed that logarithmic transformation of the raw data facilitates downstream data processing by significantly reducing the dependence of the sd on the signal intensity, and by improving approximation to a normal distribution for many probe signals. log <dig> transformation did not completely standardise variance vis a vis intensity, and in situations where this becomes critical, additional more complex alternative transformations can easily be incorporated e.g.  <cit> .

a large number of different approaches to data normalisation have been explored in order to improve the reproducibility of array data, particularly with the objective of comparing data generated from different experiments  <cit>  . many of these were designed for the affymetrix platform  and are not readily implemented for the agilent platform . nevertheless, we compared the loess normalisation used in this study to the quantile normalisation which is the basis for data preprocessing in rma and rma based packages  <cit> . quantile normalisation and loess normalisation reduced the average standard error of the data similarly. however, as discussed in the original implementation of the rma normalisation algorithm  <cit> , quantile normalisation may "overnormalise" giving identical or very similar values at the extremes of the quantile range. this problem is less serious in dealing with data from the affymetrix platform, which uses multiple probe sets per gene, and has inter probe variances often greater than the inter array variance. one of the most detailed published comparisons of alternative normalisation approaches did also include a baseline loess normalisation procedure similar to the one used here  <cit> . the study found relatively subtle differences between normalisation techniques, but did not report absolute levels of error, rendering comparison difficult.

the use of two colour ratio normalisation, which is possible with the agilent platform but not affymetrix, is in fact implemented in the proprietary normalisation supplied by agilent. the advantage of this normalisation, over global array normalisations, is that it can theoretically correct for probe specific systematic errors. however, as shown in equation  <dig>  ratios decrease variance only when correlation between channels is high, and noise in the "reference" channel is small. previous studies have in fact suggested that the agilent normalisation protocol is sub-optimal. in fact, as illustrated in table  <dig>  the actual decrease in variance observed by introducing ratio normalisation with the two colour array signals is very modest. this modest gain needs to be weighed against disadvantages of the ratio measure. firstly, ratios behave counter intuitively in terms of biological processes at both extremes of the signal range, adopting increasingly large negative values which tend to infinity as the experimental signal approaches zero. secondly, we detected an unexpected interaction between independent cy <dig> and cy <dig> signals at high signal intensities, although the mechanisms remains unclear. although the effect is only seen for a small number of genes, it may nevertheless prejudice the outcome of experiments which use a reference sample in one channel. overall, the use of the two colour format to run a reference array for each experimental sample is not supported by our study, a conclusion in line with previous studies  <cit> .

in summary, the preprocessing steps implemented in this study significantly reduce the variation due to experimental, rather than biological variation. this value provides a good estimate of the overall sd of the signal attributable to the various sources of intrinsic "experimental error". given the gaussian nature of log signal variation for most probes, differences between experiments of one log <dig> unit should be detectable even with rather low sample sizes. however, future studies using spike-in controls, and including comparisons to q-pcr data will be required to validate the analysis given here, and to determine the true discriminatory power of the data. more precise modelling, using probe specific variances computed from the large set of reference arrays, or more sophisticated bayesian inference  <cit> may further improve the quality of the data.

the presence of a very large number of probes showing low level hybridisation prompted us to try and distinguish background from low level gene transcription. hybridisation of the arabidopsis samples established a realistic background cut-off to determine the boundary at which genes may be considered to be on or off, and showed transcriptional activity for approximately 70% within human macrophage samples. this degree of transcriptional diversity suggests transcription is going on across the majority of the genome even in a single cell type, and is in accord with recent estimates of cell transcriptional complexity obtained from deep sequencing  <cit> , and also with the recent upward revision of estimates of the frequencies of transcriptional start sites within the human genome  <cit> . this data cannot however address the question of whether the mrna message are translated or even complete.

in general, the power of genome-wide arrays lies in its ability to define a global transcriptomic response, made up of complex patterns of interacting genes. in order to analyse the extent to which these patterns remained reproducible and robust in the face of experimental error and variation, we used mds which is equivalent to principal component analysis for continuous euclidean distance measurements and retains more of the information than conventional hierarchical clustering.

mds analysis of the macrophage/dendritic cell data set  confirmed that the key underlying structure of the data set is robust, and that sample relationships are conserved even when samples are collected at different times, and by different operators. for example, the distinction between macrophages and dendritic cells, between normal and leukaemic dendritic cells, and between resting and lps stimulation were all very robust to underlying experimental variation. of interest, the biologically meaningful variables such as those described above, usually segregated from the "artifactual" variables  into a different dimension. since the mds axes are orthogonal this suggests that the biological and artifactual variables are often determined by non-overlapping sets of gene probes, and the identification of these genes is the subject of on-going analysis.

CONCLUSIONS
agilent long oligonucleotide expression arrays represent a robust and increasingly affordable tool for mapping transcriptional activity within the majority of human open reading frames. with correct data processing and normalisation, the genewise variability can be reduced to a few % of the average signal intensity. the pipeline of protocols for data collection, processing and subsequent analysis developed in this study  allows robust, and reproducible identification of small gene differences, and reliably preserves the complex transcriptomic relationships associated with important biological variables. importantly, the common custom of using ratios of signals in the two channels is shown to be redundant, and indeed in certain situations, to reduce the sensitivity of the analysis. furthermore, the sensitivity of the system allows detection of a large number of low abundance transcripts and confirms the widespread transcriptional activity even within a single cell type.

