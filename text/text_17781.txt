BACKGROUND
liquid chromatography-tandem mass spectrometry  analyses typically leverage database search tools  <cit>  to accurately identify analytes  from tandem mass spectra. in proteomics, search tools utilize a protein sequence database to generate in silico spectra that are statistically matched to the empirical spectra in order to assign the best amino acid sequence to the spectrum. these peptide sequences along with their mass and chromatographic elution time information are often stored in a reference peptide database that serves as a look up table for identifying peptides in subsequent higher-throughput, high-resolution lc-ms analyses  <cit> . the resulting lc-ms spectra are deisotoped using decontools  <cit>  or similar software that applies algorithms such as thrash  <cit> or rapid  <cit>  to obtain monoisotopic mass and elution time features. once aligned, these features are matched to appropriate reference databases using software such as viper  <cit> , maxquant  <cit> , msinspect  <cit> , mzmine  <cit> , or specarray  <cit>  for peptide identification and/or quantitation.

when a database is not available or is incomplete, as is often the case in environmental proteomics studies, peptide sequences are identified using alternative approaches, such as de novo sequencing or by combining multiple genomes to form a pseudo metagenome  <cit> . reference peptide databases generated from these approaches tend to be error prone and poorly represent the sample proteome, which results in a substantial number of unidentified  features and a failure to adequately capture proteome dynamics. liquid chromatography-mass spectrometry-based global metabolomics studies are similarly challenged in that constructing a representative database for identifying metabolite features is difficult due to the lack of available metabolite standards, which often results in an incomplete identification.

herein we introduce multialign, a public domain software tool designed to overcome lc-ms data analysis challenges stemming from the lack of a reference database. with multialign, multiple datasets are aligned by clustering mass and lc elution time features. in addition to revealing the presence/absence of features and differences in relative abundance from proteome or metabolome profiles, the software can cull a set of features for targeted peptide sequence or metabolite assignment via a traceback capability that links clusters of lc-ms features across numerous experimental runs to tandem mass spectra. this multi-alignment strategy is advantageous in that patterns among lc-ms global proteome profiles can be evaluated in the absence of reference databases, which is appealing to environmental proteomics applications, such as characterization of microbial communities that lack genome sequence information, as well as to other omics-based applications, such as metabolomics. while the comparative multi-dataset analysis approach is similar to that of xcms  <cit> , which is primarily used to process metabolomics data, multialign is applicable to both proteomics and metabolomics data and allows for peak matching lc-ms data to reference databases . furthermore, multialign supports full traceback from feature clusters to parent and corresponding tandem mass spectra.

implementation
multialign is a multiple dataset analysis tool for clustering aligned lc-ms features  across lc-ms experimental runs. provided a reference database exists, these clusters can be matched to the database for peptide sequence assignment. multialign also performs ms/ms spectral clustering to facilitate proteome structure characterization .

architecture
the basic architecture of multialign is depicted in figure  <dig>  the software is written on .net framework version  <dig> , using c# for the presentation layer, and a mixture of standard c++  and c# for the computational engine. a c++/cli adapter marshals data between c# and c++/cli managed and unmanaged interfaces when features in the c++ engine are required. results are persisted to a sqlite database. a graphical user interface is provided with the microsoft windows application version. interactive feature scatter plots, heat maps, histograms, and line charts are created using a custom visualization package that can handle millions of data points by leveraging fast bitmapping techniques via gdi + library calls. a command line version is also supplied as an alternative to the user interface.

data structures
multialign uses four simple data objects: ms features, lc-ms features, lc-ms feature clusters, and lc-ms/ms-generated accurate mass and normalized lc elution time features referred to as amt tags. an ms feature represents the peaks of an isotopic distribution of peptide ions resulting from the deisotoping of an lc-ms spectrum using the thrash algorithm  <cit> . each ms feature is described by a monoisotopic mass, charge, and retention time. an lc-ms feature is a group of ms features common to a monoisotopic mass observed across elution time , whereas an lc-ms feature cluster is composed of lc-ms features observed across multiple aligned datasets. an amt tag feature is represented at the most basic level by monoisotopic mass, globally averaged normalized elution time  between  <dig> and  <dig>  and a peptide sequence. these features are stored in a reference peptide database referred to as an amt tag database. fragmentation spectra are represented by the msn spectra object by a precursor m/z linked to ms features within a given elution time.

algorithm
four major processing components exist in the computational layer: lc-ms feature finding, lc-ms feature alignment, lc-ms feature clustering, and peak matching to an amt tag database. this computational workflow is similar to that of viper  <cit>  , an existing lc-ms proteomics analysis tool, but with the addition of a clustering step that allows multialign to perform dataset-to-dataset analysis in addition to finding unattributed features common across datasets. multialign also provides a traceback capability that links lc-ms feature clusters to ms/ms spectra for use in peptide sequence assignment approaches that do not rely on database searches, e.g. de novo approaches.

lc-ms feature finding
peptides separated via lc are detected across several mass spectra at various charge states . respective isotopic distributions of ionized peptides can be resolved to a single monoisotopic mass after normalizing by charge  <cit> , which results in an ms feature. the feature finding component clusters these ms features into an lc-ms feature, using a mass tolerance window in parts per million  and assigns a representative lc scan based on the maximum signal intensity of the eluting lc peak. this clustering step uses a single linkage clustering algorithm with a weighted l <dig> norm distance calculation based on mass, elution time, and intensity; weights are user definable. feature abundances are reported as the sum of monoisotopic peak values from all clustered ms features. the output database links feature data to scans from the instrument files, which allows researchers to develop custom quantitation algorithms to suite their specific applications.

when running on a hybrid instrument, multialign will ingest raw data files  to link ms features found by thrash to ms/ms spectra by searching daughter scans  that have similar parent masses. the algorithm hashes all ms scans and then stores the ms/ms scan indices after which the precursor m/z from the ms/ms spectra is compared to the m/z of the ms feature. all matches are linked and stored in the results database. the end result is the ability to query all clusters and/or lc-ms features for which there is ms/ms spectra that can be exported to peptide identification tools, e.g., peptide spectrum match search and de novo approaches.

alignment
to correct for systematic variation in elution time and mass measurement accuracy, multialign uses the lcmswarp algorithm  <cit> , a dynamic time warping approach. this algorithm computes a piecewise linear alignment function to calibrate the monoisotopic mass and transform scan number of each ms feature to the net so that lc-ms features can be compared across datasets.

multialign uses one of two alignment strategies. the first strategy is similar to viper  <cit>  in that it aligns a single dataset to an amt tag database. the second strategy, which is useful when no amt tag database is available, aligns a dataset to another reference dataset. the analysis tool is capable of loading several datasets at once for subsequent pair-wise alignment.

multialign also produces heat maps for visualizing how well a dataset aligns to a database or to a dataset. these heat maps display alignment probability scores between scans of the aligned and baseline data  <cit> . ideally, one sees a bright linear yellow trend line from the lower left coordinate to the upper right, which indicates little retention time and mass variation between data.

clustering
if a peptide is represented across multiple lc-ms acquisitions obtained under similar conditions, then it should be visible as an lc-ms feature across all datasets. multialign finds these common lc-ms features via average or single linkage clustering . both algorithms initially treat each lc-ms feature across all datasets as a singleton cluster. these clusters are then iteratively merged based on minimum values in a distance map; single linkage merges are based on the shortest distance and average linkage merges, on average centroid distances. in the single linkage algorithm, clusters are merged only if they are within monoisotopic mass tolerance  and net. these tolerances can be defined by the user based on knowledge of instrument performance. clusters are assigned a score as to the mean l <dig> distance of each feature to the cluster centroid. this cluster score describes the overlap of lc-ms features in mass and retention time space across runs.

both clustering algorithms use a simple mass partitioning approach to improve run time performance. the entire feature space from all datasets is sorted based on monoisotopic mass. gaps in the list are identified based on the mass tolerance  between two consecutive features, which provides a 33-fold increase in speed and improves multiple dataset analysis runtime. each cluster is assigned two scores, the first of which calculates the mean l <dig> distance of all features to the cluster centroid based on monoisotopic mass and net. this score reflects tightness where the smaller the tightness, the more confident the cluster. the second score addresses ambiguity; that is, given any two clusters, what is the potential that they are indistinguishable by their dimensionality . if two clusters are close in monoisotopic mass and net space, then the cluster is considered to be ambiguous. an ambiguity score is calculated as the minimum l <dig> norm distance between any two features from neighboring clusters. as the score approaches zero, the distance between pair wise members is small and indicates an ambiguous cluster. these scores serve as filtering metrics to find clusters of similarly eluting features across datasets in downstream analysis, e.g. presence/absence and relative quantitation.

peak matching
when an amt tag database is available, multialign performs peak matching to assign peptide sequences to lc-ms features. peak matching is accomplished by using simple range queries with monoisotopic mass ppm and net. however, a single lc-ms feature can be matched to multiple peptides, thus making the identification ambiguous. we utilize the stac algorithm  <cit>  to quantify the goodness of match for a cluster and an amt tag in what is called the stac score. the stac algorithm also provides an orthogonal score  that assesses the uniqueness probability of each match in the case of multiple amt tags matching the same cluster, i.e., for a given cluster that matches to multiple mass tags, the uniqueness probability describes which match is the most likely.

spectral clustering
when ms/ms spectra are available, multialign can cluster the spectra across multiple samples by implementing an algorithm similar to that of mscluster  <cit>  except that it incorporates retention time information at the ms feature level, which allows spectral databases to be constructed. this clustering method is a hierarchical approach analogous to that used for clustering lc-ms data. first, ms/ms spectra that belong to lc-ms features are considered for clustering, which limits the number of ms/ms spectra to be clustered. as spectra must have a representative elution profile  gained from the lc-ms feature finding step, the chance of transient ms/ms spectra  entering the analysis is reduced. the ms/ms spectra are then compared across datasets, and the spectral similarity is computed as the normalized dot product of the ion series.

visualization
multialign has several visualization capabilities, including a fully interactive graphical user interface . the gui parameter file editor  can be used to edit parameter files, as well as to export parameters to hyper text markup language  for easier review. multialign also provides a fully functional gui application that includes a wizard to guide the researcher through the analysis steps. the wizard is a series of views from which to load data from a data management system  <cit>   or local disk, load setup algorithm parameters, and define the output folder. when the analysis is complete, results are displayed in a data view window that facilitates further investigation of features, clusters, and matched peptides when using an amt tag database. the data view displays all of the results along with interactive plots  that show feature distributions, cluster scores, and error histograms . the data view also provides an interface to review the parameters used and includes summary information about the number of features found, clusters identified, and peptide sequences identified. lastly, a report is generated in html that contains the plots generated in the data view. this report is packaged with the analysis file and provides users with a way of distributing a data overview to others.

parameters
parameters for all algorithms can be modified through the user interface in the analysis wizard or in the standalone parameter file editor. they also can be adjusted, persisted, and/or loaded in the xml formatted parameter file described in additional file 1: table s <dig>  parameter options include feature loading filters for isotopic fit scores and abundances. feature finding parameters include mass tolerance  and scan tolerances.

file formats
multialign data input formats are in decontools “isos” csv format, icr2ls “pek” csv format, and in an lcms feature tab delimited text file of clustered decon2ls results. two forms of data output files are available:

 <dig>  sqlite database: this file is an open source-based formatted database that stores pertinent analysis data, and is the main file export format for analysis. the database allows the full traceback to occur from a cluster of features across datasets to an associated ms/ms spectrum. the database schema is published in the data tutorial hosted on the project website  under the tutorials section.

 <dig>  cross tab: this format is a flat comma separated variable  file whose rows are clusters and whose columns are attributes about the cluster and features that comprise it.

RESULTS
multialign was applied to two environmental proteomics datasets and to a metabolomics dataset to demonstrate its different operational modes. the first application involved a re-analysis of published data  <cit>  acquired from planktonic biomass for which a pseudo metagenome sequence and an amt tag database were available. in the second application, multialign was used to analyze datasets acquired previously for a microbial community biomass that did not have a metagenomics sequence. these two applications demonstrated the dataset-to-database and dataset-to-dataset alignment capabilities of the software. we also analyzed datasets from a metabolomics study of mitochondrial fatty acid, which demonstrated the applicability of the software to other lc-ms-based omics datasets.

proteomics dataset-to-database alignment
multialign was initially applied to re-analyze  <dig> lc-ms datasets of digested proteins extracted from a groundwater monitoring well sample  <cit> . the sample was collected during acetate addition to a uranium contaminated aquifer during a biostimulation field experiment conducted at the u. s. department of energy’s integrated field research challenge site . the proteomics data were generated using an ltq-orbitrap mass spectrometer  operated in hms-msn mode  and coupled to an on-line reverse phase separation of peptides using hplc. detailed operating conditions of both the mass spectrometer and hplc system are described elsewhere  <cit> . deisotoped lc-ms spectra  <cit>  were analyzed using multialign and viper  <cit>  for comparison. the lc-ms features were peak matched to an amt tag database that previously had been generated using lc-ms/ms spectra from the  <dig> datasets and a concatenated set of bacterial genome sequences for iron reducing bacteria  <cit> .

results from the lc-ms feature finding algorithm in multialign ranged from  <dig>  to  <dig>  lc-ms features per dataset, which is comparable to feature counts per dataset obtained using viper. features identified from both software tools were aligned to mass and net information in the amt tag database that represented  <dig>  fully tryptic peptides  <cit> . retention time alignment was performed in a pair-wise fashion, whereby each dataset was aligned to the database. alignment heat maps for both software tools demonstrate comparable analyses . noticeable differences between these heat maps may reflect differences in the feature sets as a result of the different lc-ms feature finding algorithms and/or the plotting tools used to create the heat maps. furthermore, the noticeable deviant line observed in many of the heat maps for both multialign and viper indicates potential differences between the database and each dataset  <cit> . this deviance in alignment most likely originates from matches that are similar in mass, but differ in peptide sequences; a common occurrence when analyzing microbial community samples because the database derived from the metagenomics sequence is not comprehensive.

following this initial comparison, multialign was used to cluster aligned lc-ms features across datasets, after which the cluster centroids were matched to the amt tag database. in this analysis  <dig>  non-singleton clusters  were observed; however, only  <dig> clusters matched unambiguously  to a single database peptide, which left approximately 86% of the clusters not conclusively identified. a total of  <dig> clusters  had features present across all  <dig> lc-ms instrument runs. to increase confidence as to which clusters were real, we removed clusters that had an ambiguity score < <dig>  which left  <dig> clusters with lc-ms features present across all datasets. of these clusters, only  <dig> had unambiguous matches to database peptides, leaving  <dig> unidentified clusters for further investigation.

the small number of unambiguous clusters with features present in all datasets suggests a large difference in both temporal and spatial conditions, which supports previous observations that suggested large differences in community structure in both temporal and spatial conditions  <cit> . unlike viper, multialign has the added functionality of being able to look across all datasets and then peak match to a database to confidently identify features. furthermore, when there is no database available, multialign can discover features present across some or all conditions to guide further experimental development.

proteomics dataset to dataset alignment and traceback to ms/ms spectra
multialign was also applied to proteomics datasets acquired from an anaerobic microbial community capable of degrading microcrystalline cellulose . the community was grown in a bioreactor seeded with biomass obtained from cow rumen. proteins extracted from five samples harvested  <dig>   <dig>   <dig>   <dig>  and 20 days after bioreactor start-up were digested and analyzed using lc-ms with an ltq-orbitrap velos mass spectrometer  and custom four column hplc . liquid chromatographic separations were performed using 3-μm jupiter c <dig> stationary phase  packed into a 70-cm length of 360 μm o.d. × 75 μm i.d. fused silica capillary tubing . the column was equilibrated with 99% mobile phase a  and 1% mobile phase b  prior to sample injection onto a  <dig> μl sample loop. automated switching of valve positions transferred the sample to a solid phase extraction column  for 7 minutes at flow rate of  <dig>  μl/min. four minutes after switching the spe in line with the analytical column, a programmed gradient ramped the concentration of mobile phase b to 85% over 95 minutes. column flow was maintained at  <dig>  μl/min. peptides were ionized using an electrospray ionization interface . spectra were collected in ms/ms mode using collision induced dissociation  fragmentation. each of the five samples was analyzed in triplicate on the instrument and in randomized order on the same chromatographic column. as no metagenomics data were available for the bioreactor community , global proteome profiles were compared using mutltialign’s dataset-to-dataset alignment and lc-ms feature clustering capabilities, and the parameters in additional file 1: table s <dig> 

results from multialign’s lc-ms feature finding algorithm ranged from  <dig>  to  <dig>  lc-ms features for the datasets of which  <dig> to  <dig> matched to ms/ms spectra based on precursor m/z and local scans . the unmatched features represent approximately 75% of lc-ms features unidentifiable through traditional database search techniques. the lc-ms feature clustering algorithm found  <dig>  clusters with members present in at least two datasets, of which  <dig> were unambiguous observations and  <dig> were present across all time points and in all technical replicates.

while excellent reproducibility was observed for lc retention and mass alignment of technical replicates, alignments at the sample scale  exhibited increases in retention time and mass variation over the time course . a systematic worsening in alignment was observed regardless of the sample and baseline dataset selected for pair-wise alignment, even though alignment reproducibility was good for technical replicates. because the run order of samples and technical replicates was randomized, bias introduced from the instrument was ruled out as a cause for this trend.

we performed spectral clustering to better understand the systematic decrease in alignment across time, using ms/ms spectra collected on days  <dig> and  <dig> and between two, day- <dig> technical replicates. clusters of ms/ms spectra were analyzed and the lc-scan difference between two spectra for each cluster was plotted with respect to the cluster index . note the differences in both the number and spread of clusters between the two cluster analyses. for the technical replicates, delta scan residuals are close to zero, while delta scan residuals between days  <dig> and  <dig> are incongruous, which suggests a lack of similarity between ms/ms spectra generated for these two samples.

both the cluster analysis plots and the alignment heat maps point to substantial proteome differences in the bioreactor community during its acclimation following inoculation with cow rumen. it is highly likely that both the community structure and proteome were behaving in a dynamic manner during acclimation, which suggests that genomics sequence information derived from any one sample may not represent the proteome of another sample. as a result, a database centric approach would be lacking in that a single metagenome may not capture the entire community structure. instead, by decoupling this alignment and peptide identification from a database centric model, multialign allows data analysis to be performed on global proteome profiles, without initial genomics sequence information.

metabolomics dataset to dataset alignment and traceback to ms/ms spectra
we also demonstrated application of multialign for processing  <dig> lc-ms-based metabolomics datasets obtained in a previously published study of wild type and mitochondrial fatty acid oxidation enzyme  knockdown mutants of human hepatocarcinoma cells  <cit> . each dataset contained  <dig> to  <dig> lc-ms features, and ms/ms traceback results showed  <dig> to  <dig> ms/ms spectra were matched to these features, which indicated that each lc-ms feature had multiple fragmentation spectra. this observation is in contrast to proteomics datasets, where a single lc-ms feature typically is selected for zero to  <dig> fragmentation events on average because of sample complexity. in total,  <dig>  unique lc-ms features were detected following chromatographic alignment using multialign. the distribution of charge states was predominantly 1+, which is expected in lc-ms metabolomics datasets.

features from individual lc-ms datasets aligned to an arbitrarily chosen baseline dataset resulted in very linear heat maps , with tight mass and net error distributions . after alignment, these features were clustered across datasets, which produced an interesting trend in the cluster size distributions. of the  <dig>  features, we observed  <dig> clusters of which  <dig> were singletons, i.e. observed in only a single lc-ms dataset. however, we also observed  <dig> clusters that spanned all  <dig> datasets for both cell conditions . further investigation of these clusters showed that roughly half  had a tightness score <  <dig>  and an ambiguity score >  <dig>  the significance of these cutoffs is demonstrated by the two significantly large score distributions in figure  <dig> 

while we did not quantitatively analyze the  <dig> metabolomics datasets, we did demonstrate that intensity profiles can be obtained as a result of clustering across conditions. furthermore, the traceback capability allows researchers to extract ms/ms spectra targets with the intent of comparing them to other metabolomics databases of known standards , thereby providing a unique capability for processing lc-ms-based metabolomics data.

CONCLUSIONS
multialign is a new software tool that aligns lc-ms feature maps for label-free proteomics and metabolomics comparative analyses. although capable of matching lc-ms features from a single dataset to a reference database, its value lies in its ability to align multiple datasets to find differentially abundant chemical species of interest not readily identified by traditional approaches, which allows for focused identification. this alignment capability supports targeted workflows for identifying systematic changes in complex samples, such as microbial communities, to assist downstream investigations of underlying biological processes.

when reference databases are available, clustered species derived from multiple datasets can be matched to entries in a database and assigned confidence values, after which selected species can be followed up using a targeted experimental approach, e.g. using selected reaction monitoring to validate identifications or more ms/ms spectra collection with other fragmentation methods such as cid, hcd, or etd. both identified and unidentified clusters can also be profiled to reveal abundance changes, which is useful for supporting or establishing hypotheses for cause/effect, spatial, or temporal studies. furthermore, multialign is useful for studies where little to no genomic context is known and reference databases cannot be constructed, as exemplified by our application of the software to proteomic samples of an anaerobic microbial community. in this analysis we demonstrated how two dissimilar lc-ms feature maps could be analyzed using multialign’s ms/ms traceback and spectral clustering capability. this functionality allows researchers to focus further informatics investigation, e.g. de novo peptide identification approaches, on ms/ms spectra that are associated to features found in multiple experiments, as opposed to transient spectra.

availability and requirements
project name: multialign

project home page:http://omics.pnl.gov/software/multialign.php

operating system: microsoft windows xp and newer 

programming language: c# for presentation layer  and c++ for computation layer.

other requirements: microsoft .net framework  <dig> , microsoft .net framework  <dig> 

license: apache  <dig> 

any restrictions to use by non-academics: none.

abbreviations
ms: mass spectrometry; lc-ms: liquid chromatography-mass spectrometry; amt: accurate mass and time 

competing interests
the authors declare that they have no competing interests.

authors’ contributions
bll developed visualization capabilities and improved performance of back-end algorithmic components, as well as improved scalability and application to targeted workflows. bll also wrote several of the data access components, and provided critical bug fixes. kc developed data access layer components for input and output and upgrades to the user interface, and provided support and testing for various platforms. kc also played a role in critical bug fixes. as and vp provided algorithmic oversight through code reviews and played a role in testing and analysis of data. nj developed initial versions of the software, including the underlying alignment, feature finding, clustering, and peak matching algorithms. gk and js wrote database access tools. mem provided feature development and access to amt-db creation utilities and provides testing and data analysis. sjc provided guidance for targeted workflow development, feature development, and application of multialign for environmental proteomics analyses. tm provided metabolomics datasets and direction for lc-ms analysis of metabolites. gaa directed development of the tool towards various application areas for high-throughput lc-ms analysis. rds provided crucial scientific guidance and leadership to the development group.

supplementary material
additional file 1: table s1
table of parameters used in the multialign analysis.

click here for file

 acknowledgements
the authors thank samuel purvine, nikola tolić, angela norbeck, and joshua aldrich, drs. samuel payne, and allan konopka for insightful discussions with regard to algorithms, software design, and biological applications; dr. joshua adkins for support and continued discussion; dr. mary lipton for continued support for feature development and application; and amy boaro and dr. birgitte ahring at the bioproducts, sciences, and engineering laboratory at washington state university -tri-cities for providing the bioreactor samples. we would also like to thank nancy colton for her technical editorial assistance and dr. kenneth auberry for his graphic design contributions.

funding
this work was supported by the laboratory directed research and development program as part of the microbial communities initiative at the pacific northwest national laboratory . proteomics datasets originated from samples analyzed using capabilities developed under the support of the national center for research resources  and the national institute of general medical sciences  from the national institutes of health, and from the u.s. department of energy office of biological and environmental research . significant portions of the work were performed in the environmental molecular science laboratory, a doe/ber national scientific user facility at pnnl in richland, washington. pnnl is operated for the doe by battelle under contract de-ac05-76rlo- <dig> 
