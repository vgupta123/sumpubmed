BACKGROUND
metabolic stability is a critical aspect in the drug discovery process. a candidate drug faces a system that has evolved to prevent exposure of foreign compounds in the body by metabolising enzymes. xenobiotic metabolism mainly occurs in two places; the gut epithelia and the liver. the mechanisms are quite well understood, but there is still a tremendous variation in reactions that lead to biotransformations. many enzymes can carry out the same reactions on a variety of substrates. all together the metabolising systems are hard to model with high accuracy.

the currently available predictive tools are usually tuned and validated against literature data, and few available methods rapidly present the results in a simple interface. a simple database search only shows the exact reported literature results and quite cumbersome queries are needed to retain any information at all about probable sites of metabolism  <cit> . much of the data in the literature have been collected by symyx http://www.symyx.com and they provide a tool, isis, to search for structures and other entities to retrieve putative metabolic sites. the data have been curated and is regarded to be of high quality. another tool is metasite  <cit>  which predicts metabolic sites in a semi-deterministic fashion. another method uses historic metabolic biotransformation data from the literature exclusively  <cit> . these methods are all fairly accurate  <cit>  and provide chemists with results within a reasonable time. however, none of them is interactive and allows a user to get instant updates during editing of chemical structures, and some of them are only available under expensive licenses that restrict their availability. also available is meteor  <cit> , which is easy to use and gives reasonably clear results. but, it generates many possible metabolites that perhaps are not all probable. to fully make use of all different features in some of the tools, a substantial amount of computer knowledge is required. there is a need for fast, reliable, and easy to use method for site-of-metabolism predictions.

this paper describes an interactive tool for prediction of metabolic sites that can run on a desktop and be managed by "wet-lab chemists". it has been built by combining two existing applications bioclipse  <cit>  and metaprint2d based on  <cit> . the next section explains how the two components work and how they have been combined, followed by a section where results are presented to illustrate its use and performance, ending with discussions about the implications.

methods
metaprint2d
metaprint2d is a tool for predicting the sites of a molecule that are most likely to undergo phase i metabolism, based on their similarity to known sites of metabolism and sites that are known not to be metabolised. the method builds on a database of atom environments found in molecules known to undergo metabolic transformation, such as the data found in the symyx  metabolite database http://www.symyx.com/, which contains over  <dig>  metabolic transformations of xenobiotics, curated from reports in scientific literature. metaprint2d contains a complete enumeration of the atom environments occurring in reactant molecules in the metabolite database, together with counts of the number of occurrences of the atom environment at a reaction centre, and anywhere in the database, whether at a reaction centre or not.

in order to make predictions on a molecule the atom environments in the molecule are calculated, and the database is searched for similar environments. an occurrence ratio - measuring how often this or a similar environment has been found at a reaction centre, relative to how many times it has been observed in total -is then calculated for each atom in the molecule. these ratios represent the relative likelihood of metabolism occurring at each atom; no prediction is made as to whether the molecule does indeed undergo metabolism, rather a ranking of the likelihood of metabolism occurring at each site in the molecule is produced. in order to standardise the output, these ratios are then scaled so that the molecule's most likely site of metabolism gets a normalised occurrence ratio of one.

preprocessing
the metaprint2d data is generated through processing of the transformations found in the symyx metabolite database. for each transformation, the differences between the structure of the reactant and product are identified: groups added or eliminated, bonds broken or made and bonds whose order has changed. in order to simplify the results, only phase i additions , and eliminations  are retained. for an addition, the atom neighbouring the added oxygen is marked as a reaction centre. in the case of an elimination, a bond gets broken, and both atoms connected by the bond are considered to be reaction centres.

the preprocessing is continued by a generation of circular fingerprints  <cit>  for each reaction centre and also for every atom in the reactants. circular fingerprints  represent the chemical environment of an atom in a form that can be processed by a computer . these fingerprints include the number of occurrences of atoms of various types in each of a series of concentric layers radiating out from a central atom; the first layer contains the atom the environment is centred on, and each subsequent layer contains the immediate neighbours of the atoms in the previous layer, so the second layer contains those atoms directly bonded to the central atom, and the third layer contains the atoms directly bonded to those atoms in the second layer. an atom environment can extend to an arbitrary number of layers. metaprint2d utilises environments up to six layers in depth. rather than describing atoms by their chemical element, they were described using the implementation of tripos forcefield atom types in the chemistry development kit  <cit> , which combine the atom's chemical element with its hybridisation and aromaticity. the used sybyl atom types were c. <dig>  c. <dig>  c.ar, c. <dig>  n. <dig>  n. <dig>  n. <dig>  o. <dig>  o. <dig>  s. <dig>  n.ar, p. <dig>  h, br, cl, f, i, s. <dig>  n.pl <dig>  lp, na, k, ca, li, al, du, si, n.am, s.o, s.o <dig>  n. <dig>  o.co <dig>  and c.cat. thus for each unique circular fingerprint the occurrence as a reaction centre as well as the overall occurrence is stored in the following sparse format :

int numberoffingerprints   //all fingerprints from the

                           //transformation db.

byte numberoflevels        //fingerprint levels.

                           //we only use six.

 

//for each fingerprint

byte numberofnonzeroentries // all existing atoms.

 

//for each non-zero entry

byte index // the index representing the sybyl atom type.

byte value // the occurrence of a specific sybyl atom type

 

int rc // number of occurrencs as reaction centre.

int oc //number of occurrences overall.

byte errorcheckingbyte // always set to a unique value.

predictions
the second stage of the proposed method is what the user experiences. it starts by reading a file of preprocessed transformation data, putting all fingerprints with their associated information, such as number of occurrences as reaction centres and number of occurrences overall in reactants, in memory. all atoms of a query molecule undergo the same procedure to generate circular fingerprints based on sybyl atom types and to allow for comparison to the reactants of the underlying transformation database. in addition to the steps of generating the circular fingerprints, a hashcode, h, is generated for each fingerprint level by the following recurrence sequence:  

where si is the sum of a specific sybyl atom type, represented by the index i and α is an integer constant. the preprocessed transformation data is searched by collecting all circular fingerprints with identical hashcodes, for a predefined number of levels, to each atom fingerprint in a query molecule. the hashcode is a compact representation of a fingerprint which is optimised for comparisons, where two identical hashcodes are not necessarily representing identical fingerprints but two identical fingerprints have identical hashcodes. if an atom fingerprint in a query molecule, fq, and a transformation molecule atom fingerprint, ft, are considered to be similar the following needs to be true:    

where n is the number of fingerprint levels required for an exact match, wl is a weight that can be set for each fingerprint level and ε is a similarity threshold. by searching the transformation data fingerprints using the hashcodes, the number of fingerprints searched using the similarity operator in equation  <dig> is substantially reduced without any loss of information. the sum of both the reaction centre occurrences and the overall occurrences for all similar transformation data fingerprints are stored for each query atom, respectively. these ratios are also normalised by the greatest ratio within a query molecule for an easy overview and a possible rank order for predicted sites of metabolism.

bioclipse
bioclipse  <cit>  is a graphical workbench for life science which is equipped with tools required for many common cheminformatics tasks, such as loading and converting between file formats, editing of chemical structures, interactive visualisation in 2d/ <dig> d, and editing of compound collections. bioclipse is however not limited to this; its extensible architecture enables it to be extended into virtually any direction, and has been used in such various fields as drug discovery, bioinformatics, spectral analysis, high throughput screening, systems biology, and general chemistry education. as a rich client application, bioclipse is downloaded and installed onto desktop computers, and is able to utilise their full power while also taking full advantage of new e-science technologies, such as on-line  services, high-performance computing, and networked databases. equipped with an advanced provisioning system, it is very easy to publish updates for bioclipse. this not only simplifies maintenance, but also enables users to stay up to date and always use the most current version of algorithms and data.

RESULTS
version  <dig>  of of metaprint2d has been trained using the  <dig>  version of the symyx metabolite database. four different metaprint2d databases are currently provided, one generated from all the transformations in the metabolite database, and others generated only using transformations found to occur in particular species - human, rat and dog. for the layered fingerprint hashcodes, α was set to  <dig> and n  was set to  <dig> 

a metaprint2d plugin for bioclipse was created which adds several new options for visualising chemical structures. a specific toolbar and a menu allows the user to select one of the available metaprint2d databases , adds options for selecting search mode, and also provides means to execute the metaprint2d calculation and to visualise the result in the chemical structure. currently the file formats mdl molfile, chemical markup language , smiles, and structure data file  are supported, and results can be visualised for single molecules or multiple structures in a table. it is also possible to execute metaprint2d in batch mode, and process for example sd files containing large collections of structures without visual inspection. metaprint2d is also accessible from the bioclipse scripting language and can easily be integrated in custom bioclipse scripts to automate tasks .

running a metaprint2d prediction is easy within bioclipse. the navigator pane on the left hand side  allows for management of files and folders that can be operated upon in bioclipse, and points to a place on the local hard disk. the navigator is easily populated by drag and drop or cut and paste of files and/or folders, or using the import functionality of bioclipse. opening a single molecule in the  <dig> d editor or multiple molecules in the molecules table of bioclipse reveals the metaprint2d toolbar, allowing for metaprint2d calculations. the results are visualised so that atoms are coloured according to the likelihood of a metabolic site being centred on this atom: high: red, medium: yellow, low: green, and very low is not coloured. in single molecule mode the molecule can be edited and by a click of a button the new prediction is computed and displayed, or automatic prediction is turned on and a new prediction is executed upon changing the structure. figure  <dig> shows the drug verapamil opened in bioclipse, and coloured by metaprint2d analysis using the standard search mode and the database all. hovering over an atom reveals a tooltip showing the number of hits in the reaction centre set, the total number of hits, and the normalised occurrence ratio. it is simple to edit the chemical structure and update the visualisation; the process is near real-time which makes it very easy to explore changes to the structure that affect the likely site of metabolism.

it is straightforward in bioclipse to invoke metaprint2d on files containing multiple molecules. figure  <dig> shows an sd file opened and predicted in bioclipse. the same colouring as in single molecule mode is produced, and the user can switch between this tabular view of several compounds to a more detailed view of a single compound by selecting the single molecule tab in the bottom of the table. here the user can make desired structural changes to a compound, and then switch back to the tabular view and proceed to another compound in the collection. there is also the ability to execute metaprint2d in batch mode by right-clicking a file and selecting "run metaprint2d". an sd file comprising  <dig> compounds  with  <dig> atoms on average was subjected to metaprint2d calculation in batch mode using standard search mode and the database all. the file took  <dig> s to process, which is an average of  <dig> ms per molecule. all results were measured on a macbook pro laptop using bioclipse version  <dig> , metaprint2d bioclipse plugin version  <dig> , metaprint2d version  <dig> , and symyx metabolite database  <dig> .

the source code for the metaprint2d algorithm is available from sourceforge  <cit> , and this version can be used as a standalone calculator called from the command line. the source code from the bioclipse-metaprint2d plugin is available from github  <cit> , and a page describing the bioclipse integration is also available  <cit> . a web page for demonstrating metaprint2d is available  <cit> ; note however that the metaprint2d version on the web page might differ from the version included in the bioclipse-metaprint2d plugin and what is described herein.

CONCLUSIONS
we here present metaprint2d, which is an improved algorithm for site-of-metabolism prediction. the efficient use of layered, hashed circular fingerprints significantly improves the speed of predictions over boyer et al. , and allows for use in new applicability domains. for example it is possible to try different hypothesis regarding chemical structures with instant feedback, which for the first time makes site-of-metabolism prediction a feasible methodology to integrate with a chemical drawing application. the combination of metaprint2d and bioclipse greatly simplifies site-of-metabolism predictions in the eyes of scientists. the metaprint2d algorithm has proven to be extremely fast compared to other available tools, and opens up the possibility to perform site-of-metabolism predictions on a large scale. the integration into bioclipse extends the usability and accessibility of metaprint2d, and in contrast to existing tools, predictions can now be done on regular laptops at execution times that are considerable less than one second per molecule. the implementation does not require access to remote computers, and the accuracy of the predictions to the predecessor of metaprint2d has been shown to be on par with other tools in the field  <cit> .

the intuitive user interface in bioclipse enables metaprint2d to be used by a variety of people in the drug discovery process, ranging from computational chemists to experts in drug metabolism. molecules can easily be drawn in the chemical editor of bioclipse and then subjected to metaprint2d prediction, or predictions can be made on all molecules in a file. the real time execution provided in single molecule mode allows for the user to try different hypothesis with very little effort, and get instant feedback of the predicted site of metabolism for a change in the chemical structure of a compound. the option to visualise multiple predictions in a tabular view allows for simultaneously working with collections of compounds with the same functionality, and easy switching to editing individual compounds. for larger collections or when visual inspection is not desired, the batch functionality for running predictions on a file with results stored as properties is an appealing option. for more advanced users, bioclipse provides the means to call metaprint2d from within a bioclipse script and integrate it with other applications. the advanced provisioning system of bioclipse greatly facilitates updates to the implementation and the databases of the metaprint2d plugin.

open-source software provides excellent opportunities to extend and combine different software projects. the application presented here is an example of this and there are several benefits of this: 1) it is completely free of charge, 2) anyone who has ideas on how to improve the algorithms can either contribute to any of the two projects or take all available software and tailor it for their own specific needs, and 3) the access to the source code ensures reliability and builds trust. there are no hidden details and everything can be reproduced. both metaprint2d and bioclipse are released under open source licenses and are completely free of charge.

competing interests
the authors declare that they have no competing interests.

authors' contributions
lc came up with the original idea to include metaprint2d within bioclipse as a plugin. he also drafted the manuscript and developed the metaprint2d algorithm. os designed and implemented the metaprint2d plugin and drafted the manuscript. sa drafted the manuscript and developed and implemented metaprint2d. rcg and sb developed metaprint2d. all authors read and approved the final manuscript.

appendix a: availability
getting bioclipse and metaprint2d
a bioclipse plugin enabling the use of the metaprint2d library from within bioclipse is available. bioclipse must be downloaded and installed from http://www.bioclipse.net. the easiest way to install metaprint2d is to use the option software updates from the help menu in bioclipse. bioclipse will then contact the update server and present the user with a list of features that is available for installation. by checking metaprint2d and clicking "add required plugins", the metaprint2d functionality is available after restart  when browsing/editing chemical structures and files.

the source code of the metaprint2d library is available from http://sourceforge.net/projects/metaprint2d/.

license
bioclipse is released under eclipse public license   <cit> . epl is a flexible open source license that ensures core plugins will remain open source, but sets no constraints on external plugin licensing. more information can be found on the bioclipse home page. metaprint2d  <dig>  is released under gnu lesser general public license   <cit> .

