BACKGROUND
technological advances in dna sequencing have led to rapid increases in sequencing throughput and a decrease in sequencing cost  <cit> . these advances have enabled comparative studies of the whole genomes of many related species  <cit> . such genome analyses have provided valuable insights into evolutionary mechanisms, diversity, and adaptability of life to environmental variation  <cit>  as well as key trait variations among industrially or medically important strains  <cit> .

identifying orthologs and orthologous protein families is an important step towards understanding and interpreting genome variation  <cit> . however, there is no single method that correctly predicts orthology in all cases, leading to the development of many different methods targeting different applications  <cit> . due to the use of different algorithms and parameters used to perform clustering, automatically computed databases of orthologs often predict different protein families for the same proteins  <cit> . since orthologs are often taken to have the same function, these differences lead to differences and thus to uncertainty in the predicted functions of the genes  <cit> .

further confounding the ability to automatically infer protein function, clustering efficacy depends on the evolution rate of those families, which can vary widely  <cit> . the need to carefully curate protein functions and gene calls is also compounded by a rapid increase in the number of incomplete genomes  <cit> , including the approximations to single-species genomes that arise from metagenomic assemblies  <cit> . careful examination of gene calls and functional annotations is particularly important for accurately assessing the gain and loss of function in these incomplete genomes because genes are often left uncalled or incorrectly annotated due gene fragmentation or sequencing errors .

a number of software packages have been developed to integrate orthologous group identification, visualization tools, and common comparative analyses based on protein content  <cit> . however, due to the challenges cited above, many of these analyses require manual curation, which is difficult to scale to hundreds of genomes. additional tools are necessary to help researchers curate annotations and evaluate the integrity of protein families across related genomes.

we present itep, a modular bioinformatics toolkit for the generation, curation, and analysis of protein families across closely-related microbial genomes in which the combination of core and variable genes constitute their "pan-genomes". the toolkit provides a consistent command-line interface between a user’s genomic data and existing tools for protein family prediction by clustering, ortholog detection, analysis of functional domains, identification of core and variable genes and gene regions, alignments and trees, cluster curation, and the integration of cross-genome analysis and the generation of draft metabolic networks for study of metabolic network evolution. the toolkit makes it easier to identify and fix problems such as inaccurate annotations and missing  genes and to study the evolutionary history and physiological implications of the curated families. itep’s architecture enables researchers to rapidly develop their own customized comparative analysis workflows, which are easily automated, allowing users to focus their curation effort, rapidly generate and test hypotheses, and build accurate metabolic networks.

implementation
the itep toolkit is a collection of python and bash scripts that interface with an sqlite database backend  and a large number of existing tools to organize and analyze genomic content across related genomes . the toolkit runs on linux natively; a virtual machine is also provided that includes a complete itep installation, which can be run on any operating system . the toolkit includes:  convenient functions for genome importing and formatting,  modular analysis scripts that can be linked by piping to quickly and flexibly create workflows,  several convenient wrapper scripts that link other functions together to perform common analysis and visualization, and  a set of underlying python libraries for programmatic data access. interfaces are available for processing genomic data from the genbank database  <cit> , rast  <cit> , or the doe knowledgebase  <cit> . standard genbank files  from any other source may also be imported into itep by running them through a provided pre-processing script.

itep’s sqlite database stores information on gene locations, annotations and sequences, sequence homology data, de novo-computed protein families, protein similarities to externally defined orthologous groups , and the dna sequence of each contig for every imported genome. protein families are generated by creating a graph of similarities between proteins and running a clustering program . setup scripts are provided to readily import this data into the sqlite database.

after the database is built, the user can use provided command-line scripts to access subsets of the data within it and perform the supported analyses . most of the command-line access scripts are pipe commands, in which the output from one command is used as an input to another using pipes . this architecture allows users to rapidly prototype analyses and subsequently automate them in a bash script. many of the database access scripts generate tab-delimited outputs that are convenient for further command-line processing or import into spreadsheets. itep also contains commands to visualize phylogenies and gene context for genes in the database using freely available python packages  <cit>  or export data to standard formats such as fasta alignments and newick files which are widely supported in other visualization and bioinformatics software. many of the same analyses implemented in the command-line scripts are also accessible programmatically via a set of python libraries to aid developers who wish to build their own tools upon itep’s data structures. finally, pre-packaged workflow scripts are provided for common analysis tasks such as the generation of concatenated core gene trees. these can be used to quickly obtain a result or as a working starting point from which to develop new analysis pipelines.

de novo clustering for computation of protein families
running the blastp program  <cit>  all vs. all provides a graph of similarities between pairs of proteins, in which the genes are nodes and each significant pairing is an edge weighted by some similarity metric. the itep toolkit's setup scripts directly support the generation of protein families de novo by clustering these graphs using the markov cluster  algorithm  <cit> . the toolkit allows many different definitions of the homology graph: it can be generated from arbitrary subsets of organisms in the database with arbitrary cutoffs and inflation parameters , and three scoring metrics that emphasize different aspects of the protein pair homology   <cit> .

a user can also import results from any other orthologous family prediction method, allowing flexibility that is necessary due to differences in the strengths and weaknesses of individual algorithms. all downstream analyses  can then be performed in the same manner as if the clusters were generated using mcl. for example, a wrapper function is provided to interface between the itep database and orthomcl, a program that applies a percent identity cutoff between pairs of homologous proteins, identifies likely orthologs by using a modified bidirectional-best-hits approach, and then runs mcl to cluster the smaller subset of nodes and edges into protein families  <cit> . it thus performs mcl only on filtered subsets of the homologous pairs of organisms rather than simply applying a simple cutoff for a homology score. the consistent storage of clustering results from multiple different clustering methods in a single database enables users to easily compare the effects of the choice of clustering algorithm and the choices of organisms to cluster on the predicted protein families.

protein family curation and visualization tools
several biological and non-biological variables can cause automatically computed protein families to be incorrect or incomplete, such as the presence of gene fusions or multiple-domain proteins, incomplete or inaccurate gene calling, sequence and/or functional divergence, and the lack of rate homogeneity in evolution rates. in light of these challenges and in order to increase confidence that conclusions about the evolution of protein families are correct, we have implemented tools to generate and visualize multiple alignments and trees for protein families, to study gene neighborhoods of genes in a family, to search for possibly missing genes, and to assess the function of proteins in the light of their conserved domain architecture.

multiple alignments and phylogenetic trees are useful to analyze the phylogenetic history of particular protein families and to sort out the potential presence of paralogs  <cit> . the itep toolkit contains convenient interfaces for generating protein and nucleotide alignments  <cit> , curating alignments  <cit> , and generating maximum-likelihood phylogenies  <cit> . itep’s tree visualization capabilities provide an interface between a user’s genomic data and the ete python package for tree manipulation and rendering  <cit> . the itep scripts include the option of appending gene neighborhood information to a protein tree, which is useful for identifying the functions of novel genes  <cit> . the user also has the option to attach numeric data  or arbitrary text tables to any tree .

to help identify missing genes, we have implemented an interface that links genomic data in itep to tblastn  <cit> , which is useful for finding genes that are fragmented, miscalled , or that are not yet annotated. the itep interface to tblastn identifies significant hits from a set of query genes to a particular genome  in the database, and then automatically identifies whether the hit was to a called gene and whether the called gene was on the same strand as the hit. from this result, a researcher can examine and  add missing proteins to protein families. the gene neighborhood and tree generation and visualization scripts support the visualization of tblastn hits in their genetic context in the same manner as called genes . we have also provided a tool that attempts to identify frame shifts, insertions, and nonsense mutation events from the tblastn results, which helps identify specific mutations that could lead to loss of function or that could indicate errors in the genome sequence.

finally, to assist the curation of annotations, we have implemented automatic generation and storage of rpsblast hits to the ncbi cdd database  <cit> . the interface allows a user to rapidly search for the ids of conserved domains that correspond to certain keywords  and to identify all proteins in a genome that have significant homology to a specific set of conserved domains. itep also includes tools for identifying and visualizing all conserved domains that are found in a specific query protein or set of proteins , providing insight into the functions of those proteins.

analysis of core and variable gene content
studying gene gain and loss and examining the core  and variable  genes in a collection of organisms can provide insights into the plasticity of cellular functions and can be used to identify genes that define a clade  <cit> . to assist such analyses, itep includes functions that identify interesting subsets of genes based on presence and absence patterns, such as genes that are present in all of a particular group of organisms , any members of a group , only members of that group relative to those all of the organisms to generate the protein families , or none of the members of that group. the script can also optionally identify genes that are conserved in any given fraction of a group of organisms, allowing for some flexibility due to missed gene calls or divergent sequences. finally, if an organism phylogeny is available , a tool is also available to identify presence and absence patterns based on each phylogenetic clade, allowing a researcher to, for example, identify all of the genes that are conserved in or unique to each individual species or all genomes in a clade.

integration with metabolic networks
a key reason to identify protein families is to use the results to propagate annotations and subsequently identify the physiological capabilities of an organism based on those of its relatives. in the context of genome-scale metabolic modeling, the predicted presence or absence of particular protein families may be used as evidence for the presence or absence of reactions in a metabolic network. in a metabolic network reconstruction, the relationship between a gene and the reactions catalyzed by the encoded enzyme is typically encoded in a boolean gene-protein-reaction relationship , in which complexes and other sets of genes that must all be present for a reaction to occur are given an and relationship, while isozymes or sets of genes with unknown relationships are given an or relationship  <cit> . to assess whether a reaction is catalyzed or not within a cell, each associated gene is assigned a  <dig>  if it is present and a  <dig>  if it is absent, and then the gpr is logically evaluated. if the gpr evaluates to true then the reaction is present and otherwise it is absent.

we have implemented a function in itep that directly evaluates boolean gene-protein-reaction relationships associated with existing metabolic reconstructions of strains in the database based on the presence-absence calls of de novo clustering with arbitrary parameters. in this way, a researcher can rapidly generate draft metabolic network reconstructions based on genomic comparisons with one or more reference networks. subsequently, these network reconstructions can be curated to generate high-quality models of each related organism.

RESULTS
test data set
we chose to use the group  <dig> clostridia as a test case to illustrate capabilities of the itep toolkit. this metabolically diverse phylogenetic clade includes industrially important organisms such as the solventogenic organisms clostridium acetobutylicum and c. beijerinckii, as well as several medically important strains such as c. perfringes and c. botulinum <cit> . c. botulinum and c. perfringes genomes have both been heavily sampled, therefore providing the opportunity to study genetic differences at both species and at the genus-scale. in addition, manually-curated metabolic models are available for c. acetobutylicum atcc  <dig>  <cit>  and c. beijerinckii ncimb  <dig>  <cit> , affording an opportunity to use itep to examine metabolic differences between these and the other clostridium species in the clade.

the species belonging to the group  <dig> clostridia were determined based on the patric database  <cit>  and the arb living tree 16s rrna tree  <cit> . all complete and draft genomes from this group were downloaded from refseq in march  <dig>  along with the genome of an outgroup organism, acetobacterium woodii. overall,  <dig> complete and  <dig> incomplete clostridia genomes were downloaded and analyzed .

the test dataset was chosen to be relatively small for purposes of illustration. itep currently supports creation of databases containing up to about  <dig> genomes on a modern workstation with 1 tb of hard drive space, 16 gb of ram, and  <dig> processors . disk space and time requirements grow as o where n is the number of genomes.

in this example, mcl was used to perform clustering and predict protein families. the relative strengths of this and other methods for predicting protein function have been reviewed at length  <cit> . importantly, if the user desires to use different algorithms for clustering, itep supports exporting subsets of blast data in formats convenient for import into clustering tools, importing the clustering results back into the sqlite database, and applying the same workflows as described here to interpret and curate them.

complete tutorials for performing the analyses described in this section and many others are available in the package documentation . a link to an up-to-date web version of this documentation and code is linked to from the project website .

analysis of gene gain and loss patterns across phylogeny
as a starting point for the analysis of the group  <dig> clostridia pan-genome, we used itep to compute the number of conserved gene families  in each clade in the group  <dig> clostridia and in a. woodii . the results indicate that a large number of genes are conserved between closely related strains  but the number of conserved genes drops off rapidly as more diverse strains are added. the identities of the conserved genes can easily be extracted from itep and used to examine physiological differences between the clades of organisms and at what point a particular function was lost. in the same manner, itep can be used to identify gene families unique to each clade or those that are found in exactly one copy in each member. importantly, the curation tools in itep can be used to verify conclusions drawn from analyzing these gain and loss patterns .

comparison of draft and complete genomes and curation of protein families
draft genomes are prevalent in many environmental studies, but because they are incomplete, presence and especially absence calls are inherently less certain for them than they are for complete genomes. the grouping capabilities of itep are useful for evaluating the quality of draft genomes by comparing their gene content with closely related closed genomes. to illustrate this, we have generated mcl clusters including two different groups of organisms with identical clustering parameters: one group contained only the completely sequenced group  <dig> clostridia species , while the other contained both the completely-sequenced genomes and the draft genomes for strains in the same phylogenetic clades as the completely-sequenced species . by comparing the protein content in these two groups, we found that  <dig> protein families were conserved in all of the completely sequenced genomes, but that  <dig> of them  were missing in at least one of the draft genomes in the same clades . the protein families that appeared to be missing in some of the draft group  <dig> clostridia genomes but not the complete ones covered many cellular subsystems, including  <dig> ribosomal protein families  and other widely conserved proteins such as the cell division protein ftsz.

when a highly conserved gene appears to be absent in a particular genome but does not have a congruent loss pattern on the phylogenetic tree, these are candidates for missing or wrong annotations or gene calls. importantly, itep includes ways to search for apparently missing genes in the incomplete genomes, making it possible to identify and correct certain types of gene calling and annotation errors. as an example, we have used the tblastn wrapper script in itep to search for copies of the l <dig> ribosomal protein in all of the group  <dig> clostridia and in acetobacterium woodii. the search revealed a complete, uncalled copy of the l <dig> protein in a. woodii and an uncalled fragment  of a l <dig> protein in c. perfringens cpe f <dig> 

to find evidence that these were real l <dig> proteins, we used itep scripts to pull the homologous sequences suggested by tblastn out of the database, align them, and build a maximum-likelihood tree containing these proteins with neighborhoods mapped onto the tree. the multiple alignment confirmed that the newly identified l <dig> homologs are very similar to called ribosomal proteins in closely-related complete genomes , while mapping the neighborhoods of the uncalled genes revealed significant conservation of gene neighborhoods , supporting the hypothesis that the identified proteins are really l <dig> ribosomal proteins and should be included in the gene annotation. the same methodology can also be applied to search for apparently missing metabolic or regulatory genes, which would help fill in gaps that appear when generating models of cellular physiology. in this way, the challenge of accurate gene annotation can be approached both from the bottom up  and top down , tying together microbial phylogeny and physiology.

draft metabolic reconstruction and curation of metabolic protein families
the comparative analysis capabilities of itep can be used to generate draft metabolic networks as a starting point for generating high-quality metabolic models of organisms based on their similarity  to related genomes. to illustrate this capability, we have generated draft metabolic networks of each completely-sequenced group  <dig> clostridia strain using the published c. beijerinckii model  <cit>  as a reference. this model was chosen as a reference because it is the most recent and most complete model of a member of the group  <dig> clostridia that has been published. we found that the presence and absence calls for metabolic functions in the other clostridia were strongly dependent on the chosen homology cutoff: with a relatively stringent cutoff of  <dig> , some organisms  appeared to be missing more than half of the  <dig> gene-associated metabolic reactions in the c. beijerinckii metabolic reconstruction, and even with a very lenient cutoff of  <dig> , at least  <dig> of them were missing in each other organism . these missing reactions create gaps in the metabolic network that represent either real differences in physiology or incorrect absence calls due to methodological issues such as incorrect clustering, mis-annotation, or missing gene calls.

the presence of gaps in reconstructed networks makes it difficult to turn them into functional metabolic models  <cit> . the comparative genomics capabilities of itep can be used to help identify genes that fix gaps in metabolic pathways . for example, the draft metabolic reconstructions for clostridium botulinum bkt <dig> and c. novyi nt based on mcl clustering were predicted to lack the purd enzyme necessary for purine synthesis . no genes were annotated to perform this function in the source genbank files for these genomes. in an attempt to fill this gap, we used itep to perform a tblastn search against these two organisms using the copy of purd from c. beijerinckii  as a reference. interestingly, we found a very strong homology between the c. beijerinckii purd and the n-terminal end of much larger proteins in c. botulinum bkt <dig> and c. novyi nt . searching these genes against the rpsblast results that were stored in the itep database revealed that the large proteins from c. botulinum bkt <dig> and c. novyi nt are in fact fusions of purd and purl , in agreement with the assignments based on metacyc  <cit> , rast  <cit> , and the seed  <cit> . therefore, the gap in the metabolic network can be fixed by assigning the same function to both of these genes, making simulations performed using other tools  <cit>  more accurate.

CONCLUSIONS
the itep toolkit integrates a large number of existing bioinformatics tools into a single cohesive, flexible framework for comparative analysis of physiological variation in microbial pan-genomes. the modular design of the toolkit makes it straightforward to add additional functionality to the toolkit, as illustrated by our implementation of novel tools for generation of draft metabolic reconstructions from a curated reference network. it also makes the analysis very flexible, empowering researchers to quickly develop analysis workflows while also providing a wide array of tools for curation of annotations and gene calls. the ability to rapidly curate protein families and propagate metabolic networks from reference organisms to related strains will streamline the process of generating high-quality physiological and evolutionary hypotheses and ultimately lead to an improvement in the inter-genome consistency of metabolic models of microbes.

availability and requirements
project name: itep: integrated toolkit for exploration of microbial pan-genomes.

project home page:https://price.systemsbiology.net/itep

operating system: linux; a virtual machine is available that can be run on any platform supported by virtualbox .

programming language: python , bash

other requirements: sqlite3+, mcl, ncbi blast+, python modules: biopython , numpy, ruffus, and ete2; others are optional depending on usage.

license: gnu gpl <dig> +

any restrictions to use by non-academics: none

abbreviations
air: aminoimidazole ribotide; blast: basic local alignment search tool; fgam: 5′-phosphoribosylformylglycinamidine; fgar: n-formylglycinamide ribonucleotide; gar: glycinamide ribonucleotide; gpr: gene-protein-reaction relationship; itep: integrated toolkit for the exploration of pan-genomes; mcl: markov cluster ; prpp: 5-phosphoribosyl 1-pyrophosphate; rast: rapid annotation using subsystem technology; tblastn: translated blast against nucleotides.

competing interests
the authors declare that they have no competing interests.

authors’ contributions
mb conceived the idea and implemented the toolkit. jh contributed code to the toolkit, participated in the toolkit design, and participated in the interpretation of the results. wm, rw and np contributed ideas to improve the toolkit and participated in the interpretation of the results. all authors participated in the writing and revision of the manuscript. all authors read and approved the final manuscript.

supplementary material
additional file 1
database schema for sqlite database.

click here for file

 additional file 2
itep architecture overview figure.

click here for file

 additional file 3
list of genomes used in the analysis; list of protein families conserved in the complete group  <dig> clostridia but not in the draft ones within the same clades; list of valid clustering metrics; list of presence and absence of metabolic reactions in the group  <dig> clostridia compared to 
c. beijerinckii 
as a function of cutoff.

click here for file

 additional file 4
text version of the tutorials for initial release . the files are in markdown format which can be viewed in many browsers using plugins such as the markdown viewer .

click here for file

 additional file 5
source code for initial itep release.

click here for file

 additional file 6
complete pdf file for the strap alignment in figure 4a.

click here for file

 acknowledgements
thanks to nicholas youngblut for his help with rast integration. thank you to caroline milne and nicholas chia for critical readings of the manuscript. the authors gratefully thank the u.s. department of energy genomic sciences program  for funding this work.
