BACKGROUND
the gene expression program of cells can be organized into a diverse set of pathways that perform specific functions  <cit> . human health depends on the functionality of these pathways; de-regulation at the pathway level may be more important for diseases like cancer than de-regulation of specific genes  <cit> . the most common statistical approach for identifying pathways of interest in a high-throughput experiment is to perform a significance analysis gene-by-gene and then summarize the significant hits using gene set or gene pathway analyses. each pathway or gene-set analysis is performed once on the entire data set. however, there is variability in the identified gene sets due to both the instability in gene rankings from the original gene ranking analysis and from the pathway/set analysis. furthermore, scientists are often interested in whether these results will replicate as significant in future similarly-designed studies using independent samples.

here we propose a new approach to evaluate the stability of biological inference drawn from an experiment, and estimate the probability that the result replicates in future studies. our approach, called gene set bagging, performs a resampling of the entire discovery algorithm - significance analysis and gene set enrichment - to identify the most stable and reproducible enriched gene sets. bagging, also known as bootstrap aggregating, is traditionally used for assessing the predictive accuracy and stability of prediction models  <cit> . while bagging and bootstrapping procedures have been used for differential expression analyses  <cit>  and other genome-wide applications  <cit>  here we introduce a new bagging procedure for significance analysis. this procedure can be useful for both evaluating significance rankings and also for describing the most reproducible genes and biological gene sets within genomics experiments in a platform-independent fashion.

we perform resampling by drawing observations with replacement from the  original data set with sample size equal to the original, performing a significance analysis followed by gene set analysis, and then identifying which sets are enriched. we can identify which observed gene sets are consistently enriched in resampled data, and compute the gene set replication probability , a measure of gene set stability based directly on the biological quantity of interest, representing the probability that an observed gene set will be enriched in future experiments.

the replication probability  has some important advantages over the traditionally-reported p-value for summarizing gene set enrichment. the structure of the gene set testing problem is fundamentally different than other multiple hypothesis testing problems - correlations between genes, different gene set sizes, and different levels and fraction of differential expression within gene sets make the hypotheses fundamentally not comparable with standard significance testing  <cit> . we propose to estimate directly the probability that a gene set will replicate because an estimate of the probability of replication may be of more interest than a measure of statistical significance. given the emphasis on replication in genetics/genomics studies, this replication probability may be another metric for directing molecular validation of important biological processes involved in human disease.

we perform our gene set bagging method on two types of genomics measurements: gene expression and dna methylation. even after adjusting the genomic data for potential batch effects, we demonstrate that some significant gene sets fail to replicate well, yet other non-significant sets have high replication rates. the results for these different genomic technologies suggest that the signal and noise structure of the specific genomic data type contribute greatly to stability of gene sets. we use a simulation study to assess replication across two simulated datasets, and evaluate the concordance between replication probability  and the traditionally-reported significance metric . in simulations we show that the replication probability better quantifies the chance that a significant gene set will be consistent across studies. our results suggest that:  gene set enrichment analyses based on significance analysis may be unstable in some cases, and  gene set bagging is a resampling approach for measuring the stability of gene sets and estimating replicability of biological conclusions.

methods
for a given gene set, the goal is to estimate: 

 rl=pr. 

 the quantity rl is useful as a measure of the stability of the significance of an identified gene set. gene sets are frequently used to interpret the biological results of studies, so it is important to know if the biological interpretation would change if the study was repeated. this is particularly true since gene set analysis is subject to errors in annotation, variation due to technological noise, and variation due to biological noise. we define “replicability” as the ability to achieve similar results when experiments are rerun, and note this differs from “reproducibility”, which we view as the ability to run the analysis code again and get the same answer within a dataset  <cit> .

as an example of our general approach, we focus on a real dataset examining the role of cigarette smoking on gene expression , which examined expression differences associated with smoking exposure in  <dig> smokers and  <dig> never-smokers. we define gene expression measurements mij for each of j= <dig> …, <dig> samples over i= <dig> …,m genes/probes  and a covariate of interest per sample . we first want to identify differentially expressed genes between the two outcome groups, so we calculate an empirical bayes regularized t-statistic and resulting p-value for each gene  <cit> . we can convert these p-values to q-values to identify which genes are significant according to the false discovery rate. we then test for enrichment among the significant genes in l predefined gene sets using the usual hypergeometric test. each gene set yields a p-value , reflecting the degree of enrichment. another approach to obtaining the gene set p-value  is to calculate them directly from the significance ranks of the genes . for example, the wilcoxon rank-based gene set enrichment test  <cit>  available in the limma bioconductor package  <cit>  can be used to test for a difference in the significance ranks of the genes in the gene set versus all of the other genes.

we then perform the gene set bagging algorithm over b= <dig> iterations. in each iteration, b, we resample the gene expression vectors of the  <dig> smokers and  <dig> never-smokers, respectively, with replacement. each gene or probe yields a p-value via calculating a t-statistic in the resampled data, and these statistics are passed to a gene set analysis algorithm to produce a enrichment p-values for the gene sets , which are stored in column b of a l×b matrix, for b= <dig> ,…,b. for each row, which represents a gene set, we count the number of times each subsampled p-value  is less than α , and divide it by the number of iterations , resulting in an estimate of the replication probability for that gene set .

estimated replication probabilities  are between  <dig> and  <dig>  where  <dig> means that the gene set always had a p-value greater than α in every iteration, and  <dig> means that the category always had a p-value less than α in each iteration. for analyses where the gene ranking is stable and the gene set calculation is stable, the replication probability will be higher. this estimate of replication assesses the stability of the gene sets, and might be a better estimate of biological reproducibility than the traditionally reported p-values. our goal is to identify the stable gene sets, akin to meinshausen and bühlmann   <cit>  in selecting a more stable set of covariates in a regression model.

algorithm  <dig> gene set bagging procedure datasets and implementation
simulated data
we designed two simulation studies to assess different properties of the replication probability based on the affymetrix human genome  <dig> plus  <dig>  gene expression microarray. basing the simulation on an existing array design, with probes annotated to genes that were already mapped to gene ontology categories, allowed us to realistically add differential expression signal to specific gene sets. we first selected a random sample of  <dig> gene sets to use in our simulation, which corresponded to  <dig> unique genes. then, for each simulation, we simulated genes via the following model: 

 mij=β0+βizj+εij 

 where εij∼n, βi∼n if gi is differentially expressed, and βi= <dig> if gi is not differentially expressed. the variables mij and zj  correspond to the expression value and group label, respectively.

in simulation  <dig>  we generated  <dig> datasets, where each consisted of  <dig> individuals . for each dataset, we made  <dig> genes differentially expressed and computed the observed p-value  and then the replication probabilities  for each gene set l= <dig> …,l. in simulation  <dig>  to directly assess the replication probability across two datasets with the same differentially expressed genes, we generated  <dig> pairs of datasets, where each dataset contained  <dig> individuals . for each data set, we set  <dig> genes to be differentially expressed, with the same parameter settings from the above model. this simulation mimics a perfect replication of the gene-set experiment where all parameters are the same. on each dataset, we then computed observed p-values  and replication probabilities  for each gene set l.

gene expression: cigarette smoking data
we tested the gene set bagging method in a differential expression analysis with publicly-available data obtained from gene expression omnibus . this study  examined the association of cigarette smoking with the oral epithelial transcriptome by comparing buccal biopsies in  <dig> never-smokers with  <dig> active-smokers using the affymetrix human genome u <dig> plus  <dig>  microarray  <cit> . we processed the raw cel files using the rma algorithm to perform intra-array normalization and then performed quantile normalization to adjust for between-array biases  <cit> .

we performed surrogate variable analysis  to adjust for potential batch effects  <cit> . briefly, this approach identifies the number of right singular vectors that are associated with more variation than expected by chance, and then in the subsets of genes driving this variation, constructs a ‘surrogate’ variable for each subset. these surrogate variables are then included as covariates in our differential expression analysis .

we identified differentially expressed genes comparing cases and controls while controlling for the surrogate variables using an empirical bayes approach  <cit> . to determine statistical significance, resulting p-values were converted to q-values to control for the false discovery rate  <cit>  and all transcripts with q-values less than  <dig>  were considered significant. we performed a full gene ontology analysis, and then ran the gene set bagging algorithm.

dna methylation: brain tissue
this approach is likely generalizable to most genomics platforms, and we first tested this hypothesis using dna methylation data processed on the illumina humanmethylation <dig> platform  from a recent paper  <cit>  that assessed quantitative trait loci using methylation and expression data in four different brain tissues . previous work has identified that dna methylation signatures can distinguish brain tissues, and might play a role in determining and stabilizing normal brain differentiation  <cit> . we conducted our gene set bagging algorithm on the differential dna methylation analysis between the frontal and temporal cortices. we performed the full differential methylation analysis comparing  <dig> front cortex and  <dig> temporal cortex samples using sva and the empirical bayes approach as described above. all probes with q-values less than  <dig>  were considered significant. we performed a full gene ontology analysis on the gene associated with each probe , and ran the gene set bagging algorithm.

RESULTS
r estimates the probability a gene set will be significant in a repeated study
the interpretation of the replication probability reflects the underlying stability of each outcome group. we simulated  <dig>  datasets from a common model , each with  <dig> differentially expressed genes. we then performed gene set analysis  using both the hypergeometric and wilcoxon tests and calculated the replication probability estimates for each of gene set in each of the  <dig>  simulated studies. the average replication probability estimate across all  <dig>  repeated studies very closely approximates the frequency that a gene set is observed to be significant in those  <dig>  studies . in other words, the estimate of the replication probability is close to the probability a gene set will be significant in a repeated study.

r correlates better with replication in repeated studies
besides identifying which gene sets are the most stable, we can also assess how well the replication probability  reflects biological replication by generating two independent simulated datasets with the same differentially expressed genes, meant to represent repeated studies of the same biological effect . we performed traditional gene ontology analysis on both datasets, obtaining p-values for each gene set calculated from the hypergeometric distribution, and then performed our gene set bagging algorithm. there was very strong spearman correlation between pairs of datasets across  <dig> simulation runs when all gene sets were considered regardless of whether the replication probability  or p-value  was used . however, when only gene sets where at least  <dig> of  <dig> datasets was significant at p< <dig>  per simulation run, the replication probability had much stronger correlation  than the p-value  .

these results suggest that globally, there might not be a large difference between the replication probability and the p-value, but when there is any signal in a particular gene set, the replication probability better captures independent replication of that set in future studies. we also performed the more robust wilcoxon rank rest on these simulated paired datasets, which also had less correlation between the resulting gene set p-values than the replication probability . there were many fewer significant gene sets by this enrichment approach than the hypergeometric test, and it was rare that both independent datasets within a simulation were significant at p< <dig> .

r may add biological interpretability
while many gene sets have both small p-values and high replication probabilities, examining discordant gene sets may improve the biological interpretation of the research question at hand. for example, in the gene expression dataset , there were  <dig> go categories with p >  <dig>  and r^> <dig>  under the hypergeometric test, including sets associated with phosphorylation , a process affected by cigarette smoking  <cit>  and regulation of metabolic processes .

similarly, examining the categories associated with dna methylation differences across brain tissue types that had at least moderate replication and non-significant p-values demonstrates support for the gene set bagging approach as well as the shortcomings of relying on strict gene set p-value cutoffs for gene ontology analysis . several biologically plausible go categories for a comparison of methylation differences in brain tissues fell into the “marginally significant” bin of observed p-values between  <dig>  and  <dig>  but had consistent replication.

there were many smaller gene sets that had statistically significant p-values  but never appeared in any of the resampled datasets  in both the gene expression  and dna methylation datasets . these represent very unstable gene sets, and should be interpreted with caution. categories with  would have been ignored in a traditional gene set analysis given their statistical significance measure, but might be biologically important to the question of interest. likewise, gene sets with  may be less biologically meaningful even though they are “statistically significant”.

we can characterize some global properties of the replication probability via these two datasets. overall, in the cigarette smoking gene expression dataset, the correlation between the replication probability r^ is correlated with the number of significant genes in a gene set . the gene set p-value shows a stronger correlation with the number of significant genes in a gene set . both quantities are also correlated with the total number of genes in a gene set r^  and gene set p-value . we also observe that larger datasets lead to better estimates of replication via the replication probability. comparing the smoking expression dataset  to the brain dna methylation dataset , we note that the smaller study has more gene sets with r^> <dig>  and has more gene sets with 0<r^≤ <dig> . however, the larger dataset has more gene sets with r^> <dig> .

relationship to the problem of regions
the set of test statistics corresponding to genes within an individual set can be viewed as a multivariate random vector. when viewed in this way, a gene set is significant if the vector of test statistics falls into a multi-dimensional region defined by the significance threshold. the replication probability is then a first-order approximation estimate of the posterior probability a gene set will be significant, assuming a non-informative prior distribution on the vector of test statistics. this problem has been considered in the case of multivariate normal data  <cit>  and for estimating confidence in inferred phylogenies  <cit> . as has been previously pointed out, this posterior probability is a reasonable first approximation to the posterior probability in question, but should not be interpreted as a frequentist measure of statistical significance  <cit> .

as an example of the relationship between the bootstrap and a posterior probability, suppose z <dig> …,zn∼n. a non-informative prior distribution for the parameters  is the jeffrey’s prior  <cit> . the jeffrey’s prior for μ is an improper uniform prior across the real line and the jeffrey’s prior for σ2∝1σ <dig>  using these prior distributions, the posterior distribution for μ is n where τ∼inversewishartn−1−1) and s2=1n∑i=1n <dig>  in this case, since μ is one dimensional, the inversewishart distribution is equivalent to an inversegamma distribution. drawing bootstrap samples from the zi and recalculating the mean approximates sampling from the posterior distribution of μ . it is important to note that the variance of the posterior for μ is inflated compared to σ <dig> assuming a frequentist model  <cit> . note that the p-values from these bootstrap samples should not be interpreted as measures of statistical significance, because they are no longer distributed uniformly.

discussion and 
CONCLUSIONS
we have developed a resampling-based strategy for assessing the stability of gene sets which also estimates the probability a gene set will replicate  in a future study. this direct approach to estimating replicability may be more useful than statistical significance for investigators who aim to identify stable and reproducible biological interpretations of their results. by utilizing resamplings of the observed data that respect the study design, the reproducibility of gene sets can be quantified, represented by the replication probability r of each gene set category across all subsamples. this approach can offer an additional metric beyond the gene set p-value for identifying important biological pathways. we have applied this method to gene expression and dna methylation under two commonly-used enrichment metrics: the hypergeometric test and the wilcoxon rank test. we demonstrated that some seemingly statistically significant go categories fail to replicate consistently. a strength of our approach is the likely generalizability of this algorithm to other genomics applications, including incorporating bias-correcting approaches like sva into the analysis, to assess the stability and replicability of significance results.

gene sets with high replication probabilities and low p-values represent statistically significant, stable, and consistent sets that might best represent the underlying biology within the experiment. overall, the wilcoxon rank test appears more stable than the hypergeometric p-value, using simulated and real data. there was less disagreement between gene set p-values and replication probabilities, and the quantitative relationship between the replication probability and p-value was more precisely defined . given that most genomics studies require some form of external replication and that r appears more correlated with replication in future studies than p-values alone, we might also suggest following up gene sets that have high replication probabilities  even if the p-values are marginally, or even non-significant. the gene set bagging algorithm has been implemented in the r package “genesetbagging”, available through github . users may choose different gene set p-value and replication probabilitiy cutoffs depending on their resources for follow-up studies.

genomics studies often involve drawing the majority of biological conclusions from the results of a gene set analysis without assessing the stability of the results. we envision replication probabilities used in conjunction with standard measures of statistical significance, as the emphasis on replication in genetics and genomics makes the replication probability a useful quantity to estimate and use in conjunction with p-values. we have demonstrated that gene lists are not necessarily stable, and therefore additional steps like gene set bagging should be undertaken to improve the biological inference of a given study.

competing interests
the authors declare that they have no competing interests.

authors’ contributions
jtl and jds designed the study, aej performed the analyses, aej hj jds and jtl wrote the manuscript. all authors read and approved the final manuscript.

