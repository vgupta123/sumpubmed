BACKGROUND
an organism’s genome contains a collection of genes and regulatory elements that are located in particular order and orientation. the organization and relative distance of these features from one another can direct their activity patterns. a classic example includes the hox gene clusters  <cit> , which are preserved as four to eight distinct regions among vertebrates  <cit> . the hox proteins and their regulatory machinery control organism development, and while the different copies share sequence similarity with each other, it is the spatial organization that determines the timing of expression. the hox genes have undergone several duplication and expansion events during evolutionary history, allowing for more specialized roles in fine-tuning development, facilitating increased organismal complexity  <cit> . more generally, gene duplications are a common mechanism for subsequent sub- and neo-functionalization, both in terms of proteins, as well as in regulation. for example, up to two thirds of vertebrate genes are members of families  <cit> , which have been generated by local duplications, block duplications and whole genome duplications.

for a comprehensive comparative genomics study, it is thus paramount to accurately identify orthologous sequences that arose through duplication events, both prior to and after speciation. due to complex patterns of selective pressure, resulting in conservation of sequences, loss of sequences, as well as invention of new functions, nucleotide or protein similarity is not a reliable measure to unambiguously resolve orthologs  <cit> . however, orthologs can be recognized through conserved synteny, i.e. the locally conserved order and orientation of features, which has been observed even in species with high turnover rates of gene duplication, expansion and loss, such as in mammals  <cit> . synteny alignments are either computed relative to one central genome, as for example human, as described in the  <dig> mammalian genomes project  <cit> , or via a complete set of pairwise comparisons, where the computational time for the analysis of n genomes is in the order of o. here, we describe a novel computational method, kraken, which provides both the independence of a central genome, as well as eliminating the time consuming step of generating all pairwise synteny maps. for setting up a synteny framework, kraken uses maps generated by the genome-wide synteny alignment programs and methods such as lastz chained alignments  <cit> , mummer  <cit> , symap  <cit> , satsuma  <cit> , synmap  <cit> , or alignment graphs, for example enredo/pecan  <cit> , and hal  <cit> . next, kraken infers indirect syntenic relationships between two genomes not connected through a synteny map via indirection, i.e. the mapping of regions through a graph of synteny maps and by dynamically augmenting local alignments.

as such, kraken constitutes a core utility aiming at resolving several bioinformatics challenges currently facing life sciences. in particular, high-throughput sequencing technologies generate millions of reads from rna, which, in turn, predict tens or hundreds of thousands of transcribed loci, each of which can contain multiple isoforms. to assess the quality and biological relevance of each prediction, additional evidence is required. an automated utility, which compares transcriptional activity in orthologous regions across multiple species, can provide such evidence, in particular for novel loci that might have a function that is yet to be determined.

in the following sections, we describe kraken’s implementation, and evaluation of the accuracy, sensitivity, and specificity on a set of  <dig> drosophila genomes spanning a long range of genomic distances  <cit>  and the well-annotated mouse, human, and rat genomes. we then apply kraken to rapidly and automatically establish transcription orthology maps across multiple vertebrate species for known and novel loci, leveraging previously generated rna-sequence data  <cit> .

implementation
an overview of kraken’s workflow is shown in figure 1a: the input is comprised of  genome sequences, in chromosome or scaffold coordinates;  synteny maps, generated from synteny alignment programs or extracted from multiple alignment graphs; and  annotations or feature coordinates, specified in gene transfer format . for each genome, kraken’s output is provided on two levels:  gtf files in translated coordinates, preserving all of the original information; and, if applicable,  a list of spatial relationships between overlapping translated annotations and native annotations. figure 1b shows a flow chart of how the input data is processed. after all genomes, synteny maps, and input coordinates are loaded into memory, each query coordinate is translated into the genomic coordinate system of the target genome in a multi-step process:  estimate candidate locations of orthologous coordinates through the synteny graph;  perform a rapid alignment of the input sequence against the target region based on a cross-correlation algorithm; and  compute a local sequence alignment to determine the exact target coordinates. optionally,  coordinates in target coordinates are compared against a reference gtf, accommodating for features with multi-exonic structures and multiple isoforms. in the following, we describe each step in detail.

configuration
kraken reads the meta-data accompanying a dataset from a configuration file. this file lists the file locations of the genomes , the synteny maps  and the genomes they connect and in what direction. kraken requires the pre-computed pairwise synteny maps to provide the coordinates of orthologous regions , in intervals specifying the corresponding:  chromosome or scaffold name;  first nucleotide position in the interval;  last nucleotide position in the interval. maps need to be provided in one direction  only, and are duplicated and inverted in memory to supply both directions . all positions  in the synteny maps are sorted by chromosome first and position next in target coordinates, setting up a data structure for binary search.

synteny graph
kraken performs an exhaustive search through all possibilities from source to target genomes through a synteny graph built from pairwise synteny as specified in the configuration file, and selects the path with either  the lowest number of indirect mappings, or  by minimizing the accumulated genomic distances, if specified. the path is determined prior to coordinate translation and fixed from there on. more formally, the synteny graph g is an undirected graph, where the nodes, v, consist of the genomes and the pairwise synteny alignments between the genomes constitute the edges of the graph, e. the graph edges are weighted by genomic distances if available, and otherwise they are non-weighted. for a given pair of genomes, , the shortest path is found by minimizing the edge distances on the path.

coordinate translation
each interval specified in the source gtf is translated individually by looking up the lower bound of the start and higher bound of the end position. the coordinate start and stop can either directly fall into syntenic anchors, or in between anchors, in which case the candidate interval is widened to the next adjacent syntenic map entries. this process is repeated until the target genome is reached. translated target coordinates on the same chromosome or scaffold with syntenic flanks in consistent orientation of up to  <dig>  nt are passed on to the next step, otherwise, the region is split into two target intervals, one from each side  to allow for searching the boundaries of syntenic breaks.

rapid alignment
for computational efficiency, kraken performs a quick search of the source sequence against the target interval by employing an approximate cross-correlation alignment, as originally implemented by satsuma  <cit> . to limit the processing time and memory requirements of the underlying fourier transform, the target interval is broken into overlapping sequences of  <dig> nucleotides in size, the source sequence is cross-correlated against each block, and the block with the highest absolute cross-correlation signal is computed. based on the size of the source interval, kraken determines a candidate region equal to that size plus flanks on each end  based on the offset of the cross-correlation signal.

dynamic local re-alignment
detailed alignment of the source sequence is performed using the cola  <cit>  implementation of a banded alignment with gap-affine penalties  <cit>  against the target sub-sequence, which is defined by the offset determined by the rapid alignment. for source intervals of >100 nt, the sequence is split into two 100 nt chunks at each end covering the start and end region of the sequence, both in the source and the target genomes. a p-value threshold to accept alignments is configurable and defaults to 10− <dig>  alignments are not required to cover the entire source sequence, i.e. nucleotide mismatches at the boundaries are permissible . in that case, the final translated target coordinates are estimated based on the alignment offset into the source sequence, i.e. if the alignment starts at position k in the source feature, the target start coordinate is adjusted by -k nucleotides . output is provided in gtf format, where for all the items that were successfully translated an output entry is produced containing the translated coordinates.

feature matching
optionally, kraken allows for directly comparing translated coordinates to features specified in the coordinates of the target genome, following the gtf file convention for exons, transcripts, and genes. kraken stores gtf coordinates internally in the following data structures :  exons, which are intervals , consisting of a chromosome name, start and end coordinate;  transcripts, which are generalizations of items and extend functionality by owning a number of exons; and  loci, which also generalize items but own a set of transcripts. kraken instantiates arrays of each type in sorted order for efficient retrieval, and stores ownership relationships between items, transcripts and loci bi-directionally to facilitate fast referencing in either direction. thus, kraken allows for rapidly inferring spatial relationships between the genomic features in the source and target genome, if the latter are available in gtf format, and taking into account their multi-exonic structures. kraken classifies matches as:  full sense overlap, i.e. all exons of the source transcript overlap all exons of the target transcript and fall on the same strand;  partial sense overlap, i.e. one or more exon overlap in sense direction;  intronic , i.e. the coordinates of the source transcript overlap an intron of a target locus; and  antisense , i.e. overlapping target exons in the opposite strand. the coordinates of all translated features, the relationships described above, and the overlapping target annotations are reported in human-readable outputs that are also friendly to machine parsers.

RESULTS
translating genomic intervals between  <dig> fruit fly species: evaluating synteny graphs
to examine how translation through intermediate synteny maps along a graph impacts sensitivity, we evaluated kraken on  <dig> pairwise comparisons between the genomes of  <dig> drosophila fruit flies  <cit> . drosophila species are a diverse group  and cover small to large genomic timespans , allowing for measuring accuracy as a function of genomic distance. moreover, the genomes are of moderate size , so that computing a full set of pairwise synteny maps as the baseline for comparison is computationally feasible. we first generated all pairwise genome-wide syntenic alignments using satsuma  <cit> . we next selected  <dig>  random genomic intervals of  <dig> base pairs in size for each genome, and used kraken to translate these sequences into the coordinates of all other genomes using three different topologies:  a star configuration with d.melanogaster in the center ;  a star configuration with d.sechillia in center ; and  a clade configuration  roughly following species phylogeny . table  <dig> summarizes the results. we first observed that for closely related species, such as d.yakuba and d.erecta, more than 80% of blocks could be successfully translated, while this fraction drops to about 12% for more distantly related species such as d.simulans and d.wilstoni. however, genomic distance does not majorly impact the fraction of successful indirect to direct translations: for example, for the closely related species pair d.erecta/d.yakuba in the melanogaster star configuration,  <dig> % of directly translated blocks are matched in the indirect translation, while this fraction is only slightly lower for the more distantly related pairs d.erecta/d.mojavensis  and d.erecta/d.willstoni . the median fraction of identical indirect/direct translations is highest in the d.melanogaster star topology , followed by the d.sechellia star , and clade  topologies. while overall, using the high-quality genome of d.melanogaster as the center yields the best results with respect to the topologies evaluated here, individual statistics suggest that a more complex topology allowing for alternative paths to traverse the synteny graph yields higher sensitivity .
drosophila 
dataset

each row shows results for blocks of  <dig> nucleotides randomly chosen from the source genome. results are shown for three different configurations for indirect translation that are depicted in figure  <dig>  namely, d.melanogaster-star, d.sechellia-star and the clade-center configuration, where in each case we report two items:  total number of blocks translated through the specified configuration  and  the fraction of directly translated blocks that are matched by identical indirect translations. to compact the results, pairwise comparisons where at least one configuration would result in a direct comparison have not been included here. also, the species are shown in abbreviated format; see figure  <dig> for equivalent complete species name.

matching genes between human, rat, and mouse: a quantitative assessment
we evaluated kraken’s quantitative performance with regards to known genomic features by matching translated gene structures across three well-annotated high-quality mammalian genomes: human , mouse , and rat . using pairwise synteny maps between the genomes generated by lastz  <cit> , we translated all annotated genes  in six pairwise comparisons across genomic coordinates. table  <dig> summarizes the results: overall, between 77% and 95% of transcripts could be unambiguously translated, with between 90% and 96% of these overlapping with annotated loci in the target genome. this fraction is higher for the protein-coding set, ranging from 93% to 98%, likely due to higher sequence conservation and sequence similarity. kraken matched more annotated transcripts between human and mouse than human and rat, possibly because of differences in the quality of the genome builds and/or annotation. among the  <dig>  protein coding gene loci that failed to be translated from human to mouse, more than half  can be divided into the following five categories:   <dig> uncharacterized and hypothetical proteins;   <dig> loci with predicted open reading frames but without functional prediction;   <dig> pseudogenes from ribosomal proteins;   <dig> zinc finger proteins;   <dig> olfactory receptors; and   <dig> keratin associated proteins. while the first two categories represent genes of uncertain annotation status, the latter are comprised of members of gene families that are highly variable in copy number, or genes that have been known to undergo lineage-specific expansions. figure  <dig> shows three-way venn diagrams based on maximal overlaps  for all transcripts , and for the protein-coding subsets . as in the pairwise comparisons, the fraction of overlaps is higher for protein coding genes. notably, the rat annotates the lowest number of isoforms per protein coding gene, however, more than 90% of those overlap isoforms in both human and mouse, and almost all overlap mouse transcripts, suggesting that the rat annotation mostly contains dominant isoforms. we attribute the large fraction of ‘human-only’ transcripts to the more than three-fold number of annotated alternative isoforms per human gene locus.

for each comparison instance we show two items:  the total number of transcripts that kraken successfully translates and  the number of successfully translated transcripts for which we find an exon overlap based on comparison with a reference annotation. we also show in brackets:  the percentage of translated transcripts to the total number of transcripts and  the ratio of overlapping transcripts to the total number translated.

we next compared the results to the methods halliftover  <cit>  and ratt  <cit> , using the ensembl compara database  <cit> , a manually curated set of orthologous relationships between protein-coding transcripts across species for human, as independent metrics . all methods largely agree in their predictions, with kraken consistently and on all data sets exhibiting the highest overlap with comparadb, as well as the lowest number of transcripts predicted by comparadb only . we note that ratt, which we ran in ‘species mode’  <cit> , yielded similar results to halliftover and kraken on the mouse/rat comparison, but considerably fewer predictions for the more distantly related human/mouse and human/rat data sets.

the numbers in each row left to right show  the overlap, i.e. transcripts predicted by both comparadb and the methods kraken, halliftover, and ratt respectively;  transcripts found only in comparadb; and  transcripts found by kraken, halliftover, or ratt, but not comparadb.

accuracy on nucleotide level: a qualitative assessment
we next examined the accuracy of kraken, comparing the translated boundaries of exons to gene models native to the target genome for the human, mouse, and rat dataset . for protein coding exons, kraken matches  <dig> to 83% of complete exons between genomes with exact agreement at both splice junctions, and up to 97% of exon with exact matches in at least one splice junction. in examining cases in which the predictions did not exactly match the annotations, we found that the majority of differences differ by multiples of three nucleotides , which is consistent with varying numbers of amino acids across species, indicating that the predicted coordinates could reflect actual biological differences in transcription between species. by contrast, we did not observe this pattern for exons of long intergenic non-coding genes , which further supports that the periodicity observed for protein coding genes is biologically valid, rather than stemming from algorithmic artifacts, such as systematic alignment biases.

for each comparison three items are shown:  total number of coding sequences translated from source to target species,  number of items translated that also find an exact match in the reference target annotation  similar to ii but also including those items that exactly match either on their start or stop coordinate. for  and , the percentage of category items matched to the total number mapped is given in brackets.

resolving transcribed single-copy genes and gene family orthologs in vertebrates
in order to illustrate kraken’s power as a practical tool for processing large and complex datasets, we re-analyzed publicly available rna-sequence data obtained from different vertebrates and multiple tissues  <cit> . we first mapped the rna-sequence reads onto the respective genomes of human, chimp, gorilla, opossum, and chicken using tophat  <cit> , without reference annotation guidance, and allowing for the detection of un-annotated transcripts and isoforms. next, we estimated rpkm expression values from the unpaired reads using cufflinks/cuffdiff  <cit>  and merged experimentally found transcripts with the reference annotations  using cuffmerge  <cit> . we then used kraken to translate the coordinates of transcribed features through a minimal set of lastz-chained alignments. a selection of pairwise interspecies transcript relationships are summarized in table 5: overall, the number of transcripts that can be translated decreases with genomic distance from  <dig>  for human-chimp to  <dig>  for chicken-human. likewise, the fraction of protein-coding genes, which are among the most highly conserved genomic features, is higher for more distantly related organisms. we next investigated whether protein-coding single copy genes and gene family members, defined by ensembl  <cit>  based on clustering by protein similarity, consistently show distinct expression patterns across tissues and species . we computed spearman’s correlation coefficients between the tissues of all species-pairs separately for the two gene sets, and compared them to each other, highlighting the differences : in all comparisons of mismatched tissues , single copy genes are more correlated than orthologous gene family members . moreover, gene family paralogs are more highly correlated in matched brain and cerebellum tissues compared to single copy genes , while liver and kidney show the opposite trend , with heart showing patterns in between . in all cases, testis is least correlated compared with other tissues  both in single copy genes and gene families, and for large genomic distances . testis genes are also less correlated in cross-species comparisons, while correlation is comparable to other tissues in primates . in terms of absolute values for correlations of both single copy and multiple copy genes, species are grouped according to phylogeny, including the primate clade, albeit statistically weakly , with  <dig> out of  <dig> matched tissue comparisons  placing human closer to chimp than gorilla. notably, comparisons involving kidney indicate higher correlations for human-gorilla than human-chimp.

for each source-target genome pair, we list the number of transcripts mapped from the source that overlap with annotations in the target, indicating the number of annotated transcripts, and the number annotated as protein coding genes in the target genome. we further list overlaps of single-copy genes and gene family members, determined by the genome of the source, with annotated protein coding genes in the target both at the transcript and locus level.

expression of novel transcripts in three primates
kraken’s independence of known annotations or protein coding genes allows for the analysis of transcribed loci that have not previously been characterized. for example, thousands of long intergenic non-coding rnas have recently been found in human  <cit> , mouse  <cit> , zebrafish  <cit> , and dog  <cit> . in the human genome, we found a total of  <dig>  actively transcribed loci based on rna-seq data  <cit> ,  <dig>  of which fell outside of ensembl annotations. of these,  <dig>  and  <dig>  were also actively transcribed in chimpanzee and gorilla respectively, with  <dig>  transcribed in all three genomes. while the expression levels are correlated across species at much lower levels than those of known protein-coding genes, matched tissue comparisons still exhibit statistically significant correlations , with testis being the most correlated tissue in both human-chimp and human-gorilla. the reported correlation measures have high statistical significance with a maximum p-value of 10− <dig> 

CONCLUSIONS
the analytical power of comparing features across multiple genomes has been demonstrated in the past and dates back to the early days of modern genomics. more recent examples, in which the order and orientation of genomic landmarks played a critical role, include describing a whole genome duplication event in the baker’s yeast saccharomyces cerevisiae <cit> , and several analyses of evolution in the chordate and vertebrate lineages . recent advances in dna sequencing and assembly, coupled with the generation and processing of functional sequence datasets, notably rna-sequencing, which often result in hundreds of thousands of transcripts, highlight the need for a new generation of high-throughput computational analysis tools. such tools are required to process:  large genomes;  large numbers of genomes;  large sets of genomic features, including large numbers of paralogous loci; but:  without large computational efforts. here we described kraken, a novel computational method and software that fills this niche. using the genomes of  <dig> fruit flies, we showed that the ability to translate indirectly, i.e. use an intermediate genome as a guide and then re-computing local alignments, comes at marginal cost in sensitivity, but at a substantial gain in computational efficiency: by removing the need to statically compute all-to-all synteny maps, kraken scales linearly with the number of genomes and allows for the simultaneous analysis of dozens or even hundreds of genomes. we next evaluated kraken on the well established and highly scrutinized genomes of human, mouse, rat, and showed that mapping orthologous sequences is highly accurate in predicting the precise boundaries of genomic features. this is particularly relevant for comparing protein-coding genes, since errors of even a single nucleotide can cause erroneous frame shifts and stop codons in open reading frames. thus, kraken can be used with ease to either create or improve comprehensive annotations through orthology for genomes that have little or no validated evidence within a few cpu hours, a functionality that is also provided by other, albeit more specialized software programs, such as ratt  <cit> , genemapper  <cit> , and halliftover  <cit> .

to showcase kraken’s utility for large-scale research projects aimed at discovering hitherto unexplored functional connections between orthologous members of gene families residing in different genomes, we re-analyzed a previously published large and comprehensive dataset consisting of rna-seq data from different tissues and multiple vertebrates  <cit> . we emphasize that kraken completed the analysis presented here within only a few hours of wall clock time and with minimal human involvement, yet yielding a rich set of results that are concordant with biological expectations and previous reports. in summary, we found that single-copy genes are more highly correlated across tissues and species than gene family members, which would indicate that single copy genes are enriched for fundamental cellular function essential to cells of different tissue types. by contrast, paralogs of gene families could have taken on more specialized roles, consistent with the concept of duplication and subsequent neo- and sub-functionalization  <cit> . moreover, orthologous gene family members are more highly correlated in brain tissues across species than their single-copy gene counterparts. this suggests that a number of genes, which were duplicated early in the vertebrate lineage, took on specialized functions in the brain, and were subsequently fixed in expression patterns, whereas we did not observe this consistently in the other tissues for which sequence was available. the pattern we see would fit with the theory that the complexity of the vertebrate brain and nervous system can in part be contributed to the redundancy of genes following the two whole genome duplications early in vertebrate evolution  <cit> . moreover, in three primates we found overlap of un-annotated transcribed regions, likely non-coding rnas, with transcription levels most highly correlated across species in testis. testis has been known to be the most actively transcribed tissue  <cit> , and our results suggest that transcription does not occur in a random fashion. long non-coding rnas have recently been shown to take part in the circuitry controlling stem cell pluripotency and cell differentiation  <cit> , consistent with expression in reproductive tissues, and indicating that the set of known rnas is still an incomplete subset of the full inventory of all such transcribed loci.

in conclusion, we expect kraken to dramatically reduce computational analysis time when deployed in future large-scale comparative studies. for a newly sequenced mammalian genome, for example, generating synteny maps to a single other mammal is sufficient for comparing it to dozens of others, at little extra computational cost. moreover, the availability of second- and third-generation dna and rna sequencing technologies have made it possible to expand the set of reference genomes and expressed sequences into different branches of life. successful and rapid analyses will thus require a computational framework that is easy to use and easy to set up.

availability and requirements
project name: kraken - a universal genomic coordinate translator for comparative genomics

project home page:http://github.com/nedaz/kraken

operating system: linux

programming language: c++

license: source code freely available under lpgl

competing interests
the authors declared that they have no competing interests.

authors’ contribution
nz and mgg designed and developed the software; nz, gs, mph, jrsm, jd, hl, bjh, and mgg designed and performed the analyses. mph, gs, jrsm, hl, and mgg provided the biological interpretation of the results. all authors wrote the manuscript.

