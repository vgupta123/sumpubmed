BACKGROUND
recent decades have seen extensive development in phylogenetic inference, resulting in a myriad of techniques, each with specific properties concerning evolutionary model complexity, inference procedures and performance both in terms of speed of execution and estimation accuracy. with the development of such phylogenetic inference methods comes the need to synthesize evolutionary data in order to compare estimator performance and to characterize strengths and weaknesses of different approaches . whereas the true underlying evolutionary relationships between biological sequences are generally unknown, monte carlo simulations allow generating test scenarios while controlling for the evolutionary history as well as the tempo and mode of evolution. this has been frequently used to compare the performance of tree topology estimation , but it also applies to evolutionary parameter estimation and ancestral reconstruction problems . in addition, monte carlo sequence simulation has proven useful for assessing model adequacy  and for testing competing evolutionary hypotheses . it is therefore not surprising that several general sequence simulation programs have been developed , but also inference packages that do not primarily focus on tree reconstruction, such as paml  <cit>  and hyphy  <cit> , maintain code to simulate sequence data under the models they implement.

as a major application of phylogenetics, estimating divergence times from molecular sequences requires an assumption of roughly constant substitution rates throughout evolutionary history  <cit> . despite the restrictive nature of this molecular clock assumption, its application in a phylogenetic context has profoundly influenced modern views on the timing of many important events in evolutionary history  <cit> . following a long history of applying molecular clock models on fixed tree topologies, the bayesian evolutionary analysis by sampling trees  package  <cit>  fully integrates these models, including more realistic relaxed clock models  <cit> , in a phylogenetic inference framework. despite its popularity this framework has lacked a flexible and efficient simulation tool. here, we address this pitfall by introducing a parallel beast/beagle utility for sequence simulation  that integrates substitution models, molecular clock models, tree-generative  models and trait evolutionary models in a modular fashion, allowing the user to simulate sequences under different parameterizations for each module.

πbuss readily incorporates the temporal dimension of evolution through the possibility of specifying different molecular clock model. further, many models and data types available for beast inference are matched by their simulation counter-parts in πbuss, including relatively specific processes, such as for discrete phylogeography with rate matrices that can be sparse or non-reversible  <cit>  that are generally beyond the scope of most sequence simulation tools. the beast- πbuss connection is further reinforced by the fact that πbuss can easily generate simulation specification in xml format for beast. finally, we implement the core simulation routine within the beast code-base to ensure a shared xml syntax between the two packages and to allow for joint simulation and inference analysis using a single input file.

implementation
through different implementations, we support several sequence simulation procedures that balance between ease-of-use and accessibility, to model complexity. on the one hand, the core simulation routine can be performed following specifications in an xml input file that is understood by beast . this procedure provides the most comprehensive access to the πbuss arsenal of models, but may require custom xml editing. on the other hand, πbuss also represents a stand-alone package that conveniently wraps the simulation routines in a user-friendly graphical user interface , allowing users to set up and run simulations by loading input, selecting models from drop-down lists, setting their parameter values, and generating output in different formats . to facilitate scripting, πbuss is further accessible through a command-line interface , with options that mirror the gui. the simulation routines are implemented in java and interface with the broad-platform evolutionary analysis general likelihood evaluator  high-performance library  <cit>  through its application programming interface  for computationally intensive tasks.

the core of πbuss consists of a recursive tree-traversal that is independent of the beast inference machinery. the algorithm simulates discrete state realizations by visiting the tree nodes in pre-order fashion, i.e., parental nodes are visited before child nodes. when a child node is visited, πbuss samples its state from the conditional probabilities of changing to state j given state i at the parental node. for a branch length t and clock rate r, the finite-time transition probability matrix p is calculated through the eigen-decomposition of the infinitesimal rate matrix q along that branch. for a review of methods to numerically approximate a matrix exponential, we refer to  <cit> . by sharing the set of xml parsers with beast, we simplify the simultaneous development of both packages and facilitate the ability to perform joint simulation and inference analyses.

program input
the core implementation of the software can be invoked by loading an xml file with simulation settings in the beast software. the simulation procedure requires a user-specified tree topology or a set of taxa with their heights  for which a tree topology can be simulated using a coalescent model. setting all heights to  <dig> would be equivalent to contemporaneously-sampled taxa. in πbuss, such a tree can be loaded in nexus or newick format, or a taxa list can be set-up in the data panel for subsequent coalescent simulation of the genealogy. creating the latter is further facilitated by the ability to load a tab-delimited file with a set of taxa and their corresponding heights. the input tree or taxon list can also be specified through the command-line interface of πbuss.

program output
πbuss generates sequence output in fasta or nexus format but it also supports xml output of the simulation settings. the xml provides a notation for the models used, it can also be used to store a record of the settings. similar to beauti for beast, πbuss can generate an xml template for editing more complex simulations, or this can be amended with beast analysis settings order to directly analyze the generated sequence data, which avoids writing to an intermediate file. the tutorial hosted on πbuss webpage provides examples of these possibilities.

models of evolution
πbuss is capable of generating trees from a list of taxa using simple coalescent models, including a constant population size or exponential growth model. the software supports simulation of nucleotide, amino acid and codon data along the simulated or user-specified phylogeny using standard substitution models. for nucleotide data, the hasegawa, kishino and yano model , the tamura nei model  and the general time-reversible model  can be selected from a drop-down list, and more restrictive continuous-time markov chain  models can be specified by tailoring parameters values. coding sequences can be simulated following the goldman and yang model of codon evolution , which is parameterized in terms of a non-synonymous and synonymous substitution rate ratio  and a transition/transversion rate ratio  or following the muse and gaut model . several empirical amino acid substitution models are implemented, including the dayhoff  <cit> , jtt  <cit> , blosum  <cit> , wag  <cit>  and lg  <cit>  model. equilibrium frequencies can be specified for all substitution models as well as among-site rate heterogeneity through the widely-used discrete-gamma distribution  <cit>  and proportion of invariant sites  <cit> .

an important feature of πbuss is the ability to set up an arbitrary number of partitions for the sequence data and associate independent substitution models to them. such settings may reflect codon position-specific evolutionary patterns or approximate genome architecture with separate substitution patterns for coding and non-coding regions. partitions may also be set to evolve along different phylogenies, which could be used, for example, to investigate the impact of recombination or to assess the performance of recombination detection programs in specific cases. finally, partitions do not need to share the exact same taxa , and in partitions where a particular taxon is not represented the relevant sequence will be padded with gaps.

πbuss is equipped with the ability to simulate evolutionary processes on trees calibrated in time units. under the strict clock assumption, this is achieved by specifying an evolutionary rate parameter that scales each branch from time units into substitution units. πbuss also supports branch-specific scalers drawn independently and identically from an underlying distribution , modeling an uncorrelated relaxed clock process  <cit> . simulations do not need to accommodate an explicit temporal dimension and input trees with branch lengths in substitution units will maintain these units with the default clock rate of  <dig> .

the data types and models described above are available through the πbuss gui or cli, but additional data types and more complex models can be specified directly in an xml file. this allows, for example, simulating any discrete trait, e.g. representing phylogeographic locations, under reversible and nonreversible models  <cit> , with potentially sparse ctmc matrices  <cit> , as well as simulating a combination of sequence data and such traits. as an example of available model extensions is the ability to specify different ctmc matrices over different time intervals of the evolutionary history, allowing for example to model changing selective constraints through different codon model parameterizations or seasonal migration processes for viral phylogeographic traits  <cit> .

RESULTS
we have developed a new simulation tool, called πbuss, that we consider to be a rejuvenation of seq-gen  <cit> , with several extensions to better integrate with the beast inference framework. compared to seq-gen and other simulation software , πbuss covers a relatively wide range of models while, similar to mesquite, offering a cross-platform, user-friendly gui. πbuss is implemented in the java programming language, and therefore requires a java runtime environment, and depends on the beagle library. although speed is unlikely to be an impeding factor in most simulation efforts, the core implementation using the beagle library provides substantial increases in speed for large-scale simulations, in particular when invoking multi-core architecture to produce highly partitioned synthetic sequence data.

1
2
3
4
1πbuss: gy <dig>  mg94; phylosim: gy <dig> x m <dig> - m4; recodon: gy <dig> x m <dig>  m <dig>  m <dig>  m8; netrecodon: gy <dig> x m <dig>  m <dig>  m <dig>  m8; indelible: gy <dig> x m <dig> - m10; evolver: gy <dig> x m <dig>  m <dig>  m <dig>  m <dig>  m <dig>  m8; alf: gy <dig> x m <dig>  m <dig>  m <dig> and m8; genomepop: mg <dig>  2πbuss: blosum  <cit> , cprev  <cit> , dayhoff  <cit> , flu  <cit> , jtt  <cit> , lg  <cit> , mtrev  <cit> , wag  <cit> ; seq-gen: jtt, wag, pam  <cit> , blosum, mtrev; indel-seq-gen2: pam, jtt, mtrev, cprev; phylosim: cprev, jtt, lg, mtart  <cit> , mtmam  <cit> , mtrev <dig>  <cit> , mtzoa  <cit> , pam, wag; indelible: dayhoff, jtt, wag, vt  <cit> , lg, blosum, mtmam, mtrev, mtart, cprev, rtrev  <cit> , hivb  <cit> , hivw  <cit> ; evolver: dayhoff, jtt, wag, mtmam, mtrev; proteinevolver: blosum, cprev, dayhoff, hivb, hivw, jtt, jones  <cit> , lg, mtart, mtmam, mtrev <dig>  rtrev, vt, wag; alf: pam,gtt,lg,wag; simprot: pam, jtt, pmb. 3πbuss: demography; recodon: recombination, migration, demography; netrecodon: recombination, migration, demography; mesquite: speciation; proteinevolver: recombination, migration, demography; simcoal: demography and migration. 4phylosim: r package; indelible: executables for windows and macos; alf: web interface; genomepop: executables for windows and linux; simcoal: executables for windows; simprot: gui, web interface; simprot: executables for windows and linux. 5forward simulation including recombination, demography and migration.

program validation
we validate πbuss in several ways. first, we compare the expected site probabilities, as calculated using tree pruning recursion  <cit> , with the observed counts resulting from πbuss simulations. to this purpose, we calculate the probabilities for all  <dig> possible nucleotide site patterns observed at the tips of a particular 3-taxon topology using an hky model with a discrete gamma distribution to model rate variation among sites. we then compare these probabilities to long-run  site pattern frequencies simulated under this model and observe good correspondence in distribution .

we also perform simulations over larger trees and estimate substitution parameters  using beast for a large number of replicates. not only do the posterior mean estimates agree very well with the simulated values, but we also find close to nominal coverage, and relatively small bias and variance . these good performance measures have also recently been demonstrated for more complex substitution processes  <cit> .

example application
we illustrate the use of simulating sequence data along time-calibrated phylogenies to explore the limitations of estimating old divergence times for rapidly-evolving viruses. wertheim and kosakovsky pond  <cit>  examine the evolutionary history of ebola virus from sequences sampled over the span of three decades. although maintaining remarkable amino acid conservation, the authors estimate nucleotide substitution rates on the order of 10− <dig> substitutions/per site/per year and a time to most recent common ancestor  of about  <dig>  years ago. these estimates suggest a strong action of purifying selection to preserve amino acid residues over longer evolutionary time scales, which may not be accommodated by standard nucleotide substitution models. the authors demonstrate that accounting for variable selective pressure using codon models can result in substantially older origins in such cases.

here, we explore the effect of temporally varying selection pressure throughout evolutionary history on estimates of the tmrca using nucleotide substitution models. in particular, we model a process that is characterized by increasingly stronger purifying selection as we go further back in to time. to this purpose, we set up an ‘epoch model’ that specifies different gy <dig> codon substitution processes along the evolutionary history  <cit> , and parameterize them according to a log-linear relationship between time and ω. specifically, we let the process transition from ω =  <dig> ,  <dig> ,  <dig> ,  <dig> ,  <dig> ,  <dig> , and  <dig>  at time =  <dig>   <dig>   <dig>   <dig>   <dig> and  <dig> years in the past, respectively. we simulate a constant population size genealogy of  <dig> taxa, sampled evenly during a time interval of  <dig> years, and simulate sequences according to the time-heterogeneous codon substitution process with a constant clock rate of 3×10− <dig> codon substitutions/codon site/year. we simulate  <dig> replicates over genealogies with varying tmrcas, by generating topologies under different population sizes parameterized by the product of effective population size  and generation time scaled in years : 

 ne×τ= <dig> , <dig> , <dig> , <dig> 

we note that under this model, trees with tmrcas of about  <dig>  years still result in sequences with a noticeable degree of homology . using a constant ω of  <dig>  on the other hand results in fairly randomized sequences. we subsequently analyze the replicate data using a codon position partitioned nucleotide substitution model in beast and plot the correspondence between simulated and estimated tmrcas in figure  <dig> 

our simulation exercise shows that a linear relationship between simulated and estimated tmrcas only holds for  <dig> to  <dig> years in the past, and estimates quickly level off after about  <dig> years in the past. this can be explained by the unaccounted decline in amino acid substitutions and saturation of the synonymous substitutions as we go further back in time. although we are not claiming that evolution occurs quantitatively or even qualitatively according to the particular process we simulate under, and we ignore other confounding factors , this simulation does conceptualize some of the limitations to estimating ancient origins for rapidly evolving viruses that experience strong purifying selection over longer evolutionary time scales.

CONCLUSIONS
πbuss provides simulation procedures under many evolutionary models or combinations of models available in the beast framework. this feature facilitates the evaluation of estimator performance during the development of novel inference techniques and the generation of predictive distributions under a wide range of evolutionary scenarios that remain critical for testing competing evolutionary hypotheses. combinations of different evolutionary models can be accessed through a gui or cli, and further extensions can be specified in xml format with a syntax familiar to the beast user community. analogous to the continuing effort to support model set-up for beast in beauti, future releases of πbuss aim to provide simulation counterparts to the beast inference tools, both in terms of data types and models, while also maintaining general purposes simulation capabilities. interesting targets include discrete traits, which can already be simulated through xml specification, continuously-valued phenotype data  <cit>  and indel models. finally, πbuss provides opportunities to pursue further computational efficiency through parallelization on advancing computing technology. we therefore hope that πbuss will further stimulate the development of sequence and trait evolutionary models and contribute to advancement of our knowledge about evolutionary processes.

availability and requirements
project name:πbuss; project home page:http://www.rega.kuleuven.be/cev/ecv/software/pibuss; operating system: platform independent; programming language: java; other requirements: java  <dig>  or higher, beagle library; license: gnu lesser gpl; any restrictions to use by non-academics: none.

source code of the parallel beast/beagle utility for sequence simulation is freely available as part of the beast google code repository: http://www.code.google.com/p/beast-mcmc/.

the broad-platform evolutionary analysis general likelihood evaluator  library has it’s both source code and binary installers available from http://www.code.google.com/p/beagle-lib.

scripts and input files required for repeating the simulation study presented in example application are hosted at http://www.github.com/phylogeography/deeproot.

competing interests
the authors declare that they have no competing interests.

authors’ contributions
fb designed and implemented the software. large portions of code extend or are based on interfaces designed and developed by ar and mas. pl and gb conceived the original idea and helped with the design of the software. pl designed the simulation study employing the software. lmc wrote the software tutorial, tested and commented on the software. all authors contributed to the writing of this manuscript. all authors read and approved the final manuscript.

acknowledgments
the research leading to these results has received funding from the european research council under the european community’s seventh framework programme  under grant agreement no. 278433-predemics and erc grant agreement no.  <dig>  the welcome trust  and the national institutes of health  and the national science foundation . the national evolutionary synthesis center  catalyzed this collaboration through a working group . lmc would like to thank the program for scientific computing staff for operational support.
