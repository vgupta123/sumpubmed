BACKGROUND
parasitemia, the quantitative relative content of parasites in the blood, is commonly used in malaria diagnosis in patients as well as for in vitro testing of new anti-malarial compounds in research laboratories. this measure can be obtained using various approaches, though the preferred and most reliable is microscopic examination of giemsa-stained thin blood films. however, manual microscopic enumeration is a time-consuming and tiring process that can be significantly effected by the expertise of the observer and, thus, have variable accuracy. therefore, an automated image analysis system for accurate, fast and reliable determination of parasitemia is desirable.

for this purpose, images of stained blood samples are captured from a microscope and then transferred to a computer for analysis. this study utilized a common, relatively low-end light microscope in combinations with a digital camera, trading off image quality for affordability. consequently, the image analysis process has to cope with numerous challenges, due to the various inherent limitations of the acquisition process, such as the presence of blurring, over- or under-exposure, and non-uniform illumination  <cit> .

moreover, the observed image quality is significantly influenced by the quality of the prepared smear in terms of uniformity of erythrocyte distribution , staining, and cleanliness. the analysis of an extensive data collection obtained during general laboratory operations also showed that conventional assumptions, like the equal-sized circular shape of erythrocytes, does not always hold as depicted in figure  <dig>  additionally, in data obtained under a real-world situation, more often than not, cells overlap each other, forming clusters and, thus, complicate the analysis. an example is given in figure  <dig>  in images of older samples, cells and parasites may possess different colors due to different incubation times with the staining solution. furthermore, in a non-laboratory environment, an analysis has to account for the presence of the other blood components, such as leukocytes and platelets. however, one of the most prominent problems is out-of-focus imagery, which is mainly due to spherical aberrations, and the difficulty in detecting the ring state of the infection as illustrated in figure  <dig> and figure  <dig>  respectively.

in the literature, one can observe two almost separate research streams in bioinformatics and microbiology addressing the problem of malarial blood sample analysis in particular, and blood smear analysis in general. blood smear image analysis has been tackled by using conventional image processing techniques like morphology  <cit> , edge detection  <cit> , region growing  <cit>  etc., which all have shown certain degrees of success with respect to the used data.

one of the most recent studies addressed the problem of parasitemia estimation using edge detection and splitting of large clumps made up from erythrocytes  <cit> . the outcome of the approach was shown to be satisfactory for well-stained samples with well-separated erythrocytes.

in further studies, granulometric estimation, morphological and thresholding techniques were employed with promising outcomes  <cit> . however, these techniques are very sensitive to the images' quality. assuming a scenario where cells are touching each other only slightly, an area-fitting technique was proposed, using a circular template  <cit> . naturally, the approach fails if the above assumption is violated. in a recent study  <cit> , segmentation of erythrocyte clusters was performed using a correlation-driven optimization approach. although the approach considered variations in cell shapes and sizes, unstable results were reported.

tackling the challenge from another angle, pinzón et al.  <cit>  suggested that the problem of erythrocyte segmentation could be reduced to a peak selection problem in the hough space. the study focused on detecting erythrocytes of circular shape and uniform size, an assumption which must be made with caution.

lastly, extended maxima transform  <cit>  and watershed transform were also employed, given that local maxima indicate the centers of convex shapes, i.e. blood components – particularly erythrocytes. this concept, however, is only justifiable for images which exhibit a small degree of cell overlap.

in this paper a comparison-based analysis approach was developed, which differentiates solid components in blood smears by exploiting the inter-relations between different observations and radiometric representations. the use of statistical measures in these comparisons and cross-referencing validations yields a more reliable detection scheme than previous techniques. furthermore, the concept of matching the image content with strictly defined model representations was relaxed in order to account for the variety of observed cases.

the digital analysis process is depicted schematically in figure  <dig> and comprises six stages, namely the nucleated components detection, image decomposition, erythrocyte size estimation, leukocytes and malarial gametocytes identification, erythrocytes segmentation and, finally, parasitemia estimation. solid lines describe the flow of image data, while dashed lines represent the flow of control information.

firstly, the acquired image is analyzed for the occurrence of nucleated components. this aspect includes the actual parasite as well as other blood components with a nucleus, e.g. leukocytes. only during a later processing step are the various components differentiated based on their properties and location of occurrence. secondly, the entire smear image is decomposed in solid and non-solid matters with the latter one characterized as background. once this is achieved the average size of an erythrocyte for the given case is estimated. this image-dependent process enables a large degree of flexibility with respect to the microscope settings and used samples. based on the results of the size estimation, the differentiation among leucocytes, gametocytes and erythrocytes is straightforward. however, most significantly, the information supports the segmentation of erythrocyte clusters into individual erythrocytes. eventually, the results of the erythrocyte and parasite mapping are combined for the actual parasitemia estimation.

the inherent shortcomings of the low-cost acquisition instrumentation, such as non-uniform back-side illumination as well as operational obstacles, e.g. contaminations on the microscope's and camera's lenses, are overcome through the consideration in the actual processing. as a major difference to previous work, the undertaken investigation utilizes the entire microscopic view instead of extracting a rectangular image region. finally, high degrees of cell overlaps within large erythrocyte clusters are handled, setting the qualitatively best images of the conducted work on the same level with the worst cases of previously conducted studies.

RESULTS
two main experiments were carried out on test sets of images from different blood smears. firstly, the accuracy of the parasitemia estimation was assessed, while the second experiment analyzed the robustness of the approach with respect to the degree of overlapping erythrocytes. all programs were implemented in matlab.

in a typical laboratory environment a variety of thin blood smears with varying parasitemia, different stages of the parasite's lifecycle, degrees of cell overlaps, and cell density was selected by the malaria researchers. in total,  <dig> blood smear images were acquired at random positions from the above mentioned smears. although it is general practice to obtain an image at the smear's tail, the randomness allows a straightforward acquisition of qualitatively inferior images.

parasitemia estimation
for the following experiments, nine images, comprising approximately  <dig>  erythrocytes, were randomly selected from the larger sample set of  <dig> images, where each of those nine images originates from a different smear. these images were then independently analyzed by the computer and qualified human professionals, i.e. four malariologists working on malaria related topics for the past four to twelve years. the test cases are displayed in figure  <dig> covering a variety of different problems, e.g. a suitable representative for the possible contamination of the optical system is shown in , while a sparse cell distribution is depicted in . other instances comprise the occurrence of a leukocyte , focus blur , strong clustering of erythrocytes  and , free haemozoin , differently stained smear , and variations in erythrocyte sizes .

the automatically obtained estimates were recorded and are compared to their corresponding manually established counterparts in table  <dig>  for both smear evaluation approaches, cells which were not fully visible within the microscope's aperture were excluded from the assessment.

on average, an absolute error value for the estimates of  <dig>  ±  <dig> % was determined with a worst case of  <dig> % difference in parasitemia. in particular this latter extreme case for image  <dig> is due to the large degree of cell overlaps within the erythrocyte clusters and was not observed for smears with a wider spread. the better performance for the comparable case in image  <dig> can be explained by the absence of massive clusters and the predominance of smaller erythrocyte clusters. however, even the manual counts for images  <dig> and  <dig> exhibit a standard deviation of  <dig>  and  <dig>  erythrocytes, respectively, which is an example of the ambiguity in human perception and which cannot be solved by automating the process.

the second largest error occurred for the differently  stained sample, i.e. image  <dig>  although the proposed thresholding steps can adapt to this problem, they were not able to address it entirely and overestimated the number of infected erythrocytes. in this context it was noticed that fragments of haemozoin and contaminations on the slide led to false detections. the variation for the actual cell count is due to the optical focus on the stained solid matters rather than on the erythrocytes which appear blurred and, hence, are more difficult to detect. however, out-of-focus does not necessarily result in erroneous counts as can be seen for image  <dig>  which also exhibits a large degree of blurring, but a wider spread of the erythrocytes. variations in cell sizes and shapes were well captured and do not pose a problem as can be seen in the case of image  <dig> 

the regression plot in figure  <dig> summarizes the relation between the manually and the automatically obtained parasitemia estimates for p. falciparum and shows a very high correlation c =  <dig>  between the two results with a slope rise m =  <dig>  and an offset b =  <dig>  for the computed regression line. in particular, the performance was achieved consistently for a variety of different images and is independent of the actual parasitemia. the values for the manual counts were computed as median over the individual results provided by the candidates.

in order to show the potential for generalizing the proposed approach, an experiment using the rodent malaria parasite plasmodium yoelii was conducted. the regression plot for the two parasitemia results is depicted in figure  <dig> with a slope rise m =  <dig>  and an offset b =  <dig>  for the computed regression line. as mouse erythrocytes are smaller and the parasite within the cell exhibits a different morphology than p. falciparum, this provides strong support for the wider application of the proposed technique. note that no parameter optimization was carried out, i.e. better results are possible.

segmentation of erythrocyte clusters
based on the results of the previous sub-section, the accuracy of the erythrocyte cluster segmentation state – the most critical step in the processing chain – was assessed separately by using the traditional f-measure

 f=2⋅p⋅rp+r, 

i.e. the weighted harmonic mean of the precision p = |ae ∩ ze|/|ae| and the recall r = |ae ∩ ze|/|ze|, where ae and ze are the sets of automatically and manually determined erythrocytes, respectively. the operator |·| describes the magnitude of the contained set. results for the nine test images in figure  <dig> are reported in table  <dig> 

according to table  <dig>  the proposed approach shows a good segmentation performance with a mutually balanced precision and recall. generally, the f-measure exceeds 92% with one major outlier for image  <dig> exhibiting a lower f-measure. while the precision is very good, the recall rate suffers from the large degree of overlap, which evidently results in underestimating the number of actual erythrocytes. the problem is less severe for image  <dig> with its smaller clusters. in summary, the main obstacles for a highly accurate cell count are inadequately spread smears and out-of-focus imaging. for instances, the latter problem can be seen in image  <dig> with an untypical low segmentation precision.

in order to assess the approach's robustness with respect to the actual degree of cell overlap, four images among the nine original test cases were picked randomly. then the f-measure was computed individually for each identified erythrocyte cluster and related to the developed overlap measure

 Ω=a|ae|⋅μ, ∀i), 

where |ae| and μ, ∀i) are the numbers of manually counted erythrocytes in a cluster ci and the average area covered by an erythrocyte, respectively. the area function a is defined as in equation . the rationale behind the measure is to relate the actual area covered by a cluster to the area which would be covered by the same number of non-overlapping erythrocytes. it follows from equation  that Ω ≤  <dig> 

altogether  <dig> clusters comprising approximately  <dig> erythrocytes were investigated and the results displayed in figure  <dig>  the scatter plot shows that the segmentation performance  is certainly satisfying for all images if Ω >  <dig> , while for focused and well-stained smears overlaps characterized by Ω >  <dig>  can be tolerated.

CONCLUSIONS
a novel automatic image processing approach for determining malarial parasitemia in thin blood smear images was presented. firstly, the nucleated components  are identified using adaptable spectral information. in an independent step, solid matters, i.e. cells and parasites, are isolated from the background, by comparing the input image with an image of an empty field of view. the range of erythrocyte sizes is then determined by examining user inputs of isolated erythrocyte regions. leukocytes and malarial gametocytes  are detected by size and removed accordingly. reducing the problem of erythrocyte segmentation to a peak selection problem in a transformed image space, the next stage identifies the positions of individual erythrocytes by finding regional maxima with area-suppression. finally, the derived parasite and erythrocyte maps are overlaid and assessed concurrently to determine the parasitemia.

the test results have shown that the proposed comparison-based approach, by exploiting the interrelation between different images and color channels, has successfully overcome most of the inherent limitations possibly occurring during the sample preparation and image acquisition phase. in conjunction with the proposed automatic measure for the degree of overall cell overlap, an objective assessment of smear quality as well as excepted accuracy for further sample analysis, i.e. parasitemia, was provided.

the benefits of the described study are twofold. firstly, it was shown that a model-based approach with relaxed parameterization can accommodate for the variety of occurring cases in nature while at the same time it can guarantee a level of accuracy comparable to human counts. in particular, this study differs from previous work in terms of accepted sample variety. secondly, the development of a robust approach based on image processing can be seen as a chance for developing low-cost solutions for mass screening.

future work will focus on the automatic classification of parasites in terms of plasmodium species and development stages. however, unlike estimating parasitemia, the detection of the parasite's stage requires high quality image data.

finally, differentiating between the various human malaria species can be considered as one of the great challenges for computer vision in bioscience at this point in time.

