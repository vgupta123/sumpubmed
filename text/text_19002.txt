BACKGROUND
understanding the phylogenetic relationships among organisms is an essential aspect for many ecological, biogeographical, and evolutionary questions  <cit> . currently, the simple step of generating a robust phylogeny for a group of poorly studied organisms can require substantial research investment. most phylogenies are reconstructed from a tiny portion of the genome  <cit> , but as next-generation sequencing technologies become faster and cheaper, the number of species for which whole genome sequence data are available has increased dramatically. most whole-genome datasets are collected for reasons other than phylogenetic reconstruction, yet it is the first step in many comparative studies  <cit> . therefore, constructing a phylogeny from genomic data would be a valuable tool even if genome datasets were not collected with this in mind. unfortunately, most existing methods for phylogenetic reconstruction are not intended for analysis of genomic scale datasets  <cit> . traditional phylogenomic techniques require genome assembly, detection of putative orthologous genes from the assembled sequences, and alignment at the dna sequence level  <cit> . these analyses typically go beyond the expertise of researchers who only require a phylogeny to place comparative studies into an evolutionary framework. approaches are needed to efficiently cope with the dramatic increase in genomic data, and to allow easy and reliable reconstruction of phylogenetic relationships among genomes  <cit> .

multiple-sequence alignment is a central issue in phylogenetic reconstruction, and errors in the alignment process often lead to errors in phylogenetic reconstruction  <cit> . when working at the genome scale, multi-sequence alignment becomes very difficult . alignment-free methods were initially proposed to circumvent the issues of recombination and genetic shuffling that make alignment difficult  <cit> , and they have attracted attention due to their computational efficiency  <cit>  and accuracy  <cit> . however, because they are not based on specific evolutionary models, they have been mainly used for comparing similarity between sequences  <cit>  and genomes  <cit> .

the majority of the alignment-free methods focus on the distribution within and among study genomes of short dna/protein fragments, known generally as k-mers where k is the length of the substring taken from the original sequences  <cit> . usually distance matrices are calculated directly from the distribution of k-mers, and phylogenies are built from these distances  <cit> . these distance metrics, however, are derived without an evolutionary model and therefore do not represent the genetic distances . furthermore, the k-mer statistics used to compare genomes are typically computed from assembled sequences  <cit> . unfortunately, for the majority of organisms, a reference genome from a closely related species is not available. without a reference, de-novo genome assembly of short reads remains a major challenge, especially in wild, out-crossed species with high levels of heterozygosity  <cit> . additionally, high coverage is generally required  <cit> , but even with high coverage de-novo assembly often remains error-prone  <cit> . the difficulty of assembly has led to methods that directly analyze unassembled read data  <cit> , and some of these methods are proposed for reconstructing phylogenies . however, these methods are mainly designed for closely related prokaryotic genomes. finally, although a couple of these methods  <cit>  have addressed the inherent assembly-free problems such as coverage and sequencing errors, none proposed any solution. they also do not provide methods such as bootstrapping to assess confidence in the reconstructions.

here we present a new method that directly reconstructs a phylogeny from whole-genome short read sequence  data. by removing the need for assembly of the sequencing reads, we extend alignment-free methods to assembly and alignment-free  methods. furthermore, we develop, explain, and validate our aaf method using a combination of sequence evolution models, mathematical calculations and simulated srs data from published genomes for  <dig> primates. the mathematical calculations provide the conceptual foundation for the method and predict its performance given a basic evolutionary model for sequence divergence. simulation models of sequence evolution allow us to test the mathematical predictions. simulations of srs data allow us to validate the method given realistic genome complexity, different genome sizes, sequencing errors, and a range of sequence coverage. to provide a tool for researchers to assess their own aaf phylogenetic reconstructions, we also developed a two-stage bootstrap that estimates the precision of our method when applied to novel genome data. in order to demonstrate how aaf works on real sequencing data, we apply aaf to reconstruct the phylogeny for  <dig> mammal species from raw sequencing datasets, since the primate phylogeny is well established through both morphological and molecular data. finally, to illustrate the ability of aaf to handle data for which it was designed – low-coverage data from poorly known species – we use aaf to reconstruct the phylogeny for  <dig> tropical tree species. the package is available at https://sourceforge.net/projects/aaf-phylogeny/ with detailed documentation and tutorials.

RESULTS
the aaf approach first calculates pairwise genetic distances between each sample using the number of evolutionary changes between their genomes, which are represented by the number of k-mers that differ between genomes. the phylogenetic relationships among the genomes are then reconstructed from the pairwise distance matrix. using simulated srs read data  from published and fully assembled genomes, our aaf method obtained the same phylogeny for  <dig> primate species  as those previously published using traditional methods  <cit> , even though aaf did not use any information about assembly or alignment. furthermore, the aaf method was very efficient, requiring only a few days on a standard work station . below, we provide complete theoretical and computational support for our method.fig.  <dig> primate phylogeny reconstructed by aaf using assembled genomes and simulated short reads. a phylogeny reconstructed from assembled genomes with k =  <dig>  incorrect branches are shown in red. b phylogeny reconstructed from assembled genomes with k =  <dig>  for the assembled genomes, correct phylogenies were also given for k =  <dig>   <dig> and  <dig> . c phylogeny reconstructed from 70-bp reads were simulated from assembled genomes with 1 % sequencing errors and 2x coverage. grey bars at the tips give the tip corrections  for incomplete coverage and sequencing error that are trimmed from each tip.d like  but with 5x coverage. e like  but with filtering to remove k-mers that appear only once. f a recently published phylogeny of primates  <cit> 

performance metrics for the aaf reconstruction of the 11-primate phylogeny from simulated srs data using one thread only. phylogenetic reconstruction requires generating the k-mer table and calculating the number of shared k-mers between species to compute the distance matrix. note that the memory usage is for the first step; the second step required no more than 1g of memory



evolutionary model
our measure of the phylogenetic distance  between two species, a and b, is based on the estimate of the rate parameter from a poisson process for a mutation occurring at a single nucleotide under the evolutionary model that the mutation rate is the same for all nucleotides across the genomes. we include not only mutations caused by nucleotide substitutions, but also insertions and deletions . if k-mers are random nucleotide sequences of length k, and if mutations occur randomly and independently among nucleotides, the probability that no mutation will occur within a given k-mer between species a and b is exp. mutations will decrease the number of shared k-mers, ns, between species relative to the total number of k-mers, nt. in the hypothetical case in which only substitutions occurred and all k-mers were unique, then all the species will have the same total number of k-mers, nt, and the maximum likelihood estimate of exp is ns/nt. in real situations, indels introduce the complication of changing nt which can be addressed as follows. a single insertion of length l will cause the loss of at most  k-mers and a gain of at most  k-mers, while a single deletion of length l will cause the loss of at most  k-mers and a gain of at most  k-mers. for computing distances, this means that deletions will cause a greater reduction in the number of shared k-mers than either a substitution or an insertion of the same length. to account for this asymmetry, when estimating the distance between two taxa, the smaller of the two values of nt calculated separately for each of the taxa is used. this leads to the estimate of d  of  <dig> d=−1klognsnt 

this formula can be modified to correct for back substitutions , although this effect is small .

although application of equation  <dig> for aaf is in principle straightforward, several important issues must be addressed. these divide naturally into alignment-free and assembly-free issues. below, we first address alignment-free issues that involve extracting as much information as possible about the true evolutionary variation between species. we then address assembly-free issues that involve reducing sampling variation caused by incomplete coverage and sequencing errors.

alignment-free: k-mer sensitivity and homoplasy
lack of alignment makes it more difficult to extract all of the possible information about evolutionary distances between species. if genomes from two species were perfectly aligned, it would be possible to identify all substitutions and indels. in aaf, however, only differences in the presence/absence of k-mers are used. if a k-mer covers, for example, multiple substitutions, it will count equally as one carrying only a single substitution. consequently, shorter k-mers are more likely to have greater sensitivity to single evolutionary events. on the other hand, identical k-mers could be derived from physically, functionally, or evolutionarily different regions of the genome and are therefore not homologous . longer k-mers are less likely to suffer from k-mer homoplasy. therefore, a trade-off exists for k-mer length between the problem of sensitivity  and k-mer homoplasy .

to isolate alignment-free issues, in this section we compute k-mers under the assumption that we have completely assembled genomes without error. therefore, only the evolutionary differences between genomes will be captured, without any differences caused by sampling error or sequencing effort.

k-mer homoplasy
k-mer homoplasy is generally considered as “noise” in phylogenetic reconstruction  <cit>  and is a particular problem when k-mer length is short and genome size is large. for example, if k =  <dig>  the total number of possible k-mers accounting for complementarity is 415/ <dig> , so if genomes are close to this length, identical k-mers will appear in different species simply due to the limited number of total possible k-mers.

k-mer homoplasy may incorrectly inflate the proportion of shared k-mers because  multiple copies of the same k-mer at different locations in species a must all experience mutations before this k-mer is no longer shared with species b, and  a k-mer that does undergo a mutation may turn into a k-mer that already exists elsewhere in the genomes of species a or b . k-mer homoplasy depends on the frequency distribution of different k-mers across the genome of species a and b, which varies with k; for the species with the shortest genome, we denote this distribution qk. to account for k-mer homoplasy, we derived a mathematical formula for the proportion of shared k-mers between species, ph, which is a prediction of the ratio ns/nt based on qk . in this formula, qk can be calculated empirically from real genomes  or estimated theoretically under the assumption that the ancestral genome for species a and b is a random sequence .

we first investigated the general issue of k-mer homoplasy under the assumption that the ancestral genome is a random sequence . for large genomes and small k, k-mer homoplasy led to ph =  <dig> because all possible k-mers occur in both species. this problem is exacerbated if gc content is biased, which will inflate the average similarity in genomic k-mer composition. fortunately, because the possible number of k-mers increases exponentially, small increases in k quickly overcome this limitation; for example, when k =  <dig> over  <dig> billion k-mers are possible, which is considerably larger than the majority of genome sizes, and when k =  <dig>  over  <dig> trillion possible k-mers exist. therefore, above a threshold k , the effects of k-mer homoplasy are greatly reduced. as would be expected, above this k the theoretical and observed values of ph are the same . furthermore, the k at which k-mer homoplasy vanishes depends only weakly on the genetic distance d between species . therefore, a sufficiently large k will overcome homoplasy, regardless of the evolutionary distance between species.fig.  <dig> effect of k-mer length on k-mer homoplasy. a mathematical predictions of the proportion of shared k-mers, p
h, as a function of k for genomes of sizes g =  <dig> ,  <dig> , and  <dig>  when the true genetic distance between two species is d =  <dig>  or d =  <dig> , and the gc content is  <dig>   and  <dig>  . the dashed black line gives the hypothetical case if there were no k-mer homoplasy. calculations were performed using the assumption that genomes are random sequences . b simulations of the effect of k-mer homoplasy on n
s/n
t and comparison with its theoretical prediction p
h. three simulations were performed starting with a random sequence of 105 bp assuming that the true genetic distance between taxa is d =  <dig> . the black lines give n
s/n
t from sequence simulations and the blue lines give the theoretical predictions, p
h, under the assumption that the ancestral genome is random with gc content  <dig>  . c like  but with the ancestral sequences given at three random starting positions from a published  <dig>  mbp sequence of the rabbit genome  <cit> . the red line gives the theoretical predictions  calculated using the observed frequency distribution of k-mers, q
k, in one of the simulated species. d theoretical predictions  of the proportion of shared k-mers, p
h, calculated from the observed frequency distribution of k-mers, q
k, for the  <dig> primate genomes ranging in size from  <dig>  to  <dig>  gbp assuming the true distance between taxa is d =  <dig>  or  <dig> 



the mathematical formula for ph accurately predicted the results from simulated sequence evolution starting from either a random ancestral sequence of  <dig> kbp  or real  sequences . comparing sequence evolution simulated from random and real ancestral sequences, k must be larger to reduce k-mer homoplasy with the real ancestral sequence ; this is because the lower complexity in the real ancestral sequence increases the probability that a k-mer appears at multiple locations in the genome by chance. for random sequences of length 109 bp, k-mer homoplasy is negligible for k ≥  <dig> , whereas for qk obtained from the primate genomes, k-mer homoplasy only becomes negligible for k ≥  <dig> .

balancing sensitivity and homoplasy
while k-mer homoplasy becomes negligible when k is sufficiently large, continuing to increase k will also increase the probability that a single k-mer contains more than one evolutionary event, and this will reduce sensitivity and underestimate the proportion of shared k-mers.

the balance between k-mer homoplasy and sensitivity can be understood in terms of the statistical properties of bias and precision in the estimate d . bias refers to the under- or overestimation of distances, whereas precision refers to the variability in the estimates. we investigated both the bias and precision by simulating sequence evolution ; for these simulations, we used relatively short ancestral sequences  for which smaller values of k will be enough to overcome k-mer homoplasy. for short k-mers , increasing genome size led to consistent underestimates of d  due to the increased numbers of shared k-mers from k-mer homoplasy . at small genome sizes, however, shorter k-mers led to greater precision in the estimate d measured by the coefficient of variation, cv . this greater precision for shorter k-mers occurred because shorter k-mers have greater sensitivity to identify individual mutations. at large genome sizes, however, the precision decreased for shorter k-mers due to k-mer homoplasy. these results predict that shorter k-mers will give better phylogenetic reconstructions up to the point that k-mer homoplasy leads to strong bias and imprecision in the estimate d. therefore, the optimal k for phylogenetic reconstruction is the k which is just large enough to greatly reduce k-mer homoplasy for a given genome size .fig.  <dig> statistical properties of bias and precision of the estimate d caused by alignment-free issues only.
a mean and  coefficient of variation  of d between two species as a function of genome size. k-mer lengths are k =  <dig> ,  <dig> ,  <dig> ,  <dig>  and  <dig> . the true distance between species is d =  <dig> . in  the dashed line is the approximate cv of d calculated assuming that all mutations were identified. c average number of topological mistakes generated by aaf from simulated sequences on the phylogeny depicted in fig. 1b, with different ancestral genome lengths and different k. one hundred simulations were performed for each length using ancestral genomes taken from random starting positions on a  <dig>  mbp sequence of the rabbit genome from prasad et al. 



to test this conclusion, we simulated  <dig> sequences based on their phylogenetic relationships starting with ancestral sequences ranging from 5 kb to  <dig> kbp  given the “true” phylogenetic relationships among simulated species are given by fig. 1b. as expected, for short genomes for which k-mer homoplasy was negligible, shorter k-mers led to fewer topological mistakes in phylogeny reconstruction . however, as genome length increased, phylogenies reconstructed using k =  <dig> possessed an increasing number of mistakes. for longer k-mers , aaf invariably gave the correct topology when genome size was ≥ <dig> kbp. furthermore, the adequate performance with k =  <dig> despite the expected underestimate of d  suggests that reconstructing tree topology is robust to moderate amounts of bias.

phylogeny reconstruction from assembled genomes
using  <dig> assembled primate genomes with rabbit as an outgroup, aaf with k =  <dig> generated a phylogeny with the same topology as those described in recent publications  <cit> . with k <  <dig>  a few topology errors were observed, especially for deep nodes; these errors were anticipated as a result of k-mer homoplasy . for k >  <dig>  tree topology  and branch lengths  were remarkably stable. this matches our prediction from fig. 2c that values of k ≥  <dig> should be sufficient to minimize k-mer homoplasy. therefore, we take  <dig> as the optimal k that balances homoplasy and sensitivity for this dataset, and we take the tree constructed from assembled genomes with optimal k as our optimal aaf tree . quantitative comparison with the phylogeny from perelman et al.  showed high similarity to our optimal phylogeny with respect to branch lengths; there was a high correlation between their patristic distances  and a low branch score distance . aaf is also very efficient, requiring only a few days on a standard workstation .

assembly-free: incomplete coverage, sequencing error, and filtering
while the lack of alignment introduces possible errors in the inference of the actual evolutionary relationships among species, the lack of assembly primarily introduces sampling error caused by low genome coverage and sequencing errors  <cit> . the actual number of k-mers will be under-represented given low sequencing coverage, whereas sequencing error will cause both the loss of true k-mers and the gain of false k-mers.

one simple solution to remove false k-mers caused by sequencing error is to filter out all low-frequency k-mers; here, we filtered by removing k-mers that occur as singletons  in a genome. if sequencing errors are random, with no molecular or experimental bias, then the probability of observing the identical sequencing error at the same position is low. therefore, given observed error rates for most next-generation sequencing platforms, k-mers observed more than one time in the srs data for a genome are unlikely to be errors. however, as sequencing coverage decreases, a larger fraction of real k-mers will be singletons in the dataset, and therefore filtering will remove real k-mers. as a consequence, although filtering will be beneficial at high coverage, at low coverage filtering will be detrimental. we investigated incomplete coverage, sequencing error, and k-mer filtering using mathematical calculations, simulations, and application to simulated srs data to determine the severity of potential problems caused by sampling errors and to derive recommendations accordingly.

total and shared k-mers with missing and false k-mers
when there is incomplete coverage and sequencing errors, the true total and shared numbers of k-mers, denoted nt* and ns*, differ from the observed total and shared k-mers, nt and ns. we derived mathematical formulas  to predict the ratios pt = nt/nt* and ps = ns/ns* given information about coverage, sequencing errors, and k-mer filtering . false k-mers caused by sequencing errors inflate pt starting from 2x coverage , and at least 5x coverage is required to capture most of the shared k-mers . when filtering out singleton k-mers, pt at higher coverage correctly equals one; however, at lower coverage ps is reduced by 20-30 %  due to the loss of true singletons. thus, the advantage of filtering is that it reduces the number of false total k-mers, at the cost of losing true shared k-mers.fig.  <dig> the theoretical ratios of observed to true total and shared k-mers. a ratio of observed to true total k-mers, p
t 
= n
t/n
t*  and ratio of observed to true shared k-mers, p
s = n
s/n
s* , when k-mers are not filtered . k-mer lengths are k =  <dig> ,  <dig> ,  <dig> ,  <dig>  and  <dig> . the simulation was performed with a sequencing error rate of 1 % and a read length of 76 bp, and the true distance between species is d =  <dig> . b like  but with filtering



to filter or not to filter?
given the trade-off between filtering and not filtering, we investigated how much coverage is required before filtering should be used. whether or not to filter k-mers can again be decided by computing the bias and precision of the estimate d . without filtering, the number of false k-mers increases, and the true distance between species is overestimated . filtering out singletons can correct for this sequencing error effect with sufficient coverage .fig.  <dig> statistical properties of the estimate d with combined effect from assembly and alignment-free issues. a mean and  standard deviation in the estimate d from simulations with incomplete coverage and 1 % sequencing error. the true distance between species is d =  <dig> , and k-mer lengths are k =  <dig> ,  <dig> ,  <dig> ,  <dig>  and  <dig> , with solid and dashed lines corresponding to no filtering and filtering, respectively. c average number of topological mistakes generated by aaf from simulated sequences on the phylogeny depicted in fig. 1b. one hundred simulations were performed using  <dig> kbp of a  <dig>  mbp sequence of the rabbit genome from prasad et al.  with random starting positions. for each sequence simulation, reads of length  <dig> were simulated and each read dataset was analyzed using different k-mer lengths



because reconstructing the correct topology appears robust to bias in the estimate d , precision is likely more important, and filtering should be done when it can lower the variance in the estimate d. this crossover point generally occurs between 5x and 8x, depending on k .

to confirm these conclusions, we simulated srs data with sequencing error and different coverage using ancestral genomes of length  <dig> kbp . as predicted by the estimates of the precision , filtering led to fewer mistakes in the topology of the phylogeny when coverage exceeded a threshold between 5x and 8x. the poor performance with k =  <dig>  was due to k-mer homoplasy as found previously . with the genome size of  <dig> kbp, k =  <dig> and  <dig>  performed slightly better than other values of k in the simulations of assembled genomes  and here had the additional advantage of being less sensitive to sequencing error .

tip correction
incomplete coverage and sequencing error both inflate estimated distances between species and lead to longer tips on the tree. we derived a mathematical correction for this effect  that does not depend on the true distance between species, but does depend on the read length and sequencing error and coverage. when the read length, sequencing error, and coverage are similar for all taxa, then this correction is similar for all species, so that the correction only affects the tips rather than internal nodes of the tree. this correction is particularly helpful for lower coverage datasets when filtering is not an option. note that the decision whether to filter depends on precision ; therefore, although the tip correction adjusts for bias, it does not affect the decision whether to filter. the case of large differences in read length, sequencing error, and coverage among taxa is discussion in the methods: tip correction.

bootstrapping
to determine the uncertainty in tree topology, we devised a two-stage nonparametric bootstrap that accounts for both sampling variation  and evolutionary variation . the first stage of the bootstrap follows standard procedures: resample the original reads with replacement, construct a k-mer presence/absence table, compute distances d, and construct the phylogeny. the variance in topology among  <dig> replicates is then used to assess the precision of reconstruction associated with sampling variation. to additionally incorporate evolutionary variation, the second stage involves, for each of the 100 k-mer presence/absence tables, resampling with replacement 1/k of the total k-mers. only  <dig> in k of the k-mers is selected to account for the non-independence among k-mers caused by their overlap. simulations showed that choosing 1/k of the k-mers gives the correct variance in d in the bootstrap .

this nonparametric bootstrap is not practical for large genomes due to the computational requirements for repeating the phylogenetic reconstruction a hundred or more times. therefore, we also developed a two-stage parametric bootstrap that uses mathematical equations to estimate the variances in distances between species caused by sampling and evolutionary variation . this approach gives similar results to the nonparametric bootstrap in both simulations with high coverage and filtering , and low coverage without filtering , but its computational requirements are independent of genome size.fig.  <dig> two-stage nonparametric and parametric bootstraps. a examples of two-stage nonparametric and parametric bootstraps from simulated data with high coverage  and filtering . the node values give the number of bootstrap trees supporting each node, with the values in parentheses giving bootstraps accounting for only sampling variability ; for each node, the top numbers give the results from the nonparametric bootstrap and the bottom numbers give the results of the parametric bootstrap. nodes without values all have 100 % support. b like  but with low coverage  and without filtering. the ancestral genomes  were  <dig> kbp sequences taken from random starting positions on a  <dig>  mbp sequence of the rabbit genome from prasad et al. 



application on simulated and raw sequencing data
as an initial test of aaf, we simulated reads from  <dig> fully assembled primate genomes with rabbits as an outgroup . aaf successfully reconstructed phylogenies with the same topology and only slightly different branch lengths from simulated srs data . the closest match to the phylogeny produced from the assembled primate genomes with k =  <dig>  was the filtered 5x coverage , followed by the non-filtered 2x coverage  and then non-filtered 5x coverage . in fact, even for  <dig> x coverage and no filtering, aaf recovered the correct topology , although we do not recommend application of aaf to datasets with such low coverage. finally, with the tip correction, the trees are more similar to those constructed from the fully assembled genomes .table  <dig> branch score distance  between trees generated from simulated reads and the optimal aaf tree

the optimal aaf tree that is generated from assembled data using k =  <dig> for the  <dig> primate dataset  is compared to trees generated from simulated srs data with different coverage, with or without filtering, and before and after tip correction



although we have included sequencing error and random sequences in our read simulations, there are non-random biases brought by different sequencing technologies. in order to test the performance of aaf on real sequencing data, we downloaded next-generation sequencing data for  <dig> primates that are available in ncbi short reads archive. we did not find data for rabbit in sra, and therefore we used cat as the outgroup. we added five species to expand the study to euarchontoglires, the super-order to which primates belong. this dataset includes sequences from different sequencing platforms with different library construction strategies and read lengths . aaf successfully reconstructed a phylogeny from the  <dig> mammals dataset  that agrees with recent studies  <cit> . this illustrates how aaf can be used to construct phylogenies from publicly available, heterogeneous genome data.

aaf is designed mainly for constructing phylogenies for non-model organisms. therefore, we showcase aaf on raw srs datasets that might be typically encountered by evolutionary biologists and ecologists, a dataset of  <dig> tropical trees from four orders . analyzing this  <dig> tropical trees dataset was the initial stimulus for developing aaf, and the dataset contains the many complications that will arise in studies of non-model organisms: low and uneven coverage, different read lengths, and no available reference genome close enough to aid traditional assembly and alignment. the aaf tree  matched the established phylogeny at the interfamily level according to the current angiosperm phylogeny group classification, apgiii  <cit> , and the intergenera level according to recent studies  <cit> . however, at the intragenus level, there is no published phylogeny for one of the major genera, lithocarpus; the existing phylogenies for the other major genus, ficus, have no consensus and poor bootstrap support  <cit> . therefore, we cannot compare our results diagnostically to established results in the literature. a tutorial giving a full demonstration from parameter selection to phylogeny reconstruction, tip correction and bootstrapping of this dataset is provided in the additional file 6: tutorial of the analysis of the  <dig> tropical trees dataset.fig.  <dig> aaf phylogeny of  <dig> tropical trees constructed from raw reads with k =  <dig>  grey bars at the tip branches give the tip corrections  for incomplete coverage and sequencing error that are trimmed from each tip. intsia palembanica_p is a pooled sample containing  <dig> individuals. both the construction of the tree and tip correction are presented in additional file 6: tutorial of the analysis of the  <dig> tropical trees dataset



comparison with other alignment and assembly-free methods
although there are other alignment and assembly-free methods for constructing phylogenies, these methods are designed for prokaryote genomes  <cit> . a major advantage of aaf is its ability to process large genomes within days. the only methods that demonstrated attempts on mammalian-size genomes are provided by song et al.  <cit>  and yi and jin  <cit> .

song et al.  <cit>  extended a variant of the classic alignment-free statistic, d <dig>  to perform assembly-free phylogenetic reconstructions. the authors demonstrated its application on 1x simulated genome sequences of five mammals and raw sequences of  <dig> tropical trees , but the results were not convincing. for mammals, none of the resulting clustering was consistent with the known phylogenetic relationships of the five species. for the tropical trees, species from the same genus  were not grouped together, and the relationship between genera within fagaceae was not consistent with previous studies  <cit> . song et al.  <cit>  did not provide a package which we could use for direct comparisons with aaf, although our successful application to  <dig> mammals and  <dig> tropical tree species contrasts with their results.

yi and jin  <cit>  developed co-phylog that uses an micro-alignment method for identifying snps . this method is designed primarily for closely related species, and the applications yi and jin present consist mainly of bacteria. the authors applied co-phylog to  <dig> mammal species in one of their supplemental figures. however, when we tried to repeat this analysis, the intermediate file  for a single run of one species  was 129g. ideally the intermediate file could be limited to around 24g for mammal species , only if given perfectly assembled genomes without repetitive segments. since each species has dozens to hundreds of runs of data, we were not able to replicate their results and compare their method to aaf based on real large genome data. this type of analysis will require more hard drive space than most potential users will have available, and this limits the practical use of the method for large genomes.

for a direct comparison between aaf and co-phylog for smaller datasets, we simulated  <dig> data sets and assessed the performance of the two methods by the number of topological mistakes in the phylogeny. this simulation study is similar to that in fig. 3c . to select the length of the flanking regions  to use in co-phylog , we used our calculations for optimal k to avoid homoplasy, which should pose the same problems for co-phylog as for aaf; thus, in co-phylog we set the combined length of the flanking regions plus the focal nucleotide  equal to k in aaf. aaf uniformly outperformed co-phylog . furthermore, the performance of co-phylog depended on ck in a manner predicted for the selection of k in aaf: for short initial sequences, smaller values of ck performed best because they are more able to identify snps that are located close together on the genome. however, for longer sequences performance was degraded by homoplasy for small ck. the best value of ck for genome sizes >160 kb was ck =  <dig>  which is comparable to k =  <dig> in aaf.

advantages of the aaf method
the aaf method greatly simplifies phylogenetic reconstruction from genomic scale data. compared to traditional phylogenetic methods, the aaf method uses the evolutionary signal from the whole genome, including coding and non-coding regions, and small-scale structural differences, like indels, not just nucleotide substitutions. in contrast to most current alignment-free methods, the distance matrix calculated by aaf matches with the genetic distance. in contrast to the few available assembly-free methods, aaf can analyze large genomes and huge datasets while accounting for problems posed by lack of assembly, specifically sequencing read errors and incomplete coverage. our strategy of treating k-mers as present/absent instead of using their absolute or relative frequencies will be advantageous for the direct analysis of raw srs data, particularly when the coverage varies within and among genomes. using presence/absence of k-mers also makes aaf more robust to repetitive sequences with high abundance. we demonstrated that the method has statistically well-defined properties that allow optimization and adaptation of the method. these properties also provide predictive insight into the strengths and weaknesses of aaf given a range of evolutionary and sampling conditions.

other main advantages of the aaf method include:. low coverage requirements. even with the increasing throughput of next-generation sequencing technology, it is still expensive to sequence many genomes at the high coverage needed for successful assembly. the aaf method is able to recover an accurate phylogeny with low coverage . this is largely due to the abundance of information brought by whole genomes. even for species with large genomes like primates, it is possible to obtain 2x coverage for five individuals from a single illumina hiseq lane. therefore, aaf can generate a robust phylogeny quickly and inexpensively for any group of species of interest.

. low computational demands. traditional phylogenomic studies rely on three main steps  that are computationally demanding: assembly, orthologous gene identification and alignment, and phylogenetic reconstruction based on the aligned sequences. traditional phylogenetic methods like maximum-likelihood and bayesian methods rely on complex evolutionary models that require large amounts of computing time, even when using large computing clusters. the aaf method decreases the total analysis time drastically. compared to 40– <dig> h required for human genome assembly using a supercomputer  <cit> , which is just the first step of traditional analysis for one species, aaf takes less than two days to complete the phylogenetic reconstruction of a dozen primate genomes on a standard workstation with 25g of ram and  <dig> threads.



limitations
the advantages of the aaf method come with some costs:. loss of k-mer sensitivity. aaf does not use all of the evolutionary information that would be available if genomes were accurately assembled and aligned. the minimum length of k-mers is set by the need to overcome k-mer homoplasy; for the primate dataset in this study, the minimum length was k =  <dig>  therefore, if there are multiple mutations  within a 21-nucleotide sequence, they will be covered by the same k-mer. nonetheless, the vast amounts of data available from entire genomes will largely overcome this problem.

. deep nodes. the accuracy of most alignment-free methods suffers when applied to sequences or genomes separated by large genetic distances  <cit> . deep phylogenetic nodes imply a higher density of mutations. this will cause the loss of sensitivity of aaf to differences between genomes, and will also exacerbate the effects of homoplasy, which in turn will decrease the estimate d between distantly related species . in our simulations and application to the primate genomes, aaf performed well despite a divergence time for primates estimated at  <dig> mya  <cit>  and estimated genetic distance  from basal node to tips of roughly  <dig> . it also worked well when expanding the analysis to euarchontoglires . however, aaf failed to identify some of the deep nodes when including more mammals across the placentalia clade  with a divergence time of > <dig> mya  <cit> . in our dataset of  <dig> tropical trees, the aaf relationships between families were consistent with the apg iii system. the divergence time for this group is about  <dig> mya, and the average genetic distance from basal node to tips is roughly  <dig>  as well. these empirical examples suggest that aaf can successfully reconstruct phylogenies with divergence times of < <dig> mya and genetic distances from base to tips of < <dig> , and we do not recommend aaf for deeper nodes.

. location of mutations. aaf does not directly give information about where genetic differences between genomes occur. specifically, the calculation of the phylogeny from the distance matrix does not estimate ancestral states that might be used for mapping specific mutations onto the phylogenetic tree. thus, aaf does not identify genes or regions of the genome that are conserved or discordant. nonetheless, once a phylogeny is constructed, analyzing distribution patterns of genes and genome regions across the phylogeny can be performed on k-mers directly  <cit> . integration with aaf, however, will require additional development.



guidelines for parameter selection
aaf requires two choices from the user:  what k-mer length to use, and  whether to filter out singleton k-mers. the choice of k depends on the possibility of k-mer homoplasy; k must be long enough to guard against it. this choice can be made for real genomes by plotting ph and selecting k where the estimated value of ph matches the theoretical value assuming no k-mer homoplasy, using empirically calculated qk . larger values of k beyond this will generally decrease the performance of aaf due to both the loss of sensitivity  and the increased likelihood of k-mer loss through sequencing error if k-mers are not filtered . we have included the r code for plotting fig. 2d to provide a starting point for the selection of k . to confirm this selection, users can repeat the analyses while increasing k by  <dig> until successive values of k give the same phylogeny.

filtering is a good guard against sequencing error and inflated tip lengths in the phylogeny . however, it requires coverage of at least 5-8x  to ensure that not too many true k-mers are filtered out . a pleasant side effect of filtering at the k-mer counting stage is that this decreases the size of k-mer table drastically and thereby decreases the computational load substantially .

future directions
aaf could be used to develop automated phylogeny generators such as phylota  <cit>  while using whole-genome data, or realphy  <cit>  but not only for microbes. it can make use of both assemblies and sequencing reads that are available, as we demonstrated for primates . automation is made feasible by aaf’s robustness against incomplete and unequal coverage, and its ability to accept different read lengths from any sequencing platform. although aaf is designed for phylogenetic analysis, it has wider application for understanding the pattern of relationships among different taxonomic levels of samples such as population structure within species. while aaf is mainly designed for large eukaryotic genomes, it is also able to analyze prokaryote datasets. possible application of the alignment and assembly free approach requires further exploration for other types of sequencing data, such as rad-seq and metagenomic data especially for organisms without a reference. although aaf is designed for subjects without a good reference genome, studies on species with a reference will also benefit from aafs computation efficiency and user-friendly pipeline. because the aaf approach is based upon a matrix of genetic distances among the genomes, it is easy to add new data without recalculating all of the other distances among genomes.

our overall aaf approach could also be expanded naturally to investigate different phylogenetic patterns within genomes. our application of aaf to phylogenies generates “average” genetic distances between whole genomes and a corresponding phylogeny based on the overall differences among genomes. it is possible, however, to use aaf to identify suites of k-mers that are consistent with a different phylogeny from the majority. this compartmentalization of the evolutionary history of the genome could identify portions of the genome with discordant histories in comparison to the majority of the genome  <cit> . the approach could also be used, in conjunction with phenotypic information about species, to associate suites of k-mers with phenotypes of interest. an advantage of the overall aaf approach is that it can identify genomic elements  that show interesting discordance or associative patterns among species without initially investing in whole-genome assembly and alignment. thus, the use of aaf to construct phylogenies is only the initial step in a broader aaf program.

CONCLUSIONS
the aaf method proved to be an accurate and efficient way of estimating the phylogenetic relationships using raw sequence data from whole genomes. we developed the theoretical basis for optimizing k-mer length selection, filtering, correcting tip branch lengths, and bootstrapping, directly addressing the problems of homoplasy, sequencing error, and incomplete coverage. thus, aaf provides a robust tool for phylogeny reconstruction especially when only low-coverage and heterogeneous genome data are available – data that would challenge traditional assembly- and alignment-based methods.

