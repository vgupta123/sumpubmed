BACKGROUND
introduction
the clinical investigation of an abnormal mass in the brain frequently starts with its non-invasive characterisation , normally with a magnetic resonance imaging  study. magnetic resonance spectroscopy  is another mr technique that, unlike mri, provides insight into the biochemistry of tissue through a discrete signal in the frequency domain  containing information about the relative abundance of several low molecular weight metabolites, lipids and macromolecules in the millimolar range of concentration.

this mr modality has been used in computer-based systems for diagnostic decision support  <cit> , building on the increasing availability of data in electronic format  <cit> . however, for brain tumours and, more specifically, glial tumours, the computer-based discrimination of the grade or the specific subtype of tumour still leaves a "gray zone" of uncertainty between class labels  <cit> . therefore, it would be desirable to define decision support systems that were able to provide accurate discrimination of tumour types from the spectra without prior information regarding tumour type and grade. from the pr viewpoint, this is an unsupervised modelling task.

the mrs data analysed in the current work are single-voxel. that is, for each patient we have a single spectrum corresponding to a small volume located within the tumour core. the aim of this study is to separate the constituent source signals on the assumption that they are mixed linearly in each single-voxel spectral measurement. this is because, even within a single voxel, an heterogeneous mix of tissue types may be expected. in this way, the main constituents of the voxel could be separately identified and quantified, providing, in turn, a quantification of class  membership for the sources of each single voxel spectrum, as an alternative to the class labelling of the spectrum as a whole.

linear unsupervised feature extraction pr techniques are commonly used in neuro-oncology for data preprocessing and dimensionality reduction  previous to the diagnostic classification of brain tumours. the usual choices are principal component analysis   <cit>  and independent component analysis   <cit> . pca has mostly been used within a dr framework, and the extracted features lack a direct interpretation. in a recent study  <cit> , pca was applied in an alternative manner to represent each tumour type through mean and variability spectra for ulterior classification using an lcmodel  <cit> . ica, instead, goes beyond dr to provide source extraction, by identifying the sources that add together to form the measured mrs signal. as stated in  <cit> , though, in analysing these type of data, ica will often yield components that "would correspond with identifying the independent degrees of freedom in mrs, not with individual metabolites, but with characteristic tissue generators", or, in other words, constituent tissues that are present in different proportions in each of the voxels where mrs is measured. there is no guarantee that these tissue generators will be tumour type-specific and, therefore, there is little a priori evidence to support that these sources will suffice to infer accurate tumour type predictions  <cit> . the alternative to feature extraction for dr is feature selection  <cit> . here, the interpretability of the results fully depends on the correspondence between the selected features  and known metabolites.

in this study, we characterise the performance of a range of variants of an unsupervised method of the matrix factorisation family, namely non-negative matrix factorisation , in two respects: first, to derive sources correlated with the mean spectra of known tissue types; second, taking the best performing nmf method for source separation, we compare its accuracy for class assignment when using the mixing matrix directly as a basis for classification, as against using the method for dr. this method is unsupervised in the sense that labelled cases are not required to create a model of the analysed mrs data . conceptually, it lies somewhere in between pca and ica. in the spectroscopy-related bioinformatics domain, standard nmf has previously been used for disease classification from infrared spectroscopy blood serum data  <cit>  and the related nonnegative pca  technique has been applied to the classification of different tumours from mass spectroscopy serum proteomic data  <cit> . also within the oncology field, nmf has recently been used for dr in large scale gene expression data  <cit>  and for recovering constituent sources from mr chemical shift imaging  of the brain, in a variant called constrained nmf  <cit> .

the results reported in the current paper reveal the advantage of using one of the recently described nmf variants, namely convex-nmf  <cit> , as an unsupervised method of source extraction from sv 1h-mrs. in contrast with ica, most of the sources extracted by the proposed technique closely correspond to the mean spectra of some of the analysed tumour types. this similarity allows accurate diagnostic predictions to be made for each patient  both in fully unsupervised mode or using convex-nmf as a dr step previous to standard supervised classification. these predictions are comparable to or more accurate than those obtained with supervised techniques.

the remaining of the paper is organised as follows. the materials subsection describes the data used in this study, while the methods subsection summarises existing approaches for the application of nmf, then discusses how they are used with mrs data, presents different model initialisation methods, and also explains how to use the obtained information to label cases and to reduce data dimensionality. the results section compiles and presents all the experimental results, with the objective of assessing nmf in fully unsupervised mode, and to investigate the use of nmf as a dr method previous to standard supervised classification. these results are later discussed and some conclusions are drawn.

materials
the data analysed in this study were extracted from interpret, an international multi-centre database  <cit>  resulting from the interpret european research projecta  <cit> . class labelling was performed according to the world health organisation system for diagnosing brain tumours by histopathological analysis of a biopsy sample. these are single-voxel proton mrs  data acquired at  <dig> t and at two different echo times  and long, 135- <dig> ms ) from brain tumour patients and healthy controls .

the importance of using two different signal acquisition conditions  lies in the different metabolites that are detectable at each of them. ste is more sensitive to those with short t <dig>  values  and, in addition, all signal peaks are positive. on the other hand, in lte spectra we can find both positive and negative peaks, where the negative peak is due to the inverted alanine or lactate doublets. the analysed data set included, at lte,  <dig> astrocytomas grade ii ,  <dig> glioblastomas ,  <dig> metastases ,  <dig> low-grade meningiomas  and  <dig> normal brain parenchyma measurements from healthy controls ; at ste, it included  <dig> a <dig>   <dig> gl,  <dig> me,  <dig> mm, and  <dig> no. data were processed as in  <cit> . a total of  <dig> clinically-relevant frequency intensity values measured in parts per million  were sampled from each spectrum in the  ppm interval. unit length normalisation  of the spectra was performed.

a further test data set  was gathered from three medical centres: centre diagnòstic pedralbes , institut d'alta tecnologia  and institut de diagnòstic per la imatge -badalona in barcelona, spain. it was processed in the same conditions as the rest of the data, and consists of ste and lte spectra from  <dig> patients and healthy controls:  <dig> a <dig>   <dig> high-grade aggressive tumours ,  <dig> mm, and  <dig> no subjects.

mrs data were acquired according to the medical ethics regulations of the countries of the medical centres involved, in particular, with the helsinki declaration and the spanish "ley orgánica de protección de datos de carácter personal", ley orgánica 15/1999" and the "95/46/eu directive on data protection, december 13th, 1999". all patients or their legal representatives signed informed consent forms, agreeing to the study and to the use of their deidentified  data for research.

methods
as stated in the introduction, nmf can be seen as a dr technique, functionally similar to source extraction. this section summarily describes some of the existing nmf methods and the different alternatives for their initialisation. the choice of initialisation technique turns out to be a key feature for the success of nmf as a tumour type classification method. the specific way in which these techniques are used and interpreted in the context of mrs data analysis is also described in this section. we later explain how the data can be labelled a posteriori, once the sources have been extracted, with the purpose of helping us to understand the extent to which obtained sources are able to represent the data. finally, the way sources can be used strictly for dr is also described.

non-negative matrix factorisation methods for source extraction
in the standard nmf description  <cit> , a non-negative matrix v of observed data , is approximately factorised into two non-negative matrices, w  and h . the product of these two matrices provides a good approximation to the original matrix, that is, v≈wh. the conventional approach to finding the two factors is by minimising the divergence between v and wh:

 minw,h f=12‖v−w h‖f <dig> 

subject to the non-negativity constraints mentioned above, where ||·||f is the frobenius norm. in this study, the following divergence minimisation methods, which cover a wide palette of algorithmic alternatives, were considered:

• euclidean distance update equations   <cit> 

the objective function is optimised with multiplicative update rules for w and h:

 w←wvhtwhht;andh←hwtvwtwh 

monotonic convergence of the algorithm can be proven  <cit> . these update equations preserve the nonnegativity of w and h, and constrain the columns of w to sum to unity.

• alternating least squares   <cit> 

this technique alternately fixes one matrix and improves the other.

 w←arg minw≥0f;  h←arg minh≥0f 

where w and h are updated as follows:

 w←-1hvt)t;andh←-1wtv 

setting all negative elements in w and h to zero.

• alternating non-negative least squares using projected gradients   <cit> 

the equations for w and h in the alternating least squares method above are solved here using projected gradients. for h, this entails:

 h←p 

where α is the step size, and p is a bounding function that ensures that the solution remains within the boundaries of feasibility. the gradient function is solved as:

 ∇f¯=wt 

the same approach is used to calculate w.

• alternating least squares with optimal brain surgeon   <cit>    <cit>  similar to alternating least squares, this algorithm alternately solves the least squares equations for w and h. the negative elements in w and h are set to zero and the rest are adjusted using the obsmethod, through second-order derivatives. the update rules for w and h are:

 w←-1hvt)t+δw;andh←-1wtv+δh 

where, δw and δh act as regularisation terms and are responsible for eliminating the less important elements of w and h, respectively , thus re-adjusting the remaining elements optimally. more implementation details can be found in  <cit> .

• convex-nmf   <cit> . to achieve interpretability, this method imposes a constraint that the vectors  defining w must lie within the column space of v, i.e. w = va , so that v≈vah. by restricting w to convex combinations of the columns of v we can, in fact, understand each of the basis or sources as weighted sums of data points. unlike the previous ones, this nmf variant applies to both nonnegative and mixed-sign data matrices. the factors h and a are updated as follows:

 ht←ht+a+htat-a-a+htat+a;a←a+ht+-ahht-ht++ahht 

where + is the positive part of the matrix, where all negative values become zeros; and - is the negative part of the matrix, where all positive values become zeros. all the algorithms, for all initialisations, were allowed to achieve convergence. such convergence was qualified as the lack of variation in the reconstruction error, from one iteration to the next, over a common set small threshold of value 10- <dig> 

interpretation of the methods
in nmf for the analysis of mrs data, the rows in h can be understood as estimates of the concentration/abundance of the constituent signals or sources, while the columns in w are the corresponding constituent signals or sources of the spectra themselves. in conventional nmf methods , the matrices v, w and h are constrained to be non-negative, thus permitting the interpretation of the mixing matrix entries as quantitative estimates of the amount of source tissue in the sample. the source can, as a result, be assigned to the class  with whose template it shows a higher correlation. if non-negativity is also imposed on the signals and sources, then it is commonplace truncating the negative values to zero, therefore loosing potentially relevant information  in lte spectra, which are expected to be especially relevant for discrimination between tumour types). some of the methods described above impose the constraint of non-negativity only on the mixing elements representing the constituent tissue fractions. where non-negative signals are also required, we propose using absolute values instead, in order to reduce data loss from the negative peaks.

convex-nmf, instead, enforces this non-negative constraint only on h, while v and w are allowed to be of mixed sign. given that the observed mrs data are of mixed sign, their sources should also be of mixed sign. thus, understanding w as the source spectra matrix, the sources will be intuitively interpretable and no pre-processing of the spectra is required in order to make them non-negative, thus preventing any unnecessary loss of information . as in the previous methods, h can be understood as estimates of the concentration/abundance of the constituent signals.

nmf initialisations
nmf methods unavoidably converge to local minima. as a result, the nmf bases will be different for different initialisations. in this study, six forms of initialisation were considered . although a standard procedure to justify the choice of nmf initialisation does not exist, the six alternatives considered here cover a wide array of approaches: from random initialisation, to prototype-based clustering methods , and feature extraction techniques .

• random:

: w and h are initialised as dense matrices of random values between  <dig> and  <dig> 

• k-means clustering:

: w is initialised with the cluster centroids, and h with the distances from each point  to every centroid.

: h is initialised as h = c +  <dig> e, where e is a matrix with all its elements equal to one, and c =  is filled with the cluster indicators, which are based on the cluster indices of each point, such that cik = { <dig> } and the ones indicate cluster membership. a is initialised as a = d- <dig>  where d is a diagonal matrix with each element being the number of points in each cluster  <cit> .

• fuzzy c-means :

: w is initialised with the cluster centres, and h with the fuzzy partition matrix ; as in  <cit> .

: h is initialised as h = c +  <dig> e, where c here is filled with the fuzzy partition values, and e is a matrix with all its elements equal to one. a is initialised as a = d- <dig> , where d is a diagonal matrix with each element being the number of points in each cluster.

• pca:

: the mean vector is subtracted from the complete dataset, and this is followed by the computation of its eigenvectors and eigenvalues. the matrix w is initialised with the whitened data , and h with the de-whitening matrix. in order to use the initial w and h matrices obtained from pca in nmf, the negative values are truncated, as proposed in  <cit> .

: h is initialised as h = c +  <dig> e, where c is the de-whitening matrix, calculated, as in the rest of methods, after calculating pca, and also truncating the negative values. for the initialisation of a, and as suggested in  <cit> , first we compute a = ht- <dig>  and then a = + +  <dig> e〈+〉 so that the negative elements are removed, where 〈x〉 = ∑n, k|xn, k|/||xn, k|| <dig>  and where ||xn, k|| <dig> is the number of nonzero elements in x.

• ica :

: the independent components extracted using fastica are used to initialise w, and h is initialised with the resulting mixing matrix. then, to meet the non-negativity condition of nmf, the negative values are truncated.

: h and a are initialised as in the pca  initialisation, with the only difference that h is filled with the sources or independent components from fastica.

• non-negative matrix factorisation :

: w is initialised with the sources extracted with nmf , and h is initialised with the resulting mixing matrix. in the case of als method, initialising with the same method is equivalent to duplicating the number of iterations, which does not necessarily mean that the results will improve.

: h and a are initialised as in the pca and fastica  initialisations, with the only difference that h is filled with the sources from nmf .

in principle, we might expect the different initialisation strategies to behave as follows. random initialisation might be considered as an uninformed first estimate for nmf methods, which may lead to different outcomes given different initialisation conditions  <cit> . we might expect k-means and fcm initialisations to make all methods perform better, but the results may depend on the initial selection of clusters; therefore, different results could be obtained depending on such selection. pca and ica, instead, can provide a unique solution, although perhaps too biased, while, in the case of nmf, the existence of a unique solution will depend on its own initialisation. all these methods will converge to local optima, so there is no guarantee that the solution obtained will be the best possible.

tumour type labelling using the mixing matrix and the sources
as explained in the introduction section, nmf is used in this study as an unsupervised method in the sense that labelled mrs cases are not used to create the data model. the obvious advantage of this approach is that the labelling procedure can be made independent of any specific labelled  mrs dataset that might bias the generalisation capabilities of the model.

in order to determine how well the sources obtained through nmf represent the data, we propose to infer the labels of the data only on the basis of the mixing matrix and the source signals calculated, which will give us an idea of the extent to which the sources contribute to the reconstruction of each mrs observation . the calculation of the contribution c of each source k to each case i is:

 c=vitwkh 

where v the data matrix, w is the matrix of sources, and h is the mixing matrix. the predicted label can then be inferred from the values in c as follows: for each case i, the label is provided by the source k that has the highest value of contribution for that case.

source extraction as a dimensionality reduction procedure prior to classification
the description of the mr spectra through a limited number of extracted sources also entails a dr process in the form of feature extraction. as previously mentioned, the use of dr methods in the form of feature selection or extraction is commonplace in the analysis of mrs. the extracted features can then be used for traditional classification, within a standard supervised framework using labelled cases. this was accomplished in the current study using the gram-schmidt process  <cit>  for orthonormalising the set of obtained source signals. this method takes a finite, linearly independent set w = w <dig>  . . ., wk for k ≤ n, where k is the number of sources and n is the number of samples, and generates an orthogonal set w' = u <dig>  ..., uk that spans the same k-dimensional subspace of ℜn as w.

RESULTS
in this section, we compile and present all the experimental results. the objective of the experiments was twofold: first, the assessment of nmf in fully unsupervised mode as a source extraction and tumour type-labelling method and, second, the evaluation of nmf as a dr method prior to standard supervised classification.

nmf as a source extraction method
here, we provide the comparative results of the application of the five nmf methods for source extraction outlined in the methods section, for each of the six different initialisation strategies discussed. the goal was to find the best combination of nmf method and initialisation for the type of data analysed. experiments were carried out for four different brain tumour diagnostic problems from mrs acquired both at lte and ste. in each of these classification problems, we attempted to discriminate between one or two tumour types and healthy tissue, namely a <dig> vs. no; a <dig> vs. me vs. no; a <dig> vs. gl vs. no; and a <dig> vs. mm vs. no.

a <dig> are low-grade  glial tumours with an infiltrating behaviour . they evolve  to gl, which are highly malignant, who grade iv tumours. me are also grade iv tumours, but they have a different origin: they are tumours originated at other parts of the body that spread  to distant sites, such as the brain. grade iv tumours usually have a necrotic pattern, with strong lipid signals that are most evident when obtaining mrs data at short times of echo  <cit> . however, not all gl have this necrotic pattern, and some retain a spectral pattern which is overall similar to that of their low-grade glial counterparts, the a <dig>  and might be considered as atypical within their type, or class outliers  <cit> . mm are low grade tumours , from a completely different origin: meningeal cells. they have a distinct spectral pattern at lte, with an inverted alanine doublet at ca.  <dig>  ppm  <cit> . their spectral pattern is also easy to recognise at ste, without necrosis, and it is different from the glial, metastatic, or normal patterns.

in summary, the choice of these specific problems at both time of echo acquisition conditions ultimately aimed to find answers to the following questions: 1) : is normal brain correctly distinguished from infiltrative tumour? 2) : are grades  well differentiated and distinct from normal tissue? 3) : are grades still well recognised when one of the classes is heterogeneous? 4) : can low grades , or infiltrative vs. non-infiltrative be differentiated?

tables  <dig> and  <dig> compile the results of the correlation between the mean spectrum of each class  and the source signal, extracted with nmf, that best represents this class, i.e. the source signal that has the highest correlation with the class. the number of sources calculated was selected according to the number of classes involved in each diagnostic problem studied. calculating the correlation provides us with an indicator of to what extent each source is tumour-type specific.

summary of the correlation values for the sources most highly correlating with each type of tissue as expressed by its mean spectrum, for different diagnostic problems at lte, and for all the nmf methods and initialisation conditions in the study. the diagnostic problems are: a <dig>  no; a <dig>  me, no; a <dig>  gl, no; and a <dig>  mm, no

summary of the correlation values for the sources most highly correlating with each type of tissue as expressed by its mean spectrum, for different diagnostic problems at ste, and for all the nmf methods and the initialisation conditions in the study. the diagnostic problems are: a <dig>  no; a <dig>  me, no; a <dig>  gl, no; and a <dig>  mm, no

the computation times for the different methods used in this study, in a personal computer :  <dig> gb, processor: pentium dual-core t <dig>  64-bit operating system), were less than one second in almost all cases, with the exception of alsobs . the different initialisations added less than one second to the total computation time.

labelling using convex-nmf
the results summarised in tables  <dig> and  <dig> lead to one clear conclusion: convex-nmf was, consistently, the variant of nmf that yielded the highest correlations between the mean spectrum of the tumour types and the corresponding extracted sources. convex-nmf was, therefore, the method of choice for the subsequent experiments.

we next report the results of the unsupervised labelling process: that is, the assignment of class labels  to each of the cases using the extracted sources and without modelling explicitly the relationship between the sources and the class labels. table  <dig> shows the accuracy results  of the labelling process using convex-nmf, for the same four diagnostic problems used to assess source extraction. to further assess the performance of convex-nmf, we added here two more complex diagnostic problems with data acquired both at lte and ste: the discrimination between a <dig>  gl+me , no; and a <dig>  ag, mm. these are both classical discrimination problems in brain tumour diagnosis using mrs  <cit> . these two specific problems aim to answer the question: are grades well recognised when one of the classes  is heterogeneous ?

summary of the labelling accuracy using convex-nmf with k-means initialisation for a <dig>  no; a <dig>  me, no; a <dig>  gl, no; a <dig>  mm, no; a <dig>  ag, no; and a <dig>  ag, mm, at lte and ste. they include the accuracy , and the number of correctly labelled samples from the total, in parentheses. the number of source signals  used in the experiments is indicated in parentheses

convex-nmf was also initialised with k-means clustering, and a total of  <dig> source signals were calculated for these two problems, given that  <dig> classes were involved. the predicted labels were then used to determine to what extent each observation was correctly labelled, according to the interpret database information. the results of the six diagnostic problems are compiled in table  <dig>  and figures  <dig> and  <dig> 

in the next section we use the sources in the context of supervised classification, and compare the results with equivalent classifiers, using the same settings.

nmf for classification
using convex-nmf extracted source signals for dimensionality reduction prior to classification
we now switch to experiments that analyse the use of convex-nmf as a dimensionality reduction technique to preprocess the mrs data prior to standard classification. for this, we used the orthogonal set corresponding to the source signals obtained, and projected the data onto this basis. the spectraclassifierb software  <cit>  was used to develop standard fisher linear discriminant analysis  classifiers, which were then evaluated through bootstrap with  <dig>  repetitions. the results are shown in table  <dig> 

classification results  obtained with fisher lda  for six diagnostic problems, from the source signals obtained by convex-nmf, for data acquired at lte and ste. classifier results were validated through bootstrap. the number of source signals  used in the experiments is indicated in parentheses

in order to compare these results with those of a traditional feature extraction method, we replicated all experiments using the spectraclassifier software with pca as data preprocessing feature extraction method . this was again followed by fisher lda classification and evaluated through bootstrap with  <dig>  repetitions, as in the experiments in table  <dig>  the combination of pca+lda has been widely used to develop mrs classifiers  <cit> . the results for experiments with pca are compiled in table  <dig>  results obtained using an independent test set are shown in table  <dig> for both fe methods: pca and convex-nmf.

classification results  obtained with fisher lda  for six diagnostic problems, from the source signals obtained by pca, for data acquired at lte and ste. classifier results were validated through bootstrap. the number of principal components  in the experiments is indicated in parentheses

classification accuracies  and balanced error rates  for the independent test set, using all the classification settings from tables  <dig> and  <dig>  for data at lte and ste

determining the most adequate number of sources
one of the issues to which attention should be paid is the determination of the most appropriate number of sources for each problem. for this, we investigate the effect of varying the number of extracted sources on the classification results. for illustration, results for only one of the six previously investigated problems, namely a <dig>  ag, mm, are presented. this problem is the most complex of those studied since it encompasses tumour type and grade, as well as extra or intra-axial origin discrimination: low grade neuroepithelial vs. high grade neuroepithelial, plus metastasis vs. low grade meningeal.

figures  <dig> and  <dig> show the different sources obtained, at lte and ste, respectively, when we vary the number of sources. the first four rows show the results of extracting  <dig>   <dig>   <dig> and  <dig> sources, while the last rows show the percentage of contribution of each source to each tumour type, for each experiment. tables  <dig> and  <dig> compile the classification results when varying the number of sources from  <dig> to  <dig>  for the training and the independent test set, respectively; and the plots in figure  <dig> summarise the results, at lte and ste.

classification results  for the training set, at lte and ste, obtained when varying the number of extracted features  from  <dig> to  <dig>  for the problem a <dig>  ag, mm. fisher lda was the classification method, and results were validated through bootstrap. the second and fourth columns show the results for pca, and the third and fifth columns the results for convex-nmf

classification accuracies  and ber for the independent test set, at lte and ste, using the corresponding classification settings from table  <dig>  the second and fourth columns show the results for pca, and the third and fifth columns the results for convex-nmf

discussion
nmf as a source extraction method
the results reported in tables  <dig> and  <dig> clearly indicate that, in terms of correlation, the convex-nmf method consistently outperforms the rest, yielding better results in nearly every experiment. the advantage of convex-nmf is especially striking at ste . regarding the different initialisation alternatives, correlation results do not show much dependence on the type of initialisation strategy. random and k-means-based initialisations seem to be, overall, the best choices at both times of echo. therefore, in all subsequent analyses, convex-nmf with k-means initialisation was the selected method.

the illustrative example of figure  <dig>  in which the nmf-extracted sources are shown, reveals an effect resulting from the fact that the best correlation value between the mean of the spectra of a class and the sources is used as the indicator for selecting the source that best represents that class: for some types of nmf, this approach results in situations in which each source does not necessarily correspond univocally to a single class; sometimes, instead, a single source may encompass more than one class. this can be clearly seen in figure  <dig>  where the sources calculated with the first four methods  can be explained as follows: the ones in the leftmost column describe mostly the a <dig> and mm tumour types, respectively ; the ones in the rightmost column describe the normal tissue; and the ones in the middle column have a low correlation with the three tumour types in the experiment, as evidenced if we compare them qualitatively to the mean spectra at the bottom of the figure.

in stark contrast, we can also conclude from figure  <dig>  that convex-nmf performs class-specific source extraction far better than the other methods studied. it is remarkable how convex-nmf is able to extract sources that represent each class univocally. here, a <dig> is represented by one source , meningiomas by another source  and normal tissue by a third one . this way, convex-nmf extremely simplifies the interpretation of the source signals extracted. for example, while the sources produced by the euc, als, alspgand alsobs methods show a doublet at about  <dig>  ppm , the two sources for a <dig> and mm in the convex method clearly discriminate the contribution from the lactate inverted doublet centred at  <dig>  ppm, typical of a <dig>  from the alanine inverted doublet centred at  <dig>  ppm, which is typical from meningioma.

labelling using convex-nmf
the results reported in table  <dig>  and figures  <dig> and  <dig> show that normal brain  is perfectly discriminated in all of the comparisons carried out, as it might be expected due to the metabolic differences of healthy tissue with respect to brain tumours in general. furthermore, the differential discrimination among meningeal, glial  and control is reasonably good for both times of echo . on the other hand, the trilateral discrimination between the aggressive tumours , a <dig> and no is far less accurate, reaching a low 71% for the a <dig>  gl, no at lte. the detailed interpretation of the last two diagnostic problems, involving the aggressive grade iv superclass is as follows:

• problem a <dig> vs. ag vs. no at lte: a <dig> is fully represented by one of the sources , which correlates at  <dig>  with the mean spectrum of a2; ag is labelled with an accuracy of  <dig> % and it is mostly represented by two sources , which correlate at  <dig>  and  <dig>  with the mean spectrum of ag; finally, no is also fully represented by one of the sources , which fully correlates  with the mean spectrum of no. the accuracy for the groups a <dig> and no is 100%, while it falls to 70% for ag, which totals  <dig> % of correctly labelled samples.

• problem a <dig> vs. ag vs. no at ste: a <dig> is labelled with an accuracy of  <dig> % and it is represented almost exclusively by one of the sources , which correlates at  <dig>  with the mean spectrum of a2;ag is labelled with an accuracy of  <dig> % and it is mostly represented by two sources , which correlate at  <dig>  and  <dig>  with the mean spectrum of ag; and no is fully represented by one of the sources , which fully correlates  with the mean spectrum of no. at ste, the highest accuracy for ag raises the overall accuracy to  <dig> %. the higher accuracy for short echo time classifiers is also common in other studies based in supervised analysis of data .

• problem a <dig> vs. ag vs. mm at lte: a <dig> is labelled with an accuracy of 95% and it is represented almost exclusively by one of the sources , which correlates at  <dig>  with the mean spectrum of a2; ag is labelled with an accuracy of  <dig> % and it is mostly represented by two sources , which correlate at  <dig>  and  <dig>  with the mean spectrum of ag; finally mm is labelled with an accuracy of  <dig> 

• problem a <dig> vs. ag vs. mm at ste: a <dig> is labelled with an accuracy of  <dig> % and it is represented almost exclusively by one of the sources , which correlates at  <dig>  with the mean spectrum of a2; ag is labelled with an accuracy of  <dig> % and it is mostly represented by two sources , which correlate at  <dig>  and  <dig>  with the mean spectrum of ag; finally mm is labelled with an accuracy of  <dig> % and represented almost in full by one of the sources , which correlates at  <dig>  with the mean spectrum of mm. the overall accuracy is  <dig> %. again, at ste the accuracy for ag is higher than at lte.

the results for the ag superclass illustrate that convex-nmf is not always successful in extracting tumour type-specific sources. two inherent characteristics of ag may explain this: first, ag has been artificially built using two tumour types  and, second, gl by itself is a rather heterogeneous type in which plenty of substructure can be found  <cit> .

this does not preclude the interpretation of the sources. according to the signal profile and its metabolic interpretation, one of the sources representing ag  seems to correspond to the necrotic core   <cit> ; while the other  seems to correspond to the cellular part of the tumour . note that this dichotomy is valid for both echo times, and the two problems above, in which one source represents the cellular part while the other represents the necrotic core, and both are needed to accurately recognise sv patterns of gl or me.

convex-nmf as dr method prior to classification
the comparison of the results of tables  <dig> and  <dig> reveals that at ste the classification results for the training dataset improve in all the experiments when using convex-nmf for feature extraction instead of pca, prior to standard supervised classification. this pattern was repeated for lte, with the exception of the a <dig>  ag, mm problem, which yielded a poorer result; in any case, the difference is rather small and not significant. interestingly, the unsupervised labelling results reported in table  <dig>  though worse than those of their supervised counterparts reported in table  <dig>  are still comparable to those obtained with pca and lda in fully supervised mode .

an independent test set was then used to further validate the robustness of the developed classifiers for data preprocessed with both fe methods: pca and the orthogonal convex-nmf sources. table  <dig> contains the accuracy results , as well as the corresponding balanced error rate   <cit> . again, at ste, the use of convex-nmf orthogonal sources yields results that clearly outperform those of pca-based classification. however, at lte the results are more mixed: similar in the cases of a <dig>  no; a <dig>  me, no and a <dig>  gl, no; better in the case of a <dig>  ag, no; and worse in remaining two: a <dig>  ag, mm  and a <dig>  mm, no, with a more noticeable difference.

other studies have addressed similar problems in the existing literature, for similar data. we report next some of these results for comparative purposes, although the techniques and the evaluation criteria involved are not always the same.

• in  <cit> , as first step of a multiclass classifier for data acquired at lte, aggressive tumours  were discriminated from a <dig> with an accuracy of  <dig> %. in our experiments, which also include the healthy tissue class, an  <dig> % accuracy was achieved from the extracted sources. for the same problem, with data acquired at ste, an accuracy of  <dig> % was reported in  <cit> , to be compared with a  <dig> % obtained in our study from the sources.

• in  <cit> , when classifying low-grade meningiomas  vs. low-grade glial tumours  vs. high-grade aggressive tumours , the reported accuracies for the training set were  <dig> % at lte and  <dig> % at ste, while the accuracies for an independent test set were, in turn,  <dig> % and  <dig> %. the results obtained in our experiments when separating a <dig> from ag and mm, using the sources, were  <dig> % at lte and  <dig> % at ste, for training; and  <dig> % at lte and  <dig> % at ste, for the independent test set.

determining the most adequate number of sources
figures  <dig> and  <dig> show the different sources obtained, at lte and ste, respectively, when varying the number of sources. in both figures, the first columns of sources are representing mostly the a <dig> type; the second columns represent mostly the mm type; and, finally, the third columns are mainly representing necrotic tissue, which should only be found in gl and me. it is interesting to see how, when calculating  <dig> sources, the first  <dig> sources remain, while the new one seems to correspond to actively proliferating tumour .

the bar plots for  <dig> sources, at both times of echo, show the extent to which sources  <dig>  and  <dig>  are representing the ag superclass. at lte, when calculating  <dig> sources, the first four look very similar to those calculated in the experiment with  <dig> sources, while the new one seems to express part of the ag superclass, which is now in fact split into the last three sources. the non-necrotic 4th and 5th sources would show an inverted trend for total choline  versus ml/lactate . then, decreasing choline would be matched by increased ml/lactate, suggesting sampling of aggressive tumour subtypes with variable proliferation rate , with concomitant effects on the lactate and ml accumulation. at ste, when calculating  <dig> sources, the first four also look very similar to those obtained in the experiment with only  <dig> sources, but the new one is not only part of ag, but also partly of mm.

six sources at lte already seem to be too many, given that the contribution of the last one is comparatively very small and completely unspecific. six sources at ste also seem to be too many. in this case, the mm class is less represented by the second source, while the 5th does contribute both to ag and mm. this could have contributions from class outlier cases , for which mobile lipids could be starting to increase. the last one could contain some artefactual bad water suppression above  <dig>  ppm. up to this point, and based solely on the patterns of the sources, and the percentages of contribution of these to each class, choosing  <dig> or  <dig> sources seems to be best option, at both times of echo, to maintain the correspondence between source, or set of sources, and individual tumour types.

tables  <dig> and  <dig> compile the classification results corresponding to the varying number of sources , both for the training and the independent test set, respectively. the plots in figure  <dig> summarise these results. the leftmost column in this figure contains the results at lte, and the rightmost column, the results at ste. strictly in terms of classification, the use of  <dig> sources seems to be a good choice at lte, given the accurate results obtained with the independent test set, and its low ber value. at ste, choosing  <dig> sources seems to be a good compromise, for which the accuracies for the training and the independent test set are high, while the ber for the test set stays the lowest.

CONCLUSIONS
the unsupervised analysis of sv 1h-mrs data from human brain tumours using convex-nmf has been shown to produce a reduced number of sources that can be confidently recognised as representing brain tumour types or healthy tissue in a way that other source extraction methods, including other nmf variants, cannot. importantly, this result allows us to produce class assignments for unlabelled spectra in fully unsupervised mode, using the mixing matrix directly as a basis for classification, with results that are comparable to those obtained in fully supervised mode. the use of the sources extracted by convex-nmf for dimensionality reduction leads to simple lda-based classifiers with independent test performances that are comparable with, and are often better than previously described strategies. in summary, the unsupervised properties of convex-nmf place this approach one step ahead of classical label-requiring supervised methods for detection of the increasingly recognised molecular subtype heterogeneity within human brain tumours. the application of convex-nmf in computer assisted decision support systems is expected to facilitate further improvements in the uptake of mrs-derived information by clinicians.

authors' contributions
som, pjgl and ca conceived the overall scope of the study. mjs participated in the data processing. som implemented the methods and carried out the experiments. som, pjgl, and av designed the set of experiments, and analysed the results from the machine learning viewpoint. mjs and ca contributed the biochemical and spectroscopic analysis of the results. pjgl, av and ca coordinated the work. all authors helped to draft the manuscript and approved its final version.

endnote
a http://gabrmn.uab.es/interpret

b http://gabrmn.uab.es/sc

