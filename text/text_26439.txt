BACKGROUND
high-throughput molecular biology is enabling the molecular characterization of functional regions by aggregation of genome-wide data. examples include the assignment of dna methylation intensities to functional regions  by averaging over the dna methylation state of many single instances, or the assignment of conservation scores to genomic locations by aggregation of the information in multiple sequence alignments. the latter analysis was first performed in the mouse genome paper  and has recently been highlighted as being of historic significance  <cit> . the averaging of signal across multiple regions of the same functional type facilitates the reduction of genome-wide results to summary statistics, but is complicated by the presence of missing data, e.g. missing cpgs in the case of methylation or indels in the case of alignment.

in the case of dna methylation, many studies use the aggregation of methylation states at multiple cpg  sites across many regions to compensate for the sparsity of signal at any specific location relative to a boundary. such analyses, where the percentage of methylated cytosines  is computed at each location relative to a boundary , are currently considered standard when characterizing the methylomes of new species , and are frequently used to compare methylation intensities at functional boundaries such as intron-exon and utr-coding junctions .fig.  <dig> bias introduced by the yule-simpson effect. a comparative analysis of dna methylation across a functional boundary. a pair of matrices is associated to a functional boundary . the methylation states are represented by numeric values at all relevant genomic locations . for example, row five may represent a genomic locus: cgagtcag||cgcgcgcg  where all cg sites are fully methylated. the mean of the row averages  is  <dig>  for both matrices: in eight of the  <dig> regions all cgs are completely methylated, and in the remaining four regions all cgs are completely unmethylated. the mean of the column averages  is  <dig>  for the left matrix and  <dig>  for the right matrix. although there is no difference in the regional methylation average across the matrices, a difference in the column averages is observed due to a different data distribution: regions that are methylated are represented with fewer cgs in the left matrix than they are in the right matrix, but this is not the case for unmethylated regions. importantly, it is not the lower frequency of sites in the left matrix that causes the discrepancy between c and r but the lower frequency of sites in the methylated regions



in this paper we address the validity of such comparisons. we show that the %mcg rates at the different relative locations cannot be directly used to deduce the methylation states of regions, or to determine whether different functional regions exhibit significant differential methylation . we explain that this is a byproduct of selection, which leads to an association between the number of cgs in a specific region and the extent to which the region is methylated. specifically, deamination of methylated cytosines results in depletion over time of cgs in constitutively methylated regions of vertebrate genomes  <cit> . varying evolutionary constraints affect the pattern of cgs, thereby limiting the availability of methylation data in some regions. the non-uniform distribution of “missing data” , associated with varying selection rates, results in the yule-simpson effect   confounding the naïve analyses . as explained in more detail in the next sections, the yule-simpson effect concerns the possibility that average-based comparison studies over aggregations of instances may lead to different conclusions than comparisons conducted without aggregation, due to an underlying trend of varying data distributions. additionally, we show that this bias is present also when relative changes are considered, e.g., when comparing the relative change in dna methylation under several different experimental conditions. we have found that numerous dna methylation studies may be vulnerable to these issues, and show this to be the case for human methylome analysis.

the biases prevalent in current studies must be addressed by modifying the statistical analyses conducted. we introduce two methods for this task that are suitable for many genome-wide studies where signal is aggregated by functional region. the first method involves regional averaging on a reduced dataset. while it is robust and involves minimal statistical inference, this method requires ignoring a significant portion of the collected data, and cannot determine quantitative and site-specific methylation tendencies. the second method we propose applies a model-based matrix completion algorithm to circumvent the missing data problem. it is inspired by machine learning techniques for matrix completion applied in other settings  <cit> , and in our case we are able to take advantage of specific patterns linking conservation pressure to a predicted observed state. the method learns the relevant set of parameters separately for each dataset, and generates site-specific inferences of the measure of interest, along with comparative statistics and error estimates.

using our approaches, we find that previous studies exaggerate the difference in methylation between functional regions, and our analysis of previously published data leads to different conclusions about the functional role of dna methylation. finally, we discuss additional settings in which this bias can be present and introduce a method to test for its presence in arbitrary datasets.

RESULTS
averaging-based comparisons of dna methylation intensities are biased by uneven distribution of data
the bin- or site-specific approach to dna methylation comparisons across region types can be formalized as follows : the methylation states on each side of a functional boundary are represented by matrices. each genomic region of interest is split at the junction, with each side contributing a row to the relevant matrix. each column represents a distance from the boundary . the ij-th entry of a matrix indicates the extent to which region i was methylated at distance j from the boundary. in the case that the base at location j in region i cannot be methylated , the matrix contains “missing data” .

to illustrate the difficulties in comparing methylation across boundaries, we show in fig.  <dig> a simplified hypothetical example in which regions across a functional boundary have the same methylation tendency. in this case the cg sites on both sides of a junction are either all methylated or all unmethylated. however a naïve comparison of the column averages suggests a significant increase in the average mcg/cg rate when crossing the functional boundary. this apparent “paradox”, can be understood by noting that the increase observed in the column averages is a result of the missing data being differently distributed across the functional boundary: regions upstream of the boundary have less data points at methylated regions than the coupled downstream regions, but there is no such trend for unmethylated regions. the “step” in column averages observed in the example is due to the different tendencies for missing data across the boundary. we emphasize that it is not the difference in the number of data points that results in an observed difference in the mcg/cg measure, but the difference in the number of data points specifically at the methylated regions. if all rows on the left hand side of the junction had one cg, a significant difference would not be observed. in the case of fig.  <dig>  comparison of the row averages would reveal that there is no difference in methylation tendency across the functional boundary. however, as we will show in the next section, row averages may also be inadequate for comparison of methylation, particularly in the common case that some rows do not have any cgs.

we hypothesized that the effects highlighted in fig.  <dig> arise in genome-wide methylation analyses due to the process of deamination, which results in the loss of cg sites at regions that are constitutively methylated . while the process of deamination leads to the loss of cg sites in methylated regions under weak selection, regions under strong selection maintain more cg sites, regardless of their methylation state. this suggests the presence of several different biases in current comparative studies. importantly, it implies that “column-based” methylation comparisons are confounded by the extent to which regions vary in selection. we begin by describing the extent of bias that can be introduced by averaging, and follow that with a demonstration of the extent of the problem using whole genome methylation data.

site specific averaging is not equivalent to regional averaging
we define an nxm aggregation matrix w as follows: each row of w represents one of a set of genomic regions of equal length. at each row, locations of the corresponding region that do not have cg sites <dig> correspond to empty elements in the matrix, and are referred to as “missing entries” or “missing data”. sites that can be methylated are represented with the assigned methylated values; in the case of bisulfite sequencing, values between  <dig> and  <dig> . given an aggregation matrix w, we define mw to be the mean over all elements of the matrix, rw to be the mean of the row averages and cw to be the mean of the column averages. for example, if we set w to be the matrix on the left in fig.  <dig>  we have mw = 1/ <dig>  rw = 2/ <dig> and cw = 1/ <dig>  for the case in which w has no missing values, it is easy to see that mw = rw = cw. however, the following proposition establishes that matrices with missing values can have  different mw, rw and cw values .

proposition  <dig> 
the difference between column averages and row averages can be arbitrarily large; for any three rational values r, c and m , there exists an aggregation matrix w such that rw = r, cw = c and mw = m.

we tested the extent to which these measures differ for different types of regions in the human methylome . establishing the extent to which these measures differ in analyzed datasets is important because in previous work cw , rw  <cit>  or mw  were used in comparisons of methylation across region types, with cw being the prevalent choice. table  <dig> shows that the difference between cw,rw and mw is large in some cases, and that the magnitude of this difference varies between regions of different types. for example, in promoter regions there is a difference of  <dig>  between r and m, whereas in intronic regions there is a difference of  <dig>  between c and r, approximately half of the reported difference in methylation between introns and exons at junctions  <cit> . we observed that in general the extent of discrepancy between the measures is inversely associated with the extent of selection. specifically, exons show the smallest differences.table  <dig> statistics for averaging-based analysis of the human methylome

the means of column averages , row averages  and all matrix values  are shown for different region types . also listed are the pearson correlations  between the number of sites in each row and its mean methylation.



we hypothesized that the differences between measurements are due to a negative correlation between the extent to which a region is methylated and the number of cg sites. we reasoned that such a process would affect c, r and m, but that c and m would be affected to a stronger extent than r. indeed, we observed such negative correlations for all but the exon regions . at coding exons, such associations are not observed, probably due to strong selection preventing the loss of cg sites in methylated regions.

average-based comparisons across region types can lead to exaggerated difference estimates and false findings
having established that different average-based measures are not equivalent to each other, and that they do not necessarily capture the actual methylation tendency, we proceeded to investigate how the use of column, row or matrix averages affects comparative methylation studies.

we found that a direct implication of possible differences between average-based measures is that a comparison of the dna methylation between two types of regions  is not the same as a comparison of the site-averages of methylation states. this is known as the “yule-simpson effect”  , and it follows from the following corollary to proposition 1: two matrices, w <dig> and w <dig>  can have the property that c1–c <dig> is different from r1–r <dig>  the direct relationship between our setting and a classic example of the ys effect is detailed in additional file 1: fig. s <dig> 

usually the term “simpson’s paradox” refers specifically to a reversal of effect when using averages. in our terminology this is equivalent to the statement that for matrices w <dig> w <dig>  we have that rw1 > rw <dig> while mw1 < mw <dig>  the following proposition connects this discord directly to the classic simpson’s paradox .

proposition  <dig> 
the sign of column-average and row-average comparisons across regions may be inconsistent. let w <dig> and w <dig> be two aggregation matrices. rw1–rw <dig> can have opposite sign to cw1–cw <dig>  and if it does then an instance of simpson’s paradox has occurred.

to test the extent to which comparative studies of the human methylome are confounded by the ys effect, we conducted simulations in which the methylation tendencies were set to be equal for the regions compared, while the matrix data structure, i.e., locations of cg sites, was kept the same . we found that although, as expected, there was no true difference in the tendency of cgs to be methylated, a “step” was observed when comparing the column averages . the presence and size of the step in these simulations indicate the need to correct for the ys effect to attain accurate comparisons of methylation tendencies across regions, that are not confounded by a difference in selection rates. an additional example of the need to correct for confounding selection effects is apparent when considering a subset of intron-exon junctions for which the intronic regions have higher methylation average rates than the downstream exonic regions . in this case cintron is significantly smaller than cexon , but rintron is significantly larger than rexon .fig.  <dig> an observed difference in the mcg/cg rate across a functional boundary is due to a change in conservation rates. a simulation based on the genetic structure of intron-exon junctions of the human genome . top row: maintaining the original genetic structure , and simulating a difference of  <dig>  % in methylation tendency . middle row: maintaining the original genetic structure , and simulating no difference in methylation by shuffling the methylation values across each matrix row . bottom row: simulating no difference in selective pressure or methylation tendency by shuffling all values  at each matrix row. shown are the %mcg/cg site-specific values and histograms of all %mcg/cg values for the different region types

fig.  <dig> analysis of dna methylation at functional boundaries. matrices containing bisulfite-generated methylation estimates were constructed from the relevant instances of the human genome , incorporating  <dig> 5′utr-coding junctions,  <dig>  mid-gene intron-exon junctions and  <dig>  cg island junctions. each plot shows average methylation measurements at increasing distances relative to the junction . the means of the column-average values are shown as dashed lines. simulation - the methylation values for each pair of coupled matrix rows were shuffled according to a random permutation , resulting in simulated data with equal methylation tendency across the junction. differences observed in the mcg/cg measures are due to differences in the matrix structure across the boundary . %mcg analysis –naïve averaging of the values in the matrix columns. corrected –column-averages after inference with compare and comparisons after correction with paired region averaging



investigating further, we found that in some cases reported differences in methylation seem to be due to the ys effect, rather than a difference in the methylation tendency of the regions at hand. 5′utr-coding junctions have been reported to display a significant difference in methylation rate based on a difference in the mcg/cg value distribution   <cit> . we observed such a significant difference  in a replicated analysis using whole-genome bisulfite data . however, when considering regional averages in a coupled corrected manner  the difference drops to  <dig> , and is non-significant . additionally, in a simulation shuffling methylation values such that there is no difference in methylation tendency across the junctions, a significant difference remains when conducting c-based analysis . the difference observed in simulation is due only to the presence of the ys effect as described. we therefore conclude that there is no significant difference in methylation tendency and extent at 5′utr-coding junctions in the human methylome.

the ys effect is not just a feature of analysis at site-specific resolution. it can also lead to questionable conclusions in bin-based studies. for instance, it has recently been reported that there is a significant difference in 5-hydroxymethylcytosine  across the exon-intron boundary in the human brain  <cit> , and that the change in 5-hmc was most evident at a 5 bps distance from the boundary . however, a closer look reveals that although  <dig>  exon-intron junctions were present in the dataset analyzed, only  <dig> and  <dig> have methylation values at the 5 bp region from the boundary, at the intron and exon side, respectively. moreover, there is not a single instance at which there were 5-hmc values on both sides of the boundary. as we have reported, the difference in selection between introns and exons results in a different distribution of missing data between these regions. we therefore conclude that there is currently no evidence for a significant difference in methylation or hmc rate across the exon-intron junctions at 5 bps resolution. testing for the possibility of such a difference at such fine resolution would require adding statistical power, perhaps by integrating more chromosomes and additional species into the analysis.

correction methods allow for comparisons of dna methylation tendencies across regions of different conservation rates
in this section we introduce two methods for unbiased comparisons in settings in which the ys effect we report on is present, and apply them to the comparison of dna methylation tendencies . we describe the methods in the context of dna methylation comparisons, but note that the techniques and software described can be extended to apply to different settings in which the ys effect is present . we first describe each method and then present results from their application to instances of the human methylome.fig.  <dig> the compare and paired-region averaging methods for correcting biases introduced by differences in conservation rates. top: compare learns a different set of parameters for every column, and the methylation tendency of site i,j is inferred from the features of row i and the parameters set for column j. the complete inferred matrix can then be used in subsequent average-based tests. bottom: paired-region averaging computes for each instance  the average methylation rate at each side of the functional boundary and excludes instances at which either of the boundary sides is lacking any values . tests to compare the relative methylation tendencies of the different boundary sides can be applied, but a quantitative analysis of the dna methylation rates cannot be conducted when using this method due to the region-exclusion step



paired region averaging
in order to account for the ys effect, regional averages may be leveraged to compare methylation tendencies across functional boundaries. however, comparisons using regional averages require adjustments to avoid biases. in the correction we propose, the regional average  of methylation tendencies is computed separately for the two sides of each boundary instance, discarding from subsequent analysis boundary-instances at which one or both sides of the boundary do not have any measured methylation values . the methylation tendency at the different sides of the boundary can then be compared using the statistical test of choice .

while allowing for comparisons of methylation tendencies in an unbiased manner, the paired row-averaging approach has several shortcomings. first, it requires discarding data. while this is crucial to avoid the ys effect , due to the sparsity of cg sites at methylated regions a considerable amount of information may need to be discarded. for example, when considering intron-exon junctions at 200 bp resolution,  <dig> of  <dig>  intron-exon junctions are discarded, and the number grows for shorter distances from the boundary. second, while this method enables an unbiased assessment of the relative methylation tendency across functional boundaries , it does not give a quantitative measurement of the methylation tendencies . this follows from the fact that instances of missing data are biased to originate from more highly methylated regions. third, the regional averages of methylation tendencies do not allow for site-specific assessment and therefore cannot determine if changes in methylation tendencies occur at a gradual or step-wise manner.

nevertheless, paired row averaging is a sound method for the comparison of dna methylation tendencies across region types, and does not require statistical inference. figure  <dig> presents our findings using paired row averaging at several functional boundaries of the human methylome.

model-based matrix completion
to enable the unbiased estimation of methylation tendencies across region types, while maintaining site-specific resolution, we developed compare . compare is a sparse-matrix completion technique that determines for each entry of an aggregation matrix a “methylation tendency” that reflects the extent to which the site corresponding to that entry would be methylated, if the dna at the site could undergo methylation. compare uses logistic-regression to perform inference of site-specific methylation tendencies and incorporates the regional observed methylation values and extent of missing data. the inferred methylation tendency is computed for each location  of an aggregation matrix as mi,j=11+e−bjbi,j+xjxi,j+yjyi,j+zj where xi,j is the average methylation rate of row i excluding site , yi,j is the proportion of sites in row i with missing data ), bi,j is a binary variable for the presence of any methylatable sites in row i ), and bj, xj,yj and zj are column-specific parameters learned from the non-missing matrix values . when analyzing large genomic segments or segments that are likely to span different conservation patterns xi,j, yi,j and bi,j are determined from a user-defined restricted region around each relative location  rather than the entire region span . compare’s inference procedure results in a complete matrix, allowing average-based statistics such as c, r and m to be used . importantly, compare’s inference approach assigns a different set of parameters for every column, enabling characterization and comparison of dna methylation tendencies at base pair resolution .

we tested compare’s predictive ability by performing 10-fold cross validation on exon, intron, 5′-utr and coding regions. compare’s estimates were highly correlated with the bisulfite-measured methylation states at observed sites, in all four types of regions . as expected, the majority of sites in 5′utr and coding regions are unmethylated, due to a high overlap of cg islands with such regions, while the majority of sites at mid-gene intron-exon junctions are methylated. in each run, compare conducts a cross-validation analysis  and reports the correlation between known and inferred values, assigning a precision measure to the specific dataset being analyzed.

re-analysis of methylation tendencies across functional boundaries
using compare and paired-region averaging we could obtain an accurate view of the  extent of methylation across functional boundaries in the human methylome . a reanalysis of 5′utr-coding boundaries with compare revealed that in contrast to previous reports, there is no significant difference in methylation tendency across the boundaries , with a difference in methylation tendency of  <dig>  . an uncorrected %mcg analysis of the same data shows a false-positive seemingly significant  difference of  <dig>  . additionally, methylation tendencies at both sides of the boundary were inferred by compare to be higher than those measured by %mcg . it is expected that the %mcg measures are lower than the true methylation tendencies because of the lower representation of cg sites at methylated regions.

an analysis of the intron-exon junctions of the human methylome with both compare and paired-region averaging revealed a difference in methylation tendency of  <dig>  , approximately half of the difference observed with no correction . interestingly, in arabidopsis we observe an average difference of  <dig>  at intron-exon junctions when no correction is applied to the whole-genome bisulfite data generated in  <cit> , and a correction with compare reveals an average difference of  <dig>   . we conclude that differences in methylation tendencies are similar in human and arabidopsis at intron-exon junctions.

discussion
we have discovered a problem with the standard approach to analyzing dna methylation at functional regions from genome-wide data and have shown that it affects comparative studies, resulting in false and exaggerated annotation of methylation differences in the human methylome. we established that averaging over cgs  to account for data sparsity creates a bias due to the different distributions of the frequency of sites that can undergo methylation in both methylated and unmethylated regions. we have examined three averaging statistics that have been used previously and have shown that they can be arbitrarily different from one another, and that significant differences between them are observed in the analysis of the human methylome.

most importantly, we have shown that comparative methylation studies are prone to biases due to a link between selection pressure and the extent of uneven distribution of cgs across regions due to different methylation rates. the link between the uneven distribution of data and the resulting bias is explained by the yule-simpson effect. interestingly, even though the bias as we’ve characterized it is a special case of a known phenomenon, it occurs due to a different type of false intuition than is usually the case with simpson’s paradox. notably, the ys effect we report on can also arbitrarily bias comparative studies of the relative change in dna methylation across different conditions . for example, it has been shown that in cancer cells the human genome becomes hypomethylated, but many cpg islands gain dna methylation  <cit> , a scenario similar to that illustrated in fig.  <dig> fig.  <dig> the ys effect can bias comparative studies of dna methylation across different conditions and cell types. the matrices above represent a hypothetical setting of a functional boundary and the methylation rates measured at the different genomic locations, as specified in fig.  <dig> . this example shows that, due to the ys effect, regional changes in dna methylation intensity that are not associated with a functional boundary can be misleading when analyzed with the %mcg statistic



to account for this underlying bias and enable the sound comparison of regions of different types we suggest using one of two procedures. paired-region averaging allows unbiased regional comparisons, while compromising site-specific resolution. an additional limitation of paired-region averaging is that it is strictly pairwise-comparative, and cannot asses the quantitative methylation tendency of a region type. the second method we propose makes use of a model-based matrix completion technique. our developed method, compare, is an inference procedure that uses structured logistic regression for sparse-matrix completion. we have shown that compare achieves high accuracy for instances of the human methylome. analyses with these two methods provide novel conclusions, such as that the difference in methylation at 5′utr-coding junctions is small and insignificant, and that the difference in methylation at intron-exon junctions is of similar magnitude in human and arabidopsis. additionally, compare’s inference approach maintains site-specific inference, allowing the detection of gradually changing methylation rates, or local methylation tendency.

testing for the presence of the ys effect in other genomic settings
in this work we have focused on biases in methylation studies that are present in the human genome. other organisms have been shown to have different genome-wide dna methylation patterns than human  <cit>  and it will be interesting to test the extent to which the ys effect is present in comparison studies of methylomes across other organisms.

it will be interesting to characterize the extent of the ys effect we report on in analyses applied to 5-hydroxymethylcytosine  data. we have shown here that the sparsity and uneven distribution of cg sites due to deamination biases averaging-based studies of 5hmc that have attempted to determine 5hmc rates in close proximity to exon-intron junctions. an annotation of the dependencies between 5hmc rates and cg site frequency and exploration of the applicability of compare to such settings will be an interesting avenue for further investigation.

the ys effect is present in dna methylation studies due to the process of deamination eliminating data in a manner that is associated with the extent of methylation. the association of the probability of observing data with functional type is present in other types of settings and can confound other genome-wide analyses. for example, in conservation analysis, gaps in alignment are frequently treated as missing data when computing conservation scores  <cit> , but misalignments are less likely to occur at regions of high conservation  <cit>  . therefore, missing data is unevenly distributed across multiple sequence alignments, and ignoring it is likely to lead to biased conservation scores, in which the scores computed at a region with misalignments are an over-estimate of the true conservation tendency. in other settings the appearance of the ys effect may be more subtle and harder to characterize, but may bias comparative studies nonetheless.

to detect instances in which the yule-simpson effect is underlying observed differences across regions we propose conducting randomization tests in which the values of observed data-points are randomized but not the locations at which there is observed or missing data . observing an uneven distribution of the statistic studied across regions following such randomizations is an indication that the ys effect is present in the analyses conducted . we have implemented such a randomization feature within the compare package that can be used for arbitrary datasets. the generalization of compare and paired-region averaging to additional instances within the genomics field will be an interesting direction to explore.

CONCLUSIONS
seemingly straightforward averaging approaches may be heavily biased by an underlying non-uniformity in the distribution of the data. this phenomenon has been identified in the field of statistics as the yule-simpson effect, and we report here on its presence in genome-wide analyses, focusing on dna methylation studies. we present two methods  for bias correction and show that a corrected analysis eliminates previously reported differences in dna methylation across functional boundaries. we conclude that genomic studies in which missing data is naïvely ignored during averaging should be carefully assessed for non-uniformity of the missing data, and we have presented a method for doing so. additionally, the methods we have introduced for correction of the ys effect should be applicable not only to dna methylation studies but to any genome-wide anlayses where averaging is performed.

