BACKGROUND
heritability is an important concept in genetics and provides a quantitative measure for the proportion of trait variation that is attributed to genetic variation. it is used in a variety of fields including psychology, behavioral genetics, and breeding  <cit> . for example, the heritability of cow milk yield is crucial for cattle breeders. the heritability of the desirable trait, either phenotypic or molecular, can then be used to predict the genetic merit of a cow and help design an appropriate breeding program  <cit> . other uses of heritability are relevant to the study of disease. if a pattern of inheritance for a disease in a family has been discovered, it can lead one to hypothesize that one or more molecular traits are in part responsible for the development of the disease  <cit> . heritability analysis may then be applied to evaluate the likelihood of an offspring inheriting the molecular traits and/or the probability of presenting the symptoms of the disease. this usage can be extended to personalized medicine. a large list of traits might be relevant to a disorder, and as a quantitative measure, heritability provides a way to rank the traits and helps to prioritize candidates for further investigation  <cit> .

heritability may be measured for “intermediate” or molecular traits for a physiological or disease state. gene expression has been well studied as an intermediate trait in genomics . the study of expression quantitative trait loci  and heritability of gene expression is relevant for understanding the basis of complex traits  <cit> . however, most of the expression trait methodologies are based on microarray technology and assume the data to be gaussian  <cit> . the rise of high throughput sequencing  technology demands the development of new methods as it produces data that are highly non-gaussian. such technology has several advantages over microarrays and is now favored by most researchers  <cit> . high throughput sequencing studies of rna  result in sequence reads that are mapped to a gene or other genomic feature, and the mapping procedure produces count data for each feature. the mean-variance relationship in the data is usually different from that of a gaussian distribution  <cit> . sun  <cit>  proposed a method based on negative binomial regression to find eqtl in rna-seq data. however, methodologies to estimate heritability scores for such data are lacking. we propose several statistical models and different methods to estimate heritability for high throughput sequencing data based on linear and generalized linear mixed effects models.

in animals and plants, panels of recombinant inbred  strains are an excellent resource for systems genetics studies. ri strains have been used in genetic mapping for over four decades  <cit> . details on the origin and history of ri strains can be found in  <cit> . since ri panels allow replicated samples with nearly homogeneous genetic information per strain under a controlled environment, they have the advantage of reproducible genotypes and the ability to separate genetic variability from environmental variability. therefore, an ri panel with an adequate number of replicates and strains facilitates analysis of complex traits and heritability. in this work, we analyzed microrna  and messenger rna  sequencing data from a large ri mouse panel that have been bred from reciprocal crosses between the inbred long sleep  and inbred short sleep  strains, called the ilsxiss  panel. the original long-sleep and short-sleep lines were selectively bred for a long or short duration of loss of righting reflex due to ethanol   <cit> . although the expression data from the lxs panel motivated this work, the methods described in this paper are applicable to any hts data with biological replicates and properly controlled environmental variation and population structure.

we present four methods for estimating heritability that account for the challenges posed by count and possibly zero-inflated data. since many of these alternatives are non-linear models, standard methods do not apply and we introduce the usage of the variance partition coefficient . we also propose a statistical test for evaluating whether the heritability is greater than zero and a method for defining confidence intervals. simulations and the motivating data including mirna and mrna expression from the lxs panel are used to compare and test the methods. we give recommendations about the performance of the heritability methods under different situations. finally, our methods are provided as an r package heritseq.

methods
definition of heritability
heritability of a genetic or phenotypic  trait is the proportion of total variance  that is attributable to genotypic  variance . the classical approach assumes that the total variance v
p can be partitioned into v
g, the variance attributable to genotypes, and v
e, the remaining variability, which is also known as variance due to environment . in other words, v
p=v
g+v
e. the  heritability, h
2=v
g/v
p, is “the proportion of phenotypic differences due to all sources of genetic variance”  <cit> .

the two most common approaches for estimating heritability differ based on the population and sample being studied. one is based on analysis of correlations and regression, first developed by sewall wright then popularized by ching chun li and jay laurence lush . traditionally, this approach estimates heritability from simple, often balanced designs, and computes the correlation of offspring and parental traits, the correlation of full or half siblings, or the difference in the correlation of monozygotic and dizygotic twin pairs. the second approach is based on the analysis of variance  in breeding studies, using intraclass correlation among relatives and was originally developed by ronald a. fisher  <cit> . given the nature of ri panels, our methods follow the latter approach and focus on estimation of variance components.

heritability for linear mixed models: intra-class correlation
a common approach to estimate heritability is to apply a random effects analysis of variance model and use the intra-class correlation   <cit> . such a model usually involves a fixed intercept, a random effect term to explain the effect of genetic background  and an error term that explains all other non-genetic variation. a simple model can be 
  <dig> y=α+bs+ε,bs∼n <dig> σg <dig> ε∼n <dig> σε <dig>  


where y is the trait, α is the fixed intercept, b
s is the random effect due to strain s and ε is the random error. σg2=var is the variance due to genotype and σε2=var is the error variance.

for the above linear mixed model, the variance components are additive so the total variance can be written as 
  <dig> var=σg2+σε <dig>  


the intra-class correlation for individuals from the same genetic strain can be shown to be the proportion of the total variability explained by the genetic component: 
  <dig> icc=σg2σg2+σε <dig>  


however, such an interpretation is not straightforward for a non-linear model.

heritability for non-linear mixed models: variance partition coefficient 
generalized linear mixed models  are often used when the data are not gaussian. for instance, a count data model such as the negative binomial with a log-link is a common choice for modeling rna-seq data. a glmm version of eq.  <dig> is as follows: 
  <dig> h=α+bs,bs∼n <dig> σg <dig> e=μ,var=f. 


here, the function h is the link function for the glmm and the function f describes the mean variance relationship which depends on the assumed statistical distribution of the phenotype. unfortunately, the additive property of the variance components does not hold for glmms.

goldstein et al.  <cit>  proposed a method to partition the variability in non-linear models. in a multi-level modeling setup, the authors describe a way to separate the variation due to the “higher level”  and any other sources of variability that remains. the variance partition coefficient  is defined as the proportion of variability due to the “higher level” compared to the total variability. for instance, the total variation in y for the model given by eq.  <dig> can be partitioned as 
  <dig> var=var)+e). 


here, the first term is similar to the between-strain-variance and the second term can be considered as average within-strain-variance. the vpc for this model is: 
  <dig> vpc=var)var)+e). 


in the following sections, we propose four different methods for modeling the hts data and derive the vpc in each case following the framework by carrasco et al.  <cit>  and nakagawa and schielzeth  <cit> .

approaches for modeling hts data
we will consider four different methods for estimating heritability from hts data. two of these methods are based on linear mixed models  after transformation of count data while the other two are based on glmms and therefore do not require the count data to be transformed.

data obtained from hts are counts ranging from  <dig> to  <dig> s, and often contain many zero counts for features of interest  in particular samples. however, true zero inflated models were not considered because the example datasets examined here did not reflect explicit zero inflation .

we propose two glmms that can directly use the data without a transformation:  the compound poisson mixed model , which is a special case of the tweedie distribution, and can model data using a continuous distribution with a mass at zero;  the negative binomial mixed model  which is the most popular choice for modeling hts data due to its simplicity and ability to accommodate overdispersion. both cpmm and nbmm allow for overdispersion, and we used a log-link in both cases. below, we describe the lmm, nbmm and cpmm setups and derive the vpc in each case.

linear mixed model 
traditional lmms can be applied to hts data after the data have been properly transformed. a lmm assumes that the errors are normally distributed, and there are various ways to transform sequencing data so that the resulting data are approximately normal. we consider two popular transformations:  voom, in the limma
r package  <cit>  and  a variance stabilizing transformation , in the deseq2
r package  <cit> . both methods account for over-dispersion.

suppose a dataset contains a total of s sample strains and g genes. let y
gsr be the observed number of sequencing read for the gth gene of sample r from strain s. g= <dig> ⋯,g;s= <dig> ⋯,s;r= <dig> ⋯,r
s, where r
s is the number of biological replicates within strain s. denote the corresponding transformed read  as ygsr∗. the lmm can be expressed as the following: 
  <dig> ygsr∗=αg∗+bgs∗+εgsr∗,bgs∗∼n <dig> σg2∗,εgsr∗∼n. 


for a fixed gene g, the intercept αg∗ is shared among all samples, while the random effect bgs∗ is strain specific. furthermore, bgs∗ and εgsr∗ are assumed to be independently distributed. under this model, the vpc for gene g is defined as 
  <dig> vpcglmm=var)var)+e)=σg2∗σg2∗+σεg2∗. 


negative binomial mixed model 
sun  <cit>  showed that modeling the hts data directly using count data models can be more powerful as compared to using linear models on transformed data. also, the interpretation of vpcs as a measure of heritability becomes problematic if it is calculated from the transformed data. the following two aspects of hts data were considered for deciding the choice of model.

it has been repeatedly shown that hts data are overdispersed  <cit> . the negative binomial distribution has been the most popular choice to accommodate overdispersion. methods such as edger  <cit> , bayseq  <cit> , and deseq <dig>  <cit>  use the negative binomial distribution in different ways to model hts data. however, the existing methods using negative binomial model primarily concentrate on the analysis of differential expression rather than heritability and do not use mixed effects models. in other applications, icc for nbmm has been used for reliability measurements  <cit> .

under the nbmm, an observed number of reads aligned to gene g, y
gsr, follows a negative binomial distribution with mean μ
gs and variance μgs+ϕgμgs <dig>  where ϕ
g is the dispersion parameter, shared across strains. the generalized linear model uses a log-link. 
  <dig> log=αg+bgs,bgs∼n <dig> σg <dig>  


similar to the lmm, the intercept α
g is only gene specific and the random effect b
gs depends on both the genes and strains. the corresponding vpc for the gth gene is 
  <dig> vpcgnbmm=var)var)+e) 



  <dig> =varvar+e+eαg+bgs) 



  <dig> =eσg2−1eσg2−1+ϕgeσg2+e−αg−σg2/ <dig>  


the last equality holds since eαg+bgs follows a log-normal distribution and the result is obtained using the mean and variance of that distribution. note that vpcgnbmm is strictly bounded above by eσg2−1eσg2−1+ϕg, its range is therefore not  <cit> , especially if gene g is overdispersed. also it is almost always necessary to take into account different library sizes and possible batch effects for large studies, which results in post normalized data that are no longer integer counts. to use the nbmm the normalized data must be rounded off to the nearest integer.

compound poisson mixed model 
some studies have shown that the negative binomial distribution might not always be the best model for hts data  <cit> . the compound poisson distribution model provides an alternative and has been a popular tool in actuarial science and economy. however, few applications have been implemented in the field of biology and genetics. the compound poisson model belongs to the family of tweedie distributions that covers a relatively larger class of mean-variance relationships  <cit> , and includes models like gamma regression or inverse gaussian regression. it has the advantage of being able to model continuous post-normalized data while still accounting for potential zero inflation.

under the cpmm an observed number of reads aligned to gene g, y
gsr, follows a compound poisson distribution with mean μ
gs and variance ϕgμgspg, for some 1<p
g< <dig>  where p
g is referred to as the tweedie parameter. under the cpmm, with a log-link, the regression on the mean has the same form as the nbmm: 
  <dig> log=αg+bgs,bgs∼n <dig> σg <dig>  


the vpc for gene g can be derived as 
  <dig> vpcgcpmm=var)var)+e) 



  <dig> =varvar+e) 



  <dig> =eσg2−1eσg2−1+ϕgeαg+σg <dig>  


similar to the derivation for vpcgnbmm, the final equality is a consequence of log-normal distribution properties.

testing the presence of heritability
the point estimate of the heritability score can be used to interpret the proportion of variability due to genetics. it is also useful to test whether genetics influence the variance of a specific trait . we propose a test for the null hypothesis that the heritability is  <dig> against the alternative that it is positive.

from the expression of the vpc for each model, clearly the vpc for gene g is  <dig> if and only if σg2= <dig>  conceptually, this is equivalent to the fact that the heritability will be zero if the variance component attributable to genotype is zero. also, the vpc for each model is an increasing function of σg <dig> when all other model parameters remain constant. with indefinite increase of σg <dig>  the vpc converges to its upper bound . we use a likelihood ratio test  to test 
 h0:σg2=0vsh1:σg2> <dig> 


since the null hypothesis lies on the boundary of the parameter space, the lrt statistic will follow a 50: <dig> mixture of χ <dig> and χ <dig> distributions  <cit> , i.e. under h
 <dig>  
 −2log∼ <dig> χ02+ <dig> χ <dig>  


the null can be accepted or rejected at specific levels by comparing the observed test statistic with the corresponding threshold of the mixture of chi-square distributions, and a p-value can also be computed. however, it should be noted that this method of hypothesis testing is not directly related with the point estimate of heritability using vpc. therefore, the most significant features from the test may not be the same as the features with the highest heritability scores .

confidence intervals for heritability
finding confidence intervals for the heritability scores is challenging due to the complexity of the heritability score obtained using glmms and the inter-dependence among the model parameter estimates. therefore, we have proposed a parametric bootstrap approach  <cit>  to obtain the confidence intervals for both cpmm and nbmm approaches. for every fitted model, we bootstrap from the corresponding parametric family and fit the model. the appropriate percentiles of the bootstrap distribution are used as the lower and upper bounds of the confidence interval. we also proposed a third method using lmm-vst where we bootstrap from the model initially fitted using nbmm, but the bootstrapped data are fitted using lmm-vst. the justification of this approach lies in the fact that the variance stabilizing transformation assumes a negative binomial distribution. this method, although approximate in nature, has the advantage of being much faster than the cpmm and nbmm based bootstrap confidence intervals. we selected lmm-vst over lmm-voom due to the fact that the former appeared to be the superior method from each of our simulations .

implementation
several existing r-packages have been used to implement the methods described. packages glmmadmb   <cit>  and lme <dig>   <cit>  were used for fitting nbmms and the package cplm   <cit>  was used for fitting cpmms. the lmm methods were fit using lme <dig> after transforming the data using the packages limma   <cit>  or deseq <dig>   <cit> . we have built an r-package heritseq that integrates all of these methods to estimate heritability, perform hypothesis testing, and provide confidence intervals. the package also includes functions to simulate data from each model.

data
the lxs ri panel reported by  <cit>  originally consisted of  <dig> strains. with a well-controlled environment, the panel allows meaningful estimation of heritability of genetic traits. the mirna and mrna expression datasets used are based on a subset of the panel with multiple mice per strain. a mirna is a small non-coding rna containing about  <dig> nucleotides which promotes degradation or represses translation of target messenger rna . mirnas are well conserved in both plants and animals, and are a vital and evolutionarily ancient component of gene regulation . estimating the heritability of the expression of each mirna or mrna can help reveal which are influenced by genetics.

mirna data: derived from  <cit> , a total of  <dig> mice  were sacrificed and had total rna extracted from whole brain tissues using the rneasy plus universal midi, mini and minielute kits for sequencing . the libraries were prepared using the illumina truseq small rna sample prep kit. fragments between 20– <dig> bp were selected and the libraries were sequenced on the illumina hiseq  <dig> platform. the size selected small rnas were then mapped using a novel k-mer matching method to quantify the number of sequencing reads per individual mirna. following mapping and quantitation, normalization and batch correction were performed .

mrna data: the original mrna dataset includes a total of  <dig> samples  with either saline or ethanol treatment  <cit> . we worked with the saline treated samples that have at least two biological replicates per strain. the resulting mrna dataset contains  <dig> samples . total rna was extracted from whole brain tissue using rneasy mini kits , quantity and quality were determined using a nanodrop spectrophotometer  and agilent  <dig> bioanalyzer . the libraries were prepared using illumina scriptseq rna-seq library preparation kit v <dig>  sequencing was performed on the illumina hiseq  <dig> platform. details on generation of strain-specific genomes can be found in the additional file 1: section  <dig> . each lxs sample was aligned with tophat <dig>  to its strain-specific genome. gene quantification was performed using htseq  to obtain rna fragment counts over each annotated gene. the dataset was normalized without any batch correction, since there was no noticeable batch effect.

both mirna and mrna features were filtered to eliminate those with small counts on most samples. for mirna we required at least  <dig> samples to have at least  <dig> counts; for mrna we required at least  <dig> samples to have at least  <dig> counts. we chose  <dig> to be the number of minimum samples because the data from parental strains were also obtained, and each parental strain had at least  <dig> samples. as for the mrna data, only lxs samples were available to us; each strain had at least  <dig> samples. after filtering, the lxs mirna and mrna datasets have  <dig> and  <dig> features, respectively. we then adjusted read counts for effective library size using the r-package deseq <dig> 

simulations
to compare the performance of the four methods: nbmm, cpmm, lmm-vst, lmm-voom, we created five types of simulations . the first type  explores the behavior of each approach for every combination of model parameters. the goal is to investigate if certain combinations of parameters result in more precise estimates of heritability. the second type  generates a more realistic full dataset where each feature is based on a distinct combination of model parameters. this simulation checks how the heritability methods compare across many features that are based on independent and unrestricted combinations of parameters. the third type  is based on the model parameter combinations observed when modeling the preprocessed lxs ri mirna dataset. the simulated datasets in this case reflect the properties of the lxs ri mirna dataset, including potential dependence among the features. the last two simulations compare the four methods through hypothesis testing for the presence of heritability. the fourth type  used to investigate the type-i error and power and the fifth type  compares the confidence intervals using bootstrap. table  <dig> provides an overview of the simulation setups. for each simulation, we generated datasets either under nbmm or cpmm to examine the performance under model misspecification. to distinguish the data generating model and the fitting model, for the rest of the paper we will use nb-sim and cp-sim explicitly for data generation; nb-fit and cp-fit will be used to denote fitting methods being compared. the methods lmm-vst and lmm-voom will be simply referred to as vst and voom.
σ
2
the parameters  and  are for nb-sim and cp-sim, respectively; σ
 <dig> denotes the random effect variance in either model. the last column shows the number of features , strains , and biological replicates  in each simulation. under each scenario, we simulated data using both nb-sim and cp-sim models. simulation ii and iii include  <dig> replicated synthetic datasets for each case




simulation i: evaluate influence of different parameter combinations
we generated datasets from different sets of model parameters to see how the four methods perform under different situations. the true distribution was assumed to be either negative binomial or compound poisson. for each scenario, we fixed the parameters for negative binomial or compound poisson distribution, i.e. we had the same α
g and ϕ
g  for each g, but varied σg <dig> to generate different heritability scores for different features. for each scenario, we simulated  <dig> features. for each feature, we simulated data for  <dig> samples . we computed the true vpc for each feature and compared these to the estimated vpcs from the proposed methods. while using the vst or voom transformations, we treated the  <dig> features as one dataset. the parameters specific to the nb or cp distributions were chosen from the range of the estimated parameters when the models are fitted to the lxs-mirna data. the σg <dig> values were simulated from a u distribution where σmax <dig> was chosen to be either  <dig> or  <dig> 

simulation ii:
in a second set of simulations we sought to examine the behavior of the proposed methods in a more realistic setting where an entire dataset of features with a wide variety of parameter combinations were simultaneously analyzed. one of the main reasons this simulation paradigm was investigated was the fact that both of the transform methods  rely on the entire dataset in their underlying algorithms, so we sought to give them an opportunity that would better replicate the scenario they were designed for. this was done under both the nb-sim and cp-sim models where each feature had a random set of parameters drawn from an appropriate distribution .

the dataset generating functions also allow for some proportion of features to be simulated from a null model that has a heritability that is identically equal to  <dig> . a final option was the specification of a proportion of features that have a high heritability. this is achieved in general by forcing a small dispersion value ϕ
g and a larger random effect variance σg <dig> 

using this algorithm, we generated  <dig> datasets each under  <dig> combinations of the data generating model and number of strains s. in all datasets the number of features g was set at  <dig>  and the number of replicates r
s was fixed at  <dig>  for both nb-sim and cp-sim data we examined two values for the number of strains s,  <dig> and  <dig>  in each of the  <dig> simulated datasets, 10% of the features were simulated with  <dig> heritability and 10% of the features were simulated with high heritability. the remaining 80% were simulated with independent draws of the model parameters . all four of the proposed methods for assessing heritability were fit on each dataset.

simulation iii: lxs mirna dataset based
datasets generated in simulation iii mimic the lxs mirna data described in “data” section. the model parameters are obtained from fitting glmms to the preprocessed lxs mirna dataset. details on preprocessing this dataset are discussed in additional file 1: section  <dig> . we simulated a new dataset based on the estimated parameters from the regressions under nb-sim and cp-sim. both retain the same mean-variance relationships as the processed dataset additional file 1: figure s <dig>  simulating based on real data also retains the dependencies among parameters. each generated data matrix has the same number of samples per strain  and the same number of genes  as the original lxs mirna dataset. the simulation procedure was repeated  <dig> times with different random seeds.

simulation iv: power and type-i error of the hypothesis test
we performed a set of simulations to compare the power and type-i error of the four methods for hypothesis testing. the true distribution was assumed to be either nb or cp. datasets with  <dig> features,  <dig> strains and  <dig> samples per strain were simulated. for each feature, the parameters of the nb  distribution were selected at random with replacement from the sets of parameters estimated from the lxs data . a fixed value of σg <dig> was used for each dataset. we considered six such fixed values:  <dig> ,  <dig> , <dig> , <dig> , <dig> , and  <dig>  the goal was to investigate how the power of the tests increase as the strain specific variance component increases. the tests were performed at 5% level, and the type-i error and power of the tests were recorded.

simulation v: confidence intervals
in this final set of simulations, we investigated the coverage of our proposed interval estimation methods. the goal of this simulation was to study the coverage of the confidence intervals for low , medium  and high  heritability features. using nb-sim, we simulated  <dig> features for each of the three levels of heritability and computed the proportion of cases where the true heritability is covered by the estimated confidence interval using the nb-fit, cp-fit, and vst methods. the analysis is repeated using data generated from the cp-sim model.

RESULTS
in this section we compare the vpc computed via the four methods: nb, cp, vst, and voom. the performance of each method in the simulations is evaluated by comparison to the true vpc values. for the real data implementation, we show the pairwise comparisons between the top methods, as well as the estimated score distributions.

simulation i: evaluate influence of different parameter combinations
from the simulation results, we observed that the performance of the method is largely driven by the amount of overdispersion ϕ and the strength of strain-specific variance σg <dig> . when data were generated from the same model that estimates the heritability, precision is maximized. the range of the rmse is  for nb-fit and  for cp-fit in such cases. under model misspecification , the performance of nb-fit suffers when the amount of over-dispersion  is large and p is small. while with nb-sim generated data, cp-fit usually suffers when the strain specific variance σg <dig> is large. the vst approach appears to be quite robust against the choice of the true distribution, but it is usually less accurate than the model that is used to generate the data. vst has the second best performance in 72% of the cases under nb-sim and in 58% of the cases under cp-sim. it has low rmse for nb-sim data  and is highly correlated with nb-fit for cp-sim data . the performance of voom is not satisfactory , especially when the data comes from a highly over-dispersed negative binomial distribution. additional file 1: figures s <dig> and s <dig> show the comparison of different methods for the two true distributions under high and low dispersion situations. it is evident that when the true distribution is cp, nb-fit may under-estimate the heritability. on the other hand, when the true distribution is nb, cp-fit may result in over-estimation of the heritability.
fig.  <dig> comparison of heritability precision for different combinations of true model parameters. . heatmap of root mean square error  corresponding to the four methods for estimating vpc. the data are generated from a nb-sim b cp-sim. the parameter combinations for the simulation are shown by the sidebars, the darker the color in the sidebar, the higher the value of the parameter. in the heat map, red indicates better performance  compared to green





we used a relatively larger number of samples per strain  for this simulation set up since we wanted to investigate how the methods perform in a relatively ideal situation. however, we also carried out the simulations for  <dig> samples per strain and the results were similar .

simulation ii: more realistic sequencing data
when looking at the results based on the entire simulated datasets, we again see the pattern of nb-fit, cp-fit, and vst methods generally agreeing with each other and the true values, while the voom transform struggles to recover the true heritability regardless of whether the data were generated using nb-sim or cp-sim . we found that the nb-fit estimates clearly perform best with both the smallest average bias across all  <dig> simulated datasets  and rmse. the next best performing method was the vst with an average bias of  <dig> , followed by the cp-fit with an average bias of  <dig> . as in simulation i, the voom transform performed the worst of the methods examined here with an average bias of  <dig> . when looking for patterns in the bias for each method we see no systematic trend when using the nb-fit with nb-sim data, but the cp-fit appears to almost always overestimate the vpc on such data. the vst shows underestimation for smaller values of the true vpc while then switching to overestimating in the larger values. the voom transform also tends to strictly overestimate the vpc throughout the range of true values, and also tends to give larger values to the features that were simulated with a vpc of  <dig> . in terms of classifying features as heritable or not, the auc from creating roc curves based on vpc threshold of  <dig>  was strong for all  <dig> methods. the best performer was again the nb-fit with an auc of  <dig>  while the cp-fit had the lowest auc of  <dig> . this general behavior for all the methods was repeated in each of the  <dig> simulations using the nb-sim data with s= <dig>  as well as when s= <dig> . adding in the additional strains in the  <dig> simulations with s= <dig> did not qualitatively alter the performance of the methods in terms of average bias or rmse from what was observed in the simulations with s= <dig> 
fig.  <dig> bias comparisons for the four methods for a single nb-sim dataset with  <dig> features,  <dig> strains, and  <dig> replicates per strain. bias is measured as estimated vpc − true vpc




when using cp-sim data with s= <dig>  we saw that the ordering of the methods in terms of average bias and rmse changed similarly to what was observed in simulation i in that now cp-fit performs the best in terms for average bias and rmse, followed by vst, nb-fit, and then voom . the same pattern held for auc analysis using a  <dig>  heritability threshold. the only major difference from the nb-sim results is that now all of the methods tended to underestimate the vpc on cp-sim data, and no method could match the average bias or rmse from the nb-fit on nb-sim data. as was observed with the nb-sim datasets, the average bias, rmse, and auc estimates for all methods were virtually identical when both s= <dig> was used .

simulation iii: lxs dataset based
although the different preprocessing procedures  have limited effect on the vpc estimation, the results do depend on which glmm was used to generate the dataset. similar to previous simulations, nb-fit, cp-fit and vst show good performance while the voom approach is worst at estimating heritability. therefore, we omit the results from voom and focus only on nb-fit, cp-fit and vst from now on. the method that matches the true underlying model is best at distinguishing heritable features as defined by having a vpc> <dig>  . under model mis-specification, nb-fit  appears to be more robust than cp-fit , while vst shows fairly robust result for both sets of simulated data .
fig.  <dig> accuracy comparisons for simulation iii. rmse for nb-fit , cp-fit , and vst  across  <dig> simulated dataset generated based on either a nb-sim or b cp-sim. the true positives are defined as mirnas with true vpc greater than  <dig> 




simulation iv: power and type-i error of the hypothesis test
when the data were simulated from cp-sim, power for the cp-fit and nb-fit methods were very close . for the nb-sim data, cp-fit method had higher power, but it also had inflated type-i error . the cp-fit method can over-estimate heritability when the data are generated from nb-sim. the vst method appeared to be conservative and hence less powerful in both cases. the voom method had low power for detecting smaller departures from null, but was quite good for large departures .
method/ σg2
the value in a cell denotes the value of the power function  for each case. the value of σg <dig> drives the power. the case σg2= <dig> reflects the null hypothesis, therefore corresponding the cell value is the type-i error. columns with σg2> <dig> indicates the power for increasing strain specific variance




simulation v: confidence interval
the results of the confidence interval simulation  indicate that the confidence interval coverages of all the methods are slightly below the target 95% for nb-sim data. the cp-fit based method has higher coverage compared to nb-sim for all true heritability levels. for cp-sim data, the coverage of all three methods are similar for low heritability, the percentage coverage being slightly smaller than 95%. however, the coverage percentage becomes lower for nb-fit and vst based methods as the true heritability score increases. the coverage of cp-fit stays at the same level. the coverages of nb-fit and vst are significantly less than 95% for high heritability when data are generated from cp-sim. the coverage of vst is the highest for low heritability, but not satisfactory for higher heritability under cp-sim.
coverage percentage is shown at each level of true heritability score for data generated from nb-sim and cp-sim. trues vpcs  <dig> ,  <dig>  and  <dig>  were considered as representatives for low, medium and high heritability. the values in parentheses show the average lengths of the intervals for the different cases.  <dig> bootstraps are used in each case




the average lengths of the confidence intervals are very similar across methods, approximately  <dig>  for low and medium heritability, and approximately  <dig>  for high heritability. we have also observed that in most the cases where the confidence interval does not cover the true heritability, the interval underestimates . the proportions of underestimation among all non-coverages for nb-fit based method are 75%  and 97% . the same percentages are 80% and 97% for vst, and 69% and 78% for cp-fit .

application to the lxs ri mirna dataset
for the real data application, we observed similar result as in the simulations. the nb-fit, cp-fit, and vst methods produce highly correlated heritability estimates . the locally weighted scatterplot smoothing  fits  are roughly linear. the overall vpc distributions are very similar among the methods. the result for voom is omitted here due to poor performance. since vst is a negative binomial based transformation, it is not surprising that the results from nb-fit and vst are highly consistent , as was observed in the simulations. the cp-fit estimators are also highly correlated with nb-fit results . the overall distribution of heritability estimates have similar shape for nb-fit, cp-fit, and vst; they are all right-skewed. however, the range of estimates differs slightly between methods due to theoretical ranges .
fig.  <dig> heritability comparison across estimation methods for the lxs mirna preprocessed dataset. the histograms with rug  and kernel density plots are shown along the diagonal. the panels below the diagonal show the scatter plots and the loess fits for the pairwise comparisons. the corresponding correlation values are listed above the diagonal





we also tested the presence of heritability using each method and looked at the distribution of the corresponding p-values . the p-value distributions are more similar between the two glmm  and between the two lmm . this is a consequence of modeling based on the original data versus the transformed data and is consistent with the power comparison results. at false discovery rate  level  <dig> , the four methods nb-fit, cp-fit, vst, and voom respectively report  <dig> ,  <dig> ,  <dig> ,  <dig>  mirna features with evidence of heritability . although the heritability estimation and the hypothesis testing use two different statistics and are not expected to have matching results, the rank correlations between p-value and heritability estimate within a method are very high except for voom, which indicates that for the other three methods the score estimation and testing substantially agree with each other .

in addition, we conducted the analysis for cpmm preprocessed data and the comparison of heritability estimates across methods are similar . regardless of the preprocessing methods, the top heritable features identified coincide . some of the mirnas present a continuous spectrum of reads while others exhibit bimodal read distributions . the feature mmu-mir-446q has a high heritability score without the bimodal trend . such sequencing read distribution were also observed for several other features, suggesting that those corresponding mirnas are likely to have an eqtl.
the second and fourth columns are the vpc scores for the datasets processed and fit under nbmm  and processed and fit under cpmm , respectively. the corresponding p-values for testing the presence of heritability are listed in the adjacent columns. the features are sorted by their heritability estimates using the nb-fit method




from a separate eqtl study on the same data using cpmm model , we found that all of the top  <dig> heritable mirnas had an eqtl when tested at fdr = <dig> . while there were several moderately heritable mirna features which did not have an eqtl, the results show that the highest heritability estimates were observed in cases where a single nucleotide polymorphism  is strongly associated with the mirna expression. however, there were several mirnas with high heritability score, but no eqtl at the above threshold. this shows the utility of the heritability analysis to find features with high genetic variation that eqtl analysis alone cannot detect, one possible reason being the weak association of mirna expression with multiple snps.

application to the lxs ri mrna dataset
as with the mirna data, nb-fit, cp-fit, and vst show highly consistent results for the lxs mrna data . there are a few features that exhibit zero vpc scores under the cp method while displaying small heritability under other models. this is an artifact caused by the optimization algorithm for regression fitting. it does not affect the identification of moderately or highly heritable features. similar to the mirna dataset, the overall distribution of estimated heritability scores have nearly identical shape for nb-fit, cp-fit, and vst. they are all right-skewed and peak near  <dig>  the distributions are much more narrow compared to the mirna data. the range of the estimated heritabilities differs between methods, but not as much as with the mirna. this could be due to the fact that the mrna dataset includes  <dig> features while the mirna data only have  <dig> features. at fdr level  <dig> , the number of features with significant presence of heritability are  <dig> ,  <dig> ,  <dig> , and  <dig>  for methods nb-fit, cp-fit, vst, voom, respectively.
fig.  <dig> heritability comparison for the lxs mrna dataset. the histograms and kernel density plots are shown along the diagonal. the panels below the diagonal show the scatter plots and the loess fits for the pairwise comparisons. the corresponding correlation values are listed above the diagonal





based on nb-fit, heritability estimate of  <dig> genes exceeds  <dig>  threshold . two of them show continuous read distribution trend, while the others are bimodal . we also examined the top  <dig> heritable features using either nb-fit, cp-fit, or vst models and found  <dig> genes that appear across the list: a830036e02rik, ccl <dig>  d030028a08rik, exoc <dig>  gm <dig>  gm <dig>  krt <dig>  like gene a830036e02rik , all of them have bimodal sequencing read distributions. the read distributions, their corresponding heritability estimates and p-values are reported in the additional file 1: table s <dig> and figure s <dig> 
fig.  <dig> sequencing read examples for a a top heritable mirna and b a top heritable mrna features. each boxplot summarizes the reads for one strain and they are sorted by strain mean in an increasing order. the color of the boxes have no special significance. the estimated vpc scores are reported in the top left tables




discussion
heritability is an important concept in evolutionary biology and relevant for breeding in agriculture and animal studies. it can be useful to gain insight on the genetic basis of individual traits  <cit>  and is therefore a critical concept in the prediction of disease risk in medicine  <cit> . when the traits of interest are gene expression, a related analysis is the detection of eqtls. the top heritable results we report have a bimodal pattern, which is likely a result of a single strong eqtl. despite this overlap, heritability and eqtl analysis also give complementary information. we found that other highly heritable mirna features did not show a bimodal pattern, and may be a result of associations from multiple loci more difficult to detect in eqtl analysis  <cit> .

while we did observe this bimodal distribution in many of the features with the highest heritability measures, we do not believe that it necessitates the use of a zero-inflated model. for a given mirna or mrna that showed this bimodal distribution of counts, virtually all of the small or zero counts were observed in samples from strains that had means close to zero. the zero counts were not equally distributed across all of the strains, and thus we found that the strain-specific means estimated using the random effects within the glmms  were able to capture the observed behavior.

a crucial element for proper heritability estimation is the use of a genetically well characterized population. we take advantage of ri panels maintained in controlled environments. the generalized linear models discussed here may be used for other types of experiments that are not based on ri panels, but with modifications. even though mixed effects models may be appropriate for repeatedly measured data such as longitudinal data, the variance partition coefficient may not always be suitable as a measure of heritability. the user should be careful about the difference between heritability and repeatability where the latter measures the relatedness of the repeated observations  <cit> . however, for a recombinant inbred panel, the only common factor among the strains are their genetic background. animals from the same strain will have a shared environment in a well designed animal study. thus, the proportion of strain specific variation can accurately measure the heritability. if our methods are to be used for other types of populations, one should make sure that there is no other common factor other than the genetic factor among the subjects within a class.

among the four methods proposed in this work, the nb-fit, cp-fit and vst methods perform similarly and all of them have very high accuracy. however, voom failed to perform well in many cases and appears to be useful only in limited situations. voom’s performance is especially limited when the data are overdispersed and not highly heritable. cp-fit and nb-fit are most accurate when the data are generated from the respective distributions. the estimation performance of nb-fit is slightly better than cp-fit under model-misspecification. the estimation using vst is the most robust against model-misspecification and it performs the second best in most cases.

the hypothesis testing procedure using cp-fit may have anti-conservative results when the data are nb-sim. the test using nb-fit is slightly conservative, but sufficiently powerful under model-misspecification. tests using vst are the most conservative and hence the least powerful. the cp-fit based bootstrap confidence interval performs the best among the three different methods considered. all the confidence intervals have a tendency to underestimate the true heritability, but the cp-fit based method seem to be the least biased and have coverage closest to the target 95%. these bootstrap based confidence intervals are computationally expensive and one may choose to use them only for a limited number of interesting features. in terms of computational cost , cp-fit is faster than nb-fit, and the lmm methods  are much faster than both cp-fit and nb-fit. for the lxs mirna dataset with hypothesis testing, the cpu time required was  <dig> ,  <dig> ,  <dig> ,  <dig>  for nb-fit, cp-fit, vst, and voom, respectively .

each method has additional considerations as well. one limitation of the nb-fit based heritability score is that it needs to be interpreted with caution because the maximum possible heritability score is less than  <dig> for over-dispersed data. this is a direct consequence of the algebraic expression of vpcgnbmm. for the same reason, the heritability score for a feature may have a smaller value when using nb-fit as compared to cp-fit. although cp-fit does not show any significant increase in accuracy to estimate the heritability for data similar to our count data, it might be appropriate for other types of post-normalized data with many zeros or heavy tails . we showed vst is robust and in many cases sufficiently accurate while voom results can be misleading. both methods fit the model on a completely different scale due to data transformation which makes the interpretation of the heritability score more problematic than the nb and cp methods.

in summary, we suggest to use vst, nb-fit, cp-fit, and compare the results. the three methods have different strengths. computationally, vst is the most efficient and robust; the nb-fit method performs well in hypothesis testing even under model mis-specification; the cp-fit based confidence intervals are the most reliable. the choice of one method out of the three should depend on the goal of analysis.

CONCLUSIONS
in this work, we have proposed several statistical models and methods for estimating and testing heritability for high-throughput sequencing data and have provided an r package heritseq implementing our methods. although mixed effects models have been used in the context of repeatability  <cit> , we studied the rather unexplored area of calculating heritability for non-gaussian or count based data. our work reports the use of the variance partition coefficient to extend the definition of heritability for generalized linear mixed models in the context of sequencing data. the variance partition coefficient is conceptually different from traditional measures such as intraclass coefficient and is more suitable for measuring heritability in this context. we have proposed the use of the cp mixed model which has not been previously used for genomic data. through simulations and two sets of sequencing data from an ri panel, we demonstrate that nb-fit, cp-fit, and vst are better methods for estimating heritability than the voom method. for a mirna and mrna expression dataset, we identified heritable features and found that many of the highly heritable features exhibit bi-modal sequencing counts, which are likely expression quantitative trait loci. in summary, the ability to better model high throughput sequencing data and estimate the heritability scores will elucidate the functional mechanisms in genetic networks.

additional file

additional file  <dig> supplementary materials. 

 


abbreviations
anovaanalysis of variance

cp-fitcompound poisson mixed model fit

cp-simexpression data simulated under compound poisson mixed models

cpmmcompound poisson mixed model

eqtlexpression of quantitative trait loci

htshigh-throughput sequencing

iccintra-class correlation

ilsinbred long sleep

issinbred short sleep

glmmgeneralized linear mixed model

lmmlinear mixed model

lxsrecombinant inbred of long-sleep and short-sleep mice

mirnamicrorna

mrnamessenger rna

nb-fitnegative binomial mixed model fit

nb-simexpression data simulated under negative binomial mixed models

nbmmnegative binomial mixed model

rirecombinant inbred

rna-seqhigh-throughput sequencing studies of rna

vpcvariance partition coefficient

vstvariance stabilizing transformation

