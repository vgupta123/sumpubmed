BACKGROUND
the aim of computational biology is to obtain a better quantitative understanding of biological systems and the principles upon which evolution has constrained cellular networks. building on such knowledge, networks can be designed that yield certain optimal responses in both natural and synthetically constructed organisms. however, despite the wealth of experimental techniques and data available, biological parameters can only be estimated relative to standard values, if they can be calculated at all. this has increasingly led to the development of optimisation techniques that aim to find the most accurate or probable set of parameters that describe a particular set of data . here, we will focus on one instance where this is a particularly pertinent problem - namely the rates at which a light-regulated protein  is able to switch between different conformational states.

one such family of photoreceptors is the phytochromes. phytochromes have been found throughout the cyanobacterial and land plant kingdoms  <cit> . each of these proteins respond to light through a similar chromophore-based mechanism  <cit> . upon illumination of red light, a conformational change in the chromophore leads to the activation of phytochromes  to regulate downstream networks  <cit> . this process can be reversed, leading to increased populations of inactive phytochrome , by illumination with a second light source of a different wavelength or leaving the protein in the dark, where thermal reactions control the conformational change  . the wavelength of light required for phytochrome inactivation changes between phytochrome species, with plant phytochromes requiring far-red light whilst bacterial and algal phytochromes can be inactivated by wavelengths across the visible light spectrum  <cit> . the transition rates between conformers is related to the photoconversion cross-sections of the photoreceptor and the light conditions that the photoreceptor is exposed to   <cit> . photoconversion cross-sections are, essentially, the ability of a molecule to absorb a photon of a given wavelength resulting in a conformational change  <cit> . a range of spectroscopic techniques have been used to observe these state changes . for phytochromes, absorption spectra show a relatively large spectral overlap implying the presence of mixed populations of p
a, p
i and, in some cases, intermediate conformations , co-existing within the protein sample. by using absorption spectra, one can not only observe levels of p
a or p
i within a phytochrome sample, but the level of absorbance can be related to sample concentration, molecular weight and extinction coefficient  <cit> . the extinction coefficient is defined as the ratio between the photoconversion cross-section of a phytochrome species and its quantum yield, where the quantum yield is the ratio of absorbed photons that lead to a molecular change with the total number of photons that are absorbed  <cit> .

therefore, photoconversion cross-sections can be inferred directly from absorption spectra if some other parameters are known. this is the case often described by butler’s model  <cit> . however, to accurately estimate the photoconversion cross-section and quantum yield of one phytochrome conformational state using this model, an experimental configuration is needed whereby 100% of the population is in a single state. for many phytochromes, no experimental condition can achieve such requirements due to overlapping absorption spectra that are indicative of mixed populations  <cit> . previous studies of plant phytochromes from avena sativa have estimated the photoconversion cross-sections and quantum yields by assuming specific percentages of p
a within the phytochrome population under different conditions , allowing butler’s model to be solved  <cit> . we shall refer to these estimates as the ‘mancinelli spectra’ and ‘mancinelli quantum yields’ following the review by alberto mancinelli  <cit> .

building on butler’s model, the verméglio group has proposed an analytical method to determine the photoconversion cross-sections of phytochrome proteins and the ratio of the quantum yields between the p
a and p
i states within a mixed population  <cit> . by using absorption spectra obtained as a result of three different illumination conditions, one can calculate the photoconversion cross-sections by solving a system of linear equations  <cit> . quantum yields need to be calculated using other methods. however, these analytical equations do not take into account any effects of thermal reversion which, under certain conditions, can play a significant role in the reactions governing phytochrome transitions  <cit> . another set of methods have also recently been developed that can estimate the number of subpopulations within a proteins reaction cycle . as a result these methods have enabled comparisons of quantum yields between a phytochrome subfamily but does not provide any information about photoconversion cross-sections or transition rates  <cit> . thus, neither of these approaches provide the same level of information obtained from the ‘mancinelli spectra’ that allows researchers to calculate, for any wavelength of light, how the phytochrome populations switch between different states.

an example of a phytochrome protein, whose dynamics have been studied both within its natural context and in optogenetic tools, is phytochrome b  from arabidopsis thaliana . generally, phyb works as follows regardless of host cell. once synthesised in the cytosol, phyb covalently binds tetrapyrrole chromophores  in plants, cyanobacterial phycocyanobilin  in cyanobacteria and synthetic systems) to form a holoprotein  <cit> . as with other phytochromes, phyb is activated by red light and inactivated by thermal reversion and/or exposure to far-red light. upon activation, phyb is able to interact with other proteins, translocate into the nucleus and control downstream processes  <cit> . these downstream processes include transcription  <cit> , protein degradation  <cit>  and protein sequestration, potentially through the formation of nuclear bodies  <cit> . in plants, the interactions of phyb eventually lead to the suppression of seedling elongation and inhibition of the vegetative to flowering transition  <cit> .

so far in optogenetics, the truncated n-terminal version of phyb  has been used  <cit> . importantly, phyb-n has been shown to be the most stable construct that still exhibits the correct responses and dynamics to light signals compared to the full-length variant  <cit>  whilst thermal relaxation of phyb-n is slower in vitro than full-length phyb in vivo  <cit> . futhermore, compared to the activity of full-length phyb in planta, which has been shown to act as a dimer, phyb-n in synthetic systems is believed to function as a monomer  <cit> . formation of phyb dimers in plants means that the networks regulating downstream activity are different between natural and orthogonal synthetic systems  <cit> . through an increasing number of systems biology studies, the networks and kinetic rates describing phyb’s role in controlling plant development have been estimated and verified  <cit> . since these studies have dealt with the full-length phyb protein, they have assumed that the ‘mancinelli spectra’ are the correct photoconversion cross-sections that determine phyb conformational changes. despite the ‘mancinelli spectra’ being calculated using full-length plant phya, this approximation is justified since plant phya and phyb molecules respond to light in a similar manner. however, as a wider range of phytochromes and their structural variants are being studied for their photophysical properties and dynamics in natural and optogenetic systems, there is a real need to accurately estimate these photoconversion cross-sections and the rates at which phytochromes switch between conformational states and how efficient these processes are. with such knowledge, one could potentially look to compare and optimise the transition rates of photoreceptors for use in optogenetic networks via protein engineering.

here, we build on the analytical methods proposed by the verméglio group to include further phytochrome reactions, such as thermal reversion and dimerisation, to obtain upper limits for the quantum yield ratio and search spaces for the photoconversion cross-sections. using this information, we then propose an optimisation algorithm that reliably estimates the photoconversion cross-sections and quantum yields of any photoreceptor. the generality of our approach is highlighted by simulating different members of the phytochrome family - including a red/green cyanobacteriochrome and a red/far-red plant phytochrome. first, our output is compared to those obtained by butler’s model, showing that our algorithm can find the correct set of photoconversion cross-sections and quantum yields when butler’s model fails. subsequently we show, for the red/far-red photoreceptor reminiscent of full-length phytochromes found in plants, that our algorithm can find the correct photoconversion cross-sections and quantum yields even in the presence of multiple thermal reversion reactions. furthermore, the results are insensitive to noise. finally, our method is applied to the phyb-n protein used in optogenetics and provides the photoconversion cross-sections for this protein for the first time in vitro. given adequate data, we propose that this procedure can be adopted for any photoreceptor protein and will be of use to those wishing to obtain quantitative understanding of light-regulated processes in natural and synthetic biological systems or comparisons of phytochrome family members and structural variants.

methods
methodology overview
below, the details of our methodology that infers the photoconversion cross-sections and quantum yields of photoreceptor proteins are described. in fig.  <dig>  an overview of the steps is presented.
fig.  <dig> an overview of the method. to obtain photoreceptor photoconversion cross-sections and quantum yields, four computational steps are required once the appropriate data has been obtained . first, the parameters for thermal reversion - the rate of reversion and the percentage of the photoreceptor population that experiences this rate - need to be found . given these values, an analytical method is then used to find the search spaces for our optimisation algorithm . once the parameters and search spaces have been obtained, the values can be found using our optimisation algorithm . finally, the optimal values can be verified by comparing simulations to the rest of our available data 




in order for the method to work, absorption spectra need to be obtained from different experimental conditions. importantly, this data needs to illustrate the switching from active to inactive states of the photoreceptor and vice versa. for a photoreceptor that responds to a single region of the light spectrum  spectra need to be obtained from two experiments: under constant darkness after the photoreceptor population has been completely activated by light, and under prolonged periods of activating light after complete inactivation in darkness . for phytochromes, that respond to two regions of the light spectrum , data would need to be obtained after initial illumination of red light followed by constant treatment with inactivating light conditions or darkness and vice versa, recording the activation of phytochromes in red light after initial exposure to inactivating light.

ultimately, we aim to simulate absorption spectra, a
s, that match experimental data, a
e. simulated absorption spectra are represented by 
  <dig> as= <dig> lctot∑k=1nckσkλΦk,∑k=1nck=nc, 


where a
s is the simulated absorption at wavelength λ given a set of tuples describing the preparatory, Ωp={}, and experimental, Ωe={}, light conditions. here, the light conditions are described by the time of exposure, t
p and t
e, in s and the spectral and intensity composition of the light source, zpλ and zeλ, in μmol m − <dig> s − <dig>  the terms c
k are time-dependent changes in the fraction of available chromophore, n
c, within the photoreceptor monomer or dimer structure that is in state k. the parameters σ={σ1λ,…,σkλ,…,σnλ} is the set of wavelength-dependent photoconversion cross-sections  of a sample population switching between states p
i and p
a, and the Φ={Φ
 <dig> …,Φ
k,…,Φ
n} is the set of associated quantum yields of the light-dependent reactions. furthermore, the c
k’s depend on the parameters related to thermal reversion, where α={α
 <dig> …,α
n} is the percentage of the active photoreceptor  population that undergoes a thermal reversion rate of β={β
 <dig> …,β
n}, where n is the number of p
a species in the population , and the preparatory/experimental light conditions . in section  <dig>  of additional file  <dig>  we show the general forms for c
k used in our study and how this function is altered between different cases.

the total concentration of photoreceptor in our sample, c
tot, is defined in mol/l, the term  <dig>  is required to relate absorption to measured light fluences and l is the light path length through the sample-containing cuvette in cm  <cit> . for our study, we have a cuvette containing ctot= <dig> mg/ml70000da sample that is  <dig> cm thick and so, due to light path corrections, we use l= <dig>  cm as in  <cit> .

the proposed methodology performs three steps: 
the parameters for thermal reversion kinetics are found, such as the rate of reversion, β, and the percentage of the population, α, that undergoes reversion at this rate . importantly, these parameters play a role in determining c
k.

appropriate search spaces for the extinction coefficients, εkλ=σkλ/Φk, and the upper bound of the quantum yield ratio, r
max, are found numerically, given the thermal reversion parameters, α and β .

photoconversion cross-sections, σkλ, and quantum yields, Φ
k, are obtained by comparing simulations described by eq.  to measured time-dependent absorption spectra .




the resulting photoconversion cross-sections and quantum yield values should then be validated against known data. in our examples, we use either the known values  or our available datasets . this section will present the details of each step of the approach and the elucidation of photoconversion cross-sections and quantum yields. in the results section, we will show the output from a series of test cases before using data obtained for phyb-n.

step 1: determination of thermal reversion rates
in order to determine the thermal reversion rates of a photoreceptor, data needs to be obtained that details the inactivation of the photoreceptor. to do this, the sample must be placed in constant darkness after a saturating period of activating light . the percentage decrease of active photoreceptor can then be obtained from 
  <dig> etd=aeλtλa,zλaλ,{}−aeλtλa,zλaλ,{}aeλtλa,zλaλ,{}−aeλ|tλa,zλaλ,{}, 


where ae},{}) is the experimental data obtained at wavelength λ after period t
d under darkness d when the system has been prepared using illumination by zλaλ light for duration tλa. here, 
 aλ|tλa,zλaλ,{}=aλ|tλa,zλaλ,{},aλ|tλa,zλaλ,{}=limt→∞aλ|tλa,zλaλ,{}. 


throughout we shall use limt→∞f=f. from eqs.  and  we can simulate thermal reversion by 
 atd=asλtλa,zλaλ,{}−asλtλa,zλaλ,{}asλtλa,zλaλ,{}−asλ|tλa,zλaλ,{},=c{td,d}a−c{td→∞,d}ac{ <dig> d}a−c{td→∞,d}a,  where c{td,d}a=ca},{}) is simplified notation describing the fraction of active photoreceptor, p
a, within the molecule population  set c{td,d}i=nc−c{td,d}a, the fraction of inactive photoreceptor, p
i). using equation  in section  <dig>  of additional file  <dig>  we get 
  <dig> atd=∑j=1nαje−βjtdwith∑j=1nαj= <dig>  


where n is the number of exponentials required to describe the decay of p
a. using , we obtain estimates for α
j and β
j . recall from  that the functions c
k depend on the preparatory light input Ω
p. consequently, the rates of thermal reversion will change depending on the starting fraction of p
a in the system. importantly, under darkness, eq.  shows that the percentage decrease of active photoreceptor is independent of the measured wavelength, λ, used for the analysis since etd is not a function of λ. this can be seen in additional file 1: figure s <dig> 

step 2: finding search spaces for the transition rates and quantum yield ratio upper bound
the next step of our methodology is to obtain the search spaces for σkλ and their respective Φ
k. in order to do this, a previously published method will be extended to include the effects of thermal reversion, using the parameters obtained from the previous section  <cit> . this section will outline the previously published method for photoreceptors with two light-regulated states and extend this to include a single thermal reversion reaction. in the additional file  <dig> we present equations for any n
c, and cases whereby the photoreceptor undergoes multiple thermal reversion processes or when multiple species exist in the photoreceptor reaction cycle.

measured spectra are obtained given preparatory conditions Ωp={} followed by experimental conditions Ωe={} and vice versa. note that, for a given experimental condition Ωe={}, if t
e→∞ then the resulting spectra do not depend on the preparatory conditions Ω
p. assuming that measured spectra are also related to extinction coefficients via eq.  then we can write: 
  <dig> ε^iλ=aeλ|Ωp,t→∞,zλaλ+x1aeλ|Ωp,t→∞,zλiλ−aeλ|Ωp,t→∞,zλaλ,ε^aλ=aeλ|Ωp,t→∞,zλaλ+x2aeλ|Ωp,t→∞,zλiλ−aeλ|Ωp,t→∞,zλaλ, 


where εkλ was calculated such that ε^kλ= <dig> lctotεkλ are the wavelength-dependent extinction coefficients and x
k are scalar constants. due to the relationship between extinction coefficients, photoconversion cross-sections and quantum yields , the resulting spectra provide us with limits for the optimisation algorithm developed below to minimise the difference between our data and eq. .

to simplify our notation we set cλw=ca}) as the fraction of active photoreceptor obtained after infinite exposure to the light-source zλλw given any preparatory conditions Ω
p. as such, any absorption spectra can then be defined by 
  <dig> aeλ|Ωp,t→∞,zλwλ=aeλ|Ωp,t→∞,zλaλ+aeλ|Ωp,t→∞,zλiλ−aeλ|Ωp,t→∞,zλaλx1+x2−x1cλw. 


using eq. , we find that 
  <dig> x1+cλa= <dig> x1+cλi= <dig>  


these equations are implicit for x
 <dig> and x
 <dig> because the fractions cλw depend, via eq. , on unknown εkλ . thus, other than in the simplest cases, these equations require solving numerically. by calculating the values for cλw for given values Φ, one can obtain spectra for ε^kλ via eqs.  and . doing this for all possible values of Φ provides us with the search space of εkλ spectra to be used within the optimisation algorithm.

the last remaining bound to be obtained is for r=Φ
a/Φ
i. to highlight how the upper bound for r can be obtained we look at the case where a photoreceptor has a single thermal reversion reaction. for the case of multiple thermal reversion rates the same steps can be followed to calculate r.

for a single thermal reversion rate 
 cλa=∑λσiλzλaλ∑λσaλ+σiλzλaλ+β 


where β is the thermal reversion rate in s − <dig>  and the photoconversion cross-sections σkλ are in m <dig> mol − <dig>  in our experimental setup, the spectral composition of zλwλ follows a gaussian distribution produced by led light sources   <cit> . by rearranging eq.  we obtain 
  <dig> x1+x2−x111+r∑λεaλzλaλ∑λεiλzλaλ+βΦi∑λεiλzλaλ= <dig>  


using eq.  leads to 
  <dig> r=x2x1+β/Φisia+x1saa−siasia+x1saa−siax2sia−saa−siar=ro−β/Φisia+x2saa−sia,ro=x2x1sia+x1saa−siax2sia−saa−sia, 


where sij=∑λεiλzλjλ. the function r
o is the same as that calculated using the previously published method in the absence of thermal reversion  <cit> . note again that the function of r is, in fact, implicit. for a given set of Φ, one calculates the values of x
k from eq.  to then obtain a value r using eq. . to limit our optimisation search space we wish to find bounds of r given our data. by definition, the lower bound of r is zero. an upper bound for r can be found since the second term of eq.  is always positive since β, Φ
i and εaλ are all positive. thus, r
o is the upper bound for r given specific values of Φ. therefore, we use the numerical maximum of r, r
max, given all possible combinations of Φ as the upper bound of r.

the above steps therefore provide, in the presence of different numbers of thermal reversion reactions, constraints on the wavelength-dependent photoconversion cross-sections and quantum yields. the final step in obtaining photoconversion cross-sections and quantum yields is to determine where in the defined search space the minimum difference between simulated spectra and experimental data exists.

step 3: simulating time-dependent absorption spectra
in section  <dig>  of additional file  <dig> we provide a pseudo-code of this optimization algorithm but, essentially, the problem is to minimize a cost score that describes the difference between the difference spectra obtained from our data and from eq. . the cost score function used in our algorithm calculates the sum of squared residuals such that 
  <dig> minΦa∈ <cit> r∈χ2=∑t=1nt∑λ=λ0λ∞d−sνtλ <dig> with:d=aeλt→∞,zλw1λ,t,zλw2λ−aeλ|t→∞,zλw1λ, <dig> zλw2λ,s=asλt→∞,zλw1λ,t,zλw2λ−asλt→∞,zλw1λ, <dig> zλw2λ, 


where νtλ is the experimental error of our data, ae},{}), measured between wavelengths λ∈[λ
 <dig> λ
∞]. here, zλw1λ and zλw2λ are the preparatory and experimental light conditions, respectively, that can be represented by gaussian distributions centred at λw <dig> and λw <dig>  furthermore, n
t is the number of measured time-points   <cit> . in the case where simulated data is used without noise, we set νtλ= <dig>  thus, upon estimating a value of Φ
a and r: 
one obtains a value of Φ
i from r=Φ
a/Φ
i.

these values are then input into eq.  to obtain values of x
 <dig> and x
 <dig> 

the obtained values of x
 <dig> and x
 <dig> are used in eqs.  and  to obtain εaλ and εiλ.

these spectra, plus the estimates of Φ, are input into eq.  to simulate absorption spectra asλtd→∞,zλw1λ,t,zλw2λ.




in our study all optimisation routines use matlab’s fmincon function that is started from  <dig> random initial points to cover as much of the global parameter space as possible. furthermore, 95% confidence intervals for Φ
k and thermal reversion parameters are calculated from profile likelihoods following the method outlined in  <cit> .

software
all computational procedures were performed using matlab . the codes created for our optimisation algorithms can be downloaded from http://gitlab.com/wurssb/absorption_spectra_optimization.

RESULTS
methodology successfully returns input values for extreme simulated test cases
to test the validity of our algorithm, we have tested the system using simulated data and compared the output to results obtained using butler’s model  <cit> . here, we highlight two extreme test cases in the absence of noise. notably, we assume that the light-dependent switching of the photoreceptor population occur on the ms to s timescale, comparable to what is known for full-length plant phytochromes in vivo   <cit> . for full details of the parameters used in our test cases see additional file 1: tables s <dig> and s <dig> 

in the first test case, we simulated a red/green cyanobacteriochrome  <cit> . the photoconversion cross-sections of this photoreceptor do not overlap in the wavelength-domain and we set the thermal reversion reaction rate to zero. thus, under red or green illumination conditions  the photoreceptor is able to attain populations containing 100% active or inactive photoreceptor. furthermore, we defined the quantum yields to be Φ
a= <dig>  and Φ
i= <dig> , which are broadly reasonable values for cyanobacteriachromes  <cit> . as shown in fig. 2
a, our algorithm is able to find the input wavelength-dependent photoconversion cross-sections and the correct quantum yields . furthermore, since the experimental conditions can lead to populations with 100% p
i, butler’s model provides similar results . consequently, the optimal simulations directly overlap with the simulated test data .
fig.  <dig> test cases of photoreceptors against output from butler’s model. a–d a red/green photoreceptor that satisfies the assumptions required for the photoconversion cross-sections to be calculated using butler’s method. a circles are the target photoconversion cross-sections used to create the synthetic data ; blue and green lines show the photoconversion cross-sections calculated using butler’s model ; black and red lines show the photoconversion cross-sections obtained using our optimisation algorithm . b quantum yields obtained from butler’s model  and our optimisation algorithm  compared to the target values . c, d simulations of absorption spectra  created using the optimal values from our algorithm compared to synthetic datasets . e–h same as in a–d except for a photoreceptor with photoconversion cross-sections that do not satisfy the conditions required to be calculated by butler’s model




to highlight that our algorithm is an accurate generalisation of butler’s model, we now show the results for a photoreceptor that does not satisfy the conditions required for butler’s model to produce accurate results. in this test case, we have simulated a photoreceptor that is activated by  <dig> nm light, but inactivated by  <dig> nm light with quantum yields of Φ
a= <dig>  and Φ
i= <dig> . such a case could occur when analysing point mutations within phytochromes . since this photoreceptor is unable to obtain populations containing 100% of p
i or p
a, butler’s model fails to predict the correct photoconversion cross-sections and quantum yields . however, our algorithm finds the correct photoreceptor parameters and simulations perfectly match the synthetic data . thus, we have shown that, in both cases where butler’s model can be applied and where it cannot, our optimisation algorithm is able to find the ‘true’ photoconversion cross-sections and quantum yields of photoreceptors.

approach is able to find optimal photoconversion cross-sections in the presence of multiple biochemical reactions
as discussed in section  <dig>  in additional file  <dig>  there is more than one way in which a photoreceptor can undergo multiple thermal reversion reactions. one option is through photoreceptor-chromophore interactions crucial for the transformation from active to inactive photoreceptor. the second is through dimerisation, whereby the p
a−p
i hetero-dimer has a different thermal reversion rate to the p
a−p
a homo-dimer, as is the case for full-length phyb found in plants  <cit> . notably, if spectra are obtained from a sample that contain a mix of these populations, we still wish to obtain photoconversion cross-sections for the monomeric p
a and p
i species. to show that our methodology can handle both cases, we have simulated a red/far-red photoreceptor using the ‘mancinelli’ spectra and quantum yields in the presence of multiple thermal reversion reactions  <cit> .
a–c shows the results for the red/far-red photoreceptor undergoing multiple thermal reversion due to photoreceptor-chromophore interactions. we set 70% of the active phytochromes to undergo one thermal reversion reaction rate  whilst the other 30% undergo a reaction rate an order of magnitude smaller . we are, once again, able to find the correct photoconversion cross-sections and quantum yields that produced the synthetic data . simulations using these parameters thus show a complete match with the input data .
fig.  <dig> optimisation results for photoreceptors undergoing multiple thermal reactions. a–c a red/far-red photoreceptor undergoing multiple thermal reversion reactions due to photoreceptor-chromophore interactions. a comparison of optimal photoconversion cross-sections  with those used as input . b quantum yields obtained using algorithm  compared with those used to create the synthetic data . c comparison of synthetic data  compared with simulations obtained using optimal parameters  for our red-to-far-red  and far-red-to-red  experiments. d–f same as in a–c for a red/far-red photoreceptor undergoing two thermal reversion rates due to dimerisation




by changing the c
k function, we are able to describe absorption spectra that result from mixed populations of dimerised photoreceptors. again, using an order of magnitude difference between the thermal reversion rates, we find the parameters used to create our test data . the resulting simulations using these parameters match the synthetic datasets . furthermore, we can find the optimal photoconversion cross-sections for any given set of thermal reversion parameters and using the wrong form of c
k has negative effects on results .thus, we have shown that even in complex photoreceptor systems our approach is able to accurately find the biochemical parameters of population-level state transitions for photoreceptors.

performance is robust to noisy spectra
in the last two sections we presented results in the absence of any experimental noise. however, as with all experiments, data is likely to include noise from both external and biological sources. consequently, the methodology should be robust against noise and provide accurate estimates of the photoreceptor transition rates. by including stochastic fluctuations  on simulated data from a single-step thermal reversion red/far-red photoreceptor , we are able to compare the impact of noise on our simulation results. as seen in fig.  <dig>  we are able to find the input photoconversion cross-sections from the calculated search spaces . similarly, the quantum yield estimates are accurate in the presence of noise . the resulting simulations using the optimal parameters also match the noise-inclusive data .
fig.  <dig> approach can obtain input values in the presence of 10% noise. a optimal photoconversion cross-sections  compared to the input photoconversion cross-sections used to create the test data . b search spaces calculated for the extinction coefficients using the verméglio method as a function of the scalar constants, x
 <dig> and x
 <dig>  c comparison of optimal quantum yields  compared to the target values . d simulated absorption spectra  compared to the synthetic data . for the time-points of each measurement see additional file 1: table s <dig>  e profile likelihoods for the parameters obtained from our optimisation algorithm  <cit> . f the search space for the optimal quantum yields. the space shows a clear global minimum at the optimal values




due to the inclusion of noise, we also highlight here the accuracy of our approach to find the optimal parameters. in fig. 4
e, we show the profile likelihoods obtained for Φ
i and r=Φ
a/Φ
i. following the theory in  <cit> , the 95% confidence interval for these parameters occurs when changing either parameter leads to the optimal score increasing by more than χ
2= <dig> . from fig. 4
e, it is clear to see that a very minor change in either parameter would result in increasing the score by more than  <dig>  , suggesting that our methodology obtained the optimal parameter values with high confidence. in fig. 4
f, we show the entire search space for our optimisation algorithm. the search space shows a clear minima at [ Φ
a,Φ
i]= that our algorithm has successfully found.

on the basis of these results we can confirm that our approach provides accurate results for multiple photoreceptors undergoing different thermal reversion reactions in the presence and absence of noise. furthermore, the obtained parameters have been shown to be the global minimum of the search space. this would suggest that our methodology is well-suited to dealing with absorption spectra obtained experimentally. in the following sections the transition rates for the phyb-n protein fragment commonly used in optogenetic tools will be determined.

the phyb-n protein fragment undergoes slow thermal relaxation
the n-terminal region of phyb  contains the key protein domains required for light responses and is relatively stable compared to other phyb fragments upon purification  <cit> . consequently, this protein is ideal for optogenetic tools although the kinetic rates describing the inter-protein reactions have not yet been quantified. before detailing the photoconversion cross-sections that control the speed of light-dependent reaction, in accordance with our methodology, we need to determine the reaction rates of thermal reactions of phyb-n.

before conducting our absorption experiments we confirmed the presence of phyb-n  within our sample . the sample was placed under  <dig> μmol m − <dig> s − <dig> red light until the system had saturated to provide the highest possible amount of active photoreceptor within the population . over the next  <dig> hours, absorption spectra were recorded in a temperature controlled dark chamber. as observed in fig. 5
a, the percentage of active phyb-n reaches a minimum by the end of the 48h protocol, showing levels of absorption at  <dig> nm that are similar to those seen after a saturating level of far-red light. comparatively with this slow thermal relaxation, the light-regulated changes of photoreceptor populations occurs within minutes given the light conditions and intensities  used in our study . from this result, one should note two observations. first, that as light intensity increases  the speed of conformational change will also increase . second, given that we use the same intensity of red and far-red light in our experiments, fig. 5
b suggests that the activation of phyb-n molecule population by red light is relatively faster than deactivation by far-red light.
fig.  <dig> population of phyb-n molecules responds to light and darkness on the minute to hour time-scale. a thermal reversion kinetics of phyb-n  compared to optimal function for a single  and bi-exponential decay function . b production and decay of p
a during red light illumination  and far-red illumination . dashed line shows the linear trend between the final measured time-point and the starting conditions of the reverse experiment obtained after  <dig> min illumination. experimental curves obtained using 




to determine the rate of thermal reversion, we used our optimisation algorithm to fit exponential functions to the data . by fitting a single and double exponential function to the data , we found that the data could be described qualitatively well by both single and double thermal reversion rates. the biochemical cause of the second exponential rate within the thermal reversion reactions is not well understood, however we have hypothesised potential causes in section  <dig>  of additional file  <dig>  since the focus of the work is on obtaining the photoreceptors photoconversion cross-sections, we analyze the generally accepted case of a single thermal reversion reaction. the optimal value for the parameter was β= <dig> ×10− <dig> s − <dig> . compared to published data for this protein, this is a slower thermal reversion rate than that recorded in  <cit> . however, and arguably most importantly, the thermal reversion of phyb-n in vitro is slower than thermal reversion of full-length phytochrome in vivo as has been observed previously  <cit> .

α

β
1

β
2
confidence intervals calculated from profile likelihoods  <cit> 




conformational changes of phyb-n are slower and blue-shifted compared to full-length phyb
according to the ‘mancinelli spectra’ for full-length phytochromes, the speed of transitioning between a population of active and inactive photoreceptor would occur within 5- <dig> s under the experimental conditions of this work   <cit> . however, there are two important differences in conditions between the measurement of the ‘mancinelli spectra’ and our experimental conditions. first, the ‘mancinelli spectra’ were calculated using absorption spectra obtained from in vivo samples whereas the samples used here are in vitro. second, in plant systems, phytochromes use p Φb chromophores whereas, in synthetic systems, pcb is used as an alternative. such differences have already been shown to produce ∼ <dig> nm blue-shifted absorption spectra that transition more slowly between different states  than spectra measured in vivo   <cit> . our data support these observations, whereby saturating levels of active or inactive photoreceptor can be achieved within  <dig> min given our experimental conditions .

using these results and the thermal reversion rates obtained in the last section, we are now in a position to use our optimisation algorithm to find the optimal photoconversion cross-sections and quantum yields for phyb-n . the output of our algorithm provides three notable observations. first, as would be expected by the slower kinetics, the amplitude of the resulting photoconversion cross-sections  is much lower than those obtained for full-length phytochromes in vivo . second, the peak of the photoconversion cross-section for phyb-n is blue-shifted compared to full-length phytochromes with peaks occurring ∼ <dig> nm shorter than full-length phytochromes in a similar manner to absorption spectra measured from in vivo and in vitro samples . third, in accordance with the slower kinetic rates and lower amplitude photoconversion cross-sections of phyb-n, the quantum yields are similarly decreased to a smaller percentage than previous estimates of full-length and mutated phytochromes, with Φ
a= <dig> ± <dig>  and Φ
i= <dig> ± <dig>  . in comparison to obtaining the results using butler’s model, we found that the calculated photoconversion cross-sections are similarly blue-shifted to our calculations albeit the amplitude of the rates and the quantum yields are decreased  in comparison to our estimates . our results suggest that the population level responses of phyb-n, in our hands, respond slowly to changes in light condition. however, despite these differences in kinetics with full-length phytochromes, the optimal parameters produce simulations that match closely with the experimental data . furthermore, given the profile likelihoods and the calculated search space, the algorithm indicates that the global optimum set of parameters has been found . since we have shown that our approach can handle data that contains noise, the differences observed between the data and our optimal simulations can be attributed to external sources that are not currently accounted for within our model .
fig.  <dig> optimal photoconversion cross-sections obtained for phyb-n. a optimal photoconversion cross-sections  compared to the ‘mancinelli spectra’  calculated for full-length phytochromes. note the change in y-axis. b search spaces calculated for the extinction coefficients using the vermémeglio method as a function of x
 <dig> and x
 <dig>  c comparison of optimal quantum yields  compared to the ‘mancinelli quantum yields’ . d simulated absorption spectra  compared to the synthetic data . e profile likelihoods for the parameters obtained from our optimisation algorithm. f the search space for the optimal quantum yields




discussion
methodology accurately calculates properties of photoreceptors
in this work we have introduced and tested a methodology that calculates the wavelength-dependent photoconversion cross-sections and the quantum yield of photoreceptor states . based on theoretical analysis  of specific photoreceptor conditions, we have generalised the theory to be used for any studied photoreceptor . the key step in the algorithm is the construction of search spaces for the k species within a photocycle. these search spaces contain all possible sets of photoconversion cross-sections, σkλ, given different values of quantum yields, Φ
k . the construction of these search spaces involves solving simultaneous equations that depend on the fraction of active photoreceptor  and ). thus, given the constraints of eq. , the wavelength-dependency of the photoconversion cross-sections can have no other form . consequently, we have demonstrated that the approach works for different photoreceptors with multiple thermal reversion reactions and dimer forms in the presence or absence of intrinsic noise . in section  <dig>  and  <dig>  of additional file  <dig>  we have presented the equations and an outline of how our analysis could be adapted for further photoreceptors that respond only to a single wavelength of light  or for photoreceptors that have reaction cycles containing n species.

the approach presented here has high potential to be used to obtain the photoconversion cross-sections for these photoreceptors, aiding both plant and synthetic biologists in understanding their respective light responsive networks in greater detail. one such example where our algorithm can be used is for the plant uv-b photoreceptor, uvr <dig> , that has recently been shown to exist as a mixed population of active monomers and inactive dimers under different environmental conditions  <cit> . our methodology will be instructive in determining photoconversion cross-sections for this photoreceptor and the rates of this light-activated switch. furthermore, since our proposed method can handle cases of overlapping photoconversion cross-sections more robustly than previous methods, one can envisage that it can be used to obtain transition rates for photoreceptors containing point mutations  or to find photoconversion cross-sections of photoreceptor sub-states, such as lumi-r in the case of phytochromes . in section  <dig>  of additional file  <dig> we highlight how this analysis could be achieved, however it should be noted that obtaining analytical expressions of c
k and r becomes challenging as the number of system components increases. thus, one could envisage that numerical solves are incorporated into the analysis to approximate values of c
k given a specific model system.

as with all methodologies, accuracy of the results is one of two factors that need to be taken into account. whilst we have shown that our approach produces accurate results, we should also assess computational performance. currently, running the entire process in a sequential manner on a single imac core using matlab r2013a can take at least a couple of hours when  <dig> optimisation runs are performed, depending on the complexity of the photoreceptor system being studied. however, within the current framework there are many steps that could be parallelised. notably, the most time-consuming step is generating the transition rate search spaces, which becomes particularly inefficient for complex problems . upon parallelisation, this process could be sped up since the same calculations are repeatedly performed for different values of the quantum yields. furthermore, our optimisation procedure is currently performed  <dig> times starting from random initial places with the quantum yield parameter space. this could similarly be parallelised such that all optimisation runs take place simultaneously. one could envisage that these steps would decrease the computational speed from hours to minutes.

the phyb-n protein fragment used in optogenetic tools responds slowly to changing light conditions
to showcase how our approach can be applied to a well-studied photoreceptor, we performed our analysis on the phyb n-terminal protein fragment that is used for optogenetic tools  <cit> . our results highlight three important insights. first, as previously observed, the data show that the phyb-n fragment has very slow thermal reversion kinetics and light-reversibility  compared to other phytochrome protein variants   <cit> . second, the calculated photoconversion cross-sections have a lower amplitude for phyb-n in vitro than full-length phytochromes in vivo and have a wavelength-dependency that is relatively blue-shifted . this matches with previous observations of measured p
a accumulation and blue-shifted absorption spectra of phyb-n  <cit> . finally, in correlation with the slower transition between p
a and p
i, the efficiency of the phyb-n protein to absorb photons  are decreased compared to estimates for full-length phytochromes  <cit> . this is likely due to the different chromophores used by phytochromes under in vivo and in vitro conditions  <cit> . in summation, these results suggest that responses of phyb-n populations in vitro to light are inefficient and slow when compared to the full-length counterpart in vivo.

this result has implications for the development of optogenetic tools based on the light-switching of phyb-n  <cit> . these studies have shown that common readouts of phyb-based optogenetic tools, such as gene expression, can take hours to accumulate to high levels after illumination of red light. notably, naturally occurring processes such as nuclear transport are rate-limiting and can take  <dig> min before the maximal system response is observed  <cit> . since the phyb-n population is fully activated by red light within  <dig> min of our experimental set up , our results suggest that accelerating population level switches between photoreceptor states could also, consequently, increase the speed of optogenetic responses. for example, mutated forms of phyb-n that have faster activation kinetics  could be applied in optogenetic tools.

CONCLUSIONS
here, we have built upon previous theoretical work to present a generalised approach for determining photoconversion cross-sections and, consequently, transition rates between conformational states of photoreceptors. we have shown the utility of our approach through the use of simulated data for multiple photoreceptors of differing complexity before performing our analysis on the phyb n-terminal fragment used in optogenetic tools. we envisage that the methodology can be used for any photoreceptor protein fragment, allowing the research field to directly compare rates at which photoreceptors and their mutated derivatives switch between conformational states in more detail. the resulting analysis will aid future optogenetic efforts where speed, efficiency and robustness of photoreceptor dynamics are imperative for the application of tools in bio-based industries.

additional file

additional file  <dig> appendix. appendix contains: the mathematical details to calculate the percentage of active photoreceptor within the population; calculating different forms of steady-state p
a percentages; how the p
a percentage is related to the scalar values x
 <dig> and x
 <dig> used in the verméglio method; how the approach could be applied to simpler and more complex photoreceptor systems; using butler’s model; pseudo-code for the optimisations algorithms used; experimental methods; supplementary figures and tables. 




