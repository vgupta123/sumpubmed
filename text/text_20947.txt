BACKGROUND
the human colon is a dense and diverse microbial habitat, that contains hundreds of microbial species  <cit> . these species together form a community that breaks down complex polysaccharides into monosaccharides, which are then fermented further into short chain fatty acids  that are taken up by the host  <cit> . the composition of the intestinal microbiota and the topology of the community-level metabolic network formed by it  <cit>  are associated with health and disease. for example, the microbiota produces the short-chain fatty acid butyrate, which has been proposed to lower the risk for colon cancer  <cit> . inflammatory bowel disease  and obesity are correlated with gain or loss of enzymes in the periphery of the network  <cit> , suggesting that in obese persons and in ibd patients the microbiota produces a different set of metabolic end-products. topological analysis further found indications that microbiota of obese individuals have a more diverse set of enzymes to extract energy from the diet  <cit> . patients with diarrhea-predominant irritable bowel syndrome show large temporal shifts in the composition of the microbiota  <cit> .

the most important source of bacterial diversity in the colon is probably due to metabolic interactions between bacteria  <cit> . the main nutrient sources entering the colon are non-degraded polysaccharides, including resistant starch and cellulose, oligosaccharides, proteins and simple sugars  <cit> . in addition to these exogenous sources of sugar, the colonic epithelium secretes mucins, which are an important nutrient source for the microbiota  <cit> .

in this paper we ask what mechanisms are responsible for the diversity of the gut microbiota. the structured environment and the diversity of undigested nutrient sources  found in the gut have been shown to sustain diverse microbial communities  <cit> . interestingly, however, diverse ecosystems can also arise in homogeneous environments with only one primary resource . for example, glucose-limited, continuous cultures of e. coli reproducibly evolve acetate cross-feeding within about  <dig> generations . in these experiments, one subpopulation enhances its glucose uptake efficiency and secretes acetate as a waste product. the acetate then provides a niche for a second strain that can grow on low concentrations of acetate.

mathematical modeling can help understand under what conditions such cross-feeding and diversification can emerge in homogeneous environments. in their isologous diversification model, kaneko and yomo  <cit>  studied sets of identical, chaotically oscillating metabolic networks that exchange metabolites via a common, shared medium. although small populations of oscillators will easily synchronize with one another, larger populations will break up in specialized, synchronized sub-populations. mathematical modeling has also given insight into the conditions that make specialization and cross-feeding beneficial from an evolutionary point of view. for example, cross-feeding can evolve if there exists a trade-off between uptake efficiency of the primary and secondary nutrient source  <cit> , or if a trade-off exists between growth rate and yield  <cit> . in absence of such metabolic trade-offs, cross-feeding can evolve if the enzymatic machinery required to metabolize all available nutrients is so complex that distributing enzymes across a number of species or strains becomes the more probable, ‘easier’ evolutionary solution  <cit> .

these initial mathematical models included simplified or conceptual models of metabolism. more recently, it has become feasible to construct models of microbial communities based on genome-scale metabolic network models . in these models, multiple species of bacteria interact with one another by modifying a common pool of metabolites. one class of models optimizes the bacterial and community growth rates in parallel, assuming flux-balance of whole community at once  <cit>  or iteratively within the individual bacteria and at community level  <cit> . such approaches can also include dynamic changes of the community-level constraints, including extracellular concentrations of metabolites  <cit> .

to also capture the emergent population dynamics of bacterial communities due to secretion and uptake of metabolites by the bacteria,  dynamic flux-balance analysis  has been introduced  <cit> . these couple the optimization-based flux-balance analysis  approach for modeling intracellular metabolism, with an ordinary-differential equation model  for modeling the metabolite concentrations in the substrate. these community models more closely approximate microbial metabolism than the initial, more abstract models, such that the results can be compared directly to experimental observations. for example, tzamali and coworkers  <cit>  used multispecies dfba to compare the performance of metabolic mutants of e. coli in batch monoculture versus its performance in co-culture with an alternative mutant. their model predicted co-cultures that were more efficient than their constituent species. louca and doebeli  <cit>  proposed methodology to calibrate the bacterial models in such dynamic multispecies fba approaches to data from experimental monocultures. by coupling these calibrated dynamical models of isolated strains of e. coli, the framework could reproduce experimentally observed succession of an ancestral monoculture of e. coli by a cross-feeding pair of specialists. because these models assume direct metabolic coupling of all species in the model via the culture medium, the model best applies to well-mixed batch culture systems or chemostats. the more recent coupled dynamic multi-species dfba and mass transfer models , or briefly, spatial dfba  models are more suitable for modeling the gut microbiota. these spatial extensions of the multispecies dfba approach couple multiple dfba models to one another via spatial mass transport models , such that bacteria can exchange metabolites with their direct neighbors.

in order to explore whether and under which circumstances a diverse microbial community can arise from a single nutrient source in the gut, here we extended the sdfba approach to develop a multiscale model of collective, colonic carbohydrate metabolism and bacterial population dynamics and evolution in a gut-like geometry. to this end, we combined spatial models of population dynamics with genome-scale metabolic models  for individual bacterial species and a spatial mass transport model. in addition to the sdfba approaches, we extended the model with an “evolutionary” component, in order to allow for unsupervised diversification of the microbial communities. we inoculate the metabolic system with a meta-population of bacteria containing a set of available metabolic pathways. when, depending on the local availability of nutrients, the bacterial population expands into its local neighborhood the metapopulation gains or looses metabolic pathways at random. we find that spatially structured, microbial diversity emerges spontaneously in our model starting from a single resource. this diversity depends on interspecies cross-feeding interactions.

RESULTS
a full multiscale model of the metabolism of the human gut would need to include around  <dig> individual bacteria belonging to hundreds of bacterial species, for which in many cases curated gems are unavailable. we thus necessarily resorted to a more coarse-grained approach, while maintaining some level of biological realism by constructing the model based on a validated, genome-scale metabolic network model of lactobacillus plantarum  <cit> . figure  <dig> gives an overview of the workflow of the paper. we first  constructed a metabolic model representing a subset of the gut microbiota, which we used for the dfba model . we then asked to what extent cross-feeding can emerge in large communities of interacting and diversified bacteria, such as those found in the colon, using a dynamic multi-species metabolic modeling  approach  <cit> , which is an extension of the dynamic flux-balance analysis  method  <cit> . to this end, we constructed a well-mixed model of a bacterial consortium , by coupling  <dig> of the dfba models via a common, external exchange medium that allowed the bacteria to exchange a subset of the metabolites in the gem. we initiated the exchange medium with a pulse of glucose, then observed the turn-over of glucose into a series of short-chain fatty acids , and quantified cross-feeding : the extent to which the bacteria exchanged metabolites via the common medium. next we asked to what extent spatially diversified microbial communities can emerge in a tube-like environment , if the microbial communities are allowed to specialize to the local availability of metabolites. in the spatial model, the gems inside the bacteria were allowed to evolve. after running the model for a fixed time, we quantified how much the gems had diversified and performed local cross-feeding  and to what extent they had locally changed the external concentrations of metabolites , leading to stratification and niche formation.
fig.  <dig> workflow of the modeling.  construction of “metabacterium” model, based on a lactobacillus plantarum gem  <cit>  extended with metabolic pathways commonly found in the gut microbiota;  dynamic flux-balance analysis model;  well-mixed community of “metabacteria” exchanging metabolites via a common medium;  observation of metabolites in the common medium;  measure cross-feeding coefficient;  spatial modeling in a gut-like environment with evolving “metabacteria”;  look for speciation and cross-feeding;  look for stratification of metabolic environment




construction of a metabolic model representing a subset of the gut microbiota
we first constructed a hypothetical, but biologically-realistic “supra-organism” model  <cit> , called “metabacterium” here, that represents a sample of the gut microbial community in a single metabolic network model. for this preliminary, explorative study we used a gem of lactobacillus plantarum  <cit> , a resident of the colon and a strain widely used for probiotics, and extended it with four key metabolic pathways of the intestinal microbial community:  propionate fermentation,  butyrate fermentation,  the acrylate pathway and  the wood-ljungdahl pathway. in future versions of our framework this network could be replaced by metabolic network models derived from metagenomic data  <cit>  as they become available. the current, simplified network contains  <dig> reactions , and compares well with consensus metabolic networks of carbohydrate fermentation in the colon  <cit> . for a schematic overview of the key pathways including in the metabolic network, see fig. 2
a.
fig.  <dig> 
a. simplified scheme of central carbon metabolism of the gem: 1) glycolysis. 2) lactate fermentation. 3) propionate fermentation. 4) acrylate pathway. 5) pyruvate dehydrogenase. 6) pyruvate formate-lyase. 7) butyrate fermentation. 8) acetate fermentation. 9) acetogenesis via wood-ljungdahl pathway. 10) ethanol fermentation. 11) butyryl-coa:acetate-coa transferase. pathways are reversible - arrow directions indicate the most common direction; b. metabolite dynamics over time. at time  <dig> only glucose is available




the uptake and excretion rates of genome-scale metabolic networks can be calculated using constraint-based modeling. to represent diauxic growth, i.e., by-product secretion as a function of extracellular metabolite concentrations, we used an extension of fba called flux balance analysis with molecular crowding   <cit> . fbawmc correctly predicts diauxic growth and the associated secretion of by-products in micro-organisms including e. coli, saccharomyces cerevisiae  <cit> , and l.plantarum  <cit> . as an additional, physiologically-plausible constraint fbawmc assumes that only a finite number of metabolic enzymes fits into a cell, with each enzyme having a maximum metabolic turnover, v
max. for each reaction, fbawmc requires a crowding coefficient, defined as the enzymatic volume needed to reach unit flux through that reaction. each reaction is assigned a “crowding coefficient”, a measure of the protein cost of a reaction: enzymes with low crowding coefficients have small molecular volume or catalyse fast reactions. given a set of maximum input fluxes, fbawmc predicts the optimal uptake and excretion fluxes as a function of the extracellular metabolite concentrations.

as fbawmc optimizes growth rate, not growth yield as in standard fba, it predicts a switch to glycolytic metabolism at high glucose concentrations at which faster metabolism is obtained with suboptimal yield. its accurate prediction of diauxic growth together with by-product secretion as a function of extracellular metabolite concentrations make fbawmc a suitable method for a microbial community model.

metabolic diversity causes cross-feeding in a well-mixed system
to study the extent of cross-feeding emerging already from a non-evolving metabolic community of “metabacteria”, we first set up a simulation of  <dig> interacting metapopulations, where each subpopulation was initiated with a set of crowding coefficients selected at random from an experimentally determined distribution of crowding coefficients of escherichia coli  <cit> , for lack of similar data sets for l. plantarum. the simulation was initiated with pure glucose and was ran under anaerobic conditions. we then performed fbawmc on all  <dig> metapopulations, optimizing for atp production rate as a proxy for growth rate. this yielded  <dig> sets of metabolic input and output fluxes, f
i, and growth rates, μ
i for all  <dig> metapopulations. these were used to update the extracellular concentrations, m→ and metapopulation sizes, x
i, by performing a single finite-difference step of  <cit>  
  <dig> dm→dt=∑ixifi→ 


and 
  <dig> dxidt=μixi. 


with a timestep Δ
t= <dig>  h. after updating the environment in this way, we performed a next time simulation step.
b shows how, in the simulation, the metabacteria modified the environment over time. the secondary metabolites that were produced mostly are acetate, butyrate, carbon dioxide, ethanol, formate, lactate and propionate. this compares well with the metabolites that are actually found in the colon  <cit>  or in an in vitro model of the colon  <cit> . in the first  <dig> min of the simulation, the initial pulse of glucose is consumed, and turned over into acetate , lactate , formate , and ethanol . these are then consumed again, and turned over into proprionate  via pathways  <dig> and  <dig>  and into butyrate  via pathways  <dig> and  <dig>  co
 <dig> is also increasing due to the turnover of pyruvate into acetyl co-a via pathway  <dig> . after about two hours of simulated time, proprionate and co
 <dig> levels drop again due to the production of butyrate : proprionate is consumed reversing reaction  <dig> and 4; co
 <dig> is consumed in pathway  <dig> that produces acetate from formate. the conversion of acetate back to acetyl-coa then drives the production of butyrate; a surplus of acetyl-coa is turned over into acetaldehyde and ethanol in pathway  <dig>  interestingly, formate and co
 <dig> are produced at the same time; this rarely occurs in any single organism but does occur in this microbial consortium.

to test to what extent these results depend on the ability of the individual fbawmc models to represent metabolic switching and overflow metabolism  <cit> , we also simulated the model using standard flux-balance analysis  <cit> . in this case, all glucose was converted into ethanol, whereas lactate and propionate did not appear in the simulation . to test to what extent the results rely on cross-feeding, we also checked if any of the single-species simulations could also produce so many metabolites. out of  <dig> single-species simulations none produced as many or more excreted metabolite species than the interacting set of species.

quantification of cross-feeding
most of the metabolites were only transiently present in the medium, m→, suggesting that the metabolites were re-absorbed and processed further by the bacteria. to quantify the amount of such cross-feeding in the simulations, we defined a cross-feeding factor, c, with i a species identifier. let 
  <dig> fup,tot≡∫t=0tmaxbfupdtfex,tot≡∫t=0tmaxbfexdt 


be the total amount of metabolite j that species i consumes and excretes during the simulation. b here equals the biomass of species i at time t. the amount of carbon species i gets via cross-feeding then equals, 
  <dig> c=∑jccmax−fex,tot,0)−6fup,tot. 


here, c
c is the molar amount of carbon atoms per mol metabolite j =6). if species i during the fermentation consumes more of metabolite j than it has produced, species i has cross-fed on metabolite j. we subtract the amount of glucose from the sum, because glucose is the primary nutrient source that is present at the start of the simulation. now we can calculate the total amount of carbon the population acquires via cross-feeding, relative to the total amount of carbon taken up by the population 
  <dig> crel=∑ic∑i∑jccfup,tot. 


if c
rel= <dig>  there is no cross-feeding. in that case, every species only consumes glucose as carbon source or only consumes as much carbon from other metabolites as it has secreted itself. conversely, if c
rel= <dig> all carbon the species has consumed during the simulation is from non-glucose carbon sources the species has excreted itself. for the whole simulation c
rel= <dig> ± <dig> , indicating that 39% of all carbon consumed by the bacteria comes from cross-feeding. cross-feeding was largest on lactate, co
 <dig>  acetate, ethanol, formate and propionate. many of these metabolites are known to be involved in bacterial cross-feeding in the colon or cecum . in the original l. plantarum model we also find cross-feeding, but only on lactate and acetaldehyde . taken together, in agreement with previous computational studies that showed cross-feeding in pairs of interacting e. coli  <cit> , these simulations show that cross-feeding interactions occur in coupled dynamic fbawmc models.

spatially explicit, evolutionary model
the well-mixed simulations showed that cross-feeding appears in populations of interacting metabacterial metabolic networks. however, this does not necessarily imply microbial diversity, because it is possible that the same metabacterium secretes and reabsorbs the same metabolites into the substrate, in which case there would be no true cross-feeding. furthermore, the previous section did not make clear whether cross-feeding will be ecologically stable under conditions where subpopulations of the supra-organisms are lost. in a spatially explicit model, cross-feeding possibly arises more easily and is more easy to detect, as different metabolic functions can be performed at different locations  <cit> . we therefore developed a spatially explicit, multiscale evolutionary model of gut microbial metabolism. we initiate the simulation with a population of metapopulations of bacteria that can perform all metabolic functions under anaerobic conditions, just as in the well-mixed simulation. we then let the systems evolve and study if meta-populations of bacteria with specific metabolic roles evolve.

model description <dig>  each containing a uniform concentration of metabolites, and potentially a metapopulation of gut bacteria  . each metabacterium represents a small subpopulation  of gut bacteria with diverse metabolic functions, and is modeled using a metabolic network model containing the main metabolic reactions found in the gut microbiota, as described above . based on the local metabolite concentrations, c→, the metabolic model delivers a set of exchange fluxes f
i,n and a growth rate, μ, which is assumed to depend on the atp production rate . the metabolites disperse to adjacent patches due to local mixing, which we approximate by a diffusion process , yielding 
  <dig> dc→dt=f→b+dl2∑i→∈nbc→−c→, 
fig.  <dig> setup of the simulation model of a metabolizing gut microbial community. the model represents a community of growing subpopulations of genetically identical bacteria. a the metabolism of each population is modeled using a unique, modified gem of l. plantarum <cit> ; b based on extracellular metabolite concentrations, the genome scale model predicts the growth rate  of the subpopulation and the influx and efflux rates of a subset of  <dig> metabolites. these are used as derivatives for a partial-differential equation model describing the concentrations of extracellular metabolites, ∂ci/∂t=fi+d∇2c, where c the metabolites diffuse between adjacent grid sites, x→. d the population is represented on a two-dimensional, tube-like structure, with periodic inputs of glucose. e to mimic advection of metabolites through the gut, the concentrations are periodically shifted to the right, until they f exit from the end of the tube. g the bacterial populations hop at random to adjacent grid sites; to mimic adherence to the gut wall mucus bacterial populations are not advected, unless indicated otherwise. h once the subpopulation has grown to twice its original size, it divides into an empty spot in the same lattice size at which time the metabolic network is mutated. i two subpopulations can live on one grid point; with yellow indicating presence of one subpopulation, and green indicating the presence of two subpopulations. 




where f→ is the flux of metabolites between the medium and the metabacterium, and the sum runs over the four nearest neighbors nb; dispersion is approximated by fick’s law, where d is a diffusion coefficient and l= <dig> cm the interface length between two adjacent patches. the local density of metabacteria, b is given by 
  <dig> dbdt=μb. 


to mimic meals, a pulse of glucose of variable magnitude enters the tube once every eight hours . the metabolites move through the tube via a simplified model of advection: at regular intervals, all metabolites are shifted one patch . metabolites continuously leave the tube at the end through an open boundary condition . to mimic peristaltic movements that locally mix the gut contents together, metabacteria randomly hop to adjacent lattice sites  and leave the gut only via random hops over the open boundary condition. in a subset of simulations, accelerated bowel movements are simulated by advecting the metabacteria together with the metabolites. to a first approximation, the boundaries are impermeable to the metabolites, a situation reflecting many in vitro models of the gut microbiota ; later versions of the model will consider more complex boundary conditions including absorption of metabolites  <cit> .

when the local biomass in a patch, b, has grown to twice its original value, the metapopulation expands into the second position on the grid point . to mimic a local carrying capacity, the metapopulation does not spread out or grow any further if both positions in the patch are occupied. in the visualizations of the simulations, full patches are shown in green, singly occupied patches are shown in yellow, and empty patches are shown in black . during expansion, changes in the relative abundance of species may enhance or reduce the rate of particular reactions, or even delete them from the metapopulation completely. similarly, metabolic reactions can be reintroduced due to resettling of metabolic species, e.g., from the gut wall mucus  <cit> . to mimic such changes in species composition of the metapopulation, during each expansion step, we delete enzymes from the metabolic network at random, reactivate enzymes at random, or randomly change crowding coefficients such that the metapopulation can specialize on one particular reaction or become a generalist.
fig.  <dig> screenshot of the spatially explicit model. the proximal end of the colon is on the left, the distal end on the right. thus, nutrients flow from left to right. a cells on the grid. at maximum  <dig> cells can be on the same grid point. yellow:one cell present, green:  <dig> cells present.  glucose concentration. black: low concentrations, white: high concentrations.  formate concentrations. in total,  <dig> extracellular metabolites are taken into account in the model




the crowding coefficients, as they appear in the flux-balance analysis with molecular crowding  method that we used for this model, give the minimum cellular volume filled with enzymes required to generate a unit metabolic flux; they are given by the v
max of the enzyme and enzyme volume  <cit> . equivalently, in our metapopulation model, the crowding coefficient of a reaction is the minimum intracellular volume averaged over all bacteria in the patch that must be filled with enzymes in order to generate a unit flux through the reaction. it depends on the density of the enzyme in the bacteria and also on the corresponding values of v
max. because the v
max of a reaction can differ orders of magnitudes between species , the evolutionary dynamics in our model could drive the metabacteria to reduce all crowding coefficients concurrently, producing a highly efficient generalist. to introduce a biologically more realistic trade-off between metabolic rate and cost in terms of volume, we therefore included an experimentally observed trade-off between growth rate and growth yield among micro-organisms  <cit> : micro-organisms that grow fast have low growth yield and vice versa. we take this trade-off into account explicitly by assuming a maximal growth rate given the carbon uptake rate of the cells. this trade-off prevents the metabacteria from growing infinitely fast by mutating their crowding coefficients.

as an initial condition, we distribute metabacteria over the grid, each containing all available metabolic reactions, i.e., each metabacterium initially contains all bacterial “species” that the complete metabacterium represents. to reflect variability in the relative abundances of the bacterial species in each metabacterium the crowding coefficients are drawn at random from an experimental distribution as described above .

evolution of diversity due to metabolic cross-feeding
to evaluate the behavior of our model, we performed ten independent simulations. these show largely similar phenomenology; therefore we will first describe the progression of one representative simulation in detail, and then discuss differences with the other simulations. figure 5
a shows the average number of metabolic reactions present in the metabacteria over time in the simulation. at t= <dig> all metabacteria still have all  <dig> reactions, but over time the number of available reactions gradually drops to below  <dig>  this reduction of the number of metabolic genes could indicate a homogeneous population that is specialized, e.g., on fermentation of glucose where most of the metabolic network is not used. an alternative explanation is that each of the metapopulation retains a subset of the full network, an indication of cross-feeding. the amount of cross-feeding will likely change over the tube: the metabacteria in the front have direct access to glucose, whereas the metabacteria further down in the tube may rely on the waste-products of those in front. we therefore determined a temporal average of the cross-feeding factors, c
rel , at each position in the tube over t= <dig> to t= <dig>  a time range at which most genes have been lost. the first observation to note is that in the spatial evolutionary simulations, the average cross-feeding factor c
rel has a higher value than in the well-mixed simulations. in this particular simulation, the spatial average cross-feeding factor at t= <dig> is c
rel= <dig> ± <dig> , compared with c
rel= <dig> ± <dig>  in the well-mixed case . the cross-feeding factor for individual cells , eq. 4), showed large population heterogeneity. as fig. 5
b shows, the cross-feeding factor in the tube front is close to  <dig>  indicating the presence of primary glucose consumers, while cross-feeding slowly increases towards the distal end until it almost reaches  <dig>  indicating complete cross-feeding. thus in the proximal end the bacteria rely mostly on the primary nutrient source, while near the distal end cells of the tube rely on cross-feeding. this observation is consistent for all simulations .
fig.  <dig> outcome of the evolutionary simulations. a population average and standard deviation of the number of enzymatic reactions  over time. b population average and standard deviation of the cross-feeding factor c
n as a function of the position in the colon. the averages and standard deviation are over the vertical dimension and are calculated over the final part of the simulation, from  <dig> h until  <dig> h. for the graphs of the other simulations, see additional file 3: figure s3




emergence of metabolic stratification
we next investigated the mechanism by which such cross-feeding emerges in the simulation. additional file 4: figure s <dig> plots the metabolite concentrations over evolutionary time for the simulation of fig.  <dig>  in this particular simulation, the concentrations of formate and lactate initially rise rapidly, after which they drop gradually. the butyrate concentrations increase over evolutionary time. in all simulations, the metabolite concentrations change gradually, but not necessarily following the same temporal pattern.
 <dig>  showing that the metabacteria convert the glucose into secondary metabolites. among these secondary metabolites, the levels of acetate , ethanol , formate , lactate  and propionate  drop towards the distal end off the tube, so they are further metabolized by the metabacteria. in this particular simulation, butyrate and co <dig> are not consumed and their concentrations increase monotonically towards the end. the small drop at the very distal end is caused by the metabolite outflow. the profiles of the other simulations were consistent with this representative simulation . in all simulations, the proximal end was dominated by glucose. further towards the end of the tube, zones of fermentation products developed as in the representative simulation, but the precise location of each product was different and not all products were present. most notably, in two out of ten simulations, butyrate was absent and in two other simulations proprionate was absent. also, in three out of ten simulations lactate was more confined to the front of the tube  than in the representative simulation.
fig.  <dig> average metabolite concentrations along the colon. average are taken over the second half of the simulation . a glucose. b acetate. c butyrate. d co <dig>  e ethanol. fformate. g lactate. h propionate




metabacteria specialize on local metabolic niches
these results demonstrate that the metabacteria spatially structure their metabolic environment, generating a stratified structure of metabolic “niches” along the tube, each offering a separate set of metabolites. therefore, we next asked if this environmental structuring gives rise to metapopulations uniquely adopted to the microenvironment. we took computational samples of all metabacteria found in the tube between  <dig> h and  <dig> h, to average out the variations at the short timescale. we tested the growth rate of these samples  in six, homogeneous metabolic environments, containing uniform concentrations of pure  glucose,  acetate,  formate,  lactate, and  propionate, and  a mixture of of co
 <dig> and h
 <dig>  figure  <dig> shows the average and standard deviation of the growth rates of the metabacteria in each of these six environments, as a function of the position from which they were sampled from the tube. strikingly, the metabacteria near the distal end of the tube have lost their ability to grow on glucose , indicating that they have specialized on secondary metabolites, including acetate  and lactate . interestingly, in support of the conclusion that the metabacteria specialize on the metabolic niches generated by the population as a whole, the metabacteria sampled from the distal end on average grow faster on acetate and lactate than the metabacteria sampled from the front of the tube. acetate and lactate are produced in the proximal colon and flow to the distal part of the tube where the metabacteria can metabolize it; in the front of the tube acetate and lactate concentrations are lower, such that neutral drift effects can safely remove the corresponding metabolic pathways from the metabacteria. remarkably, the metabacteria also grow on co
 <dig>  because of the presence of hydrogen gas, that allows growth on co <dig> via the wood-ljungdahl pathway  <cit> . to further characterize the alternative metabolic modes occurring in the model, we clustered the population present at the end of the simulation t =  <dig> h with respect to their maximum growth rates in the six environments . clearly, different metabolic “species” can be distinguished. one “species” can metabolize glucose, a second “species” can metabolize most secondary metabolites and a third “species” has specialized on acetate. thus in our simulation model a number of functional classes appear along the tube, each specializing on its own niche in the full metabolic network.
fig.  <dig> average growth rates along the colon. average are taken over the final part of the simulations  all growth rates ar calculated in the presence of unlimited hydrogen gas, water, sodium, ammonium, phosphate, sulfate and protons. a growth rate on glucose. b growth rate on acetate. c growth rate on co <dig>  d growth rate on formate. e growth rate on lactate. f growth rate on propionate


fig.  <dig> hierarchical clustering of all cells present at the end of the simulation, with respect to the growth rates on glucose, acetate, co <dig>  formate, lactate and propionate. black indicates low growth rate, red high growth rate. we used  <cit>  to perform the cluster analysis, with average linkage and a euclidian distance metric




increased flux through the tube makes diversity collapse
from the results in the previous section, we conclude that the inherent spatial structuring of the colon results in separate niches. this allows the population to diversify, such that different “species” have different metabolic tasks. a recent population-wide metagenomics study of stool samples from the flemish and dutch population  <cit>  showed that, among a range of life-style related factors and medicine use, the diversity of the human gut microbiota correlates strongest with the bristol stool scale , a self-assessed indicator of the “softness” of the stool. the analysis showed that for softer stools , the diversity of the gut microbiota was reduced  <cit> . to investigate whether transit time could also be correlated with reduced diversity in our model, we studied the effect of increased fluxes through the tube , by assuming that the supra-bacteria flow through the tube at the same rate as the metabolites do. strikingly, the maximal growth rate of the cells has become independent of the position . again, we clustered the population present at the end of the simulation with respect to their maximum growth rates in glucose, acetate, h <dig> and co <dig>  formate, lactate and propionate . in contrast to the simulations without cell flow, the population does practically not diversify. all supra-bacteria can grow on glucose, acetate and h <dig> and co <dig>  thus, our simulations suggest that increased transit times may contribute to a reduction of microbial diversity, by reducing the spatial heterogeneity in the gut and, consequently, the construction of ecological niches and cross-feeding interactions.
fig.  <dig> average growth rates along the colon, when cells flow through the colon as fast as metabolites. average are taken over the final part of the simulations  all growth rates ar calculated in the presence of unlimited hydrogen gas, water, sodium, ammonium, phosphate, sulfate and protons. a growth rate on glucose. b growth rate on acetate. c growth rate on co <dig>  d growth rate on formate. e growth rate on lactate. f growth rate on propionate


fig.  <dig> hierarchical clustering of all cells present at the end of the simulation with cell flow, with respect to the growth rates on formate, co <dig>  propionate, lactate, glucose and acetate. black indicates low growth rate, red high growth rate. we used  <cit>  to perform the cluster analysis, with average linkage and a euclidian distance metric




discussion
we have presented a coupled dynamic multi-species dynamic fba and mass-transfer model of the gut microbiota. we first studied a non-spatial variant of the model, in order to determine to what extent cross-feeding can emerge in a non-evolving, diverse population of metabacteria. the individual metabacteria in this model contain the major carbohydrate fermentation pathways in the colon. starting from glucose as a primary resource, the model produced acetate, butyrate, carbon dioxide, ethanol, formate, lactate and propionate. these fermentation products compared well with the short-chain fatty acids found in the colon  <cit>  or with those found in an in vitro model of the colon  <cit> . our model generated these short-chain fatty acids only if it was run with fbawmc and not with standard fba, indicating that the individual metabacteria must be able to exhibit diauxic shifts. in fbawmc these are due to rate-yield metabolic trade-offs  <cit> .

it has been argued that metabolic trade-offs in combination with mutational dynamics may already explain population diversity as it will select for suboptimal phenotypes with equally fit mutational neighbors - i.e., ‘survival of the flattest’  <cit> . this mechanism may already sufficiently explain diversity in microbial ecosystems, suggesting that cross-feeding or spatial heterogeneity is not required for diversity. however, cross-feeding interactions exist in the gut  <cit>  and are likely to be an important factor in determining microbial diversity. indeed, our spatially explicit, sdfba model shows that already on a single food source a stratified structure of metabolic niches is formed, with glucose consumers in front, followed by strata inhabited by secondary and tertiary consumers.

interestingly, these secondary and tertiary consumers specialized to their metabolic niche: metabacteria sampled from the rear end of the tube could no longer grow on the primary resource glucose , and they grew better on the secondary metabolite lactate than bacteria from the front did . this specialization was mostly due to “gene loss”, i.e., simplification of the metabolic networks. interestingly, metabacteria with reduced genomes did not have a growth advantage in our model, yet they lost essential pathways required for metabolizing the primary resource. such “trait loss without loss of function due to provision of resources by ecological interactions”  <cit>  is indicative of an evolutionary mechanism known as compensated trait loss  <cit> . note, however, that because smaller metabacteria did not have a growth advantage in our model, the gene loss in our model is due to drift. hence it differs from the black queen hypothesis  <cit> , which proposes that the saving of resources associated with gene loss accelerate the evolution of compensated trait loss. an interesting future extension of the model would consider the metabolic costs associated with the maintenance of metabolic pathways.

the formation of metabolic niches and the observed compensated trait loss required that the metabacteria can maintain their approximate position in the gut-like tube, e.g., by adhering to the gut wall or by sufficiently fast reproduction  <cit> . the microbial diversification did not occur if the metabacteria moved along with the flow of the metabolites, a situation resembling diarrhea. decreased microbial diversity is often seen causative for diarrhea, e.g., because it facilitates colonization by pathogenic species including clostridium difficile  <cit> . our model results suggest an additional, inverse causation, where accelerated transit reduces microbial diversity. experimental studies are consistent with the idea that transit speed is causative for reduced diversity, but with a different mechanism: microbiota sampled from softer stools  have higher growth potential, suggesting that faster transits favor fast growing species  <cit> . a second potential strategy to preventing wash-out from the gut at high transit times is adherence to the gut wall e.g., by the species of the p enterotype  <cit> . thus these observations suggest that the reduction of microbial diversity at fast transits is due to selection for fast growing or adherent species. our computational model suggests an alternative hypothesis, namely that increased transit times reduce the potential for bacterial cross-feeding, thus reducing the build-up of metabolic niches in the environment.

CONCLUSIONS
we have presented a coupled dynamic multi-species dynamic fba and mass-transfer model of the gut microbiota. we first studied a non-spatial variant of the model, in order to determine to what extent cross-feeding can emerge in a non-evolving, diverse population of metabacteria. the individual metabacteria in this model contain the major carbohydrate fermentation pathways in the colon. starting from glucose as a primary resource, the model produced acetate, butyrate, carbon dioxide, ethanol, formate, lactate and propionate. we next discussed a spatial variant of the model in a gut-like environment, a tube in which the metabolites diffuse and advect from input to output, and the bacteria attach to the gut wall. this spatially explicit, sdfba model was extended with models of bacterial population dynamics, and ‘mutation’ of the metabacteria due to the gain and loss of pathways from the local population. in this model, a stratified structure of metabolic niches formed, with glucose consumers in front, followed by strata inhabited by secondary and tertiary consumers that lost the ability to grow on the primary resource. interestingly, the stratification, and hence niche formation and specialization was lost if we increased transit speeds through the tube, to mimic diarrhea. thus our model results suggest that enhanced enhanced transit speeds might contribute to the observation that softer stools  have lower diversity  <cit> .

of course our model is a simplification as it lacks many key features of the gut microbiota and of the gut itself. the metabacterium only contain a minimal subset of the metabolic pathways that are found in the gut microbiota. future versions of our model could extend the current metabacterium model with additional metabolic pathways, e.g., methanogenesis or sulfate reduction. adding multiple pathways would increase the number of potential cross-feeding interactions and improve the biological realism of the model. an alternative route that we are currently taking is to include multiple, alternative metabacteria, each representing a functional group in the human gut microbiota  <cit> . this will allow us to compare the metabolic diversification observed in our computational model with metagenomics data, or use the model to compare alternative enterotypes  <cit> .

a further simplification of this first study of our model, is that we have focused exclusively on glucose metabolism. future versions of the model will also consider lipid and amino acid metabolism, allowing us to compare the effect of alternative “diets” and consider the break-down of complex polysaccharides present in plant-derived food fibers. further extensions include more complex interactions with the gut wall, which is currently impenetrable as in some in vitro models of the gut microbiota  <cit> . additional terms in eq.  <dig> will allow us to study the effects of scfa from the gut lumen, oxygen supply, and effects of the production of mucus by the gut wall  <cit> .

