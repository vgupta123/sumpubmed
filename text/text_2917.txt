BACKGROUND
affymetrix genechip microarrays  are routinely used for genome-wide quantitative expression analysis. ma measure the expression of genes using probe sets. probe sets are composed of multiple probes covering different regions of a particular transcript , as well as probes designed to measure non-specific hybridization .

preprocessing algorithms evaluate the signals from probes and combine them to get an expression measure for each probe set. as was shown in  <cit> , the choice of the preprocessing algorithm has a strong impact on ma analysis. irizarry et al.  <cit>  presented a comprehensive comparison of such algorithms and concluded that different preprocessing algorithms may suit different applications. in this study, we analyzed  <dig> popular algorithms: mas <dig>  <cit> , plier  <cit> , rma  <cit> , gc-rma  <cit> , and  <dig> variants of mbei algorithm  <cit> , using either pm-only model  or pm-mm model .

quantitative reverse-transcription pcr  is another method to measure gene expression. this is a widely used diagnostic assay, but the measurements obtained with this technique are more costly and time consuming  than in ma analysis. in biological studies  <cit> , as well as in analyses of preprocessing algorithms  <cit> , qrt-pcr is widely used to validate ma results. as was shown in  <cit> , the correlation coefficient between log-transformed  microarray expression measurements and Δct values from qrt-pcr is a good measure of agreement.

depending on the type, ma consist of several or tens of thousands probe sets, and traditional analysis of microarray data requires testing of all possible probe sets. however, multiple testing increases the number of false positives. for this reason, methods that eliminate unreliable measurements are helpful. one of them is filtering by fraction present calls  which was proposed by mcclintick and edenberg  <cit>  . this method uses the detection call  originally designed to support the affymetrix microarray suite  <dig> , one of the first preprocessing algorithms. the p/a/m procedure uses both pm and mm probes to determine specificity of signal of each probe set. the filtering by fraction present calls removes probe sets that had the fraction of present calls below a given threshold in every sub-group of samples. the authors showed that f can be effectively applied even for data generated by another preprocessing algorithm. recently, hackstadt and hess  <cit>  compared different filtering methods on  <dig> biological data sets and pointed that f can increase the number of differentially expressed genes identified.

as was shown by okoniewski et al.  <cit> , there are many probe sets which are annotated ambiguously to several genes, so cross-hybridization signal might be seen. the authors demonstrated that such probe sets could hamper inference of gene interaction networks, and suggested the use of a comprehensive annotation of probe sets to genes. an example of such mapping are custom definition files packages , designed by dai et al.  <cit> . their redefinitions of probe sets are based on the latest genomic knowledge, and by regrouping probes and creating new probe sets, allow to limit analysis only to the gene-specific measurements. however, among the redefined probe sets the numbers of probes are not identical. since such disparity may cause different quality of results, we implemented "naive mapping" method  which reduces the set of analyzed probe sets only to probe sets annotated to a single gene . in our study of filtering/mapping effects, we compared  <dig> approaches: a - use of all probe sets without any filtering or mapping method, f, d, n as described above, and all their nontrivial combinations - fd and fn.

both d and n mappings demand an annotation of probe sets to genes, and there are many different databases or probe set definitions for this purpose. sandberg and larsson  <cit>  compared the accuracy in estimation of fold change computed with ma for  <dig> databases: netaffx , ensembl gene, ensembl transcript, entrez, refseq, and unigene. accuracy was defined as a slope after a linear regression between qrt-pcr and ma fold change for  <dig> genes. the authors observed the most significant improvement in accuracy when using the ensembl gene and transcript databases . since qrt-pcr data used in our comparisons are labelled with the gene rather than the transcript names, we decided to use the ensembl gene database.

because of the evolution of genome sequence annotations, probe sets that originally were mapped uniquely to one gene may now be mapped to several genes. therefore, to check the influence of this evolution of annotation, we decided to use  <dig> different versions of annotations: the new  and the old .

typically, ma experiments are designed to profile the expression in two types of study: detection of differentially expressed genes  <cit>  or estimation of fold change  <cit> . the difference of expression is usually measured by p-values of welch's t-statistic that can be calculated as follows:  

where  and  stand for means of log-transformed expressions in two analyzed groups,  and  are estimators of variances, and n <dig> and n <dig> denote the numbers of samples in each of the analyzed groups. in case of log-transform data fold change is simply computed as the difference between the means  <cit> :  

in spite of the fact that t is a normalized fc, with regard to standard deviation, these two measurements have different motivations and lead to different results. small p-values of welch's t-test allow to point significantly differentially expressed genes, but possibly with small fc. although possibly biologically relevant, such genes may be difficult to validate with qrt-pcr. on the other hand, scientists may be interested in changes of expression level between groups, measured by fc  <cit> , but this statistic does not take into account a variability within groups. thus, a large relative difference may be statistically insignificant. moreover, there are approaches proposed to analyze sets of related genes  which benefit from the ranking of genes based on fold change regardless of significance of differential expression. additionally, in the analysis of differentially expressed genes the ranking of calculated p-values or, equivalently, values of t is interesting, while in the analysis of fold change nominal values are interesting. therefore, these two types of study should be treated differently. in our study, we used spearman's correlation  to compare values of welch's t-test from ma and qrt-pcr, and pearson's correlation to compare the respective fc values.

note that our analysis of agreement between detection of differential expression computed from qrt-pcr and ma results fits to the practice of preparing a list of genes with expected fdr below a given threshold. indeed, a list of genes with expected fdr ≤ α is a list with p-values not greater then some  dependent on α . hence, the more similar the lists of genes computed from ma and qrt-pcr results are, the higher a rank correlation between p-values is.

to sum up, we analyzed the influence of:

• type of ma study ;

• version of annotation of probe sets to genes ;

• type of preprocessing algorithm ;

• type of filtering/mapping ;

on the correlation between ma and qrt-pcr results.

RESULTS
collected data sets
we collected publications describing both, the ma based gene expression profiling and validation performed on the same rna samples with qrt-pcr experiments. next, we asked authors to provide us with raw data , i.e. microarray cel files and tables of a threshold cycle  from qrt-pcr. in this way, we obtained  <dig> data sets collected in different laboratories. the data sets are listed and abbreviated as follows:

• nerderd - samples from patients with non-erosive or erosive reflux disease  <cit> . we selected  <dig> groups which were well balanced in respect of sex and the batch effect.

• strain - data come from the study of effects of morphine administrations in  <dig> inbred mice strains  <cit> . we selected the contrast between 129p3/j and c57bl/ <dig> strains after morphine, because it displays the greatest differences among  <dig> analyzed strains.

• agewt - age difference  among wild-type mice. this is one of the most significant contrasts from an unbalanced 2x <dig> factorial design study  <cit>  and was analyzed there in detail. we chose this contrast to facilitate comparison with the original study.

• lonely - samples of peripheral blood from human individuals differing in the degree of social interactions  used in  <cit> .

• tsc - brain specimens, consisting of  <dig> tumour samples from patients with tuberous sclerosis complex  and  <dig> control samples. the data were performed in the nencki institute of experimental biology  <cit> , and the ma can be obtained from arrayexpress  <cit>   while additional file  <dig> contains qrt-pcr results.

• maqc_cd - in the maqc project  <cit>  gene expression levels were measured from  <dig> high-quality, commercially available rna sample types a and b  from stratagene, human brain reference rna  from ambion). however, the authors noticed that in practical applications the expected differences between sample types were usually much smaller, and they suggested that mixtures c and d of the original samples were more realistic substitutes of biological samples . we followed this suggestion.

for the nerderd  <cit> , strain  <cit> , agewt  <cit> , and maqc_cd  <cit>  data sets, we analyzed only one contrast selected from the original multifactorial data. using the data for all possible contrasts would upset the balance between the experiments in the final average towards the data sets with more groups. our work, to our knowledge, is the first validation of preprocessing algorithms and filtering/mapping methods on independent data sets collected to address biological questions.

the first three columns contain general information about collected experiments: labels of the data sets used in our analysis , reference numbers , and numbers of used samples . the fourth column describes a type of microarray used in each experiment: . the last column contains information about qrt-pcr protocol.

• the analyzed samples originate from different species and were hybridized on different ma types. this variety allows us to assume that the obtained average performance of different ways of ma data analysis is more representative for practical applications.

• different qrt-pcr protocols were used to validate ma results in different experiments. however, arikawa et al.  <cit>  demonstrated that both sybr green and taqman delivered highly comparable results and both showed high agreement with ma data.

• the collected qrt-pcr data are labelled with gene rather than transcript names and we were not able to gather details of the primers used. therefore, to compare ma and qrt-pcr results, we had to use annotation of probe sets to genes. in all variants of filtering/mapping except for d and fd, several different probe sets may be annotated to one gene. therefore, it is necessary to transform expression measurements from probe set ensembles to genes. in this study we considered two such transformations:  assigning the expression measure from the best probe set  to a gene and  averaging expression measurements over all probe sets annotated to the same gene. it turned out that choosing the best probe set led to consistently higher correlations between ma and qrt-pcr results , so we present only the results obtained with this method .

for all experiments and in each variant of analysis, a number of correlated genes depended on the version of annotations. table  <dig> shows a number of genes correlated in each variant and experiment. in each cell, the first number stands for the new annotation, whereas the number in brackets stands for the old annotation.

number of correlated genes in each variant of filtering/mapping  and a biological experiment . in each cell, the first number stands for the new annotation, whereas the number in brackets stands for the old annotation.

detection of differentially expressed genes
for every gene validated with qrt-pcr, we calculated welch's t-statistic, both from ma expression measurements and from Δct of qrt-pcr in a given experiment. the two resulting vectors of t-statistics  were compared by calculating spearman's correlation. for reasons of simplicity, since high Δct values correspond to low microarray expressions, we multiplied correlations by - <dig> in figures, and by - <dig> in tables.

the table contains mean values and the corresponding standard deviations of spearman's correlation coefficients calculated for  <dig> experiments. correlations were computed between values of welch's t-statistic calculated from ma and qrt-pcr measurements. columns contain results for the  <dig> preprocessing algorithms, whereas rows contain results for the  <dig> filtering/mapping methods  after the new and the old annotations.

estimation of the fold change
similarly as for detection of differential expression, we compared vectors of ma and qrt-pcr fold changes, but this time we used pearson's correlations. figure  <dig> presents results in a similar way to figure  <dig>  overall, we can see that for each preprocessing algorithm and for both annotations correlations are higher than for the differential expression study. again, the use of the new annotation generally leads to higher correlations. moreover, for each preprocessing algorithm, the highest correlations were achieved in fn for the old annotation, and in f and fn for the new annotation. however, for the new annotation the influence of naive mapping was even smaller than in our differential expression study. the redefinitions d did not have equal influence on all preprocessing algorithms. for both annotations, d led to higher correlations, relatively to n, for gc-rma, rma, and mas <dig>  and to lower correlations for plier, mbei, and mbeimm. table  <dig> presents average correlations shown in figure  <dig> and their standard deviations . like above, the highest correlations were achieved by plier in the variants f and fn. moreover, the plier correlations again have the lowest sd. in general, pm-mm methods, outperformed pm-only methods regardless of annotations.

the table contains mean values and the corresponding standard deviations of pearson's correlation coefficients. correlations were computed between fold changes calculated from ma and qrt-pcr measurements. columns contain results for the  <dig> preprocessing algorithms, whereas rows contain results for the  <dig> filtering/mapping methods  after the new and the old annotations.

unreliability of results for mbeimm
although mbeimm leads to one of  <dig> the best results, both for detection of differentially expressed genes and for estimation of the fold change, there are some reasons that undermine this method. raw mbeimm values may be negative and cannot be log-transformed . if this occurs for the best probe sets , then the values of t-statistic or fold change are computed using lower number of observations than in case of other preprocessing algorithms or qrt-pcr. for example, figure  shows that mbeimm clearly outperformed gc-rma and plier in a and n filtering/mapping variants for lonely data. this result implies a similar order of preprocessing algorithms as in figure  <dig>  but, as we checked, the values of fc and t for mbeimm were computed using a lower number of observations than in case of the other preprocessing algorithm. thus, correlation of mbeimm, and qrt-pcr should not be compared with other preprocessing algorithms. moreover, in tables  <dig> and  <dig> we show that mbeimm results are less stable  than for plier or gc-rma.

principal component analysis of preprocessing algorithms
comparison of table  <dig> and table  <dig> suggests that there is a difference in performance of pm-mm and pm-only methods. in the fn variant of filtering/mapping  using mm probes increased correlation in the fold change studies, but pm-only methods performed better in the detection of significant expression. we confirmed the difference in performance of pm-mm and pm-only preprocessing algorithms in principal component analysis on maqc data. we used a and b sample types, instead of c and d because we wanted to obtain the maximal biological diversity and to analyze only technical differences. we performed pca on values of t-test and fold change separately using only genes that were validated with qrt-pcr. then, we plotted the preprocessing algorithms on the plane of the first  and the second  principal directions. figure  <dig> presents both results.

the relevance of pc <dig> and pc <dig> measured with a sum of relative variances of first two pc amounts to 77% for detection of differentially expressed genes, and to 83% for estimation of fold change. discrimination between pm-only pm-mm methods is well noticeable, especially in figures 4a, where pc <dig> separates pm-only from pm-mm methods. additionally, in both pictures, the pm-mm algorithms are placed more closely to each other. in both cases, mbei and mbeimm algorithms are separated by the first principal component.

CONCLUSIONS
this paper presents a comparison of preprocessing algorithms and filtering/mapping variants for analysis of microarray data. based on  <dig> independent biological data sets, we studied correlations between ma and qrt-pcr expression measurements in  <dig> studies  using  <dig> annotations . we showed that filtering by fraction present calls increased correlations for all  <dig> preprocessing algorithms. we observed the difference in performance of pm-mm and pm-only methods: using mm probes increased correlations in the fold change studies, but pm-only methods performed better in the detection of significant expression. for detection of differentially expressed genes, we recommend using gc-rma, and for estimation of fold change - plier algorithm. the use of the more recent annotation improves results in both types of studies, encouraging re-analysis of old data.

