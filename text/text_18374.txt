BACKGROUND
microorganisms comprise the majority of earth’s biological diversity, and they play essential functional roles in virtually all ecosystems  <cit> . in particular, human-associated microbial communities play a fundamentally important role in health and disease  <cit> . in many environments, however, more than 99% of the microorganisms cannot be cultured by standard techniques  <cit> . in order to understand the genetic diversity, population structure, and ecological roles of novel organisms, metagenomic approaches analyze the microbial genomic dna obtained directly from the environment  <cit> . the number and scope of metagenomic studies have increased dramatically  <cit>  due to the rapid advance of sequencing technologies, which enable large amounts of dna sequencing to be performed quickly and cheaply.

one fundamental goal in metagenomics is to characterize the taxonomic diversity of a microbial community - taxonomic profiling. this is usually achieved by the targeted sequencing of the 16s rrna gene, either as a whole, or focused on a hypervariable region within the gene  <cit> . then the sequences are classified based on similarity against a curated reference 16s rrna database  <cit> . this approach has been a powerful research tool allowing biologists to explore the majority of previously unknown microorganisms populating our world. approaches based on 16s rrna sequencing, however, provide a biased estimate of microbial diversity due to the wide variability in copy number of the 16s gene even within closely related organisms , and due to amplification biases inherent in pcr.

a more direct approach for taxonomic profiling is to classify metagenomic reads through homology search against a reference genes database. megan  <cit>  maps query sequences to the ncbi nr database using blast, and assigns them taxonomic labels according to the lowest common ancestor of the top database hits. carma  <cit>  first searches for conserved pfam domains and protein families within the unassembled reads of a sample, then constructs a phylogenetic tree of each matching pfam family and the corresponding query reads, and finally the reads are classified into a higher-order taxonomy depending on their phylogenetic relationships with respect to the database sequences that have known taxonomic origins. in contrast to homology-based approaches, machine learning and statistical methods  <cit>  have been used to classify dna sequences based on dna base composition signatures .

further, a hybrid approach phymmbl  <cit>  has demonstrated that the combination of machine learning  and homology information  produces higher accuracy than either method alone. despite the difficulties in accurately classifying whole-metagenome shotgun sequences, the estimated taxonomic profiles may be biased because of variations in genome size .

in this paper, we present a novel taxonomic profiling tool  for metagenomic sequences, which relies on  <dig> phylogenetic marker genes  <cit>  as a taxonomic reference. we extend the database described by wu and eisen  <cit>  by including marker genes from all complete genomes, the ncbi nr protein database and  <dig> draft genomes. one major limitation of prior methods used in this context is the use of a universal classification threshold for all genes at all taxonomic levels . however, individual bacterial genomes and proteins can have different evolutionary rates, and metagenomic reads contain gene fragments of different lengths. we propose that better classification results can be obtained by tuning the taxonomic classifier to the length of each hsp , to the reference gene, and to the taxonomic level. our classifier, based on blast, uses different thresholds for each of these parameters, which are automatically learned from the structure of the reference database. a side-effect, and an important feature of our tool, is the ability to identify novel organisms or taxa. results on simulated metagenomic datasets demonstrate that metaphyler outperforms previous tools used in this context . further, metaphyler is much faster than previous tools for two reasons:  the size of the reference database is much smaller than the ncbi nr database; and  our classifier based on blast bit scores involves much less computation than some previous approaches which build phylogenetic trees  <cit> . finally, we present several interesting results obtained by applying metaphyler to the gut microbiomes of obese and lean twins  <cit> .

RESULTS
performance evaluation using simulated datasets
classification performance
we carried out a simulated metagenomic study by comparing metaphyler with three other widely used tools: webcarma  <cit> , megan  <cit>  and phymmbl  <cit> . we have randomly simulated around 300k 60bp and 70k 300bp dna sequences from  <dig> phylogenetic marker genes. figure  <dig> compares the sensitivity  and precision  of the phylogenetic assignments at five taxonomic levels. the query sequence itself was removed from the reference dataset when running metaphyler, megan and phymmbl. we can see that metaphyler, megan and phymmbl have comparable precisions in almost all cases, and metaphyler is a little bit better than others at the genus level. however, the sensitivity of metaphyler is significantly better than other tools in all situations, perhaps due to the fact that the classifiers are explicitly trained at each taxonomic level.

one of the major challenges of metagenomic analysis is the presence of novel dna sequences which do not match well any data in current databases. one major goal of metagenomic analysis is to discover and classify such novel sequences. for example, we asked the following question: given a read from an organism whose genome has not been sequenced before, and also no sequences from the same genus are available, can we classify this sequence correctly at the family level provided that we have sequences from other organisms within the same family? we further examined the performance of metaphyler using progressively less data from organisms related to those from which the query sequences were simulated. table  <dig> summarizes the sensitivity and precision performance evaluated on 60bp and 300bp simulated metagenomic reads. overall the classification precision is still very high when fewer reference marker genes are available. this is especially true for the 300bp reads: even if no sequences in the database originate from the same genus as the query reads, the precision is still higher than 92% when classifying at higher taxonomic levels.

 <dig> 
 <dig> 
 <dig> 
 <dig> 
metaphyler phylogenetic classification performance on 60bp and 300bp simulated metagenomic reads. for each prediction, the top and bottom numbers are precision and sensitivity in percentage, respectively. different taxonomic levels are excluded when evaluating the classification, e.g., ’genus’ means genes that have the same genus label as the query read are excluded from the reference training dataset.

estimating bacterial composition
as we have discussed in the introduction section, estimating the abundance of taxonomic groups in a sample through the classification of phylogenetic marker genes is more accurate than that obtained through 16s rrna analysis or classification of all of the metagenomic shotgun sequences. in order to validate our hypothesis, we have created a simple simulated metagenomic sample comprising  <dig> genomes . we compared the accuracy of the taxonomic profiles estimated by different approaches . the genomes, which are present in the simulated sample, are eliminated from metaphyler reference database. metaphyler outperforms other approaches dramatically, and is very close to the true taxonomic profile. while for approaches based on classifying 16s rrna and all the shotgun sequences, even if we assume that the classification is perfect , the resulting taxonomic profile is still highly biased.

to evaluate the performance of different approaches in estimating the bacterial composition, we have created a simulated metagenomic sample consisting of  <dig> species with 100bp reads. ”coverage” indicates the depth of the coverage of the simulated reads in the simulated sample for the genomes.

taxonomic profiling of gut microbiomes from obese and lean twins
to demonstrate the capabilities of metaphyler in analyzing real metagenomic datasets, we used metaphyler to analyze the microbial diversity of the gut microbiome from lean and obese subjects, relying on data from  <cit> . this metagenomic dataset comprises  <dig> samples from obese subjects and  <dig> samples from lean subjects. in the original study, the taxonomic profiles for different individuals are estimated from the analysis of full-length 16s rrna gene, v <dig> and v <dig> hypervariable regions, and shotgun sequencing of community dna. to compare the results with the original paper, after running metaphyler on the shotgun sequences, we have used the modified t-test  <cit>  to compare the taxonomic profiles between obese and lean groups at the phylum level . as a result, we have identified three phylum-level clades  to be differentially abundant: actinobacteria, euryarchaeota and verrucomicrobia. the higher proportion of actinobacteria in obese compared with lean individuals confirm the observations in the original paper  <cit> . also we have determined firmicutes not to be differentially abundant, which agrees with the original findings. in contrast with the original study, we found the lower proportion of bacteroidetes in obese  not to be significant because of large variances within the two groups under comparison. furthermore, we have discovered that the verrucomicrobia bacteria are highly enriched in the lean group, which was not revealed in the original study but is consistent with the findings from another human gut metagenomic study  <cit> . by applying megan to these data we only identified actinobacteria  to be enriched in obese subjects.

                              p 
comparison of taxonomic profiles, estimated by metaphyler, between obese and lean gut microbiomes at the phylum level.

detecting novel organisms
as mentioned in the introduction , metaphyler can help to identify novel bacteria from metagenomic sequences. here we show a concrete example based on sample f10t1ob <dig> from the above-mentioned human gut metagenome dataset. we have identified a set of reads belonging to the order clostridiales, but novel at the family level. we then used minimus  <cit>  to assemble  <dig> reads that are mapped to the rplb gene. one of the resulting contigs  contained the full-length rplb gene. we searched the contig against the ncbi nr database and identified as the best hit the rplb gene from species ruminococcussp. sr1/ <dig> with 94% and 86% similarity at the amino acid and nucleotide levels, respectively. in addition, our assembly of another contig containing a fragment of rplb gene had 93% and 82% similarity with blautiahanseniidsm <dig> at the amino acid and nucleotide levels, respectively. given the low level of similarity at the nucleotide level between the genes extracted from the dataset and all previously characterized genes, we can be fairly confident that the rplb genes we identified are novel and likely belong to previously unsequenced members of the clostridiales order. it is important to note that this discovery was made possible by the stringent strategy we employ which avoids assigning an organism to a lower-level taxonomic group if the evidence does not support this assignment, a feature not available in other taxonomic profiling tools.

comparison of running times
we compared the running time of metaphyler with three other tools  on 70k 300bp simulated phylogenetic marker gene fragments . on a single  <dig> ghz processor, the running times  of metaphyler, phymmbl and megan for analyzing the simulated dataset are  <dig> hours,  <dig> days, and  <dig> days, respectively. on the same dataset webcarma  <cit>  took  <dig> hours. metaphyler is much faster than other tools in estimating the taxonomic compositions from metagenome shotgun sequences.

on a single  <dig> ghz processor, the computation time  used by metaphyler, phymmbl and megan for analyzing 70k 300bp simulated sequences. cpu hours for webcarma are calculated using its web server.

CONCLUSIONS
we have introduced a novel taxonomic classification method for analyzing the microbial diversity of metagenomic sequences. compared with previous approaches, metaphyler provides significantly higher sensitivity when classifying 60bp and 300bp simulated reads; metaphyler has slightly higher classification precision at the genus level, and comparable precision at higher taxonomic levels. more importantly, the taxonomic profiles estimated by metaphyler are much more accurate than those estimated by other tools. in addition, metaphyler is much faster than other tools for taxonomic profiling because  the reference marker genes database is much smaller than a general reference genes database ,  and also our classifier based on blast statistics involves much less computation than building phylogenetic trees . the high performance of metaphyler makes it suitable for large scale metagenomic studies, e.g., the human microbiome project. furthermore, analysis of publicly available metagenomic data agrees with previous observations, and also provides new insights into the microbial diversity of the human gut ecosystem. finally, we have demonstrated that metaphyler can be used to guide the discovery of novel organisms from metagenomic sequences.

the novel classification algorithm for short dna reads we have introduced in this paper can also be applied to other conserved genes. we are planning to release a general gene fragment classifier, which can learn classification thresholds automatically from a user provided dataset. in addition, instead of providing a binary result for each classification, we will also explore techniques for generating ”fuzzy” classifications based on confidence scores. the software described in this paper is freely available under an open-source license from http://metaphyler.cbcb.umd.edu.

