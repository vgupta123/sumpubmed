BACKGROUND
genome-wide association studies  aim to identify genetic variants of single nucleotide polymorphisms  across the entire human genome that are associated with phenotypic traits, such as disease status and drug response. the international hapmap project determined genotypes of over  <dig>  million common snps in human populations and computationally assembled them into a genome-wide map of snp-tagged haplotypes  <cit> . concurrently, high-throughput snp genotyping technology advanced to enable simultaneous genotyping of hundreds of thousands of snps. these advances combine to make gwas a feasible and a promising research field for associating genotypes with various disease susceptibilities and health outcomes. recently, gwas was successfully applied to identify common genetic variants associated with a variety of phenotypes  <cit> . many of these studies used the affymetrix genechip human mapping  <dig> k array set  <cit> . the genomic dna for one of the arrays is cleaved with the nsp i restriction enzyme and ~ <dig>  snps are interrogated. the second chip uses sty i – cleaved genomic dna and ~ <dig>  snps are analyzed. genotypes from affymetrix genechip human mapping  <dig> k array set data are usually determined by the calling algorithm brlmm  <cit>  embedded in affymetrix software packages. algorithms developed by other laboratories such as plasq  <cit> , gel  <cit> , crlmm  <cit> , sniper-hd  <cit> , mams  <cit> , and chiamo  <cit>  are also utilized.

the mpam algorithm was developed for analysis of raw data  from the first generation of affymetrix mapping  <dig> k array and is based on clustering of chips for each snp by modified partitioning around medoids  <cit> . mpam was error prone for snps with missing genotype groups or low minor allele frequency, a problem more pronounced on the second generation of affymetrix mapping  <dig> k array. this prompted affymetrix to develop a new dynamic model based calling algorithm called dm for mapping  <dig> k array data  <cit> . dm is a single-chip calling algorithm and usually calls genotypes with high overall call rate and accuracy. however, the algorithm exhibited a higher misclassification rate for heterozygous genotypes than for homozygous genotypes. to improve data analyses for genotyping arrays, the multi-chip genotype calling algorithm rlmm was developed. rlmm is based on a robustly fitted, linear model that employs mahalanobis distance for classification  <cit> . rlmm achieved a higher call rate than dm. with the release of the mapping  <dig> k snp array set, affymetrix extended the rlmm model to brlmm by adding a bayesian step that provided improved estimates of cluster centers and variances. the dm and gel algorithms operate on a single chip, while all others use multiple chips to call genotypes.

high call rate and accuracy of genotype calling are important and essential issues for success of gwas, since errors introduced in the genotypes by calling algorithms can inflate false associations and may lose true associations between genotype and phenotype. each of the algorithms was reported to have a high successful call rate and accuracy, or more precisely, high concordance with genotypes determined by the international hapmap consortium on the hapmap samples. with the exception of dm and gel, the algorithms require data from multiple chips  to make genotype calls. a gwas usually involves analyses of thousands of samples that generate thousands of raw data files . the raw data file for one sample  is about  <dig> mb in size. computer memory  limits make it unfeasible to analyze all cel files in a gwas in one single batch on a single computer. the samples are, therefore, divided into many batches for genotype calling. affymetrix suggests  <dig> to  <dig> cel files for a batch for the brlmm method. to date, the effects on genotype calls caused  by changing the number and specific combinations of cel files in batches and propagation of the effects to the downstream association analysis have not been investigated.

since brlmm is recommended by affymetrix, we analyzed the effect of batch size and composition on the ability of the brlmm algorithm to consistently call the  <dig> samples from the international hapmap project.

RESULTS
batch size effect
batch size effect was assessed by comparing the genotypes called from bs <dig>  bs <dig>  and bs <dig>  for call rate and concordance. the overall call rates, defined as the proportion of successful calls to the total number of calls  for bs <dig>  bs <dig>  and bs <dig> were  <dig> %,  <dig> %, and  <dig> %, respectively. however, overall call rates are not informative enough to assess the distribution of missed calls on the chip. batch size effect on genotype calling rates are best compared using one-against-one comparisons of distributions of call rates on individual samples and snps. these distributions were calculated from data of samples and snps generated from the calling results of the experiments with three batch sizes .

the comparison of call rates of samples using ma-like plots is shown in figure  <dig>  the average call rate of two genotype calling results  from experiments with two different batch sizes were plotted against the difference of call rates between the two experiments . the horizontal dotted lines at y =  <dig> represent the expected locations of samples if the missing calls on each sample were exactly the same in the two experiments. data points above this line are the samples having fewer missing calls  in the experiment with the larger batch size than in the experiment with the smaller batch size. data points beneath this line indicate samples having fewer missing calls in the experiment with smaller batch size than in the experiment with the larger batch size. the perpendicular distance from a data point to this line is the difference in call rate of a sample between the two experiments. figure 1a compares the results of bs <dig> with bs2; 1b compares the results of bs <dig> with bs3; and 1c compares the results of bs <dig> with bs <dig>  data points at lower average call rates are more distant from the calculated equivalent call rate  than the data points at higher average call rates. thus, batch size affected lower call rates more severely than higher call rates. furthermore, data points in figure 1b  are farther away from the dotted line when compared with the data points in figure 1a , which, in turn, were farther away from the dotted line when compared with figure 1c . the values of d¯  were  <dig> ,  <dig> , and  <dig>  for comparisons shown in figure 1a, b, and 1c, respectively, that are related to the corresponding differences of batch sizes of the compared experiments,  <dig> ,  <dig> , and  <dig> . the p-values for comparisons in figure 1a, b, and 1c are  <dig>  × 10- <dig>   <dig> , and  <dig> , respectively, indicating that call rates on samples between calling batch sizes are statistically different.

the comparisons of the call rates for individual snps are depicted by ma-like plots in figure  <dig>  figure 2a compares the results of bs <dig> with bs2; 2b compares the results of bs <dig> with bs3; and 2c compares the results of bs <dig> with bs <dig>  the trend is similar to that observed in figure  <dig> that batch size affected lower call rates more severely than higher call rates for individual snps. the d¯ values were calculated to be  <dig> ,  <dig> , and  <dig>  for the comparisons shown in figure 2a, b, and 2c, respectively. they were positively correlated with the differences of batch sizes of the compared experiments,  <dig>   <dig>  and  <dig>  respectively. the p-values for comparisons in figure 2a, b, and 2c are  <dig>  × 10- <dig>  indicating that the difference of call rates on snps between calling batch sizes are statistically significant.

comparing call rates in experiments with different batch sizes can only assess the batch size effect on missing calls. since three genotypes  are possible for a genotype call, we determined the effect of batch size on the ability to consistently call the genotype. to evaluate the batch size effect on successful calls, concordance of successful genotype calls between experiments with different batch sizes was analyzed . batch size affected successful genotype calls since the concordances were not 100% and heterozygous genotype concordances were more affected than homozygous genotype concordances. the largest difference in batch size  led to the lowest concordances . however, the concordances for bs <dig> versus bs <dig> were slightly lower than for bs <dig> versus bs <dig>  even though the difference of batch sizes for bs <dig> versus bs <dig>  is smaller than that for bs <dig> versus bs <dig> . this result is likely due to the relatively large difference in the number of arrays in the batch . high concordance of genotype calls depends on the difference between batch sizes as well as the actual batch sizes themselves.

successful calls for both: snp genotypes successfully called in both of the compared experiments; concordant calls : same genotype called in both of the compared experiments; concordant calls : homozygous genotype called in both of the compared experiments; concordant calls : heterozygous genotype called in both of the compared experiments.

batch composition effect
the overall call rate based on all cel files of the  <dig> hapmap samples for bc <dig>  bc <dig>  and bc <dig>  were  <dig> %,  <dig> %, and  <dig> %, respectively. the genetic homogeneity of the batches in bc <dig>  is higher than that of bc <dig>  which, in turn, is higher than that of bc <dig> . the batch sizes were the same for all of the three experiments. thus, higher call rates were obtained when genotype calling was conducted with samples of higher genetic homogeneity. the effect of batch homogeneity was relatively minor by this measure. because the distribution of missing calls on samples and snps was more informative for assessing batch effect in our first experiments , we examined the distribution of call rates in the bc experiments.

the comparisons of call rates on samples are depicted by ma-like plots . figure 3a compares the results of bc <dig> with bc2; 3b compares the results of bc <dig> with bc3; and 3c compares the results of bc <dig> with bc <dig>  it can be seen that most of the data points are above the dotted lines, indicating fewer missing genotypes  when samples in batches are of higher genetic homogeneity. batch composition had a larger effect when the call rate was lower. moreover, the level of batch composition effects was related to differences in the genetic homogeneity of samples in the compared batch compositions. we quantified genetic homogeneity as gh=1n, where n is number of population groups of samples in a batch composition. the values of gh are  <dig>   <dig>  and  <dig>  for bc <dig>  bc <dig>  and bc <dig>  respectively. the d¯ values of the comparisons in figure 3a, b, and 3c are  <dig> ,  <dig> , and  <dig> , respectively. these values are positively correlated with the corresponding gh differences between the compared experiments, , , and . the p-values for all comparisons are  <dig>  × 10- <dig>  therefore, the call rates on samples between calling batch compositions are statistically different.

the comparisons of call rates on snps for bc <dig> versus bc <dig>  bc <dig> versus bc <dig>  and bc <dig> versus bc <dig> are shown in figure 4a, b, and 4c, respectively. data points at lower average call rate were farther away from the dotted line than the data points at higher average call rate; that is, batch composition affected snps with lower call rates more severely than snps with higher call rates. furthermore, more snps are above rather than below the calculated equivalent call rates  indicating fewer missing genotypes per snp  when samples in calling batches are of higher genetic homogeneity. moreover, it was further confirmed that the level of batch composition effects was related to differences in genetic homogeneity of samples in the compared batch compositions. the d¯ values are  <dig> ,  <dig> , and  <dig>  for comparisons shown in figure 4a, b, and 4c, respectively, that are related to the corresponding gh differences between the compared experiments:  <dig> ,  <dig> , and  <dig> . the p-values for all comparisons are  <dig>  × 10- <dig>  confirming that the call rates on snps between calling batch compositions are statistically different.

to evaluate batch composition effect on successful genotype calls, concordance of successful genotype calls between experiments with different batch compositions was analyzed . batch composition not only affected the genotype calls but was more pronounced at heterozygous genotypes compared with homozygous genotypes, since the concordance for heterozygous genotype calls were lower than the corresponding concordance for homozygous genotype calls. moreover, the concordance of successful genotype calls between the compared batch compositions were negatively related to genetic homogeneity differences between the batch compositions. for example, overall concordances were  <dig> %,  <dig> %, and  <dig> % for bc <dig> versus bc <dig>  bc <dig> versus bc <dig>  and bc <dig> versus bc <dig>  respectively. these are in opposite order of the gh differences of the compared experiments, that is,  <dig> ,  <dig> , and  <dig>  for bc <dig> versus bc <dig>  bc <dig> versus bc <dig>  and bc <dig> versus bc <dig>  respectively.

successful calls for both: genotype successfully called in both of the compared experiments; concordant calls : same genotype called in both of the compared experiments; concordant calls : homozygous genotype called in both of the compared experiments; concordant calls : heterozygous genotype called in both of the compared experiments.

quality of the raw data
the quality of the raw data is important for comparative analyses and interpretation. the qc scores of the  <dig> nsp cel files and of the  <dig> sty chip cel files of the  <dig> hapmap samples were calculated using dm . the average qc scores for nsp and sty cel files are  <dig>  and  <dig> , respectively. the lowest qc scores for nsp and sty cel files are  <dig>  and  <dig> , respectively. the affymetrix default qc cut-off score is  <dig>  therefore, we confirmed high qc of the raw data and used all cel files of  <dig> hapmap samples in our study.

propagation of batch effect to significantly associated snps
the objective of a gwas is to identify the genetic markers associated with a specific phenotypic trait. it is critical to assess whether and how the batch effect propagates to the significant snps identified in the downstream association analysis. three case-control based association analyses were conducted for each of the calling results with different batch sizes and compositions to assess the propagation of batch effect in genotype calling to the significantly associated snps .

after removal of low quality snps by quality control assessment, each of the three population groups  was set as "case" while the other two groups were set as "control". association analyses were conducted to identify snps that can differentiate the "case" group from the "control" group. different lists of snps significantly associated with a same population group, identified using the genotype calling results with different batch sizes and compositions, were compared using venn diagram.

the comparisons of the significantly associated snps obtained from calling results with different batch sizes are given in figure  <dig>  the significantly associated snps from bs <dig> are in black circles, from bs <dig> in blue circles, and from bs <dig> in red circles. number of significantly associated snps common in all three batch sizes is in brown, shared only by two batch sizes in green. the association analyses results for european versus others are depicted in figure 6a, for african versus others in 6b, and for asian versus others in 6c.

it is clear that the batch size effect on genotype calling propagated into the downstream association analyses. moreover, it was observed that the larger the differences between two batch sizes, the fewer the significantly associated snps shared by the two batch sizes. for example, there were  <dig>   <dig>  and  <dig> significantly associated snps shared only by bs <dig> and bs <dig>  by bs <dig> and bs <dig>  and by bs <dig> and bs <dig> for the association analyses with european as "case", respectively, that are negatively related to the corresponding differences of batch sizes:  <dig>   <dig>  and  <dig>  same trends were observed for the association analyses with african as "case" and with asian as "case".

the venn diagrams demonstrated that for a same "case-control" setting different lists of significantly associated snps were identified by the same statistical test  using the genotype calling results from different batch compositions. therefore, the batch composition effect on genotype calling propagated to the significantly associated snps. moreover, it was observed that the larger the difference of genetic homogeneity between two batch compositions, the fewer the significantly associated snps shared by the two batch compositions. for example, there were  <dig>   <dig>  and  <dig> significantly associated snps shared only by bc <dig> and bc <dig>  by bc <dig> and bc <dig>  and by bc <dig> and bc <dig>  respectively, for the association analyses with european as "case". the numbers are negatively related to the corresponding differences of genetic homogeneity in the batch compositions:  <dig> ,  <dig> , and  <dig> . same trends were observed for the association analyses with african as "case" and with asian as "case".

discussion
gwas is increasingly used to identify loci containing genetic variants associated with common diseases and drug responses. the number of snps interrogated in a gwas has grown from thousands to millions; for example, the newest affymetrix snps array  <dig>  contains ~ <dig> million probe sets. at the same time, the allele frequency difference of disease-associated or drug-associated snps is usually very small. therefore, a very small error introduced in genotypes by genotype calling algorithms may result in inflated false associations between genotype and phenotype in the downstream association analysis. reproducibility and robustness are as important to genotype calling as is the accuracy and call rate that are usually used to evaluate performance of genotype calling algorithms. as most genotype calling algorithms are based on multiple chips, and genotype calling for a gwas is usually conducted in many batches, reproducibility and robustness of multi-chip calling algorithms under different batch sizes and compositions are important variables. statistical tests of these parameters would increase the confidence for associated snps identified in downstream association analysis.

a heterozygous genotype carries a rare allele. therefore, the robustness of calling heterozygous reduces false positive associations and the chance of missing true associations. our studies revealed that both batch size and composition affected genotype calling results, especially for heterozygous genotype calling. it was also demonstrated that batch effect propagates to the downstream association analysis. genotype calling algorithms that eliminate or reduce batch effects but maintain high call rates and accuracy are preferred for gwas.

brlmm first derives an initial guess for each snp's genotype using the dm algorithm and then analyzes across snps to identify cases of non-monomorphism. this subset of non-monomorphism snps is then used to estimate a prior distribution on cluster centers and variance-covariance matrices. this subset of snp genotypes is revisited and the clusters and variances of the initial genotype guesses are combined with the prior information of the snp in an ad-hoc bayesian procedure to derive a posterior estimate of cluster centers and variances. all snps in a chip are called according to their mahalanobis distances from the three cluster centers and confidence scores are assigned to the calls. with default settings, brlmm randomly picks  <dig>  snps to estimate cluster centers and variances. but the number of non-monomorphism snps used to estimate the prior distribution on cluster centers and variance-covariance matrices varies with changing number of cel files and changing composition of cel files in the calling batches. batch size effect and batch composition effect alter these estimates of prior distribution and variance-covariance matrices. the effect of altering the number of non-monomorphism snps was confirmed when using the brlmm calling algorithm by varying the batch size and composition. the average number of non-monomorphism snps used to estimate the prior distributions are  <dig>  and  <dig> ,  <dig>  and  <dig> , and  <dig>  and  <dig>  for calling batches in bs <dig>  bs <dig>  and bs <dig>  respectively. the difference of batch sizes is related to the difference of numbers of non-monomorphism snps used to estimate the prior distribution which is, in turn, related to the difference of genotype calling results. the average number of non-monomorphism snps used to estimate the prior distribution are  <dig>  and  <dig> ,  <dig>  and  <dig> , and  <dig>  and  <dig>  for calling batches in bc <dig>  bc <dig>  and bc <dig>  respectively. differences in genetic homogeneity of samples are related to differences in the numbers of non-monomorphism snps used to estimate the prior which, in turn, is related to the difference of genotype calling results.

CONCLUSIONS
as demonstrated above, both batch size and batch composition affect genotype calling results of gwas using the brlmm algorithm. the larger the difference of batch sizes, the larger the effect. when the samples in the calling batches are more homogenous, more concordant genotypes are called. batch effect propagates to the downstream association analysis and makes the significantly associated snps identified inconsistent. therefore, we suggest from our studies that the same or larger batch sizes should be used to make genotype calls for gwas and homogenous samples should be put into the same batches.

