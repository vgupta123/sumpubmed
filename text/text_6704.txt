BACKGROUND
circadian, or approximately daily, rhythm is one of the most well studied periodic processes in living organisms. multiple studies in different tissues report that expression of approximately 5–15% of all genes show circadian oscillations  <cit> . circadian oscillation is driven by a molecular mechanism involving a few genes co-regulated by self-sustaining feedback loops, which generate the basic rhythm driving their expression. in mammals the master circadian clock is located in the hypothalamus, and its oscillation is constantly adjusted to the daily light cycle through photic stimuli from the retina. analysis of gene expression in peripheral tissues indicates that, while peripheral circadian mechanisms play an important role in different organs, relatively few genes share the same circadian expression profile in more then one tissue  <cit> .

identification of periodically expressed genes presents a significant challenge. most of the statistical methods for detection of periodicity in timeline data have been developed for much longer series than those available for computational analysis of gene expression. production of long time-series microarray experiments is prohibitively expensive. even a single time series of  <dig> time points with a minimal number of replicates costs thousands of dollars in microarray chips, equipment and labor. among publicly available data sets, few extend beyond  <dig> time points or cover more than  <dig> complete cycles. high variability and low expression level for many genes are additional challenges, further obscuring the periodicity of the base expression. the current manuscript describes a permutated time test designed to address these challenges.

RESULTS
the permutation of time algorithm
our alternative test for significance of a particular periodicity  among large numbers of gene expression profiles is based on random permutation of time points, thus abbreviated as the pt-test. to present this approach, consider a time series y = x <dig>  x <dig>  x <dig>  ...xn- <dig>  in which technical variation approaches or even exceeds the amplitude of periodic expression. in a very short time series stochastic noise often obscures periodicity. however, the periodic change of the base expression level can still be identified in spite of the high noise level. if the periodogram of the original time series iy contains a significant peak corresponding to a particular frequency  this peak results from a particular order of observation is the y. a random permutation would preserve the same noise level, but not the periodicity. let yr be a random permutation of the time series y. its corresponding periodogram is ir. after dft a periodogram ir would represent only the peaks occurring by chance. however it will miss the true periodic frequencies unless permutations happen to preserve the period, for example if the rank of each point x in permutated series yr is equal xy ± n* p where n is a natural number and p is a period corresponding to a significant peak in iy. to avoid random re-institution of periodicity we generate yr by multiple shuffling of randomly selected time points xn ⇔ xm, where |n - m| ≠ p, i.e. each shuffle is swaps time points from different phase. comparing permutations with deliberately wiped out periodicity to the original time series we can estimate whether a particular order of observations  is important. for each gene expression profile we generate two series of min random permutations. each permutated series yr is transformed to the frequency domain and a single peak of the periodogram ir is stored. the p-value for the null-hypothesis of random nature of a particular peak of periodogram can be estimated by comparing the stored ir values to the observed i:



high p-value exceeding the threshold, for example  <dig> , means that at least  <dig> out of  <dig> random permutations of time series produce a periodogram with the same or higher peak, corresponding to a given periodicity. low p-values indicate a significant difference between periodogram ir preserving circadian periodicity and randomly permutated periodogram iy with the same level of technical variation. this difference leads to rejection of the null-hypothesis of purely random nature of variation in the original time series y.

testing and benchmarking
permutation is a commonly used procedure applied for estimation of p-value. algorithms to recognize a circadian oscillatory pattern in storch et al. and panda et al. as well as many other papers employ some form of permutation. the principal difference of our test is that while we, like others, generate permutations in the time domain, we then analyze the periodograms of the permutated time series in the frequency domain. since we consider only one frequency , stochastic variations between time points have a reduced impact compared to the time-domain methods. fisher's g-test is based on the estimation of signal to noise ratio from the periodogram of a time series . it is less effective on very short time series, such as those commonly found in functional genomics studies. in such time series, typically derived from a dozen or two microarray experiments, stochastic deviations can easily exceed the underlying baseline variation, which results in high peaks for irrelevant non-circadian frequencies and an overall poor resolution capability of the method. we have developed the pt-test for short time series in order to combine the benefits of the frequency domain analysis with robust error rate estimation based on a permutation procedure.

the results of our analysis of the simulated data set with  <dig> different algorithms are presented on figure  <dig>  when applied to the simulated data with controlled properties, none of the tested algorithms have reported a significant number of false positive oscillating profiles among profiles with  <dig> amplitude baseline. as expected, all algorithms report progressively fewer oscillating profiles as there is an increasing range of the stochastic noise component ε and a decreasing signal to noise ratio. in the first  <dig> categories  all three algorithms identify 100% profiles as oscillating. in every other category our permutation test tends to find more oscillating expression profiles compared to fisher's g-test and autocorrelation.

to test the effectiveness of the new algorithm on real data we have re-analyzed three independent data sets. all of them represent murine liver time series over the equivalent of  <dig> complete daily cycles . all three utilize affymetrix genechips. however the data was acquired in different years by  <dig> different research institutes in independently designed experiments. one data set, produced by gnf  contained  <dig> time points representing samples collected every  <dig> hours, while the other two  contained  <dig> time points taken every  <dig> hours.

analysis of the locally produced murine liver data revealed more circadially oscillating genes than it anticipated from previous publications  <cit> . we applied  <dig> different algorithms; the total number of circadian oscillating genes revealed by at least one of the algorithms was  <dig> out of total  <dig> genes . the largest number of oscillating genes  is reported by pt-test, followed by autocorrelation and fisher's g-test, similar to the results on the simulated data. the venn diagram on figure  <dig> shows general agreement between the results of all the algorithms, particularly between the autocorrelation and pt-test.

another illustration of the performance and agreement between algorithms is presented on figure  <dig>  here all  <dig> gene expression profiles are sorted into  <dig> distinct groups by the phase of oscillation. to determine the phase we generate a series of ideal cosine curves with the same number of time points



, each one with a phase shift by one time point . we calculate a pair-wise correlation between gene expression profile and each phase of ideal cosine curve. the phase shift  that produces the highest correlation coefficient is assumed to be the most likely phase of a particular profile. this method is superior to assigning the phase by position of the zenith and nadir, as it takes into account ascending and descending trends in the whole data sets rather than single points. within each phase, expression profiles are sorted by ascending order of p-value estimated in pt-test, depicted as gray scale in the first column. the next  <dig> columns, fg and ac represent p-values estimated through fisher's g-test and autocorrelation analysis, respectively. although they do not follow the same exact order, both these columns display similar patterns as the pt column. the heatmap shows a characteristic pattern of two red zones  spaced by dark or green areas  prominent in all phases. in each phase group  the pattern shows some deterioration close to the bottom, but never disappears completely. this test suggests that the permutation is likely to be a correct, although still conservative, estimation of the true number of circadially expressed genes in murine liver.

in both external data sets  we have apparently identified more periodically expressed genes than was previously reported by the authors. the results of the analysis are summarized in figure  <dig>  in data sets of  <dig> time points  <cit>  and  <cit> ) all three algorithms revealed that 20–25% of all genes followed a circadian rhythm with confidence levels of at least 95%. it should be also noted that previously reported  <dig> to 15% of periodically-expressed genes was calculated in relation to the estimated number of active genes, which in turn is influenced by arbitrary selection criteria. we report both the absolute numbers and percentage of periodically expressed genes in relation to all genes present in the data set. analysis of a larger data set of  <dig> time points  <cit>  produced radically different results. fisher's g-test revealed  <dig> oscillating genes with p <  <dig> , or ~5% of all genes examined . the autocorrelation method identified  <dig> or ~13% of all genes oscillating with circadian periodicity. in contrast to the first two methods, our permutation test reported a circadian pattern in ~80% of all genes. although these values were larger than previously reported in liver  <cit> , they may still underestimate the actual number of oscillating genes. the circadian pattern  is prominent in all thee heatmaps included in figure  <dig>  this pattern extends beyond the selected p <  <dig>  cutoff.

discussion
it is likely that most genes following the circadian pattern are not linked directly to the basic circadian clock mechanism. rather, they are modulated by the downstream circadian effectors, some of which can be responsive to the supply of energy and macronutrients, which, in turn, is closely linked to the daily feeding pattern. connections between basic circadian mechanisms and nutrient homeostasis have been demonstrated  <cit> . specifically, at least two components of the basic circadian pacemaker, bmal <dig> and clock, were found to regulate glucose levels and thus, play a significant role in the energy balance. this finding is consistent with the accepted view that circadian clocks are important in driving activity and feeding behavior in mammals. this may also explain the difference between heatmaps presented on figure  <dig>  the phase groups on the heatmap of pbrc data set are approximately equal and two peaks are evenly spaced. the other two data sets have more expression profiles with poorly defined or unevenly spaced peaks and phase groups are obviously different in size. at the pbrc samples were collected from mice maintained under constant diurnal  <dig> hr light:  <dig> hr dark environment, while the two other data sets were produced under conditions simulating constant darkness. storch et al. have entrained the mice to a  <dig> h light/darkness cycle and then collected the samples after the animals were transferred to a constant dim light environment. panda et al. entrained the mice to a  <dig> h light/darkness cycle and then collected the samples after several days of complete darkness. these differences in experimental design, specifically with respect to photic stimuli, may explain the expression patterns we describe. this includes phase shifts and deregulated amplitude in the expression patterns for many genes, although not a complete loss of oscillation. our pt-test analysis of the largest collection of time series expression profiles in peripheral tissues  <cit>  leads to a conclusion that the majority of all expressed genes are affected by the circadian rhythm. direct application of the established methods for identification of circadian expressed genes to our data already revealed a larger portion of oscillating genes relative to previous reports, 20–25% vs. 5–15%. it should be also taken into account that we relate the number of revealed oscillating genes to the total unfiltered number of genes in the data set, no matter how low their expression level may be. if the same method had been applied to the external data sets, the oscillating fraction of genes reported by the original authors would have been reduced to <5%.

in addition to circadian data we have analyzed a different time series microarray data, recently published by tu et al.,  <cit> . this data represents gene expression of sacharomices cerevisae measured at  <dig> consecutive time points. the original authors report an oscillating pattern with a period of ~ <dig> min in a large part of expressed genes. this ultradian oscillating pattern reflects temporal compartmentalization of components of yeast metabolic cycle. our analysis of the same data corroborates the prominence of oscillation reported in the original paper. however, our approach allows identification of oscillating pattern in even larger portion of expression profiles. consistently with all other experiments in summarized in figure  <dig>  the pt-test identifies the largest number of oscillating genes,  <dig> instead of  <dig> reported by tu et al. this number includes practically all actively expressed genes, which is logical and expectable since the authors have postulated that the whole energy supply of the yeast cell oscillates, imposing the rhythm on all cellular processes.

CONCLUSIONS
from the analysis of both simulated and real data from independent sources we conclude that pt-test consistently reveals more circadially oscillating genes in short time series compared to the other tested algorithms and generally less sensitive to stochastic non-periodic noise. the drawback of this algorithm is that it is much more computationally demanding compared to autocorrelation or fisher's g-test. however, its effective c++ implementation allows processing of realistic amounts of data in a reasonable time on an average personal computer. typically, analysis of a complete data set takes less then an hour, which is trivial compared to the time it takes to collect the data. the source code of pt-test procedure, as well as computationally effective c++ implementations of autocorrelation, dft and fisher's g-test procedures are free and available from the authors upon request.

