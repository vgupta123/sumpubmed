BACKGROUND
recent progress in dna sequencing technologies is making it possible to determine thousands of eukaryotic genomic sequences
 <cit> . on an even larger scale, the china national genebank has launched the three million genomes  project to sequence one million human genomes, one million plant and animal genomes and one million micro-ecosystem genomes
 <cit> . to gain full use of the genomic information, the next step after sequencing is to annotate genes encoded in each genome. several genome annotation pipelines have been established and actively used in a number of genome projects
 <cit> . one of the most important products of genome annotation is a set of amino acid sequences translated from predicted protein-coding genes. obviously, the quality of amino acid sequences, which in turn depends on the accuracy of gene prediction, profoundly affects the reliability of downstream analyses, such as functional implications, 3d-structure prediction of proteins, and evolutionary inference of the genes and species. the recently emerging method of co-evolutionary 3d structure prediction requires even larger numbers of accurate protein sequences
 <cit>  than the traditional template-based homology modelling methods
 <cit> .

currently, three major categories of methods are used in computational prediction of protein-coding genes
 <cit> . the ab inito methods rely on only the statistical features of the “query” genomic sequence to be analysed; the de novo or comparative genomic methods use the information of sequence conservation and variation between the query genome and one or more related “reference” genome; and the transcript-dependent methods use known transcript sequences, such as full-length cdnas, ests, and proteins of cognate or related genomes as templates. the accuracy and coverage of gene prediction can be improved by combining several lines of information, and present annotation pipelines usually adopt several distinct categories of methods depending on the available information. although human intervention can further improve the quality of annotation
 <cit> , manual annotation by experts is impractical to apply to all the genomes whose number is growing rapidly. thus, the vast majority of genome annotations rely on high-throughput automated methods. however, assessment of the quality of the products of such procedures has not been well explored, mostly due to the scarcity of proper assessment methods.

in this work, we present gene-structure-aware multiple protein sequence alignment  as a powerful tool to evaluate and refine a set of homologous  gene structures. a gsa-mpsa is constructed from translated amino-acid sequences supplemented with the location and phase of introns along the coding sequence  of the parental  genes. our approach is based on the facts that  long insertions/deletions are rare among closely related homologous protein sequences and  positions of introns in a set of homologous genes are generally well conserved
 <cit> . thus, we can expect high reliability of gene predictions if we observe few gaps and a concordant distribution of intron positions in the gsa-mpsa. conversely, existence of long gaps or a discordant distribution of intron positions is a strong indicator of some defects including annotation errors.

although many mpsa methods have been developed so far , none is designed to incorporate the information about exon-intron organization of the parental genes. hence, we extended our iterative mpsa method prrn
 <cit>  so that conserved intron positions should gain an additional bonus in the objective function to be optimized. the resultant mpsa labelled with intron positions is parsed to see the distribution of indels and also the distribution of the concordant/discordant intron sites with the help of an outlier statistical analysis. we have also extended our spliced alignment program aln
 <cit>  so that it can use a generalized profile as the template. generalized profiles have been used in internal routines of prrn
 <cit>  to detect and evaluate gaps exactly and efficiently, where “generalized” means that various lengths of internal gaps, as well as ordinary residues, are treated in the form of a profile
 <cit> . we have implemented a tool named “refgs.pl”  that tries to successively improve individual gene structures of the members constituting the gsa-mpsa by running prrn and aln in an iterative manner. to test the performance of refgs.pl, we applied our method to the cytochrome p <dig> and ribosomal protein genes annotated in  <dig> plant genome datasets, most of which were obtained from phytozome ver.  <dig> 
 <cit> . these gene  families were chosen as representatives of two distinct categories of genes, a divergent multi-gene superfamily that codes for enzymes and a set of unique gene families that code for individual subunits of a large protein-rna complex, respectively. the results indicate that refgs.pl is highly effective at detecting various kinds of defects including annotation errors, a majority of which can be corrected by the iterative refinement procedure. external tests with est mapping and manual inspection indicated that nearly 99% of exon-intron boundaries are correctly assigned after a series of refinements by refgs.pl, and the overall quality of gene prediction is comparable with that obtained by specialists in the field.

RESULTS
performance of spliced alignment with a profile template
msas and profiles derived therefrom have been successfully used to improve the quality of various biological sequence analyses, such as remote sequence similarity search
 <cit> , prediction of secondary structure of proteins
 <cit> , protein fold recognition
 <cit> , and alignment itself
 <cit> . however, no attempt appears to have been made to examine whether the use of a profile can improve the quality of a spliced alignment, although an appreciable number of spliced alignment programs have been developed so far
 <cit>  including genewise
 <cit>  that supports profile-hmm-based spliced alignment. to test the effects of profiles, we used the same dataset, p <dig>  as that used in previous studies
 <cit> . p <dig> consists of  <dig> human genes and their mouse orthologs together with a total of more than  <dig>  homologous protein sequences used as the references . in the original study, a sequence was randomly chosen from the reference set for each bin of sequence identity level. here, we compare the results of such an examination with those obtained by a use of a profile derived from all sequences in each bin as the template. as shown in figure 
 <dig>  use of profiles significantly improves both sensitivity and specificity at the exon level. figure 
 <dig> also indicates that prediction with a close reference, if one exists, may outperform that with a profile consisting of remote reference sequences. these observations afford a foundation for our template selection modes described in the next subsection.

assessment and refinement of gene structures by refgs.pl
to examine how reliable predicted protein sequences produced by plant genome projects are, we first constructed gsa-mpsas from individual clusters of p <dig> and ribosomal proteins as described in methods. a cluster is an operational unit consisting of closely related orthologs and paralogs. by applying outlier analyses to the indels and local sequence variations, and also examining the distribution of intron positions within the gsa-mpsa, we categorized each predicted gene into “r” , “q” , or “p”  types. figure 
 <dig> shows the fractions of these types as a function of the threshold value for the defect point between “q” and “p” types . in this and most other tests, the maximal cluster size  is fixed to  <dig>  approximately the number of genomes examined. the fraction of “r”-type sequences amounts to about 80% of all sequences tested. however, the percentage of the “r” sequences of the initial annotated genes is only about 55% as the clusters were constructed from the sequences that passed two preliminary criteria . moreover, this simple evaluation method considerably overestimates “r” type genes, as the outlier analysis fails to detect abnormalities when the variance of the variables is large. for example, no indel outlier is detected in the n terminal part of the alignment shown in the additional file
1: figure s1a, although human eyes clearly perceive some abnormalities. long indels that are not recognized as abnormal by the outlier analysis were actually prevailing among the gsa-mpsas, some of which are exemplified in the additional file
1: figures s1a-f.

it is naturally expected that the accuracy of prediction of individual gene structures would be increased by improving the quality of the gsa-mpsa in which the genes participate. we designed three template selection modes and their combinations to improve the quality of a gsa-mpsa by iteration . the quality of a gsa-mpsa was examined from various aspects, such as the number of outlier indels and local sequence variations, the numbers of concordant and discordant  introns and their difference , the standard deviation of sequence lengths in variable regions, and the normalized sum-of-pairs  or normalized weighted sum-of-pairs  msa score. figures 
 <dig> and
 <dig> show the results of the iterative refinement for p <dig> and ribosomal proteins, respectively, with respect to four representative features. these figures clearly indicate that the iterative procedures improve all the features, except for Δcdi with the m <dig> mode  and the combination modes that initiate with the m <dig> mode. the m <dig> mode tends to overestimate exons when some member in the cluster contain a foreign sequence which acts as an erroneous template to incorporate false exons in other members, whereas the other two modes are robust in this respect. by contrast, the m <dig> mode is more effective than the other modes to fill in exonic regions that are missing in the original prediction. thus proper combinations of m <dig> and the other two modes perform best; cr-m1-pr, pr-m1-pr, and cr-pr-m <dig> are generally the best combinations as judged from nwsp  that incorporates various features into a single score. wilcoxon signed rank tests indicated that the mutual merits of the three combinations were insignificant .

figure 
 <dig> shows the effects of maxcluster on the performance of iterative refinement. as most quantities used for evaluation mentioned above depend on a cluster size in complicated manners, we consider only Δcdi that is not directly affected by a cluster size. for small maxclusters, cr-m1-pr refinement clearly improves Δcdi of both p450s and ribosomal proteins. however, for maxcluster =  <dig> or  <dig>  cr-m1-pr refinement worsens Δcd, which appears to largely originate from over-prediction of extra exons/introns. the est-based analyses described in the next subsection also indicate over-prediction of introns with maxcluster =  <dig> or  <dig>  furthermore, the computational time increases near quadrically with maxcluster . thus, we may conclude that maxcluster should be kept within a two-digit number, although the best choice would vary with the number of genomes under analysis, the relative frequencies of orthologs and paralogs, the qualities of initial annotation, and other factors.

est-based and manual assessments
most genome annotation pipelines utilize the results of est mapping on the relevant genome as a component of evidence-based prediction
 <cit> . hence, the false rates assessed through our mapping results are expected to be small. in fact, the sensitivity  and specificity  at the intron level  exceed 96% and 94%, respectively , when all retrieved sequences before filtering were examined. the two steps of filtering improved both sn and sp by ~1% . although marginal, cr-m1-pr refinement with maxcluster =  <dig> or  <dig> further improved sn and sp  despite the fact that no information about est mapping is incorporated in the refinement process.

in plants, the most prevalent alternative splicing events are the retained-intron type
 <cit> . hence, some est sequences may represent unspliced or aberrantly spliced isoforms, which leads to an overestimate of false positive introns. to examine this possibility, we asked whether each false positive intron position might be conserved in other homologous gene. if the relevant intron is a lonesome intron, that intron is likely to be real false positive, but otherwise that intron can be regarded as a “homology-supported” true positive intron. figure 
 <dig> shows the results after this correction . the most remarkable point observed in figure 
 <dig> is that the fraction of “pure” false positive introns  of p450s is dramatically reduced by the cr-m1-pr refinement, suggesting the efficacy of our refinement procedure. no improvement was observed for ribosomal proteins probably because the original false positive rate was already quite low.

one caveat of this type analysis is that the introns thus examined do not necessarily belong to the genes under investigation; if a prediction erroneously contains an extra genomic segment that is expressed as a distinct transcriptional unit, the est-based assessment may regard such extra exons/introns as true positives. to synthetically evaluate the integrity of the predicted gene structures, we also conducted detailed analysis of the amino acid sequences of p450s encoded in two representative genomes, peach
 <cit>  and maize
 <cit> . the peach gene models were obtained by a typical automated pipeline that combines several gene prediction algorithms, whereas ~60% of the maize p <dig> genes were manually curated by one of the present authors. the full maize genome was annotated by the gramene pipeline
 <cit> , that takes advantage of extensive maize full length cdnas and closely related well annotated genomes like rice. we found that gsa-mpsas as shown in additional file
1: figure s <dig> are helpful for manual assessment as well, and could unambiguously infer true gene structures for more than 90 ~ 97% of seemingly genuine or nearly complete genes. although almost all existing annotations disallow frame shifts and premature termination codons and hence the genes are truncated or the affected exons are skipped, our method properly accommodates such defects. if a gene harbours a single such defect but otherwise looks intact, we regard the gene as near complete, whereas if a plural number of defects are found, the gene is regarded as a pseudogene. the most common ambiguity is the location of a translational initiation site , when two or more initiation codons are closely arranged in the same reading frame. we regarded a variant as either erroneous or near correct depending on whether the n-terminal hydrophobic transmembrane domain, which is ubiquitous among all microsomal p <dig> proteins, is truncated or not. besides this type of ambiguity, only three of peach and four of maize genes remained uncertain with respect to their exon-intron organizations. as summarized in figure 
 <dig> and detailed in the additional file
2: table s <dig>  the cr-m1-pr refinement augmented the number of correctly or near-correctly predicted p <dig> genes in the peach genome by  <dig> , and only five genuine genes contained errors after the refinement. by contrast, cr-m1-pr refinement introduced  <dig> new errors that were absent in the initial annotation, while it remedied  <dig> errors in the original annotation. thus, we may conclude that our refinement method is not perfectly accurate but at least as effective as manual curation by specialists in reducing the errors in gene prediction by an automated method.

discussion
for human and several model organisms
 <cit> , the catalogue of their protein-coding genes is nearly complete. the situation is completely different for the vast majority of organisms whose genomic sequences are recently revealed. although high-throughput gene annotation pipelines are widely used, the accuracy of such products has not been well studied. to our knowledge, mispred
 <cit>  is the sole practical tool to search for potentially erroneous annotations. to evaluate the reliability of a prediction, mispred examines macroscopic features of the predicted amino acid sequences. accordingly, mispred is not necessarily effective to discover individual defects, especially subtle defects. moreover, mispred affords no way to correct annotation errors it finds. we have shown here that a gsa-mpsa constructed from close homologues provides rich information about the reliability of each predicted gene structure. thanks to the recent progress in many genome projects undertaken in parallel, collection of appropriate homologs is now much easier than a few years ago. we have also shown that gsa-mpsa can facilitate not only evaluation but also refinement of the predicted gene structures. the improvement in the quality of prediction is demonstrated from various viewpoints as shown in figures 
 <dig> and
 <dig>  however, a more direct impression would be obtained by looking into the alignments themselves. additional file
1: figure s <dig> presents several examples of gsa-mpsas of the same genes before and after refinement. the smaller numbers of indels and better aligned intron positions after refinement compared with those in the original gsa-mpsas will give an intuitive support for the efficacy of our refinement procedure.

in essence, our refinement strategy relies on the consensus or the “decision by majority” rule. in general, consensus-based approaches fail when the initial predictions are scarce, poor, or highly heterogeneous. in fact, of the  <dig> clusters of p <dig> and  <dig> clusters of ribosomal proteins with maxcluster =  <dig>  the cr-m1-pr refinement worsened the nwsp scores for  <dig> and  <dig> clusters , whereas the nwsp scores remained unchanged for  <dig> and  <dig> clusters  and improved for the rest of the  <dig> and  <dig> clusters , respectively. in addition,  <dig> p <dig> and  <dig> ribosomal protein sequences didn’t belong to any cluster due to the lower limit in the minimal size of clusters and had no chance to be evaluated or refined. roughly speaking, therefore, our refinement procedure is effective or neutral for about 93 ~ 96% but inadequate for about 4 ~ 7% of sequences that passed the two filtering criteria .  one potential way to cope with these difficult cases would be to improve the profile method so that more distant homologs can be used as the templates, or pre-annotated sequences from human curated datasets could be used. in addition, the  <dig> plant transcriptome project now in progress
 <cit>  will provide a broad sampling of plant gene diversity including distant homologs currently lacking as templates.

by counting the defect points, we estimated that about 80 ~ 84% of the original sequences that passed the two filtering criteria are regarded as “r” type . by the cr-m1-pr refinement, the fraction of the “r” type genes are increased , and we estimate that about 58% of p <dig> and about 70% of ribosomal protein genes in the initial annotations are likely to be genuine. however, the cr-m1-pr refinement modified the gene structures of a large fraction of the original predictions. as a result, only about 40% of p <dig> and about 50% of ribosomal protein genes in the original annotations remain unmodified and are regarded as defect free after the refinement . as demonstrated by manual assessments, not all the changes are improvements, but the above discussion about nwsp scores suggests that at least 90% of the modifications are likely to be real improvements.

as our method does not directly refer to the available cdna/est information, the assessment based on the est mapping results can be regarded as an external test. we consider that the sensitivity and specificity of 97 ~ 98% at the intron level and 98 ~ 99% at the junction level are quite high. one reason for this high accuracy might be because the original annotations had already incorporated est mapping information and some annotations had been manually curated. it is an interesting next theme to examine how our approach performs without relying on existing annotations.

in the present study, we analysed ca.  <dig> p <dig> and ribosomal protein sequences. although the phytozome dataset are generally well organized, the formats of gene annotation of various resources are not completely uniform, rendering the preparation of the initial sets of amino acid sequences supplemented with parental gene structure information rather laborious. once the initial setting was completed, however, the entire process including clustering, assessment, and refinement finished within an hour on our computer system  when maxcluster is set to  <dig> or smaller . it was feasible because the post-clustering processes are executable in parallel, where we used ten cores/threads in the present experiments. thus, it would not be much additional burden to analyse an order of magnitude larger number of sequences in a personal computational environment, and this may be scaled further with an institutional computer system.

CONCLUSIONS
we have shown that gsa-mpsa-mediated refinement of eukaryotic gene structures is a useful automated strategy to dramatically improve the overall prediction quality of a set of homologous genes. our method will be applicable to various families of protein-coding genes if their domain structures are evolutionarily stable. it is also feasible to apply our method to gene families in any kingdoms of life. the c++ source codes of aln, prrn, and spaln, the engines of our strategy, are available from our web site
 <cit> . the perl scripts of refgs.pl that organizes the refinement process together with source codes/scripts of the associated programs are also made available from the same site as prrn/aln.

