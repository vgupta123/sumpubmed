BACKGROUND
genome wide association  studies usually evaluate data from thousands of individuals. identifying the subpopulations within the data set and inferring biogeographic origins of the samples are important steps in the conduct of any study. not allowing for population substructure in the analysis will introduce false positives  <cit> . furthermore, one usual step in quality control procedures checks for hardy-weinberg equilibrium, often just in the controls. if the population being studied comprises two or more subpopulations, hardy-weinberg equilibrium will be violated for any snps with variability in allele frequencies among the subsets. two software packages are widely used in analysis of substructure: structure and eigenstrat. structure assumes each individual may inherit a proportion of its ancestry from multiple distinct populations and then estimates an ancestry proportion for each subpopulation  <cit> . the setup of running structure is complex as it requires tuning multiple parameters. also when large samples are involved, structure requires considerable computational time. eigenstrat, implementing the program smartpca, uses principal component analysis  to model ancestry variation among the samples . pca has been a standard procedure in population genetics studies for over 30 years. the continental origin variations in allele frequencies among individuals can be elaborated in a lower dimensional space using the derived eigenvectors to score individuals. however, pca does not fulfill the requirement of ancestry inference as it does not estimate the proportional ancestry origin of each individual. furthermore the current implementation of eigenstrat returns eigenvectors for a specific population that cannot be generalized to another sample. to extend the use of pca in association analysis and develop a fast and accurate method for ancestry inference, we have developed fastpop, an r package that allows users to estimate the proportion of intercontinental ancestry for each individual. furthermore, the scores derived from pca analysis in fastpop can be generalized to other studies provided the same set of markers are used. human population history tends to follow gradients of gene flow  <cit> , and we have incorporated flow among major populations to assist in assignment of major ancestral origins of participants.

implementation
principal components analysis
we selected  <dig> snps across the whole genome based on having a large fixation index  value among european, african and asian populations for pca analysis. we conducted pca analysis of  <dig> hapmap samples with european, african or asian ancestry along with a collection of  <dig> additional samples of unknown ancestry. to perform pca, we use the eigendecomposition method, which parses the covariance relationships among markers.

define xn×p=x11⋯x1p⋮⋱⋮xn1⋯xnp, where n and p are the number of samples and snps, respectively.

for the mean-centered data matrix, we need to compute the mean on each snp, x¯.j=∑i=1nxijn,wherei= <dig> ⋯,nandj= <dig> ⋯,p. 

then, we generate the mean-centered data matrix as yn×p≡x11−x¯.1⋯x1p−x¯.p⋮⋱⋮xn1−x¯.1⋯xnp−x¯.p. 

assume that there are larger number of samples than number of snps . we construct the covariance matrix as cp×p=1n−1⋅yty. 

since the covariance matrix c is symmetric and positive definite, the eigenvalues of c are real and positive semi-definite. the eigendecomposition of covariance matrix c can be applied to calculate the eigenvalues λi and the eigenvectors vi of c satisfying that cv¯i=λiv¯i. 

which can be written in matrix form as cv = vΛ,

where Λp×p=λ100λ200⋯00⋮⋱⋮000⋯λp is a diagonal matrix with diagonal eigenvalues λi.

in pca, the λi in Λ are extracted according to size descent order  and the matrix vp×p=v¯1v¯2⋯v¯p consists of eigenvectors corresponding to λi.

for our purposes we find that selection of snps to maximize interancestral variability ensures that the first few eigenvectors capture interpopulation variation. we therefore obtain a low dimensional projection, score matrix zn × k = yn × p × pp × k . where k =  <dig> or  <dig> is adequate for capturing ethnic similarities when considering  <dig> or  <dig> continental origins respectively. the eigenvectors are pp×k=v¯1v¯2⋯v¯k. 

once we select the first k eigenvectors, named as snp weights, which we would like to keep among the principal components computed from the discovery data, we can predict new scores in the new data using pre-computed snp weights.

let um×p=u11⋯u1p⋮⋱⋮um1⋯ump be a new data with m samples and the same p snps as in the original analysis. then, generate the mean-centered matrix, wn×p≡u11−u¯.1⋯u1p−u¯.p⋮⋱⋮un1−u¯.1⋯unp−u¯.p.

using the snp weights pp × k from the original analysis, compute the new score matrix, z*n × k = wn × p × pp × k . for prediction of new score matrix, we recommend that the snp weights should be generated from large samples  to avoid variance shrinkage if the eigenvectors will be applied to a subsequent data set  <cit> .

ancestry analysis
we started with three well characterized continental populations, studied by the hapmap consortium of european, asian, and african descent, since characterizing ancestry for these populations is often a major goal in genome-wide association studies. the centroid of each known hapmap population was characterized by the multivariate mean of the first and second score . a triangle reflecting the usual clines of intermarriage among continental groups was created by connecting the lines connecting the centroids . six lines perpendicular to the triangle sides and originating at the centroids were obtained . individuals of unknown ancestry can be divided into three groups based on their location relative to the triangle: points in area 1– <dig> are classified as 100 % european, african or asian ancestry, respectively; points in areas 4– <dig> have mixture origin of two adjacent populations; points in area  <dig> have a mixture origin of european, african and asian ancestry. for points in area 4– <dig>  the distance between the closest point on the triangle was identified and the admixture proportion is the proportional distance to each centroid. for example, for a sample in area  <dig>  if the distances along the european-african line are l <dig> to the european and l <dig> to the african centroids, then the proportion of european ancestry for this individual is computed as p=1l11l1+1l <dig> , the proportion of african ancestry is 1-p. for a point inside the triangle, let h <dig>  h <dig> and h <dig> denote the distance between the point and the three sides of the triangle; l1-l <dig> denote the distance between the point and the nearest perpendicular projects onto the ancestry triangle. the proportion of european for this individual is then computed asfig.  <dig> proportion of ancestry inference using first and second pca score. x and y axis denote the first and second pca score generated by fastpop. red, blue, green and black denote hapmap samples with european, africana, asian ancestry and studied samples with unknown ancestry. the centroids of each population were computed for hapmap samples. three lines in dark green were drawn connecting the centroids; six extra line perpendicular to triangle sides and across the centroids were drawn in grey. individuals in area 1– <dig> are classified as pure european, afrian and asian origin; samples in area 4– <dig> have mixture origin of two adjacent populations; samples in area  <dig> have mixture origin of european, african and asian ancestry. h <dig>  h <dig> and h <dig> denote the distance between the samples in the triangle to the sides of the triangle; l1-l <dig> denote the distance between the image of the sample at the triangle sides and the population



p=1h1×1l11l1+1l2+1h3×1l61l6+1l5/1h1+1h2+1h <dig> , with similar calculations yielding the proportion of african and asian ancestry. hapmap samples can be downloaded from http://hapmap.ncbi.nlm.nih.gov/downloads/genotypes/hapmap3_r3/plink_format/.

the approach can also be generalized to include additional populations. when we plotted the first three pc scores for individuals coming from four distinct populations , we observed a three-dimensional tetrahedron instead of a two dimensional triangle for three populations, which suggested we could extend the triangle algorithm to a tetrahedron-based algorithm to incorporate four populations. when applied to four populations, a similar approach to that taken for  <dig> populations is employed. we first define regions for which the closest point to an ancestry tetrahedron is a vertex, and for those individuals, a single continental ancestry is assigned. for points outside the tetrahedron but closest to a side, we project to the nearest face of the tetrahedron  and then use equation  <dig> to estimate the proportions of ancestry for each of three origins for that face. for points inside the tetrahedron, an extension of equation  <dig> to encompass a mixture of  <dig> populations is applied. in this case, the projections are to each of the four faces of the tetrahedron. for interior points, once the sample was mapped to the two-dimensional face , we applied equations  <dig> and  <dig> developed for three populations to estimate the proportions of european, asian and native american  on this surface. we then performed the estimation of ancestry for each ancestry plane as indicated above for equations  <dig> and  <dig>  for interior points the final estimated proportion of each ancestry is the average of the proportions from each of calculations.

software implementation
in order to use fastpop, users need to provide the input file in a correct format. fastpop takes the cleaned genotype file coded in additive model as the input file. the usual options for data cleaning includes removing individuals or snps with a high missing rate. we observed that an additional “population” may be identified when the missing rate for the samples was higher than  <dig> . it is also critical that the snp genotype data are in forward strand and it is easy to use plink to flip the alleles. we provided the reference allele file in the package for users to check the allele information.

there are two steps using fastpop: first, fastpop will compute scores for individuals based on eigenvectors from pca analysis; second, it will estimate the proportional ancestry of each individual based on the scores generated in first step . fastpop is implemented in r programing language. the function “predictionpcascoring.r” enables the user to compute scores based on eigenvectors from pca analysis given by  <dig> snp weights; create a plot to visualize the scores and compare scores of the studied samples with  <dig> hapmap samples with known ancestry. the function “intercontinentaldistancemetrics” calculates the proportion of each continental ethnicity from scores of individuals and this function also works for inference using eigenvectors as input directly. the output file is ancestry.out which has six columns including sample id, first pca score, second pca score, proportions of european, african and asian ancestries. the whole package is freely available at https://sourceforge.net/projects/fastpop/files.fig.  <dig> flow chart of intercontinental ancestry analysis using fastpop



RESULTS
we applied fastpop on intercontinental ancestry analysis of a data set including  <dig> individuals from studies performed in the u.s. and europe primarily of european descent, but with some additional self-reported african-american and asian members. we used a large sample size to avoid any potential for overfitting and to ensure the intrasample variance is consistent for application to future studies. in order to evaluate the results from fastpop, we also ran structure on the same set of data to benchmark our results. structure was run without/with prior population information for hapmap samples. for each individual, we compared the estimated proportions of european, african and asian ancestry between fastpop and structure. the results from fastpop are highly consistent with those found using structure across the  <dig> samples . the correlations of the results between fastpop and structure are  <dig> ,  <dig>  and  <dig>  for european, african and asian, respectively. further, we studied different cutoff values of estimated proportions of ancestry from  <dig>  to  <dig>  to assign the individuals to each continental ancestry, and fastpop had similar accuracy compared with structure. for example, when we used a stringent cutoff value of  <dig>  in both fastpop and structure, >95 % of the individuals identified by structure were also identified by fastpop. when the cutoff value was relaxed to  <dig> , the concordance rate increased to  <dig>  % . while fastpop retains the same level of accuracy as structure, it is much faster in performing the analysis compared with structure. fastpop finished ancestry inference for  <dig> samples in 16 min, while structure required 21 h when implemented without prior ancestry information and 24 h when implemented with prior ancestry information for hapmap samples. structure was run with parametric settings “burnin  <dig> numreps  <dig> inferalpha  <dig> popspecificalmbda 1”.fig.  <dig> comparison of estimated proportion of ancestry between fastpop and structure for  <dig> individuals. x and y axees denote the proportion of ancestry for each individual from fastpop and structure

number in each cell indicates: no. assigned by structure/no. assigned by fastpop/no. common in both methods. structure analysis was conducted with/without prior population information for hapmap samples. structure was run was run under admixture model. parameter setting “burnin  <dig> numreps  <dig> inferalpha  <dig> popspecificalmbda 1”. without prior population information, the running time is 21:16: <dig> and 23:30: <dig> for with prior population information



we also tested the algorithm on a data set comprising  <dig> individuals with european, asian, african ancestry from the hapmap consortium along with  <dig> individuals of native american ancestry derived from the human genome diversity panel, along with  <dig> mexican individuals with mixed ancestry. points at or closest to the four vertex corners were designated as 100 % european, asian, african or native american, respectively . the mexican samples had a mixed ancestry and all the points lay within the ancestry-defined tetrahedron . for individuals with mixed ancestry we projected the samples to the faces of the tetrahedron . we compared the results from the extended fastpop and structure for the four population ancestry inference, and the results were highly consistent between methods. the concordance rates were greater than 97 % in all the four populations . and the correlations for the estimated proportions between fastpop and structure were all greater than  <dig>  for the four populations. the  <dig> mexican samples had a mixed ancestry and they were identified as mixed population by both structure and extended fastpop . as noted in the methods above, individuals outside the ancestry tetrahedron are mapped to the nearest part of the tetrahedron and analyzed according to equation  <dig> fig.  <dig> panel a displays four intercontinental populations and one mixed population in 2-dimensions. tetrahedron model in b can be applied to the extended intercontinental analysis. european, asian, african, and native american are four distinct populations and denoted in red, green, blue, purple, respectively. mexican american is mixed population and represented in black. each intercontinental population has three combinations derived for each face in the tetrahedron. first, fastpop is applied to infer ancestry on each face of tetrahedron and then average proportions over each intercontinental population are used to summarize ancestry



discussion
there are broadly two types of clustering methods: distance based methods and model-based methods. the algorithm of fastpop is based on distance. we first map each individual using pc values as coordinates and the joint probabilities of ancestry are based on how close each individual is to each centroid or nearest elements of ancestry surfaces. structure is a model-based method. it assumes that each cluster  is modeled by a characteristic set of allele frequencies and the main modeling assumptions are hardy-weinberg equilibrium within populations and complete linkage equilibrium between loci within populations  <cit> . structure applies a bayesian approach to infer the ancestry of each individual and allele frequency from all populations. so fastpop and structure have completely different algorithms although we showed that the results from fastpop are highly correlated with that from structure in our study. fastpop is a distance-based method and it conducted mathematic calculations using distance on the coordinates which is very straightforward and fast. however, structure uses a bayesian method for inference of ancestry and it applies mcmc algorithm to achieve final desired distribution in computation. as shown by equations  and , calculations in fastpop do not require iteration to solve the principal components and therefore we find that fastpop works very well for moderate samples sizes such as those we have studied here and that the scoring method can then be applied effectively to any sample size. if an investigator wanted to apply our approach to a very large dataset comprising over  <dig>  subjects we have found that substituting pca with matrix inversion with a singular value decomposition method or with a random vector analysis will reduce computation time compared to application of standard pca  <cit> .

pca has become a standard procedure in population genetics study for substructure analysis. the eigenvectors from pca are easy to use for population adjustment in gwa studies. however it lacks the ability to provide clear information for ancestral origin. to fill this gap, we developed an efficient tool for inference of ancestry with pca scores as the input. the pca scores generated by fastpop can be used to identify ancestries of individuals or could be used to adjust for population structure in association analysis. the scores are based on snp weights so the scores of reference population such as hapmap samples can be applied to other studies provided the same set of markers are used. this characteristic is attractive especially in large consortia studies when multiple independent studies may be analyzed by individual laboratories. the pca scores generated in one site can be adopted by other sites thus to reduce the repetitive work and ensure consistency among analyses. in current gwa studies, sample sizes keep increasing and now involve tens of thousands individuals. fastpop can be more efficiently implement than structure in analyzing data with a large sample size.

fastpop provides the estimated centroids from a training set considering the users may have a small data set and may require a golden standard for the centroid positions for the populations. theoretically, the triangle model in fastpop will work without training samples. when the sample size of a data comprising of three populations is big enough, we can calculate the centroids position for each population based on the principal component values from the study samples instead of deriving centroid positions from hapmap samples. we also tested this idea by inferring ancestry for  <dig> study samples without using hapmap samples, and the correlations of the results between fastpop and structure were still > 95 %. for this approach, one needs to define a set of centroids for defining ancestral origins.

as a further comparative analysis, we also evaluated linear discriminative analysis  method applied to pca scores as input to predict ancestry. compared to lda, fastpop had better performance in terms of the estimated proportions, consistent performance across different cut off values for decisions and a lower excess positive rate for europeans. we are using the term ‘excess positives’ here to denote the classification of individuals who may have multiple ancestries into a single ancestry group by lda . the improved performance of fastpop over a more generic application of lda reflects the application of clines relating more typical intermarriages along continental clines as opposed to the more generic model that is required by lda.

the version of fastpop released to sourceforge includes an input file with  <dig> snps that differentiate european, african and asian very well across the whole genome. the  <dig> snps were derived from our study population to maximize variation among european, african and asian populations. however, any set of markers that differentiates european, african and asian can be applied in the analysis. we have provided a set of markers for the users so they do not need to choose a set of ancestry informative markers for the analysis. if some of the snps are missing from the input file, the researchers can replace the missing genotype with average of genotype from the samples we provided in the package. fastpop can be implemented for different sets of markers and the locations of three centroids would then need to be recomputed either using user supplied samples or hapmap samples with a different set of markers.

fastpop is based on a trianglular algorithm so theoretically it works for any data including different intercontinental populations provided the ancestral origins provide reasonable fit to a triangular origin. in this study, we evaluated the performance of fastpop in differentiating individuals with either a mixture of european, african and asian or with additional native american ancestry. the preponderance of studies requires analysis of samples without consideration of origins, which are the three major ancestries in most genome-wide association analysis.

the currently released fastpop has been released to characterize genetic data involving three ancestries and is available upon request for four ancestries. theoretically, our algorithm can be applied to an arbitrary number of populations, but the algorithm becomes more complex as the number of dimensions increases. we also have assumed that that the number of dimensions that need to be characterized is one less than the number of populations.

CONCLUSIONS
we developed fastpop, an efficient r package that can be applied to ancestry study on genotype data including three intercontinental origins. the pca scores generated by fastpop can be included for population structure adjustment or classification into major ancestral groups. additionally, the method can be applied for large studies to ensure comparability of results among participating sites. the algorithm based on pca score mapping can also be extended to multiple population inference. we have applied fastpop in the analysis of data from the oncoarray consortium, which has genotyped  <dig>  samples, because we needed an approach that could be readily applied across this large consortium. we anticipate that our approach would be of value to other investigators performing coordinated analyses across large consortia.

availability and requirements
project name: fastpop software

project home page: https://sourceforge.net/projects/fastpop/files/

operating system: linux

programming language: r

other requirements: none

license: none

any restrictions to use by non-academics: none

ethics, consent and permissions
this study has been approved by the committee for the protection of human subject  – the institutional review board  at dartmouth college. all human subjects involved in this study consented to research involving genetic analysis. all individuals signed institutional review board approved consent documents related to genetic analysis of germline samples. samples were deidentified prior to analysis. all the analysis was performed at dartmouth college.

additional file
additional file 1: supplementary materials. 

 competing interests

the authors declare that they have no competing interests.

authors’ contributions

ca and ig developed the approach. yl, jb, oc, gc, jd, yh, ms and ca contributed to the design of the algorithms. yl, jb, oc, and gc wrote the code for fastpop. yl drafted the manuscript. jb and yl released the package. all authors read and approved the final manuscript.

