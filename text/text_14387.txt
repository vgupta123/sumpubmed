BACKGROUND
genes of the mhc encode cell-surface proteins responsible for the recognition and presentation of foreign antigens to t-lymphocytes, which then initiate an immune response against pathogens  <cit> . the mhc is known to be the most variable gene group in vertebrates, both in terms of allelic diversity and gene number  <cit> . numerous studies have suggested that selection from parasites is the major factor driving this polymorphism, whereas the role of sexual selection has also been demonstrated in several species  <cit> . interest in understanding mhc genes is growing significantly as more studies demonstrate implications of their diversity in the context of survival  <cit> , mate choice  <cit> , conservation  <cit>  and even speciation  <cit> . the number of mhc genes can differ greatly between and within species, and may show no sequence orthology between genera or orders – e.g. class i gene number and organization differences between human and chimpanzees . differences in the number and organization of mhc genes are explained by a birth and death model of evolution  <cit> . according to this model, new genes are formed by duplication events and, while some retain their function in the genome, others are inactivated or deleted  <cit> . because an individual mhc molecule can recognize and bind to a few antigens only, which is determined by the amino acid composition in their antigen-binding site , gene duplications and polymorphism at the abs are thought to be adaptations enabling individuals to respond to a greater variety of antigens  <cit> .

the mammalian mhc is a gene-dense region that is divided into subfamilies with similar function. class i and class ii genes are considered ‘classical’ mhc genes to indicate their polymorphic, highly expressed, structure; and antigen processing and presenting function. in sharp contrast to mammals with multiple class i and ii loci, the avian model organism, the chicken has a “minimal essential mhc”, a term referring to its surprisingly small, densely packed mhc region with only two class i and ii genes  <cit> . however, recent studies have shown that “minimal essential mhc” does not hold for other avian orders, as a larger number of class i and ii genes have been detected in passerines  <cit> . the recent in-depth characterization of zebra finch mhc demonstrated that more than ten mhc class i and class ii loci are located on different chromosomes in this species . many of the genes were suspected to be pseudogenes and only one mhc class i locus appeared to be transcribed, contrasting to the pattern observed in other passerine species, where many functional class i loci have been described  <cit> . similarly the recent characterization of mhc class ii loci exon  <dig> in the collared flycatcher revealed the presence of at least nine expressed  loci, confirming the complexity and variable evolutionary dynamics of this region in passeriformes  <cit> .

the presence of multiple loci and high allelic diversity in passerines make them intriguing species for mhc studies as they are potentially under strong selection, and thus can provide valuable information on the mechanisms maintaining mhc polymorphism. however the complexity of multilocus mhc genes also poses a great challenge for accurate genotyping. in species where the mhc has undergone rapid duplication, gene conversion and recombination, the genes are often tightly linked to each other and alleles are shared among loci, making it almost impossible to identify and isolate independent loci. therefore simultaneous amplification of multiple loci becomes necessary in such systems  <cit> .

it is surprising that until recently the importance of accurate genotyping has been somewhat neglected in species harbouring complex multilocus mhc systems  <cit> . initial characterization of mhc genes is essential to fully understand the architecture of the system and to design primers that would potentially amplify all the alleles of interest, so that precise genotyping could be achieved  <cit> . moreover the fact that some alleles might be non-functional further complicates the situation and obligates the differentiation of functional alleles from the non-functional ones through historical selection tests and screening of cdna libraries. the method chosen for mhc genotyping is also of great importance. there are a few indirect genotyping techniques that have been widely used to date; although these methods require extensive initial optimization, often necessitate further characterization via cloning and sequencing, and are still insufficient when genotyping complex multilocus systems . the application of next generation sequencing  methods for mhc screening has recently been introduced as a promising alternative to the conservative typing methods and has the potential to provide high resolution, accurate and large-scale genotyping, thus solving three problems that have plagued previous studies in this field  <cit> . especially in projects where sample sizes are high, 454-pyrosequencing may outperform the other methods both in terms of the time it takes and per sample cost. one major drawback of the application of high-throughput ngs is its error-prone sequencing technology; therefore strict quality control is crucial to distinguish true alleles from sequencing artefacts . to date relatively few published studies have used 454-pyrosequencing method for mhc genotyping in non-model vertebrates; all succeeded in identifying real and artificial sequences. the repeatability of the results was confirmed for all but one, by cloning or running a fraction of the samples in duplicates  <cit> . in one study, that by zagalska-neubauer et al.  <cit> , the repeatability of the duplicate samples was low, because the coverage of reads was not sufficient for reliable genotyping. however this did not prevent full characterization of diversity at species level.

these recent studies demonstrate that  <dig> or similar technologies can be employed for accurate typing of complex mhc loci. reliable genotyping of multilocus mhc alleles is, however, still not sufficient for determining what equates to functionally important alleles. mhc alleles commonly share the same abs aminoacids and have similar antigen-binding motifs; hence their allelic differences are not always functionally relevant . therefore a growing body of evidence across taxa highlights the importance of clustering mhc alleles into functional supertypes and considering these supertypes as the unit of selection  <cit> . for instance trachtenberg et al.  <cit>  showed that rare human leukocyte antigen  supertypes confer a strong advantage in responding to hiv infection, independent of the contribution of single alleles.

here, we describe an approach for characterizing and genotyping mhc class i loci exon  <dig> in natural great tit  populations. genes of mhc class i have been shown to influence avian malaria resistance  <cit> , female mate choice  <cit>  and extra-pair paternity  <cit>  in other passerine species. initially we undertook a comprehensive characterization effort to detect the diversity of allelic variants at exon  <dig>  and used  <dig> pyrosequencing for genotyping. using this technique we genotyped a fragment of mhc class i exon  <dig> of several hundred great tits simultaneously; and applied a stepwise variant validation procedure to separate true alleles . then we differentiated the functional alleles from the non-functional ones, first by investigating the presence of stop codons in sequences and examining the phylogenetic relationship between allelic clusters, and secondly through historical selection tests. finally we clustered the mhc alleles into functional supertypes, to determine the biologically meaningful mhc variants of each individual. our main aim was to describe an approach for accurate mhc characterization and typing, a crucial prerequisite for studies investigating the role and importance of complex mhc loci in non-model vertebrates.

methods
samples and dna extractions
we analyzed  <dig> first year or adult great tits, sampled between 2006– <dig> in wytham woods and bagley woods nest-box breeding populations. both populations have been monitored continuously since the 1960s and 1990s respectively, and are located within a few km of oxford, uk. all great tits were ringed with aluminium bands for individual recognition. blood was collected by wing or jugular venipuncture under uk home office licence , and stored in set buffer at −80°c until dna extraction. total genomic dna was extracted using standard ammonium acetate method and stored in ae buffer . dna concentration was measured using a picogreen assay  and samples were diluted to 5-20 ng/μl when necessary.

development of primers
we used degenerate primers hn <dig> and hn <dig>  <cit> , as well as primers t3f and gtjsf in the 3′ direction and gbt3r and gtjsr in the 5′ direction, identified from the alignment of tit sequences available in ncbi  to isolate complete and partial exon  <dig> sequences. then we designed specific primers within this exon using the consensus from these sequences . mhc class i exon  <dig> was chosen as the target region, as it bears most of the abs. pcr reactions were run using platinum® taq dna polymerase kit . pcr amplification was performed in 25 μl reactions, with the following final concentrations: 1x pcr buffer,  <dig>  mm mgcl <dig>   <dig>  μm of each primer ,  <dig>  units of platinum taq polymerase  and  <dig>  mm of each dntp. 2 μl of extracted dna  was added to this mix. the reaction was run for  <dig> cycles at 95°c for 45 s, 57°c-65°c for 45 s and 72°c for 45 s on a geneamp pcr system  <dig> thermal cycler . pcr products were purified using minelute  <dig> uf pcr purification kit , ligated in plasmid vector and transformed to bacteria using pcr8/gw/topo ta cloning kit . each primer pair was tested on four individuals – two males  and two females  that were sampled in different areas of the population. twelve clones from each individual were randomly selected and reamplified using the same pcr conditions. the amplicons were sequenced directly by dye terminator cycle sequencing  and loaded on an abi prism  <dig> automated sequencer . the sequences were edited in sequencher version  <dig>    <cit>  and aligned using bioedit sequence alignment editor  <cit> .

the primers were developed in the order from top to bottom . mhcd-f and mhcd-r are the final primers designed for  <dig> pyrosequencing. f indicates forward and r indicates reverse primers. gdna indicates amplification of genomic dna and cdna indicates amplification of cdna libraries with the specified primer.

after isolating a large number of variable mhc class i sequences, we used the consensus from the obtained sequences to design a degenerate primer pair  that would potentially amplify all the expressed alleles that are present in the great tit. by using these degenerate primers we aimed to minimize the risk of missing out a fraction of allelic variation that might bias the results of the studies to follow. the primers amplified a 212– <dig> basepair fragment  of mhc class i exon  <dig>  in the great tit. four individuals were amplified with the primers under the same pcr conditions and 65°c for annealing temperature. the pcr products were cleaned, cloned and sequenced as described above.

rna extraction, cdna synthesis, rt pcr
total rna was extracted from four great tit blood samples for expression analysis. blood samples collected via jugular venipuncture were immediately placed into rnaprotect animal blood tubes  for rna stabilization and were stored at 4°c overnight. rna isolation was done using rneasy protect animal blood kit  and reverse transcription was carried out with omniscript reverse transcription kit . first strand cdna was synthesized in a final volume of 20 μl with the following conditions: 1x buffer rt, 1 μm of oligo-dt primer,  <dig> units of rnase inhibitor,  <dig> units of omniscript reverse transcriptase,  <dig>  mm of each dntp and 1 μl of template rna. the mixture was incubated for 60 min at 37°c and a 2 μl aliquot of the finished reverse-transcription reaction was used for two-tube rt-pcr. we used four different primer pairs for rt-pcr  and adjusted the same pcr conditions that we described for genomic dna amplification. again the pcr products were cleaned, cloned and sequenced.

tagged primer design; amplicon preparation, dilution and pooling
 <dig> pyrosequencing was performed on  <dig> genomic dna samples from  <dig> great tits, collected between 2006– <dig> in wytham and bagley woods; and cdna libraries of four wytham wood great tits. the individuals with cdna libraries were not included in the genomic dna sequencing panel, since the rna stabilization step prevented dna isolation from these samples. forty genomic dna samples were randomly chosen and ran in duplicates to estimate the repeatability of the results. in order to maximize the throughput for  <dig> great tit samples from the bidirectional sequencing run, we used the  <dig> regions of the pico titer plate individually . therefore the samples were divided into  <dig> sets of  <dig> individuals and individuals in each region were differentiated by the use of multiplex identifiers .

mhcd-f and mhcd-r were chosen as the template-specific primers since the aim was to amplify all the functional allelic variation present in the population. forward  and reverse  fusion primers were designed by adding a gs flx titanium primer sequence and a 10bp mid sequence to the 5’ end of the template specific primers   <cit> . the mid’s are the sequence tags that allow individual identification; when both forward and reverse primers are tagged, individual identification can easily be achieved by selecting different combinations of mid’s for each sample. hence a small number of mid’s were used to uniquely barcode a large number of individuals  <cit> . we designed ten forward and ten reverse fusion primers using the first ten mid’s from the standard  <dig> set. these mid’s have been engineered by roche to avoid misassignment of reads and they are tolerant to several errors  <cit> . the fusion primers were purified using hplc to minimize the risk of mispriming events  <cit> . recently, lenz and becker  <cit>  compared the effects of different pcr conditions on mhc artefact formation and showed that simple adjustments like decreasing pcr cycle number or increasing elongation time within each cycle reduced the number of artefacts. as proposed in  <cit> , we tested the minimum number of cycles needed in this study by agarose gel electrophoresis, and found that bands were visible after  <dig> cycles. therefore we adjusted the pcr cycle number to  <dig> and elongation time to  <dig> minute, to minimize the formation of pcr artefacts. amplifications were run in a final volume of 25 μl, including 1x faststart buffer # <dig>   <dig>  μm of forward and reverse titanium fusion primers,  <dig>  units of faststart taq dna polymerase ,  <dig>  mm of each dntp and 2 μl of extracted dna   <cit> . pcr conditions included an initial denaturation at 94°c for 3 min, followed by  <dig> cycles of denaturation at 94°c for 15 sec, annealing at 59°c for 45 sec and extension at 72°c for 1 min with a final extension step at 72°c for 8 min.

pcr products were purified using the minelute  <dig> uf pcr purification kit  and viewed on agarose gels to estimate the concentration of the amplicons. kloch et al.  <cit>  found this method to be cheaper, less-time consuming and as satisfactory as nanodrop measurements.  <dig> individuals with different tag combinations were pooled together in approximate equimolar quantities, and a single pool was prepared for each region of the pico titer plate. the pools were then sent for bidirectional  <dig> pyrosequencing using gs flx titanium chemistry at genomic services, wellcome trust centre for human genetics, university of oxford.

bioinformatics and data processing
the experiment was run twice for bidirectional sequencing and the results were merged prior to analysis. the output was initially analyzed using jmhc, a software package specifically designed for mhc amplicon analysis  <cit> . jmhc allows users to specify the template-specific primers, sequence tags, and the individuals represented by each tag. we used the software to extract the reads bearing complete primers and sequence tags; and to generate a table of all variants, and the number of variants represented in each individual. therefore jmhc sorted out the reads and assigned them to the individuals, and then removed the sequences lacking complete primers or tags, and sequences that had ambiguous base pairs .

there are three potential sources of error during pcr and pyrosequencing:  pcr-generated mutations;  pcr-generated chimeras and   <dig> sequencing errors. most of the  <dig> sequencing errors constitute over- or under-calls and are low in frequency, hence they are easy to identify  <cit> . in contrast pcr-generated errors are harder to distinguish as they might occur early in amplification, can have higher frequencies, and the same chimeras may be produced repeatedly . considering the high number of artefacts generated during these processes, an efficient quality control was crucial to reliably differentiate real alleles from artefacts. we applied a stepwise variant validation procedure to detect true alleles ; the method is broadly based on the procedures defined by zagalska-neubauer et al.  <cit>  and galan et al.  <cit> .

variant validation was based on six assumptions:  sequences that have deletions or substitutions shifting the reading frame should be regarded as artefacts;   <dig> sequencing artefacts should have low copy numbers in the whole dataset and on a per individual basis;  pcr-generated mutations and chimeras could have high copy numbers on per individual bases but should co-occur with the allele or allele pair from which they originated  <cit> , and should have low copy numbers in the whole dataset;  verified sequences should be represented at least twice in an individual;  verified sequences should be found in at least two individuals; and  reliability of individual genotypes should be ensured by requiring a minimum number of sequences per individual.

recently, galan et al.  <cit>  developed a probabilistic model to validate mhc variants and to determine the confidence level of genotyping for each individual. the confidence level  depended on the values of r, n and m; r being the minimum copy number of each true variant, n the total number of sequences and, m the maximal number of variants for the gene; while the program permitted the presence of 1– <dig> loci. although the number of mhc class i loci in great tit was unknown and most likely exceeded  <dig> loci, we used the program ‘negative multinomial’ to estimate the minimum number of sequences required per individual for reliable genotyping and calculated the number of sequences that are necessary for amplifying all the variants at least twice , giving a confidence level  of  <dig>   <cit> . we found that the minimum number of sequences  required per individual was  <dig>   <dig>   <dig> and  <dig> for  <dig>   <dig>   <dig> and  <dig> loci  respectively. the increase in sequence number was linear with respect to locus number; therefore we estimated that 151– <dig> sequences would be necessary to genotype 10– <dig> loci. previous passerine studies demonstrated the presence of 5– <dig> mhc class i loci  <cit> ; hence we chose  <dig> reads for minimum coverage and two copies per individual for keeping a variant in our study. in galan et al.  <cit>  the minimum copy number of each true variant was set as three  and the confidence level was set as  <dig> % , hence the minimal number of sequences required for reliable genotyping was much higher, compared to our estimates. although it would have been ideal to apply the same criteria considering its robustness, in the present study we modified the values because the average number of reads per individual was lower than expected. therefore we lowered the minimum copy number of each true variant to two  and the confidence level to 95%  to balance the tradeoff between read quality and size of the dataset. keeping variants that occur twice in an individual is relatively conservative, but it ensures the retention of real variants and allows the elimination of artefacts in the following steps. it can also be argued that assumptions  <dig> and  <dig> are not strictly true and might lead to the removal of rare variants. however we believe that it is better to be conservative and risk missing a small fraction of real alleles, rather than risking the inclusion of artefacts. therefore our approach was in line with the standard two-pcr criterion – to be verified a sequence should be retrieved at least twice from independent pcr reactions - that mhc studies traditionally use.

the sequence validation procedure had five steps :

  reads that did not match the expected allele sizes were eliminated 

  reads that occurred only one, two or three times in the whole dataset were removed 

  individuals with fewer than  <dig> reads were removed 

  artefacts were identified at the level of the whole dataset by applying the following criteria:

 maximum per amplicon frequency  was determined for each unique variant  <cit> . all the variants that had mpaf equal to  <dig>   were examined to detect whether they were real alleles or artefacts. the decision was based on the three individuals that had the highest mpaf for the variant in question. if the variant could be explained as a chimera of more common alleles, or if it differed by a single basepair from more common alleles in all three individuals, it was eliminated as an artefact. otherwise it was retained as a real allele . a total of  <dig> out of  <dig> variants  with  <dig>  mpaf were detected as artefacts and deleted. then we randomly selected  <dig> variants with mpaf smaller than  <dig>  to check their status; all were identified as artefacts. therefore we deleted all the variants below  <dig>  mpaf. the variants above  <dig>  mpaf were examined and the following pattern was detected:  <dig> % of the variants  that had mpaf between  <dig> - <dig>  were detected as artefacts;  <dig> % of the variants  that had mpaf between  <dig> - <dig>  were detected as artefacts; but only  <dig> % of the variants  that had mpaf between  <dig> - <dig>  mpaf were detected as artefacts. the rest of the variants were not checked to prevent false negatives – assigning real alleles as artefacts due to sequence similarities. however we randomly chose  <dig> variants with mpaf larger than  <dig>  and all were identified as real alleles. in total we found and removed  <dig> artefacts on the scale of the whole dataset. of these,  <dig> %  had two, three or four copies within the individual, whereas  <dig> %  had five or six copies. therefore variants that have two, three and four copies within an individual represented the “grey area” as these sequences were likely to be artefacts.

  artefacts were distinguished at the individual level by applying the following criteria:

 all single copy variants within an individual were deleted . all variants represented by two, three and four copies were examined to detect whether they could be explained as a chimera of more common variants or whether they differed by a single basepair from more common variants, and were deleted if the answer was yes . variants with more than four copies were retained as true alleles.

the fourth and fifth steps of the sequence validation procedure were based on the method developed by zagalska-neubauer et al.  <cit> . these steps involved visual analysis of variants that have low read number in the whole dataset and on a per individual basis, and were critical for distinguishing true alleles from artefacts. although we increased the risk of introducing artefacts in step  <dig> by choosing  <dig> reads for minimum coverage and two copies per individual for keeping a variant, the detailed inspection of variants in step  <dig> and  <dig> enabled us to detect and eliminate errors, hence we believe that the reliability of the genotyping method improved substantially following these two steps.

phylogeny construction
a phylogenetic tree of great tit mhc class i exon  <dig> variants were constructed using neighbour-joining method and tamura-nei model. the tree was rooted with a chicken  mhc class i sequence  and the reliability of the branches was tested with  <dig> bootstrap replicates. the phylogenetic tree was constructed using mega  <dig>  <cit> . the nucleotide diversity between sequences was analyzed using dnasp ver.  <dig> . <dig>  <cit> .

tests of historical selection
the strength of historical selection acting on great tit mhc was tested using a likelihood ratio modelling approach. two models of codon evolution were compared: the nearly neutral model  where dn/ds < 1; and the positive selection model  where the presence of dn/ds >  <dig> sites are allowed. if m <dig> fits the data better than m <dig>  positively selected sites  were identified through the bayes empirical bayes  procedure. the analysis was computed using codeml, implemented in the software paml  <cit> . the frequencies of dn and ds were then estimated using a second approach: nei-gojobari method and jukes-cantor correction. the two approaches incorporate different evolutionary models; hence codon based z-test of selection was conducted on  pss,  non-pss,  abs,  non-abs and  all sites, for comparative purposes  <cit> . the aminoacids corresponding to abs were detected by superimposing the chicken major mhc class i sequences and assuming concordance at the abs  <cit> . the z-test of selection estimates dn-ds and computes a 1-tailed test to determine if dn > ds. for sites predicted to be in contact with antigens, a significant dn > ds  would be expected. analyses were computed using mega  <dig>  <cit> .

definition of supertypes
mhc alleles with similar antigen binding motifs were clustered into supertypes as proposed by doytchinova and flower  <cit> . initially the aminoacid sequences of all pss were aligned and the rest of the sites were removed  <cit> . then each pss aminoacid was characterized by five physicochemical descriptor variables: z <dig> , z <dig> , z <dig> , z <dig> and z <dig>  and translated into a matrix  <cit> . this matrix was subjected to k-means clustering algorithm and model selection for identifying genetic clusters, and discriminant analysis of principal components  for describing the clusters using ‘adegenet’ package in r  <cit> . initially, the function ‘find.clusters’ was used; k-means was run sequentially with increasing number of groups, and different clustering solutions were compared via bayesian information criterion  values . the number of clusters was then chosen based on the graph of bic values for increasing number of clusters. the optimal number of supertypes was defined as the minimal number of clusters after which the bic decreases by a negligible amount and was indicated by an elbow in the curve of bic values as a function of cluster number. once the number of clusters was chosen, we applied dapc to visualize the relationship between the supertypes. the function ‘dapc’ was used to perform a discriminant analysis on the retained principal components ; and a dapc scatterplot was displayed to illustrate the differences between the clusters using the first two pcs  <cit> .

RESULTS
characterization of great tit mhc class i exon 3
amplification of genomic dna using nine different primer pair combinations yielded three distinct pcr products that differed at the length of exon  <dig> . alleles of similar sizes generally grouped together within the phylogenetic tree, however they were not organized in well supported clusters so it was not possible to identify exact gene families. in total  <dig> highly divergent alleles were retrieved from  <dig> great tits . only three of these alleles were clearly non-functional: their amino acid translation bore two stop codons, and possibly belonged to a pseudogene, as they formed a monophyletic cluster . some individuals had up to nine alleles so we estimated that  the great tit had at least five mhc class i loci, of which one is a pseudogene.

in order to understand which allelic clusters were functional and expressed, we amplified transcribed mhc alleles from mrna extracted from blood. contrary to our expectations, the cdna sequences were not confined to any allelic cluster and were distributed throughout the phylogeny . moreover we found that even the pseudogene alleles were being transcribed, as they were present in the cdna library. since it was not possible to determine an allelic subgroup of interest for mhc genotyping, we designed the degenerate primers mhcd-f and mhcd-r that would potentially amplify all the functional variation present in great tits. the primers were specifically designed to prevent a good match with the pseudogene alleles, so that the coverage of non-functional sequences could be limited while amplifying the rest of the alleles. the pcr products were  <dig>   <dig> and  <dig> basepair long and covered the major part of mhc class i exon  <dig> . the primers succeeded in amplifying alleles from each well-supported allelic cluster, suggesting that full scale sequencing of mhc class i alleles could be attained with their use.

 <dig> genotyping
genomic dna from  <dig> individuals,  <dig> of them amplified twice, and cdna libraries from four individuals were amplified using the ten forward and ten reverse titanium fusion primers we designed. bidirectional sequencing was employed using the  <dig> regions of a pico titer plate gasket. overall, the experiments generated  <dig>  reads. jmhc removed the imperfect sequences reducing the read number to  <dig>   with a mean of  <dig> reads per individual and a median of  <dig>  a high level of variation was observed in the number of reads per individual . while more than one quarter of the variation in read number was introduced by the  <dig> region on which a sample was run , some variation was also introduced by the concentration differences between purified pcr products.

first we eliminated reads that were not  <dig>   <dig> or  <dig> basepair long, since the characterization phase allowed us to define the expected allele sizes, leaving  <dig>  reads  and  <dig>  unique variants. reads that occurred only once, twice or three times in the whole database were then eliminated, reducing the dataset to  <dig>  reads  and  <dig>  unique variants. at this stage we removed all the individuals that had fewer than  <dig> reads, as their genotypes were considered incomplete and thus unreliable. lastly, artefacts were differentiated at the level of the whole dataset and the individual, resulting in retention of only  <dig> variants as true alleles. overall,  <dig> samples passed our criteria:  <dig> individuals,  <dig> duplicates and two cdna amplicons; the final genotypes were based on  <dig>  reads .

among the  <dig> samples genotyped twice only  <dig> duplicates passed our variant validation criteria, and the reliability of the experiment was calculated based on these samples. we removed the pseudogene alleles that bore a stop codon prior to calculation, because the primers were designed to avoid amplification of such alleles and they were functionally irrelevant. for each duplicate we calculated the agreement between the genotypes after the 3rd, 4th and 5th step of the variant validation procedure, to verify the efficiency of the method . we also calculated the agreement between the genotypes following supertype classification , since supertypes will be considered as the unit of selection in subsequent analyses investigating the effects of mhc variation on parasite burdens, survival, reproductive success and mate choice in this system. on average the repeatability of the duplicates increased from  <dig>  to  <dig>  between step  <dig> and step 5;  <dig> alleles were common in the duplicate, while  <dig>  alleles occurred only in one duplicate. of the  <dig> individuals six had identical genotypes following variant validation. a repeatability score was calculated for each duplicate and the scores were averaged to estimate the repeatability of the experiment. hence the repeatability of the genotyping method was calculated as 94%. the lack of significant correlation between read number and allele number per individual, above the threshold of  <dig> reads  further supported the reliability of the experiment . the agreement between genotypes increased from  <dig>  to  <dig>  after supertype classification; on average  <dig> supertypes were common in the duplicate, whereas  <dig>  supertypes occurred in one duplicate. of the  <dig> individuals eight had identical genotypes following supertyping and we found no correlation between the read number and supertype number per individual  .

st – supertypes; read no - the number of reads per sample. verified alleles/supertypes stand for the number of identical alleles/supertypes between the duplicate samples. unverified alleles/supertypes represent the number of alleles/supertypes that were found in one of the samples and indicate non-identical genotypes. repeatability was calculated as the ratio of verified alleles/supertypes to the total number of alleles/supertypes for each duplicate. a repeatability value of  <dig> signifies identical genotypes. for a duplicate each measurement was calculated four times - after the 3rd, 4th and 5th steps of the variant validation procedure, and following supertype classification. the average values for each measure are provided in the bottom row.

sequence diversity
in this study a total of  <dig> mhc class i alleles  were detected; to our knowledge the highest number characterized in a wild bird species . the sequences were highly divergent with  <dig> polymorphic nucleotides, representing 60%  of the sites. nucleotide diversity and the average number of nucleotide differences were π =  <dig>  ±  <dig>  and  <dig>  ±  <dig>  respectively. of  <dig> alleles we retrieved in the characterization stage, fifty were present among these sequences . within the sample of  <dig> alleles,  <dig> were non-functional alleles bearing stop codons:  <dig> of these alleles had two stop codons at the same location, were highly similar to each other and formed a paraphyletic group suggesting the presence of a pseudogene family . moreover these sequences formed a monophyletic cluster with  <dig> alleles that did not bear stop codons, but showed a dissimilar pattern of divergence from the rest of the alleles. these  <dig> sequences are referred as group  <dig>  while the remaining  <dig> sequences are referred as group  <dig> . the members of group  <dig> were  <dig> basepairs long, similar to each other, and structurally similar to the pseudogene alleles variants . the segregating sites within group  <dig> were considerably different than the segregating sites in group  <dig>  implying that separate evolutionary forces might be shaping this variation and that group  <dig> sequences might be representing non-functional variants. alleles of group  <dig> were, on the other hand, highly divergent from each other, had similar segregating sites and varied in their size . three non-functional alleles bearing stop codons  were within group  <dig>  but unlike the members of the pseudogene family these sequences bore only one stop codon and were not clustered together, implying that they evolved independent from each other . these alleles were probably formed recently as a result of mutation accumulations, and did not belong to a pseudogene.

two cdna amplicons passed our variant validation criteria and  <dig> alleles were retrieved in total. we checked whether the cdna alleles were confined to particular allelic clusters; however, in line with our previous findings, the sequences were found throughout the phylogenetic tree  and did not fall into any cluster. hence the sequence variants obtained from cdna were not useful in differentiating functional groups from the non-functional ones.

signatures of historical selection
tests of historical selection were performed separately on group  <dig> and group  <dig> alleles in order to clarify whether they were under different selective pressures. first we used a likelihood ratio modelling approach to compare the two models of codon evolution  and selected the model that best fitted the data . for group  <dig> the model allowing a class of sites to be under positive selection  fitted the data better than the null nearly neutral model . therefore m <dig> was rejected in favour of m <dig>  and three sites were found to be under positive selection according to bayes empirical analysis . however none of these sites were identical to the chicken abs, and only one was situated close to an abs with a distance of two aminoacids . for group  <dig> it was not possible to run the analysis on all of the alleles because the number of sequences exceeded the capacity of codeml software. therefore we selected all the sequences that were present in more than  <dig> individuals as being common alleles, confirmed that they were equally distributed throughout the phylogeny  and ran the analyses on these  <dig> sequences. again m <dig> fitted the data better and nine sites were detected as pss . six pss were identical to the chicken abs, suggesting full agreement . the remaining three pss had high aminoacid variability and might have been sites of peptide or t cell binding. none of the pss identified in group  <dig> were identical with the pss in group  <dig>  confirming that these two groups are under different selection pressures, and hence probably differ in their functionality.

ω - dn/ds; nearly neutral with β - for all sites dn/ds ≤  <dig> and the beta distribution approximates ω variation; positive selection - a proportion of sites evolves with dn/ds > 1; lnl - log-likelihood value; Δaic - the difference between the value of the aic of a given model and the best model; p <dig> - proportion of sites with dn/ds ≤  <dig>  p <dig> - proportion of positively selected sites , ω <dig> - estimated value of ω for sites under positive selection.

we also performed codon based z-test of selection on group  <dig> and group  <dig> separately . here we checked whether pss, non-pss, chicken abs, chicken non-abs and all sites were under selection to validate the results of the previous analysis. as expected, none of the sites were found to be under positive selection in group  <dig>  whereas both pss and chicken abs  were positively selected in group  <dig> 

the rates of non-synonymous mutations  and synonymous mutations  were computed using nei-gojobari method and jukes-cantor correction. the standard errors were obtained through  <dig> bootstraps replicates. z test of selection estimated dn-ds  and computed a1-tailed test to determine whether dn > ds . n is the number of nucleotides representing antigen binding sites , non antigen binding sites , positively selected sites , non positively selected sites  and all sites in group  <dig> and group  <dig>  abs were detected by superimposing the chicken mhc class i sequences and assuming concordance. significant p-values are bold.

supertypes
group  <dig> sequences were clustered in functional supertypes, using the nine sites detected as pss. we excluded the alleles bearing stop codons and the group  <dig> sequences because they were considered non-functional. we created a matrix for the  <dig> group  <dig> alleles based on their pss physicochemical properties; and subjected the matrix to k-means clustering algorithm and model selection. the optimal number of clusters was indicated by a change in the slope of bic decrease  and was identified as  <dig> . allele number per supertype ranged from  <dig> to  <dig> alleles with a mean of  <dig> , and the population-wide frequency of supertypes ranged from  <dig>  to  <dig>  . once the number of clusters was chosen, we applied dapc to visualize the relationship between the  <dig> supertypes. for this analysis  <dig> principal components  were kept to retain 93% of the variation. the dapc scatterplot summarizes the differences between the clusters using the first two pcs .

estimating the number of mhc class i loci
the maximum number of alleles per individual was found to be  <dig> with a mean of  <dig>  ±  <dig> , suggesting that there are at least  <dig> mhc class i loci in the great tit . however some of these alleles belonged to a pseudogene, whereas others were considered non-functional . we found a maximum of  <dig> functional alleles per individual with a mean of  <dig>  ±  <dig> . therefore we estimate that the great tit has at least  <dig> functional loci. when functionally similar alleles were clustered in discrete supertypes, each individual had between 6– <dig> supertypes with a mean of  <dig>  ±  <dig> ; the number of supertypes was approximately normally distributed in the population. based on the data, the number of pseudo and putatively non-functional genes were also estimated. these numbers are probably an underestimate as the primers were designed to prevent a good fit with the alleles bearing a stop codon, and the putatively non-functional alleles were similar to the pseudogene alleles. nevertheless, we found a maximum of six pseudogene alleles and six putatively non-functional alleles per individual, pointing to the presence of at least three loci in each group.

s.d.- standard deviation. minimum loci number was estimated using the maximum allele number for each class.

discussion
in this study, characterization of great tit mhc class i exon  <dig> was adopted and large-scale, high-resolution genotyping was carried out by the use of  <dig> pyrosequencing method. a total of  <dig> alleles with varying sizes and high nucleotide diversity were detected in  <dig> great tits, demonstrating that this species has a polymorphic, multilocus mhc region; tests of historical selection implied this polymorphism was mainly maintained by balancing selection. full analysis of sequences through a stepwise variant validation procedure allowed reliable typing of  <dig> samples and duplicates confirmed the repeatability of the genotyping method. lastly, the effective mhc repertoire of each great tit was described by clustering alleles with similar antigen binding affinities into  <dig> supertypes.

our characterization effort proved to be effective as it enabled us to define the allelic groups of interest and the sequences to prevent  during  <dig> pyrosequencing. high diversity among the potentially functional alleles led to the design of a degenerate primer pair, however attention was paid to minimize amplification of alleles with stop codons. consequently, functional sequences constituted the major fraction of the reads  that were retained following variant validation procedure, whereas the number of reads belonging to putatively non-functional genes were much lower. this highlights the importance of carrying out a thorough background work prior multilocus typing, not only to attain an initial understanding of gene and allelic diversity, but also to design the ideal primers that target the expressed alleles only. for instance, zagalska-neubauer et al.  <cit>  used  <dig> pyrosequencing to type the mhc class ii region of the collared flycatcher and the experiment successfully generated a mean of  <dig> reads per individual. however the coverage was insufficient for reliable genotyping since the primers extensively amplified the putative mhc pseudogenes, greatly decreasing the coverage of expressed alleles.

we retrieved 76% of the alleles identified during the characterization stage. these were randomly distributed in the phylogeny and represented each allelic group, suggesting that we successfully amplified the allelic groups of interest. few of the alleles that were not retrieved belonged to group  <dig> or the pseudogene group as expected. the rest of the alleles identified at the initial characterization stage were most likely pcr-generated errors that were not differentiated at the characterization stage as they were either  <dig> basepair different from more common alleles or they could be explained as a chimera of more common alleles. lenz and becker  <cit>  showed that pcr generated artefacts could constitute up to  <dig> percent of the alleles when no approach is taken to reduce artefact formation. although we adjusted the pcr conditions during amplification for  <dig> genotyping, we used the standard conditions during characterization. hence it would not be surprising to have generated a relatively high frequency of artefacts during the cloning –sequencing processes.

we used the  <dig> regions of the pico titer plate and pooled  <dig> great tit amplicons in each region to maximize the number of individuals sequenced in the experiment. however from the total of  <dig>  only  <dig> samples  were successfully genotyped following the variant validation procedure. the efficiency of the experiment could have been improved by optimising the sample number for a full plate run  <cit> . in amplicon sequencing, the depth of coverage is tightly linked to the number of amplicons being pooled. therefore by pooling a smaller number of amplicons, we could have genotyped more individuals. however, it is rather difficult to determine the optimal number of samples to use in a  <dig> run, especially in cases where the gene copy number is initially unknown. alternatively, our method could have been improved by calculating the concentration of each amplicon using a nanodrop, in order to assure the pooling of equimolar quantities  <cit> . this way the variation in read number per sample could have been minimized and possibly more individuals would have passed the minimum coverage threshold. due to the error-prone sequencing technology of ngs, we applied a five-step variant validation procedure to differentiate real alleles from pcr/sequencing artefacts. it can be argued that some rare alleles might have been missed in few individuals  while these steps were being applied. however we believe this is unlikely to be a very large effect given that no significant correlation between read number and allele number per individual was found. moreover the consistency of the genotyping method and the variant validation criteria was confirmed by the high repeatability  of duplicates, and by the substantial increase in the repeatability measures between the 3rd and 5th step of variant validation procedure.

still, of the  <dig> duplicates only six had identical genotypes following variant validation. therefore it is plausible to suggest that the quality of the genotyping method could have been improved by modifying the variant validation procedure. as mentioned in the methods section, we tried to maintain a balance between the quality and size of the dataset whilst setting up the genotyping criteria; hence a better experimental design would have maximized both measures. the inconsistency among samples in six of the duplicates was mostly due to removal of real alleles, because the variants in question had low frequency on per individual basis and were highly similar to more common variants. although the removal of rare alleles poses a problem for accurate genotyping, the application of supertype classification alleviated the issue to some extent, since highly similar alleles were grouped into the same supertype and the contribution of single alleles became irrelevant following supertyping. hence, of the  <dig> duplicates eight had identical genotypes after supertyping, no correlation was found between the read number and supertype number per individual and the agreement between duplicates was calculated as  <dig> . to date few mhc studies carried out an empirical assessment of genotyping error via running duplicates in non-model vertebrates  <cit> , therefore it is hard to assess how good the agreement is, but we believe that in the context of ecological studies, this level of repeatability is sufficient.

four great tit cdna libraries were constructed from mrna sequences extracted from blood, and the libraries were used to identify transcribed allelic clusters. however a few cdna sequences were retrieved from each allelic cluster, so it was not possible to isolate any group as more functionally important. surprisingly, pseudogene alleles that bore stop codons were also found in the cdna libraries. this emphasized the fact that classical sequencing methods are limited and even problematic if used for expression analysis, as they only inform on the presence or absence of transcripts. such data are insufficient, because even non-functional genes could be transcribed in low levels unless a mutation at the promotor region halts the transcription completely. therefore an approach based on expression level quantification  should be adopted in order to differentiate highly expressed, hence functionally important alleles  <cit> . assessment of gene expression through cdna coverage has started to find wider application in ngs methods  <cit> .

alternatively, the presence of non-functional cdna sequences can also be explained by genomic dna contamination during rna extraction. however we believe this is unlikely, because the method used for rna purification  included a dnase digestion step. although mrna data did not inform us on allelic expression, the phylogenetic tree of the class i alleles and the historical selection tests significantly improved our understanding of functional alleles. the group  <dig> sequences formed a monophyletic cluster with pseudogene alleles and codon based z-test of selection suggested none of the putative antigen binding sites were positively selected. still we detected a weak and non-significant signal for the positive selection of group  <dig> abs. such weak signals are expected, as it has been shown to take around 19– <dig> million generations for a positive dn-ds signal to disappear even in the absence of selection  <cit> . using a likelihood ratio modelling approach three sites were found to be under positive selection in group  <dig>  yet these were not within highly variable sites. in contrast all the putative antigen-binding amino acids were under positive selection in group  <dig>  in addition to three highly variable sites. moreover z –test of selection suggested both abs and pss were under great selective pressure. these results implied that group  <dig> sequences were actively involved in antigen recognition and have been under selection from a variety of parasites; whereas group  <dig> sequences were non-functional, hence the observed variation possibly accumulated as a result of relaxed selection.

in total  <dig> alleles were considered functional and individual great tits possessed  <dig> to  <dig> putative expressed alleles. a discrepancy in the number of alleles per individual is common in mhc studies across taxa, due to variation in gene copy number within species and allele-sharing between loci  <cit> . we cannot exclude the possibility that some alleles might have been missed at the pcr stage, although we believe this to be relatively unlikely considering that we gathered extensive sequence information during characterization, and amplifications were performed using a degenerate primer pair. similarly sized alleles did not form monophyletic groups implying that 3 bp insertions and deletions occurred several times in the history of the gene, independent of each other. the important contribution of indels to mhc genomic diversity has already been shown in chicken  <cit> . moreover a comparative study between human and chimpanzee mhc proposed indels as the major driving force for genomic divergence  <cit> . alternatively, this pattern might also be an effect of recombination and gene conversion, processes shown to be frequent in passerine mhc systems  <cit> .

the alleles of group  <dig> were clustered into  <dig> functional supertypes based on the physicochemical properties of their pss. we adopted a bioinformatic approach that was described by doytchinova and flower  <cit>  to determine peptide specificity; however an experimental approach would have been ideal. for instance, a recent study established computational antigen-binding prediction algorithms based on empirical datasets, and showed an evolutionary advantage for allele pairs that are more divergent in recognizing a broader range of potential antigens  <cit> . moreover the biological relevance of grouping mhc alleles with similar antigen binding affinities into supertypes is supported by a growing number of human and non-human primate studies  <cit> . in this study we utilized a newly proposed method for identifying genetic clusters . this method is an advance on previous methods, as it does not require arbitrary clustering decisions  <cit> , but uses k-means clustering algorithm and model selection approach to compute associated summary statistics.

we found evidence for the presence of at least  <dig> functional loci in the great tit. this constitutes the highest number of expressed mhc class i alleles/loci identified in a passerine species. however we believe it is likely that this complexity is not specific to great tits and that similar patterns can be found in other passerines. studies on great reed warbler and scarlet rosefinch have already revealed high polymorphism and the existence of more than 5– <dig> functional mhc class i loci in these species, although these studies had lower sample sizes  and used conformation-based mutation detection methods that rely on physical separation of alleles, without providing allele sequence information  <cit> . the utilization of indirect typing methods and motif-specific primers can be a rewarding approach in species where functional alleles are well described and confined to an allelic subset. however in species where the mhc structure is complex and the number of co-amplifying alleles is high, like in the great tit, it is impossible to differentiate variants based on their migratory patterns and it is inevitable to underestimate the allelic diversity as a result of peak overlapping  <cit> . moreover, because indirect typing methods require cloning-sequencing effort to reveal the nucleotide information, hundreds of clones must be sequenced to obtain a good estimate of allelic composition in such complex systems  <cit> . therefore it is feasible to suggest that the employment of 454-pyrosequencing is ideal for passerine species that harbour many mhc loci and high allelic diversity, as it has the potential to reveal the extent of mhc complexity. in a recent study  <dig> technology was used for mhc genotyping atlantic cod and it was shown that the species possess more than  <dig> mhc class i loci, a greatly expanded number compared to other teleost fish  <cit> . this extraordinary expansion of class i genes was explained by the absence of class ii loci; this might represent a compensatory mechanism adapted by the atlantic cod immune system. this work illustrates the great flexibility in mhc genomic organization among closely related species.

CONCLUSIONS
we found extreme complexity at the mhc class i exon  <dig> of the great tit following a broad characterization and large-scale, high-resolution genotyping effort. the presence of at least  <dig> functional loci was shown, together with a pseudogene family and putatively non-functional alleles. there was clear evidence that expressed alleles were under strong balancing selection and these alleles were grouped into  <dig> functional supertypes based on their antigen binding affinities. this study represents the first step of an in-depth analysis of the genetic basis of disease resistance, aimed at better understanding how parasite-mediated and sexual selection shape and maintain host genetic variation in nature. we believe that this approach will find wide application among evolutionary biologists in the near future and will allow advancements in our understanding of complex genetic regions.

authors’ contributions
is participated in study design, carried out the molecular genetics procedures, analyzed the data and drafted the manuscript. hkm provided tools for bioinformatic analyses and helped to draft the manuscript. eh helped with statistical analyses and drafting the manuscript. bcs participated in study design and coordination, provided the samples and helped to draft the manuscript. all authors read and approved the final manuscript.

supplementary material
additional file 1
fig s <dig>  fig s <dig>  fig s <dig>  fig s <dig>  fig s <dig>  figure s <dig>  phylogenetic tree of the mhcclass i sequences we identified during characterization. the tree was constructed using neighbour-joining method, jukes-cantor model and rooted with a scarlet rosefinch  mhc class i exon  <dig> sequence . the interior branch numbers refer to bootstrap values with  <dig> replications. blue squares indicate sequences retrieved from cdna. three sequences adjacent to the scarlet rosefinch mhc allele are the pseudogene alleles and are indicated with the letter ‘p’. figure s <dig>  variation in supertype number per individual with increasing read number. figure s <dig>  aminoacid sequences of a representative set of great tit mhc class i alleles . the first set of alleles  are members of group 2; the second set of alleles  are members of group 1; and the third set of alleles  are members of the pseudogene. identity with pama-u*ii <dig> is indicated with dots, differences are shown by letter substitutions, and gaps are shown by dashes. stop codons are shown by stars. chicken antigen binding sites  are shaded with blue, while group  <dig> positively selected sites  are indicated with ‘+’. pama-u*ii <dig> is one if the three non-functional alleles within group  <dig>  figure s <dig>  phylogenetic tree of functional group  <dig> sequences. the tree was constructed using neighbour-joining method, jukes-cantor model and rooted with a chicken  mhc class i sequence . the reliability of the branches was tested with  <dig> bootstrap replicates. bootstrap supports for major clades are indicated with numbers. the alleles that were present in more than  <dig> individuals are marked in red. the chicken mhc allele is marked in grey. figure s <dig>  graph of bic values for increasing number of clusters. the optimal number of supertypes was identified as  <dig>  as it indicated the elbow in the curve of bic values. after  <dig> clusters the slope of bic decrease dropped notably. the change in the slope at the 17th cluster is indicated with two, red dashed-lines.

click here for file

 acknowledgements
we are grateful to the wytham and bagley fieldworkers who collected the data and materials for this study. we thank judith mank and camille bonneaud for useful comments on laboratory protocols and alicia davies for laboratory assistance. we also thank wieslaw babik, colin garroway, john mulley, jordi paps, kaan oz and two anonymous reviewers for helpful discussion and advice. this work was funded by nerc grants  to bcs.
