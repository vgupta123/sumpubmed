BACKGROUND
the assessment of immunoglobulin  heavy and light chain sequences is essential to investigate the cellular mechanisms underlying humoral immunity. this applies to the accurate quantification of repertoire diversity or hypermutation, maturation and differentiation dynamics of b cells during an immune response. typically, this information is obtained by next-generation sequencing  of transcripts isolated from bulk b cell populations. the inherent drawback of this strategy is the loss of information regarding ig heavy:light chain pairing, which is a critical determinant of antibody reactivity.

approaches sequencing individually isolated cells naturally preserve this information. moreover, single-cell resolution facilitates the integration of antigen receptor repertoire  information with various other data types, e.g. surface marker phenotypes as determined by flow cytometry . strategies of this type have been successfully applied in the investigation of numerous types of infections or auto-immune diseases. in the case of influenza vaccination e.g. the combination of whole antibody sequence data together with single-cell phenotyping and affinity measurements of monoclonal antibodies has provided insights into the characteristics of memory recall, affinity maturation and selection as well as epitope specificity of the b cell response .

historically the assessment of single ig sequences has been performed using sanger sequencing. to increase the experimental throughput, various next-generation sequencing -based protocols have been developed, which generate libraries of pooled ig heavy and light chain transcripts while preserving the heavy:light chain pairing of the individual cell . we previously established a reverse-transcription pcr  based methodology to analyze fc-sorted single murine or human b cells  <cit> . in this process , the ig heavy and light chain transcripts are amplified in a nested pcr with two-dimensionally barcoded primer sets, which encode the physical location of the individual cell within a set of microtiter plates. the resulting library can be sequenced on roche/ <dig> or illumina platforms. the indexed fc data recorded for each cell allows linkage of ig sequence information to cell surface marker expression at single-cell level.

comparison to current arr analysis tools
automated data analysis pipelines are critical for high-throughput datasets since they facilitate fast and standardized analysis of arr. current analysis methods include online tools for analysis of antigen receptor sequences, which provide basic immunological sequence annotation, e.g. imgt/highv-quest  <cit> . other more specialized computation pipelines like iggalaxy  <cit> , lymanalyzer  <cit>  or presto  <cit>  are used for analysis of antigen sequencing data. change-o  <cit>  additionally allows analysis of clonality, molecular evolution or somatic hypermutation. although these computational methods have successfully been used to process and analyze bulk arr sequencing data, none of them is designed to handle single-cell data. these tools do not provide integrated solutions to represent single cells in the form of data structures or identifiers and thus do not facilitate direct linkage of phenotypic data to single-cell sequences.

we developed scireptor as a flexible single-cell arr analysis toolkit. its modular architecture allows analysis and comparison of ig sequencing data originating from various experimental protocols. the core of scireptor is constituted by a relational database, which stores all sequences, annotations and metadata in a standardized format. the usage of a relational database for data storage is distinct from other existing tools and allows scireptor to link different data types such as sequences, fc data or genomic annotations of reference sequences. the parameters and reference sequences used by the analysis modules are customizable for individual projects.

implementation
scireptor was initially developed to analyze sequencing data from our previously published single-cell matrix pcr platform  <cit> , but the software is equally capable of processing data generated by alternative experimental procedures . the latter requires that the sequencing reads have already been mapped to an individual cell and, if necessary, aggregated to provide a single consensus sequence per locus . the algorithms for sequence annotation and metadata linkage are identical for different input data types. the required external software packages are given in table  <dig>  a step-by-step manual on how to process data is included in the repository, in addition, test data sets  and a pre-configured virtual machine are available at http://b-cell-immunology.dkfz.de. computationally expensive steps such as sequence alignment or consensus building can easily be parallelized on suitable hardware. the sequential steps of data input and sequence annotation are shown in fig. 1: the blue panel  depicts processing of high-throughput sequencing data, whereas the red panel  side illustrates the analysis of sanger sequences. the implementation details of consensus building from raw data and subsequent immunological and phenotypical annotation are described below.
fig.  <dig> scireptor analysis workflow. overview of the scireptor workflow for different datasets. blue: processing steps for high-throughput data. red: analysis workflow for data that is already on single-cell level. shm: somatic hypermutations



input of raw sequence data and consensus building
when processing sequencing data from our matrix pcr platform, scireptor maps each read to an individual cell and locus and subsequently builds an error-corrected consensus . in detail, scireptor first identifies the proximal and distal tag of each read with razers  <cit> . then igblast  <cit>  and blast  <cit>  are used to identify the most probable germline v, d and j segment and constant region for each read. all raw read information and statistics are stored in the database. the consensus build algorithm then successively identifies all reads originating from the same cell and locus and selects the reads with the most frequent v-j combination. muscle  <cit>  is used to align the reads and build a primary consensus, which is stored in the database. if possible, scireptor will repeat this procedure to build a secondary consensus based on the reads with the second most common v-j combination, which facilitates the identification of multiple transcripts that were present in a single cell.

for sequencing data from other experimental procedures , the tag identification and consensus build are skipped . scireptor then directly analyzes the single-cell level sequence data as provided by the user.

immunological sequence annotation
after successful assignment of sequences to single cells, igblast is used for alignment versus a germline database and annotation of v, d and j segments or positions of functional ig subregions . scireptor provides its own algorithm for annotating shm, which uses the query-to-germline alignment provided by igblast and maps all mutations to the corresponding germline base pair. isotypes are assigned for sequences containing sufficient parts of the constant region by using blast alignment versus a reference database.

integration of meta- and phenotypic data
to complete the information stored in the database, scireptor links a set of user-defined specifications from a spreadsheet. this metadata includes information on the donor, the sample and the fc single-cell isolation process. additionally, fc index data  can be linked to the sequence data.

relational database
the structure of the database reflects the different data types that are generated in the consecutive analysis steps of scireptor. it is divided into four sections as depicted in additional file 1: figure s1: 1) data related to raw sequencing reads, 2) analysis results related to consensus sequences at single-cell level, 3) metadata and fc index data, 4) annotation of reference germline variable , diversity  and joining  segments and constant regions.

RESULTS
the advantage of scireptor over currently available analysis pipelines is its capacity to handle single-cell data and directly assign it to other biological non-sequence data. to demonstrate this, we processed different b cell receptor datasets using scireptor and visualized the single-cell linkage between heavy and light chain transcripts and cell surface marker expression. table  <dig> shows the three available test datasets with their respective number of sorted single cells. the datasets are available at http://b-cell-immunology.dkfz.de. the analysis tools used to generate the graphical output are also part of the scireptor software and can be accessed at the project’s repository https://github.com/b-cell-immunology.

quality control
scireptor includes a quality control module for high-throughput sequencing datasets. the module visualizes the distribution of sequencing read lengths, the success rate of sequence tag identification and the distribution of reads per well. this allows the monitoring of sequencing depth as well as potential cross-contaminations. an example of the quality control output is shown in additional file 1: figures s2–s <dig> 

linkage of heavy:light chain information
scireptor attributes an event identifier  to every cell included in the analysis. every heavy, kappa or lambda sequence that is identified during data processing is then assigned to the corresponding event id. grouping the sequences by event id provides information on the associated heavy and light chains of individual b cells. figure  <dig> shows the association of ig heavy and light chain v and j segments in three healthy human donors .
fig.  <dig> paired ig heavy and light chain segment usage. the analysis module of scireptor comprises functions to plot the associations between heavy and light chain segments. the upper heatmaps represent relative association frequencies between heavy and light v segment families for each individual donor. the lower panel shows association frequencies of heavy and light j segment families



integration of flow cytometric index data
in addition to linked single-cell heavy and light chain information, scireptor also supports attribution of phenotypic characteristics. figure  <dig> shows how scireptor can be used to integrate single-cell sequence information with fc index data. the analysis is shown for igg memory cells of three human donors . sequences are grouped according to donor and usage of kappa or lambda chain. different subclasses of igg isotype are represented in the color scheme. the corresponding single cells are depicted in flow cytometric index plots showing their ig κ and ig λ surface expression.
fig.  <dig> isotype distribution related to flow cytometric index data. upper panel: distribution of igg isotypes for all cells for which paired ig heavy and light chain sequences could be determined. the data of each donor is split into two categories according to whether scireptor identified an associated kappa or lambda chain. lower panels: indexed flow cytometry data of the sorted cells that were subjected to the sequencing process . during the single-cell isolation, the cells were labeled with anti-ig κ and anti-ig λ antibodies , whose respective fluorescence intensity is plotted. the cells for which ig heavy and light chain sequences could be obtained are additionally color-coded according to the identified igg isotype



scireptor possesses the unique feature to handle single-cell ig sequencing data. the generic structure of the database and algorithms are designed to be modular and can easily be adapted to handle t cell receptor  data as well. additionally we are currently developing an analysis module to integrate antigen binding data generated with recombinantly expressed monoclonal antibodies.

CONCLUSIONS
scireptor is a flexible toolkit for the standardized analysis of single-cell ig sequencing data. its relational database backend allows integration of different types and sets of data and thus facilitates repertoire comparisons.

availability and requirements
project name: scireptorproject homepage:https://github.com/b-cell-immunology/scireptorhttps://github.com/b-cell-immunology/scireptoroperating system: linuxprogramming languages: perl, r, pythonother requirements: mariadb, igblast, blast, razers <dig>  musclelicense: gnu affero general public license v3

additional file
additional file  <dig> 
database structure and quality control. visual representation of the relational database used by scireptor. quality control output showing the read length distribution, the statistics for sequence tag identification and the reads per cell statistics. 



abbreviations
arrantigen receptor repertoire

fcflow cytometry

igimmunoglobulin

ngsnext-generation sequencing

pcrpolymerase chain reaction

shmsomatic hypermutation

competing interests

the authors declare that they have no competing interests.

authors’ contributions

ki designed the database, implemented scireptor and drafted the manuscript. pfa contributed to the design of the database and to scireptor implementation. hw provided critical input for the design of analysis tools. ceb contributed to scireptor implementation, performed code review and edited the manuscript. all authors read and approved the final manuscript.

funding

this work was supported by the imprs for infectious diseases and immunology, berlin ; and the higs for cancer research, heidelberg .

the authors would like to acknowledge the preceding work and input of irina czogiel and marius tolzmann .
