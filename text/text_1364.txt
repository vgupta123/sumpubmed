BACKGROUND
stochastic behavior, resulting from the small population of species in an intracellular medium, can stimulate interesting molecular phenomena, such as noise-induced bifurcations, phenotypic heterogeneity, etc. through such phenomena, intracellular noise can have an impact on the physiology of the cell  <cit> . it is therefore important that in silico analysis of intracellular networks, aimed at relating cell function to molecular events, is capable of capturing fluctuations. exact stochastic algorithms, such as the stochastic simulation algorithm   <cit>  and its variants  <cit> , can capture the molecular noise by accounting for the random nature of biochemical processes.

the ssa  <cit>  provides the exact solution but can be computationally intensive, especially when large populations and/or reaction networks are involved. τ-leap methods  <cit> , which accelerate the simulation by firing multiple reactions in a coarse time step, provide an excellent alternative when large populations are involved. however, the original poisson-based τ-leap method  <cit>  and its modifications, the binomial τ-leap  <cit>  and the implicit τ-leap  <cit>  methods, do not perform too well at low populations. therefore, an intracellular network comprised of mixed population scales is not amenable to a τ-leap treatment. a modified τ-leap algorithm  <cit>  was recently developed to avoid negative populations that can occur in the poisson τ-leap method. implicitly, this modification results in a hybrid, stochastic algorithm that handles mixed population levels by seamlessly switching between the ssa for low population species and the poisson τ-leap method for large population species  <cit> . similarly, the partitioned leaping method  <cit>  combines the exact next reaction method  <cit>  with the poisson τ-leap  <cit>  method to enable stochastic simulations over a disparate range of populations.

another aspect of biological networks plaguing stochastic simulation is the presence of processes with disparate reaction rates. fast reactions, which are sampled more frequently by the ssa, reduce the size of the time step. as a result, it is difficult to simulate macroscopic real-time. τ-leap methods are also inefficient when a large separation of time scales is encountered. most multiscale, stochastic algorithms  <cit>  accelerate simulation of stiff networks by reducing the time spent in simulating the fast network. one way to achieve this is to use an approximate, accelerated algorithm, such as the langevin method  <cit> , to speed up the simulation of fast reactions  <cit> . this approach tacitly assumes that the faster kinetics arise purely from the large populations, and is not applicable to cases involving fast reactions with small populations. an alternative multiscale approach  <cit>  based on the slow-scale ssa   <cit>  concept, uses information from the quasi-equilibrium  description of the fast network to evolve the slow network . in this multiscale approach, individual networks are modeled with the ssa, and thus, large populations in either the fast or the slow network cannot be handled effectively.

a generic stochastic algorithm, which simultaneously addresses the disparity in time scales and species populations in well-mixed reaction networks, is currently lacking . in this paper, we propose a hybrid, multiscale monte carlo  algorithm to fill in this gap . like our original multiscale monte carlo  algorithm  <cit> , the proposed hymsmc algorithm makes no a priori assumptions about the scales and collapses to the exact ssa and/or non-multiscale stochastic solver, when a scale separation is absent. additional new elements in our work include:  the introduction of the computational singular perturbation  framework, as an auxiliary tool, to aid network partitioning and determine relaxation times of the fast network for its convergence and  of a new statistical relaxation criterion that eliminates the need for the complete description of the qe probability distribution function , and  the applicability of the hymsmc method to networks displaying bistability in the fast or the slow networks. to the best of our knowledge, this is the first successful application of a multiscale, stochastic algorithm to a bistable network, reported in the literature.

the paper is organized as follows. we begin with a brief introduction of the ssa notation, and then provide a detailed explanation of the csp-assisted partitioning technique and the new statistical relaxation criterion. next, we introduce the new hybrid multiscale monte carlo  algorithm. finally, we demonstrate the efficiency, accuracy and generality of the new algorithm with a few prototype and real biological examples.

RESULTS
stochastic simulation algorithm  notation
the notation we follow is identical to that of gillespie  <cit> . consider a well-mixed, isothermal system of n species s ≡ {s <dig>  s <dig>  ..., sn} reacting through m reactions r ≡ {r <dig>  r <dig>  ..., rm}. let the state of the system at any time t be denoted by a n-dimensional vector, x = , x <dig>  ..., xn), where xi is the number of molecules of species si at time t. let the n-dimensional vector υj correspond to the stoichiometry vector of reaction rj, such that υij is the stoichiometric coefficient of species si in reaction rj. given that the system is in a state x = x at time t, we define a propensity function, aj such that ajdt gives the transition probability of the jth reaction, rj, occurring in an infinitesimally small time interval . this function is typically dependent on the state of the species and the reaction conditions of the network, such as temperature and pressure.

stochastic quasi-equilibrium, network partitioning, relaxation, and evolution
a. quasi-equilibrium  in stochastic systems
in dealing with numerical "stiffness" in stochastic systems, arising from separation of time scales, one needs to account for the probabilistic nature of the qe  <cit> , which is given by a distribution of states, rather than a single state. accordingly, every state of the slow variables determines a qe pdf of the fast network, i.e., a stochastic low-dimensional manifold. stochastic qe is defined by a time-invariant qe pdf, i.e., the existence of a stable equilibrium of the fast network  <cit> 

 lim⁡t′→∞p^=p∞,
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadawfqaqaaigbcygasjabcmgapjabc2gatbwcbaacbagaf8hdaqnbauaacqghsgircqgheispaeqaaogaf8huaalbakaacqggoaakieqacqgf4baedaahaawcbeqaaiab+zgambaakiabcycasiqb=rha0zaafagaeiifawnae4heagnaeiilawiae8hdaqnaeiykakiaeyypa0jae8huaa1aasbaasqaaiabg6hilcqabagccqggoaakcqgf4baedaahaawcbeqaaiab+zgambaakiabcyha8jab+hha4jabcmcapiabcycasaaa@4fc6@ 

where p^
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacuwfqbaugaqcaaaa@2dea@ is the probability of observing x^f
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaqiaaqaagqabiab=hfaybgaaypadawaawbaasqabeaaieaacqgfmbgzaaaaaa@3033@ = xf, given that the system is in a state x at time t. x^f
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaqiaaqaagqabiab=hfaybgaaypadawaawbaasqabeaaieaacqgfmbgzaaaaaa@3033@ is a stochastic process that is identical to xf, but describes the evolution of the fast species purely via the fast network.

the fast species relax to the stationary pdf, p∞, at t'→∞ ; in practice, this happens over a relaxation time, τrelf
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfepaddaqhaawcbaacbagae4nuailae4xzaumae4hbawgabagae4nzaygaaaaa@33d0@, of the fast network. accuracy of the qe approximation requires that the relaxation time, τrelf
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfepaddaqhaawcbaacbagae4nuailae4xzaumae4hbawgabagae4nzaygaaaaa@33d0@, be much smaller than the smallest time scale, min⁡j∈rs
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadawfqaqaaigbc2gatjabcmgapjabc6gaubwcbaacbagae8naaomaeyici4mcbmgae4nuai1aawbaawqabeaaiegacqqfzbwcaaaaleqaaogaeiikagcccigaewhxdq3aa0baasqaaiab=pgaqbqaaiab=nhazbaakiabcmcapaaa@3d4e@, of the slow network

 lim⁡t′→τrelfp^≈p∞.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadawfqaqaaigbcygasjabcmgapjabc2gatbwcbaacbagaf8hdaqnbauaacqghsgiriigacqgfepaddaqhaaadbagae8nuailae8xzaumae8hbawgabagae8nzaygaaawcbeaakiqb=bfaqzaajagaeiikagccbegae0heag3aawbaasqabeaacqqfmbgzaagccqggsaalcuwf0badgaqbaiabcyha8jab9hha4jabcycasiab=rha0jabcmcapiabgiki7kab=bfaqnaabaaaleaacqgheispaeqaaogaeiikagiae0heag3aawbaasqabeaacqqfmbgzaagccqgg8bafcqqf4baecqggpaqkcqgguaglaaa@5628@ 

provided that eq.  is satisfied, eq.  transforms into

 lim⁡t′→τrelfp^≈p∞.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadawfqaqaaigbcygasjabcmgapjabc2gatbwcbaacbagaf8hdaqnbauaacqghsgiriigacqgfepaddaqhaaadbagae8nuailae8xzaumae8hbawgabagae8nzaygaaawcbeaakiqb=bfaqzaajagaeiikagccbegae0heag3aawbaasqabeaacqqfmbgzaagccqggsaalcuwf0badgaqbaiabcyha8jab9hha4jabcycasiab=rha0jabcmcapiabgiki7kab=bfaqnaabaaaleaacqgheispaeqaaogaeiikagiae0heag3aawbaasqabeaacqqfmbgzaagccqgg8bafcqqf4baecqggpaqkcqgguaglaaa@5628@ 

obtaining this probabilistic description and then using it in the evolution of the slow network forms the core of multiscale, stochastic mc methods  <cit>  . the solver used to compute it is called microscopic solver. a difficulty is that the relaxation time, τrelf
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfepaddaqhaawcbaacbagae4nuailae4xzaumae4hbawgabagae4nzaygaaaaa@33d0@, is unknown in complex systems. we have indirectly addressed this issue in refs.  <cit>  and revisit it below.

b. partitioning of a stiff stochastic system
in our algorithm, one method we use follows the partitioning scheme proposed by cao et al.  <cit>  by identifying the fast and slow processes based on reaction propensities, aj. we identify a fast reaction subset rf≡{r1f,r2f,...,rmff}
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiewacqwfsbgudaahaawcbeqaaiab=zgambaakiabggmi6oaacmqabaacbagae4nuai1aa0baasqaaiabigdaxaqaaiab+zgambaakiabcycasiab+jfasnaadaaaleaacqaiyagmaeaacqgfmbgzaagccqggsaalcqgguaglcqgguaglcqgguaglcqggsaalcqgfsbgudaqhaawcbagae4xba02aawbaawqabeaacqgfmbgzaaaaleaacqgfmbgzaaaakiaawuhacagl9baaaaa@458f@ with mf reactions, and a slow reaction subset rs≡{r1s,r2s,...,rmss}
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiewacqwfsbgudaahaawcbeqaaiab=nhazbaakiabggmi6oaacmqabaacbagae4nuai1aa0baasqaaiabigdaxaqaaiab+nhazbaakiabcycasiab+jfasnaadaaaleaacqaiyagmaeaacqgfzbwcaagccqggsaalcqgguaglcqgguaglcqgguaglcqggsaalcqgfsbgudaqhaawcbagae4xba02aawbaawqabeaacqgfzbwcaaaaleaacqgfzbwcaaaakiaawuhacagl9baaaaa@4611@ with ms reactions. all species  participating in fast reactions are defined as fast species, and the remaining species as slow species. the state is given by x = ,xs), where xf=
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieqacqwfybawdaahaawcbeqaaiab=zgambaakiabcicaogqaaiab+rha0jabcmcapiabg2da9maabmaabagae4hwag1aa0baasqaaiabigdaxaqaaiab+zgambaakiabcycasiab+hfaynaadaaaleaacqaiyagmaeaacqgfmbgzaagccqggsaalcqgguaglcqgguaglcqggsaalcqgfybawdaqhaawcbagae4nba42aawbaawqabeaacqgfmbgzaaaaleaacqgfmbgzaaaakiaawicacaglpaaaaaa@468d@ and xs=
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieqacqwfybawdaahaawcbeqaaiab=nhazbaakiabcicaogqaaiab+rha0jabcmcapiabg2da9maabmaabagae4hwag1aa0baasqaaiabigdaxaqaaiab+nhazbaakiabcycasiab+hfaynaadaaaleaacqaiyagmaeaacqgfzbwcaagccqggsaalcqgguaglcqgguaglcqggsaalcqgfybawdaqhaawcbagae4nba42aawbaawqabeaacqgfzbwcaaaaleaacqgfzbwcaaaakiaawicacaglpaaaaaa@470f@ are the states of the fast and slow species, respectively. nf and ns are the number of fast and slow species, respectively, and n = nf+ns is the total number of species. the propensity function of the slow reaction rjs
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfsbgudaqhaawcbagae8naaogabagae83camhaaaaa@30cf@ and of the fast reaction rjf
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfsbgudaqhaawcbagae8naaogabagae8nzaygaaaaa@30b5@ at state x =  can be generally written as ajs=ajs
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfhbqydaqhaawcbagae8naaogabagae83camhaaowaaewaaeaaieqacqgf4baecqgg7awocqwf0badaiaawicacaglpaaacqgh9aqpcqwfhbqydaqhaawcbagae8naaogabagae83camhaaowaaewaaeaacqgf4baedaahaawcbeqaaiab+zgambaakiabcycasiab+hha4naacaaaleqabagae43camhaaogaei4oasjae8hdaqhacagloagaayzkaaaaaa@4695@, and ajf=ajf
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfhbqydaqhaawcbagae8naaogabagae8nzaygaaowaaewaaeaaieqacqgf4baecqgg7awocqwf0badaiaawicacaglpaaacqgh9aqpcqwfhbqydaqhaawcbagae8naaogabagae8nzaygaaowaaewaaeaacqgf4baedaahaawcbeqaaiab+zgambaakiabcuda7iab=rha0bgaayjkaiaawmcaaaaa@426c@, respectively.

partitioning is done according to a user-defined threshold of the propensities. the choice of this threshold is influenced by the required accuracy and the computational cost. using simple model systems  <cit> , it was found that a separation of time scales of at least  <dig> orders of magnitude is necessary for the msmc method to be accurate and computationally more efficient; this value is further discussed below using new and more complex examples. this ranked propensity-based partitioning scheme does not always yield a single cut-off point, especially for large networks with multiple gaps in time scales. furthermore, it does not identify the relaxation time. we propose the use of the computational singular perturbation  technique to assist with these difficulties.

computational singular perturbation -assisted stochastic partitioning
the computational singular perturbation  technique was introduced by lam, goussis and co-workers, e.g.,  <cit> , as a diagnostic tool for gaining physical insight into the reaction dynamics of large complex networks, and as an accelerated deterministic solver for stiff networks. our principal interest in the csp approach is in its diagnostic power, specifically its ability to identify the species present in qe, and the dominating reactions in the fast and slow modes. we refer to our use of csp techniques in network partitioning as a "csp-assisted stochastic partitioning".

consider the deterministic representation of the dynamics of a reaction network

 g=dxdt=∑i=1mυiai.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieqacqwfnbwzcqggoaakcqwf4baecqggpaqkcqgh9aqpdawcaaqaagqaaiab+rgakjab=hfaybqaaiab+rgakjab+rha0baacqgh9aqpdaaewbqaaggadiab9v8a1naabaaaleaacqwfpbqaaeqaaogae4xyae2aasbaasqaaiab+lgapbqabagccqggoaakcqwf4baecqggpaqkasqaaiab+lgapjabg2da9iabigdaxaqaaiab+1gatbqdcqghris5aogaeiola4caaa@49bb@ 

g is an n-dimensional vector, such that gi = dxi/dt describes the rate of change of species si. differentiating , yields

 dgdt=∂g∂x⋅dxdt=j¯¯⋅g,
mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadawcaaqaagqaaiab=rgakhqabiab+dganjabcicaoiab+hha4jabcmcapaqaaiab=rgakjab=rha0baacqgh9aqpdawcaaqaaggaciab9jgi2kab+dganbqaaiab9jgi2kab+hfaybaacqghfly1dawcaaqaaiab=rgakjab+hfaybqaaiab=rgakjab=rha0baacqgh9aqpdaadbaqaaiab+peakbaacqghfly1cqgfnbwzcqggsaalaaa@49f0@ 

where j¯¯=∂g∂x
mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaadbaqaagqabiab=peakbaacqgh9aqpdawcaaqaaggaciab+jgi2kab=dganbqaaiab+jgi2kab=hfaybaaaaa@3446@ is the jacobian matrix of g. in general, the jacobian matrix, j¯¯
mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaadbaqaagqabiab=peakbaaaaa@2de0@ is not a diagonal matrix. we perform a linear transformation on g,

 f=b¯¯⋅g,
mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieqacqwfmbgzcqgh9aqpdaadbaqaaiab=jgaibaacqghfly1cqwfnbwzcqggsaalaaa@34e4@ 

such that the transformed mode f evolves in a decoupled manner,

 dfdt=Λ¯¯⋅f.
mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadawcaaqaagqaaiab=rgakhqabiab+zgambqaaiab=rgakjab=rha0baacqgh9aqpdaadbaqaaggabiab9t5ambaacqghfly1cqgfmbgzcqgguaglaaa@3933@ 

the matrix b¯¯
mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufebsjuyzl2yd9gzlbvynv2caerbwvmckfmbhbqedmvetj2bsbqee0evguee0jxyaibaieigflioyr2nhoxjyhrpyhrpypi8f4rqqrffpeea0xe9lq=jc9vqaqpepm0xbbg8faspyrqj0=yi0lxdbba9pge9qqff0dxdhuk9fr=xfr=xfrpiwzqaaeaabigaaiaacaqabeaabeqacmaaaoqaamaameaabawexlmbb50ujbqegcuavzxyu5wagi0bvtgaiqqacqwfibgyaaaaaa@3e4d@ consists of a set of n linearly independent row vectors, bi, and is chosen appropriately to decouple the evolution of the transformed modes, f. Λ¯¯
mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaadbaqaaggabiab=t5ambaaaaa@2e37@ is a diagonal matrix with the diagonal elements, |Λii|, arranged in the order of descending magnitudes. every vector, bi, is associated with a vector, bi*
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieqacqwfibgydaqhaawcbagae8xaakgabagamaiscqcaqaaaaaa@3197@ through the biorthonormality condition, such that,

 bi*⋅bj=1  and bi*⋅bj=0 
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieqacqwfibgydaqhaawcbagae8xaakgabagamaipcqcaqaaakiabgwsixlab=jgainaabaaaleaacqwfqbgaaeqaaogaeyypa0jaegymaejaeeiiaaiaeiikagccbagae4xaakmaeyypa0jae4naaomaeiykakiaeeiiaaiae4xyaemae4nba4mae4hzaqmaeeiiaaiae8nyai2aa0baasqaaiab=lgapbqaaiadasqgqagkaagccqghfly1cqwfibgydawgaawcbagae8naaogabeaakiabg2da9iabicdawiabbccagiabcicaoiab+lgapjabgcmi5kab+pgaqjabcmcapaaa@5746@ 

the matrix b*¯¯
mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaadbaqaagqabiab=jgainaacaaaleqabagamgjvcqcaqaaaaaaaaa@3075@ consists of n linearly independent column vectors, bi*
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieqacqwfibgydaqhaawcbagae8xaakgabagamaiscqcaqaaaaaa@3197@, and is called the basis vectors set. the matrix b¯¯
mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufebsjuyzl2yd9gzlbvynv2caerbwvmckfmbhbqedmvetj2bsbqee0evguee0jxyaibaieigflioyr2nhoxjyhrpyhrpypi8f4rqqrffpeea0xe9lq=jc9vqaqpepm0xbbg8faspyrqj0=yi0lxdbba9pge9qqff0dxdhuk9fr=xfr=xfrpiwzqaaeaabigaaiaacaqabeaabeqacmaaaoqaamaameaabawexlmbb50ujbqegcuavzxyu5wagi0bvtgaiqqacqwfibgyaaaaaa@3e4d@, which is the inverse of the basis vector set, is called the dual vector set. lam defined an ideal basis vector set, b*¯¯
mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaadbaqaagqabiab=jgainaacaaaleqabagamgjvcqcaqaaaaaaaaa@3075@ as one that completely decouples the evolution of the transformed modes  <cit> . the csp method provides an iterative refinement procedure  <cit>  to obtain the ideal basis vector set from a random trial basis set.

for linear systems, the jacobian matrix is independent of time, and thus, the right hand eigenvectors of the jacobian, j¯¯
mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaadbaqaagqabiab=peakbaaaaa@2de0@, can be conveniently used as the ideal basis vector, b*¯¯
mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaadbaqaagqabiab=jgainaacaaaleqabagamgjvcqcaqaaaaaaaaa@3075@. in this case, b¯¯
mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufebsjuyzl2yd9gzlbvynv2caerbwvmckfmbhbqedmvetj2bsbqee0evguee0jxyaibaieigflioyr2nhoxjyhrpyhrpypi8f4rqqrffpeea0xe9lq=jc9vqaqpepm0xbbg8faspyrqj0=yi0lxdbba9pge9qqff0dxdhuk9fr=xfr=xfrpiwzqaaeaabigaaiaacaqabeaabeqacmaaaoqaamaameaabawexlmbb50ujbqegcuavzxyu5wagi0bvtgaiqqacqwfibgyaaaaaa@3e4d@ is the inverse of the eigenvector matrix of j¯¯
mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaadbaqaagqabiab=peakbaaaaa@2de0@. for nonlinear systems, the eigenvectors of j¯¯
mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaadbaqaagqabiab=peakbaaaaa@2de0@ are time-dependent, and do not constitute an ideal basis vector set. lam  <cit>  proved that using the eigenvectors as an ideal basis set for nonlinear systems provides a leading order accuracy. since we employ the csp technique as a partitioning guide, leading order accuracy suffices as our examples indicate.

the elements Λii represent the time scales of the system, with a possible gap in the magnitude of Λii reflecting a time-scale separation. assuming that such a gap can be identified, i.e., the system is stiff, we get a set of nf fast modes, ff, and ns slow modes, fs. if the separation is large enough, i.e., min⁡≫max⁡
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacyggtbqbcqggpbqacqggubgbdaqadaqaamaaemaabagaeu4mdw0aa0baasqaagqaaiab=lgapjab=lgapbqaaiab=zgambaaaogaay5bslaawia7aagaayjkaiaawmcaaiablumi=igbc2gatjabcggahjabciha4naabmaabawaaqwaaeaacqqhboatdaqhaawcbagae8xaakmae8xaakgabagae83camhaaagccaglhwuaayjcsdaacagloagaayzkaaaaaa@4b20@, then the fast modes relax rapidly, and the reduced system consisting of only the slow modes can be evolved over the low-dimensional manifold using larger time increments. while such a transformation in deterministic systems is helpful in removing stiffness from the system and reducing the system dimension, here we are more interested in extracting the physical meaning of the modes, and identifying reactions and/or species that contribute to the fast modes.

lam  <cit>  defined the mode participation index  of reaction j in mode i as

 pji≡bjiaj∑r=1m|briar|+oi= <dig> ,...n, j= <dig> ,...,m
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfqbaudaqhaawcbagae8naaogabagae8xaakgaaogaeyyyio7aasaaaeaacqwfcbgqdaqhaawcbagae8naaogabagae8xaakgaaogae8xyae2aasbaasqaaiab=pgaqbqabaaakeaadaaewbqaamaaemaabagae8nqai0aa0baasqaaiab=jhaybqaaiab=lgapbaakiab=fgahnaabaaaleaacqwfybgcaeqaaagccaglhwuaayjcsdgaey4kasiae83ta80aaewaaeaadaabdaqaaiab=jgainaabaaaleaacqwfpbqaaeqaaogaeyyxictaeyildqkae8xeak3aiai1caaaleqcasdaiai1cwagulokaocaaogaei4la8iaeyildqkae8hdaq3aiaivcaaaleqcaybaiaivcwagulokaocaaagccaglhwuaayjcsdaacagloagaayzkaaaaleaacqwfybgccqgh9aqpcqaixaqmaeaacqwftbqba0gaeyyeiuoaaagccqwfpbqacqgh9aqpcqaixaqmcqggsaalcqaiyagmcqggsaalcqgguaglcqgguaglcqgguaglcqwfubgbcqggsaalcqqggaaicqwfqbgacqgh9aqpcqaixaqmcqggsaalcqaiyagmcqggsaalcqgguaglcqgguaglcqgguaglcqggsaalcqwftbqbaaa@8037@ 

where bji
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfcbgqdaqhaawcbagae8naaogabagae8xaakgaaaaa@309b@ is given by the dot product bi ⊙ υj. Δy* and Δt* are user-defined values of acceptable error in temporal solution provided by the csp method. to simplify our analysis, we neglect the second term, o, that sets the threshold for magnitude of relaxed f. the participation index, pji
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfqbaudaqhaawcbagae8naaogabagae8xaakgaaaaa@30b7@, for the fast modes  gives the fractional contribution of reaction j to the fast mode, i.

herein, the csp method is used at any stochastic state to understand the instantaneous time scales and appropriately partition the network at that state. this constitutes our second partitioning method. the evolution of the reaction network is still carried out in a stochastic manner, using the hymsmc method. the jacobian at a stochastic state can be approximated using the corresponding deterministic model or its variant where the mean-field propensity functions are used instead of the deterministic reaction rates. we propose the latter approach. in addition, we recommend using an analytical jacobian, if possible, due to its higher accuracy and lower computational cost. aside from partitioning, the csp method provides an estimate of the relaxation time of the system that could be used for converging the fast network. since there are multiple eigenvalues, and thus multiple time scales, in our implementation we choose the smallest eigenvalue  from the nf fast modes, to relax the fastest dynamics. we discuss this concept further below and in the results section.

obviously, there is a computational overhead associated with the evaluation of the jacobian and the eigenvalue analysis. this overhead depends on whether the system is linear  or not, the system size and the frequency of carrying out the csp analysis. ideally, network partitioning, either csp-assisted or ranked propensity-based, should be performed prior to every call to the microscopic solver. practically however, when the trajectory evolves fairly smoothly and gradually, a few calls of the csp routine during a simulation are sufficient. for the networks considered in this work, the overhead of csp is negligible in comparison to the cost of a stochastic simulation . below, we demonstrate the potential of the csp technique using several examples and discuss the cpu of the csp analysis for the most complicated example.

c. evolution of the slow network
once the qe pdf of the fast network has been obtained, the slow network is evolved. appendix a discusses various approximations. the slow-scale approximation  <cit>  evolves the slow network using the slow-scale propensities as the effective transition probabilities of the slow reactions. the slow-scale propensity of reaction rjs
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfsbgudaqhaawcbagae8naaogabagae83camhaaaaa@30cf@ is the expectation of the propensity function, ajs
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfhbqydaqhaawcbagae8naaogabagae83camhaaaaa@30ed@, over the temporal qe pdf given by

 ajs¯=∑xf′p^∞⋅ajs,
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaqdaaqaagqaaiab=fgahnaadaaaleaacqwfqbgaaeaacqwfzbwcaaaaaogaeiikagccbegae4heagnaeiykakiaeyypa0zaaabuaeaacuwfqbaugaqcamaabaaaleaacqgheispaeqaaogaeiikagiae4heag3aawbaasqabeaacugfmbgzgaqbaaaakiabcyha8jab+hha4jabcmcapiabgwsixlab=fgahnaadaaaleaacqwfqbgaaeaacqwfzbwcaagcdaqadaqaaiab+hha4naacaaaleqabagaf4nzaymbauaaaagccqggsaalcqgf4baedaahaawcbeqaaiab+nhazbaaaogaayjkaiaawmcaaawcbagae8heag3aawbaawqabeaacuwfmbgzgaqbaaaaasqab0gaeyyeiuoakiabcycasaaa@54f0@ 

where the summation is performed over all the equilibrium states xf' visited by the fast species  <cit> . slow reactions are picked and the elapsed time is computed the same way as in the ssa.

after a slow reaction has been picked, the populations of the species need to be updated. this is not as straightforward, and while critical, has been largely overlooked. a rigorous way of picking slow reactions and subsequently updating the slow network is based on a joint pdf  <cit>  . in this work, we use the last state present after the relaxation criterion  has been met. in doing this, we minimize the computational effort and also ensure that the fast state belongs to stationary pdf p∞. in some cases, the selected slow reaction cannot be executed from some states 
of the fast species, e.g., a reactant species with zero population, even though these states might be visited frequently  <cit> . care is taken that the chosen slow reaction can be executed from that state by checking the feasibility of firing the chosen slow reaction from the selected state. failure to satisfy this condition calls for additional simulation of the relaxed fast network until the chosen slow reaction can occur from the current state of fast species or selection from a database of states from p∞. this eliminates the problem of having negative populations.

d. relaxation of the fast network
the next question is how does one gauge the relaxation of the fast network and decide the time, τeqm, required to obtain an accurate approximation of the stationary pdf, p→, or the slow-scale propensities, ajs¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaqdaaqaagqaaiab=fgahnaadaaaleaacqwfqbgaaeaacqwfzbwcaaaaaaaa@30fe@ ? e et al.  <cit>  decide τeqm via an implicit relation to the deviation of the numerical estimate of the slow-scale propensity from its true value. salis and kaznessis  <cit>  relax the fast network for a user-defined number of mc events, mceeqmf
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfnbqtcqwfdbwqcqwffbqrdaqhaawcbagae8xraukae8xcaenae8xba0gabagae8nzaygaaaaa@3541@. a predetermined choice of τeqm or mceeqmf
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfnbqtcqwfdbwqcqwffbqrdaqhaawcbagae8xraukae8xcaenae8xba0gabagae8nzaygaaaaa@3541@ overlooks the likelihood of the relaxation time varying with time, and may make the multiscale simulation inaccurate and potentially inefficient. thus, we need a more generic relaxation criterion that decides the relaxation time  of the fast network on-the-fly. this issue is addressed next.

the slow-scale propensity is the first moment  of the propensity of the slow reaction, evaluated over the entire stationary pdf p∞. in this work, we test convergence of the slow-scale propensities rather than of the entire pdf. we propose the  <dig> sample t-test to check for convergence of the slow-scale propensities. the  <dig> sample t-test is a commonly used statistical tool to verify with a certain degree of confidence, if two independently drawn samples of a random variable come from the same probability distribution. in the current context, the state of the fast species , of the slow reaction) is the random variable, such that a sample of a size p corresponds to p events of the fast network, with the state at every fast event corresponding to one data point in the sample. the t-statistic for a  <dig> sample t-test, assuming unequal sample sizes, n <dig> and n <dig>  and unequal variances, is given by

 tj=ajs¯|1−ajs¯|2σj2|1n1+σj2|2n2∀ j∈rs.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiewacqwf0baddawgaawcbagaemoaaogabeaakiabg2da9maalaaabawaaqgaaeaadaqdaaqaagqaaiab+fgahnaadaaaleaacqgfqbgaaeaacqgfzbwcaaaaaagccagliwoadawgaawcbagaegymaedabeaakiabgkhitmaaeiaabawaa0aaaeaacqgfhbqydaqhaawcbagae4naaogabagae43camhaaaaaaogaayjcsdwaasbaasqaaiabikdayaqabaaakeaadagcaaqaamaalaaabawaaqgaaeaaiigacqqfdpwcdaqhaawcbagae4naaogabagaegomaidaaagccagliwoadawgaawcbagaegymaedabeaaaoqaaiab+5eaonaabaaaleaacqaixaqmaeqaaaaakiabgucarmaalaaabawaaqgaaeaacqqfdpwcdaqhaawcbagae4naaogabagaegomaidaaagccagliwoadawgaawcbagaegomaidabeaaaoqaaiab+5eaonaabaaaleaacqaiyagmaeqaaaaaaeqaaaaakiabgcgiiiabbccagiab+pgaqjabgigiolab=jfasnaacaaaleqabagaem4camhaaogaeiola4caaa@5ba4@ 

here ajs¯|1
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaabcaqaamaanaaabaacbagae8xyae2aa0baasqaaiab=pgaqbqaaiab=nhazbaaaaaakiaawia7amaabaaaleaacqaixaqmaeqaaaaa@33ba@ and σj2|1
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaabcaqaaggaciab=n8aznaadaaaleaaieaacqgfqbgaaeaacqgfyagmaaaakiaawia7amaabaaaleaacqaixaqmaeqaaaaa@33a8@ are, respectively, the mean and variance of the propensity ajs
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfhbqydaqhaawcbagae8naaogabagae83camhaaaaa@30ed@ evaluated from n <dig> = ·mcewin mc events in the first  simulation windows. ajs¯|2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaabcaqaamaanaaabaacbagae8xyae2aa0baasqaaiab=pgaqbqaaiab=nhazbaaaaaakiaawia7amaabaaaleaacqaiyagmaeqaaaaa@33bc@ and σj2|2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaabcaqaaggaciab=n8aznaadaaaleaaieaacqgfqbgaaeaacqgfyagmaaaakiaawia7amaabaaaleaacqaiyagmaeqaaaaa@33aa@ are the mean and the variance of the propensity ajs
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfhbqydaqhaawcbagae8naaogabagae83camhaaaaa@30ed@ from n <dig> = mcewin events in the wth  window. we define a window as a short stochastic simulation of the fast network, consisting of mcewin fast mc events. the slow-scale propensities are converged to a stationary value when

 -tα/ <dig> υ <tj, <tα/ <dig> υ, for all j∈rs, 

where tα/ <dig> υ is the value of the t-statistic for υ degrees of freedom and a significance level of α/ <dig>  we use a significance level, α =  <dig> , in all the simulations shown in the results section. υ is evaluated as

 υ=22/+2/.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwffpqdcqgh9aqpdawcaaqaamaabmaabawaasgbaeaadaabcaqaaiab=n8aznaadaaaleaaieaacqgfqbgaaeaacqaiyagmaaaakiaawia7amaabaaaleaacqaixaqmaeqaaagcbagae4nta40aasbaasqaaiabigdaxaqabaaaaogaey4kasyaasgbaeaadaabcaqaaiab=n8aznaadaaaleaacqgfqbgaaeaacqaiyagmaaaakiaawia7amaabaaaleaacqaiyagmaeqaaagcbagae4nta40aasbaasqaaiabikdayaqabaaaaagccagloagaayzkaawaawbaasqabeaacqaiyagmaaaakeaadawcgaqaamaabmaabawaasgbaeaadaabcaqaaiab=n8aznaadaaaleaacqgfqbgaaeaacqaiyagmaaaakiaawia7amaabaaaleaacqaixaqmaeqaaagcbagae4nta40aasbaasqaaiabigdaxaqabaaaaagccagloagaayzkaawaawbaasqabeaacqaiyagmaaaakeaacqggoaakcqgfobgtdawgaawcbagaegymaedabeaakiabgkhitiabigdaxiabcmcapaaacqghrawkdawcgaqaamaabmaabawaasgbaeaadaabcaqaaiab=n8aznaadaaaleaacqgfqbgaaeaacqaiyagmaaaakiaawia7amaabaaaleaacqaiyagmaeqaaagcbagae4nta40aasbaasqaaiabikdayaqabaaaaagccagloagaayzkaawaawbaasqabeaacqaiyagmaaaakeaacqggoaakcqgfobgtdawgaawcbagaegomaidabeaakiabgkhitiabigdaxiabcmcapaaaaagaeiola4caaa@6b93@ 

to simplify the implementation of the above test and to avoid the recurring evaluation of the tα/ <dig> υ, we assume that υ >  <dig>  and hence fix the critical value at tα/ <dig> υ ≅  <dig> . since tα/ <dig> υ increases with decreasing υ, using tα/ <dig> υ ≅  <dig>  in cases where υ <  <dig> imposes a more stringent criterion on the relaxation, and hence can be used safely.

the accuracy of the multiscale method depends on the convergence of the slow-scale propensities. for instance, if the qe pdf is bimodal, then it is crucial that both the branches be sufficiently sampled in evaluating the slow-scale propensities. also, it is possible that by pure chance, the mcewin fast events in the first relaxation window do not alter the populations of any fast species participating in the slow network. so the t-test might falsely indicate convergence of slow-scale propensities as a result of inadequate sampling. to avoid such a situation, we suggest that the window length accounts for the size of, and the separation of scales within, the fast network, to ensure that all the fast reactions are adequately sampled.

we propose that the relaxation time, computed via csp, should be used in conjunction with the relaxation time estimated via the statistical one to ensure sufficient sampling of qe state space. in general, we find good agreement between the statistical and csp relaxation methods as detailed below in several numerical examples. in general, one should relax the system for the longest of the two times estimated by the csp and the statistical criterion. convergence of bistable systems is interesting  as discussed in the results section.

the hybrid multiscale monte carlo  method
the new relaxation criterion discussed above enhances the efficiency of the original msmc method. there are two other areas that can be exploited to further accelerate the method: one is to execute multiple firings at each microscopic time step and the other is to reduce the number of evaluations of the qe pdf. one could reuse the same qe pdf for a few consecutive coarse  time steps, assuming that the occurrence of the slow events does not significantly alter this pdf. this is reminiscent of the τ-leap  methods  <cit> , where the leap condition allows one to perform multiple firings of the reactions in a pre-selected leap time. the inherent assumption of the tl methods is that the propensities remain unchanged in the leap time, and hence one can approximate the number of firings in the reaction channels using a poisson  <cit>  or a binomial random variable  <cit> . while maintaining the same qe pdf for a few coarse  time steps can potentially result in substantial computational savings, we need a criterion to indicate how long one could maintain the same pdf without sacrificing accuracy. we address this question by using the framework of the hybrid ssa-tl solver  <cit>  to systematically coarse grain the macroscopic solver in time. since leaping the slow reactions significantly moves the fast network away from its qe, we also propose the hybrid ssa-tl method  <cit>  as the microsolver to speedup the relaxation of the fast network at every coarse time step.

the τ-leap solver  <cit> , which temporally coarse-grains the exact ssa, works well only in the limit of large population  <cit> . at low population of the reactant species, there is a risk of observing negative populations due to the unbounded nature of the poisson random variable. the binomial τ-leap methods  <cit>  eliminate this problem, but are not as accurate and efficient at low populations. recently, the hybrid ssa-tl method was introduced by cao et al.  <cit> , primarily, to reduce the possibility of negative population of the poisson τ-leap solver. a similar hybrid solver, the partitioned leaping method  <cit> , which combines the next reaction method  <cit>  and the poisson τ-leap method  <cit> , was introduced by harris and clancy. we incorporate the hybrid ssa-tl solver  <cit>  into the msmc method as the macrosolver and the microsolver. this practically eliminates the likelihood of negative populations while using the explicit poisson tl method. we call this method the hybrid multiscale monte carlo  method.

the overall concept of hymsmc is depicted in figure  <dig>  integration of the hybrid solver with the multiscale framework begins with classification of the fast  reactions into ssa reactions and tl reactions subset, rssaf
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiewacqwfsbgudaqhaawcbagaem4uamlaem4uamlaemyqaeeabagaemozaygaaaaa@32cc@ and rtlf
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiewacqwfsbgudaqhaawcbagaemivaqlaemitaweabagaemozaygaaaaa@31b5@ and , respectively. all reactions whose reactant population is less than some critical population, xcrit, are defined as ssa reactions  <cit> . we have successfully used xcrit =  <dig> in all simulations to obtain accurate results. in principle, the cost and accuracy of the hybrid solver increases with xcrit, with the method reducing to ssa for xcrit → ∞, and to a poisson tl for xcrit =  <dig>  generating poisson random numbers is more expensive than generating uniform random numbers. as a result, there is a xcrit value below which the hybrid solver is more expensive than the ssa. this computational overhead of the hybrid solver should be considered in deciding the optimum xcrit that maximizes the efficiency of the solution.

a. hybrid solver as the microscopic solver
the objective of using the hybrid solver as the microsolver is to accelerate the relaxation of the fast network via a coarser sampling of the qe state space of the fast species. only one reaction from the ssa reaction group is executed. the average elapsed time until the occurrence of the next fast reaction belonging to rfssa
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiewacqwfsbgudaqhaawcbagaemozaygabagaem4uamlaem4uamlaemyqaeeaaaaa@32cc@ is evaluated as  <cit> 

 τssaf=−ln⁡∑j∈rssafajf.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfepaddaqhaawcbaacbagae43uamlae43uamlae4xqaeeabagae4nzaygaaogaeyypa0jaeyoei0yaasaaaeaacyggsbabcqggubgbcqggoaakcqwf+oaedawgaawcbagaegymaedabeaakiabcmcapaqaamaaqafabagae4xyae2aa0baasqaaiab+pgaqbqaaiab+zgambaaaeaacqgfqbgacqghiiiziewacqqfsbgudaqhaaadbaacbigaew3uamlaew3uamlaewxqaeeabagaewnzaygaaawcbeqdcqghris5aaaakiabc6cauaaa@4cd7@ 

the hybrid solver executes multiple firings of the tl reactions in a leap. the leap time is estimated using a leap criterion that imposes an upper bound on the mean and the variance of the change in the propensity in this leap time  <cit> . to evaluate τtlf
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfepaddaqhaawcbaacbagae4hvaqlae4htaweabagae4nzaygaaaaa@3246@, we use the r-criterion  given by  <cit> 

 τtlf=min⁡i∈sf{rxif∑j∈rtlf;υijf<0−υijfajf}.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfepaddaqhaawcbaacbagae4hvaqlae4htaweabagae4nzaygaaogaeyypa0zaacbeaeaacyggtbqbcqggpbqacqggubgbasqaaiab+lgapjabgigiojqadiab9nfatnaacaaameqabagaemozaygaaawcbeaakmaacmaabawaasaaaeaacqgfybgccqgf4baedaqhaawcbagae4xaakgabagae4nzaygaaagcbawaaabuaeaacqghsislcqwffpqddaqhaawcbagae4xaakmae4naaogabagae4nzaygaaogae4xyae2aa0baasqaaiab+pgaqbqaaiab+zgambaakmaabmaabaacbegaewheag3aawbaasqabeaacqafmbgzaaaakiaawicacaglpaaaasqaaiab+pgaqjabgigiolab9jfasnaadaaameaacqwgubavcqwgmbataeaacqwgmbgzaawccqgg7awocqwffpqddaqhaaadbagae4xaakmae4naaogabagae4nzaygaasgaeyipawjaegimaadabeqdcqghris5aaaaaogaay5eaiaaw2haaiabc6cauaaa@68c2@ 

the time increment τf is chosen as

 τf=min⁡{τtlf,τssaf}
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfepaddaahaawcbeqaagqaaiab+zgambaakiabg2da9igbc2gatjabcmgapjabc6gaunaacmaabagae8hxdq3aa0baasqaaiab+rfaujab+xeambqaaiab+zgambaakiabcycasiab=r8a0naadaaaleaacqgftbwucqgftbwucqgfbbqqaeaacqgfmbgzaaaakiaawuhacagl9baaaaa@4471@ 

if τtlf≥τssaf
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfepaddaqhaawcbaacbagae4hvaqlae4htaweabagae4nzaygaaogaeyyzimrae8hxdq3aa0baasqaaiab+nfatjab+nfatjab+feabbqaaiab+zgambaaaaa@3aad@, we sample a single fast reaction  from the subset rssaf
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiewacqwfsbgudaqhaawcbagaem4uamlaem4uamlaemyqaeeabagaemozaygaaaaa@32cc@ such that j is the smallest integer satisfying

 ∑i=1jaif≥ξ2⋅∑i∈rssafaif.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaaewbqaagqaaiab=fgahnaadaaaleaacqwfpbqaaeaacqwfmbgzaagccqghljysiigacqgf+oaedawgaawcbagaegomaidabeaaaeaacqwfpbqacqgh9aqpcqaixaqmaeaacqwfqbgaa0gaeyyeiuoakiabgwsixpaaqafabagae8xyae2aa0baasqaaiab=lgapbqaaiab=zgambaaaeaacqwfpbqacqghiiiziewacqqfsbgudaqhaaadbagaem4uamlaem4uamlaemyqaeeabagaemozaygaaawcbeqdcqghris5aogaeiola4caaa@4ee0@ 

here ξ <dig> and ξ <dig> are uniform random numbers, sampled from the unit interval ,for allj∈rtlf.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfrbwadaqhaawcbagae8naaogabagae8nzaygaaogaeyypa0dcbmgae4huaa1aaewaaeaacqwfhbqydaqhaawcbagae8naaogabagae8nzaygaaggacogae0hxdq3aawbaasqabeaacqwfmbgzaaaakiaawicacaglpaaacqggsaalcqwfmbgzcqwfvbwbcqwfybgccqqggaaicqwfhbqycqwfsbabcqwfsbabcqwfgaaicqwgqbgacqghiiizcqgfsbgudaqhaawcbagaemivaqlaemitaweabagaemozaygaaogaeiola4caaa@4f7f@ 

if τtlf<τssaf
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfepaddaqhaawcbaacbagae4hvaqlae4htaweabagae4nzaygaaogaeyipawjae8hxdq3aa0baasqaaiab+nfatjab+nfatjab+feabbqaaiab+zgambaaaaa@39eb@ then only the tl reactions are fired according to eq. .

b. hybrid solver as the macroscopic solver
employing the hybrid solver as the macroscopic solver to evolve the slow network replaces the instantaneous value of propensities in the above eqs. with the slow-scale propensities. for completeness, the time increment used to evolve the slow network is given by

 τs=min⁡{τtls,τssas}
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfepaddaahaawcbeqaagqaaiab+nhazbaakiabg2da9igbc2gatjabcmgapjabc6gaunaacmaabagae8hxdq3aa0baasqaaiab+rfaujab+xeambqaaiab+nhazbaakiabcycasiab=r8a0naadaaaleaacqgftbwucqgftbwucqgfbbqqaeaacqgfzbwcaaaakiaawuhacagl9baaaaa@44bf@ 

where

 τssas=−ln⁡∑j∈rssasajs
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqahepaddaqhaawcbaacbagae83uamlae83uamlae8xqaeeabagae83camhaaogaeyypa0jaeyoei0yaasaaaeaacyggsbabcqggubgbdaqadaqaaggaciab+57a4naabaaaleaacqaixaqmaeqaaagccagloagaayzkaaaabawaaabuaeaacqwfhbqydaqhaawcbagae8naaogabagae83camhaaaqaaiab=pgaqjabgigiojqadiab9jfasnaadaaameaacqwgtbwucqwgtbwucqwgbbqqaeaacqwgzbwcaaaaleqaniabgghildaaaaaa@4c2b@ 

 τtls=min⁡i∈s{rxi|∑j∈rtls;υijs<0−υijsajs¯|}.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfepaddaqhaawcbaacbagae4hvaqlae4htaweabagae43camhaaogaeyypa0zaacbeaeaacyggtbqbcqggpbqacqggubgbasqaaiab+lgapjabgigiojqadiab9nfatbqabagcdagadaqaamaalaaabagae4ncainae4heag3aasbaasqaaiab+lgapbqabaaakeaadaabdaqaamaaqafabagaeyoei0iae8xxdu3aa0baasqaaiab+lgapjab+pgaqbqaaiab+nhazbaakmaanaaabagae4xyae2aa0baasqaaiab+pgaqbqaaiab+nhazbaaaaaabagae4naaomaeyici4sae0nuai1aa0baawqaaiabdsfaujabdyeambqaaiabdohazbaaliabcuda7iab=v8a1naadaaameaacqgfpbqacqgfqbgaaeaacqgfzbwcaawccqgh8aapcqaiwaamaeqaniabgghildaakiaawea7cagliwoaaaaacagl7bgaayzfaagaeiola4caaa@64f9@ 

if τssas≤τtls
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfepaddaqhaawcbaacbagae43uamlae43uamlae4xqaeeabagae43camhaaogaeyizimqae8hxdq3aa0baasqaaiab+rfaujab+xeambqaaiab+nhazbaaaaa@3ad0@, we sample a single reaction  from the subset rssas
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiewacqwfsbgudaqhaawcbagaem4uamlaem4uamlaemyqaeeabagaem4camhaaaaa@32e6@, such that j is the smallest integer satisfying

 ∑i=1jais¯≥ξ2⋅∑i∈rssasais¯.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaaewbqaamaanaaabaacbagae8xyae2aa0baasqaaiab=lgapbqaaiab=nhazbaaaagccqghljysiigacqgf+oaedawgaawcbagaegomaidabeaakiabgwsixpaaqafabawaa0aaaeaacqwfhbqydaqhaawcbagae8xaakgabagae83camhaaaaaaeaacqwfpbqacqghiiizcqwgsbgudaqhaaadbaacbmgae03uamlae03uamlae0xqaeeabagae03camhaaawcbeqdcqghris5aawcbagae8xaakmaeyypa0jaegymaedabagae8naaoganiabgghildgccqgguaglaaa@4f49@ 

the number of firings, kjs
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfrbwadaqhaawcbagae8naaogabagae83camhaaaaa@3101@, of a tl reaction rjs
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfsbgudaqhaawcbagae8naaogabagae83camhaaaaa@30cf@ ∈ rtls
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiewacqwfsbgudaqhaawcbagaemivaqlaemitaweabagaem4camhaaaaa@31cf@ is sampled from a poisson distribution with mean ajs¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaqdaaqaagqaaiab=fgahnaadaaaleaacqwfqbgaaeaacqwfzbwcaaaaaaaa@30fe@τs

 kjs=p,for allj∈rtls.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfrbwadaqhaawcbagae8naaogabagae83camhaaogaeyypa0dcbmgae4huaa1aaewaaeaadaqdaaqaaiab=fgahnaadaaaleaacqwfqbgaaeaacqwfzbwcaaaaaggacogae0hxdq3aawbaasqabeaacqwfzbwcaaaakiaawicacaglpaaacqggsaalcqwfmbgzcqwfvbwbcqwfybgccqqggaaicqwfhbqycqwfsbabcqwfsbabcqwfgaaicqwfqbgacqghiiizcqgfsbgudaqhaawcbagae4hvaqlae4htaweabagae43camhaaogaeiola4caaa@4fe5@ 

if τssas>τtls
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfepaddaqhaawcbaacbagae43uamlae43uamlae4xqaeeabagae43camhaaogaeyopa4jae8hxdq3aa0baasqaaiab+rfaujab+xeambqaaiab+nhazbaaaaa@3a23@, only the tl reactions are executed according to eq. .

algorithm implementation
 <dig>  initialize the system state x at time t =  <dig> and the simulation parameters, such as the critical population xcrit, the number of fast mc events, mcewin, for each relaxation window, the coarse graining factor, r, in the leap criterion, the partitioning criterion, and the significance level a of the statistical test used for the relaxation.

 <dig>  at the state x = , evaluate the propensities of all the reactions in the

network. partition the reaction network into a fast and a slow network, and the species into fast and slow species.

a. microscopic solver – fast network
 <dig>  perform mcewin mc events of the fast network using the hybrid ssa-tl solver. in each event,

a. identify the ssa and the tl subsets in the fast network, rssaf
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiewacqwfsbgudaqhaawcbagaem4uamlaem4uamlaemyqaeeabagaemozaygaaaaa@32cc@ and rtlf
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiewacqwfsbgudaqhaawcbagaemivaqlaemitaweabagaemozaygaaaaa@31b5@, respectively, based on the populations of the participating reactants;

b. evaluate the time increment τf using -;

c. execute kjf
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfrbwadaqhaawcbagae8naaogabagae8nzaygaaaaa@30e7@ reactions, rjf
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfsbgudaqhaawcbagae8naaogabagae8nzaygaaaaa@30b5@ ∈ rf using  and ;

d. update the state of the fast species, xif←xif+∑j∈rfkjfνijf fori∈sf
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwf4baedaqhaawcbagae8xaakgabagae8nzaygaaogaeyikhwqae8heag3aa0baasqaaiab=lgapbqaaiab=zgambaakiabgucarmaaqafabagae83aas2aa0baasqaaiab=pgaqbqaaiab=zgambaaiigakiab+17aunaadaaaleaacqwfpbqacqwfqbgaaeaacqwfmbgzaagccqqggaaiasqaaiab=pgaqjabgigiojqadiab9jfasnaacaaameqabaacbigaewnzaygaaawcbeqdcqghris5aogae8nzaymae83ba8mae8ncainae8hiaaiae8xaakmaeyici4sae03uam1aawbaasqabeaacqwgmbgzaaaaaa@5558@

 <dig>  evaluate the slow-scale propensities ajs¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaqdaaqaagqaaiab=fgahnaadaaaleaacqwfqbgaaeaacqwfzbwcaaaaaaaa@30fe@).

 <dig>  if the convergence criterion  is satisfied and the time is longer than the relaxation time predicted by csp, go to  <dig>  else, go to  <dig> and perform another mcewin fast events using the hybrid solver.

b. macroscopic solver – slow network
 <dig>  evolve the slow network using the hybrid ssa-tl solver:

a. identify the tl and the ssa reactions subsets rtls
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiewacqwfsbgudaqhaawcbagaemivaqlaemitaweabagaem4camhaaaaa@31cf@ and rtls
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiewacqwfsbgudaqhaawcbagaemivaqlaemitaweabagaem4camhaaaaa@31cf@ at the state ;

b. evaluate the time increment τs using eqs. -;

c. evaluate the number of firing kjs
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfrbwadaqhaawcbagae8naaogabagae83camhaaaaa@3101@ of rjs
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfsbgudaqhaawcbagae8naaogabagae83camhaaaaa@30cf@, using eqs.  and ;

d. if any reaction rjs
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfsbgudaqhaawcbagae8naaogabagae83camhaaaaa@30cf@ ∈ rs cannot be fired kjs
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfrbwadaqhaawcbagae8naaogabagae83camhaaaaa@3101@ times, execute steps 3a-3d until state xf = xf allows kjs
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfrbwadaqhaawcbagae8naaogabagae83camhaaaaa@3101@ executions of all reactions, rjs
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfsbgudaqhaawcbagae8naaogabagae83camhaaaaa@30cf@ ∈ rs or pick a state from a database that can be fired. else go to 6e;

e. update the state of all species, xi←xi+∑i=1nkjsνijs fori∈s
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwf4baedawgaawcbagae8xaakgabeaakiabgcziskab=hha4naabaaaleaacqwfpbqaaeqaaogaey4kasyaaabcaeaacqwfrbwadaqhaawcbagae8naaogabagae83camhaaggacogae4xvd42aa0baasqaaiab=lgapjab=pgaqbqaaiab=nhazbaakiabbccagawcbagae8xaakmaeyypa0jaegymaedabagae8nba4ganiabgghildgccqwfmbgzcqwfvbwbcqwfybgccqwfgaaicqwfpbqacqghiiiziewacqqftbwuaaa@509d@.

f. update the time t = t + τs.

 <dig>  if the desired time is reached, stop. else, go to step  <dig> 

step 6d is performed to avoid negative populations that may arise from using the stationary pdf to select the representative state of the fast network . next we demonstrate the strength of the hymsmc algorithm with the help of simple prototype examples. real biochemical networks are also considered to demonstrate the generality of the approach to complex networks.

algorithm testing
in each of the following examples, we demonstrate the efficiency and accuracy of the proposed hymsmc algorithm. simulations were performed on  <dig>  ghz intel® xeon processors. the relaxation of the fast network is assessed with a relaxation tolerance, tα/ <dig> υ =  <dig>   and using windows of  <dig> mc events. the hybrid solver uses a critical population of xcrit =  <dig> and a leap condition tolerance of r =  <dig> . in all the examples shown below, the method is accurate with this parameter set. each numerical example uniquely serves to highlight other novelties of the new hymsmc scheme.

a. coupled isomerization reactions
the first reaction network consists of two pairs of reversible isomerization reactions, coupled through a common species b

 a⇄k−1k1bb⇄k−2k2c.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakqaabeqaagqaaiab=feabnaao0aaleaacqwfrbwadawgaaadbagaegymaedabeaaasqaaiab=tgarnaabaaameaacqghsislcqaixaqmaeqaaagccaglsgiaayjkhagae8nqaieabagae8nqai0aa4qdasqaaiab=tgarnaabaaameaacqaiyagmaeqaaawcbagae83aas2aasbaawqaaiabgkhitiabikdayaqabaaakiaawkzicaglqgcacqwfdbwqcqgguaglaaaa@432a@ 

the above network is one of the simplest networks conducive to qe treatment. the simplicity of this network allows us to clearly demonstrate the key features of the hymsmc algorithm. it also clarifies the applicability and adaptability of the algorithm to different levels of time-scale and population-scale separation. the rate constants are chosen such that the first reaction pair is much faster than the second reaction pair, and thus it constitutes the fast network. a four orders of magnitude time scale separation exists between the partitioned networks. based on our definition, species a and b are the fast species and c is the slow species.

starting with an initial state xa =  <dig>  xb = xc =  <dig>  we generate stochastic trajectories of network  using the exact ssa, the msmc method, and the hymsmc method. as can be seen in figure  <dig> and figure  <dig>  the multiscale methods correctly predict the temporal evolution of the network. the hymsmc trajectories in figure 3c and figure 4c have been generated from states recorded after the occurrence of every slow event, i.e., at every macroscopic step, compared to every millionth mc events in the ssa  trajectories. approximately,  <dig> data points have been used to generate all the trajectories seen in figure  <dig> and figure  <dig>  ssa takes around  <dig> minutes for a single stochastic run from t =  <dig> to t =  <dig> s. the msmc run is completed in half a minute, and the hymsmc run, in a fraction of a second. the speedup over the exact ssa is  <dig> and  <dig> using the msmc technique and the hymsmc technique, respectively. using number of mc events as a metric, the speedup of the msmc and hymsmc methods over the ssa is ~ <dig> and  <dig>  respectively.

to compare the accuracy of the multiscale methods in a systematic manner, we generate normalized histograms of the states observed at time t =  <dig> s using  <dig> trajectories. figure  <dig> shows that the hymsmc method accurately captures the statistics of the process.

the above example clearly demonstrates the superiority of the hymsmc method over the msmc method. the strength of the hybrid scheme stems from its ability to handle large populations that typically render ssa solvers inefficient. the hybrid solver quickly relaxes the fast network, even when the pre-relaxation state is far away from the qe. the computational advantage of the hybrid solver, over the ssa, in relaxing the fast network, is demonstrated by comparing the convergence of the slow-scale propensities in figure  <dig>  the qe pdf of the fast species b is given by the binomial pdf, ℬ
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbamrthrhal1wy0l2yhvtyaehbnfgdovwbhrxajfwnaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabawaaegaeaaakeaaimaacqwfseiqaaa@377e@, where p = k1/ and n = . the slow-scale propensity of the linear reaction, b → c, is analytically given by k2np .
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaqdaaqaagqaaiab=fgahnaabaaaleaacqaizawmaeqaaaaaaaa@2f2d@, of reaction  <dig> in network  before the occurrence of the first slow event b → c, using the msmc  and the hymsmc  methods. the horizontal dashed line shows the slow-scale propensity estimated via an analytical description  of the qe. a magnified view of the initial period is shown in the inset to highlight the rapid convergence of the slow-scale propensity using the hybrid solver of the hymsmc method. the parameters are those of figure  <dig> 

using this network as an example, we also studied the efficiency of the msmc and the hymsmc methods as a function of population scales, at a constant time scale separation. studying the effect of population under overall equilibrium conditions ensures that the net speedup corresponds to a specific average population. the population scales were varied from o to o, and in each case we ran the simulation until a certain time and monitored the cpu time and the number of mc events required to complete the run. the parameters in  <dig> cases are presented in table  <dig>  the time scale separation is maintained at around  <dig> in all cases.

the rate constants have been proportionally scaled down with increasing population to maintain the reaction propensities approximately constant.

the cost of relaxing the faster network, gauged by the average number of relaxation events per slow event , increases with increasing population. as a result, the speedup of the msmc method over the ssa decreases with increasing population .

in contrast to the msmc method, the speedup achieved with the hymsmc method improves with increasing population. at low populations, the hymsmc speedup approaches that of the msmc technique, because the hybrid solver reduces to the ssa at these population levels that are below the critical population limit. at the other extreme, as the population increases, the number of slow events required to reach a certain time approaches  <dig> . as a result, the cpu time and the number of mc events required to reach this end time reduce to the requirements for one slow event. thus, in the limit of high population, the speedup of the hymsmc over the exact ssa tends to plateau off. by increasing the end time used for the speedup measurement, say from  <dig> s to  <dig> s, the leveling of the hymsmc speedup curve occurs at a higher population . in theory, the speedup of the hymsmc method has a power law dependence on the population scale.

using the same network, we also studied the effect of network stiffness on the speedup achieved at a constant population. the parameters used for this study are presented in table  <dig>  the network stiffness is approximated by the ratio of the rate constants, o, given that the populations of all species are in the same range . figure  <dig> shows that the acceleration achieved with both multiscale schemes has a power law dependence on stiffness. the speedup of the hymsmc method lies above that of the msmc method, highlighting the additional speedup achieved through temporal coarse- graining. as the network stiffness reduces to below  <dig>  the speedup of the msmc drops below unity, implying that the msmc method is more expensive than the ssa, and hence should not be used. this is caused by the cost of the msmc method associated with relaxing the fast network. however, even with this small time-scale separation in the system, the hymsmc still gives a speedup of around  <dig> over the ssa due to temporal coarse-graining.

k <dig> = k- <dig> =  <dig> s- <dig> and xa = xb = xc =  <dig> are used in all  <dig> cases.

finally, we demonstrate the use of csp to aid network partitioning. the deterministic dynamics of the coupled isomerization network  can be written as

 g1=dxadt=−k1xa+k−1xbg2=dxbdt=k1xa−xb+k−2xcg3=dxcdt=k2xb−k−2xc.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakqaabeqaagqaaiab=dgannaabaaaleaacqaixaqmaeqaaogaeyypa0zaasaaaeaacqwfkbazcqwfybawdawgaawcbagae8xqaeeabeaaaoqaaiab=rgakjab=rha0baacqgh9aqpcqghsislcqwfrbwadawgaawcbagaegymaedabeaakiab=hfaynaabaaaleaacqwfbbqqaeqaaogaey4kasiae83aas2aasbaasqaaiabgkhitiabigdaxaqabagccqwfybawdawgaawcbagae8nqaieabeaaaoqaaiab=dgannaabaaaleaacqaiyagmaeqaaogaeyypa0zaasaaaeaacqwfkbazcqwfybawdawgaawcbagae8nqaieabeaaaoqaaiab=rgakjab=rha0baacqgh9aqpcqwfrbwadawgaawcbagaegymaedabeaakiab=hfaynaabaaaleaacqwfbbqqaeqaaogaeyoei0iaeiikagiae83aas2aasbaasqaaiabgkhitiabigdaxaqabagccqghrawkcqwfrbwadawgaawcbagaegomaidabeaakiabcmcapiab=hfaynaabaaaleaacqwfcbgqaeqaaogaey4kasiae83aas2aasbaasqaaiabgkhitiabikdayaqabagccqwfybawdawgaawcbagae83qameabeaaaoqaaiab=dgannaabaaaleaacqaizawmaeqaaogaeyypa0zaasaaaeaacqwfkbazcqwfybawdawgaawcbagae83qameabeaaaoqaaiab=rgakjab=rha0baacqgh9aqpcqwfrbwadawgaawcbagaegomaidabeaakiab=hfaynaabaaaleaacqwfcbgqaeqaaogaeyoei0iae83aas2aasbaasqaaiabgkhitiabikdayaqabagccqwfybawdawgaawcbagae83qameabeaakiabc6cauaaaaa@7ee6@ 

since the system is linear in x, the jacobian is time-invariant, and thus its eigenvalues and eigenvectors do not evolve with time. the eigenvalues of the jacobian matrix are Λ <dig> ≈ - <dig>  Λ <dig> ≈ - <dig> , and Λ <dig> =  <dig>  the relaxation time of the fast network approximated from the largest in magnitude eigenvalue, , is consistent with the time estimated from the statistical convergence criterion over the course of a simulation . the corresponding eigenvectors are

 b1*=;b2*=;b3*=
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfibgydaqhaawcbagaegymaedabagamaimcqcaqaaakiabg2da9maabmaabaqbaeqabmqaaaqaaiabicdawiabc6cauiabieda3iabicdawiabieda3iabigdaxaqaaiabgkhitiabicdawiabc6cauiabieda3iabicdawiabieda3iabigdaxaqaaiabicdawaaaaiaawicacaglpaaacqgg7awocqwfibgydaqhaawcbagaegomaidabagamaipcqcaqaaakiabg2da9maabmaabaqbaeqabmqaaaqaaiabicdawiabc6cauiabisda0iabicdawiabiida4iabiodazaqaaiabicdawiabc6cauiabisda0iabicdawiabiida4iabikdayaqaaiabgkhitiabicdawiabc6cauiabiida4iabigdaxiabiada2iabiwda1aaaaiaawicacaglpaaacqgg7awocqwfibgydaqhaawcbagaeg4mamdabagamaiscqcaqaaakiabg2da9maabmaabaqbaeqabmqaaaqaaiabgkhitiabicdawiabc6cauiabiwda1iabieda3iabieda3iabisda0aqaaiabgkhitiabicdawiabc6cauiabiwda1iabieda3iabieda3iabisda0aqaaiabgkhitiabicdawiabc6cauiabiwda1iabieda3iabieda3iabisda0aaaaiaawicacaglpaaaaaa@7700@ 

and the inverse eigenvectors are

 b1=b2=b3=
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakqaabeqaagqaaiab=jgainaabaaaleaacqaixaqmaeqaaogaeyypa0zaamwaaeaafaqabeqadaaabagaegimaajaeiola4iaeg4nacjaegimaajaeg4nacjaegymaedabagaeyoei0iaegimaajaeiola4iaeg4nacjaegimaajaeg4nacjaegymaedabagaeg4mamjaeiola4iaegynaujaey41aqraegymaejaegimaazaawbaasqabeaacqghsislcqai1aqnaaaaaagccaglbbgaayzxaaaabagae8nyai2aasbaasqaaiabikdayaqabagccqgh9aqpdawadaqaauaabeqabmaaaeaacqaiwaamcqgguaglcqai0aancqaiwaamcqai4aaocqaizawmaeaacqaiwaamcqgguaglcqai0aancqaiwaamcqai4aaocqaizawmaeaacqghsislcqaiwaamcqgguaglcqai4aaocqaixaqmcqai2agncqai1aqnaaaacaglbbgaayzxaaaabagae8nyai2aasbaasqaaiabiodazaqabagccqgh9aqpdawadaqaauaabeqabmaaaeaacqghsislcqaiwaamcqgguaglcqai1aqncqai3awncqai3awncqai0aanaeaacqghsislcqaiwaamcqgguaglcqai1aqncqai3awncqai3awncqai0aanaeaacqghsislcqaiwaamcqgguaglcqai1aqncqai3awncqai3awncqai0aanaaaacaglbbgaayzxaaaaaaa@7821@ 

based on the magnitude of the eigenvalues, mode  <dig> is the fast mode. the participation indices of all the reactions in the fast mode are evaluated using , and are shown in figure  <dig>  at small times, when the qe approximation is not yet valid, only reaction  <dig> is identified as a fast reaction. then, as the population of xb builds up, the contribution of reaction  <dig> to the fast mode increases, and eventually reactions  <dig> and  <dig> contribute almost equally to the fast mode. thus, the partitioning of the networks with the csp analysis agrees with that based on the propensities.

b. a system with bistability in the fast network
bistability is a common feature of biological networks, and thus, it is important that the approximate stochastic algorithms capture the correct dynamics of a bistable system. one of the most studied examples of bistabilty is the schlögl model

 x1+2x⇄k−1k13xx2⇄k−2k2x.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaafaqacegabaaabaacbagae8hwag1aasbaasqaaiabigdaxaqabagccqghrawkcqaiyagmcqwfybawdagdnawcbagae83aas2aasbaawqaaiabigdaxaqabaaaleaacqwfrbwadawgaaadbagaeyoei0iaegymaedabeaaaogaaypkhiaawcziaiabiodaziab=hfaybqaaiab=hfaynaabaaaleaacqaiyagmaeqaaowaa4qdasqaaiab=tgarnaabaaameaacqaiyagmaeqaaawcbagae83aas2aasbaawqaaiabgkhitiabikdayaqabaaakiaawkzicaglqgcacqwfybawcqgguaglaaaaaa@4a2c@ 

the simplicity of this network makes it an ideal prototype to study the validity of the algorithm in the presence of bimodality. in the above network, we assume that species x <dig> and x <dig> are in excess and act as buffering species. consequently, the population of species x <dig> and x <dig> can be combined with the rate constants k <dig> and k <dig>  to give lumped rate constants k′1
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacuwfrbwagaqbamaabaaaleaacqaixaqmaeqaaaaa@2f38@ and k′2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacuwfrbwagaqbamaabaaaleaacqaiyagmaeqaaaaa@2f3a@, respectively. the network can be written as

 2x⇄k−1k′13x;k′1=x1k1=144−1;k1=6−1⇄k−2k′2x;k′2=x2k2=5000 molc/s;k2=1276 s− <dig> 
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaafaqabegadaaabagaegomaidcbagae8hwag1aa4qdasqaaiqb=tgarzaafawaasbaawqaaiabigdaxaqabaaaleaacqwfrbwadawgaaadbagaeyoei0iaegymaedabeaaaogaaypkhiaawcziaiabiodaziab=hfaybqaaiabcuda7aqaaiqb=tgarzaafawaasbaasqaaiabigdaxaqabagccqgh9aqpcqwfybawdawgaawcbagaegymaedabeaakiab=tgarnaabaaaleaacqaixaqmaeqaaogaeyypa0jaegymaejaeginaqjaeginaqjaeiikagiae8xba0mae83ba8mae8hbawmae83yammaeyoei0iae83camnaeiykakyaawbaasqabeaacqghsislcqaixaqmaagccqgg7awocqwfrbwadawgaawcbagaegymaedabeaakiabg2da9iabiada2maabmaabagae8xba0mae83ba8mae8hbawmae83yam2aawbaasqabeaacqaiyagmaagccqghsislcqwfzbwcaiaawicacaglpaaadaahaawcbeqaaiabgkhitiabigdaxaaaaoqaamaao0aaleaacuwfrbwagaqbamaabaaameaacqaiyagmaeqaaawcbagae83aas2aasbaawqaaiabgkhitiabikdayaqabaaakiaawkzicaglqgcacqwfybawaeaacqgg7awoaeaacuwfrbwagaqbamaabaaaleaacqaiyagmaeqaaogaeyypa0jae8hwag1aasbaasqaaiabikdayaqabagccqwfrbwadawgaawcbagaegomaidabeaakiabg2da9iabiwda1iabicdawiabicdawiabicdawiabbccagiab=1gatjab=9gavjab=xgasjab=ngajjabc+caviab=nhazjabcuda7iab=tgarnaabaaaleaacqaiyagmaeqaaogaeyypa0jaegymaejaegomaijaeg4nacjaegonayjaeeiiaaiae83cam3aawbaasqabeaacqghsislcqaixaqmaagccqgguaglaaaaaa@92ef@ 

at equilibrium, the network displays a noise-induced switching between the two stable steady states. a typical differential equation solver will relax the above network to either of its stable equilibrium states, depending on the initial state. the deterministic steady states can be obtained by solving the cubic steady-state equation for x

 dxdt=k′1x2−k−1x6+k′2−k−2x= <dig> 
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadawcaaqaagqaaiab=rgakjab=hfaybqaaiab=rgakjab=rha0baacqgh9aqpdawcaaqaaiqb=tgarzaafawaasbaasqaaiabigdaxaqabagccqwfybawcqggoaakcqwfybawcqghsislcqaixaqmcqggpaqkaeaacqaiyagmaagaeyoei0yaasaaaeaacqwfrbwadawgaawcbagaeyoei0iaegymaedabeaakiab=hfayjabcicaoiab=hfayjabgkhitiabigdaxiabcmcapiabcicaoiab=hfayjabgkhitiabikdayiabcmcapaqaaiabiada2aaacqghrawkcuwfrbwagaqbamaabaaaleaacqaiyagmaeqaaogaeyoei0iae83aas2aasbaasqaaiabgkhitiabikdayaqabagccqwfybawcqgh9aqpcqaiwaamcqgguaglaaa@588e@ 

the reaction rates in  are based on the discrete nature of the reacting species. solving  for x gives xeqm1
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfybawdaqhaawcbagae8xraukae8xcaenae8xba0gabagaegymaedaaaaa@32dc@ =  <dig>  xeqm2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfybawdaqhaawcbagae8xraukae8xcaenae8xba0gabagaegomaidaaaaa@32de@ =  <dig> and xeqm3
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfybawdaqhaawcbagae8xraukae8xcaenae8xba0gabagaeg4mamdaaaaa@32e0@ =  <dig> as the steady state solutions of  with xeqm1
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfybawdaqhaawcbagae8xraukae8xcaenae8xba0gabagaegymaedaaaaa@32dc@ and xeqm3
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfybawdaqhaawcbagae8xraukae8xcaenae8xba0gabagaeg4mamdaaaaa@32e0@ being stable and xeqm2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfybawdaqhaawcbagae8xraukae8xcaenae8xba0gabagaegomaidaaaaa@32de@ being unstable. the equilibrium solution of the above steady state rate equation, using a generic algebraic solver, such as the newton's method, depends on the initial guess.

the schlögl model does not display any separation of time scales. so to apply the hybrid multiscale scheme to this example, the schlögl model was coupled with a pair of slow reversible isomerization reactions

 2x⇄k−1k′13x;k′1=x1k1=144−1;k1=6−1⇄k−2k′2x;k′2=x2k2=5000 molc/s;k2=1276 s−1x⇄k−3k3y;k3= <dig>  s−1;k−3= <dig>  s− <dig> 
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaafaqabewadaaabagaegomaidcbagae8hwag1aa4qdasqaaiqb=tgarzaafawaasbaawqaaiabigdaxaqabaaaleaacqwfrbwadawgaaadbagaeyoei0iaegymaedabeaaaogaaypkhiaawcziaiabiodaziab=hfaybqaaiabcuda7aqaaiqb=tgarzaafawaasbaasqaaiabigdaxaqabagccqgh9aqpcqwfybawdawgaawcbagaegymaedabeaakiab=tgarnaabaaaleaacqaixaqmaeqaaogaeyypa0jaegymaejaeginaqjaeginaqjaeiikagiae8xba0mae83ba8mae8hbawmae83yammaeyoei0iae83camnaeiykakyaawbaasqabeaacqghsislcqaixaqmaagccqgg7awocqwfrbwadawgaawcbagaegymaedabeaakiabg2da9iabiada2maabmaabagae8xba0mae83ba8mae8hbawmae83yam2aawbaasqabeaacqaiyagmaagccqghsislcqwfzbwcaiaawicacaglpaaadaahaawcbeqaaiabgkhitiabigdaxaaaaoqaamaao0aaleaacuwfrbwagaqbamaabaaameaacqaiyagmaeqaaawcbagae83aas2aasbaawqaaiabgkhitiabikdayaqabaaakiaawkzicaglqgcacqwfybawaeaacqgg7awoaeaacuwfrbwagaqbamaabaaaleaacqaiyagmaeqaaogaeyypa0jae8hwag1aasbaasqaaiabikdayaqabagccqwfrbwadawgaawcbagaegomaidabeaakiabg2da9iabiwda1iabicdawiabicdawiabicdawiabbccagiab=1gatjab=9gavjab=xgasjab=ngajjabc+caviab=nhazjabcuda7iab=tgarnaabaaaleaacqaiyagmaeqaaogaeyypa0jaegymaejaegomaijaeg4nacjaegonayjaeeiiaaiae83cam3aawbaasqabeaacqghsislcqaixaqmaaaakeaacqwfybawdagdnawcbagae83aas2aasbaawqaaiabiodazaqabaaaleaacqwfrbwadawgaaadbagaeyoei0iaeg4mamdabeaaaogaaypkhiaawcziaiab=lfazbqaaiabcuda7aqaaiab=tgarnaabaaaleaacqaizawmaeqaaogaeyypa0jaegimaajaeiola4iaegimaajaegimaajaegimaajaegynaujaeeiiaaiae83cam3aawbaasqabeaacqghsislcqaixaqmaagccqgg7awocqwfrbwadawgaawcbagaeyoei0iaeg4mamdabeaakiabg2da9iabicdawiabc6cauiabicdawiabicdawiabicdawiabigdaxiabbccagiab=nhaznaacaaaleqabagaeyoei0iaegymaedaaaaakiabc6cauaaa@bbc3@ 

thus, in our example, the schlögl model constitutes the fast network, and the solution of eq.  is the deterministic qe solution of the fast network. the presence of bimodality in the fast network introduces interesting features in the transfer of information between the fast and the slow networks. figure 10a and figure 10b show the population trajectories for species x and y, using the hymsmc method and the ssa, respectively. visually, the hymsmc technique seems to capture the temporal behavior of the network, including the bistability of the species x. the ssa trajectory appears noisier than the hymsmc one because it records the numerous fast events that are neglected in the hymsmc plot. only the states observed at every coarse time step have been recorded in the hymsmc plot, compared to every  <dig> millionth point in the ssa trajectory. based on the cpu time required for a single run, the hymsmc and msmc speedups over the ssa are  <dig> and  <dig>  respectively. based on mc events, the speedups are ~ <dig> and  <dig>  respectively. as a result of the moderate size of populations in the network, the hymsmc method has a rather marginal  advantage over the msmc method.

to assess the accuracy of the hymsmc technique, we compared the pdfs at  <dig> s from  <dig> trajectories, with those of the ssa. as was mentioned earlier, by selecting the last state at convergence as the representative state at the macroscopic time step, we are implicitly selecting the fast state from the frequency pdf  present at that macroscopic time. for an accurate histogram of the fast species at any time, their states need to be sampled from the temporal pdf  at any state of the slow network. in most cases, sampling from the frequency pdf does not cause any noticeable errors in the histogram of the fast species. however, these sampling-induced discrepancies surface in circumstances involving low populations and/or multimodality. this network exemplifies such a situation. even though the statistics of the slow species y is correctly captured , there is a distinct mismatch with the ssa results for the fast species . it is possible to obtain the correct probabilistic information of the fast network at any time, provided the slow network has been evolved correctly. to demonstrate this, we performed additional sampling of the fast network to obtain the temporal pdf. we then compute the average of the temporal pdfs at  <dig> s using  <dig> trajectories to account for the joint probability of observing a slow state, xs, and the relaxed pdf, pdf , of the fast species at that slow state. using this simple procedure, the pdfs of both the species match with those obtained using the ssa . this corroborates the fact that qe information of the fast network is embedded in the evolution of the slow species, and can be extracted by sufficient time-average sampling when needed. usually, we do not have an a priori knowledge of the differences between the temporal and the frequency pdfs. therefore, we propose that only the temporal pdf should be used.

we further illustrate the role of the correlations of the fast network, in the evolution of the slow network. in the slow-scale ssa , cao et al.  <cit>  used the mean-field approximation of the relaxed fast network to evaluate the slow-scale propensity. in the present example, the fast network has  <dig> steady-state solutions that are independent of the slow network, due to the buffering species in the schlögl model. as a result, the deterministic equilibrium solutions, xeqm, of the fast network are the same at every slow step. assuming that the same initial guess is given to the solver at every macroscopic time step, the bistability of the fast species will not be identified by the ss-ssa. this error creeps into the slow species evolution too. this can be seen in figure 11b , where using xeqm =  <dig> or xeqm =  <dig> to evaluate the slow-scale propensities in the ss-ssa results in a wrong pdf of the slow species. this example emphasizes the need for accurate transfer of information  between scales, and the failure of the mean-field approximation of the slow-scale propensities for bistable systems.

the csp analysis is based on the analytical jacobian of the following set of odes

 g1=dxdt=k′1x2−k−1x6+k′2−k−2x−k3x+k−3yg2=dydt=k3x−k−3y.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakqaabeqaagqaaiab=dgannaabaaaleaacqaixaqmaeqaaogaeyypa0zaasaaaeaacqwfkbazcqwfybawaeaacqwfkbazcqwf0badaagaeyypa0zaasaaaeaacuwfrbwagaqbamaabaaaleaacqaixaqmaeqaaogae8hwaglaeiikagiae8hwaglaeyoei0iaegymaejaeiykakcabagaegomaidaaiabgkhitmaalaaabagae83aas2aasbaasqaaiabgkhitiabigdaxaqabagccqwfybawcqggoaakcqwfybawcqghsislcqaixaqmcqggpaqkcqggoaakcqwfybawcqghsislcqaiyagmcqggpaqkaeaacqai2agnaagaey4kasiaf83aasmbauaadawgaawcbagaegomaidabeaakiabgkhitiab=tgarnaabaaaleaacqghsislcqaiyagmaeqaaogae8hwaglaeyoei0iae83aas2aasbaasqaaiabiodazaqabagccqwfybawiiaacqgfrawkcqwfrbwadawgaawcbagaeyoei0iaeg4mamdabeaakiab=lfazbqaaiab=dgannaabaaaleaacqaiyagmaeqaaogaeyypa0zaasaaaeaacqwfkbazcqwfzbqwaeaacqwfkbazcqwf0badaagaeyypa0jae83aas2aasbaasqaaiabiodazaqabagccqwfybawcqghsislcqwfrbwadawgaawcbagaeyoei0iaeg4mamdabeaakiab=lfazjabc6cauaaaaa@7779@ 

the two eigenvalues are well separated, indicative of a significant scale separation in the network. specifically, |Λ22| is ~10- <dig> and |Λ11| fluctuates between negative and positive values  but is of the order of 102- <dig>  the temporal profile of the participation indices in the fast mode is presented in figure  <dig>  the combined participation of reactions  <dig> and  <dig> is negligible at all times. the individual contribution of reactions  <dig> to  <dig> fluctuates a lot, but their combined participation to the fast mode equals ~ <dig>  see inset in figure  <dig>  implying that the fast mode is comprised of the first four reactions. thus, the partitioning of the two methods  is consistent.

assessment of convergence in this bistable system is more complicated. the relaxation time estimated via csp provides the time needed to sample a branch. for bistable systems, aside from two relaxation times, there is also a time scale related to the  time the system stays in a branch. in order to adequately sample both branches, one needs to simulate the system for times longer than all three time scales. the mean residence time of the fast network was estimated to be ~ <dig>  s on the higher branch  and ~ <dig>  s on the lower branch . the relaxation time of the fast network based on magnitude of the eigenvalues lies in the range o-o. thus, in this case, due to the comparable magnitude of residence times and relaxation times, the relaxation time based on the largest in magnitude eigenvalue gives a reasonable estimate of the sampling time of the fast network. in our simulation, we simulated the fast network for an additional  <dig>  s, which was decided as a multiple of the sum of the residence times on each of the bifurcation branches.

c. gene expression model: bistability in the slow network
having established the benefits of the algorithms with simple networks, we focus on real biological networks. the positive feedback-regulated gene expression model proposed in the work of kepler and elston  <cit>  mathematically proved that fluctuations between operator states are a potential source of stochasticity in the level of translated protein, even at high mean populations. the gene expression model used by kepler and elston is an excellent biological example of "multiscales plaguing stochastic simulation". unlike the previous example where the bistability was present in the fast network, in this gene expression model, the bistability is rooted in the slow network, and propagates to the fast network.

in the gene expression model shown below, the dimerized form, d, of the gene product, m, activates the gene in a positive feedback manner, by binding its operator site.

 2m⇄k−1k1dk1=100−1; k−1=106s−1θ0+d⇄k−2k2θ1k2= <dig> −1; k−2= <dig> s−1θ0→k3θ0+mk3=50s−1θ1→k4θ1+mk4=1000s−1m→k5k5=1s− <dig> 
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaafaqadeqbcaaaaeaacqaiyagmieaacqwfnbqtdagdnawcbagae83aas2aasbaawqaaiabigdaxaqabaaaleaacqwfrbwadawgaaadbagaeyoei0iaegymaedabeaaaogaaypkhiaawcziaiab=reaebqaaiab=tgarnaabaaaleaacqaixaqmaeqaaogaeyypa0jaegymaejaegimaajaegimaajaeiikagiae8xba0mae83ba8mae8hbawmae83yammaeyoei0iae83camnaeiykakyaawbaasqabeaacqghsislcqaixaqmaagccqgg7awocqqggaaicqwfrbwadawgaawcbagaeyoei0iaegymaedabeaakiabg2da9iabigdaxiabicdawmaacaaaleqabagaegonaydaaogae83cam3aawbaasqabeaacqghsislcqaixaqmaaaakeaaiigacqgf4oqcdawgaawcbagaegimaadabeaakiabgucariab=reaenaao0aaleaacqwfrbwadawgaaadbagaegomaidabeaaasqaaiab=tgarnaabaaameaacqghsislcqaiyagmaeqaaagccaglsgiaayjkhagae4hude3aasbaasqaaiabigdaxaqabaaakeaacqwfrbwadawgaawcbagaegomaidabeaakiabg2da9iabicdawiabc6cauiabigdaxiabiwda1iabcicaoiab=1gatjab=9gavjab=xgasjab=ngajjabgkhitiab=nhazjabcmcapmaacaaaleqabagaeyoei0iaegymaedaaogaei4oasjaeeiiaaiae83aas2aasbaasqaaiabgkhitiabikdayaqabagccqgh9aqpcqaixaqmcqgguaglcqai1aqncqwfzbwcdaahaawcbeqaaiabgkhitiabigdaxaaaaoqaaiab+h7axnaabaaaleaacqaiwaamaeqaaowaa4ajasqaaiab=tgarnaabaaameaacqaizawmaeqaaawcbegccaglsgcacqgf4oqcdawgaawcbagaegimaadabeaakiabgucariab=1eanbqaaiab=tgarnaabaaaleaacqaizawmaeqaaogaeyypa0jaegynaujaegimaajae83cam3aawbaasqabeaacqghsislcqaixaqmaaaakeaacqgf4oqcdawgaawcbagaegymaedabeaakmaaoqcaleaacqwfrbwadawgaaadbagaeginaqdabeaaasqabogaaypkhagae4hude3aasbaasqaaiabigdaxaqabagccqghrawkcqwfnbqtaeaacqwfrbwadawgaawcbagaeginaqdabeaakiabg2da9iabigdaxiabicdawiabicdawiabicdawiab=nhaznaacaaaleqabagaeyoei0iaegymaedaaagcbagae8xta00aa4ajasqaaiab=tgarnaabaaameaacqai1aqnaeqaaawcbegccaglsgcaaeaacqwfrbwadawgaawcbagaegynaudabeaakiabg2da9iabigdaxiab=nhaznaacaaaleqabagaeyoei0iaegymaedaaogaeiola4caaaaa@c05c@ 

the separation of scales comes about because the dimerization reaction and its reverse reaction proceed at a much faster rate than the remaining reactions in the network. hence, in the simulations performed using the exact ssa, most of the simulation time is spent firing the first set of reversible reactions. in simulating  <dig> seconds of real time, the hymsmc algorithm accelerates the simulation by a factor of  <dig>  based on cpu times, and by a factor of  <dig>  based on the number of mc events. the trajectories for the gene product, m, and its dimer, d, are in good visual agreement with those generated using the ssa, as shown in figure  <dig> and figure  <dig> 

pdfs generated at t =  <dig> s using the hymsmc method are in excellent agreement with those of the exact ssa . the low population of the dimer exemplifies a situation where the temporal pdf of the fast network is different from the frequency pdf. as a result, the pdf of the dimer species, generated using the hymsmc method is in disagreement with the ssa pdf at low population states. however, sampling  the fast network at  <dig> s to collect the temporal pdf, followed by the ensemble average eliminates this discrepancy .

as an additional test of accuracy of the hymsmc method, we compared the distributions of the life-time of the states of the gene  obtained from a single equilibrium run of the hymsmc method and the ssa. figure  <dig> shows that the hymsmc method correctly captures the pdf of life time of both states.

finally, the csp-analysis shows that there is one predominant eigenvalue  at all times, implying the presence of one fast mode. the microsolver relaxes the fast network in ~10- <dig> time units based on the statistical criterion, which is greater than the eigenvalue-based relaxation time of  <dig> × l0- <dig>  implying that our statistical relaxation criterion is more conservative and dominates convergence in this example. the contribution of the reactions to the fast mode is shown in figure  <dig>  the fast mode almost completely consists of reactions  <dig> and  <dig> . however, the contribution of reaction  <dig> drops to zero when the d =  <dig> state is encountered. in such a situation, the csp-identified fast network will consist of only reaction  <dig>  even the rank based partitioning faces similar problems in such a situation. one way to tackle the problem is to base the partitioning of the network on average propensity values evaluated from a few  mc events. these averaged propensities could effectively be used to perform the csp analysis.

d. heat shock response  model
as a final example, we apply the algorithm to the heat shock response model in e. coli. on sensing high temperature, the cell triggers off a network of biochemical reactions at the genetic and cytoplasmic level to prevent or reduce protein denaturation caused by elevated temperatures. the physiological behavior resulting from these reactions is termed the heat shock response . takahashi et al.  <cit>  and e et al.  <cit>  used a modified version of the hsr model as an example of a biological network with multiple time scales. the biochemical reactions constituting the hsr model are presented in table  <dig>  a large separation of time scales is present in this network, with the first  <dig> reactions shown in table  <dig> being around six orders of magnitude faster than the rest. we applied the hymsmc scheme to the hsr network.

the units of stochastic rate constants are s- <dig> for 1st-order reactions and - <dig> for 2nd-order reactions. dna and mrna correspond to dna sequence and mrna transcripts, respectively, for species x. dna  molecules do not get consumed in the transcription  reactions, but simply provide a template for mrna  formation.

the transient behavior of the network is captured accurately using the hymsmc, as can be seen in figure  <dig> and figure  <dig> which compares trajectories of two species with those of the ssa. species σ <dig> and dnaj were chosen from the fast and slow network, respectively, to demonstrate the accuracy of the algorithm at all scales. using the hymsmc method requires  <dig> s  to reach t =  <dig>  compared to  <dig> s  required by ssa, thus accelerating the simulation by a factor of  <dig> . as a test of accuracy, the normalized histograms of states at t =  <dig> s from  <dig> trajectories were generated. the results are in good agreement, as shown in figure  <dig>  the algorithm accurately captures the noise of species σ <dig> despite the low population involved .

the csp analysis identifies one fast mode in the hsr network, whose eigenvalue is  <dig> orders of magnitude larger than the next fastest mode. the relaxation time estimated from the eigenvalues  is in good agreement with the one based on the statistical convergence criterion . the temporal profile of the participation indices, shown in figure  <dig>  identifies the first  <dig> reactions in the network as the fast reactions that contribute the most to the fastest mode. the combined participation index of reactions  <dig> to  <dig> is negligible compared to the participation index of reactions  <dig> to  <dig>  thus, reactions 4– <dig> are the slow reactions. figure  <dig> also shows that for the time considered, the network partitioning is maintained. thus, even for a moderately large network, the csp method offers a systematic method to partition the network. for the hsr model, the csp analysis increased the cpu cost of the hymsmc method by less than 4%. thus, for the largest network simulated in this paper, the cpu overhead of the csp-assisted partitioning method is negligible.

CONCLUSIONS
in this paper, we have presented a hybrid, multiscale monte carlo  algorithm that can simultaneously handle disparity of timescales and species population in well-mixed stochastic networks. the hymsmc method uses a hybrid ssa-i-leap method  <cit>  as the microscopic and the macroscopic solvers, and employs stochastic singular perturbation concepts when time scale separation exists. as a result, it is able to systematically exploit large populations in the fast and/or slow networks to accelerate stochastic simulations without losing accuracy. importantly, the absence of a priori assumptions about the scales in the network makes the hymsmc method applicable over a wide range of the population and time-scale separation. consequently, the hymsmc method can switch between the exact ssa  <cit> , the τ-leap  <cit> , or the msmc  <cit>  method in a dynamic manner, depending on the instantaneous timescales and populations in the network.

the superiority of the hymsmc method over the original msmc method  <cit>  and the ssa  <cit>  was demonstrated using various examples, including two networks displaying bistability. the core of most multiscale algorithms is the closures between scales, which strongly influence accuracy. using the schlögl model and a simple gene expression model, we showed that the closures used in the hymsmc method accurately capture the bimodality in the fast and the slow networks.

a second contribution of this paper is the stochastic partitioning and convergence that have not extensively been discussed in previous work. we introduced the computational singular perturbation  technique  <cit>  as a diagnostic tool to systematically identify the fast and the slow networks. in all examples, csp was able to correctly partition the network and provide estimates of relaxation time for converging the fast network. this latter use of eigenvalues in conjunction with statistical tests is strongly recommended in order to eliminate numerical artifacts of the latter. the computational overhead associated with the evaluation of the jacobian matrix and the eigenvalue analysis has been small for the examples studied here.

authors' contributions
as developed the algorithm, set up and performed the simulations and drafted the manuscript. dgv and bao conceived the study, and participated in its design and coordination and helped refine the manuscript. all authors read and approved the final manuscript.

appendix a: evaluation of pdfs and slow scale propensities
calculation of pdfs
once a network has been partitioned, one needs to relax the fast sub-network  until the stochastic low-dimensional manifold has been reached, then compute the qe pdf of the fast network, and subsequently use it to evolve the slow network. in our original msmc method  <cit> , this was accomplished using the ssa but this can also be done with the τ-leap method. we compute the time-averaged pdf of the fast states

 p∞≈Δtfτeqm,
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfqbaudawgaawcbagaeyohiukabeaakmaabmaabaacbegae4heag3aawbaasqabeaacqgfmbgzaagccqgg8bafcqgf4baeaiaawicacaglpaaacqghijyudawcaaqaaiabgs5aejab=rha0naacaaaleqabagae8nzaygaaagcbaaccigae0hxdq3aasbaasqaaiab=veafjab=fhaxjab=1gatbqabaaaaogaeiilawcaaa@43d5@ 

where Δtf is the total life time of the state xf in an equilibrium simulation of the fast network for time τeqm=∑xf′Δtf′
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfepaddawgaawcbaacbagae4xraukae4xcaenae4xba0gabeaakiabg2da9maaqafabagaeyildqkae4hdaq3aawbaasqabeaacugfmbgzgaqbaaaaaeaacqgf4baedaahaaadbeqaaiqb+zgamzaafaaaaawcbeqdcqghris5aaaa@3d0c@, given that the slow system is at state xs. we obtain Δtf by monitoring the life-time of states accessed once at equilibrium.

in the literature, it is common to generate a pdf based on the frequency of observing a state

 p∞≈mcefmceeqm.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfqbaudawgaawcbagaeyohiukabeaakmaabmaabaacbegae4heag3aawbaasqabeaacqgfmbgzaagccqgg8bafcqgf4baeaiaawicacaglpaaacqghijyudawcaaqaaiab=1eanjab=neadjab=veafnaacaaaleqabagae8nzaygaaagcbagae8xta0kae83qamkae8xrau0aasbaasqaaiab=veafjab=fhaxjab=1gatbqabaaaaogaeiola4caaa@45ad@ 

here, mcef is the number of times a state xf is observed in an equilibrium simulation of mceeqm mc events of the fast network. we refer to the pdfs based on the life-time of states ) and frequency of states ) as the temporal and frequency pdf, respectively. in most cases, the frequency and temporal pdfs are practically the same. however, differences arise when the qe pdfs are multimodal and/or when low populations are encountered, as was shown in ref.  <cit> . numerical examples of this paper further indicate that the frequency pdf method can result in erroneous results in such cases, so we strongly recommend the use of the temporal pdf.

calculation of slow-scale propensities
the propensity function of the slow reaction rjs
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiewacqwfsbgudaqhaawcbagae8naaogabagae83camhaaaaa@30d2@, given by ajs
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfhbqydaqhaawcbagae8naaogabagae83camhaaaaa@30ed@, is a function of the states of the slow and the fast species. thus, the distribution of xf results in a distribution of ajs
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfhbqydaqhaawcbagae8naaogabagae83camhaaaaa@30ed@ for all j ∈ rjs
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiewacqwfsbgudaqhaawcbagae8naaogabagae83camhaaaaa@30d2@. the transition probabilities used to evolve the slow network should be projected onto the qe pdf of the fast network. in ref.  <cit> , we underscored that the most rigorous way of evolving the slow processes should be based on a joint pdf that accounts for the life time of various fast states along with the rate at which these states are being changed by slow processes.

evaluating the first moment of the propensity, ajs
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfhbqydaqhaawcbagae8naaogabagae83camhaaaaa@30ed@, over the temporal qe pdf, p∞, is a simpler way to assimilate the stochastic qe description into the dynamics of the slow network  <cit> . the ss-ssa  <cit>  uses an analytical expression of qe-pdf to evaluate eq. , which restricts the applicability of the algorithm to simple networks. alternatively, it uses a deterministic, steady-state solution of the fast network to evaluate the slow-scale propensities. as correctly pointed out by cao et al.  <cit> , this mean-field approach neglects the correlation in the stochastic qe and is accurate at large populations only. in a numerical example, we show that the mean-field approach also fails when the fast network has multiple steady states. other stochastic multiscale methods  <cit> , which employ the slow-scale approximation, obtain the slow-scale propensities via a numerical approximation, and are, therefore, more general than the ss-ssa, at the expense, of course, of increased computational cost.

here, we follow ref.  <cit>  and numerically compute the average propensities instead of the entire pdf. however, we ensure that the state we pick to fire from can indeed be fired, i.e., no negative populations arise . this approach effectively accounts for the joint pdf approach of ref.  <cit> . more specifically, the slow-scale propensity of each slow reaction can be evaluated as

 ajs¯=∑xf′Δtf′⋅ajsτeqm, for j= <dig> ,...,ms
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaqdaaqaagqaaiab=fgahnaadaaaleaacqwfqbgaaeaacqwfzbwcaaaaagqabogae4hkagiae4heagnae4xkakiaeyypa0zaasaaaeaadaaeqbqaaiabgs5aejab=rha0naacaaaleqabagaf8nzaymbauaaaagccqghfly1cqwfhbqydaqhaawcbagae8naaogabagae83camhaaowaaewaaeaacqgf4baedaahaawcbeqaaiqb+zgamzaafaaaaogaeiilawiae4heag3aawbaasqabeaacqgfzbwcaaaakiaawicacaglpaaaasqaaiab=hha4naacaaameqabagaf8nzaymbauaaaaaaleqaniabgghildaakeaaiigacqqfepaddawgaawcbagae8xraukae8xcaenae8xba0gabeaaaagccqggsaalcqqggaaicqwfmbgzcqwfvbwbcqwfybgccqqggaaicqwfqbgacqgh9aqpcqaixaqmcqggsaalcqaiyagmcqggsaalcqgguaglcqgguaglcqgguaglcqggsaalcqwftbqbdaahaawcbeqaaiab=nhazbaaaaa@66db@ 

eq.  can be rewritten as follows

 ajs¯=∑p=1mceeqmf|pτeqm, for j= <dig> ,...,ms
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaqdaaqaagqaaiab=fgahnaadaaaleaacqwfqbgaaeaacqwfzbwcaaaaagqabogae4hkagiae4heagnae4xkakcccagae0xpa0zaasaaaeaadaaewbqaamaaeiaabawaaewaaeaaiigacqafepaddaahaawcbeqaaiab=zgambaakiabgwsixlab=fgahnaadaaaleaacqwfqbgaaeaacqwfzbwcaaaakiaawicacaglpaaaaiaawia7amaabaaaleaacqwfwbacaeqaaaqaaiab=bhawjabg2da9iabigdaxaqaaiab=1eanjab=neadjab=veafnaadaaameaacqwffbqrcqwfxbqccqwftbqbaeaacqwfmbgzaaaaniabgghildaakeaacqafepaddawgaawcbagae8xraukae8xcaenae8xba0gabeaaaagccqggsaalcqqggaaicqwfmbgzcqwfvbwbcqwfybgccqqggaaicqwfqbgacqgh9aqpcqaixaqmcqggsaalcqaiyagmcqggsaalcqgguaglcqgguaglcqgguaglcqggsaalcqwftbqbdaahaawcbeqaaiab=nhazbaaaaa@6ad4@ 

where mceeqmf
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaieaacqwfnbqtcqwfdbwqcqwffbqrdaqhaawcbagae8xraukae8xcaenae8xba0gabagae8nzaygaaaaa@3541@ is the number of mc events executed by the microscopic solver to simulate time  τeqm=∑p=1mceeqmfτpf
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfepaddawgaawcbaacbagae4xraukae4xcaenae4xba0gabeaakiabg2da9maaqahabagae8hxdq3aa0baasqaaiab+bhawbqaaiab+zgambaaaeaacqgfwbaccqgh9aqpcqaixaqmaeaacqgfnbqtcqgfdbwqcqgffbqrdaqhaaadbagae4xraukae4xcaenae4xba0gabagae4nzaygaaaqdcqghris5aaaa@4647@ of the quasi- equilibrated fast network. τf|p
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaabcaqaaggaciab=r8a0naacaaaleqabaacbagae4nzaygaaagccagliwoadawgaawcbagae4hcaahabeaaaaa@332e@ is the time increment in the pth mc event, and ajs|p
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaabcaqaagqaaiab=fgahnaadaaaleaacqwfqbgaaeaacqwfzbwcaaaakiaawia7amaabaaaleaacqwfwbacaeqaaaaa@341e@ is the propensity of the jth slow reaction before the occurrence of the pth mc event.

