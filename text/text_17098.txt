BACKGROUND
a beadarray is an array of randomly positioned, three micron diameter, silica beads. a specific oligonucleotide sequence is assigned to each bead type, which is replicated about  <dig> times on an array. a series of decoding hybridisations is used to identify every bead  <cit> . beadarrays can be used in a wide range of genomic applications including snp genotyping, methylation profiling, and copy number variation analysis. in this paper we concentrate on data from single-channel gene expression beadarrays  <cit> . after hybridisation and washing, each array is scanned by illumina's scanning software  to produce an image in the tagged image file format , along with files in a proprietary file format containing intensity and location information. the latest version of beadscan can also output a text file giving the identity and position of each bead on the array. the collection of tiff images and text files is referred to as the bead level data for an experiment and are presented in the same format, regardless of the assay used.

analysis of beadarray data is routinely carried out using the beadstudio application developed by illumina. this software takes the proprietary files and produces bead summary data, comprising a mean and standard error on the original unlogged scale, for each bead type on each array. when the raw data are analysed using beadstudio, there is no control over image processing or the method used to combine the replicate observations for a given bead type into a single, summarised, value. also, the user loses the ability to perform a detailed quality assessment of the data.

information about how to obtain bead level data has only recently been released and these data cannot be generated retrospectively. therefore, no publications have taken the processing of bead level data into account apart from our own preliminary investigations  <cit> . in comparison to affymetrix, which is an established technology, there is a lack of in-depth literature on the low-level analysis of illumina data. publications involving illumina expression data tend to use illumina's recommendations for normalisation, with the exception of  <cit>  who found this method to have a negative impact on data quality and who used quantile normalisation instead. also, there is no publicly available dataset for which the bead level data may be obtained and for which there is some expectation about the results. such datasets are available for affymetrix and have allowed researchers to understand more about the technology and to develop new analysis methods  <cit> .

this paper presents our guidelines regarding the pre-processing of illumina data and explores some common issues raised during the analysis of other microarray platforms. after discussing the bead level properties and quality assessment of a spike-in experiment, we investigate the effects of the image processing and summarisation methods used by illumina on a typical de analysis.

image processing is an important consideration for microarrays and involves calculating foreground intensities using the pixels that make up each feature on the array, and estimating a local background intensity using the pixels surrounding each feature. a background correction calculation is then used to correct for non-specific or random contributions to the overall signal. within beadscan, the local background measures are subtracted from the bead foreground values to produce the intensities in the bead level text files. this method is the same for all illumina technologies. previous studies have shown that background subtraction introduces missing values, increases variability and has a negative impact on the detection of differentially expressed genes  <cit> . therefore, it is crucial to investigate the automatic background adjustment used within beadscan.

in addition to local background subtraction, illumina also recommends a secondary calibration procedure for expression data, known as background normalisation, which is performed on summarised data. for a given array, this method involves subtracting the mean intensity of the negative controls  from each bead summary value. this is intended to compensate for differences between arrays in both non-specific binding of dye and cross-hybridisation. after background normalisation, an additional normalisation using rank invariant genes or cubic splines can be carried out between arrays. we demonstrate the effect of applying this normalisation to the spike-in experiment.

for affymetrix data, it has been shown that the base composition of the 25-mer probes can have an effect on the observed intensity, and methods have been proposed to deal with this effect  <cit> . other probe effects have also been described for two-colour microarrays with longer probes  <cit> , but have not been reported for illumina data, which typically uses 50-mer probes. additionally, the reliability of affymetrix probe sets has been called into question, with a large percentage of probes on an array sometimes not mapping to the intended transcript. naturally, this can lead to misleading conclusions in a de study  <cit> . we investigate if such effects are apparent in illumina gene expression data.

data
the illumina spike-in experiment investigated in this paper consists of eight customised mouse- <dig> version  <dig> beadchips hybridised with a complex mouse background. in addition to the ~ <dig>  bead types included as standard, the bead pool for these chips was modified to include  <dig> bead types chosen to target  <dig> different bacterial and viral genes absent from the mouse genome  <cit> . these  <dig> bead types are referred to as spikes in this paper and the remaining bead types on the array are referred to as non-spikes. each array also includes a number of standard illumina controls, including  <dig> negative controls. each beadchip comprises six arrays and each array is made up of two strips on the chip surface. the first strip interrogates targets from the curated meebo database, and the second strip mostly contains targets from the refseq and riken databases.

the spikes were added at concentrations of  <dig>   <dig>   <dig>   <dig>   <dig> and  <dig> pm on the six arrays from the first four beadchips. a further four chips were hybridised with spikes at concentrations of  <dig>   <dig> ,  <dig> ,  <dig> ,  <dig>  and  <dig> pm. the spikes on a given array were all added at the same concentration. each concentration was allocated to the same position on all replicate beadchips. for example,  <dig> pm was always array  <dig> on a chip and  <dig> pm was array  <dig> and so on. the spike-in experiment was designed and scanned by illumina. raw data from the experiment, which includes the tiff image and text file for each strip, are available as supplementary materials  <cit> . annotation information , additional figures and r scripts are also available online  <cit> .

RESULTS
bead level issues
access to the bead level data allowed us to identify a significant spatial artefact on one beadchip in the experiment. an error in the scanning of the chip resulted in the x coordinates of many beads on the left-hand side taking negative values. consequently, the illumina algorithm for image processing was unable to calculate foreground and background intensities for these beads and set their foreground intensities to zero. this problem affected between  <dig> % and  <dig> % of the total number of beads from each strip on this chip, with the percentage of affected beads decreasing from the top to the bottom of the chip. these beads were subsequently removed as outliers by illumina's summary algorithm. no other significant spatial effects were found on the remaining chips and arrays. we note that after background correcting the bead level data, the median percentage of beads with negative intensities on a strip was  <dig> % with a 75th percentile of  <dig> %.

before proceeding with an analysis of summarised data, we investigated how robust illumina's technology is to the spatial effects observed above. arrays with varying numbers of saturated beads were simulated as described in methods. these data sets aimed at assessing how many outliers could be tolerated by illumina'a default summary method compared to other methods . figure  <dig> shows the average bias and variance versus the percentage of outliers introduced. illumina's summary method performs best overall, with the lowest bias  and variance . after around 20% of the bead intensities become saturated, the bias and variance start to increase. using a trimmed mean which excludes 10% of the smallest and largest intensities, we see an increase in bias and variance after more than 5% of the beads are saturated. this is not surprising as the outliers are not simulated to be symmetric around the mean, which this method is suited to handle. the median offers similar robustness to illumina's method. similar results were obtained if the analysis was performed on the log-scale, or if the data were censored at  <dig> rather than at  <dig> .

after applying the illumina summary method, the median number of beads per bead type on an array was  <dig> with 25th and 75th percentiles of  <dig> and  <dig> respectively. the median number of beads per bead type per array removed as outliers was  <dig> with a 95th percentile of  <dig> 

the effects of pre-processing on de analysis
in figure  <dig> we show the bead type means and variances calculated on the log <dig> scale, for the  <dig> spikes across all arrays in the experiment using three background correction methods . these boxplots of non-normalised data are arranged according to the concentration of the spikes on the array. different background correction methods are shown in different colours and data from each array are plotted in a separate boxplot. given the design of the experiment, we would expect to see a decrease in observed intensity as the concentration of the spikes decreases.

note that even though the data shown are not normalised, we can see that the replicates of the same array processed using the same method show low variability and only slight differences in the medians. the same trend can be seen for all background correction methods. a saturation effect can to be seen between  <dig> pm and  <dig> pm, as the increase in the concentration of the spikes is not reflected in a change in observed intensity. at  <dig> pm, there is a clear difference between arrays with no background adjustment and arrays where a local background estimate has been subtracted. the linear relationship between spike concentration and observed intensity persists below  <dig> pm for the background subtracted data, whereas without background adjustment, an attenuation in signal is evident below  <dig> pm.

the variances of each method are similar in the range  <dig> pm to  <dig> pm. however, at  <dig> pm we see a steep decrease in the variability for the non-adjusted data, whilst the background subtracted data shows a slight increase. the rate of decrease in variability for the no background adjustment option is greater than the rate of increase in variability for the subtracted data. for concentrations of  <dig>  pm and below, the variance of the spikes does not decrease any further with decreasing concentration.

we now quantify how well the expected change in spike concentration is recovered by different background correction methods. in figure  <dig> we show an ma-plot  of the log <dig> transformed data from an array with spikes at  <dig> pm and an array with spikes at  <dig> pm. the data shown in figure 4a were not background adjusted and we can see that the range of m-values is very low for all genes. the largest m-value we see is around  <dig>  and the a-values are in the range  <dig> to  <dig>  the observed log-ratios for the spikes are much lower than the expected value of  <dig> . figure 4b shows the same data after background subtraction. we see a wider range of m and a values compared to figure 4a, and the log-ratios for the spikes are closer to the expected value on average. notice that although these data have not been normalised, the non-spikes lie around m =  <dig>  indicating no differential expression.

in figure 4c we show the same comparison for data which have been background subtracted and background normalised. this is equivalent to processing the raw data using beadstudio's recommended settings. for visualisation purposes, and to compare with the other methods, we log <dig> transformed the background normalised data. the difference that this makes to the ma-plot is striking. we see a much increased range of m-values as a decreases. there are clearly a large number of genes which would be selected as differentially expressed if a simple cut-off approach were used, even though few genes are expected to change for this comparison. in addition, the log-ratios of the spikes are systematically over-estimated by this method. there are also a large number of bead types with negative intensities on each array after applying background normalisation, ranging from  <dig> % to  <dig> % . these become missing values after a log <dig> transformation, which is undesirable in downstream analyses.

analyses of replicated arrays use statistical methods to determine genes that show de for a particular contrast of interest. in this paper, we chose the linear model approach of  <cit> . figure 5a shows the log-odds scores for the contrast between  <dig> pm and  <dig> pm and for data processed using different background correction methods. separate boxplots are shown for the spikes and non-spikes  and results are shown both with and without weights in the model . outliers for the non-spikes are indicated by crosses. background subtraction is seen to increase the log-odds of being differentially expressed for the spikes. moreover, a greater distinction between the log-odds of the spikes and non-spikes is seen after background subtraction.

five non-spikes are seen to have high log-odds both before and after weights were used. these bead types were ranked amongst the spikes for all contrasts and had a similar expression profile to the spikes. further investigation revealed these probes are controls from the meebo database and not used in current illumina chips. generally, the spikes were the top ranked probes for each contrast with very few false discoveries. the choice of background correction method was found to have little impact on the number of false discoveries .

when weights are used in the linear model for a particular correction method, we see an increase in the log-odds scores calculated for the spikes. at the same time, we do not see a substantial change for the non-spikes. the most dramatic increase in log-odds by using weights is seen for the non-adjusted data. it is interesting to note that the log-odds of the different methods are more comparable when weights are used. we produced the same plot for all contrasts in the linear model . the log-odds typically increased for all contrasts in the middle of the concentration range when weights were used. however, for contrasts comparing  <dig>  pm to lower concentrations, we found little improvement, or sometimes a decrease in log-odds. figure 5b shows the estimated coefficients for the comparison between  <dig> pm and  <dig> pm. for this contrast, we would expect the spikes to have a log-ratio of log <dig> or  <dig> . for data processed without background adjustment, the highest log-ratio seen for the spikes is not much greater than  <dig>  for the subtract and normexp methods, the log-ratios are centered around the expected value. for other contrasts , the log-ratios were often underestimated by all methods, especially at high and low concentrations. pairwise contrasts  <dig> pm to  <dig> pm,  <dig> pm to  <dig> pm and  <dig> pm to  <dig> pm accurately recovered the predicted log fold-changes. the non-adjusted data consistently produced the most biased values for all contrasts.

probe properties and annotation considerations
we now repeat a similar analysis to figure  <dig>  but consider the behaviour of each spike separately. in figure  <dig>  we show the coefficients for each spike estimated by fitting the linear model described in methods to the background subtracted data. for clarity, each spike was labelled and coloured according to its target gene. a smoothed curve was fitted to the coefficients for each spike. note that bead types with the same target name  have the same probe sequence attached, but are located on different strips. we can clearly see different intensities for spikes at the same concentration. these differences are consistent across the concentration series. for example, ela_ <dig> always shows the lowest intensity at all concentrations, whereas gus_ <dig> and lux_ <dig> tend to have the highest intensity. the difference between the spikes is quite dramatic for some concentrations. for instance, at  <dig> pm the highest intensity spikes measured are  <dig>  whereas the lowest intensities are at  <dig>  it is also apparent that the spikes respond differently to the decrease in concentration. the ela_ <dig> spikes show a larger decrease between  <dig> pm and  <dig> pm than the other spikes and the curve for these spikes flattens out at a higher concentration. conversely, the spikes for gus_ <dig> are flatter for concentrations  <dig> pm to  <dig> pm, but attenuate at lower concentrations than the other spikes. some small differences can be seen for bead types having the same probes sequence, but hybridised to different strips.

after re-annotation of the available probe sequences, bead types were categorised according to where they map in the genome. some probe sequences were found to match to intronic and intergenic regions. the percentages of bead types on the second strip with intronic and intergenic matches were  <dig> % and  <dig> %, respectively, compared to  <dig> % and  <dig> % on the first strip. there were  <dig>  and  <dig>  unique genes represented on the first and second strips respectively, in addition to the  <dig>  genes interrogated on both strips. as expected, re-annotation of the spikes and negative controls produced no matches in the genome.

an important subset of the non-spikes are the negative controls, which in addition to not changing between arrays, should have a low intensity on every array. in figure  <dig>  for  <dig> negative controls picked at random, we plot the  averaged values for each control over all arrays. as expected, each control shows intensities at the lower end of the values observed on an array . however, we do see some variation in median intensity between the different probes, with a greater than two-fold difference in intensity measured between the bead type on the far left and far right of the plot.

in figure  <dig> we see the normalised intensity of all non-spikes on strip  <dig> of a particular array grouped according to how many a, c, t or g bases are found in the sequence attached to each bead type. generally, we see that an increase in the number of as or ts in the sequence is associated with a decrease in mean intensity, whereas an increase in the number of cs or gs results in an increase in mean intensity. moreover, as the gc content increases, the variance of the bead types decreases. we also see that probes with either a g or c as the first base have a higher normalised intensity and lower variance relative to having a t at that position. the distribution of gc content for the spikes was skewed towards higher gc content and showed little variation. therefore, we did not have sufficient information to conclude a gc-related effect for these probes alone . similarly, we could find no evidence for an effect of the gc content on the intensity of the negative controls.

ideally, we would like such probe effects to be removed when comparisons are made between arrays. in figure  <dig> we show the ranking of the log-odds scores of the contrast shown in figure  <dig> for all non-spikes on strip  <dig>  clearly there is a preference for bead types with  <dig> to  <dig> gcs in the sequence to be higher in the list. on average, sequences with  <dig> gcs are  <dig>  places higher in the list than sequences with  <dig> gcs.

the "hump" seen in figure  <dig> was evident for most contrasts in the linear model. we have observed similar trends in experiments which use human version  <dig> beadchips .

for the affymetrix spike-in experiments, the thermodynamic properties were shown to explain some of the variation between observed intensities for different probes spiked in at a nominally consistent level  <cit> . in this illumina experiment, similar strong correlations are seen at high concentrations . the correlation of the negative control intensities to Δh, Δs and Δg  have inter-quartile ranges of  <dig>  to  <dig> ,  <dig>  to  <dig>  and  <dig>  to  <dig>  respectively. the intensities of the negative controls are highly correlated from array to array, although the agreement between arrays is quite poor. thus, for the most robust analysis we compare the thermodynamic properties to the average within-array rank of the negative controls. the correlations are  <dig>  for Δs,  <dig>  for Δh and  <dig>  for Δg. whilst these values are small in magnitude, they are significantly non-zero.

discussion
data quality
the data produced using illumina technology are widely reported to be of high quality. naturally, we would still recommend careful quality assessment of illumina arrays and not to take high data quality for granted. whilst initial quality assessment using the raw data showed little variation between arrays, we were able to detect a consistent spatial effect on a particular beadchip. however, we found that in this case, there was no impact on further analysis due to the random placement of beads and robust summary method used by illumina. although beadstudio is capable of giving a good overview of an experiment, it will miss important artefacts on arrays, as spatial information is lost when the data are summarised. we found that the two strips for each array show consistently different intensities with the first strip showing a wider range of expression values. we have noticed this effect for other mouse expression data and also for human- <dig> version  <dig> chips . the second strip contains a large number of bead types with sequences that target rare transcripts, or match to intronic or intergenic regions, which could partly explain the lower signal on this strip. the default options within the beadstudio software combine the two strips for every array on a whole genome beadchip. in the version  <dig> whole genome beadchips, the replicates of each bead type are spread between the two strips with potentially  <dig> replicates on each strip. clearly, the summary value could be affected by any differences in underlying intensity between the strips, in which case analysing strips separately would be appropriate.

local background estimation and subtraction
it is interesting to note the consistency of the estimated background for individual beads, which is observed within and between arrays. the background estimation used by illumina takes an average of the five dimmest pixels within a comparatively large area surrounding each bead. this gives a very low estimate for background that is related to the optical properties of the array surface rather than being specific to the sequence attached to each bead. in contrast, background estimation for two-colour arrays typically uses the mean or median value of pixels surrounding each feature, producing higher, more variable estimates. the approach illumina uses is more akin to a morphological background estimation, which has been shown to perform well for two-colour arrays  <cit> .

in other data sets, we have used the predictability of the background signal as a simple diagnostic to identify poor quality arrays on which the background level was considerably higher and more variable than usual . when analysing this experiment, we found that subtracting this low estimate of the background was beneficial for detecting differentially expressed genes. at low spike concentrations , the observed values for the spikes are close to the negative controls. therefore, when comparing arrays with low spike concentrations that have not been background subtracted, the calculated log-ratios will be biased towards zero as the difference in spike concentration is obscured by the background noise. background subtraction reduces this bias, although, as anticipated, we see an increase in variability after a log <dig> transformation of the subtracted data. the results of the simplest method of subtracting the background estimates are comparable to those of the model-based approach of normexp. this is due to the low percentage  of negative intensities produced using the subtract method, hence methods that avoid these negative values have little scope for improvement. this is encouraging for users without access to raw data who perform pre-processing using illumina's default settings.

summarisation
illumina's default summary method was able to handle around 20% of outlier beads before the estimates became noticably biased in our simulations. this provides a rough guideline on how much of an array can be corrupted before the analyst needs to worry about biases creeping into the estimates and inflating the variances. in addition, illumina's method is better at accommodating asymmetric outliers than regular trimmed means. this is desirable, as these artefacts arise frequently in data sets we have analysed.

normalisation
in this study we did not conduct a thorough investigation into normalisation methods. given the low variability of replicate observations, it is important that the data are not "over-normalised", thus removing potentially interesting biological information. an important conclusion from the spike-in experiment is that the background normalisation recommended by illumina is not appropriate for some de analyses. this method is seen to introduce substantial variability into the data, particularly at low intensities, and also to increase the numbers of false positives. another consequence of this normalisation is that low expression values become negative and cannot be log <dig> transformed. in the spike-in experiment, we found that around 40% of the data were missing on average per array. illumina keep the bead summary data on the unlogged scale and their model for differential expression takes the relationship between the mean and variance of each bead type into account  <cit> . de analyses performed outside of beadstudio, such as limma ebayes  <cit> , sam  <cit> , or other methods, usually require data that have been subjected to a log <dig>  or similar, transformation to ensure the gene-wise variances are comparable. therefore we recommend that only non-normalised data are exported from beadstudio if they are to be analysed using established statistical methods. otherwise, a small offset could be added to the intensities to ensure positivity of the background normalised data.

de analysis
we find that using the bead type variances as inverse weights increases the evidence for de for the spikes for each background correction method in most contrasts. at the same time, the log-odds scores for the non-spikes are not affected; this represents a gain in statistical power. the weights also produce more comparable log-odds between processing methods. less precise observations arising from arrays with quality issues, or intensity-dependent trends in variablity introduced by the chosen pre-processing option, are down-weighted in the analysis. at very low concentrations , this improvement was reversed, with de statistics decreasing for the spikes. although this would seem undesirable, it indicates that after considering the underlying variability of the observations, it is difficult to distinguish between very small changes in concentration, which is a limitation of any microarray technology. having access to the bead level data allows bead type variances to be calculated on the appropriate scale so that they may be used in the linear model.

annotation
probe annotation should be given careful consideration during the analysis. the second strip should assist in the investigation of rare transcripts, but it also contains many probes that will not produce any meaningful signal in many gene expression studies. one way of exporting data from beadstudio is to average the probes for the same gene. we would discourage combining the signal from two probes, as there may be differences in the reliability of the probes, particularly if one maps to an intron or intergenic region. we found the intensities of probes on an array to be related to base composition. in particular, probes with a higher gc content were seen to have a higher intensity, as were probes with a g or c at the first base. these effects were observed on normalised data from strip  <dig> and persisted in the between-array comparisons. inflated differential expression statistics were found for probes with  <dig> to  <dig> gcs in their sequence.

a possible probe effect is also suggested by the intensity differences in both spikes and negative controls. given these observations and previous work for affymetrix arrays, it would seem that more sophisticated methods than background normalisation are needed to account for sequence-specific hybridisation effects. the correlation of observed intensities with the melting temperature or free energy is seen to decline with the spike concentration, presumably as the signal-to-noise ratio diminishes. similar correlations were seen in affymetrix spike-in experiments. while it is clear that some of the behaviour of the negative controls can be explained by their thermodynamic properties,  <dig> – 3% of the variation is explained at best. since the intensities of the negative controls are reproducible across strips and arrays, it seems implausible that the remainder could consist of random noise. thus, we conclude that other sources of variation are to be identified.

application to other illumina technologies
in this paper, we describe the advantages of analysing a gene expression experiment using bead level data. we also anticipate that the analysis of other illumina assays  can benefit from using bead level data. for instance, recent genotyping methods for affymetrix technology successfully use the full raw data and therefore having access to the bead level data is likely to be useful in developing similar methods for illumina. if log-ratios are required for genotyping, the situation is similar to expression data where the values output by beadstudio are not on the desired scale. with the raw data, it is possible to obtain log ratios for every bead and then calculate an average and variance for each bead type.

CONCLUSIONS
the main findings presented in this paper are:

• access to bead level data promotes more detailed quality assessment and more flexible analyses. bead level data can be summarised on a relevant scale. we were able to use the means and variances of the log <dig> data in the de analysis to improve our ability to detect known changes in the spikes.

• the background correction and summarisation methods used in beadstudio reduce bias and produce robust gene expression measurements. however, we find that background normalisation introduces a significant number of negative values and much increased variability.

• base composition of probes has an effect on intensity and further investigation is required to remove this effect.

