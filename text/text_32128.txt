BACKGROUND
although most of the human genome is identical among individuals, there are about  <dig> million single nucleotide polymorphisms  which distinguish us  <cit> . snps are single base-pair loci where the nucleotides can assume two possible values  among the four bases . in general, since we have two copies of each chromosome, the genotype at any snp can be: aa, bb or ab, where a and b represent the two alleles. moreover, a snp can be classified as homozygous  or heterozygous , whether or not its genotype consists of two equal alleles. cancer and several human diseases are caused by genomic aberrations, which can affect the homozygous status and/or the dna copy number . the former type of aberrations is often displayed by unusual long stretches of homozygous snps, called loss of heterozygosity  region. the latter type of aberrations consists in genomic regions with dna copy number different from two.

in general, loh can arise by several mechanisms, such as deletions and germ-line or somatic recombinations. when the loh occurs without a change in copy number, it is referred to as copy-neutral loh . in the past, copy-neutral loh regions were usually explained as a consequence of an uniparental disomy event , see  <cit> . recently, long homozygous segments have also been detected in genomes of normal individuals, supporting the hypothesis that some copy-neutral loh segments might represent autozygosity . in the literature, it has been shown a relationship between some tumors and both types of aberrant events .

uniparental disomy  occurs when both homologues of a part of a chromosome are inherited from only one parent. it can be divided in: uniparental isodisomy  and the uniparental heterodisomy . because of meiotic recombination, a mixture of both events is also possible, and similar events can also happen during the mitosis. moreover, in cancer cells, the uniparental isodisomy can also occur when a homologue of a part of a chromosome is lost and the remaining homologue is duplicated. the autozygosity describes a situation where the homologues are identical by descendent , because they are inherited from a common ancestor. inbreeding is usually uncommon because of laws and social conventions, but it does occur in small isolated populations.

snp microarrays are able to measure simultaneously both the dna copy number and the genotype at each snp position considered  <cit> . we call loh data the homozygous status of the snps deduced from the genotyping data. by integrating the information given by both loh and copy number data, we can better identify several types of lesions of the genome . for example, when one copy of a chromosomal segment is deleted, we usually detect a long stretch of homozygous snps , but the same homozygous status can also occur for other reasons, such as uniparental disomy. in this situation, the knowledge of both types of data can lead to the correct interpretation of the phenomenon, while with only one type of data it would not be possible. another example is when an amplified genomic segment is present: if one of the two copies of the segment is highly amplified, then even the heterozygous snps will be likely detected as homozygous, because the dna quantity of one allele is much higher than the other one. in this case again, the integration of both types of data is able to better identify the dosage of the dna aberration.

many methods have been developed for the estimation of the copy number profile  and others for the discovery of loh regions from the genotyping data, without distinguishing if they are caused by either the loss of one copy or other genomic events like uniparental disomy or autozygosity . to the best of our knowledge, only one method integrates these two types of data for the estimation of both copy number aberrations and copy-neutral loh regions and it uses a hidden markov model   <cit> . other statistical procedures use the information regarding both the total and the allelic copy number to infer these kind of lesions  and some of these algorithms are available only for the analysis of data coming from illumina beadarrays. finally, in  <cit>  the authors describe an hmm with the same purpose, which employs the allelic copy number data from a tumor sample and the genotyping data from the matched normal sample.

here, we propose a method which estimates the copy number changes and the copy-neutral loh regions at the same time, using both loh and dna copy number data. the estimation procedure consists of a bayesian piecewise constant regression, thus we call our algorithm genomic bayesian piecewise constant regression . our model is more general than  <cit> , since the latter cannot be applied to data, whose dna sample come from a mixture of cell populations . moreover, the algorithm in  <cit>  needs the specification of some parameters by the user and is sensitive to their values.

our method was implemented in r and is freely available at http://www.idsia.ch/~paola/gbpcr/ or in additional file  <dig>  furthermore, an r package will be soon available.

methods
because of the complexity of the biological model, we first describe a preliminary simplified model , which only estimates the copy number events exploiting the relationship between copy number and loh data. therefore, it does not identify copy-neutral loh regions , which are due to events like uniparental disomy, and it does not distinguish the normal regions from the gained one . in the subsequent subsections, we add to the model the detection of copy-neutral loh regions  and of gained ones . therefore, the explanation is structured in the following way:

• model 1: relationship between loh and copy number data to detect copy number changes ;

• model 2: addition to model  <dig> of the ibd/upd region detection ;

• model 3: addition to model  <dig> of the gained region detection.

each of the three models is contained in the subsequent. the final model  represents our algorithm for the estimation of both copy number changes and copy-neutral loh regions and we call it genomic bayesian piecewise constant regression .

model 1: relationship between loh and copy number data
although in nature the copy number is an integer, the raw copy number values detected by the microarray are usually continuous values, due to technical procedures. moreover, the samples often contain also a percentage of normal cells.

it is common practice to treat copy number data in a log2ratio scale  which makes the errors approximately normally distributed. then, the copy number profile is estimated as a piecewise constant function , where the levels assume real values. for the purpose of our model, we estimate this profile by mbpcr, which is a bayesian piecewise constant regression procedure  <cit> . it has been shown in  <cit>  that this method outperformed well-known other methods on several datasets.

commonly, in biomedical/cancer research, after estimating the log2ratio profile, the copy number aberrations are defined as those regions with values outside an interval around zero . often, the interval is a statistical confidence interval computed on the basis of the samples of the whole dataset.

in model  <dig>  our aim is to classify better the copy number changes, trying to reduce the number of false positives, by exploiting the relationship between copy number and loh data.

mathematical model of the biology mechanism
the aim of model  <dig> is to obtain a better estimation of the true underlying copy number events, using both the information given by copy number and loh data. in a genomic region, a copy number event is defined as a particular class of copy number values. the definition of the categories into which the copy number values are divided will follow from the description of the loh data.

for the purpose of better identifying the copy number events, we can consider two classes of snp values: heterozygosity  and homozygosity . thus, the loh data are deduced from the genotyping data, by mapping the genotypes aa and bb into hom and the genotype ab into het, for all snps. the genotype calling algorithm  is unable to distinguish between a homozygosity due to the presence of two equal nucleotides or the one due to the loss or high amplification of one of them. hence, the presence of heterozygosity can ensure that the copy number is normal or gained with a high probability, while the homozygosity can be due to different events. it follows that there are only four relevant classes of copy number events that can be distinguished by looking at the loh data. therefore, if we call  the random variable which represents a copy number event at snp i, it can assume only the following values:

•  =  <dig>  when cn >  <dig> ;

•  =  <dig>  when  <dig> < cn ≤  <dig> ;

•  = - <dig>  when cn =  <dig> ;

•  = - <dig>  when cn =  <dig> .

the homozygous deletion corresponds to the loss of both copies of a genomic region. ideally, the genotype calling algorithm should detect a nocall genotype at the corresponding snp position . although not common, since cancer dna samples usually contain a mixture of normal and tumor cells , the information given by the nocall genotype can be used to better distinguish between a mono-allelic deletion and a bi-allelic  deletion.

therefore, three different loh variables are present in the model: the true homozygous status in normal cells , the homozygous status in abnormal cells , which is the consequence of copy number changes , and the homozygous status detected by the genotype calling algorithm . the components of the first two random vectors can assume only values in  = {het, hom} and * = {∅, het, hom}, respectively, and we suppose that they are independently distributed as bernoulli random variable. the components of y can assume values in  = {nocall, het, nhet} .

a summary of the model can be found in figure  <dig> and a summary of the notations is in table  <dig>  ideally, at each snp i, the homozygous status in abnormal cells xi is completely determined, given the corresponding value in normal cells  and the occurred copy number event , by the following relations:  

nevertheless, the homozygous status of abnormal cells estimated by the genotype calling algorithm  is affected by several sources of errors.

hypothesis of the model
the genome of cancer cells can be divided in subregions where the copy number is constant. since we divided the copy number values in four classes , we can also consider regions with the same copy number event.

let us consider a genomic region where the microarray measures the dna copy number and the genotype at n snp loci. then, from the previous discussion, the vector of the copy number events at all positions  can be seen as a piecewise constant function. this function consists of k <dig> intervals with the same copy number event and with boundaries  so that , for all p =  <dig>  ..., k <dig>  to estimate this function we use a bayesian piecewise constant regression method, which determines the number of segments k <dig>  the boundaries () and the copy number events .

for any sample, we assume to have the homozygous status detected by the genotype calling algorithm  and the profile of the log2ratio of the copy number estimated by mbpcr. the estimated log2ratio profile consists of  intervals with boundaries  and levels of the segments  . this estimated profile is used only to define the prior distribution of the random vector z , while the loh data y are used to infer z . notice that we do not suppose to know xn, i.e. the homozygous status in normal cells. moreover, we assume that, given the true value of the homozygous status in normal cells xn and the copy number event z at each position, the loh data points  are independent, since their values depend only on both noise and genotype detection errors.

the model implies that, given k <dig> and t <dig>  the posterior distribution of  is  

and thus, if we condition only with respect to the loh data y, the posterior becomes  

where  and  are the domains of k and t, respectively .

to specify the model , we need to define the likelihood, i.e. the conditional distribution of y, given  and xn. to model it, we take into account all the variability that can affect the genotype detection, such as: the polymerase chain reaction  amplification, the presence of different cancer cell subpopulations or normal cells, and the amplification of only one copy. for example, the probabilities  and  are not zero, because of the error in the genotype detection even in case of a normal dna sample. the probabilities  and  are related to the detection errors due to the presence of normal cells and/or different types of cancer cell subpopulations, or to pcr amplification errors, while  is related to the errors that can be due to the amplification of only one allele. also  and  account for the errors that can be due to the presence of cell subpopulations.

the set of conditional probabilities  are considered as parameters of the model. to quantify them, we needed paired normal-cancer samples, since they are related to the probability of detecting a certain homozygous status in a cancer cell, given the corresponding one in a normal cell of the same patient and under some copy number event. therefore, to compute maximum likelihood estimates of these parameters, we used  <dig> samples from an available cancer dataset consisting of breast cancer cell lines  <cit>  .

to complete the bayesian model, we need to define the prior distributions of the other random variables. for the parameters k and t, we consider distributions similar to the ones used in mbpcr  <cit> :  

where  = { <dig>  ..., kmax} and  is a subspace of  such that t <dig> =  <dig>  tk = n and tq ∈ { <dig>  ..., n - 1} for all q =  <dig>  ..., k -  <dig>  in an ordered way and without repetitions.

the prior probabilities of heterozygosity of the snps  are the frequencies of heterozygosity computed on the samples of the matched race in the hapmap project  <cit> . they are usually provided by the manufacturer in the documentation related to the microarray used. in section "results and discussion", the microarray mostly employed is the genechip human mapping 250k nspi .

z prior definition
the only prior that we have not yet defined is the one of z. while the estimated levels of the log2ratio profile are continuous variables, z classifies the copy number as discrete events. then, the major problem consists in mapping the continuous values into the discrete values of z, i.e. in defining a partition of the log2ratio values such that each interval corresponds to a particular copy number event.

in the literature, most methods determine a confidence interval around zero  and then consider all the log2ratio values above this interval as gains and all values below as losses . this method is not suitable in our case, since we want to classify also the events {cn = 0} and {cn > 4}. looking at the histogram of the estimated log2ratio values , we can see that they have a multimodal density with peaks corresponding to cn =  <dig>  cn =  <dig> and cn = { <dig>  4}. sometimes, we can even separate the peaks of cn =  <dig> and cn =  <dig>  similarly to  <cit> , we model this density as a mixture of normal distributions . once the parameters of the density are estimated, we can define a function to map the log2ratio values into the copy number event values:   

where  are, respectively, the estimated mean and variance of the normal distribution corresponding to cn = cn.

from the definition of flogtoz, for all p =  <dig>  ..., , we define the prior distribution of zp as:  

where cn represents all copy number information  and mp is the random variable representing the log2ratio value in the pth segment. from the mbpcr model, given cn, mp is normally distributed with mean  and variance  where  are the posterior mean and variance of mp estimated by mbpcr, respectively.

the estimation
to estimate the piecewise constant profile of the copy number events, we define the estimators of k <dig>  and t <dig>  similarly to the ones in the mbpcr method  <cit> :      

namely,  corresponds to the  positions which have the highest posterior probability to be a breakpoint. the main differences with respect to mbpcr are in the prior over k and in the estimation of k. instead of using a uniform prior and an estimator which minimizes the posterior expected squared error, here we consider a prior similar to 1/k <dig> and an estimator which minimizes the 0- <dig> error, in order to reduce the false discovery rate  in case of few segments.

another difference with respect to mbpcr consists in the level estimation. while in the copy number model the levels were continuous random variables, now they assume categorical values. hence, they are estimated separately  with the map estimator instead of the posterior expected value,   

for p =  <dig>  ..., , where  and  are any estimate of t <dig> and k <dig>  respectively. for the computation of all the posterior probabilities involved, we used dynamic programming as described in section s. <dig> in additional file  <dig> 

let us define yij = , representing the loh data points in the interval , and kij as the random variable which represents the number of segments in the interval . using bayes' theorem and the independence of the loh data points belonging to different segments, the probability in equation , given the loh data y, can be written as,   

therefore, if the boundary estimator misses a clear boundary between  and , then the probability at the denominator of equation  could be zero and thus the level would not be estimated. the best way to prevent this event consists in using a good estimator for the boundaries.

previously, in  <cit>  we found that the boundary estimator  is an estimator with a high sensitivity, but medium fdr. the problem of this estimator is the following. the vector p of the posterior probabilities to be a breakpoint at each point of the sample usually represents a multimodal function with maxima at the breakpoint positions, but often in a neighborhood of each maximum there are other points with high probability because of the uncertainty . hence, if we take the first  points with the highest probability , we could take points in the neighborhood of the higher maxima and not some maxima with a lower probability . as a consequence, if k <dig> was estimated with its exact value then the sensitivity of the  would be lower. in this case, we could lose important breakpoints so that the denominator in equation  would become zero. in practice,  often slightly overestimates k <dig>  because of the high noise of the data, and thus this phenomenon should not happen, but to prevent even this rare case we searched for a way to improve the estimation of the boundaries.

since commonly the vector of the posterior probabilities shows clearly the position of the breakpoints in correspondence to the maxima, we estimate the number of the segments and the breakpoints with the number of peaks and the locations of their maxima, respectively . essentially, the algorithm for the determination of the peaks, after applying a kernel method to reduce the noise of the function, uses two thresholds: one for the determination of the peaks  and one for the definition of the values close to zero . therefore, we will denote the corresponding estimators by  and .

in section "results and discussion", we will consider several pairs of thresholds and we will apply the corresponding estimators to simulated data, in order to determine the best paired thresholds and to compare their performance with . we will also compare  with , another boundary estimator described in  <cit> .

model 2: addition of the ibd/upd region detection
loh data are used in biology not only to better identify regions of loss and amplifications, but, especially, to detect regions of copy-neutral loh, which can be identified by unusual long stretches of homozygous snps, with normal copy number. in section "background", we explained that this type of aberrations can be a consequence of upd  or autozygosity . from the description of these genomic events, it follows that the uniparental isodisomy and the ibd regions can be detected because they appear as a long sequence of homozygous snps with a low probability to occur, while the uniparental heterodisomy consists in a sequence of both homozygous and heterozygous snps as in a normal condition. therefore, without the genotypes of the parents, from snp data we can only detect the uniparental isodisomy  and the ibd segments. in the following, we will consider only these two events, referring to them as ibd/upd events.

since an ibd/upd event, by definition, only exists in regions of normal copy number , the only probabilities which are affected by the presence of this event are those involving {z = 0}. therefore, we define the following sets of conditional probabilities  and , where the variable  indicates if an ibd/upd event occurred at snp i . we can notice that, given { =  <dig>   = 0}, the distribution of yi is equal to the conditional distribution with respect to { = 0} in model  <dig>  since the latter was modeled with no possibility of an ibd/upd event. instead, in case of an ibd/upd event, we do not need to condition with respect to , since, in case of a somatic iupd event, the genotype of an iupd region is independent of the homozygous status of the same region in a normal cell. otherwise, in case of autozygosity or germ line iupd, the genotypes of normal and abnormal cells are the same and it makes no sense to condition one to the other.

in the new framework, we define the vector of the aberration events at n snp loci as ; here the aberrations regard both copy number changes and ibd/upd regions. each component  of the vector assumes values: - <dig> , - <dig> , - <dig>   <dig> ,  <dig> ; a graphical representation of the model is given in figure  <dig>  as previously, we can divide the genome in intervals corresponding to the same aberration event, i.e the profile of the aberrations consists of k <dig> intervals, with boundaries , so that , for all p =  <dig>  ..., k <dig>  the estimation procedure is similar to the one of model  <dig>  the estimators of k <dig> and t <dig> are the same and, given  and  , we estimate the aberration events in each interval with their map estimators,   

for p =  <dig>  ..., . notice that, for w = - <dig>  - <dig>   <dig>  the posterior probability p is equal to p, while for w = - <dig>   <dig> we have,      

and we assume that p =: pupd, for all p =  <dig>  ..., .

both  and pupd are parameters of the model. for the maximum likelihood estimation of , we used  <dig> ibd/upd regions previously found by us on  <dig> samples of patients with hairy cell leukemia  <cit>  and on the b-cell lymphoma cell line karpas- <dig>  all regions were detected by dchip  <cit>  and their width was between  <dig> mb and  <dig> mb , so that they were large enough to be really considered ibd/upd regions .

values for the parameter pupd
we expect the prior probability of an ibd/upd event to be low. in order to estimate the order of magnitude of this parameter, we considered two studies on ibd regions:  <cit>  and  <cit> . in the former, they considered as ibd regions only stretches of at least  <dig> homozygous snps  longer than  <dig> mb and the platform used was the affymetrix genechip human mapping 50k array. in the latter, a denser microarray was used and the stretches considered were longer than  <dig> mb  or longer than  <dig> mb. using the data of the former paper , we estimated pupd ≈  <dig> ·10- <dig>  instead, with the data of the latter, we estimated pupd ≈  <dig> ·10- <dig> considering all regions greater than  <dig> mb, while pupd ≈  <dig> ·10- <dig>  considering only the regions greater than  <dig> mb. the differences in the estimated values are due to the different resolution of the technologies used . moreover, the probability depends on the minimum length allowed for these regions. the wider the regions are, the higher is the probability that the regions represent "abnormalities" and the lower becomes the probability of their occurrence . therefore, in the following applications , we will use two values: pupd = 10- <dig> and pupd = 10- <dig> 

another possible way to solve the problem could be to assign a prior distribution to pupd  and integrate it out in the equations of the model.

model 3: addition of the gained region detection
in the description of model  <dig>  we explained our assumption that there is no difference in the genotype detection between a normal or gained region. therefore, in model  <dig> , we defined a single class for the normal or gained regions. but, for the biological studies, it is relevant to distinguish these two copy number events and this distinction is based essentially on the estimated copy number . as a consequence, the probability of yi given a normal  or gained copy number  is the same,  

we also need to define two distinct prior probabilities for the normal copy number and the gain event. similarly to its previous definition, for all , the new prior of zp  is given by,  

in the following, model  <dig>  will be called genomic bayesian piecewise constant regression .

adjustment of the parameters related to nocall
the probabilities {p, x ∈ , w = - <dig>  - <dig>  - <dig>   <dig>  2} are related to the detection of nocalls under some conditions. generally, the presence of nocalls is not only due to diffculties of the genotype calling algorithm in the detection of the genotype  but also to the noise of the sample because of differences in the quality of extracted dna. therefore, we need to adjust the estimated values of these parameters on the basis of the sample noise.

since usually the nocall rate  increases with the noise of the sample, we assume that, given { = x,  = z}, the probability of detecting a nocall at snp i in sample s is proportional to a parameter px,z  by a factor θs ,   

if we condition over the values of  and estimate p = 1/ <dig> for a generic snp i , we can compute the nocall rate in regions with copy number event z in the following way,      

therefore, by applying equations  and , for any pair of samples , we can write the conditional probability of nocall, given { = x,  = z}, in sample  <dig> in terms of the corresponding probability in sample  <dig>    

in the following, we will denote the sample to estimate with s =  <dig> and the reference sample with s =  <dig> 

using equation , the values of the parameters related to nocall detection are adjusted for sample  <dig>   

for z = - <dig>  - <dig>   <dig>   <dig>  where r <dig> and r <dig> are an estimate of the nocall rate in regions with copy number event z, for sample  <dig> and  <dig>  respectively. by applying equation  with p = 1/ <dig>  r <dig> can be computed from the estimated values of p and p  

for z = - <dig>  - <dig>   <dig>   <dig>  r <dig> is the frequency of nocall in regions with copy number event z of sample  <dig>  for z = - <dig>  - <dig>   <dig>   <dig> 

the estimated value of the probability p is adjusted in a different way. on the reference samples, we found, as expected, that  

that is, the nocall rate in ibd/upd regions is approximately equal to the nocall rate in normal regions. therefore,  

in section "results and discussion", we will compare the estimations resulting from gbpcr with and without the adjustment of these parameters.

RESULTS
in this section, we apply gbpcr to both artificial and real data. first, we compare the boundary estimators  on data simulated by using model  <dig>  then, we evaluate the detection of ibd/upd regions on the artificial dataset of  <cit> , in comparison with three well-known methods for loh estimation. using the same data, we also show the difference in the estimation when adjusting the parameters. finally, we show the performance of gbpcr, when applied to real data.

with the current implementation, on a computer with dual cpu  and  <dig> gb ram, the algorithm needed almost two days to estimate the profile of an affymetrix genechip mapping 250k nspi sample . nevertheless, the computations can be performed by chromosome , reducing the computational cost. in any case, an optimized version of the code will be soon available.

comparison of the breakpoint estimators on simulated data
in section "methods", we have described several possible boundary estimators: ,  and . the last one actually defines a class of estimators which depend on the values of the thresholds thr <dig> and thr <dig>  we tried several pairs of the following types of thresholds:

• "005" := max

• "01" := max

• " <dig> 90" := max

• "mad" := median +  <dig> * mad

where mad is the median absolute deviation and p is the vector of posterior probabilities to be a breakpoint. all these thresholds derive from different definitions of which probability values are to be considered significant.

we assessed the quality of all the estimators of k <dig> and t <dig> considered, by applying them on two artificial datasets , each of  <dig> samples. we used as prior probabilities of heterozygosity the frequencies of heterozygosity  given by the annotation file of the affymetrix genechip mapping 250k nspi microarray. just for illustrative purpose and because of limited computational time, we considered only the snps of a single chromosome , hence the number of data points in each sample is n =  <dig>  since our complete model  does not provide a realistic way to simulate ibd/upd regions and the identification of gained regions depends mainly on copy number data, the samples were generated using model  <dig> 

simulation description
since the model  <dig> assumes to know the estimated copy number profile given by mbpcr, for both datasets, we fixed the estimated segment number  =  <dig>  the estimated boundaries  =   and the prior distribution of z . the profiles of the samples in dataset a should be estimated easily, since in each segment the prior distribution of z is quite peaked.

given the previous parameters  and the estimated values of the other parameters of the model, we used the following steps to generate each loh sample:

 <dig>  we generated a true profile of the homozygous status in normal cells xn, by using the prior probabilities of heterozygosity, described previously;

 <dig>  we generated a true copy number event profile , by using the prior distribution of z ;

 <dig>  given the true copy number event profile and the profile of the homozygous status in normal cells, we generated y , by using the conditional probability distributions of model  <dig> 

results of the comparisons
to evaluate the performance of the estimators, we computed several error measures regarding the estimation of the number of segments , the boundary estimation  and the profile estimation . the explanation of these error measures can be found in section s. <dig> in additional file  <dig> 

by applying the pairs of estimators ,, and () to dataset a, the latter two appeared the best performing methods with respect to the error measures considered .

the table shows some error measures regarding the copy number event estimation obtained with several methods on datasets a and b. while  outperforms the other methods on dataset a, on b it obtains a poor estimation of the copy number events in comparison with the other methods. on dataset b, the methods which achieve the lowest errors are: (), (), () and ().

based upon these results, we decided to not apply the estimators  on dataset b and to try other paired thresholds for , in order to reduce the fdr of the boundary estimation. by looking globally at the results of all error measures , we can suggest the use of the following pairs of estimators: (), () or (). moreover, from the study of the behavior of () and (), we can understand the role of the two thresholds in our algorithm for the determination of the maxima in a multimodal function . the threshold thr <dig> is used to decide which points belong to the same peak: all the points, between two regions of points below thr <dig>  are considered in the same peak. hence, with a low threshold, more points are considered belonging to the same peak and thus we can eliminate lot of false breakpoints ). but, at the same time, if two true peaks are close, then it is possible that they are considered as only one peak, losing a true breakpoint . instead, the threshold thr <dig> is used to choose which estimated breakpoints are significant for the regression, i.e. if their posterior probabilities are to be considered different from zero. therefore, using a lower value of thr <dig>  we select a higher number of breakpoints obtaining a higher percentage of both false ones  and true ones ).

a detailed description of the results obtained in the comparison is in section s. <dig> in additional file  <dig> 

comparisons on simulated data with loh regions
in order to evaluate the ibd/upd detection of gbpcr, we applied it to simulated data of  <cit> . these data are based on three real samples of the hapmap dataset , obtained with the affymetrix genechip mapping 250k nspi. for each sample and signal to noise ratio  value, the authors simulated two profiles: one with regions of copy-neutral loh and one with regions of loss. in both cases the number of regions was  <dig> and their width ranged from  <dig> snps to a whole chromosome. the values of snr considered were  <dig>   <dig> and  <dig> . therefore, the total number of samples was  <dig>  because for each normal sample we had two loh profiles and three snr values. the authors simulated the noise and the aberrations at probe level intensity saving the data in .cel file format, thus we used brlmm  <cit>  to extract the genotyping data and cnat  <dig>   <cit>  for the raw copy number data.

similar to  <cit> , the estimation of gbpcr was compared with the ones given by three well-known methods in the field: dchip  <cit> , cnat  <dig>   <cit>  and penncnv  <cit> . the evaluation has been done by computing the true positive rate  and the false positive rate , i.e. the proportion of snps inside the loh regions that are correctly identified  and the proportion of snps outside these segments that are wrongly identified , respectively. we used (), () or () as paired estimators of the number of segments and the boundaries, and either pupd = 10- <dig> or pupd = 10- <dig> mas the prior probability of ibd/upd.

since cnat does not consider the nocall snps  for the estimation of the loh profile, we compared the tpr and fpr computed using only either the informative or the non-informative snps .

overall, all versions of gbpcr behaved similarly on these data and they outperformed penncnv, cnat and dchip. moreover, dchip failed to give a good estimation in presence of high noise, while penncnv did not detect almost any loh aberration. four examples of profile estimation in samples with snr =  <dig>   are shown in figure  <dig> . regarding the copy-neutral loh estimation, all methods  were able to identify the aberrations, but sometimes dchip divided the biggest lesions into small regions of aberration . instead, only gbpcr and cnat were usually able to detect loh regions due to deletions. in this case, cnat divided the biggest aberrations in small regions of loh, losing part of the lesions. in figure  <dig>  we can also appreciate the differences in the estimation of the regions of gain between gbpcr and penncnv. in both examples with regions of loss , the segments outside the losses represent gains. gbpcr failed to identify only one of these lesions, instead penncnv did not recognize almost any of them . in the next section, by applying gbpcr to a real dataset from  <cit> , we will be able to discuss its performance in the identification of genomic gains, depending on the copy number of the alleles .

finally, we also evaluated the effect of the adjustment of the model parameters related to the nocall detection , using the same data. at low or medium noise, no significant differences in the goodness of the estimation could be observed . instead, in presence of high noise, the fpr regarding the ibd/upd detection without the adjustment of the model parameters was close to one. in fact, in this situation a segment with normal copy number is more often classified as ibd/upd, since the nocall rate is higher and, without the correction, the ibd/upd segments are allowed to contain a higher percentage of nocalls with respect to the normal ones. instead, with the adjustment, all types of regions are allowed to have a higher number of nocalls in proportion to the noise, obtaining a less biased estimation.

in conclusion, we suggest to use () or () with pupd = 10- <dig>  due to their good results obtained on the non-informative snps. a detailed description of all the results is in section s. <dig> in additional file  <dig> 

application to real data
in this subsection, we show the behavior of gbpcr on three real datasets. the first dataset consisted of eight paired cancer samples of patients affected by chronic lymphocytic leukemia , which then developed in diffuse large b-cell lymphoma , see  <cit> . for two patients we had also a third sample, thus the total number of samples was  <dig>  the second dataset consisted of  <dig> patients affected by cll, see  <cit> . for both of these datasets, genome-wide dna profiles were obtained using the genechip human mapping 250k nspi . the genotype calls were calculated with brlmm  <cit>  using  <dig> caucasian normal female samples of the hapmap project as reference samples and the raw copy number data were retrieved using cnat  <dig>   <cit> . in  <cit> , the copy number of some genomic regions was also measured with fluorescent in situ hybridization . therefore, on these regions we compared the copy number event estimated by gbpcr with the copy number measured by fish. moreover, since samples coming from the same patient should present the same copy-neutral loh regions  for the majority of the genome, we used the two patients with three samples to evaluate the ibd/upd detection of gbpcr.

the third dataset was a dilution series of the crl- <dig> breast cancer cell line from  <cit> . the series comprised  <dig> samples, corresponding to the following percentages of tumor content:  <dig>   <dig>   <dig>   <dig>   <dig>   <dig>   <dig>   <dig>   <dig>   <dig>   <dig>   <dig>  the genome-wide dna profiles were obtained using illumina 370k beadchips. the authors preprocessed the data with beadstudio software  and we used both the genotyping and logrratio data available at  <cit> . in  <cit> , the authors chose eight genomic aberrations and compared the estimation given by their method  with the ones of the following algorithms: dchip  <cit> , penncnv  <cit> , quantisnp  <cit>  and somatics  <cit> . thus, we compared the estimations of these genomic regions given by gbpcr with the ones given by the previous methods. we also used these data to evaluate the performance of gbpcr in the detection of gains, for different values of the allelic copy numbers.

based on the previous results on simulated data, for the analysis of these real data, we used: (), as paired estimators of the number of segments and the boundaries, and pupd = 10- <dig> as prior probability of ibd/upd.

results regarding the identification of the copy number changes in cll samples
we recall that an individual cancer sample can represent a mixture of neoplastic and normal cells. moreover, the tumor cells themselves do not represent a genetically homogeneous population, since individual genetic lesion might be present in only a fraction of the cells. in fact, figure  <dig> shows that the log2ratio values corresponding to normal, gain, loss regions are sufficiently well separated only when the copy number changes are borne in at least 60% of the cells of the dna sample. as a consequence, we aim to detect the copy number changes borne in at least the 60% of the cells, otherwise we cannot ensure that the identified aberrations are true and not due to the noise of the microarray data . to detect aberrations in even less cell content, it is sufficient to change the prior of z with thresholds closer to zero. in practice, the prior of z influences more the discovery of the gains than the one of the other copy number events, because the determination of gains depends mainly on the estimated log2ratio values .

in the samples considered for the comparison, we had a total of  <dig> regions measured by fish :  <dig> regions were gains or losses in at least 60% of the cells ,  <dig> were gains or losses in less than 60%  and  <dig> were identified as normal segments. regarding the detectable aberrations, only two copy number events were not identified by our algorithm. one loss was not found, because the estimated log2ratio was very close to zero, and the other, because of a different percentage of het snps from what was expected by our algorithm. we discovered  <dig> of the  <dig> less detectable copy number changes and we also detected two of the  <dig> normal segments as aberrations, but one of these copy number changes was equal to the one discovered in the same region of the paired sample, thus it was likely to be true.

instead, by simply using the thresholds of the prior of z on the profiles estimated by mbpcr for the classification of the copy number events , we detected one alteration less than what found by gbpcr and other  <dig> normal regions were seen as aberrations.

for the analysis of the results, we have to consider that the samples used for fish came from peripheral blood, for the cll samples, and from paraffn embedded tissues or lymph node, for the dlbcls. because of the consequently different cell content, in the former case, the results are better estimated. moreover, the samples used for microarray and fish might not be exactly the same, hence the percentage of cells which carry the aberrations can be different and a discordance between the two techniques is possible. thus, gbpcr performed well in estimating the copy number changes on these samples.

results regarding ibd/upd region detection in cll samples
for the evaluation of the ibd/upd region detection, we considered the two patients with three samples. for the first patient , we had: one matched normal dna sample extracted from peripheral blood granulocytes , one sample from neoplastic cells at cll phase  and the last one from neoplastic cells at dlbcl phase . for the second patient , we had: one sample from neoplastic cells at cll phase , one at dlbcl phase  and the last one from neoplastic cells at a further progression of the dlbcl .

applying gbpcr to the three samples of patient  <dig>  we found that the number of aberrations in each sample increased with the progression of the disease. the lower number of segments discovered in sample  <dig>  could also be due to a higher nocall rate in comparison to the other samples. the same happened for sample  <dig>  of patient  <dig> 

we compared the ibd/upd segments found in the three samples of each patient and we divided them into three classes :

• equal regions: segments that are exactly the same in two or three samples;

• overlapping regions: segments that are common in at least two samples but do not have the same boundaries;

• single sample regions: the remaining segments.

then, we defined the number of distinct regions as the sum of all these regions and the number of validated ones as the sum of all types of regions except the single sample regions. the proportions of equal and overlapping regions were similar in the two patients and the validated regions were 73% of the distinct regions detected in patient  <dig> and 79% of the distinct regions in patient  <dig>  the single sample regions were about the 21% of the distinct regions in patient  <dig>  but the majority of them had length less than  <dig> snps. instead, since the samples of patient  <dig> belonged to different stages of the disease, in this patient we found a higher number of single sample regions and most of them were wider than  <dig> snps. in fact, the majority of these regions was detected in sample  <dig> , thus they were likely to be somatic.

results regarding the identification of genomic aberrations in the dilution series
in  <cit> , the authors observed that the beadstudio normalization produced copy number profiles which were centered differently as the tumor content decreased and, as a consequence, many algorithms wrongly assigned the type of genetic aberration. therefore, they evaluated the methods by considering only if they found any aberration in the eight regions considered, without looking at the type of aberration.

due to this variation in centering the normal copy number, we estimated the histogram of the estimated log2ratio values , separately by using only samples with similar tumor content. nevertheless, this shrewdness was not suffcient to well distinguish the peaks of the histogram in some cases.

for all samples, we computed the sensitivity in detecting the eight aberrations considered in  <cit> . for each of them, the calculations were done in two ways: by looking if gbpcr found any aberration  and by looking if it found the correct lesion . by comparing the results obtained by gbpcr using the first type of sensitivity with the ones given by the other methods in figure  <dig> of  <cit> , we can observe that gbpcr outperformed dchip and penncnv and often also quantisnp. sometimes it also performed better than bafsegmentation and somatics in the detection of the regions of gain. moreover, occasionally gbpcr had a non-zero sensitivity in the normal sample, because it detected small ibd/upd regions. by looking at the results obtained by gbpcr with the second type of sensitivity, we can notice that the correct aberration was usually detected in samples with at least 60% of tumor content and the sensitivity was still often higher than the one of dchip and penncnv.

finally, we computed the sensitivity of gbpcr for eight regions of gain, to evaluate its performance depending on the value of the copy number of the alleles. for all eight lesions, the total copy number was four. instead, the minor allele copy number  changed from two to zero. the selection of these regions of gain was based on the estimated genomic profile of crl- <dig>  provided by the cancer genome project at the wellcome trust sanger institute and available at  <cit> . for each aberration, the sensitivity was computed in two ways: by looking if the region was identified as a gain and by looking if it was detected as either a gain or an ibd/upd segment .

the differences between the two types of sensitivity were observed for some percentages of tumor content, in gains with macn =  <dig> or macn =  <dig>  regarding the lesions with macn =  <dig>  a small part of the gain was identified as ibd/upd region in few cases with a small percentage of tumor content. this phenomenon was due to the presence of a high percentage of homozygous snps with copy number close to the normal copy number. for the same reason, the whole gain 6q <dig>   was identified as an ibd/upd region at 100% and 79% percentages of tumor content and the same happened also for a part of 6q <dig>  at 79%. as we explained in section "method", the detection of the gains highly depends on the copy number value. thus, if the copy number of a region of gain is close to the normal value, it is identified as either normal or ibd/upd, depending on the homozygous status of the snps inside it. therefore, the performance of gbpcr depends mainly on the quality of the copy number data and not on the value of the copy number of the alleles.

CONCLUSIONS
we have derived a new algorithm  for the simultaneous estimation of copy number changes and ibd/upd regions, by using both copy number and genotyping data. to the best of our knowledge, only one other algorithm exists which uses the same input data for the same purpose  <cit> , but it does not appear appropriate for data coming from a dna sample of a mixture of cell populations .

our model takes into account the errors due to both the microarray procedure and the biological processes that lead to aberrations affecting the dna copy number and the homozygous status. because of the complexity of the algorithm and the high noise of the real data, we introduced new estimators to improve the detection of the breakpoints. on the basis of the results on simulated data, we selected the best performing one: ().

on the artificial dataset of  <cit>  , gbpcr outperformed three well-known methods which estimate regions of loh: dchip  <cit> , cnat  <cit>  and penncnv  <cit> . we also tested gbpcr on real data. on  <dig> cll samples  <cit> , we found a high agreement between the copy number changes estimated by gbpcr and the ones obtained by fish . moreover, on two patients with three samples we could validate at least 73% of the identified ibd/upd segments. on the samples of the crl- <dig> dilution series of  <cit> , we showed that in samples with at least 60% of tumor content, gbpcr was able to detect the genomic aberrations, while with less tumor content only some aberrations could be seen. moreover, on these data gbpcr outperformed dchip  <cit>  and penncnv  <cit>  and sometimes quantisnp  <cit> . since other methods , which use the allelic copy number information, seemed to perform well, as future work we intend to add also this useful information in our model.

availability and requirements
project name: gbpcr.

project home page: http://www.idsia.ch/~paola/gbpcr/.

operating systems: the software should run in linux, mac-os or windows. tests were performed on windows and linux systems.

programming language: r.

other requirements: none.

licence: gnu gpl.

any restrictions to use by non-academics: none.

authors' contributions
pmvr carried out the study and wrote the manuscript. mh and ik supervised the statistical analysis. fb supervised the validation study and provided the real data. all authors read and approved the final manuscript.

supplementary material
additional file 1
gbpcr source code. this zipped file contains the source code of the gbpcr algorithm in r, including help files, sample data and examples.

click here for file

 additional file 2
supplementary material. this file contains: 1) the description of the estimation of the parameters of the likelihood, 2) the explanation of the estimation of density of the estimated log2ratio levels, 3) explicit formulae of some quantities employed in the dynamic programming used to implement our method, 4) the explanation of an algorithm for the determination of the maxima of a multimodal function, 5) detailed description of the results obtained on simulated data, 6) some supplementary tables and 7) some supplementary figures.

click here for file

 acknowledgements
this work was supported by swiss national science foundation ; oncosuisse grants ocs-1939-8- <dig> and ocs - 02296-08-2008; cantone ticino ; fondazione per la ricerca e la cura sui linfomi .
