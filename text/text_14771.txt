BACKGROUND
alternative splicing  is the process by which a single gene is able to express several proteins that may have diverse or even antagonistic functions. the mature mrna that corresponds to the different proteins for the same gene is called transcript isoform or isoform in short. some as is related to development, tissue differentiation, etc. other as events are pathological and are associated with various diseases including cancer. many of them are yet unknown. the analysis of disease specific alternative splicing and its molecular consequences is promising and can be used to find new diagnostic, prognostic, predictive, and therapeutic tools  <cit> .

some microarray companies  provide arrays designed to capture alternative splicing events. there are also custom arrays that use the agilent platform  <cit> . the main difference between these technologies is that affymetrix only includes exon probes  and jivan, exonhit or customized agilent arrays also include junction probes . affymetrix has recently developed an experimental array that also includes junction probes. this work focuses on affymetrix exon arrays. there are a number of studies that propose different methods to deal with these arrays  <cit> . the procedure to extract a signal value from a set of probes in an affymetrix array  can be divided into three stages: background removal, normalization  and summarization . usually the proposed methods for exon arrays  <cit>  are modifications of the algorithms already used in expression arrays.

algorithms for removing background and performing normalization in expression arrays can be reasonably applied to exon arrays. however, the summarization step has some special characteristics that make it difficult to apply these methods. to clarify this assertion, it is important to distinguish that, in exon arrays, there are three ways to group the probes: by genes , by transcripts  and by exons . affymetrix  <cit>  and brainarray  <cit>  provide different updated versions of the chip definition files  to do the grouping using genes, transcripts or exons and using different identifiers for each of them. our work focuses on transcripts.

in a summarization step it is implicitly assumed that there is no cross-hybridization between probes that belong to different sets . however, if the probes are grouped by transcripts and a gene presents several isoforms, there will be many probes that hybridize with several transcripts of the same gene. to make matters worse, specific probes for a particular transcript  may be excluded if the computation is a robust summarization method. the reason is that, since their behavior is different from other probes in the set, their values are not used in the summarized signal. as many as 85% of the exons in genes with several isoforms are shared by several transcripts. it is not advisable to use standard expression algorithms to exon arrays grouped by transcripts. in the seminal study of wang et al.  <cit>  this problem is stated and solved by using a deconvolution algorithm assuming that the structure of the gene is known. recently, a work that also deals with transcript concentration estimation has been proposed  <cit> . for some gene structures there is a deconvolution ambiguity and additional constrains may be necessary to resolve transcript expressions  <cit> .

to deal with the problem of quantifying transcripts, the authors and some colleagues  <cit>  designed the algorithm "splicing prediction and concentration estimation"  based on non-negative matrix factorization . space algorithm was used to predict the structure for each particular gene and quantify the concentration of each particular transcript including unknown isoforms. space was designed to be used with arrays with either exon or junction probes. the special characteristics of the affymetrix arrays drove us to include some refinements to this algorithm. they are  detection and removal of the outliers in the probe data,  estimation of the number of transcripts of a gene in a set of samples,  selection among the possible solutions which is the most suitable for splicing data  and  use of the information of probesets to correct errors in the predicted structure of the genes. in the results section, the improvements for simulated data are shown. the accuracy of predicted structures and concentrations validated by pcr for real datasets is also tested. in addition to this, the space algorithm with the improvements described here, has been ported to r .

RESULTS
the improvements described in the methods section to the initial space algorithm were applied to both synthetic and real microarray datasets. each of the datasets are described in the following sections.

synthetic dataset
around  <dig> genes  that show alternative splicing were simulated. probe signals for this synthetic dataset are proportional to the sum of concentrations of the transcripts that share the probe, in turn, this proportional constant, the affinity, was estimated from the values of each probe in an experiment for different tissues provided by affymetrix. these affinities are estimated using dchip. this method assumes that the signal is proportional to the product of the affinities of the probes and the concentration of the gene. once the estimated concentration of the gene is known it is quite straightforward to get the affinities. another equivalent possibility is to get the affinities using the first eigenvector of the svd decomposition of the probe data matrix for each gene. since dchip assumes that there is only one isoform per gene, these affinities are not accurate but sufficient to perform a simulation. transcript concentrations are constructed by drawing random numbers that follow a uniform distribution across samples and multiplying them by a proportional factor also drawn from a uniform distribution. this approach simulates that there are some transcripts that are systematically more expressed than others in a gene.

the property g matrix for each of the genes was built using the information provided by brainarray  <cit> . g is an indicial matrix  that relates probes with transcripts, i.e. it discerns whether a probe is included in a transcript or not. the size of this matrix is probes transcripts. following the deconvolution model proposed by wang et al.  <cit> , the simulated probe signal matrix  was built by multiplying the three matrices . the underlying reasoning is that the signal of each probe is proportional to its affinity times the sum of the concentrations of the transcripts that hybridizes against it. finally, noise  was added. this noise was computed so that it is similar to the noise present in real data. in turn, the noise in real data was estimated by using the residuals of the dchip summarization model.

this simulated dataset are  <dig> genes with known structure , known number of transcripts  and known concentrations  plus noise that mimics the real distribution.

the space algorithm includes a nmf step. the nmf is computed iteratively. each gene is iterated  <dig> times to achieve convergence.

the results are presented for estimation of the number of different transcripts in a given mixture, structure prediction of each of these transcripts and estimation of their concentration.

prediction of the number of transcripts
the number of transcripts was estimated using a modification to a method proposed by owen and perry  <cit> . this method performs a partition of the initial data matrix  into four submatrices and estimates one of these submatrices using the remaining three submatrices. changing the role of each of the submatrices, it is possible to predict the whole initial data using approximately 75% of these data. the estimation is performed by means of using nmf  and is done considering different internal dimensions for the factorizations into consideration. the estimation process was repeated a number of times for different partitions . afterwards, we selected the minimal internal dimension of the factorization  that provides an error distribution whose median is not statistically larger than the distribution of the error of the internal dimension with the minimum error . figure  <dig> shows the performance of this estimation. it compares the predicted number of transcripts  with the number of transcripts in ensembl .

this simulation shows that the estimation of the number of transcripts is a difficult task even for synthetic data since, for this level of noise, the predicted number of transcripts is usually incorrect. nevertheless, if the proposed method is used simply to predict splicing, it has a very low false positive rate , i.e. only 1% of the genes that have a single transcript are predicted to have alternative splicing. the false negative rate  is on average about 30%. this false negative rate  is  a consequence of some simulated transcripts having very low concentrations in all samples, in comparison with the most significant transcript of the same gene. we also performed a simulation assuming that all the transcripts follow an uniform distribution and fnr improves .

the figure s <dig> in additional file  <dig>  compares the performance of the number of transcripts predictions using the new and the previous version of the algorithm on the same simulated dataset. the new version estimates the number of transcripts more accurately.

structure prediction
space algorithm was applied to each of the genes in the synthetic dataset. the algorithm provided a continuous estimation g˜ of the property g matrix .

the g˜ matrix has all its values bounded between zero and one. on the other hand, the original g matrix is binary . it would be desirable to quantify the ability to predict the g matrix using g˜.

changing a threshold th, it is assumed that a particular entry of g˜ is  <dig>  or  <dig> . comparing the corresponding entries from g and , there are true positives , true negatives , false positives  and false negatives . these values  can be used to construct the roc or compute other performance figures. each gene has its own roc curve. summing up each of tp, tn, fp and fn for all the genes it is possible to get an estimation of the overall performance.

it is important to point out that there is always an indetermination in the order of the transcripts: the columns of g and g˜ for a perfect prediction can have a different order. before performing the previous computations, g˜ is resorted so that it becomes more similar to g. the same sorting is applied to the rows of the concentrations matrix.

different error figures in the prediction are represented in figure  <dig>  it includes the hamming distance, the sensitivity and the specificity for different thresholds over the g˜ matrix. the dashed lines belong to the space algorithm without improvements and the continuous lines to space with improvements.

in figure  <dig>  it can be observed that the optimum threshold for the hamming distance  is about  <dig> . the new algorithm has a lower hamming distance than previous one. if the threshold that provides the same sensitivity and specificity  is set, both the one and zero values have the same reliability. in this case, we consider accidental inclusion as equally undesirable as accidental exclusion of an exon. this threshold is close to  <dig> . the sensitivity and specificity of space in the crossing point is equal to  <dig> ; such value represents an error 25% lower than the crossing point for space without any improvement.

concentration estimation
we scaled the columns of the w matrix to make its structure more similar to ag matrices. this scaling, different for each of the columns of w is possible because of the non-uniqueness of the nmf. the initial space algorithm included a heuristic to obtain a "filled" g matrix that is also used in the improved one before the scaling. the estimated concentrations of the transcripts with and without the adaptation of w matrix in space were compared. in figure s <dig> in additional file  <dig>  the mean average error  for different genes used in the simulations is shown. in that figure, it can be observed that adaptation improves the estimation of the concentrations. in most of the cases the diminution in the estimated error is statistically significant.

real datasets
space was also applied to several datasets downloaded from geo  <cit> . all of them have available cel files to perform all the steps of the analysis and the corresponding papers include validation of the results using rt-pcr. these datasets are: affymetrix sample dataset of human tissues. it contains  <dig> tissues with  <dig> replicates of each tissue along with several mixtures of three tissues . a recent study made by de la grange et al.  <cit>  includes rt-pcr validation for some genes in that dataset; gse <dig>  <cit>  ; gse <dig>  <cit>  ; gse <dig>  <cit>  ; and gse <dig>  <cit>  .

the table s <dig> in additional file  <dig>  summarizes the results of the predictions for each of the datasets. the table includes the following fields: dataset, gene, rt-pcr band according to fast-db, number of isoforms between primers using pcr, predicted number of isoforms between primers using space, number of isoforms between primers according to ensembl  <dig>  predicted total number of isoforms, total number of isoforms in ensembl  <dig>  coherence of predicted structure with pcrs, coherence of estimated concentrations with pcrs and a comment of the results.

affymetrix dataset
roc curves have been made to test space performance for the structure prediction of alternatively spliced isoforms. as already stated, space predicts the overall structure of a gene whereas rt-pcr experiments can identify only the events that occur between the included primers. in order to test the quality of space predictions we made the following assumption: if the results of a rt-pcr within a gene in a dataset is compatible with ensembl structure, we assume that the ensembl structure is correct. in figures three and four of the study made by de la grange et al.  <cit>  a total of  <dig> genes that present alternative splicing between tissues were validated by rt-pcr . two genes snx <dig> and ide were excluded because alternative splicing events shown in the pcrs do not appear in ensembl release  <dig>  assuming that the gene structures of the remaining  <dig> genes in ensembl are correct, we use these structures for each gene as "ground truth" and computed the roc curves shown in figure  <dig>  the number of transcripts of each gene in all samples was estimated from the pcr figures. the number of transcripts was also estimated by the proposed algorithm. the estimated number of transcripts was usually larger than the indicated by pcrs. two roc curves were constructed. the red roc curve indicates space performance without any improvement. the black roc curve was estimated applying the improvements described in the methods section.

the analysis for cltb gene is shown in figure  <dig>  space algorithm was run to predict the structure of two alternatively spliced isoforms. their predicted structure in panel  shows a cassette event that is characteristic of cerebellum. predicted structure is the same than annotated structure in ensembl release  <dig> shown in panel . the predicted concentrations of isoforms clearly show that variant  <dig>  which includes the cassette exon, is exclusive of nervous tissue. these results match rt-pcrs provided in de la grange et al.  <cit> . results for other genes in  <cit>   are shown in the additional material .

glial tumors
in the study of glial brain tumors in humans made by french et al.  <cit> , the authors provide pcrs for  <dig> genes. the analysis for atp2b <dig> gene is shown in figure  <dig>  space algorithm was run to predict the structure of two isoforms. their predicted structure in panel  shows a cassette event that involves one exon towards the 5' end of the gene. the estimated concentrations of both transcripts  across all samples are shown in panel . variant  <dig>  is almost non-existent in samples  <dig> to  <dig> . in samples  <dig> to  <dig> , variant  <dig> has a larger concentration than variant  <dig>  in samples  <dig> to  <dig> , this difference in concentration is even more apparent. these results are not consistent with the pcrs shown in  <cit> . in this study, the pcr shows that the long isoform is expressed only in gbm cells whereas the short isoform is expressed similarly in the three groups. this error in the predicted concentration may be owed to the lack of identifiability of this particular gene structure  <cit> .

genotype and alternative splicing
in the comparative study of the relationships between genotype and alternative splicing in humans, the validation done with parp <dig> gene is shown in figure  <dig>  this gene, according to kwan et al.  <cit>  study, shows an alternative splicing event related to a particular snp in probeset  <dig>  in ensembl release  <dig>  this gene is annotated as a single transcript. two transcripts were predicted by space algorithm and their predicted structure is shown in panel . predicted transcript variant  <dig> is equal to the annotated transcript in ensembl. predicted transcript variant  <dig> shows the lack of probeset  <dig>  in panel , the estimated concentrations of the two predicted transcripts are shown. there are three replicates of each sample and the estimated concentrations match perfectly pcr results for both splicing variants in each sample.

in this particular case, the coherence algorithm would miss this alternative splicing event because the ensembl annotation does not include this variant.

ptb depletion in mice
in the analysis of predetermined transcript inclusion levels after ptb depletion in mice made by xing et al.  <cit> , the obtained results for ncam <dig> gene are shown in figure  <dig>  this gene has five different transcripts annotated in ensembl release  <dig> as shown in panel , two of which are very short compared to the length of the gene. two transcripts were predicted by space and their predicted structure is shown in panel . the first predicted transcript variant  <dig> is very similar to the first ensembl transcript. the second predicted transcript variant  <dig> is also similar to the third ensembl transcript. some probes that belong only to the short ensembl transcripts are incorrectly assigned to the larger predicted transcripts and the second exon is also misassigned to the predicted variant  <dig>  in panel , the estimated concentrations of the two predicted variants are shown. variant  <dig> is predominant in the samples  <dig> to  <dig>  and variant  <dig> is predominant in the samples  <dig> to  <dig> . these concentrations are in concordance with pcrs.

discussion
we have described the different improvements on space: outlier detection and correction; prediction of the number of transcripts; the adaptation of the factors of the nmf to provide a structure closer to the reality; and the exploitation of the redundancy of the affymetrix probes.

all the improvements were tested on synthetic data mimicking the real data . suggested changes improved error rates by about 25%. we have also tested our algorithms in rt-pcr validated data. the roc figures document a specificity and sensitivity of around 75% in the case of structure prediction. concentration estimates to a large extent mirrored pcr images in the cited studies.

however, when applying space  to real data we faced some problems worth noting. for example, space algorithm assumes that all the probes hybridize against at least one of the transcripts. in exon arrays there are many probes  that do not hybridize against mrna, this happens even in the core annotated probes. additionally, many of the probes in exon arrays do not perform well or at least there are probes within the same exon that do not correlate well with other probes of that exon.

structure prediction improves with careful selection of the probes, e.g. by identifying and discarding probes that do not hybridize or that cross-hybridize to different parts of the genome . background acts as an offset for the probes in the array. even though the applied background removal algorithm  <cit>  behaves better than the standard rma version, further improvements can be made at this point. this problem is attenuated but not completely solved when using brainarray  <cit>  cdf files for genes, transcripts and exons. there are several papers  <cit>  that address these questions and provide different methods to select the probes.

assessment of the performance of the space algorithm for real datasets required some sort of "ground truth". in this paper, only genes with rt-pcr validated splicing events in each dataset were used for validation. it should be noted that pcrs only assess splicing events that appear between the primers, while space algorithm reconstructs the whole structure of each transcript. for the validated gene set, transcript structures from ensembl release  <dig> were used as reference. inaccuracies in the ensembl annotation would lead to an underestimation of the validation rates. in figures s <dig> and s <dig>  additional file  <dig>  the concordance between space predictions and ensembl release  <dig> annotations was tested for a set of  <dig> randomly selected genes. the performance decreased compared to genes that have rt-pcr evidence of alternative splicing. additionally, the concordance of the estimated concentrations of each isoform in each sample with the pcrs shows the accuracy of the predictions.

the redundancy of the affymetrix probes in exon arrays was exploited to detect and correct errors in the structure. probes that belong to the same exon or probeset  must all be present or absent in a particular transcript. after applying this correction, both sensitivity and specificity improved significantly in real and simulated datasets. however, if a new transcript had a splicing event  that did not follow the probeset grouping , the prediction would be incorrect, as the algorithm would treat the probeset as a whole.

variability between samples provides space algorithm with more information that leads to better results in the prediction of structure. for example, a normal vs tumor experiment that consists of several technical replicates of the same samples provides less information than an experiment with  <dig> different tissues as the affymetrix sample dataset. additionally, the number of transcripts present in all samples is also important to the algorithm performance. if there are more than  <dig> or  <dig> transcripts space performance greatly decreases.

using the wang deconvolution model, it would be possible to estimate transcript concentrations provided that the gene structure  is known. however, there is a deconvolution ambiguity that only depends on the gene structure  <cit> . this ambiguity may provide different valid solutions to the wang model for some genes with the same probe intensities. space is also sensitive to this ambiguity. however, as shown in the simulations, it is able to predict the structure and estimate the concentrations with reasonable accuracy. she et al.  <cit>  suggest a method to deal with this ambiguity by estimating the mean affinity of groups of probes. this is a priori information which can also be included in the space algorithm. it is also possible to test later whether the estimated g matrix has this ambiguity or not.

all the described algorithms have been included in an r-package and added as the additional file  <dig>  a script to test the functions is also included as additional file  <dig>  the source code and the manual of the package are included as additional file  <dig> and additional file  <dig> respectively.

CONCLUSIONS
we have proposed a method to predict the structure and estimate the concentration of transcripts using affymetrix exon arrays. we have included several improvements over our previous work, namely; outlier identification and removal, improved estimations of the number of transcripts, adaptation of the nmf factors to mimic the proposed model and exploitation of the redundancy of the exon arrays that include several probes per exon. simulations show that the error figures improved by applying these methods. the algorithms have been validated in real datasets.

