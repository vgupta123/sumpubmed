BACKGROUND
one of the most fundamental problems of molecular biology is to annotate all functional elements in the genome. because of evolutionary pressure, many of the functional elements are believed to be located within regions that evolve more slowly than the overall genome  <cit> . regions that evolve more slowly are called evolutionarily conserved elements. conservation analysis by comparing genomes of related species is a powerful approach for identifying functional elements like protein/rna coding regions and transcriptional regulatory elements  <cit> .

in comparative genomics, one often starts with an alignment of multiple orthologous sequences from several species. the power of a conservation analysis is usually measured by its sensitivity and specificity of detecting conserved elements from given alignments. several papers have been published recently dealing with the power evaluation of phylogenetic models in comparative genomics studies  <cit> . both eddy  <cit>  and mcauliffe et al.  <cit>  evaluated the power of such studies assuming a symmetric star topology and the jukes-cantor nucleotide substitution model, whose simple structure makes it possible to evaluate the power of the method analytically. mcauliffe et al. considered the hypothesis testing problem for the conservation of a single nucleotide site, whereas eddy considered the classification problem for whether a whole dna block is conserved or not. both papers reported the theoretical power mainly as a function of the number of comparative genomes and the branch length from the center of the star topology to each species. however, the approaches they employed are not able to accommodate the substitution rate variation and correlations among nearby nucleotides along a genomic sequence. more realistic models are needed to account for the spatial rate variation and correlation in order to more accurately reflect the nature of real data  <cit> . various models have been proposed for this task, including the hidden markov model  <cit> , ising chains  <cit>  and markov random fields  <cit> . in particular, felsenstein and churchill  <cit>  used hmms to model the substitution rate correlation along the genome. since then, this model has been adapted to many evolution related problems  <cit> .

in this paper we evaluate the power of the phylogenetic hidden markov model , which models the substitution rate variation using an hmm. as introduced collectively in ref.  <cit>  to improve phylogenetic modeling, phylo-hmm is a generative probability model for aligned multiple orthologous sequences. it models the molecular evolution in both the space dimension along the genome and the time dimension along branches of the phylogenetic tree. along the genome of the common ancestor, an hmm is used to describe the change from one site to the next. along each branch of the phylogenetic tree, a continuous-time markov process is used to model the evolutionary process. siepel et al.  <cit>  implemented a two-state phylo-hmm to perform a genome-wide detection of evolutionarily conserved elements. they showed that this model can yield biologically meaningful results, but did not evaluate the statistical power of the method. in their study, the transition matrix of the hmm in the phylo-hmm model is assumed to be known and unchanged along the genome. this is equivalent to assuming that the expected length and coverage  of conserved elements are known and that the conservation ratio is homogeneous along the genome, which is unrealistic  <cit> .

the goal of this paper is to systematically assess the ability  of the phylo-hmm to identify conserved genomic regions. because this model is too complex for a theoretical analysis and because the availability of real data with experimentally verified conserved elements is still very limited, we adopt a simulation approach. given that different regions along the genome vary in terms of their neutral substitution rates, the expected lengths and coverage of the conserved elements  <cit> , we used sequence data from promoter regions of four selected species  to first estimate the set of key parameters of the phylo-hmm. we call this set of estimated parameter values the baseline. we simulated sequences by varying one or a subset of parameters around the baseline. using these simulated sequences, we explore several fundamental questions in comparative genomics with respect to this model, including 1) does the topology of the phylogenetic tree critically impact statistical power?, 2) is the accuracy of the predictions significantly reduced if we simplify the nucleotide substitution model?, 3) is it always beneficial to select more distantly related species for this analysis, thereby increasing the branch lengths of the phylogenetic tree?, 4) how many comparative genomes do we need in order to detect conserved elements of a certain length with satisfactory power?, and 5) is spatial variation of the conservation ratio important? assuming that the underlying phylo-hmm model is a reasonable approximation of reality, our results reveal a number of insights. first, we demonstrate that the most important factors of a comparative genomics analysis appear to include the number of genomes used and the evolutionary distance between pairs of species, consistent with results for simpler models reported by others. further, we show that the conservation ratio of conserved elements and the expected length of the conserved elements are also major factors. therefore, our results show that it is important to accurately characterize the inter-species  variation in the phylo-hmm model. in contrast, the influence of the topology and the nucleotide substitution model are relatively minor.

methods
phylo-hmm model
a main objective of the conservation analysis is to classify each nucleotide position of the target genome as either evolutionarily conserved or nonconserved based on a comparison with genome sequences of some other chosen species. this task is often achieved by first aligning the genomes under consideration and then using a computational strategy for site classification. here we focus on the second task. following the description of the two-state phylo-hmm model  given by siepel et al.  <cit> , the alignment generating mechanism is modeled as a two-step procedure. first, a common ancestral dna sequence of all contemporary species under consideration is generated from a two-state hmm, with the hidden states being conserved or nonconserved sites. second, the phylogenetic model assumes that each nucleotide in the ancestral dna evolved independently, conditional on their hidden states, to the contemporary nucleotides along all branches of the phylogenetic tree. the two parameters, , for the two-state hmm are derived from the data, and then re-parameterized as , which have a more intuitive explanation, with l = 1/μ representing the expected length of a conserved element , and p = ν/ representing the expected coverage of conserved elements . the phylogenetic models for nonconserved and conserved states are denoted as ψn =  and ψc = , respectively. here π is the vector of background  probabilities for the four nucleotide bases; τ is the tree topology of the corresponding phylogeny; β is a vector of non-negative real numbers representing branch lengths of the tree, which are measured by the expected number of substitutions per site; ρ is the conservation ratio representing the ratio between the substitution rate in conserved regions versus that in nonconserved regions; and q is a 4-by- <dig> substitution rate matrix for the continuous-time markov process.

many parametric forms are available for the substitution rate matrix q  <cit> . here we used the parametric forms in the paml package  <cit> . the jc model  <cit>  is the simplest one among all models implemented in paml; it assumes a uniform base composition and a uniform rate for all types of substitutions. f <dig>  <cit>  assumes that the substitution rate is proportional to the frequency of the target nucleotide. hky  <cit>  is a more realistic rate matrix because it accounts for non-uniform base composition and transition/transversion rate bias. rev, a generalization of hky, is the most general model and only requires that the nucleotide substitution process be a reversible markov process  <cit> .

parameter inference and posterior probability
we assume that the tree topology τ of the selected species for comparative analysis is known. the background distribution π can be first estimated by the relative frequencies of the four bases of all the sequences in consideration and treated as known. all other parameters, denoted by θ = , will be inferred from the data by their maximum likelihood estimates . the complete likelihood can be written as:

 p=bz1p∏i=2kazi−1zip
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgqbaucqggoaakcqwgabgwcqggsaalcqwgybawcqgg8bafiigacqwf4oqccqggpaqkcqgh9aqpcqwgibgydawgaawcbagaemoeao3aasbaawqaaiabigdaxaqabaaaleqaaogaemiuaalaeiikagiaemieag3aasbaasqaaiabigdaxaqabagccqgg8bafcqwfipqedawgaawcbagaemoeao3aasbaawqaaiabigdaxaqabaaaleqaaogaeiykakyaaebcaeaacqwghbqydawgaawcbagaemoeao3aasbaawqaaiabdmgapjabgkhitiabigdaxaqabawccqwg6bgedawgaaadbagaemyaakgabeaaasqabagccqwgqbaucqggoaakcqwg4baedawgaawcbagaemyaakgabeaakiabcyha8jab=h8a5naabaaaleaacqwg6bgedawgaaadbagaemyaakgabeaaasqabagccqggpaqkasqaaiabdmgapjabg2da9iabikdayaqaaiabduealbqdcqghpis1aaaa@637b@ 

where k is the total number of columns in the alignment, xi is the observed nucleotide vector in the i-th column, zi ∈ {c, n} is the hidden state of the i-th column,  = , μ/) is the initial emission probability of the hmm, and azi−1zi
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwghbqydawgaawcbagaemoeao3aasbaawqaaiabdmgapjabgkhitiabigdaxaqabawccqwg6bgedawgaaadbagaemyaakgabeaaasqabaaaaa@3620@ is the transition probability as illustrated in figure  <dig>  with the help of the standard forward/backward procedure for hmm  <cit>  to sum over all possible z, we can use the em algorithm  <cit>  to get the mle of θ, denoted as θ^
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacuwf4oqcgaqcaaaa@2e79@. based on θ^
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacuwf4oqcgaqcaaaa@2e79@, the forward-summation-backward-sampling method  <cit>  can then be used to compute the posterior probability for a given hidden state to be conserved, i.e., p. by applying a threshold to the posterior probability that a given site is conserved, we finally classify all sites in the alignment as either conserved or nonconserved. another possible approach is to estimate θ using a bayesian method via the gibbs sampler  <cit> .

the baseline
we estimated the baseline parameters of the phylo-hmm from the promoter sequences of dog, human, mouse, and rat, whose evolutionary relationship is represented by the phylogenetic tree in figure  <dig>  the promoter sequence of a gene is defined as the region  <dig> bp upstream to  <dig> bp downstream of the annotated transcription start site of that gene. mlagan  <cit>  was used to align the promoter regions of genes in each orthologous gene cluster, which is defined as a set of  <dig> genes, each from a different species, of which any pair are reciprocal-best blast hits of each other . all gaps in the alignment were treated as missing data  <cit> . if the average branch length of the phylogenetic tree for the conserved sites of a gene's promoter region was estimated to be greater than one substitution per site, the corresponding promoter alignment was considered unreliable and, thus, removed from our simulation studies. after filtering out such alignments,  <dig> orthologous gene clusters remained. using the rev model for the substitution rate matrix, we fitted the phylo-hmm to each of these  <dig> alignments separately. the baseline is defined by setting the parameters  to be the median values of fitted parameters from these  <dig> alignments.

simulation scheme
given the phylogenetic tree and all model parameter values , we first simulated the true state sequence from the two-state hmm, considering sequences  <dig> nucleotides in length. then, we simulated the ancestral dna sequence by independently choosing a nucleotide for each site of the state sequence according to π. to simulate the ungapped alignment of the modern-day genomes, we followed the phylogenetic tree from its root for each site. recursively, we sampled a nucleotide for each branch point  of the tree according to the markov transition kernel q and the length of the branch that links to the previously-generated branch point. assuming that the true topology and the true substitution model type were known, we computed the posterior probability for each site being conserved from the simulated alignments. the predicted state sequence was produced by applying a threshold to the posterior probability. the sensitivity of the method was defined as the proportion of true conserved sites correctly predicted, and the specificity was defined as the proportion of predicted conserved sites that were truly conserved. the receiver operating characteristic  curve was plotted to illustrate the tradeoffs between the sensitivity and specificity at different thresholds.

the above simulation-prediction procedure was repeated  <dig> times under each topology and parameter setting unless otherwise specified. the median sensitivity and specificity at each threshold were used to draw a roc curve. the inter-quartile range  was used to reflect the variation of the sensitivity and specificity measures. the size of this range is related to the length of the alignment. we used the median and the inter-quartile range instead of the mean and the standard deviation because the former measures are more robust and naturally bounded by  <dig> and  <dig>  we used the bootstrap method  <cit>  to obtain the 95% confidence interval of the median. the size of the bootstrap confidence interval is dependent of the number of simulations.

RESULTS
the baseline
the baseline parameter values for the phylo-hmm with rev, as estimated from alignments of orthologous promoters of dog, mouse, rat, and human, are listed in table  <dig>  the average length of a conserved element is about  <dig> bp, much longer than the typical length of a transcription factor binding site. this may be due to the prevalence of the clustering effect of cis-regulatory elements  <cit> , or the existence of sequence features that are specific to individual genes instead of transcription factors. the average coverage of conserved elements is about 25%. estimated branch lengths of the phylogenetic tree for nonconserved sites show that the promoter region is more divergent compared to the protein coding region. for example, the estimated distance between human and mouse for the promoter region is  <dig>  substitutions per site, whereas that for the protein coding region is  <dig>  substitutions per site  <cit> .

the table provides the fitted phylo-hmm parameter values  from the alignments of orthologous promoters of dog, mouse, rat, and human. mlagan was used to align the orthologous promoters. each promoter alignment of the  <dig> orthologous gene clusters was fitted separately by phylo-hmm using the rev model for the substitution rate matrix.

power comparison of phylo-hmm and the pid method
we simulated alignments from phylo-hmm with the baseline setting. these alignments were then used by phylo-hmm to infer the hidden state sequence conditional on the true topology and the true substitution model type, i.e., rev. the power of the phylo-hmm on these simulated alignments was compared with the pid method, which is a simple but widely used local conservation measure in comparative genomics  <cit> . given an alignment, the pid value of each site was calculated as the percent of identical columns  within a window centered at the current column. to maximize the performance of the pid method, we set the window size as the true expected length of conserved elements, which is  <dig> +  <dig> for the baseline. then the roc curves were generated by varying thresholds for the pid values.

both methods were applied to the simulated ungapped alignment under the baseline setting. figure  <dig> shows the corresponding roc curves. by choosing  <dig>  as the posterior probability threshold for a site to be conserved, phylo-hmm achieved a median sensitivity of  <dig>  at a median specificity level of  <dig> . the 1st – to 3rd- quartiles of the sensitivity are  <dig>  and  <dig> , respectively. however, the pid method only achieved a median sensitivity of  <dig>  at the same specificity level. the corresponding 1st – to 3rd- quartiles of the sensitivity are  <dig>  and  <dig> , respectively. the inter-quartile range for the estimate is also larger than that of phylo-hmm. the 95% bootstrap confidence interval for the median estimate is very narrow as shown in figure  <dig>  which implies that the variation of the median estimate is small. therefore, the power of pid method is significantly smaller than that of phylo-hmm method for the baseline. this is generally true if the alignment is generated from the phylo-hmm model with a non-star-topology tree.

influence of branch length at different locations in the tree
it has been suggested that the power of a comparative genomics method to distinguish conserved sites from nonconserved ones increases with the total evolutionary distance in the phylogenetic tree  <cit> . however, it is difficult to obtain a reliable orthologous alignment if the genomes under consideration are too divergent. even if the true orthologous alignment is available, some recent studies have shown that the power decreases with increasing total branch length in some instances  <cit> . here we investigated the effect of varying branch lengths on phylo-hmm power.

the curves in figure  <dig>  generated by varying lengths of different branches in the baseline phylogenetic tree, show the relationship between the median sensitivity and the length of the branch when the specificity was fixed at  <dig> . the simulation-prediction procedure was repeated  <dig>  times for each branch length setting considered. it is clear that for the phylo-hmm model, the power decreases if the branch length increases beyond a certain critical value. for example, for the baseline phylogenetic tree, the optimal value for the middle branch is around  <dig>  substitutions per site. in addition, the plots show that starting from the baseline branch lengths, the power can be increased more significantly by increasing the length of the shorter branches, rather than increasing the length of the longer branches. this can be seen by noting the way in which the slopes change for all of the curves, where the first derivative decreases as the branch length increases.

influence of the tree topology
a common question concerning comparative genomics studies is how to choose the species. one factor to consider is the evolutionary distance, which we have just addressed. another factor is the topology representing the relationship of these species. by changing the topology and branch length of the baseline model to those in figure 5a, we performed simulations to compare the power of three classes of representative topologies under different branch length settings . for topologies with balanced branch lengths, all branches have the same length. for topologies with unbalanced branch lengths, all branches except the long branch have lengths equal to  <dig>  substitutions per site. the length of the long branch is set to match the total branch length. when the number of genomes under study was small , the roc curve for the symmetric star topology differed very little from the balanced depth-first binary tree. for larger numbers of comparative genomes, the symmetric star topology performed slightly worse than the balanced binary trees. no detectable power difference was observed between the two classes of balanced binary trees.

influence of the number of genomes
the number of species to choose is yet another important problem to consider in performing comparative genomics studies. based on conclusions from previous sections, we investigated this problem using a symmetric star topology and the common baseline settings, with the exception of the branch lengths . assuming each branch is as long as the distance between mouse and rat,  <dig> genomes are needed to achieve a sensitivity of  <dig>  at a specificity of  <dig> . adding  <dig> more genomes increases the sensitivity to  <dig>  at this same specificity. for shorter branch lengths , the number of genomes required to achieve a desired level of power scales inversely with the individual branch length. this scaling property of phylo-hmm is similar to that established for the individual alignment block model  <cit> .

effect of different substitution rate models
several parametric forms are available to model the nucleotide substitution process. simpler models are obviously easier to handle. for example, the analytical form of the roc curve is available for the jc model under certain conditions  <cit> . although models with more free parameters, such as hky and rev, appear more realistic, conducting a proper statistical inference for these models is difficult, and one can actually lose information or over-fit the data if an improper analysis is done. therefore, one question is whether we can use simpler models to capture the essential characteristics of the power for the more complex models. we performed two experiments to investigate this problem.

the first experiment involved comparing the power of various model types. to compare them on a common ground, we used the same parameter values as in the baseline, with the exception of the substitution rate matrix for each model type. for jc, we used the uniform background nucleotide probability. for hky, we set kappa =  <dig>  for simulated sequences from each model type, we used the corresponding true model type to infer the state sequence. we went through the simulation-prediction procedure  <dig> times to get the roc curve for each model type. the results are depicted in figure  <dig> and show that the simpler models  performed slightly better than the more complex models , which agrees with our intuition that simpler models are easier to solve. at the parameter values set by mimicking these  <dig> alignments, however, the observed differences are small.

the second experiment was aimed at characterizing the effects of simplifying the substitution model. the rev model has five free parameters, whereas the jc model has no free parameters. we simulated alignments from the rev model using the baseline parameters, and then inferred the state sequence under the simpler jc model. this perhaps represents a more realistic situation in which the substitution model in the analysis is a simplification of the "true" substitution model. figure  <dig> shows that the roc curve for using the true model type is located within the 95% bootstrap confidence interval of the roc curve for using the simplified jc model, which justifies the use of the simple jc model to study the properties of more complex models such as rev.

power comparison for different hmm parameters
evolutionarily conserved elements within different regions have different sizes and densities. for example, conserved elements in coding regions are much longer than those in promoter regions, and the coverage of conserved elements  in coding regions is higher than those in intergenic regions. also, conserved elements in promoter regions of genes rich in cis-regulatory modules may be longer than those for other genes. furthermore, promoter regions of different genes may have different coverage of conserved elements. binding sites for different transcription factors have different lengths as well. all of these variations are modeled by the hmm parameters μ and ν, or correspondingly, expected coverage  and expected element length  in the phylo-hmm method.

we simulated alignments by varying the expected coverage and length of conserved elements in order to understand their effect on the power of phylo-hmm . under the same expected coverage, a greater expected element length yields better roc curves with smaller variation. for example, for the same expected coverage p =  <dig> , to achieve a median specificity of  <dig> , the median sensitivity for expected element length l =  <dig>   <dig>   <dig>   <dig>   <dig> is  <dig> ,  <dig> ,  <dig> ,  <dig> , and  <dig> , respectively. the relationship between the median sensitivity and 1/l is approximately linear with a negative slope. the effect of the expected coverage for fixed expected element length is rather complicated because the corresponding roc curves cross over. for example, when the expected element length l =  <dig>  to achieve a low specificity like  <dig> , the sensitivity for expected coverage p =  <dig>  is higher than that for p =  <dig> . to achieve a high specificity like  <dig> , the sensitivity for expected coverage p =  <dig>  is lower than that for p =  <dig> . the variation of the roc curves for smaller expected coverage is greater than for bigger ones in the range we considered . the area under the roc curve of a larger expected coverage is greater than that of a smaller expected coverage. in this sense, a larger expected coverage of conserved elements makes them easier to detect.

power comparison for different conservation ratio
the conservation ratio , which is defined as the ratio of the average substitution rate of conserved sites over that of nonconserved sites, is one of the major factors determining the power of phylo-hmm. figure  <dig> shows the power we can expect for a given conservation ratio under other baseline settings. for fixed specificity, the relationship between sensitivity and the conservation ratio is approximately a sigmoid type function: 1/). the power decreases dramatically with increasing conservation ratio, especially when the conservation ratio is around  <dig> . this poses a problem for the two-state phylo-hmm model, which assumes a uniform conservation ratio along a given alignment. a promoter region could be bound by several types of transcription factors, and each of these could have a different conservation ratio compared to the nonconserved background. in this case, the power evaluation from a uniform conservation ratio is questionable. this problem can be alleviated by introducing multiple rate classes to form a multiple-state phylo-hmm.

ability to recover the true alignment and its influence on the power
all simulations discussed so far have been based on the assumption that we can get the true alignment. therefore, the usefulness of the above results is questionable in more realistic situations where the true alignment is unknown. we again used simulation to check what alignment accuracy we could achieve under different phylo-hmm parameter settings. we simulated sequences that were  <dig> base pairs long by varying one or a subset of phylo-hmm parameters around their baseline values. we then used mlagan  <cit>  to align the simulated sequences, assuming that we knew the topology of the true evolutionary tree. real alignment problems are plagued by many different types of noise in the input sequences , which inevitably decreases the alignment accuracy. in order to evaluate the alignment accuracy determined by phylo-hmm parameters, we directly fed the sequences simulated based on the phylo-hmm to mlagan without adding additional insertions or deletions. the alignment accuracy was measured by the column score  <cit> , which is defined as the number of identical columns between the true alignment and the recovered alignment. we further divided the number of identical columns by  <dig> to normalize the column score to the  <cit>  interval.

we evaluated the alignment accuracy for all situations reported in the previous sections. the column score was higher than  <dig>  for the baseline case and in all cases where the topology, substitution rate model, hmm parameters, and the conservation ratio were varied. figure  <dig> shows the influence of branch length and the number of genomes. for the baseline phylogenetic tree, the column score decreases below  <dig>  if any of the leaf branches is longer than  <dig> substitution per site or the middle branch is longer than  <dig>  substitutions per site. for the symmetric star-topology tree, if the number of genomes is  <dig>  the column score decreases below  <dig>  if the single branch length is longer than  <dig>  substitutions per site. as the number of genomes increases, the column score decreases below  <dig>  at shorter branch lengths, which implies it is harder to recover the true alignment if the number of genomes increases. all of these results suggest that no branch length should be longer than  <dig> substitution per site  in order to realize an accurate alignment. if no branch is too long, which holds around the baseline setting, the assumption that a highly accurate alignment is available is valid.

to further investigate the influence of alignment quality on power, we fitted phylo-hmm to both the true alignment and the recovered alignment. previously we defined sensitivity and specificity by comparing the true and predicted state sequences. since there is no unique true state sequence corresponding to the recovered alignment, we instead counted the number of nucleotides located within conserved sites. we call these nucleotides as conserved nucleotides. sensitivity is defined as the proportion of true conserved nucleotides correctly predicted. specificity is defined as the proportion of predicted conserved nucleotides that were truly conserved. for the true alignment, these definitions are equivalent to the previous version defined by conserved sites. figure  <dig> shows the performance of phylo-hmm on the true alignment and the recovered alignment when we varied the length of the middle branch in the baseline phylogenetic tree. when the column score is no less than  <dig> , the difference of the median sensitivity between the two scenarios is less than  <dig>  when the specificity is fixed at  <dig> . when the column score decreases to  <dig> , this difference increases to  <dig> , which is still quite small. this suggests that the power of phylo-hmm is robust to the alignment quality measured by column score. in the case of changing middle branch length in the baseline phylogenetic tree, the noise caused by bad alignment begins to pull down the power when the branch length grows to be greater than one substitution per site.

besides mlagan, we also evaluated the alignment accuracy using tba  <cit>  and mavid  <cit> , which have been used for the recently published encode consortium alignments  <cit> . details are shown in additional file  <dig>  among these three aligners, tba is essentially a local alignment algorithm, which avoids incorporating distant sequences into the output alignment. mavid produces global alignments by assuming that all sites in the alignment evolve at the same speed. mlagan produces global alignments for sequences containing conserved blocks, which is the exact scenario we are dealing with. the alignment accuracies are similar for the results of the three aligners when the branch lengths are short . these results agree with those reported by kumar and filipski  <cit> . nevertheless, the power of phylo-hmm is still quite robust with respect to the alignment quality.

CONCLUSIONS
we used simulations to investigate the statistical power of phylo-hmm under a number of diverse situations. among all factors studied, the number of species-specific genomes used, evolutionary distance, conservation ratio, and expected length of the conserved element are the major factors affecting the power of phylo-hmm. if conditions allow, it is better to select species such that every branch length in the phylogenetic tree is between  <dig>  to  <dig> substitutions per site. to achieve a desired power, the number of genomes required in the analysis scales inversely with the mean branch length if the mean branch length is small. the conservation ratio and the expected length of the conserved element are uncontrollable factors. for a fixed specificity, the relationship between the median sensitivity and one over the expected length of the conserved element is approximately linear with a negative slope. we also found that the influence of the topology and the nucleotide substitution model were relatively minor. this justifies selecting species with a simpler topology, like the symmetric star topology, and approximating complex substitution models with less complex, easier to manipulate ones, like the jc model.

our analyses of the power of phylo-hmm models were carried out under a number of simplifying assumptions that may influence the results reported and the degree to which they will reflect what can be expected from real data. first, for the simulations carried out to evaluate power, we assumed that all sequences were generated from the phylo-hmm model and that we could get the true ungapped alignment. in reality, it may be difficult to locate the orthologous sequences. even if we can get the orthologous alignment, gaps are inevitable and it is perhaps inappropriate to treat them as missing data. second, the real nucleotide substitution process may be more complicated than the models we studied here. for example, content dependent substitution is possible. finally, the assumption of two evolutionary rates, one for functional elements and the other for neutral background, is also unrealistic and may affect the power estimate we obtained. however, these issues notwithstanding, the general guidelines established by our analysis should still hold qualitatively.

several problems are worthy of further study. first, a goodness-of-fit test for phylo-hmm on real data remains to be validated. second, in the current phylo-hmm model, once the conservation state of a site is determined for the common ancestor, it is fixed for all species and is not allowed to change over the course of evolution. more flexible models that allow for differences among the conservation states are required for different species. third, the conservation annotation conducted by the current phylo-hmm model represents just one step toward the goal of functional annotation. a more ambitious approach would be to directly model the functional elements like transcription factor binding sites. an integrative approach to align the sequences by modeling evolution events and perform the conservation analysis at the same time is also desired. this may be feasible within the start topology jc framework.

authors' contributions
xf conceived and carried out the study. all authors participated in designing the study and preparing of the manuscript.

supplementary material
additional file 1
xfan_powerofphylohmm_manuscript_v12_supplement.doc. performance of three aligners . it gives detail results for the performance of three aligners.

click here for file

 acknowledgements
xf and jsl were supported by the nih grant r01-gm <dig>  all simulations were performed using the linux cluster at rosetta inpharmatics llc, a wholly owned subsidiary of merck & co. inc.
