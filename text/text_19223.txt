BACKGROUND
the increasing availability of high-throughput biological data sets promises a deeper understanding of cellular processes than has ever previously been accessible. many of these high-throughput experiments directly or indirectly measure metabolic changes within a cell, for example microarrays indirectly measure enzyme concentration and metabolomics experiments directly measure changing metabolite concentrations. the metabolism of any organism is a complex system with thousands of interacting entities, meaning that an integrated, network-based analysis is required in order to extract the maximum amount of knowledge from these data.

common methods for proteome and transcriptome analysis include go or kegg enrichment analysis using fisher’s exact test or gene set enrichment analysis . these approaches look for predefined pathways  that are enriched for genes with highly changed transcription , usually using a two-fold up- or down-regulation cutoff to define these highly changed genes. however, if biologically important pathways cross multiple predefined pathways  they might not be picked up by these approaches, which do not allow flexibility in pathway definitions.

other approaches have analysed such data using simple protein interaction graphs. ideker et al.  <cit>  have developed a method called active modules, which employs simulated annealing to search for connected components of a protein-protein interaction  network that are significantly changed according to some microarray dataset, thus giving an insight into how a coordinated response occurs in the ppi network without the need for such predefined pathways or gene-sets.

in order to find significantly changed pathways in metabolism, breitling et al.  <cit>  developed giga , an alternative to the active modules approach, which uses a greedy algorithm to build connected components of a gene-gene graph that are significantly enriched with genes having a low p-value for expression change. the chief innovation of giga as applied to metabolic network analysis is the ability to link genes by any given set of associations. in  <cit>  these associations are made through metabolites in kegg pathways, linking genes that encode enzymes sharing a particular metabolite as substrate or product. the gene-gene graph is then a representation of the metabolic network, within which giga finds connected components that are enriched for significant gene changes. such analyses, when applied in the metabolic context, can be thought of as pathway finding methods, uncovering linked modules  of genes or proteins that undergo coordinated change as a result of some environmental or genetic perturbation. these modules give a better view of the coordination specifically of metabolic changes and when accompanied by expert interpretation can reveal insights into system-level responses.

several other recent methods have been developed to take explicit advantage of the underlying metabolic network structure controlled by transcriptional changes in order to determine network-based gene neighbourhoods. pathexpress  <cit>  takes a set of genes of interest  as an input and for each enzyme finds whether there is enrichment of genes of interest around that enzyme. this ‘enzyme neighbourhood’ is defined through gene-reaction-metabolite relationships in kegg. however, these neighbourhoods are predefined by the metabolic network before analysis, rather than allowed to take any shape or size. kegg spider  <cit>  does a similar analysis, but is limited to those organisms covered by the kegg orthology database. both of these approaches have similar limitations: they discard information about fold-changes of the entire transcriptome by demanding a significance cutoff for each gene and they also limit the shape and size of inferred modules. recently schramm et al.  <cit>  developed a network-topology based approach to finding gene regulatory relationships in the context of metabolism, but this is currently applicable to a limited number of organisms and relies on kegg annotations of those organisms and kegg pathway maps.

whilst giga and active modules can both find arbitrary modules in simple gene-gene interaction graphs, there are several problems in using such graphs to represent metabolic networks. genes in these networks connect to all other genes associated with a particular metabolite, such that so-called currency metabolites  can link large swathes of metabolism to create large  subnetworks. currency metabolites can potentially falsely link unrelated parts of metabolism in pathway-building approaches and must therefore be accounted for. usually this is done by a priori manual removal of these metabolites  <cit>  or simply assigning a maximum connectivity, above which a metabolite will be discarded from the network  <cit> . however, both approaches require a somewhat arbitrary classification of compounds that may result in the loss of useful information. figure  <dig> shows the conceptual problems with these approaches. in the case where a highly connected metabolite is not a currency metabolite, important structural information about the network can be lost by ‘over-connection’ of the network . however, in the case where this metabolite is removed  the potential for a crossover between the pathways, even supported by experimental evidence, is eliminated.

genes encoding enzymes with the same function  can also be problematic: often the quantity of real interest for a particular reaction is the net change in flux or flux capacity for that reaction, thus multiple gene changes related to a single reaction should be accounted for together rather than as separate nodes in a graph representation of metabolism. in contrast, multi-function enzymes can potentially erroneously link two separate parts of metabolism and cause inferred modules to consist of otherwise disconnected pathways within the metabolic network.

the bipartite metabolite-reaction representation of metabolism solves all of these problems by representing both metabolites and reactions as nodes and mapping data onto these entities separately. figure 1a shows such a bipartite network . this representation allows the full relationship between reactions and metabolites to be used in the investigation of metabolic changes. no metabolites need be removed from the initial network because they can be individually assessed for inclusion in any pathway prediction . since reactions, rather than genes, are used for mapping data onto the network, isozymes and multifunctional enzymes can be amalgamated and separated respectively according to actual enzymatic function , eliminating the problems of gene-centric metabolic network representations.

the analysis of such a network representation requires that there is information mapping genes to reactions. until recently this would have limited the use of this approach to organisms with published manually curated metabolic models  and organisms that are present in such metabolic network databases as kegg  <cit>  and biocyc  <cit> , many of which are not subject to any curation. however, henry et al.  <cit>  have implemented a system to automatically reconstruct a draft-quality metabolic model for any prokaryotic organism with a complete genome sequence, thus enabling bipartite metabolic networks with gene-reaction mappings to be produced for any of these organisms.

in this paper we introduce ambient, a new method for high-throughput data analysis in the context of metabolic models. ambient is an extension of the active modules approach such that it accommodates bipartite  networks, allowing coordinated metabolic pathway changes to be discovered from transcriptomic or metabolomic data. simulated annealing is used to find modules  containing reactions associated with genes that are highly changed in expression and metabolites that have low overall connectivity .

ambient has several advantages over previous approaches to the discovery of metabolic modules. the bipartite representation of metabolism offers a systematic objective representation of metabolism which enables unbiased pathway finding. it also treats all metabolites equivalently, so information about the metabolic network is not lost through arbitrary decisions about which metabolites should be considered currency metabolites. in this paper we compare ambient to giga  <cit>  to show how it complements and improves on existing approaches to metabolic module finding in high-throughput data analyses.

methods
the algorithm implemented in ambient is based on the active modules approach of ideker et al.  <cit> , extended to a bipartite network. the largest modification of the approach apart from the changed network representation is to toggle edge membership rather than node membership in candidate subnetworks, as described below. a python implementation of ambient is provided at http://www.theosysbio.bio.ic.ac.uk/ambient.

input data and outputs
ambient requires as input a metabolic model and scores for those reactions for which data is available. by default, metabolite scores are calculated using their degree in the metabolic network  so their scores need not be specified by the user. for models with gene-protein-reaction  relationships, scores for genes can be provided, which are converted into scores for reactions. the metabolic model is represented by an undirected bipartite network, where an edge links a reaction node with a metabolite node when the metabolite is either a substrate or product of that reaction. scores for reactions for which there are no data are by default set as the median score of the set of known reaction scores.

the python implementation of ambient outputs three files: a ‘.tsv’ flatfile results table of all nodes from each significant module, a graphml file for results visualisation and a ‘.dat’ file in the python shelve format containing all input and output variables.

scoring nodes
reaction nodes must each be assigned a score, according to the data being analysed. although in principle this can be based on any dataset, in this work we have investigated the use of ambient with microarray data, so reactions have been scored according to the transcriptomic data for the enzymatic genes known to be involved in the catalysis of those reactions. the scores of each reaction have been assigned in the following way: where a reaction is linked to a single gene in its gpr the reaction is given the value of the fold-change of that gene’s transcript.

where a reaction is catalysed by a single enzyme made up of multiple different gene products the mean of the fold-changes of those genes is assigned to the reaction. in this way error propagation from individual gene transcript measurements is reduced. without any knowledge of relative activities of enzymes for each reaction, if a reaction is catalysed by multiple enzymes the mean of the inferred enzyme fold-changes is used. this takes into account all of the enzyme level changes affecting single reactions in a single fold-change score.

scoring modules
a module m is defined as the union of a subset rm of reactions and a subset cm of metabolites that subtend a connected subgraph within the bipartite metabolic graph. the score s of a module is given by 

 s=ln∑is-α∑jw, 

 where q = |rm| + |cm| is the number of nodes in the module m, s is the score of the ith reaction in the module, w is the weight  of the jth metabolite in the module and α is a constant given by 

 α=|c|∑is|r+|∑jw, 

 wherer+⊆r:s>0∀ri+∈r+. 

α is defined here as the mean score of all reactions for which s >  <dig>  divided by the mean value of w over the complete network. this formula for α is chosen to ensure that modules are not needlessly restricted by metabolite weights, but do not extend to cover large, biologically meaningless regions of the network. this algorithm tracks all module scores, the logarithmic term being added to bias exploration towards larger modules, without generating extremely large, biologically meaningless modules.

as in the original active modules algorithm, the aim is to find the set of non-overlapping modules with the highest total score. finding global maximum scoring modules is np-hard  <cit> , so a simulated annealing approach is taken. in order to search the space of all modules efficiently, a random set of edges  is toggled at each step of the simulated annealing.

in many cases, modules describing downregulated regions of the network are of as much interest as upregulated regions. these modules can be investigated by multiplying reaction scores by - <dig>  which gives the most reduced reaction the highest score, and leaving the metabolite scores negative. with this transformation, downregulated modules can be found using the same algorithm as upregulated ones.

ambient algorithm
the algorithm for finding high scoring modules is outlined here : 

 <dig>  set t = tinit, t = tinit,

 <dig>  select a random set of edges, e, of size t, as the initial edge set,

 <dig>  calculate the score σ=∑ks, where me is the set of connected components induced by e,

 <dig>  select t edges at random to form the toggle set, f,

 <dig>  propose a new edge set, p = e ∪ f - e ∩ f,

 <dig>  calculate σ=∑ks,

 <dig>  if ρ<eσ-σt, where ρ is a random number drawn from [ <dig> ), accept the proposed move and set e = p,

 <dig>  repeat steps  <dig> to  <dig> until the temperature reduction criterion  is met,

 <dig>  set t =  <dig> t and t =  <dig> t, 

 <dig>  if the maximum number of annealing steps is reached then end, otherwise go to step  <dig> 

here, t is the number of edges to toggle during any one toggle step and t is the effective temperature for annealing, determining the tolerance for accepting negatively scoring steps. tinit and tinit are determined from the number of nodes and node scores respectively, as described in the additional file  <dig>  the temperature reduction criterion is based on adaptive simulated annealing, giving a highly efficient cooling schedule. for any particular temperature, annealing steps are taken until the system reaches thermal equilibrium  and this represents the temperature reduction criterion. if this is met, or a cutoff number of steps is reached  then the algorithm moves to step  <dig> 

determining module statistical significance
the significance values of modules found by ambient are found empirically because the distribution of module scores for different sized modules is not known a priori. for each module, the number of reactions and metabolites contained in that module are determined. a random sample of scores for that number of reactions and metabolites is summed to produce a random score for a module of that size. this is repeated p times  and the empirical p-value is equal to the number of scores in this sample greater than the module score from annealing divided by p. this is determined for the top m modules. these m p-values are corrected for multiple testing using the benjamini-hochberg correction.

module visualization
all network diagrams were created using cytoscape v <dig> . <dig>  <cit> .

RESULTS
case study: diauxic shift in saccharomyces cerevisiae
the data used to validate the ambient tool were taken from an experiment by derisi et al.  <cit> , investigating the transcriptional response of s. cerevisiae to glucose depletion. the gene scores used were the log fold-changes between the  <dig> hour timepoint  and  <dig>  hour timepoint  of that experiment. the yeastnet yeast model  <cit>  was taken as the basis metabolic network. this network is available in sbml format so could be used directly by ambient, and was also converted into a simple protein interaction network with edges induced by shared metabolites for input to giga  <cit> .

overall the derisi dataset covers  <dig> genes, of which  <dig> are present in the yeastnet model, which through the gene-reaction relationships in that model provide scores for  <dig> of the  <dig> reactions in the model. since the overall change in metabolism was being investigated, those reactions for which there were no data were assigned the median score of the reactions with known scores. due to the formulation of the method, ambient modules may include reactions for which there is no data, as long as the scores from the surrounding reactions support such an inclusion.

ambient was run with all parameters set as default except the maximum number of annealing steps n, which was set to  <dig> , <dig>  giga was run with all parameters at default values, ignoring metabolites with degree greater than  <dig>  and restricting the number of genes per module to  <dig>  since giga does not make predictions about which metabolites are in particular modules, a simple rule was followed: where any non-currency metabolite was connected to more than one reaction in a giga module, it was included in that module. the analysis was run twice for each method, to find both up- and down-regulated modules; of particular interest was whether the main result of  <cit> , of the rerouting of carbon in the glycolysis/gluconeogenesis  pathway and the tca cycle, were recapitulated with this metabolic model.

summary statistics comparing the giga and ambient approaches to analysing the diauxic shift of saccharomyces cerevisiae on glucose starvation.

the yeast model used is compartmentalised, so mitochondrial and cytosolic reactions and metabolites are separated. both giga and ambient recapitulate the main conclusions of previous analyses  <cit> , namely that the most significantly affected parts of metabolism are the tca cycle and associated respiratory chain complexes. they also both capture the tca cycle in the mitochondrial compartment, as expected in yeast.

each of the three parts of the central carbon metabolism show up in different modules in the ambient analysis. detailed results for these pathways can be found in table  <dig> which shows inferences for ambient, giga and from expert manual inspection  <cit> . this table shows the extent to which each computational method recapitulates the manually observed carbon rerouting through central metabolism in the diauxic shift induced in s. cerevisiae. to assess the similarity between the two computational approaches and the derisi analysis, the recall, precision and f-measure were calculated, with the results as shown in table  <dig>  these data indicate that ambient agrees somewhat better with expert interpretation of data for both the gly/gng top pathway and the tca cycle results. whilst recall is much better for the tca connection pathway, ambient has a very poor precision. this reduced precision is because the down-regulated pathway found by ambient is very large, reflecting the general downshift in metabolism rather than just the most highly repressed enzymes. as seen in additional file 2: figures s <dig> and s <dig>  each of the giga modules is separated into unconnected modules from the conversion between the simple gene-gene evidence graph used in the analysis to the bipartite metabolite-reaction representation. this is due to genes being involved in more than one reaction, where metabolites do not necessarily overlap between these reactions.

a list of genes in central carbon metabolism that are involved in the regulated response to diauxic shift  and the reactions for which they encode enzymes, along with their inferred transcriptional changes . id represents id of the relevant reaction node in the ambient network. the final three columns represent which genes and reactions are up- or down-regulated according to ambient, giga and  <cit>  . the ambient and giga columns indicate which modules the reactions are in and the the identified reactions column shows those curated manually. ‘diff.’ stands for ‘differentially’.

values of recall, precision and f-measure for the comparison between the two computational inference methods for metabolic modules and the expert curation of derisi et al.  <cit> . the modules containing the relevant parts of metabolism for each computational method are indicated on the table, where ‘u’ and ‘d’ represent up- and down-regulated modules and the number corresponds to the numbers of the modules found in order of significance by the two methods. diagrams for these can be found in the additional file  <dig> except ambient u <dig>  which can be seen in figure  <dig> 

additional insights from ambient
in addition to finding the important parts of metabolism discovered by previous methods, ambient finds several linked but previously undiscovered pathways which add to our appreciation of the full metabolic response of s. cerevisiae to glucose depletion and diauxic shift. it is clear from the upregulated modules  that ambient finds the important changes in the tca cycle and respiratory chain complexes discovered previously by giga. additional file 2: figures s1- <dig> show the parts of metabolism identified by ambient that connect to and between the giga modules found and the overlap between ambient and giga pathways. there are several pathways picked out by ambient that show some expression change and link between the metabolic pathways that have already been identified by others  <cit>  to change on diauxic shift in yeast. this indicates a larger scale coherent metabolic response than has previously been recognised.

ambient identifies a further pathway linking mitochondrial oxaloacetate to succinate  which forms part of the 2-methylcitrate cycle, converting propionate to pyruvate. additional file 2: figure s1a shows that in addition to the glycogen metabolic pathways, galactose metabolic pathways are also activated. s-adenosyl-l-methionine is important for dna methylation and although s. cerevisiae has little methylation in its regulation, figure  <dig> shows that metabolism around this chemical is activated on diauxic shift . malate and oxaloacetate metabolism also show a coordinated increase . overall, these results show that there is a considerable response to glucose starvation in yeast, and ambient has found modules that extend beyond the boundaries of conventionally accepted pathways.

differences between ambient and giga
it can be seen that there is a large overlap between the results of the two algorithms compared here, however the ambient algorithm has found some additional changed reactions that appear to be part of the coordinated response of s. cerevisiae to glucose starvation. giga identifies some reactions that are not in significant ambient modules. in the upregulated results it finds many transport reactions, though these are mostly disconnected from the rest of the giga modules, so do not appear to be parts of coordinated pathways at the transcriptomic level. the cytosolic pentose phosphate pathway is identified by giga  as being up-regulated, which indicates a potential limitation of ambient’s pathfinding ability, though being a small part of a larger metabolically disconnected module the significance of the transcriptional change of that part by itself is not known. this is also true of the top down-regulated module identified by giga  which contains several small pathways absent from ambient, but for which there are not individual significance values.

the use of metabolite information is important in metabolic network analysis. highly connected metabolites have limited utility for constructing modules of coordinated responses to metabolic and environmental perturbations because they carry little information about the flow of material through the metabolic network. it can therefore be asserted that for the purposes of pathfinding, links in metabolic modules through more highly connected metabolites are less significant than those through metabolites connected to fewer reactions. giga deals with this problem by excluding a predefined set of currency metabolites, whilst in ambient the relative weights in the metabolic network are taken explicitly into account. in the analysis presented here, the two approaches appear to be somewhat equivalent, as the highest degree metabolite node in the ambient results has a degree of  <dig> 

the advantage of mapping gene scores onto reactions and finding reaction-metabolite modules rather than protein-protein modules is apparent when looking at the relationship between reactions and genes. approximately half of all genes in the yeast model are associated with more than one reaction, and some are associated with many reactions. for instance, gene ykr009c  which is present in giga module  <dig> encodes a multifunctional enzyme associated with  <dig> reactions in the yeast model. using giga  will fail to distinguish between potentially very different reactions catalysed by such multifunctional proteins and will infer either all or none of them as parts of a metabolic module. this approach will therefore always lack the specificity inherent in the reaction-metabolite bipartite network representation of metabolism and results in unconnected ‘modules’, as seen in additional file 2: figures s3- <dig>  a number of the reactions associated with ykr009c are in modules returned by the ambient analysis, but none of these modules are statistically significant.

another important advance in ambient over previous approaches to module-finding is that it encourages larger modules to form which might otherwise be hidden due to individual interconnecting low-scoring  nodes or due to missing experimental data. this advantage, inherited from the simulated annealing approach, means that a fuller picture of how metabolic responses are coordinated can appear from the same data used in previous approaches, as can be seen in the good coverage of previously known and newly discovered affected parts of metabolism shown in figure  <dig> 

against these advantages, it should be noted that the giga approach is much faster than ambient in this case study, taking approximately  <dig> seconds on a  <dig>  ghz chip, as opposed to ambient’s two hours.

consistency between ambient runs
since ambient is not a deterministic algorithm, it arrives at slightly different solutions each time it is run. ambient was run ten times with the settings and data described above and the the consistency of the results was assessed. each run produces what is in effect a partition of the set of all nodes, with each partition being a significant module, except the largest partition which consists of all nodes not in significant modules. the adjusted rand index  <cit>  was used to quantify the similarity of results. the ten runs compared with each other produced an adjusted rand value of  <dig> ± <dig> , indicating highly consistent results between runs, despite the stochastic nature of the algorithm.

limits to the discovery potential of ambient
while ambient is very effective for elucidating metabolic changes from transcriptomic datasets it does have several limitations that should be borne in mind. firstly it does not in any way take into account regulation except in as much as the regulation is apparent in the changes of transcription levels of genes encoding enzymes. secondly, as with all other current methods for mapping transcription onto metabolic networks, if genes with enzymatic products are not mapped onto the metabolic network then information about their changes cannot be used to investigate the changes in metabolism. due to this inability, ambient does not extract all of the information possible from transcriptomic data, but just the information from genes with known functions. the elucidation of metabolic functions for uncharacterised genes would therefore require a different approach.

the best way to interpret transcriptomic changes in terms of their effect on reaction rates is an open question. with the approach to reaction scoring presented here, mismapping between mrnas  and reactions could impact on the effectiveness of ambient. also the best way in which transcript values are combined for each reaction is not known. if some knowledge of the relative activity of various enzymes for each reaction were integrated into this approach a more refined way of combining enzyme inferred changes could be used to score each reaction. despite these potential limitations ambient has recapitulated the results produced by a very different computational approach and by expert curation of the same data used here, so some confidence can be drawn concerning the scoring system presented here.

potential applications and future developments
ambient has been applied here to transcriptional data looking at yeast diauxic shift. this approach is of course applicable to any dataset containing two  microarray measurements in differing conditions. however, due to the information now available in many metabolic models, and the use of a bipartite representation of metabolism, any information that can be mapped to genes, enzymes, reactions or metabolites can be included in an ambient analysis. the explicit links available between genes, proteins and reactions means that transcriptomic , proteomic or fluxomic data could be mapped onto the metabolic network under study. furthermore, metabolites were scored here purely by weight in the metabolic network, but if metabolomic information were available this could easily be incorporated into the scoring system.

in order to look at the overall changes in yeast diauxic shift, the scores for reactions were left as mean log fold-changes of gene transcription. in order to further dissect any transcriptomic dataset, it would be possible to set the median reaction score to zero, therefore just search for especially up- and down-regulated pathways.

future developments will include methods for combining several different datasets into a single module-finding problem. since the metabolic models used for this analysis can also be used in flux balance analysis , methods to combine computational flux estimates obtained from fba with experimental data will be of particular interest in order to extend and refine our understanding of metabolic network function.

CONCLUSIONS
in this paper we have presented ambient, a method for finding metabolic modules that represent coordinated metabolic differences between two environments or conditions. using simulated annealing, ambient can go beyond previous approaches to the system level analysis of metabolic changes, as demonstrated here using transcriptomic data from a yeast glucose runout experiment. the bipartite representation of metabolism allows a much greater specificity of analysis and can incorporate information about metabolites, giving an objective view of the changes in cells during the diauxic shift.

this approach has the potential to integrate many different types of high-throughput data obtained in a single experiment. it is hoped that ambient will enable the analysis of disparate data that would otherwise be difficult to integrate, thus improving the biological understanding accessible using high-throughput experimental techniques.

competing interests
the authors declare that they have no competing interests.

authors’ contributions
jp and ms conceived the project, wb and jp developed the tool and wb wrote the manuscript. all authors read and approved the final manuscript.

supplementary material
additional file 1
supplementary methods. further details on the ambient algorithm and scoring system.

click here for file

 additional file 2
supplementary figures. figures s1-s4: diagrams of the positive and negative modules found by both ambient and giga.

click here for file

 acknowledgements
this work was supported by the bbsrc, grant bb/g020434/ <dig>  jp is supported by a university research fellowship from the royal society.
