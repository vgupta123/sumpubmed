BACKGROUND
a species phylogeny is a graphical model of the common evolutionary history of a group of species, and is most often represented as a phylogenetic tree or phylogenetic network  <cit> . a species phylogeny gives valuable information about protein functions  <cit> , host-parasite relationships  <cit> , etc.

however, species tree estimation is difficult, due to multiple biological processes, including recombination  <cit> , duplication and loss  <cit> , hybridization  <cit> , incomplete lineage sorting   <cit> , and horizontal gene transfer   <cit> , that can cause a given genomic locus to have a tree that is different from the species tree. as a result, multiple loci are needed to estimate a species phylogeny with high accuracy.

of the many sources of gene tree discord, the one that has received the greatest attention is ils, which is modeled by the multi-species coalescent  model  <cit> . an msc model tree has a rooted tree t , leaf-labelled by a set of species, and is given with branch lengths in coalescent units. gene trees evolve within the species tree, in a backwards process described by the msc; thus, lineages "coalesce" on the branches of the tree, as they move from the leaves of the species tree towards the root. when two lineages fail to coalesce on the earliest branch in which they can coalesce, this can result in a gene tree having a different topology than the species tree.

under the msc model, each species tree defines a probability distribution on gene trees, and the species tree can be identified uniquely from this distribution. hence, one type of technique  for estimating species trees under the msc operates by first estimating gene trees for a set of different loci, and then uses this estimated distribution on gene trees to estimate the species tree. a summary method is said to be statistically consistent under the msc model if, as the number of loci and sites per locus go to infinity, the estimated species tree returned by the method will converge in probability to the true species tree  <cit> . many statistically consistent summary methods have been developed for estimating species trees when gene discordance is due to ils  <cit> .

despite advances in developing statistically consistent methods for species tree estimation that are robust to ils, by far the most common technique for estimating a species tree is concatenation analysis, in which the sequence alignments for the different loci are combined into one large supermatrix, and then a phylogeny is estimated on the alignment using maximum likelihood  <cit> . this type of approach, however, is sometimes not statistically consistent under the multi-species coalescent model  <cit>  in the presence of ils. hence, even though concatenation often has good accuracy   <cit> , a large effort has been made to develop alternative methods that are provably robust to ils and have good accuracy on realistic conditions.

for very small datasets, bayesian methods such as best  <cit> , *beast  <cit>  or bucky-pop  <cit>   can provide excellent accuracy; however, these methods are too computationally intensive to use on even moderate sized datasets with hundreds to thousands of loci and  <dig> or more species  <cit> .

of the currently available coalescent-based methods, astral- <dig>  <cit> , mp-est  <cit> , and njst  <cit>  have emerged as the most accurate of the methods that can run on datasets with  <dig> or more species and hundreds to thousands of loci. however, the comparison among these methods shows that mp-est is typically not as accurate as njst and astral- <dig> and is also much slower than both  <cit> . some newer statistically consistent methods have also been developed , but have not yet been sufficiently evaluated in terms of their accuracy and scalability in comparison to other coalescent-based methods.

some of the most commonly used coalescent-based methods estimate species trees by encoding each gene tree as a set of quartet trees , and then estimate the species tree from the quartet tree frequencies. the mathematical basis of this approach is the following theorem, originally proved in  <cit> :

theorem  <dig> under the multi-species coalescent model, for every model species tree   and for every set x of four leaves from t, the most probable unrooted gene tree topology on x is identical to the species tree t restricted to the leafset x.

interestingly, nearly the same theorem was proven under two phylogenomic models that addressed horizontal gene transfer ! when hgt is present, the evolutionary history of the species is not really treelike, but rather requires a phylogenetic network  <cit> . under hgt models, a phylogenetic network consists of an underlying species tree t with horizontal gene transfer edges  between branches in the tree, and each locus evolves down a tree  within this network. hence, while the species evolution is not purely treelike, the gene tree evolution is treelike. furthermore, for this type of reticulate phylogeny, it is reasonable to ask whether the underlying species tree t can be reconstructed from gene trees estimated on the different loci.

this question has been partially answered for two models of hgt. the first models hgt events between lineages using a continuous-time poisson process  <cit> , and is called the stochastic hgt model. in a stochastic hgt model, the hgt events happen between contemporaneous lineages, either uniformly at random or with probability that depends on the distance between the lineages . the second type of model assumes that there are hgt edges between specific pairs of branches in a species tree, commonly referred to as highways, along which hgt events are far more likely to occur than elsewhere in the tree; this is called the highways hgt model  <cit> .

the theoretical framework for estimating the underlying species tree under these two hgt models was established in  <cit>   and in  <cit>  . specifically,  <cit>  proved theorems that under both the stochastic hgt model and highways model, but with bounded amounts of hgt per gene, the most probable quartet tree would be topologically identical to the species tree. note that these theorems are the equivalents of theorem  <dig> under the two bounded hgt models.

some species tree estimation methods operate by computing gene trees, encoding each computed gene tree as a set of quartet trees, and determining the dominant quartet tree for every four species . then, these dominant quartet trees are combined using a quartet amalgamation method . this type of species tree estimation method can be statistically consistent under the msc model, and also under these bounded hgt models - depending on the quartet amalgamation method, as we now show.

theorem  <dig> let m be a summary method . suppose that m has the property that it is guaranteed to return the unique tree compatible with the dominant quartet trees defined by its input set of gene trees, whenever the dominant quartet trees are compatible. then m is statistically consistent under the msc model, and also under the bounded hgt models given in  <cit> .

proof to establish statistical consistency, we only need to prove that as the number of sites per locus and the number of loci both increase, the tree returned by the method converges in probability to the species tree. as the number of sites per locus and the number of loci both increase, the dominant quartet tree converges to the most probable quartet tree on every set x of four species. under the msc model and also under the bounded hgt models in  <cit> , the most probable quartet tree on any set x is topologically identical to the species tree. hence, for a large enough number of loci and large enough number of sites per locus, with probability converging to  <dig>  the input to the quartet-based methods will be a set of gene trees such that the dominant quartet trees are all compatible with the species tree. furthermore, the species tree will be the unique such compatibility tree, and so the method will return the true species tree.

similarly, we can prove the following:

theorem  <dig> astral and astral- <dig> are statistically consistent under the bounded hgt models of  <cit> .

this proof uses theorem  <dig>  but is essentially identical to the proofs of statistical consistency for astral and astral- <dig> under the msc model  <cit> ; see methods for the proof of this theorem.

very little is known about the theoretical guarantees of any species tree estimation methods under models in which both hgt and ils can occur. in fact, to the best of our knowledge, no methods have yet been proven statistically consistent under these conditions. we also do not know much about the empirical performance of any species tree estimation methods under these conditions. as far as we know, the only simulation study to date of the impact of both ils and hgt on the performance of species tree estimation methods is  <cit> , which explored the performance of two coalescent-based methods, bucky and best, on data that evolved under both processes. however, both of these methods are computationally intensive, and cannot run on even moderately large datasets   <cit> .

we report on a study evaluating the accuracy of astral- <dig>  njst, and weighted quartets max cut   <cit> , as well as unpartitioned maximum likelihood concatenation analysis , on simulated datasets in which gene tree discord is due to both hgt and ils. the simulation protocol evolved gene trees down 50-taxon species trees under the msc model with a moderately high level of ils, and allowed gene trees to then evolve with six different hgt rates . hgt rate  has no hgt events, and hgt rates - have  <dig> ,  <dig> ,  <dig> ,  <dig> , and expected hgt events per gene, respectively. finally, sequences evolved down each gene tree under the gtr+gamma model.

we estimated gene trees on each locus using the fasttree- <dig> maximum likelihood software  <cit> , and then used the summary methods on these estimated gene trees to estimate the species tree. we also concatenated the sequence alignments and ran unpartitioned fasttree- <dig> maximum likelihood on the concatenated super-alignment. finally, we analyzed a cyanobacteria dataset with  <dig> species and  <dig> genes  <cit> , which is believed to have evolved under high levels of hgt and has been used to evaluate methods for inferring species trees in the presence of hgt  <cit> . see methods for additional details.

RESULTS
we ran  <dig> experiments using astral- <dig>  njst, wqmc, and an unpartitioned concatenated maximum likelihood analysis  using fasttree- <dig> on 51-taxon datasets that evolved under a moderate amount of ils but with varying rates of hgt under the stochastic hgt model. in our analyses, all methods produced binary trees; hence, we report the normalized bipartition distance  between estimated species trees and true species trees. we report results for both true and estimated gene trees, with  <dig> to  <dig> genes. to evaluate the relationship between topological accuracy and performance with respect to the optimization problem that astral- <dig> and wqmc attempt to solve, we compared the quartet support scores and topological accuracy of trees computed by astral- <dig> and wqmc.

results on estimated gene trees
for datasets with  <dig> genes , all the methods are very similar when there is no hgt ), with error rates varying from  <dig> %  to  <dig> % . error rates increase with increasing hgt rates, but the increases are generally small until hgt rate , where all methods have error between  <dig> %  and  <dig> % . furthermore, the differences between methods remain small  through hgt rate . however, there are substantial differences between methods under the two highest hgt rates  and , with ca-ml having the highest error  and astral- <dig> having the least error . while the differences between wqmc and njst were often small, typically wqmc was more accurate than njst.

the same trends hold on datasets with larger numbers of genes ; in particular, astral- <dig> remains typically the most accurate method  and ca-ml is typically the least accurate. however, as the number of genes increase, the species tree estimation error drops for all methods, and the differences between methods become even smaller. for example, on  <dig> genes the maximum error for hgt rates - is  <dig> %  and the smallest error is  <dig> % . by  <dig> genes, the maximum error of all methods on hgt rates -) is  <dig> %  and the smallest is  <dig> % . with  <dig> genes, the maximum error on hgt rates - is only  <dig> %  and the lowest is  <dig> % . however, under the two higher hgt rates  and ), the differences between methods can be noteworthy, even with large numbers of genes. more importantly, under these higher hgt rates, ca-ml is substantially less accurate than all of the summary methods. as an example, under hgt rate , ca-ml has  <dig> % error on  <dig> genes, while astral- <dig> has  <dig> % error. one interesting trend that is hard to explain is that error rates do not always increase with increases in hgt rates; for example, results on  <dig> estimated trees show some small decrease in error for astral- <dig> and njst between hgt rates  and . finally, while astral- <dig> is the most accurate of the summary methods, the difference between astral- <dig> and the other summary methods is small . indeed, the differences between the summary methods given  <dig> or more genes are very small - at most  <dig> %.

results on true gene trees
we show results on true gene trees in figures  <dig> and  <dig>  unsurprisingly, error rates of species trees estimated on true gene trees are lower than those estimated on estimated gene trees; while the reduction depended on the model condition, for the astral- <dig> datasets with  <dig> genes and hgt rate , we see a reduction of more than 50%. differences between methods were reduced on the true gene trees, but otherwise, all the trends are the same as for estimated gene trees.

comparing quartet scores of trees produced by astral- <dig> and wqmc
while the differences between astral- <dig> and wqmc are often small, astral- <dig> nearly always matches or improves on wqmc with respect to tree topology. both astral- <dig> and wqmc attempt to solve the maximum quartet support species tree problem , but use very different techniques. in particular, astral- <dig> constrains the search space based on the input gene trees, and then finds an optimal solution within that constrained space, but wqmc uses a greedy heuristic and does not constrain the search. one hypothesis for the improved topological accuracy of astral- <dig> compared to wqmc is that astral- <dig> finds better solutions to the mqsst optimization problem, and a competing hypothesis is that the higher topological accuracy achieved by astral- <dig> is due in part to the constraint it imposes on the solution space.

we examined the quartet scores for wqmc and astral- <dig> across the different model conditions. for  <dig> % of all cases involving estimated gene trees, the species trees returned by the two methods had the same quartet support. astral- <dig> returned a tree with a better quartet score than wqmc  <dig> % of the time while wqmc returned a tree with a better quartet score  <dig> % of the time. thus, in general astral- <dig> does a better job than wqmc of finding good solutions to mqsst. however, there are cases in which wqmc produces trees with better scores, and the cases are typically cases with high hgt levels , and more than half of the cases occurred for hgt rate ).

we investigated the  <dig> replicates for which wqmc has a better quartet support score, and therefore does a better job of solving the mqsst problem . astral- <dig> and wqmc had the same topological accuracy on  <dig> datasets, astral- <dig> was more topologically accurate on  <dig>  and wqmc was more topologically accurate on  <dig>  thus, even for those cases where wqmc finds trees with better quartet support scores, astral- <dig> tends to match wqmc with respect to accuracy, or produce topologically more accurate trees. since wqmc does not constrain the search space, this means that wqmc can find trees with better quartet scores but which are outside the constrained search space, and that constraining the search space seems to be beneficial with respect to topological accuracy. in other words, although astral- <dig> generally is a better heuristic for the mqsst problem, part of the reason it is more topologically accurate is due to the constraint it imposes on the search space.

cyanobacterial data
we analyzed a cyanobacterial data set from  <cit>  using astral- <dig> with multi-locus bootstrapping  to estimate a species tree. two estimated species trees were reported in  <cit> : one is the "plurality tree", which has served as the reference tree for this dataset. the plurality tree is a supertree  on a set of quartet trees represented in a plurality of the gene trees that have high support. the other tree is a phyml  <cit>  maximum likelihood tree. the astral- <dig> majority consensus tree  has 100% bootstrap support on all its branches, and is identical to the plurality tree that has served as the reference tree for this dataset. the wqmc tree was previously reported for this dataset in  <cit> , and is also topologically identical to the plurality tree.

discussion
while all methods had very good accuracy on the simulated datasets under the lowest hgt rates, they were clearly differentiated on the higher hgt rates, especially when the number of genes was not too large. specifically, on the higher hgt rates, concatenation using maximum likelihood and njst were both less accurate than astral- <dig> and wqmc. however, all summary methods we explored were impacted by gene tree estimation error. furthermore, there are no proofs of convergence to the true species tree if the gene trees have estimation error for these or other standard summary methods  <cit> . since many of the lower hgt model conditions had substantial gene tree heterogeneity resulting from ils, this study shows that many methods - and even unpartitioned concatenation using maximum likelihood can be highly accurate under these highly heterogeneous model conditions.

results on the biological dataset showed that astral- <dig> and wqmc both matched the reference "plurality tree", and hence may be correct. but this analysis is perhaps less helpful, since the reference tree is based on the mrp analysis of a set of quartet trees, and mrp on quartet trees is a heuristic for the unweighted version of the optimization problem addressed by wqmc and astral- <dig>  thus, the three methods are closely related in terms of their optimality criteria, and this may explain why they produce the same tree on this input.

this experimental study evaluated the performance of these methods when hgt is also present, and demonstrated that wqmc and astral- <dig> maintained good accuracy even in the presence of hgt, while njst tended to be more impacted by high levels of hgt. the explanation as to why njst is not as robust to high hgt levels as astral- <dig> and wqmc is likely to be that the theoretical justification for njst only applies to the msc model, and not to the bounded hgt models. on the other hand, both astral- <dig> and wqmc attempt to solve the mqsst problem, for which optimal solutions are statistically consistent under the msc model, and also under the bounded hgt models discussed in  <cit> .

finally, the slight advantage astral- <dig> had over wqmc in terms of topological accuracy is largely due to its better ability to find good solutions to the mqsst problem, but constraining the search space is also part of the reason that astral- <dig> has good topological accuracy, even under conditions with very high rates of hgt.

CONCLUSIONS
this study evaluated astral- <dig>  njst, wqmc, and concatenated analysis using unpartitioned maximum likelihood  on one biological and several simulated datasets in which ils and hgt were both present. we observed that the quartet-based methods  generally had better accuracy than njst, and that ca-ml could be more accurate than all methods under conditions with low hgt rates. in particular, astral- <dig>  a species tree estimation method that was initially designed to estimate species trees in the presence of ils, had excellent accuracy and generally gave somewhat more accurate results than the other methods we explored. however, all methods were highly accurate under the low to moderate hgt levels, and were only differentiated under the two highest hgt levels. the methods based on quartets  had the highest robustness to hgt. while the study is limited in scope, the results suggest that highly accurate species trees can be constructed, even in the presence of both hgt and ils, using quartet-based methods.

as noted, astral- <dig> and njst are statistically consistent under the msc model , and astral- <dig> is also statistically consistent under the bounded hgt models addressed by  <cit> . however, njst has not been shown to be statistically consistent under the bounded hgt models, and wqmc may not be statistically consistent under either model . because the proof of statistical consistency for astral- <dig> depends only on the requirement that for all sets of four taxa, the most probable quartet tree is topologically identical to the induced species tree on the four taxa, we conjecture that astral- <dig> will be statistically consistent under models in which both ils and hgt occur but at bounded rates .

although the results in this study are encouraging, future work needs to evaluate the performance of species tree estimation methods under a broader set of conditions. in particular, we only evaluated performance under the stochastic hgt model; future work should evaluate methods under the highways model as well. our datasets had only one level of ils, and it is possible that under conditions with higher or lower levels of ils, the effect of hgt would be different. this study was limited to gene trees in which heterogeneity was due only to ils and hgt; future studies should examine other sources of discord, including gene duplication and loss, and/or orthology detection errors. larger numbers of taxa, and/or gene trees with missing taxa, are also likely to present significant analytical challenges, and accurate estimation may not be as easily obtained. hence, future studies should also evaluate accuracy on larger and more challenging datasets, in order to determine whether the good accuracy we saw for the quartet-based methods is maintained under more difficult conditions. similarly, it is possible that some methods might provide highly accurate results on smaller numbers of species, and that the relative performance of methods could change on those conditions. thus, performance on small datasets  should also be explored.

this study was limited in terms of the methods that were explored, in that we restricted the analysis to reasonably fast methods, and of these fast methods we only explored those methods that had been shown to perform well under ils-only scenarios. however, it is possible that some coalescent-based species tree estimation methods, such as mp-est, star, etc., might perform well under hgt+ils scenarios. it is also likely some computationally intensive methods, such as bucky-pop, *beast, and best, might provide better accuracy than astral- <dig> on datasets with hgt+ils. there are also methods designed to infer species trees in the presence of gene tree discordance resulting from duplication and loss, and it is possible that some of these methods  might have good accuracy under the msc. future work should also explore ca-ml using different ml heuristics  and under more complex sequence evolution models. in addition, it would be very interesting to explore fully partitioned ml analyses, since these have very different statistical properties than unpartitioned analyses  <cit> .

