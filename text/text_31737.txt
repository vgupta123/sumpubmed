BACKGROUND
despite recent advances in diagnostic and preventative medicine, infectious diseases still account for a large proportion of the disease burden and mortality worldwide, particularly in low-income areas and developing countries
 <cit> . current clinical diagnostic tests for identifying infection-causing pathogens utilize limited technologies such as polymerase chain reactions , sanger sequencing, or cell culture. these methods typically focus on identifying only a single pathogen at a time and often lack the specificity required to distinguish between closely related species or strains of the same species. bacterial cultures can accurately identify culturable pathogens, but usually require 4– <dig> days to complete and cannot be conducted for all pathogens
 <cit> . microarray technologies, such as the virochip
 <cit> , have been shown to be useful in the space of pathogen identification. microarrays, such as these, are designed to detect known pathogens through the use of high-sensitivity probes and isotype novel pathogens using probes that map to conserved genomic regions. while useful for broad spectrum screening of clinical samples, this technology is limited in that probes must be continually designed and updated to support the ever-growing number of genomic sequences in public databases.

in recent years, researchers have taken advantage of innovations in sequencing technologies to more rapidly identify and characterize pathogens responsible for disease outbreaks, including the west nile virus
 <cit> , h1n <dig> influenza
, cholera
 <cit> , escherichia coli
, salmonella
 <cit> , and antibiotic resistant klebsiella pneumoniae
 <cit> . traditionally, sequencing a single sample has taken as long as several days or weeks using the most common platforms. recent commercial efforts, however, have reduced this time to a few hours or days, projecting within the next few years sequencing runs of less than an hour with a cost of under one hundred dollars
 <cit> . once these technologies become widely accessible, the use of sequencing as a diagnostic tool in the clinic will have great potential for more personalized medical applications. the rapid and accurate analysis of next-generation sequencing data, however, remains a challenge for many reasons. the sheer volume of data, for example, is difficult to analyze without significant computational resources 
 <cit> . furthermore, dna from host genomes or commensal species will often dominate clinical samples and sequencing error can swamp out diagnostic signal. these challenges highlight the need for the development of highly sensitive algorithms that can distinguish among closely related pathogenic strains in a computationally efficient manner.

current sequencing-based diagnostic methods
 require thousands of reads from the pathogen and include computationally intensive steps such as genome assembly, multiple genome alignments, extensive homology searches, and/or phylogeny estimation, with some methods taking upwards of three days to complete a single run
 <cit> . additionally, these methods fail to accurately identify pathogens at the strain level and will often assign ambiguously aligned reads to higher taxonomic levels which may lead to a nonspecific or incorrect diagnosis and the administration of ineffective clinical treatments. such was the case during the european outbreak of hemorrhagic escherichia coli, which resulted in  <dig>  infections and  <dig> deaths across  <dig> countries due to a 3-week delay in appropriate intervention
 <cit> . the challenges encountered when diagnosing viral and bacterial pathogens in the clinic reinforce the need for a streamlined sequencing protocol and a highly sensitive computational method by which strain specific identification can be rapidly achieved. by helping clinicians to direct treatment and avoid misdiagnoses, the identification of viral and bacterial pathogens in clinical samples will directly benefit patients suffering from a variety of infectious diseases
 <cit> . in particular, assigning a viral rather than bacterial cause to an infection may help alleviate the antibiotic overuse that is common in clinical practice today
 <cit> . recent editorials and reviews express concern that analysis, rather than data generation, is likely to be the limiting factor for sequence-based clinical pathology; thus, clearly highlighting the need for ‘clinic-ready’ software tools and approaches
.

here we present clinical pathoscope, a rapid alignment and filtration pipeline for accurate viral and bacterial pathogen identification using unassembled sequencing data. using a variety of clinical samples and simulated scenarios, we demonstrate our method’s ability to differentiate between pathogens, identify multiple pathogens in a single clinical sample, and identify the closest relative to highly mutated and novel strains. clinical pathoscope builds on the previous success of pathoscope v <dig> 
 <cit> , which capitalizes on a bayesian statistical framework to process an alignment file and provide posterior probability profiles of organisms present. while pathoscope v <dig>  showed success when used with purified samples, it was necessary to develop a method to remove potential contaminating sequences from the host and commensal microbes for host-dominated clinical samples. clinical pathoscope incorporates the original pathoscope algorithm into a novel pipeline that allows users to go directly from metagenomic sequencing reads to a list of organisms present in a sample in one easy step and in a clinically relevant timeframe. for convenience, we provide bacterial and viral databases curated from ncbi; however, custom databases can easily be incorporated as well. taken together, these features make clinical pathoscope the fastest and most accurate pipeline currently in the literature for identifying strain-specific pathogens in clinical samples without the need for genome assembly. clinical pathoscope  is freely available at:
http://sourceforge.net/projects/pathoscope/.

methods
in order to develop the clinical pathoscope framework, we have accomplished the following essential tasks for pathogen identification in clinical samples: 1) selection of the most appropriate alignment algorithm and parameters for optimal performance on clinical samples, 2) evaluation of filtering approaches to efficiently remove reads from a clinical sample that originated from host, non-target, or non-pathogenic genomes, and 3) the evaluation and comparison of clinical pathoscope with existing approaches using multiple real datasets [see additional file
 <dig> for clinical pathoscope development workflow]. details regarding the specific methods evaluated, pipeline modules, and results observed are given in the subsequent sections. finally, we have implemented these results into a highly sensitive and efficient pipeline that is user-friendly and approachable by physicians and researchers without the requirement of advanced computational expertise.

clinical pathoscope pipeline development & evaluation
the clinical pathoscope pipeline consists of three primary steps: 1) optimized read alignment, 2) host and non-target genome filtration, and 3) ambiguous read reassignment. we developed the optimized clinical pathoscope algorithm using a set of simulated clinical samples  and later validated our method and compared our results against existing approaches using multiple clinical datasets, some of which are original to this publication.

reference genome library curation and processing
one of the most important steps for the accurate identification of benign and pathogenic genomes is to build a comprehensive genome library containing all species and strains likely to be present in the sample. this is a critical step as clinical pathoscope can only identify organisms or their nearest neighbors if they are present in the library. in order to maximize the characterization of all reads within a given clinical sample, our method aligns reads against three broad categories of reference genomes. the human host library consisted of two sequences totaling  <dig>  gigabase-pairs ; the grch37/hg <dig> build of the human genome, as well as the human ribosomal dna sequence . the ribosomal reference was included in order to remove several false positive alignments to viral genomes that share sequence similarity with human ribosomal rna . the bacterial library was downloaded from ncbi  and contained  <dig>  complete reference genomes and  <dig>  plasmid sequences. in all, this bacterial library consisted of  <dig>  gbps of dna sequence. due to restrictions enforced by some of the aligners with regard to index size, it was necessary to split this library into two smaller segments to facilitate proper alignment. finally, the viral library was also obtained from ncbi . for genomes in which multiple segments were available, all segments for a given genome were concatenated into a single contiguous sequence with each segment separated by a series of null characters . in total, the viral library contained  <dig>  complete genomes and  <dig> megabase-pairs  of total sequence.

generation of simulation study datasets
we simulated two sets of five in silico clinical samples to represent a variety of clinical scenarios including infections with two or more disease causing and benign pathogens, infections with a pathogen having closely related substrains , and infections with highly mutated pathogens. the first set of simulated samples was used to evaluate several alignment algorithms and to optimize the architecture of the clinical pathoscope pipeline. the second set was then used to evaluate the efficacy of clinical pathoscope alongside existing technologies. importance was placed on implementing accurate mutation rates, genome diversity, and relative compositions. functioning as positive controls, these data were essential to develop a robust pipeline for pathogen identification. each sample was composed of human, bacterial, and viral sequences mimicking the microbiota found in sequencing data from nasopharyngeal samples during a respiratory tract infection
 <cit> . specifically,  <dig> million 100-base reads were generated for each sample with 90% of reads originating from the host transcriptome , 9% from bacterial genomes, and 1% from viral genomes. the first set of simulated samples contained sequencing reads from five bacterial and six viral genomes at various depths of coverage. this was essential to determine how each aligner and pipeline architecture performed with respect to the number of reads originating from each genome. the second set of simulated samples was designed as a more challenging and realistic dataset and was used to evaluate our optimized approach. each sample contained sequences from six viral genomes and twenty-five bacterial genomes. the number of reads originating from each viral genome ranged from ten to  <dig> . to determine a realistic bacterial landscape for these samples, we downloaded and aligned three anterior nares samples  from the human microbiome project  and selected  <dig> of the most common bacterial strains  to be included in our simulation. the number of reads originating from each bacterial genome was determined by sampling a gaussian distribution such that the number of bacterial reads per sample totaled  <dig> . reference genomes for each of the representative species were obtained from ncbi’s refseq database
 <cit>  and samples were simulated using the next-generation read simulator, mason
 <cit> , employing its ‘illumina sequencing’ error-model. previously published species or kingdom specific mutation rates for snps and indels were applied to the human
 <cit> , bacterial
 <cit> , and viral
 <cit>  genomes to accurately capture the variability inherent in clinical samples. the simulated datasets are available for download on the pathoscope software distribution site and will be useful for benchmarking and comparing future metagenomic analysis pipelines. the specific parameters and code used to generate this dataset as well as accession numbers of reference genomes and actual read proportions of each genome within each sample are given in additional file
 <dig> 

alignment optimization
we evaluated and compared four publicly available alignment algorithms  based on three criteria, namely, 1) run time, 2) sensitivity and 3) specificity by aligning our first set of five simulated samples against the human, bacterial, and viral reference libraries described above [see additional file
 <dig> for aligner evaluation schematic]. run time was measured as cpu minutes using  <dig> cores and a single  <dig>  ghz amd opteron processor on the boston university medical campus linga cluster. using the resulting alignment files and the known origin of the reads, sensitivity was measured as the number of true positives divided by the number of true positives plus false negatives, and specificity was measured as the number of true negatives divided by the number of true negatives plus false positives. our goal was to identify the algorithm and parameters that provided the best balance of our three evaluation criteria. additionally, we examined the effect of varying the length of each read on the number of reads correctly aligned to the reference genomes using the first  <dig>   <dig>   <dig>  and  <dig> base-pairs, as well as the full-length sequence. evaluating variable read lengths served multiple purposes: 1) determining whether aligning the entire read was necessary, or if aligning a smaller segment of the read performed just as well, 2) identifying optimal sequence read size for future studies, and 3) evaluating whether aligning a smaller portion of the read can replace the need for a computationally intensive spliced-read alignment algorithm for reads from host/filter genomes that contain spliced gene transcripts. the version information, run commands, and alignment results for each algorithm and all parameters evaluated are included in additional file
 <dig> and additional file
 <dig> 

filtration optimization
we employed a computational subtraction methodology
 <cit>  in which reads are sequentially aligned against a series of reference genomes to determine their origin. for our purposes, we aligned reads against libraries of reference genomes originating from human, bacteria, or viruses. within our pipeline, reads that align to the target library  are retained while reads that align to the host  and non-target  sequences are removed. the effects of varying the order of subtraction were examined by comparing the resulting alignment sensitivity, specificity, and pipeline run time using all six permutations of our three libraries. additionally, we evaluated the effect of using the pathoscope expectation maximization  algorithm
 <cit>  to minimize false positive mappings by reassigning reads with ambiguous alignments to their correct genome of origin. a detailed diagram of the overall experimental design is shown in additional file
 <dig>  the subtraction methods evaluated for use in our pipeline as well as the optimal method are shown in additional file
 <dig> 

clinical datasets
prostate cancer cell line 
the pccl dataset
 <cit>  has been leveraged in previous studies as a positive control and a means for comparing algorithm run time. this dataset is derived from a prostate cancer cell line infected with the human papillomavirus serotype  <dig>  the rna sequencing was performed using an illumina ga ii sequencer and  <dig> , <dig> reads  were publically available .

new world titi monkey adenovirus outbreak 
sequencing reads from two new world titi monkeys  infected with a highly divergent adenovirus
 <cit>  make up the second dataset used to evaluate clinical pathoscope. the samples originated from an outbreak of an unknown virus in a colony of titi monkeys in california. chen et al. obtained tissue samples from the lungs of two titi monkeys during necropsy and were sequenced together using the illumina ga iix for 73 cycles in both directions yielding  <dig> , <dig> reads . chen et al. identified the cause to be a new highly divergent species of adenovirus that was subsequently assembled and so named titi monkey adenovirus . we supplemented our host library with the most closely related, fully sequenced simian species, callithrix jacchus . as a positive control, we included the tmadv genome in our target library and validated that clinical pathoscope accurately distinguished the tmadv from all other adenovirus genomes.

tuberculosis in a mummy
sequencing reads from a 200 year old mummy infected with tuberculosis were obtained from a previous study
 <cit>  and used to evaluate clinical pathoscope’s ability to detect bacterial pathogens. the sample was collected from lung tissue taken from the left side of the thorax of a mummified body. pulmonary tuberculosis was suspected because of the cathectic state of the body and was confirmed by pcr analyses. as further validation, the sample was sequenced on the illumina miseq instrument for 300 cycles in both directions yielding  <dig> , <dig> reads with an average length of  <dig> basepairs; the reads were retrieved from sequence read archive with accession number srp <dig>  for analysis with clinical pathoscope, the reads were split into  <dig> , <dig> reads of approximately  <dig> bases in length.

16s amplimer sequencing 
in addition to testing our approach on in silico and previously published clinical datasets, we validated our approach on data from our own clinical samples. under gw irb-approved protocol # <dig>  unused deep endobronchial sputum samples acquired from three intubated subjects were obtained after the samples had been used for standard microbiologic testing and culture as directed by the medical team. a waiver of informed consent was used since the samples were being used as part of the standard of care for these subjects. each subject was provided a handout detailing the study and given them the option to have their sputum samples excluded from the study. the bacteriological staining of aspirate samples revealed the presence of gram-negative bacteria, and bacterial culture from aspirates identified abundant pseudomonas  and enterobacter , with opportunistic flora in all samples. all three patients were on an antibiotic treatment regimen prior to the collection of samples. patient f <dig> was treated with a combination of aminoglycoside  and polymyxin  antibiotics; patient g <dig> was on gentamicin/tobramycin regimen only, and patient h <dig> was treated with third generation cephalosporin antibiotics . in addition to clinical samples, we collected the bacterial dna from gram-positive and gram-negative atcc reference strains: staphylococcus aureus , enterococcus faecalis , pseudomonas aeruginosa , escherichia coli . total dna from these samples was isolated by centrifugation, and solubilization of the pellet using the sigma geneelute kit combined with a lysis buffer by mixing together the gram + and gram- buffers supplemented with lysozyme , lysostaphin , mutanolysin . nanodrop and qubit measurement of concentrations were used to quantify dna. after dna isolation, we amplified the 16s ribosomal rna  gene using the u1492r, tm  <dig>   and b27f, tm  <dig>   universal primers using 800 ng of template. the amplimers were ligated into smrtbells and sequenced on a pacific biosystems rs. the sequencing yielded an average of  <dig>  reads per sample, averaging  <dig>  bases long. for analysis with clinical pathoscope, the pacbio reads from each sample were split into  <dig> base segments that were then treated as individual reads, generating on average  <dig>  reads of  <dig> bases per sample. to accommodate the high identity of 16s rna sequences from different bacterial species and strains, the alignment parameters for this dataset were tightened compared to the viral samples, allowing  <dig> mismatch per  <dig> bases during alignment, and allowing for multiple ‘best’ hits per read . these data were submitted to the ncbi sequence read archive  database under accession number srp <dig> 

16s phylogenetic inference
we took all genomes from genbank’s refseq database belonging to pseudomonas, enterobacter, and acinetobacter genera  and generated a blast database, which we queried with a full-length 16s rrna gene sequence
 <cit> . we selected one copy per species and aligned the resulting dataset using a secondary structure aware algorithm  as implemented in mafft
 <cit> . we ran  <dig> independent maximum likelihood searches in raxml
 <cit>   assuming a gtr nucleotide substitution model with gamma distributed rate heterogeneity. additionally, we obtained diagnostic characters defining particular species using the phylogeny-aware algorithm implemented in caos
 <cit> .

clinical dataset preprocessing
the four clinical datasets were used to evaluate our clinical pathoscope pipeline and to compare our method against previously published algorithms. a summary of these datasets is shown in additional file
 <dig>  extensive quality control was performed uniformly on each of the datasets to remove low quality and artificial sequences using prinseq
 <cit>   and cutadapt
 <cit> , respectively. for each read, bases having a phred quality score less than  <dig> were trimmed from the 3′ end and reads with a median quality score below  <dig> were removed. low complexity and redundant reads were determined using prinseq and removed along with adapter and primer sequences [see additional file
 <dig> for a complete list of adapter and primer sequences]. a minimum read length of  <dig> base pairs was strictly enforced for trimmed reads to facilitate accurate sequence alignment. reads that failed to meet the length requirement were not considered for further analysis.

comparison to published algorithms
clinical pathoscope was evaluated alongside two existing pathogen identification algorithms, rins
 <cit>  and readscan
 <cit>  to emphasize the major differences in performance between assembly-based approaches and our implementation of computational subtraction with varying read length and ambiguous read reassignment. all three methods were compared based on their ability to rapidly identify the pathogens present in the clinical datasets described above. we also considered several published metagenomic-like pipelines such as clovr-metagenomics
 <cit> , imsa
 <cit> , lmat
 <cit> , and metamos
 <cit>  in the context of pathogen identification. these methods were of limited use in this context because of their significantly longer run times . additionally, we tested mgmapper
 <cit> , kmerfinder
 <cit> , and tapir
 <cit> . these approaches are webserver-based approaches, which in some cases have stand-alone downloadable software, however the stand-alone versions produced errors at implementation. additionally, these methods were not designed for metagenomic samples and therefore have no mechanism for dealing with host sequences, and as a result these methods were not considered further in this study.

RESULTS
comparison of alignment algorithms
the internal parameters for each alignment algorithm were evaluated and tuned to maximize alignment sensitivity and specificity as well as to minimize run time by mapping reads from our first set of simulated samples to the reference libraries [see additional file
 <dig> and additional file
6]. the average alignment results and confidence intervals of each algorithm using optimized parameters and read lengths are shown in table 
 <dig>  when aligning reads to the human library, soap <dig> was on average  <dig> % faster than bowtie2; however bowtie <dig> had a  <dig> % higher average sensitivity at  <dig> % and a more consistent run time. for alignments to the viral library, pblat had the highest average sensitivity of  <dig> %. bowtie <dig> also achieved a high average sensitivity of  <dig> % with an 80% reduction in average runtime compared with pblat. for alignments to the bacterial library, pblat had the highest average sensitivity of  <dig> %; however, it took almost  <dig> times longer than bowtie <dig>  which had an average sensitivity of  <dig> %. overall, bowtie <dig> offered the best combination of sensitivity, specificity, and speed when aligning reads against the human, bacterial, and viral libraries.table  <dig> 
simulation study alignment statistics using optimal model parameters


each aligner was used to align the first set of five simulated sequencing samples  against each of the three genome libraries using optimal parameters. the average run time, sensitivity, and specificity as well as confidence intervals for each alignment are reported. bwa failed to run to completion with the bacterial library.



impacts of read length
we evaluated the effect of varying the length of each read used during alignment to further maximize the sensitivity, specificity, and minimize run time. temporary read splitting and trimming allows clinical samples from any sequencing technology to be analyzed without compromising the speed and accuracy of the short read aligner or losing the alignment specificity of longer reads. for the five simulated samples, varying read length had a larger impact on runtime and sensitivity than adjusting internal parameters. using bowtie <dig> as our primary aligner,  <dig> million  <dig> base reads were aligned against the human library in an average 28 minutes, while aligning  <dig> base reads took on average 40 minutes. depending on the reference library used, increasing read length may or may not increase sensitivity. bowtie <dig> aligned  <dig> base reads to the human library with an average sensitivity of 90% and  <dig> base reads with a decreased average sensitivity of 75%. this trend can be explained by the splice junctions found in human transcriptome sequences. with fewer bases, the odds of a read spanning a splice junction are smaller and the read will be more likely to align. conversely, when aligning reads against the bacterial and viral libraries, the average sensitivity is 10-20% higher using  <dig> base reads compared to  <dig> base reads [see additional file
 <dig> for complete results]. to evaluate if longer reads continue to increase sensitivity, a subset of  <dig> base simulated bacterial reads were tested. results indicate that splitting the  <dig> base reads into  <dig> base and  <dig> base segments increased sensitivity by approximately  <dig> percent compared to leaving the reads at the full length of  <dig> bases. thus, upon initiation, clinical pathoscope splits all long reads into fragments with a maximum length of  <dig> bases.

library alignment and filtering order
various filtration methods were evaluated in an effort to minimize computation burden and maximize accuracy. five subtraction frameworks were evaluated: a) naïve approach, b) target centric, c) target centric + reassignment, d) host centric + reassignment, and e) host centric [additional file
7]. in the target centric approaches, reads are first aligned against the target library followed by the host and non-target libraries. conversely, in the host centric approaches, reads are first aligned against the host and non-target libraries and then against the target library. the naïve approach, or only aligning to the target library, took the least amount of time, but resulted in the highest number of false positives. while both the target centric and host centric filtration approaches yielded similar results in terms of accuracy, the target centric approaches required ten fewer minutes  to run to completion than the host centric approaches. the target centric approaches were more efficient because a greater number of sequences were removed by initially mapping reads to the target library than to the host library, thus reducing computational burden for subsequent alignments. to determine the impact of the read reassignment algorithm, we compared the sensitivity of both target centric approaches by analyzing our second set of simulated samples. with viral pathogens as the target library, the target centric approach with read reassignment achieved an average sensitivity of  <dig> % for species and strain level identifications. without the reassignment algorithm, the target centric approach achieved an average sensitivity of  <dig> % and  <dig> % at the species and strain level, respectively. concurrently, with bacterial pathogens as the target library, the target centric method with reassignment achieved an average sensitivity of  <dig> % and  <dig> % at the species and strain levels, respectively, compared with  <dig> % and  <dig> % for species and strain specific identifications without read reassignment. these dramatic improvements in sensitivity between methods with and without read reassignment demonstrate the necessity of this algorithm within the clinical pathoscope pipeline. the performance difference between viral and bacterial identification can be directly attributed to the mixture of bacterial pathogens present in these simulated samples. when two very closely related strains of the same species are present in a given sample, clinical pathoscope will tend to reassign reads which aligned to both strains to the strain with more uniquely identifying sequences. details regarding identification accuracy of clinical pathoscope with respect to each individual strain can be found in additional file
 <dig> 

optimal clinical pathoscope pipeline
the optimized clinical pathoscope pipeline uses three reference genome libraries, four alignment modules and the original pathoscope read reassignment algorithm to identify pathogens in a given sample . first, all reads from a sample are mapped against the reference genomes of the organisms of interest  using up to the first  <dig> bases of each read. this initial alignment results in the removal of the greatest number of sequences by eliminating reads without strong sequence similarity to the target genomes. second, reads that aligned to the target library are aligned against the reference library of the host species  using the first  <dig> bases of each read. this step allows for any residual host contamination to be identified and removed from the set of candidate reads originating from the target genomes. third, reads which did not align to the host library are aligned against additional reference genomes  known to be negative targets of the analysis and which may overlap with the candidate read set. similar to step one, reads are aligned using the first  <dig> bases of each read to maintain high specificity. reads which did not align to the non-target library are realigned to the target library allowing up to k alignments  per read and subsequently passed to the read reassignment module in which reads with ambiguous alignments are reassigned to their putative correct genome of origin. in summary, any sequencing read contributing to the identification of a pathogenic genome must 1) align to the target genome library, 2) remain unaligned to the host genome library, 3) remain unaligned to the non-target library, and 4) retain its alignment to the target library. finally, the pipeline produces a report detailing the number and proportion of reads originating from each genome identified in a given sample.figure  <dig> 
clinical pathoscope pipeline. a computational subtraction method using varying sequence read lengths and ambiguous read reassignment. unassembled sequencing reads are aligned against a target library containing reference sequences of the intended target of identification . reads aligned to the target library are then aligned to a host library. any reads aligned to the host sequences are removed from further analysis. next, reads are aligned against a library of known non-target sequences. unaligned reads are then mapped back to the target library, allowing up to k alignments per read . these alignments are subsequently passed to an expectation maximization algorithm in which ambiguous alignments are reassigned to their most probable genome of origin. upon reassignment, a report detailing the pathogens identified and their relative abundances is produced.



software implementation and distribution
the clinical pathoscope pipeline has been implemented in open-source python, and is freely available for download at:
http://sourceforge.net/projects/pathoscope/. the software requires the user to supply a fastq read file , any number of target, host, and non-target library bowtie <dig> indices. furthermore, the user has the option of changing the pipeline alignment parameters using inputs in the configuration file. for convenience, our viral, bacterial, and human alignment indices are freely available for download on the software distribution website. clinical pathoscope will output two alignment files in sam format, one directly from the bowtie <dig> alignment, and another after read reassignment. finally, the pipeline will output a tab-delimited summary report containing the genomes found in the sample as well as read numbers and proportions assigned to each genome.

evaluation of clinical pathoscope on clinical data
four clinical datasets were utilized to evaluate the efficacy of clinical pathoscope across a variety of scenarios [see additional file
 <dig> for summary of datasets]. in addition, clinical pathoscope was evaluated side by side with two previously published pathogen identification methods, rins and readscan, on the basis of computational speed and accuracy at identifying pathogens in clinical sequencing samples.

prostate cancer cell line 
clinical pathoscope was able to rapidly decode the viral composition of this dataset; identifying the human papillomavirus type  <dig> in fewer than 10 minutes. rins and readscan both produced similar results; however, they required approximately four times the computational time to identify the pathogen, with run times of 89 minutes and 53 minutes, respectively .table  <dig> 
run time comparisons of clinical pathoscope and existing technologies




new world titi monkey adenovirus outbreak 
we examined clinical pathoscope’s performance in two clinical scenarios using the tmadv dataset. first, to evaluate our pipeline in cases where the exact strain is missing from the target library, we excluded the tmadv strain from the target library. in this scenario, clinical pathoscope assigned reads to several adenovirus species . according to chen et al., the simian adenovirus  <dig>  which was the top ranked virus in the clinical pathoscope result, is the closest phylogenetic relative to the tmadv, with approximately 56% sequence similarity. despite its highly divergent nature, clinical pathoscope was able to successfully identify the closest phylogenetic neighbor of this novel species. next, as a positive control, we included the tmadv genome in our target library and validated that clinical pathoscope accurately distinguished the tmadv from all other adenovirus genomes , identifying  <dig>  reads from tmadv. in their original analysis, chen et al. used blastn
 <cit>  to identify  <dig>  reads from tmadv. this discrepancy can be explained by the fact that blastn is a much more sensitive algorithm than bowtie <dig>  this moderate increase in sensitivity, however, results in a dramatic increase in run time, with blastn requiring ten times longer to complete the alignment than bowtie <dig> when tmadv is the only sequence in the database. therefore, with rapid pathogen detection as the goal, a bowtie2-based approach clearly provides a reasonable trade-off between speed and sensitivity, whereas if genome assembly is the goal, a blast-based approach might be preferable . despite aligning approximately  <dig>  fewer reads than the analysis in the original publication, we were still able to obtain  <dig> x coverage of the tmadv genome. while it is clear that clinical pathoscope aligned substantially more reads with the tmadv genome in the target library than in its absence, we were still capable of generating a list of candidate relatives with read counts proportional to their sequence similarity with the tmadv. furthermore, clinical pathoscope completed analysis of this dataset in less than 5 minutes .figure  <dig> 
alignment variations with and without tmadv in the target library. a) without the tmadv present in the target library, clinical pathoscope assigned reads to several adenovirus genomes. the identified genomes are displayed according to the proportion of total reads aligned to all adenovirus genomes. the pairwise nucleotide identities of several adenovirus subtypes to the tmadv genome according to chen et al. are given in parentheses. the simian adenovirus  <dig> had the most reads aligned of all adenoviral genomes, which is consistent with its sequence similarity to the tmadv. additionally, the human adenovirus d aligned the most reads of all human adenoviruses, which is consistent with the analysis of chen et al.
b) inclusion of the titi monkey adenovirus  in the target library resulted in the assignment of  <dig>  reads to the tmadv reference genome.



with the tmadv genome in the reference library, both rins and readscan were able to accurately identify the correct viral genome in the sample. when the tmadv was removed from the library, rins generated a single contiguous sequence consisting of only  <dig> reads which mapped to  <dig> different adenovirus genomes, none of which included the nearest phylogenetic neighbor. this shows that, while assembly may be possible in a given sample, the ambiguous mapping of a contig to multiple genomes provides little information pertaining to the true subspecies of origin. additionally, rins required 144 minutes to complete its analysis of this dataset. readscan assembled several contigs of varying lengths and read counts from 16– <dig> reads per contig. however, the adenovirus strains identified and ranked by readscan based on their relative genome abundance score
 <cit>  were inconsistent with phylogenetic relationships found by clinical pathoscope and the original study
 <cit> . finally, readscan required approximately 80 minutes to analyze this dataset.

tuberculosis in a mummy
to demonstrate the performance of clinical pathoscope with respect to bacterial pathogen identification, we analyzed a sample isolated from a mummy infected with tuberculosis. using assembled contigs and comparative genomics, chan et al. found evidence the deceased was infected with two mycobacterium tuberculosis genotypes. using patterns of deletions and snps, they concluded that both strains most closely resemble strain 7199/ <dig>  but also share similarities with strain h37rv. when strain 7199/ <dig> was included in the target database, clinical pathoscope associates 32% of the reads with strain 7199/ <dig> and 25% of reads with h37rv. the majority of the remaining reads were split between additional m. tuberculosis strains and nocardia species. chan et al. also identified nocardia species using their assembly approach. clinical pathoscope successfully identified the most closely related strains and furthermore, only required 25 minutes to complete the analysis. while these results are in agreement with the author’s nearest-neighbor findings, we note that the number of novel m. tuberculosis strains in the sample  cannot be inferred from the clinical pathoscope output alone. to successfully conclude the presence of two unique, novel strains in the sample, a more complex, assembly based approach is required. neither rins nor readscan performed well on this dataset, requiring  <dig>  and  <dig>  minutes, respectively, to complete the analysis, likely due to the large average read size of  <dig> bases and the complexity of the bacterial database. rins assembled  <dig>  unique contigs of varying length and reported  <dig> , <dig> unique alignments of these contigs to  <dig>  bacterial genomes. while vast, these results are uninformative as to the specific strains present within the clinical sample. several contigs were assigned to various m. tuberculosis strains in the rins report; however, there was a tremendous lack of specificity with regard to the specific strains present in the sample. with thousands of other bacterial genomes identified and no metric for quantifying sequence abundance, the user is forced to interpret the results of thousands of contigs and millions of potential alignments, many of which are redundant or uninformative. readscan required less time to complete its analysis of the mummy dataset than rins; however it also failed to generate a report detailing any of the identified pathogens. in their original publication, the authors demonstrate readscan primarily in the context of viral pathogen identification and note its performance improvements over previous methods. as can be observed from its run time on the mummy dataset, however, readscan has trouble scaling to larger bacterial datasets with many closely related strains of the same species.

bacterial species identification from 16s amplimer sequencing
clinical pathoscope was also tested on eight 16s amplimer samples , five originating from atcc bacterial species, and three from patient tissue extracted from intensive care patients with suspicion of bacterial infections. as shown in table 
 <dig>  clinical pathoscope was able to successfully identify the unique bacterial species in each of the first four atcc samples with high accuracy. furthermore, clinical pathoscope was able to accurately identify the correct mixture of atcc species in the fifth sample, assigning  <dig> %,  <dig> %,  <dig> %, and  <dig> % of the reads to escherichia coli, enterococcus faecalis, pseudomonas aeruginosa, and staphylococcus aureus, respectively.table  <dig> 
clinical pathoscope performance on the 16s amplimer dataset


s. aureus
p. aeruginosa
e. faecalis
s. aureus
e. hirae
p. aeruginosa
p. aeruginosa
e. coli
e. coli
s. enterica
e. coli
e. faecalis
p. aeruginosa
s. aureus
a. baumannii
p. aeruginosa
p. aeruginosa
e. coli
e. aerogenes
p. aeruginosa
erwinia sp. ejp617
e. coli
s. enterica
e. asburiae
s. intermedius


for the three patient samples, we observed that the first sample  contained a mixture of acinetobacter baumannii  and pseudomonas aeruginosa , and that the other two samples  were dominated by pseudomonas aeruginosa  and enterobacter aerogenes , respectively. to validate these results, we constructed a phylogenetic tree of 16s genes from all genomes in the reference library that reside within the three genera identified in the clinical samples [see additional file
10]. we then visually inspected the read coverage pileup plots of 16s genes unique between identified species and their positions relative to phylogenetic neighbors [see additional file
11]. we observed that read coverage is uniform across the genomes identified by clinical pathoscope in each sample, resulting from the fact that they share 100% sequence similarity of their 16s genes. in contrast, we noticed large coverage gaps in the nearest phylogenetic neighbors, indicating that there were sequence variants in these regions that prohibited reads from aligning to these specific locations. this analysis further demonstrates the highly specific and accurate framework employed by clinical pathoscope and its utility not only for strain-specific pathogen identifications, but also for 16s bacterial classification.

comparison to metagenomic pipelines
clinical pathoscope has been designed to facilitate a rapid and streamlined approach to identify strain-specific pathogens in noisy clinical sequencing samples. we compared our method directly with two previously published algorithms, rins and readscan, which were designed specifically for pathogen identification in clinical samples. additional methods, such as pathseq
 <cit>  and imsa
 <cit> , were also considered. these methods rely on several blat and blast alignments in order to filter sequencing reads which can take several hours to days to complete depending on the number of reads in a given sample. to evaluate these types of approaches, we implemented a similar blast-based workflow and applied this workflow to our second set of simulated samples with the bacterial library as the target. this approach resulted in a substantial decrease in performance with only  <dig> % and  <dig> % sensitivity for species and strain-specific identifications, respectively. this blast-based approach required 55 hours and 26 minutes, which is  <dig> times slower than clinical pathoscope. therefore, these algorithms are not practical methods for rapid clinical diagnostics.

we further expanded our comparisons to metagenomic pipelines that were not specifically designed for the identification of pathogens in clinical samples but whose methods or modules may be useful for the task. we first considered the clovr-metagenomics pipeline which clusters raw sequencing reads to reduce redundancy followed by a simultaneous blastx and blastn analysis against refseq and cog in order to annotate each sequencing read. clovr-metagenomics does not address the issue of host contamination and thus wastes computational time clustering and annotating sequences originating from the host which can account for >90% of the clinical sample. while very sensitive, blastn is notoriously slow and does not scale well to large metagenomic samples
 <cit> , making clovr-metagenomics impractical for rapid strain identification. furthermore, the redundancy reduction procedures employed by clovr-metagenomics collapse sequences with 99% nucleotide similarity which could potentially remove reads that distinguish two closely related strains of the same species.

we also considered assembly-based metamos
 <cit>  and phylogeny-based lmat
 <cit> . metamos offers a rich suite of assembly algorithms and pathogen annotation methods, however it does not incorporate any methods to remove host or contaminating sequences. as a result, the assembly of sequencing reads from a host-dominated clinical sample would require an attempt to assemble the entire host genome. this will result in a substantial and unnecessary increase in computational time and these contaminating reads could result in high instances of false positive mappings. lmat, a software package designed for taxonomy classification, claims accuracy only to the species level and does not report genome abundance information and thus cannot replicate the detailed pathogen report produced by clinical pathoscope.

CONCLUSIONS
sequence-based diagnostic tools have the potential to revolutionize the treatment of patients in the clinic, particularly those suffering from viral and bacterial infections. as the run times and error rates of modern sequencing technologies rapidly decline, it is essential that software be developed to analyze these data in a manner that is both fast and highly sensitive in order to provide physicians with the most accurate information possible. we have implemented a novel pipeline for pathogen identification that overcomes many of the challenges faced by current sequence-based methods including clinically appropriate run time and subspecies specific assignment of sequencing reads. we have also demonstrated our method’s ability to identify multiple pathogens in a single clinical sample or the nearest phylogenetic neighbor of highly mutated or divergent species. furthermore, clinical pathoscope remained robust when analyzing datasets with lower than 1x coverage of the target genomes. it should be noted, however, that as coverage drops below 1x, the probability of sequencing a strain-specific segment of the target genome decreases. if these uniquely identifying reads are not sequenced and thus not present in the sample, clinical pathoscope will tend to report the strain with the most aligned reads. given that strain-specific reads do exist within a given sample, we expect the lower limit of coverage required to make a strain-specific identification to be comparable to our previously published 
