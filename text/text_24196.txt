BACKGROUND
a huge number of genome-wide polymorphisms have recently been elucidated in livestock and crops with the development of sequencing technologies. high-throughput genotyping systems, such as high-density snp chips containing several tens or hundreds of thousands of genome-wide snp markers and gbs 
 <cit> , have become available to efficiently identify genotypes of individuals for a large number of snps at low cost. consequently, genomic selection
 <cit>  is attracting attention as a new breeding technology utilizing the information of genome-wide dense snp markers. in genomic selection, a model to predict genomic breeding value  based on genome-wide snp genotype is firstly constructed using a training population consisting of individuals with both snp genotypes and phenotypes of a trait and, subsequently, using this model, the gbvs of a trait are predicted for individuals in the tested population, which are selection candidates, based on their snp genotypes, allowing effective individual selection to be performed without phenotypic records using the predicted gbv. therefore, genomic selection requires the construction of prediction models being able to accurately relate genotypes of genome-wide snps to gbv.

in the original study of genomic selection by meuwissen et al.
 <cit> , two bayesian methods were presented for construction of prediction models, which were referred to as baeysa and bayesb and have been used for the studies of genomic selection in their original or modified forms
 <cit> . the model of bayesa is equivalent to the bayesian shrinkage regression  model
 <cit> , where all snps are included in the prediction model as covariates and the estimates of snp effects are shrunk by assuming a normal distribution with mean  <dig> and snp-specific variance as prior distributions of snp effects, resulting in negligible estimates for the effects of many snps irrelevant to phenotype, but significantly large estimates for the effects of snps contributing to phenotype. on the other hand, the bayesb method is regarded as a variant of bayesian stochastic search variable selection 
 <cit> , where the prior probability, π, that a snp has zero effect and is removed from the model was considered in the model fitting to obtain the best model explaining the phenotypes with a small number of snp effects. a normal distribution with mean  <dig> and snp-specific variance is assumed for the prior distribution of snp effects in bayesb, as in bayesa, if snps are included in the model with probability 1-π and, otherwise, both the mean and variance are fixed at  <dig> with probability π.

in bayesa and bayesb, an additional hierarchical structure is induced for this snp-specific variance, where an inverted chi-square distribution with degree of freedom ν and scale parameter s is adopted as the prior distribution of the variance. however, only the information of the relevant single snp can be used for the posterior inference of this snp-specific variance regardless of the number of genotypes or phenotypes. due to the insufficient bayesian learning for the variance, the degree of shrinkage for the estimates of snp effects is largely influenced by the prior setting for ν and s in bayesa and bayesb
 <cit> . in baeysb, the sparseness of the model and the prediction accuracy are also greatly affected by the prior probability, π, that a snp has zero effect, which is treated as a known fixed value. to overcome these drawbacks of bayesa and bayesb, the modified methods such as bayesc and bayesd were proposed. in bayesc, a single variance common to all snps is adopted for the prior distribution of snp effects while bayesd allows s to be inferred from the data, given ν. furthermore, the step for inferring π, which is given as a fixed value in bayesb, can be incorporated in the procedure of bayesc and bayesd and the corresponding methods are termed bayescπ and bayesdπ, respectively
 <cit> .

these bayesian methods were mainly developed for genomic selection of a single trait. however, actual breeding of animals and plants often aims to simultaneously improve multiple correlated traits. therefore, joint prediction of gbvs for multiple traits, taking into consideration the correlation structure between traits, is suitable for multi-trait genomic selection, which requires the extension of existing methods for single-trait gbv prediction to multi-trait case. in qtl mapping methods that use similar models to those of genomic selection, some researchers have developed multi-trait models
 <cit> . xu et al.
 <cit>  extended the bsr model to a multi-trait case introducing the correlation structure between traits in estimation of qtl effects and other non-genetic effects. banerjee et al.
 <cit>  employed a bayesian composite model space approach
 <cit>  for multi-trait qtl mapping, where a variable indicating inclusion or exclusion of each qtl was incorporated for constructing a model with the smallest possible number of qtls, a similar approach to bssvs adopted in bayesb, and each trait was allowed to have a different model by assuming the trait-specific effects for qtls and non-genetic factors that were assumed to be uncorrelated between traits. meuwissen and goddard
 <cit>  proposed a multi-trait bssvs model for qtl mapping. these methods can be applied for prediction of multi-trait gbvs in genomic selection. calus and veerkamp
 <cit>  applied the method proposed in
 <cit>  with some modification for multi-trait gbv prediction to compare the accuracy between single-trait prediction and multi-trait prediction in genomic selection.

the computational procedure with mcmc iteration is generally used for the bayesian methods to estimate parameters in the models, which become complicated models in genomic selection, including a huge number of snps as covariates and snp effects that are estimated as their regression coefficients. the computational burden of mcmc-based bayesian methods, which requires a long time until convergence when estimating many parameters is huge even in single-trait gbv prediction and would be further increased in the case of multiple traits, thus hindering the mcmc procedure depending on the number of traits to be jointly analyzed. therefore, it would be necessary to devise a solution for reducing the computational burden of bayesian methods for multi-trait gbv prediction. so far, some non-mcmc computational procedures for bayesian methods have been proposed in qtl mapping and genome-wide association study, including em-algorithm
 <cit>  and variational approximation
 <cit> . the em-algorithm was also applied to single-trait gbv prediction, successfully reducing the computational time
 <cit> .

in this paper, we propose bayesian methods for multi-trait gbv prediction, in which bsr models allowing variable selection are developed and mcmc procedures for estimating model parameters including snp effects are described as well as a computationally cost-effective non-mcmc method using variational approximation as an alternative computational procedure. hereafter, the bayesian methods based on mcmc iteration and variational approximation are referred to as mcbayes and varbayes, respectively. the multi-trait bayesian models described here include a bayesian shrinkage regression  models that are equivalent to those adopted by bayesa and bayesd when variable selection is not conducted, and the models of bssvs that are regarded as slightly modified versions of bayesb and bayesdπ methods when a step of variable selection step is incorporated. we develop computationally-effective variational approximation procedures to construct the posterior distributions of parameters of these bayesian models.

using simulated datasets consisting of genotypes of genome-wide dense snps and phenotypes of three correlated traits with high and low heritabilities, we investigated the differences in prediction accuracy for each trait between multi-trait analysis, where gbvs of three traits were simultaneously predicted taking the correlation structure between traits into consideration, and single-trait analysis, where each trait was separately predicted for gbv. we also evaluated the prediction accuracy of the varbayes methods in comparison with mcbayes. moreover, we investigated the performance of multi-trait analysis in simulated data including missing phenotypes.

methods
in this section, we describe bayesian models for multi-trait gbv prediction and computational procedures for bayesian estimation of the model parameters, including construction of posterior distributions of the parameters using mcmc iteration and variational approximation. here, we consider the statistical models for bsr and bssvs, which are shown to be equivalent to bayesd and similar to bayesdπ, respectively. in these bayesian models concerned, bsr is regarded as a special version of bssvs by setting π = <dig>  where π is a prior probability that a snp does not contribute to traits; thus, we present the multi-trait gbv prediction models in a unified fashion in terms of bssvs.

we assume that the number of snps genotyped is n and a training dataset including n individuals with phenotypic records of multiple traits, where the number of traits is denoted by t, and snp genotypes is available for estimating parameters in the prediction model. we also assume that a test dataset consists of individuals with only snp genotypes, for each of which gbv is predicted. we denote two alleles at each snp by  <dig> and  <dig> and three genotypes by ‘0_0’, ‘0_1’, and ‘1_1’.

models for bayesian stochastic search variable selection in multi-trait genomic selection
we propose the following bayesian multi-locus linear model for the phenotypes of t traits of the ith individual, which are denoted as a tx <dig> vector yi , as a bssvs model for multi-trait gbv prediction:

  yi=xib+∑l=1nγluilgl+ei, 

where b is a f ×  <dig> vector of non-genetic effects including interceptions of the model with xi being a t × f design matrix linking b to the ith individual; uil is a variable indicating the genotype of the ith individual at the lth snp taking a value of − <dig>   <dig> or  <dig> corresponding to the genotypes, ‘0_0’, ‘0_1’, or ‘1_1’, respectively; gl is a t ×  <dig> vector of the effects of the lth snp on the phenotypes of t traits; γl is a variable indicating the inclusion of the lth snp in the model with  <dig> or  <dig> depending on whether or not the lth snp is included in the model; and ei is a t ×  <dig> vector of residual errors following a t-variate normal distribution n with  <dig> being a t ×  <dig> vector of zeros and Σe being a txt covariance matrix of ei.

within the bayesian framework, prior distributions are assigned to the parameters of the model . we assume that the priors of the elements of b are the improper uniform distribution over the possible values. the prior probabilities that γl = <dig> and γl = <dig> are presented as 1- π and π, respectively, considering the prior probability that a snp does not contribute to the trait and is excluded from the model is π. the prior distribution of gl given γl has the form

  gl|γl~{n <dig> Σglγl=1δ0γl= <dig>  

where Σgl is a t × t matrix that is the variance and covariance matrix of gl given γl = <dig> and δ  is the delta function that concentrates a total mass at zero for all t elements of gl. we induce a hierarchical structure for Σgl by assigning an inverse wishart distribution with degree of freedom ν and scale parameter s, denoted by iwt, to the prior distribution of Σgl :

  Σgl~iwtv,s∝|s|ν/2|Σgl|−ν+t+1/2exp−12trsΣgl− <dig> 

although the snp effect gl is zero and irrelevant to Σgl when γl = <dig> as shown in , we assume that Σgl is a priori distributed as given in  regardless of γl. we treat ν as a given fixed value but infer s from the data within the bayesian framework. for simplicity, we assume here that s is a diagonal matrix with the kth diagonal element being sk , that is s = diag , and we adopt the improper uniform distribution over positive values for a prior distribution of sk. the residual variance and covariance matrix Σe is assumed to have a uniform distribution over the positive definite matrices as a prior distribution.

denoting these parameters of the bayesian model collectively by θ, the prior distribution of θ by p and observed phenotypes yi and snp genotypes uil  by y and u, respectively, we can write the posterior distribution of θ, g, as

 gθ|ν,y,u∝|Σe|−n/2exp−12∑i=1nyi*'Σe−1yi* 

 ×∏l=1n{1−π|Σgl|−1/2exp}γlπδ01−γl 

  ×∏l=1n|s|ν/2|Σgl|−ν+t+1/2exp−12trsΣgt− <dig> 

from ,  and , where yi* is a residual given by
yi*=yi−xib−∑l=1nγluilgl.

given that s is fixed, posterior distribution  is equivalent to that of bayesa extended to multi-trait case when π =  <dig> leading to γl = <dig> for all snps. when π >  <dig>  the selection of snps to be included in the model is performed as in bayesb. however, it should be noted that posterior distribution  is not equivalent to that of the multi-trait version of bayesb, which supposes that Σgl is a zero matrix as well as gl when γl = <dig>  while, in , the prior distribution of Σgl is assumed to be iwt regardless of γl. the form of posterior distribution  allows gibbs sampling in the mcmc estimation for all parameters including gl and Σgl. the full conditional posterior distributions of parameters used in mcbayes are described in additional file
 <dig> 

variational approximation procedure for multi-trait bayesian model
we adopted variational approximation as an alternative to mcmc iteration for constructing marginal posterior distributions of parameters based on joint posterior distribution . in the variational approximation procedure, the joint posterior distribution is approximated by the product of functions for subsets of parameters with lower dimension. briefly, we assume that g is approximated by a function of θ, q, which is factorized as q = q <dig> q2…qk, where θ <dig>  θ <dig> … ,θk are mutually exclusive subsets of θ such that ∪ k = 1kθk = θ and qk   may generally depend on νy and u although this dependence is omitted here for simplicity. this approximating marginal posterior distribution, qk, is referred to as the variational posterior of θk <cit> . the form of qk is determined such that the kullback–leibler divergence between g and q q2…qk, d, is minimized
 <cit> , where d is defined as

 dq||g=∫qθlogqθgθ|ν,y,udθ 

it can be shown that qk is expressed as

  qkθk=cexpe−θkloggθ|ν,y,u 

where c is a normalized constant and e-θk indicates the expectations of parameters other than θk that are calculated with respect to every other parameter’s variational posteriors except qk
 <cit> .

in the varbayes method that applies the variational approximation procedure to the multi-trait bayesian model considered here, g is assumed to be approximated by a factorized function q that is written as

 qθ=qbqΣe∏l=1nqγl,glqΣglqs 

where we denote all of the variational posteriors for the different parameters in the right-hand side by q for simplicity with the understanding that q, q  and so on take different forms depending on the parameters. the forms of these variational posteriors are derived from  in a manner similar to that used for derivation of the full conditional posteriors for the parameters in gibbs sampling and the computational details are given in additional file
 <dig>  in the following, we will give the variational posteriors for parameters, γl, gl, Σgl , b, Σe and s.

the variational posterior for b, q,is a multivariate normal density with mean

  eb=∑i=1nxi'eΣe−1xi−1∑i=1nxi'eΣe−1yi−∑l=1nuileγlgl 

and variance-covariance matrix

 vb=∑i=1nxi'eΣe−1xi− <dig> 

where e indicates the expectation calculated with respect to the variational posteriors of relevant parameters, while q  is iwt  with

  se=∑i=1nyi−xieb−∑l=1nuileγlglyi−xieb−∑l=1nuileγlgl' 

from which we obtain

  eΣe−1=n−t−1se− <dig> 

the variational posterior of Σgl is represented by iwt , where

 νgl=ν+eγl 

and

 sgl=es+eγlglgl’ 

the expectation of Σgl- <dig> with respect to this posterior distribution is

  eΣgl−1=νglsgl−1=ν+eγles+eγlglgl’ 

for γl and gl, we consider joint distribution for variational posterior q that is expressed as

  qγl,gl∝1−π|vgl|1/2|eΣl−1|1/2exp12g^l'vgl−1g^l×ϕgl|g^l,vglγl×πδ01−γl 

where
φgl|g^l,vgl is a density function of a multivariate normal distribution
ng^l,vgl with mean

  g^l=eΣl−1+∑i=1nuil2eΣe−1−1eΣe−1∑i=1nuilyi−xieb−∑j≠luijeγjgj 

and variance-covariance matrix

  vgl=eΣl−1+∑i=1nuil2eΣe−1− <dig> 

the marginal posterior distribution of γl is a binomial distribution with probabilities of γl = <dig> and  <dig> given by

  qγl=1=eγl=1−π|vgl|1/2|eΣl−1|1/2exp12g^l'vgl−1g^l1−π|vgl|1/2|eΣl−1|1/2exp12g^l'vgl−1g^l+π 

and

 qγl=0=1−qγl=1=π1−π|vgl|1/2|eΣl−1|1/2exp12g^l'vgl−1g^l+π 

the conditional distribution of gl given γl is given by

 qgl|γl=ng^l,vglγl=1δ0γl= <dig> 

therefore, we obtain

  eγlgl=qγl=1egl|γl=1+qγl=0egl|γl=0=eγlg^l 

and

  eγlglgl’=eγlg^lg^l'+vgl 

from , the variational posterior of s is a t-variate wishart distribution with a scale matrix Σs and degree of freedom νs, wt, where
Σs=∑l=1neΣgl−1− <dig> and νs = nν + t +  <dig>  and the expectation of s is expressed as

  es=νsΣs=nν+t+1∑l=1neΣgl−1− <dig> 

as outlined above, a well-known probability distribution, such as normal, inverse wishart and so on, is assigned to the variational posterior of each parameter, which is characterized by the expectations of the functions of other parameters, taken with respect to their variational posteriors. the relationships between these expectations are given by , , , , ,  and , from which the expectations can be calculated with numerical iterations to obtain the variational posteriors.

moreover, the prior probability for a snp to have zero effect, π, can be treated as a variable parameter to be inferred from the data as in bayescπ and bayesdπ when 0 < π <  <dig>  here, we assume a uniform prior on 0 < π <  <dig> to obtain a beta distribution, b, as a variational posterior from , where
a=n−∑l=1ne+ <dig> and
b=∑l=1ne+ <dig>  with the expectation

  eπ=a/a+b=n−∑l=1neγl+1/n+ <dig> 

accordingly, the variational posteriors of the other parameters are modified with π substituted by e when π is involved in the bayesian inference.

treatment of missing phenotypes
in the phenotypic records for multiple traits, it is common for trait values to be partially missing in some individuals. missing phenotypes of a trait in individuals can be inferred with the observed phenotypes of other traits in the same individuals. the step for inferring missing phenotypes can be implemented in the mcbayes and varbayes procedures as described below.

when there are missing phenotypes in an individual, the residual vector of the individual, e in model , is partitioned into components eo and em corresponding to observed and missing phenotypes, respectively. following
 <cit> , em can be sampled from the following normal distribution,

  em~nΣmoΣoo−1eo,Σmm−ΣmoΣoo−1Σmo’ 

where Σmm, Σmo and Σoo indicate the partition of the residual variance-covariance matrix Σe corresponding to em and eo. accordingly, em is drawn with gibbs sampling in mcbayes while it is obtained as ee-1eo* in varbayes, where, denoting the component corresponding to the missing traits by subscript ‘o’, eo* is written as

 eo*=yo−xoeb−∑l=1nuileγlgol 

and the expectations can be calculated with the variational posteriors of Σe, b and gl . missing phenotypes are inferred as the sum of the estimates of b, gl and em, which are used for the construction of the prediction model.

simulation experiments
we simulated datasets to evaluate the accuracy of the predicted gbvs using the proposed bayesian methods, mcbayes and varbayes, for multiple traits. in generating the datasets, three traits, denoted as a, b and c, were considered. the simulation of population and genome was carried out following
 <cit>  where a single trait was treated, while multiple traits were generated through a modified approach. the simulated population, genotypes and phenotypes are described in the following.

populations with an effective population size of  <dig> were maintained by random mating for  <dig> generations to attain mutation drift balance and ld between snps and qtls. in generation  <dig> and  <dig>  the population size was increased to  <dig>  the population in the 1001st generation was treated as a training population, where the phenotypes of three traits and snp genotypes of the individuals were simulated and analyzed to estimate the snp effects in the model. the phenotype of each trait for each individual in the 1001st generation was given as the sum of qtl effects over the polymorphic qtls and environmental effects, which were sampled as described later. for simplicity, no other fixed effects were assumed. the population in the 1002nd generation was used as a test population, where the individuals were only genotyped for snp markers without phenotypic records and gbvs of three traits were predicted for each individual using a model with snp effects estimated based on the training population in the 1001st generation. the true breeding value  of the individual in the 1002nd generation was also simulated as the sum of qtl effects corresponding to the qtl genotype for each trait and used for evaluating the accuracy of predicted gbv, but was regarded as unknown and unavailable in the estimation of snp effects in the models. accuracy was measured based on the correlation between the tbv and predicted gbv, rtbv,pgbv, for each trait and regression of tbv on predicted gbv, btbv,pgbv, was also obtained for assessing the bias of the prediction.

the genome was assumed to consist of  <dig> chromosomes each 100cm in length. two scenarios were considered for the number of available snp markers and the datasets under these two scenarios were denoted as data i and data ii. in data i,  <dig> marker loci were located every 1cm on each chromosome for a total of  <dig> markers on a genome. in data ii,  <dig> equidistant marker loci were located on each chromosome for a total of  <dig> markers. we assumed that  <dig> equidistant qtls were located on each chromosome such that a qtl was in the middle between two marker loci in both data i and data ii. therefore, there were a total of  <dig> qtls located on a whole genome. the mutation rates assumed per locus per meiosis were  <dig>  × 10- <dig> and  <dig>  × 10- <dig> for the marker locus and qtl, respectively. at least one mutation occurred in the most of the marker loci with a high mutation rate during the simulated generations. in the marker loci experiencing more than one mutation, the mutation remaining at the highest minor allele frequency  was regarded as visible, whereas the others were ignored, which resulted in the marker loci having two alleles similar to snp markers. although the mutation rate for qtl was assumed  <dig>  × 10- <dig> in the simulation for a single trait conducted in
 <cit> , we here doubled it for generating tbvs of multiple traits for the reason as described below.

the polymorphic qtls at which mutation occurred were used to simulate the three traits, a, b and c, the heritabilities of which, denoted by ha <dig>  hb <dig> and hc <dig>  respectively, were assumed to be ha2 =  <dig> , hb2 =  <dig>  and hc2 =  <dig> . we divided all polymorphic qtls into four groups, group <dig>  group <dig>  group <dig> and group <dig>  according to the causal relationship with traits, where group <dig> was a group of qtls affecting both traits a and b, group <dig> was a group of qtls affecting only trait a, group <dig> was a group of qtls affecting only trait b and group <dig> was a group of qtls affecting only trait c. therefore, it was assumed that qtls of group <dig> had pleiotropic effects on traits a and b while qtls of other groups affected only a single trait. each polymorphic qtl was randomly assigned to one of these groups, that is, to group <dig>  group <dig>  group <dig> and group <dig> with respective probabilities  <dig> ,  <dig> ,  <dig>  and  <dig> . therefore, 80% of the qtl loci affecting trait a were shared by trait b on average and whereas all the qtl loci affecting trait c influence neither traits a nor b. in this setting of multi-trait case, the mutation rate of qtl was increased to  <dig>  × 10- <dig> from  <dig>  × 10- <dig>  the mutation rate adopted in
 <cit>  for generating a single trait, to retain the number of qtl per trait.

the pleiotropic effects of each qtl in group <dig> were assumed to be correlated between traits a and b with correlation coefficient of  <dig> . consequently, genetic correlations between traits a and b, between a and c and between b and c, denoted as ρgab, ρgac and ρgbc, respectively, were ρgab =  <dig>  and ρgac = ρgbc =  <dig> on average although the values of correlation coefficients were somewhat fluctuated in each data generation. this setting of traits was adopted to investigate how the prediction accuracy was increased for a low-heritability trait  by simultaneous analysis for multiple traits including a correlated high-heritability trait .

the effects of qtl alleles were sampled from gamma distributions independently for each qtl. pleiotropic effects of qtl alleles in group <dig> were determined for traits a and b by generating two correlated gamma random variables, x and y, with the correlation coefficient of  <dig> , and assigning them with positive or negative values with equal probabilities. the effects of qtl alleles in the other groups, which affected each single trait only, was determined by sampling a gamma random variable z and by similarly assigning it with the positive or negative sign. we generated these three random variables x, y and z such that their marginal distributions were the same gamma distribution with scale parameter  <dig>  and shape parameter  <dig> , gamma. for obtaining correlated variables x and y, we generated three independent gamma variables, x <dig>  x <dig> and x <dig>  which were sampled from gamma, gamma and gamma, respectively, and determined the values of x and y as x = x1 + x <dig> and y = x1 + x <dig>  it can be shown that x and y had a correlation coefficient of  <dig>  and the same marginal distribution gamma
 <cit> .

the environmental correlation coefficients between three traits were denoted by ρeab, ρeac and ρebc, respectively, and assumed as ρeab =  <dig> , ρeac =  <dig>  and ρebc =  <dig> . the environmental effects were sampled from a trivariate normal distribution with a mean vector  <dig> and a variance-covariance matrix re, where

 re=σea2ρeabσeaσebρeacσeaσecρeabσeaσebσeb2ρebcσebσecρeacσeaσecρebcσebσecσec <dig> 

with σea <dig>  σeb <dig> and σec <dig> indicating environmental variances of three traits. environmental variance of trait a was given by σea2 = σga <dig> with its heritability ha <dig> and genetic variance σga <dig>  which was variance of tbv of trait a, and those of traits b and c were obtained similarly. the environmental effects were added to tbvs which were given by the sum of qtl effects to determine phenotypic values of three traits for individuals in the 1001st generation.

in data i,  <dig> replicated datasets were simulated while data ii consisted of  <dig> replicated datasets due to the larger number of snps. each of replicated datasets included records of phenotypes of three traits and genotypes of snps for the training population  and only snp genotypes for the test population . to simulate the situation of missing phenotypes, we generated additional datasets by deleting the phenotypic records of some traits for some individuals in the  <dig> replicated training datasets of data i. these  <dig> replicated datasets were referred to as data iii, where the phenotypic records of traits a, b and c were respectively deleted for individuals of i = 801– <dig>  individuals of i = 1- <dig> and individuals of i = 201- <dig> in  <dig> individuals  of the 1001st generation of data i. therefore, in data iii, the prediction model for gbvs was constructed with a training dataset consisting of the phenotypes of  <dig>   <dig> and  <dig> individuals for traits a, b and c, respectively, where only  <dig> individuals  had phenotypic records of all three traits, and  <dig> individuals in the 1002nd generation were predicted for gbv based on the genotypes of  <dig> markers. the setting of non-zero environmental correlations, i.e., ρeab =  <dig> , ρeac =  <dig>  and ρebc =  <dig> , was adopted here to assess the benefit from the estimation process of missing phenotypes implemented in multi-trait analyses for the prediction accuracy, where the information of environmental covariance between observed and missing phenotypes was utilized as in .

each replicated dataset in data i, data ii and data iii was analyzed using the proposed methods for multiple traits, mcbayes and varbayes, to construct the gbv prediction model in the1001st generation and investigate rtbv,pgbv and btbv, pgbv for each trait in the 1002nd generation. for a comparison with conventional single-trait gbv prediction, the same datasets were also analyzed with the single-trait setting of mcbayes where three traits were separately treated without considering the correlation structure between traits.

we conducted cross-validation as well to evaluate the prediction performance within a population in the 1001st generation without the 1002nd generation since the techniques of cross-validation have commonly been used for evaluation of the accuracy in the studies of genomic selection with the actual datasets of animals
 <cit>  and plants
 <cit> , where the prediction accuracy of the model for the unobserved future samples was of concern. we applied 10-fold cross-validation. in brief, we randomly split a population of  <dig> individuals in the 1001st generation into ten subpopulations with each size  <dig>  by using a single subpopulation used as a test set and the remaining nine subpopulations as a training set to construct prediction model, the prediction accuracy and bias were assessed for the test set. this process was repeated ten times until all single subpopulations were used as test sets exactly once. we averaged the prediction accuracy and bias over ten repetitions to evaluate the prediction performance in each dataset. because of much computational burden with mcmc analysis for repeated model constructions in cross-validation, evaluation with 10-fold cross-validation was carried out for data i only, where mean of the prediction accuracies and biases in  <dig> datasets were obtained as rtbv,pgbv and btbv, pgbv for each trait and for each prediction method. in the process of cross-validation, we also investigated the correlation between predicted gbv and the phenotypic value, ry,pgbv, in place of tbv, and regression of predicted gbv on phenotypic value, by, pgbv, for each trait.

two settings for the prior probability that a snp has zero effect, π, were adopted in model construction, i.e., π was fixed at  <dig> or π was variable over the range 0 < π < <dig> and inferred from the data. the values of hyperparameter ν, degree of freedom of prior inverse wishart distribution of Σgl, were set to  <dig>  and  <dig>  corresponding to π = <dig> and 0 < π < <dig> after preliminary analyses to evaluate the effects of the values of ν on prediction accuracy over 3 < ν < <dig> although the accuracy was little affected by the values of ν.

in the mcmc iteration of mcbayes, we repeated  <dig> cycles including a burn-in period of the first  <dig> cycles. the values of parameters were sampled every  <dig> cycles to obtain the posterior means that were used to determine a prediction model for each generated dataset. in the method of varbayes, we adopted the criterion
|θ^*−θ^|2/|θ^*| <dig> < 10- <dig> for convergence in numerical iteration for computing the expectations of parameters, where
θ^* and
θ^ are the current and previous value of the expectations of parameters. when this criterion was satisfied, the computational procedure with variational approximation was regarded as converged.

RESULTS
we evaluated the accuracy and bias of the predicted gbvs, rtbv,pgbv and btbv, pgbv, obtained by the proposed methods for genomic selection of multiple traits including mcbayes and varbayes in  <dig> simulated datasets of data i and data iii and in  <dig> datasets of data ii in comparison with the prediction accuracy with single-trait mcbayes analysis. the means of accuracies and biases of prediction evaluated using a test population in the 1002nd generation are summarized in table
 <dig>  table
 <dig> and table
 <dig> for data i, data ii and data iii, respectively. in all of datasets, mcbayes provided higher prediction accuracy than varbayes in multi-trait analysis . in data i, rtbv,pgbv obtained with multi-trait mcbayes analysis was  <dig>  ,  <dig>   and  <dig>   for traits a, b and c, respectively, when π was fixed at  <dig>  where standard errors were given in parenthesis here and hereafter, while that was  <dig>  ,  <dig>   and  <dig>   when π was varied and inferred. in data ii with the number of snps increased to  <dig>  rtbv,pgbv with multi-trait mcbayes analysis was higher at  <dig>  ,  <dig>   and  <dig>   for traits a, b and c, respectively, when π was fixed at  <dig> while that was  <dig>  ,  <dig>   and  <dig>   when π was inferred. with multi-trait varbayes analysis, rtbv,pgbv was  <dig>  ,  <dig>   and  <dig>   for traits a, b and c with π = <dig> and that was  <dig>  ,  <dig>   and  <dig>   with π variable in data i while that was  <dig>   ,  <dig>   and  <dig>   with π = <dig> and  <dig>   ,  <dig>   and  <dig>   with π variable in data ii. the prediction with multi-trait mcbayes was almost unbiased in data i, where btbv,pgbv was near  <dig>  but was biased in data ii for traits b and c . the analysis with varbayes showed greater bias than with mcbayes.

averages and standard errors based on  <dig> replicates of simulated data are listed for prediction accuracy, rpgbv,tbv, and bias, bpgbv,tbv, of each trait. for the prior probability that a snp has zero effect, π, we considered two settings, in which π was fixed at  <dig>  meaning the inclusion of all snps in the model, and π was varied over 0 < π < <dig> and inferred from the data.

averages and standard errors based on  <dig> replicates of simulated data are listed for prediction accuracy, rpgbv,tbv, and bias, bpgbv,tbv, of each trait. for the settings of the prior probability that a snp has zero effect, π, see table
 <dig> 

averages and standard errors based on  <dig> replicates of simulated data are listed for prediction accuracy, rpgbv,tbv, and bias, bpgbv,tbv, of each trait. for the settings of prior probability that a snp has zero effect, π, see table
 <dig> 

in single-trait analysis where mcbayes was applied for a single-trait model, rtbv,pgbv was comparable with that of multi-trait analysis for high-heritability trait a while it was significantly decreased for low-heritability trait b which was highly correlated with trait a . for trait c which had same heritability as trait b but was genetically independent of trait a , multi-trait mcbayes analysis gave the accuracy comparable to single-trait mcbayes analysis when π = <dig> while, when π was varied and inferred, single-trait analysis showed considerably higher accuracy than multi-trait mcbayes and varbayes analyses as shown in table
 <dig> and table
 <dig>  the prediction with single-trait analysis was almost unbiased in data i, but that was likely to be biased in data ii with btbv,pgbv much deviated from  <dig> especially when π was varied and inferred.

in data iii with missing phenotypes, which was derived from data i by removing some phenotypic records, rtbv,pgbv was decreased for all traits in all methods due to the smaller sample size in comparison with data i . the rate of decrease in rtbv,pgbv was greater for traits b and c than a as the greater reduction of the sample size was made in b and c. multi-trait mcbayes analysis provided higher prediction accuracy than multi-trait varbayes analysis for all traits except for trait c withπ varied and inferred. for trait b, multi-trait analysis showed higher prediction accuracy than single-trait analysis, but gave less accurate prediction for trait c. for the bias of predicted gbv, btbv, pgbv, the mcbayes analysis with π = <dig> was almost unbiased for both multi-trait and single-trait analyses, where btbv, pgbv ranged  <dig>  to  <dig> , although the standard error of btbv, pgbv was increased for low-heritability traits b and c, for which the mcbayes analyses with π varied and varbayes showed much biased prediction.

we listed rtbv, pgbv and btbv, pgbv obtained by cross-validation conducted in a population of the 1001st generation of data i as well as ry,pgbv and by,pgbv, correlation between predicted gbv and phenotype and regression of phenotype on predicted gbv, in table
 <dig>  the prediction accuracy evaluated with cross-validation was considerably higher than that evaluated with a test population in the next generation, with the prediction bias being similarly for both evaluated with cross-validation and use of a test population. the relative merits in performance of prediction between the methods were also similar for both evaluations. it was shown in table
 <dig> that the relational expression, rtbv,pgbv = ry,pgbv/h <cit> , held with h being a square-root of heritability and that btbv,pgbv was almost the same as by,pgbv.

averages and standard errors evaluated with 10- fold cross-validation are listed based on  <dig> replicates of simulated data in data i are listed for prediction accuracy, rpgbv,tbv, and bias, bpgbv,tbv, as well as correlation between phenotypic value and predicted gbv, ry,pgbv, and regression of phenotypic value on predicted gbv, by,pgbv , of each trait. for the settings of prior probability that a snp has zero effect, π, see table
 <dig> 

correlation coefficients between predicted gbvs of trait a, b and c were listed in table
 <dig> for multi-trait mcbayes and varbayes analyses and single-trait mcbayes analysis in all datasets as well as the correlation coefficients between simulated breeding values  of three traits in the 1002nd generation. although the correlation of simulated breeding values between traits a and b was expected to be  <dig> , the actual correlations obtained were biased upwards:  <dig>   and  <dig>   in data i  and data ii, respectively. multi-trait analysis could better estimate these correlations compared to single-trait analysis as seen in the correlation between predicted gbvs between traits a and b. for trait c which was genetically independent of a and b, the correlations between predicted gbvs for traits a and c and traits b and c did not significantly deviate from zero .

averages and standard errors are listed based on  <dig> replicates of simulated data in data i and data iii and  <dig> replicates in data ii. simulated bv indicates simulated breeding values, where expected correlations are  <dig> ,  <dig>  and  <dig>  for trait-pairs a-b, a-c and b-c as listed in parentheses. in data iii, correlations between simulated breeding values are the same as those in data i.

discussion
in this study, we proposed bayesian methods for simultaneously predicting gbvs for multiple traits, where two computational procedures were devised using mcmc iteration and variational approximation, referred to as mcbayes and varbayes, respectively. a bayesian model for simultaneously analyzing multiple traits was obtained by extending a bayesian model for single-trait genomic selection proposed by
 <cit>  and
 <cit>  to multi-trait case. we introduced the prior probability that a snp has zero effect, π, and accordingly, mcbayes with π fixed at  <dig>  meaning that all snps are included in a model as covariates, constructs a model for multi-trait gbv prediction in a similar manner to bayesd. on the other hand, the mcmc procedure of mcbayes with π variable and inferred from the data is not exactly the same as that of bayesdπ, where a prior distribution of the variance and covariance matrix of snp effects, Σgl, is assumed to be independent of whether the snp is included  or excluded from the model in mcbayes, as seen in , while it is dependent onγl and takes different forms for γl =  <dig> and γl =  <dig> in bayesdπ. this modification allows mcmc iteration of mcbayes to be performed with only gibbs sampling.

in the simultaneous analysis of multiple traits for constructing a gbv prediction model, the computational burden greatly increases depending on the number of analyzed traits in comparison with single-trait analysis. we developed a variational approximation procedure, varbayes, for mcbayes to reduce the computational time for multi-trait analysis. in varbayes, the joint posterior distribution of parameters was approximated by a factorized function, each component of which approximated marginal posterior distribution of each parameter and was referred to as a variational posterior. variational posteriors were shown to be well-known distribution functions such as normal or inverse wishart that could be derived by simple non-mcmc based numerical iteration.

in genomic selection, it is important to construct a model that enables accurate prediction for gvbs. therefore, precise point estimation of the model parameters is more relevant rather than the construction of their posterior distributions. accordingly, the evaluation of loss of prediction accuracy with varbayes in comparison with mcbayes would be suitable for the evaluation of approximation accuracy of varbayes. using simulation experiments, we investigated the performance of the prediction model constructed with multi-trait analysis compared with single-trait analysis as well as the model constructed using variational approximation. moreover, the performance of multi-trait analysis in the case of missing phenotypic records commonly occurring in the treatment of the actual data of multiple traits were evaluated based on the results of simulations. these points are discussed below including the computational time and the possible extension of prediction model considering polygenic effects.

increase in accuracy for gbv prediction with multi-trait analysis
we evaluated the increase in prediction accuracy with multi-trait analysis in comparison with single-trait analysis using the datasets without missing phenotypes, data i and data ii . for trait a having heritability  <dig> , multi-trait analysis and single-trait analysis made no difference in the prediction accuracy with mcbayes. therefore, the advantage of multi-trait analysis over single-trait analysis in predicting gbv is negligible for high-heritability traits. however, we anticipate the increase in accuracy with multi-trait analysis for low-heritability traits utilizing correlations with high-heritability traits. actually, for low-heritability trait b with heritability  <dig> , which has highly correlated with trait a , prediction accuracy was increased with multi-trait analysis. as trait c was not genetically correlated with trait a, the accuracy of predicting the gbv of c was not improved with multi-trait mcbayes analysis. the accuracy of predicted gbv of trait b was also increased with multi-trait varbayes analysis in data i and data ii in comparison with single-trait mcbayes analysis while the prediction accuracy of trait c was lower with multi-trait varbayes analysis . the genetic correlations between traits a and b were better estimated with predicted gbvs in multi-trait analysis than in single-trait analysis as shown in table
 <dig>  therefore, it can be concluded that low-heritability traits  are better predicted for gbvs utilizing their correlations with high-heritability traits , if any, with multi-trait analysis. however, the benefit of multi-trait analysis would be subtle for high-heritability traits. a similar finding was also reported in
 <cit> . for uncorrelated low-heritability traits such as trait c, it is likely that the prediction using multi-trait analysis with π varied and inferred is less effective in comparison with single-trait analysis. therefore, multi-trait analysis with π fixed at  <dig>  which allows highly accurate prediction for correlated traits while retaining prediction accuracy comparable with single-trait analysis for uncorrelated low-heritability traits, would be a suitable method of choice for multi-trait genomic selection.

approximation accuracy of variational procedure for mcmc estimation
generally, constructing a gbv prediction model with mcmc estimation based on genotypic records for tens of thousands of snps and phenotypes for hundreds of individuals requires considerable computational time even for single-trait cases. much more computational burden would be imposed in constructing a model in multi-trait analysis, depending on the number of traits of interest. therefore, we proposed a computationally cost-effective method, varbayes, approximating mcmc based method, mcbayes, using a variational approximation procedure.

simulation experiments showed that the prediction accuracy was lower with varbayes than with mcbayes in multi-trait analysis but the rate of loss of accuracy was not remarkable and was less than  <dig> percent for traits a and b under the same setting of π while it was greater for c . the prediction accuracy for trait b correlated with high-heritability trait a was still higher with multi-trait varbayes analysis than with single-trait mcbayes analysis indicating that varbayes could well utilize the information on the correlation structure in multiple traits. actually, multi-trait varbayes analysis could better capture the genetic correlation between a and b than single-trait mcbayes analysis .

the computational time was greatly reduced for multi-trait varbayes analysis in comparison with multi-trait mcbayes analysis. we carried out all computations using a fortran program written to implement multiple-trait analysis on a computer having two cpus each with a quad-core processor . in data i, where  <dig> replicates of datasets each including genotypes of  <dig> snps for  <dig> individuals were simulated, varbayes took only  <dig> minutes with π fixed and  <dig> minutes with π varied for  <dig> times of model constructions while the computational time for mcbayes was respectively  <dig> and  <dig> minutes. therefore, the average computational time required to construct a prediction model for each dataset in data i was less than  <dig> seconds for varbayes and was more than  <dig> minutes for mcbayes. for a larger data, data ii, that included  <dig> replicates of datasets each consisting of genotypes of  <dig> snps for  <dig> individuals, the computational time was  <dig> and  <dig> minutes for varbayes with π fixed and π varied, respectively, and the time for mcbayes were increased to more than  <dig> hours with the average computational times for each model construction being about  <dig> minute for varbayes and more than  <dig> minutes for mcbayes. in cross-validation process in which a total of one thousand repetitions of model constructions were performed in data i, the computational time was about 3days with mcbayes while varbayes completed the analysis within only  <dig> hours.

taking computational time and prediction accuracy into account, varbayes is considered a useful method for multi-trait genomic selection, which can rapidly construct a prediction model that is less accurate than that with the mcmc-based method for multi-trait analysis, but is more accurate than that with single-trait analysis for correlated traits. the usefulness of varbayes would be more remarkable for simultaneous prediction of gbvs of a large number of traits based on a huge number of snps where the application of an mcmc-based method might be prohibited.

multi-trait analysis of dataset with missing phenotypes
in data iii, we simulated the datasets under the same condition as data i except that some phenotypes were assumed to be unobserved. in short, we assumed that phenotypes of traits a, b and c were not available for  <dig>   <dig> and  <dig> individuals, respectively, in a total of  <dig> individuals with only  <dig> individuals having the phenotypes of all three traits. in multi-trait analysis, missing phenotypes of individuals can be estimated with their observed phenotypes of other traits using , which indicates that residual effects of missing phenotypes can be restored from those of observed phenotypes. when the model fitting is successful for observed phenotypes, the residual effects of the phenotypes are well estimated by subtracting snp effects and other fixed effects from the phenotypic effects, and those of missing phenotypes are suitably obtained by  utilizing the environmental correlation  between observed and missing phenotypes. therefore, by assuming non-zero environmental correlation between traits , the loss of prediction accuracy caused by missing phenotypes was anticipated to be less with multi-trait analysis than with single-trait analysis. we expected that, in data iii, the prediction accuracy of trait c, environmentally correlated with trait a , was maintained higher in the presence of missing records for some phenotypes using multi-trait analysis in comparison with single-trait analysis. however, the rate of loss for the prediction accuracy for trait c was similar between multi-trait and single-trait analyses as seen in the comparison of the prediction accuracies between data i and data iii . the utility of implementation of  for imputing missing phenotypes in the process of multi-trait model construction remains unclear in the settings of simulation adopted here.

model extension by including polygenic effects
we can modify the bayesian model  by including polygenic effects as follows;

  yi=xib+∑l=1nγluilgl+vi+ei, 

where vi is a vector of polygenic effects for multiple traits and assumed to follow a multivariate normal distribution, vi ~ n with Σv being a variance-covariance matrix of polygenic effects. the polygenic effects for all individuals of a training population and a test population are collectively denoted by v, then the variance-covariance matrix of v can be expressed as a ⊗ Σv, where a is additive genetic relationship matrix for analyzed individuals, computed from the information of pedigree or markers. when the low-density markers are used for the analysis, a considerable portion of genetic effects could not be captured by markers. accordingly, if pedigree information is available, inclusion of polygenic effects estimated based on pedigree is beneficial in predicting breeding values for genomic selection. the revised model  can be similarly treated by mcbayes and varbayes as the model , where estimation steps for additional covariates and parameters, v and Σv, can be easily implemented in the procedures of bayesian multi-trait model construction using mcmc iteration and variational approximation. when no pedigree information is available, a is computed from marker information as a genomic relationship matrix. however, the model  includes all available markers as covariates, resulting in redundantly using the same marker information in the model fitting. in the availability of high-density snp markers, which is the case for some species of animals and plants currently, the genetic relationships between individuals can be well captured by markers themselves in the multi-locus model , the benefit from the inclusion of the polygenic effects in the model would be subtle
 <cit> .

CONCLUSIONS
in this study, we described a statistical model for bayesian simultaneous prediction of gbvs in genomic selection targeting multiple traits and devised an mcmc-based method and a computationally cost-effective method utilizing the variational approximation procedure, referred to as mcbayes and varbayes, respectively, to estimate parameters included in the model. the results of simulation experiments showed that the multi-trait analysis that could utilize the correlation structure between traits allowed more accurate prediction of gbvs for correlated traits compared to single-trait analysis that treated each trait separately, where, for low-heritability traits correlated with high-heritability traits, the prediction accuracy for gbvs was remarkably improved with multi-trait analysis. although the prediction accuracy with varbayes was lower than that with mcbayes in multi-trait analysis, the rate of loss in accuracy was moderate and the accuracy for correlated low-heritability traits was still higher with varbayes analysis compared to single-trait analysis. considering the benefit of greatly reduced computational time, varbayes was considered to be a practical method for predicting gbvs in multi-trait genomic selection.

competing interests
the authors declare that they have no competing interests.

authors' contributions
th devised bayesian prediction methods for the genomic selection of multiple traits, developed a program for simulations and drafted the manuscript. hi assisted in developing a program and drafted the final manuscript. both authors read and approved the final manuscript.

supplementary material
additional file 1
derivation of full conditional posterior distributions of parameters in a statistical model.

click here for file

 additional file 2
derivation of variational posteriors for parameters in a statistical model.

click here for file

 acknowledgements
this study was supported by the grant-in-aid for scientific research  of japan society for the promotion of science .
