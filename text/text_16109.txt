BACKGROUND
the multiple displacement amplification  reaction allows for single cell sequencing and genome assembly of organisms that cannot be cultured  <cit> . mda is also frequently used to amplify dna from low biomass environmental samples for use in metagenomic sequencing although amplification bias alters the ratio with which individual species are represented  <cit> . during shotgun sequencing, genomic libraries are randomly sampled from a population of molecules; this sampling is biased due to sample content and preparation. such selection bias is even more prominent when mda is used to amplify dna from a single cell  <cit> . the amplified dna has extreme coverage variability and may represent from only a small portion of the genome span up to the complete recovery of the genome  <cit> . sequence independent single primer amplification  allows for sequencing of organisms that cannot be cultured, including single cell bacterial genomes  <cit> , viral genomes  <cit> , and metagenomes  <cit> . selection bias within sispa-prepared sequences also results in extreme coverage variability. the biases in sequence coverage from both approaches lead to an increased probability that rarely occurring sequences will be removed when reads are selected randomly for the purpose of coverage reduction. similar outcomes can also occur due to experimental and sequencing biases, particularly when coverage greatly exceeds what is optimal for assembly. existing simulated multi-de bruijn graph assemblers use iterative assembly at multiple kmer sizes to provide a consensus within variable coverage regions. these tools are affected by the quality and level of coverage variability in the data set and often reduce fragmentation while increasing the quantity of erroneous or duplicative contigs that may obscure sequence representing true overlaps.

the quality of de novo genome assemblies is limited by the quality and quantity of the input sequences. without an available reference sequence, the consensus generated by de novo assembly can be validated only in the presence of deep and high quality overlaps. large quantities of sequence data result in greater coverage and more contiguous regions of high confidence overlaps; however, when input sequences contain an extremely high level of redundancy, it may necessitate greater computing resources  that are not readily available to many users.

reducing extremely variable base coverage of reads allows them to be used more efficiently by standard bacterial genome assembly algorithms. the previously published algorithm, diginorm, used rmkf values to predict each read’s coverage, accepting reads until they approach a user-determined cutoff  <cit> . additional studies have explored the use of bin separation in coverage-reduced data sets to facilitate memory-restricted assembly of deeply sequenced metagenomic datasets  <cit> . for implementation of coverage normalization within extremely variable data sets, additional functionality is required to randomize reads targeted for selection, maximize the retention of two-sided mate pairs and give preference to the most unique sequences.

below, we present a novel algorithm, neatfreq, for reducing large sequence data sets to uniform coverage, leading to consistently high quality representations of true target sequence using a traditional olc assembler. the algorithm increases the selection of true, low frequency sequences from a read set which has had maximal false low frequency mers  removed. for the purpose of this study, kmer normalization is used to separate these false low frequency mers by identifying the prevalence of similar, high abundance mers in the data set  <cit> . during this process, high frequency coverage peaks are reduced to produce a data set primed for traditional bacterial genome assembly techniques. reads are binned by a chosen level of retention before selection, after which a user may opt for either random selection or targeted recruitment of the most unique sequences with or without preferential selection of two-sided mate pairs within the set. the pipeline enables the selection of the best available high confidence  consensus sequences from assemblies generated by several olc single- and simulated multi-kmer de bruijn graph assemblers while substantially reducing the requirement for high-end computer resources.

implementation
data
sequences from the following strains were used in the analysis performed by the pipeline. the format and the type of the sequences were a) viral samples:  <dig> h1n <dig> influenza virus single plaque  and bacteriophage f_ha0480/pa <dig> - sispa-optimized titanium  <dig> fragments, derived from a single plaque  <cit> ; b) single cell amplification of multiple bacterial cells: escherichia coli str. k- <dig> substr. mg <dig> and staphylococcus aureus subsp. aureus usa <dig> fpr <dig>  for which both sequence datasets were obtained by mda of dna from single cells that were selectively sequenced from  <dig> isolates, as chosen by highest exon content. these sequences are therefore expected to be of more normal coverage and greater sequence quality than a true single cell sample  <cit> ; c) hmpmda <dig> – illumina paired-end sequences from a true single cell mda sample . all samples except hmpmda <dig> have available reference genomes.

software dependencies
a pipeline for the configurable auto-curation of all sequence preprocessing stages used in this study is distributed with the open source software package. the recommended pre-processing pipeline includes the third party software cutadapt  <cit> , dust  <cit> , quake  <cit> , the bio-playground package  <cit> , sffinfo  <cit> , cd-hit-est  <cit> , clc ngs cell  <cit> , and allpaths-lg  <cit> . the celera gatekeeper program  <cit>  was used for mate-sensitive conversion between file formats with a minimum acceptable sequence length of 40 bp. tools from the mira package were used for fastq file manipulation  <cit> . kmer counting was conducted by the program tallymer from the genometools package  <cit> .

the effect of each preprocessing step on input sequences was captured for all sequencing platform file formats and library types with the assembly quality assessed by rapid assembly using clc assembly cell ver  <dig> . <dig>  <cit> . the performance of the following assemblers was compared using all reads, pre-processed reads, and multiple levels of coverage reduction: velvet-sc ver  <dig> . <dig>  <cit> , idba-ud ver  <dig> . <dig>  <cit> , and spades ver  <dig>   <cit> . all assemblies were run using sequences converted to either fasta or fastq format. velvet-sc was run at multiple kmer sizes . all other assemblers were used with default settings. expected coverage values of input sequences required by velvet-sc were calculated by counting pre-processed query bases aligned to contigs obtained by preliminary clc assembly using a 40% length and 90% identity cutoff.

preparing input files
read selection using this algorithm requires that input data be cleaned of the most identifiable sequencing errors possible, particularly when using the targeted selection method. additional screening and removal of contaminants, particularly from samples obtained from human hosts, may be mandated by ethical or funding restrictions. a suggested pipeline, including a preliminary contaminant check, error correction/kmer normalization, exact de-duplication, low complexity/tandem repeat masking, quality trimming, final contaminant check and adapter contaminant removal is described in additional file 1: figure s1). details regarding pre-processing methods used for this study are available in additional file 2: supplemental methods). all datasets in this experiment used 19-mers for rmkf evaluation.

reference-free coverage normalization pipeline
the coverage normalization pipeline described here is supplied for standalone use, employing user input kmer frequencies, or as part of a pipeline containing methods for the formatting of all reads and de novo calculation of their kmer frequencies. the novel coverage reduction algorithm calculates rmkf values using reports from genometools’ tallymer  <cit>  and compares them to a rmkf cutoff value provided by the user. reads with a rmkf =  <dig>  and those with less than k  non-ambiguous bps, are removed from the dataset. rmkf values are calculated for each sequence and compared to a cutoff provided by the user. each read is placed into one of a count, z, of retention bins  denoting the percentage of reads to be retained, as follows: 1) all reads with rmkf less than or equal to the cutoff are placed in the 100% retention bin; 2) reads with rmkf greater than the cutoff are evaluated by the expression, retention bin selection value = *z, rounded up to the nearest integer, and placed in retention bins  from which the denoted percentage of reads are extracted to satisfy the user-specified coverage cutoff . reads with a retention value of less than  <dig> are rounded up and placed in the 1% retention bin. reads from the 100% retention bin  are picked first, followed by progressive selection of reads from the 1%  through the 99%  bins, utilizing either random or targeted selection of unique sequence.

neatfreq pipeline pseudocode
for each input sequence○ if read length, not including ambiguous “n” bps, is greater than kmer size ▪ update to unique read ids, concatenate

▪ calculate kmer frequencies



○ else▪ delete read

▪ format broken pairs dataset as fragments



○ endif



for each concatenated input sequence○  build list of mate pair relationships using unique ids

○ calculate median kmer frequency

○ add sequence id to appropriate “retention bin” by comparing ideal coverage to rmkf



end for each

if bin selection = random○ select all reads from the 100% retention bin

○ for each bin …randomize ids in bin

record ids up to ideal retention count from bin



○ end



elsif bin selection = targeted○ highlight 2-sided mates within bin  <dig> as high priority

○ divide all reads by similarity using cd-hit-est

○ select all reads from the 100% retention bin

○  if a mated read is selected, toggle the status of its partner

○ foreach retention bin ▪ foreach sub-bin cluster calculate ideal count of sequences to extract from sub-bin cluster based on count already selected from retention bin

if tracking mates = yesrandomize the sub-bin cluster id list select from each until the ideal count is reached.



elsif tracking mates = noselect maximal sets of 2-sided mate pair relationships within sub-bin cluster

select maximal 1-sided mates whose partner has already been selected

select maximal 1-sided mates whose partner has not yet been evaluated

select fragments and 1-sided mates whose partner has been removed

toggle status of all of selected mates



▪ endif



▪ endfor



○ endfor



endif

extract selected ids from relevant input libraries to maintain fragment and mate pair relationships

 parse 2-sided mates from fragment-only runs using read ids



random selection
the number of reads selected from each bin is determined by the expression: ideal read count from bin = * . sequence ids are randomized within all bins prior to selection. a random selection of reads from all bins, in inverse proportion to their original abundance, ensures a normalized and uniform selection from all regions of the sequenced genome. if the input sequences contain paired-ends, selected reads can be separated into valid pairs and single-end fragments in the available pipeline, though any two-sided mate retention is purely random and depends on the level of reduction requested.figure  <dig> 
schematic illustration of sequence selection by neatfreq pipeline. a). blue blocks represent fragment-only reads. the left side of the figure shows  <dig> retention bins  created by the ratio between the rmkf of the read and the cutoff input by the user. the random bin selection method extracts a random subset of reads from each bin up to the count denoted by its retention level and the number of reads available. b). the targeted bin selection method, run as fragment-only sequences, is illustrated on a 20% retention bin . within each retention bin, reads were clustered by the cd-hit-est alignment  <cit>  program based on similarity and sorted by uniqueness, or the population of the sub-bin cluster . illustrated here, reads from each intra-bin sub-cluster were selected randomly from within each cluster approached within a bin. c). green blocks represent forward mates and red blocks reverse mates, with dark green brackets indicating 2-sided mate relationships. when applying the targeted bin selection method to the same bin containing mate pairs , analysis is identical to that described for fragments except that the retrieval of 2-sided mates across all bins, and their sub-bin clusters, is prioritized. note that highly unique clusters containing only fragments are still given priority in selection.



targeted selection
emphasis is placed on extracting unique sequences from each retention bin to increase the chance of recruiting true low abundant reads which remain after pre-processing. after all sequences from the 100% retention bin are selected, targeted selection begins by clustering reads within each of the remaining bins using the cd-hit-est algorithm   <cit> . bins are approached one-by-one as in the random bin method and selection from within each bin proceeds iteratively from the most unique sub-bin clusters  to the least unique , as determined by the size of homologous clusters created within each retention bin. selection from homologous intra-bin clusters occurs by: 1) calculation of ideal read counts for intra-bin clusters with the expression:  = /; 2) sorting of intra-bin clusters by size, from most unique to least; 3) randomization of reads within each intra-bin cluster and maximal extraction from each bin up to s, and; 4) update of ideal bin and intra-bin cluster extraction counts based on the selected read counts prior to the iterative processing of the subsequent bins . if the selection was performed without tracking mates for paired-end sequences , the mates for the selected reads can be parsed after reduction as described for the random method above.

when input includes paired-end reads and the targeted bin selection method is chosen, reads representing one side of a mate pair relationships are tracked by their selection status and the status of their mate. two-sided mate pair relationships found within a single bin or intra-bin cluster are given the highest priority during selection, followed by mated reads with unresolved one-sided relationships. during the initial recruitment of all reads in the 100% retention bin, one-sided mates are toggled to indicate the possible recruitment of both pairs in the two-sided mate relationship. subsequently, as selection within the 1%  bin proceeds, new one-sided mates are evaluated by their corresponding mate status and are preferred for selection if their mate has previously been selected . one-sided mates whose pair has already been discarded are reduced to the priority of fragments.

assembly statistics
all assembly statistics evaluate contigs greater than 500 bp only to comply with ncbi assembly submission requirements. assembly coverage statistics were calculated. the successful retention of low coverage sequence in following dataset reduction is evaluated using the change in represented reference bases when aligned to the shredded consensus sequence . average contig coverage was calculated as a weighted mean of means across all contigs based on contig length. changes in the sequencing span  and assembly span  at each pre-processing stage were calculated by aligning either query sequences or the assembled output from each stage of pre-processing to the available reference. contig and sequence alignments were evaluated by aligning to the reference at 40% length and 90% identity cutoffs with contigs shredded to 7999 bp with 49 bp overlaps. compute time was captured using system time on a single host machine with  <dig> cpu and 256 gb ram. memory usage was monitored by ‘ps’ with runs executed in isolation on a single host.

RESULTS
short-read assembly requires deep coverage to in order to sufficiently sample the source genome since shotgun sequencing is subject to random sampling variation, amplification and systematic sequencing biases. some of the recently developed random-primed laboratory techniques like mda and sispa enable whole genome sequencing of organisms that cannot be cultured, but have the caveat of highly variable sequence coverage due to amplification biases  <cit> . as described by brown et al.  <cit> , the relationship between the rmkf of each read and its true coverage can be estimated with a 1% error rate on simulated sequences. production of the longest valid consensus span requires sufficient coverage across the entire genome; however, due to selection, amplification and sequencing biases, it is likely that certain regions yield far more coverage than others, especially with extremely deep sequencing coverage .

prioritized selection of true low coverage sequences
the most common reasons to normalize read coverage are to: eliminate duplicate reads, minimize sequence errors, recruit more reads within low coverage regions and minimize computational and memory resources required for assembly. traditional olc bacterial assemblers like newbler and celera wgs prefer 40-80-fold of uniform coverage across a single genome. both algorithms often fail during consensus resolution of genomic regions with particularly high coverage peaks, as shown by the failed experimental single cell sample assemblies missing in additional file 3: table s <dig>  the reduction to normalized sequence coverage was shown to promote completed assembly of the experimental hmpmda <dig> sample in contrast to the failed assembly when more sequence data was used . the degree to which reads from each of the retention bins are represented in the final pool varies with the coverage complexity of the dataset and the rmkfcutoff value supplied by the user. kmer frequencies are not merged for forward and reverse compliments, so rmkfcutoff correlates empirically to approximately half of the expected output sequence coverage when using the random bin. as each retention bin can contain reads with varied abundance, the likelihood that less abundant sequences are not selected is high when using the random bin selection method, particularly with extremely variable coverage input sequences. both random and targeted bin selection methods discriminate against the selection of repetitive sequence because their representative kmers are overabundant in the overall data set and recruited at a lower priority. as illustrated in figure 2a, reads were found to be recruited at less than normal coverage within regions of the reference identified as repeats using repeatfinder  <cit> .figure  <dig> 
comparison of random and targeted neatfreq selection methods on sequence coverage. a). elevated kmer counts within repetitive regions cause over-reduction using an rmkf cutoff. the genomic regions labeled with stars indicate regions identified as repeats by repeatfinder  <cit> . reads from repetitive regions are placed in low selectivity bins due to the high frequency of similar mers within the data set. therefore, over-reduction occurs at multiples directly related to the count of repetitive regions. b). this histogram shows the retrieval of sequences at different rmkf cutoff levels when using each of the bin selection methods. aligned sequence coverage distribution is shown for the first  <dig>  bp of the s. aureus genome using query sequences selected by random  and targeted  methods. the targeted method is more effective at recruiting low coverage regions resulting from single cell amplification bias in variable coverage region, including 0-fold regions. the x-axis shows genomic coordinate from the reference used for mapping the extracted reads and the y-axis shows the level of coverage at each genomic position. c). the histogram gives zoomed view of the low coverage area highlighted by an arrow in figure 2a . alignment histograms show that the targeted algorithm, in contrast to the random selection, retains the low coverage areas in the variable dataset, resulting in an increased sequencing span. d). coverage histogram of reads aligned to the largest h1n <dig> influenza genomic reference segment . random selection from the entire dataset  was performed to a count of reads equal to that used by targeted selection at rmkf cutoff = <dig>  this random selection from all reads is the most subject to input coverage variability and fails to reduce deep spikes to generate coverage levels compatible with olc assembly.



changes in assembly and sequencing spans showed that the pre-processing steps caused the loss of some reference bases, particularly when aggressively removing erroneous reads by read correction . despite lost reference bases in reads, preliminary read processing to remove false low frequency mers was shown to improve the inclusion of low coverage regions in the final assembly, particularly when handling datasets with many low coverage regions or with a wide range of coverage across the genome span. using all pre-processed sequences as input, reduction to assembly-ready coverage removed as much as 90% of the reads for samples found to have excessive coverage , while minimally removing true reference bases within low coverage regions .

improved selection for low coverage mda sequence or scaffolding
random bin selection used less memory and was significantly faster than the targeted alternative, making it an ideal option for large prokaryotic genome assemblies with only moderate coverage variability. for larger datasets, newbler assemblies used less system time and ram for all assembly and processing after data reduction was performed by the recommended preprocessing pipeline or following coverage normalization . the effects of random and targeted bin selection algorithms on the coverage reduction and normalization of the over-sequenced h1n <dig> influenza viral plaque sample were compared to all unprocessed reads, pre-processed sequences, and a completely random subset of the pre-processed data set. targeted selection from bins minimized the loss of true low coverage sequences when evaluating samples with pronounced coverage differences . the likelihood that some low abundant sequences are not selected by random bin selection was linked to sequencing coverage, and true reference base-pairs may be removed within low coverage regions, inhibiting the extension of an assembled consensus through that region of the genome . targeted selection from retention bins by homologous clustering increased the likelihood that reads coming from low coverage regions were represented in the selected output pool, resulting in fewer missing reference bases compared to random selection methods. in this context, a completely random selection of the reads failed to remove problematic coverage spikes, while the targeted selection  from homologous sequence clusters retained more reads from low coverage regions, resulting in an improved genome span as evaluated by comparison to a reference genome . targeted reduction displayed the best approximation to true genome span for all samples requiring coverage reduction by recruiting more reads to low coverage regions . a comparison of bin-based selection for reduced coverage to bin-less random selection from all reads was performed, showing a tendency of the latter process to follow the coverage distribution of the input dataset and a failure to remove coverage spikes, which inhibit olc assembly .

targeted selection using mate tracking recruited 10-20% more two-sided pairs than when reads were initially selected from bins as fragments and followed by the extraction of their mates . the prioritized selection of mate pairs was shown to be successful at creating improved scaffolds, linking fewer contigs . this effect was more dramatic in the olc assemblies than those generated by the scaffolded multi-de bruijn graph equivalent. here, scaffolding of both control mda samples  was improved despite losing as much as 45% of the two-sided mate information.

validation of coverage normalization pipeline on controls
samples amplified by mda and built from multiple cells  saw the largest jump in the loss of base coverage  using allpaths read correction, although the resulting clc assembly of these reads aligned to the reference sequences at levels comparable to spades assembly of all reads . samples requiring additional coverage reduction, specifically e. coli as compared to s. aureus, assembled into a more contiguous consensus at closer approximation to the reference genome span. similarly, for the experimental single cell sample, hmpmda <dig>  in which the entire genome was not fully represented, average coverage decreased as low quality bases were trimmed or corrected out of the assembled data pool and highly abundant spurious contigs were removed from the assembled output . a comparison of bin selection methods for sequence selection showed an increased number of formerly low coverage regions receiving at least 5-fold coverage following reduction with the targeted method across all samples except hmpmda <dig> . in this case, random reduction collapsed the overlap graph and produced a consensus at less than half the predicted size, resulting in inflated coverage values. spades assembly of the deeply sequenced control mda e. coli sample yielded the most reference bases when using all reads, but did so at the cost of generating approximately  <dig> kbp of nearly duplicative contigs containing errors , in these cases, spades output consensus lengths were found at 108% and 1048% of expected genome spans for e. coli and bacteriophage f_ha0480/pa <dig> samples, respectively .figure  <dig> 
comparison of
e. coli
mda assemblies to the expected  genomic span. newbler assembly with all reads  fails on all samples during consensus resolution . spades is able to complete an assembly using all reads with few missing reference bases in the assembly but the output also generates excessive redundant and spurious contigs. pre-processing reduces sequences allowing the completion of olc  assembly and yields genomic spans by both newbler and spades which are most similar to the ideal  assembly. the newbler assembly from coverage-reduced data is also closer to the reference span and verifies  the assembly produced by the spades following preprocessing alone.



for the bacteriophage and influenza samples with a short genome span, as well as the idealized high quality mda e. coli sample, the cumulative metrics contig n <dig>  consensus span, difference from reference genome span, extent of missing reference bases in contigs and the percent of contig duplication suggest that sequences selected by both random and targeted methods yield assemblies that are improved or highly similar in quality to the assembly of all reads . moreover, these assemblies yielded consensus spans at closer to the reference genome size while increasing the inclusion of reads from lower coverage regions, specifically those found at a minimum of 5-fold coverage, and reduced the fragmentation of the output consensus . as coverage is calculated by the alignment of the input reads to the assembled consensus, average coverage was shown to increase when low quality and contaminant sequences were removed from the datasets. changes in the sequencing  and assembly span  for individual samples showed that despite removing true reference bases in reads during neatfreq reduction compared to the pre-processed input, the resulting assemblies produced an increased  or competitive  assembly span . when deep coverage differences were normalized by random or targeted coverage reduction, newbler generated assemblies of comparable quality with less duplication and fewer spurious contigs relative to spades and other simulated multi-de bruijn assemblers from all samples.

the successfully executed newbler assemblies also showed a comparable count of 0-fold  reference bases as observed from the best-simulated multi-de bruijn results for highly variable inputs. unlike spades and velvet-sc, the newbler assemblies either failed to run to completion when all unprocessed reads were used for high coverage samples  or produced lower quality results prior to the data reduction and coverage normalization . spades used lower peak memory and less processing time than is required for the suggested pre-processing-neatfreq-newbler pipeline for the bacteriophage sample, even when all reads were used as input .

discussion
the novel algorithm described here adapts and extends the earlier methods of digital normalization using kmer frequency analysis by  selecting reads randomly within retention bins using cutoffs set by expected levels of reduction,  providing the optional selection of the most unique sequences in a dataset by comparing the contents of scaled retention bins and  offering optional extraction of two-sided mate pairs during the reduction of sequences to obtain normalized coverage. effective pre-processing reduces false kmers in the dataset and allows the removal of exact duplicates while minimizing memory use and the obfuscation of alignments due to the presence of superfluous sequences. the reduction of overabundant sequences and spikes in unequally distributed coverage across a target genome were found to build improved consensus sequences when assembled by both olc and simulated multi-de bruijn graph algorithms. the targeted bin selection approach offers a novel method for the recovery of rarely occurring sequences critical to samples with extreme coverage variation such as those generated from the sequencing of randomly amplified genetic material.

when large data sets inhibit processing due to algorithmic or resource restrictions, the ideal starting point in reducing coverage is the removal of sequencing errors. the exclusion of erroneous kmers results in the improvement of assemblies when samples are over-sequenced, but exhibit no significant variation in coverage . the goal in each de novo assembly task must be to develop an effective strategy to remove uninformative sequences in a way in which the biases inherent to individual sample are best addressed.

the choice between random and targeted bin selection methods for normalization of extremely variable sequence data is dictated by the nature of the sample. the random bin selection method is preferable to taking completely random subsets of data in all cases where deep coverage spikes prevent successful assembly . this selection method uses less memory and runs more quickly since it neither tracks mate pair relations nor requires intra-bin clustering by similarity . as such, the random bin selection algorithm is preferable to the targeted method for common sequencing analyses which may utilize deep sequencing, but do not require specialized retention of low coverage regions. by nature of the randomized selection within each bin, the highest population reads within each predicted coverage level are also more likely to be retained in the extracted sequence set when using this selection method. for this reason, the targeted selection method should be preferred for the recruitment of these low frequency kmers for the assembly of extremely variable coverage sequence, such as that found in transcriptomic data sets or prokaryotic sequence exhibiting mda or sispa bias. additionally, the targeted bin selection method may be preferred for its capability of preferential 2-sided mate pair selection at the cost of time- and resource-intensive processing. such targeted selection should be used only with those samples that have been error-corrected by preliminary kmer normalization. this allows for the effective removal of exact duplicates without increasing the output of short, erroneous, or chimeric kmers , and increases the predicted coverage for valid kmers in the kmer graph. as currently implemented, the rmkf-based coverage prediction approach is primarily intended for analyzing data obtained from individual species. should multiple species be present in a data set presented to the neatfreq algorithm, each would reduce to normalized coverage, thus increasing the relative population of any low abundant organisms in the reduced output. in addition, the presence of sequences from multiple species introduces noise in kmer frequency counts, which may result in reduced coverage in the target organism. following reduction, the relative increase in coverage for low abundant contaminating sequence, as compared to target sequence, further facilitates greater contiguity in contaminant assembly for improved identification, recursive removal and reduction. furthermore, the use of these kmer frequency bin selection reduction algorithms with mixed sample data  requires a preliminary binning to separate organisms by taxonomy, gc profiles, etc. for optimal use. these techniques, however, would not be sufficient for the separation of similar strains where normalization of similar kmer profiles would complicate true overlaps within organisms present at different coverage levels.

the large amount of data generated from multiple samples by high throughput sequencing methods necessitates an automated, yet flexible processing pipeline. ideally, the pipeline should perform recursive analysis using several methods of read selection and assembly algorithms, allowing one to choose from the most improved genomic consensus sequences. by tracking the input sequence metadata and the subsequent assembly results, a user or program can quickly evaluate the effects of specific pre-processing steps on the assembly quality, particularly when a reference is available. furthermore, automation of sequence pre-processing and coverage reduction allows rapid processing of samples while conforming to reduced computer memory and data storage resources available to most users.

the pipeline described here has a number of other uses, including the preparation of illumina sequences for the correction of lower quality, longer read length sequencing types including those from pacbio to ensure fewer erroneous bases in the final assembly. the tool can also be useful in the de novo assembly of transcriptome sequences including those of low abundance isoforms with the caveat that no differential expression analysis is possible due to the inherent normalization of sequence coverage. however, in the future, an implementation of extended read tracking could allow for automated de novo gene finding and expression analysis in rna-seq projects. as currently implemented, the fragment-only pipeline can be used to process sequences and genomes of all sizes. processing using paired-end reads should be capped at  <dig> million pairs due to lack of parallelization in the execution of some stages in the pipeline. the planned improvements incorporating multi-threading and multi-processor  options and the parallel processing of bin calculations in a cluster environment  would extend its utility in processing larger datasets, including higher eukaryotic samples. additional improvements could be made to compare the assemblies produced by the pipeline to known insertion sequence elements in order to detect and resolve known issues of sub-normal recruitment of repetitive sequences. the software can be trained with the expected kmer distributions from multiple related reference sequences for metagenomic data or a single reference for individual novel samples. implementation of the algorithms and pipeline as described is valuable in delivering high quality assemblies from high-density data, obtained from prokaryotic and small eukaryotic species containing extremely deep coverage differences.

CONCLUSIONS
the single cell amplification of novel organisms whose genome span is unknown and contains sequences of extremely variable coverage requires approaches that emphasize data reduction and coverage normalization prior to their use with high-confidence olc assemblers such as newbler and celera wgs to generate more valid assemblies of target genomes. in this study, we have shown that using olc methods with a reduced set of high quality sequences results in conservative assemblies that can be used as a standard to validate results obtained from more aggressive assembly programs that require all reads as input. simulated multi-de bruijn graph-based assemblies using multiple kmer sizes such as spades, velvet-sc and idba-ud perform well with samples of deep coverage using input sequences that have not been pre-processed. when using all input reads and comparing to the same assemblies using reads reduced by either the random or targeted selection methods, these simulated multi-de bruijn graph assemblers, which expect variable coverage input sequence, are shown to output assemblies with more consistent confidence when compared to the reference genome. pre-processing of input sequence reduced assembly resources and generated assemblies that were less fragmented and contained fewer spurious contigs . verification of the sequencing spans generated by these simulated multi-de bruijn graph assemblers by the concomitant high confidence olc assemblies allowed for the selection of the most valid consensus sequences and minimized time and effort spent for the costly post-assembly analysis  to eliminate contigs of dubious quality. our analysis also demonstrates the utility of extracting mate pairs , when available, and finds that the selection of unique sequences over a wide range of coverage depth may allow for more contiguous assemblies with improved scaffolds using commonly problematic data sets.

availability and requirements
project name: neatfreq

project home page:https://github.com/bioh4x/neatfreq

operating system: unix/linux

programming language: perl

other requirements: 3rd party utilities 

license: gnu gpl 2

any restrictions to use by non-academics: none

additional files
additional file 1: 
 <dig> supplemental figures described in text.


additional file 2: 
supplemental methods. a summary of supplemental methods for neatfreq preprocessing.

additional file 3: 
supplemental tables of assembly and scaffold statistics described in text.




competing interests

the authors declare that they have no competing interests.

authors’ contributions

jm created the novel software, administered tests and drafted the manuscript and figures. pv and is contributed to the methods used in the algorithm and the writing of the manuscript. bm proposed and coordinated the study, performed analysis of experimental single cell data and, revised the manuscript. df facilitated phage sequencing data, contributed to sispa preparation concepts, and revised the manuscript. rl participated in the coordination of the project, interpretation of mda sequence bias, and revised the manuscript. all authors approved the final manuscript.

