BACKGROUND
illumina whole-genome expression beadchips have been widely adopted for high-throughput gene expression analysis in the past few years. most popular and comprehensive of these are the humanwg- <dig> and mousewg- <dig>  beadchips. each sentrix- <dig> beadchip allows the interrogation of six rna samples in parallel and produces data that can be treated as coming from six independent microarrays. physically, each sentrix- <dig> beadchip consists of twelve equally-spaced strips of beads . each pair of adjacent strips comprises a single microarray and is hybridized with a single rna sample. in the first generation of human- <dig> and mouse- <dig> beadchips, the first strip of each array was populated mainly with probes for curated refseq transcripts while the second strip was populated with probes for less well-annotated transcripts from a variety of databases including refseq, riken fantom, gnomon and unigene  <cit> .

normalization of microarray data is an essential analysis step which removes unwanted technical variation and ensures that expression values from different arrays are comparable. normalization needs to adjust not only for technical variation between rna samples but also for systematic measurement errors associated with the hybridizing and scanning steps. in the case of illumina beadchips, normalization needs to adjust for technical variation within each beadchip, including spatial variation across the slide.

all normalization strategies proposed so far for illumina beadchips carry out normalization at the array level, meaning that data from the two strips comprising each array are combined before normalization is conducted. the simplest and most popular strategy is to log-transform the probe-wise expression summaries for each array which are then quantile normalized between arrays  <cit> . this strategy normalizes the arrays, but fails to take any account of variation between the two strips comprising each array, despite the fact that the physical spacing between strips is the same as the spacing between arrays.

this study illustrates by way of a data example that between-strip technical variation can be substantial. we demonstrate that normalizing at the strip level rather than at the array level can effectively remove this between-strip variation, improve the precision of gene expression measurements and discover more differentially expressed  genes. many of the extra genes found are functionally closely related to the knockout genes in the experiment.

RESULTS
strip-level variation
as an illustrative case study, we consider data from an experiment involving  <dig> rna samples hybridized to illumina mouse- <dig> version  <dig>  beadchips. the data were generated as part of a study designed to dissect molecular components of the nf-κb <dig> pathway which mediates the immune response to pathogen invasion. the experiment studied the response to lps stimulation in macrophages from wild-type, nfkb <dig> knockout and tpl <dig> knockout mice. for each of the three genotypes, rna samples were taken prior to lps stimulation and  <dig> hour and  <dig> hours after lps stimulation, making a total of nine experimental conditions . two biological replicates were conducted of the entire experiment, making a total of  <dig> rna samples hybridized to three beadchips. illumina beadstudio software was used to output a summary probe profile file containing a raw intensity value for each probe on each array of the experiment. the arrays contain  <dig>  probes, so the raw data is a  <dig>   <dig> ×  <dig> matrix of intensities.

the same problem can be seen even more vividly by comparing replicate arrays. an ma-plot compares two arrays by plotting probe-wise log-ratios between the arrays against average log-intensities. the ma-plot in figure  <dig> compares the third array in the experiment to the other array hybridized with rna sample from the same source. both arrays hybridize to the biological sample tpl2-/-  <dig> mins. the plot shows that first-strip probes are systematically lower on the first replicate whereas the second-strip probes are systematically higher. this systematic bias has been introduced by the normalization. the bias is substantial, with the strip- <dig> and strip- <dig> bands in figure  <dig> separated by more than one unit of the vertical axis, corresponding to a 2-fold discrepancy in intensity. this lack of alignment between the two strips is clearly systematic and is enormously greater than could arise from random variation. array-level normalization produces here the fiction that the strip- <dig> probes appear generally up-regulated when in reality almost certainly most are not differentially expressed. similar bias can be observed on other replicate pairs of arrays .

a solution to the above problem is to normalize the first and second strips separately. in this approach, quantile normalization is applied twice, once to the  <dig> first strips and once to the  <dig> second strips. this forces all first strips to have the same overall intensity distribution, and similarly for the second strips, but no relationship between the first and second strips is assumed. figure  <dig> displays the distribution of intensities after strip-level normalization. strip-level normalization has the desirable property that the intensity distribution for each strip is equalized across arrays. in particular, the normalized intensities for one strip can no longer be influenced by aberrations on the other strip of the same array.

the success of strip-level normalization can be seen by comparing replicates, which now show high concordance. figure  <dig> shows the third array and its replicate after strip-level normalization. the strip- <dig> and strip- <dig> bands are now perfectly aligned about the m =  <dig> line, i.e., the expression log-ratios are now randomly scattered about zero for both first and second strips. this shows that the bias related to the physical position of the strips within the arrays has been removed.

between-array precision
the most basic aim of normalization is to increase the consistency between replicate arrays. to examine this, we computed the standard deviation of normalized log2-expression values between replicate arrays for each probe. each of the nine experimental conditions has a pair of replicate arrays, so each pooled standard deviation has nine degrees of freedom. when array-level normalization was used, the median of the probe-wise standard deviations was  <dig> . this implies that replicate expression values have a typical variation up or down by about 11% on the unlogged scale . when strip-level normalization was used, the median standard deviation decreased more than 10% to  <dig> . this corresponds to a 20% increase  in statistical information, equivalent to the gain which would be achieved by increasing the number of microarrays used in the experiment by 20%. since normalization can reduce only the technical component of the residual variability, not the biological component, we can conclude that the technical standard deviation corresponding to microarray precision has been reduced by substantially more than 10%.

differential expression analysis
next we identified probes which are differentially expressed between wild-type and the two knockout lines. significance analysis was conducted using empirical bayes moderated t-statistics  <cit> , a popular method which gains precision compared to an ordinary t-test by moderating the standard deviations across probes. not surprisingly, the increased precision arising from strip-level normalization translates directly into greater numbers of de probes. table  <dig> gives the numbers of de probes between the knockout sample and the wild-type sample at each time point. twice as many de probes can be detected at a 5% false discovery rate after strip-level normalization as compared to the usual array-level normalization. the larger list of de probes after strip-level normalization includes almost all of those found after array-level normalization.

numbers in parentheses are the number of probes which were also found by strip-level normalization.

functional analysis
in the previous section, we have demonstrated that strip-level normalization gives a global and substantial improvement in precision for the microarray data. naturally, the improved precision increases the number of statistically significant genes. figures  <dig> and  <dig> demonstrate the mechanism by which this improved precision arises, by improving the alignment of the strips. we can be confident that improving precision by a proper analysis of the physical properties of the microarrays will in general improve the reliability of our biological results, although specific effects will of course depend on the data set. in this section we confirm that strip-level normalization does indeed return more biologically meaningful results for this particular data.

our functional analysis consists of two parts. firstly we used the functional annotation tool david  <cit>  to look for biologically interesting annotation categories amongst our de genes. secondly, we used the ingenuity database  <cit>  to show that the de genes are enriched for genes known to interact with the genes knocked out in the experiment. in both cases, genes de at the  <dig> min time point were used for the analysis.

consider first the tpl <dig> knockout. at a false discovery rate  cutoff of  <dig> , no david terms at all were found to be significantly enriched in the list of de genes found by array-level normalization. after strip-level normalization, on the other hand, fifteen highly relevant terms were found to be significantly enriched . all fifteen david terms found by strip-level normalization were grouped by david into one cluster of closely related categories. as can be seen from table  <dig>  this cluster relates to the toll-like receptor signaling pathway, exactly the pathway which is being studied in this experiment, and all the terms are of obvious biological relevance. in summary, strip-level normalization returns easily interpretable and highly relevant biological results whereas array-level normalization returns no significant results at all.

the first column is the data source from which terms in the second column come. the third column gives the number of de genes found by array-level normalization which are associated with the term in the same row in the second column. fdr  from the enrichment test for these genes in all the de genes found by array-level normalization is given in the fourth column . the fifth and sixth column are similar with the third and fourth column respectively except that de genes examined are from strip-level normalization rather than from array-level normalization.

now consider the nfkb <dig> knockout . in this case, array-level normalization did manage to find two gene ontology  terms and two other keywords at a 5% fdr, however strip-level normalization found many more terms at much higher significance levels. the only term found by array-level normalization but not by strip-level normalization is "glycoprotein", which is an extremely common keyword, and has no obvious role specific to the particular molecular pathways being studied here. most of the terms  found by strip-level normalization were grouped by david into the same functional cluster relating to cytokine activity and immune response. again, strip-level normalization gave strong, clearly interpretable results, whereas array-level normalization gave very limited results at best.

further evidence of the biological relevance of genes found by strip-level normalization can be seen from a gene interaction analysis using ingenuity pathway analysis  tool. only  <dig> % of genes on the microarrays are known to interact with nfkb <dig>  yet 7% of genes found by strip-level normalization are known to interact with nfkb <dig>  and almost all of these are in fact directly interacting genes . this enrichment for nfkb <dig> interacting genes is highly significant . the enrichment is virtually the same if we restrict to genes found only by strip-level normalization and not by array-level normalization . on the other hand, no interacting genes were found by array-level normalization only.

the rows give respectively genes found by array-level normalization only, strip-level normalization only, both or neither. the second column gives the numbers of genes differentially expressed between nfkb1-/- and wild-type at  <dig> mins found by different normalization methods. the third column gives the numbers of genes interacting with nfkb <dig> in each set  of de genes in the second columns. this interaction could be direct or indirect according to ipa. the fourth columns shows the corresponding numbers of directly interacting genes.

six directly interacting genes were found by strip-level normalization only, and these are shown in an ipa display . three are the transcriptional targets of nfkb1: interleukin  <dig> , interferon regulatory factor  <dig>  and prostaglandin-endoperoxide synthase  <dig> . two of them have a protein-protein interaction with nfkb1: b-cell leukemia/lymphoma  <dig>  and tnfaip <dig> interacting protein  <dig> . tnfaip <dig> interacting protein  <dig>  has a protein-rna interaction with nfkb <dig> 

a literature search confirms that these six genes are direct targets of or associates with nfkb <dig>  il <dig> is required for b- and t-cell growth and differentiation, neuronal and macrophage differentiation  <cit> . inhibition of mouse nfkb protein decreases expression of mouse il <dig> mrna in colonic tissue from mouse exhibiting experimentally induced colitis  <cit> . irf <dig> is a lymphoid/myeloid-restricted member of the irf transcription factor family that plays an essential role in the homeostasis and function of mature lymphocytes. irf <dig> expression in htlv-1-infected cells is driven through activation of the nfkb and nf-at pathways, resulting in the binding of p <dig>  p <dig>  and c-rel to the nfkb <dig> element and p <dig>  c-rel, and nf-atp to the cd28re element within the - <dig> to - <dig> region of the irf <dig> promoter  <cit> . the proto-oncoprotein bcl <dig> is a member of the ikb family and is present predominantly in the nucleus. it acts as an adaptor between nfkb p50/p <dig> and other transcription regulators  <cit> .

this is far from a comprehensive study of the biological results of this experiment. such a study will be published elsewhere, including rt-pcr confirmation of differential expression for selected genes and other follow-up assays. the bioinformatics analysis included here is however more than enough to demonstrate that the extra differential expression detected by strip-level normalization is biologically relevant and not merely a random sample of unrelated probes. moreover the extra differential expression is sufficient to materially change the conclusions obtained.

probe filtering
as demonstrated above, inconsistencies in the relativities between the two strips caused array-level normalization to perform poorly. now we want to investigate if it is possible to alleviate these inconsistencies by filtering out non-expressed probes. probe filtering has been reported to be able to increase the power of detecting de genes  <cit> .

probes with detection p-value greater than  <dig>  on all arrays were deemed as non-expressed probes and filtered out. the intensity of a probe with detection p-value less than  <dig>  will be greater than  <dig> percent of all negative controls  <cit> . in total,  <dig>  non-expressed probes  were identified. as expected, more such probes come from the second strip  than the first strip. however, inconsistencies in the relativities between the two strips clearly remain in the filtered raw data. array-level normalization on the filtered raw data shows the same problem. filtering probes after the normalization also fails to remove the inconsistencies .

by filtering out non-expressed probes, the number of de probes increased for both normalization strategies. however, strip-level normalization still discovered about twice as many de probes as compared to array-level normalization irrespective of whether probe filtering was performed before or after the normalization step . functional analysis revealed that strip-level normalization still yields much more significant fdr scores for discovered david terms than array-level normalization . two new david terms  found by strip-level normalization, not array-level normalization, are closely related to this experiment. put together, it was clearly demonstrated that probe filtering failed to remove intra-array variation.

CONCLUSIONS
it has been shown that strip-to-strip technical variation can have a material effect on expression values from illumina beadchips. if the usual strategy of array-level normalization is used, technical variation on one strip can artificially perturb the normalized intensity values on the other strip for the array, introducing bias, disagreement between replicates, and less precise assessment of differential expression. on the other hand, strip-level normalization successfully removes technical artifacts within as well as between arrays, solving all of the above problems and resulting in more powerful statistical analysis of the expression values.

the evidence we present consists of three major parts. firstly we demonstrate that strip-level normalization gives a substantial improvement in precision for the microarray data. this improvement in precision is not restricted to individual genes, but is a global result affecting all the probes on the arrays. secondly, we demonstrate by way of some carefully chosen plots, how this improvement arises by improving the alignment of the intensity values from the individual strips. the problem can be seen to arise from strips which have an unusually large or small intensity range  relative to their partner strip within the same array. we show that this phenomenon leads to mis-aligned bands for individual strips in ma-plots for replicate arrays. in this way, we have demonstrated the mechanism by which strip-level normalization leads to improved precision and removal of bias. thirdly, we demonstrate by functional analysis that the extra genes discovered after strip-level normalization are not random but do indeed tend to be biologically related to the experimental conditions. although this third component of our evidence is convincing, we view the first two components as the most compelling, because they demonstrate global results which affect all the probes on the arrays, not just those genes which happened to be significant in this experiment.

detailed r code which should enable readers to repeat our analysis is provided in the additional file  <dig>  we also provide the strip-level normalization and plotting algorithms in the illumina package for r available from http://bioinf.wehi.edu.au/illumina/.

our figure  <dig> can be viewed as a "figure of merit" from which the need for strip-level normalization can be judged. in the additional file  <dig>  we provide r code for producing plots such as figure  <dig>  our code is compatible with the bioconductor project software including the lumi package for reading and pre-processing illumina data. we recommend strip-level normalization whenever inconsistent boxplot inter-quartile ranges can be seen in this plot.

in our examples, we used what is probably the simplest and most popular normalization strategy for illumina data. our results are essentially the same using alternative preprocessing methods including model-based background correction  <cit> , variance-stabilizing data transformation  <cit>  or robust spline normalization  <cit> . the need for strip-level normalization remains.

our data example used version  <dig>  mousewg- <dig> beadchips. although illumina stopped shipping this version of the beadchip in  <dig>  data from this platform continues to be highly current. at our institution, version  <dig>  mousewg- <dig> beadchips continued to be hybridized until late in  <dig>  it is likely that the majority of experiments worldwide, which used human or mouse version  <dig> wg- <dig> beadchips, have not yet been published and so are still subject to primary analysis. the majority of illumina beadchip data which is publicly available through databases such as geo  <cit>  is version  <dig> 

the currently shipped versions of illumina beadchips  no longer imbed separate sets of probes in the first and second strips of each array. rather, the entire library of probes  is now randomly distributed over each strip. this means that the marked difference in intensity distribution between first and second strips on the version  <dig> beadchips is no longer apparent. however, the physical layout of strips on the chip is unchanged. therefore the possibility of intra-array variation and the consequent need for strip-level normalization remains.

the probe-level expression summaries output by the illumina beadstudio software for humanwg- <dig> version  <dig> or mousewg- <dig> version  <dig> beadchips do not provide any means to separate first and second strips. expression values are already averaged over the two strips for each array. instead, strip-level information can be obtained from the bioconductor software package beadarray, which provides access to bead-level data summaries for illumina beadchips  <cit> . this process requires that the illumina beadscan software be configured to output bead-level data. with the new generation of beadchips, strip-level normalization implies carrying out pre-processing and normalization of the two strips as if these were separate arrays. the potential need to analyse the strips separately has been noted by dunning et al  <cit>  although they do not elaborate on how this might occur. our recommendation is that the two strips be treated as technical replicates in a differential expression analysis. the strip-level technical replication fits into the same format as developed previously for within-array replicate spots  <cit> . software for utilizing these technical replicates in an differential expression analysis is readily available in the bioconductor package limma, using the duplicatecorrelation function to estimate the correlation between the technical replicates  <cit> . while our experience with version  <dig> and  <dig> beadchips is limited so far, the potential for an improvement in precision is similar to that for version  <dig> arrays when the spread of the intensity distribution is seen to vary considerably between strips, and bead-level analysis has demonstrated that spatial variation does occur on version  <dig> and  <dig> beadchips  <cit> .

it is worth noting that the standard normalization method applied to data from illumina's infinium beadchips for genotyping also occurs at the sub-array level. similar to the wg- <dig> expression arrays, each infinium array is made up of a number of strips . beads manufactured together in the same pool are located on a particular strip on each array and are normalized separately using a between channel/allele affine transformation  <cit> . the need for normalization at the strip-level rather than at the array-level is therefore essential for data from both genotyping and expression beadchips.

