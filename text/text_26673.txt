BACKGROUND
elucidation of the three-dimensional  arrangement of subcellular components facilitates understanding of their structure-function relationships and as such is one of the greatest assets of modern biology. with the newest electron microscopes and well-established techniques for sample preparation  <cit> , it is increasingly possible to achieve 3d-visualization of subcellular structures in their near-native state at a nanometer resolution  <cit> .

most 3d-tem techniques, such as single particle analysis  <cit>  and methods for reconstruction of periodic structures  <cit>  require structurally homogeneous or periodic objects. however, identical molecular conformations are not guaranteed due to the intrinsic and extrinsic variability of biological objects. in addition, although the sizes of crystallized objects are increasing, a large number of macromolecular complexes remain inaccessible to crystallization. transmission electron tomography  circumvents these limitations, enabling the 3d reconstruction of objects with unique topologies, including most cellular organelles. in addition, et offers a resolution between that of optical microscopy and that of single particle or periodic structures reconstruction methods  <cit> . this enables correlative microscopy approaches  <cit>  that combine information from the level of atoms to the level of cells  <cit> .

computing a volume  by et requires four main steps: acquisition of a series of projections at different tilt angles , image alignment, reconstruction, and visualization. the acquisition of tilt series can be performed using different geometries: single-axis  <cit> , dual-axis  <cit> , multiple-axis  <cit> , or conical  <cit> . one of the major inconveniences during the acquisition process is specimen shift due to instrumental limitations such as thermal or mechanical instability. these shifts require alignment of the tilt series before reconstruction. shift correction is accomplished with two types of algorithms, automatic and semiautomatic. automatic alignment is performed by cross-correlation  <cit> , and semi-automatic alignment is performed using fiducial markers  <cit> . fiducial markers  can also be used to determine the tilt-axis direction around which the tilt series is rotated. knowledge of the tilt-axis is strictly required for reconstruction. the tomogram is commonly reconstructed using weighted back-projection   <cit> , although other algorithms such as the algebraic reconstruction technique   <cit>  and simultaneous iterative reconstruction technique   <cit>  can be used for tomographic reconstruction. visualization of the computed tomogram is difficult due to the complexity of the data, which necessitates subjective manual segmentation. in order to develop a more objective semiautomatic or automatic segmentation, efforts are underway to denoise data, mostly by application of anisotropic diffusion algorithms  <cit> .

tomographic reconstructions can be performed using software dedicated for single-particle analysis . however, the development of et  <cit>  has been facilitated by freeware specifically designed for et , and simplicity at the user-interface level . in addition, tomoj can read and write all file formats available in imagej as well as the standard electron microscopy image formats mrc  <cit>  and spider  <cit> .

as a plug-in for imagej, tomoj requires this software to be installed from the web  <cit> . the main limitation of imagej, as with any other java software, is the ram memory management. et requires high memory usage, which is limited with 32-bit java processors. working with large data sets requires 64-bit processors and at least  <dig> gigabytes of ram memory .

once imagej installation is complete, it is simply necessary to copy the distribution file  to the imagej plug-in directory. at this point, for each new execution of imagej, a submenu "tomoj", including two main options, will be available in the plug-in menu. the first option, "tomoj interface", is used to launch the interface for reconstruction of single-axis tilt series. the second option, "tomoj average", enables combination of multiple volumes for multiple-axis tomography  <cit> . tomoj can also be run from the command line.

tomoj workflow
computation of a single-axis tomogram in tomoj requires: 1) tilt-angle assignment, 2) tilt-series normalization, 3) tilt-series alignment, 4) tilt-axis determination, and 5) volume reconstruction. all these steps are accessible from a unique interface .

assignment of tilt angle
once a tilt series is loaded into imagej, the user is prompted to provide the tilt angle corresponding to the first image and the angular increment used for image recording. based on these parameters, tilt angles are computed for each image by applying the two most commonly used angular schemes for acquisition: linear or saxton  <cit>  models. if other acquisition models are used, tilt angles can be provided by a text file. the tilt angles can then be manually modified, if required, for any individual image using the command "assign tilt angle" from the menu of tomoj.

a single image can be removed from the tilt series using the "remove image" button . this operation does not modify the tilt-angle assignment of other images.

normalization of tilt series
tilt-series images must be placed in a common numerical framework in order to eliminate differences between the individual dynamic ranges. these differences are mainly due to the fact that the electron beam crosses different sample thicknesses as a function of the tilt angle. normalization also facilitates visualization of the tilt series. each image  from a tilt series is expanded to a 32-bit real number and normalized to have a mean of  <dig> and a constant standard deviation , as described in  <cit>  using the equation:

 in = /σm 

where in is the normalized pixel value of an image, im is the original pixel value, and Îm and σm are the average and standard deviation of the pixels from the whole image, respectively. the normalization procedure is launched by the tomoj "normalization" button . output is generated as a 32-bit real image stack.

alignment of tilt series
correct registration  of the images from the tilt series is necessary to produce a quality tomogram. tomoj enables automatic and semiautomatic alignment. if the data set has a low signal-to-noise ratio, shift and rotation corrections can be computed from filtered data  and then applied to the original data set .

automatic shift correction  is performed by computing the cross-correlation coefficient  between every  <dig> consecutive images and then moving one of the images by the number of pixels required to maximize the ccc. this step is carried out in the frequency domain using the correlation property of the hartley transform   <cit> . the advantage of using the ht is that it requires only half the memory of the most frequently used fourier transform . in order to preserve the maximum amount of information, the common region is maximized by subtracting the average of all computed shifts between every  <dig> consecutive images. to improve alignment, a region of interest containing features with high signal-to-noise ratio can be selected. if this region has side lengths of a power of  <dig>  the alignment process is accelerated by using the fast ht. the computed shifts will be applied to the whole stack and can be saved to a text file.

the problem of performing pair-wise comparisons is that, in theory, the final alignment can be quite prone to bias . winkler and taylor  <cit>  have proposed a method for automatic alignment whereby the central image of the tilt series is compared in a pair-wise fashion to its immediate neighbors. once the neighbors are aligned, they serve as templates for their respective neighbors. this procedure is repeated until all images are aligned. although this procedure tends to avoid bias, it does not guarantee an unbiased final result. we are currently working on an alignment procedure that avoids alignment bias by considering all images at the same time.

rotations can be automatically corrected using an equivalent procedure , but if the tilt series was acquired with an automated electron microscope this is usually not required. however, it may be necessary if the tilt series was manually recorded. rotations between consecutive images are determined by maximizing the ccc in real space or by using the ht power spectrum . similar to the method for shifts, the average of the computed rotations is subtracted from all rotations.

in the case of important shifts, semiautomatic prealignment  may be required before automatic alignment. prealignment requires the user to select point coordinates that correspond to recognizable features present in every image. selection is performed using the pointpicker's toolbar  <cit> , which replaces the standard imagej toolbar on the imagej window after launch of the tomoj interface. the "switch toolbar" button  enables exchange between these toolbars. pointpicker provides a user friendly interactive tool to manually assign coordinates. once the points are selected, each image is moved so that the barycenter of the feature coordinates is placed at the image center. these precentered images are used as the input for automatic alignment.

if the results of automatic alignment are unsatisfactory, semiautomatic alignment is possible. this method is based on the fact that points belonging to an object rotated along a single axis in 3d space follow arcs around the axis. the 2d projection of the points belonging to these arcs determines parallel lines perpendicular to the tilt axis. as transmission electron microscopy images are projections of 3d objects, the trajectories of any projected point of the 3d object follows lines in the tilt series. the equations of these lines are determined by linear regression of coordinates of recognizable features. each image is then aligned using the average of the translations needed to project each feature coordinate on its line. the semiautomatic alignment procedure requires knowledge of the feature coordinates on a prealigned tilt series.

determination of tilt axis
if the tilt axis is known, then tomogram reconstruction requires only typing the value into the reconstruction panel of the tomoj window, vertically placing the tilt axis using the corresponding button, and running the chosen reconstruction algorithm. if the image size surpasses the available computer memory, it is possible to obtain a smaller region of interest for reconstruction using selection tools and the "image->crop" options from the imagej window. this operation requires vertical placement of the tilt axis and switching to the imagej toolbar. the cropped region can be located at any position in the stack. after cropping, the user must update the tomoj image series by clicking the "update series" button . shift correction in the cropped series is recommended before running the reconstruction algorithms on the cropped region.

if the tilt axis is unknown, it can be determined by  <dig> procedures. the simplest one, based on the ft of the projected aligned stack, requires discrete and well defined fiducial markers, such as gold particles. in this case, the imagej option "z-project" from the "image-->stack" menu enables computation of a projection of the stack using the "min projection" option. from this image it is possible to compute the ft using the "analysis-->fft" menu from imagej. finally, the tilt angle can be measured using the angle tool of the imagej window. the tilt angle is defined by the vertical line crossing the center of the ft power spectrum image shown on the screen and the tilt line that appears on it.

the second procedure uses the coordinates of a set of selected points from recognizable features or fiducial markers. the features coordinates are used to compute by linear regression the equation of the line perpendicular to the tilt axis. this line represents the average direction of the features displacements. before their use for tilt-axis determination, features coordinates are validated using the pearson test to fit linear trajectories. the pearson test is performed on the linear regression coefficients for each feature. the features not belonging to their line equation with a confidence of  <dig>  are excluded from further calculations. the tilt axis is computed as the line perpendicular to the average feature displacement. the software provides the angle  required to position the tilt axis vertically. in addition, a confidence interval for the tilt angle is computed from the confidence interval for the slope of the average feature displacement equation. this method requires the presence of at least three recognizable features in most of the tilt-series images. at this stage, it is possible to mark a feature in some of the images  using the pointpicker toolbar and to interpolate the rest of the points using the "interpolate" button. the position of the interpolated points can be corrected with the "move crosses" tool from the pointpicker toolbar. once one object is selected along the whole stack, the operation can be repeated with the next object. at any step, the tilt axis can be computed by clicking on the corresponding button of the tomoj window. the value of the tilt axis will be shown in a results window with its corresponding statistical error. depending on the computed error, the user can complete the tilt-axis determination procedure or choose between correcting the point positions or adding new points. the points can also be used to align the images using the "center with points" option from the tomoj menu. however, in most cases this operation is unnecessary because the images have previously been centered. point coordinates can be saved as a text file and retrieved at any moment using the "save points" option from the pointpicker toolbar.

reconstruction
the final step in computing a tomogram is reconstruction. for this purpose, the image stack must be aligned and the tilt axis determined. then, it is necessary to indicate the volume thickness that corresponds to the expected number of voxels that the reconstruction will occupy in the z-direction. the sample thickness in pixels can be approximated by multiplying the sample thickness in nanometers by the sampling size in nm/pixel.

three reconstruction algorithms are implemented in tomoj: wbp  <cit> , art  <cit> , and sirt  <cit> . wbp is the most commonly used algorithm for reconstruction in et. this method compensates for overemphasis of low frequencies in fourier space by using a weighting scheme prior to reconstruction. subsequently, the aligned and weighted projections are back-projected into a 3d volume using bilinear interpolation. art and sirt are performed in an iterative manner so that the projections of the reconstructed volume computed through an image formation model resemble the experimental projections obtained by the microscope. a linear projection model with additive gaussian noise is assumed  <cit> . the linear projection model is a first-order approximation of the nonlinear image formation process occurring in the microscope  <cit> . furthermore, despite the fact that the noise is not white  <cit> , the sirt formula for white noise is known to produce good estimates of the underlying structures  <cit> .

no special inputs are required to compute a volume using wbp in tomoj. for the iterative algorithms art and sirt, it is necessary to provide the number of iterations and the relaxation coefficient. in our experience, usually at least four iterations are required to obtain a good tomogram. the choice of the number of iterations depends on the mean square error computed from the differences between the projections of the reconstructed volume and the experimental data. an error curve showing the error as a function of the iteration number is displayed after completing the reconstruction process. the second parameter, the relaxation coefficient, is a weighting factor used to improve the quality of reconstruction, usually at the expense of convergence  <cit> . tomoj proposes for art a relaxation coefficient of - <dig>  and of  <dig> for sirt, which experimentally are good values for most cases. however, these values can be manually modified. in general, lower relaxation coefficients should be used with data sets having a low signal-to-noise ratio, and higher values in the opposite case. the error curve also assists in the choice of the relaxation coefficient: rapid convergence indicates that the relaxation coefficient is too high and slow convergence indicates that it is too low.

use of all the tomoj tools is not strictly required to obtain a tomogram. for instance, the tilt-axis angle is provided by most microscope acquisition software. thus, it can be directly provided by the user. in addition, rotations are normally negligible in an automatic acquisition procedure. therefore, in most cases only the "normalize", "correct shift", "put tilt axis vertical", and "reconstruction" steps are needed.

volume combination in multiple-axis tomography
the inability to record projections at all tilt angles during acquisition results in incomplete information. this inability is due to the increase in the effective sample thickness  as a function of the initial thickness  and the tilt angle : t=tcos⁡
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgubavcqgh9aqpdawcaaqaaiabdsha0bqaaigbcogajjabc+gavjabcohazjabcicaoggaciab=f7ahjabcmcapaaaaaa@37e0@, implying an infinite thickness to traverse at α = 90°. this lack of information is known as the missing wedge  <cit> . the missing wedge induces reconstruction artifacts  in the reconstructed volume perpendicular to the horizontal plane. to compensate for this lack of information, it is possible to rotate the sample in the horizontal plane, recovering a portion of the missing projections. in this way, if two rotations  are used to record two tomographic series , and the two reconstructed volumes are combined in a merged tomogram, then the missing wedge is transformed into a missing pyramid. this approach is referred to as dual-axis tomography  <cit> . an extension of this approach is to record tomographic series at the maximum possible number of rotations in the horizontal plane, which results in a missing cone. this approach is referred to as multiple-axis tomography  <cit> . both dual- and multiple-axis reconstructions require alignment of volumes before computing a final average. tomoj provides a second user friendly plug-in for combining the different single-axis reconstructions by simply averaging volumes after registration.

running tomoj in batch mode
some of the tasks for computing or merging tomograms are greatly time consuming, depending on the processor and memory used. as a plug-in for imagej, tomoj runs in the user window, which can block the computer from performing other interactive tasks. to overcome this problem, tomoj can be run in batch mode. this can be accomplished using various commands from the terminal; the full set is provided in the user manual .

RESULTS
tomoj enables 3d reconstruction from tilt-series recorded around a tilt axis, as in et. the main advantage of this software is the availability of different algorithms for reconstruction. thus, unlike other public domain software for electron tomography reconstruction  tomoj can perform 3d reconstruction using the art  <cit>  and sirt  <cit> . the use of the art and sirt provides better results than standard wbp  <cit>  implemented in other software. this is due to the fact that the two main limitations of electron tomography are the missing wedge and the low signal-to-noise ratio of the images . the robustness of wbp, art and sirt has been evaluated by comparison of the 3d reconstructions computed by these three methods to an original phantom. such comparison can be performed using the coefficient of determination   <cit> . the cod is nearer to  <dig> when objects are more similar and nearer to  <dig> when objects are more different. running tomoj on the projections of the phantom shown in figure 2a, after addition of gaussian noise to the projections , we obtained a cod of  <dig> %,  <dig> %, and  <dig> % for wbp, art, and sirt, respectively. the cod obtained using wbp and imod  was equivalent to that for tomoj wbp . figure  <dig> shows the greater accuracy with art and sirt versus wbp.

in addition to offering different reconstruction algorithms, tomoj leverages the capabilities of imagej for preprocessing and denoising images. different image filters and denoising procedures, such as anisotropic diffusion, can be used by downloading the corresponding plug-ins from the imagej web page. these features are unavailable in other tomographic freeware.

imagej also provides tools for visualization . therefore, the development of specific visualization tools inside tomoj is not required. in addition, imagej offers segmentation tools such as manual tools and snake or watershed algorithms to assist interpretation of complex volumes, which requires segmentation before visualization. using the tomoj export options , the segmented volumes can also be exported to optimized freeware, such as chimera  <cit> , for visualization. the main advantage of chimera is that it provides the required functionality for visualization of volumes and is the standard for visualization of macromolecular 3d reconstructions from electron microscopy data.

as java-based public domain software implemented as a plug-in for imagej, tomoj can be used for research as well as instruction. increasingly, cell biology laboratories are becoming interested in electron tomography. the user-friendly interface of imagej, the easy installation of tomoj, and the multiplatform capability  facilitate use of tomoj in biology laboratories. in addition, tomoj includes algorithms for multiple-axis tomography  <cit> , which allows tomographic reconstruction without electron microscopes equipped with high-tilt devices. these microscopes, which are not devoted to tomography, are available in most electron microscopy services in research centers and universities. in addition, tomoj will be expanded to compute 3d chemical mapping. this will enable calculation of the spatial distribution of chemical elements from tilt series acquired with the electron microscope at different energy-loss values  <cit> . calculation of these chemical maps requires background subtraction using specific software   <cit> , which has already been developed as a plug-in for imagej in a preliminary version. the eftetj output can be used as an input for tomoj to compute the 3d chemical map.

CONCLUSIONS
in this paper, we present new software for electron tomography. this software was specifically designed to be user-friendly, and it encompasses all algorithmic steps needed for tomographic reconstruction. it also implements the most recent algorithms for tomographic reconstructions. the package has been written as a plug-in for imagej and benefits from all the possibilities offered by this freeware. as a java program, it runs on all java platforms. tomoj can be freely downloaded  <cit> .

availability and requirements
project name: tomoj

project home page: 

operating system: platform independent

programming language: java

other requirements: java  <dig> . <dig> or higher

license: cecill

any restrictions to use by non-academics: licence needed

authors' contributions
cm carried out the design and implementation of the software. tb participated in the design and implementation of the reconstruction algorithms. coss participated in the design of the reconstruction algorithms. sm conceived and coordinated the study, and participated in its design. all authors read and approved the final manuscript.

