BACKGROUND
copy number variants , which constitute a major form of dna structural variation, have been shown to be closely related to several diseases, including autism  <cit> , schizophrenia  <cit>  and cancer  <cit> . comparative genomic hybridization and fluorescence in situ hybridization have been used to detect cnvs of particular genes or fragments  <cit>  but are limited in terms of resolution. to profile genome-wide copy number  landscapes, these techniques have consequently been replaced by next-generation sequencing  technologies  <cit> . because it uses bulk dna from tissue samples, however, traditional sequencing provides an average signal from millions of cells and is thus of limited utility for the characterization of tumor heterogeneity at the single-cell level.

an innovative technique, single-cell sequencing , was developed to address key issues in cancer studies, including measurement of mutation rates, tracing of cell lineages, resolution of intra-tumor heterogeneity and elucidation of tumor evolution  <cit> . scs combines flow sorting of single cells, whole-genome amplification  and ngs to characterize the genome-wide cn of single cells. existing wga techniques, such as degenerate oligonucleotide primed-polymerase chain reaction  <cit> , multiple displacement amplification  <cit>  and multiple annealing looping-based amplification cycling  <cit> , inevitably introduce amplification bias to varying degrees when the whole genome of a single cell is amplified to microgram levels for ngs  <cit> . such technical noise due to amplification bias is over-dispersed and is different from that of bulk sequencing, which does not involve amplification. there are two main strategies that use ngs data to detect cnvs: read depth -based and read pair -based methods  <cit> . to the best of our knowledge, rd-based methods are arguably popular for cnv detection. furthermore, cnv detection using scs data requires only sparse sequence coverage to economically accommodate numerous single cells  <cit> .

the analysis pipeline of rd-based methods consists of data preparation , data normalization , cnv region identification  and cn profile estimation   <cit> . briefly speaking, the reference genome is divided into equally or variably sized, non-overlapping bins for computing read counts  in each bin along the whole genome. the rd in each bin is generated by the corresponding rc divided by the average rc for the whole genome. the rd signal is then normalized using strategies such as lowness smoothing based on guanine-cytosine  content. different segmentation algorithms are used to detect the cnv regions. after their detection, the cnv regions can be translated into a cn profile using available ploidy information or by other methods  <cit> . several existing rd-based benchmark cnv detection methods, which we later apply for comparison, are described as follows.

dnacopy  <cit>  implements a classical circular binary segmentation   <cit>  algorithm to segment rd data and identifies abnormal genomic regions. the basic idea of cbs is to translate a noisy-intensity rd signal into regions of equal cns followed by binary segmentation. copynumber  <cit>  is a highly efficient algorithm that offers a unified framework to segment rd data from single or multiple samples. this approach combines least squares principles with a suitable penalization scheme for a given number of breakpoints to detect cn profiles. the above two methods do not require data preparation and normalization. control-free copy number and allelic content caller   <cit>  is a systematic cnv detection package consisting of data preparation, normalization, cnv region identification, and profile estimation. control-freec segments the whole reference genome into equally sized, non-overlapping bins. it then computes the rd of the tested sample in each bin. if a control sample is not supplied, control-freec uses the gc content in each bin to achieve data normalization. for cnv detection, control-freec uses least absolute shrinkage and selection operator  regression. cnvnator  <cit>  also divides the whole reference genome  into continuous, non-overlapping equal-sized bins. normalization is achieved by averaging the rd signal over each bin with respect to gc content, and cnv region identification is based on mean-shift tracking.

most of the earlier analysis in sequencing analysis assumed that the rds are following gaussian distribution  <cit>  or poisson distribution  <cit> . however, experimental analysis in the absolute numbers of mrna molecules by single-cell sequencing manifested  <cit>  that the counts could be accurately characterized by negative binomial distribution. to this aim, we firstly generated an illustrative example to characterize the statistical distribution of real rds by single-cell sequencing technology. real sequencing data from a normal cell   <cit>  were preprocessed to obtain rc data with  <dig> variable bins. the frequency histogram of the rc data is shown in fig.  <dig>  the distribution was approximated by the poisson, gaussian and negative binomial probability density functions through maximum likelihood estimation . the estimated mean value of the poisson distribution was λ= <dig>  for the negative binomial distribution, the estimated mean value and dispersion coefficient are μ= <dig>  and α= <dig> , respectively. for gaussian distribution, the estimated mean value was μ= <dig>  and the estimated standard deviation σ= <dig> . this figure clearly demonstrated that the frequency histogram of the real rc data could be nicely characterized by a negative binomial distribution. for further comparison, we also measured the overlap ratio between the real rc and its approximations with different bin counts, ranging from  <dig> to  <dig>  the overlap ratio was calculated as, 
  <dig> f=a⋂ba⋃b fig.  <dig> modeling of single-cell sequencing rc data and selection of a suitable bin count for experiments. a frequency histogram of rc data , shown in light green. for comparison, the frequencies of simulated rcs generated by poisson, gaussian and negative binomial distributions are indicated by brown, yellow or dark green lines, respectively. the rcs of the scs data can be accurately characterized by a negative binomial distribution. the estimated parameters by mle for each p.d.f are shown in parenthesis. b relationship between bin count  and overlap ratio . the empirical sequencing data could be better approximated by a negative binomial distribution. such nice approximation was insensitive to the bin count. therefore, the proposed nbcnv is hoping to be applied in various bin count setting



where a denotes the frequency of empirical rc x and b is the approximated probability density function. the result was shown in fig.  <dig>  the ratio between the empirical rc and the one approximated by nb distribution was dramatically higher than by the poisson distribution. when the bin count was larger than  <dig>  the ratio is more than  <dig>  by the nb distribution. in comparison, the ratio was low to  <dig>  by poisson distribution. for gaussian distribution, the ratio was rising when the bin count ranged from  <dig> to  <dig> and the ratio under  <dig> was as higher as the one by nb distribution. however, it began dropping continuously with the bin count rising continuously. therefore, the rc distribution could be accurately characterized by the negative binomial distribution.

to this end, a novel model called nbcnv was proposed in this paper to detect cnvs using scs data. the nbcnv model uses negative binomial distributions to approximate loci along the whole genome. we incorporate two constraints of sparsity and smoothness to fit the cnv patterns. the cnv detection problem is then formulated by a quadratic optimization model. the proposed nbcnv uses an efficient numerical scheme based on the classical alternating direction minimization method  to achieve efficiency. since scs data analysis requires carefully data preprocessing, a recently published scs protocol  <cit>  was modified to fit with the proposed nbcnv detection method. we have built a systematical pipeline for single-cell sequencing analysis. considering the inherent contradiction between the quality  <cit>  and resolution of cnvs detected with rd-based methods, nbcnv can adaptively select the most suitable total number of bins according to user preference. once ploidy information is provided, the cnv regions detected by nbcnv can be translated into a cn profile.

the rest of this article is organized as follows. the underling mathematical models of nbcnv and its numerical solution are described in section “methods”. we then evaluate and demonstrate the efficiency of nbcnv compared with several benchmark methods using both simulated and real scs datasets in section “results and discussion”. finally, we conclude the paper in section “conclusions”.

methods
data preprocessing
to achieve data preparation and normalization, we modified a previously reported protocol for genome-wide cn analysis of single cells  <cit> . the steps are briefly summarized here. we first downloaded a sequencing file from the national center for biotechnology information  short read archive  and used the bowtie <dig> alignment tool  <cit>  to map the millions of short reads to the grch <dig> human reference genome. bins of variable sizes were used to segment the whole genome. bin boundaries were decided by the length of reads used in the cnv analysis. for example, simulated reads of length k are generated along the whole genome one base pair at a time when the length of reads is k bp. thus, the total number of simulated reads is l−k+ <dig>  where l is the length of a chromosome. in our experiments, nearly three billion simulated reads were aligned back to the reference genome and all unique mapping read positions were retained. to divide the whole genome into variable-sized segments, each segment except the last one in each chromosome was possessed to have the same number of uniquely mappable positions. to achieve uniform bins, parameters for bowtie <dig> in each run were set to be equal. the rd signal was further normalized by locally-weighted polynomial regression  and linear interpolation based on the gc content in each bin  <cit> .

one of the important issues rising in above procedures is to decide the size of bin count. to investigate its dynamic relationship with the quality of the rc data, a quantitative measurement known as the multiple absolute pairwise difference  threshold  <cit>  was used to quantify the data quality. the mapd is defined as median, where xi denotes the rc signal at i-th position. a larger mapd value implies of lower quality of the real rc data and less credibility of the following cnv detection. the relationship between data quality and bin count is shown in fig.  <dig>  as is evident from the figure, the quality of the rc data drops quickly when the bin count increases. it is due to the rc data tends to be more dispersed  if being preprocessed under a larger bin count.
fig.  <dig> relationship between bin count  and mapd values . with increasing bin count, the quality of the data drops rapidly. a suitable bin count should thus be carefully selected by balancing the high resolution versus good quality as well as large overlap ratio. in our experiments, the maximum tolerable mapd was set at  <dig>   and the bin count was 50000



in analyzing read depth data, a larger bin count is admired to achieve higher resolution. provided with enough sequencing depth, high resolution analysis makes it accurate in cnv detection. however, if the sequencing depth is low, a larger bin count will deteriorate the data quality and make the data analysis less reliable. in order to find the accurate value in balancing the high resolution versus good quality as well as large overlap ratio f, a simple maximization scheme is defined as following: 
 maxxg−αk  where g is a polynomial functions aiming to fitting the mpad function. k is the overlap ratio defined in eq. . the parameter of α is a trade-off parameter, ranging from  <dig>  to  <dig> . in our experiments, α was set to be  <dig>  and it is corresponding to a bin count of  <dig>  when the bin count is  <dig>  the ratio between the empirical rc and the one approximated by nb distribution is higher than 90% and the mapd value is closer to the maximum tolerable value . therefore, the bin count of  <dig> was selected to achieve a nice balance between the data quality and resolution of detection.

problem formulation
mathematically, let y= be the observed rd signal in a bin, with x= representing the corresponding reconstructed cn. we wish to determine the cn x that is most likely given by rd y. by bayes’s law: 
 p=ppp.  estimation of the cn x could be derived by maximizing the posterior probability pp. assuming a negative binomial distribution at each genome position t with mean parameter x and over-dispersed parameter α, we have: 
 p=Γyt!Γxtxt+αytαxt+αα,  where α is an over-dispersed parameter that must be estimated empirically. for ease of model derivation, we temporarily assume that its value is known a priori and elaborate its estimation later.

if we assume that the values of y at position t are independent, then: 
 p=∏tΓyt!Γxtxt+αytαxt+αα. 

considering the characteristics of cnvs, we further require that the prior distribution on cn  satisfies assumptions related to two characteristics:

smoothness: cns at contiguous chromosome positions are similar except for abrupt changes between different segments;

sparsity: cn variants are less common than invariants.

mathematically, the above two characteristics can be penalized by: 
 p=exp−∫dΩ,  where λ <dig> and λ <dig> are trade-off parameters for respectively controlling the sparsity and smoothness of the cn function. the integration operation takes value along the genome on each bin Ω.

finally, we minimize − logp) to seek the maximum posterior probability on x: 
  <dig> minx,α−logΓ+logΓ−αlog+log+−ylogx++λ1|∇x|+λ2|x|, 

where x+= max{ <dig> x}. however, minimization of this problem to have optimal x and α is infeasible because of the presence of the hyperbolic function Γ. if one uses the gradient descent method, the computation time needed to approximate the optimal solution will be very large. to alleviate this problem, we use a simple mle-based method to estimate the value of α; thus, eq.  can be simplified as 
  <dig> minx∑tlog+−ytlogx++∫dΩ, 

where x+= max{ <dig> x}. once we have obtained the legitimate cn signal, its variants can be easily derived using simple thresholds.

numerical solution
the minimization problem  is actually a quadratic optimization constrained both by a total variational norm and a l <dig> norm. such minimization problems are widely encountered in various areas, including signal processing and image recovery  <cit> . because the optimization problem  is convex, multiple standard optimization methods are available for its solution, such as majority minimization  <cit>  and the lasso approach  <cit> . because of the high volume of the sequencing data, however, an efficient numerical solution is desirable for practical usage. this paper proposes to solve eq.  within the framework of the alternating direction method of multipliers  method  <cit> . the most attractive characteristic of admm is its ability to decompose a complex problem into favorably separable subproblems that can then be efficiently solved individually.

let g1= log−y logx, g2=1+, g3=λ1∥·∥ <dig>  g4=λ2∥·−c∥ <dig>  where 1+ is the indicator function for positive real numbers: 
 1+= <dig> x>0+∞,otherwise. 

let g=t, with i being the identity matrix and ∇ the usual difference matrix. the minimization eq.  can then be accordingly rewritten as: 
 𝕃=minx∑tmlog+−ytlogxt++1+)+λ1∥∇x∥1+λ2∥xt−c∥1=minxf1+f <dig>   where f1= <dig> f2=∑j=14gj. after introducing a slack variable u=gx, the augmented lagrange function for 𝕃 is: 
  <dig> 𝕃=minxf1+f2+μ2∥gx−u∥ <dig>  

where μ is the lagrange multiplier. the above minimization problem can be now fitted into the admm framework and subsequently decoupled into the following two subproblems: 
subproblem 1:xk+1=argminxf1+μ2∥gx−uk−dk∥22

subproblem 2:uk+1=argminuf2+μ2∥gxk+1−u−dk∥22

updating:dk+1←dk−.



all that remains are to solving the two subproblems, for which we demonstrate that they can be elegantly solved using standard methods after simple algebraic transformation in additional file 1: s. <dig>  for the clarity of the numerical scheme, a short introduction of admm is also provided in additional file 1: s. <dig> 

parameter pruning
the dispersion parameter α is associated with the negative binomial distributions of the different cn states. in our experiments, the dispersion parameter was estimated by mle. in simulation experiments, the rds from simulated reads of the chromosome- <dig> sequence without implanted cnvs were used for the mle estimation of α. in empirical experiments, the rd signals from a normal single cell under accession number srr <dig> were employed for estimation of α. the parameter λ <dig> is used to penalize the total variational term, and λ <dig> is used to control the sparsity of the recovered signal. both of the two parameters were estimated by trials on preliminary experiments. the copy number duplications were implanted artificially in the rd data of srr <dig> by adding one cn to any bins with the duplications. the copy number deletions were generated similarly by subtracting one to any bins overlapped the deletions. it should be noted that srr <dig> was considered as a clean sample  and thus its copy number status was known. we run the simluation experiments for different values of λ <dig> and λ <dig>  the euclidean distance between the fitter signals and the real copy number signals was calculated for evaluating the cnv detection performance. as shown in fig.  <dig>  one may observe that when the λ <dig> was set as  <dig> and λ <dig> was set as  <dig> the euclidean distance achieved the minimum. for real data experiments, the two parameters of λ <dig> and λ <dig> were pruned around  <dig> 
fig.  <dig> heatmap of euclidean distance between the fitter signals and the real copy number signals with respect to the two parameters used by nbcnv. the horizontal axis stands for λ
 <dig> and the vertical axis stands for λ
 <dig>  a smaller euclidean distance implies a better detection performance



RESULTS
simulation experiments
to evaluate the performance of nbcnv, experiments on a simulation dataset from a chromosome sequence with implanted cnvs were conducted. the chromosome  <dig> of grch <dig> was used as a template. variants including duplications and deletions were randomly implanted into it. our experiments considered only duplications  and deletions  since these two types of cnvs are typically the most challenging problem in distinguishing them from normal cns. we first doubled the chromosome- <dig> sequence  to generate the diploid sequence . the length of chromosome  <dig> without unknown sequences is  <dig> bp and the size of cnvs ranged from  <dig> bp to  <dig> bp. for each simulation,  <dig> cnvs were artificially implanted into the chromosome, from which simulated single-end sequencing reads were created by wgsim  <cit> . wgsim is a simulation tool to create ngs reads, including single nucleotide polymorphisms, insertion-deletions and sequencing errors from a reference sequence. the simulated reads by wgsim were further contaminated by noises following negative binomial distribution to mimic the technical noises introduced by amplification and sequencing  <cit> . a total number of  <dig> reads with coverage of  <dig>  × were generated. each single-end reads is in 50-bp, similar to the illumina sequencing platform. as shown in fig.  <dig>  the frequency histogram of the simulated rcs was approximated by negative binomial and poisson distribution. one may note that the frequency of the simulated reads was nicely characterized by the negative binomial distribution.
fig.  <dig> frequency histograms of contaminated rcs for the srr <dig> in chromosome- <dig> with implanted cnv sequences. the distribution of contaminated rcs can be better fitted by a negative binomial distribution than a poisson distribution and is closer to that of empirical data



to have quantitative comparison on cnv detection, the sampled short reads were aligned back to the reference sequence by bowtie <dig>  <cit> . its output sam files were used as the input for control-freec  <cit> , cnvnator  <cit> , nbcnv and our earlier work based on poisson model named by poicnv)  <cit>  for performance comparison. as for control-freec, the chromosome- <dig> sequence with implanted cnvs were served as the control sequence. the bin size used in control-freec and cnvnator analyses was  <dig>  the above simulation was run  <dig> times independently. for quantitative comparison, four measurements including accuracy, precision, sensitivity and specificity were recorded and calculated. their definitions are as follows: 
 accuracy=tp+tntp+tn+fp+fnprecision=tptp+fpsensitivity=tptp+fnspecificity=tntn+fp 

where true positive  is the total number of instances when the cnv regions are correctly identified and true negative  is the number of instances when the normal regions  are detected properly. false positive  and false negative  are defined similarly. the experimental results are summarized in table  <dig>  in which the best value was highlighted in bold. for visual comparison, a bar graph was also drawn in fig.  <dig>  among the  <dig> simulations, the nbcnv performed superior to poicnv and its peers by achieving the highest measurements of accuracy, precision and sensitivity. moreover, nbcnv also resulted in a smaller standard deviations than by control-freec and cnvnaotr. compared with control-freec and cnvnaotr, the superior performance of nbcnv is attributed to its effective data preprocessing and robustness in parameter pruning. compared with poicnv, the nice performance of nbcnv is attributed to its appropriate noise modelling.
fig.  <dig> the performance of implanted cnvs detection after four methods of control-freec, cnvnator, nbcnv and poicnv at chromosome- <dig>  each bar in the plot represents the mean based on  <dig> simulations of the corresponding measurement as determined by each method. in addition to the error bars, the nbcnv method can clearly be seen to have achieved superior performance in terms of accuracy, precision and sensitivity

 <dig> ± <dig> 
%
 <dig> ± <dig> 
%
 <dig> ± <dig> 
%
 <dig> ± <dig> 
%


application to scs data from  <dig> single cells
to further assess the performance of nbcnv in real applications, a scs dataset from  <dig> single cells was downloaded from the ncbi sra under accession number srp <dig> and tested. the original samples were selected from high-grade  triple-negative  ductal carcinomas   <cit> . they were preprocessed by flow sorting of single nuclei, whole genome amplification, library construction, and finally sequenced on an illumina genome analyzer  <cit> . the  <dig> illumina runs generated a total of  <dig> × <dig> reads,  <dig> × <dig> base calls  and were thus of low coverage. the data has been used to study the evolutionary dynamics and population structure of tumors in order to have a comprehensive view of the evolutionary process occurring in individual tumor cells  <cit> . they have been analyzed by fluorescence-activated cell sorting and therefore their ploidy levels were known, including  <dig> diploids or pseudodiploids ,  <dig> hypodiploids  and  <dig> aneuploids . the diploids or pseudodiploids part consists of cells which have a small number of cnvs as a whole, while the hypodiploids part shows narrow deletions and the aneuploids part shows numerous copy number duplications  <cit> . the ploidy information could serve as benchmark information for evaluating the clustering performance in these  <dig> cells.

the proposed nbcnv as well as the other three methods of poicnv, cnvnator and control-freec were applied on the sequence data to have their cn profiles. for visual comparison, multidimensional scaling  was performed by mapping each sample from the high-dimensional space to a visually acceptable one . the diploid , hypodiploid  and aneuploid  fractions are highlighted in fig.  <dig>  five diploid cells were mistakenly classified into the hypodiploid fraction by nbcnv and poicnv. however, when we retrospectively examined the five diploid cells, we found that they possess abundant cnvs compared with other diploid cells and thus making it difficult to be merged with others. the clustering result on the cn profiles after nbcnv was better than the one by cnvnator by covering most of the sample dots. the one after control-freec method resulted in a smaller inter-cluster distance between diploid and hypodiploid fractions. to further visualize the evolutionary history of the  <dig> single cells, hierarchical clustering was computed and shown in fig.  <dig>  the misclassified cell number after each method was summarized in table  <dig>  the proposed nbcnv and poicnv achieved superior performance by only misclassifying five cells. in comparison, cnvnator misclassified  <dig> cells and control-freec misclassified  <dig> cells. it should be noted that although ploidy information could serve as benchmark information for evaluating the clustering results. however, using clustering accuracy to evaluate the performance of methods was coarse-grained. for example, nbcnv and poicnv were shown to perform equally well in term of mds and clustering accuracy. since the real copy number profiles of these sequence data were unknown, we pictured the number of detected cnvs after nbcnv and poicnv by wayne chart at two typical cells . as shown in fig.  <dig>  nbcnv can detect more cnvs than by poicnv. it implies a possible good coverage yet higher false positive. we also reported the detection results on other cells by nbcnv and poicnv in additional file 1: s. <dig> 
fig.  <dig> multidimensional scaling of  <dig> single cells. diploid , hypodiploid  and aneuploid  fractions are shown in green, yellow and red, respectively. clustering results after nbcnv were better than those after cnvnator, when comparing the number of covered dots. compared with the other three methods, control-freec resulted in a smaller inter-cluster distance between diploid and hypodiploid fractions, and thus was less satisfactory

fig.  <dig> results of hierarchical clustering and heat map of copy number profiles of  <dig> single cells after a control-freec, b cnvnator, c nbcnv and d poicnv analysis. different colors are used to distinguish the generated clusters. a comparative evaluation of the performance of the different detection methods based on the clustering results is given in table 2


fig.  <dig> wayne comparison on detected cnvs by nbcnv and poicnv on two samples. the pink part measures the number of cnvs detected by nbcnv while the purple represents poicnv and the overlay region represents both. it implies of a possibly better coverage yet higher false positive by nbcnv



CONCLUSIONS
we have presented a rd-based method to detect cnvs from over-dispersed sequencing data such as scs data. taking into account the over-dispersed noise in the scs data and the characteristics of cnv patterns, the method uses negative binomial distributions to model the rd signal and imposes sparsity and smoothness constraints to transform cnv detection into a quadratic optimization problem. comparative experiments with other cnv detection methods on simulated data and an empirical scs dataset demonstrated that our method is superior in terms of accuracy, precision and sensitivity for cnv detection. compared with other methods, the robustness in parameter pruning in our cnv detection method contributes to a more steady performance.

additional file
additional file  <dig> contains a formal description of the admm algorithm and the cnv detection results on scs ductal carcinomas  data by nbcnv and poicnv. 



abbreviations
cnvscopy number variants

cncopy number

scssingle-cell sequencing

wgawhole-genome amplification

rdread depth

gcguanine-cytosine

cbscircular binary segmentation

admmalternating direction minimization method

mapdmultiple absolute pairwise difference

funding
this work was partially supported by the national natural science foundation of china , special program for applied research on super computation of the nsfc-guangdong joint fund , science and technology planning project of guangdong province, open funds of state key laboratory of oncology in south china, and the fundamental research fund for the central universities .

availability of data and materials
the datasets supporting the conclusions of this article are available in the ncbi sequence read archive  repository 
]. the relevant code can be downloaded from https://github.com/zcszcstl/nbcnv.

authors’ contributions
hmc provided method, design, development and authorship. csz designed the experiment and evaluated the performance and drafted the manuscript. jyh provided advisement on experiments. ys provided the data preparation and manuscript editing. all authors read and approved the final manuscript.

competing interests
the authors declare that they have no competing interests.

consent for publication
not applicable.

ethics approval and consent to participate
the authors declare that ethics approval and consent to participate are not applicable to this study.
