BACKGROUND
microarray technology has revolutionized the study of the genetics of complex disease, with large-scale case-control studies completed in the past  <dig> years  <cit>  uncovering many thousands of new susceptibility loci for a wide range of autoimmune, mental and cardiovascular disorders and cancers  <cit> . these discoveries were made possible by the pioneering work of the hapmap project  <cit>  in cataloguing genetic variation in multiple human populations. this collection has recently been expanded upon by the  <dig> genomes project  <cit>  which has enhanced the catalogue of low frequency and rare variation  of  <dig> %–5% and <  <dig> % respectively). single-nucleotide polymorphism  microarrays with increased coverage of low frequency and rare variants are available from both major manufacturer’s affymetrix and illumina. previous comparisons of genotyping methods have shown that many popular algorithms have reduced call accuracy for these snps  <cit> . optimal analysis of this new content will therefore depend on calling algorithms that are capable of making sensible calls even when there are few observations, as is the case for genotypes involving the minor allele.

illumina snp microarrays are currently the most widely used array-based platform in both large- and small-scale genetic studies. illumina’s largest beadchips contain between  <dig>  million and  <dig>  million snps  and process multiple samples in parallel . the infinium ii chemistry used on this platform differentially labels allele a and allele b with red and green dye respectively  <cit> . a number of algorithms are available for processing the raw signal of paired allele intensities into discrete genotype calls  for each snp in each sample. current methods include: gencall  <cit> , illumina’s proprietary method implemented in the genomestudio software; genosnp  <cit> ; illuminus  <cit> ; crlmm  <cit> ; birdseed  <cit>  and beaglecall  <cit> . three new methods have been proposed recently to meet the challenge of calling low frequency/rare variants on the illumina platform .

the number of samples from each of  <dig> hapmap populations  is shown in parentheses for each data set.

in this paper, we introduce krlmm, a new genotype calling method for illumina beadarray data that takes a novel approach to that of other methods by allowing a variable number of clusters  to be fitted to the between sample normalized intensity data. we analyze datasets from a number of platforms and highlight the benefit of careful signal adjustment between samples to optimize calling accuracy. we compare this approach to four existing algorithms  by analyzing data sets with increasing coverage of low frequency/rare variants, and compare the performance of these methods in terms of accuracy at varying minor allele frequency. krlmm is shown to perform favourably in most comparisons, particularly at low maf.

methods
data sets
data from hapmap samples run on  <dig> high density snp platforms in-house at illumina were analyzed  using  <dig> different genotyping methods . for each chip type, independent genotype calls  were downloaded from the hapmap ftp server . the number of snps with at least  <dig> non-missing call varied by chip type . these data provide us with an independent truth that can be used to compare the call accuracy of the different genotyping methods.

key: w - within sample method; b - between sample method.

signal characteristics
in the description below, we use illumina’s nomenclature of x and y to refer to the intensities of the respective alleles . for well-behaved snps with normal copy number, log-ratios  or other contrasts between the normalized intensities  tend to be well separated into distinct clusters corresponding to the major genotypes present . this separation is known to vary between snps and can depend on the overall signal intensity. various within and between sample modelling approaches have been proposed to adjust for these effects and convert the intensities into genotype calls, with appropriate call confidence measures   <cit>  for a review).

krlmm algorithm

preprocessing

two different preprocessing methods were considered for use in krlmm. the first involved between sample quantile normalization of each channel  separately to adjust for systematic differences between the signal from different arrays. although this resulted in a more consistent distribution of log-ratios between samples  relative to no normalization , there remained an intensity-dependent trend in the log-ratios . to overcome this, an additional loess correction was applied to each major cluster , with the consensus estimate of cluster center added back to the upper  and lower  clusters .


regression to choose k

the krlmm algorithm is a one-dimensional clustering method that uses k-means clustering  for a variable number of clusters, where the choice of k is determined by the snp-specific signal. as shown in figure  <dig>  an ideal clustering might be relatively tight  rather than diffuse and have cluster centers with low bias when compared to the consensus positions of the aa, ab and bb clusters obtained by looking across all snps . it should also assign an appropriate number of calls to each genotype in order to obey hardy-weinberg equilibrium. a clustering that performs well according to these criteria is likely to be more accurate than one that scores poorly in one or more of these areas. to exploit these underlying signal characteristics and genetic principles, we applied logistic regression using these variables to predict k independently for each snp.

to obtain an initial estimate of the cluster centers, k-means clustering with k =  <dig> is first applied to normalized log-ratios from each snp separately. a vector containing the median values for the aa, ab and bb clusters  is used as a consensus value, and the variance-covariance matrix  estimated. the snp-specific  predictors calculated across all n
i 
samples  used in the regression model include the residual sum of squares  <dig> for k clusters, where m
ij 
is the normalized log-ratio), mahalanobis distance vk^t, where x
ik 
is a vector of cluster centers from a given k-means clustering) and agreement with hardy-weinberg equilibrium  <dig>  ri1=pi <dig>  r
i <dig> =  <dig> p
i 
, r
i <dig> =  <dig>  n
i <dig> = number of aa calls made, n
i <dig> = number of ab calls made and pi=2ni1+ni2)2ni is the empirical major allele frequency based on a given number of clusters, k). each variable is calculated for each snp using the cluster assignments obtained via k-means clustering with k =  <dig> , <dig>  leaving  <dig> variables in the regression. coefficients for each parameter were estimated from fitting this model to a training set of  <dig>  randomly chosen snps from the hapmap data sets. the independent genotype calls provide us with the true k for these snps. both ordered logistic regression  of the alternate allele), or regular logistic regression  as available in the polr  and vglm functions  respectively were used. once regression coefficients are available, and given a complete set of covariates , the best k is determined for each snp by obtaining fitted values from the model and choosing the k with maximum probability. next k-means clustering is applied using the predicted value of k to obtain genotype calls. this approach is applied to all snps from autosomes and pseudo-autosomal  regions of the genome.


call confidence measures

the silhouette width , where b^ij is the smallest average between cluster distance for the ijth observation and all other observations in a different cluster and ŵij is the average within cluster distance for the ijth observation and all other observations from the same cluster) as calculated in pam clustering  <cit>  is used as a call confidence measure. this value will be near  <dig> for calls made with high confidence  and - <dig> for low certainty calls .


choosing an optimal preprocessing/regression combination

using the independent hapmap calls, the median and median absolute deviation  of each cluster  was determined to obtain a snp-level view of the effect of normalization . although the centers were more consistent after quantile adjustment with an extra loess correction compared to quantile normalization alone , the effect on the variability was a mixed one for homozygous clusters, with some clusters becoming more variable, relative to no normalization and some less variable . quantile normalization generally lowered the between sample variability more consistently than no normalization and quantile normalization combined with loess correction.to assess the performance of the different regression/preprocessing combinations, the concordance between the genotype calls made by each method were compared with the independent calls obtained from the hapmap database. figure  <dig> shows the results from the two logistic regression methods  coupled with either quantile normalization alone or quantile normalization followed by loess adjustment. the drop rate refers to the proportion of snps that have been removed from the accuracy calculation on account of low call confidence measures. for each data set, regular logistic regression applied to log-ratios after quantile normalization gives higher accuracy. this optimal preprocessing combination was chosen as the default implementation of krlmm in the remainder of this paper.


calling snps from sex chromosomes

snps outside of pseudo-autosomal regions on the x and y chromosomes represent special cases that are called separately for males and females to allow for the appropriate number of clusters . when gender  of the samples is not specified, the average intensities  from the y chromosome snps are used to impute this information. applying k-means clustering with k =  <dig> clusters separately to all chromosome y markers should assign females to the low signal group  and the males to a second high intensity group that corresponds to signal from one copy of the y chromosome. samples are then assigned as female or male by looking at which cluster  is closer on average by comparing the median cluster position determined by k-means and the median s-value for these snps within each sample. this simple approach was found to be 100% accurate on each of the  <dig> platforms upon comparison of the imputed gender with the information provided by the hapmap database.


implementation

an overview of the krlmm algorithm and the regression analysis used to determine k for each snp is presented in figure  <dig>  the genotype.illumina function available in the crlmm package  <cit>  from r  <cit> /bioconductor  <cit>  implements this approach when call.method=~krlmm~, allowing users to read in idat files using capability available through the illuminaio package  <cit>  and make genotype calls in one simple command. a second option for importing data is offered through the readgencalloutput function, which handles either tab or csv delimited genomestudio reports. regression coefficients and reference distributions for the quantile normalized x and y channels obtained from analyzing illumina’s in-house hapmap samples are stored in chip-specific data packages also available from bioconductor . the krlmm method does not currently support data from affymetrix genotyping arrays.

other algorithms
table  <dig> summarizes the major features of the  <dig> algorithms compared in terms of normalization method and underlying model. normalization occurs either within  or between sample . likewise, the model-based clustering can occur within sample , between sample  or in a hybrid manner . for a review of the first  <dig> methods, see ritchie et al.   <cit> .

the opticall algorithm is a hybrid between genosnp and illuminus. it first makes use of data from  <dig>  randomly chosen intensity values to do an initial clustering using a mixture model with  <dig> states . this step is akin to genosnp’s between snp approach for genotyping. opticall then clusters snp-by-snp using a model similar to the one used in illuminus, with added hierarchical structure including priors derived from the initial clustering. in clusters with few observations, the prior ensures the clusters are sensibly placed, thus overcoming one of the shortcomings in illuminus. we chose opticall as a representative method from the newer calling methods tailored for low frequency/rare variants. m  <dig> <cit>  was also considered, however its implementation in matlab  precluded us from using this software. another option is the zcall algorithm  <cit> , which unlike the other methods compared, begins with the output of gencall rather than the raw intensity data. such a post-calling correction method could presumably be adapted to improve the calls from any method once calls and confidence values are available from the raw data.

RESULTS
for performance comparison, concordance between the genotype calls made by each method and the independent calls obtained from the hapmap database were used to calculate accuracy. figure  <dig> shows the accuracy of each method for the  <dig> data sets listed in table  <dig> for autosomal snps at varying drop rates. overall differences between the five methods are modest, with most delivering accuracy above 98%. krlmm has the best or equal best performance amongst the methods compared, while gencall tends to have lower to intermediate accuracy.the performance of opticall varies the most between data sets: in the omni5-quad data set  it is marginally worse than all other methods; in the omni1-quad data set  it is more accurate than gencall, but less accurate then the other methods  while in the omni <dig> -quad data set  its accuracy is comparable to the other methods. given opticall’s hybrid approach between genosnp and illuminus, this inconsistent behaviour was surprising, with performance on par with these two methods expected. although overall differences in accuracy between the methods are modest, given the large size of the respective data sets, differences as small as  <dig> % will translate to thousands of additional correct genotype calls per sample. for example, the difference between krlmm and gencall in figure 6a at a drop rate of 2% equates to an average of  <dig>  additional correct calls per sample. in figure 6c at the same drop rate , the difference in accuracy between krlmm and opticall equates to an average of  <dig>  additional correct calls per sample.we next stratify accuracy by maf and concentrate on common snps . ignoring the overall differences in accuracy that are consistent with the results seen in figure  <dig>  we see that the performance of different methods varies by maf. for the majority of methods, accuracy increases gradually with maf, consistent with the idea that the clustering problem becomes easier as the number of observations in the clusters involving the minor allele increases. opticall is an exception to this trend, giving less accurate calls for common snps than illuminus; this is especially pronounced for the omni1-quad  and omni5-quad chips . this highlights the reason for the poorer overall performance of opticall relative to illuminus and genosnp for these chips . the accuracy is only marginally worse  for opticall compared to other methods, however given the ease at which snps with higher maf can be called by other algorithms, it may suggest the presence of a minor bug in the version of the software we used . differences between the methods are consistent as the number of low confidence calls removed increases from 1%  to 5% .

we next zoom in and focus on the ability of different genotyping methods to call low frequency content . accuracy was stratified to look at calls involving either the major allele only or the minor allele. this is a key comparison, as methods with a systematically higher error rate for calls involving the minor allele will pay a negligible price in terms of overall accuracy since there are so few of them. figure  <dig> plots results by major  and minor  allele for each method at a drop rate of 1%. for calls of the major allele, all methods show comparable accuracy . gencall is slightly less accurate for the omni1-quad platform , but this can be attributed to use of an older version of gencall . for minor allele calls , illuminus is generally slightly less accurate, followed by gencall in the omni1-quad and omni5-quad data sets . krlmm performs comparably to opticall and genosnp across the board for both the major and minor allele calls. in particular for the low frequency content  on the omni5-quad platform , krlmm, genosnp and opticall all have accuracy above  <dig> , whereas gencall and illuminus are below this level . as previously noted, the performance of illuminus improves as more samples are available  <cit> , with higher accuracy achieved on both the omni1-quad  and omni5-quad  compared to the omni <dig> -quad data set . this highlights the difficulty faced by methods that model  <dig> clusters for every snp using only the data at hand. clusters with no or few observations, as occurs at low maf, are more likely to be erroneously called. as sample size increases, there is more data to support these minor clusters, which improves the accuracy of illuminus to a level comparable to that of other methods. the accuracy of opticall is on par with genosnp as expected, since opticall makes use of priors obtained from other snps, thereby overcoming the major limitation of illuminus.to explore situations where the adaptive approach of krlmm is beneficial, we examined snps where krlmm is in perfect agreement with the calls from the hapmap database and the other methods make varying numbers of mistakes. figure  <dig> shows  <dig> examples that exemplify the main categories observed: snps with fewer than  <dig> clusters , snps with less well separated clusters , or snps with signal that is skewed towards one of the homozygous clusters . the first situation will benefit from krlmm’s adaptive approach to clustering, while the presence of shifted signal shows the utility of snp-specific clustering over the more global approaches of genosnp and opticall that cannot accommodate skewed cluster positions.

CONCLUSIONS
overall, the krlmm algorithm marginally outperforms the vendor’s own alternative  in terms of accuracy, even at low minor allele frequencies. for low frequency variants, our results show the merit of approaches that use the signal from other snps either directly in their models  or indirectly to help choose the appropriate number of clusters  to give more accurate calls. such approaches offer modest improvements over gencall and illuminus that do not have a tailored approach for dealing with snps with low maf.

the krlmm method uses k-means clustering of the log-ratios obtained after between sample quantile normalization of the raw intensities and logistic regression to determine the number of clusters to fit to each snp. it is the only algorithm to date that allows flexibility in the number of clusters. although the data we have used to benchmark our approach  is known to be of very high quality, we are still able to detect small performance differences between our method and the vendor provided alternative. these performance differences are expected to be more pronounced in disease association studies, where samples are collected over an extended period and will be subject to additional sources of variation. the benefit of krlmm’s between sample normalization is anticipated to deliver additional performance gains in such settings.

the krlmm method requires a small subset of training data . although this information was obtained from hapmap data in our case, the regression coefficients could just as easily be estimated using calls from another method if such data were more readily available, as may be the case for platforms from other species. support for newer illumina platforms can be easily added and future extensions of the method to handle data from the two-color axiom platform from affymetrix are also conceivable. another adaptation would be to allow k >  <dig> so that krlmm could be used on cancer samples where gains and losses in the genome introduce copy number variation.

future comparisons of the performance of different genotyping algorithms on data from a genome-wide association study  or suitable non hapmap control data set, such as the large collection of reference samples in wang et al.   <cit>  would also be instructive. previous work has demonstrated that the choice of method can influence gwas results obtained from the affymetrix platform  <cit> . this important extension will determine whether the same holds true for studies that use illumina snp arrays. publications on this platform to date predominantly rely on calls from the gencall or illuminus algorithms. this will be of particular interest at the rare or low frequency end of the minor allele spectrum, especially when it comes to any significant associations detected or missed by particular genotyping methods. access to a suitable reference gwas data set where raw data for both cases and controls is available will be the key to such a comparison.

abbreviations
gwas: genome-wide association study; krlmm: the new genotype calling algorithm described in this article; maf: minor allele frequency; snp: single-nucleotide polymorphism.

competing interests
the authors declare that they have no competing interests.

authors’ contributions
rl, mr and ri devised the algorithm and zd, rl and mr implemented the method in public software. my provided advice on algorithm development and data sets. rl and mr performed data analysis and mr wrote the manuscript with input from rl and ri. all authors read and approved the final manuscript.

