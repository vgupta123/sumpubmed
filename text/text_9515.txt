BACKGROUND
common evolutionary origin or homology is one of the key concepts in biology. homologous proteins usually share similar three-dimensional shape and often perform identical or similar molecular functions. therefore, detection of homology is now routinely used to make inferences regarding structure, function or evolution for the protein of interest. protein sequence comparison is the primary means for establishing homology. for closely related proteins, sequence similarity can be detected even by an untrained eye, however, the similarity becomes weak and difficult to distinguish from random as the evolutionary distance increases. in many cases not until three-dimensional structures become available the homology between proteins can be established.

comparison of multiple sequence alignments instead of individual sequences can often facilitate inference of remote homology relationships. this should not be surprising, because in contrast to a single sequence, a set of aligned related sequences can tell much more about the conservation  of individual positions or regions within the polypeptide chain. for homology detection, multiple sequence alignments are generally converted into either of the two numerical forms: position-specific sequence profiles or hidden markov models   <cit> . the main difference between the traditional sequence profile and hmm is that the latter incorporates position-specific insertion and deletion probabilities.

at present, profile-profile or hmm-hmm comparison represents arguably the most sensitive remote homology detection strategy. although over the years profile-profile  comparison methods have improved significantly, they still lag behind methods based on protein structure comparison. on the other hand, there are a number of areas for potential improvement of such methods, including the way profiles  are constructed, profile  similarity is scored and statistical significance of that score is estimated. for example, fixed gap opening and extension penalties, traditionally used in profile comparisons, is a poor representation of protein evolution. thus, introduction of position-dependent variable gap penalties might be expected to lead to considerable improvement of profile-based methods. further development of statistical framework is another promising area of improvement for both profile and hmm-based methods.

here, we present coma , a new profile-profile search and comparison method that has a number of novel features. however, the two features that distinguish coma from other profile-profile comparison methods most, are position-dependent gap penalties and a global score system, which enables analytical solution of the statistical parameters used in estimation of the significance of a match. we show that at the protein domain level coma performs better than several other state-of-the art homology detection methods.

methods
methods that aim to detect relationship between protein families by comparing corresponding sequence profiles include three main components: 1) profile construction algorithm, 2) logic for profile comparison and 3) estimation of statistical significance of the profile-profile alignment score. in this section we describe underlying theoretical considerations and their implementation in coma.

profile construction
multiple sequence alignments are converted into profiles similarly as in psi-blast  <cit> , but with new additions and modifications as described below.

filtering of high and low complexity regions
sometimes multiple sequence alignments have stretches of positions  with highly divergent residue distribution, which means that the expected occurrence for nearly all residue types is about the same. these stretches, defined here as high complexity regions, often indicate either misaligned or structurally unrelated sequence regions and may negatively affect subsequent comparison of profiles. comparison problems may also be caused by multiple alignment regions of low compositional complexity. these may include groups of columns with short periodic repeats or very similar residue distributions and often correspond to unstructured regions of aligned sequences. to deal with both extremes of compositional complexity, the seg algorithm  <cit>  has been modified and adopted to work with multiple alignments and profile positional vectors. by default, coma uses the modified seg for filtering high complexity regions prior to the construction of a sequence profile. optionally, low complexity regions can be filtered as well.

sequence weighting
as in psi-blast, sequence weights are computed from the reduced multiple alignment that is compiled for every position of the input multiple alignment. however, in contrast to psi-blast, sequences from the multiple alignment are included into the reduced multiple alignment only if the residues contributing to the corresponding position are not at the sequence termini. this is important, because in some cases, the reduced multiple alignment may consist of only a single column, leading to the assignment of incorrect sequence weights and subsequently to a dramatic deterioration of the overall performance in profile comparisons. in coma, more stringent requirements for reduced multiple alignments help to avoid such situations. after reduced multiple alignments are compiled, sequence weights are calculated by the modified henikoff & henikoff sequence weighting algorithm  <cit> .

initial scores and probabilities
profile scores are calculated using an initial score table such as that from blosum  <cit>  or pam  <cit>  series. here, we use a newly derived initial score table, constructed from multiple alignments obtained for astral  <cit>  sequences. the table is derived using a method similar to that of henikoff & henikoff  <cit>  and can be easily recalculated for a different set of multiple sequence alignments. residue substitution frequencies and background probabilities derived from the initial score table are used to compute target probabilities  using the tatusov pseudo count method  <cit> .

composition-based statistics
the alignment score obtained using explicitly defined score table is related to its statistical significance  <cit> . thus, each score table used for generating alignments can be characterized by the statistical parameters of the score distribution  <cit> . in coma, the computed statistical parameter values for the initial score table are used for composition-based statistics  <cit> . once a profile is constructed, it is compositionally adjusted to have statistical parameter values equal to those of the initial score table. such a compositional adjustment is needed to normalize profile scores so that alignment scores would follow the reference distribution.

deletions and insertions
comparison of profiles in many cases is bound to produce gapped alignments. therefore, an accurate estimation of insertion and deletion probabilities at every profile position is a significant factor that affects alignment quality. currently, profile-based methods such as psi-blast  <cit>  and compass  <cit>  use constant gap penalties, but that is a poor approximation of evolution of protein families. in coma, insertion and deletion probabilities are allowed to vary along the length of the sequence profile. deletion is defined as gap in a sequence aligned against the residue in another sequence, while insertion corresponds to residue aligned against the gap. the probability of a deletion at the position i of the multiple alignment is expressed as 1-Σafa, where fa is the weighted observed frequency, calculated for the residue a at the position i. an exhaustive analysis of  <dig> profiles showed that deletion probabilities can be accurately approximated linearly. thus the generalized probability of a deletion at the profile position i is described by the linear function whose slope and intercept are determined from the probability values at the boundary positions of the deletion. the probability of an insertion at the profile position i is defined as the weighted observed frequency for the gap  at the profile position i. since the insertion always corresponds to a residue, which occupies a profile position, no generalization of probabilities of insertions is needed.

profile-profile comparison
in coma, a pair of profiles is aligned using a modified smith-waterman dynamic programming algorithm  <cit> , the score system and the position-dependent variable gap cost scheme.

score system
the score sia of the residue a at the profile position i is defined as , where  is the target probability of the residue a at the profile position i, pa is the background probability of the residue a, λp is the reference statistical parameter of ungapped alignments of protein sequences such that the target probabilities  sum to  <dig>  <cit> .

similar log-odds principle is used to construct a score system for a pair of profiles. an individual profile is the score table constructed for a single sequence using the processed information from the multiple alignment. the information from the multiple alignment is in part expressed with the weighted observed frequencies  for the residue of type a at profile positions i. weighted observed frequencies are important measures of positional conservation and are also used to derive the target probabilities . thus, we use both profile quantities  to define the target probabilities when comparing a pair of profiles. let  denote the target probability of the residue a at the profile position i of the first profile, and  the corresponding target probability at the profile position j of the second profile. let  and  be the observed frequencies of the residue a at the profile positions i and j of the first and second profile, respectively. we say that two positions i and j of two distinct profiles are more similar if the probability odds ratio  is greater. the score sij of matching the position i of the first profile with the position j of the second profile is calculated as follows:   

where n is the normalizing term such that the background probabilities for a pair of profiles sum to 1:   

λ in equation  <dig> is a statistical parameter of profile-to-profile ungapped alignments such that the target probabilities of a pair of profiles  sum to 1:   

where p is the background probability for a pair of profiles or, in other words, probability of the score sij, sk are the discrete values of sij and   

having all terms defined, we can express the score sij from equation  <dig> as follows:   

note that the statistical parameter λ is solved from the equation  <dig> using the background probabilities in equation  <dig> so that the target probabilities for a pair of profiles in equation  <dig> sum to  <dig>  to solve equation  <dig>  scores sij are multiplied by 2c  and rounded to the nearest integer value.

correction of scores
multiple sequence alignments, from which profiles are constructed, may carry very different amounts of evolutionary information. for example, the information extracted in one case from three and in other case from three hundred aligned diverse sequences cannot be considered to have the same value. thus before the final alignment of a pair of profiles, assuming that probabilities do not change, scores sij are corrected as follows:   

where t and t' are the effective number of sequences comprising a reduced multiple alignment at the profile position i of the first profile and position j of the second profile, respectively. since the limit of the sum  is  <dig>  the corresponding constant is introduced in the numerator of equation  <dig> to keep both the corrected and original scores in a similar range. the parameter λ in equation  <dig> is now solved from equation  <dig> so that the corrected target probabilities of a pair of profiles sum to  <dig>  using the correction scheme , the profile scores obtained from a "thin" alignment are down-weighted in comparison to the scores from a "thick" alignment. in the general case the scores of the "thin" profile are averaged over the observed weighted frequencies of the "thick" profile using higher weights, while the scores of the "thick" profile are averaged over the corresponding frequencies of the "thin" profile using lower weights. if one of the two profiles, say the first, is constructed from a single sequence,  and then the log-odds of the first profile are averaged over the observed weighted frequencies of the second profile. several other score correction schemes have been tested, but the one in equation  <dig> worked best. in the extreme case, when both profiles are constructed from a single sequence, no correction is applied.

in addition to "thickness", the information content of the profile position i is characterized by the expression of relative entropy . small values of r indicate uninformative and variable positions. therefore, scores of the positions, having r lower than the specified threshold, are scaled down by the adjustable factor . the threshold is inversely proportional to -log e, where e is the pre-calculated e-value per hit. for compositionally similar profiles this threshold will be low. scaling down of the scores for positions of low entropy is performed independently of the effective number of sequences  comprising corresponding positions.

gap cost computation
position-dependent gap costs for a pair of profiles are defined by the insertion/deletion probabilities for every position of individual profiles and by the limits within which position-specific gap costs are allowed to vary. the high scoring positions of the score system are mostly conserved, and the probability for a gap to occur there is low. in contrast, the positions of low scores often match variable regions  where the probability of a gap becomes higher. thus, gap cost limits should be more stringent for high scoring positions than for low scoring ones. following this logic, gap cost limits for the first and the second profile are calculated using respectively the row and column maximum scores of the score system. for each position of the score system, the number w of maximum scores is recorded and their autocorrelation is calculated. since the autocorrelation is a sum of the products, the characteristic value of maximum scores for the corresponding position is calculated as the square root of the autocorrelation value divided by the number of summed products. this ensures that the characteristic value is within the similar range as the maximum scores. the final gap cost limit for the corresponding position is computed as the square root of the autocorrelation function of the characteristic values divided by the number of summed products. the goal of this procedure is to make the gap cost limit for the corresponding position dependent on the adjacent characteristic values. the formal description of this logic follows below.

let sij denote the score for the positions i and j of the score system. let  be the sorted periodic sequence of the w maximum scores at the position i of the score system such that , , , .... similarly, let  be the sorted sequence of the w maximum scores at the position j such that , , , .... let further {ai}i be the periodic sequence such that  where  is the autocorrelation function, and let  be the periodic sequence defined so that  for all i . similarly, let  be the sequence such that , where  and  be the periodic sequence defined for all j: . then the gap cost limit a for the first profile computed at the position i of the score system is defined as follows:   

where  is the autocorrelation function of  in a window of size k ; ω / <dig> is the number of the summed products. if the condition in equation  <dig> is not satisfied, a is assigned to  <dig> 

similarly, we define the gap cost limit b for the second profile at the position j:   

where  is the autocorrelation function of  in a window of size k. if the condition in equation  <dig> is not satisfied, b is assigned to  <dig> 

sometimes low positive scores in the score system imply relatively low gap cost limits leading to high-scoring local alignments, which may be poor because of the positive expected score per aligned pair of positions  <cit> . in coma, to address this problem, the term z is added to the multipliers within the autocorrelation functions in equations  <dig> and  <dig> so that the gap cost limits are widened:   

the parameter z in equation  <dig> is introduced twice in a two-step iterative protocol. in the first step, the term z, inversely proportional to √h, is added to each of the autocorrelated values. h is a statistical parameter of entropy  and its low values indicate low scores. by default, h is derived analytically for a pair of profiles . in the second step, an initial alignment and its e-value are computed. based on this initial alignment, z is reevaluated as -y/, where x and y are adjustable parameters and e is the initial estimated e-value per hit. this reevaluation implies narrowing of gap cost limits in case of small initial e-values that indicate possibly related profile pairs.

a gap cost at a certain position of the score system is two-sided. it depends on both the deletion probability in the first profile and the insertion probability in the second . the final gap cost g for the first profile at the position i of the score system is defined as a fraction of the size of the gap cost limit a at the position by the superposition of the deletion and insertion probabilities:   

where d is the deletion probability of the first profile at the position i, i is the insertion probability of the second profile at the position j. since the gap cost limits a by definition mean the costs of the deletions for the first profile, a weight of the deletion probability d of that profile in the expression for g is reduced by the constant c . the gap cost for the second profile c is computed in a similar way:   

where p is the deletion probability of the second profile at the position j, j is the insertion probability of the first profile at the position i.

if multiple sequence alignment is "thin", the effect of deletion and insertion probabilities may be disproportionally large. for example, consider a position of multiple sequence alignment consisting of just two aligned sequences where the second sequence contains a gap. the insertion probability for that position would be 50%. to avoid such situations, the insertion/deletion probabilities are adjusted by a factor of 1/), where t is the effective number of sequences in multiple sequence alignment at a given position, and u and v are the adjustable parameters. when the alignment is "thick" , the factor approaches  <dig> and the adjustment essentially has no effect.

all the heuristic parameters  were optimized on the most structurally diverse and most difficult subset  of the dataset.

statistical significance
an accurate estimation of statistical significance of the alignment score is important as it tells whether aligned sequence profiles  are likely to be related or not.

we use analytical estimation of statistical significance. the analytical approach was initially proposed  <cit>  for any score table used for ungapped sequence alignments and meeting two necessary conditions: the mean of scores must be negative and at least one positive score must exist in the table. it was shown  <cit>  that the distribution of the optimal alignment scores using a score table that meets these two conditions can be well approximated by the extreme value distribution . furthermore, it was shown  <cit>  that the limit of average score per aligned pair of positions exists for gapped alignments. this means that the theory can be extended for gapped alignments and this has been demonstrated in practice  <cit> .

statistical parameters
if the distribution of the optimal alignment scores is approximated by evd, the expected value e  can be expressed as follows:   

where m is a length of the query profile, n is a length of the database. this expression of e-value and the corresponding p-value ) are the ones used in coma to estimate statistical significance. since the score system used in coma is amenable to the karlin-altschul statistics, the statistical parameters are derived as follows: the scale parameter of the distribution λ, is solved from equation  <dig>  where the scores sk are calculated from equation  <dig>  k is found by the formula given in  <cit> . using the definitions of the target and background probabilities in equation  <dig>  the parameter of relative entropy h required to compute k is expressed as follows:   

it follows from equation  <dig> that the target probabilities are equal to  where , and the log-odds in equation  <dig> are equal to λ sij. using the notations found in equations  <dig> and  <dig>  h is expressed as:   

it is important to note that the search space m n used in equation  <dig> is valid asymptotically. thus, the edge effect  is corrected by computing additional statistical parameters α and β  <cit> .

composition-based statistics and the global score system
in coma, statistical parameters are computed for each pair of profiles to be aligned. the exact values of solved statistical parameters  may differ from pair to pair of profiles leading to adverse effects such as different statistical significance values for identical scores. to deal with this problem we apply composition based statistics using a newly introduced global score system. the idea of the composition-based statistics  <cit>  is to transform a score table  so that its statistical parameter λu* becomes equal to the reference value of λu, where λu is the statistical parameter of the distribution of ungapped alignment scores. for sequences the reference parameter corresponds to the known parameter of the residue substitution score table used, e.g. one of the blosum  <cit>  or pam  <cit>  families. for profiles, there is no explicitly defined alphabet of finite size such as that for sequences .

here, to make such an alphabet for profiles, we compile all unique profile vectors from the profile database used for profile comparisons and construct a global score system of profile vectors . each cell  of the global score system contains the similarity score sij of two profile vectors. solving equation  <dig> for the parameter λ gives us the value of the required reference parameter λu. after the score system is constructed for a pair of profiles, its scores are transformed so that the parameter λu* of the score system becomes equal to the reference parameter λu. making use of the global score system involved a non-trivial algorithmic approach , but it significantly improved the performance of coma.

statistical significance of gapped alignments
the analytical theory of statistical significance estimation has been developed only for ungapped alignments  <cit> . since there is no universal theory for gapped alignments, the statistical parameters of the score distribution of gapped alignments have to be estimated empirically. although in theory  <cit>  it is possible to derive analytical expressions of the statistical parameters of gapped alignments, in practice this does not seem to be feasible and, to our knowledge, so far has not been implemented. the gap cost scheme in coma is complex, and the analytical approach in this case would not be feasible as well.

on the other hand, it has been shown empirically that the scores of gapped alignments are also distributed according to evd  <cit> . for profile-profile comparisons, the score distribution might be slightly diverged from evd  <cit>  due to specifics of the profile scoring and gap introduction methods. however, for significance estimation the most important is the tail of the distribution, which can be accurately represented by evd.

to derive the reference statistical parameters λg and kg for gapped alignments, we compiled a set of unrelated coma hits. this set comprises  <dig>  <dig> hits that fulfil all of the following conditions:  profiles are from different scop  <cit>  superfamilies,  coma alignment score is ≥  <dig>  and  tm-score  <cit>  according to the dali  <cit>  alignment evaluated in the local mode is ≤  <dig>  .

having compiled the set of unrelated hits, we then derive the scale and localization reference statistical parameters of the extreme value distribution, λ and μ, respectively, as follows. we progressively increase the lower bound of the alignment score threshold for alignments to be considered, each time re-estimating the statistical parameters for the resulting set. in this way we obtain a series of values for both λ and μ that in general show a significant variation . however, with the increase of alignment scores, the statistical parameter values become fairly stable , allowing to select them as the reference values for gapped alignments . in other words, the empirically derived reference values of λ and μ are expected to accurately describe the statistics of score distribution in the region of higher scores .

as a result of the composition-based statistics, the parameter λ u* solved and scaled for a pair of profiles is equal to the reference parameter λu of the global score system: λ u* ≡ λu. only in rare cases, e.g. because of low absolute values of scores , λu* and λu might be slightly different. we then assume that the statistical parameter λu* of the score system for the pair of the profiles to be aligned with gaps differs from the reference parameter λg* exactly in the same ratio as λu* differs from λu. the same principle is applied for estimation of the statistical parameter kg* of the score system for the pair of profiles to be aligned with gaps. however, in contrast to λ, the values of ku and ku are of ten different. thus, kg* is calculated by adjusting the empirically estimated kg by the factor ku*/ku. the final expressions of λg* and kg* are as follows:   

RESULTS
to evaluate coma, we compared its ability to detect remote relationships and produce accurate alignments with that of other state-of-the-art profile-based methods. we chose compass  <cit>  , another profile-profile comparison method, hhsearch  <cit>  , a method based on hmm-hmm comparison, and psi-blast  <cit>  , a widely used profile-sequence method.

test set
the assessment of distant relationships and corresponding alignments can be best done having three-dimensional  structures of the test set proteins in hand. here, we used scop  <cit>   protein structures and corresponding astral  <cit>  sequences. having focused on distant homology we only considered sequences 20% or less identical to each other. we also excluded sequences of small and membrane protein classes . as a result, we ended up with a large statistical sample consisting of  <dig> sequences representing a wide variety of protein structures and a challenging set for similarity detection. for each sequence from this set, multiple alignments were built by running up to  <dig> iterations of psi-blast against the ncbi non-redundant  sequence database filtered to the maximum identity of 70%. to prevent unrelated sequences from entering the alignments, we ran psi-blast using a stringent  sequence inclusion threshold and with low complexity filter turned on. the resulting alignments were used in all-to-all comparison for all methods except for compass. before running compass, alignment columns corresponding to gaps in the first  sequence were removed, substantially improving its performance.

evaluation framework
traditionally, homology detection methods have been evaluated against a reference protein classification scheme and reference alignments serving as "gold standard". however, the more remote relationships are considered, the less straightforward becomes the use of "gold standard" classification schemes and alignments. for example, the original hierarchical scop classification scheme implies that protein domains assigned to different folds are unrelated and therefore should be considered as a false positive match in the benchmark. yet, by now, it is commonly accepted that there are many evolutionary related proteins classified as having different folds. perhaps most obvious examples include rossmann-like domains, immunoglobulin-like β-sandwiches and β-propellers. evolutionary relationships can be found even at the highest hierarchy level, between domains belonging to different scop classes .

reference alignments usually have to be derived separately, using some structure comparison method, e.g. dali  <cit> . however, different structure comparison methods tend to produce structure-based alignments that differ in coverage and/or accuracy. this problem is essentially non-existent for closely related proteins, but becomes very important in the cases of remote homology, the area specifically targeted by profile-profile comparison methods.

therefore, to bypass additional problems with reference classification and reference alignments we chose to use exclusively the reference-free evaluation framework based on structural models. in this framework, no other information except for the pairwise sequence alignment produced by the assessed method and 3d structures of aligned protein domains is needed. alignment is used to generate a 3d model of the query sequence based on the structure of the match. the questions of whether the match is correct  and whether the alignment is accurate are automatically answered by evaluating the obtained model against the real structure. such model evaluation framework has been very effective in critical assessment of techniques for protein structure prediction  experiments lasting over a decade  <cit> . for assessment of homology detection methods the reference-free evaluation initially was introduced as a way to take care of exceptions within the "gold standard" scop classification  <cit>  and, more recently, validated as an entirely self-sufficient evaluation framework  <cit> .

here, pairwise alignments obtained by every tested method are converted into corresponding 3d models using a standard modeller  <cit>   run. to evaluate the quality of the models we use the template modeling score   <cit> , which is similar to gdt_ts  <cit>  and maxsub  <cit>  measures, but is designed to be less dependent on the protein size. tm-score generates a single value in the  range indicating how close is the model to the reference structure  <cit>  . accordingly, in our evaluation scheme the aligned pair of proteins is accepted as a true positive match, if the tm-score is ≥  <dig>  and a false positive match, if the tm-score ≤  <dig> . alignments producing intermediate tm-score values  are considered to represent "unknown" relationships.

evaluation of methods in all-to-all comparison
to measure the performance of all the evaluated methods, we performed all-to-all comparison for the test set . although in our evaluation framework the alignment, produced by a method being tested, by itself defines both the quality of the match and the alignment accuracy, two different evaluation modes, global and local, are possible. in a global mode, the alignment is evaluated with respect to the entire protein domain. this is equivalent to asking how useful the alignment is for generating a structural model of that domain. in a local mode, the alignment is evaluated within its boundaries. this mode measures how well a particular method can detect and align possibly short, but structurally similar fragments, without the requirement that these fragments come from overall similar domains. a caveat of this mode is that very short alignments would often score very high, independently whether the aligned fragments are related or not. therefore, in the local evaluation mode we only consider fragments that include at least  <dig> aligned residues, the length that approximates the transition from individual secondary structure elements into supersecondary structure motifs.

all-to-all comparison generates two matches between proteins a and b , scores of which in general may slightly differ. to reduce the redundancy, for each evaluated method we only consider one of the two matches producing a better statistical significance value. in both evaluation modes for every aligned pair ab we consider two models, a' and b' . although the same ab alignment is used to generate both a' and b', their corresponding tm-scores in general differ, because they correspond to different structure pairs aa' and bb'. of the two tm-scores for the ab pair we take the better one.

in the global evaluation mode, coma is clearly better than the other methods included in the comparison. within the high specificity range  compass is second, but in the lower specificity region  is overtaken by the hhsearch version that uses secondary structure information. for the user of a particular homology detection method, the most important is the left-most region of the curve, because it corresponds to the statistically most significant matches. the significantly better performance by coma in this region becomes even more apparent when the same data is plotted in a log-scale . to make sure that this result is not specific to the exact cutoff  that we used as a criterion of true positive we have also tried alternative definitions . in both cases we obtained qualitatively similar results with coma being a top performer . in addition, we sought an independent means to confirm that the tm-score criterion is indeed sufficient to make a case for meaningful similarity of an aligned pair. for this, we analyzed the non-redundant set of true positives  produced by all the evaluated methods. all pairs from the same scop superfamily as well as those coming from different superfamilies, folds or even classes, but producing dali z-score ≥  <dig>  were considered related. it turned out that in the global evaluation mode tm-score results are nearly perfectly reproduced by the combined scop/dali classification scheme . in contrast, if only scop hierarchy is used for classification, the discrepancy is much larger.

the local evaluation mode measures the quality of the structural match predicted by the sequence alignment with respect to the aligned region only. the results of the local evaluation mode  of hhsearch are strikingly different from those obtained in the global mode. both versions of hhsearch, in particular the one using secondary structure information, outperform other methods by a large margin, except for the region of very high specificity, where coma detects the largest number of true positives . at the same time coma, compass and psi-blast all show relative performance qualitatively similar to that of the global mode. why then the hhsearch behavior is so much different in the local evaluation mode?

the apparent reason for that becomes clear if we analyze the binned distribution of the length of alignments that score as true positives in the local evaluation mode for all the methods . both versions of hhsearch strongly favor relatively short alignments . in contrast, coma and compass, are both aimed at aligning longer segments. compass specifically avoids short alignments . on the other hand, while coma produces a significant number of short accurate alignments, its strength lies in generating long ones .

thus the combined analysis of the performance by compared methods reveals the opposite preferences towards the alignment length by hhsearch on one side and coma and compass on the other side. it is interesting to note that for all of the compared methods the number of true positives is higher in local as opposed to the global mode analysis . the scop/dali criterion recaptures most of the true positives as defined by tm-score in the local evaluation mode, yet the disagreement is larger than in the global mode . this should not be surprising, because both scop and dali are aiming at the global similarity between protein domains. taken together the data indicates that 1) it is relatively easier to accurately align similar fragments than entire domains and that 2) a number of detected similar fragments are imbedded within domains that are not globally similar.

structure-based vs. profile-profile alignments
it is a common knowledge that structure-based alignments are in general more accurate than those based on sequence  comparison. thus, we asked whether and, if so, to what extent alignments produced by individual methods in all-to-all comparison can be improved by using structure comparison? to answer this question, we realigned equal number of the top matching domain pairs for each method with dali  <cit>  and computed tm-scores for these alignments. distribution of the original tm-scores and those based on dali alignments are shown in figure  <dig>  one can see that the tm-score distribution derived using dali structural alignments is strongly shifted towards higher tm-score values in both evaluation modes. in other words, dali was able to improve significantly both the coverage and accuracy of alignments. interestingly, after the realignment with dali, the tm-score distribution is similar for all evaluated methods, except for psi-blast, which remains significantly worse. these results indicate that the quality of homology detection for all of the evaluated methods  is comparable. the observed differences in performance mostly come from differences in the alignment coverage and/or accuracy.

although structure-based methods such as dali, often serving as providers of "gold standard" references, overall outperform profile -based methods, they are not perfect either. yet, in the reference-dependent evaluation, any disagreement with the "gold standard" is treated as an error. in contrast, using the reference-free setting, we can directly find cases when structure-based methods perform worse than the evaluated methods. figure  <dig> provides a couple of such examples.

in the first example , we consider two scop structures belonging to different folds that nevertheless have been identified by coma as related at the domain level. it aligned ketopantoate reductase , a representative of rossmann-fold , and the methyltransferase  ruma with statistically significant scores . dali superimposed the corresponding structures producing z-score of just  <dig>  which is at the borderline of significance . upon closer inspection, it turned out that coma and dali aligned the rossmann-fold domain with different domains of ruma. coma matched it with the catalytic domain representing a typical rossmann-like sam-dependent methyltranserase fold  <cit> , reproducing previously established relationship. in contrast, dali superimposed it with the iron-sulfur cluster-containing central domain, which has a different topology altogether  <cit> . interestingly, when the isolated catalytic domain of ruma is compared to d1ks9a <dig>  the resulting dali alignment is assigned a much higher z-score of  <dig> . the corresponding tm-score =  <dig>  indicates that dali has been able to improve over coma's alignment, thus corroborating the relationship detected by coma. however, note that this dali result was obtained only due to a manual intervention. were the original dali results and the scop classification to serve as a reference, the distant relationship detected by coma should have been considered either as false positive or at least dismissed as "unknown".

the second example  involves human psoriasin  and pike parvalbumin , a pair of clearly homologous proteins belonging to the same scop superfamily . while coma correctly assigns a significant e-value  to their alignment, dali considers this to be a spurious match . interestingly, both methods produce similar alignments, but the alignment by coma  is an improvement over dali's .

these two examples vividly illustrate the problems associated with the use of structure-based classification and/or alignments as "gold standard". with further improvement of homology detection methods the use of "gold standards" is going to be even more problematic.

discussion and 
CONCLUSIONS
in general, there are two major features that distinguish coma from other sequence profile-profile comparison methods. the first one is position-dependent gap penalties. although position-dependent gap penalties are commonly used in hmms, to our knowledge, this study is the first one to implement them for comparison of sequence profiles. the second novel feature is the concept of the global score system. it enabled us to extend the analytical theory of statistical significance estimation developed for sequence comparisons into the comparisons of sequence profiles.

so far, a theory that could be as robust as that developed earlier for sequence comparisons  <cit>  has been missing for profile-profile comparisons  <cit> . an earlier implementation of the analytical approach for sequence profile-profile comparisons  <cit>  employs a number of simplifications in computing statistical parameters, thereby affecting their precision. one of the fundamental prerequisites for application of the karlin-altschul statistics  <cit>  is the existence of the discrete score table. here, to satisfy this requirement for profile comparisons we introduce a global score system that includes all the profile vectors from a profile database. although the construction of the global score system has presented a serious challenge at the implementation level it has been successfully resolved. thus, the introduced global score system provides a foundation for the accurate analytical estimation of statistical significance of ungapped profile alignments and for composition-based statistics. gapped alignments, however, follow a different score distribution and, therefore, their statistical significance has to be estimated empirically. in the case of gapped alignments, we only focus on the tail of the score distribution, which is the most important region for significance estimation. in coma, we fit it to evd, but fitting to a slightly different distribution  <cit>  is also possible.

although in coma the statistical significance of gapped alignments is estimated empirically, the resulting gapped alignments depend, albeit indirectly, on the karlin-altschul statistics. the dependence comes from the compositional adjustment of scores and, by definition, gap penalties, derived using the analytically solved statistical parameter values. since the precision of these values strongly impacts the actual alignment of a profile pair, we believe that this significantly contributes to coma's performance.

along with algorithmic improvements, an important factor in the development of sequence profile-based distant homology detection methods is an effective evaluation framework. historically, profile-based methods have been benchmarked against external "gold standard" protein classification schemes and reference structure-based alignments. however, profile-based methods have already advanced to a point, where very remote relationships can be detected. often these distant relationships challenge the traditional hierarchical classification schemes such as scop and/or structure-based alignments . this is in line with the emerging view of "continuous" protein fold space and also with the observation that there is no single structure-based method that would always produce an optimal alignment . in this study we used an evaluation method that does not depend on any reference classification or reference alignments and only requires the knowledge of protein 3d structures. in this evaluation scheme we ask a single question: how useful is the alignment between a query and a matching protein in reproducing the structure of the query. the closer are the protein structures and the more accurate is the alignment, the better score is assigned for the aligned pair.

here, this general evaluation scheme has been applied in two different modes, global and local, each targeting different abilities of the evaluated methods. in a global evaluation mode an alignment is evaluated in respect to the entire protein domain. therefore, in this mode not only more accurate but also more complete alignments are favored. yet, a simple overprediction is not rewarded either, because if aligned regions are not structurally similar, their contribution to the total score is negligible. in contrast, the local evaluation mode is not concerned with the alignment coverage. it only measures how effective is the method in detecting and accurately aligning structurally similar protein segments, which can be very short.

it is obvious that there is an unavoidable trade-off in performance, evaluated using these two different modes. a method, optimized to produce very short accurate alignments that include only the structurally most similar segments  will fare well in the local evaluation mode, but would be very poor if evaluated at the domain level . in contrast, a method that tries to extend alignment into less structurally similar regions, may perform very well in the global mode, but will inevitably look worse if evaluated in the local mode. certainly, for different tasks, different modes may be desired. for example, the accurate detection of short, structurally similar fragments is of great value in protein structure prediction by fragment assembly, regardless whether these fragments are homologous or simply reflect similar conformational preferences. however, if the method is to be used primarily for homology modeling or structural/functional annotation of protein domains, the good performance in the global mode is more appropriate.

coma performs best at the protein domain rather than at the fragment level. this may be linked to position-dependent gap penalty scheme that allows the extension of alignment into structurally similar regions through sizeable variable regions . the shape of the roc curve in the global evaluation mode shows that coma is also good in distinguishing related from unrelated matches, an important property from the user's perspective. this property may be attributed to the new procedures of compositional adjustment of scores and statistical significance estimation. in conclusion, we hope that our new profile-profile comparison tool will be useful in studies of protein structure, function and evolution.

the coma software package and a web server are freely available for academic use at http://www.ibt.lt/bioinformatics/coma/. the standalone package also includes programs for constructing the global score system and computing/scaling its statistical parameters for any profile database of interest.

authors' contributions
mm and Čv conceived of the study and designed research. mm carried out the research. mm and Čv analyzed data and wrote the manuscript. all authors read and approved the final manuscript.

supplementary material
additional file 1
supplementary table and figures. supplementary table provides the analysis of alignments defined as "true positives" by the tm-score criterion using two independent schemes . supplementary figures provide supporting data for the results of methods evaluation. figures s <dig> and s <dig> display roc curves using correspondingly an alternative  representation and alternative definitions for "true positives". figure s <dig> provides a plot, showing how good is the agreement between the expected and observed p-values. figure s <dig> represents evaluation results as venn diagrams.

click here for file

 acknowledgements
this work was in part supported by lithuanian state science and studies foundation and howard hughes medical institute.
