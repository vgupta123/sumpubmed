BACKGROUND
chromatin immunoprecipitation on tiling array  studies attempt to identify genomic features such as protein binding  <cit>  or histone modification/occupancy  <cit> . in the former, the regions of interest are generally small, resulting in a low proportion of enriched probes and the data can be considered to come from one of two distributions, enriched or non-enriched. in contrast, the regions analyzed in the latter studies are generally large and can have multiple levels of enrichment within and between them, making their analysis more difficult. bromodeoxyuridine immunoprecipitation on tiling array  datasets, which map recently replicated regions of the genome, have characteristics that are similar to histone modification/occupancy experiments. while computational tools have been developed to address the analytical issues associated with mrna-chip and protein binding chip-chip studies, the highly enriched ip-chip datasets described above pose unique problems requiring new investigative strategies. in a recent study we used brdu-ip-chip to investigate the effects of chromatin modifications on replication timing/efficiency in s. cerevisiae cells  <cit> . we have developed a new set of computational tools for the normalization and analysis of these and similar experiments and we present them here.

5-bromo-2'-deoxyuridine  is a synthetic thymidine analog that pairs with deoxyadenosine and, when available to the cell, is incorporated into replicating dna at positions normally occupied by deoxythymidine. after genomic dna is extracted from a cell culture, regions that have been replicated in the presence of the molecule can be extracted by centrifugation or with brdu-specific antibodies. in  <cit>  brdu-incorporated dna was separated by isopycnic centrifugation and run on affymetrix tiling arrays to analyze human cell replication profiles. in  <cit>  brdu-ip dna samples from both early and late s-phase were fluorescently labeled and co-hybridized on two-color arrays to analyze the replication timing dynamics of the drosophila genome. here we concentrate specifically on the brdu-ip-chip assay, which involves the labeling and co-hybridization of brdu-ip and genomic dna on two-color tiling arrays. in  <cit>  this procedure was employed to study the co-localization of replication forks with various dna binding factors. in  <cit>  the authors used brdu-ip-chip to investigate differences in replication fork progression in response to intra-s checkpoint activation in s. cerevisiae. more recently, this technique has been employed in a comparative genome-wide analysis of replication activity throughout various stages of embryonic stem cell differentiation  <cit> .

analyses of brdu-ip-chip experiments aim to distinguish true biological signals  from array noise and to examine those signals for magnitude and associated genomic features. microarray datasets  typically contain errors resulting from sample handling, preferential amplification and labeling bias, making this task difficult. in attempts to correct for this, several chip-chip studies have incorporated mock controls into their experimental design  <cit> . under this protocol, for each experiment a mock sample  is hybridized against the same total dna as the experimental sample. following array quantification, true positive signals are identified as those that are significantly higher in the experimental data than the mock data. recently, it has been shown that without these controls the false positive rate can be high  <cit> . unfortunately, the use of these controls significantly increases the cost of each experiment and furthermore, the strategy fails to address issues pertinent to studies aimed at comparing the magnitude of signals across different experimental conditions.

computational alternatives to the use of mock controls have been developed to work with two-color array data. these typically involve a within-array normalization step aimed at eliminating intensity bias  values show dependence on their corresponding a =  + log2)/ <dig> values) and can be followed by a between-array normalization step to remove location and scale variation across multiple experiments  <cit> . simple loess normalization is usually used in mrna-chip studies for within-array normalization, based on the assumption that the m-values should follow a symmetric distribution  <cit> . briefly, probes are plotted in the ma plane and a loess curve is fitted to the data. to remove the intensity bias, the resultant curve is then subtracted from the probe m-values.

while mrna-chip m-values typically follow a symmetric distribution, array studies involving chromatin immunoprecipitation are often associated with asymmetric empirical m-distributions  <cit> . to remove the intensity bias in chip-chip data peng et al.  <cit>  proposed a two-step process in which an initial data transformation is performed under the assumption that chromosomally neighboring probes should have minimal difference in their m-values . probes are first plotted in the δ  vs. δ  plane, where δ  and δ  values are the differences between the m- and a-values of neighboring probes, respectively. under their assumption, when plotted in this plane probe data should have a slope equal to zero. with this in mind, the line of best fit to the probes in this plane is taken as the x-axis for a modified ma plane into which the probes are transformed; we refer to this line as the rotation line. following this, a modified loess normalization step is performed where the loess curve is fitted to data points within two standard deviations of the median.

if comparisons are to be made across experiments after within-array normalization, between-array normalization is typically applied to remove differences between the empirical m-distributions of the arrays not attributable to true biological variation. for chip-chip data, yang et al.  <cit>  proposed scale normalizing by a value proportional to the median absolute deviation . others have proposed quantile normalization  <cit> , which forces the m-values of all experiments to follow the same empirical distribution.

here we demonstrate that current methods for normalizing chip-chip datasets may be unsuitable for brdu-ip-chip experiments, and we describe a novel algorithm for within-array normalization that is robust to the nuances of protein binding and histone modification/occupancy chip-chip and brdu-ip-chip datasets. for each experiment, the algorithm identifies a subset of putative background probes and uses it to transform the data onto a plane where the intensity bias of the dataset is low. we then employ these subsets in between-array normalization and peak identification strategies to prepare the data for downstream analysis. finally, we present a dynamic programming algorithm that first identifies the optimal alignment of enriched regions across experiments and then assigns these regions to the known and/or predicted origins from which they most likely emanate. this results in more accurate comparisons across experiments and also allows a precise analysis of the chromosomal features surrounding each interesting region.

we illustrate the strategies proposed here on four replicate wild-type  and four replicate mutant s. cerevisiae brdu-ip-chip datasets described in greater detail in  <cit> . the mutants are rpd3Δ cells  that were shown to have earlier replication initiation  at a subset of replication origins  <cit> . all datasets were produced when dna was harvested from cells one hour after release from α-factor  into hydroxyurea  and brdu. the well-studied replication landscape of wt s. cerevisiae cells in hu and the subset of origins whose altered replication activity in rpd3Δ cells is known allows us to test the signal identification and quantification capabilities of our methods in the context of cross-experiment analysis.

RESULTS
within-array normalization
to remove the intensity bias present in the brdu-ip-chip data  we first attempted simple loess normalization with default parameter settings. figures 1a and 1b show the result of this normalization on the "cleanest"  wt dataset. under the assumption that in the presence of hu earlier and more-efficient origins fire in a higher percentage of cells than do later less-efficient origins, we expect that the amount of ip dna, and thus m-values, associated with active origins will have larger magnitudes than those associated with less active origins. the green points on the ma plots signify probes within ars <dig>  and these can be used as a measure of the normalization procedure's performance. due to the high percentage of brdu-enriched probes the loess curve is pulled away from the background probe set  during fitting. as a result, when these curves are used for normalization they artificially lower the m-values of some significantly brdu-enriched probes .

next we applied the two-step within-array normalization scheme for chip-chip data proposed in  <cit>  to brdu-ip-chip data, again using default parameter settings. figures 2a and 2b show the probes of the "cleanest" wt and rpd3Δ datasets, respectively, plotted in the δ  vs. δ  plane. the rotation lines identified in this plane do not follow the slope of the background distribution in the ma plane. after probes have been transformed using these lines, a residual intensity bias remains that seems to be more prominent in the rpd3Δ data . unfortunately this residual bias appears significant enough to affect the modified loess step, resulting in a normalized probe set with characteristics similar to probes after simple loess normalization . when these methods are applied to a slightly "noisier"  rpd3Δ dataset, they define a rotation line whose slope has the opposite sign to that of the background distribution , leading to a more obviously incorrect transformation.

the methods proposed in  <cit>  were developed under the assumption that probe m-values follow one of two distributions  and that these distributions have relatively low variance . while this assumption is generally valid for chip-chip data, it does not hold for brdu-ip-chip experiments. figure 2g shows that the replicated regions are wide  and, due to the asynchrony of replication fork movement across the cell population, there is no sharp boundary between enriched and non-enriched regions, but rather an incremental decrease in m-values on either side of each peak apex. we suggest that these characteristics, in not following those of typical chip-chip data, are the reason why the method proposed in  <cit>  is sub-optimal for brdu-ip-chip datasets.

although the data transformation proposed in  <cit>  is not appropriate for brdu-ip-chip data, we agree with their strategy of first transforming probe intensities onto an appropriate plane before further normalization. thus, to remove intensity bias we have developed a data rotation method, robust to the nuances of both chip-chip and brdu-ip-chip data, that we employ prior to the modified loess normalization step. we demonstrate our transformation on the "clean" rpd3Δ dataset, as it best displays the analytical issues associated with brdu-ip-chip arrays; for analysis of the "noisier" rpd3Δ dataset see additional file  <dig> 

an ma plot of the raw rpd3Δ data shows that the background probes , under the correct transformation, have a dense and relatively symmetric empirical m-distribution . as shown in  <cit> , this is a characteristic feature of chip-chip data, and thus the methods described below will also be applicable to such data. we propose a data transformation that takes advantage of, and searches for, a subset  of the n probes whose distribution best follows these characteristics. after the probes in  are identified we define a rotation line that follows their slope in the ma plane and adopt it as the x-axis for a modified ma plane.

to identify  we first search for the d densest subsets of probes  with sizes k <dig> = n/d, k <dig> = 2n/d,..., kd = n. here, the density of a probe set is measured by the size of its minimum spanning tree in the ma plane; see methods for details. d is a parameter that determines the granularity of the algorithm . following this, we search for the smallest of the d subsets whose "symmetry" measure r  is greater than an experiment-specific cutoff rc , and  is defined by this subset of probes.

to assess the symmetry of probes in the set  we calculate the first and second principal components,  and  respectively, of its probes in the ma plane, and define its symmetry measure ri by

  

where msti denotes the minimum spanning tree of the subset,  <dig> denotes the indicator of a set, and the cutoff ci is determined as the median of the -values of the set . we choose this subset size because we know a priori that less than 80% of probes are enriched in the experimental conditions being analyzed .

we define  as the set of size kj where

  

and rc =  <dig> × standard deviation of r <dig>  r <dig> ..., r <dig> n. this choice is motivated by the observation that if ki is the size of the largest subset of size at most ||, then the values r <dig>  r <dig>  r,..., ri fluctuate at a value close to  <dig>  whereas the values ri+ <dig>  ri+ <dig> ..., rd incrementally increase, as enriched probes are only included in the numerator of the ratio defining r . the cutoff value rc is dependent on the a priori knowledge that at most 80% of all probes are enriched.

after  is identified, all probes are transformed into the plane whose x and y axes correspond to its first and second principle components, pc <dig> and pc <dig> respectively . following the rotation, the modified loess step proposed in  <cit>  is applied to the data  and although the large numbers of enriched probes "pull" the loess curve away from the background distribution , the data transformation ensures that the loess normalization does not distort the data and that the majority of the residual intensity bias is removed .

the autocorrelation structure of probe m-values along the chromosome is inversely proportional to array noise and intensity bias and should increase when within-array normalization methods are carefully applied  <cit> . to assess our methods, we calculated the autocorrelations of both the wt and rpd3Δ datasets prior to and after application of our within-array normalization scheme at lags of  <dig> to  <dig> probes . figure  <dig> demonstrates that the proposed strategies reduce the intensity bias-related noise inherent in brdu-ip-chip experiments. in addition the correlation structure of the wt data is worse than that of rpd3Δ. we think that this is due to the mutant array having a higher proportion of enriched probes, as noise appears to be more significant in non-enriched regions .

between-array normalization
location normalization
when comparing the within-array normalized data across different experiments, further normalization is needed to correct for the fact that the m-values in  can have different locations. for example, when comparing the ma plots of wt and rpd3Δ after within-array normalization, the median is much lower in rpd3Δ . when these data are plotted along the chromosome we see that the baseline of the rpd3Δ plot is artificially lower than that of wt . if not corrected, this would result in errors when testing for differences between wt and rpd3Δ peaks. to correct for this, for each experiment we propose subtracting the median m-value of its  as calculated after within-array normalization . this strategy successfully normalizes the baseline across arrays, allowing comparisons between experimental conditions to be performed more accurately .

scale normalization
we observe noticeable scale differences in the empirical m-distributions of experimental replicates. before performing comparisons across various conditions, these experimental errors should be eliminated without removing differences attributable to true biological variation. we tested the existing strategies for scale normalization  and found that signal differences observed consistently between wt and rpd3Δ replicates, which we attribute to true replication landscape changes in rpd3Δ, are removed when either is applied . with mad scaling, differences between larger enrichment peaks are removed and with quantile normalization virtually all biological differences are eliminated.

here we propose a modified quantile normalization procedure where the m-values of each set of replicates are normalized together  <cit> , but not with replicates from other experimental conditions . this forces replicates to better resemble each other  without removing true biological differences. figure 6a shows the peak heights from the four wt replicate datasets  plotted against their averages . the scale differences result in discrepancies between replicate peaks with larger heights, which can be a source of false negatives when testing for peak height changes . figure 6b shows that, when the modified quantile normalization strategy is applied, these size-dependent differences are removed.

peak identification and quantification
there are several ways in which peak identification and quantification can be performed. for example, we might average the observations from replicate experiments to get a single set of potential peaks for each experimental condition. because there are often multiple peaks within a given enriched region that may be lost if averaging across replicates is used, we have found it better to identify peaks within each replicate, and then compare peaks across replicates  using further alignment.

several algorithms have been developed to identify enriched genomic regions in chip-chip data  <cit> . many of these use hidden markov models  with two probe states, corresponding to enriched and non-enriched. others have proposed simpler methods, such as setting an enrichment threshold based on the variability of the array noise  <cit> . here we calculate a final enrichment cutoff, used below to identify positive signals, by taking advantage of the characteristics of the distribution of the m-values of background probes. we employ a strategy similar to that proposed in  <cit> : identify all probes whose m-values are less than the median of the set , as recomputed after within-array and between-array normalization, reflect them about this value, and set the cutoff to twice the sample standard deviation of the resulting distribution. we note that we could also use this distribution to provide p-values for ranking probes, but we do not explore this further here.

to identify individual replication peaks, we begin by fitting a loess curve to the normalized data on the chromosomal plane. following this, a sliding window is applied to search for all regions with a continuous increase in smoothed m-values for at least  <dig> probes  followed by a continual decrease for at least  <dig> probes . we assign each peak a height equal to the median of the non-smoothed m-values within  <dig> bp of its apex and accept it as a potential positive if its height is greater than the enrichment cutoff .

after potential peaks have been identified for each experiment, we align them across replicates with a dynamic programming algorithm; see methods for details. following this, peaks present across all replicates are aligned with the known/predicted origins reported in the oridb database  <cit> . this second alignment allows us to further confirm the validity of peaks with a priori knowledge of origin locations which, in turn, allows for an in-depth analysis of the chromosomal features surrounding the start point of each peak .

validation
typical brdu experiments aim to identify genomic regions where there is evidence of replication activity, to determine its magnitude and to test if it is different in various cellular conditions. below we validate our normalization and peak identification/quantification strategies both experimentally and statistically.

peak identification
we fitted an hmm  <cit>  to the average normalized m-values of non-overlapping  <dig> bp blocks of probes. the algorithm assigns to each such block the posterior probability of that block being in an enriched region. these probabilities can be used to rank and call potential enriched regions. here, blocks with posterior probabilities ≥  <dig>  were called as enriched. a comparison of the hmm approach with the one presented here shows substantial agreement in positive peak calls .

to validate experimentally our peak identification strategies, we compared the set of peaks identified here  with those identified in two previous studies  <cit>  where alternatives to the brdu-ip-chip assay  were employed to map replication origins that fire in wt cells in hu. there were  <dig> origins found to fire in hu in  <cit>  and  <dig> in  <cit> . here we identified  <dig> origins as active in hu, with  <dig>  overlapping with those identified in  <cit>  and  <dig>  with those identified in  <cit> . in total  <dig>  of the origins we identified as active were found to fire in at least one of the two previous studies .

peak quantification
to confirm that our array normalization and peak identification/quantification methods assign peak heights that are proportional to origin timing/efficiency, we compared the wt peak heights developed here to their times of replication  reported in  <cit> . we found that brdu peak heights are significantly anticorrelated with treps, indicating that high brdu peaks are associated with early/efficiently firing origins, while lower brdu peaks are associated with later firing less efficient origins .

strain comparisons
to examine our ability to identify true biological variation across experimental conditions, we tested for peak height differences in the wt and rpd3Δ datasets  and compared these results to those in  <cit> . in this previous study three independent methods were used to compare the replication activity of five origins  in wt and rpd3Δ cells. these three methods showed no significant difference between wt and rpd3Δ cells in origin firing times at ars <dig> or ars <dig> but found advanced origin firing in the rpd3Δ cells at ars <dig>  ars <dig> and ars <dig>  comparisons of brdu peak heights at these origins demonstrate significant peak height differences at ars <dig>  ars <dig> and ars <dig> , but no significant differences at ars <dig> or ars <dig>  .

CONCLUSIONS
the brdu-ip-chip assay provides an effective technique to identify replication activity across the genome, and furthermore, the signal magnitude in these data is proportional to the percentage of cells in a culture that fire at each origin. as whole-genome analysis of replication dynamics continues to develop, a proper strategy for analyzing these and other datasets with similar characteristics is essential. here we have shown that traditional strategies for dealing with expression and protein binding chip-chip experiments may be sub-optimal for the analysis of these types of data. we have developed strategies for both within-array and between-array normalization that are able to accommodate highly enriched datasets. furthermore, we have presented peak identification, quantification and alignment tools that use a priori knowledge to remove both false positives and negatives. we have tested these methods both statistically and through a comparative analysis with previous studies to show that they are able to identify enriched regions correctly and that the array normalization and peak identification/quantification strategies are effective in detecting biologically meaningful changes in experiments performed under different conditions.

