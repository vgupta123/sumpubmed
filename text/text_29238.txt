BACKGROUND
model reduction in systems biology
systems biology is a rapidly growing discipline, which often is predicted to end up transforming biology into a field similar to physics and engineering - which integrates mathematical modelling in almost all their studies. systems biology models are typically based on the mechanistic understanding of the systems. in other words, the model formalises a mechanistic hypothesis, which then is evaluated with respect to the available data. the potential of using a model for such an evaluation is that the evaluation can be made in a much more systematic and objective fashion, since complex interaction networks quickly become too complex to grasp using classical biochemical reasoning.

however, many relevant hypotheses are too complex to be analysed in a satisfactory manner, even when using modelling. even with the power of super-computers, parameter and state spaces quickly become too large to be searched convincingly. further, even though experimental data are being produced in ever larger amounts, most models are still highly over-parametrised with respect to the available data. this means that many or all conclusions regarding a model will often be highly uncertain, sometimes even arbitrarily uncertain <cit> . finally, even if a complex model could be validated from a computational point-of-view, an intuitive understanding of what actually goes on in the model is often easiest obtained from a simplified version of the model. all of these are reasons why model reduction is a central ingredient of systems biology modelling.

there are a number of existing approaches to model reduction. one important approach seeks to reduce the model as much as possible while preserving the input-output relations. an important example of this approach is balanced truncation, in which one derives transformed ordered states: the first transformed state is both the one affected the most by the inputs, and the state that affects the outputs the most. therefore the states can be eliminated from the end with a minimal effect on the input-output relationship. this method is straightforward for linear systems  <cit> , and different nonlinear extensions are available  <cit> . the main advantage of taking an input-output approach is that one optimally eliminates the unidentifiable and unobservable parts of the model. this means that much of the ambiguity regarding model predictions mentioned above is eliminated. however, the drawback is that the interpretation of the remaining states, i.e., those not considered as outputs, usually is lost. since systems biology primarily uses modelling to evaluate mechanistic assumptions regarding the internal wiring of a system  this is a major drawback. one way to partly circumvent this problem is to start by sub-dividing the model into modules, where only those modules are reduced whose interior details are not of interest to the particular situation  <cit> .

another approach focuses on the internal dynamics irrespectively of the input-outputs, and such methods are commonly applied to biochemical models. an important sub-class is based on time-scale separation. if the time-scales in a model are widely different, the model can usually be simplified so that all aspects that are not on the time-scale of interest are eliminated: slow processes are replaced by constants, and fast processes are assumed to be infinitely fast. the latter means that the fast processes are projected down to their corresponding steady-state behaviours, which can be expressed as analytical  relations involving the other states. this is the basic principle behind computational singular perturbation and manifold reduction  <cit> . a problem is that the resulting model is usually not very much less complex in most aspects, since the fast variables still have to be calculated, and usually through complex  expressions.

yet another approach based on time-scale separation, but which usually completely eliminates the non-dynamic states, is known as lumping  <cit> . lumping is a widely adopted approach, since it can be done empirically  <cit> , and it is also the central approach in this paper. shortly, lumping is centred around the identification of pools of variables that can be approximated by a single lumped variable, where the internal distributions among the different sub-states are either irrelevant or assumed to occur momentaneously. lumping may be either proper or improper  <cit> . proper lumping refers to the case when the pools are non-overlapping. here it is important to note that although most systems biology methods are proper, since improper lumps are rarely biochemically interpretable, there are important exceptions.

for instance, biochemically interpretable improper lumps appear in some reductions works dealing with the important problem of combinatorial complexity. in these works the lumps are not fully specified signalling intermediates, referred to as mesoscopic states  <cit> . in  <cit>  these reductions were shown to be exact, i.e., they do not involve any approximations, and only make use of structural properties of the model  <cit> . in this paper we will deal with proper, in-exact lumping, which primarily is developed for linear  systems. there are a number of related studies devoted to such lumping, e.g.  <cit> . however, other basic assumptions, or the basic algorithmic approach, are different compared to our setting, as e.g.  <cit> , where a total separation of time-scales is assumed. some more details regarding similarities and differences are pointed out as we derive our results below.

another important sub-class of methods based on the dynamics are centred around a sensitivity analysis. here the model components that affect the dynamics the least are eliminated. a model component could for instance consist of a state variable  <cit> , an interaction  <cit> , or a term in an expression  <cit> . likewise, the considered dynamics can range from some overall qualitative property   <cit> , to the quantification of some specific outputs  <cit>  . sensitivity-based reductions are intuitive and easy to understand and implement, but they may have the problem of generating a model structure that cannot be interpreted biochemically  <cit> . also, like most methods it does not find all kinds of reduction possibilities - for instance when two terms could be merged into one - and should therefore be combined with other approaches.

however, independently of which reduction approach one follows, there is one thing that would be very valuable, and which is rarely known in current versions of the methods: back-translation. back-translation is a concept introduced in relation to core-box modelling  <cit> , which is an approach that tries to combine the strengths of input-output approaches  with the strengths of dynamical reduction methods . a core-box model is the combination of a reduced core model, with known identifiable properties, and a mechanistically detailed model. the two models both describe the same system and experimental data. the combination of the models occurs through the back-translation, which is a mapping of the states and parameters in one of the models to the corresponding states and parameters in the other model. this mapping allows the two models to be considered as two versions of the same model, as two degrees of zooming. this property is of course extremely useful, since it allows the user to work with  the degree of zooming that is most appropriate for the current question, and then easily and quickly convert that model, or a part of the model, to another degree of zooming, if the question should change . nevertheless, there are very few available methods that derive such back-translation relations along with the reduction.

in this article we present a novel method for reduction that does provide such a back-translation. the method is based on lumping, and we present both the lumping step and the back-translation calculations. the method is derived in a linear setting, and is applied to two examples of previously published linear models for processes involved in photosynthesis. we also illustrate how the same concepts can be extended to a non-linear setting through the reduction of a system of differential equations for glucose transport. finally, we discuss the strengths and short-comings of both the linear and the non-linear versions of our proposed methodology.

ordinary differential equations
we will study models described by ordinary differential equations . let the dynamic states be denoted x, the parameters p, the inputs u, and the outputs y, where x ∈ rn and y ∈ rl. finally, let the the functional relations for the dynamics and the outputs be denoted f and g, respectively. then, the set of odes is given by   

note that all these symbols are vectors, which is indicated by the symbols being bold. note also that x, u, and y depend on the time, denoted by t, but that the explicit time-dependence is dropped from the notation except for in equation . note also that x <dig> may be parametrised and hence is a function of p. equation  is referred to as a model structure, which is denoted ℳ.

for the theoretical developments, we will in this paper primarily focus on the special case of linear odes. then the general nonlinear functional relationships f and g can be replaced by matrices a, b, c, d of appropriate dimensions as follows   

the usage of linear models in systems biology
the use of linear dynamic models in systems biology may at first sight look as an overly simplified approach. however, many biological and biochemical systems operate close to a steady-state where a linearised version of a detailed non-linear model well describes the dynamics of the deviations of the model variables around such a steady-state. how to linearise a nonlinear model around a steady-state  is described in many textbooks on basic systems theory, see for example  <cit> . the use of linearisation of nonlinear dynamic systems to obtain a linear model, with a limited range of validity, which facilitates theoretical analysis is a very common approach in engineering fields such as systems and control theory, electrical circuit theory , rotating machinery and vibrational analysis. it should also be noted that the field of metabolic control analysis  <cit>  is developed under the assumption that the underlying pathway or network is operating at steady-state.

the steady-state assumption is fulfilled in many metabolic pathways or networks at normal operation. this is because the fluxes through the network are often fairly constant, since several control mechanisms provide means to maintain a steady-state or homeostasis  <cit> . for oscillating systems it might also be possible to linearise submodels of the non-linear models  <cit> . another important situation where linearity is an appropriate assumption is the case of probabilistic networks, where a state corresponds to the probability of a specific molecular conformation and a transition between states corresponds to a flux of probability  <cit> . this latter situation is the case in the prototype examples studied in this paper, where models for fluorescence emission in photosynthesis have been used.

there is also a relevant recent method for model reduction described in  <cit> , which converts a non-linear system into an ensemble of  piecewise affine systems. here the steady-state assumption is no longer critical, but the different  piecewise systems are valid during different time intervals. that model reduction process could in some cases be taken one step further by applying the lumping techniques described in this paper to each  piecewise affine system in the ensemble.

finally, it should also be mentioned that there are several recently published papers on yeast osmo-regulation, where linear models and techniques have successfully been applied to the study of mechanistic details, even though the underlying system is operating far from equilibrium  <cit> . note also the discussion in  <cit> , concerning the possibility of applying the algorithms for linear  models to pseudo-linear  sub-models of nonlinear models, for which the internal reactions are functions of the external variables.

graph theory
the method developed below will make frequent use of concepts and results from graph theory. since these might not be common knowledge for the average systems biology reader, we here give a short introduction. a graph consists of nodes, which usually are represented as dots, and edges, which connect some of the nodes. if the edges have a direction, we speak of a directed graph, or a digraph. the indegree and outdegree of a node in a digraph is the number of edges leading to and from the node, respectively. a directed graph is strongly connected if there is a path of edges leading from each node to each other node. a sub-graph is a sub-set of nodes and edges to the original graph, where only edges between nodes appearing in the original graph may appear in the sub-graph. if a directed graph is not strongly connected, there is always at least one sub-graph that is strongly connected . such a sub-graph that is as large as possible, a maximal strongly connected subdigraph, is referred to as a strong component . identification of scs is a part of the method developed below. there are general and automatic methods for identification of scs  <cit> , but for the cases in this paper the scs can be found by mere inspection of the graph. a node with a nonzero indegree, but a zero outdegree, is referred to as a sink . a strong component from which there are no edges leading to nodes outside those of the strong component, but edges leading to the strong component, will here be referred to as a sink cluster. we will refer to a sc that is not a sink cluster as non-sink sc. formally a graph g =  is a mathematical structure that consists of two sets n and e, where the elements of n and e are the nodes and edges of the graph, respectively, and e consists of 2-element subsets of n.

let us now illustrate the graph-theoretical concepts above. in the directed graph g <dig> = ,  

there are five nodes and five edges, so that n <dig> = {s <dig>  s <dig>  s <dig>  s <dig>  s5} and e <dig> = {a, b, c, d, e}. the sub-graph ,  

where  = {s <dig>  s <dig>  s5} and  = {b, d, e}, is strongly connected, since there is a path from each node to each other node. this graph is also a maximal strongly connected sub-graph, or a strong component, since any larger sub-graph would not be strongly connected. node s <dig> has a zero outdegree and non-zero indegree, which makes it a sink. now consider graph g <dig> = ,

which has the same structure as graph g <dig> apart from the addition of an edge f, which leads from node s <dig> to node s <dig>  the sub-graph ,  

where  = {s <dig>  s <dig>  s5} and  = {b, d, e}, is strongly connected but not a strong component. this is because a larger sub-graph in which node s <dig> and edges c and f are included is also strongly connected. note that node s <dig> in g <dig> has a non-zero outdegree and is for this reason not a sink. the sub-graph ,  

where  = {s <dig>  s <dig>  s <dig>  s5} and  = {b, c, d, e, f}, is a strong component. since there are no edges leading from the strong component to other nodes , but only in the opposite direction,  also constitutes a sink cluster as defined above.

in this paper, graphs are used for illustration of biochemical systems, where the nodes represent the involved biochemical entities and the edges represent transformations between these entities such as reactions, translocations, or conformational changes.

methods
initial observations
we will in this section make some initial observations, which form the conceptual basis for the model reduction approach presented in this paper.

consider two linear model structures ℳg and ℳc where one of the states in ℳc corresponds to a group of states in ℳg. we can think of ℳc as a reduction of ℳg in which the states of the pool have been lumped.

for example let the graph g <dig> above represent a model structure . if the states corresponding to s <dig>  s <dig> and s <dig> are lumped we get the reduced model structure , which can be represented by  

where  and  have the same interpretation as s <dig> and s <dig> in g <dig>  respectively, and where  corresponds to the lumped state.

in general, let the states in the pool in ℳg be denoted x <dig> to xn and let the corresponding lumped state in ℳc be denoted . let the reaction rate from a state xq to a state xp be denoted vpq so that   

where kpq is a kinetic parameter. in ℳc the reaction rate from  to a state external to the pool xj is denoted  and is given by   

reaction rate  corresponds to the sum of all reaction rates in ℳg from any of the pooled states to state xj, which is denoted vj, and is given by   

note that if there is no reaction between some state xi in the pool and the state xj, kji is equal to zero. since vj and  have the same interpretation in the two model structures, we can set them equal and solve for one of the parameters, e.g.,    

now, note that eq.  gives a translation between parameters of the original and the reduced model structure. the translation requires the fraction of each state variable of the pool, xi, to the lumped state variable, , to be known. such fractions are therefore useful auxiliaries to derive for reduction of models by lumping. define the fraction parameters ηi as   

so that eq.  takes the form   

note that in general the fraction parameters are time-varying. however, internal equilibrium can be assumed for a sub-system of states with fast reactions. this is justified by terms on the right hand side of eq.  that are large enough to neglect the derivative term on the left hand side. the sub-system is then said to be in quasi-steady-state . variables in such a sub-system will show a high correlation in qss, leading to approximately time-invariant fraction parameters. by definition from eq.  the states in ℳg that are lumped have a clear interpretation in the reduced model structure, ℳc, given by   

i.e., each of the lumped variables corresponds to a given fraction of the lump .

in summary, the basic observation is that the relation between the states in the original and the reduced model is constant over time, and is given analytically by eq. . this is possible because of the basic assumption behind lumping: that the states within the lump reaches internal equilibrium momentaneously.

example  <dig>  to illustrate the ideas above, let us consider the six-states model depicted below.  

this model is used to predict the observed behaviour of fluorescence emission in photosynthesis  <cit> , which is characterised by a flux of probability between the states. to translate the figure above to a model structure in the form of , all rates are assumed to be given by expressions proportional to the probabilities of the states they emanate from, which would correspond to mass action kinetics for a regular biochemical reaction network. this makes the resulting model structure linear. let the model structure be denoted , with states x1to x <dig>  where the initial condition for state x2is set to  <dig> and for the other states to  <dig>  the values of the kinetic parameters in  <cit> are k <dig> =  <dig> , k <dig> =  <dig> , k <dig> =  <dig>  k <dig> =  <dig>  k <dig> =  <dig>  k <dig> =  <dig>  k <dig> =  <dig>  k <dig> =  <dig>  k <dig> =  <dig> and k <dig> =  <dig>  since the order of magnitude of the kinetic parameters are k <dig>  k <dig>  k <dig>  k <dig>  k <dig>  k <dig>  k <dig>  k <dig> >>  <dig> s- <dig> and k <dig>  k <dig> ≈  <dig> s- <dig>  the reactions between states x <dig> to x <dig> are all reversible and fast compared to a time-scale of seconds, whereas the reactions to state x <dig> operate on this time scale. the equation for the output, y, is   

by lumping states x <dig> to x <dig> in into one state    

we obtain the reduced model structure  as shown below.  

note that and that corresponds to the sum of states x <dig> to x <dig>  all probability is initially assigned to state x <dig>  which gives the following equations for the reduced model.   

the translation between the reduced and original parameters are given by eq.    

where and so that and . however, we still lack analytical formulas for the fraction parameters η . we also lack an automatic method for conducting the model reduction. these two things will be derived in the following sections.

lumping of states
we will now generalise the above observations to a concrete methodology, with the goal that it should be useful in practice. in particular, the method should

a automatically identify lumps in a model

b deliver analytical formulas for back-translation

in this section we focus on step a, which we will sub-divide in several sub-steps, and in the next section we turn to the calculation of back-translation formulas.

a basic criteria for lumping a group of states is that the reactions between states in the group occur on a much faster time-scale than that of interest to the modeller. a group of states that are  connected by such fast reactions will here be referred to as a directed graph of fast reactions . to identify the non-connected dgfrs of a linear model structure, ℳg, we first rewrite eq.  on the form   

where the kinetic parameters of pf are those of p that are much larger than the inverse of the time-scale of interest, and dim + dim = dim, where dim gives the dimension of a vector z. the method of ϵ-decomposition  <cit>  can then be applied by permuting af into block diagonal form. the blocks of non-zero elements can be interpreted as corresponding to the various non-connected dgfrs of the model. for example, if the reactions corresponding to edges b, d, and e in graph g <dig> above are large and the other reactions slow, the matrix af for the corresponding model structure can be permuted into the block diagonal form. this is done by exchanging the rows and columns for the states corresponding to s <dig> and s <dig>  so that the permuted matrix  takes the form   

so we have identified one dgfr consisting of three states and two states  that are not connected to other states by fast reactions. note that some of the block elements in eq.  are equal to zero if the reactions between the corresponding states are missing, and that eq.  is only used to illustrate the matrix form in principle.

to find a permutation for the purpose of identifying dgfrs we can construct a matrix m in which each element, mij, is assigned a value  <dig> if afij or afji are non-zero and  <dig> otherwise. the total connectivity

matrix mc   

then reveals if there is a path between each two states. note that equation  contains both multiplications of the matrix m with itself, and summations of such products. the states xi and xj are connected if and only if mcij ≠  <dig>  using the connectivity matrix it is thus straightforward to determine the permutation and the independent blocks of .

these independent blocks, or dgfrs, determined by the ϵ-decomposition must be analysed further, before useful lumps can be identified. the reason for this is illustrated by the following digraph  

where ks ≈ 1s- <dig> and kf ≫ 1s- <dig>  this digraph could have been generated as a dgfr from an is ϵ-decomposition, even though ks is slow. the reason for this is that there is a fast reaction from state x <dig> to x <dig>  the consequence of this slow reaction in the dgfr is that we cannot assume qss for this dgfr directly, since this would imply that inputs to states x <dig> and x <dig> would instantly end up in x <dig> .

this further analysis of the dgfrs starts with the characterisation of strong components  in each dgfr. recall that an sc is a maximal strongly connected sub-digraph in which each node can be reached from each other node. note that there is at least one sc  that acts as a sink cluster, meaning that the corresponding states will be assigned a non-zero value in qss. note that if there is a path of fast reactions from a non-sink sc to a sink cluster, but no path in the opposite direction, the states of the non-sink sc will have little effect on the overall model dynamics. unless the modeller has a particular interest in these non-sink sc states, e.g., if they are important for the observation function, the non-sink sc and the sink cluster can be lumped. the states of the non-sink sc will then be assigned a zero value at all times in the back-translation.

it is important that there is only one sink cluster within each pool of states that are lumped, since the dynamics on the time-scale of interest might otherwise affect the fraction parameters. if there is a path of fast reactions from a non-sink sc to more than one sink cluster, the rule of thumb is to avoid lumping the non-sink sc to any of the sink clusters. however, if there is a path of slow reactions from only one of the sink clusters to the non-sink sc, the corresponding states can be lumped. finally, we also identify which states are slow, i.e., can be treated as constant at the time scale of interest. a simple criterion for identification of such states in linear models is that a state xi is slow if max << ϵ ∀ j and max << ϵ ∀ j. this statement can formally be connected to the eigenvalues of the system matrix through the gershgorin circle theorem, see for example  <cit> . if there is a union of k gershgorin discs corresponding to "small" diagonal elements with "small" row and column elements and this union is disjoint from the other gershgorin discs, the corresponding states are slow. alternatively, we could also check if the state remains approximately constant at a given time scale, in a simulation of the original model. note that in the case of oscillating systems, a more suitable method is the method of averaging  <cit> . below we summarise the most important steps in the identification of a states lumping scheme.

a <dig> use ϵ-decomposition to identify non-connected digraphs of fast reactions .

a <dig> identify the strong components  in each of the dgfrs.

a <dig> classify the scs as sink clusters or non-sink scs.

a <dig> check if the non-sink scs can be lumped with any of the sink clusters.

a <dig> identify slow states in the reduced model.

these steps make up a lumping scheme for the state variables.

example  <dig>  for the six-states photosynthesis model, ϵ-decomposition gives one dgfr consisting of states x <dig> to x <dig>  these states are all interconnected with fast reactions, and thus constitute a sc . since there are no fast reactions to states outside the sc, it is classified as a sink cluster . there are no non-sink scs in the dgfr and we do not need to consider the additional lumping of non-sink scs , and there are no slow states in the reduced model . having followed the steps 1- <dig> above, we have thus identified a suitable lump consisting of states x2to x <dig>  which in the lumped model will correspond to the state .

fraction parameters
we now turn to the problem b above: deriving back-translation formulas. this means that we are seeking analytical expressions for the fraction parameters η in eqs.  and . the derivation presented here relies on that qss can be assumed for each group of lumped states, which is ensured by the work flow in the previous section.

consider a sub-model of states to be lumped, with the corresponding system of differential equations   

where dim = m >  <dig> and ul are the inputs to the lumped states. recall that ul are slow compared to the dynamics within the lump, since we assume qss. using the notation qss for quasi-steady-state, this assumption gives   

so that   

where ηli is the fraction parameter for the i:th lumped state variable.

eq.  requires al to be invertible, which is not always the case. al is not invertible in the absence of output reactions, i.e., with no reactions vij, where xj is in the lump but xi is not. the reason for this is that the dynamics given by al then introduces an apparent conserved moiety: that all the states in the lump sum up to . this is a true conserved moiety if there are also no inputs, since then  is constant over time, and the only thing that can happen within the lump is re-distribution. with such a conserved moiety one of the rows of a can be expressed as a linear combination of the others, i.e., al is not invertible. it should be noted that also in the situation of zero inputs u but with outputs, the matrix al will have the same problem , and thus non-invertible.

fortunately, also in the situation of non-invertible a, our method can be applied. since the non-invertibility is due to the presence of a conserved moiety, there is an additional relation that can be used: the one describing the moiety.   

note that there can only be one conserved moiety in a given connected linear system. equation  can be used to replace one of the rows in the matrix equation . replacing the last row in eq.  with eq.  gives   

where   

the fraction parameters can in this case be obtained by substitution of  from eq.  into eq. .

note that if eqs. - are used,  is a function of the lumped state variable . however,  appears linearly in each entry of  and therefore disappears in the division in eq. . so the fraction parameters are independent of , which is typically varying over time. hence the fraction parameters are time-invariant, just as we want. this should be compared with eq.  <dig> och eq.  <dig> in  <cit>  and the recipe proposed by clarke  <cit> .

the quasi-steady-state equation, eq. , can be solved explicitly since the solution only requires the inverse of the non-singular matrix  and the multiplication with the matrix  and a vector . note that these matrices and vectors are functions independent of the model states. the use of symbolic tools are advantageous, since analytical formulas of the fraction parameters can be obtained. the inverse of a matrix can be computed with a number of symbolic software packages, such as maple  or mathematica. we have used the symbolic toolbox for matlab in our examples with a good result for all matrices tested. however, since fraction parameters are time invariant for linear models, if we are only interested in the numerical values, we can also substitute the values of the parameters in the matrix . matlab provides very efficient algorithms for matrix inversion of numerical matrices, based on the fortran package lapack. this makes the algorithm much faster than for symbolical solution of the qss equations.

the complexity of solving the qss equations boils down to the problem of symbolical inversion of a matrix. for all our test cases the time for symbolical matrix inversion was rather short . in  <cit>  the assumption of a multi-scale nature of the model was exploited to reduce the number of parameters. a similar approach may be used for some of the parameters also without the strong assumption that all parameter values are clearly separated. also, in  <cit>  it was suggested to choose the dominant terms in the solutions as functions  of the parameters, which again relies on separated time scales in the model.

example  <dig> 

to illustrate the ideas of this section we again consider the six states model for fluorescence emission inphotosynthesis. we have already identified states x2-x6as a suitable states to be lumped. since there are no inputs to states x <dig> to x <dig>  eqs. -are used to compute the fraction parameters. the matrix  takes the form   

note that we have approximated   

this is justified since these two parameters are much smaller than the others, and is done because it gives much simpler expressions for the fraction parameters derived below. the assumption  is however not necessary, and is not a part of the method per se, and it could be omitted with the only change that the approximation would be a little better, and that the expressions would be more complicated. and are given by eqs.  and  as   

the vector is obtained from eq.  and the fraction parameters from eq.  <dig>  so that   

the analytical expressions for the fraction parameters are determined by analytical inversion of a, which gives   

where   

note that approximate trajectories for the states of can be obtained from eqs. ,  and , if the solution to the model equations of is available. the state trajectories resulting from back-translation and the output function are compared to those obtained by simulation of in figure 1and  <dig>  respectively. as can be seen the disagreement is negligible at the time-scale of interest. this high agreement validates the assumption , but, above all, it validates our reduction method.

implementation
the method has been implemented in matlab and is based on the systems biology toolbox, which is a freely available and widely used matlab toolbox . the additional files  <dig>   <dig>   <dig> and  <dig> contain scripts for all the examples in this paper. the provided implementation is script-based, user-friendly and easily modified, and provides automatically reduced models from any correctly entered model to which the theory applies. the functionality will be included in the toolbox once the paper has been published.

RESULTS
the model
we will now demonstrate the performance of the method based on lumping on a larger model for fluorescence emission in photosynthesis. this will also exemplify the shortcomings of a purely input-output based reduction method like balanced truncation in a systems biology context. the chosen model was originally published in  <cit> , and it is based on mechanistic understanding of the corresponding biochemical system. the original model consists of the  <dig> states, but they are divided in two identical disjoint groups, and hence only one of these groups needs to be considered. the studied system therefore consists of  <dig> state variables, corresponding to  <dig> different configuration states of a protein specific complex. the state variable xi represents the probability that the protein complex is in the i:th configuration state . at time zero all the probability is assigned to state x <dig>  corresponding to the state of the molecule right after the excitement with a laser flash. further, the input only enters in one of the state equations, only a single linear combination of the states may be measured, and the measurements are not directly affected by the input. more specifically eqs. - take the form   

here a is a 26-by- <dig> dimensional matrix, and the ai, j element is given in figure  <dig>  this means that for instance the a <dig>  element is given by kmin <dig>  that the a <dig>  element is given by ky <dig>  and that the a <dig>  element is zero.

results with balanced truncation
balancing of  using the function hsvd in matlab gives the hankel singular values depicted in figure  <dig>  the initial condition for state x <dig> was replaced by a dirac delta function, as an input on the right hand side of the differential equation for this state. this was done to justify the input-output perspective of the method since there are no inputs to the system. as can be seen there is a jump after the first two states, another jump after  <dig> states, and after  <dig> states the singular values are below computer precision. that indicates that a 2-state model works reasonably well, that a 6-state model works good, and that there is no point in adding more states after the 10:th state has been added. this prediction is verified by the corresponding truncations, and by simulations comparing the original and the reduced model output .

results with lumping
now our novel lumping approach is applied to the same model. the first step  is to identify the dgfrs of the model using 3-decomposition. rate parameters much larger than  <dig> s- <dig> are considered to be fast, which is reasonable if we are interested in a time-scale of seconds. this gives five disjoint groups of states  

however, the only external reactions to the states in  and  are from states x <dig> and x <dig>  respectively. these state variables x <dig> and x <dig> have low values  at all times, so the states in  and  are even smaller and can be removed from the model without affecting the overall model dynamics much.

the second step  is to identify the scs in the dgfrs and in the third step  we check which of them are sink clusters. it turns out that there are no scs in the model consisting of more than one state, but several sinks. the single state sinks in the three disjoint groups are states x <dig> and x <dig> in , states x <dig>  and x <dig> in , and states x <dig> and x <dig> in . to conclude the lumping, the fourth step  checks which non-sink states that can be lumped with the sinks in their dgfr. we are not particularly interested in any of the states for which there is a path of fast reactions to a sink, but no path of slow reactions in the opposite direction. these states are therefore lumped with the corresponding sink state, as described in the guidelines for this step. there is an ambiguity for state x <dig>  since there is a path of fast reactions from this state to two separate sinks, x <dig> and x <dig>  however, there is a path of slow reactions from x <dig> to x <dig>  but no path from x <dig> to x <dig>  so x <dig> is lumped with x <dig>  there are also paths of fast reactions from state x <dig> to the two states x <dig> and x <dig>  with the same reasoning as for x <dig> above, we decide to let x <dig> be lumped with x <dig> 

the procedure above gives rise to the following six groups of state variables   

and lumping the states of each group then results in a reduced model structure represented by the following digraph.   

note that there are no slow states in the reduced model . we then calculate the back-translation formulas  using eqs. -.

in figure  <dig> the outputs from the original model and the reduced model are compared, and as can be seen the agreement is very good. finally, eqs. , , , and - can be used to compare the original states obtained with back-translation using fraction parameters from the reduced model with those of the original model. the results for the six states that are sinks, as well as the six states that are connected to them via reversible reactions, are shown in figure  <dig> and  <dig>  respectively. as can be seen the agreement is convincing.

nonlinear model reduction with lumping
the aim of this section is to give some insights about the applicability of our method to nonlinear models.

reduction of a model for glucose transport in yeast
a model for glucose transport in the yeast saccharomyces cerevisiae was presented in  <cit>  and is depicted in figure  <dig>  the paper  <cit>  presents this detailed state-space model with a number of assumptions, and reduces the complete system into a single rate-expression. we will now illustrate how one can use nonlinear analogues to the methodological steps introduced in this paper to derive fraction parameters, η, which again gives back-translation formulas; interestingly, the fraction parameters may also be used to easily calculate the in  <cit>  obtained rate expression. the differential equations for the original model are given by   

where it should be noted that the right hand side of the odes are nonlinear functions of the states. recall that step a in our method is to identify a suitable lump. for this example, the reduction problem is stated such that the resulting reduced model should go from extracellular glucose to intracellular glucose. this means that all states in between should be lumped; this gives   

note that this implies that the lump is given by all states including the carrier protein, and thus a conserved moiety.

recall that step b in our method is to identify the fraction parameters for this lump. also recall that this is done by identifying a linear matrix equation for the states in the lump, which can be inverted and used to calculate the steady-state values of the lumped states, which in turn gives the fraction parameters η. finally, recall that this invertible matrix in the most general form is given by a combination of steady-state assumptions and the sum containing the conserved moiety.

in this nonlinear example, there are four reversible reactions in the model for the transport processes through the inner and outer parts of the cell membrane -). these were identified as fast in  <cit> , i.e., the corresponding states are in quasi steady-state. a method for automatic detection of fast states, for which the quasi-steady-state assumption is fulfilled, was proposed in  <cit> . this means that the right hand side of the equations can be set equal to zero . we also assume that the total flux of the carrier molecules between the inner and outer walls of the cellular membrane is zero   

these assumptions put together gives us a nonlinear version of the matrix equation. more explicitly, the equations stating the qss assumptions corresponding to eqs. - followed by eqs.  and  collected in a matrix gives   

where  and . note that eq.  has the same form as eq. , but with variables as matrix elements. however, the variables in the matrix are all external to the lump, which means that these variables can be treated as parameters in the derivation of the fraction parameters and that eq.  can be solved explicitly. this is a typical situation for nonlinear models based on mass-action kinetics, since the conserved moiety is usually only represented by one of the variables within each term of the polynomials. symbolically inverting the matrix in eq.  gives   

where   

note again that this results in a relation between the individual states of the lump  and the total lump through fraction parameters, η.

interestingly, these fraction parameters can be used to derive the in  <cit>  obtained rate expression for the glucose flux into, and out of, the cell. note that the only path for glucose to be transported between the outer and inner parts of the cell membrane is the rate-limiting reversible reaction between states  and . note also that the rate of the reaction in either direction is proportional to the magnitude of the substrate state.

now consider the reaction from  to . since the carrier within the cell membrane is conserved at all times, the potential largest possible reaction rate, denoted rmax, is obtained if all carrier molecules is in the state from which the reaction leads. however, typically only a fraction, , of the carrier molecules is in state  at a given time. hence the rate of the reaction into the cell is . similarly, we have for the flux out of the cell : . from eqs.  and  we can thus derive the influx, rin, as   

and the efflux, reff, as   

this flux rate expressions are the same as presented in  <cit> . this thus demonstrates how the same concepts we have derived for the linear case, can be applied also to calculations of fraction parameters for nonlinear systems, and how these fraction parameters can be used to solve other nonlinear problems.

discussion
in this paper we have presented a novel lumping approach. apart from identifying suitable lumps in a novel and automatic way, the method also finds analytical expressions for the back-translation relations regarding both states and parameters between the original and the reduced models, resulting in the derivation of a zoomable model. the method has been applied to two models for fluorescence emission in photosynthesis, and we have demonstrated how the concepts supporting the method may be used also to nonlinear problems.

in the larger photosynthesis related model, a reduction was also performed using balanced truncation; let us now compare the performance of these two methods. a first observation is that the methods perform comparably when it comes to preservation of the input-output relations of the model. both methods predict and supply good agreement between a reduced 6-state model and the original model of  <dig> states. balanced truncation do provide reasonable model agreements also for lower order models, but it is not until  <dig> states are added that the agreement is equally good to the lumped 6-state model. however, even though the two methods yield comparable results from an input-output perspective, the lumping method has at least two important advantages when it comes to other properties of importance in a systems biology analysis.

first, the reduced model structure may be interpreted biochemically. as can be seen in figure  <dig>  the lumped variables correspond to combinations of neighbouring states. the analysis thus means that these neighbouring states may be treated as a single variable. similarly, the reduced model structure above reveals that the actual dynamics of the original model can be predicted by a simple cyclic structure of six states. finally, this also means that all future results and analyses that will be produced for the reduced model will have a more direct and clear interpretation.

the second reason why the proposed lumping approach is advantageous is that it provides an analytical back-translation formula for the mapping of the states and parameters in the reduced model to those of the original model. that means that one may not only interpret the results for the reduced model, but actually see what they mean for individual time-series and parameters in the original model. such a back-translation may actually be said to result in a 'zoomable' model, which could for instance be used as a module in a larger object oriented model  <cit> . a zoomable model could for example be used in a larger model of the plant where photosynthesis is a sub-system. such a larger object oriented model would probably be easiest to construct by combining reduced  versions of the models for the different sub-modules. if then a later analysis would require more details regarding the photosynthesis, one could simply switch to the 'zoomed-in' version of some part of the model, and examine the corresponding results - without performing a new simulation. this is an important advantage compared to conventional constructions of model libraries, typically used in object-oriented modelling  <cit> . to sum up the comparison between our new lumping approach and balanced truncation: the two methods perform similarly from an input-output perspective, but our novel method is much more useful in a systems biology context, since then an increased interpretability, through the lumping and the back-translation formulas, is highly advantageous.

a final note on the back-translation. the calculations for back-translation are relatively straight-forward, given a reduced model, and have been touched upon elsewhere  <cit> . however, the main point we want to make concerning the back-translation is a conceptual one; information about the original system can be retained from the reduced one without doing any new simulations. also, the state-space trajectories from simulations between the original and back-translated states are compared. we are not aware of any similar previous comparisons for lumping-based methods in systems biology. however, back-translation-like formulas are at the heart of various time-scale based methods , where the eliminated states are simply replaced by algebraic expressions. we also want to emphasize that both the reduction and the back-translation increases the interpretability and biochemical understanding of the model. consider for instance our 26-state example, which has been reduced to a  <dig> dimensional model. these  <dig> states corresponds to disjoint groups of states in the original model, since our lumping is proper. also, the relation between these groups is much more straightforward , compared to the original model, and time-traces for the original model can be retained without doing a new simulation. nevertheless, some of the expressions might become complex and are not always themselves straightforward to interpret.

our method can also produce multi-scale approximations of a linear model; just redo the model reduction for each specific value of  <dig>  corresponding to the time scales under study. this will generate a set of reduced models, which are valid at different time scales, and altogether form a multi-scale approximation of the original model. for previous work on multi-scale approximation of linear models, see  <cit> . however, for each time scale our method is guaranteed to produce a biologically interpretable model, without the strong assumption of clearly separable time scales for all parameters.

one shortcoming of the current version of the method is that states that are not part of a sink, and to which there is no path from a sink, do not have a proper back-translation. the reason for this is that these states give an insignificantly small impact on the model dynamics; their main purpose in the model are to serve as a short-lived intermediates. in other words, the qss values, upon which the back-translation formulas are based, is zero. nevertheless, if for some reason we are particularly interested in any such state, the state can be kept in the model simply by not lumping it with any of the other states; the price is one additional states in the reduced model. it should also be noted that our method deals with the inversion of a matrix, which might be a difficult task if the number of states is large. for larger models one might consider methods based on methods that only makes use of the order of magnitude of the parameters, such as that in  <cit> . another shortcoming is that the back-translations do not yet allow for back-translation of uncertainties, e.g., obtained from parameter estimation given experimental data. this will have to be improved before the method can be fully useful in a core-box modelling situation  <cit> . model reduction methods based on solving the quasi-steady-state equations usually generate models that are less stiff. however, the reduction in simulation time, for the reduced in comparison to the original model, was not large . one reason for this is the availability of good stiff ode solvers, e.g., the matlab solver ode15s which was used in this paper. the main advantage of our method is instead that biologically interpretable reduced models, based on proper lumping, are guaranteed. note that this is done without any strong assumption about the kinetic constants, which may be compared to the approach in  <cit> . the reduced model can always be represented graphically as a network of states, and lumped variables, where each state of the original model has a clear interpretation as a fraction of one lumped state . this makes it easy to discuss the reduced models with scientists who lack a strong mathematical background, which is very important for the success of large interdisciplinary projects that are typical in systems biology. it also gives the researcher a great overview of the individual parts and of the important interactions in the reduced model, which are responsible for the observed dynamics.

the method is developed in a linear setting, even though we have demonstrated how the main concepts and ideas may be extended to a non-linear setting. in the chosen nonlinear example, the lump was identified by the problem, and consisted of a conserved moiety. the moiety relation together with the usual assumptions of qss within the lump allowed us to construct a matrix equation , which is analogous to the linear formula . further, just as for the linear case, the matrix equation could be solved analytically using conventional computer algebra software, and with the resulting steady-state values identified, the fraction parameters can be calculated using the linear formula. all these central steps are thus more or less directly transferable between the linear and nonlinear situations. interestingly, we also showed how these fraction parameters could be used to easily derive a complex michaelis-menten expression for the given system.

however, it should be noted that the extension to the nonlinear situation is not done without the introduction of new problems. note for instance that the fraction parameters in this nonlinear model are functions of states variables and may therefore vary over time. further, the states outside the lump in the reduced model can not be simulated after substitution of the fraction parameters into the model odes. the reason is that the right hand side of the odes is algebraically equal to zero, which gives the false impression that the outside system is always in steady-state. we are currently working on methods to resolve this, seemingly general problem in the reduction of nonlinear models, with promising results. all in all, we believe that the main contribution of this paper is the introduction of the concept of back-translation, and the demonstration that it is possible to derive back-translation formulas in an automatic manner. since this is a fundamentally and conceptually novel improvement of lumping and model reduction, which is very useful in a systems biology context, we think that our contribution could stimulate much future research to improve our present contributions further.

CONCLUSIONS
we have in this paper introduced a novel reduction method, which is centred around two main steps. the first step is an automatic identification of states that are suitable for lumping. these states are identified in four sub-steps, which makes use of existing and powerful concepts from graph-theory and ϵ-decomposition. the identified lumpable states are considered as a single state in the reduced model, and are chosen such that we may assume that they reach qss quickly compared to the surrounding dynamics. this qss property is the basis for the second step: to identify analytical back-translation expressions, describing the relations between the states and parameters in the reduced and the original model. these back-translation expressions are centred around the fraction parameters η, which represent the fraction of a lumped state to the total lump. the fraction parameters are calculated through calculations of the qss steady-state concentrations of the lumped parameters, which are calculated analytically through the analytical inversion of the matrix .

we have developed and tested the method using two previously published models for photosynthesis. notably, the larger of these two models was reduced from  <dig> to  <dig> states, where there is no visible difference when comparing simulations from the two models. here it should be noted that this comparison can be done either in the space of the reduced model, or in the original state space, and that the reduced model does not have to be simulated again to obtain time-series for those detailed states that are of interest. it is because of this property that the resulting models may be viewed as two degrees of zooming of the same model; this is a conceptually important step forward in terms of model reduction, and we believe that it will prove to be very useful in modelling situations, and that it will stimulate much future research. in line with this, it should finally be said that even though most of the results and derivations in this paper are for linear models, we have shown that the same concepts and methods are applicable to nonlinear models as well, and that we are currently working on a similarly general theory for a commonly occurring class of nonlinear models.

authors' contributions
all four authors contributed to the development of the theory and analysis of the results. nevertheless, hs initiated the original m.sc. project including reduction of linear models with preserved interpretability, gc developed the concepts concerning back-translation and zooming, ms developed most of the aspects of the actual method and did most of the calculations, and mj supervised in particular the later stages. ms, gc and mj wrote the article. all authors read and approved the final manuscript.

authors' information
mikael sunnåker has a b.sc. in engineering physics and a m.sc. in complex adaptive systems from chalmers university of technology. in january  <dig> he took a position as an applied researcher at the department for systems biology and bioimaging at the fraunhofer-chalmers research centre for industrial mathematics. since january  <dig> he is a phd student at the department for biosystems science and engineering at the eidgenössische technische hochschule , and competence center for systems physiology and metabolic diseases, in zurich. his research interests include methods for network identification, model reduction, and parameter estimation of biochemical reaction systems.

henning schmidt received a double m.sc. degree in electrical engineering from the tu darmstadt and supelec in paris  <dig>  and a ph.d. degree in control theory from the royal institute of technology in stockholm  <dig>  following his ph.d. time he joined the fraunhofer-chalmers research centre for industrial mathematics where he worked on topics including modelling and analysis of biochemical reaction systems and the development of related computational tools. since december  <dig> he is working in the modelling&simulation group at novartis pharma ag in basel.

mats jirstrand received a m.sc. degree in applied physics and electrical engineering  <dig>  a lic.eng. degree in automatic control  <dig>  and a ph.d. degree in automatic control  <dig> all from linköping university. in  <dig> he was appointed associate professor in automatic control at the school of electrical engineering, chalmers university of technology. his research interests include modelling methodology, system identification, and model reduction, in particular for biological and medical applications. he is currently the head of department for systems biology and bioimaging at the fraunhofer-chalmers research centre for industrial mathematics.

gunnar cedersund has a m.sc. in theoretical physics. since his master thesis he has been working with systems biology. he is interested both in methodological developments, summarized in the core-box modeling framework, and in concrete modeling of biological systems related to glucose homeostasis. his ph.d. time was placed in two different electrical engineering groups, and he is currently co-leading the joint experimental/theoretical group "diabetes and integrative systems biology" at the linköping university.

supplementary material
additional file 1
model reduction algorithm. a matlab function that constitutes our implementation of the model reduction algorithm  presented in this paper. the function requires the systems biology toolbox and the symbolic math toolbox for matlab to be installed.

click here for file

 additional file 2
model reduction scripts. matlab script that can be used to easily test the model reduction algorithm on the 6-states and 26-states models for photosynthesis that are employed in this paper.

click here for file

 additional file 3
the 6-states model. this is the six-states model for photosynthesis that is used in the paper. this model can be imported to matlab in the form of an sbmodel object .

click here for file

 additional file 4
the 26-states model. this is the 26-states model for photosynthesis that is used in the paper. the model can be imported to matlab in the form of an sbmodel object .

click here for file

 acknowledgements
this work was supported by the european commission through the biosim project, by lions, and by the swedish foundation for strategic research.
