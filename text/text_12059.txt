BACKGROUND
a chimeric transcript is an rna molecule that does not have a collinear mapping to a single reference gene model. such a transcript can result from genome rearrangement events that occur at the dna level, or transcriptome events that occur at the rna level
 <cit> . two types of chimeric transcripts that are important in human cancers are fusions , in which parts of two genes located on the same or on different chromosomes are joined ; and tandem duplications, in which part of a gene is repeated. a tandem duplication can be further classified as either a partial tandem duplication , if both edges of the duplicated segment correspond to annotated exon boundaries that are involved in splicing ; or an internal tandem duplication  otherwise . the defining characteristic of a ptd is a non-canonical exon junction : a junction from the end of an exon a, to the beginning of the same exon or of another exon that is  <dig> prime of exon a in the reference isoform . salzman et al.
 <cit>  present evidence for circular transcripts , which can produce ncejs that are identical to those seen in ptds; as discussed in that work, rna-seq data cannot support differentiating between linear ptd transcripts and circular transcripts when the total length of the exons involved is greater than the fragment-length range of the sequencing experiment. however, a poly-selected rna-seq library preparation protocol should enrich for linear transcript products. al-balool et al.
 <cit>  performed a large-scale experimental analysis of post-transcriptional exon shuffling  events detected as ncejs in human datasets, along with extensive wet-lab validations; some of the ncejs that they reported could represent ptds.

chimeric transcripts have been detected in a range of eukaryotes
 <cit> , including mice
 <cit> , rats
 <cit> , and both healthy and diseased human tissues
 <cit> . although al-balool et al.
 <cit>  reported four genes in which expression levels of ncejs were greater than 50% of those of their corresponding wild-type transcripts, the majority of the  <dig> expressed ncej sequences that they validated were expressed at low relative levels. the functional importance of chimeric transcripts in healthy tissues remains controversial; such transcripts generally have low relative expression levels, and no high-throughput tools have been available for estimating the expression levels of such transcripts
 <cit> .

specific tandem duplications and fusions are important in detecting, prognostically scoring, and treating cancers . in cancerous tissues, chimeras are often the result of genomic events; however, kannan et al.
 <cit>  found strong evidence for transcriptome-level production of chimeric transcripts in prostate cancer samples. they detected many more events in cancer samples than in matched benign samples, and a large fraction of their detected events were either specific to, or had a much higher expression level in, the cancer samples. similarly, li et al.
 <cit>  found evidence in normal endometrial tissue of a fusion transcript due to regulated trans-splicing that is identical to a constitutively expressed fusion transcript resulting from a chromosomal translocation in endometrial tumours. schnittger et al.
 <cit>  found that, beyond the simple presence or absence of an itd in the flt <dig> gene, the relative expression of chimeric flt <dig> transcripts relative to wild-type flt <dig> can be used as a prognostic indicator.

transcriptome sequencing  can support high-throughput detection of chimeric transcripts. de novo transcriptome assembly of rna-seq data  generates contigs representing transcripts without relying on annotated transcript models or assuming collinearity between transcripts and the genome, and so is well suited to discovering novel transcript structures. further, the longer sequences assembled from reads yield alignments that have specific signatures, facilitating detection and characterization of contigs that cannot be explained by reference gene models, and that may reflect complex genomic or transcription-related events.

tools like age
 <cit>  and delly
 <cit>  predict a range of structural variations, including tandem duplications, in genomic data. a number of tools are available for detecting fusions in rna-seq data , but do not predict tandem duplications. yorukoglu et al.
 <cit>  developed dissect, a novel tool for non-collinear alignments of long transcriptome sequences to a reference genome; however, this tool performs alignment only, and does not further characterize the alignments. to our knowledge, no production-grade, high-throughput tool is available that uses rna-seq data to detect and characterize ptds or itds, and compares the coverage of chimeric transcripts to their corresponding wild-type transcripts.

here, we describe a discovery and analysis pipeline for browsing assembled rna for chimeras with localized evidence . it integrates evidence from a range of data types:  assembled transcriptome contigs and their alignments to a reference genome,  read alignments to assembled transcriptome contigs, and  gene and repeat annotations in the reference genome. by comparing assembled contigs to a reference genome sequence, barnacle identifies a wide range of non-collinear alignment topologies, and currently characterizes three types of chimeric transcripts: ncejs , itds, and fusions. barnacle provides a range of filtering options, allowing users to adjust sensitivity and specificity to suit their applications. when provided with alignments of rna-seq reads to a reference genome, barnacle supports prioritizing predictions by comparing the coverages of candidate chimeric transcripts and the corresponding wild-type transcripts.

we applied this tool to two deeply sequenced acute myeloid leukemia  samples. among the events that we predicted are several known to be important in aml: a ptd in the myeloid/lymphoid or mixed-lineage leukemia  gene
 <cit> ; two distinct itds in the fms-related tyrosine kinase  <dig>  gene
 <cit> ; and a pair of reciprocal fusions between the promyelocytic leukemia  and alpha retinoic acid receptor  genes
 <cit> . these results for a well-studied cancer with known and clinically significant chimeric transcripts suggest that barnacle will be a useful tool for detecting and characterizing such events in rna-seq data, particularly in large-scale studies of complex diseases.

RESULTS
barnacle overview
the barnacle pipeline is composed of five stages . the first stage examines contig alignments to genomic sequences  and identifies anomalous or non-reference  contigs that have a variety of alignment topologies. the second stage examines transcriptome read alignments to the assembled contig sequences , and calculates read support for these candidate contigs. the third stage applies user-specified filters to the candidate contigs and retains sufficiently confident candidates. the fourth stage identifies chimeric transcripts of particular types from the filtered candidates. these four stages require the following as input: contig sequences in fasta format; contig-to-genome alignments in psl format; read-to-contig alignments in bam format; and gene and repeat annotations in ucsc genepredext and bed file formats, respectively. the optional final stage uses read alignments to genomic sequences  in bam format to compare the coverage of the predicted chimeric transcripts to their corresponding wild-type transcripts. although we used the trans-abyss pipeline for the assemblies and alignments in our experiments below, barnacle can be applied to the outputs of a variety of combinations of assembly and alignment tools, provided that the outputs can be converted to the accepted formats.

stage  <dig> detecting candidate contigs
stage  <dig> . candidate identification
barnacle begins by examining alignments of contigs to the reference genome, determining which alignment best represent each contig, and comparing these alignments to the alignment signatures that we have identified as indicating non-collinear alignment topologies, such as interchromosomal, where parts of the contig align to different chromosomes; inversion, where parts of the contig align to different strands of the same chromosome; eversion, where parts of the contig align out of order to the same strand of the same chromosome; and duplication, where parts of the contig align to the same region of the same strand of the same chromosome . while examining alignments, barnacle uses their genomic coordinates to assign genes to each. because long-sequence aligners  are designed to generate collinear alignments, determining which alignment result most likely represent the true genomic source of the transcript that produced a given contig is non-trivial. barnacle cannot simply pick the alignment with the highest alignment score or percent identity.

the alignment selection problem is as follows. by contig and genome we are referring to strings, s, of characters in the alphabet {a, c, g, t}. for any such string, we will refer to the substring of s starting at position i and ending at position j, inclusive, as s. for a contig c, define a, a contig-to-genome alignment of c, as a mapping from each position i in c to one of:

•an insertion, showing that the base at contig position i is not aligned to the base in any genomic position;

•a match, showing that the base at contig position i is aligned with and the same as the base at genomic position j;

•a mismatch, showing that the base at contig position i is aligned with and different from the base at genomic position j.

note that since we are considering rna-to-dna alignments from an rna contig-centric perspective , we are not concerned with deletions, i.e. unaligned genomic positions flanked by aligned genomic positions, which would typically represent introns in rna-to-dna alignments. as no contig position would be mapped to such deletions, we do not consider them.

we define a query gap as a set of adjacent contig positions mapped to an insertion . that is, if for positions i and j, i < j, positions i- <dig> and j +  <dig> are marked as a match or a mismatch, and all positions between i and j, inclusive, are marked as an insertion, then c is a query gap. query gaps can also occur at either edge of a contig, when either i =  <dig> or j = |c|- <dig> 

now, for each contig c, we have a set of contig-to-genome alignments: a . we define the following functions for analysing sets of contig-to-genome alignments: quality) is the sum of the qualities of the alignments in a, based on the alignment score and percent identity reported by the contig aligner; inclusion) is the fraction of the positions in c marked as a match or mismatch in any of the alignments in a; overlap) is the fraction of positions in c marked as match or mismatch in more than one of the alignments in a; and size) is the number of alignments in a . we then define score) = quality) + inclusion) - overlap) - size). our goal is to find all subsets a* of a that approximate a maximization of score).

there are four possible cases to consider for each alignment set a* found for contig c :

case i: a* is a single alignment that contains no query gaps; the contig is considered non-chimeric, and not processed further.

case ii: a* is a single alignment that contains one or more query gaps; the contig is considered a potential gap-candidate .

case iii: a* is a pair of alignments; the contig is considered a potential split-candidate .

case iv: a* contains more than two alignments; the contig is considered outside the current scope of barnacle characterization, and not processed further.

barnacle approaches the alignment selection problem heuristically. first, for a contig c, if any single alignment result a in the set of alignments a, has inclusion) greater than a user-specified threshold, then contig c is considered to fall into case i and is not processed further. otherwise, the alignments in a are grouped by their pairwise overlap values, resulting in a partitioning of the positions in c based on the edges of the alignments in each group. that is, if a = {a, b, c, …} and overlap,b}) is greater than a user-specified threshold, then a and b are grouped together. furthermore, if either overlap,c}) or overlap,c}) is greater than the threshold, c is also grouped together with a and b.

barnacle then chooses the highest quality alignment result in each alignment group. if there are multiple alignments in a single group that have qualities within a user-specified range of the highest quality alignment, then they are all marked as multi-mapping and considered in following steps. candidates involving alignments marked as multi-mapping can be removed at the filtering stage, if desired . by default, barnacle discards any alignments to mitochondrial dna, but the user can disable this option.

to determine whether a potential gap-candidate  represents a chimeric transcript, barnacle processes it as follows. first, the contig-to-genome alignment a must pass user-specified thresholds for quality}), inclusion}), and the length of the query gap. if the alignment passes these thresholds, then for each query gap in that alignment, barnacle attempts one or two local realignments, using the query gap sequence as the new query. the first realignment looks for duplications by attempting to align the query gap sequence to the sequence produced by masking the gap position in the original contig sequence . if c is the query gap, then barnacle attempts an alignment between c and c + c . if the query gap is internal to the contig, i.e. i >  <dig> and j < |c|- <dig>  then a second realignment is attempted. this alignment looks for inversions by attempting to align the query gap sequence to the genomic region bounded by the genomic alignment coordinates of the bases flanking the gap in the original contig-to-genome alignment . if the contig position c is aligned to genomic position g and c is aligned to genomic position g, then c is aligned to g. if either of these realignments is successful, barnacle creates a gap-candidate from the contig c, the original contig-to-genome alignment a, and the successful query-gap realignment a’.

potential split-candidates  need only have inclusion) greater than a user-specified minimum value for barnacle to create a split-candidate from the contig c, and the pair of contig-to-genome alignments a*.

at this point, barnacle has identified gap- and split-candidates with a variety of alignment topologies. each candidate is made up of a contig and a pair of alignments associated with that contig. for gap-candidates these are a single contig-to-genome alignment and a gap-realignment; for split-candidates they are two contig-to-genome alignments. if barnacle has marked either of these alignments as multi-mapping, the candidate contig is also marked as multi-mapping. a single contig can be present in multiple candidates if, for example, that contig multi-maps. barnacle labels each candidate with the appropriate alignment topology and uses these labels while calculating support and annotations, and while identifying specific types of chimeric transcripts.

stage  <dig> . candidate grouping
because some transcriptome assemblers produce a meta-assembly, i.e. a set of contigs that has been produced by merging several independent assemblies generated with a range of assembly parameters
 <cit> , a single event can be represented by multiple contigs. alternative splicing can also result in multiple contigs representing the same event. to address this, gap- and split-candidates are grouped by their genomic locations and alignment orientations.

stage  <dig> . candidate annotation
for use in filtering, predictions, and characterization, several types of annotations are associated with each candidate, based on files provided by the user. if the genomic coordinates of a predicted event overlap any repeat regions, segmental duplications, or small structural rna regions , the event is annotated with this information. also, for each candidate barnacle determines whether both, one, or neither of its genomic breakpoint coordinates match annotated exon boundaries. for a fusion from gene a to gene b, the first breakpoint is the last genomic position from gene a that is present in the transcript, while the second breakpoint is the first genomic position from gene b that is present in the transcript. note that barnacle is able to detect fusions that involve non-canonical exon junctions; it does not require that fusion breakpoints match annotated exon boundaries. for a tandem duplication event, the breakpoints are the first and last genomic positions of the duplicated segment.

stage  <dig> calculating read support
when the two genomic regions connected by a chimeric breakpoint have high sequence homology, it can be 'impossible to unambiguously determine the exact position of that breakpoint within the homologous region . given this, a search region, p, surrounding the breakpoint is determined on the contig, based on the alignments associated with the candidate . for gap candidates involving a duplication event, p is defined as the region between the two copies of the duplicated sequence . at each position p within p, barnacle calculates the read depth r, counting only reads mapping to the contig without mismatches and overlapping p by at least a user-specified minimum on each side ). barnacle reports the minimum value of r over all positions p in the search region p as the read-to-contig support for the current candidate contig. this guarantees that wherever the breakpoint is within p, at least the reported number of read alignments overlap the breakpoint.

since multiple contigs may represent the same event, barnacle uses the following method for handling reads that map to multiple contigs. for a given read r, let c represent the set of contigs that r maps to. for a contig c, let e represent the set of contigs representing the same event as c, i.e. c plus any other contigs grouped together with c . now define score = |intersection, e)| / |c|. for all c in c, r strongly supports c if score ≥   <dig> , otherwise r weakly supports c. barnacle reports both total read-to-contig support  and strong read-to-contig support .

stage  <dig> filtering candidates
barnacle provides several filters that a user can apply to the candidates at this point. the filters and their default values were iteratively developed in close interaction with manual review. the following filtering criteria can be applied to each candidate, with default values shown in parentheses:

 <dig>  the number of candidate groups containing the contig associated with the candidate ;

 <dig>  whether the candidate has been marked as multi-mapping ;

 <dig>  whether the inferred event is a homopolymer sequence ;

 <dig>  whether the breakpoints occur within any repetitive regions ;

 <dig>  whether the breakpoints occur within any structural rna regions ;

 <dig>  the percent identities of the pair of alignments associated with the candidate ;

 <dig>  the total fraction of the bases in the contig marked as “match” or “mismatch” in the pair of alignments associated with the candidate ;

 <dig>  the amount of support from read-to-contig alignments ;

 <dig>  the maximum amount of overlap in the contig coordinates of the pair of alignments associated with the candidate ;

 <dig>   whether the event might be a misalignment of the poly tail of a transcript  events).

the filters for the number of distinct candidate groups , contig multi-mapping , homopolymer sequences , annotated repeats , and small structural rnas  all address the challenges that repetitive sequences pose to assembling and aligning contigs, which reduce prediction confidence. there are two situations that can cause a contig to create candidates in multiple candidate groups. first, the contig could represent a combination of multiple simultaneous events, such as a pair of fusions joining three genes into a single transcript. second, alignment ambiguity can result in several mutually exclusive events that are explainable by the same contig. for example, if two genes a and a’ have similar sequences and there is a fusion between one of them and a third gene, b, then the assembled contig will have one piece that aligns to gene b, while the remainder of the contig aligns with similar qualities to both gene a and gene a’. so, while only one fusion actually occurred , the resulting contig will be explainable by either of them. because the frequency of the events being detected is typically low compared to the transcriptome size, and contigs that involve multiple simultaneous events are more difficult to characterize, we allow the user to limit the number of events that a reported contig can contain. this filter  can also be used to roughly control the amount of contig multi-mapping allowed in the final predictions, since filter  removes contigs with any amount of multi-mapping. for a candidate to fail the homopolymer filter, it must be a gap-candidate, and every position within the realigned portion of the query gap must be the same base. because expansions of homopolymer and repetitive regions can have signatures similar to general duplication events, we allow the user to filter out such expansions with filters  and  if desired. small structural rnas  can resemble repeats
 <cit>  and can be eliminated using filter .

filters for percent identity  and contig inclusion  are used to filter candidates based on the confidence with which barnacle chose alignments to represent the genomic source of the contig associated with the candidate, when creating the candidate in stage  <dig> 

the read-support filter  specifies minimum values for total and strong read support calculated for each candidate in stage  <dig>  it can help avoid false positives due to misassembly, by requiring that reads directly support the novel sequence at the event breakpoint, and allows the user to adjust the sensitivity to weakly expressed chimeras by filtering predictions based on chimera read coverage. see stage  <dig> above for a description of how read support is calculated. the discussion of the aml datasets below suggests how to select appropriate threshold values for this filter. this filter has a default value of  <dig> strongly supporting reads, which we established in extensive work with human datasets from large-scale disease studies, in which manual review needs to be efficient. users will likely need to determine the optimum value for this threshold for their specific analyses. see our discussion of the aml datasets below, for suggestions on how to choose an appropriate value for this threshold.

the final two filters attempt to handle some common sources of false positives. the maximum contig overlap filter  helps avoid false positives due to large regions of homology between distinct genomic regions causing such regions to be incorrectly assembled together. from our experience, setting this filter to the read length, such that contigs overlapping by more than the read length are rejected, is usually appropriate. the poly filter  helps avoid false positives when one of the alignments associated with the candidate is either a run of t’s at the very beginning of the contig or a run of a’s at the very end of the contig. the presence of poly tails in assembled contigs can cause misalignments to the reference genome.

stage  <dig> predicting chimeric transcripts
barnacle uses the alignment topology , gene and exon-boundary annotations , and sequence properties of the candidates that have passed the user-specified filters  to predict chimeric transcripts of specific types. for the work described here, we focus on fusions, ptds, and itds.

we predict fusion events from split-candidates with any topology. the two alignments associated with the candidate must overlap only distinct genes, and must not overlap each other in the genome . along with each fusion prediction, barnacle reports whether or not the direction of transcription of the two genes is maintained in the contig structure. as noted above, there is no requirement that the fusion involves only canonical exon junctions.

as a ptd event, by definition, must involve at least a single full exon, we expect that such an event will usually be too long to be assembled as a full-length chimeric transcript. instead, assembly programs like abyss will produce a short junction contig representing the ncej between the copies of the duplicated exon. the minimum duplication length to create a junction contig rather that a full-length contig, as well as the length of the junction contigs produced, will depend on both the read and fragment lengths sequenced, and the assembly algorithm and parameters used. such junction contigs will align as split-candidates with an eversion or duplication topology . we predict ptds from such split-candidates when both alignments associated with the candidate overlap the same gene, and both genomic breakpoint coordinates match annotated exon boundaries . as noted above, these candidates may actually represent circular isoforms rather than ptds ; however, as the focus of our analysis is data from poly-selected cdna libraries, we mark them as ptd events.

we predict long itd events with criteria similar to those used for predicting ptd events, except that we require that at least one of the genomic breakpoint coordinates does not match any annotated exon boundary. however, itds can also be quite short, in which case assembly of the full-length chimeric transcript is possible. short itds are predicted from gap-candidates that have a duplication topology  and at least one genomic breakpoint that matches no annotated exon boundary. the exact length threshold separating “long” itds, detectable as split-candidates, from “short” itds, detectable as gap-candidates, will depend on the assembly algorithm and parameters used.

due to the difficulties inherent in aligning transcriptomic sequences to a genomic target sequence , misalignments that lead to false positive event predictions can occur. therefore, as a final, post-processing filter, contigs representing potential fusions, ptds, and itds can be aligned to wild-type transcript sequences provided by the user. predictions involving any contig that exhibits a full-length, collinear alignment  to any single wild-type transcript are removed from the final output.

stage  <dig> measuring relative coverage
to support prioritizing detected events, barnacle can estimate the coverage of a predicted chimeric transcript relative to its co-expressed wild-type transcript, when provided with alignments of transcriptome reads to the genome . because this is a fractional metric, there is no need to normalize its value when making comparisons between different genes and/or datasets.

when multiple isoforms are expressed, determining the full-length structure of a transcript with rna-seq can be constrained by the length of the cdna fragments produced in the sequencing experiment; that is, an rna-seq dataset contains insufficient information to disambiguate structural options that are separated in the rna by a distance longer than the fragment length. for example, consider a gene with five exons, in which the middle exon is longer than the fragment length. if there are reads representing transcripts both with and without the second exon, as well as reads representing transcripts both with and without the fourth exon, sequence analysis cannot determine which of the following four transcripts are actually present in the dataset: e1-e2-e3-e4-e <dig>  e1-e3-e4-e <dig>  e1-e2-e3-e <dig>  and e1-e3-e <dig> 

given this constraint, barnacle calculates a local metric that relies only on those portions of the transcripts for which we have direct evidence in the contig representing the chimera. for example, for a contig representing a duplication of exon  <dig>  our method estimates the coverage of expressed chimeric transcripts that include a duplication of exon  <dig> and the coverage of expressed wild-type transcripts involving exon  <dig>  then returns the value obtained by dividing the former by the latter. for a contig representing a fusion joining the first two exons of gene a  to three of the last four exons of gene b , our method estimates the coverage of expressed chimeric transcripts that include the fusion junction between exons a <dig> and b <dig>  the coverage of expressed wild-type transcripts of gene a involving exons a <dig> or a <dig>  and the coverage of expressed wild-type transcripts of gene b involving exons b <dig>  b <dig>  or b <dig>  then returns the two values obtained by dividing the first value by each of the latter. cases may occur in which a gene expresses, at relatively high levels, isoforms that do not include the exon that are involved in the chimera; these will reduce the accuracy of the reported relative chimeric coverage.

when a chimera involves duplication of a sequence that is longer than the read length, accurately measuring the relative coverage of that chimera requires knowing how many times the sequence is duplicated. however, given the relationship between the duplicated region length and structure, the read and fragment length, and assembly software and parameters, assembly may not provide sufficient information to determine the copy number of a duplicated region. as noted above, long duplication events will sometimes be detected through a short junction contig representing the ncej between the copies of the duplicated region, rather than a contig representing the full transcript . from such a short contig it is not possible to determine the multiplicity of the duplication. however, because we expect that lower copy number duplications are far more common than higher copy number duplications, we calculate relative coverage assuming that every duplication event involves only a single extra copy of the duplicated region.

for the read depth of the chimeric transcript, c, we use the read-to-contig support calculated by barnacle . we then define two search regions in the genome, a and b, by considering the alignment blocks of the contig-to-genome alignments. these two groups of blocks are either cut or extended so that the sum of the lengths of all blocks in each region is twice the read length . each of these genomic regions is part of our attempt to determine a collection of regions that, when joined together, might represent a portion of a chimeric or wild-type transcript extending two read lengths away from the chimeric breakpoint. using the read-to-genome alignments, we calculate the read depth, t, at each position s in each block of each search region r in {a,b}, counting only reads that overlap s by at least q nt . t is made up of three values: dw counts reads that represent sequences present only in wild-type transcripts, t <dig> counts reads that represent sequences present once in both the wild-type and chimeric transcripts, and t <dig> counts reads that represent sequences present once in wild-type transcripts, but multiple times in chimeric transcripts .


 tr,s=dwr,s+t1r,s+t2r,s 

from these values, and the copy-number assumption explained above, we have the following formula for estimating the wild-type read depth at each position in regions a and b:


 wr,s=dwr,s+i1r,s×t1r,s‒c+i2r,s×t2r,s‒2×c 

where ij =  <dig> if tj >  <dig> and i1 =  <dig> otherwise, for j in { <dig> }. defining w as maxs{w} and t as maxs’{t : w = w}, we now have five values for three regions: c, the chimeric read depth at the chimeric breakpoint; w, the wild-type read depth in region a; t, the total read depth in region a; w, the wild-type read depth in region b; and t, the total read depth in region b. two more values are calculated: w, the average of w and w; and t, the average of t and t. for each predicted event, barnacle reports these seven values as well as the six ratios c/w and c/t, for r in {a,b,*}.

for duplications, w and w  and t, respectively) represent two measures for the same gene, and we consider their average value, w ) in our further analysis. for fusions, w and w  and t, respectively) represent measures of two different genes, so we consider them independently.

simulations
to test barnacle’s sensitivity and specificity, we first created two simulated paired-end datasets that had distributions of read coverage comparable to the aml datasets discussed below. the first, a negative control , contains only simulated reads generated from annotated transcript sequences. for the second, a positive control , we simulated reads from simulated chimeric event transcripts, and combined these reads with the wild-type reads from the first dataset . we processed these two datasets with trans-abyss v <dig> . <dig>  followed by barnacle v <dig> . <dig>  since this is the first production-grade tool for ptd and itd detection in rna-seq data, we have no comparators for its performance for these event types. we compared its fusion prediction performance on these two datasets with that of tophat-fusion v <dig> . <dig> . these two datasets have  <dig> nt reads and mean fragment lengths of  <dig> nt. sim <dig> comprises 38 m reads. sim <dig> includes those 38 m wild-type reads as well as  <dig>  m reads generated from simulated chimeric sequences, for a total of  <dig>  m reads.

in the negative control dataset, sim <dig>  barnacle predicts a single false positive fusion between pigm on chromosome  <dig> and ncoa <dig> on chromosome  <dig>  and no false positive ptds or itds  shows sensitivity and false discovery rates in the positive control dataset, sim <dig>  for five different setups or configurations. row  <dig> in this table contains values with a configuration that uses blat for contig-to-genome alignments and bwa for read-to-contig alignments, and has barnacle remove predictions involving multi-mapping contigs . with this configuration, barnacle predicts  <dig> ptds,  <dig> itds and  <dig> fusions;  <dig>   <dig>  and  <dig> of these predictions represent simulated ptds, itds, and fusions, respectively. below, we discuss the false positives and negatives in the positive control dataset.

three of the  <dig> itd predictions are actually misclassified ptd events, but the remaining  <dig> are true positives. these ptd events are misclassified because of errors made by barnacle in determining whether the event breakpoints match annotated exon boundaries. two of the simulated itds occur within exon  <dig> of the sgk <dig> gene, and because of their proximity, barnacle groups the two contigs, each with one itd sequence, into a single prediction , resulting in  <dig> itd predictions representing  <dig> simulated itds.

as expected, given that every read present in the negative control is also present in the positive control, one of barnacle’s fusion predictions in sim <dig> is the same false positive fusion between pigm and ncoa <dig> as seen in the negative control dataset . another prediction is reported as a fusion between gnrh <dig> and sirpa, which is not present in the simulated events; however, a fusion between gnrh <dig> and sirpb <dig> is present in the simulated events, and there is  <dig> nt of exact sequence homology between sirpa and sirpb <dig> adjacent to the breakpoint of the fusion.

of the  <dig>  ptd  events that barnacle did not predict, only  <dig>  have a simulated mean coverage equal to or greater than the read-to-contig support threshold used to filter the barnacle predictions . stage  <dig> of barnacle identifies twelve of the  <dig> fusions with simulated mean coverage above our threshold, but stage  <dig> filters these candidates out of the final predictions due to undercounting of read support in stage  <dig>  barnacle undercounts read support in these cases because the assembled contigs are extremely short, i.e. close to or even shorter than the read length. this makes it difficult to align the reads to the contigs using bwa
 <cit> . bwa also has trouble aligning reads to the start or end  of target sequences, and some of these fusion contigs have breakpoints less than a read length from the edge. barnacle’s fusion sensitivity improves when read support is recalculated using read-to-contig alignments generated by abyss-map, which is capable of aligning parts of reads to short sequences and the edges of sequences . abyss-map is a mapping tool distributed with abyss
 <cit> . note that abyss-map only reports a single location for reads that multi-map, which can result in under-counting of read-support when multiple assembled contigs represent the same chimeric event.

bailey et al.
 <cit>  define a segmental duplication as a region at least  <dig> nt long that is duplicated within the reference genome with sequence identity greater than 90%. five of the simulated fusion events that had coverage higher than the read-to-contig support threshold, and for which barnacle did not undercount read support, involve genes located within segmental duplications that have 100% sequence identity. these fusions are identified as candidates in stage  <dig>  but are not present in the final predictions due to our use of barnacle’s contig-to-genome multi-mapping filter . if we disable this filter and accept multi-mapping contigs, the fusions appear in barnacle’s results . however, the genes for these simulated fusions are in genomic regions whose sequences are identical over distances much longer than the  <dig> nt fragment length and the lengths of the genes involved in the fusions. given this, although the assembled fusion sequence is correct, barnacle cannot decide which of the two possible breakpoint locations is correct, and if both alignment options overlap genes, both are reported. so, for the simulated fusion between ap <dig>  and lztr <dig>  barnacle reports fusions of lztr <dig> with both ap <dig> and kb-1125a <dig> , which have nearly the same sequence. ap <dig>  and kb-1125a <dig>  have two exons each; kb-1125a <dig>  exon  <dig> is an exact subsequence of ap <dig>  exon  <dig> and kb-1125a <dig>  exon  <dig> is an exact subsequence of ap <dig>  exon  <dig>  fortunately, for the four other simulated fusions lying in segmental duplications, only one of each of the duplicated regions contains a gene annotation, so barnacle reports only the correct prediction. we suggest that users have barnacle remove predictions involving multi-mapping contigs, unless specifically looking for events involving genes within known segmental duplications.

while ptd specificity is high , ptd sensitivity is low, due in part to a blat limitation. as noted above in stage  <dig>  ptd events are often represented by short junction contigs. accurate alignment of these contigs often involves splitting the contig into two pieces and aligning each piece of the contig to the same, or overlapping, locations in the genome. we noted that in many of these cases blat reports an alignment for only one of the two pieces. while gmap
 <cit>  is better able to align such contigs, it is less effective with itd contigs; using it improves ptd sensitivity but reduces itd sensitivity . using gmap also leads to a slight increase in fusion sensitivity, but at the cost of additional fusion false positives.

with default settings, tophat-fusion
 <cit>  made no fusion predictions in either simulated dataset. we suspected that this was due to the long read length and short mean fragment length used for read simulation, which correspond to the read and mean fragment lengths in the aml datasets discussed below. since the  <dig> nt mean fragment length is less than twice the  <dig> nt read length, in most cases the pair of reads simulated from a fragment will contain overlapping sequence. therefore, for any fragment representing the sequence across a fusion breakpoint, that breakpoint will lie within at least one of the reads generated from that fragment. this means that there will be almost no fragments with one read entirely on one side of the fusion and the other read entirely on the other . to address this, we ran tophat-fusion with the supporting-pairs threshold set to  <dig> . with this change, tophat-fusion predicted no fusions in sim <dig>  the negative control, and predicted  <dig> fusions in sim <dig>  the positive control,  <dig> of which are true positives . the remaining two predictions in sim <dig>  are false positives; however, they both involve genes whose sequences are extremely similar to genes involved in simulated fusions. specifically, the part of bcrp <dig> involved in the predicted fusion has  <dig> % sequence identity with the part of bcr that is fused to rtn4r, and the part of sirpa involved in the predicted fusion has  <dig> % sequence identity with the part of sirpb <dig> that is fused to gnrh <dig>  tophat-fusion predicts fusions of rtn4r with both bcr and bcrp <dig>  but does not predict the gnrh2/sirpb <dig> simulated fusion.

although when configured with blat for contig-to-genome alignments and bwa for read-to-contig alignments, and removing multi-mapping contigs , barnacle had lower fusion sensitivity than tophat-fusion  in our simulated dataset sim <dig>  using different alignment tools and allowing predictions involving multi-mapping contigs may improve barnacle’s performance . however, in our experience, removing predictions that involve multi-mapping contigs is useful in reducing false positives in real data. see also our comments below on read-support thresholds in simulated and real data.

because the optimal aligners could differ depending on the nature of the experiment, barnacle allows users to choose preferred read and contig alignment tools. for example, these simulations suggest that using gmap for contig-to-genome alignments would be better for detecting ptds, while using blat would be better for detecting itds.

additional file
1: table s <dig> gives the runtimes for the various stages of the initial configuration of pre-processing, barnacle, and tophat-fusion, for the simulated dataset sim <dig>  several stages of barnacle and the trans-abyss pipeline take advantage of parallelization to reduce runtimes. for example, contig-to-genome alignment is split into  <dig> jobs, each taking only  <dig>  minutes. assuming a computer cluster capable of running  <dig> jobs simultaneously, trans-abyss pre-processing and barnacle analysis of sim <dig> can be completed in  <dig>  hours. pre-processing is dominated by the  <dig>  minutes taken to sort the read-to-contig alignments. barnacle analysis is dominated by the  <dig>  minutes taken to predict events; most of this time  is spent aligning the candidate contigs to the set of wild-type transcript sequences . tophat-fusion took a total of  <dig>  hours to analyse the same dataset.

we assessed the behaviour of barnacle  at read-support thresholds ranging from  <dig> to  <dig>  using simulated dataset sim <dig>  additional file
1: table s <dig>  reports the sensitivities and false discovery rates , and additional file
1: figure s <dig> shows these as an roc-like curve. we use fdr rather than sensitivity because the number of true negatives is not well defined for this type of experiment. with the abyss parameters used, assembling a sequence requires a minimum local coverage of  <dig> reads; given this, we plot values of tpr’, which is the fraction of simulated events with simulated mean coverage at least  <dig> that are correctly predicted. while a read-support threshold of  <dig> read produces the best tpr’ and fdr for all event types for this simulated data, in our experience, such a threshold tends to produce an impractically large number of predictions in real datasets. see the discussion below of the previously published breast cancer dataset bt- <dig>  and our suggestions for choosing an appropriate read-support threshold for the aml datasets that we analysed.

the roc-like curves are quite different for the three event types. for ptds, barnacle makes no false positive predictions, even with a threshold of  <dig> read, so increasing the threshold merely removes weakly expressed true positives. for itds, the fdr increases as the read-support threshold increases, but the number of false positives does not increase. barnacle’s three false positive itd predictions correspond to simulated ptd events that it has misclassified as itds. because these ptds have relatively high mean simulated coverage levels, increasing the read-support threshold does not remove these false positives, until after it has removed many weakly expressed true positives. the itd fdr decreases when going from a threshold of  <dig> reads to a threshold of  <dig> reads, because of the removal of a false positive itd that is supported by  <dig> reads, causing a ‘zig-zag’ shape in the curve. for fusion predictions, with read-support thresholds of  <dig> or lower, the curve for fusion predictions is similar to that for itd predictions; with read-support threshold higher than  <dig>  it is similar to that for ptd predictions.  <dig> and  <dig> reads support the two false positive fusion predictions made by barnacle, so when the read-support threshold is  <dig> or above, these two predictions are removed, resulting in an fdr of  <dig> 

we note that while the tpr’ and fdr of barnacle with a read-support threshold of  <dig> are identical to those of tophat-fusion, the predictions are not . each tool predicts  <dig> fusions;  <dig> of the fusions predicted by barnacle are not predicted by tophat-fusion, and  <dig> others are predicted by tophat-fusion but not by barnacle. six of the tophat-fusion-specific fusions are represented by trans-abyss contigs that are very short, causing problems with the read-to-contig and contig-to-genome alignments; four more are represented by trans-abyss contigs that multi-map when aligned to the genome. one of the tophat-fusion-specific fusions is represented by a trans-abyss contig that has issues being aligned to the genome due to sequence homology between the regions flanking the fusion breakpoints. another one of the tophat-fusion-specific fusions is represented by a trans-abyss contig that represents two distinct fusion transcripts assembled together, leading to a complex contig-to-genome alignment. the final tophat-fusion-specific fusion has a simulated mean coverage of only  <dig> .

we assessed the effect on barnacle’s performance of varying read and mean fragment lengths with two additional simulated datasets. sim <dig> and sim <dig> were created analogously to sim <dig>  and used the same simulated chimeric transcript sequences. sim <dig> had  <dig> nt reads, a  <dig> nt mean fragment length, and  <dig>  m reads; sim <dig> had  <dig> nt reads, a  <dig> nt mean fragment length, and  <dig>  m reads. additional file
1: table s <dig> shows that barnacle’s performance is relatively insensitive to changes in read and mean fragment lengths; in particular, it does not depend on the mean fragment length being less than twice the read length, as it is in sim <dig> 

acute myeloid leukemia
we used barnacle to process two poly-selected acute myeloid leukemia  rna-seq datasets, a <dig> and a <dig>  for which we sequenced  <dig> and 227 m read pairs, respectively. these datasets have mean fragment lengths  that are shorter than twice the read length , meaning that most pairs of reads in these datasets will overlap at their 3-prime ends. as noted above, having a mean fragment length shorter than twice the read length can challenge fusion detection tools that rely on fragments spanning fusion breakpoints with one read mapping entirely to each gene involved in the fusion. since barnacle does not rely on mapping reads to the reference genome for event detection, short fragment lengths are not a concern.

prior to processing these datasets, we obtained cytogenetic evidence that the sample associated with dataset a <dig> has a t reciprocal translocation causing fusions between the promyelocytic leukemia  gene on chromosome  <dig> and the alpha retinoic acid receptor  gene on chromosome  <dig>  the presence of these fusions indicates the acute promyelocytic leukemia  subtype of aml, which is particularly sensitive to treatment with all-trans retinoic acid
 <cit> . fluorescence in situ hybridization  showed a normal karyotype in dataset a <dig>  we also found evidence in both datasets of itds in the fms-related tyrosine kinase  <dig>  gene by pcr amplification of the region surrounding flt <dig> exon  <dig> , followed by size-estimation of the observed pcr bands. the presence of this itd is associated with poor prognosis in aml
 <cit> . since the two aml samples we used were poly-selected, and circular transcripts are not polyadenylated
 <cit> , we assume that all ncejs predicted by barnacle represent linear transcripts .

as with the simulated datasets, we used trans-abyss to assemble our reads and perform the required alignments prior to barnacle analysis. initially, we filtered our predictions with the repeat filter enabled and the default read-to-contig threshold of  <dig> reads . see additional file
1: section s <dig> for the barnacle commands used and additional file
1: table s <dig> for runtimes and computational resources. for these deeply-sequenced datasets the overall runtimes, including trans-abyss pre-processing, were ~65 hr with  <dig> cpus and ~39 hr with  <dig> cpus. as in the simulations, runtimes are dominated by sorting the read-to-contig alignments during preprocessing, which took  <dig> and 13 hr respectively. the barnacle runtimes were 10-14 hr with  <dig> cpus, and 5- <dig> hr on  <dig> cpus.

after generating read-to-genome alignments using jaguar
 <cit>  and the hg <dig> human genome reference sequence, we used barnacle to estimate the chimera-to-wild-type relative coverage of each prediction . figure 
 <dig> shows the relationship between the fraction of coverage attributable to the chimeric transcript, and the local total coverage, i.e. the sum of the chimeric and wild-type coverage. using log-log axes, the majority of the predictions are close to a straight line representing our read-support threshold of  <dig> reads; however, there are a few outliers above and to the right of this line. since these two datasets are so deeply sequenced, we filtered the predictions again, increasing the read-to-contig threshold to  <dig> reads to focus on the most confident predictions . in our experience, plotting barnacle relative-expression results and identifying outliers in this way is useful in selecting an appropriate read-support threshold .

after this second filtering, we have  <dig>  ptd,  <dig>  itd, and  <dig>  fusion predictions in a <dig>  . of the three fusion predictions in a <dig>  two are between pml and rara: one joining the 5′-end of pml, ending at exon  <dig>  to the 3′-end of rara, starting at exon 3; the other joining the 5′-end of rara, ending at exon  <dig>  to the 3′-end of pml, starting at exon  <dig>  these are the expected results of the reciprocal translocation detected by cytogenetic analysis. manual inspection reveals that the third prediction is a false positive caused by high sequence identity between the tmem14b and tmem14c genes.

 <dig> exon numbers are from hg <dig> ucsc gene annotations.

 <dig> for the two chimeras predicted in both datasets, read support is presented as a <dig> support / a <dig> support.

 <dig> validation. wgs: validated via whole-genome shotgun sequencing. rt-pcr: validated via rt-pcr. failed mi: failed manual inspection.

 <dig> relative coverage is presented as the local coverage attributable to the chimera, as a percent of the total local coverage . for fusions, relative coverage with each parental gene is ordered as in gene column.

 <dig> relative coverage is presented as a <dig> relative coverage / a <dig> relative coverage.

 <dig> the flt <dig> duplications predicted in a <dig> and a <dig> have different sequences.

a  <dig> nt ptd involving exons  <dig> through  <dig> of sec <dig> is predicted with identical sequence in both datasets, and retains the wild-type open reading frame. the other ptd prediction, a  <dig> nt duplication of exons  <dig> through  <dig> of mll, is specific to a <dig>  and disrupts the wild-type open reading frame. the mll ptd is known to occur in aml patients, particularly those with a normal karyotype , and like the flt <dig> itd, is associated with poor prognosis
 <cit> .

the  <dig> predicted itds range in size from  <dig> nt in mrps <dig> in a <dig> to  <dig> nt in flt <dig> in a <dig> . other than in mrps <dig> and sspo, all of the itds retain the wild-type open reading frame. the prediction in mrps <dig> spans an exon/intron boundary and involves a retained intron adjacent to the duplication; if this intron sequence is considered, as well as the duplicated sequence, then the wild-type open reading frame is retained. seven of the predicted itds  involve microrepeat expansion events . all of the predicted itds but four  correspond to insertion records in dbsnp build  <dig>  the flt <dig> duplication predicted in a <dig> has a distinct sequence from the flt <dig> duplication predicted in a <dig> 

 <dig> exon numbers are from hg <dig> ucsc gene annotations.

 <dig> length is given as either “duplication length” or “duplication length + insertion length”, when extra sequence occurs between the two copies of the duplicated sequence.

 <dig> if: in-frame, fs: frame-shift.

 <dig> event involves retention of a 152-nt intron adjacent to the duplication and is in-frame when this intron is considered as well.

flt <dig> itd events are known to include extra sequence between the two copies of the duplicated sequence in some cases
 <cit> . three of the itds that we predicted  include such insertions. the length of extra sequence that we observe  always results in the retention of the open reading frame when considered along with the duplication.

we assessed whether there was any evidence for our predicted fusions, ptds, or itds in whole-genome shotgun  sequence data for these two samples. for fusions and ptds, we aligned the wgs reads to the hg <dig> human genome reference sequence using bwa v <dig> .9
 <cit> . wgs read pairs supported both pml/rara fusion predictions, and the mll ptd in a <dig>  but not the sec <dig> ptd predictions, suggesting that the latter may be the result of transcriptome-level events. to validate itds, we constructed wild-type and chimeric target sequences by joining together one or more copies of the duplicated sequence with  <dig> nt of upstream and downstream genomic sequence, then aligned the wgs reads to these target sequences using bwa v <dig> . <dig>  we found the wgs reads to support all  <dig> itd predictions.

since we found no genomic support for the sec <dig> ptd predictions in either dataset, we used reverse transcription polymerase chain reaction  to attempt transcriptome-level validations of this ptd . bands clearly confirmed the ptd predictions in both datasets .

breast cancer
we assessed barnacle’s fusion performance on an independent bt- <dig> breast cancer dataset in which two studies discovered and validated  <dig> gene fusions 
 <cit> . with the default read-support threshold of  <dig> reads, barnacle predicts  <dig> fusions . each of the fourteen predictions corresponds to a validated fusion , with  <dig> barnacle predictions representing  <dig> validated fusion gene pairs . the differences between the “matching” and “recovered” columns of additional file
1: table s <dig> are due to the alternative splicing displayed by some of the validated fusions
 <cit> ; barnacle treats fusion isoforms as distinct predictions, so makes multiple predictions for some of the validated fusion gene pairs.

as the number of junction reads supporting each validated fusion is reported
 <cit> , and eight of the validated fusions were supported by three or fewer reads, we assessed reducing barnacle’s read support threshold . while decreasing this threshold increased the number of recovered fusions slightly, it also greatly increased the total number of predictions. for example, with a read-support threshold of  <dig> read, barnacle predicted  <dig> fusions. such a result set would require lengthy manual review, and so would likely be impractical in studies involving large numbers of samples. in contrast, only  <dig> of the predictions made with a read-support threshold of  <dig> do not match validated fusions. one of these predictions, which passes manual review, involves stx <dig> fused to gucy1a <dig>  while barnacle does not predicted the validated fusion between stx <dig> and rae <dig>  which is supported by  <dig> junction reads. another of the barnacle-specific predictions is between numb and tpt <dig> , which also passes manual review. the other two barnacle-specific predictions are c3orf75/mpzl <dig>  which from manual review looks more likely to be a potential novel alu insertion in c3orf <dig> than a fusion, and apoa1bp/znf <dig>  which on review is questionable due to both breakpoints being in gc-rich repetitive regions.

with a read-support threshold of  <dig>  barnacle recovers all but one of the validated fusions that are supported by more than  <dig> junction reads; the exception, discussed above, is stx16/rae <dig>  with a read-support threshold of  <dig> or  <dig>  barnacle recovers the validated cmtm7/glb <dig> fusion that is supported by only  <dig> junction reads. however, as noted above, a low threshold can produce a large number of predictions for which manual review may be costly.

while the original publications validated only fusions
 <cit> , additional file
1: table s <dig> also reports the number of ptds and itds that barnacle predicts in bt- <dig> at each read-support threshold that we used.

CONCLUSIONS
we have described barnacle, a production-grade pipeline for detecting and characterizing chimeric transcripts in long rna sequences, and have demonstrated its capabilities using de novo rna-seq assembled contigs. many methods are available for detecting fusions. in addition to fusions, barnacle detects ptds and itds in rna-seq data; to our knowledge, it is the only method that is being used in large-scale disease studies for detecting tandem duplications
 <cit> . it characterizes these predictions in the context of existing gene and repeat annotations; determines the level of read support; and provides metrics for prioritizing detected events with measures of coverage levels of the chimeras detected, relative to their corresponding wild-type transcripts.

because its first stage considers a wide range of contig alignment topologies, barnacle can be extended to identify other chimera types that are important in disease. for example, repeat expansions play a role in several diseases
 <cit> . while barnacle currently classifies repeat expansions as itds, it could be adapted to specifically characterize such events.

although de novo assembly-based fusion detection methods are more computationally intensive than those based on read alignments to a reference genome, runtimes are practical, and de novo assembly supports characterizing detected events by generating long contig sequences that contain the exact breakpoint and its sequence context. from such contigs, validation primers can be designed, even when the contig represents a complex set of rearrangements .

in two aml datasets, all itds and fusions, and all but one of the ptds that passed manual inspection were validated in genomic data. the sec <dig> ptd predicted in both datasets passed rt-pcr validation, but has no evidence in the genomic data, suggesting that transcriptome-level processes may have caused this chimera, consistent with fusions reported by kannan et al.
 <cit> .

houseley and tollervey
 <cit>  showed that template switching in in vitro reverse transcription reproducibly mimics trans-splicing. this must be kept in mind when validating in silico chimeric transcript predictions. they also found that producing a given reverse transcriptase artifact depends on using a specific reverse transcriptase. as they recommended, we chose a different reverse transcriptase  for the sec <dig> validations than was used in the initial sequencing . since the particular reverse transcriptase artifacts that may be produced by the superscript ii enzyme will likely be different from those produced by the roche transcriptor enzyme, this reduces the chances of false validation due to such artifacts.

given that reverse transcriptase artifacts often involve non-canonical splice sites and regions of sequence homology
 <cit> , each barnacle prediction reports these two features, allowing the user to further evaluate whether a prediction may represent a reverse transcriptase artifact. the sec <dig> ptd that we validated with rt-pcr involved only canonical splice sites, and did not involve regions of significant sequence homology.

our simulations show that, with appropriate filter settings, barnacle makes highly specific predictions for three types of chimeric transcripts that are important in a range of cancers: ptds, itds, and fusions. high specificity makes manual review and validation efficient, which is necessary in large-scale disease studies. in aml, mll ptds, flt <dig> itds, and pml/rara fusions are important for determining prognosis, and we demonstrated barnacle’s potential for large-scale studies by successfully predicting these events in two rna-seq datasets. characterizing an extended range of chimera types will help generate insights into progression, treatment, and outcomes for complex diseases.

