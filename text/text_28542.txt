BACKGROUND
the composition of phytoplankton communities is dependent on different ecological and toxicological factors and the analysis of these communities entails the monitoring of water quality which is prescribed by the european water framework directive  <cit> . however, this approach is time consuming since the organisms have to be registered individually and, due to the high morphological complexity of phytoplankton, most of the routine analysis is still done by hand and microscope. also reproducibility between different scientists and even for the same person is relatively low and reduces the credibility of the retrieved data  <cit> .

to overcome these problems, automation of phytoplankton analysis seems to be a good alternative. it should speed up the process, make it more transparent and reproducible, and therefore improve the effectiveness of phytoplankton identification for water monitoring and protection. because of these advantages, different systems for an automated analysis of phytoplankton communities have been developed.

the use of flow cytometers allows a fast analysis of different plankton groups  <cit>  and removes the need to preserve the sample  <cit> . yet the strongest drawback of this method is that particles must be differentiated based on the optical characteristics as seen by the photomultiplier tube  resulting in poor species resolution, far below microscopic methods   <cit> . another noteworthy approach is the investigation of the whole phytoplankton community in parallel via a metagenomic analysis. since this method is based on genomic data, it has great potential for high taxonomic resolution  <cit> . unfortunately, the costs are still too high to be feasible for a routine analysis, though this is expected to change in the future with the rapid advancements in this field. this also applies to some extent to modern barcoding methods based on the sequence and structure of genetic markers such as ribosomal rna  <cit> . quantification via metagenomic analysis or related barcoding methods may also be difficult as dna or rna molecules and not cells are counted and the number of genomes of each organism  has to be known. finally, the identification of a dna needs a previously sequenced reference genome, i.e. one can only properly identify species which have been studied beforehand.

since taxonomy of plankton is based on morphological differences, various systems using digital image analysis  can be found  <cit> . yet, these systems are mostly developed for the analysis of zooplankton resulting in a resolution too low for an accurate differentiation of phytoplankton. due to their higher resolution, microscopic systems seem to be more adequate for the analysis of this plankton subclass. additionally, microscopes are currently used for the established procedures for plankton analysis, thereby allowing first an adaptation and then an easy comparison of both systems. one reported automated microscopic system is plasa, which was developed with the goal of classifying different phytoplankton organisms with the use of automated microscopy and image analysis for an ecotoxicological microcosm study  <cit> . to allow a better differentiation between different phytoplankton taxa and between phytoplankton and other objects in the sample  fluorescence imaging for phycoerythrin and chlorophyll was integrated into the system. the software was written in idl, a proprietary programming language requiring a commercial license to legally run the respective programs, which potentially hindered the development and adoption of this system. additionally, it has been reported to only be able to differentiate between few taxa, and has seen no further development since it was first published in  <dig> 

in this paper we describe a novel system using automated microscopy and image analysis for the automated identification of phytoplankton for monitoring freshwater quality. like plasa, the microscopic system uses fluorescence imaging, for a better discrimination. the chlorophyll filter set used in plasa was improved and in addition to the filter for phycocyanin, a new filter set for phycoerythrin was also integrated into the analysis. additionally, a new method, where different focal levels are integrated into one image during the microscopy , was used. one of the goals was to develop open source software that is available for a broad range of research. therefore, the image analysis was written as a plugin for imagej, which is a free and open source project written in java  <cit> . this allows the use of the software on almost any operating system without costs. since the code for the plugin is also licensed as free software anyone can adapt and expand the system.

planktovision was specifically developed to improve water quality analysis. in order to make this possible, we so far focused on some of the most important taxa  as defined by the harmonized taxa list for phytoplankton in germany. this list is based on a nation-wide study with the goal to standardize phytoplankton analysis to make it more reproducible  <cit> .

for the automated classification the use of neural networks was examined. neural networks consist of artificial neurons, resembling the properties of biological neurons. these neurons are equations connected in different layers and allow complex classification tasks.

in the following, planktovision and the used microscopic system are described. initial results for the classifications of  <dig> different indicator taxa using a neural network are discussed.

RESULTS
automated image acquisition
images within the scanning path showed a consistent quality  and no significant changes in the characteristics of the sample could be observed during the microscopy . because of an uneven bottom of the sedimentation chamber an auto focus function had to be used for every position resulting in a longer image acquisition time.

since typical bright field images only integrate one focal plane into the image, parts of some organisms with a larger volume were, however, still blurred, which occurred more obviously in the mixed samples. in the quick full focus images , which integrate different focal planes into one image, all organisms could be imaged completely  in the mono culture samples, as well as in the mixed sample . with this method, however, it is essential to avoid vibration during the imaging process to prevent the organisms from moving and creating artefacts in the image. for the fluorescence imaging it could be observed that the short exposure of a single position already caused bleaching effects that reached further than the immediate area of the taken image. to keep the bleaching on the different recording positions to a minimum the distance between them was set to  <dig> μm. additionally, the gain for the fluorescence images was set as high as possible  to keep exposure times as short as possible. after this change, the characteristics of the analyzed samples remained stable during the imaging procedure.

image processing
adaptation of imagej
all image processing and classification tasks were performed with imagej since it already integrates many functions for the work with microscopic images. additionally, imagej is an open source project that can be easily extended. nevertheless, it is not primarily intended to be used for complex classification tasks as presented in this work. to allow this, imagej’s core functionality had to be expanded. this includes the integration of a region growing segmentation algorithm and the calculation of additional features . imagej is also unable to perform classification tasks by itself. to allow this, the classification api encog  <cit>  was integrated into the system.

segmentation
in this step of the image processing all particles in an image are separated from the background and registered individually. comparing both types of images  the separation of the single organisms from the background was better for the qff images . since they integrate different focal planes into one image most of the organisms could be properly segmented and an accurate feature calculation  was possible. for the bright field images a good segmentation was only possible when the organism was imaged at, or near to its focal point. however, it was often impossible to obtain images with all organisms in focus. some organisms have three dimensional structures which can not be focused simultaneously and not all organisms occupy the same focal level when sedimented. when the segmentation of organisms that were not in focus was possible it still resulted in an inaccurate feature calculation and a poor classification process. based on these results only qff images were used for the following training and testing.

selected features & classification
after the segmentation, different features are calculated  that describe the characteristics of the particles. these features are then used in the classification step to differentiate the plankton species. it has to be noted that not all calculated features are used for the classification that is presented within this manuscript as the use of some features reduced the classification results with our species selection . however, these features could be useful to differentiate between a different set of taxa. the features selected for our work are listed in the section below.

the classification procedure was divided into two steps. first a neural network was trained to separate plankton particles from non-plankton particles; the latter exhibited a great range of texture, size and shape and interfered with the actual classification of the plankton. since no non-plankton particles showed any fluorescence and all were mostly transparent or brown, features for color , fluorescence , area and circularity showed good classification results with the mixed test sample .

the data were classified into detritus , unknown plankton organism , cyclotella , anabeana , chlorogonium , cryptomonas , desmodesmus , staurastrum , botryococcus , pediastrum , trachelomonas  and crucigenia . the test set included images of  <dig> different samples that were independently prepared, imaged and analyzed on different days to prevent the selection of an over fitted classifier. the results of planktovision  were compared to a manual classification . correctly classified results are shown in bold.

in a second step, another separate network was trained for the actual differentiation between the plankton taxa. best results for the mixed test sample could be achieved with  <dig> hidden layers  and features for the texture inside of the organism , shape , size , and pigmentation of the organism .

the classification of the test sample showed an average recognition rate of  <dig> % ranging from  <dig> – <dig> %. the rate of false positive particles showed an average of  <dig> %  and was mainly caused by occluded or aggregated organisms, organisms that did not show the typical morphological features, incorrectly segmented particles or particles that were out of the focus range.

discussion
we present here a system for the automated identification of phytoplankton using microscopy and computer-based image recognition in regard to water quality analysis . it integrates methods already described  <cit>  as well as new approaches into the analysis. the procedure performed by the system can be divided into the two general steps: automated imaging of the water sample and the following image processing and recognition.

the sample was sedimented in an utermöhl chamber and automatically scanned in the microscope. to enable a precise analysis of the samples, different images  were taken for each position during the scanning process. quick full focus images , which integrate different focal planes into one image, were newly implemented in a plankton classification system. this has two distinct benefits compared to regular bright field images. on the one hand plankton organisms with a large expansion over the focal plane can be imaged in total, even when using a great magnification, improving the accuracy of the following image processing and recognition . on the other hand, the loss of whole groups of organisms, which are mostly located at a higher focal point above other sedimented organisms , can be reduced. this results in a smaller overall systematic error for the system .

since the used keyence software is proprietary, it was not possible to determine exactly how qff images are generated. this may complicate the adaption of planktovision to other microscope systems, which probably have similar but not necessarily identical functions available. to avoid these problems and make methods available to more people it is advisable to use open source solutions for the control of microscopes . one possible solution would be the use of the micro manager software  <cit> . micro manager allows the recording of z-stacks and since it is based on imagej, existing or newly created plugins for a z-stack projection could be easily integrated. the currently supported hardware of micro manager includes single components as well as fully motorized microscopes from leading manufacturers. unfortunately, micro manager does not support the hardware currently used for the development of planktovision and therefore could not be integrated.

in addition to the fluorescence of chlorophyll and phycoerythrin, which was already recorded by the plasa system, the imaging of the phycocyanin fluorescence was newly integrated in the imaging process. unlike as described for plasa  <cit> , we used a chlorophyll filter which is able to excite chlorophyll a and chlorophyll b simultaneously so that both could be included into the analysis. the filter set used for plasa has been reported not to induce chlorophyll fluorescence for some species during the experiments. it only excites chlorophyll b, which is not present in the photo system of many phytoplankton species  <cit> .

the image processing itself can be divided into three distinct steps:  segmentation of the organisms from the background;  calculation of features that describe the segmented particle in a more defined way; and  classification of the different groups of organisms based on the calculated features.

for the segmentation a region growing approach was chosen  <cit> . compared to a histogram-based thresholding, where the whole image influences the segmentation, it enables a more robust segmentation of very different organism. this is possible since only the background region is included into the calculations for the segmentation and the amount and type of the organisms in the analyzed image has no influence. edge detection  was integrated into the region growing, to allow a good segmentation of transparent organisms and organisms that include transparent parts. because of this, the segmentation was only possible for organisms that were imaged at their focal point, since edges are only detectable at sharp intensity differences in the image. this, however, is not a drawback, as the segmentation of organisms that are out of focus results in a reduced accuracy, or even erroneous feature calculation and has an overall negative impact on the analysis. therefore the positive effects of the edge detection vastly outweigh its disadvantages and we conclude for this application that the combined approach of edge detection and region growing is superior to a region growing without previous edge detection.

for the feature calculation, new features  as well as those previously reported  were used. despite the fact that most factors for illumination were set to fixed values and the image as well as the rotation of the organisms was corrected before classification, it was noted that few features, which are not invariant to those factors, were less suitable for classification. these features include statistics of the gray level co-occurrence matrix as well as normalized brightness and saturation of the organisms. also features that are influenced strongly by slight variations in shape  seem to deteriorate the results since the shape varies to differing extents with the different organisms.

the classification of the organisms described was done by using neural networks. for the differentiation of all taxa one network with  <dig> output possibilities  was chosen and trained with one pre-selected set of features. another possibility would be to use one network for every organism with a feature set optimized and specifically selected for this organism. in this case, classification would be done by going through every network and checking if the particle belongs to one class or not. however, training and feature selection for the different networks would be more complex and every network would have to be checked and  adapted to each new organisms integrated into the system. since the classification with one network showed a good performance this approach was preferred due to its simplicity and expandability.

despite the average classification rate of ~ 95%, an over-training of the network can be excluded as the image test set contained images from independent samples and all samples showed good classification results without bias towards a wrong class. a comparison of the classification rate to other published systems is difficult since there are differences in the number of classes, as well as varying similarities of the organisms that should be differentiated. additionally, most of the reported systems are used for differentiation of marine plankton.

culverhouse  <cit> , however, made a comparison of reported systems. the classification results are summarized as followed: adiac , which is a system for the automated analysis of diatom slides  <cit> ; zooscan , which is a platform for the analysis of mesozooplankton where samples are imaged with a water-proof scanner  <cit> ; sipper   <cit>  and vpr   <cit> , which both are system for the analysis of mesozooplankton, where the organisms are imaged during the sampling; dicann , which is a system for the classification of dinoflagellates  <cit> ; cytosense , which is a flow cytometric approach  <cit> .

the average recognition rate of plasa  was above the recognition rate of the previously mentioned systems and is comparable to the rate achieved by planktovision . nevertheless, planktovision showed a much smaller rate of false positives  when compared to other reported results . for all the mentioned systems the false positives were mostly caused by a wrong classification of non-plankton particles and unidentified objects.

in planktovision this cause of errors could be drastically reduced by the use of the adapted chlorophyll fluorescence filter which allowed a very good exclusion of non-planktonic particles from the analysis with an error rate < 1%. additionally, “unknown” particles  could be identified with ~ 92% accuracy during the analysis, despite the fact that they showed a great range of shape, color and fluorescence. additionally, the system allowed a good classification of taxa that show similarities in their morphology  as well as a good differentiation of taxa that show varying morphology within their class .

comparing the average classification rate of ~ 95% achieved by planktovision to human accuracy, the results are in the same range as those reported for routinely engaged personnel  and notably better than those for trained but not routinely engaged personnel   <cit> . here it has to be stated that an analysis of a sample by a human generally does not provide a reproducible error rate - despite an automated system.

CONCLUSIONS
the implemented automated microscopy and the new open source image analysis system -planktovision- allowed a good differentiation of the presented test set consisting of  <dig> different phytoplankton taxa. the classification results were comparable or better than existing systems and the false positive rate could vastly be improved over reported results due to a better exclusion of non-plankton particles and unidentified objects. the image analysis was developed as an open source system in order to make it available for many researches and thereby help to make the analysis of water quality more reproducible. for future work, more taxa should be integrated into the analysis to allow the generation of more significant results in regard to the water quality analysis of real phytoplankton samples. however, the chosen methods for the image processing might have to be revised to test if they are still sufficient, or if they will have to be further extended . additionally, the choice of the neural network structure might have to be reexamined for the differentiation of a larger number of taxa.

