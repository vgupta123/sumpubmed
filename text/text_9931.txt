BACKGROUND
the ability to characterize phenotypes related to respiration is of vital importance to many areas of biomedicine ranging from pulmonary and infectious disease to drug discovery and biodefense. although such devices can be applied clinically  <cit> , plethysmographs designed for small animals provides an effective means to study phenotypes that can be expensive or impossible to carry out in humans. there are several variants of plethysmographs which differ in whether the animal is wholly contained within the chamber and whether they are restrained during the measurements  <cit> . for whole body plethysmographs  <cit>  a common parameter of interest is enhanced pause , which can be considered a measure of airway resistance  <cit> . some examples of the applications of these devices include studies in asthma  <cit> , sleep apnea  <cit> , cystic fibrosis  <cit> , respiratory viral infection after radiation injury  <cit>  as well as the assessment of host immune response to respiratory syncytial virus after vaccination  <cit> .

in order to easily analyze and share data from a large scale experiment utilizing unrestrained whole body plethysmographs we developed plethy. the plethy package is an r/sqlite based framework that enables the storage and retrieval of subsets of whole body plethysmography data for visualization and analysis. in addition, other measures that can be exported in a similar format, such as metabolic parameters, can also be utilized.

implementation
program design and data structures
the plethy package provides an infastructure for parsing, loading and querying plethysmography data utilizing sqlite databases. currently, we provide parsing code designed to handle files exported from the finepointe software suite bundled with the buxco whole body plethysmographer. an example of such a file is given as part of the example data  available at the github repository https://github.com/dbottomly/plethydata. these files are read into memory all at once or in chunks and loaded into an sqlite database. the user can control the number of lines read in at a given time. although this can be useful for limiting the memory consumption of the program at the expense of runtime, there is a limit to its benefit as the data for several entire file sections are currently held in memory at a given time.

the use of sqlite provides several benefits in terms of simplicity and portability. these databases can be easily transfered amongst collaborators as stand alone files or as part of an encapsulating r package . this paradigm is one that has been utilized successfully by the bioconductor project for distributing annotations  <cit> . in addition, the data contained within the database can be queried using sqlite’s own client or through drivers for most programming languages including r. the current schema for these databases is provided in additional file  <dig> 

the resulting database can be accessed conveniently through an s <dig> object oriented interface where a buxcodb object can be created and accessed through several defined methods. a listing of the available methods is provided in additional file  <dig> 

retrieving data for analysis is done most conveniently through the retrievedata method. this method without any arguments will retrieve all the data and return it in a data.frame. this can take a lot of memory and will be a little slower than specifying the data subsets the user is interested in. by passing in character or numeric variables as arguments to the method  smaller subsets of the data can be retrieved quickly and then be used for downstream statistical or graphical analysis. the form of the data.frame is described in table  <dig> description of the fields in the 
data.frame
 returned by 
retrievedata



column
description


multiple files can be imported to the database by simply running the parse.buxco function again and specifying the same database path. alternatively, data.frames generated by retrievedata can be used to create a new database or be merged in with an existing plethy database using the dbimport method. this allows plethy to be extensible enough to be used in a collaborative multi-lab setting where data sharing is essential. parsing and data retrieval is demonstrated in additional file  <dig> 

RESULTS
dataset
as a demonstration of the plethy package we used a plethysmography dataset derived from the longitudinal assessment of c57bl/6j mice after influenza , severe acute respiratory syndrome coronavirus  or mock infection . this dataset is available as an r package at https://github.com/dbottomly/plethydata. demonstration of these features and reproduction of the tables and figures is shown in additional file  <dig> and additional file  <dig>  as is described in the ‘parsing’ section of additional file  <dig>  the plethysmography files we work with are large and structured. previously sections of these files would be loaded and manipulated in excel by investigators, a process which was both tedious and error prone. the plethy package simplifies this process and enables efficient exploration and analysis of the data with only a handful of r functions. assuming the data has been loaded into a database and a buxcodb object exists, we can first perform qa/qc of the data followed by exploratory data analysis and model fitting.

quality control
currently our quality control procedures are centered around finding deviations from the expected number and duration of the measurements. for example, the expectation is that the flu, sars and mock infected animals were first allowed an acclimation period of  <dig> minutes in the chamber followed by  <dig> minutes of experimental readings. as shown in additional file  <dig>  these data can be labeled with their inferred run type  and these labels can then be checked for similarity to the experimental design. if deviations are detected, the data can be re-labeled, keeping the old labels for provenance. the plethy package comes with procedures to provide basic checks of the measurement timestamps. one such check is performed internally while parsing and loading the data. this check emits a warning if observed experimental time intervals are greater than a specified tolerance. similarly, the exact timepoint of an experiment can be computed from the measurement timestamps which are captured in the sqlite database. this enables automatic checking of the labeled experimental timepoint. in the case of the sars, flu and mock data, no such anomalies exist but we provide a simulated dataset where they do in the ‘quality control’ section in additional file  <dig>  these data can then be visualized using several built in methods as well as other visualization functionality in r.

visualization
visualization is key for plethysmography data as many measurements can be produced for each animal for each time point. this results in a very rich multivariate experimental dataset which is also potentially longitudinal in nature. as our main use case is the change in respiration measurements over time, we provide two key plotting methods for longitudinal data: tsplot and mvtsplot. arguably the most common way to visualize longitudinal data is using a simple line plot of the mean response per each animal and time point as is shown in figure  <dig> for the penh phenotype which can be produced using the tsplot method. additionally, the mvtsplot method produces an adaptation of the multivariate time series plot  <cit>  which combines a heatmap with boxplot-like summaries and a basic line plot to provide a detailed overview of a given experiment . note that as is shown in both figures  <dig> and  <dig>  one of the sars samples  appears to be anomalous compared to the others in terms of its penh measurements and bears a greater similarity to the mock samples.


interface to modeling utilities
the simplest approach to analyzing longitudinal data is to summarize the data as a single value for each animal and then perform a t-test or analysis of variance, termed a ‘summary measures’ analysis  <cit> . we provide a summarymeasures method which can compute a wide variety of summaries for each curve as demonstrated for animal ‘907_b_f’ below in table  <dig>  also as mentioned above, retrievedata can provide the user with a data.frame and similarly data can also be returned in matrix form using the retrievematrix method. importantly, either data.frames or matrices can serve as the input to almost all modelling functions in r. for example, we may be interested in assessing the effect of time and infection status on penh values. as shown in figures  <dig> and  <dig>  the penh response over time is non-linear showing a peak around day  <dig> for flu and  <dig> for sars followed by a decline to roughly the level shown by the mock infected animals. an initial model for this might involve infection status and polynomial terms for time. any such model should also account for the presence of many technical measurements for each sample. for the example code below we make the initial assumption that samples will differ only in terms of the intercept. assuming bux.db refers to a buxcodb object we can fit a cursory mixed effects model  <cit>   as:summary measures for animal ‘907_b_f’ for several buxco whole body plethysmography phenotypes



variable_name
time_to_max
max
auc
mean


as the goal of this section of the manuscript is only to highlight how plethy could be used in conjunction with other r packages we make no claims as to the efficacy of this particular model for a given analysis. as another example of utilizing the data retrieval functions to simplify analysis we can also perform classification. if more samples were accrued, we may also be interested in predicting flu, sars and mock status given measurements from mutliple plethysmography outputs. one approach to this could be the use of linear discriminant analysis  <cit> . this could be carried out as below by first summarizing each sample by the mean phenotype for a given informative day, say day  <dig>  and running a procedure similar to below to train our model:

the predictions and assements of this model could then be carried out using utilities provided in one of many r packages.

CONCLUSIONS
our software provides a convenient framework for storage and retrieval of whole body plethysmography data in r. currently we support import of data from the finepointe software of buxco, however the basic framework is amendable to data produced from other vendors. as the software is open source, such support can be requested via the bioconductor mailing list or contributed via the github site  for the project. r in conjunction with sqlite allows efficient exploration and summarization of the data. future releases of plethy will include additional built-in plotting and summarization tools.

availability and requirements
project name: plethyproject home page:http://www.bioconductor.org/packages/release/bioc/html/plethy.htmloperating system: platform independentprogramming language: rother requirements: r > <dig> . <dig>  plethy ≥  <dig> .10license: gpl-3any restrictions to use by non-academics: n/a

additional files
additional file  <dig> 
sweave pdf vignette demonstrating manuscript analyses. pdf demonstrating code from the plethy package including how to replicate the figures and tables using the example data.



additional file  <dig> 
the current database schema used by 
plethy. a png file depicting the tables and relationships utilized by the parsing and data retrieval functions of plethy.



additional file  <dig> 
table summarizing 
plethy’s
 api. a csv file listing the name, brief description and category of each of the currently defined functions/methods for plethy.



additional file  <dig> 
rnw file corresponding to additional file 
 <dig>  rnw file used to produce the additional file  <dig> pdf. the r code itself can be extracted using: r cmd stangle plethy_supp.rnw.



competing interests

the authors declare that they have no competing interests.

authors’ contributions

db wrote the program and manuscript with input from bw and skm. all authors have read and approved the final manuscript.

