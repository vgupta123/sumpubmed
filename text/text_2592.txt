BACKGROUND
metabolomics is a rapidly-growing field of "-omics" research concerned with the high-throughput comparison, identification and quantification of large numbers of metabolites in biological systems  <cit> . metabolomics only became possible as a result of recent technology breakthroughs in small molecule separation, identification and quantification. these include advances in ultra-sensitive, ultra-precise mass spectrometry , robotic, multi-dimensional nmr spectroscopy, and greatly improved hplc and uplc separation technologies  <cit> . while other techniques may be more sensitive or less expensive, nmr has emerged as an ideal platform for studying metabolites in biofluids. it is a rapid, highly precise, non-destructive, and quantitative technique that allows one to compare, identify and quantify a wide range of compounds without the need for prior compound separation or derivatization  <cit> . nmr is particularly amenable to compounds that are less tractable to gc-ms or lc-ms analysis, such as sugars, amines, volatile ketones and relatively non-reactive compounds. a key disadvantage of nmr is that it is a relatively insensitive technique, with a lower limit of detection of 1~ <dig> μm and a requirement of relatively large sample sizes .

currently, most nmr-based metabolomic studies involve the analysis of 1d 1h nmr spectra, although 1d 13c and 31p nmr spectra may also be analyzed  <cit> . there are generally two routes to analyzing nmr spectra for metabolomic studies. in one method , the compounds are not initially identified – only their spectral patterns and intensities are recorded and statistically compared in order to identify the relevant spectral features that distinguish sample classes. once these features have been located, a variety of approaches may then be used to identify the corresponding metabolites  <cit> . in the other approach , compounds are first identified and quantified by comparing the nmr spectrum of the biofluid of interest to a spectral reference library obtained from pure compounds  <cit> . once these compounds are identified and quantified, the data can be analyzed in many different ways to identify the most relevant biomarkers or informative pathways.

a variety of protocols and software tools have been recently developed for conducting quantitative metabolomics via 1d 1h nmr  <cit> . in most cases, a manual peak-fitting process is required in order to perform compound identification and quantification. however, this manual fitting process can become particularly difficult and prone to frequent errors, especially for very complex biofluid mixtures  due to severe spectral overlap. in contrast to 1d nmr, 2d nmr offers a robust approach to resolving excessively overlapped spectra. indeed 2d  nmr has long been used to resolve and identify individual resonances from large macromolecules such as dna, rna and proteins. 2d nmr experiments such as tocsy, hsqc and j-resolved spectroscopy are also increasingly being used in metabolomic studies in order to resolve spectral ambiguities to aid in the identification of specific compounds in complex biofluid mixtures  <cit> .

a number of small-molecule nmr databases have been developed in recent years to support metabolomics research, including the human metabolome database   <cit> , the biomagresbank database   <cit> , the madison metabolomics consortium database   <cit> , the magnetic resonance metabolomics database   <cit> , and the platform for riken metabolomics . these resources, which contain significant numbers of reference nmr spectra of metabolites, also support metabolite identification through web-based submission of 1d and 2d nmr peak lists. however, these on-line tools don't generally provide graphical support for peak filtering, processing, comparative display or annotation. furthermore, they don't exploit additional constraints such as knowledge about biofluid composition or metabolite concentration ranges to make compound identification even more robust, more accurate, and more efficient. we propose that by using a comprehensive 2d spectral reference library along with a more detailed knowledge of metabolite compositions of different biofluids, it is possible to greatly improve compound identification from 2d nmr spectra. here we report our efforts in developing an easy-to-use, graphically-based, stand-alone software tool, called metabominer, to perform semi-automated metabolite identification from 2d tocsy and hsqc-spectra of complex biofluid mixtures.

methods
data collection and curation
key to the development of this software package was the creation of an extensive 2d spectral library containing tocsy and hsqc spectra of pure metabolites. we used several publicly available sources in constructing this library. the majority of the raw 1h-1h tocsy spectra were collected from the standard compound spectral library available at the bmrb database  <cit> . a few additional compound spectra were obtained from the mrmd  <cit> . the 1h-13c hsqc spectral library was downloaded from the hmdb  <cit> . these raw spectra contained a number of spectral artefacts . consequently it was necessary to convert these raw spectra into "synthetic" or "simplified" spectra corresponding to the peaks specific to the pure compounds of interest. this conversion was done manually, with each of these simplified, noise-free spectra being examined for inconsistencies by comparing them to the original raw spectra and the compound's known resonance assignments. in total, the metabominer tocsy reference library includes spectra from  <dig> common metabolites and the metabominer hsqc library contains spectra from  <dig> metabolites. the compounds in both libraries were further catalogued into three sub-libraries corresponding to the three common human biofluids – cerebrospinal fluid , plasma and urine. the classification was based on their respective metabolic compositions listed in the hmdb  <cit> . since the presence of these biofluid-specific metabolites was determined by a variety of technologies not limited to nmr, we further investigated the appearance of these metabolites in a large number of 1d 1h spectra collected from csf, plasma and urine. the combined collection of compounds  were used to create corresponding "common biofluid" 2d nmr spectral libraries that effectively represent a generic biofluid or cell extract. the "csf", "plasma", "urine", "biofluid" and "total" spectral libraries are stored as xml files and are editable via metabominer's graphical user interface .

after the spectral libraries were constructed, each peak for each compound in each library was assigned a series of uniqueness values that are specific for that reference library. a unique peak in metabominer is defined as a relatively isolated peak around which no peak from any other compound is observed based on the spectral library of the given biofluid. for any given peak, its uniqueness value is calculated as the total number of surrounding peaks from other compounds within a given chemical shift "distance". five distance levels were used to measure peak uniqueness. for 1h chemical shifts, the distance thresholds are  <dig> ,  <dig> ,  <dig> ,  <dig> , and  <dig>  ppm. for 13c chemical shifts, the distance thresholds are set at  <dig> ,  <dig> ,  <dig> ,  <dig> , and  <dig>  ppm. for instance, an hsqc peak with a series of assigned uniqueness values of 0-0-0-1- <dig> indicates that no peak from any other compound in the reference library is observed within  <dig>  ppm  and  <dig>  ppm  of that peak. it also indicates that one peak from another compound in the spectra library was observed within  <dig> ~ <dig>  ppm  and  <dig> ~ <dig>  ppm  and another peak from another compound was observed within  <dig> ~ <dig>  ppm  and  <dig> ~ <dig>  ppm . see figure  <dig> for a more complete description of the uniqueness value concept. these uniqueness values are automatically updated after any spectral library change using metabominer's graphical user interface.

peak processing, peak matching and compound identification
as part of its input, metabominer requires peak lists corresponding to the peaks that were identified in either the tocsy or hsqc spectra collected from the biofluid of interest. while it is possible for users to provide manually picked peak lists, metabominer also supports processing of multidimensional nmr peak lists obtained from automatic peak peaking programs. multidimensional nmr spectra typically contain substantial numbers of spectral artefacts such as baseline distortions, intense solvent lines, ridges, sinc wiggles, etc. automatic peak-picking programs tend to mistake these noise signals for real resonances. therefore, any raw 2d spectra collected from biofluids must be processed appropriately before attempting to match them to metabominer's reference spectral library. two automated procedures were found to be very effective in cleaning up raw 2d spectra: 1) streak removal and 2) symmetrical editing. note that the latter processing technique is only applicable for tocsy spectra. spectral streaks are usually caused by residual solvent signals  or the presence of other compounds at extremely high concentrations. streaks can be recognized by their specific locations and prominent shapes in the nmr spectra. streak removal was implemented by searching for groups of peaks at these common locations and eliminating them from the peak list. symmetrical editing exploits the fact that real tocsy peak signals form a symmetrical square pattern along the diagonal line. off-diagonal peaks without any corresponding symmetrical peaks can be considered to be artefacts. both peak positions and intensities  of the corresponding peaks are examined for symmetry. since tocsy cross peaks are frequently not of equal intensity we require that the intensity ratio between the upper and lower-diagonal peaks should be within a range of  <dig> ~ <dig>  of each other to be considered symmetrical.

in order to accommodate small chemical shift differences between the observed nmr spectra and the reference nmr spectra, an adaptive threshold method was implemented based on the uniqueness values  of each reference peak. during the peak searching/matching process, the search threshold varies automatically based on the maximum uniqueness value of the current peak. for instance, when searching for potential matches for a tocsy peak with uniqueness values of 0-0-0-0- <dig>  metabominer will automatically set its threshold to  <dig>  ppm. the peak matching and adaptive thresholding employ two processes: a reverse search strategy and a forward search strategy. in the reverse search strategy, the library peaks are searched and matched against the query peaks. typically most query peaks find their potential matches during this reverse search step. however there are usually some peaks left without any matches. in order to assign these unmatched peaks a forward search is performed in which the unmatched query peaks are searched against the reference library with expanded thresholds –  <dig>  ppm for tocsy and  <dig>  ppm  and  <dig>  ppm  for hsqc spectra. a match is identified if only a single reference peak is identified within this range.

in metabominer a compound is considered to be present only if its matched pattern satisfies the requirements of what we call "minimal signatures". a minimal signature is defined as the minimum peak set that can uniquely identify a compound from all others in a given spectral library. based on the complete peak set of the reference spectral library, many minimal signatures can be derived through different combinations of unique peaks. a single peak match may be considered a minimal signature if it is completely unique. more peaks are required to define a minimal signature for less unique ones. for instance, in our current implementation, the presence of a single peak with uniqueness values 0-0-0-0-x  will determine the presence of the corresponding compound ; while at least two peaks with uniqueness values 0-0-0-x-x are required to reach the decision.

since query spectra  usually contain substantial levels of spectral noise, even after pre-processing, we found that we could reduce metabominer's false positive rate even further by implementing several authenticity checks. these include: 1) having a minimum number of matched peaks , 2) having a minimum matched fraction of peaks , 3) ensuring the presence of certain peaks for certain compounds , and 4) ensuring that the identified compounds were known to be in a given biofluid.

user interface description
metabominer's graphical user interface was implemented using java swing technology. the spectral visualization and manipulation tools were built using the jgraph library . figure  <dig> illustrates a flowchart describing the metabominer gui. there are four main functional views, 1) a processing view, 2) a search view, 3) an annotation view, and 4) a library view. all these views share the same component arrangement, with panels on the right side being used for visualizing and manipulating peaks, and the panels on the left being used for displaying parameters, compound lists, structure images, etc. navigation to each view is readily accessible by clicking an appropriate menu item.

when the program launches, the default view is the "processing view" where users can copy and paste the automatically picked peak list. the input format must be either a two or three-column list, with numbers separated by a space or a semicolon. the first two columns must be the x and y chemical shift coordinates of each peak in the 2d spectrum and the optional third column must be the peak height or peak intensity. after processing the raw peaks, both the original and the processed spectra will be displayed on metabominer's spectral viewing panel . with this viewing panel, users can directly edit peaks on the spectrum if necessary. for manually picked peaks, this step can be skipped by turning the processing options off. by clicking the "search" button, metabominer's "search view" will be displayed with its initial, automated compound identification results. users can adjust the search threshold or switch the reference library to further refine the result. a compound is marked as identified if the matched pattern passes the authenticity checks and satisfies the minimum signature requirement. the raw matched scores are also displayed. metabominer's interface allows users to visually inspect the matched peaks of any metabolite against the corresponding reference spectrum. by right clicking any peak displayed on the spectrum, users can search the library for this particular peak. the identified compound list can be saved in three different formats by clicking the "export" button. a screenshot of metabominer's "search view" is shown in figure  <dig> 

users can further refine the automated search results by manually annotating the raw 2d spectrum. by clicking the "refine" button in the "search view", the "annotation view" will be launched with the identified compounds being transferred as the starting point. users can also directly enter the "annotation view" mode by clicking the "annotate" button from the "console" menu. in order to perform manual annotation, users first need to load a high resolution spectral image in png format and set up the spectral axes properly. peak searching is performed by right clicking the peak position on the spectrum to search the reference library as shown in figure  <dig>  all compounds that generate peaks within the search threshold will be checked. the compound with the closest peak match will be highlighted with its database reference spectrum displayed on the uploaded "raw" spectrum. users can perform peak annotation for any currently displayed compound. double clicking any database peak will open a small text editor where users can enter the peak assignment or a comment. the peak pattern of the identified compounds can also be edited to match the experimental spectrum. for example, users can insert, delete, or drag a database peak to match the observed peak in the raw spectrum. these changes will be valid only for the current session. to make permanent changes, metabominer's "library view" must be used.

the "library view" is intended for browsing and managing metabominer's spectral libraries. to view all the available reference spectra in metabominer's libraries, users must click the "browse" button in the "library" menu. double clicking any compound in the compound list will open a popup window for peak editing. any changes will be reflected on the spectrum at real time. new compounds can be introduced by clicking the "new" button at the bottom of the compound list. a new compound can be either exported from another library or be created from scratch through the wizard dialog. both peak editing or adding new compounds will trigger updating of the uniqueness values of the affected peaks. for researchers who study other types of biological samples , they may either use metabominer's generic spectral reference library or create a new library customized for that particular type of biofluid. library creation or deletion can be easily accomplished by clicking the appropriate menu items in the "library" menu. the compounds in the default reference library are linked to pubchem, hmdb  <cit> , and the bmrb  <cit>  via the hyperlink under their structure icon. the "graphics" menu enables users to change the size, shape, or color of the synthetic peaks to suit their preferences.

it is important to note that metabominer does not support spectral processing such as phasing, baseline correction or chemical shift referencing. there are many other high-quality nmr-processing software available for this task, including nmrpipe  <cit> , felix , vnmr , and xwinnmr , to name a few. these tools should be used prior to loading spectral images into metabominer. in other words, metabominer is not a spectral processing tool, but a nmr-based metabolomics tool that facilitates automatic peak processing, rapid compound identification, and facile spectrum annotation capabilities through an intuitive graphical interface. metabominer is available at: 

evaluation protocol
metabominer was assessed in a variety of ways using both synthetic and experimental nmr spectra. the synthetic spectra were generated from the  <dig> compounds that have both tocsy and hsqc spectra in the reference library. the experimental spectra were collected from three defined compound mixtures  and a biofluid sample of known composition . these evaluations allowed a complete and comprehensive assessment of metabominer's performance as well as its potential strengths and limitations.

the effects of different types of spectral noise on compound identification
the performance of the minimal signature method and the adaptive threshold method were evaluated under two common types of spectral noise – missing peaks and "drifting" peaks . the missing peaks were simulated by deleting peaks of each compound at random with 0%, 10%, 20%, 30%, 40%, 50% probabilities. the chemical shift drift effects were simulated by adding random values of ±  <dig> , ±  <dig> , ±  <dig> , ±  <dig> , ±  <dig>  ppm for each 1h chemical shift, and ±  <dig> , ±  <dig> , ±  <dig> , ±  <dig> , ±  <dig>  ppm for each 13c chemical shift. the spectra of each synthetic query mixture were generated by first pooling the peaks from  <dig> compounds that were randomly selected from the metabominer reference spectral library . after introducing this artificial spectral noise, the query mixtures were searched against the reference spectral library with and without using the adaptive threshold method. two compound identification strategies were compared – the minimal signature method  and the percentage match method  with 75% as the cut-off value. the f-measure was used for performance evaluation, where f =  <dig> × / where recall is the proportion of true positives in the returned result ) and precision is a measure of the percentage of positive or correct results ). the values were obtained as the averages of tocsy and hsqc search results over  <dig> iterations. figure 5a summarizes metabominer's performance using data with different fractions of missing peaks. figure 5b shows the results using data with increasing chemical shift drift effects.

the effects of different spectral data types on compound identification
we further investigated the usefulness of different nmr data types for compound identification based on our concept of a minimal spectral signature. four nmr data types were compared – 1d 1h, 1d 13c, 1h tocsy, and 1h-13c hsqc spectra. for this particular evaluation, reference 1d 1h and 1d 13c spectra were obtained from the corresponding 1h and 13c chemical shifts of metabominer's hsqc spectral library. for a small number of compounds, these artificial 1d spectra lacked some of the expected 1h or 13c signals that might be seen in a real 1d nmr spectrum, but their absence also helped to simulate the fact that some peaks in 1d nmr spectra are broadened or washed out due to signal overlap or solvent suppression.

synthetic 2d nmr spectra  representing different biofluids of increasing molecular complexity were generated by pooling peaks of  <dig>   <dig>   <dig>   <dig>   <dig>   <dig>  and  <dig> compounds randomly selected from metabominer's reference spectral library. to further simulate noise or ph/salt effects, 10% of the peaks from the query spectra were deleted at random, followed by the introduction of random chemical shift changes  to the remaining peaks. the resulting peaks were subsequently searched against metabominer's reference spectral library using the adaptive threshold method. the f measures were averaged over  <dig> iterations. the result is summarized in figure  <dig> 

compound identification using experimental spectra
twelve 2d nmr experiments  were collected under different ph conditions using three synthetic mixtures and a plasma sample. the three synthetic mixtures were composed of  <dig>   <dig>  and  <dig> common metabolites, respectively, with concentrations ranging from  <dig> to  <dig> mm. the plasma sample contained  <dig> identifiable metabolites  as determined by independent profiling of its 1d 1h nmr spectra by several experienced individuals using chenomx's nmr suite software  <cit> . these results were further confirmed by spiking/doping authentic standards into the plasma sample and by gc-ms analysis. the plasma sample was prepared by filtering the sample through a  <dig> kda filter , then lyophilizing and finally dissolving the remaining solids in distilled water to its 1/ <dig> original volume. deuterium oxide  was added to make a final concentration of 90% h2o and 10% d2o. all spectra were acquired at 25°c. six spectra were collected on a varian inova  <dig> mhz spectrometer equipped with a  <dig> mm triple axis gradient cryoprobe. the other six spectra were collected on a varian inova  <dig> mhz spectrometer with a  <dig> mm triple-resonance z-gradient probe. the tocsy experiments were performed using the wgtocsy pulse sequence, and the hsqc experiments were performed using the gchsqc pulse sequence, both provided by varian's biopack. for the tocsy experiments, the spectral width was set to  <dig> hz and a mixing time of  <dig> milliseconds. sixteen transients were collected for each of  <dig> t <dig> intervals using an acquisition time of  <dig>  seconds and a relaxation delay of  <dig>  seconds. the total acqisition time for the tocsy spectra was  <dig>  hours for the 13c-hsqc experiments, the spectral widths of the proton and carbon dimensions were  <dig> hz and  <dig> hz respectively. sixty four transients were acquired for each t <dig> interval using an acquisition time of  <dig>  seconds and a relaxation delay of  <dig>  seconds. the spectra were collected with 2048* <dig> complex points for the 1h and 13c dimensions respectively. the total spectral acquisition time for the hsqc spectra was  <dig> hours. sample tocsy and hsqc spectra are available .

the raw nmr spectra were first processed using nmrpipe  <cit>  and the peaks were subsequently picked using sparky's  <cit>  automatic peak picking program. the resulting "raw" peak lists were copied and pasted to the processing view of metabominer. both peak processing and compound identification were performed using metabominer's default parameter sets. the reference library used for the synthetic mixtures was the biofluid  library. for plasma data, the plasma  library was used. to assess the degradation in performance assuming no prior knowledge of the sample source  the complete spectral reference library  was also used to identify compounds. to assess the performance of the web-servers that support 2d nmr mixture analysis – the hmdb  <cit> , the mmcd  <cit> , the bmrb  <cit> , and the spinassign  <cit>  of prime  – the same set of peak lists were submitted. for prime, the default search parameters were used. for other web services, the search threshold for 1h was set to  <dig>  ppm and  <dig>  ppm for 13c. the results are summarized in tables  <dig> and  <dig> 

samples a, b, and c are synthetic cocktail mixtures and sample d is a plasma sample.

.

samples a, b, and c are synthetic cocktail mixtures and sample d is a plasma sample.

.

RESULTS
using synthetic query spectra constructed as described previously, the performance characteristics of metabominer were first assessed under different levels of spectral noise. secondly, the utility of different nmr data types were also investigated for our approach of compound identification. finally, we evaluated metabominer's performance using a total of  <dig> real nmr spectra collected from defined compound mixtures and a plasma sample of known composition.

after creating the spectral reference libraries and calculating the uniqueness values for each peak, we first investigated the performance of the minimal signature  method versus the adaptive threshold method under different types of spectral noise. as an additional comparison, the percentage match  method was also included. as shown in figure  <dig>  the ms method performed consistently better than the pm method when missing peak and chemical shift variations are present. the adaptive threshold method appears to be most effective for data exhibiting large chemical shift variations. when chemical shift variation is negligible, as in the test with missing peak data, this method performs exactly the same as the fixed threshold method.

the utility of different nmr data types was also investigated using synthetic spectra of increasing complexity. as illustrated in figure  <dig>  hsqc, tocsy and 13c-based methods worked very well over the full range of compound mixtures. the number of compounds in the query mixture has very little effect on their overall performance. the slight increases in f scores with increasing spectral complexity are not statistically significant. in general, metabominer's performance for compound identification was best using the hsqc dataset. it is also apparent that the minimal signature method favours compound identification with hsqc spectra as these spectra tend to have more unique peaks than other types of nmr spectra. also evident from figure  <dig> is the fact that metabominer's performance using 1d 1h data, alone, is the poorest. in contrast to the 1h spectra , it is quite clear that 13c chemical shifts  can provide sufficient information for robust compound identification. this is mainly due to the much wider chemical shift dispersion  seen in 13c spectra compared to 1h spectra. most 13c chemical shifts remain unique even in mixtures of  <dig> compounds.

while 13c spectra  provide excellent data sets for compound identification we found that by focusing on off-diagonal peaks originating from the coupling between pairs of protons, the utility of tocsy spectra could be greatly improved. as indicated in figure  <dig>  metabominer's metabolite identification performance based on tocsy spectra was better than that based on 1d 13c spectra and was only slightly outperformed by 13c hsqc data. these results underscore the utility of using 2d spectra in nmr-based compound identification of complex  mixtures.

we also assessed metabominer's performance on its own and against several other web services using eight experimental nmr spectra collected from four different mixtures of known composition. as indicated in tables  <dig> and  <dig>  the best performance for metabominer was obtained when a biofluid-specific reference library was used to analyze tocsy or hsqc data. on average, metabominer was able to correctly identify  an average of 81% of the compounds from both tocsy and hsqc data. when the entire spectral library  was used, the performance  decreased by an average of 15%. among the four web services evaluated using the same data , the spinassign program performs the best  but this is still about 30% worse than metabominer when it uses a biofluid-specific library and 15% worse than metabominer when it uses its entire spectral library. overall, the other web servers did not perform particularly well with average f-measures of 15–25% for hsqc data and 6–12% for tocsy data. both the hmdb and mmcd servers performed better when analyzing hsqc data than tocsy data. the performance for all web servers was essentially the same regardless of whether "clean" peak lists  or "raw" peak lists were used as input. note that tocsy mixture analysis is not currently supported by either prime or bmrb.

in an effort to understand the influence of ph on the efficacy of compound identification by 2d nmr, we also collected tocsy and hsqc data at ph  <dig>  and ph  <dig> . this is approximately  <dig> ph units below  the ph at which the spectral library standards were collected. as seen in table  <dig>  a significant ph change in the sample  can negatively impact the performance of compound identification. for instance, at ph  <dig> , the f-measure drops by more than 20% for the hsqc spectra.

tests were performed using biofluid-specific library.

discussion
in this paper, we described the development and assessment of a software tool  to facilitate compound identification from 2d nmr spectra of biofluids or small molecule mixtures. we first created a series of "clean" spectral reference libraries based on publicly available spectral databases. secondly we developed and tested several algorithms to facilitate robust and automatic peak processing, peak matching and compound identification. finally, we integrated these resources into an easy-to-use application and evaluated its performance using a variety of synthetic and real spectra.

metabominer's spectral reference library covers most nmr-detectable metabolites present in human biofluids  <cit> . to improve the reliability of the compound identification, the larger spectral library was further partitioned into three smaller libraries based on the composition of different biofluids . in addition, we also created "common" libraries for each type of biofluid that contain the most common or abundant metabolites found in these biofluids . we found that the creation of biofluid-specific libraries significantly improved compound identification by reducing the spectral search space. as indicated in tables  <dig> and  <dig>  a 15% reduction in metabominer's performance occurred if the entire compound library was used instead of the biofluid-specific "common" library. for researchers who wish to study other types of biofluids, metabominer provides intuitive interfaces that allow users to easily expand and customize their spectral reference libraries.

performance assessment
the performance of metabominer was evaluated using a variety of synthetic and experimental datasets. in all cases, our strategies for peak matching and compound identification showed robust performance under various noise  conditions. using synthetic data, the best compound identification performance was ~90%  under moderate noise levels as indicated by figure  <dig>  further inspection of the compound identification lists showed that the most common problem was the identification of false positives. in particular, for certain compounds it is inherently difficult to uniquely identify them by nmr based on their matched peaks. for example, the tocsy peaks of citrate and serine cluster very tightly around the diagonal. they also overlap with peaks of other more abundant compound species. as a result, they are often misidentified. another source of false positives comes from the existence of structurally similar compounds such as asparagine/aspartate, inosine/adenosine, or creatine/creatinine, which have nearly identical nmr spectral features.

when we assessed the performance of metabominer using experimentally collected data, the performance was reduced by ~10% for both tocsy and hsqc data. close examination of the lists of identified compounds as well as the spectra used in the evaluation indicated two sources of problems . the first relates to the fact that several compounds known to be in the mixtures failed to be identified . manual inspection of the actual spectra  indicated that in every case, no peaks or very weak peaks were visible for these compounds. these compounds were obviously below the detection threshold of the instrument. the second problem was the existence of several false positives. again, manual inspection of the spectra showed that the false positives were mainly caused by spectral artefacts. real spectra  can contain a significant amount of spectral noise. in the case of tocsy spectra, most of the automatically picked peaks  are from these artefacts. obviously if cleaner spectra could be collected or if more manual intervention was used to eliminate some of the spectral artefacts prior to submitting the data to metabominer, a better performance could be achieved. in addition, we also observed that some compounds are exquisitely sensitive to small ph variations such as lactate, uracil and histidine.

peak uniqueness and the challenges in automated compound identification
there are three major challenges facing automatic compound identification for nmr-based metabolomics. the most common and perhaps the most vexing is the so-called spectral overlap problem. the spectral complexity inherent in many biofluids can lead to a large number of peaks confined to a relatively narrow chemical shift range . with the increased availability of high-field nmr spectrometers, the problem of spectral overlap is diminished somewhat for simple biofluids such as csf. however, for complex mixtures like plasma, urine, or tissue extracts, the problem is still quite severe. the second challenge in automated compound identification is the handling of chemical shift changes induced by the variation of ph, temperature, ionic strength, etc. this effect combined with the first issue makes it difficult to perform automated compound identification based solely on chemical shifts. the third challenge in automated compound identification is the low signal-to-noise  ratio for the nmr resonances of low abundance compound species. consequently, the wide range of metabolite concentrations found in many biofluids poses a serious problem for most automatic peak-picking programs. in particular, many low intensities peaks are likely to be missed by most peak picking programs.

to address these challenges we introduced the notion of "uniqueness" in the reference library in order to deal with the problem of missing peaks and chemical shift variations. the uniqueness values were calculated for every peak based on their relative distances to each other in a given reference library. although a finer scale may perform better for more complex mixtures, we found that the use of five levels of uniqueness works well for most situations. in metabominer, both peak matching and compound identification rely heavily on these uniqueness values. during peak matching, an adaptive threshold method was used to adjust the current search threshold to its maximum uniqueness scope. this approach significantly improves metabominer's performance when chemical shift variations are nontrivial. by using an adaptive threshold method we found the effect of chemical shift changes or chemical shift drift could be tolerated to a greater extent. these uniqueness values also allow us to derive minimal signatures based on a relatively small portion of unique peaks. this approach turned out to be both robust and flexible since it did not require "stable" spectral patterns. in contrast, the common percentage match  method weights each peak equally and uses a fixed threshold for compound identification. this approach suffers greatly if a nontrivial proportion of peaks are not matched. note that the minimal signature method in metabominer is complemented by authenticity checks with due consideration of the total matched patterns.

it should be noted that the performance of metabominer strongly depends on the quality of the upstream spectral collection and processing work. as a general rule, for optimal performance, the nmr experiments on biofluid mixtures should be carried out under the same  conditions as the conditions used to collect the spectra for the reference library . the automatic peak-picking process should be closely monitored and an iterative approach is recommended in order to pick up most signals while avoiding obvious spectral noise. in our testing process, a typical tocsy spectrum usually generated  <dig> ~ <dig>  peaks with a high proportion of noise peaks. we found that these noisy signals were handled quite efficiently by metabominer. as a general rule, we would suggest that users employ a low threshold during the peak picking stage for tocsy spectra. for hsqc spectra, because of the difficulty associated with detecting and removing noisy signals, we would suggest more manual intervention during the peak picking process.

comparison to other spectral analysis software tools
there are several commercial software tools available for analysing complex metabolite mixtures using nmr. chenomx inc. has developed a commercial bioprofiling software package called the chenomx nmr suite that allows semi-automated identification of compounds from 1d 1h nmr spectra. the chenomx software package provides an excellent interface for compound identification and quantification via a manual peak-fitting process using a spectra reference library containing  <dig> compounds  <cit> . however, the requirement for manual fitting and analysis leaves the process open to inconsistent interpretation or inconsistent assignment by different individuals. furthermore, the analysis can take upwards of one hour per sample and the software is relatively expensive. bruker's amix  software is another powerful tool that offers support for compound identification and quantification for 1d and 2d nmr as well as lc-ms spectra. it used a method called autodrop to facilitate compound identification and structure verification  <cit> . the key idea is the systematic decomposition of reference spectra into spectral patterns of molecular fragments. compound identification is based on recognition of such patterns in the target spectra. however, similar limitations pertaining to cost, the reliance on manual analysis, processing time and inconsistent interpretation appear to apply to amix as well.

in addition to these commercial packages there is at least one other non-commercial system that has been described. xi et. al  <cit>  developed a statistical and chemical model for automatically identifying compounds in mixtures using 2d cosy spectra. like metabominer, the chenomx nmr suite and amix, xi et al's method uses a library of pre-collected nmr spectra to assist with compound identification. these authors reported experimental results using spectra collected from abalone muscle and digestive gland extracts. their method was able to identify  <dig> out of  <dig> amino acids and  <dig> out of  <dig> amino acids as determined with chenomx's nmr suite. however, it appears that this system has a spectral library of only  <dig> cosy spectra, so it is very limited in terms of practical applications.

in addition to these stand-alone, graphically based software packages, several metabolomics database websites, including the hmdb  <cit> , mmcd  <cit> , bmrb  <cit> , and prime now allow direct querying of their databases using peak lists obtained from compound mixtures. however, as web servers they are somewhat limited in their graphic capabilities and user-interface interactions. in particular, most of these sites typically return long lists of potentially matched compounds without a graphic display of the matched spectra to help users make their decisions. further, most of the servers appear to be designed to handle single compound or simple mixture queries and are not optimized for compound identification from complex biofluid mixtures. this is particularly evident from the results shown in tables  <dig> and  <dig>  the modest performance for the mmcd and bmrb servers with regard to their handling of hsqc spectra may be partially due to the ph and solvent differences between the query spectra and their internal reference spectra , however these ph differences are relatively small and should not have affected the identification of most compounds. furthermore, the fact that the same level of performance was seen with tocsy queries where metabominer, bmrb and mmcd used the same set of reference spectra and had the same ph mistmatch suggests that the performance differences are likely related to algorithmic robustness. likewise the relatively good performance of the prime server is likely due to the fact that it only contains spectra for  <dig> common compounds. this significantly reduces the number of false positives and somewhat inflates its overall performance.

overall, metabominer combines many of the useful interactive graphic features and high levels of performance of the stand-alone commercial packages such as bruker's amix and chenomx's nmr suite with the relatively simple automation or semi-automation seen with nmr-based metabolomics web servers. key to metabominer's success are its large and carefully constructed spectral libraries, its robust spectral filtering and peak matching routines, and its use of biofluid-specific spectral libraries to rationally limit the spectral search space. given the extensive testing and the availability of many built-in tools for spectral manipulation, viewing and annotation we believe metabominer is well designed and ready for practical metabolomics applications.

limitations
metabominer is not without its limitations. in particular, metabominer does not support compound quantification. efforts are underway to add this functionality to the program but it appears that quantification via 2d nmr spectra is intrinsically more difficult and less reliable than with 1d nmr spectra. lewis et al.  <cit>  recently described a quantification method for hsqc spectra using standard curves calibrated to unique or selected peaks of a given compound. quantification by tocsy still remains difficult because the magnetization transfer functions for complex spin systems can differ greatly between metabolites. this can lead to widely different peak intensities. another limitation to metabominer  is the fact that metabominer's performance is highly dependent on the spectral quality and spectral pre-processing of the query  spectra. high signal-to-noise, good phasing, minimal baseline distortion and the elimination of spectral artefacts will always improve the performance. however, some biofluid samples may be refractory to good spectral processing or some users may lack sufficient experience/skill to properly process their spectra. under these circumstances, metabominer's results may prove to be unreliable or non-reproducible. overall, the performance for metabominer  degrades as the signal-to-noise ratio for the peaks of any given compound drops below 3: <dig>  the lower limit of detection on our  <dig> mhz instrument for tocsy data was about  <dig> mm and about  <dig> mm for hsqc data. a third limitation to metabominer is its limited sensitivity. in particular, metabominer's exclusive reliance on 2d nmr spectra generally reduces its sensitivity limit by a factor of ~ <dig> over what might be detected via 1d spectrum. obviously the use of more concentrated samples, longer collection times or isotopic labelled samples can overcome these problems, but the trade-off between time, cost and convenience may not always be in metabominer's favour. it is worth noting that methods such as asap hmqc  <cit>  now allow very rapid acquisition of 2d nmr data. this may make the issues of sensitivity and time much less important, particularly for 2d heteronuclear experiments. a fourth limitation is that fact that metabominer's spectral libraries  are still missing a number of important compounds. efforts are underway to expand the tocsy library over the coming months and the metabominer website will provide periodic reference spectral updates. alternately, users are invited  to add their own spectra to metabominer's reference libraries. finally, unlike chenomx's nmr suite and bruker's amix, metabominer's spectral libraries do not cover a broad range of ph values. as a result, metabominer is largely restricted to analyzing spectra from biofluids or metabolite mixtures that are titrated to ph  <dig>  +/-  <dig> .

CONCLUSIONS
in this paper we have demonstrated that by utilizing the extra information found in 2d nmr spectra as well as prior knowledge about the composition of the biofluid itself, it is possible to semi-automatically identify a significant number of compounds in complex aqueous mixtures  with excellent  accuracy. in particular, the quality and degree of metabolite identification achieved by metabominer certainly matches that of what a skilled nmr spectroscopist could do – but in significantly less time. overall, we have shown that by using a comprehensive reference library coupled with robust algorithms for peak processing, peak matching and compound identification, the process of metabolite identification from 2d nmr spectra can be greatly simplified.

availability and requirements
project name: metabominer

project home page: 

operating system: platform independent

programming language: java

other requirements: java  <dig>  or higher

license: gpl

abbreviations
csf: cerebrospinal fluid; dss:  <dig>  2-dimethyl-2-silapentane-5-sulfonic acid; gui: graphic user interface; hplc: high performance liquid chromatography; hsqc: heteronuclear single quantum correlation spectroscopy; ms: mass spectrometry; nmr: nuclear magnetic resonance; png: portable network graphics; ppm: parts per million; tocsy: total correlation spectroscopy; tsp: trimethylsilyl- <dig>   <dig>   <dig>  3-tetradeuteropropionic acid; uplc: ultra-high performance liquid chromatography; gc-ms: gas chromatography mass spectrometry; lc-ms: liquid chromatography mass spectrometry.

authors' contributions
jx carried out the software design, implementation, and drafted the manuscript. tb participated in generating 2d experimental data. pt participated in the implementation of the user interfaces and evaluated the software. dsw conceived of the study, participated in the creation of spectral library and implementation of search algorithm, edited the manuscript and reviewed the software. all authors read and approved the manuscript.

supplementary material
additional file 1
supplemental figure 1

click here for file

 additional file 2
synthetic mixture information

click here for file

 additional file 3
supplemental figure 2

click here for file

 acknowledgements
we would like to thank the canadian national high field nmr centre  for their assistance and use of the facilities. we also wish to thank the reviewers for their helpful comments on improving this paper. the project is supported by the alberta ingenuity fund, alberta advanced education and technology and by genome alberta.
