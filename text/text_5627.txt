BACKGROUND
t cells are a key component of the adaptive immune system, targeting infected or altered cells, such as cancerous cells. cell targeting is a consequence of recognition of processed peptides displayed on the cell surface. processed peptides are derived from antigens, presented by the major histocompatibility complex on target cells which in turn are recognized by the t cell receptor  on the surface of t cells  <cit> . in the context of cancer, antigens range from aberrantly expressed self-antigens to mutated self-antigens   <cit> . because of the enormous breadth of epitopes recognized by tcrs, the t cell repertoire is extremely diverse and dynamic. diversity of the tcr is generated through somatic recombination during t cell differentiation in the thymus. recombination of the variable , diversity  and joining  antigen receptor segments, as well as stochastic nucleotide addition and deletions, in the tcr generate a hypervariable complementary determining region  <dig>  – the portion of the tcr that mediates the specificity of peptide recognition .

the human immune system contains > <dig> different t cells and measuring responses to immunotherapy by bulk biological analysis methods  cannot sample enough t cells to characterize immunotherapy driven changes at the individual t cell clone level. the emergence of technologies such as next-generation sequencing  has allowed researchers to sequence across the variable region, which can be used as an identifier for t cell clonotypes. this allows researchers to track, and quantify, individual clonotypes across time as well as among different biological compartments such as circulating peripheral blood and intra-tumoral tissue  <cit>  at a finer level than traditional assays such as flow cytometry  <cit> . this novel technology has recently been utilized to shed insight into the effects of immunotherapies such as anti-ctla <dig> and anti-pd <dig> on anti-tumoral immunity and survival  <cit> . it has also been leveraged to understand the heterogeneity of tumor infiltrating t cells and holds potential to be a prognostic biomarker  <cit> .

current approaches to understand the t cell repertoire diversity involve quantitating the number of unique clonotypes detected or utilizing ecological diversity indices such as the shannon index  <cit>  and clonality  <cit> . the shannon index and clonality have been used to show that a more restricted t cell repertoire correlates with clinical response to pembrolizumab treatment in melanoma subjects  <cit> . recently, cha et al. have utilized the morisita’s distance to assess the dynamics of the t cell repertoire and showed that repeated doses of anti-ctla <dig> in melanoma and prostate cancer patients continued to remodel the t cell repertoire  <cit> . however, most literatures on tcr sequencing focus on the top ranked clones or the clones with larger abundance. here, we proposed a “3d” analysis pipeline that was designed for assessing diversity of the t-cell repertoire at a single time point, evaluating dynamics of tcr sequencing across the time course or among different biological compartments, and performing differential testing to detect the clonotypes whose abundance significantly changed among evaluated time points . we used the published data of an open-label, phase ii clinical trial of neoadjuvant sipuleucel-t  <cit>  and a phase i/ii clinical trial of ipilimumab with a fixed dose of gm-csf to metastatic castration resistant prostate cancer patients  <cit>  as the two test cases. besides a detailed description of each measurement, we also examined the robustness of diversity/dynamics indices and compared their performance over the various thresholds used to filter the sequencing data. we then recommended major matrices for sample size calculation in a study where the diversity of t cell repertoire was one of the major endpoints. we further investigated the assessment of dynamic changes among different biological compartments by accounting for their presence or absence in each compartment assessed. such an analysis pipeline will provide an initial workflow for tcr sequencing data with serial time points and/or in multiple compartments in a clinical context.fig.  <dig> 
a the “3d” analysis pipeline of next-generation sequencing based tcr repertoire data. it consists of assessing the diversity of the t-cell repertoire, evaluating the dynamics of t-cell clonotypes across the time course or among different biological compartments, performing differential testing to investigate differences in the abundance of each clonotype between pre- and post-treatment. b the count distribution of unique tcr clonotypes of a healthy subject . using one of the healthy subjects for illustration, the x-axis represents each unique clonotype in descending order of the count, and the y-axis is log <dig> of each clonotype from pbmc at week  <dig> , week  <dig>  and week <dig> . c the count distribution of unique tcr clonotypes of a treated prostate cancer subject 




methods
throughout this paper we define a sample as tcr sequencing data from a single biological sample of a subject at a particular time point. all the analyses were performed by r, the statistical computing software  <cit> . statistical significance was declared at p <  <dig> . unless noted, there were no multiple testing adjustments performed. a typical tcr dataset for a single sample contains raw read count f
i and count frequency p
i for each clonotype, where p
i = f
i/∑l=1n
f
l. after preprocessing the raw sequencing data, for each sample, we first calculated the number of unique clones  and read depth f = ∑i=1n
f
i, which is the measure of the total count of tcr sequences.

determination of tcr sequence diversity
we first characterized the diversity of clonotypes of each sample by using renyi diversity of order a: ha=11−aloge∑i=1npia, where p
i is the frequency of clonotype i for the sample with n unique clonotypes, and the corresponding hill number is n
a = exp  <cit> . as stated in  <cit> , many common diversity indices are special cases of hill numbers: n
0 = n, n
1 = exp, n
2 = d
 <dig>  and n
∞ = 1/max, where shannonindexh=−∑i=1npilogepiginisimpsond1=1−∑i=1npi2inversesimpsond2=1∑i=1npi <dig> 


the shannon index is a diversity index scaled from  <dig> to  <dig>  minimally diverse to maximally diverse respectively. h/loge is pielou’s evenness , and clonality=1−h/logen, which can be considered as a normalized shannon index over the number of unique clones. both shannon index and clonality are the most popular indices currently used to assess t cell repertoire diversity. we can regard a sample more diverse if all of its renyi diversities are higher than in another samples.

we also considered coefficient of variation , known as relative standard deviation, to assess the tcr diversity. it is a standardized measure of dispersion of a probability distribution or frequency distribution and was first used to assess the tcr diversity in dziubianau et al.  <cit> . since the frequency distribution of the tcr sequence was skewed to small frequencies , we considered logarithm transformation with base  <dig> of clonotypes’ frequency, i.e., log
10
p
i, therefore, we used geometric coefficient of variation  defined by kirkwood  <cit> : gcv=expsln− <dig>  where s
ln = s × 10 × log
e and s is the standard deviation of log
10
p
i, i =  <dig>  …, n.

evaluation of the dynamic nature in tcr sequence across time or between different biological compartments
to assess the dynamic nature in tcr repertoire, we measured the overlap among tcr sequences across time points or between different biological compartments for the same subject by binary similarity matrices. choi and the coauthors  <cit>  collected  <dig> binary similarity measures used over the last century and revealed their correlations through hierarchical clustering technique. as an example, we utilized the baroni-urbani and buser  overlap index  <cit> . unlike most of the overlap index measures, bub includes the negative matches, i.e., the absent clones. for example, to calculate bub of each two time points across three time points j
 <dig> 
j
 <dig> and j
 <dig>  we first consolidated all clones present in any of the three time points and let n
 <dig> = the number of clones present at time j
1;n
2 = the number of clones present at time j
2; n
12 = the number of clones present in both time points and d
12 = the number of clones absent in both time points; then bub overlap index of time points j
 <dig> and j
 <dig> equals: bubj1j2=n12+n12d12n1+n2−n12+n12d <dig>  


it is equivalent to the jaccard coefficient = n12n1+n2−n <dig>  when there are only two time points. the advantage of bub overlap index is that it includes the information of the number of the absent clones, thus allows the researchers to observe and account for changes across all available samples. this ensures that different paired bubs  across the same set of available samples are comparable. there are several other binary similarity measures that have closer distance with the bub overlap index based on hierarchical clustering, thus can be considered as the substitute of the bub overlap index, such as bub2=3n12−n1+n2+n12d12n1+n2−n12+n12d <dig>  faith and mountford  <cit> .

the binary similarity measures are straightforward but only use very limited information of tcr repertoire, i.e., the presence or absence of clones across the samples. in addition, we utilized the relative clonality  which was calculated as the ratio of the clonality at two time points to measure the dynamics. furthermore, we considered matrices which aggregate the changes in abundance of each clonotype across time points to evaluate the dynamic nature of tcr repertoire across time course. morisita's overlap index  <cit>  has been used in several recent publications as a statistical measure of dispersion of clones in tcr sequence  <cit> . it is based on the assumption that increasing the size of the samples will increase the diversity because it would include more different clonotypes. cd=2∑i=1mfijfik∑i=1mfij2fj2+∑i=1mfik2fk2fjfk 
f
ij and f
ik are the abundance of clonotype i with the read depth f
j and f
k from time point j and k, respectively. c
d =  <dig> if the two samples do not overlap in terms of clonotypes, and c
d =  <dig> if the clonotypes occur in the same proportions in both samples.

the intraclass correlation coefficient  is another matrix we proposed to evaluate dynamic nature in clone abundance, which is commonly used to quantify the degree to which individuals with a fixed degree of relatedness resemble each other in terms of a quantitative trait. one of the applications of icc is to assess the persistence of quantitative measurements at different time points for the same quantity. in the framework of a random effects models z
ij = u + a
j + e
ij, where z
ij = log
10
p
i of the observed clone i in sample j for a particular subject, u is an unobserved overall mean, a
j ~ n is an unobserved random effect shared by all clones in sample j, and e
ij ~ n is an unobserved random error. both a
j and e
ij are assumed to be identically distributed, and uncorrelated with each other. thus, icc=sa2sa2+se <dig>  


the function ‘icc’ in r package ‘irr’  <cit>  was used to calculate icc. the advantage of icc is that it can be used to evaluate the dynamic change in clone abundance for more than  <dig> time points. however, due the nature of the tcr sequences that a big proportion of clones only present at one time point, i.e., their counts equal  <dig> in another time points, which greatly drives the value of icc. therefore, icc is more appropriate to evaluate the dynamic change of the common clones present at all the time points that we are interested in.

besides aggregating the dynamic changes of clones of the t cell repertoire, we further investigated the distribution of the fold change , for clonotype i, fc=log2pikpij, where k and j are two different tcr samples from the same subject. furthermore, based on fc, we clustered the clonotypes into three groups: decrease if fc ≤ -c, unchanged if –c < fc < c and increase if fc ≥ -c, where c is an arbitrary constant, for example c =  <dig> stands for a 4-fold change. when comparing the clonotypes frequencies between different biological compartments , we recommended adjustment to account for the distinctions due to the biological characteristics. for example, we multiply c by ∑i=1m
log
2
p
ik/∑i=1m
log
2
p
ij.

exploration of the treatment effect or the clinical benefits
as stated above, to explore the treatment effect or the clinical benefits, the diversity/dynamics index can be served as an endpoint. to test for a treatment effect, we can compare the diversity index of all subjects among time points by repeated measures analysis of variance  . to explore the difference of over-time dynamics among the groups defined by clinical outcomes , we can compare the dynamics index among the groups by anova . in addition, to allow for a varying number of follow-up measurements, the repeated measure anova methods with a mixed model approach  can be utilized, and the specific comparison of change in the diversity index between baseline and any specific post-baseline time point can be tested using linear contrast.

differential testing
the methods described above treated all clonotypes from the same sample as a single unit, and therefore failed to distinguish which unique clonotypes may be the most significant driver for observed effects. we therefore considered a modified differential expression analysis   <cit>  to explore treatment effects on the abundance of clonotypes for each clonotype as we did in our recent work  <cit> . the deseq r package  <cit>  was developed explicitly for identification of differentially expressed genes in rna-seq experiments and it is technically possible to work with experiments with small number of replicates or without any biological replicated. tcr repertoire data differs from typical gene expression data, in that it is heavily skewed towards rare clonotypes, with large numbers of clonotypes appearing only a few times, and many clonotypes appearing only once  <cit> . modifications were made to accommodate the specific case of repertoire analysis: 1) normalization was performed using only clonotypes that had > = <dig> counts in at least one sample; 2) a dispersion model calculated as the median of dispersion curves from all samples . this modification served to account for normal variation in the repertoire over time, and to compensate for the lack of replicates in the experimental design. the detection of the significant clones by deseq analysis was based on controlling for false discovery rate   <cit>  < <dig> .

illustration datasets
tcr profiling data from five subjects enrolled in the neoact study   <cit>  were used for major illustration. neoact study was a phase ii neoadjuvant study examining whether sipuleucel-t induced t cell infiltration into the prostate. subjects received sipuleucel-t  with a fusion protein of prostatic acid phosphatase and gm-csf) at the standard 2-week intervals for three planned doses. radical prostatectomy was performed 2–3 weeks after the final sipuleucel-t infusion. pbmcs were evaluated in the five treated subjects at week  <dig>  and during treatment at weeks  <dig> and  <dig>  rp tissues from the same subjects were also evaluated. in addition to the neoact subjects, tcr data from three healthy donors and five untreated prostate cancer subjects were also used for comparative purposes. serial  pbmcs from healthy subjects receiving no treatment as well as pbmc and rp tissue from untreated prostate cancer subjects were used as comparators.

the second dataset includes pbmcs from  <dig> metastatic castration resistant prostate cancer patients treated with anti-ctla- <dig>  and gm-csf in a single-center phase i/ii clinical trial   <cit> . patients were treated with up to four doses of ipilimumab ranging from  <dig>  to 10 mg/kg and gm-csf at 250 mg/m <dig> per day. anti–ctla- <dig> antibody was administered every 4 weeks with gm-csf given daily on the first 2 weeks of these cycles. only baseline  and week  <dig> data were included in the current paper for illustration purpose .

tcrβ amplification and sequencing
the tcrβ cd <dig>  region for both pbmc and tissue samples was amplified and sequenced using the immunoseq assay . the amplification and sequencing of tcrβ repertoire as well as clonotype identification and enumeration have been previously described in detail  <cit> .

RESULTS
visualization of tcr sequence abundance before and after sipuleucel-t treatment
instead of using scatter plots, which are commonly used to visualize the distribution of frequencies of two tcr samples from the same subject, we plotted the log <dig> of each unique clonotype in descending order of count , and inclusive of multiple samples in one graph. the distributions of clonotype frequencies of serial blood samples obtained every 2 weeks were very similar in a healthy subject . whereas the prostate cancer subject receiving sipuleucel-t treatment had different distribution profiles among the three time points . we also observed that the baseline curve intersected with the curves at week  <dig> and week  <dig> at count of  <dig>  =  <dig> ) and  <dig>  =  <dig> ), respectively. the similar results were found for other treated patients  with the intersection points ranging from count of 10– <dig>  which implied that the difference in the number of unique clones was caused by the clones with the counts smaller than those intersection points. the clones with counts smaller than the intersection point might have influence on the diversity and dynamics indices; therefore, those intersection points might be helpful for finding the best cutoff to filter the data. our r package provides the function to obtain such an intersection point.

tcr sequence diversity changed following the first treatment with sipuleucel-t
the first phase of the proposed “3d” analysis pipeline was quantifying diversity . as shown in additional file 2: figure s1b, the clonality for the healthy subjects were consistent for two subjects across time with the third subject was later verified having a cold at week  <dig>  the treated subjects had a wide range of baseline clonality, however, the clonality of the majority of treated subjects had a decrease from week  <dig> to week  <dig>  but became stable from week  <dig> to week  <dig>  indicating that tcr diversity changed after the first treatment but didn’t significantly change from week  <dig> to week  <dig> 

evaluation of the dynamics of tcr sequence across the sipuleucel-t treatment time course showed that the commonality of tcr sequence between week  <dig> and  <dig> increased
as presented in additional file 3: figure s2a, the bub overlap indices of pbmc over week  <dig>   <dig> and  <dig> were consistently about  <dig>  for healthy donors, but for the treated prostate cancer subjects there was a significantly greater increase in the overlap between week  <dig> and  <dig> than the overlap of week  <dig>  with baseline . additional file 3: figure s2b show that the healthy subjects had a consistent icc of  <dig> , however, the treated subjects had much higher icc at week  <dig> with week  <dig> than that of baseline with either week  <dig> or week  <dig> . this demonstrated that for the treated subjects when compared to baseline pbmc, pbmc samples at week  <dig> and week  <dig> had greater concordance, confirming an immediate sipuleucel-t treatment effect.

the three fc distribution curves  of the healthy subjects had a similar pattern , whereas for treated subjects there was a large shift in the week 4/week  <dig> fc curve compared to other two curves . we further calculated the proportions of decrease/unchanged/increase in terms of clone frequency by setting c =  <dig>  there was a significant increase in the proportion of unchanged clones between week  <dig> and week  <dig>  and a significant drop in the proportion of increased clones from week  <dig> to week  <dig> . this indicated that from baseline to week  <dig> and week  <dig>  about 15–25% of the overlapped clone abundance was enriched and this enrichment remained from week  <dig> and week  <dig>  fc analysis further implied that the immediate sipuleucel-t treatment effect might enrich the abundance of a certain group of clonotypes.fig.  <dig> the distribution of the pairwise fold change  between pbmc samples  for one healthy subject  and one treated prostate cancer subject . for clonotype i, fc is calculated by fc=log2pikpij, where k and j are the samples from two different time points for the same subject. each curve represents a pair of samples: pbmc. <dig> vs. pbmc. <dig> , pbmc. <dig> vs. pbmc. <dig>  and pbmc. <dig> vs. pbmc. <dig> . top figures  include the clones present at either of the sample from a pair and bottom figures  include the clones present at both samples from a pair 




assessment of dynamic changes from pbmc to tissues revealed that rp tissues became resemblance with week  <dig> and week  <dig> pbmc after sipuleucel-t treatment
our previous finding showed that the tcr sequence diversity within rp tissue was significantly higher in subjects who received sipuleucel-t treatment compared to untreated prostate cancer subjects . to explore the dynamic change of clonotypes from pbmc to rp tissue, we calculated the proportion of overlap  between tissue and pbmc at each time point separately for both treated and untreated subjects. similar overlap proportions between tissue and pbmc were observed for the untreated subjects and for that of the treated subjects at baseline , but a greater increase was seen between tissue and pbmc week  <dig> or week  <dig> for the treated subjects  .fig.  <dig> the dynamics from pbmc to tissue for prostate cancer subjects . a the proportion of overlap between pbmc and rp tissue. the traditional formula was used to calculate the overlap proportion of t-cell clonotypes between rp tissue and pbmc at each time point  for the treated prostate cancer subjects and untreated subjects . b the intraclass correlation coefficient  between rp tissue and pbmc. the icc was calculated based on the clones present at both rp tissue and pbmc from the untreated prostate cancer subjects , or between rp tissue and pbmc at each time point of the treated prostate cancer subjects . c the binned analysis of fold change in clonal frequency from pbmc to rp tissue. this fold change analysis only included the clones that present at both tissue and pbmc for the untreated subjects  or present at both tissue and pbmc at each week , respectively, for the treated prostate cancer subjects. from top to the bottom, each panel presents the fraction of the decrease, unchanged and increase clones which correspond to the adjusted fc of tissue vs. pbmc is less than  <dig> , between  <dig>  and  <dig> and greater than  <dig>  respectively. the median and interquartiles are shown




comparing to the untreated subjects , iccs of week  <dig> pbmc and tissue of the treated subjects were similar , but icc of week  <dig> or week  <dig> pbmc with tissue dramatically increased . moreover, comparing with the untreated subjects , there was a significant increase in the proportion of unchanged clones from week  <dig> or week  <dig> pbmc to the tissue for the treated subjects , which implied that rp tissue resembled at week  <dig> and week  <dig> pbmc for those clones present constantly. there was a significant drop in the proportion of increased clones from week  <dig>  pbmc to the tissue  when compared to week  <dig> pbmc vs. tissue  , indicating about 5–20% of the overlap clones in rp tissue were enriched immediately after the first treatment. these implied that sipuleucel-t treatment increased tcr sequence commonality between blood and resected prostate tissue in the treated subjects comparing to the untreated subjects.

deseq analysis demonstrated sipuleucel-t treatment induction of that were present in the prostate tissue
for each treated subject, we first calculated the dispersion based on each pair of the pbmc samples and performed  <dig> to  <dig> comparison by modified deseq . next we calculated dispersion on all pbmc samples, and performed pairwise comparison , and then compared pbmc at week  <dig> and  <dig> with pbmc at baseline. we found, for example, within the treated subject  <dig>   <dig> clones were significantly changed from week  <dig> to week  <dig> , of which  <dig>  of clones were present in the tissue . comparing log <dig> of the  <dig> significantly enriched clones from week  <dig> to week  <dig> which also presented in tissue with mean of log <dig> of all  <dig> tissue-present clones , we found that these  <dig> significantly enriched tissue-present clones had significantly higher tissue count than the overall mean , supporting the hypothesis that sipuleucel-t induces extravasation of t-cells into the prostate tissue. we also detected  <dig> clones significantly changed from week  <dig> to week  <dig> , of which  <dig>  of clones were present in the tissue , and the tissue count of those  <dig> clones also had significantly higher tissue count than the overall mean . similar results were observed for the other sipuleucel-t treated subjects .fig.  <dig> significantly differentiated clones detected by deseq analysis for one treated prostate cancer subject in neoact study . a tracking plot of the  <dig> clones that were significantly changed from week  <dig> to week  <dig>  green and red lines represent the increased and decreased clones from baseline pbmc to post-treatment. b boxplots of log <dig> of tissue t-cell repertoire clonotype count for the  <dig> tissue-present clonotypes that were also significantly changed from week  <dig> to week  <dig>  the left and the middle boxplots present log <dig> of the clones significantly decreased  or increased  from baseline to post-treatment, respectively. the right plot presents all tissue-present clones. c tracking plot of the  <dig> clones that were significantly changed from week  <dig> to week  <dig>  green and red lines represent the increased and decreased clones from baseline pbmc to post-treatment. d boxplots of log <dig> of tissue t-cell repertoire clonotype count for the  <dig> tissue-present clonotypes that were also significantly changed from week  <dig> to week  <dig>  the left and the middle boxplots present log <dig> of the clones significantly decreased  or increased  from baseline to post-treatment, respectively. the right plot presents all tissue-present clones




discussion
the proposed analysis pipeline is designed to investigate two major aspects of the t cell repertoire: diversity and dynamics, and further perform differential testing for each clone. here, a diversity index reflects how much difference among the tcr repertoire within each sample, while the dynamics analysis is to evaluate clone abundance change across the samples for the same subject, moreover, differential testing aims to detect the single clonotypes that have significantly different abundance across samples for the same subject. a public available r software “tcr3d”  is developed to implement the proposed workflow.

based on the preprocessed tcr repertoire data , starting with obtaining the number of unique clones and read depth for each sample, we suggest first assessing the repertoire diversity. although clonality is recommended, calculating more than two diversity measures is highly recommended to ensure consistent results and a sample can be considered more diverse if all of its renyi diversities  are higher than in another samples  <cit> . the number of unique clones and read depth should not be considered as the basis for an overall conclusion. if a study has multiple observations available for the same subject - usually obtained at different time points , then dynamics analyses, such as evaluation of binary similarity measures, morisita’s distance, icc, etc., and fold change analysis, are expected. in addition, when assessing commonality between different biological compartments consideration of the inherent variation due to the different biological mechanism is highly recommended, such as adjusting the clone frequency by the ratio of read depth, though we readily acknowledge that more advanced work  might be warranted to further address this issue. note each analysis component is performed for each single subject separately, to obtain meaningful scientific inference, we need to further compare the index between different time points or between different patient groups  with a valid statistical test. furthermore, differential testing needs to be taken into consideration with necessary modification on normalization and dispersion estimation, especially when replicates are available. deseq was applied solely for the illustration purpose. it has been developed to enable analysis of experiments with small number of replicates and it is technically possible to work with experiments without any biological replicated, which meets our situation that the differential testing of tcr data can only be done within each subject and there are very limited or no biological replicates within each subject. seyednasrollah et al.  <cit>  summarized and compared the software packages for detecting differential expression and stated that other existing methods to test differential expression require relative larges number of replicate samples. however, most of the softwares are applicable in r environment  <cit> , thus are compatible with our developed r package.

though there are a number of methods and software available for immunoglobulin  and tcr profiling   <cit> , these computational methods were mainly used for processing repertoire data by mapping v, d, j antigen receptor segments to sequencing reads and assembling t- and b-cell clonotypes, and most of them are not designed to quantify the diversity and dynamics of the repertoire. for example, mixcr  <cit>  is a universal framework that processes big immunome data from raw sequences to quantitated clonotypes. the more comprehensive software, lymanalyzer  <cit> , consists of four functional components: vdj gene alignment, cdr <dig> extraction, polymorphism analysis and lineage mutation tree construction. scireptor  <cit>  is a flexible toolkit for the processing and analysis of antigen receptor repertoire sequencing data at single-cell level by a relational database. some of the tools, such as repgenhmm  <cit> , imonitor  <cit> , imex/immunexplorer  <cit> , change-o  <cit> , immunediversity  <cit> , and vdjtools  <cit>  etc., could also measure repertoire diversity, but they only rely on one or two diversity indices, such as shannon or gini diversity. immunoseq analyzer  <cit>  developed by adaptive biotechnologies, a pioneer in leveraging ngs to profile t- and b-cell receptors, provides web-based analysis for tcr data including estimation of diversity and dynamics indices, though with limited options; and unfortunately, it is only available to the customers who have sequencing performed by adaptive biotechnologies. recently, nazarov et al.  <cit>  developed an r package “tcr” to analyze ngs-based t cell repertoire data, that integrated widely used methods for individual repertoires analyses and tcr repertoires comparison, customizable search for clonotypes shared among repertoires, spectratyping, and random tcr repertoire generation. however, both immunoseq analyzer and the “tcr” package do not provide detailed discussion about the robustness of diversity/dynamic indices, lacks the ability to investigate the unique dynamic nature of this type of sequencing data, especially between different types of biological compartments and don’t offer the feature of differential testing of each individual clone.

we examined the robustness of diversity/dynamics indices with the number of unique clones whose differences were mainly driven by low-count clones, and compared the performance of the diversity/dynamics indices over the various thresholds used for filtering the sequencing data . we found that clonality and relative clonality were the matrices that possessed robustness to different count thresholds , the binary similarity measures were greatly influenced by the lower count clones , and morisita’s distance had better performance when tcr repertoire only retains the high abundance clones . furthermore, we also performed differential testing on the clones with different thresholds , which show that more than 86% of clones detected significant when applying a threshold of count ≥  <dig> were still detectable when applying other thresholds . currently, the tcr data from the vendors  all have their own preprocessing steps which may be proprietary. however, we advocate not just working on the top ranked clones, such as the clones with the count in top 25%, or the clones with larger abundance , but rather considering possible but necessary filtering on the data to avoid the potential noises caused by low-count clones and performing robustness checkfig.  <dig> the influence of the count thresholds on diversity matrices of tcr repertoire in sipuleucel-t treated prostate cancer patients . a tcr sequencing data of pbmc samples at week  <dig> , week  <dig>  and week  <dig>  of the five treated prostate cancer subjects are used for illustration. from top to bottom, each row shows the number of unique clones , read depth, the shannon index, gini simpson, inverse simpson , geometric coefficient of variation  and clonality of tcr repertoire. from the left to the right, each column presents the different threshold of the clonotypes count . the shannon index, clonality, gini simpson, inverse simpson and gcv were obtained by recalculating the clone frequency after filtering the data with the different cutoffs. b pairwise relative clonality were calculated as the clonality of pbmc at the later time point divided by that of the earlier time point, e.g., pbmc.2/0 = clonality of pbmc week  <dig> divided by pbmc week  <dig>  from the left to the right, each column presents the different threshold of the clonotypes count . the subject with triangle shapes was the example used in fig. 1c)




tcr diversity and dynamics might someday be used as predictive biomarkers in cancer immunotherapy. therefore, we propose that if testing the treatment effect is the primary objective, sample size calculation should be based on a paired t-test or repeated measures anova of the diversity index, where clonality is recommended; if examining the influence of the clinical outcome  is the major goal, sample size calculation should be based on a two-sample t-test or anova of the dynamic index .

to extend the pipeline, in our next step, we would perform both manual and automated approaches in biological annotation such as summarizing the v, d, j gene families used to construct the tcr to further explore the biology of the t cell repertoire. both supervised and unsupervised clustering clonotypes within a sample or across different time points is part of our future work too, though we recognize that due to the large number of clonotypes and low overlap caused by dynamic feature of the tcr sequencing data, finding a suitable distance measure and an efficient clustering method is a challenging task.

CONCLUSIONS
by using the proposed “3d” analysis pipeline to the real example, we were able to evaluate the tcr sequence diversity of each sample and investigated the changes in abundance of each clonotype across time and between blood and tumor tissue. through this approach, we discovered that sipuleucel-t treatment changed the tcr repertoire in the blood and in prostate tissue. we also found that the increases in common tcr sequences between rp tissue and blood after sipuleucel-t treatment supported the hypothesis of a treatment-induced t cell migration into the prostate tissue. the pipeline is a thorough analysis of tcr repertoires after primary sequences extraction from raw sequencing reads. this paper also provides comprehensive understanding of the diversity and dynamics indices for tcr sequencing data with serial time points and for comparing t cells in multiple compartments in a clinical context to ensure consistency and reproducibility of post-analysis. tabular outputs and visualization tools with a simple enough r software usage enable scientists and clinicians with little computational experience to generate results in a well-presented format.

additional files

additional file 1: figure s <dig>  results of all ipilimumab treated prostate caner subjects and separately by long survivors  and short survivors .  shannon index of tcr at week  <dig> and week  <dig>   clonality of tcr at week  <dig> and week  <dig>   intraclass correlation coefficient of tcr between week  <dig> and week  <dig>   morisita’s distance of tcr between week  <dig> and week  <dig>   scatter plot of shannon vs. log <dig>  pearson correlation coefficient and corresponding pvalues were calculated.  scatter plot of clonality vs. log <dig>  pearson correlation coefficient and corresponding pvalues were calculated. 


additional file 2: figure s <dig>  the diversity of tcr from pbmc at week  <dig>   <dig> and  <dig> for the healthy subjects  and the treated prostate cancer subjects  in neoact study.  the clonality of tcr from pbmc at week  <dig>   <dig> and  <dig> for the healthy subjects  and the treated prostate cancer subjects .  the geometric coefficient of variation  of tcr from pbmc at week  <dig>   <dig> and  <dig>  for the healthy subjects  and the treated prostate cancer subjects . 


additional file 3: figure s <dig>  the dynamics of tcr from pbmc across time course .  the baroni-urbani and buser  overlap index of tcr from pbmc across week  <dig>   <dig> and  <dig>  for the healthy subjects  and the treated prostate cancer subjects .  the intraclass correlation coefficient  of tcr from pbmc across week  <dig>   <dig> and  <dig>  for the healthy subjects  and the treated prostate cancer subjects . the icc was calculated based on the clones present at both time points of each paired samples .  a binned analysis of fold change in clonal frequency for the healthy subjects  and the treated prostate cancer subjects , for example, pbmc.0- > pbmc. <dig> is the fraction of clones where the ratio of frequencies at week  <dig> vs. week  <dig> is greater than  <dig> , less than  <dig>  , or between  <dig>  and  <dig> , similarly for week  <dig> vs. week  <dig>  and week  <dig> vs. week  <dig> . this fold change analysis only includes the clones that present at both paired time points . the median and interquartiles are shown. 


additional file 4: table s <dig>  the results of serial  <dig> vs.  <dig> comparison by modified deseq analysis for  <dig> treated prostate cancer subjects . we considered  <dig> different ways of estimating dispersion:  <dig> vs.  <dig> uses sample  <dig> and sample  <dig> to calculate the dispersion; all samples uses all available pbmc samples from  <dig> time points  to calculate the dispersion. subject  <dig> doesn’t have data at week  <dig>  the number of the significantly differentiated clones between sample  <dig> and sample  <dig>  was listed for each patient and each comparison. the summary statistics summarized across all  <dig> patients. table s <dig> the results of comparing pbmc samples of week  <dig> vs. week  <dig> and week  <dig>  separately, by modified deseq analysis for  <dig> treated prostate cancer subjects, where the dispersion was calculated based on all three pbmc samples. overall mean stands for the average of log <dig> of all the tissue-present clones. n is the number of the significantly differentiated  clones . n* is the number of the significantly differentiated  tissue-present clones. mean stands for the average of log <dig> of the corresponding n* significantly differentiated  clones. p was obtained by comparing log <dig> of the n* significantly differentiated  tissue-present clones with the overall mean of log <dig> using t-test. 


additional file 5: table s <dig>  the list of bioinformatics tools to analyze high-throughput immunological repertoire sequencing data. 


additional file 6: robustness of diversity/dynamics measures . 


additional file 7: figure s <dig>  the influence of the count thresholds on the pairwise binary similarity measures of tcr from pbmc at week  <dig>   <dig> and  <dig> for the treated prostate cancer subjects in neoact study. from top to bottom, each row shows five different types of similarity measures. from the left to the right, each column presents the different threshold of the clonotypes count . the subject with triangle shapes was the example used in fig. 1c). the median and interquartiles are shown. 


additional file 8: figure s <dig>  the influence of the count thresholds on the pairwise dynamics indices of tcr from pbmc at week  <dig>   <dig> and  <dig> for the treated prostate cancer subjects in neoact study. from top to bottom, each row shows the proportion of increase/unchanged/decrease clones from earlier time point to later time point, and pairwise morisita’s distance. from the left to the right, each column presents the different threshold of the clonotypes count . the subject with triangle shapes was the example used in fig. 1c). the median and interquartiles are shown. 


additional file 9: figure s <dig>  the scatter plot of the number of unique clones with the shannon index, clonality and geometric coefficient of variation  of tcr repertoire from pbmc  of the five treated prostate cancer subjects in neoact study. pearson correlation coefficient and corresponding pvalues were calculated for each pair. 




abbreviations
anovaanalysis of variance

bubbaroni-urbani and buser

cdr3complementary determining region 3

cvcoefficient of variation

fcfold change

fdrfalse discovery rate

gcvgeometric coefficient of variation

iccintra-class correlation

ngsnext-generation sequencing

pbmcperipheral blood mononuclear cell

tcrt cell receptor

