BACKGROUND
proteomics inter-alia focuses on the identification of peptides/proteins in complex biological samples  <cit> . before the identification of the complex constituents, several separation steps are required to reduce the sample complexity. the classical separation method is the two-dimensional gel electrophoresis  <cit> , followed by excision of the detected spots from the gel, digestion with sequence specific proteases and extraction of the cleaved proteins  <cit> . mass spectrometric  analysis  <cit>  of the resulting mixture of peptides yields a peptide mass fingerprint : a set of measured molecular masses of the proteolytic peptides derived from the analysed protein  <cit> .

pmf commonly requires matrix assisted laser desorption/ionisation  time of flight  instruments, capable of high throughput analysis of complex samples with minimal pre-cleanup, high femtomolar range sensitivity and accuracy of peptide molecular mass determination up to  <dig> –  <dig> parts per million   <cit> . due to the high ion transmission of the tof mass analyzer, this technique is more sensitive compared with other ms techniques. in relation to electrospray ionisation  ms  <cit> , maldi-ms is more tolerant to sample contamination resulting from salts and detergents often present in protein samples due to the separation method. maldi-ms and esi-ms have become the standard high throughput proteome analysis techniques in many research laboratories.

the experimental peptide mass lists are generated by the analysis of tof spectra  <cit> . ideally, the tof is proportional to the square root of mass over charge . thus, in order to transform the spectrum from tof into m/z, two calibration constants a and b are necessary. these can be derived by measuring the flight times t of at least two different ions with known masses and fitting them such that . after the transformation from time into m/z, the mono-isotopic peptide signals in the spectrum are identified and their intensity is determined by computational methods  <cit> . the lists of the first mono-isotopic peptide peaks – further called peak-lists – are used to identify the protein of interest. in order to assign the pmf to a protein in a sequence database, database search algorithms use the match  of theoretical peptide masses computed from protein sequence databases  <cit>  with observed ms masses  <cit> .

usually the scoring schemes model the mass frequencies of the proteins and peptides in the sequence databases  <cit> . other properties to be considered include the different sensitivity of detection for individual peptides, known protein modifications, and/or possible mutations  <cit> , although generally, all popular search scores depend on the precise assignment of experimental to theoretical peptide masses.

two novel calibration methods
in a high throughput setting  <cit> , where the samples are placed on a moving sample support, the calibration coefficients for transforming the tof into m/z differ depending on sample position. this is due to deviations in plate flatness, sample topography changing the size of the acceleration region  <cit> , and alterations in the strength of the electric field on the sample support borders which influences the drift velocity of the ions  <cit> . thus, when calibration constants determined from one position on the sample support are used to calibrate tof spectra acquired on other positions , the determined m/z values have errors of up to  <dig> ppm.

calibration is usually performed using external  <cit>  or internal calibrants  <cit> , which rely on known masses to calibrate the spectra to common co-ordinates. it must be stressed, that in some cases the signal of a reference compounds might be suppressed by the analyte molecules, thus precluding internal calibration. in other cases, the reference signal may partially overlap with an analyte signal, resulting in an erroneous assignment. a third category of calibration methods is based on the peptide mass rule  <cit> . a major advantage of the latter method is that no internal calibrants are required to calibrate the peak-lists. the limitation of this method is it's sensitivity to the presence of non-peptide peaks in the spectra, and that it completely fails if the number of peptide peaks in peak-lists are small  <cit> . therefore, in practice this method usually is used only to pre-calibrate  <cit>  or to support the results of internal calibration  <cit> .

we have developed two novel calibration methods for pmf data. both calibration methods exploit similarities of peak-lists due to closeness in the origin of the analysed samples. the first method combines the computation of dissimilarities  <cit>  between peak-lists with internal calibration. the second method employs spatial statistical methods  <cit>  to model systematic changes of the calibration-model over the maldi sample support. the major advantage of the presented methods originates from the fact that the ms calibration derives from samples without internal standards or external calibrants positioned on each sample support.

evaluating the methods
to demonstrate the accuracy of our methods, we studied one sample set of  <dig> mass spectra, consisting of a part of the arabidopsis thaliana proteome study  <cit> . for this purpose, a maldi ms sample support in pre-structured  <cit>   microtitre plate format was used. the measurements were performed using the autoflex maldi-tof ms  <cit>  instrument.

to compare the performance of calibration methods described here with those already published  <cit> , we used two different data sets. the first set consisted of  <dig> spectra deposited on four pre-structured sample supports and measured on a reflex maldi-tof ms  <cit>  instrument . spectra were generated via mass spectrometric analysis of the rhodopirellula baltica proteome . the second set was generated in connection with a proteome study of mus musculus and consisted of  <dig> spectra deposited on five pre-structured sample supports and measured on an ultraflex maldi-tof ms  <cit>  instrument .

during ms sample preparation of the ultraflex data set, standard peptides of known masses   <dig>   <dig> da) were added before the measurement to the ms matrix. this was done because the data sets were optimised for the calibration methods, which required the internal calibrants. we examined if the standard peaks could be observed in more than 33% of spectra and if so, we removed the peaks matching these masses from the data set. this procedure was applied in order to simulate a data set not optimised for internal calibration.

the rhodopirellula peptide peak-lists were searched against a pirelulla database  <cit>  with  <dig>   <dig> predicted open reading frames . the mus musculus samples underwent searches against the mus musculus entries  of the ncbi non-redundant protein database  <cit> .

RESULTS
internal calibration using a pre-calibrated list of calibration masses
internal calibration is a widely used method in mass spectrometry. this method fails however, either if no peaks matching known masses are present or if ms peak assignment is false. a detailed description of the application of internal calibration in a high throughput-ms setting, addressing the two points is given by e.g. chamrad et al.  <cit> , levander et al.  <cit>  and samuelson et al.  <cit> . in order to avoid the lack of ms peaks matching the known calibration masses the authors used a pre-compiled list, e.g. trypsin autolysis peaks and unidentified, frequently observed masses  <cit> .

chamrad et al.  <cit>  initiated the calibration procedure with searches for matching masses using a relatively large search window and iterated it with an increased accuracy. in this scheme, a large search window allows false assignments for calibration masses to occur more frequently. if a false assignment occurs in the first iteration, then the determined calibration constants are false and the entire calibration would be wrong. in the next round of calibration, where a search for matching masses is performed with a higher mass accuracy, the calibration would also fail. to prevent this, the authors  <cit>  checked the obtained calibration coefficients against the peptide mass rule   <cit>  and stopped further calibration attempts where they disagreed substantially.

levander et al.  <cit>  introduced an adaptive method to eliminate low-sensitivity auto-proteolysis trypsin peaks from the calibration mass list if no high-sensitivity trypsin peaks e.g.  were found to decrease the chance of false matches. unfortunately, this method could only be applied for "tryptic" calibration peaks.

figures 1a &1b demonstrate the limitations of a calibration list compiled from ubiquitous masses of the whole data set. one can recognise that out of three abundant masses , only two can be practically used for calibration. specifically, the first and the third abundant mass in the list of ubiquitous masses  match simultaneously two peaks in peak-list  <dig>   <dig> and  <dig> . thus, out of five peak-lists only three could be calibrated. the second calibration mass is also of no use, since it is the only calibration mass in the peak-lists  <dig> and  <dig> . this illustrates that the usage of a global calibration list may fail to calibrate a set of peak-lists.

it is therefore feasible to address the following questions: how can one obtain a short calibration list to avoid spurious matches while at the same time it matching a sufficient number of peaks in every peak-list of the set? in addition, how can one minimise the initial search window to avoid false matches?

finding the optimal multiple peak-list alignment using a modified minimum spanning tree  algorithm
in order to bypass the limitations imposed by global calibration we used an observation made by schmidt et al.  <cit> . they noticed that protein samples excised from high-resolution 2d-gels are usually not ideally separated and therefore exhibit local similarities. compiling a calibration list of abundant masses from a whole data set obtained from a 2d-gel does not differentiate local spectra similarities. for example peak-lists  <dig>   <dig> and  <dig>  share peaks, which were not recognised as ubiquitous masses and hence not used further for calibration using a global calibration list. the peak-list pairs  and  shared more than one peak, thus allowing an easy calibration.

we explored the property of local pairwise peak-list similarities for calibration of data sets. to achieve it, we used a modified minimum spanning tree mst  <cit>  algorithm on the complete weighted graph g, where the vertex set v corresponds to the individual peak-lists and the edges e are weighted by a dissimilarity measure d. we denned the measure between two peak-lists p <dig> and p <dig> as d = -s, where s represented a similarity measure denned in equation  <dig>  this measure not only counts the number of matching peaks, but also weights the mass range enclosed by them. hence, it also considers that if the matching masses lie very close to each other, the calibration model describes a small mass range only, and can result in a large error when aligning masses that are out of this range. using the dissimilarities one can compute a mst . the algorithm to compute the mst of the peak-list data set starts by choosing a peak-list , which belongs to the peak-list pair of smallest dissimilarity, for example peak-list  <dig> or  <dig> in figure  <dig>  this peak-list is the root of the growing tree t . next, a peak-list v was chosen, which easily could be aligned to peak-list u where v is a part of the growing tree i.e. u ∊ t , for example peak-list v =  <dig> can easily be aligned to peak-list u =  <dig>  using linear regression, we computed the coefficients c =  of the affine function, modelling the absolute mass differences of the peaks matching in the peak-list pair . having these coefficients one can compute the calibration coefficients c using the update rule in equation  <dig>  which described the mass measurement error  between the peak-list v and the starting peak-list s. the calibration is not terminated until the whole tree is built. we then added peak-list v to the tree t and have iterated the procedure until all peak-lists were appended to the tree, for example by adding peak-list  <dig>  then  <dig> and finally  <dig> to t .

in the mst algorithm, the vertices are joined by edges of smallest dissimilarity. consequently, the mst algorithm connects all peak-lists in the data set in the way that the length of the path from the peak-list of origin  to any peak-list in the data set is minimal. the algorithm for computing the agglomerative clustering using the single linkage method  <cit>  works similarly like the mst algorithm and therefore the dendrogram  provides  the order, by which the peak-list pairs were chosen. the horizontal lines joining two dendrogram tree branches were drawn at the height of the value of the minimal dissimilarity of two peak-lists in either branch.

finally, the algorithm returns a list of coefficients and a measure of confidence for all peak-lists equalling the smallest similarity in the path from s to v.

the strip-charts of mass ranges including peaks of the trypsin autolysis products  <dig>  and  <dig>   <dig>  are presented in figure 2c <dig> and c <dig>  one can observe that the mst-method works robustly on raw data with a mass measurement error of up to ±  <dig> da , even if the search for matching peaks when computing the similarities and calibration coefficients was performed within a much smaller window of ±  <dig> da. notably, if the maximal error among two peak-lists is much larger than the search window, it is still possible to find a path, thus allowing alignment of two extreme peak-lists.

due to the fact that all peak-lists were aligned to the peak-list of origin s, which did not necessarily match to the theoretical trypsin autolysis masses, a final correction was required to calibrate the whole tree to the theoretical co-ordinate system before database searches .

determining the calibration model of the sample support using thin-plate spline interpolation 
because a large part of the mme is of systematic origin and depends on the sample support position, the mapping of the calibration coefficients across the entire maldi plate was introduced by gobom et al.  <cit>  and moskovets et al.  <cit> . the calibration coefficients were determined using a standard mixture of peptides with known masses. subsequently, the calibration coefficients were used during ms analysis in order to correct for the masses measured afterwards on the same plate.

we introduced here a method that derives the calibration model from calibration coefficients acquired from samples, which do not necessarily contain internal standards. instead of refining the mst calibration model, we chose the peptide mass rule based approach, namely linear regression on peptide rule , to obtain the calibration coefficients. the methods based on the peptide mass rule do not rely on the specification of an initial search window or on internal calibrant masses. the peptide rule based calibration method calibrates the peak-lists into the theoretical co-ordinate system and increases the mass accuracy to approximately  <dig> da, but fails if the peak-list is too short, which indeed could be observed for several samples . figure 3a provides the color scheme coded slope coefficient c <dig> as determined by the peptide rule based calibration method in dependence of the target location. one can observe that some erroneous predictions occur .

however, it is unbiased to assume a smooth transition between adjacent positions of the sample support. for example, figure 2b demonstrates that the slope coefficient of the sample calibration-model obtained by the mst calibration methods increases for samples close to the support border. this change is due to alterations in the electric field e  influencing the flight velocity given by



where sa is the size of the acceleration region, z is the ion charge and m is the mass of the ion. we determined the systematic change of the slope using the thin-plate spline  interpolation method  <cit> . at first, we computed the tps with a degree of smoothing λ = 5·10- <dig> . calibration models with slope coefficient c <dig> that varies more than ± 1·10- <dig> or with intercept coefficient c <dig> varying more than  <dig> da from the one predicted by the tps were discarded. using the remaining calibration models, the tps was recomputed with smaller degree of smoothing λ = 1·10- <dig>  figure 3b, demonstrates the colour scheme coded slope coefficient c <dig>  as estimated by the refined tps. this model resembles the one generated by the mst method . we corrected the peak-lists masses , using the tps values as estimates of the slope coefficients, and as intercept estimate we used the average intercept of all coefficients of the refined calibration models to obtain the calibrated masses .

the tps method reduced the mme of a peak-list compared to any other peak-list in the data set  down to  <dig> da, as compared to  <dig> da for raw data. this is approximately a 5- fold increase of a mass measurement accuracy. this decrease of the mme enabled us to utilise the mst-algorithm with an accuracy of ±  <dig> da, reducing further the probability of false assignments of calibration masses. in addition, the histogram of dissimilarities computed for all peak-list pairs  shows for tps calibrated data lower values of dissimilarity  as compared to the raw data , even if the first dissimilarities were computed with a search window of  <dig> da and the second ones with a search window of  <dig> da. a subsequent calibration using the mst method decreased further the mme .

the mass measurement error
prior to the calibration, the main error source is due to different drift velocities of the ions causing an increase of the absolute mme, proportional to mass and best described by the slope coefficient c <dig> ≠  <dig> and measured as relative error using parts per million ppm . after removal of this error using calibration methods, for example the tps calibration  or tps with subsequent mst calibration , the main contribution to the mme was due to peak detection performance. we were aware, however, of systematic changes of the mme, which can be described using higher order polynomials  <cit> . we have removed higher order terms of the mme, by applying external calibration before to other calibration procedures . the change of peak-detection quality was negligible in the range of  <dig> – 4000da. figure  <dig>  as well as table  <dig>  illustrates that after calibration the absolute mme was smaller for the peak with higher mass  than that of the peak with a lower mass  if the peak intensity and consequently the signal to noise ratio remained sufficiently high. therefore, we performed the database searches by specifying the search window in da instead of ppm.

the optimal size of the search window
the optimal size of the search window was determined by searching of four internally calibrated data sets with five different search window sizes, namely  <dig> ,  <dig> ,  <dig> ,  <dig>  and  <dig> da using the mascot  <cit>  search algorithm. the search window of  <dig> da generated the highest identification rate. figure  <dig> shows the relative identification rate ·100%). allowing the search window to be larger e.g.  <dig> da, decreases the identification rate by increasing the rate of false negatives, while a smaller window e.g. ±  <dig> da decreases it by rejecting true matches  <cit> . because the identification rate for a search window of  <dig> da is only slightly worse than one of  <dig> da, and since it minimizes the risk of false positive matches, we further compared the practical performance of the calibration methods with a search window of  <dig> da.

prior to the database searches we removed all masses that occur in more than 8% of spectra, as it significantly increased the identification rate  <cit>  . the sequence data base search was performed using the mascot  <cit>  search software version  <dig> . <dig>  we interfaced the search server from within r using the in-house developed r package msmascot  <cit> .

combining different calibration methods and their comparison
all parameters were fitted to a data set optimised for internal calibration, measured on an autoflex maldi-tof ms  <cit>  instrument. we applied the calibration methods introduced  without changing the parameters to two sample sets obtained using two different instruments, namely a reflex maldi-tof ms and a ultraflex maldi-tof ms instrument. this was executed to illustrate that our methods are robust with respect to different instruments even if the parameters were not optimised for the respective machines.

we combined the different pre-calibration and calibration methods resulting in six different calibration sequences . we compared the performance of the mst and tps calibration sequence to the internal calibration , and the peptide rule based calibration methods . furthermore, we investigated if the identification rate of the tps based method could be improved further by subsequent internal  or mst calibration . the r  <cit>  scripts implementing each sequence can be found in the samples directory of the mscalib bioconductor  <cit>  package.

the only calibration method for which parameters were optimised with respect to the instrument was the standard internal calibration  method, which employs a pre-compiled calibration list of theoretical trypsin autolysis peaks and a calibrated set of ubiquitous masses . in case of the peptide rule based calibration  method we applied an additional filtering of the calibration-models. only models with an intercept coefficient c <dig> satisfying - <dig> da <c <dig> <  <dig> da and slope coefficients c <dig> with -5·10- <dig> <c <dig> < 5·10- <dig> were kept. in order to avoid falsely calibrated peak-lists we performed the filtering.

the identification rates were defined as the number of identified samples by at least one of the calibration sequences divided by the number of samples submitted for searches



where csi indicates the set of identified samples by one of the calibration sequences , and #{a} denotes the number of elements in a set a. the identification rates were 74%, 87%, 79%, 85% for the pirellula  data set, with an overall identification rate of 82%, whereas for the mus musculus  data set they were 51%, 72%, 35%, 51%, 27%, with an overall identification rate of 58%. the lower identification rate of the mus musculus data set can possibly be explained by the fact that it was matched with a larger database. therefore, more matching peaks are required to make significant assignments to a data base entry.

in order to directly compare the identification rates for both data sets and each calibration sequence, we computed the relative identification rate. it was defined as the ratio of the number of identified samples calibrated by a sequence  and of the number of identified samples, which could be identified by at least one method :



the relative identification rate is indicated by the dots, joined by continuous lines for readability purposes only, in figure  <dig>  the dashed lines denote the average of the sequence coverage of all identified samples. figure 7a presents the results for the four pirellula data sets, while figure 7b shows the results of five mus musculus data sets.

only in one case of one data set was a single calibration sequence tps-mst  able to identify all peak-lists  and therefore it completely dominated over the other methods . in the case of the ultraflex data set  we observed that the tps-mst method had the highest identification rate, while in reflex data set  it achieved the highest performance for approximately half of the data sets.

interestingly, the tps smoothing method resulted in an overall higher identification rate than the other methods tested on raw data , except for one case of the ultraflex data set. furthermore, a combination of the internal calibration with tps calibration  did not increase either the sequence coverage  or the identification rate of the tps method applied alone.

in two out of the four reflex data sets, the mst method applied on tps-processed data  slightly decreased the sequence coverage indicating a reduction of calibration accuracy. for the ultraflex data sets, the sequence coverage correlated well with the identification rate and the tps-mst-method accomplished the highest performance.

moreover, if similar identification rates of the peptide rule based calibration and the internal calibration were observed, the peptide rule based calibration method provided higher sequence coverage . this could be explained by the fact that the peptide rule based method calibrated well the peak-lists possessing many peptide peaks. such peak-lists potentially contain the higher sequence coverage.

the bioconductor package mscalib
all of the calibration methods are part of the mscalib programme, which is available as a bioconductor  <cit>  package. the bioconductor project is an initiative for the collaborative creation of extensible software for computational biology and bioinformatics  <cit> . the scripts carrying out the calibration sequences tested, can be found in the subdirectory/samples of the package. furthermore, in the same directory and in the directory/doc there are two vignettes  <cit>  with detailed descriptions of two selected calibration sequences.

CONCLUSIONS
while the methods described in this study significantly improve the calibration of raw data, they do not perform better than other published calibration routines which reduce the mme to  <dig> ppm or below. the real advantage of the methods described here is that they are not dependent on the presence of internal or external calibrants, required to correct for the affine component of the mme. furthermore, the calibration methods described in this study allow a larger fraction of peak-lists in the datasets to be calibrated than the reference internal calibration method would do.

the tps method deals with systematic detrimental calibration effects that are due to imperfections in the geometry of the electric field over the maldi sample plates. usage of tps calibration results in up to 10% higher identification rates, at least for the bruker mass spectrometers, than the internal calibration. the tps calibration procedure enables, for most of the samples deposited on the sample support, to obtain mass accuracy in the range of ±  <dig> da. moreover, the tps method does not require the presence of internal calibrants since it relies on calibration coefficients acquired from a calibration method based on the peptide mass rule.

the mst method is able to increase the identification rates obtained by the tps-method for protein samples separated by a 2d-gel electrophoretic procedure. furthermore, the parameters optimised for one instrument  can be directly utilised for other instruments .

in this work, we have only examined a version of the mst algorithm that builds a single tree for all peak-lists. this is adequate if the data are a set of peak-lists with smooth transitions in the similarity values. if this is not the case, it might be more appropriate to compute a forest of several msts. we have examined, however, only a single peak-list similarity measure  for peak-lists calibration. it is possible that better similarity measures can still be generated and subsequently applied for peak-lists calibration.

complete utilisation of microtitre plates and sample supports is not only rational with respect to increased accuracy of the tps method, but also with respect to the idea of high throughput experiments – maximal utilisation of energy and resources. dense excision of spots from 2d-gels not only increases the performance of the mst method, but also identifies novel proteins. hence, the main contribution of this manuscript is to present two calibration methods, compatible with the principle of high throughput sample processing and aims to identify a maximum of the proteins resolved on 2d-gels.

however, no single "best-calibration" method exists. each of the methods utilises different properties of the peak-lists. consequently, applying these methods in parallel and determining the total  of the identified samples provides the highest identification rate.

