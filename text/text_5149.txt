BACKGROUND
the lepidoptera  are one of the four mega-diverse insect orders, containing over  <dig>  described species  <cit> . primarily plant-feeding as larvae and nectar-feeding as adults, they are a prominent element of terrestrial ecosystems, functioning as herbivores, pollinators and prey, as well as constituting one of the most damaging groups of pests overall to agriculture. lepidoptera have served as important model systems for studies of genetics, physiology, development, and many aspects of ecology and evolutionary biology including insect/plant coevolution  <cit> . as conspicuous terrestrial invertebrates, they have become central as well to ecosystem assessment, conservation planning, and public outreach designed to foster environmental awareness  <cit> .

a phylogenetic framework is fundamental to all attempts at understanding the diversity, adaptations and ecological roles of lepidoptera. deep-level lepidopteran phylogeny, however, remains largely a mystery, except in the species-poor, basal  lineages . monophyly seems well established for many of the  <dig> superfamilies but not for all, and phylogeny within superfamilies has only begun to receive concerted study. relationships among superfamilies have rarely been examined. in the clade ditrysia, which contains over 98% of lepidopteran species and 80% of the families, the most authoritative phylogenetic hypothesis to date postulates only  <dig> tentative monophyletic groupings among the  <dig> superfamilies  <cit> , and is not based on a quantitative phylogenetic analysis.

in this paper we present an initial study undertaken to help guide the design of a very large molecular investigation of lepidopteran phylogeny now in progress . we test the ability of five protein-coding nuclear genes  to resolve relationships among  <dig> species, drawn from  <dig> superfamilies and  <dig> families that together contain nearly 90% of the species of ditrysia. we then compare the results to previously postulated relationships, most of which are based on morphology. this report presents by far the largest explicit character-based analysis of ditrysian phylogeny yet published, though others are underway .

the working hypothesis that our sampling is designed to test is the compendium of expert opinion on within- and among- superfamily relationships compiled by kristensen  <cit> . the major divisions follow minet  <cit> , who recognized three successively more restricted clades within ditrysia. in order from most to least inclusive, these are apoditrysia, obtectomera, and macrolepidoptera. these divisions, based on morphological characters, are correlated with broad postulated trends in life history  <cit> . for example, in most non-ditrysian and many primitive ditrysian lineages, the larvae typically live and feed inside the host plant, most often as leaf miners, emerging, if at all, only to pupate. in the majority of non-macrolepidopteran apoditrysia, the larvae live outside the plant but construct and feed within shelters such as silk webs or leaves rolled and tied with silk. only in the putative clade macrolepidoptera, comprising the butterflies and larger moths and totaling about  <dig>  described species in  <dig> families and  <dig> superfamilies, do the larvae - "caterpillars" - typically feed exposed on the leaf. macrolepidoptera also differ from the remaining ditrysia, often referred to informally as "microlepidoptera," in that over 80% of the species, mainly in the superfamilies drepanoidea, geometroidea, and noctuoidea, possess some form of ultrasound-detecting "ears," most often located on the thorax or abdomen. these hearing organs probably evolved as a defense against bats that hunt using sonar  <cit> . among the microlepidopterans, in contrast, the only large superfamily to possess such "ears" is pyraloidea, though similar structures have been described in two other small groups  <cit> . rigorously documenting  the existence of such major transitions and their evolutionary consequences is a central long-term goal of our studies of lepidopteran phylogeny.

the early radiations of ditrysian superfamilies are likely to have been rapid  <cit> , and to have taken place mainly during the cretaceous  <cit> , a problematic time span for insect molecular phylogenetics . cretaceous divergences are sufficiently young that most coding sequences, even ones chosen specifically for suitability over this time span, have accumulated relatively few amino acid changes. thus, many genes will probably be needed to provide sufficient non-synonymous signal to resolve a rapid radiation. at the same time, these divergences are sufficiently old that sites undergoing synonymous substitutions, the largest source of signal, will be both approaching saturation and diverging in base composition, posing special difficulties for phylogeny inference. resolution of ditrysian relationships is thus likely to require, in addition to very large character sets, an especially careful choice among analytical methods, to extract the maximum amount of signal from a highly heterogeneous and challenging set of relevant characters. for this reason, our study included extensive exploration of the differing properties and phylogenetic signal content of different character subsets. we focus particularly on the distinction between sites undergoing non-synonymous versus synonymous substitution, and on the computational effort required to extract full information from these.

methods
taxon sampling and specimen acquisition
complete coverage of the lepidopteran families and superfamilies, many of which contain just a few, difficult-to-collect species, is beyond the reach of this initial study. our more modest aim here was simply to represent a majority of the probable major lineages of ditrysia. the distribution of our exemplars across the major clades of minet  <cit>  is shown in additional file  <dig>  which also lists families/superfamilies not sampled, to illustrate the extent of our coverage. our sampling, which builds on a preliminary study of macrolepidopteran  relationships  <cit> , is most dense in macrolepidoptera  and non-macrolepidopteran obtectomera , which together contain about 70% of ditrysian species diversity. thirty species of non-obtectomeran apoditrysia are included, representing eight of eleven superfamilies, and seven species of non-apoditrysian ditrysia representing four of five superfamilies. one of the latter, tineoidea , was used to root the tree, as tineoids are generally agreed to be the oldest superfamily of ditrysia  <cit> . we sampled relatively extensively within a few larger superfamilies, both to get an adequate estimate of ancestral character states, and to further test the resolving power of our genes within superfamilies; our main focus, however, is among-superfamily relationships. altogether our sample includes  <dig> of  <dig> superfamilies and  <dig> of  <dig> families of ditrysia. the six superfamilies not represented each contain fewer than  <dig> species. the missing families are likewise mostly species poor, the main exceptions being lycaenidae and several large families of gelechioidea. thus, the families represented in our study contain the great majority  of all species of ditrysia. the classification system used  follows the authorities in kristensen  <cit> , with exceptions as noted, including the following: in pyraloidea we follow the more recent classification of solis and maes  <cit> ; in geometridae we update the classification following hausmann  <cit> , holloway  <cit> , scoble  <cit>  and young  <cit> .

specimens for this study, obtained with the kind help of collectors around the world  are stored in 100% ethanol at -85°c as part of the atolep collection at the university of maryland . dna extraction used only the head and thorax for most species, leaving the rest of the body including the genitalia as a voucher . wing voucher images for all adult exemplars are posted at http://www.leptree.net/voucher_image_list, and dna 'barcodes' for nearly all specimens have been kindly generated by the all-leps barcode of life project http://www.lepbarcoding.org/, allowing check of our identifications against the bold   <cit>  reference library and facilitating future identification of specimens whose identity is still pending .

gene sampling and generation of dna sequence data matrices
our sequence data come from five protein-coding nuclear gene regions, identical to those used by regier et al.  <cit> , with demonstrated promise for resolving deeper lepidopteran relationships. the combined length of these regions after alignment is  <dig> nucleotides  per taxon, or  <dig> if  <dig> characters  around indel regions are excluded because of uncertain alignment. the five sequences are: cad   <cit> , ddc   <cit> , enolase   <cit> , period   <cit> , and wingless  <cit>  .

why choose these genes and exclude markers more commonly used in lepidoptera? we used protein-coding regions rather than ribosomal rna sequences because they are easier to align and their sequence evolution is easier to model. we used nuclear rather than mitochondrial protein-coding genes because the faster evolution of the latter, and their extreme base composition bias, render them less suitable for recovering deeper divergences  <cit> . for the same reasons, we did not include the "barcode" fragment of mitochondrial co-i in our analyses. we did not sequence ef-1α, the nuclear protein-coding gene most often studied in lepidoptera, because in comparisons between superfamilies, synonymous substitutions in this gene approach saturation, while amino acid changes are too few to provide much information  <cit> . we used rt -pcr, instead of the more standard genomic dna pcr, to avoid amplification of introns. this increases the efficiency of obtaining coding sequences, which are easier to interpret than introns and likely to carry on average more information on deeper divergences than introns. we intend no criticism of previous uses  of genes and gene regions excluded here, which have yielded countless valuable results at lower taxonomic levels. rather, our present choice of markers was motivated simply by the goal of obtaining as much information about deeper relationships as possible from the finite resources available for this project.

a detailed protocol of all our laboratory procedures has been published . further descriptions, including gene amplification strategies, pcr primer sequences, and sequence assembly and alignment methods, can be found in previous papers . to summarize, total nucleic acids were isolated and specific regions of the cognate mrnas were amplified by rt-pcr. specific bands resulting from rt-pcr were gel-isolated and reamplified by pcr using hemi-nested primers, except for wingless, which lacks nested primers. visible bands that were too faint to sequence were reamplified using the m <dig> sequences at the 5' ends of all primers. pcr amplicons were sequenced directly on a  <dig> dna analyzer . sequences were examined, edited and assembled using the trev, pregap <dig>  and gap <dig> programs in the staden package  <cit> . multiple sequence alignments were made manually in genetic data environment  <cit> , and a data-exclusion mask of  <dig> nucleotides was applied. alignment was generally straightforward, given the overall conservation of the protein sequences. the entire aligned data matrix in nexus format is available in additional file 2: "data matrix". genbank numbers as well as genes and taxa for which sequences are partial or missing are listed in additional file  <dig> 

congruence among genes
most of our analyses were based on the maximum likelihood criterion applied to nucleotides, as implemented in garli   <cit> . we selected the best-fitting substitution model  under the akaike information criterion , using modeltest version  <dig>   <cit> . to determine whether conflicting signal among genes might significantly complicate phylogenetic analysis, we first conducted a bootstrap analysis  for each gene separately , looking for groupings that conflicted moderately or strongly  with other individual genes, with the all-gene result, or with conventional understanding of relationships. the results are presented and discussed in additional file  <dig>  only two such conflicts were found, one previously reported  <cit> , both of which involved within-family relationships. given the rarity of inter-gene conflict, we felt justified in concatenating all five genes into a single data set for estimating the organismal phylogeny.

character sets differing in synonymous versus non-synonymous change
while heterogeneity among genes does not appear to present a major obstacle to analysis of these data, variation among sites within genes is potentially a larger problem. most phylogeny reconstruction methods for nucleotides, including those used here, assume that the relative rates of different nucleotide substitution types  are constant across the tree, and can be led astray if this assumption is violated. in our experience  <cit> , strong compositional heterogeneity, an indicator of underlying process heterogeneity, is common at sites capable of undergoing synonymous substitution. for this reason, we explored several character sets which differ strongly in the likely proportion of synonymous change. in a subsequent section  we compared compositional heterogeneity among character sets and its possible consequences.

to create a character set essentially free of synonymous change, we first isolated from the total population of first codon position sites  a subset which we term "nolrall <dig> " containing all sites belonging to codons in which no more than one leucine or arginine occurred among the taxa considered. since only leucine  and arginine  codons can undergo synonymous change through a single nucleotide substitution at nt <dig>  variation in the "nolrall2" subset should reflect mostly non-synonymous change. combining nolrall <dig> with second codon position sites  produces a character set we term "nolrall <dig> + nt <dig> " which should contain most of the total signal from non-synonymous change. the "nolrall2" subset of nt <dig> contributes  <dig> more sites to the non-synonymous category than does the similarly-motivated "nolr1" subset of regier et al.  <cit> , which excluded all sites at which even one leucine or arginine occurs. the nt <dig> subsets were generated using a perl script available in regier et al. . as a more conventional estimate of predominantly non-synonymous signal we also analyzed nt <dig> + nt <dig> alone. as an estimate of almost entirely synonymous signal we first analyzed nt <dig> alone. a second, larger set of mostly synonymous change was then obtained by combining nt <dig> with a character set we call "lrall2", which is the complement to "nolrall2" above. that is, "lrall2" consists of nt <dig> sites at which either leucine or arginine  occur in two or more taxa, opening the potential for those taxa to differ by synonymous substitutions. analysis of all nucleotides together  provides a third data set dominated  by synonymous change.

tree space and the efficacy of ml searches
for reasons developed in the discussion, we spent considerable effort on obtaining the best possible tree estimate, as well as gauging bootstrap support for that estimate. we first sought to gain some idea of how many heuristic searches might be required to consistently obtain an optimal or near-optimal tree. to this end, we first ran  <dig>  garli searches on each character set, using the default search parameters. we regarded the best-score resulting tree from this very large effort to represent the best topology that it is feasible to obtain with our computing resources. while we have no way of knowing whether this is actually the globally best tree, the chance that it is so increases with the number of times the same topology is recovered in  <dig>  trials.

to determine how many replicates to include in subsequent searches, we used the number of times  the "best feasible" topology appeared in the  <dig>  replicate searches to estimate how many search replicates would be needed to be 95% confident of getting the "best" topology at least once. in other words, for what number of replicates would the chance of never getting the "best" topology be only 5%? from the formula probabilities under the binomial distribution, that number can be expressed as x in the equation x =  <dig> , where n is the number of trials, among the  <dig>  trials, that yielded the best-score topology. estimates of the number of runs needed ranged from about  <dig> to nearly  <dig> , depending on the character set. for all subsequent analyses of each data set , we used the number of garli runs thus specified for estimating the optimal topology. node support for each character set was gauged by performing  <dig> bootstrap replicates under default search parameters. for consistency in the characterization of results, we will refer to bootstrap support of 70-79% as "moderate" and support ≥ 80% as "strong."

we also used the results of the  <dig>  heuristic searches for each data set to explore the nature of tree space in the vicinity of the best feasible topology. to gauge the tightness of clustering around the best tree, we computed the topological difference from the best topology for each of the  <dig>  trees, defined as the number of nodes collapsed in its strict consensus with the best tree. this is a variant of the consensus fork index of colless  <cit> . we also examined the frequency distribution among the  <dig>  trees of departure in likelihood score from the best score, expressed as a percent of the best score, and looked for a relationship between topological difference and likelihood score difference.

the total number of garli runs for the entire study amounted to about  <dig> . to make this large effort possible we used grid computing  <cit>  through the lattice project  <cit> , which includes clusters and desktops in one encompassing system  <cit> . a grid service for garli was developed using a special programming library and associated tools  <cit> . following the model of cummings et al.  <cit> , we distributed required files among hundreds of computers, where the analyses were then conducted asynchronously in parallel.

bayesian analysis
although analyzing character sets separately can help elucidate the evolutionary properties of each, for phylogeny inference one would ideally analyze complementary character sets simultaneously, taking into account the different substitution behavior of each. garli does not yet allow data partitioning under the gtr + g + i model. for this reason, we also performed a bayesian analysis, with the full data set  partitioned into site populations undergoing largely non-synonymous  versus largely synonymous  change. this analysis used mrbayes   <cit> . default values were used for the prior probability distribution of the parameters of the likelihood model , except that the rate multipliers of the character sets were specified to be variable. for all character sets the gamma shape parameter, proportion of invariable sites, character state frequencies, and substitution rates of the gtr + g + i model were unlinked. the markov chain monte carlo analysis was run for  <dig> million generations, and samples were taken every  <dig> generations. the analysis consisted of two simultaneous, independent runs with four chains, and samples from the two runs were pooled for the final result. all samples were taken after the two runs had converged, as indicated by a standard deviation of split frequencies smaller than  <dig>  and diagnostic analyses implemented in awty  <cit> . convergence was first seen in the  <dig> millionth generation.

testing significance of non-monophyly of predicted groupings
several groupings proposed in the composite working hypothesis  <cit>  were non-monophyletic in all of our analyses. we used the approximately unbiased  test of shimodaira  <cit>  to determine whether our data or subsets thereof significantly reject those previous hypotheses, against the alternative that the discrepancy can be explained by sampling error in the sequence data. the test determines whether the best tree possible under the constraint of monophyly, no matter what its topology may be otherwise, is a significantly worse fit to the data than the best tree without that constraint. table  <dig> lists the eight groups tested for significance of non-monophyly. for each combination of one character set and one group of uncertain monophyly, we performed a garli analysis under the constraint of monophyly for the group in question, and a parallel unconstrained analysis. each analysis used the number of garli runs determined to be appropriate for that character set as described above. the site likelihoods of the resulting best constrained tree and best unconstrained tree were then estimated with paup*  <cit> , and the trees and site likelihoods for all comparisons combined into a single input file for the consel package  <cit> . in consel, the test statistic of shimodaira  <cit>  was used to determine the difference in fit to data of the constrained and unconstrained trees, and the bootstrapping procedure of shimodaira  <cit>  was used to determine the significance of those differences.

base composition heterogeneity and its consequences
one of the most difficult problems that can affect molecular phylogenetic inference is among-lineage heterogeneity in nucleotide base composition  <cit> . to investigate the potential influence of compositional heterogeneity in our character sets, we first conducted chi-square tests of among-taxon heterogeneity on a character set undergoing mostly non-synonymous change, nolrall <dig> + nt <dig>  and on a character set undergoing mostly synonymous change, nt <dig>  in each case, the test was performed both on the entire character set, and after elimination of invariable sites in that character set. to gauge the level of taxonomic divergence over which compositional heterogeneity becomes apparent, we carried out these tests both for all taxa together and for  <dig> taxon subsets . to explore the possible consequences for phylogeny inference of the compositional heterogeneity revealed by these tests, we compared neighbor joining trees computed from three distances that are influenced to different degrees by compositional heterogeneity:  logdet distances, which are relatively insensitive to compositional heterogeneity  <cit> ;  ml distances based on the gtr model, which can be influenced by compositional heterogeneity; and , euclidean distances calculated on the proportions of the four nucleotide states treated as independent characters, which will reflect only compositional heterogeneity. these calculations were performed separately on nolrall <dig> + nt <dig>  nt <dig>  and nt <dig>  the calculations were carried out with paup*  <cit> , except that the euclidean distances were generated using mbe toolbox v <dig>   <cit> , after modification of the source code to correct for varying sequence lengths.

RESULTS
tree space and the efficacy of ml searches
the best-score topology occurring one or more times in a set of  <dig>  garli search replicates, taken here to represent the closest feasible estimate to the globally best tree, was found with a frequency  that differed markedly among data sets and appeared inversely correlated with the prevalence of synonymous substitutions. the "best-feasible" topology was found  <dig> times for the largely non-synonymous-change character set nolrall <dig> + nt <dig>   <dig> for nt <dig>   <dig> times for nt <dig>  and only twice in  <dig>  trials for nt3; change in the latter is almost entirely synonymous. from these numbers, we estimate  that to be 95% confident of getting the "best-feasible" topology at least once in a new analysis, one would need to perform  <dig> garli search replicates for nolrall <dig> + nt <dig>   <dig> for nt <dig>   <dig> for nt <dig>  and  <dig>  for nt <dig> alone. the result for nt <dig> strongly suggests that our searches did not find the globally optimal tree.

we also used the results of the  <dig>  heuristic searches for each data set to explore the nature of "tree space" in the vicinity of the best tree . the  <dig>  garli trees showed a broad range of topologies, and the differences of these topologies from the best tree appear correlated, across data sets, with the fraction of synonymous change . for example, the topology with the median degree of difference from the best topology  differs from the best topology in  <dig> of  <dig> nodes for nolrall <dig> + nt <dig>   <dig> nodes for nt <dig>   <dig> nodes for nt <dig>  and  <dig> nodes for nt <dig>  in general, very large numbers of trees differ only slightly in likelihood score from the best tree, yet these trees can differ dramatically in topology . for example, 40% of all  <dig>  trees for nt <dig> have likelihood scores within  <dig> % of the maximum score, yet these can differ from the best tree at up to  <dig> nodes. tree score difference is only loosely correlated with topological difference. for example, trees for nt <dig> that differ in score from the best by between  <dig> % and  <dig> % span a broad range of topological differences from the best tree, from five to  <dig> nodes not shared .

phylogeny estimates from the four character character sets
the best trees found in the ml and bayesian analyses are shown in condensed form in fig.  <dig>  with each terminal taxon representing a family or fraction thereof that proved monophyletic. support values are shown on the branches. the bayesian tree shown is a majority rule consensus of the trees sampled from the markov chain process. for comparison, the expected relationships among  these families under the composite working hypothesis  <cit>  are shown in fig. 2a. the complete 123-taxon ml tree for nt <dig>  together with bootstrap values for nt <dig>  nt <dig> and nolrall <dig> + nt <dig>  as well as bayesian posterior probabilities for nt <dig>  is shown in fig.  <dig>  full ml trees in phylogram format, and bootstrap majority rule consensus trees, are presented for all data sets in additional files  <dig>   <dig>   <dig>  and  <dig>  the full 123-taxon majority-rule consensus of trees sampled during the bayesian analysis, with associated posterior node probabilities, is given in additional file  <dig> 

the ml tree and the bayesian consensus tree for nt <dig> were largely identical, with just five discordant nodes . the ml trees for nolrall <dig> + nt <dig> and nt <dig> were quite similar to each other, and only slightly less so to the nt <dig> topologies. the nt <dig> topology, in contrast, differs markedly from all the others, and will be discussed in a subsequent section. for the ml analyses apart from nt <dig>  bootstrap support levels are generally high near the tips of the trees, typically within and among closely related families, whereas support at deeper levels - among superfamilies or more inclusive clades - is very weak, with almost no nodes reaching bp of even 50%. in striking contrast, support at deeper levels in the bayesian analysis is very high, with posterior probabilities along the "backbone" of the tree nearly all  <dig> ; support at shallower levels is, if anything, weaker.

comparison of the molecular trees  to the morphology-based working hypothesis  can be summarized as follows, proceeding from more-inclusive to less-inclusive groupings. on the broadest scale, there is rough agreement with division of ditrysia into four successively nested clades  <cit> , but with major exceptions. in all analyses there is a clade consisting of most but not all of the superfamilies of minet's macrolepidoptera, with membership varying slightly among data sets. for nt <dig>  this clade includes geometroidea, bombycoidea, lasiocampoidea, and noctuoidea, as well as mimallonoidea, drepanoidea and cimelioidea ; placement of the last three is variable for nolrall <dig> + nt <dig> and nt <dig>  in a substantial departure from expectation, however, the pyraloidea, not traditionally considered macrolepidoptera, are always grouped with these core macrolepidopterans, whereas the butterflies sensu scoble  <cit>   are always more distantly related. the exact position of the butterflies sensu scoble varies considerably among data sets, but they are always separated from core macrolepidoptera + pyraloidea by at least one lineage containing non-macrolepidoptera. the remaining macrolepidopteran was the single representative of calliduloidea, which was variably placed but never grouped with core macrolepidopterans, though it sometimes grouped within butterflies .

the other hypothesized major clades are also at best partially congruent with the molecular trees. the obtectomera are never monophyletic, both because of the variable position of the butterflies sensu scoble, and because each of the non-macrolepidopteran obtectomerans apart from pyraloidea, i.e., thyrididae, hyblaeidae and carposinidae, is quite unstably placed, sometimes grouping with non-obtectomerans. however, these last three groups are also allied often  with either core macrolepidoptera or butterflies, and in the nt <dig> analysis, all obtectomera except thyrididae and callidulidae form a monophyletic group. in contrast, even near-monophyly is never supported for apoditrysia, as the two non-apoditrysian groups yponomeutoidea + gracillarioidea and gelechioidea are always nested  within lineages that consist otherwise only of apoditrysians.

support is similarly variable for two smaller-scale proposed groupings of superfamilies   <cit> . the hypothesized clade consisting of butterflies sensu scoble plus geometroidea, drepanoidea, cimelioidea  and calliduloidea is never close to monophyletic; indeed, no subset of even two of these superfamilies is consistently grouped together. in contrast, the proposed grouping of zygaenoidea + sesioidea + cossoidea is recovered fully by nt <dig>  and is at least paraphyletic in trees for other data sets, although the predicted relationship among these superfamilies ) was never seen. the butterflies sensu scoble  <cit>  were monophyletic for data sets excluding nt <dig>  however, the widely accepted relationships among the superfamilies ) were never recovered; the hedyloids always grouped with the hesperioids, and these with nymphalidae + pieridae, to the exclusion of papilionidae, rendering papilionoidea non-monophyletic. monophyly of the "bombycoid complex"  <cit>  is not supported, as mimallonoidea never group with bombycoidea + lasiocampoidea. only a single relationship among superfamilies received even moderately strong support in this study: the lone representative of gracillarioidea was invariably grouped with the two yponomeutoidea, with bootstrap support as high as 79% .

the ml bootstrap support for nodes corroborating or contradicting the broad groupings just discussed is typically very weak . more support is evident, and congruence with previous hypotheses greater, for groupings at or near the superfamily level. nine previously defined superfamilies were represented in our sample by more than one family. monophyly was recovered in full for pyraloidea and gelechioidea in all analyses, with bootstraps sometimes > 60%, and for bombycoidea in nearly all analyses, with weaker support. in three other cases, monophyly was consistently supported for a group consisting of at least a significant fraction of the families including the nominate family, and/or a plausible re-circumscription of the superfamily, with bootstrap support most often > 50% and sometimes > 80%. geometroidea, if re-defined to include epicopeiidae  were always monophyletic, though never with bp ≥ 50%. a core subset of zygaenoidea , excluding only the enigmatic, highly divergent, parasitic families epipyropidae and cyclotornidae, was always monophyletic, sometimes with strong support ; zygaenoidea as a whole are monophyletic in the ml nt <dig> analysis, albeit with weak support. noctuoidea were always monophyletic, with moderate to very strong support , except that doa , by far the longest-branched noctuoid exemplar, was never included. doa grouped weakly instead with cimeliidae  or drepanidae. this result was so surprising that we re-checked the identity of our doa specimen, and re-extracted and partially re-sequenced it, to rule out laboratory error. monophyly or near-monophyly was always lacking for three superfamilies, including drepanoidea as discussed above. the two families of sesioidea, sesiidae and castniidae, varied in position but always grouped separately with other taxa, never strongly but sometimes with bp > 50%. papilionoidea, as we have seen, were always paraphyletic with respect to both hedylidae and hesperiidae.

the strongest resolution provided by our data lies within superfamilies and families. most multiply-sampled families are recovered as monophyletic by nolrall <dig> + nt <dig>  nt <dig> and nt <dig>  often with very strong bp support. apart from noctuidae and bombycidae, both of which have been previously shown to be non-monophyletic  <cit> , only cossidae are consistently non-monophyletic for all three data sets, albeit without even modest contrary bootstrap support. the nt <dig> analysis also fails to recover lacturidae. within several of the families and superfamilies that we sampled most extensively, including geometridae, pyraloidea, noctuoidea and tortricoidea, our results provide some of the first strong tests of hypothesized relationships. these findings are presented in detail in the discussion.

tests for significance of non-monophyly
the results of the approximately unbiased tests  <cit>  for significance of non-monophyly, carried out on eight previously hypothesized higher taxa that were never recovered in our trees, are presented in table  <dig>  this test is especially useful for assessing the confidence we can place in conclusions based on partial resolution of relationships, in cases such as the present one, where the data do not unambiguously resolve most or all individual nodes on the tree. by this test, monophyly can be confidently rejected for the hypothesized clade consisting of butterflies sensu scoble  <cit>  + geometroidea + drepanoidea + cimelioidea + calliduloidea  <cit> , as p is less than  <dig>  for all three character sets. monophyly of macrolepidoptera is rejected significantly by nt <dig> , but not by either nolrall <dig> +nt <dig>  or nt <dig> . strongly suggestive evidence is also seen for rejection of drepanoidea as currently defined . for the remaining five predicted groups, the data do not argue strongly against monophyly.

pairwise differences and rates of substitution
uncorrected pairwise differences among all  <dig> species, an approximate indicator of the prevalence of multiple substitutions , are mainly in the range of 50-58% for nt <dig>  while those at nolrall <dig> + nt <dig> are in the range of 3-8% . nt <dig> accounts for about 90% of the total character change in the nt <dig> data set under likelihood analysis, despite comprising only 33% of the total characters . in contrast, nolrall <dig> + nt <dig> contributes only about 9% of total character change despite comprising 58% of all characters. in addition to nt <dig>  the lrall <dig> character set  also can undergo synonymous change; its average rate of substitution is quadruple that of the remainder of nt <dig> characters , in which synonymous change cannot be detected.

a based on likelihood analyses of 5-gene, 123-taxon character sets and subsets. the single constraint tree on which parameters are optimized is derived from analysis of nt <dig> 

a, number of characters; b, average number of substitutions per character across all branches; a × b, tree length = number of substitutions for all characters across all branches. numbers in parentheses represent comparisons to the nt <dig> values, defined as  <dig> .

nucleotide composition heterogeneity and its phylogenetic consequences
the results of chi-square tests for compositional heterogeneity are shown in table  <dig>  neither for all taxa nor for any of the  <dig> taxon subsets could homogeneity be rejected for the nolrall <dig> + nt <dig> character set. even with invariant characters  removed, only zygaenoidea were significantly non-homogeneous, due in part to the highly divergent taxon epipyropidae. in contrast, nt <dig> showed highly significant heterogeneity across all  <dig> taxa and within all  <dig> taxon subsets as well.

zygaenoidea,
no cyclotornidae,
zygaenoidea,
zygaenoidea,
compositional heterogeneity in nt <dig> may account for some of the unusual properties of the ml topology derived from nt <dig> alone . that tree, as noted earlier, differs strikingly from those for all other character sets, and fails to recover a number of groupings strongly supported both by other character sets and by morphology. for example, it breaks up the strongly-supported families geometridae, uraniidae and zygaenidae. the nt <dig> tree also has markedly lower support levels than those for other data sets. despite providing about 90% of the total character change, the nt <dig> character set alone yields bootstrap support > 50% for only about half as many nodes  as does the full data set , fewer even than the nolrall <dig> + nt <dig> character set .

more direct evidence that compositional heterogeneity can affect trees based on nt <dig> alone comes from comparison of the nj trees computed from logdet distances, which correct for compositional heterogeneity, to those computed on ml distances on the gtr + g model, which do not . for nt <dig>  these two trees are very different from each other, sharing only  <dig> of a possible  <dig> nodes. for nolrall <dig> + nt <dig>  in contrast, they are quite similar, sharing  <dig> of  <dig> nodes. the case for an influence of composition is further supported by the neighbor joining analysis of pairwise euclidean distances computed from just the proportions of the four nucleotides in each taxon . the range of the compositional distances themselves  is about  <dig>  times greater for nt <dig> than for nolrall <dig> + nt <dig>  the tree for nolrall <dig> + nt <dig> tree is mostly comb-like with short branches, consistent with prevailing compositional homogeneity. the few distinct clusters, reflecting shared deviation from typical composition, appear to group taxa that are missing a relatively high proportion of data, frequently in the same gene regions. thus, such compositional heterogeneity as is evident in nolrall <dig> + nt <dig> is apparently due to intra- and/or inter-genic heterogeneity coupled with differential sampling of those regions. none of the obviously incorrect groupings  based on composition alone are also found in likelihood or distance analysis based on standard substitution models. the results of the corresponding analyses of nt <dig> are very similar, providing likewise little evidence for an influence of composition that contradicts very strong previous evidence.

the results for nt <dig> alone are very different. here, groupings in the composition-based nj tree appear to be largely independent of missing data, reflecting instead real differences in mean composition among taxa. in several instances, groups based only on composition match clearly incorrect groupings seen in the ml tree and the nj tree on ml distances . for example, the most derived group in the nt <dig> nj tree based on composition pairs one species of uraniidae with one species of geometridae, and these together with tortricidae. similar though not identical groupings are seen in the nj tree on gtr distances, reaching bootstrap support as high as 77% and 78%, and also in the ml tree of fig. 2f. thus, it appears that in the case of nt <dig> alone, sufficiently aberrant composition can sometimes overwhelm true phylogenetic signal.

discussion
in this section we first review the implications of our findings for the analysis of molecular data on deep-level lepidopteran relationships. we then review the bearing of our results on current understanding of those relationships themselves.

heuristic search efficiency and computational effort
in preliminary analyses prior to those described here we had repeated each garli run  <dig> times , a typical number in applications of this program so far  <cit> . surprising discrepancies between the initial tree estimates for different character sets prompted us to wonder if these were really the best available estimates. the ensuing, much more extensive tree searches reported here revealed, first, better trees for all data sets. moreover, for all data sets except nt <dig>  the same best topology was found many times  in  <dig>  searches, making it plausible, though not provable, that we actually found the global ml topology.  also revealed by these searches were  surprisingly large sets of near-best trees, with only slightly lower likelihood scores, yet including topologies strikingly different from the best tree, underscoring the limited resolving power of our data.

we tentatively conclude from these results that garli analyses of data sets the size of ours should routinely include not just tens of searches but hundreds, if one wants to be confident of having the best feasibly obtainable tree. but, given that the differences between our initial trees and the better ones found subsequently are very weakly supported by any measure , is the improvement worth the large additional computational effort? the answer is often likely to be yes, for at least two reasons. first, some types of hypothesis tests for which tree estimates are used do not explicitly take topological uncertainty directly into account, thereby placing a premium on the accuracy of the input tree. for example, in our study, the improved tree estimates generally raised the p values of the significance tests for non-monophyly of previously-proposed groups, as compared to those based on the initial trees found using just  <dig> garli searches . in  <dig> total comparisons, the new p value was equal to the initial one in two, moderately to substantially larger in ten, and smaller  in just four. these differences were caused specifically by change in the unconstrained tree estimates.

a second reason to value even small, hard-won improvements in likelihood score is that some problems, including ditrysian phylogeny, may be difficult enough to resist strong resolution by any one data source for a long time to come. in the interim, the most convincing means of favoring one hypothesis over another may be congruence among multiple data sets, each providing only weak support by itself. thus, credibility is lent to the phylogeny estimates presented here, despite their low support levels, by the fact that very similar relationships among lepidopteran superfamilies are emerging from an independent molecular study using a different but comparable gene sample, and a larger taxon sample .

support levels and possible reasons for low bootstrap support at deeper levels
the overall pattern of bootstrap support in our ml analyses is that families and divergences within them are generally strongly supported; superfamilies and divergences within them are only sometimes strongly supported; and relationships among superfamilies almost always have very weak support, with bootstraps often < 20% .

why is support along the "backbone" so low? there are several possibilities. first, given the extensive search needed to find the best feasibly-obtainable ml trees, low ml bootstrap support at deeper levels might be thought to reflect insufficient effort - a single garli search - on each pseudo-replicate. search effort surely has some effect on bootstrap efforts, but we doubt that it is the main explanation. the literature on per-replicate search effort required for accurate bootstrap percentage estimation  <cit> , while limited thus far to parsimony analyses, suggests that a plateau in mean bp is quickly reached as one increases heuristic search effort from simplified fast methods to somewhat more elaborate methods  to full standard search methods . it further suggests that the plausible prediction of increased bp with more thorough searches is realized mainly for bp values which were low to begin with. preliminary experiments included in our initial analyses  point in the same direction: very low initial bp values sometimes increased substantially  with increased search effort per pseudo-replicate, but never reached moderate or strong levels ; initially high bp values  changed little with increased pseudo-replicate search effort.

strong conflict among genes is a second possible explanation for low bp values at deeper levels, but in our data set, the rare instances of such conflict are restricted to within-family relationships . support might have been higher had our ml analysis modeled synonymous and non-synonymous character sets separately, but the near-identical topologies produced by our unpartitioned ml and partitioned bayesian analyses for all nucleotides suggests that the effect would not be dramatic. the most plausible explanation for low support is that the branches along the "backbone" are very short, as evidenced in the phylogram of fig.  <dig>  in contrast to the very long branches subtending some superfamilies  and/or subgroups therein. short internodes along the "backbone", which may reflect rapid radiation, suggest that very large amounts of sequence, as well as more accurate modeling of character change, will be needed to firmly resolve these nodes.

in contrast to low support under ml, posterior probabilities along the "backbone" in the bayesian analyses were very high, mostly  <dig> . the sole purpose of our bayesian analysis was to examine the effect of partitioned analysis on tree topology. the interpretation of the associated posterior probabilities is problematic, due to their often-reported tendency toward "overcredibility" . lewis et al.  <cit>  attribute "overcredibility" to the failure of the tree-proposal step in current bayesian phylogenetic algorithms to allow the possibility of polytomies. in the absence of true signal, this restriction can artificially confer very high posterior probabilities on arbitrary resolutions. this explanation seems quite consistent with our findings.

differing properties among character sets and their implications
several potential benefits motivate our focus on separating and independently analyzing sites undergoing synonymous versus non-synonymous change, as exemplified by our distinction between the character sets "nolrall <dig> + nt2" and "lrall <dig> + nt3". these categories can be defined in all protein-coding sequences, and the substitutions they undergo are known to follow markedly different rules. to some extent, then, they provide independent lines of phylogenetic evidence, thereby boosting our confidence in groupings that they separately recover. separate analysis also allows us to discover the evolutionary properties peculiar to each, and to account for these when considering the two character sets together. thus, it is reassuring that although there are numerous differences in detail involving nodes with little support, particularly at deeper levels, trees based on nolr + nt <dig>  nt <dig> and nt <dig>  which though not fully independent span a gradient from entirely non-synonymous to predominantly synonymous evolution, are quite similar overall. they are generally concordant for nodes with modest to strong bp support. even moderately strong conflict - reciprocal bp ≥ 70% support for incompatible groupings - is essentially absent.

analysis of nt <dig> alone, however, complicates the picture. despite contributing about 90% of the total evolutionary change for nt <dig>  nt <dig> by itself provides relatively weak resolution, and fails to recover many well-established nodes. yet when added to nt <dig> +  <dig>  it can often greatly increase support for those nodes , particularly at shallower levels, providing dramatic examples of "hidden support"  <cit> . on the other hand, adding nt <dig> sometimes markedly decreases support for deeper nodes, e.g. gelechioidea, "core" zygaenoidea, yponomeutoidea + gracillarioidea. nt <dig> seems to contain a complex mixture of true phylogenetic signal and conflicting signal from non-phylogenetic sources. the latter undoubtedly stems in part from non-homogeneity of base composition. it appears that for shallower divergences the non-phylogenetic signal in nt <dig> is relatively easily overcome by the addition of non-synonymous signal. for deeper divergences, in contrast, it appears that either true phylogenetic signal at nt <dig> is weakened by saturation, or non-phylogenetic signal becomes relatively stronger, or both, leading typically to less resolving power. and yet, nt <dig> does carry some true signal for deeper divergences, possibly because it undergoes at least some non-synonymous change. for example, it is probably not coincidence that only with nt <dig> included do we completely recover, albeit with weak support, both zygaenoidea and sesioidea + cossoidea + zygaenoidea. our analyses of nt <dig> alone provide one of the first examples of an influence of compositional heterogeneity on estimated phylogeny at relatively low taxonomic levels; previous demonstrations have mostly involved much deeper divergences . one might take comfort in the disappearance of the obvious effects of composition on topology when nt <dig> is combined with other character sets. compositional heterogeneity remains a likely contributor, however, to the instability and lower support that inclusion of nt <dig> brings to some deeper-level groupings. the problem cannot be easily dismissed.

given that different character sets can differentially support, and/or obscure, each individual node, treating all character sets as belonging to a single population of characters  is clearly not the most effective way of extracting phylogenetic information from the data set. ideally, one would analyze all character sets simultaneously, using a model that fully accounted for the differences in evolutionary behavior among them. the widely-available methods for partitioned analyses, however, do not yet include correction for heterogeneity of nucleotide composition, a key point of difference between mainly synonymous and mainly non-synonymous character sets. in the review below, we therefore adopt an interim strategy for assessing progress on ditrysian phylogeny: a group is considered to be supported by the data set as a whole to the degree that it is  strongly supported by one or more character sets, and  at most weakly contradicted by others. at present, no single analysis can tell the whole story.

current understanding of ditrysian phylogeny
in this section we ask, how much progress did this exploratory study yield toward a robust phylogeny estimate for ditrysia, and toward testing the working hypotheses compiled by kristensen  <cit> ?

the near-total lack of strong support for nodes subtending multiple superfamilies, with especially low bootstraps along the "backbone", is sobering. we expected more from  <dig>  kb of sequence data chosen specifically for their suitability for addressing this problem. it appears that robust node-by-node resolution of among-superfamily ditrysian relationships will require several to many times as much sequence as analyzed here, in addition to expanded taxon sampling, particularly among the non-obtectomeran lineages. fortunately, two independent efforts to provide such additional data are underway .

low bootstraps for deep nodes notwithstanding, however, our current data do provide important first steps toward resolving ditrysian phylogeny. how can this be? conventional bootstrap values can greatly underestimate the amount of structure present in a large, noisy data set, because they take into account only nodes that agree completely between pseudo-replicate trees, ignoring partial agreement on those groupings  <cit> . thus, given the taxon sample size, we think that the approximate overall concordance of our trees with the "backbone" hypothesis in fig. 2a is unlikely to be accidental, despite the lack of bootstrap support. our results provide some of the first quantitative phylogenetic evidence for broad subdivisions of ditrysia resembling those of minet  <cit> , albeit with important differences. the clearest point of correspondence is that all analyses apart from nt <dig> yield a clade consisting of most macrolepidoptera plus one or more non-macrolepidopteran obtectomera, and excluding all non-obtectomerans.

this mostly macrolepidopteran clade, however, also harbors one of the strongest departures from the working hypothesis. the pyraloidea, traditionally considered non-macrolepidopterans, invariably group with the "core" macrolepidoptera identified here , while the butterflies sensu scoble, always traditionally considered macrolepidopterans, never do so. despite weak support for individual nodes, the approximately unbiased test  <cit>  provides statistical evidence against monophyly of the macrolepidoptera as previously defined , significantly rejecting it for nt <dig>  although not for the other character sets. minet's  <cit>  exclusion of pyraloidea from macrolepidoptera was based on their supposed lack of his synapomorphy  <dig>  a feature of the base of the forewing. recent unpublished observations by one of us , however, strongly suggest that this feature is in fact characteristic of pyraloids. the distribution of this trait deserves further study in other superfamilies as well.

the existence of a clade comprising "core macrolepidoptera" plus pyraloidea, which we predict that future work will confirm, is likely to prompt re-examination of hypotheses about the evolution of the thoracic or abdominal ultrasound-detecting "ears" that characterize the superfamilies noctuoidea, geometroidea, drepanoidea and pyraloidea. these together contain over 90% of species in the putative clade. the "ear" found in each superfamily shows a unique location and anatomy, and has been thought to represent an independent origin. our result prompts contemplation, at least, of the possibility of fewer origins, conceivably even a single origin in the common ancestor of the proposed clade . this alternative hypothesis would require only a few independent losses of the "ear," in the ancestors of bombycoidea + lasiocampidae, cimeliidae , and sematuridae + epicopeiidae. the observation  <cit>  that the anatomy of the "ear" and/or the location of its opening can vary between sister families  or between sexes within the same family  suggests that transformation among widely differing types of "ear" is at least plausible.

the unexpected position of the butterflies is also reflected in the strongest result from our tests for non-monophyly, namely the decisive rejection  of the proposed clade aligning butterflies and allies with geometroidea, drepanoidea, cimelioidea  and calliduloidea  <cit> . in our trees, no two of these taxa consistently group with or even near each other. it seems safe to abandon this conjecture. an alternative hypothesis about phylogeny of the major macrolepidopteran groups, grouping geometroidea with noctuoidea and these together with bombycoidea + lasiocampoidea, is worthy of contemplation because it is supported, albeit weakly, in all our analyses. in contrast, placement of the several small, morphologically isolated and highly divergent macrolepidopteran superfamilies may be very difficult. the problem is illustrated by the unstable position of mimallonidae and our inability to significantly reject their alliance with bombycoidea and lasiocampoidea, despite their failure to ever group near these superfamilies.

within several large superfamilies of the "core macrolepidoptera + pyraloidea" clade, our results provide some of the first strong tests of hypothesized relationships . in geometroidea, our findings corroborate, albeit with weak support, the grouping of sematuridae, which lack abdominal tympanal organs, with uraniidae and geometridae, which possess them. a novel result is that all data sets place epicopeiidae, included in drepanoidea by the working hypothesis, either next to or within geometroidea. the strongest signal comes from nt <dig>  which resolves epicopeiidae as sister group to sematuridae , with which they share the lack of tympanal organs. within geometridae, one of the largest families of lepidoptera, we sampled all subfamilies, finding moderate to very strong support for nearly all relationships among these , and strong agreement with groupings seen in other recent molecular studies of this family  <cit> .

in noctuoidea, our findings very strongly  corroborate previous morphological and/or molecular evidence for monophyly of:  the quadrifid forewing clade of families;  within this, the clade of "trifine" hindwing subfamilies; and  a clade comprising most quadrifine hindwing noctuidae plus arctiidae and lymantriidae, excluding nolidae , contra recent morphology-based hypotheses  <cit> . the recently erected family micronoctuidae  <cit>  also appears to fall in the "laq" clade. the most surprising result is the failure of doa  to group with the remaining noctuoidea, despite its possession of the very distinctive morphological synapomorphies of the superfamily, including a metathoracic tympanal organ and two md setae on larval t <dig>  <cit> . no position for doa is strongly supported, however, and noctuoid monophyly is not significantly rejected by the approximately unbiased test. thus, it remains possible that doa will group with other noctuoids upon further gene and taxon sampling. the postulated sister group relationship between doidae and notodontidae  <cit> , on the other hand, now seems very unlikely, given the strong support  for a clade comprising all sampled noctuoidea except doa.

pyraloidea are recovered by all data sets , albeit with low support . though our sampling of subfamilies is incomplete, the five genes appear to offer strong resolution of relationships within this superfamily, including very strong bootstrap support  for monophyly of both pyralidae and crambidae as sampled. divergences among all exemplars of pyralidae, representing all five subfamilies, were strongly resolved . relationships among subfamilies nearly match a previous morphology-based tree  <cit> , requiring only a trade in position of the subfamilies pyralinae and phycitinae. in crambidae, relationships of the five  subfamilies sampled were also strongly resolved, corresponding well to the morphological hypothesis of yoshiyasu  <cit> , less well to that of solis and maes  <cit> .

in contrast to their success in the foregoing clades, our data do not strongly resolve relationships of the butterflies sensu scoble  <cit> . the three superfamilies do form a clade, but only in analyses excluding nt <dig>  and neither the monophyly of papilionoidea, nor any of the accepted relationships among the families thereof except the basal position of papilionidae, is supported by any analysis. on the other hand, the approximately unbiased test  does not reject monophyly for papilionoidea , and bootstrap supports are mostly low for groupings contradicting expectation, the highest being 68% for the unexpected pairings of hedylidae with hesperiidae and pieridae with nymphalidae. thus, apart from qualitatively corroborating scoble's grouping of macrosoma  with butterflies rather than geometridae, we are unable to strongly confirm or refute any previous hypothesis about butterfly relationships. our results raise the possibility, however, that butterfly relationships will undergo significant revision as more data accumulate.

evidence both for and against predicted relationships is less strong in the lower ditrysian lineages than in obtectomera, which were much more extensively sampled. nonetheless, some tentative conclusions emerge. two non-apoditrysian lineages are always nested well inside the apoditrysia as currently defined, the monophyly of which is consequently never supported. the pairing of yponomeutoidea and gracillarioidea, a novel grouping so far as we are aware, is the most strongly supported among-superfamily relationship in our study .

within the lower apoditrysia , one of the few previous postulates of among-superfamily relationships  <cit>  groups zygaenoidea with sesioidea + cossoidea. agreement between our analyses and previous hypotheses is ambiguous throughout this putative clade, suggesting signal too weak to be decisive. the proposed groupings are only sometimes monophyletic, and yet never strongly contradicted. the trio of superfamilies is fully recovered by nt <dig> , albeit with very weak support, and is at least somewhat coherent in the other analyses. in the nt <dig> tree , for example, it is basal and paraphyletic with respect to all other taxa except tineidae. thus, the proposed grouping sesioidea + cossoidea is never monophyletic, but in nt <dig> it is at least paraphyletic, comprising the two lineages most closely related to zygaenoidea. within this assemblage, however, neither sesioidea  nor cossidae are monophyletic in any analysis.

our data provide similarly qualified support for zygaenoidea, the monophyly of which is uncertainly established by morphology  <cit> . the eight families sampled  were grouped together by one data set, nt <dig>  but with weak support. we did however find a consistently monophyletic core group of six zygaenoid families, with bootstrap support as high as 82% . excluded from the "core zygaenoidea" were the parasitic families epipyropidae and cyclotornidae. the weakly-supported sister group relationship between these families seen in nt <dig>  seems credible, despite the exceptionally long branches subtending both, because of their bizarre shared larval habit of ectoparasitism on auchenorrhyncha. within the "core zygaenoidea" we find qualified support for the morphologically-defined "limacodid group" of families  <cit> , here represented by limacodidae, dalceridae, megalopygidae and aididae. these form a clade, weakly supported, in the nolrall <dig> + nt <dig> tree, and a paraphyletic group in other analyses. relationships within the "limacodid group" agree partially with the morphological cladogram of epstein  <cit> , in that dalceridae are most often grouped with limacodidae , albeit with weak support. the only strongly supported node, however, unites aididae with megalopygidae , in which they were formerly included, contra epstein's hypothesis grouping them with dalceridae + limacodidae. within zygaenidae our data moderately to strongly support the relationships reported by niehuis et al.  <cit>  for the three subfamilies sampled.

in tortricoidea, finally, though our sampling is limited to two of three subfamilies and six of  <dig> tribes, the five genes appear able to offer decisive resolution, as all nodes are strongly supported. support is 99-100% for monophyly of the two subfamilies as thus far sampled. the representative of cochylini, in the past treated as a separate family  <cit> , was strongly placed as sister group to the two other sampled tribes of tortricinae, consistent with the proposal of kuznetsov and stekolnikov  <cit> .

CONCLUSIONS
the five genes/ <dig>  kb and  <dig> species analyzed here provide sufficient information to:  corroborate the broad outlines of the current working phylogenetic hypothesis for ditrysia;  conclusively demonstrate that several prominent features of that hypothesis, including the position of the butterflies, need revision; and,  strongly resolve the majority of family and subfamily relationships within superfamilies as thus far sampled. however, these data alone cannot strongly resolve node-by-node relationships among superfamilies of ditrysia. such resolution will clearly require a substantial increase in both sequence and taxon sampling. moreover, given the complexity of character variation at deeper levels of divergence, especially the saturation and strong compositional heterogeneity characterizing nt <dig>  full resolution of ditrysian relationships will require careful dissection of true from misleading phylogenetic signal.

abbreviations
bp: bootstrap percentage; garli: genetic algorithm for rapid likelihood inference  <cit> ; gtr + g + i: general time reversible substitution model with gamma distribution correction for among-site rate variation and a separate class of invariant sites; ml: maximum likelihood; nj: neighbor-joining tree-building algorithm; nt <dig>  nt <dig>  nt3: codon position  <dig>  codon position  <dig>  codon position  <dig>  respectively; nolrall2: subset of nt <dig> sites  which excludes all those occurring in codons which specify either leucine in two or more taxa, or alanine in two or more taxa; lrall2: complement of the preceding; a subset of nt <dig> sites which includes only those occurring in codons which specify either leucine in two or more taxa, or arginine in two or more taxa; rt-pcr: reverse transcription from mrna; followed by dna pcr.

authors' contributions
jb, jwb, sc, mpc, drd, ah, ayk, cm, cp, jcr, ar, and sw participated in the design and coordination of the study. jba, jb, sc, drd, me, wh, ah, dhj, ayk, ijk, cm, mas and shy collected and identified specimens. jcr directed, and jcr and sc participated in, generation and alignment of the sequence data. mpc, ayk, jcr, az and alb performed the phylogenetic analyses, which were led by az. mpc, cm, cp, jcr, ar, sw and az participated in drafting the manuscript, coordinated by cm, and all the authors participated in the editing of the manuscript. all the authors read and approved the final manuscript.

supplementary material
additional file 1
specimen information and genbank numbers. for each specimen sequenced we list superfamily, family, genus and species name, code name, collection locality, genbank accession numbers for all sequences, and missing and partial sequences. numbers after the superfamily name indicate number of families sampled/number of families total. an l in parentheses after the species name means the specimen sequenced was a larva; a p in parentheses means it was a pupa. all other specimens were adults. an 'x' in the genbank number table means that no sequence was obtained for that gene in that taxon.

click here for file

 additional file 2
data matrix. the final sequence alignment, excluding alignment-ambiguous regions, is presented in sequential nexus format. the file includes charsets for different genes, nucleotides and lr/nolr. taxon names are the code names given in additional file  <dig> 

click here for file

 additional file 3
single-gene bootstrap analyses. we present a table of bootstrap values obtained from a separate analysis of all nucleotides for each gene, for all nodes on the all-nt ml tree plus all other nodes supported by bp of 50% or greater by any gene. we summarize the evidence on bootstrap-supported groupings that conflict with those found for other individual genes, with the all-gene result, and with conventional understanding of relationships, and examine the two instances of strong conflict.

click here for file

 additional file 5
nt <dig> bayesian analysis, partitioned nolrall <dig> + nt <dig> vs. lr + nt <dig>  majority rule consensus of trees sampled from partitioned bayesian analysis of nt <dig> with partitions nolrall <dig> + nt <dig> versus lrall <dig> + nt <dig>  two runs,  <dig> trees sampled from each, with standard deviation of split frequencies <  <dig> .

click here for file

 additional file 6
123-taxon ml tree & bootstrap for nolrall <dig> + nt <dig>  part a: nolrall <dig> + nt <dig> best ml tree found in  <dig>  replicate garli searches, gtr + g + i model, phylogram format. part b: nolr2all + nt <dig> bootstrap majority rule consensus tree, generated in paup, from  <dig> garli ml bootstrap replicates, gtr + g + i model.

click here for file

 additional file 7
123-taxon ml tree & bootstrap consensus tree for nt <dig>  part a: nt <dig> best ml tree found in  <dig>  replicate garli searches, gtr + g + i model, phylogram format. part b: nt <dig> bootstrap majority rule consensus tree, generated in paup, from  <dig> garli ml bootstrap replicates, gtr + g + i model.

click here for file

 additional file 8
effects of compositional heterogeneity on inferred relationships, compared between nt <dig> and nolrall <dig> + nt <dig>  part a. analysis of variable nt <dig> characters. part b. analysis of nolrall <dig> + nt <dig> characters.

click here for file

 additional file 9
123-taxon ml tree & bootstrap consensus tree for nt <dig>  part a. nt <dig> best ml tree found in  <dig>  replicate garli searches, gtr + g + i model, phylogram format. part b. nt <dig>  bootstrap 50% majority rule consensus tree, generated in paup, from  <dig> garli ml bootstrap replicates, gtr + g + i model.

click here for file

 additional file 4
123-taxon ml tree & bootstrap consensus tree for nt <dig>  part a: nt <dig>  best ml tree found in  <dig>  replicate garli searches, gtr + g + i model, phylogram format. part b: nt <dig>  majority rule consensus tree from  <dig> garli ml bootstrap replicates, generated in paup.

click here for file

 acknowledgements
we are greatly indebted to generous colleagues for supplying specimens for this study, including j. k. adams, d. adamski, k. nishida, v. becker, n. bloomfield, t. burbidge, j. farr, g. clarke, r. f. denno, e. edwards, m. fibiger, t. friedlander, j. giebultowicz, r.j.b. hoare, k. r. horst, r. hutchings, n. hyde'n, w. kelly, r. leclerc, m. j. matthews, n. mcfarland, d. messersmith, a. mitchell, r. poole, k.-t. park, j. o. nelson, e. s. nielsen, r.s. peigler, k. pullen, r. robertson, g. tremewan, a. venables, a. willis, and k. wolfe. suwei zhao and kongyi jiang provided technical assistance, and k. mitter made essential contributions as specimen collection and database manager. we are grateful to m. mutanen, l. kaila, n. wahlberg for permission to cite their work in progress. we thank d. sean brady, sonja scheffer and the five anonymous reviewers for helpful comments on the manuscript. financial support was provided by the u.s. national science foundation's assembling the tree of life program, award numbers  <dig> and  <dig>  and by nsf grants bsr  <dig> and deb  <dig>   <dig>   <dig>   <dig>  and  <dig> to dhj.
