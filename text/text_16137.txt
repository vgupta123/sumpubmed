BACKGROUND
the power of genome-wide association studies  to discover common genetic variants associated with complex traits has been empirically demonstrated  <cit> . the single-snp analysis tests genetic association on individual snps and identifies only the most significant snps because of the stringent statistical criteria necessary for minimizing false positive hits. the identified snps, however, represent only a small fraction of the genetic variants contributing to complex traits; the majority of the variations remain hidden within the statistical ''noise''  <cit> . genetic variants with small individual effect sizes but jointly significant genetic effects would be missed by single-snp analysis. as a result, identified genetic variants only explain a small fraction of heritability for most studied traits <cit> .

it is increasingly recognized that pathway-based analysis, which considers cumulative association between the outcome and a group of snps or genes in a biological pathway, can greatly complement the single-snp approach in understanding genetic determinants of common diseases as well as providing insight into the biological process of complex diseases  <cit> . a pathway-based analysis by baranzini et al  <cit>  not only confirmed previously identified immunological pathways but also found that neural pathways might be responsible for multiple sclerosis. joel hirschhorn  <cit>  pointed out that for many diseases, different risk loci are often clustered in a common pathway, so when a study highlights the role of one or a group of loci in a disease, it also provides important insights and predictive information on the role of other loci within the same biological group. he argued that the primary goal of genome-wide association studies should not be the prediction of individual risk loci but rather the discovery of biological pathways underlying polygenic diseases and traits. the genetic variants revealed in pathway-based analysis could be used to build predictive models for complex diseases, and provide insights on how multiple genetic variants jointly contribute to the etiology of complex human diseases.

one approach for pathway association analysis of gwas is to extend the gene set enrichment analysis  method, which has been successfully applied in gene expression data analysis  <cit> . however, a key difference between gene expression analysis and gwas analysis is that each gene in gwas is represented by many snps. the challenge is to determine the number as well as which snps are the best representatives for each gene.

most of the current methods for pathway analysis of gwas data are gene-based. wang et al.  <cit>  used the snp with the strongest association to represent a gene. choosing the smallest p-value for each gene might not be optimal in situations when the joint action of multiple snps within a gene explains more variance than the most significant snp. for example, if a gene contains multiple causal variants, it might not be identified by the smallest p-value method, which reduces the power of the subsequent pathway enrichment analysis. moreover, this approach is likely to favour genes of large sizes, as genes with a larger number of snps have a higher chance of having significant snps, by chance alone. consequently, the effects of genes with smaller numbers of snps would be underestimated. holmans et al.  <cit>  proposed aligator  method to study the significance of pathways. although this method corrects variable gene sizes by simulations, it requires a pre-determined p-value cutoff for selecting significant snps and the evaluation of pathways is gene-based, not snp-based. yu et al.  <cit>  used an adjusted p-value for each gene, and also treated gene as the basic unit for analysis. since the gene-based approaches focused on testing significance at the gene-level, they may have low power to detect pathways containing only a few genes <cit> .

recently, holden et al.  <cit>  proposed a snp-based pathway analysis, which used all available snps to represent a gene. this approach is computationally intensive and might not be practical for genome-wide studies with millions of snps. o'dushlaine et al.  <cit>  developed a snp ratio test  method which computed the ratio of the number of significant  to the number of non-significant  snps for each pathway and used permutations to identify the significant pathways. the snp ratio test  method computes the ratio of the number of significant  to the number of non-significant  snps for each pathway, and uses permutations to quantify its statistical significance. if there is only one gene that contains significant snps, the srt method would reduce the pathway signal to a gene signal. by contrast, our method uses adaptive rank truncated product and permutations to determine the number of representative snps for each gene, and each gene includes at least one snp. therefore contributions from multiple genes are emphasized in the pathway analysis. another disadvantage of the srt method is that it treats all significant snps equally, which can lead to a reduction of power in detecting significant pathways.

to address these limitations, we propose a new snp-based pathway analysis method, called snp set enrichment analysis , for gwas studies. ssea consists of two main steps: selecting representative snps for each gene, and performing pathway enrichment analysis using all selected snps. in the first step, we exploit an adaptive rank truncated product method with permutations to choose the most significant subset of snps for each gene. the number of snps representing a gene is not predetermined, but data driven. then for each pathway, we calculate the average number of representative snps for the genes within this pathway and re-select snps using this number. in the second step, we modify the existing gsea algorithm  <cit>  to conduct the pathway enrichment analysis using all selected snps. we rank all snps selected from the first step based on their strength of association with the trait, and then test whether the set of snps associated within a pathway is significantly enriched with high ranks using a weighted kolmogorov-smirnov test. because this test is rank-based, snps with smaller p-values tend to contribute more in a pathway.

methods
adaptive rank truncated product of snp association
one difficulty in extending the pathway enrichment analysis of genes to snps is the many-to-one mapping from snps to genes. generally, assigning the most significant snp to a gene might miss other informative snps, while assigning too many snps to a gene might introduce noise and decrease statistical power. both would introduce bias into the following pathway enrichment analysis. we select the best representative subgroup of snps for each gene in the following way.

for each snp, a p-value is obtained by comparing the genotype frequencies between the cases and controls using the pearson's chi-square test with two degrees of freedom. extending the work of yu et al.  <cit> , we use an adaptive rank truncated product method. the l p-values of the l snps mapped to a gene are sorted from smallest to largest: p ≤ p ≤ ... ≤ p, with p being the lth smallest p-value. we use  to combine the first k p-values, where k is the truncation point. permuting the phenotypes and computing the statistic in permutated data allows us to assess the overall significance of the k snps. in the permutation procedure, we permute the phenotype values n times to obtain n permutated datasets. for the nth permutated dataset, we denote the resulting p-values as , and calculate the corresponding . then the p-value for evaluating w is calculated by . to maximize the association of the subset of snps and the trait, all possible values of k are calculated and the one with the smallest p-value is chosen. the corresponding snps are used to represent the gene.

to avoid genes with larger number of snps dominating a pathway in the following snp set enrichment analysis, and to let the contributions by more genes be emphasized in pathway analysis, we require genes in the same pathway have the same number of representative snps. therefore, for each pathway, we calculate the average number of representative snps of genes and re-select snps using this number in the given pathway.

the computation needed for selecting representative snps for genes involves hundreds of permutations of thousands of subjects, recalculating the test statistic in each permutation based on about half a million snps, and testing on multiple values of the cutoff  point k. one way to limit the computational effort is to set the upper limit kupper to  <dig> for the truncation point k. to further reduce the computational cost, we discard snps with large nominal p-values. on the other hand, if too few snps are selected, we might miss snps have low or moderate individual effects but jointly show a moderate or large effect. to seek a balance, we set a nominal threshold that is generous, say  <dig> , i.e, only snps with p-values less than or equal to  <dig>  will be selected. however, if none of the snps for a gene passes the threshold, the smallest snp would be selected to avoid missing too many genes in pathway analysis. both kupper and p-value thresholds are changeable in our software; other values can be used depending on the situation. in our experiment, we found that  <dig> as kupper and  <dig>  as the p-value threshold are useful choices.

snp-based pathway enrichment analysis
to conduct pathway analysis of snp data from gwas, we modified an existing gene set enrichment analysis  algorithm  <cit> . the original gsea algorithm ranks all genes by their significance of differential expression and then looks for groups of biologically relevant genes that are enriched at either the top or bottom of the ranked list. to apply this idea to snp data, we take the n selected representative snps across all the genes to form the snp list, and compute the p-values for comparing genotype frequencies between cases and controls. to measure their strength of association, we define ri = Φ- <dig>  i =  <dig> ..., n, where Φ- <dig> is the quantile function for the standard normal distribution. let r ≥ r ≥ ... ≥ r be the sorted values from largest to smallest. a gene set sharing the same functional pathway is converted to a pathway consisting of snps. for a snp-based pathway with nh snps, we calculate a weighted kolmogorov-smirnov-like running sum  <cit>  to measure the deviation of the pathway from a set of randomly picked snps in the genome:  

with. here p is a parameter that controls the weights to ensure snps with higher r values tend to contribute more in the pathway level. following the original gsea algorithm, we set p =  <dig> 

statistical significance evaluation
the enrichment score is expected to be high if most snps within a pathway are at the top of the list. we examine the statistical significance of a pathway by a permutation procedure. in each permutation, we permute  the phenotype labels, re-compute the p-values for snps and the corresponding enrichment score . due to the size of large-scale genetic data, computational complexity would become extremely high when the number of permutations is very large. we used  <dig>  permutation-cycles to generate the permutated datasets. the nominal p-value is obtained by comparing the enrichment score for the observed phenotypes with scores computed from permutated phenotypes.  

adjustment for multiple testing is applied to control false positives. when many hypotheses are tested simultaneously, the probability that at least one type i error is committed is large. one common approach for accounting for multiple testing is to control the false discovery rate   <cit> . the fdr is the expected proportion of falsely rejected hypotheses out of the rejected hypotheses. one can also control the family wise error rate , which is the probability of making one or more type i errors among the family of hypothesis tests. when the number of tests is large and some of the test hypotheses are in fact false, fwer is too conservative. since multiple pathways might be involved in a complex trait, fdr, which controls the expected proportion of false discoveries, is more suited to identifying pathways relevant to a trait. to account for multiple testing in our pathway analyses, we used a robust method to estimate the false discovery rate proposed by pounds and cheng  <cit> . the q-value is the minimum fdr at which the test is called significant. for a given significant level α, the point estimate of q-value  is defined as  

where fdr denotes an estimate of the proportion of tests when rejecting all null hypotheses with p-values less than or equal to the significance threshold t.

RESULTS
to perform snp-based pathway enrichment analysis of gwas data, we developed a java based software package called snp set enrichment analysis  by extending the original gsea code. ssea consists of four procedures as outlined in figure 1: 1) calculating the p-value of the association of each snp to a trait of interest, 2) selecting representative snps for each gene using an adaptive snp combination method, calculating the average number of representative snps for genes in each pathway and reselecting snps for gene in each pathway, 3) ranking all selected snps by their p-values and testing if the snps from a pathway are enriched with high ranks, and 4) calculating the fdr of the discovered pathways. see methods for details.

we applied ssea to two large genetically distinct gwas data sets for schizophrenia from the genetic association information network  studies  <cit> , available at the database of genotype and phenotype   <cit> . the study version we reported here is phs <dig> v <dig> p <dig> with general research use consent, which includes two samples; one is from the european american  ancestry and the other one is from african american  ancestry. individuals in those two cohorts represent two genetically distinct populations  <cit> . however, we should note that the two data sets were collected and quality controlled in a similar way, which might affect the independence of the two data sets. both samples were genotyped by the affymetrix snp array  <dig> . with gain quality-control criteria and after removing redundant subjects, the data sets included  <dig> cases and  <dig> controls in ea and  <dig> cases and  <dig> controls in aa. since linkage disequilibrium  is an important concern for selecting representative snps for each gene, we used plink http://pngu.mgh.harvard.edu/~purcell/plink/ to prune snps that are in strong ld . the final data used in our study consisted of  <dig>  snps in ea and  <dig>  snps in aa. the snps were assigned to genes on the basis of being located within the gene or up to  <dig> kb from the gene. most genes are associated with more than one snp; we applied the adaptive rank truncated product of snp association algorithm described in method to selected representative snps for each gene. for pathways, we used  <dig> experimentally validated pathways from the kegg database <cit>  .

application of ssea to the two schizophrenia data sets resulted in the discovery of  <dig> pathways in the ea data set and  <dig> pathways in the aa data set with the nominal p-value less than or equal to  <dig> . using this p-value cut-off, the overall fdr is controlled within 5% for both data sets. the list of identified pathways from each sample is shown in additional file  <dig> and  <dig>  together with the related gene information.

interestingly, the two data sets share  <dig> significant pathways; we used monte carlo simulation to assess the significance of sharing and found the p-value is less than  <dig> e- <dig>  to examine whether our method detects biologically relevant pathways or random combinations of genes, we permutated genes and generated  <dig> random pathways for both ea and aa data sets; our method only detected  <dig> significant pathways  in ea and  <dig> in aa, and none of them is shared, indicating that the number of significant pathways detected by our methods is more than what expected by chance, and those significant pathways are likely to be biologically relevant. the list of the  <dig> replicated pathways are shown in table  <dig>  together with their nominal p-values, the gene set sizes and the snp set sizes associated with each pathway, and the full list of  <dig> significant pathways in ea and  <dig> significant pathways in aa are shown in additional file  <dig> 

schizophrenia  is a complex brain disorder characterized by disturbances in multiple domains of brain function, including cognitive, emotional, and perceptual processes  <cit> . evidence for schizophrenia as a neurodevelopment disorder began more than  <dig> years ago  <cit>  and has been accepted commonly  <cit> . it is intriguing to note that the  <dig> pathways discovered by ssea in both the ea and aa samples included  <dig> pathways important for neurodevelopment and neuronal functioning, such as axon guidance pathway, neuroactive ligand-receptor interaction pathway, long-term depression pathway and long-term potentiation pathway. axon guidance pathway and neuroactive ligand-receptor interaction pathway are directly related to neuroplasticity and neuropathology, and thus are important to the genetic mechanism of schizophrenia  <cit> . long-term depression pathway and long-term potentiation pathway were reported to be important for synaptic plasticity development and related to schizophrenia  <cit> . besides, axon guidance pathway, long-term depression pathway and long-term potentiation pathway were reported in a recent study where pathways were overrepresented by genes disrupted by copy number variants in schizophrenia cases  <cit> . genes in the focal adhesion pathway are principally involved in the biological processes for synaptic transmission and cell adhesion  <cit> . in addition, arrhythmogenic right ventricular cardiomyopathy  pathway is related to cardiovascular disease, which supports the previous study that patients with schizophrenia had higher rates of cardiovascular disease and mortality compared with the general population  <cit> . we took a further investigation of gene intersections in the remaining two non-schizophrenia specific pathways. we found the calcium signalling pathway shared  <dig>  genes with long-term potentiation pathway, while vascular smooth muscle contraction shared  <dig> genes with long-term depression pathway; the same genes implicated in different pathways might be a reason for their enrichment in our study.

as a comparison, we also applied another two methods, smallest p-value and plink set-based tests  <cit> , to the two gain data sets. the smallest p-value method, which only used the snp with the smallest p-value to represent a gene, detected  <dig> and  <dig> significant pathways in ea and aa data sets, respectively; only one was shared by both data sets. this showed our method could improve the power of detecting causal pathways by using multiple snps to represent a gene. for the set-based test method ,  <dig> significant pathways were detected in ea, and  <dig> in aa, but none was shared between the two data sets. one reason for the loss of power of these two methods might be their favouring of pathways containing large numbers of genes and genes with large number of snps, as larger pathways are expected to show more significant genes or snps just by chance. we checked several potential factors that might affect pathway significance: pathway size, gene size, total bp content, and average content. we found these factors are uncorrelated with pathway significance , confirming that using multiple representative snps per gene and permutations are able to reduce the bias introduced by gene and pathway sizes.

relaxing the nominal p-value cut-off to  <dig> , with fdr q-value controlled within 10%, resulted in  <dig> significant pathways detection in ea data set, and  <dig> significant pathways in aa data set. among them,  <dig> pathways are shared . the full list of  <dig> shared pathways is shown in table  <dig> 

discussion
the traditional strategy for gwas studies tests one snp at a time. although widely used, single-snp gwas analysis does not have adequate power to detect snps that have marginally weak, but jointly strong genetic effects. jointly analyzing snps within the same biological pathway simultaneously complements the single-snp analysis and can reveal new insights to the understanding of complex human traits. our snp set enrichment analysis operates on representative snps of genes and then combines the effects of snps within the same pathway by a weighted kolmogorov-smirnov running sum statistic test  <cit> . this strategy has the potential to increase the chance of identifying genetic variants that that individually have a modest risk.

compared to gene set enrichment analysis, the snp set enrichment analysis is a much larger scale and is more computationally challenging. several pathway-based methods have recently been developed to analyse gwas  <cit> . in general, these methods can be classified into two categories, depending upon how representative snps for each gene are chosen: one selects the most significant snp per gene, and the other selects all snps located within a gene  <cit> . both approaches have limitations. using all available snps per gene not only poses computational challenges, but also introduces significant amounts of noise into the analysis. using the most significant snp per gene might miss snps with moderate strength individually but strong effects jointly, and in addition it introduces biases of favouring large extensive pathways and genes with greater numbers of snps. the ssea method we proposed uses an adaptive approach to choose snps in each gene, and can eliminate the limitations of other strategies.

it is also worthy to point out that the number of selected snps varies between genes. this is because we used permutations to decide both the number and the set of snps to represent each gene. the permutation of phenotypes and recalculation of statistical values for about half a million snps and thousands of subjects is computationally expensive. to seek a balance between the computational complexity and not losing too much information from snps, we set a nominal significance threshold chose only snps with smaller p-value for pathway analysis. to further reduce computation, we recommend using an upper limit for the number of representative snps for each gene.

our method has a critical assumption. in combing p-values of snps in a gene we assume that the p-values are independent, although in reality some snps in a gene are in linkage disequilibrium . when comparing the results with and without removing snps in strong ld, we found there is no big difference between them. however, a future direction is to relax this assumption and develop a snp selection method that explicitly takes the ld patterns into account rather than remove snps in ld. it is interesting to note that peng et al.  <cit>  also found that ignoring ld could actually lead to better results than methods with very conservative multiple testing corrections. the permutation test we consider might partially alleviate the effect due to ld.

a critical component for the success of the pathway-based analysis is the availability of a comprehensive collection of relevant gene sets related to the disease/genetic trait of interest. current understanding of gene functions and pathways is still very limited. this is especially the case for neuropsychiatric diseases, as most of the gene sets currently available were generated based on experiments done on tumor cell lines. as a consequence, we have only limited knowledge regarding the pathways involved in brain development, and normal and pathological activities. in this regard, the pathways discovered by ssea for schizophrenia are likely to be substantially incomplete. we expect the performance would improve as better and more comprehensive disease-related pathways become available. a future challenge is to curate pathways and gene sets in a disease specific way, possibly by taking advantage of the high-throughput functional genomics tools.

CONCLUSIONS
in summary, we have developed a new snp-based method, called snp set enrichment analysis , for pathway analysis of gwas data. ssea selects a multiple and varying number of snps to represent each gene using an adaptive truncated product statistic. the selected snps are then ranked and enrichment of pathways is tested using a weighted kolmogorov-smirnov test. we tested ssea in two genetically distinct gwas studies of schizophrenia with large samples, and discovered  <dig> significant pathways in the european-american sample and  <dig> significant pathways in the african-american sample. eight important pathways were found in both distinct samples providing support for our method.

the ssea method is coded in a java software package with a user-friendly interface. the software is freely available at http://cbcl.ics.uci.edu/ssea/.

authors' contributions
designed the experiments: wl, sgp, yz and xx; performed the experiments: wl; wrote the paper: wl, fm, yz, and xx; all authors contributed to the analysis, and approved the paper.

supplementary material
additional file 1
supplementary tables and figures on genes and pathways. supplementary tables and figures on genes and pathways discovered by ssea.

click here for file

 additional file 2
detailed information on replicated pathways. a excel file containing detailed information on replicated pathways.

click here for file

 acknowledgements
we would like to thank helpful discussions with daniel newkirk, and anita lakatos and alvin chon. the research was partly supported by an nih grant to sgp, an nih grant to yz, and a nsf grant to xx.
