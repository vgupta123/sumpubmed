BACKGROUND
fostered by the importance of studying the cell metabolism under a system-level approach  <cit> , the set of metabolic pathways of organisms of interest are assembled in metabolic networks  <cit> . if it is assumed that the intracellular metabolites of a network are at pseudo steady-state, mass balances around each metabolite can be described by means of a homogeneous system of linear equations  <cit> . these equations can be considered as stoichiometric constraints. then, the constraints imposed by enzyme or transport capacities and thermodynamics  can be incorporated to the system  <cit> . thereby the imposed constraints define a space where every feasible flux distribution lives  <cit> . since the metabolic phenotype can be defined in terms of flux distributions through a metabolic network, this space represents  the set of feasible phenotypes  <cit> . the environmental conditions given at a certain time instant will determine which of these flux distributions corresponds to the actual one  <cit> .

coupling constraints with experimental measurements
experimental measurements of fluxes can be incorporated as constraints, in order to determine the actual flux distribution or at least to reduce the space of possible flux distributions. however, it must be taken into account that measurements are not invariant constraints, but specific condition constraints  <cit> . there are several methodologies that use this approach with different purposes: estimate the non-measured fluxes, predict flux distributions, investigate the cell behaviour or monitor bioprocesses.

metabolic flux analysis  provides a methodology to uniquely determine the actual flux distribution by using a metabolic network and a set of measured fluxes  <cit> . it has been intensively used in recent years with successful results  <cit> . as it can only consider stoichiometric constraints, a considerable number of fluxes need to be measured to determine the rest of the fluxes. unfortunately, the available measurements are often insufficient  <cit> .

the flux balance analysis  can be used to predict metabolic flux distributions  <cit> . firstly, a constraint-based model is defined as a set of invariant constraints: stoichiometrics, thermodynamics, etc. then, only a few specific condition constraints  are imposed. subject to these constraints, which define a region of possible flux distributions, an optimal flux distribution is calculated using linear programming. yet, the optimal solution may not correspond to the actual flux distribution. it must be hypothesized that i) the cell has identified the optimal solution, ii) the objective sought by the cell is known, and iii) it can be mathematically expressed. however, fba predictions based on different objective functions  are consistent with experimental data  <cit> .

estimating the evolution over time of flux distributions
typically, calculation of a flux distribution  is done under a static point of view: the measured fluxes are assumed to be constant. that means that the obtained flux distribution will only be valid during a certain period of time, while the environmental conditions and the cell state remain steady . however, if these conditions change along time, as it happens in an actual culture, the flux distribution will change. the estimation of the flux distribution over time can be useful to investigate the dynamic behaviour of the microorganism or to monitor the progress of industrial fermentations  <cit> . in  <cit> , the classical fba is extended to predict the dynamic evolution of flux distributions. in  <cit> , an approach based on elementary modes and the assumption of optimal behaviour is used to estimate the flux distributions of corynebacterium glutamicum at different temporal phases of fermentation. elementary modes are also employed in  <cit> , where the cell life is decomposed in a succession of phases, and then the time-varying intracellular fluxes are obtained by switching the flux distributions calculated at each phase. in  <cit> , on-line mfa is successfully applied to quantify coupled intracellular fluxes. takiguchi et al.  <cit>  use a similar approach to recognize the physiological state of the cells culture. they also show how this information can be used to improve lysine production yield. very recently  <cit>  has presented an on-line estimation of intracellular fluxes applying mfa to an over-determined metabolic network.

to calculate the succession of flux distributions, it is usually assumed that intracellular fluxes are in quasi-steady state within each measurement step. however, that does not mean that the intrinsic dynamic nature of the cultivation is being disregarded. instead, the intracellular fluxes will follow the change of environmental conditions as mediated by the measured fluxes . hence, steady states may undergo shifting from one state to another depending on the evolution of the measured fluxes  <cit> . such assumption has been successfully applied in the works cited in above and in the development of several dynamic models  <cit> . this approach makes it possible to study the dynamic behaviour of the organism, without considering the still not well-known intracellular kinetics.

using the flux spectrum approach to estimate the fluxes
mfa can be successively applied to estimate the evolution of a flux distribution over time. however, this approach has three main difficulties: i) it cannot be used when measurements are scant . this happens very often due to the lack of measurable fluxes. ii) the uncertainty of the measured fluxes cannot be considered. not only gross errors may appear -which could be managed only in case there are redundant measured fluxes- but also most sources of measurements are intrinsically uncertain and the propagation of this uncertainty to the estimated fluxes is not controlled, and iii) only equalities can be used as constraints. for instance, reversibility constraints or maximum flux values cannot be taken into account. fba solves the first difficulty and provides a framework to deal with the other ones. but the use of fba in this context could be problematic due to the appearance of a time-variant metabolic objective  <cit> . for these reasons, the procedure introduced in this work uses the flux spectrum approach   <cit> . it is a variant of mfa that includes some characteristics of fba  and provides some additional benefits . the use of fsa will make it possible to face the difficulties described above without assuming an optimal behaviour of the organism.

although fsa is capable of considering a wide range of constraints, in this work we will only use stoichiometric relationships and simple thermodynamic constraints , and we assume them to be known a priori. however, it must be noticed that the incorporation of thermodynamic constraints -based on measurements or estimations of the standard gibbs free energy change of reactions- is capturing attention in recent times. a genome-scale thermodynamic analysis of escherichia coli has been recently carried out  <cit> . kümmel et al. have introduced an algorithm that -based on thermodynamics, network topology and heuristic rules- automatically assigns reaction directions in metabolic models such that the reaction network is thermodynamically feasible  <cit> . interestingly, the reaction directions obtained can be incorporated as constraints before using fsa. standard gibbs free energy changes have been also used to incorporate thermodynamic realizability as constraint for fba  <cit>  -or in an analogous manner to fsa-, and to develop a new form of mfa with the capability of generating thermodynamically feasible fluxes  <cit> .

the objectives of this article are twofold: first, introduce a procedure for the estimation of the metabolic fluxes over time by using a metabolic network as a constraint-based model and a reduced set of measurable species. this procedure is capable of coping with lack of measured species and with its intrinsic uncertainty, thanks to the use of the flux spectrum approach . second, illustrate this procedure with a real example: the estimation of non-measured fluxes during a cultivation of cho cells in batch mode in stirred flasks.

RESULTS
procedure overview
in most cases, only a few extracellular species are measurable during fermentation processes. this is the reason for use an indirect approach to estimate the fluxes that cannot be measured: couple the available measurements with known biological constraints. under this philosophy, the proposed procedure is structured as follows : 1) obtain experimental measurements of the concentration of some extracellular species and biomass, 2) convert these concentrations to measured fluxes and 3) estimate the non-measured fluxes using the flux spectrum approach .

it is sometimes overlooked that extracellular fluxes are not directly measured. instead, the concentrations of a set of species are measured , and those data are converted to flux units or measured fluxes . the importance of a good conversion should not be disregarded: error in the measurements of concentrations may be amplified through the conversion, incorporated into the measured fluxes, and then propagated to the estimation of the non-measured fluxes. to minimize this hitch, the conversion should be done carefully. afterwards, the non-measured fluxes can be estimated by coupling the metabolic network and the measured fluxes . this has been done before by means of the mfa methodology  <cit> . yet, this approach has certain limitations. we will overcome some of them using fsa.

it must be remarked that the procedure can be used in two main scenarios: as an off-line analysis of previously collected data or as an on-line monitoring of an industrial process. the structure of the procedure and its fundamental step  are exactly the same in both cases. nevertheless, there are several differences concerning step  <dig>  these differences will be briefly described along the article and illustrated in an additional file .

preliminaries: choice and analysis of the metabolic network
a metabolic network can be represented with a stoichiometric matrix s, where rows correspond to the m metabolites and columns to the n fluxes. assuming that the intracellular metabolites are at pseudo-steady state, material balances around them can be formulated as follows  <cit> :

 s·v =  <dig> 

where v is a flux distribution. assuming that s has full row rank, the number of independent equations is m. as typically n becomes larger than m, the system  is underdetermined . that means that there is not a unique flux distribution fulfilling , but an infinite number of feasible flux distributions. in order to determine which of these feasible flux distributions is the current one, the constraints imposed by the measured fluxes will be incorporated -latter on it will be shown that other constraints, for example the reversibility constraints, can be added.

thereby, when choosing the metabolic network to be used through the procedure, it must be taken into account that its degree of detail needs to be compatible with the number of available measurements -i.e. the available measurements must be sufficient to offset the underdeterminacy of the network. in order to study this, we can analyze the system formed by the stoichiometric constraints given by  and the constraints imposed by the measured fluxes. this system -which constitutes the fundamental equation of mfa- can be obtained making a partition between measured  and non-measured or unknown fluxes :

 su·vu = -sm·vm 

system determinacy and calculability of fluxes
system  is determined when there are enough linearly independent constraints for uniquely calculate all non-measured fluxes vu; i.e., when rank = u . on the contrary, when rank>u, the system is classified as underdetermined because at least one non-measured flux, and probably most of them, is non calculable  <cit> . if the system is underdetermined, the traditional mfa methodology cannot be used to calculate the non-measured fluxes. fortunately, the use of fsa may provide an estimation of the non-measured fluxes even in this situation. however, it must be taken into account that the likelihood of obtaining a precise estimation increases as the underdeterminancy reduces, as the set of flux distributions compatible with the measured values will be smaller.

system redundancy and consistency of measurements
system  is redundant when some rows in su can be expressed as linear combinations of other rows; i.e., when rank<m. this can lead to an inconsistent system if the vector vm contains such values that no vu exists that exactly solves . therefore, when the system is redundant, the inconsistency of the measurements can be checked and its importance can be estimated . unfortunately some measured fluxes have no impact on the consistency of the system, so they cannot be considered in the analysis of consistency. these fluxes are called non-balanceable. the balanceable fluxes can be detected as explained in  <cit> , and they should be adjusted  in case the system is inconsistent . all these methods are commonly applied when mfa is used  <cit> . they can also be used within our procedure, but in addition the use of fsa provides new methods to deal with inconsistency as it will be shown in a subsequent section.

step 1: getting experimental measurements of species
there are several alternatives to measure the concentration of species -e.g. on-line sensors, isotopic tracer experiments or laboratory procedures- but providing a detailed description of each one is out of the scope of this work. in any case, it must be remembered that the more measurements are available, the more non-measured fluxes may be accurately estimated. however, it is necessary to be prepared to overcome a lack of measurements, especially when the procedure is done on-line .

step 2: conversion of measured concentrations in measured fluxes
a mass balance around each extracellular species whose concentration is measurable can be stated as:

 dξdt=vξ⋅x−d⋅ξ+fξ
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadawcaaqaaiabdsgakhgaciab=57a4bqaaiabdsgakjabdsha0baacqgh9aqpcqwg2bgdlmaabaaabagae8nvdghabeaakiabgwsixlabdifayjabgkhitiabdseaejabgwsixlab=57a4jabgucariabdaeagtwaasbaaeaacqwf+oaeaeqaaaaa@4472@ 

where ξ is the specie concentration, vξ its flux , x the biomass concentration,d the dilution term and fξ the net exchange of the specie with the outside. notice that this equation is only valid for extracellular species; however, the biomass growth and the mass balance around an internal metabolite not assumed to be at pseudo-steady state can be represented in a similar way  <cit> .

it is possible to calculate vξ as a function of ξ, x, d, fξ and dξ/dt. but this presents two main difficulties: i) approximate a derivative  and ii) deal with the presence of errors and noise in the measurements of the concentration ξ  <cit> . the underlying problem is how precision can be combined with robustness with respect to measurement errors. the most straightforward approach is to approximate the derivative with a simple method  and then solve   <cit> . very often this straight approximation needs to be combined with the use of filters to eliminate -or at least to reduce- the presence of noise. this approach provides very good results when centred methods can be used to approximate the derivative and to filter the resultant signal, i.e. when the whole procedure is done off-line, or when it is done on-line but certain delay in the calculation of the fluxes is allowable ). furthermore, there are methods especially aimed to the on-line approximation of the derivative. if the noise signal is well characterized  a linear differentiator  <cit>  or even a luenberger observer may be used  <cit> . if nothing is known on the structure of the signal, then sliding mode techniques are profitable. for example, the method introduced in  <cit>  combines exact differentiation for a large class of input signals with robustness with respect to any small noises. finally, there are other approaches to calculate the extracellular fluxes that avoid the approximation of the derivative, as for example the use of extended kalman filters  <cit>  or the observers based on concepts from nonlinear systems theory, such as the high gain estimators described in  <cit> . these methods do not use future information because they are aimed to the on-line operation mode.

the importance of the use of filters should be remarked: not only the signal of measured concentrations should be filtered to reduce its noise, but also the calculated extracellular fluxes may be filtered to get a smooth signal. filters based on the moving average will be used in this work since they are simple and versatile. basically, the filtered value at time k is calculated by averaging the values of the original signal within a time window. there are several versions that differ in the time window used  and in the distribution of weight over the averaged values . interestingly, this kind of filters has already been successfully applied to the calculation of metabolic fluxes  <cit> .

to provide a complete description of our procedure, two conversion approaches are described in the methods section: the combination of an euler method with a moving average filter, and the use of a nonlinear observer . the first one is especially suitable when the procedure is done off-line, while the second one is aimed to work on-line. nevertheless, it must be taken into account that there is not a universal solution for the conversion problem. in real applications, the particularities of the concentrations measurements  and the operation mode  will determine which method is the most suitable one. a real off-line conversion is described below, but the most illustrative example of the step  <dig> is given in the additional file  <dig>  which addresses the on-line and the off-line operation modes and the use of filters. a practical guide about step  <dig> is also given in the mentioned file.

step 3: estimation of the non-measured fluxes using fsa
finally, the measured fluxes obtained in step  <dig> are coupled with known biological constraints in order to estimate the non-measured fluxes . basically, this implies that a solution for system  has to be found at each time instant k. traditionally mfa was successively applied with this purpose. unfortunately, as mentioned in the background section, this has some limitations -which become especially critical if the procedure is done on-line, due to the traditional lack of reliable on-line sensors. to overcome them, the flux spectrum approach  will be used instead in the third step of our procedure.

using fsa, the estimation of the non-measured fluxes at each time instant k is obtained as follows  <cit> :  <dig> ) impose the set of constraints given by  and the reversibility constraints. they define a region where the actual fluxes may live.  <dig> ) calculate the interval of possible values for each non-measured flux by solving two linear programming problems, one to compute its maximum value within the region and the other one to compute its minimum . thus, at each time k, and for each non-measured flux, an interval bracketing its possible values will be obtained: vuj = . the size of the intervals  depends on the number of non-measured fluxes, the irreversible reactions, the available measurements and the degree of uncertainty considered. of course, the more constraints are available, the tighter intervals are obtained. if uncertainty is not considered, reversibility constraints are not used, and the system  is determined, fsa gives the same unique solution as mfa  <cit> . but in addition, the use of fsa provides several advantages to the estimation procedure :

• it makes it possible to consider the uncertainty of experimental measurements and even qualitative knowledge . hence, if measurements uncertainty is indeed present and it is well characterized, the estimation of non-measured fluxes will be more reliable . fsa provides not only a prediction of the fluxes, but also an indication of the reliability of this prediction.

• it considers the reversibility constraints of certain fluxes. this provides an estimation of the non-measured fluxes even when measurements are insufficient, i.e. when  is underdetermined . this estimation will be precise if the degree of underdeterminancy is limited and there are irreversible fluxes. on the contrary, the estimation could be poor and some intervals may be unbounded. the reversibility constraints will also restrict the intervals of the estimated fluxes when uncertainty is considered . finally, the reversibility constraints can also provide a means to detect inconsistencies even when the system is not redundant .

• it provides a straight method for coping with inconsistency: a band of uncertainty is used instead of adjusting the inconsistent measurements. as any inconsistent set of measurements is necessarily uncertain, it seems reasonably to define a band of uncertainty around the measured values trying to enclose nearby consistent sets of measurements. thus, every consistent set of measurements enclosed by the band will be taken into account in the estimation of the non-measured fluxes . furthermore, the band size needed to find the nearest consistent flux distribution gives an indication of the degree of inconsistency.

additional advantages arise when fsa is used in a successive way to estimate the temporal evolution of the metabolic fluxes:

• it may detect sensitivity problems. assume that a band of uncertainty is being used and that the measured fluxes change smoothly over time. if the interval of values for an estimated flux is strangely large at a certain instant k, it indicates that a slight change in the measured fluxes has a big effect over the estimated flux, i.e. that a sensitivity problem exists . thereby, an analysis of sensitivity is incorporated in the estimation procedure.

• the peak values at certain time instants k -which may appear when mfa is used- are avoided with fsa. these peaks are consequence of slight errors in the measurements . since fsa considers a band of uncertainty around the measured values, it avoids, or at least reduces, this phenomenon.

• the estimation given by fsa for a certain flux at time k , combined with the inspection of past and future estimations and with our qualitative knowledge about cell behaviour, may be used to hypothesize which of the possible temporal evolutions corresponds to the actual one. that is to say, the richness of the estimation given by fsa makes it possible to exploit our qualitative knowledge to support certain hypothesis without being confused by measurements uncertainty.

application: estimation of the fluxes during a cultivation of cho cells
the three-step procedure described in the previous section is now applied to a real problem taken from the literature: the estimation of the intracellular fluxes of cho cells cultivated in batch mode in stirred flasks. the available experimental data are the typical data measured off-line , and therefore this example will be approached assuming that the procedure is done off-line. this assumption is important during the second step of the procedure, and for this reason an example has been included in the additional file  <dig> that illustrates the differences between the on-line and the off-line operation modes. however, hereinafter we will pay special attention to the third step of the procedure because it is the most important one. in particular, the benefits provided by the use of fsa will be compared with those obtained with the well-established mfa methodology, which is the basis of most of the similar procedures  <cit> . this comparison illustrates the advantages of the new estimation procedure in three different scenarios:

s <dig>  when measurements are almost sufficient. the number of measured fluxes is almost sufficient when there are enough to determine all the non-measured fluxes but there are not redundant measurements  is determined and not redundant).

s <dig>  when measurements are sufficient, i.e. when the measured fluxes are enough to determine the non-measured fluxes and there are also redundant measurements  is determined and redundant).

s <dig>  when measurements are insufficient. the number of measured fluxes is insufficient when there are not enough to determine all the non-measured fluxes  is underdetermined and not redundant).

for completeness, the most uncommon case  is illustrated with a toy example in an appendix . in the three scenarios, the intrinsic uncertainty of the measured fluxes is taken into account.

metabolic network of cho cells
the metabolic network  has been taken from  <cit> . the network describes only the metabolism concerned with the two main energetic nutrients, glucose and glutamine. thus, the metabolism of the amino-acids provided by the culture medium is not included. four pathways are considered: the glycolysis, the glutaminolysis, the tca cycle and the nucleotides synthesis. all reactions are assumed to carry flux only in only one direction, except reactions  <dig>   <dig>   <dig>   <dig> and  <dig> that are reversible . the complete lists of species and reactions are given in the additional file  <dig> 

the mass balance around intracellular metabolites at pseudo-steady state is given by eq.  <dig> . there are  <dig> metabolites  and  <dig> intracellular fluxes . therefore, the system is underdetermined and has  <dig> degrees of freedom. the extracellular fluxes vg, vl and va coincide with the fluxes -v <dig>  v <dig> and v <dig>  three equations that link vnh <dig>  vq and vco <dig> with the intracellular fluxes can be obtained by inspection of the metabolic network. moreover, it is a natural assumption to consider that the formation of purine and pyrimidine nucleotides is the same. as a result, four equations are incorporated by the authors  <cit> :

 vnh4:v19=v15+v16−vq:v20=v16+v17+2⋅v18vco2:v21=v3+v8+v10+v11+v13vextra:v22=0=v17−v18
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakqaabeqaaiabdaha2twaasbaawqaaiabd6eaojabdieaihqaaiab=rda0aqabagccqgg6agocqwg2bgddawgaawcbagaegymaejaegyoakdabeaakiabg2da9iabdaha2naabaaaleaacqaixaqmcqai1aqnaeqaaogaey4kasiaemoday3aasbaasqaaiabigdaxiabiada2aqabaaakeaacqghsislcqwg2bgdlmaabaaameaacqwgrbquaeqaaogaeiooaojaemoday3aasbaasqaaiabikdayiabicdawaqabagccqgh9aqpcqwg2bgddawgaawcbagaegymaejaegonaydabeaakiabgucariabdaha2naabaaaleaacqaixaqmcqai3awnaeqaaogaey4kasiaegomaijaeyyxictaemoday3aasbaasqaaiabigdaxiabiida4aqabaaakeaacqwg2bgdlmaabaaameaacqwgdbwqcqwgpbwtcqwfyagmaeqaaogaeiooaojaemoday3aasbaasqaaiabikdayiabigdaxaqabagccqgh9aqpcqwg2bgddawgaawcbagaeg4mamdabeaakiabgucariabdaha2naabaaaleaacqai4aaoaeqaaogaey4kasiaemoday3aasbaasqaaiabigdaxiabicdawaqabagccqghrawkcqwg2bgddawgaawcbagaegymaejaegymaedabeaakiabgucariabdaha2naabaaaleaacqaixaqmcqaizawmaeqaaagcbagaemoday3cdawgaaadbagaemyraukaemieagnaemidaqnaemocainaemyyaegabeaakiabcqda6iabdaha2naabaaaleaacqaiyagmcqaiyagmaeqaaogaeyypa0jaegimaajaeyypa0jaemoday3aasbaasqaaiabigdaxiabieda3aqabagccqghsislcqwg2bgddawgaawcbagaegymaejaegioagdabeaaaaaa@8e44@ 

these constraints can be represented with a 4× <dig> matrix sξ fulfilling . then,  and  can be joined to define an extended homogeneous system of linear equations . the extended system has  <dig> metabolites  and  <dig> reactions .

the mathematical model, formed by the stoichiometric matrixes s and sξ , is given in a matlab script and a standard sbml file .

step 1: getting experimental measurements of species
the experimental data taken from  <cit>  is given in figure  <dig>  the cell density  and the concentration of  <dig> extracellular species are measured; two substrates, glucose  and glutamine , and three excreted products, lactate , alanine  and ammonia . this data was collected with a sample rate of  <dig> h. these measurements cannot be filtered because -due to the low sample rate- it is impossible to distinguish between noise and true changes of the signal.

step 2: conversion of measured concentrations in measured fluxes
the second step of the procedure is the conversion of the measured concentrations in measured fluxes. the measured fluxes  calculated with three different approximations of the derivative are depicted in figure  <dig> . since the procedure is being done off-line, a centred approximation is the most advisable choice. therefore, the fluxes calculated with the middle point euler approximation will be used hereinafter. we obtained similar results  when the complete example was done using a backward euler approximation . it is also remarkable that figure  <dig> already gives the idea of uncertainty -differences between the conversions obtained with different methods are significant. in fact, the different conversions, along with the precision of the sensors and the protocols used to measure the concentration of species, could be used to characterize the uncertainty in the measured fluxes.

step  <dig> : estimation of fluxes if measurements are almost sufficient and uncertain
if the five measured fluxes are used , v <dig> ,v <dig> , v <dig>  and v <dig> ) and it is assumed that the formation of purine and pyrimidine nucleotides is the same , the rank of su  is equal to the number of unknown fluxes . thereby the system  is determined but not redundant. in this case we could use mfa to determine the non-measured fluxes. more precisely, at each time instant k, the unique flux distribution fulfilling  can be obtained by using the inverse matrix of sm . however, as it can be observed in figure  <dig>  the results obtained are not very satisfactory:

• the estimated values at time  <dig> h an  <dig> h for fluxes v <dig>  v <dig>  v <dig>  v <dig>  v <dig> and v <dig> seem unreasonable: the measured fluxes evolve in a smooth way, but these fluxes show peak values.

• the estimated fluxes v <dig>  v <dig> and v <dig> do not fulfil the reversibility constraints .

• mfa assumes that there is not any kind of error in the measurements, which is unlikely, and therefore the estimated fluxes are unreliable.

a new estimation has been done at time  <dig> h, where the measured values for fluxes v <dig> and v <dig> are slightly modified . in a similar way, a new estimation at time  <dig> h assumes a slight variation of the measured values for v <dig> and v <dig> , respectively). as it can be observed in figure  <dig> , the peak values in fluxes v <dig>  v <dig>  v <dig>  v <dig>  v <dig> and v <dig> are eliminated or reduced, while the values of the rest of non-measured fluxes remain almost unchanged. this demonstrates that the peak values at times  <dig> h and  <dig> h could be caused by slight errors in the measured fluxes. the same issue is illustrated with figure a <dig> . hence, the main weakness of mfa in the determined case is pointed out: the effect of slight errors in the measured fluxes is not under control. these slight errors will exist in virtually all the measured fluxes . moreover, even the conversion of the measured concentrations into measured fluxes may introduce slight errors. for this reason, the fluxes estimated with mfa are unreliable in this scenario.

the same scenario is now approached following the procedure introduced in this paper, i.e. using fsa instead of mfa in the third step. if uncertainty is not considered and all reactions are assumed to be reversible, fsa provides the same solution that mfa . but it is possible to include the reversibility constraints for those reactions classified as irreversible. by using these constraints, fsa has detected a high inconsistency at  <dig> h and a lower one at  <dig> h . it must be highlighted that the system is not redundant, so methods to check consistency based on redundancy cannot be used; however, fsa is detecting inconsistencies thanks to the reversibility constraints. afterwards, it is also interesting to consider the intrinsic uncertainty of the measurements. we will define a band of uncertainty around the measured values, and then we will use fsa to estimate the non-measured fluxes. the most common ways to define a band of uncertainty are the use of a relative error around the measured values  and the use of an absolute one ). herein, we use a mixed approach. for each measured flux vm, at each time instant k, the band is defined as:

 if relerr⋅vm>abserr→band=vm±relerr⋅vmelse→band=vm±abserr
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaafaqaaegadaaabagaeeysakkaeeozaymaeeiiaaiaemocainaemyzaumaemibawmaemyraukaemocainaemocainaeyyxictaemoday3aasbaasqaaiabd2gatbqabagccqgh+agpcqwghbqycqwgibgycqwgzbwccqwgfbqrcqwgybgccqwgybgcaeaacqghsgiraeaacqwgibgycqwghbqycqwgubgbcqwgkbazcqgh9aqpcqwg2bgddawgaawcbagaemyba0gabeaakiabgglaxkabdkhayjabdwgaljabdygasjabdweafjabdkhayjabdkhayjabgwsixlabdaha2naabaaaleaacqwgtbqbaeqaaagcbagaeeyraukaeeibawmaee4camnaeeyzaugabagaeyokh4kabagaemoyaimaemyyaemaemoba4maemizaqmaeyypa0jaemoday3aasbaasqaaiabd2gatbqabagccqghxcqscqwghbqycqwgibgycqwgzbwccqwgfbqrcqwgybgccqwgybgcaaaaaa@7b55@ 

with this expression the relative error  will be considered when the measured value is high, and the absolute one  when it is near to zero . if more information about the measurements sources were available, the range of uncertainty of each measured flux could be defined accordingly. for example, if a commercial sensor is employed, its technical specifications can be used to define the band.

the non-measured fluxes estimated with fsa -when the band of uncertainty is considered and the reversibility constraints are incorporated- are shown in figure  <dig> . if they are compared with those obtained when mfa was used, several conclusions can be pointed out:

• the peaks at time  <dig> h an  <dig> h for fluxes v <dig>  v <dig>  v <dig>  v <dig>  v <dig> and v <dig> -which appeared when mfa was used- are avoided with fsa. as it was shown, when the measurements were slightly modified, these peak-values were replaced by more sensible predictions. since these modified measurements are included in the band of uncertainty, the obtained intervals for v <dig>  v <dig>  v <dig>  v <dig>  v <dig> and v <dig> contain the sensible predictions. in principle, the peak-values would be within the intervals. however, a peak value could not satisfy the reversibility constraints and therefore it will not be considered a valid solution by fsa -this is the case at k =  <dig> h.

• the uncertainty of experimental measurements is non-trivially propagated to the non-measured fluxes. hence, the use of fsa provides not only a prediction of the non-measured fluxes, but also an indication of the reliability of this prediction. for example, the predicted v <dig>  v <dig> and v <dig> are highly influenced by measurements uncertainty, while v <dig>  v <dig>  and v <dig> are quite insensitive. although all fluxes can be determined, fsa highlights that the estimated values for v <dig>  v <dig> and v <dig> are less reliable  than those assigned to v <dig>  v <dig> and v <dig>  this issue is more deeply analyzed in a subsequent section.

• reversibility constraints provide a method to detect inconsistencies. for example, it can be easily checked that the solution provided by mfa do not satisfy the reversibility constraints at  <dig> h . this inconsistency is detected and avoided with fsa.

• the underdeterminancy introduced as uncertainty in the measurements can be partially neutralized with the reversibility constraints. hence, the estimated fluxes are more reliable but not necessarily highly imprecise.

this example shows that the procedure provides a reliable and rich estimation of the evolution along time of the non-measured fluxes when the measurements are only almost sufficient, i.e. when the system is determined but not redundant. in particular, the use of fsa in the third step of the procedure -instead of the well-established mfa- provides several benefits, thanks to taking into account the uncertainty of measurements and considering the reversibility constraints.

step  <dig> : estimation of fluxes if measurements are sufficient and uncertain
when the system  is determined and redundant, an estimation based on mfa will work as follows : firstly, the importance of the inconsistency is checked and the measured flux values are adjusted; then, the pseudo-inverse matrix is used to estimate the non-measured fluxes. these two properties -checkable consistency and adjustable measurements- are responsible of the success of mfa in this scenario. however, fsa provides a new approach  which holds the property of checkable consistency, but replaces the adjustment of the measurements by the definition of a band of uncertainty. we will apply both alternatives to our example.

the system  was determined and not redundant when six fluxes were known. if another independent flux is measured, the system will be redundant because the rank of su  will be less than m . since no more fluxes were measured in  <cit> , we will assume that the evolution of v <dig> has been measured -we chose it because it is a well-known extracellular flux. we assume that v <dig> evolves smoothly and that its values are within the intervals estimated with fsa in the previous section. hence, at each time instant k, except  <dig> h and  <dig> h, the values given by mfa in the previous section are used as measured values . the values at  <dig> h and  <dig> h are calculated by the approximation of a spline curve .

first of all, we apply the χ-square method to estimate the importance of the inconsistency at each time instant k . the data fails the consistency check at time  <dig> h, what indicates that the set of measurements contains gross errors at this point . afterwards, we estimate the non-measured fluxes at each time instant k with the two approaches described above. in the first one, the measured values are adjusted to be consistent . then, the non-measured fluxes are estimated with mfa. in the second one, a band of uncertainty around the measured values is defined trying to enclose some nearby consistent sets of measured fluxes . then, the non-measured fluxes are estimated with fsa. the results  illustrate the benefits of using fsa in this scenario:

• all the consistent sets of measured values enclosed by the band of uncertainty are considered by fsa. that guarantees that the intervals obtained enclose the actual values of the fluxes if the band was correctly chosen. contrarily, when mfa is used , the actual values of the measured fluxes need to be exactly found to ensure that the estimations fit in with the actual fluxes. to illustrate this idea a consistent flux distribution within the band of uncertainty has been highlighted in figure  <dig> . this flux distribution corresponds to a set of measured values very near to the original ones; nevertheless the evolution of v <dig>  v <dig>  v <dig> and v <dig> is quite different to the estimation given by mfa. that proves that the values estimated with mfa may be deviated from the actual ones, even if there are only slight errors in the measured fluxes. conversely, fsa shows that two qualitatively different interpretations of fluxes v <dig>  v <dig> and v <dig> are possible: they can be stable around  <dig>  or evolve from  <dig>  to  <dig>  mm/. if there were other evidences supporting one alternative over the other one, we could hypothesize which of these two scenarios corresponds to the actual one. hence, fsa not only reduces the number of wrong predictions, but may also provide a quantitative support for our qualitative knowledge.

• although there is a gross error in the measurements at  <dig> h, fsa finds at least one consistent set of measured values within the band of uncertainty . the estimations provided by fsa at  <dig> h seem sensible: the measurements are only slightly adjusted  and the peak values are avoided. on the contrary, the fluxes estimated with mfa are very sensitive to the gross error. the value of v <dig> is significantly changed by the adjustment method resulting in a peak. moreover, this insensible peak also appears in the estimated values of v <dig>  v <dig>  v <dig>  v <dig> and v <dig>  in fact, the fluxes calculated with mfa are generally discarded when the measurements fail the χ-square method.

• when fsa is used, the uncertainty of experimental measurements is non-trivially translated to the non-measured fluxes. again, fsa provides not only a prediction of the non-measured fluxes, but also an indication of the reliability of this prediction.

this example has shown that the procedure can be useful to estimate the evolution of the fluxes even when measurements are sufficient but uncertain, i.e. when the system is determined and redundant. although this is the scenarios were the procedures based on the use of mfa are most successful, the use of fsa provides a more reliable estimation of the non-measured fluxes and offers an interesting approach to cope with inconsistency.

step  <dig> : estimation of fluxes if measurements are insufficient and uncertain
finally, it will be shown that our procedure can be used even when the available measurements are insufficient  is underdetermined). in this situation procedures based on mfa cannot be applied, but the use of fsa allows our procedure to estimate the interval of possible values for each non-measured flux. in particular, the non-measured fluxes will be estimated by using different sets of  <dig> and  <dig> measured fluxes -remember that  <dig> were necessary to get a determined system. in all cases, uncertainty has been considered using the band described above. all results are given in table  <dig> and two illustrative cases are depicted in figure  <dig> 

column ref: fsa is applied by using the six available measurements . columns f, g, e b, a and c: fsa is applied by using a different set of  <dig> measurements in each case . columns i and h: fsa is applied by using two different sets of  <dig> measurements . in all cases the band of uncertainty described in the text has been used. a mean interval size along time evolution; b in ; c intervals enlargement w.r.t. case ref. ; d the nomenclature is given in the additional file 1; e measured values are in bold.

with four sets of  <dig> measurements  the evolution over time of all the non-measured fluxes can be estimated. case g, where v <dig> is not known, provides the best results. there is a mean interval increment of 39% with respect to the determined case and the increment is minor than 25% for  <dig> fluxes . this case is depicted in figure  <dig> . the intervals are practically the same than in the determined case for most fluxes . intervals for v <dig> and v <dig> are larger, but still accurate, and only the estimations of v <dig>  v <dig> and v <dig> are highly imprecise. moreover, the temporal evolution -that can be characterized by using the middle point of the interval- is almost the same than of the determined case even for these fluxes . case c, where v <dig> is not measured, provides very good results. all fluxes are predicted , the interval increment is minor than 25% for  <dig> fluxes and minor than 100% for  <dig> fluxes. case f, where v <dig> is not measured, provides good results too. there is a mean interval increment of 155% and the interval increment is minor than 100% for  <dig> fluxes . case e, where v <dig> is not measured, provides slightly worse results than f. with the other sets of  <dig> measurements , some non-measured fluxes cannot be estimated. nevertheless the intervals of the fluxes that can be estimated  are exactly the same that in the determined case.

two sets of  <dig> measurements have been studied . case i, where v <dig> and v <dig> are not measured, provides remarkable results. there is a mean interval increment of 180% with respect to the determined case and the increment is minor than 100% for  <dig> fluxes . this case is depicted in figure  <dig> . for most fluxes the intervals are similar to the determined case . intervals for v <dig> and v <dig> are larger but still useful, and only v <dig>  v <dig>  v <dig> and v <dig> are highly imprecise. again, the temporal evolution of the estimated fluxes is similar to the determined case .

this scenario has illustrated an important feature of the introduced procedure: it can estimate the evolution of the non-measured fluxes even when there is a lack of measurable species  and the available measurements are uncertain.

unbalanced propagation of measurements uncertainty
as it has been shown in previous sections, the uncertainty of the experimentally measured fluxes is not equally propagated to the estimated fluxes . on the contrary, the structure of the metabolic network  will determine how the uncertainty is propagated from the measured fluxes to the estimated ones.

a convenient way of measuring this effect is to calculate the interval size for each estimated flux at each time instant -in absolute and relative terms. the complete dataset has been included in the additional file  <dig>  but, as a summary, the average interval size  for each estimated flux is given in table  <dig>  it can be observed  that certain fluxes -such as v <dig>  v <dig> and v21- are highly affected by the uncertainty of the measurements ), while other fluxes -such as v <dig> and v17-are less sensitive ). although it is obvious that in relative terms the smaller fluxes are usually more affected by the uncertainty, this phenomenon is not the only responsible for the unbalanced propagation of the uncertainty. for example, the calculated fluxes v <dig> and v <dig> have a similar maximum value ), but the effect of the uncertainty over them is dramatically different: v <dig> is the flux more influenced by the uncertainty  whereas v <dig> is quite insensitive to it . another example is given by v21: although being one of the fluxes with a bigger maximum value ), it is highly affected by the uncertainty , which represents a  <dig> %).

max: maximum value of the estimated flux along time; ais: averaged interval size for each estimated fluxes ; diff: difference between determined and overdetermined cases; a in ; b the interval size for each estimated flux is expressed w.r.t. its maximum value. the complete dataset is given in the additional file  <dig> 

furthermore, the data given in table  <dig> provides a quantitative indication of the benefits of incorporating a redundant measurement. when seven fluxes are assumed to be measurable instead of six, the estimations of the non-measured fluxes are more precise . this is particularly important for those fluxes that were poorly estimated in the determined case .

non-linear propagation of measurements uncertainty
in the previous section we analyzed the unbalanced propagation of the uncertainty from the measured fluxes to the estimated ones. herein we investigate some characteristics of this propagation and, in particular, the interrelation between the uncertainty of the different measured fluxes and their combined effect over the estimated fluxes.

again, the time series of the five measured species  have been used, under the assumption that the formation of purine and pyrimidine are equal . then, 15· <dig> executions of the estimation procedure have been carried out with different degrees of uncertainty for the measured fluxes v <dig> and v <dig> . afterwards, the averaged interval size for each estimated flux was calculated. this makes it possible to analyze how the different combinations of uncertainty in v <dig> and v <dig> affect to the estimated fluxes.

on the one hand, the propagation of the uncertainty does not satisfy the principle of superposition. let f be the interval size of a calculated flux when the degree of measurements uncertainty is ui, then: f  + f  ≠ f . to remark this, the result of summing up the independent effect of the uncertainty of v <dig> and v <dig> has been depicted in figure  <dig> . interestingly, if the uncertainty of one of the two measured fluxes is kept low then f  + f  > f ; but if the uncertainty of both fluxes is increased, this is inverted: f  + f  <f . this implies that the net result of considering the uncertainty of two  measured fluxes can not be predicted just by summing up the results of considering only the uncertainty of one measured flux at a time. on the contrary, the net result may be given by a complex non-linear function, as it happens in the example of figure  <dig>  where:

• the uncertainty in v <dig> is always translated to the estimated v <dig> . when v <dig> uncertainty increases, the ais of v <dig> increases -even if there is not v <dig> uncertainty. however, the bigger v <dig> uncertainty gets, the bigger the effect of adding v <dig> uncertainty is.

• when v <dig> uncertainty is low, the addition of v <dig> uncertainty has a low effect over the estimated v <dig>  more precisely, the first small addition of v <dig> uncertainty has a slight effect, but the subsequent additions do not . however, the saturation limit increases with v <dig> uncertainty, and, therefore, the more uncertainty there is in v <dig>  the more important effect has addition of uncertainty in v <dig>  in summary, v <dig> uncertainty has not an important effect itself, but its combination with v <dig> uncertainty boosts it.

on the other hand, as the superposition principle is not fulfilled the effect of the uncertainty of one measured flux over one estimated flux is not linear, i.e. f  ≠ k·f  for example, assume that the uncertainty of v <dig> is fixed in 10% . it can be observed that the effect of adding a first 4% of uncertainty to v <dig> is higher than the effect of adding a second one. in fact, when the uncertainty of v <dig> is bigger than 16%, the addition of more uncertainty has practically zero effect .

in the last two sections it has been shown that the relationship between the uncertainty of the measurements and the precision of the estimation is a complex one. on the one hand, the propagation of measurements uncertainty to each estimated flux will be different. on the other hand, the net effect of considering the uncertainty of two  measured fluxes simultaneously does not correspond to the sum of the effects of considering the uncertainty of each measured flux one at a time. finally, the effect of the uncertainty of one measured flux over one estimated flux is not linear.

therefore, when the procedure introduced in this paper considers the propagation of the uncertainty from the measurements to the estimated fluxes, it provides non-trivial information.

analysis of the effect of the uncertainty of each measured flux
in this section we analyze the effect of the uncertainty of each measured flux over the imprecision of the estimated fluxes. basically, we can apply the estimation procedure over previously logged data -considering the uncertainty of each measured flux one at a time- in order to determine which measured fluxes have the more critical uncertainty. there are two similar approaches to carry out the analysis:

a) direct approach. calculate the increase of the imprecision of the estimated fluxes when the uncertainty of one measured flux is increased. this calculation is repeated for each measured flux.

b) indirect approach. calculate the reduction of the imprecision of the estimated fluxes when the uncertainty of one measured flux is decreased. this is repeated for each measured flux. notice that the effect of decreasing the uncertainty is not the inverse of increasing it, i.e. f .+ f  ≠ f .

the direct approach  informs about the effect of considering the uncertainty of each measured flux over the estimated ones . this information may be useful during the setting-up of a process plant in order to choose the sources of measurements . nevertheless, the indirect approach  is probably more promising. it calculates how much the imprecision of the estimated fluxes will be reduced, if we reduce the uncertainty of one of the measured fluxes. given the characteristics of our current equipment and our measuring protocols , we can calculate which of the measured fluxes should be more accurately measured in order to improve the precision of the estimations .

the indirect analysis has been applied to the cultivation of cho cells . figure  <dig> shows the reduction of the imprecision of each estimated flux when the uncertainty of a measured flux is decreased a 3%. this is repeated for each measured flux . those data provide valuable information. for example, it is shown that the maximum reduction of the imprecision occurs when the uncertainty of v <dig> is reduced at time  <dig> h: the imprecision of v <dig>  v <dig>  v <dig> and v <dig> is reduced more than 85%. it can be also observed that during the first  <dig> h removing the uncertainty of v <dig> slightly reduces the imprecision of the estimated v <dig>  but this reduction is very important between  <dig> h and  <dig> h. those data are summarized in figure  <dig>  the left figure shows the averaged reduction at each time instant, and the one on the right the averaged reduction for each estimated flux. for example, it can be observed that removing the uncertainty of v <dig> or v <dig> has no effect over the estimations of v <dig>  v <dig>  v <dig>  v <dig> v <dig> and v <dig>  this information can be used to improve our estimations in a rational manner. for example, one could be interested in increasing the precision of the estimation of v <dig>  in this case the indirect analysis indicates that the best option is to reduce the uncertainty of the measured v <dig>  however, if we want to improve the estimations during the transition phase  we should reduce the uncertainty of v <dig>  finally, if we prefer to improve the overall precision of the estimations we should reduce the uncertainty of v <dig>  although reducing the uncertainty of v <dig> or v <dig> brings similar benefits.

more details about this analysis -including the complete dataset- are given in the additional file  <dig>  in addition, the results obtained with the direct analysis are also included there.

CONCLUSIONS
in this contribution we have presented a new procedure to estimate the temporal evolution of the metabolic fluxes. it copes with the intrinsic uncertainty of experimental measurements and with the lack of measurable species by means of the use of the flux spectrum approach . the potential of the procedure has been demonstrated using a real problem: the estimation of the intracellular fluxes of cho cells cultivated in batch mode in stirred flasks. using this example, the benefits that the use of fsa brings to the whole procedure have been illustrated through a comparison with the use of metabolic flux analysis , a well-established methodology that is the basis of related procedures  <cit> . when the available measurements are only almost sufficient , the procedure provides a more reliable and richer estimation of the evolution of the fluxes, because it takes into account measurements uncertainty and it considers the reversibility constraints. it has been also shown that even when measurements are insufficient , the procedure is capable of estimating the evolution of the non-measured fluxes. finally, when measurements are sufficient , the procedure provides a reliable estimation of the non-measured fluxes -because it considers measurements uncertainty- and offers an interesting approach to cope with inconsistency.

the procedure to estimate the metabolic fluxes can be applied off-line , providing an insight into the time-varying behaviour of the organism. this can help in the understanding of its dynamic metabolic regulation and its adaptation to the environmental conditions. it can also be useful for physiological studies, strain characterization tasks, and to guide research to improve strain and processes. on the other hand, the procedure is a promising tool for on-line monitoring processes in industrial environments, where there is still a lack of reliable on-line sensors. the features of the procedure are especially suitable for this application.

in summary, it has been shown that the temporal evolution of non-measured fluxes can be estimated by using a set of measurable species and a set of known biological constraints. moreover, the procedure proposed considers the intrinsic uncertainty of the experimental measurements and could be applied even if there is a lack of measurable species.

