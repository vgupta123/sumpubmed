BACKGROUND
analysis of hybridized microarrays starts with scanning the fluorescent image. for high-density oligonucleotide arrays  such as affymetrix genechip® oligonucleotide  arrays, the focus of this paper, each scanned image is stored pixel-by-pixel in a 'dat' file. as the first step in measuring intensity of the hybridization signal, a grid is overlaid, the image is segmented into spots or features, and the pixel intensities within each of these are summarized as a probe intensity estimate . the probe-level intensity estimates are stored in a 'cel' file. each gene is represented by pairs of probes, each representing another characteristic sequences and a 'mismatch', which is identical, except for the watson-crick complement in the center. expression of a gene is estimated from such a probe set by applying algorithms for background correction, normalization, and summarization.

the quality of data scanned from a microarray is affected by a plethora of potential confounders, which may act during printing/manufacturing, hybridization, washing, and reading. each chip contains a number of probes specifically designed to assess the overall quality of the biochemistry, such as 'checkerboards' in the corners and borders, whose purpose is, e.g., to indicate problems with the biotinylated b <dig> hybridization. affymetrix software provides for a number of criteria to assess the overall quality of a chip, such as percent present calls, scaling factor, background intensity, and overall pixel-to-pixel variation . software packages such as bioconductor for r  <cit>  have implemented biochemical quality control tools such as rna degradation plots. if a quality problem is found, however, these criteria and tools do not easily suggest a remedy and they have little sensitivity to detect localized artefacts, like a speck of dust or a localized hybridization problem. although such physical blemishes obviously affect the expression estimates, they have hitherto been only narrowly addressed in the literature. thus, there are currently no safeguards to signal potential physical blemishes. instead, researchers are merely advised to carefully inspect the chip images visually  <cit> . given the high variance among the hundreds of thousands of probes and their random allocation on the chip, it is impossible to visually detect any but the starkest artefacts. for two-colour cdna arrays, a bayesian network approach has been proposed  <cit> , based on the 'features' of the pixel distribution within each probe, yet, due to the standardized manufacturing process, the probes on an oligonucleotide array have too few 'features' for such an approach to be effective.

as the price of microarrays continues to drop, a typical microarray experiment now contains several chips, each representing a sample obtained under conditions that were similar except for the experimental factor under investigation. having collections of chips available offers new strategies not only for analyzing the effect of the experimental factor, but also for identifying blemishes. the power of having several chips available was first harnessed for estimating mrna expression levels by the 'robust multichip average'  method  <cit> . one of the assumptions underlying the rma model is that probes across chips are highly correlated, due to differences in their affinity  <cit>  and because only a small proportion of genes are differentially expressed in any experimental setting. this correlation should be even higher for the mismatches, because they are less likely to be affected by the specific changes in gene expression induced by the experimental factor. given the volume of pixel level data,  it is desirable to devise algorithms that work from the  <dig> times smaller probe level files, the same information used in traditional signal value estimation approaches.

RESULTS
data
psoriasis is thought to be due to an overly active immune system  <cit> . to study how the immune response of leukocytes isolated from blood can be affected by drugs that may serve to control autoimmune diseases like psoriasis, blood was drawn from five volunteers under a protocol that had been approved by the rockefeller university hospital institutional review board  <cit> .

for each subject, peripheral blood mononuclear cells  were isolated and cultured in six petri dishes. four cultures were activated with an anti cd3/cd <dig> antibody, two of which were pre-treated with a repressor drug. two cultures served as control without drug or activation. one of the two sets of control, activated, and pre-treated cultures  was analyzed after  <dig>  the other after  <dig> hrs.  all samples were hybridized to affymetrix huu95av <dig> chips.

artefacts identified on probe-level  files
similar results were obtained for all subjects . none of the artefacts would have been detected by visual inspection of the pseudo image . even after having seen the filtered image, most blemishes are difficult to identify at best. interestingly, some chips appear to have a preponderance of specific artefacts, suggesting that at least some of the blemishes are caused by specific environmental factors during hybridization, and providing the first indication for the validity of the proposed method. the chip used as the background in figure  <dig> has 'dark clouds' in the upper left corner and, albeit to a lesser degree, in both lower corners. of the two chips with several smaller artefacts, one had three spots that resemble the 'dark spot' in figure  <dig>  only the bright scratch at the bottom of one of the chips could have been detected by mere visual inspection of the chip, although even this chip passed the rockefeller university's gene array resource center's quality control.

average vs. median in the filtering procedure
the proposed filtering process relies on identifying deviations of a probe on one chip from a measure of central tendency for this probe across chips. thus, if few chips have high intensity 'outliers' for one probe, the chips with normal intensities may appear to be negative 'outliers'. one would expect that the six-chip filter is less likely to generate such 'ghosting' artefacts than the three chip filter. we compared the use of medians vs. arithmetic means as the reference. as we had predicted based on the understanding that errors are more likely to be outliers than white noise, using medians not only resulted in less 'ghosting', but also in fewer isolated cells being considered artefacts and, thereby, better contrast .

validation of probe-level artefacts by going back to the pixel-level image
our method allows us to identify spatially correlated regions that are unlikely to originate from random fluctuations. to demonstrate that the statistical anomalies detected in the pseudo images at the probe level  are, in fact, physical blemishes, we inspected the corresponding raw image at the pixel level. the regular artefacts seen  are clearly blemishes, even if the precise nature of the physical blemish may not be known. still, the difference in features between blemishes suggests different causes.

a number of factors are known to cause bright or dark spots in fluorescence micrographs. dust on the front cover slip will cause a dark, out-of-focus shadow. common white paper is bleached with strongly fluorescent dyes, so fibres from tissue paper ordinarily used for cleaning cause intense glare. many organic solvents, detergents, and other chemicals will fluoresce when concentrated, so leftover droplets or condensates will appear as bright regions, regardless of whether they are in front or behind the focal plane. a crack in the glass would ordinarily be invisible to fluorescence microscopy – except for its ability to accumulate such substances. glass will normally be coated with substances to prevent the direct binding of fluorophores to it; however, any damage to the fragile coating will cause fluorescent streaks. illumination with a coherent source such as a laser, as opposed to a broadband source such as a xenon lamp, has specific artefacts such as speckle. in addition, the arrays themselves are manufactured through photolithographic techniques and may contain occasional damage.

dirt
the visible bright artefact at the bottom-left of figure  <dig> is the only blemish in our dataset that did not require 'harshlighting' to be visible. the magnification in figure 5a shows a structure in an area of  <dig> ×  <dig> probes. figure 5b shows the corresponding area in the raw image, clearly exhibiting this artefact to be a piece of debris lying in front of the active array surface in the optical path. while the exact physical nature of this debris is unclear, there can be no doubt that probes highlighted at the bottom of figure 3b are, in fact, a blemish.

dark and bright spots
a very 'dark spot' was seen in the lower left corner of figure 3b. the probe level pseudo image  shows a dark region, but only the raw image reveals the characteristic of this blemish: an elliptical spot with sharp boundaries which pass through the inside of probes. still, the grid is visible underneath, as in one of the examples given by simon, korn, et al.  <cit>  for cdna arrays. the dark probes in figure 6a are therefore likely to be caused by a physical blemish that has 'stained' the image with a dark oval, a mechanical/optical artefact that invalidates the measured intensities of the probes in the region, so all affected probes in the region should be excluded from further analysis. the 'dark spot' in figure  <dig>  also had a well defined border, although with less contrast . three similar artefacts were seen in yet another chip, as shown in the composite picture .

the bright spot on the upper right corner figure  <dig> clearly is of different nature. the zoomed area of the dat file of the second chip  of subject  <dig> shown in figure 7b reveals a diffuse area of brightness that covers around  <dig> probes. because this bright cloud is out of focus, it is difficult to assess whether its physical location was in front of or behind the focal plane; it could be a leftover detergent condensate in the plastic back panel of the chip. the artefact is less visible in the pseudo image than in the raw image, because the low granularity of the pseudo image enforces an artificial grid structure. moreover, the affymetrix image analysis algorithm, taking the  <dig> percentile of the pixels as an estimate of the probe, may make it more difficult to detect these artefacts through visual inspection because the brightness in areas with low pixel-to-pixel variation is lowered for all percentiles above the median. although they were easily seen in the filtered pseudo image, neither the 'bright spot' nor the 'dark spot' could have been identified by visual inspection of the original pseudo image. even on the raw image, only an extremely thorough search for areas of low pixel-to-pixel contrast or boundaries with high contrast across probes could have detected these artefacts based on a single chip alone. thus, blemishes involving only  <dig> to  <dig> probes would often be overlooked in a visual inspection of both the raw and the pseudo image. given the high variance across pixels, any image processing algorithm aiming at detecting such blemishes at high sensitivity would also create many false positive results.

dark clouds
for the 'dark clouds', the raw image at first did not show any recognizable feature. upon closer inspection, however, we noted that the 'dark cloud' in subject  <dig> had higher pixel-to-pixel variance . the noise does not seem to have a physical origin, as the fluctuations appear to be single-pixel in extent, giving the raw image a 'grainy' appearance.

the areas outside the dark clouds do not appear to be any grainier, so it does not seem to be a change of exposure setting or other simple global change. the image analysis software reports a single, global pixel-to-pixel variation qraw; it would be useful to have a local quality measure as well, in a fashion similar to the reported background estimate for probe intensities. all dark clouds we found impinge on the array borders. we have no conjecture as to the physical origin of this problem.

shadowy circles
the two artefacts crossing the left border of figure  <dig> suggest yet another reason for blemishes on microarrays. only one of our chips displayed this artefact, but it did so twice on the same border. neither the raw image nor physical examination of the chip in a dissection microscope provided any hints to the possible cause .

there are myriad possible explanations for what caused this striking artefact. a perfectly round structure with outliers concentrated near its perimeter, evocative of the 'coffee stain rings' phenomenon  <cit> , suggests that a bubble  may have formed, during the microfluidic stage, condensation after the washing stage, or as a manufacturing defect.

thus, to further elucidate the potential cause of this artefact, we plotted the observed vs. the expected intensity  for each probe in the area depicted above . we then marked the points below the . <dig> percentile of all deviations  in this area, which formed the 'shadowy circle'. these points were seen over a wide range in expected intensity , although their density is higher for lower intensities. notably, their intensity was consistently lower than the expected intensity, as though something had only partially interfered with hybridization – or partially stripped the fluorophores prior to readout, or affected probe sensitivity.

relevance
to determine the extent to which such artefacts may affect standard analyses, we compared the activated vs. the repressed samples  for patient  <dig>  and studied whether masking the blemishes affects the list of differentially expressed genes.

we searched for blemishes all four chips; after manually circling each affected area, we masked  all points in the upper or lower 10th percentile within that area, respectively. we used either the lower or upper 10% since one of our findings is that all artefacts seem to have the common characteristic shown, for instance, in figure  <dig>  that outliers within an artefact are either  exclusively brighter  or darker  than expected we conducted separate analyses for the original and the masked data. we estimated the signal value for each probe using the bioconductor implementation  of the mas <dig> algorithm with default parameters, after modifying the summarization and normalization steps to allow for missing data. the overall effect is shown in figure 10a, with a maximum difference of  <dig>  log <dig> 

genes whose expression estimates changed by more than  <dig>  log <dig> through filtering were considered as 'altered' by filtering. the 'bright spot', where about  <dig> probes were affected, altered the expression of  <dig> genes by up to  <dig>  log <dig>  the 'shadowy circle' altered the expression of about  <dig> genes; more than  <dig> of them by more than  <dig>  log <dig>  the 'dark spot' affected  <dig> probes, altering expression of  <dig> genes by up to  <dig>  log <dig>  the 'cloud' altered the expression of  <dig> genes,  <dig> of them by more than  <dig>  log <dig>  the dirt covering around  <dig> ×  <dig> probes, affected around  <dig> probes, altering  <dig> genes,  <dig> of them by more than  <dig>  to a maximum of  <dig>  log <dig> 

finally, we compared the two conditions , mirroring masked probes on both on the affected and the corresponding chip. as an exploratory criterion, we used the modified  t-test suggested in smyth  <cit>  from the limma package of the bioconductor project  <cit> . as shown in figure 10b, the effects of identifying genes as differentially expressed can be dramatic, demonstrating the potential value of detecting blemishes and masking affected areas on microarrays.

validity
we validate the proposed method using data from the spike-in hug <dig> experiments  <cit> . this data set consists of  <dig> technical replicates of  <dig> separate hybridizations of  <dig> spiked transcripts at concentrations from  <dig>  pm to  <dig> pm arrayed as a latin square. our interest is to assess whether masking the blemishes improves the ability to detect differentially expressed genes. we used the affycomp package of the bioconductor project, which encompass a series of tools developed by  <cit>  to compare the performance of expression measures for affymetrix genechips. figure  <dig> shows that masking blemishes has little effect for large fold changes, as one would expect, while the roc curve  vs.  shows a substantial improvement for small  changes. other statistics are also improved in this case: the average false positive decreases  while the true positives increases . comparing by range of intensities, the area under the curve  is bigger for the masked data in the lower intensities  while keep similar performance in the medium and low range , resulting in a bigger average weighted auc for the filtered data  . thus, our masking procedure improves the sensitivity/specificity to detect small differential expression, especially in the range of low intensities.

discussion
as an alternative approach to identify blemishes, one might try to look at the residuals from parametric estimations in the background subtraction or summarization stages; e.g., looking at the residuals of the pm-mm difference model  <cit>  or the rma model over the pm values  <cit>  to identify possible aberrations. unfortunately, the variety of models currently being discussed attests to the fact that each model has its drawbacks. while random variation can typically be handled by statistical methods, systematic errors in the choice of the model assumptions may have a drastic impact on these processes. the proposed method is robust in the sense that only few assumptions are made. another advantage of our approach is that we can include mismatch probes which are especially suitable to identify aberrations, because they are less sensitive to gene expression variations.

moreover, in any such model of expression estimation the residuals of the entire probe set containing a faulty probe is likely to be affected, so that errors are spread across the probe set and hence over the image; if one probe in a probe set is an outlier, e.g., very bright, all other probes would be slightly dark ghost images, similar to the 'ghosting' seen in figure  <dig>  utilizing topological information for identification and elimination of blemishes has the advantage that suspect probes are identified before background correction, normalization and summarization take place. thus, faulty data will not confound the preprocessing steps and further statistical analysis.

with the next generation of affymetrix chips, the relevance of correcting for blemishes will even increase. here, we analyzed u <dig> chips with  <dig> probe pairs per probe set. to make room for more probe sets, the number of pairs per set has been reduced to   <dig> on the u <dig> chips. this, however, not only increases the standard error by 20%, and, thus the effect of any artefacts on the results, but also reduces the ability of model based methods to draw on probe set information. the number of neighbouring cells on a microarray, in contrast, is not adversely affected by reducing the size of the probe sets. in fact, smaller probe sets make it less likely that probe pairs from the same set are in close vicinity.

CONCLUSIONS
we have presented an extremely simple method for finding blemishes on microarrays. the method's simplicity makes it robust and it does not rely on estimating model parameters. it sensitively tagged blemishes on chips that had passed our gene array resource center's quality control mechanism. only one blemish  could have been readily seen in the raw images. that we found clear evidence of physical blemishes in the raw images for most of the artefacts identified on the pseudo images attests to the validity of the findings.

we have applied our method to an experimental dataset and were able to identify anomalies of different type. approximately 25% of our chips are blemished, often more than once, and blemishes can cover areas from a few dozen to hundreds of probes. we examined the potential impact these blemishes have on the experiments. failure to remove the blemishes from further analysis can materially affect the detection of subtle changes in experiments testing similar conditions. when applied to the spike-in data set, the proposed method had an overall better sensitivity/ ratio.

for the future we propose to develop pattern recognition algorithms to automatically find and mask out suspected blemishes, and to modify the extant background correction and summarization algorithms to be able to properly handle missing data from blemish removal.

