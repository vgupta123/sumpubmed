BACKGROUND
understanding transcriptional regulation is essential to deciphering the genetic pathways involved in various cellular processes and represents one of the major challenges in molecular biology. one critical step during this process is to determine how proteins interact with target dna to regulate gene expression. chromatin immunoprecipitation  followed by pcr amplification of specific target dna has been the primary approach to detect in vivo protein-dna interaction  <cit> . however, the chip-pcr assay has been limiting in characterizing chip-enriched genomic dna on a genome scale. to address this, various techniques have been developed to identify the binding sites of specific dna-associated proteins  <cit> . one frequently used technique is chip-chip  <cit> , in which the protein-bound dna is detected through hybridization to dna microarrays containing a fixed set of probes. however, this approach is heavily biased towards the predetermined probes selected on the dna microarray, limiting the scale and resolution of this method.

more recently, chip-seq, leveraging massively parallel next-generation sequencing technology, has emerged as a powerful method for genome-wide mapping of protein-dna interactions and histone modifications  <cit> . using this technology, numerous studies have been conducted to characterize the genomic landscape of various transcription factors , histone marks and methylation patterns  <cit> . in chip-seq experiments, the chip process isolates dna fragments bound by a protein using a corresponding antibody. oligonucleotide adapters are then linked to the dna to allow ultra-high-throughput sequencing. through direct sequencing of all of the chip-enriched dna fragments, chip-seq is capable of revealing protein-dna interaction sites across the entire genome, making it a valuable tool for researchers.

an array of computer algorithms has been developed to analyze chip-seq data aiming to identify chip-enriched regions  <cit> . excellent reviews of these methods can be found in spyrou et al.  <dig>  <cit>  and laajala et al.  <dig>  <cit> . a brief description of the seven methods chosen for comparison in this study can be found in the method section. although performed well in chip-seq studies, the majority of these methods are rule-based therefore lack the ability to determine the significance of each region. to address this, we have adopted a probability model-based approach to explicitly model noise within sequencing data, thereby enabling rigorous statistical inference. for example, the probability of enrichment can be derived and used to compare across samples and experiments. our approach, referred to as hpeak, utilizes a hidden markov model . hmms have been successfully applied for the analysis of chip-chip data  <cit> , which motivated us to adopt hmm in our present algorithm. recently, mikkelsen et al.   <cit>  and xu et al.   <cit>  have utilized hmms in their chip-seq studies. however, very little detail of their hmm is provided in mikkelsen et al. and the chipdiff method presented in xu et al. is restricted to analyzing comparative histone modification data. by using a novel unbalanced weighting scheme, hpeak will account for the uncertainties in the actual lengths of dna fragments. therefore, it is capable of accurately reconstructing the genome-wide coverage profiles of dna fragments. such information can be used to define the boundaries of chip-enriched regions, which is indicated by the significantly elevated dna fragment coverage relative to the neighboring genomic regions. overall, we demonstrated that hpeak produces higher motif enrichment in the peaks identified without sacrificing sensitivity when compared with other existing peak-calling algorithms.

RESULTS
datasets
to demonstrate the performance of the hpeak algorithm, in this study we used four previously published chip-seq data sets including the nrsf  dataset  <cit> , the stat <dig>  dataset  <cit>  and datasets from two histone marks h3k4me <dig> and h3k27me <dig>  <cit> . we selected these two histone mark datasets because both h3k4me <dig> and h3k27me <dig> are important histone modifier and they show opposite modification patterns  <cit> .

the nrsf chip-seq data  <cit>  was downloaded from a website of illumina , now accessible from geo with accession number gse <dig>  it consists of two files of  <dig> bp sequencing reads in eland output file format. only reads that uniquely mapped to the human reference genome, with up to two mismatches, were included in these two files. one file has about  <dig>  million reads that were obtained from the sample treated by chip. the other file contains about  <dig>  million reads obtained from the mock control sample.

the stat <dig> dataset  <cit>  was downloaded from http://www.bcgsc.ca/data/chipseq. it consists of two files in eland output file format, each of which contains reads combined from six lanes of a flowcell. the lengths of reads contained in these two files range from  <dig> to  <dig> bp. only reads that uniquely mapped to the human reference genome, with up to two mismatches, were included in these two files. the numbers of uniquely-mapped reads contained in these two files are  <dig>  and  <dig>  million for the stimulated and the unstimulated samples respectively.

the bed format of aligned reads obtained from h3k4me <dig> and h3k27me <dig> chip-seq experiments  <cit>  were downloaded from http://dir.nhlbi.nih.gov/papers/lmi/epigenomes/hgtcell.aspx. reads contained in these two files are  <dig> bp in length. the numbers of available reads contained in these two files are  <dig>  and  <dig>  million respectively.

chip-seq reproducibility
it is of critical importance to examine the reproducibility of an experimental assay to confirm that it returns consistent results on biological and technical replicates. in this study, we evaluated the reproducibility of chip-seq by examining the similarity of genome-wide distributions of sequencing reads obtained from duplicated or distinct samples. a common strategy is to apply a chi-square test of homogeneity to compare the two distributions; however, it faces the challenge of selecting the quantity and size of intervals to cover the genome. in this study, we took an alternative approach using the two-sample kolmogorov-smirnov  test to evaluate the distribution of sequencing reads across chromosomes. to compare under the same setting, we first separated reads into individual chromosomes and forward/reverse strands. under the null hypothesis that the two samples are reproducible, the genome-wide distributions of sequencing reads are assumed to be identical. thus we expect non-significant outcome from the k-s test conducted in each chromosome/strand combination. bonferroni correction was used to correct for multiple testing.

for our reproducibility analysis we used the stat <dig> chip-seq data  <cit> , as this dataset is comprised of reads from multiple lanes. in total, there are six lanes each for the stimulated and unstimulated samples. the variance between the numbers of usable reads differed substantially between lanes, ranging from  <dig>  million to  <dig>  million reads per lane of stimulated sample, and  <dig>  million to  <dig>  million per lane of unstimulated sample. since differences in sequencing depth affect the reproducibility assessment, we only considered pairs of lanes with similar numbers of uniquely mapped reads . table  <dig> lists the numbers of chromosome/strand combinations in which the p-value from the k-s test is lower than the bonferroni corrected significance threshold of  <dig> . as expected, we found that no more than one out of  <dig> chromosome/strand combinations showed significant discrepancy for a pair of lanes within either the stimulated or the unstimulated samples. when comparing lanes from the stimulated group to the unstimulated group, we observed a much higher frequency of chromosome/strand combinations displaying significant discrepancies . figure s <dig> in additional file  <dig> shows plots of empirical cumulative distribution functions  under various scenarios. these observations led us to conclude that the k-s test, along with the ecdf plots, provide a rigorous quantitative means for assessing reproducibility in the chip-seq assay.

*numbers displayed in the table are quantities of chromosome/strand combinations that show significant discrepancy when conducting the two-sample kolmogorov-smirnov test.

comparison of chip-seq with chip-chip data
one question that arose from the analysis of the chip-seq experiment is how well it performs relative to the chip-chip experiment. we selected stat <dig> for a comparison study, since it has been recently evaluated using the chip-chip technique  <cit> . using a threshold of false discovery rate   <cit>   <dig> , euskirchen et al. identified  <dig>  chip-enriched regions in about one-tenth of the genome, mostly on chromosomes  <dig>   <dig>   <dig>  x and y. for ease of comparison, we focused only on chip-seq peaks located within these five chromosomes, which corresponds to  <dig>  out of  <dig>  regions. a motif scan demonstrated that the peaks defined by chip-seq showed greater enrichment of the stat <dig> motif than peaks defined by chip-chip. comparison of chi-square statistics using the chip-seq data showed that motifs in the stat family are much more enriched relative to motifs from other families  whereas the stat motif family is not the most enriched in the chip-chip data . our results supported earlier reports of the superior resolution of the chip-seq technique  <cit> .

it has been reported that regions with higher chip-chip scores are more likely to contain the motif of interest  <cit> . a natural question is whether the chip-seq data shows a similar property. to investigate this, we ranked all peaks identified by hpeak from the stat <dig> chip-seq data according to the average posterior probabilities of all bins within the peak. we then divided these peaks into five groups of equal sizes. we next calculated the chi-square test statistics of motif enrichment within each of these five groups of sequences relative to the length-matched control sequences. for comparison, we performed the same analysis on regions identified by the chip-chip study on stat <dig>  <cit> . we found that the change in motif enrichment is more dramatic among regions identified by chip-seq than chip-chip .

performance comparison with other chip-seq peak-calling algorithms
to demonstrate the performance of hpeak, we tested it on the four publicly available chip-seq datasets described above. seven chip-seq analysis packages were used in this comparison, peakfinder  <cit> , findpeak  <cit>  macs  <cit> , sissrs  <cit> , cisgenome  <cit> , chipseeqer http://physiology.med.cornell.edu/faculty/elemento/lab/chipseq.shtml and chipdiff  <cit>  . we applied these software programs to the datasets using either the default or the recommended parameters according to the program manuals.

since findpeaks analyzes treated and control samples separately. to provide a fair comparison, we ran hpeak twice, first using both treated and control samples and second with the treated sample only .

a brief summary of the peak-calling results of the nrsf chip-seq data is presented in table  <dig>  the number of identified peaks ranges from  <dig>   to  <dig>  . as explained in the method section, we used motif enrichment as the measure of performance to evaluate the results obtained from different chip-seq analysis programs. the motif enrichment in the chip-enriched and random control sequences was measured by chi-square test statistics derived from  <dig> ×  <dig> contingency tables . since the numbers of peaks identified differed substantially across these methods, for a fair comparison, we ranked the peaks by each method s specific significance criterion , and subsequently selected the top m peaks nominated from each approach to compare their motif enrichment . overall, for the nrsf dataset, we found hpeak performs the best in most cases when both the stimulated and unstimulated samples were used. when only the stimulated sample was used, hpeak outperformed findpeaks in terms of enrichment of the expected motif.

next, we compared motif enrichment in peaks identified by one method, but not the other, in order to determine the distinguishing features of each program. we found that, among the  <dig>  peaks that were identified as significant by hpeak but not peakfinder, the nrsf motif is the most enriched relative to length-matched random control sequences  among all  <dig> motifs in the matbase matrix library  <dig> . analogously, among the  <dig> peaks that were identified by hpeak, but not findpeaks, the nrsf motif is again the most enriched . in contrast, among the  <dig> peaks that were identified by findpeaks but not hpeak, the nrsf motif ranked 68th among the  <dig> motifs tested with p-value  <dig> , which was no longer significant after correction for multiple testing. when tested using the two half sites of nrsf motif, which have been shown to present in nrsf chip-seq binding domains in statistical significant manner relative to random sequences  <cit> , we found that the right half-site ranked 32nd with p-value of  <dig>  while the left half site ranked 213th with p-value  <dig> . neither was significant after correction for multiple testing. overall, this suggests that peaks identified by other programs but not by hpeak are likely to be false positives.

we next assessed the performance of hpeak using the stat <dig> chip-seq dataset  <cit> . we did not compare it to peakfinder, since it only identified approximately one-tenth of the peaks found by most of the other algorithms under its default parameter settings . compared to the nrsf dataset, the stat <dig> data represents a deeper coverage scenario, with an increase in usable reads obtained from multiple lanes.

for this dataset, when both stimulated and unstimulated samples were considered under the default setting, hpeak identified  <dig>  peaks. the number of peaks identified by competing algorithm ranges from  <dig>   to  <dig>  . using both the stimulated and unstimulated samples, hpeak showed the highest motif enrichment. when only the stimulated sample was used, hpeak identified  <dig>  peaks. using the stimulated sample alone, hpeak showed significantly higher motif enrichment than findpeaks. however, adding unstimulated control samples improved hpeak's performance in terms of motif enrichment . this suggests that the use of control samples may improve the accuracy of identified peak regions as substantial region-specific biases are often observed in genome-wide sequencing due to the different accessibility of genomic regions.

in the above comparison, the lengths of the peaks differed across tested algorithms. therefore, if we scan these peaks only, those with wider peaks will contain more motif of interest. we have corrected such bias by introducing size-matched control sequences. an alternative solution to remove the size bias is to search a fixed window around the peak summit. this method was adopted in the macs study  <cit> . we have examined the performance using this method as well. the results of these scans can be found in figure s <dig> in additional file  <dig>  from there, we found that nearly all methods reported similar number of motif occurrences in the  <dig> bp regions around the peak summits especially for the nrsf data. macs showed slight edge perhaps owing to its accurate positioning of the peak summits.

for the two histone mark datasets, since there is no list of gold standard binding loci, and there are no known motifs associated with either mark, we tabulated the sets of peaks identified from all peak-calling algorithms and studied the overlap among these sets of peaks. the results are summarized in tables  <dig> and  <dig>  we found that results from most of the peak-calling algorithms we tested are very similar especially for the open chromatin histone mark h3k4me <dig> . for h3k4me <dig>  the overlap pattern is similar to what we observed for tfs nrsf and stat <dig> . for h3k27me <dig>  the percentages of overlap vary greatly, most likely due to the fact that the numbers of peaks generated by these peak-calling algorithms are quite different. we did not included results from chipdiff in this evaluation since this program produces many more peaks than others and chipdiff was originally designed for the comparison between two cell types.

* we compare two sets of peaks  to assess how much overlap can be found among them. numbers displayed is the percentage of peaks in one set that are overlapped with at least one peak in another set. for each pair of peak sets, two percentages can be calculated by switching the order of the two sets. the higher percentage for each pair of peak sets is shown.

in addition, we observed that the patterns of the peaks identified from chip-seq experiments on tfs like nrsf and stat <dig> are different from those obtained from chip-seq experiments on histone marks like h3k4me <dig> and h3k27me <dig>  the average peak length is  <dig> bp for nrsf and  <dig> bp for stat <dig> respectively. in contrast, peaks of h3k4me <dig> are much broader  with high variance 2) while peaks of h3k27me <dig> are shorter  with lower variance 2). histograms of peak lengths from the four chip-seq datasets can be found in figure s <dig> in additional file  <dig> 

discussion
in this study we have described hpeak, an hmm-based algorithm for defining chip-enriched peaks from short sequencing read data generated from chip-seq experiments. distinct from various algorithms currently available  <cit> , hpeak explicitly assumes probability distributions to model coverage profiles of hypothetical dna fragment  along the genome. after dividing each chromosome into bins, hpeak employs an hmm to distinguish chip-enriched regions from the background. generalized poisson   <cit>  or zero inflated poisson   <cit>  distributions were used to model observed hdf counts in each bin, allowing for a more optimal fit to the data than a standard poisson distribution. the end of each hdf was down-weighted when evaluating coverage to account for the uncertainties in chip dna fragment length. these features facilitate the recognition of the core regions that show significant chip-enrichment. as a result, hpeak produces more calibrated peaks with higher motif concentration when compared to other peak-finding algorithms. evaluation of experimental data showed favourable performance in terms of motif enrichment. because the underlying hmm is quite general, hpeak may be applied to a wide spectrum of chip-seq data with different experimental design and different sequencing depth, achieving balanced sensitivity and specificity with little or no fine-tuning by the users. in a recent study, laajala et al. conducted a comprehensive performance comparison of existing peak-calling software  <cit> . hpeak was included in that study along with eight other published peak-calling algorithms. we noticed that overall hpeak performance is quite encouraging. for example, hpeak showed the best true positive rate and is closest to the optimum when testing on the nrsf chip-seq data. this is consistent with what we have found.

a key advantage of model-based methods is that they are compatible with rigorous statistical inference. for example, under our model assumption, we can directly calculate the probability of observing the actual number of hdfs in a bin. such probabilities can then be used to rank all peaks identified. this is important, as we have shown that higher-ranking peaks are more likely to harbour canonical binding motifs . furthermore, these probabilities can facilitate comparison of peaks across samples and studies. another advantage of model-based method is that additional information such as gc content and mappability scores can be easily incorporated by extending the model.

in addition to its ability to identify the chip-enriched portion of the genome, hpeak provides more extensive information than other available programs. for example, as an option to users, hpeak provides more comprehensive annotation corresponding to each peak such as gc content, phylogenetic conservation , genomic features of the region , and distance to the tss of nearby genes. hpeak also provides an optional wig file containing the genomic locations of all identified peaks, easily enabling the visualization of all of the peaks within the ucsc genome browser. further, hpeak provides an optional fasta format sequence file containing nucleotide sequences of all peaks to facilitate subsequent motif analysis.

when comparing publicly available stat <dig> chip-seq and chip-chip data, we found that the chip-seq technique has a clear advantage over the chip-chip technique in terms of enriching for an expected motif under the predicted peaks. the improvement can be largely attributed to the increased resolution offered by the new sequencing technology. by enabling the detection of narrower peaks flanking the true binding sites, chip-seq reveals a higher concentration of the predicted binding motif within its peaks. it is known that the significance measure derived from the chip-chip data is correlated with the probability that a region contains the canonical binding motif  <cit> . we found that such correlation is much stronger in chip-seq data . this implies that the read coverage profile is very informative on the presence and location of actual functional binding sites.

in this study, rather than the commonly used chi-square goodness-of-fit test, we proposed to use the k-s test as an alternative to evaluate the reproducibility of datasets obtained under different conditions. we found that the k-s test is better suited for sequencing data than the chi-square goodness-of-fit test, since there is no need to divide chromosomes into windows and correlation/reproducibility can be conveniently visualized by plotting ecdfs .

it is worth pointing out that it is challenging to determine criteria to evaluate the performance of various peak-calling algorithms on experimental chip-seq data. this is because in general very little information is available on true positive and true negative loci. we choose to use the prevalence of known motifs as a metric for performance. one caveat of this approach is that, as pointed out in hu et al.  <dig>  <cit> , many of the motif patterns stored in the database may not be accurate and there maybe novel motifs that do not exist in motif databases. we speculate that the inaccurate motif patterns will affect the results of all peak-calling algorithms equally, but the actual effect remains to be seen and further studies seem warranted. additionally, our method is not well-suited for quantifying false detection rate therefore some methods maybe put in a disadvantaged position in our comparison. because of this, our performance evaluation results should be interpreted with caution.

the chip-seq technology can be applied to other types of proteins in addition to tfs. for example, multiple studies have utilized chip-seq to identify histone modification sites in the genome  <cit> , which is reviewed in park  <cit> . since the underlying two-component hmm is quite general, hpeak can also be applied to data collected from other types of sequencing-based experiments such as medip-seq  <cit> , rna-seq  <cit>  and methylation pattern discovery  <cit> . in these experiments, hpeak can be used to identify regions in the genome that is significantly enriched for sequencing reads. some adjustment of hpeak parameters such as bin size may be needed when analyzing non-chip-seq type of data.

the hmm used in hpeak assumes two different states: enriched and non-enriched. although such a scheme is well-accepted in chip-chip analyses  <cit> , it is possible and of interest to consider more sophisticated hmm schemes where more than two states are allowed. as an example, we may consider a four-state hmm: enrichment of reads on the positive strand, enrichment of reads on the negative strand, enrichment of reads on both strands and no enrichment. by utilizing strand information, we will be able to better identify true binding events since a symmetric pattern among reads with different strands is expected around the binding sites. another possibility is to distinguish shapes of peaks, such as sharp peaks, broad and low plateaus. these may help us to distinguish different types of binding events.

we assume hdf counts follow zip and gp distributions in background and chip-enriched regions respectively. other probability distributions such as negative binomial  has also been used to model chip-seq data  <cit> . it is of interest to understand whether these distributions fit observed chip-seq data better than the standard poisson distribution. to investigate, we fit gp, poisson and nb distributions to the number of hdfs found in nrsf and stat <dig> chip-seq data. for the number of hdfs found in the chip-enriched regions, we found that the gp distribution shows a much better fit than the poisson distribution and a slightly better fit than the nb distributions. an example of the model fit can be found in figure s <dig> in additional file  <dig>  for the number of hdfs found in background regions, we found that the zip distribution produces a slightly better fit than both poisson and nb distributions .

the current hpeak algorithm does not distinguish reads of different orientation within a peak. such information has been shown to be informative in pinpointing the summit of the peak and to estimate the dna fragment length  <cit> . we plan to incorporate such information in the future release of hpeak and we believe it will further enhance the performance of the hpeak program.

CONCLUSIONS
based on our study, we believe that hpeak will be highly useful to researchers conducting chip-seq experiments. for instance, hpeak has already been utilized in a recent study to map the genomic landscape of master transcriptional regulators of prostate cancer  <cit> . we envision that this tool will greatly facilitate the rapid and accurate analysis of the emerging chip-seq data generated by the research community.

