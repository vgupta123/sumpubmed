BACKGROUND
during the last five years, massively parallel sequencing of cdna libraries synthesized from rna samples  has largely replaced the use of microarrays for comparative studies of gene expression . advantages of rna-seq over microarrays include a greater dynamic range and the ability to survey expression in new strains and species without the set-up costs of microarrays and without complications from hybridization differences among genotypes  <cit> . in addition, because rna-seq provides full sequence information for the transcriptome, it is better suited for discovering novel transcripts and splice isoforms and for quantifying allelic abundance in heterozygous and mixed genotype samples than microarrays. measures of allele-specific expression  are particularly important for studying the regulation of gene expression because they can be used to distinguish cis- and trans-regulatory changes  <cit>  and to detect genomic imprinting  <cit> .

to quantify transcript abundance using rna-seq, each short sequence read  is compared to an annotated reference genome. assignment of a read to a specific gene is made by finding the region of the genome with the highest sequence similarity, and the number of reads aligning to a gene is used as a proxy for its relative expression level  <cit> . mapping reads to specific genes is relatively straightforward with the bioinformatics tools available today  <cit> , but using these tools to distinguish between reads derived from alternative alleles of the same gene remains challenging  <cit> . this challenge was most clearly demonstrated by degner et al.  <cit> , who simulated reads from a heterozygous human genotype and assigned them to specific alleles after mapping to a reference human genome. reads perfectly matching the reference genome were assigned to the reference allele, whereas reads containing mismatches to the reference genome were assigned to the alternative allele. despite simulating an equal number of reads from each allele, a bias was observed causing reads to be assigned more often to the reference allele than the alternative allele. controlling for sites known to be polymorphic in humans prior to aligning the simulated reads produced symmetrical measures of relative ase, showing that the differentiating sites themselves caused this bias.

recently, two alternative strategies for aligning reads have been shown to eliminate the systematic bias in measures of relative ase favoring the reference allele. in the first, rna-seq reads are aligned separately to maternal and paternal genomes. these allele-specific genomes can be generated either by sequencing inbred lines with the maternal and paternal genotypes  <cit>  or by inferring the maternal and paternal haplotypes using phased genotype information such as that available for humans from the  <dig> genomes project consortium  <cit> . however, researchers interested in measuring relative ase in organisms for which parent-specific genomes cannot be readily obtained will struggle to use this approach. the second strategy is to consider all possible phasings of variants that can occur in the same sequence read and either supplement the reference genome with these haplotypes  <cit>  or use this information during alignment with a polymorphism-aware aligner, such as gsnap  <cit> . this is a viable strategy for both model and non-model species, but will likely be most effective for intraspecific studies of species like humans with relatively low levels of polymorphism because the number of possible haplotypes increases exponentially with the number of polymorphic sites.

to better understand the source of biased measures of relative ase, we identified properties of sites showing inaccurate measures of relative ase using simulated drosophila sequencing data with known values of relative allelic abundance. simulated datasets contained either ~10-fold or ~100-fold more differentiating sites than the human genotypes used to validate other methods for measuring relative ase  <cit> . we also examined the impact of these factors on measures of relative ase derived from real sequencing data. reads from simulated and real sequencing data were aligned to a single reference genome, varying the number of mismatches allowed, as well as aligned to separate maternal and paternal genomes with no mismatches allowed. we found that limiting analysis of relative ase to regions of the genome with no more differentiating sites than the number of mismatches allowed eliminated the systematic bias toward the reference allele and produced measures of ase similar to those inferred from aligning reads separately to the maternal and paternal genomes. excluding differentiating sites contained within reads that cannot be aligned uniquely or that overlap an insertion or deletion  further improved measures of relative allelic abundance.

RESULTS
the systematic bias in measures of ase correlates with the density of differentiating sites
as described above, degner et al.  <cit>  found that allele-specific reads mapped preferentially to the reference allele when using a single reference genome to quantify ase. the alignment parameters they used allowed two or fewer bases within each read to differ from the reference genome. reads perfectly matching the reference genome were assigned to the reference allele, while reads with at least one difference from the reference genome were assigned to an alternative allele. we hypothesized that the inability to map reads with more differences from the reference genome than mismatches allowed underestimated the abundance of the alternative allele and caused measures of ase to be biased toward the reference allele.

to test this hypothesis, we generated an equal number of reads from two genotypes in silico, combined them, and measured the relative abundance of allele-specific reads. these sequences were derived from  <dig>  non-overlapping constitutively-expressed exons in drosophila melanogaster . the annotated d. melanogaster genome  was used as the “reference” allele, and an edited version of this genome with  <dig>  coding sites altered to match alleles in a line of d. melanogaster from the drosophila genetic reference panel  <cit>  was used as an “alternative” allele. we generated 36-base reads from each allele starting at every possible position in each exon and repeated this process for both strands of dna because rna-seq is usually performed using double-stranded cdna . this process generated  <dig> , <dig> reads, representing ~ <dig>  gb of sequencing data. importantly, this approach guaranteed that reads from each allele were present in equal amounts. to quantify relative allelic abundance as a proxy for relative ase, we aligned each read to the reference genome using bowtie  <cit> , excluding reads that mapped to multiple locations, and evaluated the number of reads assigned to the reference and alternative alleles at each differentiating site using samtools  <cit> .

initially, we allowed one mismatch to the reference genome during the alignment step, which is the minimum number required to align a read from the alternative allele. we found that  <dig> % of differentiating sites had unequal measures of allelic abundance,  <dig> % of which were biased toward the reference allele. to determine whether this bias was influenced by the density of differentiating sites, we calculated the maximum number of sites that differed between the two alleles among all possible 36-base reads overlapping each differentiating site . of all sites considered,  <dig> % had at least one neighboring differentiating site . of these sites,  <dig> % showed more reads assigned to the reference allele than to the alternative allele. furthermore, the extent of bias toward the reference allele increased with the number of neighboring differentiating sites . this bias was caused by the failure of reads simulated from the alternative allele to align to the reference genome more often than those simulated from the reference allele. aligning reads to only the alternative allele produced complementary results . these findings are consistent with our hypothesis that the density of differentiating sites complicates the mapping of reads and leads to biased measures of relative ase.

to decrease the impact of neighboring differentiating sites on allelic assignment, we allowed two or three mismatches when aligning our simulated reads to the reference genome. we found that increasing the number of mismatches improved measures of allelic abundance:  <dig> % and  <dig> % of differentiating sites were inferred to be equally abundant when two and three mismatches, respectively, were allowed. a bias toward the reference allele was still observed, but only for sites where the number of neighboring differentiating sites was greater than or equal to the number of mismatches allowed during the alignment step . increasing the number of mismatches allowed reduced the bias toward the reference allele, but increased the percentage of reads that failed to map uniquely: allowing one, two, and three mismatches,  <dig> %,  <dig> %, and  <dig> % of all reads failed to map uniquely, respectively.

for comparison, we aligned the simulated reads independently to the reference and alternative genomes with the same parameters used when aligning reads to the single reference genome except that zero mismatches were allowed. this is analogous to aligning reads to the maternal and paternal genomes, which is a strategy that has previously been shown to produce unbiased measures of relative ase  <cit> . we found that  <dig> % of differentiating sites showed equal representation of the two alleles, with the rest showing no systematic bias toward either allele . only  <dig> % of all reads were excluded because they failed to map uniquely to at least one genome.

read length and the amount of sequence divergence can also affect allelic bias
given the observed impact of neighboring differentiating sites on allelic assignments, we hypothesized that longer reads might produce less accurate measurements of allele-specific abundance because they should overlap more neighboring differentiating sites. to test this hypothesis, we repeated our simulation with 50-base reads, determining the maximum number of sites that differed between the two alleles among all possible 50-base reads overlapping each differentiating site. we found that  <dig> %,  <dig> %, and  <dig> % of differentiating sites showed equal representation of the two alleles when aligned to a single reference genome with one, two or three mismatches allowed . increasing the number of mismatches allowed when aligning the 50-base sequence reads to be more similar to the ratio of mismatches allowed for the 36-base sequence reads eliminated this difference, however.  <dig> % and  <dig> % of differentiating sites showed equal allelic abundance for 36- and 50-base reads when three and four mismatches, respectively, were allowed . by contrast,  <dig> % of differentiating sites showed equal representation when reads were aligned to the maternal and paternal genomes with zero mismatches allowed .

increased sequence divergence is also expected to affect measures of relative allelic abundance because it should increase the average number of neighboring differentiating sites within each read. to test this hypothesis, we simulated 36-base reads from two different drosophila species  and analyzed them as described above, using the d. melanogaster exome as the single reference genome. sequences from  <dig>  orthologous exons with  <dig> , <dig> differentiating sites were used for this simulation, which is an order of magnitude more differentiating sites than between the two strains of d. melanogaster analyzed. as predicted, we found that the bias toward the reference allele was higher for the interspecific comparison than for the intraspecific comparison when reads were aligned to a single reference genome . when aligning reads to both parental genomes, however, sequence divergence had a negligible impact: the intra- and interspecific datasets produced nearly identical results .

allele-specific differences in mappability and insertions/deletions affect measurements of ase
differences between alleles in sequences that appear more than once in the genome can also cause reads to be excluded for one allele but not the other  <cit> . assuming the number of such differentiating sites is similar between alleles, differences in allele-specific mappability should not systematically favor one allele or the other, but will still cause errors in relative ase. to examine the impact of mappability on measures of relative allelic abundance derived from our simulated data, we used software from the gem library  <cit>  to calculate a mappability score for each differentiating site by averaging the mappability scores of all possible reads that included that site. in each case, mappability scores were calculated using the same number of mismatches allowed during read alignment. differentiating sites with an average mappability score <  <dig> were considered to have imperfect mappability when using a single reference genome. when using parental genomes, we summed the average mappability scores for each allele, and mappability scores <  <dig> were considered to have imperfect mappability.

we then compared relative allelic abundance for sites with perfect and imperfect mappability in all three simulated datasets , excluding sites with more neighboring differentiating sites than the number of mismatches allowed when aligning to a single reference genome. for both the 36- and 50-base reads simulated from the two d. melanogaster genotypes, >  <dig> % of sites with perfect mappability showed the expected equal abundance of the reference and alternative alleles under all mapping conditions . for the 36-base reads simulated from the d. melanogaster and d. simulans genomes,  <dig> % of sites with perfect mappability showed equal abundance when reads were aligned to both parental genomes , but only ~94% of sites with perfect mappability showed such equal abundance when reads were aligned to a single  reference genome .

we hypothesized that this decrease in accuracy after aligning d. melanogaster and d. simulans reads to a single reference genome might be caused by the presence of insertions or deletions  between d. melanogaster and d. simulans that are located near differentiating sites . such indels can prevent the alignment of d. simulans reads to the d. melanogaster genome. consistent with this hypothesis, we found that sites with perfect mappability that had an indel nearby showed more reads assigned to d. melanogaster than d. simulans allele when reads were aligned to only the d. melanogaster genome, whereas sites with perfect mappability that lacked such an indel did not . when reads were aligned to both parental genomes, sites with perfect mappability showed equal representation of the two alleles regardless of the presence or absence of nearby indels . indels were not a factor in our comparisons of the two d. melanogaster strains because the alternative allele was constructed by changing only single nucleotides in the reference allele.

aligning real sequencing data to a single genome can produce reliable measures of relative ase
assessing the accuracy of relative ase measurements derived from rna-seq data is challenging because the true value of relative ase is rarely known. independent empirical methods for measuring relative ase such as pyrosequencing and qpcr can be used to validate rna-seq data for individual genes, but they are not suitable for quantifying relative ase on a genomic scale. therefore, instead of using real rna-seq data to evaluate factors affecting measures of relative ase, we used sequence data that was collected in a comparable manner from genomic dna extracted from f <dig> hybrids, in which all maternal and paternal alleles are expected to be present in equal amounts.

specifically, we used 36-base reads from genomic dna extracted from female f <dig> hybrids that were produced by crossing inbred strains of d. melanogaster and d. simulans <cit> . these strains had the same genotypes as the d. melanogaster and d. simulans sequences used for the interspecific simulation described above. reads were aligned to the d. melanogaster exons allowing one, two, or three mismatches, as well as to both the d. melanogaster and d. simulans exons allowing zero mismatches. because real sequencing data involves stochastic sampling, the proportion of the reference allele observed was not always expected to be  <dig> . therefore, after aligning reads, we excluded differentiating sites with fewer than  <dig> overlapping reads and used binomial exact tests with a false discovery rate threshold of  <dig>  to test each differentiating site for a statistically significant difference in relative allelic abundance  <cit> .

as described above, our simulated datasets showed that reads containing  as many or more neighboring differentiating sites as mismatches allowed during alignment,  imperfect mappability, and/or  an indel between alleles can cause inaccurate measures of relative allelic abundance. differentiating sites with an excess of neighboring differentiating sites were the most common of these three types of problematic sites in both intra- and interspecific simulations . to determine the relative impact of each of these factors on measures of allele-specific abundance derived from real sequencing data, we filtered the differentiating sites based on each factor sequentially and determined the percentage of differentiating sites retained that had no statistically significant difference in abundance between alleles  for each alignment strategy.

prior to excluding any sites,  <dig> %,  <dig> %, and  <dig> %, respectively, of all differentiating sites showed equal allelic abundance when reads were aligned to a single genome with one, two, or three mismatches allowed. after aligning reads to both parental genomes,  <dig> % showed evidence of equal allelic abundance. excluding differentiating sites with at least as many neighboring differentiating sites as the number of mismatches allowed increased this percentage to  <dig> %- <dig> % when aligning to a single reference genome . further restricting the set of differentiating sites to those with perfect mappability increased these percentages ~ <dig> %, and subsequently excluding differentiating sites with indels nearby increased the percentage of genes with equal allelic abundance an additional ~ <dig> % . after filtering out these problematic sites, measures of relative allelic abundance derived from aligning reads to a single reference genome were similar to those produced by aligning sequence reads separately to the maternal and paternal genomes .

excluding selected differentiating sites maintains ability to measure relative ase for most exons
we focused on measures of relative ase for individual sites in this study, but most researchers are more interested in relative ase for individual exons and/or genes. the major consequence of excluding sites based on the density of differentiating sites, mappability, and/or indels is that fewer allele-specific reads will be successfully mapped for each exon and for each gene. after filtering based on the number of neighboring differentiating sites, we found that  <dig> %- <dig> % and  <dig> %- <dig> % of differentiating sites were retained in the 36-base intra- and interspecific simulations, respectively, when the reads were aligned to a single reference genome and one, two, or three mismatches were allowed . by comparison,  <dig> %- <dig> % and  <dig> %- <dig> % of exons contained at least one of these reliable differentiating sites when the same alignment conditions were used in the intra- and interspecific simulations, respectively. excluding additional differentiating sites with imperfect mappability in both datasets, as well as sites with one or more nearby indels in the intraspecific dataset, had little effect on the proportion of differentiating sites and exons retained . the retention of more differentiating sites and exons in the intraspecific simulation than in the interspecific simulation  is consistent with the lower sequence divergence within than between species. analyses using real and simulated reads to compare the same sets of alleles retain the same sites and exons when aligned to the same reference genome because differentiating sites are excluded based only on the genome sequence.

CONCLUSIONS
rna-seq is a powerful tool for measuring ase on a genomic scale; however, a systematic bias occurs when reads from a heterozygous individual are aligned to a single reference genome  <cit> . we found that this systematic bias is predominantly caused by additional differentiating sites located near the focal differentiating site that interfere with read alignment. a similar bias toward the reference allele is caused by the presence of an indel near the focal differentiating site. differences between alleles in mappability  also contribute to inaccuracy of ase, but do not systematically favor one allele or the other across the genome.

using both simulated and real sequencing data, we found that sites affected by the systematic bias toward the reference allele could be identified and excluded prior to estimating ase based on the density of differentiating sites. the precise density at which neighboring differentiating sites became problematic depended on the number of mismatches allowed during the alignment of sequencing reads. after excluding these biased sites, as well as those affected by imperfect mappability and/or an indel nearby, we found that rna-seq data aligned to a single reference genome produced measures of relative ase that were comparable to those resulting from separately aligning the same reads to allele-specific maternal and paternal genomes. furthermore, we showed that excluding these problematic sites did not preclude measuring relative ase for most exons, although the most rapidly evolving exons are expected to be preferentially eliminated. by identifying the specific factors causing erroneous measures of relative allele-specific expression reported in prior work and determining the relative impact of these factors on these measures, results from this study are expected to foster further improvements in methods for quantifying relative allele-specific expression.

