BACKGROUND
sequencing the whole genomes in conjunction with high-throughput analyses of mrna, protein and metabolite profiles  <cit>  has paved the way for a fast reconstruction of metabolic networks  <cit> . for a quantitative assessment of metabolic fluxes, palsson and co-workers have developed a theoretical approach commonly referred to as flux balance analysis   <cit> . this method relies on the hypothesis that the most likely distribution of stationary fluxes in the network has to be optimal with respect to a feasible optimization criterion linking the fluxes with cellular functions. in most applications of fba the fluxes have been determined to maximize a specific network output as the production of biomass  <cit> ) or the production of ethanol in yeast  <cit> . whereas the maximization of biomass production appears to be a reasonable objective of the cellular metabolism of rapidly growing and replicating primitive cells such as bacteria, the flux distribution in complex eukaryotic cells is governed by a larger variety of cellular functions that have to be met simultaneously. therefore, the principle of flux-minimization was proposed as a more general optimization criterion for fba  <cit> . the extension of fba outlined in this paper will be tested by choosing as flux objective both the maximization of biomass and the minimization of internal fluxes at given output fluxes. flux distributions predicted by fba are hypothetical because they depend essentially upon the choice of the flux evaluation criterion used. therefore, to increase the reliability of fba results, one has to seek for strategies to include additional biochemical knowledge into fba. one way is to include measured flux rates as further side constraints. however, flux measurements – except for exchange reactions that deliver metabolites into the external space – are still difficult and costly to perform as they require determining labeled isotopomers in a time-dependent manner  <cit> . another possibility to increase the credibility of flux balance calculations is to include some basic thermodynamics of the reactions and transport processes constituting the network. the thermodynamic consensus rule dictates that a positive net flux through a reaction implies a negative corresponding change of the gibb's free reaction energy and vice versa. based on this fundamental criterion one may check whether given flux directions conflict with known gibb's free energy changes. this allows to identify putative regulatory sites in the network  <cit>  or to decide on the reversibility/irreversibility of reactions  <cit> . however, regarding flux distributions predicted by constrained optimization methods as fba it is desirable to judge their feasibility not only post-hoc but to include thermodynamic constraints on flux directionalities directly into their calculation  <cit> . in our previous work  <cit>  this was accomplished by weighting negative  fluxes with the thermodynamic equilibrium constant of the reaction. the rationale behind this empirical weighting procedure is to impede reversing the direction of a reaction  with increasing value of the thermodynamic equilibrium constant. however, this way of mixing the costs for the maintenance of metabolic fluxes with the thermodynamic 'costs' for reversing the direction of a reaction in one and the same objective function is questionable for two reasons. first, the concentrations of metabolites in a cell differ significantly from  <dig> m so that the actual free energy changes of biochemical reactions may considerably differ from their standard values. second, increasing or decreasing the concentration of the reactants to an extent that enables reversal of the flux direction might occur in the cell by regulations that does not cause much real 'costs' in terms of the production of more enzyme and of used external resources. one way to overcome this shortcoming of our previous approach  <cit>  is to incorporate fulfillment of the thermodynamic consensus rule as additional side constraint into the calculation of the flux distribution. such an approach was recently outlined by henry et al.  <cit> . these authors studied the range of metabolite concentrations that is still compatible with a thermodynamically feasible flux distribution in a genome-scale network of e. coli under conditions of optimal bacterial growth. here we go one step further to include information on metabolite concentrations directly into the calculation of the flux distribution. our algorithm considers the optimization of two different objectives: on one hand a functionally optimal and thermodynamically feasible flux distribution is demanded an on the other hand the calculated metabolite concentrations are required to deviate as little as possible from set-point values prescribed on the basis of biochemical knowledge. in the following we outline the method and provide applications to two different metabolic networks:  the energy- and redox metabolism of red blood cells for which a detailed kinetic model has been established  <cit>  thus allowing to check the feasibility of our method and  the large-scale genome-based metabolic network of escherichia coli ijr <dig>  <cit>  which has already been subjected to fba in several studies  <cit> .

RESULTS
algorithm
thermodynamic constraints
the directionality of the net flux of a chemical reaction and the change of gibb's free energy are related to each other by the consensus rule

 sgn = -sgn , 

where 'sgn()' is the sign function, Δgr denotes the change of gibb's energy of the reaction and v is the net flux  through the reaction. actual changes of gibb's energy can be calculated from changes of standard gibb's energy  according to

 Δgr=Δgr0+rt∑m∈pln⁡−rt∑m∈sln⁡,
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqqhuoarcqqghbwrdawgaawcbagaeeocaihabeaakiabg2da9iabfs5aejabbeeahnaadaaaleaacqqgybgcaeaacqaiwaamaagccqghrawkcqqgsbgucqwgubavdaaeqbqaaigbcygasjabc6gaujabcufabjabd2eanjabc2fadjabgkhitiabbkfasjabdsfaubwcbagaemyta0kaeyici4saeeiuaafabeqdcqghris5aowaaabuaeaacyggsbabcqggubgbcqggbbwwcqwgnbqtcqggdbqxasqaaiabd2eanjabgigiolabbofatbqab0gaeyyeiuoakiabcycasaaa@570e@ 

where  is the active concentration  of the metabolite m, s and p denote the sets of substrates and products of the reaction, respectively. r is the universal gas constant and t is the absolute temperature. the change of the standard gibb's energy is related to the equilibrium constant keq of the reaction by

 Δgr0=−rtln⁡keq.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqqhuoarcqqghbwrdaqhaawcbagaeeocaihabagaegimaadaaogaeyypa0jaeyoei0iaeeouailaemivaqlagiibawmaeioba4maem4sas0aasbaasqaaiabbwgaljabbghaxbqabagccqgguaglaaa@3dbf@ 

it has to be noted that standard gibb's energy changes depend on temperature, ph value, and ion strength and thus may significantly differ from those determined under specific in vitro conditions. for a metabolic network,  reads in vector notation Δgr¯rt=Δgr0¯rt+sc
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadawcaaqaamaanaaabagaeuildqkaee4rac0aasbaasqaaiabbkhaybqabaaaaagcbagaeeouailaemivaqfaaiabg2da9maalaaabawaa0aaaeaacqqhuoarcqqghbwrdaqhaawcbagaeeocaihabagaeeimaadaaaaaaoqaaiabbkfasjabdsfaubaacqghrawkieqacqwftbwucqqgdbwqaaa@3ef0@, where Δgr¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaqdaaqaaiabfs5aejabbeeahnaabaaaleaacqqgybgcaeqaaaaaaaa@30cf@ is the column vector of the Δgr values for all reactions of the network, Δgr0¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaqdaaqaaiabfs5aejabbeeahnaadaaaleaacqqgybgcaeaacqqgwaamaaaaaaaa@31b7@ is the column vector of the Δgr0
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqqhuoarcqqghbwrdaqhaawcbagaeeocaihabagaeeimaadaaaaa@31a6@ values, c is the column vector of the natural logarithms of the active metabolite concentrations.  s is the stoichiometric matrix of the system, where rows refer to reactions and columns refer to metabolites. a positive or negative matrix element of s represents the stoichiometric coefficient with which the metabolite indicated by the column number appears as a product or substrate of the reaction indicated by the row number. changes of the standard gibb's energies of reactions can be additively composed of changes of the standard gibb's energies of the formation of their reactants  <cit> :

 Δgr0¯=sΔgf¯.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaqdaaqaaiabfs5aejabbeeahnaadaaaleaacqqgybgcaeaacqqgwaamaaaaaogaeyypa0dcbegae83uam1aa0aaaeaacqqhuoarcqqghbwrdawgaawcbagaeeozaygabeaaaagccqgguaglaaa@38f5@ 

owing to the first law of thermodynamics the values of the standard gibb's free energy changes are not independent from each other but have to obey the principle of micro-reversibility dictating the sum of standard free energy values in a closed system to be zero. in several flux balance studies  <cit>  this criterion has been referred to as generalization of kirchhoff's loop law which . the problem is that experimentally determined values for the changes of standard gibb's energies are not consistent with the principle of micro-reversibility per se because of experimental errors. therefore, we add correction terms  to all observed values of standard gibb's energy changes and determine minimal corrections necessary to assure the principle of micro-reversibility. the corresponding optimization problem reads

 minimize‖e‖subjecttoΔgr0¯∗=sΔgf¯∗+e,
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaafaqaaegacaaabaacbegae8xta0kae8xaakmae8nba4mae8xaakmae8xba0mae8xaakmae8neaonae8xzaugabawaauwaaeaacqqgfbqraiaawma7caglkwoaaeaacqwftbwucqwf1bqdcqwfibgycqwfqbgacqwflbqzcqwfjbwycqwf0badcqwfgaaicqwf0badcqwfvbwbaeaadaqdaaqaaiabfs5aejabbeeahnaadaaaleaacqqgybgcaeaacqqgwaamaaaaaowaawbaasqabeaacqghxiikaagccqgh9aqpcqwftbwudaqdaaqaaiabfs5aejabbeeahnaabaaaleaacqqgmbgzaeqaaaaakmaacaaaleqabagaey4fiocaaogaey4kasiaeeyraukaeiilawcaaaaa@58fb@ 

where ||e|| is the 2-norm of the vector e, and Δgf¯∗
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaqdaaqaaiabfs5aejabbeeahnaabaaaleaacqqgmbgzaeqaaaaakmaacaaaleqabagaey4fiocaaaaa@31dd@ are hypothetic gibb's free energy changes of formation. Δgr0¯∗−e
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaqdaaqaaiabfs5aejabbeeahnaadaaaleaacqqgybgcaeaacqqgwaamaaaaaowaawbaasqabeaacqghxiikaagccqghsislcqqgfbqraaa@34e5@ is then used as the modified vector of standard gibb's energy changes fulfilling the condition of micro-reversibility.

constraints on metabolite concentrations
in case that the metabolite concentrations might assume arbitrary non-negative values it would be always possible to let a chemical reaction proceed in either forward or backward direction. hence, including information on metabolite concentrations as additional constraints in fba makes only sense if the concentration of the metabolites can be restricted to a feasible range. if the concentration of a metabolite is known, we use this value as set-point which should be approximated as best as possible by the calculated metabolite concentration. thus, we add the term

 ∑m∈w2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaaeqbqaaiabcicaoiabdogajnaabaaaleaacqwgtbqbaeqaaogaeyoei0iaem4cam3aasbaasqaaiabd2gatbqabagccqggpaqkdaahaawcbeqaaiabikdayaaaaeaacqwgtbqbcqghiiizcqqgxbwvaeqaniabgghildaaaa@3c8e@ 

to the objective function where w denotes the set of metabolites m for which a set-point  concentration value sm is available and cm is the component of c related to metabolite m. if the concentration of a metabolite is not exactly known but can be restricted to a narrower concentration range based on metabolite profiling  we use this information to define so-called soft concentration bounds denoted by clow and chigh. in case that such physiologically feasible concentration range has not been reported yet we set the lower and upper soft bound close to the minimum and maximum of all known cellular metabolite concentrations. however, it may happen that a non-trivial flux distribution can only be found if the concentration of some metabolites drops off the range defined by the soft bounds. this may be due to the improper choice of soft bounds for some metabolites resulting from large experimental errors in the determination of cellular metabolite concentrations or the  binding of metabolites to macromolecular structures lowering their effective free concentrations inside the cell. therefore, concentrations lying outside the range of the soft bounds are allowed in our algorithm but are penalized in the optimization criterion:

 s={clow−cif c<clow0if clow≤c≤chighc−chighif c>chigh
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgzbwccqggoaakcqwgjbwycqggpaqkcqgh9aqpdagabeqaauaabaqadiaaaeaacqwgjbwydawgaawcbagaeeibawmaee4ba8maee4dachabeaakiabgkhitiabdogajbqaaiabbmgapjabbagamjabbccagiabdogajjabgyda8iabdogajnaabaaaleaacqqgsbabcqqgvbwbcqqg3bwdaeqaaagcbagaegimaadabagaeeyaakmaeeozaymaeeiiaaiaem4yam2aasbaasqaaiabbygasjabb+gavjabbeha3bqabagccqghkjyocqwgjbwycqghkjyocqwgjbwydawgaawcbagaeeiaagmaeeyaakmaee4zacmaeeiaaggabeaaaoqaaiabdogajjabgkhitiabdogajnaabaaaleaacqqgobaacqqgpbqacqqgnbwzcqqgobaaaeqaaagcbagaeeyaakmaeeozaymaeeiiaaiaem4yammaeyopa4jaem4yam2aasbaasqaaiabbigaojabbmgapjabbeganjabbigaobqabaaaaagccagl7baaaaa@724e@ 

here c is the  active concentration of the metabolite. the penalty function for the whole concentration vector is

 s=∑c component of cs.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgzbwccqggoaakcqqgdbwqcqggpaqkcqgh9aqpdaaeqbqaaiabdohazjabcicaoiabdogajjabcmcapawcbagaem4yammaeeiiaaiaee4yammaee4ba8maeeyba0maeeicaanaee4ba8maeeoba4maeeyzaumaeeoba4maeeidaqnaeeiiaaiaee4ba8maeeozaymaeeiiaaiaee4qameabeqdcqghris5aogaeiola4caaa@4d2f@ 

as in henry et al.  <cit>  we introduce a second type of bounds, so-called hard bounds, to exclude metabolite concentrations which are impossible from the biochemical point of view. the combined effect of set-point values, soft and hard concentration bounds on the scoring function of the optimization algorithm is shown in figure  <dig> 

metabolic network models may contain reactions which are simplified in a way that reactants are dropped from the reaction formula. for example, the oxidation of glutathione  to glutathione disulfide  is usually written as an overall reaction 2gsh → gssg. actually, this reaction should read 2gsh + r-ooh → gssg + r-ohh2o where r-ooh represents a large group of not further specified hydroperoxides that can be detoxified by the glutathione system. for these lumped reactions it is impossible to give a realistic Δgr0
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqqhuoarcqqghbwrdaqhaawcbagaeeocaihabagaeeimaadaaaaa@31a6@ value. for other reactions a Δgr0
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqqhuoarcqqghbwrdaqhaawcbagaeeocaihabagaeeimaadaaaaa@31a6@ value is simply not known . for such reactions the consensus rule  is not applied.

setting up the constrained optimization problem
in fba, formulation of the optimization problem requires to define the following three elements:  a physiologically meaningful scoring function to evaluate flux distributions,  the steady-state conditions for all internal metabolites valid for the time-scale of interest  and  further constraints taking into account biochemical knowledge as, for example, maximal enzyme capacities limiting the flux rates  <cit>  or thermodynamic constraints on flux directions as those discussed above. the steady-state condition can be formulated as

 s'v =  <dig> 

where s' derives from the full stoichiometric matrix s of the network upon deletion of all columns referring to those metabolites which are exchanged with the external environment and thus need not to be balanced. according to the principle of minimal fluxes  <cit>  we set up the scoring function as the sum of the absolute values of all reaction fluxes |v| while assigning fixed values lj, j ∈ j to all output fluxes, which are directly linked to cellular functions, the so-called target fluxes, the set of which is denoted by j. adding the weighted terms  and  to the scoring function and including the constraint  the complete optimization problem is written as

 minimize|v|+λ1s+λ2∑m∈w)2subjecttos′v=00≤vj+αdj≤α,1≤j≤n0≤−Δgrj+αdj≤α,1≤j≤nΔgr¯/=Δgr0¯/+scc∈ℭvj=lj,j∈j.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaafaqaaewbcaaaaeaaieqacqwfnbqtcqwfpbqacqwfubgbcqwfpbqacqwftbqbcqwfpbqacqwf6bgecqwflbqzaeaadaabdaqaaiabbafawbgaay5bslaawia7aiabgucarggaciab+t7asnaabaaaleaacqaixaqmaeqaaogaem4camnaeiikagiaee4qamkaeiykakiaey4kasiae43udw2aasbaasqaaiabikdayaqabagcdaaeqbqaaiabcicaoiabdogajnaabaaaleaacqwgtbqbaeqaaogaeyoei0iaem4dacnaeiikagiaemyba0maeiykakiaeiykakyaawbaasqabeaacqaiyagmaaaabagaemyba0maeyici4saee4vacfabeqdcqghris5aagcbagae83uamlae8xdaunae8nyaimae8naaomae8xzaumae83yammae8hdaqnae8hiaaiae8hdaqnae83ba8gabagaf83uamlbauaacqqgwbgvcqgh9aqpcqaiwaamaeaaaeaafaqabeqacaaabagaegimaajaeyizimqaemoday3aasbaasqaaiabdqgaqbqabagccqghrawkcqgfxoqycqwgkbazdawgaawcbagaemoaaogabeaakiabgsmijkab+f7ahjabcycasaqaaiabigdaxiabgsmijkabdqgaqjabgsmijkabd6gaubaaaeaaaeaafaqabeqacaaabagaegimaajaeyizimqaeyoei0iaeuildqkaee4rac0aa0baasqaaiabbkhaybqaaiabdqgaqbaakiabgucariab+f7ahjabdsgaknaabaaaleaacqwgqbgaaeqaaogaeyizimqae4xsdemaeiilawcabagaegymaejaeyizimqaemoaaomaeyizimqaemoba4gaaaqaaaqaamaanaaabagaeuildqkaee4rac0aasbaasqaaiabbkhaybqabaaaaogaei4la8iaeiikagiaeeouailaemivaqlaeiykakiaeyypa0zaa0aaaeaacqqhuoarcqqghbwrdaqhaawcbagaeeocaihabagaegimaadaaaaakiabc+caviabcicaoiabbkfasjabdsfaujabcmcapiabgucariab=nfatjabboeadbqaaaqaaiabboeadjabgigioprr1ngbprmryf2a0vncaehbfv3yslgzgykchtgd1jhaiqaacqqfteyqaeaaaeaafaqabeqacaaabagaemoday3aasbaasqaaiabdqgaqbqabagccqgh9aqpcqwgmbatdawgaawcbagaemoaaogabeaakiabcycasaqaaiabdqgaqjabgigiolabdqeakjabc6cauaaaaaaaaa@cc8b@ 

ℭ
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufebsjuyzl2yd9gzlbvynv2caerbhv2bydwahbqedmvetj2bsbqee0evguee0jxyaibaiki8=vi8tuq8fmi8gi=heeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqacigacagaaeqabaqadeqadaaakeaatuudjxwakzkchtgd1jharyqr1ngbprgigjxyrrxdybaceagae8xlhmeaaa@3f03@ is a vector of ranges defined by the hard concentration bounds. v is the vector of flux rates and vj is the j-th component of v. λ <dig>  λ <dig> ∈ ℝ+ are empirical factors weighting the relative contribution of the various penalty scores relative to the scoring function of fluxes.  n is the number of reactions, and for any  <dig> ≤ j ≤ n, dj is a binary variable. α is set to a positive number which is larger than any possible flux value and larger than any possible gibb's energy value, and it can easily be shown that the constraints  <dig> ≤ vj + αdj ≤ α and  <dig> ≤ -Δgrj
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqqhuoarcqqghbwrdaqhaawcbagaeeocaihabagaemoaaogaaaaa@321c@ + αdj ≤ α are equivalent to vj ≠  <dig> → sgn = -sgn . intentionally, for a zero flux through a reaction the change of gibb's free energy is not constrained because it might be substantially different from zero if the corresponding enzyme is missing or inhibited. the optimization problem corresponds to a mixed integer  linear program with quadratic scoring function.

we call a flux distribution obtained by solving the above optimization problem  thermodynamically realizable and refer to it in the following as tr-fluxmin, i.e. thermodynamically realizable flux-minimized solution. if the maximization of biomass is used as flux objective, the sum of internal fluxes appearing in the objective function is replaced by the negative biomass production rate.

testing
application to a metabolic network of human erythrocytes
the method described above was applied to a metabolic network of human red blood cells  <cit>  for which stationary flux distributions have already been calculated in our previous work  <cit> . the network comprises basically two cardinal metabolic pathways of this cell: glycolysis including the so-called  <dig> -bisphosphoglycerate shunt, and the pentose phosphate cycle dividing into an oxidative and a non-oxidative part. the network consists of  <dig> biochemical reactions,  <dig> transport processes and  <dig> metabolites . the orientation of the arrows in the reaction scheme corresponds to the net direction of the reaction flux at standard concentrations. standard gibb's energies have been derived from the equilibrium constants contained in the kinetic model  <cit> . the functionally essential target reactions that have to be maintained by the network are the following:  formation of  <dig> -bisphospho-d-glycerate  required to modulate oxygen affinity of hemoglobin,  atp-utilization , which is mostly spent on the na+/k+-atpase to build up the na+/k+-gradient across the plasma membrane,  oxidation of gsh  to prevent oxidative damage of cellular proteins and lipids,  synthesis of prpp  required for the salvage of adenine nucleotides. the magnitude of these  <dig> target reactions depends on the specific external conditions of the cell as, for example, osmolarity of the blood or preservation medium, oxidative stress caused by reactive oxygen species, or lowering of the oxygen tension during hypoxia. in our calculations the flux values for these  <dig> target reactions were chosen as reported for the normal in vivo state of erythrocytes: dpgm =  <dig>  mmol/h, atpase =  <dig>  mmol/h, gshox =  <dig> μmol/h, prpps =  <dig> μmol/h. with these values for the target fluxes, the comprehensive kinetic model  <cit>  yielded metabolite concentrations as shown in figure  <dig>  these values are in good concordance with experimentally determined concentrations and thus will be referred to in the following as 'observed' concentrations.

using the same values of standard gibb's free reaction energy changes as used in the kinetic model and putting the set-point values of the metabolite concentrations to the 'observed' ones, the tr-fluxmin solution of the optimization problem turns out to be identical with the flux-minimized solution determined by our previous approach  <cit> . a detailed description of the model and the solution mentioned below can be found in the supplements .

perturbation analysis
to investigate the impact of errors in the observed metabolite concentrations on the predicted flux distribution the concentration values given in figure  <dig> were perturbed by multiplying them with a random factor obeying an exponential normal distribution with controlled standard deviation . the hard concentration bounds were chosen as follows:  <dig>  μm... <dig> mm ,  <dig>  μm... <dig> mm , and  <dig>  μm... <dig> mm . calculation of the flux distribution with randomly altered set-point concentration values was repeated in  <dig> trials. surprisingly, for smaller perturbations the reference solution  was retained in all trials. but perturbations with a standard deviation of  <dig>  resulted in a second, slightly different, flux distribution in some trials. for perturbations with standard deviation of  <dig>  this second alternative flux distribution dominated and on top a third alternative flux distributions was obtained in a significant number of trials .

in a second perturbation analysis, the standard gibb's energy change values were randomly altered in a similar manner. also here, there was an increasing tendency towards the two alternative flux distributions found before when increasing the magnitude of perturbations . these alternative flux distributions already occurred at a standard deviation of  <dig>  and their relative share became dominant at a standard deviation value of  <dig> .

inspection of alternative flux distributions
the three alternative flux distributions obtained in the perturbation studies differ in the uptake flux of glucose  and the fluxes in the non-oxidative pentose phosphate pathway converting ribulose-5-phosphate  into fructose-5-phosphate  and glyceraldehyde 3-phosphate . the reference solution predicts this pathway to proceed in forward direction thereby forming  <dig>  μmol/h ribulose-5-phosphate. in the second solution  this pathway is not used at all whereas in the third flux distribution  it is used in backward direction producing  <dig>  μmol/h ribulose-5-phosphate. interestingly, the latter flux distribution is also obtained for the unperturbed network if the maximization of biomass production used as flux criterion. notably, all three different flux distributions obtained as solution of the minimization problem  for randomly altered thermodynamic parameters and set-point concentrations are feasible from the kinetic view point, i.e. the kinetic model of the erythrocyte metabolism yields a stable stationary solution.

effect of external concentrations
our algorithm allows assessing how the predicted flux distributions are affected by changes in the concentration of external metabolites. in vivo, such a situation may occur if some essential fuels for the cellular metabolism are depleted, for example, due to a reduced blood flow through vessels with severe atherosclerotic stenoses, or some end products of the cellular metabolism accumulate because of a reduced excretion capacity of the body. for example, in case of strong physical exercise the concentration of lactate in human blood may rise to values as high as  <dig>  mm  respectively  <dig>  mm   <cit>  indicating that the lactate production by the anaerobic skeletal muscle clearly exceeds its rate of re-conversion to glucose in the liver and its utilization rate in the heart muscle. to investigate the consequences of such high blood lactate levels for the metabolism of red cells we calculated thermodynamically realizable flux distributions at gradually increasing concentration of external lactate. for all metabolites except external lactate, the hard bounds were put to ± 25% and the soft bounds to ± 10% deviation from of the 'observed' concentration values. for external lactate concentrations up to a critical value of  <dig>  mm our algorithm predicted a thermodynamically realizable flux distribution. for concentrations higher than  <dig>  mm no stationary flux distribution solution was found. increasing gradually the concentration of external lactate up to the critical value of  <dig>  mm, the concentrations of pyruvate, nad+ and nadh tended towards the hard bounds to ensure the flux through the lactate dehydrogenase  to be directed towards formation of lactate. our find of a metabolic threshold effect with respect to blood lactate levels corresponds well with clinical observations. at lactate levels higher than  <dig> mm a reduced deformability of erythrocytes is observed, which may account for the exercise-induced arterial hypoxemia occuring in athletes  <cit> . decreasing deformability of erythrocytes is a clear indication for a severely perturbed metabolism of the cell.

application to a metabolic network of e. coli
to check the applicability of our algorithm to genome-scale metabolic networks comprising hundreds of reactions and metabolites, we performed the same type of analysis as described above with respect to the metabolic network ijr <dig> of the bacterium e. coli reconstructed by palsson and co-workers  <cit> . in this model a minimal medium composed of glucose, ammonium, sulfate, oxygen, phosphate is sufficient for growth according to the biomass creation formula associated with the model. experimental flux data for e. coli has been determined by emmerling et al.  <cit>  which correspond to  <dig> internal fluxes of the ijr <dig> network  the thermodynamic properties of the ijr <dig> network, consisting of  <dig> metabolites and  <dig> reactions, have been analyzed previously  <cit> . since experimentally determined gibb's free energies are available only for a minor fraction of reactions  <cit>  we use computed values given by henry et al.  <cit> .

these values were obtained by a slightly modified version of the group contribution method  <cit> . physiological concentration ranges were available for  <dig> internal metabolites  and  <dig> external metabolites . for the other metabolites generic concentration bounds were used based on typical cellular concentration ranges reported in the literature:  <dig> μm- <dig>  mm ,  <dig> μm- <dig> mm . further details of the model are given in the supplement .

we calculated the flux distribution in this network according to the proposed optimization principle  using as flux objective the maximization of the biomass production. no a priori assumptions were made with respect to the directionality of reactions with two exceptions: the direction of the exchange fluxes was fixed according to the experimental conditions  <cit>  and the direction of  <dig> internal reactions for which no gibb's energy value was given in henry et al.  <cit>  was also fixed . as shown in fig. 5)  the thermodynamically realizable solution provided a good concordance with observed flux values available for  <dig> internal reactions. to check the influence of the thermodynamic side constraints on the quality of the flux distribution, we omitted the condition of thermodynamic realizability from the optimization algorithm, again making no a priori assumptions on flux directionalities. in this case ) the concordance between predicted and observed flux values diminished significantly. this example shows that our algorithm may significantly improve the reliability of flux predictions even if the concentration range of most metabolites is only roughly restrained.

in a third calculation we again omitted the condition of thermodynamic realizability from the optimization algorithm but instead used the heuristic classification of reactions into reversible and irreversible ones as outlined in  <cit>  . the obtained flux distribution also yielded a reasonably good concordance between predicted and observed flux values. notably, this 'classical' variant of fba gave no better predictions of the observed fluxes than the tr-solution obtained with our algorithm. this qualifies our method as a valuable flux predictor for large-scale networks without the need to apply heuristic rules for the assignment of flux directionalities.

perturbation analysis
using the same perturbation analysis as outlined above for the erythrocyte network we investigated the impact of alterations in the values of the gibb's free standard energies on the predicted flux distributions. such an analysis is of importance as the values of standard gibb's free energy changes computed by the group contribution method may generally exhibit a large degree of uncertainty  <cit> .

compared with the findings for the erythrocyte network, much smaller perturbations already resulted in a multitude of alternative flux distributions . thus, the higher the complexity of the network the more susceptible is the predicted flux distribution is to the choice of the standard gibb's energies. closer inspection of the predicted alternative flux distributions showed that the main differences are concentrated in some distinct parts of the networks. we found the largest variability of predicted fluxes for the exchange of co <dig>  the 3-reaction pathway leading from acetaldehyde and coa to formation of atp from adp via acetyl-phosphate as intermediate, and in the import of a-ketoglutarate. the possible fluxes through these reactions appear to be strongly determined by thermodynamic constraints and thus are difficult to predict given low accuracy of thermodynamic data.

discussion & 
CONCLUSIONS
quantitative evaluation of genome-scale metabolic models by means of fba is becoming more and more appealing because it works without knowledge of the kinetics and regulation of the underlying enzymes and membrane transporters. however, the outcome of fba is rather hypothetical because it relies on plausible but hardly provable optimality principles that are thought to govern metabolic flux distributions.

therefore, a challenge for computational systems biology lies in the incorporation of all biochemical knowledge that is obtainable at genome-scale . one important restriction of fluxes in the network arises from thermodynamics. reactions associated with a decrease of free energy larger than  <dig> kj/mol are generally thought to be irreversible. this condition can be used as an additional constraint on feasible flux distributions. kümmel and co-workers  <cit>  have recently developed an algorithm that – based on thermodynamics, network topology and heuristic rules – automatically assigns reaction directions in metabolic models such that the reaction network is thermodynamically feasible with respect to the production of energy equivalents. however, an a priori distinction between reversible and irreversible reactions may become problematic under extreme conditions, e.g. depletion of substrates or accumulation of intermediates due to inhibition of enzymes, where metabolite concentrations may drastically change thus allowing to reverse reactions that are normally designated to be irreversible.

for example, under hypoxic conditions, the cellular concentration of oxygen may become so low that the respiratory chain – usually thought to carry electrons from hydrogen to oxygen in a strictly irreversible manner – may indeed operate in the reverse direction, i.e. reducing nad to nadh <dig>  <cit> . thus, it is necessary to replace the rigid priori classification of reactions into reversible and irreversible ones by a more flexible constraint that assures the flux directions to be compatible with the change of gibb's free energies, exhibiting a wide range of values depending on the actual metabolite concentrations. an important step into this direction was recently made by henry et al.  <cit>  who included the thermodynamic consensus rule as additional side constraint into fba. in their study, they investigated the range of metabolite concentrations that allow in a genome-scale network of e. coli the realization of a specific flux distribution assuring optimal bacterial growth. in contrast to this approach, the algorithm proposed in this work aims at employing reliable information on metabolite concentrations to restrain the solution space of fba.

hence, depending on reported ranges of metabolite concentrations, our algorithm may yield different flux distributions. in other words, in our approach we do not ask for metabolite concentrations that are compatible with a given flux distribution but in contrast ask for the flux distribution that is compatible with a given metabolite profile. as demonstrated for two exemplary metabolic networks, even if no measurements of metabolite concentrations are available restriction of concentrations to physiologically feasible ranges alone allows the prediction of reliable flux distributions if no a priori assumptions are made on the reversibility of the reactions. as demonstrated for the erythrocyte network, our approach may provide valuable information about alterations in the external conditions of a cell that may result in a metabolic dysfunction. of course, fba cannot assess whether a stable steady state may exist at very high concentrations of external lactate because this is determined by kinetic regulation. possibly the metabolite concentrations may vary even in a larger interval than imposed in our calculations. this problem can be addressed better by a comprehensive kinetic network model. nevertheless, our method may provide valuable information on external conditions causing metabolic problems merely for thermodynamic reasons. concerning the predictive capacity of our method it must be critically noted that – based on a comparison with a relatively small number of measured fluxes – the most reliable flux distribution for the e. coli network is still obtained if the directionality of fluxes is a priori defined based on biochemical conventions. this is obviously due to the fact that – owing to the lack of reliable experimental data – the soft bounds for the metabolite concentration used in our method have been too generously chosen. indeed, enlarging systematically the physiologically feasible concentration ranges one eventually obtains a network without any constraint of flux directionalities. hence, the usefulness of the proposed method essentially depends upon the availability of reliable information on values of free energy changes and metabolite concentrations. as long as this information is not available, the benefit of our method consists mostly in the generation of alternative flux distributions by varying the values of standard gibb's free energy changes and/or in the physiologically relevant concentration ranges of metabolites. applying such perturbation analysis to two networks of different complexity has provided evidence that the larger the network is, the more alternative flux distributions occur, even at relatively modest variation of energy values of about  <dig> kj/mol. inspection of such alternative flux distributions reveals critical reactions for which fluxes are largely undetermined by the fba approach. in this respect, our method represents a useful complement to the thermodynamic evaluation method recently proposed by kümmel et al. to identify putative regulatory sites by network-embedded thermodynamic analysis of metabolome data  <cit> .

authors' contributions
the basic idea of the presented theoretical concept was developed by hgh. ah and sh prepared of the network models. ah developed the algorithms and carried out the computations. all authors jointly contributed to the manuscript.

supplementary material
additional file 3
this document shows the proof that thermodynamic realizability implies that there is no net flux in a closed loop – a consequence of the generalization of kirchhoff's loop law.

click here for file

 additional file 1
this archive contains three files relating to the erythrocyte network. the file "ery-model.txt" gives the definition of the network as tab-separated text file which is organized in the sections: 'metabolites', 'reactions', 'reactions excluded from the tr property', 'equilibrium constants', 'targetfluxes', 'fixed concentrations', the file "ery.sbml" gives the network description in sbml format. the file "ery-solutions.txt" contains three solutions: the thermodynamically realizable fluxmin solution  together with the associated metabolite concentrations and the two alternative solutions obtained in the perturbation analysis.

click here for file

 additional file 2
this archive includes two directories relating to the e. coli ijr <dig> computations: "fullyreversible" and "heuristicirreversibilities". both contain the file "ecoli-model.txt", a tab-separated text file, as the definition of the network which is organized in the sections: 'metabolites', 'reactions', 'reactions excluded from the tr property', 'equilibrium constants', 'targetfluxes', 'concentration bounds', and 'setpoint concentrations'. both directories also contain the file "ecoli.sbml", the network description in sbml format. the file "biomax.txt" also residing in both directories contains the solution of the biomass maximization without the constraint of thermodynamic realizability as a tab-separated text file assigning a reaction identifier with a flux value if it is not zero.. additionally the directory "fullyreversible" contains the file "tr-biomax.txt" as the solution to the thermodynamically realizable biomass maximization together with the hypothetic metabolite concentrations compatible with the flux directions.

click here for file

 acknowledgements
the work of ah was funded by the german federal government's program "systems biology of hepatocytes – hepatosys".
