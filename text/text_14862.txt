BACKGROUND
cellular metabolism is a complex biological problem. it can be viewed as a chemical engine that transforms available raw materials into energy or into the building blocks needed for the biological function of the cells. in more specific terms a metabolic network is indeed a processing system transforming input metabolites , into output metabolites  according to very strict molecular proportions, often referred as stoichiometric coefficients of the reactions.

although the general topological properties of these networks are well characterized  <cit> , and non-trivial pathways are well known for many species  <cit>  the cooperative role of these pathways is hard to comprehend. in fact, the large sizes of these networks, usually containing hundreds of metabolites and even more reactions, makes the comprehension of the principles that govern their global function a challenging task. therefore, a necessary step to achieve this goal is the use of mathematical models and the development of novel statistical techniques to characterize and simulate these networks.

it is well known that under evolutionary pressure, prokaryote cells like e. coli behave optimizing their growth performance  <cit> . flux balance analysis  provides a powerful tool to predict the optimal growth and production fluxes, but is not reliable about phenotypic state the cell will acquire. this is mainly due to the fact that among the infinitely many potential network states compatible with the stoichiometric constraints, fba chooses a single one whose biological meaning is at least questionable under generic external conditions. fba maximizes a linear function  subject to biochemical and thermodynamic constraints  <cit> . on the other hand, cells with genetically engineered knockouts or bacterial strains that were not exposed to evolution pressures, need not to optimize their growth. in fact, the method of minimization metabolic adjustment  <cit>  has shown that knockout metabolic fluxes undergo a minimal redistribution with respect to the flux configuration of the wild type. yet, in more general situations, the results are unpredictable, therefore, a tool to characterize the shape and volume of the whole space of possible phenotypic solutions must be welcome.

so far, apart from exact algorithms evaluating the volume of the space of possible solutions, that are unsuitable for analyzing metabolic networks larger than some dozens metabolites  <cit> , the best technique allowing for such a characterization is based on monte carlo sampling  of the steady-state flux space  <cit> . this method is known to perform very well on intermediate size metabolic networks   <cit>  where different strategies of mcs have been implemented giving comparable results. some improved variant of mcs seems to perform well also on organism-wide where the number of variables is in the range order of a thousand  <cit> . although mcs has in general some intrinsically associated problems, mainly due to the fact that the convergence  time is hard to assess and often is exponential, in the case of polytope volume estimations it turns out that sampling strategies such as hit and run have mixing times that scale only polynomially with system size  <cit> . however in many concrete cases a practical problem is to give a precise condition for convergence therefore we believe that an alternative independent technique could be more than welcome even in the cases where mcs is applicable.

as a concrete step toward an efficient characterization of the set of fluxes compatible with the stoichiometric constraints, we propose a novel message-passing technique derived from the field of statistical physics and information theory.

mathematical model
as already mentioned, a metabolic network is an engine that converts metabolites into other metabolites through a series of intra-cellular intermediate steps. the fundamental equation characterizing all functional states of a reconstructed biochemical reaction network is a mass conservation law that imposes simple linear constraints between the incoming and outcoming fluxes at any chemical reaction:

  ∂ρ∂t=i+s‸⋅ν−o 

where ρ is the vector of the m metabolite concentrations in the network. i  is the input  vector of fluxes, and ν are the reaction fluxes governed by the m × n stoichiometric linear operator s‸  encoding the coefficient of the m intra-cellular relations among the n fluxes.

as long as just steady-state cellular properties are concerned one can assume that a variation in the concentration of metabolites in a cell can be ignored and considered as constant. therefore in case of fixed external conditions one can assume metabolites  stationarity and consequently the lhs of  <dig> can be set to zero. under these hypotheses the problem of finding the metabolic fluxes compatible with flux-balance is mathematically described by the linear system of equations

  s‸⋅ν=o−i≡b 

where b is the net metabolite uptake by the cell. without loss of generality we can assume that the stoichiometric matrix s‸ has full rows rank, i.e. that rank = m, since linearly dependent equations can be easily identified and removed. given that the number of metabolites m is lower than the number of fluxes n the subspace of solutions is a -dimensional manifold embedded in the n-dimensional space of fluxes. in addition, the positivity of fluxes, together with the experimentally accessible values for the maximal fluxes, limit further the space of feasible solutions. this fact may be expressed by the following inequalities:

   <dig> ≤ ν ≤ νmax 

in such a way that together,  <dig> and  <dig>  define the convex set of all the allowed time-independent phenotipic states of a given metabolic network.

sub-dimensional volumes
mathematically speaking, the space of feasible solutions consistent with the equations  <dig> is an affine space v ⊂ ℝn of dimension n - m. the set of inequalities  <dig> then defines a convex polytope Π ⊂ v that, from the metabolic point of view, may be considered as the allowed configuration space for the cell states. the main goal of this work is computation of the volume of this space of solutions and of certain subspaces of it. although conceptually simple, the notion of sub-dimensional volume like that of Π requires some new definitions.

consider any linear parameterization ϕ : ℝn-m → v ⊂ ℝn . a popular choice for ϕ is, for instance, the inverse of the so called lexicographical projection i.e., the projection over the first n-m coordinates such that its restriction to v has an inverse. being ϕ linear, the  × n jacobian matrix λ‸ is constant and coincides with the matrix of ϕ in the canonical bases. denoting λ = det  <dig>  the euclidean metric in ℝn induces a measure on v :

  ∫vfdν≡λ∫f)du 

allowing to compute the volume of our polytope

  volv≡∫v1Πdν=λ∫1φ−1du 

where 1Π  is the indicator function of the set Π. it is worth pointing out that given the linear structure of the metabolic equations, the determinant of the mapping is a  constant. although the coefficient λ could be explicitly calculated, it turns out that as far as only relative volume quantities are concerned, as in the case of the in silico flux knock-outs introduced below, this term factors out and therefore we will drop it from the rest of the computation.

probabilistic framework
the problem of describing the polytope Π can be cast into a probabilistic framework. we define the probability density p as:

  p=volv−11Π 

marginal flux probabilities over a given set of fluxes are obtained by integrating out all remaining degrees of freedom. in particular we can define single flux marginal probability densities as integrals on the affine subspace w = v ∩ {νi = ν¯}

  pi=∫wp∏j≠idνj=volwvolv 

where the normalization term volw  is the  volume of the intersection between the polytope Π and the hyperplane {νi = ν¯} as displayed schematically in figure  <dig> where the marginal probability at point νi = ν¯ is proportional to length of the blue segment which is the intersection between the polytope Π and the plane νi = ν¯

approximate volume computation
¿from a computational point of view, the problem of the exact computation of the volume of a polytope with current methods requires the enumeration of all its vertexes. the vertex enumeration problem is #p-hard  <cit> , but even the problem of computing the volume, given the set of all vertexes is a big computational challenge. various algorithms exist for calculating the exact volume of a polytope from its vertexes , and many software packages are available in the internet. computational limitations restrict however exact algorithmic strategies to cope with polytopes in relatively few dimensions . to overcome such severe limitations we will introduce a very efficient approximate computational strategy that will allow us to compute the volume and the shape of the space of solutions for real-world metabolic networks.

we will adopt the following three steps strategy:

• we discretize the problem a la riemann considering an a n-dimensional square lattice whose elementary cell is of size εn. the approximated volume is then proportional to the number of cells intersecting the polytope Π. of course the smaller ε the better is the approximation.

• we consider an integer constraint satisfaction problem where each of the mass-balance equations set a hard constraint over the involved discretized fluxes.

• we solve the constraint satisfaction problem using a message-passing algorithm called belief propagation.

discretization
consider the regular orthogonal grid Λε of side ε partitioning ℝn as in the simple sketch of figure  <dig>  this grid maps via ϕ- <dig> into a partition Γε of ϕ- <dig>  the number of cells nεε of Λε intersecting Π is proportional to the numbers of cells of Γε intersecting ϕ- <dig>  finally, the volume in eq.  <dig> is proportional to limε → 0εn-mnεε . for any given ε one we have then defined discrete variables νi ∈ { <dig> ,..., qimax⁡}, for qimax⁡ equal to the integer part of qmax⁡×νimax⁡, where the integer qmax is the granularity of the approximation.

the constraint satisfaction problem
when dealing with integer coefficients si, a, as the ones appearing in normal stoichiometric relations, the discrete version of eqs.  <dig> close in the set of positive integers defining a constraint satisfaction problem. the ε-approximation of the volume is then the number of elementary cells that are solution to the discretized mass-balance equations. it is interesting to note that in the case of fractional stoichiometric relations one can multiply all terms for the minimum common multiple of all denominators, getting an equivalent mass-balance equation with integer coefficients.

belief propagation
the integer constraint satisfaction is solved using belief propagation , a local iterative algorithm that allows for the computations of marginal probability distributions. bp is exact on trees, and perform reasonably well on locally tree-like structures  <cit> . this approximation scheme allows for the computation of the logarithm of the number of solutions via the entropy that can be expressed in terms of flux marginals. we will give a detailed derivation of the equations in section methods.

RESULTS
performance on low dimensional systems
in this section we will analyze the performance of our algorithm against an exact algorithm on low dimensional polytopes. among the different packages available in the internet, we have chosen lrs  <cit> , a program based on the reverse search algorithm presented by avis and fukuda in  <cit>  that can compute the volume of non-full dimensional polytopes. actually, it computes the volume of the lexicographically smallest representation of the polytope, that for the benchmark used below, coincides with the conventional volume estimated by our algorithm.

we have devised a specific benchmark generating random diluted stoichiometric matrices at a given ratio α = m/n and fixed number of terms different from zero k in each of the reactions. all fluxes were constrained inside the hypercube  <dig> ≤ νi ≤  <dig>  as a general strategy we have calculated several random instances of the problem and measured the volume  of the polytope using the lrs and bp algorithm. in particular, we have first generated  <dig> realizations of random stoichiometric matrices with n =  <dig>  m =  <dig>  note that n =  <dig> is around the maximum that allows simulations with lrs in reasonable time . for each polytope then we have computed the two entropies slrs and sbp with both algorithms, fixing the same maximum value for the discretization qmax =  <dig> for all fluxes.

in figure  <dig> we show how the quality of the bp measure is affected by the discretization, by displaying the histogram of the relative differences δs=sbp−slrsslrs with an increasing number of bins per variable qmax =  <dig> ,  <dig>   <dig>   <dig>  one can see how a finer binning of messages improves the quality of the approximation, seemingly converging to a single distribution of errors. it is expected that for larger n the histograms would peak around the true value: upon increasing the number of fluxes, loops become larger and the overall topology of the graph becomes more locally tree-like, validating the hypothesis behind the bethe approximation. unfortunately, the huge increase of computer time experimented in the calculation of the volumes using lrs made impossible to test systems large enough to make any reasonable scaling analysis.

finally we address the issue of the computational complexity of the algorithm which is a crucial one if one is interested in approaching real world metabolic networks whose size typically is at least  <dig> times the size of the largest network that can be analyzed with exact algorithms. in figure  <dig> we display the running time of both lrs and bp as a function of the number of fluxes n. interesting, lrs outperforms bp up to sizes n ~ <dig> where the running time of lrs explodes exponentially while bp maintains a modest almost-linear behavior.

distribution of fluxes in red blood cell
we used our bp algorithm and mcs  <cit>  to obtain the marginal flux distributions for each of the reactions in the red blood cell  metabolism taking the same stoichiometric matrix presented in  <cit>  . the network contains  <dig> reactions and  <dig> metabolites. the first comparison of mcs with our bp algorithm is done setting all νimax⁡ to  <dig> . the second comparison is done by setting all νimax⁡ to the values used in  <cit>  . in both settings we compared bp with a set of  <dig> feasible solutions generated by mcs, while for the bp algorithm we used a qmax =  <dig>  as it can be seen in the two cases, the predictions of both methods compare rather well. assuming the accuracy of mcs, differences are probably due to small loops structures in the graph. we leave for a future work the issue of a more detailed comparison of both methods. however we really think that the emerging scenario of rbc metabolism captured by bp is analogous to that obtained by mcs both quantitatively and qualitatively.

the mcs method appears to be quite efficient  while our algorithm converged to the same result in less than  <dig> seconds on a similar machine . of course, no stringent statement can be done at this level about the comparative performance of the two algorithms. this positive result encourages us to face the problem of metabolism at organism-wide scale.

analysis of gene knock-out in e. coli central metabolism
in this section we study the influence of partial flux knock-out on the volume of the solution space. we concentrate on e. coli central metabolism  <cit> . the network has  <dig> metabolites,  <dig> reactions . all reactions were considered irreversible following their nominal directions, and maximum flux rates were set to  <dig> 

in this numerical experiment we first run bp on the unperturbed system measuring the volume of the space of solution s <dig>  then the maximum flux values are kept constant and equal to  <dig> for all the reactions but one . the partial knock-out effect on flux i is then obtained reducing repeatedly νimax⁡ and computing again the volume sko at each time until νimax⁡ =  <dig>  in principle at each reduction step of νimax⁡ one should converge again the bp equations. in practice for most of the fluxes convergence is very fast since at each reduction of νimax⁡ the new stationary point will be in general close enough to the old one. however we have experimentally noted that the larger is the impact of a given flux on the volume of the space of solutions, the longer is the convergence time at each reduction step. let us point out that doing so we are tacitly assuming that each knock-out is independent from the others although it is known that some reactions might be associated with the same enzyme. however there is no computational restriction to analyze multiple knock-outs. an analogous technique was presented in  <cit> , where maximal fluxes were reduced to the value of 75% of their original maximal allowed flux to mimic enzymopathies.

in figure  <dig> we display the whole set of s <dig> - sko vs. knock-out percentage curves. we can observe how heterogeneous is the impact of the different fluxes on the volume. moreover one can observe how different curves may cross depending on the knock-out percentage displaying thus an intriguing scenario of differential flux-reduction impacts. let us now concentrate on the  <dig> fluxes having larger impact on the space of solutions: in figure  <dig> we display complete knock-outs values s <dig> -sko. focusing only on internal fluxes , one can observe that the first half of them basically compose the backbone of glycolysis showing little pathway redundancy in the network, while reactions like fum, acont, suc and succd1i appear in the krebs cycle and again show little pathway redundancy in the network .

finally in figure  <dig> we display the correlations between the changes in the entropy for different reaction knock-outs and the average flux ⟨νi⟩ = ∫pi νdν in the unperturbed network. at 75% knock-out, two kinds of regimes are divided by a clear threshold at ν ~  <dig> :  for ⟨νi⟩ <  <dig> , s <dig> - sko has a small positive correlation with ⟨ν⟩,  at larger average fluxes, correlations increase rapidly but with larger fluctuations. the presence of this threshold can be understood noting that reactions belonging to the linear  an circular  pathways are, in the wild cell, fast flux reactions, with average flux values larger than  <dig> . an analogous scenario emerges in the case of a 100% knock-outs, but now fluctuation are wider, and also fluxes with intermediate average value start becoming important. this is the case for instance of the  <dig> large impact fluxes having average flux around  <dig> . a closer inspection reveals that among them there is an exchange fluxes  and  <dig> internal fluxes . the first three  are the first steps of glycolysis, while pdh is the input of the krebs cycle, and cs is a segment of the cycle strictly related to pdh. it is interesting that this peculiar behavior  are related to key check-points of central metabolism.

e. coli metabolism at organism-wide scale
finally we analyze the average fluxes distribution function in the metabolic network of e. coli. the network used contains, in its original format,  <dig> reactions and  <dig> metabolites  <cit> . the network has been preprocessed using gaussian elimination procedure: when a trivial mass-balance equation of the type νi = νj is present we eliminate variable νi using elementary row operations. doing so new trivial mass balance equations appear, an then we iterate the eliminations until all trivial mass-balance equations disappear. during gaussian elimination, some mass balance equations become effective dead-end metabolite . fluxes participating to dead-end metabolites are set to zero at the beginning and removed from the system. the new set of equations is equivalent to the original one but with a lower number of fluxes. reversible reactions have been considered using bidirectional signed fluxes. using bp we are able to compute the marginal flux distributions in around  <dig> minutes, using qmax =  <dig> 

we ran our algorithm on this network and computed the average fluxes in each reaction. we have performed a statistical analysis of these averages in the spirit of  <cit> . the probability distribution function  of these average values is displayed in figure  <dig>  as can be clearly seen the distribution is large and may be fitted with a power law distribution of p ∠ -γ. the fit gives an exponent γ around  <dig> , a result that compares very well with previous simulations found in:   <cit>  where fba optimal fluxes were averaged over many different external condition,   <cit>  where a maximal local-output strategy is used, and   <cit>  where a gaussian approximation for the marginal flux distributions is used. it is claimed in  <cit>  that the robustness of this value γ is a signature of universality in cell's metabolism.

a more careful analysis of the data may reveals however that the distribution of averages fluxes has a richer structure. in figure  <dig> we present the cumulative distribution function p<≡∫−∞νpdy of theaverage fluxes of the reactions and a clear jump appears for ν ≈  <dig> , and smaller ones for ν ≈  <dig>  and μ ≈  <dig> . at present we do not know whether these jumps are just due to statistical fluctuations  or they reflect relevant biological or structural information about the network.

CONCLUSIONS
we proposed a novel algorithm to estimate the size and shape of the affine space of a non full-dimensional convex polytope in high dimensions. the algorithm was tested in specific benchmark, i.e. random diluted stoichiometric matrices at a given ratio α = m/n and fixed number of terms different from zero k, in each of the reactions, with results that compare very well with those of exact algorithms. moreover, we show that while the running time of exact algorithms increases more than exponentially for already moderate sizes, our algorithm is polynomial. the program was run on the red blood cell metabolism producing with shorter computational time results that are in both quantitatively and qualitatively in good agreement with those obtained by mcs presented in  <cit> .

then, our program was used to study the e. coli central metabolism, and as expected, reactions with little redundancy turned out to be the ones with larger impact in the size of the space of the metabolic solutions. specifically, most of the reactions associated with the transformation of glucose in pyruvate, belong to this set, as well as some reactions in the citric cycle. in addition we show strong correlations between the characteristics of the flux distributions of the wild type network and the changes in size of the space of solutions after reaction knock-outs. finally, we calculate the distribution of the average values of the fluxes in the metabolism of the e. coli and present results that are consistent with those of the literature. in the present approach we have mainly followed a discretization strategy that although polynomial, becomes computationally rather heavy for mass balance equation containing a large number of fluxes. we are currently investigating other representation schemes for the messages. the final hope is to obtain an algorithm that allows for on-line analysis of organism-wide metabolic networks.

let us conclude by noting that in principle the presented approach can be extended to deal with constraints whose functional form is more general than linear, provided that the number of variables involved in each of the constraints remains small, as in the case of inequalities enforcing the second law of thermodynamics for the considered reactions  <cit> . work is in progress also in this direction.

