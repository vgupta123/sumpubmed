BACKGROUND
a prime motivation for determining the genomic sequence of an organism is to obtain information about the genes it contains and the proteins they encode. accurate prediction and characterization of gene structures enable genome-wide analyses including the identification of target genes, transcriptome and proteome studies, and comparative genomics and evolutionary analyses. as dna sequencing technology advances and whole genome sequences accumulate, gene prediction has become a bottleneck, especially in newly-sequenced genomes.

gene prediction software has been developed intensively over the last fifteen years; numerous programs are already available
 <cit>  and more continue to appear. these programs commonly use three basic sources of evidence, alone or in combination. genes can be predicted “ab initio” by detecting statistical signals of gene structure in dna sequences using hidden markov models 
 <cit> , conditional random fields
 <cit> , and support vector machines
 <cit> . genes can also be predicted by sequence homology with known genes or proteins in related organisms
 <cit> , or with protein family profiles
 <cit> . experimental evidence from the target organism, such as protein, est, or transcript sequences, can help identify individual genes
 <cit> . the most successful gene predictors have integrated all available evidence, either internally
 <cit>  or by combining the predictions of other programs
 <cit> .

the massively parallel sequencing of short fragments of messenger rna, rna-seq, can yield detailed information on the structure of many of the mature transcripts in an organism
 <cit> . the short sequences from rna-seq can be combined to delineate transcripts by assembly into contigs
 <cit>  or by mapping to the genome sequence
 <cit> . the arrival of this source of experimental evidence has stimulated the development of a new generation of computational tools to apply it to gene and transcript prediction and quantification
 <cit> .

the effectiveness of different gene prediction programs in various animal genomes have been compared in a series of competitions: gasp for the fruit fly genome
 <cit> , egasp for the human genome
 <cit> , and ngasp for the nematode genome
 <cit> . the competition organizers chose genome sections with high-quality gene annotations as a test set, invited program authors to predict the genes in the test set from their dna sequences, and compared the predictions to the annotated genes. gene prediction sensitivity was estimated by the fraction of annotated genes that were predicted, and gene prediction specificity by the fraction of predictions that matched annotated genes. sensitivity and specificity were also assessed at transcript, exon, and nucleotide levels. recently the rgasp consortium has used a similar framework to test programs that reconstruct transcripts from rna-seq reads in the human, fly, and nematode genomes
 <cit> .

the genomes of hundreds of fungi have been sequenced recently or are being sequenced currently in large projects such as  <dig> fungal genomes
 <cit>  and the fungal genome initiative
 <cit> , and in smaller studies. this effort is motivated by curiosity about the genetic diversity and phylogeny of fungi, by their ecological importance, and by their economic impact as pathogens of plants and animals, including humans, and as sources of food, medicines, industrial chemicals and enzymes.

development of eukaryotic gene prediction software has mainly targeted animal genomes; the resulting tools have then been applied to fungi, plants, and other biological groups. fungal genomes show several differences from typical animal genomes: they are more compact, with shorter intergenic spaces and introns
 <cit> . gene spacing may be so tight that the untranslated regions  of adjacent genes overlap. sequences that signal transcription start and stop and translation start sites in animal genomes are not active in fungal genomes, and their equivalents in fungi are not well understood
 <cit> . despite the recent activity, a very small fraction of fungal species have been sequenced, and even fewer have well-characterized genes and gene products; this currently limits the possibility of detailed comparative gene prediction to a few well-studied genera. manual curation of gene predictions cannot keep up with the pace of fungal genome sequencing and computational gene prediction
 <cit> . many predicted fungal proteins in the sequence databases lack experimental verification. in addition, many of the newly-sequenced genomes are assembled solely from short reads, which is still challenging and increases chances for assembly errors
 <cit> . genome sequence errors that introduce reading frame shifts or that add or remove start or stop codons or intron donors or acceptors can lead to major errors in gene prediction. fragmented assemblies can cut gene sequences in two. these characteristics of fungal genomes can best be accommodated in a gene predictor that is tailored to them.

in the genozymes project
 <cit>  we are analyzing the newly-sequenced genomes of  <dig> thermophilic fungi in search of novel and useful enzymes. we needed a quick and accurate method to identify the genes in these genomes and predict the sequences of their proteins. the genome assemblies and rna-seq reads are available but other resources such as est collections or close relatives with annotated genomes usually are not. we have developed an efficient fungal gene prediction pipeline, snowyowl, that makes extensive use of rna-seq data. snowyowl generates initial models for training an hmm gene predictor by assembling rna-seq reads into predicted transcripts, and additionally uses the intron and transcribed sequence positions revealed by mapping rna-seq reads onto the genome assembly to guide and evaluate gene predictions. the snowyowl source code is publicly available and the pipeline is also available as a web service.

to demonstrate the effectiveness of snowyowl we have predicted genes in the genomes of the basidiomycete phanerochaete chrysosporium and the ascomycetes aspergillus niger and thermomyces lanuginosus, and compared them with our manually curated gene sets as well as previous annotations of these genomes. the snowyowl predictions are more sensitive and accurate in these comparisons than published gene models for a. niger <cit>  and p. chrysosporium <cit> . we also validated the performance of snowyowl on an independently annotated reference genome, in the manner of gasp, egasp, ngasp, and rgasp. this required a filamentous fungus with high-quality gene annotations. the best-studied fungal genome is that of the yeast saccharomyces cerevisiae <cit> , but it differs significantly from the genomes of filamentous fungi
 <cit> . neurospora crassa is a better standard for our purpose. it was the first filamentous fungus to have its genome sequenced
 <cit>  and its sequence has been upgraded to finished status
 <cit> . the structural and functional annotation of its genes has undergone several revisions, most recently with the aid of roche 454-sequenced transcripts and strand-specific rna-seq reads
 <cit> . the reliability of the n. crassa annotations may not be as unassailable as those used in the gasp contests, but we believe that it is sufficient for a useful benchmark.

implementation
overview
the snowyowl pipeline takes as inputs a genome sequence file, a file of rna-seq reads, a file of full-length transcript sequences assembled from the rna-seq reads, a file of intron locations, and a file of rna-seq read coverage values [see additional file
1]. the rna-seq reads do not need to be strand-specific. first a pool of candidate gene models is generated with the hmm-based gene predictors augustus and genemark-es, then the models are scored against the rna-seq intron and coverage evidence, and finally the set of non-overlapping models with the highest total score is selected . snowyowl does not attempt to predict alternative splicing isoforms, which is difficult even in well-studied genomes
 <cit> . each transcript predicted by augustus is treated as a separate gene candidate and only the best-supported model at each location is retained during selection. nor does snowyowl attempt to predict utrs; the gene prediction includes only the coding sequence .

the main product of the pipeline is a set of accepted gene models. accepted models conform to the general principles of fungal exon and intron structure, include an open reading frame  that encodes a protein of reasonable length, and are consistent with rna-seq read coverage distribution and the introns implied by spliced reads if their read coverage is adequate. in addition to the accepted models, the pipeline produces a number of imperfect models from genomic regions with no accepted model. while these models fail to meet one or more of the criteria for acceptability, they serve as reminders that some evidence exists for genes at their locations. the highest scoring of the models, accepted or imperfect, predicted at any location is selected as a representative.

candidate generation
augustus
 <cit>  was among the most sensitive gene and transcript predictors in the ngasp
 <cit>  and rgasp
 <cit>  contests, accepts a broad range of evidence sources, and has been used successfully with several fungal genomes. genemark-es has the virtue of being self-training, and has also been used successfully in fungal genomes
 <cit> .augustus requires a training set of at least several hundred gene models from the target genome. snowyowl creates this training set in a bootstrap fashion. augustus is first trained on the input transcript sequences and run to generate a set of initial gene models, termed contig models . a second set of initial models is obtained by running genemark-es. to increase its reliability, the consensus training set is formed from models that are common to the contig models and the genemark models. the consensus training set is used to retrain augustus for a second round of predictions.

in this model proliferation stage, the criteria for model acceptance by augustus are relaxed to increase the diversity of the gene models generated. by default augustus reports a single, best prediction at a location; it can, however, be configured to generate alternative transcripts from probabilistic sampling or from evidence provided by hints, with the number of alternatives controlled by thresholds for the minimum and mean posterior probabilities of exons and introns in the models. often the model selected by the snowyowl pipeline was not the alternative that augustus predicted to be most probable, so we prefer to have augustus produce a wide variety of alternatives for scoring and selection by the pipeline.

hints based on rna-seq data are used to guide the augustus predictions. one set of hints is generated from the input files of intron locations and rna-seq read coverage, leading to the splice-hinted augustus models. another hint set is derived by mapping the rna-seq reads to the genome with blat as described in the augustus documentation
 <cit> . hints provided to augustus are weighted and evaluated according to parameters from an extrinsic configuration file; the snowyowl pipeline runs augustus with seven different extrinsic configuration files for the rna-seq hints to increase the number of alternative models generated. the union of all the blat-hinted augustus and unhinted augustus prediction sets forms the pooled augustus models.

scoring of gene models
at the heart of the snowyowl pipeline is the selection of the best available gene model at each location within the genome. ‘best’ is operationally defined through a model-scoring procedure summarized in figure 
 <dig> and the following formulas. since each snowyowl gene model has a unique transcript the transcript score v
t
 serves as the gene score. scoring depends on several configurable parameters [see additional file
2]; table 
 <dig> shows the parameter values that we used to obtain the results reported here. dealing with special circumstances such as low read coverage, short predicted proteins, and partial intron retention complicates the scoring logic .

scoring begins by translating the predicted transcripts into proteins and using blastp
 <cit>  with the default blosum <dig> substitution matrix to search for homologs in a protein database. the sequences of refseq proteins from fungi were downloaded from ncbi
 <cit>  on march  <dig>   <dig>  the uniprot-swissprot database was downloaded from
 <cit>  in november  <dig>  any model without a valid coding sequence is assigned a score of  <dig> and not considered further. a homology score is calculated for each significant blastp hit b
i
 from its fraction of matching and similar amino acids as reported by blastp, up to a maximum number of hits, and divided among the transcript exons e according to their overlap with the hit.

homology score:

 hit=1maxhomologs⋅matchesbi+similaritiesbi2lenbihe=1+∑i=1maxhomologshit⋅lene∩bilene 

predicted proteins shorter than a minimum length lead to a score of  <dig> unless the transcript model contains an intron or the protein has at least one blastp hit.

each predicted intron is scored  <dig> if it uses unconventional donor-acceptor sequences or if it is longer or shorter than set limits.

intron score:

 ii=0ifdonor‒acceptor∉gt‒ag,gc‒ag,at‒ac0iflengthi<minimum0iflengthi>maximum1otherwise 

models with rna-seq read coverage too low for reliable assessment of coverage continuity or splice junction usage bypass detailed scoring and receive a final score based only on their homology and intron scores. models with adequate median coverage are rejected if the coverage is not continuous over their whole length.

each exon in well-covered model transcripts is scored for agreement with the splice junctions in the rna-seq reads. exon ends matching a splice junction receive a bonus, and ends that miss a splice junction incur a penalty. exons that cover splice junctions are also penalized.

exon score:

 vxe=he⋅rlefte⋅rmide⋅rrighte 

exon boundary scores:

 rlefte=1ifeisaninitialexonrewardjifthestartofematchestheendofsplicejunctionjpenaltyjifthestartofedoesnotmatchthenearestsplicejunctionj0ifthereisnosplicejunctionbetweenthetranscriptstartandtheendofe 

 rmide=1ifedoesnotcompletelycontainanysplicejunctionpenaltyjifecompletelycontainssplicejunctionj 

 rrighte=1ifeisaterminalexonrewardjiftheendofematchesthestartofsplicejunctionjpenaltyjiftheendofedoesnotmatchthestartofthenearestsplicejunctionj0ifthereisnosplicejunctionbetweenthestartofeandthetranscriptend 

introns are sometimes retained in spliced transcripts, and each splice junction has an empirical read-through ratio to reflect this.

read-through ratio:

 rtj=meanreaddepthinsidejunctionjmeanreaddepthinsidejunctionj+numberofsplicedreadsspanningjunctionj 

the splice junction bonuses and penalties are functions of the read-through ratio.

 rewardj=21-rtjpenaltyj=1-1-rtj 

the transcript score is the product of the scores of its introns and introns.

transcript score:

 vtt=∏i∈intronstii•∏e∈exonstvxe 

the scored models are classified by their final score into those that match the rna-seq data and those that do not .

selection of representative models
the selection routine acts on sets of scored gene models sorted by start position. models that overlap one another are grouped together. within each group, the chains of non-overlapping model transcripts with the highest score summed over the member transcripts are found by dynamic programming. transcripts with score  <dig> are included in the chains where there is no overlapping transcript of higher score. regions containing multiple overlapping models that all score  <dig> are frequent, and could inflate the number of highest-scoring chains if all the possible alternatives were retained. to avoid such inflation and to favour the longest among 0-scoring models, a small positive per-base pseudoscore is added to the score of all models before dynamic programming. the selection routine returns the gene models in the highest-scoring chain.in snowyowl selection is applied first to the pooled augustus model set, which often contains multiple predictions at the same locations. it is helpful to reduce these predictions to one or two per gene locus to avoid overwhelming the main selection with too many possible model combinations. the inputs to the main selection are the genemark, splice-hinted augustus, and preselected pooled augustus models. in a final pass through the genome, any model overlaps in the selected set are resolved by keeping only the highest-scoring model. if multiple models have the same score, one of them is chosen randomly. the output of this step is the representative model set. figure 
 <dig> illustrates the selection process for one group of overlapping gene models.
 <cit> . orange bars at the top of the read coverage track show regions of coverage depth >  <dig>  the data were visualized with gbrowse2
 <cit> .

the representative models are subdivided into accepted models and imperfect models, which have structural flaws or conflict with the rna-seq data.

RESULTS
pipeline evaluation against neuropora crassa annotated models
we ran snowyowl on the n. crassa genome and compared its  <dig>  accepted predictions to the latest release of annotated models from the broad institute, using the comparison methodology and software of the rgasp project
 <cit> . the finished genome assembly of neurospora crassa or74a , version  <dig> transcript models , and a high-confidence subset of the transcript models  were downloaded from the broad institute website
 <cit> . the rna-seq reads used by snowyowl came from a different source than those used in the selection of the annotated models and were not strand-specific. rna-seq reads were downloaded from the ncbi short read archive
 <cit>  ; these reads had been generated for a study of the regulation of polysaccharide-degrading enzymes by n. crassa <cit> . the reads were assembled into transcript sequences with trinity
 <cit>  using the cufffly option for input to snowyowl. to find splice junctions the reads were mapped to the n. crassa genome with star
 <cit> . to determine read coverage the reads were mapped again with star using the filtered splice junctions from the first run. read coverage depths for gene models were calculated by counting the reads mapping within the exons of each model and dividing by the total exon length. the gene models were sorted by coverage depth and subdivided at depths of  <dig> ,  <dig> ,  <dig> ,  <dig> ,  <dig> , and  <dig> .

gene model comparisons were limited to the coding sequences. only predictions that exactly matched an annotated model were counted as true positives . to measure prediction sensitivity, the snowyowl models were compared to the  <dig> high-confidence n. crassa models; to measure prediction specificity, the snowyowl models were compared to all  <dig> annotated models. snowyowl predicted  <dig> % of the high-confidence annotated genes exactly and  <dig> % of the snowyowl predictions matched an annotated gene exactly. at the exon level, snowyowl’s sensitivity was  <dig> % and its specificity was  <dig> %.the sensitivity and specificity of snowyowl’s predictions depended strongly on the read coverage depth . the sensitivity for genes and initial, internal, and terminal exons followed a common pattern: low below a depth of  <dig>  and high above depth  <dig> . prediction sensitivity for monoexonic genes varied less with read depth. differences in sensitivity between terminal and internal exons can be ascribed to stop codon prediction, and differences between initial and internal exons to start codon prediction. the generally lower sensitivity for initial exons at read depths above  <dig> suggests problems with placing start codons; the increased apparent sensitivity when the initial exon start is not required to match exactly  confirms this. monoexonic genes showed a similar increase in apparent sensitivity with flexible evaluation. prediction specificity depended even more strongly on read depth than did sensitivity. this indicates that snowyowl needs adequate read coverage to weed out erroneous models. the generally higher prediction specificity for internal exons than for initial, terminal, or single exons suggests that many of snowyowl’s wrong predictions had only one or two exons. the increased apparent specificity in flexible mode indicates frequent errors at the start codon. among the models with rna-seq read coverage depth of  <dig>  or more, the sensitivity of the snowyowl gene predictions was  <dig> % and the specificity was  <dig> %. if differences in start codon position were overlooked, the snowyowl predictions had apparent sensitivity of  <dig> % and apparent specificity of  <dig> % for genes with read coverage depth of  <dig>  or more.

figure 
 <dig> shows how the sensitivity and specificity of n. crassa gene and exon predictions evolve along the snowyowl pipeline. genemark and unhinted augustus predictions have good specificity but relatively low sensitivity. running the hinted augustus stage of snowyowl adds both correct and erroneous predictions, increasing sensitivity but lowering specificity in the pooled models. adding the other snowyowl candidate models further increases sensitivity and lowers specificity. after the snowyowl scoring and selection stage, the specificity of the accepted models is slightly above the level of the genemark and augustus predictions and their sensitivity is significantly higher. gene and exon predictions follow roughly parallel trajectories; the sensitivity and specificity of exon predictions are always higher than those of gene predictions. surprisingly, running augustus with rna-seq hints as recommended in the augustus documentation lowered the sensitivity as well as the specificity of gene prediction; this was apparently due to extension of predicted coding regions into the utrs. an attempt to reduce this problem by turning on utr prediction in augustus was stymied by lack of utr training data.

pipeline performance on manually curated models
during development of the snowyowl pipeline we monitored its performance by comparing its predictions to manually curated gene models from three fungal genomes. the v <dig>  genome sequence of aspergillus niger atcc  <dig> and filtered gene models 
 <cit>  were downloaded from the joint genome institute  website
 <cit> . the v <dig>  genome assembly of phanerochaete chrysosporium rp <dig> and gene models 
 <cit>  were also downloaded from the jgi website
 <cit> . the genome of thermomyces lanuginosus atcc  <dig> was sequenced and assembled at the mcgill university genome quebec innovation centre ; the assembled sequence is available from
 <cit> .

total rna was extracted from fungi cultured on agricultural straws
 <cit> , then used to prepare mrna-seq libraries. sequencing and library construction were conducted at mugqic; none of the libraries were strand-specific. the a. niger and t. lanuginosus libraries were sequenced to lengths of  <dig> bases on an illumina gaii dna sequencer, while the p. chrysosporium library was sequenced on an illumina hiseq machine in a 100-base, pair-end format. additional rna samples from a. niger were sequenced to  <dig> bases on a hiseq instrument. out of the  <dig> million reads obtained from a. niger,  <dig> million  mapped to the genome sequence, revealing  <dig>  intron splice junctions. of the  <dig>  million reads from t. lanuginosus,  <dig>  million  mapped to the genome, revealing  <dig>  splice junctions. a total of  <dig> million  of the  <dig> million p. chrysosporium reads mapped to the genome, revealing  <dig>  splice junctions. the read sequences have been deposited in the ncbi short read archive
 <cit>  .

one of the authors  identified about  <dig> putatively correct gene models in each of the a. niger, p. chrysosporium, and t. lanuginosus genomes by comparing published gene models
 <cit>  and predictions of genemark-es and augustus to the profiles of rna-seq read coverage visualized in gbrowse
 <cit> . the selected models were computationally screened for structural validity and compatibility with the rna-seq evidence. this check uncovered subtle problems such as non-canonical donor-acceptor sequences in predicted introns, small shifts in intron position or the omission of short exons in some models; such erroneous models were excluded from the curated sets. the number of curated models used for benchmarking was  <dig> for p. chrysosporium,  <dig> for a. niger, and  <dig> for t. lanuginosus. the curated gene model sets are available as additional files [see additional files
 <dig> 
 <dig>  and
5].

for evaluation, the genomic coordinates of the coding sequences of a gene model were compared to a curated model exon-by-exon. exact identity of all coordinates was required. utr sequences were ignored. more than 93% of the curated models in a. niger and t. lanuginosus and 87% of the p. chrysosporium models were correctly predicted by the snowyowl pipeline . for many of the curated models that were not predicted exactly, snowyowl predicted a gene that differed only in the position of its start codon. only 72% of the a. niger curated models and 32% of the p. chrysosporium curated models were included in published prediction sets
 <cit> .

*component included in pipeline.

selection of pipeline components
while some redundancy in predictions from different sources increases confidence in those predictions, excessive redundancy increases the computational cost of operating a gene model prediction pipeline. we sought to create the lowest-cost pipeline that would accurately predict as many of the genes in a genome as possible. to find this balance, we began with a pipeline that included three sources of initial gene predictions and three types of augustus predictions feeding into the pooled augustus models. the orthologs training set and the augustus domains models, which we do not use in the final pipeline, are described in additional file
 <dig>  to determine the contribution of each component, we left out one component of the pipeline at a time and observed the effect on prediction of the curated genes in our three test genomes. the most expensive components that were producing redundant results were iteratively dropped from the pipeline until any further reduction would have decreased sensitivity.

table 
 <dig> presents the results of running the snowy owl pipeline with various components added or omitted on our three test genomes. the leftmost column represents the standard pipeline ; columns labelled changes show differences from this standard. in comparison to a pipeline including all components, omitting any one of orthologs, contig models, or genemark models from the consensus training set had little effect on the number of accepted models or recovery of curated models in a. niger and t. lanuginosus. omitting contig models caused significant reductions in model yield in p. chrysosporium, however. because orthologs was the most computationally expensive component and was redundant in all  <dig> genomes, it was left out of the final pipeline.

omitting augustus domains or unhinted augustus models from the pooled augustus models had negligible or positive effects in all the test genomes. the multiple augustus runs required for augustus domains made it the most expensive pipeline component after orthologs, so we did not retain it. on the other hand, omitting blat-hinted augustus models had major negative effects on the numbers of accepted models and the recovery of curated models among the augustus pooled models . although leaving it out would have the positive effect of reducing the number of imperfect models, especially short models and models that contradicted rna-seq evidence, retaining this component is essential for high accepted model yield.

omitting splice-hinted augustus models or genemark models from the selection step decreased the number of accepted models and the recovery of curated models in the representative and accepted sets in at least one genome. consequently we kept these components in the pipeline.

model scoring and selection
the method of scoring and selecting models is the most original aspect of snowyowl. the configurable parameter values used in snowyowl  were tuned to give good sensitivity on the curated models from a. niger; their general applicability was then checked on our curated models of p. chrysosporium and t. lanuginosus and the annotated models of n. crassa. thus they are useful for ascomycetes and basidiomycetes, and possibly other fungi, but would probably need to be adjusted for other organisms.

figure 
 <dig> illustrates the distribution of exon scores in pooled augustus models from a. niger. exon scores are affected mainly by the homology to known proteins of the peptides they encode and by the read-through ratios of their flanking introns. imperfect models that have structural defects or are contradicted by the rna-seq evidence receive  <dig> scores. the scores of accepted models cover a broad range, reflecting the varying quality of the evidence for individual models.overlaps are common in the pooled models from the model proliferation stage, and increase the size of the sets of models that must be compared to one another. figure 
 <dig> illustrates the inputs to and outputs from model selection in part of a typical overlap group. both the splice-hinted models and the genemark models in this region contain gene predictions that fuse two genes, adding to model overlap. the pooled augustus models include various combinations of potential exons and introns, including several single-exon predictions. the selection procedure identifies the set of non-overlapping transcripts giving the highest total score, with credit for multiple independent predictions. there are three accepted models, matching manually curated models, in this region. all of the accepted models are present among the pooled augustus models; the leftmost one was also predicted by genemark, and the rightmost one by splice-hinted augustus. the representative models include a short imperfect model in the gap between the leftmost and central genes.

the sets of non-overlapping models produced by the selection procedure are usually small. in the pooled augustus models from a. niger, for example, the number of selected models per overlap group averaged  <dig> ;  <dig> % of the overlap groups yielded a single selected model. at the other extreme, one group containing  <dig> overlapping models gave  <dig> selected models. just  <dig> % of the selected sets had more than  <dig> members. nonetheless, the few large overlap groups consume most of the running time of the selection procedure.

computational load
the pipeline is computationally intensive and its execution time depends strongly on the processing power available to it. it needs at least  <dig> processors to run, and benefits from using more; the maximum number of processes that the pipeline can use is a configurable parameter. hardware support for blast searches is especially helpful; the pipeline will optionally run tera-blast software on local or remote decypher timelogic boards. on a workstation with  <dig>  ghz intel xeon e <dig> cpus and remote access to a timelogic board, the pipeline took  <dig>  h to predict the genes in the  <dig>  mb t. lanuginosus genome. without the timelogic board, the pipeline run took  <dig>  h using  <dig> processes for parallel blast searching. memory requirements are relatively modest;  <dig>  gb of ram per processor is sufficient for fungal genomes.

characteristics of accepted gene models
table 
 <dig> summarizes the general features of the accepted gene models predicted by the snowyowl pipeline for three genomes: the ascomycetes a. niger strain atcc  <dig> [see additional file
7] and t. lanuginosus [see additional file
8], and the basidiomycete p. chrysosporium strain rp <dig> [see additional file
9]. the snowyowl models can be viewed with gbrowse at
 <cit> . the average lengths of the genes, transcripts, exons, and introns are similar to those previously predicted for a. niger and p. chrysosporium. about 99% of the introns predicted by snowyowl have the gt-ag donor-acceptor consensus, with 1% showing gc-ag splice junctions, and  <dig> % exhibiting the rare at-ac junctions.

a. niger
p. chrysosporium
t. lanuginosus
†updated january  <dig> 

characteristics of imperfect models
the largest class of imperfect models contains those predicting short proteins: fewer than  <dig> amino acids for monoexonic models with no homology support or fewer than  <dig> amino acids for models that contained introns or showed homology to known proteins . many of these short models are located adjacent to longer gene models and could result from short, nonfunctional orfs inside the utrs of the longer genes. models with intron errors form the second most abundant class; they are located in genomic regions with significant rna-seq read coverage where augustus and genemark failed to construct a model with introns that match the rna-seq spliced reads. models that are inconsistent with rna-seq read coverage are also frequent; most often these models extend past the region of read coverage at one end, although some have internal coverage gaps. representative models that have bad intron structure or cannot be translated into protein are relatively rare. excessive length is the most frequent problem with intron structure. the unusually high number of representative models in p. chrysosporium that cannot be translated to protein are all incomplete gene predictions from genemark. the majority of untranslatable representative models in t. lanuginosus contain blocks of n introduced during scaffolding of the genome.

a. niger
p. chrysosporium
t. lanuginosus
comparisons of snowyowl models to previous gene predictions
previously published gene predictions are available for a. niger and p. chrysosporium <cit> . aspergillus niger genes were predicted with fgenesh, fgenesh +
 <cit> , and genewise
 <cit>  and representative models were selected on the basis of homology and est support
 <cit> ; the updated gene model set v <dig>  to which we compare snowyowl predictions was released in january  <dig>  the genes of p. chrysosporium were predicted with genewise
 <cit>  and grailexp
 <cit> . the overlap between snowyowl predictions and previous predictions is substantial in both genomes , indicating that snowyowl and the published models detect many of the same genes.

in a. niger, about 58% of the previously published predictions are identical to a snowyowl accepted gene model. another 10% of the previous predictions are the same as a snowyowl prediction over much of their length but use a different start codon. most of the remaining 32% of the models show some degree of overlap with members of the other set . a quarter of the snowyowl models overlap predictions in the other set by less than 100% but more than 50%; almost 22% overlap by 95% or more. the published models are longer on average than the snowyowl models, and some published models overlap two snowyowl models. consequently the fraction of published models showing substantial overlap is lower: 14% overlap snowyowl models over more than 95% of their length and 20% over more than half their length. some gene predictions are unique to one set or the other:  <dig> snowyowl predictions and  <dig> previously published predictions have less than 5% overlap in the other set. many  of the published gene models that differ from a snowyowl prediction are incompatible with the rna-seq evidence . some of the published models contain structural errors; such defects are especially frequent in the models that overlap a snowyowl prediction by less than 5%.

a. niger
p. chrysosporium
*invalid coding sequences, short predicted proteins, introns with nonstandard donor-acceptor pairs.

†predicted introns not matching read splice sites, models with discontinuous read coverage.

in p. chrysosporium, snowyowl predicted  <dig>  genes, 36% more than the  <dig>  predictions reported previously. a smaller fraction  of the genes predicted in p. chrysosporium were identical in the snowyowl and previous prediction sets than in a. niger, but more of the non-identical models overlapped substantially. the model differences often involved the presence, absence, or position of small exons or introns, which are difficult to predict without rna-seq evidence; figure 
 <dig> illustrates typical cases. the published gene models for p. chrysosporium, which date from the early days of fungal gene prediction, had a relatively high frequency of structural defects . there were  <dig> times as many snowyowl as previous predictions that overlapped less than 5% with models in the other set. some  of these unique snowyowl predictions had homologs in the fungal refseq protein database supporting their validity.

despite the generally higher quality of the snowyowl gene models, some of the previously published gene predictions were better than the corresponding snowyowl prediction or were missing from the snowyowl set. applying the snowyowl scoring and selection procedure to the combined previous and snowyowl predictions gave totals of  <dig>  accepted models in a. niger  and  <dig>  accepted models in p. chrysosporium .

additional genomes analyzed with snowyowl
in addition to t. lanuginosa, we have successfully applied the snowyowl pipeline to  <dig> other novel fungal genomes. the resulting gene models are being publicly released in stages at
 <cit> .

discussion
the detailed information about transcribed gene sequences provided by rna-seq data allows a major advance in the accuracy of gene prediction. the snowyowl pipeline uses this information at several stages, from generating initial models through guiding gene prediction to scoring candidate models. the intron locations identified by spliced mapping of rna-seq reads are especially helpful in weeding out erroneous intron predictions by ab initio gene-predictors such as genemark and unhinted augustus, errors that were frequent in the previous generation of fungal gene models
 <cit> . read coverage profiles reveal some gene models that are too long, including ones that concatenate genes. with the increased power to eliminate incorrect gene models provided by rna-seq, we can widen the range of candidate models generated by the ab initio predictors in order to increase prediction sensitivity. in addition to the gains in selectivity from rna-seq data, snowyowl increases the quality of its predictions by rigorously screening for correct intron and coding sequence structure.

we evaluated the performance of the snowyowl pipeline by comparing its predictions for the neurospora crassa genome to independent, high-quality annotations. over the whole genome, the sensitivity of the snowyowl gene predictions was  <dig> % and their specificity was  <dig> %. both sensitivity and specificity depended on the level of rna-seq read coverage; among the genes with a read coverage depth of at least  <dig>  reads per base, snowyowl’s prediction sensitivity was  <dig> % and its specificity was  <dig> %. the specificity of snowyowl is similar to those of genemark-es and augustus but its sensitivity is 11% higher on the n. crassa genes. we don’t have direct comparisons of snowyowl to other gene predictors, and no gasp-style competition has been held with a fungal genome. in the nematode caenorhabditis elegans, the tested eukaryotic genome closest in size to a fungal genome, augustus was among the most sensitive gene predictors in both the ngasp competition
 <cit>   and the rgasp competition
 <cit>  . it appears that, within its domain of fungal genomes, snowyowl is at least as good as the best current gene prediction programs.

we also measured the ability of snowyowl to predict  <dig> manually curated gene models from three other fungal genomes. this is not an independent test set, since the curator selecting those models relied on the same evidence as snowyowl uses. nor is it unbiased, since most of the selected genes come from the subset with high read coverage where snowyowl is most effective. nevertheless it was useful for checking how well snowyowl can use the rna-seq data to match the selections of a human expert in diverse genomes, for tuning the model-scoring routine, and for detecting losses of prediction sensitivity while streamlining the pipeline. the curated model sets also illustrate our progress from the previous generation of fungal gene models. snowyowl can predict 94% of the curated models from a. niger and t. lanuginosus, and 87% of those from p. chrysosporium. the numbers of these curated models in published gene sets for a. niger and p. chrysosporium are significantly less.

the pipeline’s design was streamlined by measuring the contribution of different components to the prediction of curated gene models in three test genomes. the key to obtaining adequate sensitivity proved to be generating a diverse array of candidate models by repeated augustus runs with different inputs. selectivity was gained by scoring the candidate models and choosing the best. two computationally costly procedures that we expected to be rich sources of gene models, blastx search of the uniprot database with all orf sequences in the genome using timelogic® genedetective™  and augustus runs guided by protein family profiles
 <cit> , were found to be redundant and eliminated from the pipeline during its streamlining.

examining the false negatives and false positives in the snowyowl predictions relative to the curated models and the annotated n. crassa models reveals three areas in need of improvement: selecting start codons, predicting genes with low or no rna-seq coverage, and filtering short gene models. these all have high priority for future versions of snowyowl.

for 29% of the high-confidence annotated n. crassa models not exactly matched by a snowyowl prediction, there is a snowyowl prediction that differs only at its start; this fraction jumps to 48% in the models with adequate rna-seq coverage. the fractions of almost-matching predictions with misplaced start codons are even higher in the manually curated genes that were not predicted exactly by snowyowl: 68% in a. niger, 81% in t. lanuginosus, and 78% in p. chrysosporium. the affected genes have multiple atg codons in frame with their orf. the sequence contexts that favour recognition of start codons have been studied in mammalian and yeast genomes
 <cit>  and in one filamentous fungus
 <cit> . developing a context scoring method for potential start codons and using other markers such as signal peptides
 <cit>  could improve snowyowl’s prediction of cds starts.

the sensitivity and specificity of snowyowl predictions for n. crassa genes with rna-seq read coverage depth below  <dig>  were 45% and  <dig> %, respectively, because insufficient rna-seq information was available to guide generation and selection of models for these genes. snowyowl was developed with an emphasis on well-expressed genes, and the best way to enhance its performance in a particular genome is to collect rna-seq data from a wide variety of growth conditions in order to increase the number of genes that are expressed. there will always be some genes whose transcripts remain unobserved, however, and better ways to handle these genes should be incorporated into snowyowl. the posterior probabilities estimated by augustus might be useful guides for such genes.

many of the false positive models from snowyowl predict short proteins . the apparent specificity of snowy owl could be increased simply by raising the minimum length for predicted proteins, at the cost of missing more true genes. snowyowl currently uses homology to a database protein or presence of an intron as heuristics to rescue gene models with predicted proteins shorter than the minimum length. we need better ways to recognize genes encoding abnormally short proteins. some of the false positive predictions are located just upstream of a true gene; they may arise from upstream orfs , which are common in fungi
 <cit>  and other eukaryotes
 <cit> .

the accuracy of snowyowl predictions may also be improved by better rna-seq technology and by taking technical limitations into account. at present snowyowl does not make use of strand-specific rna-seq because few strand-specific reads have been available. strand-specific reads would allow transcription on the strand opposite to a gene model, which can inflate apparent model coverage and intron read-through, to be ignored and help separate overlapping transcripts on different strands
 <cit> . strand-specific rna-seq methods are becoming more standardized and commonly used
 <cit> , and it will be worthwhile to adapt snowyowl to take advantage of strand specificity. snowyowl assumes that all parts of a transcript are sampled equally, but the illumina rna-seq library preparation method under-represents certain sequences
 <cit> . checking that any apparent gaps in read coverage are not artifacts of library bias before penalizing models for incomplete coverage would increase the accuracy of model scoring.

we developed snowyowl for use in fungal genomes and have only tested it with fungal genomes. it is highly configurable, however, and might be adapted for other types of genomes in need of a gene predictor.

CONCLUSIONS
the snowyowl pipeline was developed to fill our need for rapid and accurate prediction of the genes in newly-sequenced fungal genomes using rna-seq data. numerous programs are available to map rna-seq reads onto a genome sequence and to assemble the reads into potential transcripts. snowyowl takes the outputs of these programs as its inputs and packages the steps of training and running gene-predictors and selecting the best of their predictions.

snowyowl performs very well for genes that are represented in the available rna-seq reads; it predicted 88% of the neurospora crassa genes that have adequate rna-seq coverage with 82% specificity. we have used it successfully in  <dig> novel fungal genomes.

snowyowl should be useful for the numerous fungal genomes currently being sequenced; it is freely available from sourceforge for local installation and can also be accessed as a web service. the pipeline has been streamlined for computational efficiency and takes less than 24 hours to predict the genes in a typically-sized fungal genome. the gene model scoring parameters can be easily customized.

snowyowl can also be used to update older annotation that did not benefit from rna-seq information. it substantially improved upon previous gene predictions for aspergillus niger and phanerochaete chrysosporium. as well, snowyowl can incorporate the best of previous annotation into its predictions.

we intend to continue development of snowyowl as an open-source project to further improve its performance and to incorporate advances in rna-seq technology.

availability and requirements
in addition to the installable version of snowyowl, we have developed a web interface to the pipeline [see additional file
10]. registered collaborators at the university of calgary’s visual genomics centre can run the snowyowl pipeline remotely through this web interface; contact c. sensen. source code for the entire software package, including the web interface, is available on sourceforge.

project name: snowyowl

project home page:http://sourceforge.net/projects/snowyowl/

operating system: unix

programming language: python, php

other requirements: perl, biopython, augustus, genemark-es, ncbi blast+, exonerate, blat, samtools, tabix, cd-hit

license: freebsd

any restrictions to use by non-academics: none

competing interests
the authors declare that they have no competing interests.

authors’ contributions
no, pg, md, and ma developed the model generation section of the pipeline, ir developed the model selection section, and oz developed the web interface. js, rn, oz, and ir integrated and tested the pipeline. at selected the curated models. ir drafted the manuscript. gb, cs, and at conceived of the project, guided its progress, and edited the manuscript. all authors have read and approved the final manuscript.

supplementary material
additional file 1
readme. installation and usage information included with the snowyowl download package.

click here for file

 additional file 2
config.template. default snowyowl configuration file with explanatory comments.

click here for file

 additional file 3
aspni curated models. manually curated gene models from aspergillus niger.

click here for file

 additional file 4
thela curated models. manually curated gene models from thermomyces lanuginosus.

click here for file

 additional file 5
phach curated models. manually curated gene models from phanerochaete chrysosporium.

click here for file

 additional file 6
discarded pipeline components. descriptions of software modules used during development of the snowyowl pipeline but not included in the final version.

click here for file

 additional file 7
aspni accepted models. snowyowl accepted models from aspergillus niger.

click here for file

 additional file 8
thela accepted models. snowyowl accepted models from thermomyces lanuginosus.

click here for file

 additional file 9
phach accepted models. snowyowl accepted models from phanerochaete chrysosporium.

click here for file

 additional file 10
webapp readme. installation and usage information included with the snowyowl web interface download package.

click here for file

 acknowledgements
the authors would like to thank nadeeza ishmael for preparing rna samples and the mcgill university genome quebec innovation centre for sequencing them. we also thank wendy findlay and emmet o’brien for help with gbrowse visualization and alexandre beaudoin for help with software testing.

this work was supported by genome canada, genome quebec, and genome alberta.
