BACKGROUND
the genotypes of biological systems form high dimensional spaces. a prominent example is that of proteins, where genotypes are strings of amino acids  <cit> . for a protein string of length n and  <dig> proteinaceous amino acids, the genotype space consists of 20n possible genotypes, an astronomically large number even for proteins of moderate length. the genotype spaces of rna molecules and regulatory networks are similarly large  <cit> . if one imposes functional constraints on genotypes, the set of genotypes fulfilling these constraints is typically tiny compared to the entire space. in this work, we focus on a space of metabolic genotypes and on the question of how functional constraints structure this space.

genotypes form phenotypes, observable traits of biological systems. examples include the three-dimensional structure of proteins  <cit> , secondary structure of rna  <cit>  and the gene activity patterns of regulatory circuits  <cit> . for some classes of biological systems, a mix of computational approaches and comparative data analysis has allowed systematic characterization of how individual genotypes map onto phenotypes  <cit> . the genotype-to-phenotype maps arising in such works have several typical properties. first, any one phenotype is adopted by a vast number of genotypes. second, these genotypes form large connected sets in genotype space. specifically, it is possible to reach any genotype in such a connected set from any other genotype by a series of small genotypic changes, such as changes in individual amino acid sequences. importantly, these changes leave the phenotype unchanged. such a set of connected genotypes with the same phenotype is also referred to as a neutral network  <cit>  or genotype network  <cit> .  importantly, the term neutrality is not used here in the sense of fitness-neutrality as in the field of molecular evolution, but it just refers to invariance of a specific  phenotype. third, any one genotype network typically extends far through genotype space. fourth, individual genotypes on any one genotype network typically have multiple neighbors with the same phenotype. put differently, phenotypes are to some extent robust to small changes in genotypes . finally, different neighborhoods of the same genotype network contain very different novel phenotypes.

genome-scale metabolic networks are a class of biological systems that have received increasing attention in recent years  <cit> . they can be thought of as large assemblages of enzyme-catalyzed chemical reactions whose function is to produce all the small-molecule chemical compounds an organism needs to survive and reproduce in its environment. the major compounds include multiple amino acids, nucleotides, lipids, carbohydrates, and enzyme cofactors. their relative proportions in an organism's biomass constitute the organism's biomass composition. the greater the rate at which an organism produces these compounds , the faster the organism can grow and multiply. the metabolic network of any one organism can be thought of as existing in a vast genotype space of possible metabolic networks. any one organism's genome encodes enzymes that catalyze some of these reactions. a simple representation of a metabolic network genotype g uses a binary string of length n, e.g., g = , where n is the number of all enzyme-catalyzed chemical reactions that occur in the biosphere; this is illustrated in figure 1a. each position in the string representation of g corresponds to one enzymatic reaction, and the necessary enzyme can be either present  or absent . in this framework, a metabolic genotype g is a point in an n dimensional hypercube  comprising 2n metabolic genotypes.

for any one metabolic genotype, the computational approach of flux balance analysis   <cit>  can help determine whether the corresponding metabolic network can synthesize all major biomass components in a given chemical environment or medium. flux balance analysis primarily uses information about the stoichiometry of enzymatic reactions in cellular metabolism to obtain a prediction for the steady-state fluxes of all reactions and the maximum possible biomass synthesis rate of a metabolic network. the key underlying assumptions used in fba are:  cellular metabolism operates at a steady state for a given environmental condition, wherein the concentrations of all internal metabolites and rates of all reactions are constant;  the organism can adjust its metabolic fluxes -- rates at which individual reactions convert substrates into products -- to maximize its biomass growth flux. flux balance analysis neglects regulatory properties of metabolic systems, and is thus concerned with the more fundamental constraints of biomass synthesis caused by the presence and absence of enzymes. in practice, regulatory constraints can often be overcome quickly in laboratory evolution experiments  <cit>  and are thus temporary rather than fundamental obstacles to cell growth. the predictions of fba and related approaches are often in good agreement with experimental results  <cit> .

we here refer to the ability of a metabolic network genotype to synthesize a given biomass in a given environment as its metabolic phenotype. except where noted otherwise, we will use the published biomass composition  of the bacterium e. coli  <cit> , but our approach is not restricted to this organism. we call a genotype viable in a given chemical environment if, according to fba, it can synthesize biomass at some strictly positive rate in this environment.

compared to other systems discussed above, little is known about the organization of metabolic phenotypes in metabolic genotype space  <cit> . in an earlier contribution  <cit>  we demonstrated the existence of extended genotype networks for metabolic phenotypes that involved a large number of environments with many variable carbon sources. we also demonstrated that such genotype networks may facilitate evolutionary innovation in metabolism, that is, viability on novel carbon sources. a limitation of that earlier work is that we considered only metabolic networks within a narrow size range. thus, we did not analyze the dependency of genotype space organization on network size systematically; nor did we estimate fractions of viable genotypes, and their dependency on network size. here, we introduce an improved computational strategy to systematically address these issues. our strategy, schematically illustrated in figure 1b and explained below, is based on markov chain monte carlo sampling of the subspace of viable genotypes  <cit> . it allows us to study in detail the dependency of genotype network properties on the number n of reactions catalyzed by a genotype. in particular, it reveals how the constraint of viability becomes more and more severe as n decreases. the properties we examine include the typical and maximal distance of metabolic networks in a genotype network, their robustness to the removal of chemical reactions, and the dependency of these and other features on different chemical environments. with our approach and a suitable database of reactions, one can explore the space of genotypes having any desired phenotype.

RESULTS
viable genotypes get rarefied as the number of reactions n decreases
we here explore the vast space Ω of metabolic genotypes with a given number n of reactions. these reactions are taken from a "reaction universe" or "global reaction set" that comprises n =  <dig> reactions. briefly, we obtained this reaction set by considering those reactions from the currently largest metabolic database kegg  <cit> , that fulfilled a number of criteria, such as being elementally balanced, and allowing nonzero biomass flux under steady-state conditions for at least one of our chemical environments . we are keenly aware that this set of reactions may comprise only a small fraction of the set of all chemical reactions in the biosphere. however, the metabolic genotype space Ω it defines is vast and comprises many more reactions than a typical microbial metabolic network  <cit> . our reaction set helps us to develop methods to explore this vast space, and to provide some intuition about its global properties.

we refer to a metabolic network genotype as any subset of reactions taken from this global set of n reactions. such a genotype g can be represented as a binary string of length n, i.e., g = , with each reaction i being either present  or absent . note that even for modest n, Ω is a huge space containing n!/ genotypes. a random genotype in Ω corresponds to a random bitstring subject to the constraint that there are exactly n bits set to  <dig> 

for any one genotype, we use flux balance analysis   <cit>  to determine the maximum biomass flux obtainable for this genotype in a given chemical environment. note that if a genotype produces a maximum biomass flux f under fba, then adding further reactions can only increase f; as a consequence, in our framework, many properties will be monotonic in the number of reactions n. we here consider several minimal environments that differ in the sole carbon source they contain . we call a genotype viable if its maximal biomass growth flux is strictly positive. we refer to the set or space of viable genotypes within Ω as v.

perhaps the most basic question about v is how its size depends on n. a priori, it seems likely that metabolic networks with fewer reactions are less likely to be viable than networks of more reactions. thus, one would surmise that v would decrease in size relative to the entire space Ω as n decreases. to estimate this dependency, we need to estimate the probability pn = |v|/|Ω| that a random genotype in Ω is also in v. this turns out to be difficult because pn can be very small. the problem can be circumvented through a decomposition approach. this approach takes advantage of the fact that pn can be written as a product of two factors, as we briefly explain now and detail further in methods.

we call a reaction "essential" for a given viable genotype in a given chemical environment if its elimination  renders the genotype non-viable in that environment. we call a reaction "super-essential" in this environment if it is essential for the genotype that contains all reactions in the reaction universe. we note that a super-essential reaction will necessarily be essential for every viable genotype in this environment. the two factors in the calculation of pn are the probability that a genotype of a given number of reactions n contains all super-essential reactions, and the probability that a genotype is viable given that it contains all super-essential reactions. the first factor can be determined analytically, as shown in methods; we refer to it as an analytical prefactor. the second factor needs to be determined numerically. we estimated it through a sampling approach.

when applying this decomposition method to estimate the size of v, we made the following observations . when n is close to its maximum value, the viability constraint is very mild. most genotypes are viable and pn is close to  <dig>  as n decreases, the probability of being viable decreases rapidly, and when n gets too small, pn becomes too small to measure. in figure  <dig> we show this behavior on a logarithmic scale, for three different minimal environments . figure s <dig> shows the same data on a linear scale . from these figures, it appears as if pn were independent of the sole carbon source . however, there are differences among carbon sources, as we will discuss below; it is just that these differences are too small to be seen on the scale of figure  <dig>  for the range of n that we were able to analyze.

note that for genotypes that contain n =  <dig> reactions, that is, more than two thirds of the global reactions set, viable genotypes represent only a fraction of order 10- <dig> of all genotypes. in other words, the viability constraint is very severe even at this large number of reactions and it gets much more severe for smaller n. for completeness, figure  <dig> also shows the analytical prefactor that is involved in our estimates of pn; note that it captures most of the trend of the data. this means that the constraint of including super-essential reactions is far more stringent than the constraint of being viable given that one includes such reactions. in other words, most of the likelihood of being viable comes from the likelihood of containing all super-essential reactions. furthermore, this likelihood scales approximately exponentially in n: each removal of a reaction decreases the probability of containing all super-essential reactions by approximately a constant factor. finally, the fact that the fraction pn of viable genotypes is a convex curve  indicates that the effect of successive reaction removals on viability becomes more and more severe.

mcmc sampling of viable genotypes
we next wanted to study the properties of random genotypes in v, i.e., metabolic networks sampled uniformly from the genotype space Ω, and subject only to the constraint that they are viable. for instance, one can ask what is the typical mutational robustness of such genotypes, or how frequently do they contain specific reactions of the global reaction set. the answers to such questions can provide valuable null-hypotheses and points of contrast with organismal metabolic networks like that of e. coli.

uniform sampling of viable genotypes is difficult, given that v can be so much smaller than Ω. nevertheless, this task can be tackled as follows. for n greater than  <dig>  one can easily generate random genotypes and include them in a statistical analysis if and only if they are viable. for smaller values of n, that kind of sampling becomes very inefficient and it is better to use the markov chain monte carlo  method, a widely used approach for sampling large and high dimensional spaces  <cit> . the mcmc method produces a sequence of genotypes forming a chain, the term "chain" coming from the property that the th element of the sequence is generated from the kth one using a probabilistic transition rule. at each transition, one proposes a small modification to the current genotype; if this modified genotype is viable, one accepts it as the next genotype of the sequence, otherwise the next genotype is identical to the current genotype. in our work, the modification introduced at each transition step is a reaction swap. that is, each modification adds one reaction and removes another reaction, so as to keep n constant. the mcmc thereby produces a walk in the subspace of viable genotypes of n reactions as illustrated in figure 1b; an overview of the different steps of the algorithm is displayed in the flow chart of figure s <dig>  and technical details are given in the methods. of particular relevance is that, in the limit of long walks, this approach can be shown to sample uniformly the space of viable genotypes that are accessible when starting with the first genotype of the mcmc. whether or not this accessible space is the whole space v is difficult to determine. we thus take a practical approach, and simply focus on properties of genotypes in the accessible space.

to start the markov chain, a first viable genotype is necessary. we generated such a genotype as follows. for the e. coli metabolic network genotype, we determined those reactions that have nonzero flux in a steady-state flux distribution that yields a nonzero biomass growth flux in a given chemical environment. for the environments we studied here, this number of reactions with nonzero fluxes is smaller than  <dig>  we then start with this set of reactions and add randomly other reactions until we have reached a metabolic network with exactly n reactions. the corresponding genotype is viable in the given environment, it has the right number of reactions, and we can thus use it as the first element of the mcmc sequence.

with this algorithm, we can sample the accessible space uniformly; any observable such as the mean mutational robustness can be estimated from a sample; and the estimate's uncertainty  can be computed as explained in methods. we find that the procedure is relatively efficient, as judged by either the chain's autocorrelation time τ or by the acceptance rate of each genotype modification . from figure s <dig>  one can see that τ ≈  <dig>  so the mcmc generates uncorrelated genotypes every few thousand swaps .

mutational robustness increases as n increases and has a narrow distribution
given a chemical environment and a viable metabolic network genotype g, we define the mutational robustness rμ of g as the fraction of its reactions that are not essential in that chemical environment. thus, rμ is simply the probability that a metabolic network remains in the viable space under one random reaction deletion. qualitatively, one expects that for large n, most genotypes in v will have a high mutational robustness. nevertheless, there are close to  <dig> super-essential reactions for each of the chemical environments we study. removal of any of these reactions will yield a non-viable genotype. this means that even when n is at its maximum value, rμ must be below  <dig>  furthermore, one expects rμ to decrease with n, perhaps quite steeply. to study this dependency on the number of reactions in a quantitative way, we used the mcmc approach for multiple values of n to generate samples of  <dig> random viable genotypes and determined their values of rμ. figure  <dig> shows the mean mutational robustness of genotypes in v as a function of n for three different minimal environments using the e. coli biomass composition. we see that rμ begins to decrease steeply near n =  <dig>  by the time n =  <dig> is reached, the mean mutational robustness has reached a value close to  <dig> . this is a low but not tiny value of robustness. 

we also studied the distribution of rμ for random viable genotypes at multiple values of n. for a first series of estimates, we used the e. coli biomass composition  <cit> . an illustrative case is shown in figure 4a for the glucose environment when n =  <dig>  the value of the number of reactions from our database that are contained in the e. coli metabolic network. the cases for acetate and succinate environments are shown in figures 4b and 4c. the horizontal axes of these figures show that the width of the distribution spans only  <dig> percent of the possible range between zero and one. in other words, rμ varies very little among random viable genotypes. it is instructive to compare this low variance in robustness to that predicted by a simple probabilistic argument, where each reaction contributes independently to mutational robustness. suppose that each reaction in each genotype in v has the same probability r of being non-essential. this probability r would then be given by the mean of rμ, which is around  <dig>  for the genotypes of figure 4a. if all reactions contribute independently to mutational robustness, then the robustness of any one genotype is the average of n binary numbers that adopt a value of  <dig> with probability r. for the large values of n we consider, this quantity effectively follows a normal distribution with mean r and variance r/n. however, to make this argument more powerful, it is best to note that super-essential reactions do not contribute to the variance of rμ. thus, we only need to consider the non-essential reactions. if s is the number of super-essential reactions, the expected variance of mutational robustness then becomes p/n <dig> where p = nr/. figures 4a-c show the distribution of mutational robustness predicted by this argument as dashed lines. for example, in the case of the genotypes of figure 4a, this framework yields a value of the variance of  <dig>  × 10- <dig>  which is close to the variance of  <dig>  × 10- <dig> we estimate through sampling. in sum, these observations suggest that the distribution of rμ is narrow simply because the number of terms that contribute to rμ is large. figure s <dig> corroborates this argument, displaying the distribution of rμ at n =  <dig> along with the normal distribution predicted by the probabilistic argument . again, this argument predicts the actual distribution well.

we next turn to the mutational robustness of e. coli itself and ask whether it is unusually high or low. specifically, we introduce the null hypothesis h <dig> that e. coli's robustness is indistinguishable from that of a random genotype in v. the mutational robustness rμ of e. coli has values of  <dig> ,  <dig>  and  <dig>  in glucose, acetate, and succinate. for all three environments, these values are in the upper tail of the distribution of rμ for randomly sampled viable genotypes in v. based on the location of e. coli's robustness in these distributions, we can reject h <dig> at p-values of  <dig> ,  <dig> , and  <dig>  for the glucose, acetate, and succinate environments, respectively. e. coli thus appears to be atypically robust. we contrast this observation with that of figure 2a in ref  <cit>  where an analogous mcmc study led to a different distribution for rμ under h <dig>  and to the conclusion that e. coli was not an outlier. the source of the different conclusions between these two studies is this: in our mcmc approach, the number n of reactions is exactly fixed, whereas it was allowed to vary modestly over a range of values in ref  <cit> . that range contained mainly values larger than  <dig>  and thus generated a sample of random viable genotypes with higher robustness. clearly, it is better to use the present mcmc method where n can be set to its value in e. coli.

one might argue that it is inappropriate to call a reaction non-essential if only a tiny biomass growth flux is realizable when the reaction is absent. put differently, our results might change if we required that removal of a reaction did not reduce biomass growth flux below some threshold. to assess whether this is the case, we used the mcmc method described above to sample only those genotypes in v that have a large biomass flux. specifically, we sampled the space of viable genotypes for which the biomass flux is at least as large as the in silico e. coli biomass flux. the resulting distribution of rμ, along with the e. coli mutational robustness is displayed in figure 4d. the figure shows that the distribution of mutational robustness is essentially the same whether one imposes this more stringent requirement on flux, or the much looser constraint of any strictly positive biomass flux. e. coli thus remains an outlier with significantly high robustness also in the more stringent comparison.

these results were all obtained using the published proportions at which e. coli biomass constituents  <cit>  occur in the e. coli cell. we next asked whether the features we found  are sensitive to this choice. to find out, we repeated the above analysis, but changed the proportion of each biomass constituent randomly by up to 20%. all the above conclusions hold for this new formula as well; this is illustrated in figures s <dig> a-d .

mean and maximum distances between genotypes in v
we showed above that viable genotypes form a tiny fraction of the space of all possible genotypes, even for numbers of reactions that are modestly large. for instance, at n =  <dig>  the viable genotypes form a fraction of about 10- <dig> of all genotypes. this fraction would decrease further as we approach reaction numbers close to that of e. coli. is this viable space v concentrated in a small region of the total space Ω? in other words, are most viable genotypes very similar to one another? to address this question, we used the hamming distance dh of the bit strings associated with two metabolic genotypes as a measure of genotype distance. in Ω, this hamming distance can range from a value of zero to  <dig> min.

we first estimated the distribution of dh between genotypes in v from our samples of  <dig> random viable genotypes. the average of this distribution is shown in figure 5a for different values of n, and for the glucose, acetate and succinate environments. to have a comparison benchmark, we also show the mean of dh for bit strings  chosen at random from Ω. this quantity is easily calculated analytically, and obviously does not depend on the environment. its value is  <dig> n /n. figure 5a shows that when n is close to n, this mean value of dh is close to the maximum distance in Ω.

after having estimated the typical distance of random viable genotypes, we turned to the maximum possible distances of such genotypes. this distance can be thought of as the "span" or diameter of v. to estimate this quantity, we generated two parallel random walks in v and at each step tried to maximize the hamming distance between them. specifically, we followed simultaneously two genotypes in a modified mcmc approach, where the criterion for accepting a genotype modification involved not only viability, but also the requirement that the hamming distance to the other genotype be non-decreasing. during a typical execution of such a random walk, the distance between the two genotypes rises and then saturates. we carried out random walks of up to  <dig> steps, and terminated any such walk if the distance between the two genotypes had not increased in the last third of the walk. we repeated this procedure  <dig> times for each value of n and each environment, and kept the largest distance identified in these  <dig> replicates as a final estimate. we note that this procedure provides a lower bound of the actual maximum distance between genotypes in v. the results are shown in figure 5b for the three environments, along with the maximum distance in Ω namely  <dig> min. qualitatively, we obtained a pattern similar to that of the average distance . for example, the viability constraint is invisible for large n, but it strongly affects the maximum genotype distance for n < n/2; not surprisingly, this viability constraint becomes more marked as n decreases to lower values. however, the magnitude of this effect is smaller than for the average distance discussed above. for example, at n =  <dig>  the maximum distance is 29% higher in Ω than in v, while for the mean distance the corresponding percentage is 42%.

clustering analysis of genotypes in v
the space Ω is a subset of a 2902-dimensional hypercube whose members have exactly n bits set to one. thus, it is a hyperplane section of the hypercube. the distribution of distances in this space is unstructured and homogeneous. this may not be the case for the viable subspace v. for example, some of the genotypes in v may present different "types" of solutions to the problem of producing a viable genotype. these different types of solutions could manifest themselves in different clusters of genotypes within v. to determine whether this is the case, we have performed a principal component analysis, using the bitstring representations of  <dig> random viable genotypes. the results for the first two principal components are given in figure  <dig> for the glucose chemical environment, and for a number n =  <dig> of reactions as in the e. coli reaction set. the first two principal components explain less than  <dig> percent of the variance in the genotype differences. similar observations hold for succinate and acetate environments . for completeness, the figure also shows the localization of the e. coli genotype. in this analysis, its location is not atypical, in contrast to our observations for mutational robustness. we supplemented this analysis by a hierarchical clustering analysis of the same  <dig> genotypes, which also did not reveal any grouping of genotypes . in sum, these analyses suggest that viable genotypes of this size form a "cloud" in genotype space with little internal structure or heterogeneity.

use of reactions by genotypes in v
previous work  <cit>  showed that not all reactions are equally likely to occur in random genotypes that are viable in a given chemical environment. in our next analysis, we analyzed the nature of these differences among reactions more systematically. clearly, at one extreme, super-essential reactions are present in every viable genotype. at the other extreme, there may be many reactions that occur with a low but non-negligible probability in random viable genotypes. for example, a random viable genotype may contain superfluous reactions.  in addition, there may be intermediate cases where reactions are present often but without being super-essential. figure  <dig> shows a rank histogram indicating the occurrence of all the reactions in the global reaction set for random viable genotypes in a glucose minimal environment. to compute this histogram, we first determined how often each of the  <dig> reactions occurred in a sample of  <dig> genotypes from v, that is, in random viable genotypes with as many reactions as the e. coli genotype in our framework. for any one reaction, the "occurrence" plotted on the vertical axis of the figure is the fraction of genotypes in this sample that contain the reaction. then we ordered the reactions according to their occurrence, assigning rank "1" for the reaction with the highest occurrence and rank  <dig> for the reaction with the lowest occurrence. all super-essential reactions have an occurrence of  <dig>  and contribute to the horizontal plateau on the left of the rank histogram, similar to previous observations  <cit> . we also see a much broader plateau on the right with occurrence values of approximately  <dig> . the two plateaus are connected by a graded slope, corresponding to reactions whose occurrence decreases continuously from  <dig>  to  <dig> . to study this intermediate region of the rank histogram, we first fitted this histogram to two classes of functions f: a function that represents occurrence as a constant plus an exponential function of the rank  = a + b exp), and a function representing occurrence as constant plus a power function of the rank  = a + b/rc). the power function provides a visibly better fit in figure  <dig>  this difference can be analyzed quantitatively by calculating the coefficient of determination r <dig> which represents the variance explained by each functional relationship. we find that r <dig> =  <dig>  for the exponential function and r <dig> =  <dig>  for the power law. note that power laws like this arise in other situations with rank histograms  <cit> .

we next asked whether reactions that are neither super-essential nor on the right hand side plateau of figure  <dig> are often essential reactions. to do so, we returned to our sample of  <dig> viable genotypes, and computed for each genotype of this sample the maximum flux through each reaction using the flux variability approach  <cit> . if this flux was equal to zero for a reaction, we considered the reaction to be "blocked"  <cit> . we also determined for each genotype its essential reactions. we thus obtained for each reaction the frequency at which it is essential and the frequency at which it is blocked . figures  <dig> and  <dig> are scatter plots of these quantities as a function of the occurrence of each reaction. clearly, reactions of low occurrence tend to be blocked, whereas reactions with high occurrence are often essential. in summary, the smooth transition region in the rank histogram is a transition from essential or near essential reactions to reactions that cannot possibly have a function in a given genotype and environment.

the scalar value of reaction occurrence is essentially a one-dimensional projection of a high dimensional pattern of the distribution of reactions among random viable networks. this high-dimensional pattern may be structured in other, non-obvious ways. to find out whether this is the case, we carried out a principal component analysis. to this end, we organized the  <dig> sampled genotypes into a matrix, such that each row corresponds to the bit string associated with one genotype. then, each column corresponds to some reaction r, and comprises a bit string of length  <dig> that contains a '1' in each row where r is part of the corresponding genotype. figure s <dig> shows the results of the principal component analysis carried out on these bit-strings reflecting reaction occurrence . this analysis used the same  <dig> random viable genotypes in v that we analyzed above. the figure shows the first and the second principal component, which explain ~14% and ~1% of the variance in the data, respectively. the first principal component corresponds well with the rank of the reaction as defined by its occurrence. to visualize the association between the first axis and reaction rank, we have colored the reactions according to their rank . the data are clearly heterogeneous, resembling a "comet" with a dense head on the left and a spread-out tail on the right. the comet's head is formed mostly by blocked reactions, while the tail of the comet is enriched with essential reactions. in contrast, the second principal component displays no particular clustering. in sum, reactions that occur in different random viable genotypes show no obvious statistical patterns beyond their rank. this rank strongly correlates with reaction essentiality and blockage.

random genotypes show highly correlated viability in different environments
although each chemical environment i has a specific viable space vi, some genotypes in vi must be viable for multiple environments, in particular at large n. to what extent do the viable spaces for different environments overlap? what are the properties of genotypes in their intersection? to ask these and other questions, we extended our computational approach to multiple environments.

to begin with, we wanted to know whether being viable in one environment improves the chances of being viable in another environment. we therefore estimated the conditional probability p of being viable in a given environment  <dig> under the condition of being viable in another environment  <dig>  as we saw earlier, the probability of being viable in one environment is tiny for genotypes with fewer than n =  <dig> reactions. if the probabilities of being viable in two different environments were independent from one another, p would be equal to p. we estimated p by first uniformly sampling the set of viable genotypes in environment  <dig> using the mcmc method. from the  <dig> genotypes thus generated, we determined the fraction of genotypes that are also viable in environment  <dig>  in the case of independence, this fraction should be close to the value of p, because then p = p. in contrast, we find that p is orders of magnitude higher. this is illustrated in figure  <dig> for all six possible pairwise combinations of three environments . it is useful to compare the data shown there to that of figure  <dig>  for instance at n =  <dig>  if p were equal to p, figure  <dig> should show a probability p of about 10- <dig>  but the actual value exceeds  <dig> , regardless of the environment pair considered. similarly, for n =  <dig>  figure  <dig> shows that p = 10- <dig> or greater, whereas p is below our detection limits for genotypes with this number of reactions.

the large association between viability in different environments we observed should arise if genotypes viable in different environments require nearly identical super-essential reactions. the reason is that the probability that a genotype contains all super-essential reactions is the dominant determinant of the probability that the genotype is viable . in the extreme case where the super-essential reactions for two environments are identical, only the remaining, minor determinants of the probability to be viable come into play. in consequence, the conditional probability p can be large. for the environment pairs we study here, the set of super-essential reactions are in fact nearly identical: all three environments share the same  <dig> super-essential reactions, and only acetate has one additional super-essential reaction. thus the strong association between the viability in different environments is no surprise. we emphasize that this does not mean that the sets v of genotypes viable in different environments are nearly identical. if that were the case, the conditional probabilities displayed in figure  <dig> would be close to one. instead, these probabilities become very small at our lowest values of n.

in sum, the sets of viable genotypes vi for different environments are far more similar than expected by chance. nonetheless, their intersections contain only a small fraction of any one set vi as n decreases.

different environments constrain viability to different degrees
the mcmc method allowed us to estimate the conditional probability p that a genotype is viable in environment  <dig> given that it is viable in environment  <dig>  we now show that it also allows us to estimate the relative sizes of the viable spaces v for different chemical environments. we define the following probability  

for chemical environment i, where vi is the set of genotypes with n reactions that are viable in environment i. in addition, we define p to be the fraction of genotypes with n reactions that belong to both vi and vj. then by mcmc sampling of vi we can estimate the fraction p/p as outlined in the previous subsection. analogously, by sampling vj, we can also estimate the fraction p/p. the ratio of these estimates then yields the ratio p/p. in other words, this approach can tell us whether fewer genotypes are viable in one chemical environment than in another. this ratio is shown in figure s <dig> for environments defined by the three carbon sources we considered here . glucose has the largest set of viable genotypes, followed by succinate and acetate. as n decreases, the differences in the sizes of the vi for these environments become more pronounced, because constraints on viability become more severe in that limit.

the concept of a probability p of being viable in both environments i and j can be extended to any number of environments by defining appropriate ratios p. although the mcmc approach does not allow us to estimate these probabilities directly, it does provide estimates for ratios of the quantities p, p, p, etc., as just discussed. and just like we found that glucose has the largest space v of viable genotypes of the three carbon sources we consider, we can ask which pair of carbon sources has the most viable genotypes associated with it. figure s <dig> shows that this pair is the succinate-acetate pair, while the pairs that contain glucose are about equivalent . because the mcmc approach only provides ratios, the figure shows the three p divided by a common normalization factor, namely p. this procedure allows a direct comparison of the relative values of the p.

for completeness, we show in this same figure the quantity p/p, that is, the probability p of being viable on all three carbon sources divided by the probability p of being viable on environment i . such data can tell us to what extent increasingly complex nutritional requirements affect viability.

to continue in this direction, we can ask whether being viable in one environment leads to an appreciable probability of being viable in many additional environments. to test this, we considered  <dig> aerobic minimal environments that differ in their carbon sources, as listed in table one of  <cit> , and asked in how many of these environments a random viable genotype in vi will be viable. in figures s11a-c we show the histogram of the number of these additional environments, with n set to its e. coli value . genotypes viable in all three "reference"  environments exhibit a bell shaped distribution of the number of environments in which they are viable. this indicates that typical genotypes in vi will be viable in more than just their reference environment.

robustness in different environments is highly correlated
we next extended our analysis of robustness to multiple environments. we sampled  <dig> random genotypes that belonged to both vi and vj, and measured for each its mutational robustness, defined as the fraction of reactions that were non-essential in both environments i and j. in figure s12a we show as a function of n the mean robustness found for the three choices of environment pairs involving glucose, succcinate or acetate as sole carbon sources . just as for the single environment case, we see that the mean robustness increases as n increases and that the lowest values are not extremely small. we extended this analysis to the case of three environments as shown in figure s12b which shows the same trends .

the use of  <dig> genotypes viable on multiple environments allows us to estimate also the distribution of mutational robustness in multiple environments. not surprisingly, just as for a single environment, the distribution is narrow. we illustrate this in figure s13a and b for networks of n =  <dig> reactions, as in the e. coli metabolic network . figure s13a shows data for the pair glucose-succinate, and figure s13b for the triplet glucose-succinate-acetate . both panels also indicate the mutational robustness of e. coli; it is a clear outlier, in fact even more so than in a single environment .

finally, we asked whether there are trade-offs in robustness for these multiple environments. for example, a genotype highly robust to reaction removal in one environment may have low robustness in a second environment. however, this is not the case. figures 10a-c are scatter plots based on  <dig> random genotypes viable in pairs of environments. here, robustness in a given environment is again defined as the fraction of non-essential reactions in that environment. for all three environment pairs, figures 10a-c show a strong positive association between robustness in two different environments rather than a trade-off. we note that this association cannot be explained by the fact that the super-essential reactions are shared between environments. the reason is that these reactions cannot contribute any variability to mutational robustness.

clustering of viable genotypes in multiple environments
in a final analysis, we asked whether genotypes in vi can be distinguished from genotypes in vj, merely by their different "locations" in the genotype space Ω. to answer this question, we performed a principal component analysis of three pooled sets of data:  <dig> random genotypes in vi, another  <dig> random genotypes in vj, and yet another  <dig> random genotypes in the intersection of vi and vj. in figure s <dig>  we show the first and second principal components resulting from this global analysis, where i corresponded to glucose and j corresponded to succinate . the figure also shows the center of mass for each of the three samples. we observe three clouds of genotypes, one for each set. these clouds overlap, but they are also different in a statistically significant way. to demonstrate this claim, we performed a permutation test as follows. first, we defined d* as the sum of the three distances between the three centers of mass of the samples. second, we generated  <dig> random permutations of the points in the clouds, thereby shuffling their assignment to the three clouds. for each shuffle k, we determined the new centers of mass and computed dk as the sum of their three distances. the p-value of the hypothesis that there is no clustering of genotypes according to their viability set is then estimated as the fraction of the shuffles having dk greater than d*. in our test, we found no shuffle satisfying that inequality, so our estimate of the p-value is less than 10- <dig>  the same analysis was performed for the other two pairs of environments, but the pair shown has the clearest separation of the clusters.

discussion and 
CONCLUSIONS
in sum, our analysis has revealed several characteristic features of the genotype space of metabolic networks. first, the probability that a random metabolic network in genotype space is viable  decreases dramatically as its number of reactions n decreases from the number n of reactions in a reaction "universe". most of this decrease is caused by the fact that smaller metabolic networks are less likely to contain all super-essential reactions, reactions that any network must contain to be viable in a given environment. second, the robustness of random viable metabolic networks to the removal of random reactions shows a very narrow distribution. this observation is a simple consequence of a law of large numbers, because many individual reactions contribute to the viability of a reaction network. in all environments we studied, the e. coli metabolic network is significantly more robust than random viable networks. third, we showed that random viable networks typically contain very different sets of reactions. specifically, their genotype distance is not much below that of metabolic networks chosen at random from genotype space, regardless of their viability. viable genotypes having few reactions are exceptions to this rule, because they are appreciably more similar to each other than random genotypes.

fourth, the maximum genotype distance between viable metabolic networks is almost as large as the diameter of genotype space itself, that is, to the maximum distance among all genotypes, regardless of their viability. because of the method we used to identify the typical and maximum genotype distance, we know that genotypes at these distances can be connected through individual reaction changes that do not affect viability. in other words, viable genotypes form genotype networks that extend far through genotype space.

fifth, there is remarkably little structure within a given genotype network. a principal component analysis and hierarchical clustering of our samples of random viable genotypes detects no clustering of genotypes that might indicate different types of viable metabolic networks. importantly, none of these observations depends strongly on the specific carbon source we used in our minimal chemical environments. however, there are differences between the number of genotypes viable on different carbon sources. for example, the space of viable genotypes is smaller for acetate than for glucose. also, fewer genotypes are viable simultaneously on two or three of our carbon sources than on just one carbon source. our markov chain monte carlo sampling approach allows us to estimate the relative sizes of these viable spaces.

we next discuss two potential caveats to our analysis. first, in order to preserve reaction numbers, we used the decidedly non-biological choice of swapping reactions to carry out random walks in our mcmc exploration of genotype space. in contrast, during the evolution of genome-scale metabolic networks, individual reactions are eliminated from metabolic networks through loss-of-function mutations in their enzyme-coding genes; reactions are added through horizontal gene transfer  <cit>  or, more rarely, via the evolution of a protein with new catalytic function within an organism. in this regard, we note that every reaction swap can be viewed as an addition of a reaction  followed by a reaction deletion that preserves viability. in other words, a reaction swap can be decomposed into a succession of biologically meaningful genotypic changes; the connectivity of genotype networks found in our swap approach thus holds also for single additions and deletions of reactions.

our knowledge of the biochemical reaction universe will undoubtedly grow in the future, which raises the question of how sensitive our observations are to the addition of reactions to this universe. in this regard, it is worth highlighting that the added reactions are unlikely to affect viability in the common carbon sources we studied. for such carbon sources, the super-essential reactions are known, and our current knowledge of the reaction universe already allows for an astronomical number of viable genotypes. we suspect that key quantities, such as the large diameter of genotype networks or their typically high robustness to mutations will thus increase rather than decrease as more and more "accessory" reactions become known. these arguments do not necessarily apply to more complex or exotic chemical environments. we leave the exploration of such environments to future work.

the work we reported here suggests that viability in the e. coli metabolic network is significantly more robust to random reaction removal than in random viable genotypes for the three environments we studied. this high robustness persists if we require that a viable genotype does not just have positive biomass growth flux, but also a high biomass growth flux, and also if we change the stoichiometry of the biomass composition randomly by up to  <dig> percent. we note that because of the very narrow distribution of robustness among random viable genotypes, this significant difference translates into a modest decrease in the absolute number of essential reactions in e. coli. for example, in a glucose minimal environment, random viable genotypes in our sample have a mean number of  <dig> essential reactions, whereas e. coli has  <dig> essential reactions, i.e.,  <dig> fewer than the mean. we cannot exclude that future improvements of the e. coli network annotation might reduce this significant difference to random viable metabolic networks, and thus our observation of significantly high e. coli robustness should be interpreted with caution. earlier work by some of us  <cit>  had suggested that the robustness of the e. coli network was not significantly different from random viable networks. however, in that work we had allowed the number of network reactions in an mcmc exploration of metabolic network space to fluctuate by a modest amount. because of the modest number of differences in essential reactions between e. coli and random viable metabolic networks, these fluctuations were sufficient to obscure significant differences in robustness. our improved mcmc approach leaves reaction numbers strictly constant and allows us to reveal these differences.

in conclusion, our work shows that phenotype-preserving genotype networks that extend far through metabolic genotype space are not just peculiarities of metabolic networks with a given size. they are generic organizational properties of metabolic genotype space, and share important features of genotype networks in other classes of systems, such as proteins, rna, and regulatory circuitry  <cit> .

