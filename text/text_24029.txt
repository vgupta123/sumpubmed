BACKGROUND
genomic selection gs,
 <cit>  has been proposed as an alternative to conventional pedigree-based selection , where pedigree information is replaced with dense genetic marker information to estimate the genetic worth of each individual. in gs, thousands of markers are modeled simultaneously and the marker effects are summed, in order to compute the genomic  equivalent of estimated additive genetic  values . gs allows small-effect loci to be captured, obviating significance testing in association and linkage studies. ps has been very effective at capturing the parent average component of the ebv, but cannot capture variation in the proportion of genome shared by pairs of relatives due to mendelian sampling in the absence of an individual’s own phenotypic record or those of its descendants
 <cit> . conversely, gs can theoretically capture the mendelian sampling component in the absence of recorded phenotypes because at an appropriate marker density, all loci that explain some of the phenotypic variation are presumably tagged.

theoretical
 and empirical studies in breeding populations of forest trees
 and other long-generation plant species
 <cit>  have shown that substantial genetic gains can be achieved through gs. it came out that the main advantage of gs over conventional breeding in long-lived species was the possibility to reduce the generation time through the selection based on marker effects before phenotypes are available. thus, any  loss of ebv precision could be compensated for by completing additional  cycles of recurrent selection. however, less attention has been paid to the effect of relatedness between cross-validation  training and testing sets, choice of model and/or the possibility of predicting in new, unknown environments.

the main assumption of gs is that marker coverage is sufficiently dense so that linkage disequilibrium  between markers and causal loci will not be considerably broken up following recombination/meiotic events. one way to increase the chance that markers are in ld with causal loci is to reduce the effective population size , as it is easily controlled by the plant and tree breeders
 <cit> . it has been shown that the increase in prediction accuracy with a reduction of ne is striking at lower marker densities, but minor at higher marker densities
 <cit> . thus, one could expect that when working with a population of small effective size, a small number of markers might be sufficient to capture the ld and obtain high prediction accuracies. however, reducing ne also increases within-population relatedness, and because markers, even at low density coverage, can capture close relatedness between individuals in the training  and testing  sets, ebv predictions in cv testing sets can be non-zero despite the absence of ld
 <cit> . indeed, empirical studies removing relatedness between training and testing sets at the level of the population 
 <cit> , subpopulation
 <cit>  or family
 levels, including a previous study on white spruce
 <cit> , found predictive abilities to be drastically reduced or to fall to zero. similarly, it was suggested that predictive accuracy was driven by markers tracing family relatedness in pine
 <cit> . this stresses the importance of designing training and testing sets appropriate to the conditions under which gs might be used
 <cit>  so that correct conclusions can be drawn and, also, so that marker densities that make it possible to capture not only relatedness but also ld can be used.

model choice may be important insofar as it must align with the genetic architecture of the trait. ridge regression 
 <cit>  is a model appropriate for traits controlled by a large number of small-effect loci, such as growth and wood traits e.g.
, closely resembling assumptions of the infinitesimal pedigree-based  model. methods such as bayesa/bayesb
 <cit>  or least absolute shrinkage and selection operator 
 <cit>  are more relevant for traits controlled by few genes of large effect and are supposedly better at zeroing out  loci of negligible effect
 <cit> . the simpler, more parsimonious rr is widely used in gs as it often performs as well as more complex models e.g.
 <cit> , even though rr is known to better capture relatedness
 <cit> , which complicates the interpretation of its effectiveness.

so far, gs prediction accuracy has mostly been evaluated within single environments. however, as reforestation programs take place on a variety of sites, genotype-by-environment  effects can be substantial and should be considered. it has been shown that a multivariate model, where traits measured on different sites are treated as different correlated traits, could improve predictive ability  for lines tested in one environment but not in the other, thus capitalizing on correlated information between environments
 <cit> . however, this model was less powerful for a line not tested in any of the two environments, with predictions drawn solely from information on relatives
 <cit> . similarly, univariate prediction accuracies dropped when marker effects estimated in a given environment were used to make predictions in different environments
 <cit> , although a recent study on white spruce in eastern canada showed that prediction accuracy could only be slightly reduced in such situations
 <cit> . thus, given species-specific considerations and the potential variability of the reforestation landscape, it appears important to determine whether the estimated marker effects have accurate predictive value in the different reforestation environments.

the objectives of this study were 1) to evaluate how type of model, relatedness between training and testing sets, marker subsets, and across-environment predictions affect model fit or prediction accuracy for wood and growth traits, 2) to estimate the relative efficiency of marker-based versus pedigree-based models, and 3) to discuss implications for the use of gs in the context of spruce improvement and its long breeding cycles.

methods
data
phenotypes
genetic material was sampled from a larger test series  designed to assess the genetic merit of first-generation selections, which had been subdivided into breeding groups delineated by their provenance or geographic region
 <cit> . crosses were made using a partial diallel mating design within each of six distinct breeding groups  or sublines
 <cit> , which were designed to limit future inbreeding to within group. each parent was used in crosses 1– <dig> times, giving rise to a mixture of full- and half-sib families within breeding groups. genetic tests were established in  <dig> from 2-year-old nursery-grown seedlings near asselin township , and st. casimir , québec, canada, in a randomized complete block design. trees were assigned to row-plots of five trees/plot .

for the current study, the base population  consisted of  <dig> parents in a first breeding group  and  <dig> parents in a second  with  <dig> and  <dig> full-sib crosses  made within each group, respectively. the sampled trees were drawn from  <dig> blocks over the two sites and 25– <dig> individuals were sampled per full-sib cross.

in  <dig>  wood cores were extracted from 17-year-old trees with a diameter at breast height  ≥ 5 cm on both sites for determination of wood density  and microfibril angle . amfa was measured by scanning the radial face of the last complete growth ring closest to the bark with a d <dig> discover x-ray diffractometer . diffraction profiles of a few samples were first calibrated by comparison with values obtained using compound light microscopy before the complete population of samples was scanned. density was determined by scanning increment cores from pith to bark along the radial face at a resolution of 25 μm in the qtrs-01x tree ring analyzer . a weighted mean density trait was obtained by summing the product between annual density measures and the ratio of respective radial areas to total radial area. before collecting wood cores, trees were measured for age  <dig> height  and diameter  growth. phenotypes outside ± <dig> phenotypic standard deviations following adjustment for fixed block effects were considered as outliers and set to missing. a total of  <dig>  offspring, with at least one non-missing record among the four traits, were retained after cleaning the genotype data ; i.e.  <dig> and  <dig> from sites s1-c and s2-d,  <dig> and  <dig> from breeding groups bg <dig> and bg <dig>  respectively .table  <dig> 
number of sampled trees across test sites  and breeding groups 


*s1: asselin township ; s2: st. casimir .



genotypes
parents  and progeny  were genotyped with the white spruce infinium snp array pglm3
 <cit>  at a rate of about one snp per target gene locus. snp loci were cleaned by removing those loci that failed; they were monomorphic, displayed a call rate <  <dig> , had a minor allele frequency  <  <dig>  , or a mismatch with both parental genotypes. a total of  <dig>  high quality snps with a mean maf =  <dig>  were retained for gs analyses. these snps were distributed among  <dig>  distinct gene loci. individual genotypes with call rates <  <dig>  were removed. missing genotypes  were imputed from the binomial distribution, with success probabilities given the observed allele frequencies.

in order to test for population structure and control for relatedness as an alternative to the numerator relationship matrix  for association testing, an identity by state , allele-sharing, realized genomic relationship matrix  was constructed as:
  <dig>  

where m is an n × m  matrix of snps coded as  <dig>   <dig> and  <dig> for genotypes  <dig>   <dig> and  <dig>  respectively, and p is an n × m matrix with columns containing the frequency of the second allele pm  at locus m. subtracting p from m gives q, which sets mean values of the allele effects  to zero. finally, dividing qqt by k = tr /m  normalizes the grm to a scale analogous to elements in the a matrix
 <cit> . to test for population structure, the k matrix  was decomposed spectrally with the eigen() function in r v <dig> .2
 <cit> , where d is a diagonal matrix of eigenvalues and columns of v are the corresponding eigenvectors of k. spectral decomposition of the k matrix made it possible to estimate the variation captured by the first eigenvector, which helped determine the extent of the population structure among the breeding groups.

statistical models
univariate polygenic model
the univariate, individual tree  mixed model for each trait  was:
  <dig>  

where yt is a vector of phenotypic measurements at age  <dig>  b is a vector of fixed block effects, ai is the vector of additive genetic  values , e is the vector of residual error effects, and x and z are incidence matrices linking phenotypic records  to estimates of effects. expectation of the model is e, e =  <dig> and e = xb, with additive genetic and error effects distributed as
 and
 where a is the nrm describing the additive genetic relationships among individuals and i is an identity matrix.

bivariate polygenic model
to test the assumption that a trait measured in different environments is affected by the genotype-by-environment interaction , the univariate model can be extended to its bivariate counterpart by stacking up the vectors for the two traits as:
  <dig>  

where the total vectors of random effects have covariance structures var = g = c ⊗ a and var = r = e ⊗ i for the additive genetic and residual effects, respectively, where ⊗ is the direct  product and c and e are matrices containing the additive genetic and residual variance parameters to be estimated as:
  <dig>  

which indicates that there is a genetic covariance across sites  but that the residual covariance across sites is zero because measures took place on different individuals in different environments.

model parameters were sampled from the posterior distribution using the mcmcglmm v <dig>  package
 <cit>  in r v <dig> .2
 <cit> . each model was run for  <dig>  iterations with a burn-in of  <dig>  and thinning interval of  <dig>  resulting in  <dig>  samples saved per chain. fixed-effect priors were drawn from the default normal distribution with large  variance. weak, proper priors drawn from the inverse-wishart distribution were set to the phenotypic variance divided by the number of random effects in the model with the degree of belief parameter set to  <dig> and  <dig> for uni- and bivariate models, respectively. mixing and stationarity of the chains was assessed with trace plots of samples from the posterior distribution using the coda package
 <cit> . posterior distributions of the parameters were summarized using the mode and the highest probability density  interval  with the mcmcglmm and coda packages. posterior distributions of heritability  and genetic correlations between traits  were calculated as
 and
 respectively. estimated breeding values  obtained from the bivariate analyses were stored on the site where phenotypes were observed and were subsequently used to determine prediction accuracies with univariate snp-based gebvs .

following bivariate analyses, phenotypes were adjusted for fixed block effects and scaled by within-site phenotypic standard deviation in order to account for  differences in phenotypic variation for traits on different sites. no differences in genetic means between the breeding groups were detected. phenotypes were then combined across sites for use in marker regressions, assuming that traits on different sites were a single trait with a genetic correlation equal to unity.

marker regression models
in multiple-marker regression, many snps are simultaneously estimated as random effects in the individual tree model:
  <dig>  

where ys is a vector of adjusted and standardized phenotypic measurements at age  <dig>   <dig> is a vector of ones, μ is an intercept, ai is the vector of additive genetic  values, uk is a vector of random marker effects with the n x m incidence matrix containing marker covariates coded as zki =  so that the sum of marker effects approximates the individual  genomic estimated breeding value 
 and ei is the vector of residual error effects. additive genetic  and error effects were assumed to be distributed as in eq.  <dig>  the intercept was assigned a flat  prior, whereas variance components were assigned a scaled inverse- χ <dig> prior density with degrees of freedom  and scale  parameters set to
 for the error, additive genetic and marker effects, respectively, as recommended in
 <cit> .

two types of marker regression were performed that differ in the prior distribution of snp effects. in ridge regression , all snp effects are assumed to have a common variance by assigning a gaussian prior as
. under this assumption all marker coefficients are shrunk to the same extent, which is appropriate for traits controlled by many genes of small effect, similar to the assumptions of the infinitesimal pedigree-based  model. in contrast, the lasso allows for marker-specific shrinkage effects, making it appropriate for traits thought to be under control of fewer genes of moderate to large effect. in the lasso, the distribution of snp effects are assigned a double exponential  prior as
 which states that the marker-specific prior is gaussian, with marker-specific shrinkage of effects depending on τ <dig>  which is in turn controlled by the prior distribution of the regularization parameter )
 <cit> . the regularization parameter , which allows the degree of shrinkage to be estimated from the data, was assigned a prior beta distribution as outlined in
 <cit> , with parameters shape =  <dig>  and rate =  <dig> × 10− <dig> yielding λ =  <dig>  for our data. large values of λ produce more informative  priors on marker effects
 <cit> , which will shrink  small effects towards zero to a greater degree than in rr. pedigree-based  best linear unbiased prediction , ridge regression  blup, and lasso  regression were performed using the blr package
 <cit>  in r v <dig> .2
 <cit> .

single-marker regression  was also conducted to test the hypothesis that individual marker loci were in partial or complete linkage disequilibrium with a causal gene and to delineate subsets of markers for further marker regressions. marker effects were treated as fixed effects  in smr and relatedness structure was controlled using the numerator  or genomic relationship  matrix using the emmax algorithm
 <cit>  in the rrblup  package
 <cit>  in r 
 <cit> . variance components are estimated only once in a base model without snps using emmax and, subsequently, each snp is added to the model in turn, equations are solved, and a f-test is constructed for each snp to test the hypothesis that the snp effect uk ≠  <dig> 

traits were modeled using 1) all individuals with all snps and/or the pedigree and 2) subpopulations of individuals with all or subsets of snps and/or the pedigree in cross-validation . snp subsets for cv were retained for reevaluation using rr in five different ways. first, the snps with the largest absolute effects  using smr were retained, controlling for relatedness with a or k. next, the  <dig> snps with largest absolute effects were retained from the full model  using rr and pedigree information , which approximated the maximum number of significant snps from smr. snp effects were estimated in a subpopulation  and subsequently re-evaluated using rr in the same  or complementary subpopulation . in the former case, snp effects treated as fixed effects in smr may be biased when estimated and validated in the same non-independent data
 <cit> . finally, as controls, two sets of  <dig> snps were built by selecting snps randomly or by selecting those with the highest observed minor allele frequencies. for each of these controls, the selected snps remained the same across traits and subpopulations.

for cross-validation  analyses, individuals  or full-sib families  were assigned to  <dig> folds randomly. in each of  <dig> rounds of cv,  <dig> folds acted as the training set in which snp effects were estimated in order to predict the genetic values of individuals in the remaining fold, whose phenotypes had been withheld. for models tested across subpopulations , that is training the models in one subpopulation and testing them in the other one, each cv round used  <dig> of  <dig> folds as the training set from subpopulation  <dig>  with a different fold used as the testing set for each round of cv from subpopulation  <dig>  prediction accuracies were calculated as the correlation ) between the sum of cv snp estimates  or gebvs and the additive genetic  value  or ebvs estimated using the bivariate, pedigree-based model and all phenotypic data, which was considered the best estimate of the “true” breeding value.

subsets of individuals with mean training and testing set sizes of  <dig> and  <dig> individuals, respectively, were used to perform marker regressions and test prediction accuracy four different ways:

bg <dig>  – within-breeding group cv simulates a situation where related individuals have already been phenotyped on both  sites, as bg members were distributed across sites. gei could lower prediction accuracy if present.

bg1 → bg <dig> – between-breeding group cv removes all known relatedness between cv sets, establishes baseline accuracy due to  ld and thus tests if the model is transferable beyond the study material. as members of both bgs are present in both environments, gei could have an impact.

s <dig>  – within-site cv simulates a situation where models are trained by pooling individuals across bgs, with no known relatedness between bg. evaluation occurs within site, thus gei cannot affect the results.

s1 → s <dig> – between-site cv simulates a situation where no phenotypes have been observed on related individuals in the second environment, testing the assumption that the traits on different sites have a genetic correlation of one.



RESULTS
univariate heritabilities  were similar to their bivariate counterparts , suggesting homogeneous phenotypic variance across sites. although the genetic correlation  was not equal to  <dig> across sites , it was moderately high , to high . this implied that, biologically, the gei was not strong enough to warrant the more complex  model for wood traits  and that data might be pooled across sites and considered as a single trait.table  <dig> 
bivariate heritabilities , genetic correlations , and highest probability density interval  for wood quality and growth traits considered as correlated traits when measured on different sites


h
2
h
2
r
12
*s1: asselin township ; s2: st. casimir .


†aden: average wood density; amfa: average microfibril angle; ht17: 17-year height; dbh17: 17-year diameter at breast height.



spectral decomposition of the k matrix revealed that < 5% of the variation was captured by the first eigenvector. this indicated that population structure was not important among the breeding groups and that a or k was sufficient to capture the relatedness among individuals. the lack of phenotypic differences observed between the two breeding groups, bg <dig> and bg <dig>  supported this lack of structure. the k matrix captured a low level of relatedness between the two bgs , implying that some pedigree errors or cryptic relatedness between groups was present. the elements in k underestimated the corresponding non-zero, expected relationship values in a, with median  values for half- and full-sibs of  <dig>   and  <dig>  , respectively.figure  <dig> 
the realized genomic relationship  matrix.
k matrix sorted by breeding group  and full-sib family, with bg <dig> in the upper left and bg <dig> in the lower right.



full model with all snps
modeling all individuals  and snps  simultaneously with ridge regression , which assumes a common variance across snps, only improved model fit  and reduced the error variance for aden, compared with the pedigree-based model  . for the other three traits , fm-rr resulted in poorer model fits and inflated error variance, signifying either that the pedigree contained valuable information not captured by the markers  and/or that markers were overfitting to spurious effects in the data. comparing models with both pedigree and marker  and pedigree-only  information confirmed that the pedigree accounted for a large proportion of the variance, even with markers present in the model. however, both sources of information  resulted in better fits and lower error variances compared with both the fm-a and the fm-rr models , implying that markers were partially capturing non-redundant information to the pedigree.table  <dig> 
full-model posterior means of variance components using all snps , all individuals , and deviance information criterion  for wood quality and growth traits


trait†


λ
2

mse‡

†aden: average wood density; amfa: average microfibril angle; ht17: 17-year height; dbh17: 17-year diameter at breast height.

*fm-a: full model - pedigree-based; fm-rr: full model - ridge regression with marker data; fm-rra: full model - combined ridge regression with markers and pedigree data; fm-l: full model - the least absolute shrinkage and selection operator; fm-la: full model – combined least absolute shrinkage and selection operator, and pedigree information.


‡mean standard error over models.



allowing marker-specific shrinkage with the lasso  resulted in only very minor improvement in model fit and reduced error variance over the corresponding models using a common snp variance  for all traits . the variance of the λ parameter increased from the starting values, indicating a tendency to shrink marker effects more severely towards zero . again, pedigree information proved important in the fm-la model, allowing λ to further increase, providing even sharper shrinkage. nevertheless, correlations between snp effect estimates in complementary models  were very high  and, given the limited improvement in lasso fits, this model was not further considered.

cross-validation  with all snps
for cv <dig>  prediction accuracies were high for pedigree-only  models because the cv sets were highly related. marker-only models  captured a high proportion  of the cv1-a prediction accuracy for all traits, when modeled within breeding groups  or environment  . modeling both pedigree and marker effects  led to prediction accuracies that approached but did not reach those obtained using the pedigree-only model, meaning that the previously seen better model fits for fm-rra  did not necessarily translate into better predictability in cv. this might have been due to the overfitting of marker effects and/or high multicollinearity between the marker and pedigree components. the same pattern was observed within bg <dig> and s <dig> . prediction accuracies were reduced somewhat for wood traits  across models when the training and testing sets were in different environments  compared to evaluation within the same environment . however, this reduction in accuracy was much more pronounced for growth traits , especially for dbh <dig>  prediction accuracies were near zero for all traits across models when training and testing sets were in different, genetically unrelated, breeding groups , as suspected from previous results with half-sib families
 <cit> .table  <dig> 
prediction accuracies for wood quality and growth traits estimated with cross-validation sets built with individuals within full-sib families using pedigree , ridge regression  or both  sources of information with all snps  and various subpopulations of individuals


trait†
mse‡

†aden: average wood density; amfa: average microfibril angle; ht17: 17-year height; dbh17: 17-year diameter at breast height.

*bg1: both training and testing sets from breeding group 1; bg1 → bg2: training sets from breeding group  <dig> and testing sets from breeding group 2; s1: both training and testing sets from site 1; s1 → s2: training sets from site  <dig> and testing sets from site  <dig> 


‡mean standard error over cross-validation iterations and subpopulations.



cross-validation  with all snps
overall in cross-validation using family assignment  where relatedness between cv sets did not exceed those of half-sibs, prediction accuracies decreased sharply  for all models, traits and subpopulations , compared with those in cv <dig>  i.e. cross-validation where individuals were assigned to the various sets . however, the same trend was also observed for the pedigree-based prediction  and as for cv <dig>  the models based on markers only  captured between 75% and 104% of the cv2-a prediction accuracy . as cv <dig> and cv <dig> evaluate exactly the same set of individuals for bg <dig> and s <dig>  differences in prediction accuracy can only be due to lower relatedness between cv sets, not to different ld patterns across different sets of individuals. that is, if markers were in ld with causal loci, prediction accuracies for marker-based models  should be superior to those of pedigree-based models , which was not usually observed. part of the lower prediction accuracy in cv2-rr was captured with cv2-rra, i.e. when combining pedigree and marker information, meaning that even the weaker pedigree structure  provided useful information not captured when using markers only. furthermore, this lower relatedness between training and testing sets in cv <dig> resulted in three times greater variability in prediction accuracy among cv folds  than in cv <dig>  similar to cv <dig>  cv <dig> prediction accuracies were higher within the same environment  than when predicting between environments , where prediction accuracies for growth traits were more reduced than those for wood traits . as suspected, by removing all known relatedness between training and testing sets , prediction accuracies for rr models fell to around zero for all traits. the fact that the expected prediction accuracy between bgs  for the pedigree-only model  was close to zero indicates that sampling error might have contributed to small, non-zero prediction accuracies for models including markers, such as for wood density .table  <dig> 
prediction accuracies for wood quality and growth traits estimated with cross-validation sets built with full-sib families, using pedigree , ridge regression  or both  sources of information with all snps  and various subpopulations of individuals


trait†
mse‡

†aden: average wood density; amfa: average microfibril angle; ht17: 17-year height; dbh17: 17-year diameter at breast height.

*bg1: both training and testing sets from breeding group 1; bg1 → bg2: training sets from breeding group  <dig> and testing sets from breeding group 2; s1: both training and testing sets from site 1; s1 → s2: training sets from site  <dig> and testing sets from site  <dig> 


‡mean standard error over cross-validation iterations and subpopulations.



cross-validation with snp subsets
for snp subsets that were identified and re-evaluated within the same population , all model-based methods used to select subsets performed relatively well . snp subsets selected for their largest absolute effects had accuracies slightly superior to those of randomly selected  or highest minor allele frequency  subsets for growth traits, but differences for wood traits were less clear. prediction accuracies were slightly higher when snp effects had been treated as fixed effects  and then re-evaluated in the same population . this trend suggests that, in some cases, completely eliminating many markers of supposedly zero effect did not hamper much the estimation of the fewer “true” marker effects, as was previously hypothesized from results obtained using the lasso models. however, in many instances, the accuracy estimates were slightly lower than those obtained with the full set of markers. this might be due to the removal of some markers that were in ld with qtls associated with the traits of interest.table  <dig> 
prediction accuracies for wood quality and growth traits estimated with cross-validation sets built with individuals within full-sib families for wood quality and growth traits using ridge regression  for subsets  of snps from single-marker regression controlling for
a
or
k
, the largest absolute effects from the full model , the highest minor allele frequencies , and a random selection  for various subpopulations of individuals


trait†
m
m
m
m
mse‡
subset of significant snps  identified after an association study using relatedness estimated with pedigree information.


₸subset of significant snps  identified after an association study using the realized genomic relationship matrix.


†aden: average wood density; amfa: average microfibril angle; ht17: 17-year height; dbh17: 17-year diameter at breast height.

*bg1: both training and testing sets from breeding group 1; bg1 → bg2: training sets from breeding group  <dig> and testing sets from breeding group 2; s1: both training and testing sets from site 1; s1 → s2: training sets from site  <dig> and testing sets from site  <dig> 


‡mean standard error over cross-validation iterations and subpopulations.



when snp subsets selected in bg <dig> were re-evaluated in a complementary subpopulation  with no known relatedness to bg <dig>  prediction accuracies fell to near zero for all subsets and traits , similarly to what was observed with the full set of markers . for models built on site s <dig> and evaluated in s <dig> , prediction accuracies were moderate for wood traits , but low for growth traits ; again, they were lower than those obtained with all the markers .

discussion
accuracy of gs models under various scenarios
it is clear from this and other studies on forest tree species e.g.
 <cit> , that current moderately dense snp panels can be used to capture additive genetic effects remarkably well under certain conditions. gs model accuracy is known to be affected strongly by ne and marker density. for instance, it was shown for a white spruce training set of about the same size as the one used in the present study, and with similar marker density, that prediction accuracy of less than  <dig>  could be achieved when the effective population size was over 600
 <cit> . however, although the number of snps in
 <cit>  and in this study was about the same, the number of distinct gene loci involved in the present study was more than twofold. this higher genome coverage might have also contributed slightly to improve accuracy estimates as expected from simulation studies for similar population sizes
 <cit> . however, such improvement in accuracy appears to be modest at best, as indicated by accuracies obtained with subsets of random markers or with those with the highest maf, which were almost the same as those estimated using all markers .

the prediction accuracy is also affected, to a lesser extent, by trait heritability and the training set size, once a minimum of n ≈  <dig>  –  <dig>  individuals has been reached
 <cit> . given the number of snps  and distinct loci  used in this study and a white spruce genome size of ~  <dig>  cm
 <cit> , one would expect ~  <dig>  snps/cm if marker coverage was evenly distributed across the genome. at  <dig> –  <dig> snps/cm, ne =  <dig> –  <dig> and a training set with n =  <dig>  individuals, one should theoretically achieve gs model accuracies of  <dig>  –  <dig> 
 <cit> . this was seen in this study  for predictions within breeding groups  or for the same environment when combining both breeding groups  using slightly smaller  training sets. however, as for pedigree-based models, prediction accuracy of marker-based models decreased and fell near zero when close  and all known relatedness  was removed between the training and testing sets, respectively, similarly to what was observed in another gs study on a white spruce population of larger effective size
 <cit> . this suggests that short-range ld, i.e. that between snps and causal loci still persisting in populations after several generations of random mating, might be more limited than expected, or that only a few of the snps used were in ld with causal loci . such an observation is reinforced by the trends in accuracy values seen when using subsets of random markers or those with the highest maf, where accuracies did not decrease much compared with those estimated using all markers .

low prediction accuracy between breeding groups in our study was not due to lack of modeling a group factor, as negligible phenotypic and genotypic differences were observed among breeding groups. this is consistent with the very weak genetic differentiation seen among white spruce populations in québec
 <cit> , making the  <dig> base parents in our study members of one large historical population. these base parents are still mostly unrelated, as spruce pedigrees in québec have only been documented for two generations. in cattle, 50 k snps were deemed adequate to capture causal loci within breed, whereas 300 k snps were recommended for consistent cross-breed prediction accuracies, based on simulations and historical knowledge of ne
 <cit> . as expected, empirical cross-breed predictions in cattle fell to zero using 50 k snps, although combining breeds into a single training set resulted in prediction accuracies comparable to within-breed predictions
 <cit> . at first glance, this appears analogous to predictions across and within breeding groups obtained in the present study, especially given that when we simultaneously considered both breeding groups when training the genomic prediction models, accuracies did not decrease much compared with those obtained by training models specific to each breeding group. when combining both breeding groups, a breeding group structure was introduced, although short-range ld should not differ between these breeding groups as they are believed to belong to the same ancestral population
 <cit> . any minor differences between breeding groups would have been absorbed by the marker effects thus biasing them, leading to prediction accuracies that may not be superior to modeling known subpopulation memberships
 <cit> .

reducing marker density and impact on prediction accuracies
removing uninformative loci from the models appeared to have a positive, although not statistically significant effect on cross-validation for some traits within breeding group  or site . compared with the prediction accuracies obtained with all markers, a slight increase was indeed seen when using markers found significantly associated with traits when using either pedigree information  or realized genomic relationships , or markers with the largest absolute effects  . this increase in accuracy can certainly be accounted for, at least in part, by the fact that these subsets of significant markers were not identified in an independent dataset
 <cit> , and the accuracy estimates obtained could consequently be slightly biased upwards, thus accounting for the slight increase observed in accuracy. such an increase in prediction accuracy was not observed for subsets of random markers, nor for those of highest minor allele frequency.

in a recent study on wood and growth traits in loblolly pine full-sib families, no increase in prediction accuracy was reported for various subsets of markers selected after association studies or randomly selected markers up to a maximum number of about  <dig>  markers
 <cit> . however, in another loblolly pine population that was clonally replicated, two different patterns were observed with regard to the influence of marker density on predictive ability
 <cit> . for some traits such as growth, development and wood traits, the maximum value was reached with a few hundred markers and this value did not vary with a larger number of markers , whereas for traits such as wood density and disease-resistance-related traits, a small number of markers associated with these traits  made it possible to reach the maximum value, which decreased with the addition of more markers. for wood density, the predictive ability obtained using subsets of several hundred markers was somewhat higher than, but not different from, subsets of randomly selected markers of similar size, as observed in the present study on white spruce. in a cattle population, genotypes from a 54 k snp array made it possible to increase, on average, the prediction accuracies for daughter yield deviations by about  <dig>  over those obtained with the pedigree information only, which represents an increase of about 60%
 <cit> . although removing uninformative snps did not reduce predictive ability estimates obtained with a 54 k snp array, the high density arrays used allowed up to tens of thousands of snps to remain in the final model. these various results suggest that higher prediction accuracy might also be obtained in trees with subsets of markers significantly associated with the traits, but likely not until much higher density arrays than the current ones are available. the bayescπ model
 <cit>  could be useful for single-step subset selection at higher marker densities because it appears to align more closely with the distribution of marker effects for wood and growth traits. bayescπ simultaneously performs variable selection and shrinkage of snp effects remaining in the model with a common variance, although empirical studies in plants have not proven it superior to the simpler rr model
 <cit> .

capture of relatedness and long-range and short-range linkage disequilibrium
the observation that gs prediction accuracies sharply decreased when training and validation individuals were completely unrelated  may be due to various causes. the first could be related to the fact that the long-range ld  generated through controlled crosses among the closely related individuals making up the training set may not be present in a non-related testing set. linkage studies have shown that marker effects are generally limited to the family  in which they were estimated
 <cit>  because the full variation of the causal loci in the population is not sampled. linkage has nevertheless been found to be useful to increase genetic gain, even when no major effects were present, by increasing the precision of the relationship matrix
 <cit> . in gs, where estimation occurs over the entire population, co-segregation of linkage blocks  was found to contribute significantly to prediction accuracy across full-sib families in maize
 <cit> . in white spruce breeding groups such as those used in the present study, the contribution of long-range ld is also likely important, but it would decay more rapidly in subsequent generations than short-range ld
 <cit> . however, combining full-sib families of several breeding groups could make it possible to develop gs models with high accuracies, as it was observed in the present study when individuals were pooled across breeding groups . the persistency of that accuracy will depend on how quickly those linkage blocks decay over generations.

a complementary explanation for the loss of prediction accuracy among unrelated individuals could be that markers were largely capturing existing relationships between cv training and testing sets
 <cit> . it has been reported that genomic prediction accuracies can increase with the number of markers even in the absence of ld because markers capture additive relationships, but these accuracies will only be superior to the pedigree-based ones if markers are in ld with causal loci
 <cit> . in line with
 <cit> , we observed in this study that the marker-based  models implicating all markers or subsets of markers did not perform in most cases as well as the pedigree-based models using all the available trees or in most cases of cross-validation. also in agreement with
 <cit> , prediction accuracies generally increased with the marker density used , but only slightly . these observations imply that larger family sizes  might be needed in order to demonstrate the superiority of marker- over pedigree-based prediction accuracies
 <cit>  or that the contribution of ld to prediction accuracy was limited. for the former, more family members would allow snp effects to be estimated more accurately, which would increase prediction accuracy
 <cit> . the latter would mean that prediction accuracies are specific to a group of closely related individuals and may be overestimated because the larger contributions from relatedness and smaller contributions from short-range and long-range ld cannot be disentangled. this observation would argue in favor of gs models developed and implemented within the same population  at least for the time being and considering the financial resources generally available to breeders.

one way to think about the level of ld in a population is to consider the relationship matrix estimated with the markers, which can be partitioned into 1) the expected  relationships obtained from pedigree information, 2) the deviations around these relationship values due to mendelian sampling, i.e. those due to the fact that each offspring receives a different set of genes from its parents and that each offspring is different from its expected degree of kinship, and 3) the sampling error
 <cit> . at high marker densities, the mendelian sampling component can vary, for example, by as much as aij =  <dig>  −  <dig> 
 <cit>  relative to the pedigree-based relationship coefficient  of aij =  <dig>  for full-sibs, and can be used to approximate the level of ld in a population
 <cit> . thus, to surpass pedigree-based prediction accuracies, it is clear that the precision of relatedness in the numerator relationship matrix  needs to be increased. at high marker densities, genetic parameters can be estimated solely from mendelian sampling components
 <cit> , implying that the genomic relationship matrix can be used to model the covariance among distantly related individuals
 <cit> , which establishes baseline accuracy due to ld
 <cit> . in this case, however, large  population sizes would be required as the precision of quantitative genetic parameters is inversely proportional to the size of the estimated relatedness
 <cit> . in our study, genomic relatedness likely underestimated pedigree-based relatedness, given that the scaling of the genomic relationship was appropriate. this observation suggests that many more markers would be necessary to obtain prediction accuracies superior to those using pedigree information. on the other hand, the “true” breeding values for wood and growth traits of the white spruce population considered in this study are not known and have been estimated using the pedigree information of the complete population and the bivariate individual-tree mixed model. one might think that “true” breeding values are closer to breeding values estimated with the realized genomic relationship matrix, which might influence the comparison of the pedigree-based and marker-based accuracies. as an attempt to answer this question, we re-estimated the accuracies replacing the “true” breeding values by the phenotypes, which are not influenced by the method of estimation as are the breeding values. for most of the scenarios tested, accuracies based on pedigree information were higher than either the genomic-based estimated breeding values or those estimated with combined genomic and pedigree information. thus, this observation suggests that using the pedigree-based estimated breeding values as proxy for “true” breeding values has no significant impact on the estimation of prediction accuracies.

genotype-by-environment interaction
the results obtained with the two cv scenarios that tested the impact of gei  were different for wood and growth traits. wood traits were relatively unaffected by gei in the bivariate model , which was reflected in high  and moderately high  prediction accuracies when phenotypes obtained in the second site  were included or not in the training model, respectively . these good prediction accuracies between environments would support the pooling of wood trait observations across sites and treat them as a single trait over environments. the situation might be different in more heterogeneous environments where gei might be more important, as generally reported for western north america for instance
 <cit> , thus necessitating a careful case-by-case analysis.

growth traits were more sensitive to gei than wood traits, as prediction accuracies fell to moderate  and low  levels, when phenotypes measured in the second site  were included or not in the training model, respectively . such gei was previously observed to be modest for growth traits in white spruce, though statistically significant
 <cit> . this trend suggests that not only could a gei component be beneficial in the statistical model, but information on relatives  alone is insufficient to predict genetic values in an environment where phenotypes have not been assessed.

borrowing correlated information  to make predictions across environments was found useful in wheat
 <cit> , which may have been facilitated by the evaluation of homogeneous genetic  lines as opposed to the families or populations used in forestry, which are genetically heterogeneous. for both wood and growth traits, removing information quality  and quantity  between cross-validation sets weakened prediction accuracies, emphasizing the importance of close relatedness when making predictions across environments. when looking at growth traits in particular, it is encouraging to notice that the decrease in accuracy between sites was less pronounced for height than for dbh. height is generally the preferred selection trait for fast growth by tree breeders
 <cit> . this observation is in line with results reported for low gei in white spruce for this trait
 <cit> , and also with the small reduction in accuracy observed across sites in a previous application of genomic selection to white spruce half-sib families in eastern canada
 <cit> .

the bivariate model, which simultaneously considers the same trait measured on trees tested on two sites as different correlated traits, could be extended to a multivariate or reduced rank factor analytic model
 <cit>  if there was an interest in fine-tuning the regional performance of seed orchards. of course, this does not preclude combining traits over sites if overall performance in a large target environment is sought . more importantly, it may be of interest to generate gei for wood traits with silvicultural treatments
 <cit>  if interactions under intensive vs extensive management are anticipated.

implementation of genomic selection in spruce breeding programs
in practice, our results indicate that future prospects for genomic selection in spruces should take place within populations of small effective size combining several breeding groups, and thus implicating individuals of high relatedness within breeding groups. to recapitulate, this is first because marker-based model accuracies do not hold when removing relatedness between cv sets, indicating that with the current marker densities the overall short-range ld between markers and causal loci is either too low to be of practical use or not sufficiently well captured. with the proposed approach, reduction in marker coverage as shown in table 
 <dig> would not have a significant negative impact on prediction accuracies, but as only long-range ld and relatedness are likely captured, prediction accuracy may not be persistent over many generations. second, as expected, within-population prediction accuracies were high in this study, where effective population size was considerably constrained, and higher than those obtained in a much larger and genetically diverse spruce population with lower degree of relatedness
 <cit> . however, it is clear that gs models could be developed for larger populations, as illustrated in the tested scenario s <dig>  which combines breeding groups g <dig> and g <dig>  without significantly affecting prediction accuracies . given the number of breeding groups tested, we could not determine what should be the most effective population size for a successful operational use of markers, but it is apparent that it could be at least  <dig>  and maybe up to 100
 <cit> , without losing too much prediction accuracy.

the obvious caveat for the proposed approach is that it is not possible to clearly separate the contributions of both relatedness and long-range ld  from prediction accuracy. long-range ld may still be important if its contribution to prediction accuracy does not decay as fast as that due to relatedness, especially with recurrent selection, i.e. in a population with the same genetic background. the use of multigenerational data might be one way to disentangle the two sources of information.

a simple form of gs that does not depend on ld would consist of replacing the pedigree-based numerator relationship matrix with the genomic relationship matrix in the standard individual  blup model
 <cit> , or to blend the two sources of information
 <cit> , which is functionally equivalent to estimating and summing snp effects using ridge regression
 <cit> . we have shown that marker-based models could achieve, in most cases, almost 90% of the accuracy of pedigree-based models, and that data from breeding groups and sites could be combined without noticeably affecting the accuracy results. based on these findings, we believe that kinship based on realized genomic relationships would be especially useful if pedigrees were unknown or incomplete  pollination in closed breeding orchards) to capture any cryptic relatedness not accounted for in the “known” pedigree , to correct pedigree errors, and to overcome some of the strong assumptions of using the numerator relationship matrix in the pedigree-based blup
 <cit> . this scenario would likely make it possible to obtain prediction accuracies that are higher than those obtained with incomplete pedigree information, and at the same time, to reduce breeding and testing costs. with the populations used in the present study, and ignoring knowledge on male contribution, the relative prediction accuracy of rr models over pedigree-based models  would have varied from 115% to 162%.

another simple gs scenario that does not depend on our ability to separate the source of prediction accuracy would be to conduct genomic prediction within full-sib families
 <cit> . in this case, the pedigree provides no information, ld would be high, and there would be no risk of linkage phases changing over families. the idea would be to generate large full-sib families , phenotype a fraction of the individuals , and select both phenotyped and unphenotyped individuals
 <cit>  for propagation. although not tested in this study, the method could be useful in multiclonal forestry to identify superior genotyped seedlings derived from somatic embryos. for embryos originating from previously field-tested and genotyped members of the same cross, no additional field testing would be required. the difference between this method and genomic selection for recurrent selection is that the identified individuals would be propagated and, thus, marker effects tracing large linkage blocks would not need to persist in subsequent generations. data could be pooled over families  as done in this study. with such a scenario and the strict assumptions under which this genetic gain potential might be realized, the breeding cycle for the set of families retained could be significantly reduced and gain per time unit more than double, i.e. the gain per year of breeding activities, which includes selection, crossing, and propagation phases .table  <dig> 
potential genetic gain as estimated empirically from a 5% selection intensity made within families using ebvs  and gebv , and expected gain per time unit under the assumption that with use of markers and somatic embryogenesis, the breeding cycle could be reduced from  <dig> to 10 years by avoiding the 20-year field test and production phases


*bg1: both training and testing sets from breeding group 1; s1: both training and testing sets from site  <dig> 


†aden: average wood density; amfa: average microfibril angle; ht17: 17-year height; dbh17: 17-year diameter at breast height.


aebvcv1/tc, where tc = <dig>  and tc is the number of years to complete a breeding cycle with conventional breeding methods.


bgebvcv1/te, where te = <dig>  and te is the number of years to complete a breeding cycle with genomic selection and somatic embryogenesis to propagate the superior selected material.



CONCLUSIONS
in the short term, genomic selection would be most useful to select superior individuals within large full-sib families. these individuals would be reproduced by vegetative propagation techniques such as somatic embryogenesis , or a mix of se and rooted cuttings, in order to develop a multivarietal forestry program. with regard to genomic selection for recurrent selection at current marker densities in spruce populations, its efficiency would depend on the presence of close relatives in order to exploit the capture of relatedness and supposedly long-range ld. thus, a simple marker-based approach that aim to uncover relatedness when pedigrees have not been recorded or are only partially known would seem to be the most cost-effective application of this technology. for such a scenario, the total number of snps required would be only a few hundreds to a few thousands. in the longer term, superior marker-over pedigree-based predictions may be achievable in descendant generations of closed populations as short-range ld increases and pedigrees provide less information. however, to achieve this goal, denser marker arrays, more individuals per family, and more sophisticated experiment designs and genomic selection models
 <cit>  than those used in the current study will likely need to be considered. a step towards achieving this goal in forest genetics might also be the estimation across generations in order to better evaluate the persistency of marker effects.

competing interests

the authors declare that they have no competing interests.

authors’ contributions

jbe participated to conceiving the study, designing breeding populations, providing access to field experiments, analysing data, drafting the manuscript and obtaining the funding. tkd performed the bulk of statistical analyses and drafting of the manuscript. jm participated in drafting the manuscript and obtaining the funding. ar participated to designing breeding populations, providing access to field experiments and phenotyping populations. jbo participated in conceiving the study, drafting the manuscript, obtaining the funding and supervised the development of markers and genotyping assays. all authors read and approved the final manuscript.

