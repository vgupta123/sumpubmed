BACKGROUND
histones are subjected to numerous modifications, including methylation, acetylation and phosphorylation. over  <dig> different amino acid residues of the histones, detected by specific antibodies or mass spectrometry, can be modified. they regulate a number of important processes on dna, including transcription  <cit> . extensive studies comparing histone modification and transcription levels have established that histone methylation is associated with either transcriptional repression or activation. a number of marks have been classified as "activating" transcription including h <dig> lysine  <dig> tri-methyl  and h <dig> lysine  <dig> tri-methyl  and "repressing" transcription including h <dig> lysine  <dig> tri-methyl   <cit> . these modifications can be recognized by chromatin remodeling proteins , which render chromatin in either "open", transcriptionally permissive conformations or "closed", dna-inaccessible conformations, respectively  <cit> .

a simple question that emerges is: why does the cell require ~ <dig> or more modifications to maintain two  or a handful of chromatin states? the histone code hypothesis was developed to address this question. the histone code hypothesis "suggested that distinct functional consequences result from histone modifications and that a given outcome is encoded in the precise nature and pattern of marks"  <cit> . a challenge to the hypothesis has been the identification of multiple readers for a single modification, thereby confounding "a simple one-mark-to-one-module type of decoding"  <cit> . a framework that keeps the histone code hypothesis intact and addresses this criticism is the phenomenon of multivalency--the cooperative engagement of several linked substrates by a species with more than one discrete interacting surface  <cit> . in other words, chromatin regulatory proteins and their associated complexes write, read and erase multiple histone modifications simultaneously. it has been suggested that multivalency may be widespread in chromatin regulation. indeed, a number of recent studies are uncovering patterns of coexisting histone marks, extensive crosstalk among different modifications as well as multiple effector proteins on the same complex  <cit> .

using chip-chip and chip-seq, bivalent domains of h3k4me <dig> and h3k27me <dig> were observed at genes encoding developmentally important transcription factors in embryonic stem cells  <cit> . it is suggested that these genes are transcriptionally silent but poised for activation during development. indeed, in differentiated cells the vast majority of bivalent domains  resolved into either k4me <dig>  or k27me <dig> . consistent with the idea of widespread multivalency, it is notable that two "opposing" marks were assayed on a genomic scale and were found to occur in bivalent domains. it raises the question: if many more marks were mapped, would we find widespread multivalencies?

to help address these questions we applied two machine learning methods, stepwise multilinear regression and multivariate adaptive regression splines   <cit> , to genome-wide chip-seq maps of  <dig> histone lysine and arginine methylations and histone variant h2a.z in cd4+ t-cells  <cit> . we hypothesize that inclusion of two  and three  interacting cross-terms in the model can reveal  putative cross-regulation or multivalent relationships between histone modifications and  a global view of the epigenetic regulatory network. specifically, we first estimate the enrichment level of each modification using a new, model-based approach, which accounts for the characteristic spatial distribution of each modification across genes. with the enrichment levels as inputs and normalized log <dig> gene expression levels as output, we build the multilinear  model from a set of  <dig> single or monovalent inputs,  <dig> bivalent inputs and  <dig> trivalent inputs. for the mars model, the  <dig> monovalent amplitudes were supplied as input and the bi- and trivalent interacting terms were added as part of the model optimization procedure. using 10-fold cross validation and requiring terms to appear in  <dig> of  <dig> training models, our best ml model contained  <dig>   <dig> and  <dig> mono-, bi-and trivalent terms, respectively. using the generalized cross validation  score to protect against overfitting, we trained a mars model that had  <dig>   <dig> and  <dig> mono-, bi- and trivalent terms, respectively. we were able to identify a number of highly significant multivalent terms, suggesting that multivalency and cross talk among histone modifications may be widespread. however, we were surprised that both models predicted h4r3me2--shown to be repressive in a number of experimental studies  <cit> --to be among the most repressive histone methylations given that its chip-seq enrichment levels showed no response to increasing gene expression  <cit> .

methods
calculation of amplitudes
enrichment levels, or amplitudes, for each of the  <dig> histone modifications were estimated for each gene using a spatially weighted average of the mapped chip-seq tag counts . the gene list used in this study was compiled from the ncbi <dig> homo sapiens database . for each mark j, an average enrichment template, ti,j across the 5' flanking region , the body of a scaled gene , and the 3' flanking region , was first calculated as a function of relative genomic position i. for both the 5' flanking region and 3' flanking region, the coordinate i represents each nucleotide position relative to the transcription start and stop sites, respectively. within gene bodies , the coordinate i represents the position in the gene body, which is divided into  <dig> segments, or bins, which corresponds to the median gene length. for genes whose lengths are greater than  <dig> bp, tag counts were averaged across bases within each of the  <dig> bins. for genes whose lengths are less than  <dig> bp, tag counts were repeated in order to generate  <dig> bins. for genes not divisible by  <dig> or a divisor thereof, fractions of base pairs within a bin were rounded to the nearest integer value; therefore bins containing the majority of the fraction received the full tag count value of the corresponding base pair, while the bin containing the minority received no part of the bisected base pair's value. the median value was used for the bin number to minimize biases introduced in scaling. large bins would tend to over-smooth large genes, while small bins would tend to overrepresent copied values from small genes. the ti,j or template for mark j, was finally computed by  aligning the transcription start and stop sites of every scaled gene and then  calculating the average bin-averaged tag count across genes for every coordinate i. all templates were then normalized so that their average across bins was  <dig> . in other words, the template is the averaged and normalized enrichment profile across all scaled genes. because the template appears to have a characteristic shape for a given mark j across the length of scaled genes, we developed a model of relative enrichment which assumes the actual profile of any given mark is given by a product of a gene-dependent amplitude, , for a gene, k, and the mark's template ti,j. in other words, gene k's tag count profile for mark j across genomic coordinate i, , is well approximated by . using least squares, we minimized the difference between the model and the actual tag count profiles:   

to arrive at the following equation for mark j's amplitude at gene k:   

we note that in the special case where the template is constant as a function of genomic position/bin, i,  reduces to a simple average of tag counts across bins, , which is the appropriate estimate of tag "depth" for a mark whose tag distribution is uniform across a gene.

selection of transcription start and stop sites
many ensembl genes contain multiple start and stop sites. given that we only have 3' biased gene expression data, there are cases where we cannot unambiguously assign an affymetrix probe set to one transcription start or stop site which we need for our estimate of mark enrichment. consequently, we chose the transcription start sites that were associated with the highest number of significantly enriched histone modifications as representing the most likely expressed transcript. if a selected start site had multiple stop sites, we chose a stop site using the same scheme. in cases where multiple transcription start sites had the same number of significant marks, the most upstream transcription start site was chosen. when multiple stop sites for a given start site had the same number of significant marks a stop site was arbitrarily selected.

to determine the number of significantly enriched marks for a particular transcription start and stop site, we first calculated the distribution of mark amplitudes for all ensembl genes. the left tail relative to the mode of the distribution of amplitudes for a particular mark was used to build a gaussian null model as a background noise model for that mark. the mode of the amplitude distribution was used as the mean of the null model, and the standard deviation of the null model was derived using the following equation:   

where μj is the mode of the amplitude distribution and the sum is over genes k* whose amplitude is less than or equal to the mode  and n is the number of genes that satisfy this inequality. this null model was used to determine the p-value by calculating the integral of the gaussian from the mark amplitude to infinity for each mark at every ensembl gene  <cit> .

a benjamini-hochberg false discovery rate   <cit>  correction was applied to the p-values using the p.adjust function in r, and an fdr-corrected p-value cutoff of  <dig>  was used to determine significantly enriched amplitudes.

amplitude robustness and relative error metrics
to assess the fit of our template model to the data we calculate the coefficient of variation of the root mean square deviation cv for every gene, which is defined by:   

where n is the number of bins in the template, and all other variables follow previous definitions. in addition to the gene amplitude calculation with the 8138-bin  template, amplitudes were also calculated with  <dig>  and  <dig>   bin  templates. to assess the robustness of our amplitude estimates, we calculated the spearman correlation coefficient between the  <dig> k and  <dig> k bin amplitudes and the  <dig> k and  <dig> k bin amplitudes. we also calculated the fractional difference between the  <dig> k and  <dig> k bin amplitudes, , and the  <dig> k and  <dig> k bin amplitudes, which is similarly defined. finally, the cv was calculated for all marks for the  <dig> sets of amplitude calculations to assess effect of bin size selection on the template model fit.

building the multilinear model using stepwise linear regression
we built the multilinear model using a stepwise linear regression procedure , which models gene expression as a function of histone mark enrichment according to the following equation:   

where yk is the normalized log <dig> gene expression ; βj , βj,l , βj,l,m are mono-, bi- and trivalent histone modification fitting coefficients;  are mark j amplitudes for gene k and the εk are random errors. briefly, an initial model with randomly selected terms-defined as β coefficients multiplied by one, two or three mark amplitudes -- is fit. terms from the set that are not in the initial model and make a statistically significant contribution to the model  are added during a forward step. the forward step continues until no terms from the available pool of unused terms contribute significantly to the model. a backward step is then applied whereby terms are ranked in descending order according to their p-values and removed if they are not significant . the backward step ends when no terms in the model are insignificant. the forward and backward steps are repeated until no significant terms can be added or removed, respectively.

because stepwise linear regression is not guaranteed to converge to a globally optimal solution  for any given initial seed model, we performed multiple rounds of multiple stepwise regressions using different randomly seeded models. in the first round, we ran stepwisefit on the full data set  <dig> times using randomly seeded models. this resulted in  <dig> models with a mean of  <dig> terms. to assess the statistical significance of a given term's survival rate across the models, we randomly sampled  <dig> of the  <dig> possible terms to generate a null model. while a survival rate of  <dig>  was significant , to increase stringency we arbitrarily selected a cutoff of  <dig>  to arrive at  <dig> starting terms for the next round of stepwise linear regression.

to avoid the problem of overfitting and its inflation of model complexity, we applied stepwisefit to 10-fold cross validation data. specifically, for each of the  <dig> folds we performed  <dig> runs of stepwisefit where the initial model contained the  <dig> terms found in the first round plus an additional  <dig> randomly selected terms . using the test data, we applied only the backward step of the stepwise procedure to assess the significance of every term that survived the training step and removed those with p-values >  <dig> . among the  <dig> runs for each fold, the model with the lowest test mean square error  was selected. this resulted in  <dig> models for each fold. we then required a term to appear in  <dig> or more of the  <dig> models generated within each fold to be selected for the final model. this resulted in  <dig> terms.

we arrived at a robust estimate of the final set of  <dig> coefficients by fitting the training data to a model that contained only the  <dig> terms. this yielded  <dig> sets of  <dig> coefficients . we arrived at the final value of each fitting coefficient by calculating the trimmed mean of the  <dig> found in each fold. the final model's performance was assessed by calculating the mean mse and adjusted r <dig> across the  <dig> test and training data folds .

building the multivariate adaptive regression splines  model
the relationship between gene expression level and each mark's average enrichment tends to be nonlinear including saturation of gene expression response as a function of mark level. the "earth" package in r was used to build the mars model, which naturally accounts for non-linear responses between the input and output variables. briefly, a mars model is the sum of basis functions multiplied by a coefficient to be determined from a regression analysis of the function   

where yk is log <dig> gene expression of gene k , c <dig> is a constant,  is the subset of mark amplitudes that appear in term i, and bi is a basis function that is made up of either one or a product of two or more hinge functions. hinge functions are splines that take the form  or  where  is a special constant known as a knot. we note that the two hinge functions shown above are a symmetrical pair about the vertical line .

the mars model was built in one forward and one reverse pass. the forward pass builds the model using a greedy algorithm. it begins with an intercept term that is equivalent to the mean of the observed response variable, which is log <dig> gene expression level in our case. the algorithm then searches for the monovalent contributions fitted as a pair of symmetrical basis functions, which maximally reduce the residual sum-of-squares  at each step. it then adds bivalent terms, which are constrained to contain one of the monovalent terms and maximally reduce the rss at a given step until a minimum rss reduction is reached. it adds trivalent terms, which are constrained to contain one of the bivalent terms and maximally reduce the rss at a given step until a minimum rss reduction is reached. the reverse pass then prevents overfitting by removing terms to optimize a generalized cross validation  score. the gcv penalizes model complexity by dividing the rss by the effective number of degrees of freedom in the model   

where rss is the residual sum of squares, ng is the number of observations or genes with expression data in our case, t is the total number of terms in the model, p is a user defined penalty , and b is the total number of non-constant basis functions in the model.

RESULTS
analysis workflow
a diagram of our analysis workflow is shown in figure  <dig>  the inputs to our analysis are the read enrichment profiles across the human genome generated by barski et al.  <cit> . in figure two of their paper, they also calculated composite plots where they stratified gene expression by quartiles, aligned the transcription start sites  of all the genes and calculated the normalized read counts as a function of position relative to the tss. these plots reveal that  each mark has a relatively unique profile and  the shape of each mark's profile displays a relatively weak dependence on gene expression level. based on these observations, we modeled each modifications profile at every gene as a product of a gene dependent amplitude multiplied by a position dependent  average profile or template. from the read enrichment profiles, we calculated the average spatial distribution of each mark across the promoter region, the scaled gene and 3' of the transcription stop as detailed in the methods section. we then calculate all possible  <dig> bivalent products and all possible  <dig> trivalent products from the  <dig> single mark amplitudes. thus, we have  <dig> single modification states that are inputs to the mars model and a total of  <dig> possible modification states that are inputs to our multilinear model.

these amplitudes were calculated for  <dig>  ensembl genes  <cit> . because the gene expression data was 3' biased, we could not distinguish the expression levels of different isoforms, which included multiple tss. we selected the tss that had the largest number of significant modifications as detailed in the methods section. human cd4+ t-cell gene expression data which was used to generate the output of our models was collected from the genomics institute of the novartis research foundation's symatlas  <cit> --a compendium of gene expression data in human and mouse tissues. only genes that had ensembl, ucsc, and refseq ids were included in this study. of the  <dig>  genes that met these criteria,  <dig>  had expression data  <cit>  associated with them. because multiple affymetrix probes can interrogate a single gene, the total number of expression data points for the  <dig>  genes was  <dig> , which constituted the output of the multilinear and mars models.

estimating input amplitudes for regression models
two groups  <cit>  have estimated chip-seq histone modification/variant enrichment levels across genes in order to applying machine learning techniques--linear regression  <cit>  and bayesian networks  <cit> . they count tags only in a region surrounding the transcription start site . a major problem with this method is that many marks do not have promoter/5' end biased enrichment patterns. a striking example is h3k36me <dig>  which has increasing enrichment along the gene body, which peaks near the 3' end of genes  <cit> . yu et al.  <cit>  calculate correlation coefficients between their 5' end biased mark enrichment estimates and gene expression levels and find little to no correlation between h3k36me <dig> and gene expression. this is an unexpected result as h3k36me <dig> has been characterized as an activating mark in a number of biochemical studies  <cit> , and its levels have been shown to have a strong positive correlation with gene expression  <cit> . this discrepancy is likely due to the 5' bias of their amplitude estimation method. to address this problem, we estimated the effective enrichment levels of each mark by calculating a weighted average across the whole gene and its flanking region as described in the methods section. we use the average enrichment pattern across the flanking regions and body of scaled genes as an estimate of the weighting function. however, given the large variation in gene lengths, exon/intron number, and mark deposition patterns, we assessed the robustness and relative error of our amplitude estimation procedure.

robustness and relative error of mark amplitude estimates
our amplitude estimation procedure is motivated by the observation that a number of histone methylations  are pervasive across the body of genes and their enrichment patterns appear to scale with gene length. however, methyl groups are physically attached to histones whose octamer wraps  <dig> bp of dna . thus, our  gene-scaling procedures average different numbers of nucleosomes depending on the gene length and selected bin size. consequently, we assessed the robustness of our amplitude estimation procedure by recalculating our template and amplitude using  <dig>  and  <dig>   bins and compared them to those calculated using  <dig>  bins.

we first generated scatter plots of the  <dig> k versus  <dig> k and  <dig> k versus  <dig> k amplitude estimates  and calculated their associated spearman correlation coefficients  for all  <dig> histone modifications/variants. we found the values to be highly correlated with correlation coefficients ranging from  <dig> - <dig>  and  <dig> - <dig>  across marks for the comparisons of  <dig> k bins to  <dig> k and  <dig> k, respectively. we also calculated the fractional difference  between  <dig> k and  <dig> k and  <dig> k and  <dig> k amplitude estimates. these values were summarized across genes by calculating the 0th, 25th, 50th, 75th and 100th percentile values for each mark . the absolute value of typical  fractional differences range from  <dig> - <dig>  and  <dig> - <dig>  for the comparisons of  <dig> k to  <dig> k and  <dig> k, respectively. indeed, the worst absolute values were  <dig>  and  <dig>  for  <dig> k versus  <dig> k and  <dig> k, respectively. thus, our estimates of mark enrichment amplitudes are relatively robust with respect to bin size. given these results, it's not surprising that our model results and main conclusions do not depend on bin size as discussed below.

an advantage of a model-based approach to estimating enrichment levels is that we can directly assess model performance by calculating residuals . thus, for each mark, we calculated the root mean square deviation  between the model and the data divided by the amplitude  defined in methods section) for every gene, which is a measure of the relative error. in a plot of cv versus amplitude for every mark we find a near universal curve . this results in part because our normalization of each mark's template  allows us to interpret the mark amplitude as a model-based estimate of each mark's effective read density, or read coverage. as might be expected, below amplitude values of  <dig>  the error grows rapidly. for relatively large amplitudes , the cv asymptotically reach values slightly below  <dig>  in contrast, marks whose largest amplitudes fall well below  <dig> and consequently don't achieve their large amplitude asymptotic value have cv values that range from  <dig> - <dig> at the largest amplitudes encountered . for most marks, the 95th amplitude percentile is below  <dig>  indicating from our crude gene-centric measure of coverage/read density that the effective sequencing coverage might be low . we also see a steady trend upward in the cv--calculated in the neighborhood of the 95th amplitude percentile --with decreasing 95th percentile amplitude levels . taken together, these results indicate that rmsd between the model and the data are on the same order as the amplitude. we also note that we find essentially the same cv values for  <dig> k and  <dig> k bins. we are currently working on improving estimates of mark enrichment levels from chip-seq data and distinguishing the extent to which this modest to high variability is due to intrinsic noise or systematic biases introduced by our model assumptions, including how we scale genes. nevertheless, we find our weighted average estimate is relatively robust and should capture enrichment level trends in histone modification/variant chip-seq data reasonably well.

multilinear model
we fit the gene expression data to the multilinear  model shown in equation . as described in the methods section, we used stepwise linear regression to build the ml model. there were  <dig>   <dig> and  <dig> possible terms in the first, second and third sum of equation , respectively. the final model contained  <dig> terms. the average training and testing mse was  <dig>  and  <dig>  respectively for this model. the average adjusted r <dig> for the training and testing data is  <dig>  and  <dig> , respectively. the fact that the train and test values are close suggests that the model was not over trained. using all the data, we calculated an adjusted r <dig> of  <dig>  and mse value of  <dig> . crudely, this suggests that our model explains almost 50% of the gene expression variation after adjusting for the number of degrees of freedom. in figure 2a, we show a scatter plot of the actual versus the model log <dig> gene expression levels whose associated pearson correlation coefficient was  <dig>  . this value is consistent with that of karlic et al.  <cit>  who modeled gene expression as a function of  <dig> histone methylation and acetylation modifications and h2a.z using a linear model with no interaction  terms. given the absence of many other mrna regulatory factors including other histone modifications, transcription factors, and mirnas, a relatively significant percentage of the variation is explained by this model and the karlic et al. model  <cit> .

finally,  <dig> of the  <dig>  single terms were found to be significant in the model. in addition, there were  <dig>  significant paired terms and  <dig>  significant triplet terms. the terms appearing in the full model are displayed in table  <dig> where we show each surviving term's β coefficient, the β coefficient's z-score , the term's p-value and a robust impact factor. the robust impact factor is defined as the product of the fitting coefficient  and the inter-quartile range  of the mark amplitudes. it is a robust measure of a term's impact on gene expression while the z-score and p-value are measures of its significance. a positive  β coefficient, z-score and impact factor indicate an activating  term in the model. the table is sorted by impact factor with activating and repressive marks labeled with an "a" and "r" superscript, respectively. we labeled the marks according to  the sign of their monovalent term in the ml model or  the response of the mark's levels with increasing gene expression when it did not contribute a monovalent term .

terms appearing in the final multilinear model, and associated statistics. trim mean of the β coefficients, z-scores and impact factors . trim mean is defined as the mean of the population excluding the lowest and highest 5% of the data. the superscript labels each mark as activating  or repressive . unstarred marks correspond to monovalent terms in the model, starred marks do not have a monovalent contribution in the model, but correlated/anti-correlated with gene expression based on univariate analysis, and uncolored marks do not have clear correlation with gene expression. rows are sorted by the impact term value.

multilinear model terms
of the  <dig> monovalent terms , h3k4me <dig>  h3k36me <dig>  h3k79me <dig>  h3k79me <dig> and h4k20me <dig> were activating. of these, only h3k4me <dig>  h3k36me <dig> and h4k20me <dig> display a clear overall activating trend from composite plots  <cit> . based on their composite plot analysis, barski et al. conclude that h3k79me <dig> level alone shows no overall trend with gene expression while it makes the highest impact activating contribution in our ml model. this is consistent with a recent finding that h3k4me <dig> and h3k79me <dig> are the most predictive of gene expression levels in low cpg content promoters  <cit> . barski et al. also find that h3k79me <dig> is enriched in active gene promoters, and in the body of silent genes. two arginine methylations, h4r3me <dig> and h3r2me <dig>  were the only repressive monovalent marks in the model. in contrast, barski et al.  <cit>  find no overall activating or repressing trend for these two methylations from their composite plot analysis. marks that showed an activating trend from composite plots  <cit>  but did not appear as monovalent terms in our ml model included h3k4me <dig> , h3k9me <dig> and h2bk5me <dig>  marks that showed a repressive trend from composite plots but were absent at the monovalent level in our ml model were h3k27me <dig> , and h3k9me <dig> . h3k27me <dig> and the variant h2a.z did not appear as monovalent terms in the ml model and displayed complex, non-monotonic enrichments as a function of increasing expression from their composite plots. finally, marks that neither appeared at the monovalent level in the ml model nor showed any trend with respect to gene expression level were h3k79me <dig>  h3r2me <dig> and h4k20me <dig> 

while the majority of monovalent terms are activating, the majority of multivalent terms,  <dig> of  <dig>  are repressive. half of the  <dig> multivalent terms involve a mix of activating and repressing modifications according to either the sign of their monovalent term in the ml model or composite plot trends. this is interesting given the discovery of bivalent domains of h3k4me <dig> and h3k27me <dig>  indeed, two of the three highest impact and most significant repressive terms are bivalent. they both include h3k27me <dig> together with h3k79me <dig> and h3k36me <dig> respectively. the highest impact activating multivalent term is also bivalent and composed of an activating mark, h3k4me <dig>  and a repressive mark, h3r2me <dig>  thus, at the bivalent level, the linear model terms suggest that there is significant overlap between opposing marks  and that one of them tends to "override" the other, similar to the observation that h3k27me <dig> overrides h3k4me <dig> in es cells  <cit> .

to further investigate the extent to which bivalent terms in the linear model point to the ability of one mark to override or oppose another overlapping mark, we generated heat maps, shown in figure  <dig>  of gene expression levels as a function of bivalent amplitudes  and one of the monovalent amplitudes . we discretize the amplitudes into a  <dig>  square grid  and calculate the average gene expression level within every box. the colors red, yellow, green, cyan, blue and magenta represent equidistant increasing gene expression values from the minimum to the maximum levels. as illustrated in figure 3a, points along lines emanating from the origin moving outward represent increasing h3k27me <dig>  and constant h3k36me <dig>  with higher slopes corresponding to a higher level of fixed h3k36me <dig> amplitude. conversely, points moving upward along vertical lines correspond to fixed h3k27me <dig> and increasing h3k36me <dig>  with increasing position of the vertical line on the x-axis corresponding to higher level of fixed h3k27me <dig> amplitudes. this allows us to visualize a given modification's impact on transcription and how its regulation of transcription is continuously altered by the increasing co-occurrence of a second modification.

we find increasing h3k27me <dig> corresponds to decreasing expression as expected; we also find increasing expression with fixed h3k27me <dig> and increasing h3k36me <dig> . however, for relative h3k27me <dig> amplitudes exceeding  <dig> , gene expression remains at low levels independent of h3k36me <dig> levels. this suggests that high levels of h3k27me <dig> are capable of overriding the gene activating potential of h3k36me <dig> 

ml models have been applied in physical and statistical studies where a common outcome-- theoretically expected in many cases--is that the single terms dominate the model in both their relative impact and statistical significance. in these systems, the double, triple, quadruple product terms tend to make small, diminishing  corrections to the single terms. as shown in table  <dig>  we find the expected trend with the highest impact and most significant activating terms all monovalent. the two most significant repressive terms are also monovalent: h3r2me <dig>  and h4r3me <dig>  however, we note that size of the impact of the highest impact bivalent terms is relatively large.

mars model
normalized log <dig> gene expression was modeled as a function of histone modification enrichment using the nonlinear multivariate adaptive regression splines  method. the model was built with the earth package in r http://cran.r-project.org/web/packages/earth/index.html as described in the methods section.

the mars model contained  <dig> terms:  <dig> basis functions, and a constant. the mse and r <dig> for this model are  <dig>  and  <dig> , respectively. figure 2b shows a scatter plot of the actual versus the mars-predicted log <dig> gene expression levels, whose associated pearson correlation coefficient is  <dig> . there were a total of  <dig> monovalent terms, with  <dig> unique single marks;  <dig> bivalent terms, with  <dig> unique pairs; and  <dig> trivalent terms, with  <dig> unique triplets. table  <dig> displays each term's hinge functions, the term's fitting coefficient and the number of probe sets impacted by each term. the basis functions can often have a value of zero for a wide range of amplitudes; for these probe-sets, the basis function has no impact. thus, the number of impacted probe-sets is a measure of the global impact of each term. we also directly assess the impact of each term on gene expression as discussed below.

coefficients and hinge functions within a row are multiplied and added to the products of other rows to form the mars model. the rightmost column indicates the number of genes for which the hinge function takes a non-zero value. terms appear in the order in which they were built into the model by the greedy algorithm.

mars model terms
of the  <dig> unique monovalent marks in the mars model,  <dig> are activating, including h3k36me <dig>  h3k79me <dig> and h4k20me <dig>  these results are in agreement with the ml model and the barski et al. data; although as previously mentioned, h3k79me <dig> is a complicated mark, which is enriched in the promoters of active genes and the bodies of repressed genes. h3k27me <dig> has a repressive trend in the model, which agrees with barski et al. h4r3me <dig> appears to have no discernible behavior in the barski et al. data; however, both the mars and ml models select it as a repressive monovalent mark.

the mars model also shows nonlinear trends in log <dig> gene expression as a function of mark amplitude. figure  <dig> shows plots of predicted log <dig> gene expression as a function of one or two mark amplitudes with all others fixed to their median value. these plots reveal whether a mark is activating or repressive. not surprisingly, the dominant non-linear trend is saturation of predicted gene expression with increasing mark amplitude. this trend is clearly evident in both monovalent and bivalent plots shown in figure  <dig> 

to determine the global  impact of individual marks appearing in the model, predictions were made with high enrichments  and low enrichments  of a given mark while fixing all other mark amplitudes at their median value. the difference of these predictions  provides an estimate of each individual mark's impact, where positive  values correspond to activating  activity. this analysis shows general agreement with barski et al. however, h2bk5me <dig>  which does not appear as a monovalent term in the model, is activating in the barski et al. analysis and repressive in the mars model. several marks that showed no activating or repressive trend in the barski et al. analysis made significant contributions to the mars model including, h3k79me <dig> , h4r3me <dig> , and h4k20me <dig> . h4k20me <dig> is generally associated with heterochromatin  <cit> , possibly explaining why it has a slightly repressive trend in the mars model. interestingly, h4r3me <dig> has the second highest repressive impact, - <dig> , and affects 100% of the probe-sets--the most of any term in the mars model. it has been shown that dna methylation, which is associated with gene silencing, is dependent on h4r3me <dig>  <cit> .

the difference in mean predicted gene expression between the high  and low  amplitude values for a given mark while fixing all other mark amplitudes to their median values. rows are sorted by predicted impact.

based on the response plots , most marks appearing in a bivalent term seem to modulate each other modestly, with the exception of h4k20me1-h3k36me <dig>  which shows complex synergistic, nonlinear behavior. synergies were assessed by making model predictions while varying each of the unique interaction terms in the model. a model prediction was made with every combination of high enrichment  and low enrichment  for each element of a multivalent pair or triplet, while all other marks were held at their median values . the h4k20me1-h3k36me <dig> combination is an example of a strong synergistic, activating bivalent pair, where high levels of both correspond to highly active genes. the trivalent combination, h3k36me3-h3k79me1-h4k20me <dig>  also shows strong synergistic activation, further suggesting that co-occupancy of h4k20me <dig> and h3k36me <dig> positively contributes to gene expression. furthermore, this pair affects a large number of probe-sets, approximately 80% of those included in the model.

the mean predicted gene expression using high  and low  amplitude values of each mark described in the leftmost column. the permutations of high and low values in each column correspond to the mark order in the leftmost column. the rows are sorted by the values in the last column.

the mean predicted gene expression using high  and low  amplitude values of each mark described in the leftmost column. the permutations of high and low values in each column correspond to the mark order in the leftmost column. the rows are sorted by the values in the last column.

we also find one bivalent and trivalent combination composed of activating and repressive marks, h3k36me3-h4r3me <dig> and h3k27me2-h3k27me3-h4k20me <dig>  as shown in tables  <dig> and  <dig>  we find that increasing each mark's level independently results in the expected activating or repressive response. high levels of the activating and repressive marks result in a moderating effect on predicted gene expression with values falling between those of high activating-low repressive and low activating-high repressive mark amplitudes. this reinforces the results of the ml model where we found the tendency of one mark to override or oppose another overlapping mark.

model comparison
like the ml model, the mars model explains about half of the variation in gene expression. moreover, the ml and mars model predicted gene expression profiles are highly correlated . however, the pearson correlation coefficient between predicted and actual log <dig> gene expression is slighter better for the mars model. this is impressive given that both models contain the same number of terms,  <dig>  and the mars model was built using one round of a greedy algorithm while the ml model was built by selecting the best model from multiple rounds of a stepwise algorithm. we note that the stepwise algorithm is a more powerful and computationally expensive optimization procedure. these observations suggest that methods like mars that are capable of modeling the nonlinear relationship between histone modification and gene expression levels should outperform models that assume this relationship is linear. moreover, many of the bi- and trivalent terms in the ml model may not have a biological origin but are compensating for the nonlinearities in the data. specifically, as shown in table  <dig>  the ml model contains two bivalent terms  containing activating marks with a negative  fitting coefficient, one bivalent term composed on two repressive marks  with a positive  fitting coefficient, and a trivalent term composed of activating marks  with a negative  fitting coefficient. these terms have no known biological origin and are more likely artifacts of imposing a linear model on data, which is inherently nonlinear.

both regression methods produced a model with  <dig> terms. however, there are only  <dig> common terms between the models, all of which are monovalent terms: h4r3me <dig>  h3k79me <dig>  h4k20me <dig> and h3k36me <dig>  both models agree that of these marks h4r3me <dig> is the only repressive mark, while the others are activating. considering the linear model contains  <dig> monovalent terms out of a possible  <dig>  and the mars model contains  <dig>  the degree of overlap in the monovalent terms is quite high.

no overlapping multivalent terms existed between the two models. the differences between the multivalent components of each model could be the result of the way the models were built. since the space of possible terms increases rapidly with valency, and the search space over which the ml model converges on a final model is much larger than that of the mars model, the potential for model overlap becomes less likely as valency increases. in this way the mars model--built using a greedy algorithm--is constrained in the number of multivalent terms it can potentially include.

in silico knockout analysis
in order to generate experimentally testable predictions, a knockout analysis of the ml and mars models was performed to assess the effect of removing a specific modification on gene expression. predictions of gene expression were made with each model by setting the amplitude of a single mark to zero in the model and holding all others at their experimental values. this process was repeated for all marks in each model to determine the global effect of each histone modification. all pairwise combinations of marks were also knocked out for each model.

tables  <dig> and  <dig> show the single and pairwise knockouts that have the highest impact on global gene expression in the ml and mars models, respectively, where knockouts are represented as log <dig> fold changes of wild type over knockout predictions; positive values indicate activating marks, and negative values indicate repressive marks. both sets of knockouts identify h3k36me <dig> and h4k20me <dig> to be among the strongest global activating marks, and h4r3me <dig> and h3k27me <dig> to be among the strongest global repressive marks. they also indicate that combinations of h3k <dig> methylations, h3k36me <dig> and h4k20me <dig> are among the strongest pairwise global activating marks, while combinations of h3k <dig> methylations and h4r3me <dig> are among the strongest pairwise global repressive marks. figure  <dig> shows box plots of the log <dig> fold changes for each single knockout of the ml and mars models. the general trend of knockouts in both models is similar; however, the mars model includes fewer marks, and thus many of the knockouts  have no effect. most of the marks absent from the mars model have a very modest knockout effect  in the ml model with the exceptions of h3r2me <dig> and h3k4me <dig>  we note that the results of the knockout analysis are also robust with respect to bin size .

the log <dig> fold change  in average gene expression for single and double knockouts in the multilinear model. in silico knockouts were performed by setting mark amplitudes to zero while fixing all other marks at their experimental values and making model predictions for each gene. the top  <dig> most repressive and activating fold changes for single and double knockouts are shown. rows are sorted according to log <dig> fold change for single and double knockouts separately.

the log <dig> fold changes  in average gene expression for single and double knockouts in the mars model. in silico knockouts were performed by setting mark amplitudes to zero while fixing all other marks at their experimental values and making model predictions for each gene. the top  <dig> most repressive and  <dig> activating fold changes for single as well as the top  <dig> most repressive and activating double knockouts are shown. rows are sorted according to log <dig> fold change for single and double knockouts separately.

h4r3me <dig> is globally repressive in ml and mars models
strikingly, h4r3me <dig> was the most globally repressive mark in the ml model according to the knockout analysis, with an average predicted fold change  in gene expression of  <dig> . it was also the second most repressive mark in the mars model knockout analysis, with an average fold change of  <dig> . this was a highly unexpected result for h4r3me <dig> given the unresponsiveness of its chip-seq enrichment levels to increasing gene expression  <cit> . indeed, we used the data generated by barski et al. but came to diametrically opposed conclusions regarding h4r3me2's influence on gene expression. moreover, this conclusion is not altered by the selection of bin size, as h4r3me <dig> is the most highly repressive mark in the  <dig> k bin-based mars model, and second most repressive in the  <dig> k and  <dig> k bin-based mars models .

in order to make sense of the apparently contradictory behavior of h4r3me <dig>  we first note that we performed two analyses that differed from the barski et al.  <cit>  analysis:  estimated mark amplitudes using a model based weighted average and  modeled gene expression using all histone methylation amplitudes as input to the ml and mars models. a trivial explanation would be that our amplitude estimation procedure now yields a response of h4r3me <dig> levels to gene expression, which is then reflected in the ml and mars fitting coefficients. we directly tested this by generating boxplots of our mark amplitudes stratified by quartiles of gene expression shown in additional file 9: supplemental figure s <dig>  consistent with barski's  <cit>  composite plots, we observe little to no response of h4r3me <dig> amplitudes with increasing gene expression. for comparison, we generate the same boxplots for h3k27me <dig> and observe a dramatic decrease in its amplitude with increasing gene expression level as expected. thus, we can rule out the mark amplitude estimation procedure as an explanation. we are left with the interesting result that h4r3me2's repression of gene expression is revealed by analyses such as mars and ml modeling which account for the simultaneous impact of the other histone methylations. in other words, the impact of any given histone methylation on gene expression is analyzed in the context of  <dig> other activating and repressive modifications.

in order to better understand h4r3me2's affect on gene expression, we performed a comparative analysis with h3k27me <dig>  which is highly repressive in the ml and mars model knockout analysis as well as the barski et al. composite plot analysis. specifically, we divided the ml model log <dig> fold changes of wild type over h4r3me <dig> and h3k27me <dig> knockouts by quintiles and calculated boxplots of predicted gene expression in the wt and ko cases as shown in additional file10: supplemental figures s5a and s5b, respectively. the first 20% of the data  represents the genes most up regulated by knocking out the mark . the last 20% of the data  represents the genes least up regulated by knocking out h4r3me <dig> and genes down regulated by knocking out h3k27me <dig>  the trends in wt and ko gene expression across the stratified data are opposite for h4r3me <dig> and k3k27me <dig>  for h4r3me <dig>  the median log <dig> gene expression in the wt is relatively low,  <dig>  in qu <dig> and increases slightly to  <dig>  in qu <dig> with the knockout showing a similar trend . in contrast, the h3k27me <dig> wt median starts out considerably higher in qu <dig>   <dig> , and plummets 8-fold to  <dig>  in qu <dig> with the knockout again showing a similar trend . thus, h3r3me <dig> tends to be consistently acting on relatively low expressed genes, and its removal is predicted to increase their expression ~ <dig> -fold on average. h3k27me <dig>  on the other hand, has the highest impact, from our knockout analysis, on middle to high expressed genes and the least on silenced genes.

we also calculated the proportion of significantly enriched marks  found in quintile-stratified log <dig> fold change data as shown in figure 6a-f. interestingly, the profiles of mark site proportions across the stratified log <dig> fold change clustered into activating marks , arginine methylations  and repressive marks . as expected, we find that the proportion of h4r3me <dig> sites is highest in the highest impact knockout log <dig> fold change group  and monotonically decreases across subsequent groups . the activating marks site profiles  tend to be relatively low and flat or mildly increasing with decreasing log <dig> fold change. the repressive mark site profiles tends to start low, rise and then fall with decreasing log <dig> fold change . thus, arginine methylation itself appears to drive the impact of h4r3me <dig> knockout on gene expression. in stark contrast, the proportion of h3k27me <dig> and other repressive mark sites increase monotonically with decreasing impact of the h3k27me <dig> knockout on gene expression  with the activating marks showing the exact opposite trend . again the arginine methylation proportion of sites cluster together and show a distinct profile falling and then rising with decreasing log <dig> fold change . interestingly, we find the largest impact of knocking out h3k27me <dig> tends to be in genes where h3k27me <dig> levels are relatively low and activating mark levels are relatively high. for these genes, h3k27me <dig> appears to be modulating or reducing gene expression from high to moderate levels .

taken together these analyses suggest that in contrast to well-characterized repressive modifications including h3k <dig> and h3k <dig> methylation whose levels tend to be strongly anti-correlated to activating modification levels , h4r3me <dig> and the other arginine methylations tend to be somewhat uncorrelated to both. consequently, its absence at genes does not imply the presence of activating marks and high levels of expression . conversely, high levels of h4r3me <dig> can coincide with modest to relatively high levels of activating marks like h3k36me <dig>  which tend to override h4r3me <dig> . thus, its levels show no strong trend with increasing overall gene expression as barski et al. found. instead, dimethylation of h4r <dig> consistently tends to further repress low to modestly expressed genes nearly 2-fold on average, leading to relatively strong predicted de-repression in the ml and mars models when knocked out.

experimental studies demonstrate h4r3me <dig> represses gene expression
barski et al.  <cit>  report that they used the antibody that recognizes symmetric dimethylated h4r <dig> , which is deposited by the arginine methyltransferase prmt <dig>  a number of experimental studies have shown that prmt <dig> and h4r3me <dig> s repress gene expression  <cit> . in an experiment that is a direct analogue of our knockout analysis, silencing of prmt <dig> in mouse cell lines resulted in more de-repressed than repressed genes in a microarray analysis  <cit> , supporting our result that h4r3me <dig> s is globally repressive. prmt <dig> is a member of the multi-subunit msin3a and nurd histone deacetylase complexes  <cit> , suggesting h4r3me <dig> is associated with deacetylation and hence gene inactivation  <cit> . interestingly, both the msin3a-prmt <dig> containing complex and recombinant prmt <dig> methylate h4r <dig> and show an in vitro preference for methylating hypo-versus hyperacetylated histone h4r <dig>  <cit> . prmt <dig> was also shown to interact with the mbd2/nurd complex and that prmt <dig> and mbd <dig> are recruited to cpg islands in a methylation-dependent manner with h4r <dig> methylated at these loci  <cit> . these results are consistent with our finding that h4r3me <dig> tends to further repress modest to low expressed genes, which are likely hypoacetylated, contain methylated cpg islands in their promoter regions or both.

in a recent study, h4r3me <dig> s was shown to be required for subsequent dna methylation  <cit> --a repressor of gene expression. indeed, h4r3me <dig> s was shown to be a direct binding target of the dna methyltransferase dnmt3a  <cit> . loss of h3r3me <dig> s through shrna knockdown of prmt <dig> resulted in reduced dnmt3a binding, loss of dna methylation and six-fold induction of the fetal  globin gene  <cit> .

CONCLUSIONS
current genomic strategies for assessing whether a particular histone modification is activating or repressive involve  mapping it to the genome using chip-chip or chip-seq and either  comparing boxplots of gene expression of genes with and without the mark  <cit>  or  generating composite plots of average mark levels of genes stratified by gene expression level as in the barski et al.  <cit>  analysis. using this approach, barski et al. concluded that h4r3me <dig> is neither activating nor repressive because its levels showed no response with increasing gene expression level. using the barski et al. chip-seq data of  <dig> histone lysine and arginine methylations and histone variant h2a.z in cd4+ t-cells, we built models of gene expression as a function of histone modification/variant levels using multilinear  regression and multivariate adaptive regression splines . the response of monovalent  terms in the ml and mars model indicate whether a given modification is activating or repressive. for most of the  <dig> histone methylations, our assignments agree with that of barski et al. however, according to our in-silico equivalent of knocking out modifications, h4r3me <dig> is predicted to be the most and second most globally repressive histone methylation among the  <dig> studied in the ml and mars models, respectively. a number of experimental studies show that prmt5-catalyzed symmetric dimethylation of h4r <dig> is associated with repression of gene expression  <cit> . this includes a recent study, which demonstrated that h4r3me <dig> is required for dnmt3a-mediated dna methylation  <cit> --a known global repressor of gene expression. consequently, our study serves as the first demonstration that h4r3me <dig> represses gene expression using genomic data and shows that the regulatory role of some modifications like h4r3me <dig> can only be revealed by approaches that simultaneously analyze multiple activating and repressive modifications. our findings point to a disconnect between traditional biochemical  and genomic approaches in assessing the activating or repressive potential of an individual modification. indeed, assuming the biochemical studies were correct and h4r3me <dig> is repressive, one would conclude from the barski et al.  <cit>  analysis that the antibody they used for h4r3me <dig> did not work. our results suggest that it worked extremely well. taken together, our findings have broad implications for chip-seq experimental design, analysis and interpretation and suggest an important role for retaining network level information in the analysis of chip-seq data.

abbreviations
mars: multivariate adaptive regression splines; mlm: multilinear model; ml: multilinear.

authors' contributions
xx calculated the amplitudes, carried out the multilinear model analysis and helped draft the manuscript. sh carried out the mars model analysis and helped draft the manuscript. mwm participated in study design and helped to draft the manuscript. sb conceived of the study, guided the analysis and drafted the manuscript. all authors read and approved the final manuscript.

supplementary material
additional file 1
figure s <dig>  box plots of enrichment amplitudes. box plots of estimated enrichment amplitudes for each of the  <dig> histone modifications.

click here for file

 additional file 2
table s <dig>  range of mark amplitudes. the minimum, 5th, 25th, 50th, 75th, 95th percentiles, and maximum amplitude values for each mark.

click here for file

 additional file 3
figure s <dig>  scatter plots of amplitude estimates. scatter plots between amplitudes calculated using different numbers of bins within scaled genes. comparisons of the  <dig>  bin versus  <dig>  bin amplitudes are shown in -, and  <dig>  bin versus  <dig>  bin comparisons are shown in -. four selected marks are shown: h3k27me <dig> in  and , h4r3me <dig> in  and , h3k4me <dig> in  and , and h3k36me <dig> in  and . the corresponding spearman correlation coefficient  is shown within each plot.

click here for file

 additional file 4
table s <dig>  amplitude estimation robustness,  <dig> k vs  <dig> k template. for every mark, the spearman correlation coefficients and 0th, 25th, 50th, 75th, and 100th percentile fractional differences between amplitudes calculated with the  <dig> k bin and  <dig> k  bin templates.

click here for file

 additional file 5
table s <dig>  amplitude estimation robustness  <dig> k vs  <dig> k. for every mark, the spearman correlation coefficients and 0th, 25th, 50th, 75th, and 100th percentile fractional differences between amplitudes calculated with the  <dig> k bin and  <dig> k  bin templates.

click here for file

 additional file 6
figure s <dig> relative error of mark enrichment models. cv versus amplitude. colors represent different marks as shown in the legend. low amplitudes correspond to low levels/coverage, and thus high cv values. as amplitude increases, values reach an asymptotic value.

click here for file

 additional file 7
table s <dig>  relative error of mark enrichment models. for every mark, the large amplitude cv values--mean cv of  <dig> - <dig>  percentile amplitude genes--calculated using  <dig>   <dig> and  <dig>  bin templates along with the corresponding 95th percentile amplitudes. rows are sorted by the  <dig> bin 95th percentile amplitudes.

click here for file

 additional file 8
table s <dig>  mars knockout robustness. two additional mars models were built with amplitude estimations using  <dig> and  <dig>  bins for the scaled gene. the table shows a comparison of knockout analyses performed for each model, with the results sorted by log <dig> fold changes calculated from the 8138-bin model. overall, the results are quite robust, showing the same trend in nearly every mark. furthermore, h4r3me <dig> appears as the most or second most repressive mark in each model.

click here for file

 additional file 9
figure s <dig>  box plots of amplitudes across expression. box plots of h4r3me <dig>  and h3k27me <dig>  amplitudes across the data stratified by quartiles of gene expression, where q <dig> and q <dig> represent the lowest and highest gene expression groups, respectively.

click here for file

 additional file 10
figure s <dig>  box plots of predicted gene expression before and after knockout. box plots of predicted gene expression before and after knockout of  h4r3me <dig> and  h3k27me <dig>  plots are stratified along the x-axes by quintiles of log <dig> fold change  in gene expression predicted by the mlm.

click here for file

 acknowledgements
this work was supported in part by the national institutes of health grant ca <dig> from the national cancer institute . sh was supported by the university of virginia cancer training grant from the nci . we would like to thank swati jain for contributing helpful ideas and generating the first multilinear models as part of a class assignment. we would also like to thank two anonymous reviewers for significantly strengthening the manuscript, especially regarding assessment of our amplitude estimation procedure and wording of the text.
