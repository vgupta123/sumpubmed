BACKGROUND
while molecular characterization provides average genome-wide profiling for each biopsy, it fails to reveal inherent heterogeneity that is only visible through tissue histology. molecular characterization has the advantage of a standardized array-based measurement compared to the genome and other well curated databases. on the other hand, histology sections do not provide standardized measurements, yet they are rich in content and continue to be the gold standard for the assessment of tissue neoplasm. because of inter- and intra- observer variations  <cit>  and the absence of quantitative representation, some studies have leveraged genome-wide analysis for improved markers for predicting biological behavior. if hematoxylin and eosin  stained tissue sections can be characterized in terms of cell type , tumor type, and histopathological descriptors , then a richer description can be linked with genomic information for an improved basis for diagnostic and therapy. this is the main value of histological imaging since it captures detailed morphometric features on a cell-by-cell basis and their organization. we have tested our system on glioblastoma multiforme , one of the most common and the least curable brain cancer, with glioma cells infiltrating the surrounding tissue with a median survival rate of  <dig>  month  <cit> . figure  <dig> shows that the tissue section has a rich spatial composition , which is lost through bulk genome-wide array analysis . our goal is to identify morphometric subtypes, based on nuclear structure and organization, from a very large sample size. first, we provide a brief review of the current state of art and then proceed with the details of our computational strategy. present techniques for morphometric analysis have focused on several different aspects of tissue characterization, and they are summarized below along with a review of the nuclear segmentation from the h&e sections.

brief review of analysis of h&e images
a comprehensive review of techniques for the analysis of the h&e sections is beyond the scope of this paper. however, a brief review can be found in  <cit> . from our perspective, three key concepts have been introduced to establish the trend and direction of the research community:  one group of researchers have focused on tumor grading through either accurate or rough nuclear segmentation  <cit>  followed by computing cellular organization  <cit>  and classification. in some cases, tumor grading has been associated with recurrence, progression, and invasion carcinoma   <cit> , but such an association is highly dependent on tumor heterogeneity and mixed grading , which offers significant challenge to the pathologists as mixed grading appears to be present in 50% of patients  <cit> . a recent study indicates that detailed segmentation and multivariate representation of nuclear features from h&e stained sections can predict dcis recurrence  <cit>  in patients with more than one nuclear grade. in this study, nuclei in the h&e stained samples were manually segmented and a multidimensional representation was computed for differential analysis between the cohorts. the significance of this particular study is that it has been repeated with the same quantitative outcome. in other related studies, image analysis of nuclear features has been found to provide quantitative information that can contribute to diagnosis and prognosis values for carcinoma of the breast  <cit> , prostate  <cit> , and colorectal mucosa  <cit> .  the second group of researchers have focused on patch-based  analysis of tissue sections through means of supervised classification. these methods operate by representing each patch with color and texture features  <cit>  for training either a kernel or regression tree classifiers. a recent study evaluated and compared emerging techniques of sparse coding with kernel based methods  on a gbm dataset to conclude that the kernel based method did equally as well, if not better, than sparse coding. alternatively, some researchers have investigated how architectural features of tumor grades correlate with fractal dimensions  <cit> . fractal dimensions differ from topological dimensions and has been shown to have the potential to elucidate irregularities by assigning a gross scalar value for discriminating benign and malignant breast cells from fine needle aspiration  <cit> .  a third group of researchers have suggested utilizing the detection of lymphocytes as a prognostic tool for breast cancer  <cit> . lymphocytes are part of the adaptive immune response and their presence has been correlated with nodal metastasis and her2-positive breast cancer, ovarian  <cit> , and gbm. these cells often respond in larger quantity, and they can be easily detected because of their constant size  and high chromatin content.

brief review of methods for nuclear segmentation
complexities in delineating nuclear regions originate from both technical  and biological  variations. present techniques have focused on adaptive thresholding followed by morphological operators  <cit> , fuzzy clustering  <cit> , level set method using gradient information  <cit> , color separation followed by optimum thresholding and learning  <cit> , hybrid color and texture analysis that are followed by learning and unsupervised clustering  <cit> , and representation of nuclei organization in tissue  <cit>  that is computed from either interactive segmentation or a combination of intensity, texture, and morphological operators. some applications combine the above techniques. for example, in  <cit> , iterative radial voting  <cit>  was used to estimate seeds for the location of the nuclei and subsequently, the model interaction between neighboring nuclei with multiphase level set  <cit> . it is also a common practice that through color decomposition, nuclear regions can be segmented using the same techniques that have been developed for fluorescence microscopy. in recent papers, we  <cit>  and others  <cit>  have reviewed those techniques. however, none of these methods can effectively address analytical requirements of the tumor characterization. thresholding and clustering assume constant chromatin content for the nuclei in the image. in practice, there is a wide variation in chromatin content. in addition, there is the issue with overlapping and clumping of the nuclei, and sometimes, due to the tissue thickness, they cannot be segmented. the method proposed in  <cit>  aims to delineate overlapping nuclei through iterative radial voting  <cit> , but seed detection can fail in the presence of wide variations in the nuclear size; thus, leading to fragmentation. we should also note that many of the techniques that have been developed for analysis of cell culture models, imaged through fluorescence microscopy, are applicable to the analysis of histology sections. accordingly, methods have been developed to quantify a variety of endpoints using iterative voting  <cit> , geometric reasoning  <cit> , evolving fronts  <cit> , and gabor filter banks  <cit> .

having summarized the current state of computational histopathology, our objective is to use a large growing dataset of tumor sections and to identify intrinsic subtypes within this dataset. these subtypes can then be used for genomic association. in other words, we don't seek to build a system to mimic histological grading. to meet this objective, it is essential to develop a pipeline for processing a large scale dataset, to overcome technical variations, and to incorporate methods that are extensible to other tumor types. our testbed consists of  <dig> sections of gbm, scanned with a  <dig> Ã— objective in a bright field, which are typically  <dig> -by- <dig>  pixels.

method
morphometric analysis and multidimensional profiling
we evaluated a number of nuclear segmentation methods that included level sets  <cit>  or their variants using graph cut implementation, and integration of these methods with seed selection using geometric methods  <cit> . but these techniques proved to be compute-intensive as a typical tissue section  would take roughly a week of processing time on a high end desktop computer. our experience led to a design of a pipeline that will delineate nuclei and compute morphometric features with a superior computational throughput. the computational model was first validated against synthetic data, then tested on annotated tissue sections, and finally evaluated by a pathologist. below, we summarize three major components of our methodology.

analytical steps
figures  <dig> and  <dig> show steps in converting an image into a multidimensional representation.  the first step removes heterogeneity associated with staining by normalizing against one gold standard of h&e stain.  the second step performs color decomposition for further reduction of the computational load. the standard approach is a non-negative matrix factorization   <cit> , but it is iterative and a previous analysis has indicated nmf did not show superior performance  <cit> . here, we used a linear transformation for separating stains  <cit>  based on the orthonormal transformation of the rgb space.  the third step computes a threshold from the image corresponding to the nuclei signature. the threshold selection is based on the analysis of the histogram for the value that minimizes intra-class variance. other techniques, such as modeling foreground and background as two poisson distributions, yielded similar results. the important issue is fast histogram-based thresholding for subsequent refinement and validation. refinement consists of enforcement of intensity and geometric constraints. often, when nuclei are close to each other, either their intercellular contents can leak, the boundaries between the two adjacent nuclei can become perceptual, or the two neighboring nuclei, with completely different chromaticity strength, can merge. the refinement step performs two tasks:  it models the intensity distribution of each thresholded blob as a mixture of up to three gaussians to examine if there is a variation in the background model and whether two adjacent nuclei, with a significantly different amount of dna content, are merged together, and  it uses the convexity constrain to partition blobs based on perceptual boundaries, as outlined in our earlier paper  <cit> . once an image is segmented in terms of nuclear morphology, a multidimensional representation is generated for each nucleus that defines its signature and organization, as we defined in a previous publication  <cit>  and summarized in additional file  <dig> 

computational pipeline
the significance of the pipeline, shown in figure  <dig>  is that it can process a large amount of data; thus, meeting tcga data processing requirements. the pipeline has four components:  maintaining consistency between the remote and local registries,  visualization of tissue sections,  data processing and importing computed representation, and  data summarization through normalization.

the pipeline maintains a local registry where consistency between images at tcga  and a local repository is constantly maintained, and new images are downloaded for processing. at present, nci provides both frozen sections and those from paraffin embedded blocks. although both types of images are registered and displayed through our system, only paraffin embedded blocks are processed. each image is partitioned into strips of 1k-by-number of columns, then the strips are stored on the ome image server  <cit> .

visualization of each large scale tissue section is realized through tiling and the utilization of flash technology that enables a client to pan and zoom, similar to googlemapsâ„¢. each image  is partitioned into tiles of 256-by- <dig> pixels at different resolutions, and the tiles are then stored on a server. as the user drags and zooms on the image in the browser, the tiles are downloaded from the server and inserted into the browser page. data and images are available through http://tcga.lbl.gov.

each strip is subsequently partitioned into 1k-by-1k blocks, and blocks are submitted to a computer cluster for processing. the block size has been optimized for processing time and wait time in the queue. at the moment, the entire gbm data set of  <dig> images takes  <dig> days of processing. in addition to cluster-based computing, the computational methods of the previous section have a multithread implementation for a more efficient utilization of each computing node. once each block is processed, computed features are imported into an imaging bioinformatics system, named biosig  <cit> , for further analysis. several java modules have been developed that run concurrently to access and update the database. the "jobsubmitter" uses jsch , and expectj  to drive shell scripts on the computing cluster. computed representation  can then be overlaid on the original image for quality control.

the backend of biosig uses postgresql  and summarization of feature-based representation is performed through procedural programming. for high performance applications, pg server programming interface  enables the transparent transformation of sql queries. this is a critical component since it adds flexibility for computing morphometric and organization features, normalizing them, and analyzing underlying representation in a new way that was not anticipated. this capability has proven to increase productivity by testing alternative representations without reprocessing the original images. given the entire gbm  datasets, we have designed a four-step process to normalize each computed feature  for subtyping and genomic association, which is implemented through spi:  each feature is represented as a density distribution per tissue;  feature-based distribution for all tissues, within a tumor type, are combined to construct a global distribution;  the global distribution is then re-binned so that each bin has a similar population of cells of a given feature-value, and  local density distributions are then remapped to computed global bins of equal weight. the net result is that the morphological indices can then be compared, in context, by reporting a distribution function for each feature. these data are downloadable and can be visualized for each tissue section. the rationale for this simplified analysis is that given a large number of cells in a tissue section, classical clustering analysis  can be computationally intractable . in cases where multiple tissue sections exist for a single patient, an average distribution is computed and archived.

subtyping and genomic association
normalized representation of morphometric data are used for subtyping. subtyping is based on consensus voting  <cit>  by varying the number of subtypes and examining the similarity matrix. it has also been used in earlier papers for subtyping 2d and 3d cell culture morphologies  <cit> . two gene ranking algorithms of moderated f-statistic and random forests are used for genomic association.  moderated f-statistic  <cit>  utilizes the empirical bayes method for assessing differential gene expression. in this method, the denominator mean squares  are moderated across genes through the empirical bayes approach. the net result is an improved statistical stability given the limited number of samples. the p-value is computed for each gene based on the moderated f-statistic, and then adjusted for multiple hypothesis testing. the adjustment is based on benjamini and hochberg's method to estimate the false discovery rate   <cit> . fdr controls the expected proportion of falsely rejected null hypotheses in multiple hypotheses testing to correct for multiple comparisons. the method is implemented through the r limma package. the top genes that are differentially expressed between subtype  <dig> and others, with fdr adjusted p-value less than  <dig> , are included in additional file  <dig> as a heatmap.  random forest is an ensemble classifier that consists of many decision trees  <cit> . in random forest, there are several policies for characterizing significance of each gene. one policy evaluates the decrease in classification accuracy by permutation values of a single gene between multiple samples  <cit> . we used the r implementation of a random forest package  <cit> , where the number of trees  is increased to  <dig> to accommodate the original subset of genes  that were used in an earlier tcga publication  <cit> . to insure the robustness and stability of gene selection, the process is repeated by averaging over  <dig> randomly generated forests.

RESULTS
the critical factors in our computational pipeline are the throughput, quality of segmentation and morphometric representation for subtyping, and genomic association. the throughput is significant since images need to be continuously processed with a newer version of the software with increased robustness. presently, the total computational time for  <dig> large scale tissue sections  is less than a week on a shared cluster. because segmentation results are also important for quality control, a number of intermediate data are also released.

data, intermediaries, and limitations
since nuclear segmentation provides the basis for morphometric analysis, subtyping, and survival analysis, it is being released for visualization through our web site at http://tcga.lbl.gov, where users can pan and zoom through the images and overlay segmentation results on original images. the web site also enables exclusion of specific tissue sections for subtyping and genomic association. computed representations and subtyping is also released through our web site to the community.

present limitations are absence of  an improved nuclear segmentation method,  patch-based tissue-based labeling,  a systematic evaluation of the multidimensional representation, as it relates to the underlying biology, and  abstraction and complete automation in the computational pipeline.  like others, our approach to nuclear segmentation is not perfect and introduces morphometric errors. the major limitation for introducing more powerful algorithms has been limited computational time for processing very large sets of data. however, given a very large number of cells in a tissue section, subsequent consensus-based clustering tends to treat segmentation errors as outliers. figure  <dig> shows nuclear segmentation and region-based tessellation overlaid on images with diverse morphometric signatures, where the cellularity index  is computed as the inverse of each tessellated region area and its density distribution.  in certain tumor types, nuclear segmentation is insufficient for characterizing tissue histopathology. for example, in gbm, apoptotic and necrotic rates are also important. there are also patches where the state of the tissue is transitory, i.e., both apoptotic and necrotic states coexist in a population of cells. this is a higher level of analysis that is difficult to deduce from a simple nuclear segmentation and additional prior knowledge is needed.  over  <dig> features are computed per cell, and we have only begun to evaluate some of those that correlate with the known pathology . it is desirable to have an informatics layer for formulating a query and get a different view of the data. possible use-cases are dimensionality reduction , or feature selection based on outcome or known pathology that is followed by subtyping. each of these queries provide a unique insight and into the underlying biology for hypothesis generation.  ideally, all processes should be launched, monitored, and validated through the database. although, images and computed features are registered with the database, additional queries and notification services are required to construct a more flexible system as required in items  and .

quality control
three modules are tested in the computational pipeline:  segmentation,  feature extraction, and  subtyping.  we have created a subset of hand segmented images, which originate from a diverse set of tissue sections from tcga gbm dataset. even though most images are stained properly, the emphasis on this subset has been placed on blocks where the nuclear dye is heterogeneous. the recall and precision is at 78% and 65%, respectively;  feature extraction and representation were tested against synthetic data with known ground truth;  subtyping is evaluated qualitatively by displaying group similarity matrix.

subtyping based tissue histology and survival analysis
our system represents each nucleus as a multidimensional vector in the tissue section. we have opted the policy to allow the pathologist to explore clinical questions in terms of selected morphometric indices. this is based on the fact that each morphometric feature can represent underlying biological processes. for example, when the cells are stressed, macromolecules are excreted into cytoplasm  to create a textured topography as opposed to a smooth one in normal cells. in the following experiment, it was decided to investigate nuclear size and cellularity for subtyping, survival analysis, and genomic association. the rationale is clear given larger nuclear size and higher proliferation rate in tumor regions. in this experimental configuration, consensus voting revealed five subtypes through qualitative analysis and ordering of the computed similarity matrix, as shown in figure  <dig>  with respect to correlation with the outcome as a result of therapy, we analyzed patients that received more  or less   <cit> . following the kaplan meier estimator, our analysis indicates that only one subtype with extreme high cellularity, shown in figure 5e, has a significant p-value through pair-wise comparison of the survival curves using a log-rank test  <cit> . figure 6f indicates that with a more intensive therapy  life span is increased as compared to a less intensive therapy . the p-values of other subtypes were not favorable for survival analysis. a possible interpretation is that extreme high cellularity is more homogeneous and highly proliferative; thus, responding better to a more aggressive therapy.

genomic association
given that the therapeutic regime has increased life span for the subtype with extreme high cellularity, as shown in figure 5e, we queried for its molecular marker through differential gene expression analysis as well as random forest. both gene lists are provided in additional file  <dig>  and a more detailed discussion of the gene lists through random forest follows. we have analyzed the top  <dig> genes for pathway and subnetwork enrichment analysis through pathway studio. pathway analysis reveals enrichment of immune response, such as nk-cell  and t-cell activation, and ap- <dig> signaling with p-value of less than  <dig> . in support of these findings, the literature suggests that gbm expresses antigens that is recognized by the immune system to eliminate virus infected cells and gbms  <cit> . tumor associated antigen  indicates that glioma cells can be recognized by the immune response, but this process is hindered by the tumor location and evasion strategies developed by gbm. ap- <dig>  is a transcription factor is responsible for high level regulation of il-13ra <dig> that is expressed in gbm cells  <cit> , and is also a highly ranked gene in the tcga gene tracker.

subnetwork enrichment analysis has revealed six hubs, with p-values of less than  <dig>  that regulate eight or more other components. these are ifng, tgfb <dig>  mapk <dig>  cytokines, pkc, and il1b. the union of these subnetworks is shown in figure  <dig>  ifng and mapk <dig> are shown to be highly scored by tcga gene tracker; tgfb <dig> is known to be upregulated in gbm  <cit> ; pkc  is well established in cancer signaling and therapy as it is involved in proliferation, migration, and malignant transformation  <cit> , and its isozyme has been suggested for chemotherapeutic targets in gbm  <cit> ; and ilb <dig> is down stream of nf-kb and is known to play an important role in cellular response to stress  <cit>  and is constitutively activated in most tumor types. in summary, bioinformatics analysis has provided hypotheses for new modes of potential therapy based on morphometric subtyping.

comparison with prior art
it is important to note that another laboratory  <cit>  has analyzed the same dataset. there are differences in the outcome and methodologies. for example, they have reported four subtypes in the gbm dataset. we suggest that the  addition of the cellularity index,  utility of feature distributions as opposed to the feature means,  selection of specific combination of features as opposed to all computed features, and  absence of curation have been the deciding factors. besides cell-based multidimensional representation, there are also differences in nuclear segmentation. it is difficult to assess the differences in segmentation in the absence of source code and computed results on a large dataset; however, color normalization  and separation of the touching nuclei has not been addressed in  <cit> . these differences, especially curation, can have a significant impact on morphometric analysis. finally, we have designed and built an open system, where algorithms and software are going through constant improvement, and computed representation and intermediaries are being made available for each version of the software.

CONCLUSIONS
we have developed an integrated pipeline to process large scale tissue sections for morphometric analysis. the data are downloaded from the nih web site, partitioned into blocks, and then processed on a cluster. computed representation is then transferred to a database where  data can be downloaded for molecular association, and  computed information is overlaid on the original image and that through panning and zooming, quality control can be performed. thus far, gbm and kidney data have become publicly available.

we have shown that through morphometric analysis and cellular organization of tissue histology of a large dataset, subtypes can be identified that are predictive of outcome as a result of therapeutic protocol. the main theme is that histological subtyping reveals intrinsic categories that are independent of supervised histological grades. in other words, tcga's large curated dataset offers potential for revealing subtypes based on intrinsic properties of tissue signatures as opposed to the classical tumor grading , practiced by pathologists. in this context, tcga's histology database can provide a complementary repository for diagnostic and molecular underpinning for histological subtypes. subsequently, molecular signature of a subtype can hypothesize a more effective targeted therapy. our continued research focuses on addressing limitations that has been addressed in the result section. ultimately, we plan to develop a system that will process all tumor types.

authors' contributions
hc developed high performance software for segmentation and feature-based representation. gvf developed integrated computational pipeline for routing data between nih repository, local databases, and cluster computing. jh performed subtyping and bioinformatics analysis of multidimensional representation. gc developed the web pages for data distribution and image zooming. fb is the lead pathologist who contributed to the interpretation of subtyping results. jg and ps conceived the study and requirements. bp contributed to the study and experimental plan, led the research, and wrote the paper. all authors read and approved the final manuscript.

supplementary material
additional file 1
supplementary material for morphometic analysis of tcga glioblastoma multiforme. supplementary material for morphometic analysis of tcga glioblastoma multiforme.

click here for file

 acknowledgements
this research was supported by the national cancer institute u <dig> ca <dig> and ro1ca <dig> and the u.s. department of energy under contract number de-ac02-05ch <dig>  the research utilized the lawrencium computational cluster resource, provided by the it division at the lawrence berkeley national laboratory, and the center for information technology research in the interest of society  at the university of california-berkeley.
