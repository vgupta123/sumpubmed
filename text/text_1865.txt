BACKGROUND
metabolic profiling,  is a rapidly developing field in which the levels of hundreds to thousands of low molecular weight metabolites are simultaneously profiled in biofluids, cells and tissues. the methodology is well-established for characterizing disease states, toxicity and differences in physiological condition  <cit>  and for extracting metabolite patterns associated with these conditions. in many experiments the biological system is followed over time, generating a multivariate metabolic time course. for example, staging of a disease process may be more important than merely determining its presence or absence. the ability to accurately define and predict disease stage also has obvious application in assessment of response to therapeutic intervention. ideally such time-series data should be well sampled in the time domain and have an adequate statistical experimental design, which is an essential component for the outcome of the study and quality of data  <cit> . however, for practical reasons collection of an optimal dataset is not always possible.

in the case of multivariate time-series data with low sample rate, many classical statistical methods are not appropriate for analysis and characterization of the time related variance due to the low number of time-points and in some cases inability to handle multivariate data. principal component analysis   <cit>  has previously been applied for the analysis of time-series data in metabonomics  <cit> , allowing visualization of the main time-related patterns of variation. pca has the objective of describing the main variance in the data in a low-dimensional subspace spanned by a few linear components. since pca does not explicitly model time-related variation, it does not provide an optimal representation of time-related data. in addition, the pca model usually has more than one pca component, making subtle changes described by multiple components hard to interpret. partial least squares  regression  <cit>  with the time as regressand has also been used for analysis of time-series metabonomic data  <cit> , but the assumption of a linear relation between descriptor variables and time is valid only under some specific circumstances, but not in the general case. the parafac model  <cit>  provides a generalisation of pca to data matrices of higher dimension. in this case, the three-way structure of the data consists of . the reason why 3-way methods are not used in this study is because the nmr spectral profile  do not preserve neither the rank, nor the spectral profile over all time points, which violates the 3-way method assumption of tri-linearity. smilde et al.  <cit>  described a generalization of the anova approach to the multivariate case for data generated from an experimental design, labelled as anova-simultaneous component analysis , with application to time-series data. however, in asca the time related effects are assumed to be linear in relation to time, which is rarely a valid assumption, neither does the asca method providing a predictive model. for short and univariate time-series, piecewise linear modelling methods can be used to describe progression over a time-series, which is similar in some aspects to the method proposed here for the multivariate case. other statistical methods applied for the analysis and modelling of time-series data in omics biology include clustering  <cit> , dynamic bayesian networks  <cit>  and batch statistical process control  <cit> . applications of time-series analysis have been described by trygg and lundstedt  <cit>  in a review of chemometric techniques applied in metabonomics, and some of the current issues with regard to analysis of time-series gene expression data were reviewed by bar-joseph  <cit> .

here a new method for piecewise multivariate modelling of time-series spectroscopically generated metabolic data is proposed, which can be used for characterization and modelling of short  and sparsely sampled  time-series data of high dimension. the method is well suited for analysis of spectral metabolite profiles where variables are intrinsically multicolinear, but is also generally applicable to other types of omics data. the suggested method also provides descriptive information, enables visualization and establishes a predictive model based on time-related variance, putting focus on effects seen between local time-points. the proposed method is based on multivariate piecewise models, where each sub-model describes changes occurring between neighbouring time points in a series of time frames over the time course, here the piecewise model is an orthogonal projections to latent structures  <cit>   model. overall, the set of sub-models describe the time-related changes over the full time also encompassing the modelling of non-linear changes in relation to time. visualization of the piecewise multivariate model can be accomplished by investigation of sub-models separately, cumulatively over all time frames and as a time-trajectory. one can interpret the local changes as the rate of metabolic change in the time course. this aspect of explicitly investigating the multivariate characteristics of change, together with the magnitude of change over time in a biological system, has not been explored previously to the knowledge of the authors. in addition we show how this approach can be used for prediction of the time-point along a time-series, based upon measured metabolic profiles. prediction of time-point by the model could be used for monitoring disease stage over time as well as for evaluation of the efficacy of an intervention, e.g. by assessing change in predicted disease stage after an intervention.

the paper is organized as follows. a brief introduction to the opls method is given, followed by a detailed description of then proposed piecewise multivariate modelling of sequential data. finally the method is demonstrated on both simulated data and metabolic profiling data and results are compared to results from pca analysis as well as linear opls regression modelling.

RESULTS
algorithm
with the objective of describing the time-related variance in the data, a set of multivariate piecewise models is estimated, describing the transitions between metabolic states in neighbouring time points, using the opls algorithm. each model establishes a function for the transition between two time points will be called a sub-model in the following sections. a distinction is made between the piecewise approach, consisting of a set of opls sub-models, and the opls regression approach where the descriptor matrix is regressed against the time using all time points in a common model, thus, assuming a linear relationship between the data and time. let the matrix x   represent the matrix of descriptor variables, where each observation, e.g. a metabolic profile, is a row-vector of x. the data vector for time-point i for individual n is denoted by xn,i. y is the response matrix  . t represents the total number of time-points, resulting in t- <dig> sub-models. throughout the paper matrices are represented by bold uppercase letter, vectors bold lower-case, scalars are represented as italics, p represents a probability density and tr is the trace function.

pls and opls methods
partial least squares regression   <cit>  has been used successfully for estimation of multivariate regression and discriminant models in many applications, especially in cases when descriptor variables are multicollinear and noisy, and when the number of variables exceeds the number of observations, which is common for e.g. spectroscopic and other omics data. for data with systematic variation, which is orthogonal to the regressand, the number of pls components required for an optimal predictive model normally exceeds the rank of the y-matrix. in such cases, the orthogonal projections to latent structures  method  <cit> , which has an integrated orthogonal signal correction filter  <cit>  specifically designed for pls, will benefit the analysis. this allows the estimation of an optimal model  with a single predictive component for the single y-variable case, contrary to the pls model which may have several components if structured y-orthogonal noise is present in data. this property of the opls algorithm, guaranteeing a single predictive component for the single y-variable case, is utilized in the method described here. it confers an advantage compared to other similar multivariate projection methods, in terms of clearer interpretation of the model and enabling a straightforward extension to the piecewise model described here. the simplicity of interpretation is due to the separate modelling of correlated components and y-orthogonal components in the opls model.

estimation of piecewise sub-models
estimation of a multivariate sub-model between time point i and i+ <dig> can be treated as a discriminant analysis problem between two time points, describing the time  as a function of the descriptor matrix . let the xi  matrix consist of training data from time t = i and t = i+ <dig> with ni observations, and let the yi  matrix to be a dummy matrix of zeros and ones, indicating which observation belongs to time point t = i and t = i+ <dig> respectively.

the opls algorithm decomposes xi into a predictive weight vector, wp,i , describing the direction in the k-dimensional space between the two time points , and a predictive score vector, tp,i , representing the orthogonal projection of x onto wp,i . if y-orthogonal variance is present in the data, the optimal predictive pls model would include more than one pls component, which in the opls model is equivalent to the estimation of additional y-orthogonal components in addition to the predictive component in the model . this results in the guarantee of a single predictive component wp,i, describing the discriminative  direction in xi, and ao y-orthogonal components with loading matrix po,i  and score matrix to,i , describing the systematic y-orthogonal variation present in the data, if any.

  xi = tp,i wtp,i + to,i pto,i + ei 

the y-orthogonal variance may be analyzed further, either separately or together with the x residuals  to understand the variance patterns present in the data that are not time-related, which may provide information of systematic instrumentation errors or biological variation not directly related to time but which may still be of value.

in equation  <dig>  wp,i may be interpreted as the direction of change in the 'metabolic space' in the local time frame, describing the transition between two neighbouring time points, i and i+ <dig>  wp,i may also be interpreted as an approximation to the derivative of the time dependent function of the metabolic state. wp,i only describes a direction but does not contain any information quantifying the magnitude of the change in each time frame. an intuitive measurement of the magnitude of change would be the euclidean norm of the predictive score vector ||tp,i||. however the euclidean norm may be affected by even moderate outliers and is therefore not an optimal choice. instead we use the median distance in the score space as the metric for the magnitude of change .

  di = |median - median| 

  wdist,i = wp,i di 

wdist,i is then defined as wp,i weighted by a scalar  defining the magnitude of the change in the local time frame i , thus incorporating the information about the direction as well as magnitude of change. wdist will be referred to as the magnitude weights and may be used as a way of describing and visualizing the profile of time-related change in any given sub-model. wdist is also comparable in magnitude between the different sub-models, contrary to wp, which is scaled to unit norm.

interpretation of time related changes in model
by applying elementary vector algebra we also define the cumulative wdist, wdist,cum, which represents the total time related changes as described by the sub-models between t =  <dig> and t = t . this provides useful information for interpretation and visualization of the time related changes described by the sub-models over the whole time-series.

  wdist,cum,i = wdist,t= <dig> + wdist,t= <dig> + ... + wdist,t=i, t =  <dig> ..i 

wdist,cum provides information on the overall change from a given reference point . this enables us to not only track the changes in the local time frames, but also to depict the accumulated change over the time course. wdist,cum may prove to be useful for investigations of systems where there is a change occurring from a homeostatic state or when studying the recovery over time after a perturbation to establish whether the system returns either to the biological state prior to the perturbation, or alternatively, to a new state. a return back to the original biological state would in result in a wdist.cum vector close to a vector of zeros. for visualization purposes, and to summarize the changes described by wdist.cum vectors, pca may be applied on the wdist,cum matrix to visualize the major patterns of time-related variation in a low dimensional subspace, describing the main changes in the time-series. the low dimensional representation of the time points provides an overview of the relationship and similarity between the temporal states, or stages, rather than maximizing the amount of modelled variation in the original data, hence providing a less noisy visualization of the time-related variation in the data compared to a conventional pca trajectory.

prediction of time point
time predictions for new observations are carried out in two steps. first the sub-model that best fits the new observation is established and within this sub-model a more detailed time prediction is then made. the decision of which sub-mode fits best the test-set observation is determined by two likelihoods. the first is pt <dig>  the likelihood for a test-set observation  to fit to the sub-model , based on the score , where the likelihood is based upon hotellings t <dig> statistic estimated from the training data. the second is based upon analysis of the model residual vector . using the distribution of the residuals from the training set we can calculate the q-statistics  <cit> , or alternatively dmodx  <cit> , which shows similar characteristics. the q-statistic , is based upon the sums of squares of the residuals, which is used to estimate the likelihood pq for the test-set observation based on the q-statistic from the training data. q-statistics for residual analysis were described by jackson  <cit> . equations 5– <dig> describe how the parameter c, which follows an approximate n distribution, can be calculated  <cit> , leading us to the calculation of pq . in equation  <dig> etest represents the residual vector for a test-set observation. in equation  <dig>  Σei is the covariance matrix of ei, which is the residual matrix for the training data for sub-model i. in equation  <dig> c' represents an instance of c as calculated in equation  <dig> for a specific test-set observation.

  qtest = etesttetest 

  θi,1=trθi,2=trθi,3=tr 

  hi,0=1−2θi,1θi,33θi, <dig> 

  c=θi,1hi,0−θi,2hi,0θi,12−12θi,2hi, <dig> 

  pq = p, c~n 

here pq and pt <dig> are treated as independent, which should be acceptable in most cases of application. the joint probability for the new observation to belong to a given sub-model is then calculated as described in equation  <dig> and equation  <dig> 

  p = z-1p pq pt <dig> 

  z=∑i=1t−1ppt2pq, t-1 = number of submodels 

equation  <dig> provides selection criterion for selecting the sub-model with the best fit, which is used for the prediction . the prior probability of each sub-model, p, in equation  <dig> can be used to if there are known prior probabilities for each sub-model, or otherwise assigned uniformly for all sub-models. time  is predicted as described in equation  <dig> and  <dig>  where xpred.new is the prediction set x matrix after y-orthogonal variation has been removed, xpred is the prediction set matrix, tpred.o is the y-orthogonal scores matrix calculated from xpred, ptraining.o represents the matrix of y-orthogonal loadings derived from the training x matrix, yoffset,i is equal to time point i and bi is the matrix of opls predictive coefficients for the selected sub-model i.

  xpred.new=xpred−tpred.optraining.ot 

  y^=yoffset,i+xpred.newbi 

testing
the simulated data set
to illustrate some of the properties of piecewise multivariate modelling approach a tractable example based on simulated data was used, which has both linear and non-linear time-related variation present. a spectral-like data set with  <dig> spectral variables,  <dig> time points, and  <dig> replicates for each time point was simulated using a bilinear model. the data contain two time dependent components, one non-linearly  and one linearly  related to time  in addition to a constant component  which contain only random variation, described in equation  <dig>  each one of these three components is related to a specific spectral profile  . random variation ) was added to the time dependent latent variables for each time point and each observation.

  j= <dig> ...100 t=u <dig> i,j=sin + ε u <dig> i,j=ti+εu <dig> i,j= <dig> +εxij=u <dig> i,jp1t+u <dig> i,jp2t+u <dig> i,jp3t 

principal component analysis
results from pca analysis of the simulated data is shown in figure 2a–c visualized as a pca trajectory plot, where the centroids in the score space are calculated for each time-point and then connect to form the trajectory  . the loading plots for component one and two  show that the two sources of variation in the simulated data are slightly confounded between the two pca components.

opls regression
we investigate the same data set using the opls regression approach and regress the simulated spectral data against time, using one predictive component. figure 3a shows opls predictive weights, indicating the predictive  variation that is described by the opls model. as expected, only the leftmost peak in the spectral profile is given any weight in the model, while the time related, but non-linear component, is not present . predictions of a test-set  using the opls model give a root-mean-square error of prediction  of  <dig> % .

piecewise multivariate modelling
in the piecewise model, the cumulative magnitude weights wdist,cum illustrate the cumulative change in the system over the time-series . figure 4b illustrates the relative magnitude of change  in each sub-model, allowing the magnitude of change in each sub-model to be established. deviations from the expected symmetrical magnitude of change profile  for the simulated data set are a direct effect of the gaussian noise present in the data set. it can be seen that di approximately traces the gradient of the non-linear time-related component  as expected. for the time-point predictions, the probability of sub-model membership was calculated for each of the test-set observations. the probabilities for all time points from one time-series is shown as an example in figure 4c. the lack of symmetry seen in figure 4c is because each sub-model  represents a model between two neighbouring time-points. therefore, an observation  has the potential to fit fairly well into both of the adjacent sub-models, or one of them. the time predictions  based on the best fitting sub-model are displayed in figure 4d in the form of a boxplot, indicating successful predictions. the larger prediction errors observed for time-points 4– <dig> , compared to earlier and later time-points, are due to lower signal to noise level for these time-points. this is an effect of the time related component u <dig> , which has a lower amount of time-related change over these time-points, while the noise level remains constant over the time course. the rmsep is similar to the opls regression model, which is expected in this case since there is one latent variable in the simulated data that is linearly related to time. crucially, the linear opls regression only models the linearly related time variation in the spectral profile, while the piecewise model shows both the linear and non-linear time-related variation in the data. this provides a model demonstrating a more complete representation of the time-related variation, enabling a more comprehensive interpretation.

the mercury ii chloride data set
to test the method on real data, we used data from a renal toxicity study using mercury ii chloride to induce a proximal tubular damage  <cit>  in the rat. this is a 1h nmr based metabonomic study of rat urine with data from seven time points  and including ten animals in total. prior to analysis the data were pre-processed using standard methods. first the spectra were interpolated to a common chemical shift scale using cubic spline interpolation. the region corresponding to water and urea resonances  was excluded from each spectrum and the spectral intensity was subsequently integrated over adjacent δ  <dig>  ppm width bins. each spectrum was normalized to the total sum of  <dig> units to reduce the overall dilution effect due to inter animal variability in urine excretion rates. a typical integrated nmr spectrum after pre-processing is shown in figure  <dig>  after  <dig> hours five animals were sacrificed, rendering n =  <dig> animals to be left in the study after  <dig> h.

principal component analysis
results from pca analysis of the hgcl <dig> data is shown in figure 6a–c visualized as a pca trajectory plot, where the centroids in the score space are calculated for each time-point and then connect to form the trajectory . figure 6b and figure 6c show the loadings for each one of the two pca components calculated. in many instances the pattern of change between time points is a combination of variation in more than one pca component, making it hard to interpret the unique pattern of change over different regions of the time-series, especially when these changes may be subtle.

opls regression
the hgcl <dig> data set was analyzed by linear opls regression against the time using one predictive component and one time-orthogonal component . interpretation of the predictive component from the opls regression model against the time provides information about variance linearly related to time . the predictive performance of the model was evaluated by cross-validation, where all time-points from one animal at a time were left out from the model estimation and used as a test-set, to evaluate time-predictions . the root-mean-square error of cross-validation  was  <dig> %.

piecewise multivariate modelling
the predicted time based on cross-validation, as described in the previous section, plotted against the true time point for each animal in the study is shown in figure 9a , showing a different pattern of prediction results compared to the opls time regression model . we note that the predictions are less variable in the early time points compared to the opls regression approach. however, in the latter part of the time-course the opls regression model performs quite similarly to the piecewise approach, indicating that there is some variation in the metabolite profiling data linearly related to time. for the time points up to  <dig> h the predictions are relatively good, but as the observation decrease from n =  <dig> to n =  <dig> after  <dig> h, the model becomes less reliable as evidenced by the poorer predictions. however, important information can still be extracted, for example animal  <dig>  is clearly a non-responder, which was confirmed by histopathology data, showing no renal damage, and clinical chemistry data, showing osmolality and glucose levels in the same range as control animals, indicating a negligible effect of the toxin on this animal. figure 9b shows the probabilities for all time-points of animal  <dig> for fitting each sub-model, as an example of how sub-models are chosen.

to provide an overview of the time-related changes, pca was used to visualize wdist.cum as a trajectory . the main information provided by this plot is for assessment of whether the perturbed system has returned to its starting point, and to provide a visualization of the overall time-events. in figure 9c we can see a trend towards the metabolite profile returning to a state close to that prior to the administration of hgcl <dig>  however, over the study duration the recovery was not complete, which may either be due to presence of irreversible injury inflicted by the toxin or that the time span over which the study was carried out was too short to allow observation of a full recovery.

implementation
a r package  <cit>   implementing the method described is available upon request from the corresponding author. 

discussion
we have presented a framework for analysis of short time-series multivariate data, typical of post-genomic  biology, using piecewise multivariate modelling and we demonstrated the method on metabolic profiling data. however, this approach is applicable to other types of omics data as well. the proposed method facilitates a transparent model allowing straightforward interpretation of time related variation in the data over the time course. prediction of the time-point for a new sample is possible. the method has applications in areas such as monitoring and prediction of disease progression or the effects of a perturbation over time, allowing for evaluation of different types of interventions. the piecewise approach makes no assumption of linear relationship between the data and time and is therefore ideal for the analysis of non-linear time-related events in a biological system, as exemplified in the analysis of the simulated and the exemplar hgcl <dig> nephrotoxic data sets.

in comparison to pca, the proposed method provides a more detailed picture of the time-related events including small and local changes in the time domain. in addition, the predictive properties of the proposed method can be utilised for prediction of different stages of time-dependent biological events, such as disease or a toxic perturbation studied over time. in comparison to linear multivariate regression methods , using the time as a response variable, the piecewise multivariate approach also models non-linear time related variation. this renders a model framework describing additional time-related variation with the potential to improve prediction and interpretation if non-linear variation is dominant, in this way providing a complement to both pca and opls regression against time. pca provides an overview of the main variation in the data, while opls regression against time models monotonic increasing or decreasing signals over the time course. the piecewise opls approach provides detailed information of time related effects seen locally over the time-course as well as non-linear time-related variation.

the proposed method does not exploit autocorrelation structures in the time-series and does not providing a tool for forecasting, as do methods like auto-regressive moving average   <cit> . one reason why arma cannot be applied successfully to the type of data described here is the restricted number of time-points available. non-linear modelling approaches, e.g. artificial neural networks or kernel based regression methods such as kernel pls  <cit> , have properties that in some cases provide models with better prediction results, however, these models are often hard or impossible to interpret in relation to the descriptor variables. for example, in the case of the mercury ii chloride data set, a kernel pls model provided only a marginally better prediction result, with a rmsecv value of  <dig> % , compared to the piecewise multivariate model. however, in many biological applications of predictive modelling it is essential to have access to transparent models that allow interpretation, rendering the proposed method beneficial compared to less transparent alternatives. another possible limitation of the proposed method is to handle time-series samples that are severely unsynchronized, e.g. high variability in response time between animals after a perturbation.

a new perspective on the time dynamic data was achieved by placing the focus on the analysis and comparison of data based on the changes over the time-series, i.e. the derivative of the time dependent function. this approach provides new insights into the dynamics of the biological system, which may otherwise have been overlooked. the method could also provide the basis for fast and large-scale comparison of biological responses studied over time due to different types of perturbations. this can be accomplished by means of comparison of the piecewise weights between sub-models, which can be seen as a multivariate representation of the time-dependent events taking place in the biological system.

the common case of data sampled in a synchronized fashion has mainly been discussed in this paper. the method could easily be modified to handle cases where individuals in the training set are not sampled at the same time points, but where the sampling time is known. in this case the sub-model will be a regression model instead of a discriminant model. in such cases, the boundaries of the local time frames will be chosen so that they are sufficiently local and overlapping in the time domain. if changes between subsequent time points are very small and noisy, while the number of time-points is not limiting, the same approach can be applied by treating some neighbouring time points together in a common time-frame when estimating sub-models.

CONCLUSIONS
given short time-series data of high dimensionality, the proposed multivariate piecewise approach provides more detailed information compared to other commonly applied multivariate methods for analysis of post-genomic data. the temporal resolution for interpretation of the model is enhanced in the sense that it is easier to conclude which changes occur over time and when they occur, improving the interpretation of the data and providing a tool for the understanding of the biological system. the method also allows time predictions, which is an important feature in many biological and clinical applications, where time may represent e.g. disease stage and interventions are evaluated in relation to the disease stage.

authors' contributions
mr developed the method, evaluated it and drafted the manuscript. oc, tl and tmde scrutinized the method. eh, jkn and jt supervised the project. all authors read and approved the final manuscript.

