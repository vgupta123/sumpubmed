BACKGROUND
analysis of human microbiota has in recent years unraveled a universe of intricate interactions between man and microorganisms with direct implications for health and disease  <cit> . a large proportion of commensal bacterial species are presently either highly fastidious or cannot be cultured in vitro. this has been a major obstacle to accurately describe the microbiota composition. metagenomic analysis based on state-of-the-art next generation sequencing  along with sophisticated bioinformatics overcomes these barriers by analyzing complex samples ex vivo.

quantitative metagenomic analysis creates a gene and species profile, which allows the identification and phylogenetic classification of known as well as novel genes and species. arumugam and co-workers discovered  <dig> functionally distinct gut microbiota compositions designated “enterotypes”  <cit> . indeed, highly diverse consortia of commensals may functionally synergize to derive energy from nutrients in a highly coordinated and efficient manner. an imbalance of gut microbiota composition has been associated with a large range of pathologies, such as obesity  <cit> , allergy and autoimmunity  <cit> .

although most studies make use of bacteria rich stool samples, a range of other body habitats with a much lower bacterial load is steadily gaining interest, such as vaginal, skin, oral and nasal body habitats  <cit> . a recent study demonstrates that it is technically feasible to analyze microbiota composition in samples of poor genomic dna quantity and quality, such as dental plaques of pre-historic skeletons  <cit> . however, it is also increasingly clear that this type of analysis is often associated with strong biases, which are difficult to discern and complicated to correct  <cit> . the increasing number of samples and the use of samples from sites of low microbial density augment the importance of speed and quality control of sample processing, sequencing and data analysis. a number of studies have addressed this need by developing bioinformatics tools to monitor and correct ngs errors. errors in this context refers to direct sequence errors at the individual base level  <cit> , but also the distribution and abundance of individual sequences including sequences derived from sample or technological contaminants  <cit> . we developed a novel method, which rapidly determines and quantifies the quality of metagenomic sequence distribution at the sample level. metagenomic analysis of complex microbiota communities is particularly sensitive to errors in sequence distribution, because abundance measures of individual bacterial genes and strains are based on sequence distribution within a given sample.

the information density of bacterial genomes is higher than complex eukaryotic organisms, because they harbor much less non-coding nucleotides  <cit> . moreover, bacterial genome size is tightly linked with host symbiosis. indeed, commensals with a long history of host symbiosis generally have small genome sizes as compared to more recent bacterial symbionts  <cit> . the metagenome of human gut microbiota consists of approximately  <dig> different bacterial genomes and therefore has a size of approximately  <dig> gbp. of note, no single bacterial strain surpasses an abundance of  <dig> % of the total gut microbiota  <cit> , emphasizing its highly diverse nature. we therefore hypothesize that contrary to genomes of individual bacterial strains  <cit>  a metagenome of high diversity fragmented into short sequences of length k , would be distributed uniformly if k is sufficiently small.

k-mers are regarded as strings of length k restricted to the 4-letter alphabet . they have been used to solve various problems, such as rapid comparison of dna sequences  <cit> , estimation of bacterial genome size  <cit>  and phylogeny of double-stranded dna viruses  <cit> . we propose to introduce an automated k-mer distribution analysis of raw dna sequences directly downstream of the deep-sequencing analysis. practically, we count the occurrence of all k <dig> possible k-mers in the raw metagenomics sequence dataset  and evaluate their distribution using a metric based on the information theory of shannon  <cit> .

here we show that k-mer distributions of good quality metagenomic sequence data of complex gut microbiota samples are equally distributed unlike genomic sequences of individual bacterial species. we furthermore demonstrate that k-mer distribution is associated with the quality of the metagenomic data. moreover, the shannon entropy of the k-mer distribution predicts the rate of sequence mapping to a predefined reference gene catalogue. our approach analysis unprocessed raw sequences and may significantly facilitate the decision making of whether to 1) recollect, 2) reprocess a sample or 3) increase number of sequence reads before continuing with more extensive analysis. moreover, it introduces a quality metric that may help validate conclusions made from metagenomic data.

methods
faecal sample collection and processing
faecal samples from  <dig> human donors were collected in dedicated hermetically closed plastic containers kept anaerobically  with activated anaerocult® a strips . samples were aliquoted anaerobically and cryopreserved  within  <dig> hours. microbiota from  <dig> g of stool were separated from the fecal matrix on an inverse nycodenz® gradient under anaerobic conditions as previously described  <cit> . the separation yielded an average of  <dig> x <dig>  purified microbial cells per sample. undiluted as well as four 10xfold serial dilutions of microbiota were pelleted by centrifugation  and cryo-preserved as dry-pellets for subsequent dna extraction.

dna extraction
genomic dna was extracted using two distinct but overlapping protocols for whole stool and gradient purified commensals, respectively. whole stool samples were treated as previously described  <cit> . briefly, 200 mg of faecal sample was lysed chemically  and mechanically  followed by elimination of cell debris by centrifugation and precipitation of genomic dna. finally, genomic dna was rnase treated. dna concentration and molecular size were estimated by nanodrop  and agarose gel electrophoresis. gradient purified commensal samples were treated similar to whole stool samples with the exception that dna precipitation was performed in smaller volumes and with extra-long incubation times.

metagenomic library construction
libraries were constructed according to manufactures protocol . briefly, extracted genomic dna was sheared by sonication, size-exclusion purified by agencourt beads , ligated to p <dig> and p <dig> adaptor oligonucleotides with appropriate barcodes, pcr amplified  and loaded onto the flow-chip for downstream solid sequencing.table  <dig> 
dna quantity used for serial dilution library constructions


donor #1
donor #2

sample size 
purified dsdna 
1
dna for ligation 
2
pcr cycles
purified dsdna 
1
dna for ligation 
2
pcr cycles

1genomic dsdna extracted from indicated number of bacteria.


2amount of sheared and size purified genomic dna utilized for ligation with p <dig> and p <dig> adaptor oligonucleotides.



metagenomic sequencing and data analysis
microbiota gene content was determined by high-throughput solid sequencing of total faecal dna  <cit> . an average of  <dig>  million ±  <dig> million  and  <dig>  million ±  <dig>  million 35-base-long single reads were determined for each sample from  <dig> dilution series samples and  <dig> whole stool samples, respectively . raw sequences for all dilution series samples have been deposited in the european bioinformatics institute  european nucleotide archive  under the accession number prjeb <dig>  by using bowtie   <cit>  an average of  <dig>  million ±  <dig>  million and  <dig>  million ±  <dig>  million reads per individual from the two groups of samples, respectively, were mapped on the reference catalogue of  <dig>  million genes  <cit>  with a maximum of  <dig> mismatches. reads mapping at multiple positions were discarded and an average of  <dig>  million ±  <dig>  million and  <dig>  million ±  <dig>  million uniquely mapped reads per individual from the two sample groups, respectively, were retained for estimating the abundance of each reference gene by using meteor software  <cit> . abundance of each gene in an individual was normalized with the method coined reads per kilobase per million  as previously described  <cit> . briefly, gene abundance was determined as the number of reads that uniquely mapped to a defined gene. subsequently, normalized gene abundances were transformed in frequencies by dividing them by the total number of uniquely mapped reads for a given sample. the resulting microbial gene profile was used for further analyses.

bacterial genome sequences
 <dig> bacterial genomes from a range of species covering common human commensals were extracted from the collection of available reference genomes from ncbi .

k-mer analysis
the abundances of all overlapping k-mer sequences present in a set of whole-genome shotgun short-read sequences were counted with in-house developed c++ software  optimized for small k, which supports colour space reads and the csfasta file format as input. sequence reads with missing colour cells were discarded and remaining reads were trimmed to  <dig> bases. k-mer analysis of bacterial genomes was conducted with jellyfish version  <dig>  . the frequencies of different k-mers at each abundance value contained in a set of sequences are plotted as a k-mer abundance histogram. a repeated sequence in a sampled genome affects the shape of these k-mer abundance spectra depending on its length and copy number. a dna sequence of length l will contain  different k-mers if it does not contain repeats of length greater than k– <dig> 

each k-mer has a reverse complement. e.g. the complement of 4mer attc is gaat. note that some k-mers are their own reverse complement  if and only if k is even. since the shot-gun short-read sequencing technology applied does not differentiate according to sequence orientation, we apply a “canonical representation”, which consider k-mers and their reverse complement equivalent .

if the same sequence occurs n times in a genome, shotgun sequencing would sample k-mers from this sequence n times more often than those that occur in a single-copy . therefore, repeated sequences in the genome result in higher abundances of associated k-mers. these collections of k-mers at higher-than-normal abundances appear as multiple peaks at different positions along the x-axis of the k-mer abundance histogram.

hierarchical cluster analysis
agglomerative hierarchical cluster analysis of k-mer distributions of individual bacterial genomes performed according to ward’s minimum variance method  <cit>  was accomplished using jmp <dig> software . the optimal number of clusters was identified according to the largest distance change between successive junctions of the associated dendrogram plot. validity and reproducibility of the classification obtained with hierarchical cluster analysis was assessed using non-hierarchical k-means cluster analysis, in which the optimal number of clusters identified through hierarchical cluster analysis was pre-specified. reproducibility of the classifications obtained with both hierarchical and non-hierarchical clustering was assessed by determination of the kappa value.

ethics statement
the study was conducted in accordance with the declaration of helsinki. human stool samples were obtained following acquisition of the study participants’ written informed consent and the study protocol was reviewed and approved by local ethics committee of pitié-salpêtrière hospital, paris .

statistical analysis
spearman’s rank correlation was calculated using the r project . p-values <  <dig>  were considered statistically significant.

RESULTS
k-mer distribution of complex microbiota is homogenous irrespective of bacterial composition
highly complex microbiota metagenomic raw sequence data can be split in short sequences of length k bases, which can be binned into a finite set of possible k-mer sequences . k-mer analysis of single bacterial genome data has previously revealed differences in k-mer distribution between bacterial species  <cit> . in contrast, we hypothesize that k-mer distribution of a large set of sequence data derived from a complex mix of microorganisms follows a relatively uniform distribution. to validate this hypothesis we selected two distinct stool samples representing two different enterotypes . we then analysed the occurrence of each 4-mer by searching through all raw sequence reads for the two metagenomes. interestingly, the two selected metagenomes had very similar 4-mer distributions despite their highly different bacterial compositions . of note, the shannon-entropy for both samples was high  characteristic of a uniform distribution of 4-mers . in line with our hypothesis, the shannon-entropy of the two selected metagenomes was clearly higher than the one of  <dig> known genomes of bacterial species from a large spectrum of phyla and classes . in other words, genomes from individual bacterial species have a more heterogenous 4-mer distribution than complex metagenomes, even when such metagenomes are derived from very different gut microbiota compositions. this result was confirmed by evaluating the average normalized shannon-index of the k-mer distribution for genomes derived from  <dig> bacterial strains compared to gut metagenomes derived from  <dig> low   and  <dig> high   bacterial content human stool samples . similarly, we compared the  <dig> bacterial strains with  <dig> healthy individuals from the study by yatsunenko et al.   <cit> . of note, the yatsunenko study employed illumina sequencing, showing that the methodology is platform-independent.figure  <dig> 
4-mer distribution analysis for complex microbiota metagenomes compared to individual bacterial genomes. a, bar diagram of quantitative metagenomics of gut microbiota from two healthy volunteers, donor # <dig>  and # <dig> , aggregated to express the frequency of a selected number of taxonomic classes from the bacteroidetes and firmicutes phylums. b, line graph showing the 4-mer distribution of metagenomic sequences from gut microbiota of donor # <dig> and # <dig>  a histogram depicting the 4-mer abundance distribution is plotted to the right of the line graph. distribution entropy is indicated . c, scatter plot visualizes the 4-mer distribution entropy for  <dig> bacterial genomes and two gut microbiota metagenomes. d, the  <dig> bacterial genomes are divided into  <dig> objective clusters by non-supervised agglomerative hierarchical cluster analysis of metagenomic 4-mer distributions based on ward’s minimum variance method.



moreover, individual bacterial genomes aggregated into  <dig> clusters defined by their k-mer distribution using agglomerative hierarchical cluster analysis . the clusters were validated with a non-hierarchical k-means cluster analysis. the agreement between the two clustering techniques was good as defined by cohen’s kappa agreement value . interestingly, the identified clusters are associated with the phylogeny of the bacteria and can be used to evaluate taxonomic relations, as previously suggested  <cit> . deductions from this result suggest that 4-mer analysis of metagenomes of complex bacterial mixtures can be decomposed into a linear regression of k-mer distribution vectors of individual bacteria genomes and a residual, which would represent the component unexplained by known bacterial genomes. in other words, this type of analysis could identify novel bacterial species and potentially elucidate their phylogenetic descent. this approach is beyond the scope of the present study.

quantitative metagenomic analysis of serially diluted gut microbiota identifies lowest analyzable sample size limit
biased metagenomic sequence distribution can be a result of technical obstacles , contaminations and limiting amount of sample material  <cit> . whereas the former causes may be improved or avoided the latter is most often unavoidable. of note, the reliability of sequence distribution directly affects the validity of quantitative metagenomic data. therefore, there is an urgent need for a method to evaluate metagenomic quality. to investigate if k-mer distribution analysis of complex metagenomes could predict metagenomic quality of samples with limiting material, we generated 10-fold serial dilutions of two purified gut microbiota samples presented above . each dilution underwent genomic dna extraction and metagenomic analysis . all dilutions of the same sample should ideally have identical gene distribution with the more concentrated sample being the most representative of the underlying gut microbiota and thus of best quality. we therefore mapped raw metagenomic sequences onto a reference gene catalogue  <cit>  for all analyzed samples and correlated gene frequencies from four 10-fold dilutions with gene frequencies from the most concentrated sample, serving as internal reference sample . for both samples  this analysis demonstrated strong correlations between all serial dilutions and their reference sample with a clear reduction in correlation for the highest dilution for both samples, indicating the analytical sample size limitation associated with our analytical protocol . as expected, correlation between two unrelated donors  was significantly lower than intra-donor correlations .figure  <dig> 
quantitative metagenomics of serially diluted gut microbiota. a, scatter plot of gene frequencies derived from quantitative metagenomic profiles of undiluted gut microbiota on the x-axis versus colour coded 10-, 100-, 1000- and  <dig> -fold diluted gut microbiota on the y-axis . b, categorical line graph depicts spearman rank correlation coefficients between gene frequencies from metagenomic analysis of undiluted gut microbiota versus gene frequencies of 10-, 100-, 1000- and  <dig> -fold diluted gut microbiota from donor # <dig>  and donor # <dig> . c, scatter plot of gene frequencies of undiluted samples from the two unrelated donors # <dig>  and # <dig>  are depicted, and their spearman rank correlation is indicated as a dotted line in b, genes, present in the reference gene catalogue, which are not detected in the samples are excluded from the analysis.



k-mer distribution analysis of metagenomic sequences identifies the same lower sample size limit as quantitative metagenomic analysis
having established a metagenomic dataset including metagenomes with a defined decline in quality we investigated if k-mer analysis of raw sequences of the same dataset would be able to predict the lower sample size limit as defined in the previous paragraph based on a comparative gene mapping procedure. 4-mer analysis of raw metagenomes corresponding to dilution series samples  of gut microbiota from donor # <dig> and # <dig> identified a biased 4-mer distribution for  <dig> - and  <dig> -fold dilution samples from both donor # <dig> and # <dig> . interestingly, aberrant k-mers were not fully overlapping between sample dilutions , suggesting that low quality is derived from both sample preparation and system noise. calculating the shannon-entropy for 4-mer distributions from all metagenomes confirmed that the two most dilute samples suffered from a particularly biased raw sequence read composition . to identify aberrant 4-mers, we correlated the 4-mer frequency observed for each dilution series metagenome with the 4-mer frequency observed for the undiluted reference sample of donor # <dig> and # <dig>  respectively . this analysis revealed a distinct subset of 4-mers largely overrepresented in the diluted samples. a closer look at these 4-mers uncovered a tight association with the unique barcode-cassette sequence flanking the genome fragments of the metagenomic shot-gun repertoire. these sequences are derived from self-ligated shot-gun cassettes. excessive amounts of these sequences are a consequence of limited genomic dna and subsequent reduced ligation efficiency. indeed, when we removed all raw sequence reads matching the barcode-cassette sequence of the respective metagenome repertoire, the 4-mer distributions of diluted samples were less aberrant , although the  <dig> -fold diluted sample remained quantitatively more biased  than the other dilutions for both donor # <dig> and # <dig> . similarly, the correlation analysis revealed that the  <dig> -fold diluted sample included k-mers largely overrepresented in the diluted sample compared to the undiluted reference k-mer distribution . of note, this bias is correlated with the skewed gene distribution observed for the  <dig> -fold dilution .figure  <dig> 
4-mer distribution analysis of raw metagenomic sequences of serially diluted gut microbiota. a, 4-mer abundance distribution  and individual frequency  of metagenomic sequences from colour coded dilution series metagenomics of gut microbiota from donor # <dig>  and # <dig> . b, bar plot visualizes the normalized shannon entropy of 4-mer distribution for undiluted and 10-, 100-, 1000- and  <dig> -fold diluted gut microbiota metagenomics from donor # <dig>  and # <dig> . c, scatter plots depict the correlation between 4-mer distributions of metagenomic sequences from undiluted gut microbiota  and 4-mer distributions of metagenomic sequences from 10-, 100-, 1000- and  <dig> -fold diluted gut microbiota  for donor # <dig>  and # <dig> .



these observations demonstrate that metagenomic quality, as defined by the capacity to precisely and robustly define gene distributions of microbiota, can be predicted by a k-mer distribution analysis of metagenomic raw sequences. it is however not clear if the skewed k-mer distribution observed for the highest sample dilutions  is due to aberrant bacterial gene sequences, as observed by correlative analysis of mapped reads , or due to concomitant non-mappable sequences similar to but distinct from the barcode-cassette sequences discussed above. we therefore filtered raw metagenome sequences to only contain mappable sequences. 4-mer analysis revealed an almost equal distribution of 4-mers for all dilution series metagenomes  resulting in very similar shannon-entropy for 4-mer distributions of all samples . equally, k-mer frequencies correlated perfectly between dilution series samples from the same donor . the predictive features of the k-mer analysis are therefore relying on a secondary but concomitant degradation of sequence quality and distribution.

k-mer distribution predicts metagenomic sequence mapping to a reference gene catalogue
our data demonstrate that k-mer analysis is primarily identifying the presence of aberrant sequences, such as contaminations linked to poor metagenome library assembly resulting from limited quantity of genomic dna. because sequence contaminations are unlikely to map to known bacterial genes, we speculated that skewed k-mer distributions could predict the frequency of raw sequence reads mapping to the reference gene catalogue. of note, raw sequences in this context refer to entirely unmanipulated ngs datasets. this approach was chosen to render the methodology broadly applicable. indeed, we were able to show a clear positive association between 4-mer distribution quantified as shannon-entropy and the frequency of mapped reads for dilution series metagenomes of donor # <dig> and # <dig> . of note, the three most concentrated dilution series samples for both donor # <dig> and # <dig> had very similar 4-mer distributions and thus similar gene mapping frequency, whereas the more diluted samples suffered a pronounced drop in the uniformity of their 4-mer distribution with an associated drop in gene mapping efficiency. applying this analytical approach to a set of  <dig> metagenomes of  <dig> human gut microbiota  showed that our observation was generally applicable, and that 4-mer analysis predicted gene mapping efficiencies below approximately 20% . of note, the rate of mapping was based on unfiltered raw sequences and therefore lower than previously reported  <cit> . we observed that low mapping efficiency was strongly associated with limiting sample material . low  and high  quantity samples differed significantly with regards to the quantity of dna available for the ligation step of metagenomic library construction . the quantities were conform with what was observed for the dilution series samples . above a mapping efficiency of 20% the normalized shannon entropy reaches a plateau despite variation in mapping efficiency. this is likely to be a consequence of the relatively large inherent variation in gene distributions between individuals, which is more or less compatible with the known but still incomplete gene reference catalog  <cit> . the constant increase in gene coverage provided by reference catalogues should eventually remove variations of gene mapping between samples.figure  <dig> 
4-mer distribution of microbiota metagenomes correlates with gene mapping efficiency to a reference gene catalogue. a, line graphs depict the frequency of gene mapping to a reference gene catalogue as a function of the normalized shannon entropy of 4-mer distributions for undiluted and 10-, 100-, 1000- and  <dig> -fold diluted gut microbiota metagenomics from donor # <dig>  and # <dig> . b, scatter plot illustrates the association between normalized shannon entropy of 4-mer distributions and the frequency of gene mapping to a reference gene catalogue for  <dig> gut microbiota metagenomic profiles stratified according to small  and large  sample size. spearman rank correlation statistics are indicated.



CONCLUSIONS
the metagenomic protocol employed in the present study enabled analysis of samples containing more than  <dig> bacteria . this lower limit fits most live habitat derived microbiota, whereas e.g. analysis of dental plaques from skeletons  <cit>  or other low density microbiota habitats, may be inherently biased in gene and/or species distribution due to limiting sample size. our study suggests that for these studies it is important to validate the employed metagenomic protocol  as described here. of note, the present study monitors the gene distribution of microbiota. it is likely that reducing the zoom from gene to a given phylogenetic level would equilibrate a large amount of the variance observed at the gene distribution level of low quality metagenomic datasets.

our study demonstrates that a k-mer distribution analysis of metagenomic raw sequence reads identifies metagenomes of low quality and predicts low gene mapping efficiency. low quality metagenomes were defined as metagenomes for which the gene distribution was considerably different from a reference sample. in the present study this was modelled by concentrated versus dilute samples of two stool samples. metagenome quality was lowered by a significant reduction of sample size. it remains to be validated if the technology would also apply to metagenomes suffering from e.g. technical biases or contaminations.

we propose that k-mer analysis of raw metagenome sequence reads should be implemented as a first quality assessment of raw ngs data prior to filtering and gene mapping analysis. it would allow a qualified decision as to whether 1) obtained metagenomic dataset should be further analyzed , 2) if more sequence reads should be acquired to surpass a predetermined threshold of mapped reads or 3) sample should be discarded or reprocessed to improve metagenomic quality. with the rising demand for metagenomic analysis of microbiota it is crucial to provide tools for rapid and efficient decision making. this will eventually lead to a faster turn-around time, higher quality analysis including measurable quality metrics and a significant cost reduction. finally, increased quality would have a major impact on the robustness of biological and clinical conclusions drawn from metagenomic studies.

additional file
additional file 1: table s <dig>  all bacterial genomes can be obtained from ncbi . figure s <dig>  4-mer distribution analysis of  <dig> bacterial genomes and  <dig> metagenomic sequences of gut microbiota from low and high bacterial content samples. figure s <dig>  4-mer distribution analysis of barcode-cassette filtered metagenomic sequences of serially diluted gut microbiota. figure s <dig>  4-mer distribution analysis of gene mapped metagenomic sequences of serially diluted gut microbiota.



competing interests

the authors declare that they have no competing interests.

authors’ contributions

conceived and designed the experiments: jmb and ml. performed the experiments: cj, jf, cf, dg, sk, fl and ml. performed metagenomic analysis and gene mapping: np, sk and ml. conceived and designed k-mer analysis: fpo, jmb and ml. performed k-mer analysis: fpo, jmb and ml. wrote the manuscript: ml. critical revision of the manuscript: fpo, jmb, cj, jd, de and gg. all authors read and approved the final manuscript.

