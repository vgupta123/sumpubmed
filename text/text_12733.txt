BACKGROUND
several computational approaches to the problem of predicting cis-regulatory modules  have been reported recently. berman et al.  <cit> , markstein et al.  <cit>  and halfon et al.  <cit>  predicted crm's involved in body patterning in the fly, and experimentally verified their predictions. the underlying principle in these algorithms was to detect dense clusters of binding sites, as determined by matches  to catalogued transcription factor weight matrices. the algorithm of rajewsky et al.  <cit> , called ahab, avoided the use of thresholds on weight matrix matches by a probabilistic modeling of crm's. ahab predictions within the segmentation gene network were subjected to extensive experimental validation, with excellent overall success . most predicted crm's, when placed upstream of a reporter gene, faithfully reproduce one or more aspects of the endogenous gene expression pattern. moreover, an analysis of binding site composition over the entire set of validated modules reveals that ahab's prediction of binding sites correlates well with expression patterns produced by the modules and suggests basic rules governing module composition.

the stubb algorithm  extended ahab's approach by incorporating the use of two-species sequence information. stubb also allows the option of scoring positional correlations between binding sites, but this option was not exercised in this study. for each sequence window analyzed, stubb first computes the homologous sequence in the second species and aligns them using lagan . the sequence is then partitioned into "blocks"  and non-blocks . putative binding sites in blocks are scored under an assumption of common evolutionary descent, using a probabilistic model of binding site evolution. thus a "weak" site that is well conserved will score higher, while a "strong" site that is poorly conserved will have its score down-weighted. the score of the sequence window includes contributions from binding sites in blocks as well as in non-blocks. stubb is implemented so that it can be run either on single species or two species data. in the single species mode, it is practically identical to the ahab program. the stubb software is available for download from 

in this paper, we present evidence that the exploitation of cross-species comparison  using stubb can lead to a significant improvement in the accuracy of genome-wide crm prediction. to our knowledge, this is the first direct evaluation of the effect of cross-species comparison on crm prediction on a genome-wide scale. another important contribution of this paper is to present a benchmark for evaluating genome-wide crm prediction tools, collected from the bdgp database and the literature, and curated by manual inspection of several hundred expression patterns. using the same benchmark, we evaluate the effect of varying how background sequence information is incorporated in the algorithm, since this is the only tunable parameter in the stubb program, other than the module length. we are thus able to suggest the optimal parameter settings for genome-wide crm prediction using stubb. finally, we report all genome-wide predictions for cis-regulatory modules involved in anterior-posterior patterning in the early fly embryo, using both single-species and two-species stubb, many of which make a strong case for experimental validation.

segmentation gene network
the transcription control paradigm we use as our test system is the segmentation of the anterior-posterior  axis during early drosophila embryogenesis, which has long been one of the preferred arenas for studying transcription control in vivo. the segmentation genes form a hierarchical network that, in a process of stepwise refinement, translates broad, overlapping expression gradients into periodic patterns of  <dig> discrete stripes, which prefigure the  <dig> segments of the larva . the maternal factors form gradients stretching along the entire ap axis of the embryo, the zygotic "gap" factors are expressed in one or more broad slightly overlapping domains; together they generate the 7-stripe patterns of the pair-rule genes; finally, the segment-polarity genes are expressed in  <dig> stripes. the regulation within the segmentation gene hierarchy is almost entirely transcriptional, and most of the participating genes are transcription factors themselves, activating  or repressing  the transcription of genes at the same level or below. in most cases, the relevant binding sites are clustered within a small interval of  <dig> – <dig> kb; these crm's typically contain binding sites for multiple transcription factors and multiple binding sites for each factor. the clustering and the combinatorial and redundant nature of the input facilitate the computational search for segmentation control elements. since the expression patterns of the segmentation genes are typically complex, their control regions often contain multiple separate crm's controlling different aspects of the pattern.

the segmentation paradigm has been used as a test system for the computational detection of crms by us and others . here, as before , we use the maternal and zygotic gap factors bicoid, hunchback, caudal, knirps, krüppel, giant, tailless, dstat, and the torre binding factor as input to stubb. the binding site specificity of each factor is characterized by a position weight matrix that is based on a collection of experimentally verified binding sites.

evaluation methodology
the complete genomes of two fruitflies, d. melanogaster and d. pseudobscura have been sequenced, and stubb was used to predict crm's in the d. melanogaster genome. this was done in two modes –  stubbss, where stubb is run on d. melanogaster genomic sequence alone, and  stubbms, where stubb uses orthologous sequence data from d. pseudobscura to help predict crm's in d. melanogaster. for each mode of execution, we obtain a separate list of predicted crm's, sorted in order of confidence in the prediction. the ideal test for our purpose would be to compare the accuracy of these two sorted lists. however, the set of experimentally verified crm's involved in this system is sparse compared to the size of the system – roughly  <dig> crm's are known , while the number of target genes is several hundreds, by our estimate. hence, direct evaluation of the success-rate of predictions is not feasible, and we use an alternative source of information to evaluate predictions, as described next.

a functional crm directs the expression of a gene, by definition, and typically this gene is located in close proximity to the crm. hence, we may map the list of predicted crm's to a list of predicted blastoderm-patterned genes – for each crm predicted by stubb, the nearest gene is identified, and if this gene is less than a threshold distance of  <dig> kbp away, it is predicted to be a blastoderm-patterned gene. the resulting list of predicted "patterned genes" may now be evaluated for accuracy.  the berkeley drosophila genome project  has catalogued the expression patterns of a large number of genes in d. melanogaster, at various stages of development. we considered such a catalogue of  <dig> genes, obtained from bdgp and from the literature.  visual inspection of the expression patterns of these genes revealed that  <dig> of them can be classified as having patterned expression along the anterior-posterior axis.  hence, our benchmark is the entire set of  <dig> genes, the "positive" set is the  <dig> ap-patterned genes, the remaining  <dig> forming the "negative" set. this enables us to evaluate the accuracy of lists of patterned genes predicted by stubbss and stubbms, and compare their performance.

we note that some accuracy is lost in the translation of a list of predicted crm's to the predicted genes it is mapped to, as per the mapping defined above. for instance, it is known that crm's may control a gene located at large distances, i.e., further than the distance threshold of  <dig> kb used in the mapping procedure. also, it is possible that a crm is located close to two genes, and directs the expression of both genes, or only of the farther gene, being somehow insulated from the nearer one. to address these concerns, we repeat our evaluation with a slightly different mapping from the one described above. a caveat that remains is that there may be genomic sequences that are functional, in the sense that they are capable of directing a specific blastoderm pattern in reporter gene constructs, but whose activity is 'silenced' in native genomic context and does not translate to patterning of any gene. also, the crm may direct expression of the gene only at post-blastodermal stages, so that the gene is not included in the "positive" test set of blastoderm patterned genes. conversely, it may also happen that a predicted crm lies close to a patterned gene, thereby being counted as a true positive, but the predicted crm is not the sequence responsible for the gene's regulation. we assume that such effects are not biased against either algorithm.

RESULTS
stubbms performs significantly better than stubbss
in order to further scrutinize the difference in predictions made by the two modes of stubb, we focused on the points where their difference is most pronounced. thus, in the top  <dig> unique gene predictions , stubbss reports  <dig> positives, while stubbms scores  <dig> hits, an improvement of over 56%. in comparison, the random expectation is ~ <dig>  hits. thus the predictions of both stubbss and stubbms are significantly enriched in patterned genes . further examination of the top  <dig> gene predictions made by each algorithm revealed that  <dig> true positives are common to both lists. stubbms reports  <dig> true positives not discovered by stubbss, while the latter reports  <dig> true positives not found by the former. similar results are seen for the top  <dig> predictions :  <dig> correct predictions were common to both algorithms,  <dig> were predicted by stubbms only, and  <dig> by stubbss only. thus there is substantial exclusivity in the sets of true positives of each algorithm.

we next examined separately the following three sets of genes:  intersection   ms-only  and  ss-only . table  <dig> shows the break-down of these sets in terms of the strength of expression of their member genes. overall,  <dig> of the  <dig> patterned genes, i.e., about 43%, are strongly expressed. we find in table  <dig> that the sets intersection and ms-only have more strongly expressed genes than weak and intermediate ones, and the opposite trend is seen in the set ss-only.

one possible strategy that uses two-species sequence is to make predictions using stubbss on each of the two genomes separately and then intersect the respective lists. we found this strategy to be very restrictive – for instance, with a particular score threshold, stubbss predicts  <dig> unique genes in d. melanogaster, but intersecting these predictions with a similar number of top predictions in d. pseudoobscura gives only  <dig> unique genes,  <dig> of which are patterned. of the top  <dig> predictions made in d. melanogaster alone,  <dig> are patterned. thus the "intersection" strategy yields only a modest improvement over the single-species search, and does so at the price of significantly reducing the total number of predictions. similar results were obtained when intersecting modules instead of gene predictions.

we have noted above that the evaluation method is influenced by the way we map the predicted crm's to predicted genes. to offset potential biases induced by this mapping, we repeated our analysis with a slightly different evaluation procedure, borrowing from the approach of grad et al.  <cit> . we now traverse the sorted list of crm's and count a crm as a prediction if either of its two flanking genes has expression information. furthermore, we designate a prediction to be "correct" if either of the two flanking genes has a blastoderm pattern. the assumption, as in grad et al.  <cit> , is that any predicted crm near a blastoderm-patterned gene is a functional crm responsible for some aspect of the pattern. also, we are now counting modules rather than genes, i.e. we are allowing for multiple hits to the same gene. figure 2a plots the results of stubbss and stubbms as per this new method of counting predictions and hits. we again notice a significant improvement in stubbms. for instance, in the top  <dig> crm predictions for which a neighboring gene has expression information, stubbms makes  <dig> correct predictions while stubbss scores  <dig> hits. the gap between stubbss and stubbms increases as more predictions are considered, so that the improvement consistently stays above 20%, as seen in figure 2b. for the remainder of this section, our evaluation method will use the more stringent mapping described earlier, wherein the nearest gene is predicted. since our test data is in the form of lists of genes, we adhere to the evaluation strategy that counts genes. it is clear from figures  <dig> and  <dig> that counting modules rather than genes improves the prediction accuracy, due to multiple crm predictions for some blastoderm-patterned genes.

the default mapping from crm's to genes used in our evaluations predicts a gene to be patterned only if its proximal end is less than  <dig> kb from the crm. schroeder et al.  <cit>  studied the range of locations of experimentally verified crm's relative to the gene. they found that while there is a clustering of crm's within the proximal  <dig> kb region upstream, downstream or intronic of a gene, it is not unusual to have crm's more than  <dig> kb away from the regulated gene. nelson et al.  <cit>  observe that for d. melanogaster, the intergenic space on either side of a gene has a mean of  <dig> kb –  <dig> kb, depending on the complexity of the gene's function. we repeated our evaluation with different values of the distance threshold, and found that lower thresholds  decrease the recovery rate, while higher thresholds  do not affect performance. 

genes in the segmentation hierarchy often have multiple aspects to their expression pattern, with more than one crm regulating them. we therefore measured how the stubb predictions fare if we required that each predicted gene be evidenced by at least two predicted crm's. this heuristic improves the performance of stubbss more prominently than that of stubbms, though much fewer predictions are made by either algorithm.  while  <dig> unique gene predictions were made by stubbss , we now observe that only  <dig> predictions are made using the same score threshold and the new way of counting predictions. thus, it appears that stubbss performance is open to considerable improvement in the top ~ <dig> predictions, by using either the multiple crm restriction or the second species' sequence data. the two-species strategy however is able to increase specificity without loss of sensitivity.

we have, in all tests reported in this paper, used as input a set of  <dig> genes whose expression patterns are available either from bdgp or from the literature. bdgp has a supplementary list of  <dig> genes for which only textual annotation has been made public, since these genes have been found to be either  ubiquitously expressed at all developmental stages,  not expressed at any stage, or  only maternally expressed.  inclusion of these supplementary genes in our data set would approximately halve the overall fraction of patterned genes. when we examine the performance curves of stubbss and stubbms for this pattern-diluted data set , we find that stubbms shows an improvement over stubbss similar in proportion to that in the default data set, even though the prediction specificity of both programs suffers a drop , typically in the range of 10–30%. note, however, that this is substantially lower than the 50% drop one would expect by chance, given that the total number of genes has almost doubled, while the number of patterned genes remains constant.

characteristics of genes predicted by stubbms
our annotations of the blastoderm patterned genes also include whether the gene expression is strong, weak or of intermediate strength; if it has a dorsal-ventral  modulation in addition to the primary anterior-posterior pattern; and if the gene belongs to a "core" set of  <dig> genes that have been shown experimentally to be required for the segmentation of the embryo . we were therefore able to examine the characteristics of the genes correctly predicted by stubb, along these axes of information. the top  <dig> correct  predictions made by stubbms were examined progressively,  <dig> predictions at a time.  in each step, we computed the fraction of the  <dig> genes that belonged to the following three non-exclusive categories:  genes with dv  modulation,  genes with strong expression pattern, and  genes in the "core" set of  <dig> genes. these values are reported in figure  <dig>  we find that

 <dig>  genes with dorsal-ventral aspects to their blastoderm pattern are more frequent at lower ranks of prediction; i.e., the top predictions are enriched in genes with anterior-posterior patterns only.

 <dig>  core genes are predominantly found in the top predictions.

 <dig>  genes found at higher ranks are somewhat more likely to be strongly expressed.

the first two observations imply that the genes more directly involved in the ap axis formation are recovered at better ranks, and that the lower rank genome-wide predictions are richer in derivative patterns characteristic of genes with more complex regulatory inputs . the same trends were found for the correct predictions made by stubbss. 

optimal parameter settings for stubb
we next evaluate the effect of varying how background sequence information is incorporated in the stubb algorithm. this is the only configurable aspect of the program, other than the module length.  one important parameter is the "markov order" of background. a value of k for this parameter means that local correlations are assumed to be present at the level of -mers, i.e., the random probability of seeing a particular base at a position depends on the bases seen at the previous k positions. th order background in the terminology of this paper.) we vary this parameter to take the values k =  <dig> and k =  <dig>  in different runs. the other parameter is the actual sequence used by stubb to measure background nucleotide frequencies. here the two options are  to use the current sequence window as background, or  to use a pre-specified sequence  as background. we call these two the "local" and "global" background models respectively. for the "global" model, we input into stubb  <dig> kb of sequence from non-coding regions of the d. melanogaster genome, collected from the five chromosome arms 2l, 2r, 3l, 3r, and x.

as mentioned earlier, the stubbss program implements the same class of algorithm as the ahab algorithm of rajewsky et al.  <cit> , with some technical differences, and therefore the two programs should produce similar results. we sought to verify this claim by running the ahab program , and comparing its performance to that of stubb.  figure 7a shows that there is not a significant difference between stubb and ahab crm predictions.

all the above runs were on genomic sequence with tandem repeats masked by the tandem repeats finder program of benson  <cit> . we have found that this heuristic improves genome-wide crm prediction by stubb. to substantiate this claim, we ran stubbss and stubbms on raw  genomic sequence. figure 7b plots the results. we find that both stubbss and stubbms perform better on masked data than on unmasked data. however, when stubb is used to analyze shorter sequences , we have found unmasked sequence to be more useful, since false positives are less of a concern.

discussion
the stubb program is an extension of ahab, with the important feature that it can handle two-species data within its probabilistic framework. the two programs differ in their underlying optimization method, with stubb using an expectation-maximization approach in contrast to ahab's conjugate gradient method. performance evaluation of the two programs shows little difference between them, implying that the algorithm is robust to the actual optimization method used. another technical difference between ahab and stubb is in the manner that orientation of binding sites is treated. while stubb assumes a uniform prior on the orientation of a binding site, ahab picks the best orientation for each site, with the caveat that probabilities are not strictly normalized.

an important component of stubb is the alignment step where the two species are aligned  and blocks of high sequence similarity are extracted.  the parameters used in lagan runs were obtained from emberly et al.  <cit> , who derived the alignment parameters that maximize the overlap between experimentally verified binding sites and blocks of sequence conservation. they also studied the effect of changing the alignment algorithm  for crm's in the two fly species, and found no significant difference. finally, the similarity thresholds we use for defining conserved blocks  were obtained by trying a broad range of values, and choosing those that produced the best results, as per our genome-wide evaluation.

tandem repeat masking is a common pre-processing step for many sequence analysis applications involving binding sites. these repeats are short locally duplicated sequences, that may or may not be related to binding sites. it is not clear a priori how tandem repeats should affect module detection – repeats similar to binding sites of the system may improve sensitivity when they occur in crm's; but if repeats resembling binding sites occur by chance in non-functional regions, prediction specificity may suffer. the occurrence of tandem repeats marks statistical deviation from stubb's probabilistic model of sequence generation. in our tests, we found that repeats distract the algorithm more than they help, as manifested in better performance on repeat-masked sequence.  this may be because two of the weight matrices in our collection  resemble a poly-t stretch. therefore, the poly-a or poly-t tandem repeats that occur promiscuously in the genome may be confused with sites of these two weight matrices.

a recently published tool for genome-wide crm prediction, called pfr-searcher , first identifies "phylogenetically footprinted regions" or "pfr"s, that are sequences conserved between the two fly species, and then searches for a subset of these that are most similar in content to an input set of promoters. their approach differs from stubb in the nature of prior information input to the algorithm. while stubb uses an input set of weight matrices, the training data for pfr-searcher is a set of crm's which, in their approach, is itself provided by a similarity search among pfr's of co-regulated genes. pfr-searcher therefore has the advantage of not requiring knowledge of the transcription factor weight matrices relevant to the system. however, its ability to predict the binding site composition of potential crm's is therefore more limited as compared to stubb.  grad et al.  <cit> report an evaluation of their algorithm on a test system very similar to ours, but with enough minor differences to make a direct comparison of performance impossible. for instance, the entire list of crm's predicted in their evaluation corresponds, as per our crm → gene mapping, to a set of only  <dig> unique genes, of which  <dig> are patterned. twenty of these  <dig> correct predictions are also found in the top  <dig> gene predictions of stubbms, indicating a good degree of overlap between the two methods, at least in their highest ranked predictions. a fair and comprehensive comparison of the predictive power of these two algorithms is an interesting topic for future work, and it will be even more interesting to run stubbms only on pfr's detected by their criteria.

regarding the recovery of patterned genes by stubb, several observations can be made. of the  <dig> genes with ap patterns, we recover roughly half at a score cut-off of  <dig>  using stubbms. why is the other half not found? while it is obvious that lowering the cut-off will detect more patterned genes, there are other reasons why a patterned gene may be missed by stubb. some genes are likely to be lost due to the distance filter we have imposed , since the regulatory regions of some genes  are likely to be larger than that. more importantly, most of the patterned genes that are not part of the core transcriptional machinery have derivative patterns that reflect a more complex input  and thus will only be recovered to the extent their input has a solid maternal/gap component. conversely, there are at least two reasons for reporting false positives . the presence of an insulator could prevent the interaction between a crm and its nearest basal promoter. more likely is a scenario where the predicted crm's do drive expression but at post-blastoderm stages. all gap factors are active in multiple tissues in later development and therefore crm's with dominant or exclusive gap input may well be active in these later contexts. these caveats affect all current crm detection algorithms, and accounting for such additional axes of information as genomic context and module composition rules will be a difficult but important challenge for the future.

a very interesting observation comes from the analysis in table 1: genes predicted by stubbss only, and not by stubbms, have weak or intermediate expression pattern more often than strong expression. this means that the crm's that are not well-conserved between the two species  typically correspond to weakly expressed genes. this ties in with previous studies  that found fast evolving genes in drosophila to be expressed relatively weakly.

the stubb program not only predicts cis-regulatory modules genome-wide, it additionally outputs the binding site profile of each predicted crm, i.e., the locations and probabilities of binding sites in the crm. schroeder et al  <cit>  use the corresponding feature in ahab for a systematic analysis of the composition of all known or validated segmentation crms. the use of stubbms improves such binding site predictions. it is easy to adapt the program to take as input orthologous crm's from the two species, and highlight the changes in terms of their binding site compositions. this leads to a powerful bioinformatic tool to predict regulatory changes between the two fly species. we can thus obtain hypotheses about changes in expression patterns, which can be verified experimentally. we have examined a representative collection of crm's, and experimentally verified several of the changes predicted by stubb, thereby building a catalogue of the different modes of cis-regulatory evolution. the results of this study will be reported in the near future.

CONCLUSIONS
we have seen that the use of a second fly genome significantly improves genome-wide module prediction. since stubbms uses a natural "two-species" extension of the algorithm of stubbss, this finding is largely a statement about the inherent potential of cross-species comparison as a paradigm for improving functional genomics. the stubbms program also has a natural extension to incorporate more than two genomes, and it will be very interesting to see how much of a difference a third genome makes. the genome of d. yakuba is expected to be sequenced soon, and since this species is closer to d. melanogaster, it may help better discriminate conserved regulatory modules.

