BACKGROUND
high throughput metabolic profiling has been performed for over  <dig> years  <cit>  on tissue extracts and biofluids. however, due to recent analytical and computational advances, metabolomics, as is now known, is an increasingly popular approach for monitoring multi-parametric responses in complex biological systems with applications ranging from the analysis of unicellular samples all the way to the analysis of complex systems such as plants and mammals. by definition, metabolomics is a comprehensive qualitative and quantitative study of small molecules composition of organisms  <cit> . nmr spectroscopy is one of the most widely used methods for analytical measurement of metabolic profiles in systems particularly because of its reliability, reproducibility, speed and low cost  <cit> .

one of the major challenges in nmr analysis of metabolic profiles is the automatic metabolite assignment from spectra. current approaches include manual assignment based on user experience and the assignment based on binning, curve-fitting and direct comparison of 1d and 2d nmr measurements  <cit>  with and without reference library support. although the two approaches have their merit, the manual assignment is highly biased towards user knowledge and expectations and 2d methods can be time consuming and yet still insufficient for direct assignment  <cit> . at the same time, unlike the classical nmr applications in molecular structure identification, in metabolomic applications, molecular structures of common metabolites are already known and thus assignment of spectra can be done by direct comparison with reference libraries, when these become available.

various approaches were described in previous publications, including:  binning approaches  <cit>  where a spectrum is typically divided into equally or variable sized bins and the intensities in each bin are qualified and quantified via integration techniques;  curve fitting without reference library support, where de-convoluting highly overlapped linearly mixed individual metabolite spectra is achieved via various methodologies ranging from bayesian decompositions  <cit>  and least squares-based non-negative matrix factorization  <cit>  to shape fitting techniques  <cit> ;  curve fitting with reference library support, where least squares strategies  <cit> , bayesian model selection  <cit> , and genetic algorithms  <cit>  are employed, and  direct comparison methods that calculate the overlap of known peaks with peaks from query spectra  <cit> . more comprehensive descriptions of methods and practical aspects of applied metabolomics are described in a number of recent publications  <cit> .

two large collections of 1h-nmr spectra of known metabolites are already available as part of the human metabolome database - hmdb  <cit>  and madison metabolomics consortium database - mmcd  <cit> . thus, for experiments performed under similar conditions as the ones used for creating the reference library, a necessary step for automatic assignment is the development of an efficient bioinformatic tool for comparison, identification and assignment directly from the spectra.

in this paper we introduce metabohunter - an efficient automatic metabolite identification approach that provides three distinct methods and two reference libraries wrapped up in an intuitive, flexible and user friendly web server application. the three methods include:  a novel scoring function that outperforms the simpler peaks match percentages employed by other tools such as hmdb nmr search  <cit>  and metabominer  <cit> ,  an iterative greedy selective approach that minimizes the number of false positives at the expense of slightly increasing the number of false negatives and,  selection approaches with a user adjustable chemical peak drift parameter that allows the identification of mixture metabolites in spectra obtained under slightly different conditions than the ones used for the measurement of reference library compounds. in addition to what other metabolite selection strategies have to offer, our approach includes a simple and intuitive graphical user interface, two manually curated reference libraries of metabolite spectra, a better metabolite scoring function and a set of three selection strategies that, in average, outperform existing methods provided by other publicly available metabolite identification software.

RESULTS
system architecture
metabohunter is a web-server application for identification of metabolites in 1h-nmr spectra of complex mixtures based on two manually curated reference libraries. the individual spectra of metabolites from the reference libraries and the additional metabolite information are stored in plain text files and are also indexed based on their peak locations and original ids for faster access. the user interaction is performed via an intuitive and user-friendly graphical interface powered by php and javascript routines. metabohunter takes as input a full spectrum or a list of peaks and their corresponding measured amplitudes, which can be either provided as text files or pasted directly into a text box. once the input is provided, a session is created for each user and the index files are uploaded. the full spectrum input files are pre-screened based on the noise threshold using custom-built perl scripts and one of the three metabolite selection methods are executed. all three methods are also implemented in perl. the output consisting of a list of potential metabolite matches is presented to the user and further functionality is provided to visualize, compare and download the results. more details regarding the pre-screening process, the metabolite selection methods and the reference libraries are presented in the methods section.

metabohunter testing
different nmr spectra, combinations of molecular spectra as well as spectra of a chemical mixture were used for testing the methods provided as part of metabohunter. validation was performed in all cases by analyzing results of searches using complete, not binned spectra as well as externally determined peak lists. peaks from fid files were determined using mnova software by mestrelab research http://www.mestrec.com. the human metabolomics database  contains different information about many metabolites including their nmr chemical shifts and these were used for the majority of tests presented here. in the test examples shown below we have included metabolites with large and small number of spectral peaks where some peaks were non-unique. results of the search for spectra of several individual metabolites  are shown in additional file  <dig>  table 1s. for the analysis of metabohunter's ability to assign metabolites from the spectra of mixtures we have combined free induction decay  measurements of  <dig> metabolites provided by hmdb into one nmr spectrum. assuming that there are no chemical interactions between molecules, the nmr spectrum of a mixture is a direct sum of spectra of the components. for this test we have selected  <dig> water soluble, i.e. hydrophilic metabolites that were consistently observed in standard 1d 1h-nmr of human cell lines  <cit> . the results of assignments for this spectrum are presented in additional file  <dig>  table 2s. finally, metabohunters's assignment power was investigated against the nmr experimental measurements of a spiked-in urine sample  measured on a  <dig> mhz bruker avance nmr spectrometer and a mixture of  <dig> metabolites  performed in house on a  <dig> mhz jeol jnm-gsx nuclear magnetic resonance spectrometer . the peak databases used by metabohunter include measurements from  <dig> mhz,  <dig> mhz and  <dig> mhz instruments. thus validation with spectra from the  <dig> mhz and the  <dig> mhz shows the possibility of using methods provided under metabohunter platform for assignment of data coming from different nmr field strength measurements. the results of this analysis are shown in additional file  <dig>  tables 3s and 5s. the results reported in additional file  <dig>  table 5s show prediction accuracy for the spiked metabolites and also include a list of  <dig> additional metabolites, such as creatinine, glycine and lysine, commonly found in urine  <cit> , that were correctly identified with our methods.

analysis of metabolite recovery for mh1_hmdb, mh1_mmcd, mh3_hmdb and mh3_mmcd from simulated mixtures of randomly selected library metabolites
a test of the metabolite fingerprinting engine employed in metabohunter for the analysis of nmr peak information was performed first by automatic search of peak list mixtures for n metabolites, where n = 1: <dig>  each result was averaged over  <dig> runs, each run consisting of randomly selecting and mixing the peaks for n metabolites from hmdb and mmcd. this controlled approach can evaluate the ability of the mh <dig> and mh <dig> methods to efficiently recover randomly selected metabolites from the supporting hmdb and mmcd libraries present in various mixtures.

the accuracy of this search, i.e. its ability to return metabolites present in the mixtures, is automatically determined from investigating whether the metabolites are included: a) in the complete list and b) in the top n listed metabolites . when the complete lists of proposed assignments are analyzed, 100%  and respectively 98%  of metabolites  in the single component mixture are found, while for mixtures with more than one metabolite  the decrease in the average percentage of correctly identified metabolites is insignificant for mh1_hmdb  but becomes more drastic for mh3_hmdb . the same effect is observed for mh1_mmcd and mh3_mmcd. the lower percentage obtained with mh3_hmdb for increasingly large numbers of metabolites in mixtures is caused by the high overlaps in shared peaks among library metabolites and the mechanism for selecting metabolites with disjoint peaks adopted in mh <dig> . the same analysis reveals that hmdb nmr search is able to identify only 35% of the metabolites for n =  <dig> and only 26% for n =  <dig> 

if only the top n scored assignments are included, we observe a minor decrease in accuracy of mh <dig> and mh <dig> with the increase of the number of metabolites in the mixture. in this case, over 98% of the time , the top metabolite corresponds to the peak list for n =  <dig> and the accuracy decreases to  <dig> %  and  <dig> %  for mixtures of n =  <dig> metabolites. for the same type of analysis and the same benchmark data, hmdb nmr search is able to retrieve 18% of the metabolites for n =  <dig> and only  <dig> % when n =  <dig> 

the effects of spectral noise originated from partial peak information and chemical shift variations on metabolite identification
we estimated the performance of the proposed methods using data from both spectral libraries under two types of noise - missing peaks  and chemically shifted peaks . following the methodology described by xia et al.  <cit> , we simulated missing peaks by removing from each spectral compound uniformly at random between 0% and 50% of the peaks. the chemical shift variations were simulated by adding random values of ±  <dig> , ±  <dig> , ±  <dig> , ±  <dig>  and ±  <dig>  ppm to each 1h chemical shift. as a first step towards the evaluation of our methods, we applied an exhaustive approach where peaks for each individual metabolite from both reference libraries  were subject to noise adjustments as described above. we repeated the process  <dig> times per metabolite and reported the average value. when peaks were removed at random from each metabolite , on average, no major loss of performance is observed  for up to 20% of peaks removed. the percentage of correctly identified metabolites decreases with removing more peaks, down to approximately 60% assignment accuracy when half of the peaks are removed from each metabolite spectrum. we also notice that both, mh <dig> and mh <dig> methods using hmdb and mmcd reference libraries fare equally well in this case.

nevertheless, the performance of mh <dig> and mh <dig> methods is clearly affected by noise originated from chemical shift variations . for a chemical shift variation of ±  <dig>  ppm, mh <dig> with hmdb and mmcd reference libraries suffers a performance drop from above 90%  to below 40% . when the chemical shift variation increases up to ±  <dig>  ppm, the performance of mh <dig>  drops below 5% . a similar but not so dramatic drop in performance is also noticed for the mh <dig> method with hmdb and mmcd reference libraries. for a ±  <dig>  ppm chemical shift variation, mh3's performance drops down to 6%  and respectively 14% .

as a second evaluation step, we applied the random pooling technique described in  <cit> , where we generated synthetic mixtures by pooling uniformly at random  <dig> metabolites from each of the two metabolite reference libraries . after injecting chemical noise in each metabolite spectrum via chemical shift alterations and random peaks removal, the mixtures were searched against the reference libraries using mh <dig>  mh <dig> and mh <dig> and a successful match is recorded if the mixture metabolite was reported within the first  <dig> results produced by each method. here, our reporting procedure is more stringent and differs from  <cit> , since they adopted a threshold based approach  for their perfect match method, which in turn does not set a limit on the total number of reported matches. the process was repeated  <dig> times for each chemical shift variation and peak removal percentage and the average value was reported . since the mh <dig> method was proposed to alleviate the insufficiencies of mh <dig> caused by chemical shift variations, mh <dig> was only applied to data that suffered chemical shift modifications.

similarly as for the case of single metabolite identification against reference libraries, the noise introduced by chemical shift variations affects the performance of the proposed methods more. figure  <dig> shows that 47% performance loss  is recorded for mh1_mmcd, while only 20% performance loss  was recorded for mh3_hmdb. the best performing method overall is mh2_mmcd, which improves the performance of mh1_mmcd with up to 10% . when compared to the results obtained with metabominer  <cit> , our percentage match - based method, mh <dig>  seems to be affected earlier by smaller chemical shift changes . nevertheless its performance does not deteriorate almost at all when larger deviations are applied on the peak locations. this is in stark contrast to the pm method implemented in metabominer, which loses only 20% in performance for deviations in chemical shift of ±  <dig>  ppm, but drops by more than 70% down to 10% performance for chemical shift changes of ±  <dig>  ppm and ±  <dig>  ppm.

compared to the performance of our methods when single metabolite spectra  are searched against reference libraries, the relatively large size  of the mixture combined with the large size of the reference spectral libraries, adds complexity and difficulty to the metabolite identification problem.

the selection of optimal cut-offs
when a mixture with an unknown number of metabolites is analyzed, the selection of an optimal cut-off point for the metabolite list that will balance specificity and sensitivity and optimize accuracy is important. here we use receiver operating characteristic  curves to shed light on cut-offs that seem reasonable for both, synthetic and experimental data.

each cut-off corresponds to a point on a roc curve. the roc curve has the sensitivity plotted vertically and the reversed scale of the specificity on the horizontal axis. the scale of the horizontal axis is also called the false positive rate. the sensitivity and specificity, and therefore the performance of the system, vary with the cut-off. when comparing roc curves of different methods, good curves lie closer to the top left corner with the diagonal line representing the random solution.

when synthetic data sets containing mixtures of  <dig> metabolites are considered , the highest accuracies  are obtained with mh1_hmdb  with different cut-offs ranging from  <dig> to  <dig>  the second best results were obtained with mh3_hmdb, while the metabolite identification method employed by hmdb nmr search ranks third . when the cut-off is set to be equal with the number of metabolites in the mixture , the same method  marginally outperforms the other four .

data sets syn5_s, syn5_f and syn5_p are synthetic mixtures and exp <dig> and exp <dig> are experimental mixtures. each table cell contains the optimal k cut-off value  and the corresponding maximal accuracy value .

for experimental data sets exp <dig> and exp <dig>  hmdb nmr search, mh1_hmdb and mh3_hmdb perform equally well with accuracies above  <dig> , although in this case, the optimal cut-off is uniformly low  except for mh1_mmcd .

the auc values for synthetic data sets  are highest for the mh1_hmdb method , and they decrease to  <dig>  and  <dig>  for hmdb nmr search and mh3_mmcd. the auc values for experimental data sets drop dramatically below  <dig>  , given that the number of false positives is much higher due to unknown exact metabolite content  and partially due to measurement of spectra using nmr spectrometers operating at much lower frequencies  and thus lower resolution than the instruments used to acquire reference metabolite spectra .

data sets syn5_s, syn5_f and syn5_p are synthetic mixtures and exp <dig> and exp <dig> are experimental mixtures. each table cell contains the area under curve  value calculated using the trapezoid rule  <cit> .

metabolite identification and results ranking
the practical utility of a metabolite identification method ultimately resides in its ability to identify as many metabolites as possible in a given mixture with as many valid matches as possible ranked closer to the top of the results list. in an ideal world, we would like to see the first  <dig> matches for data set syn5_s as being the exact  <dig> metabolites from the mixture.

here we investigate and compare the ability of the proposed methods  to find highly ranked correctly identified metabolites using two metrics, namely the percentage of correctly identified metabolites in top  <dig> results and the average rank of the identified metabolites. the first metric will quantify the solution while the second will qualify each result.

bmrb and mmcd results were obtained using the following parameter settings: mmcd ), bmrb .

bmrb and mmcd results were obtained using the following parameter settings: mmcd ), bmrb .

for experimental mixture exp <dig>  the highest percentage of metabolites out of top  <dig> was obtained with mh1_hmdb with an average rank of  <dig> , while the best average rank  was obtained with mh3_mmcd. for this data set, the hmdb nmr search identified only 25%  of the metabolites with an average rank of  <dig>  the nmr search tools employed by bmrb  <cit>  and mmcd also identify up to  <dig> metabolites with lower average ranks compared to hmdb nmr search.

for experimental mixture exp <dig>  the highest percentage of correctly identified metabolites  was obtained with two methods, namely mh1_mmcd and mh2_hmdb with a chemical shift variation of ±  <dig>  ppm, the latter having the lowest average ranking . nevertheless, the best two average rankings were obtained with mh3_mmcd  and mh3_hmdb . hmdb nmr search identified  <dig> out of  <dig>  metabolites with an average ranking of  <dig> , while the search tools of bmrb and mmcd identified only  <dig> out of  <dig> metabolites.

for synthetic mixtures , the mh1_hmdb method consistently outperforms all the other methods, with match percentages of above 92% and average ranking below  <dig>  for the same data sets, the hmdb nmr search method correctly identifies up to  <dig> out of  <dig> metabolites  for  <dig> out of three data sets with the best ranking of  <dig> . for the third data set , the same method is not able to identify any of the  <dig> metabolites, while the other methods seem to perform relatively well. when spectra of single metabolites are queried against the reference libraries , all of our methods clearly outperform hmdb nmr search, bmrb, mmcd and chenomx profiler, both in terms of percentage of correctly identified metabolites and average ranking.

overall, we notice that mh3_hmdb and mh3_mmcd produce the lowest average rankings regardless of the data set, at the expense of increasing the number of false negatives, while mh1_hmdb and mh1_mmcd typically identify a higher percentage of metabolites, but with slightly lower rankings.

the effect of scoring functions on metabolite identification
our modified scoring function  for metabolite identification was developed to insure that metabolites with larger numbers of peaks that have identical percentages of matched peaks as those with smaller number of peaks, should score higher. we prove that our novel scoring function was valid by performing an exhaustive search of single metabolites queried against the corresponding reference libraries . figure  <dig> shows that metabohunter's metabolite identification accuracy averages 95% when the new scoring function  is used, compared to 59% when the simpler percentage-based function used in hmdb nmr search and other nmr metabolite fingerprinting tools is used.

CONCLUSIONS
metabohunter provides an excellent tool for spectral assignment from 1h-nmr data with a novel and efficient scoring function and several different search methods. in the outlined examples metabohunter's search methods found metabolites included in the spectra with good accuracy. in many cases metabolites in question were obtained with the top, highest score, in the list, however, in some cases they were still listed but with lower scores.

due to the large peak overlaps between different metabolites and the relatively large number of spectra present in the reference libraries, this can be expected and can only be dealt with either by doing multidimensional nmr or by utilizing a spectrum modelling from a more accurate and more focused metabolite database.

we expect that the accuracy of our methods will increase once metabolite spectral libraries obtained with higher resolution spectrometers  will become available. such spectra typically contain more detailed peak resolutions, thus reducing the peak overlaps and increasing the ability of selection methods to choose among potential metabolite candidates present in a mixture.

we also acknowledge that, while metabohunter typically provides high quality results for synthetic and experimental input spectra of 1h-nmr metabolite mixtures with up to  <dig> components, more testing using spectra of mixtures with more components are necessary.

availability and requirements
project name: metabohunter

project home page: http://www.nrcbioinformatics.ca/metabohunter

application type: web server 

