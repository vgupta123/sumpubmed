BACKGROUND
disease is a major driving force of evolution, generating natural selection which acts both on host defences and on genes enabling parasites to overcome those defences. two types of polymorphism have been proposed to result from the co-evolution of interacting host and parasite loci  <cit> . long-term maintenance of polymorphism is predicted by the "trench warfare" hypothesis, resulting from balancing selection acting on both host and parasite genes  <cit> . polymorphism at host and parasite loci is thus predicted to be ancient  <cit>  with substantial phenotypic and molecular diversity within species at population and metapopulation levels. alternatively, in the "arms race" scenario, there is recurrent fixation of favourable alleles by selective sweeps. in this situation, alleles are short-lived, and transient polymorphism is only observable for a short period of time  <cit> . an important topic in population genetics of host-parasite interactions is to understand the ways in which natural selection interacts with the organisms' ecology to promote the occurrence of each scenario in natural populations  <cit> . the occurrence of "arms race" or "trench warfare" dynamics has been studied in controlled laboratory experiments with bacterium-phage systems and theoretical predictions have been tested  <cit> .

the gene-for-gene  relationship, found widely in plant diseases, but also in some invertebrate-parasite systems  <cit> , is a model system for host-parasite co-evolution because the molecular biology of the interactions between host and parasite genotypes is well-understood  <cit> . in the gfg system a host can resist attack by a parasite if it has a resistance  gene which enables recognition of a specific parasite avirulence  gene. a parasite is not detected by a host and resistance is ineffective if the host has a susceptibility allele  or the parasite has a virulence allele . coevolutionary dynamics are driven by indirect frequency-dependent selection , in which the strength of natural selection acting on resistance genes depends on the frequencies of parasite genes and vice-versa  <cit> . the resulting "boom-and-bust" behaviour causes unstable coevolutionary cycles, leading to fixation of alleles in host and parasite populations . in this case, there is a point at which there is balanced polymorphism at the host res and parasite avr loci but this equilibrium is unstable  <cit> . long term maintenance of polymorphism in gfg systems, i.e. via stable equilibrium or cycling of host and parasite allele frequencies, generally requires the existence of a stable equilibrium point at which there is balanced polymorphism at res and avr loci. conditions for such a stable equilibrium have been the subject of theoretical population genetics studies which have emphasised the existence of genetic fitness costs associated with resistance and virulence alleles  <cit> , prompting attempts to estimate such costs experimentally  <cit> .

however, an important recent theoretical result is that direct frequency-dependent selection , in which the contribution of an allele to fitness depends on its own frequency, is necessary for balanced polymorphism to be maintained  <cit> . specifically, polymorphism can be stabilised if direct fds is negative, so that the allele's net contribution to fitness declining with increasing frequency. diverse epidemiological and ecological processes which act within a single population generate negative direct fds and stabilise polymorphism  <cit> . crucially, while fitness costs of resistance and virulence alleles are required to generate coevolutionary cycles, they do not generate direct fds  <cit> . in other words, a single-locus gfg model, in which each host and parasite locus has two alleles, with discrete non-overlapping generations of haploid parasites and haploid or selfing plants, generates an "arms race" with recurrent fixation of host and parasite alleles, if the life cycle of host and parasites are synchronised and disease transmission is frequency-dependent  <cit> .

most organisms exhibit some degree of spatial structuring of their populations, which has two main influences on the dynamics of host-parasite systems. firstly, metapopulation structure, in which a species exists as a set of local host and parasite demes, generates demographic processes such as random genetic drift, limited dispersal between demes and extinction-recolonisation events, driving local adaptation of hosts or parasites  <cit> . however, metapopulation dynamics within a homogeneous environment, in which coevolutionary parameters are identical in all demes, do not in themselves stabilise a model which would otherwise be unstable in a single population  <cit> . secondly, the ranges of most species extend over diverse ecological habitats which generate different rates of natural selection, driving local adaptation of populations to abiotic and biotic environments  <cit> . since the seminal work of levene  <cit> , much theoretical work has focused on the mathematical conditions for maintenance of polymorphism for a diploid species in two  niches linked by gene flow with different selective coefficients for different alleles  <cit> . briefly, a heterogeneous environment with different strengths of natural selection in different demes and weak coupling between demes, i.e. low level of gene flow, favour stable local and global polymorphic equilibria by migration-selection balance  or heterozygous advantage  <cit> .

a general theory which summarises the dynamics of coevolution in a spatially heterogeneous environment is the 'geographic mosaic of co-evolution'. this proposes that variation in selection pressures between demes is caused by heterogeneous abiotic conditions generating 'hot' and 'cold' spots of coevolution  <cit> . gavrilets and michalakis  <cit>  analysed a general model for coevolution in heterogeneous environment. polymorphism may occur in a multilocus gfg system in a metapopulation where heterogeneous selection is generated by hot and cold  spots  <cit> . theoretical and experimental studies considered heterogeneity in space for the cost for the host of being diseased or absence of parasite  <cit> . in this paper, we bring together the theory of host-parasite coevolution in single populations with that of heterogeneous environments, and investigate the conditions which lead to balanced polymorphism at host and parasite loci both in individual demes and in the metapopulation as a whole. this study has four objectives.

first, we connect the existing theory  <cit>  to host-parasite coevolutionary models  <cit> , by showing that migration-selection dynamics generate negative direct fds.

second, we show that in gfg models, negative direct fds arising from gene flow between demes with different environments can stabilise polymorphism at interacting host and parasite loci.

third, we extend previous work  <cit>  to relate the strength of direct fds and the conditions for occurrence of stable polymorphism to the parameters which describe plant-parasite interactions involving gfg relationships. in particular, we highlight the importance of costs of resistance and virulence for the metapopulation dynamics of gfg coevolution, and show that these costs are not needed in every deme for polymorphism to be stable.

fourth, we discuss the relevance and implications of our results for empirical studies. we recommend testing for the existence of genetic costs for resistance and virulence alleles and measuring their environmental variability in crop and natural plant-parasite systems  <cit> , and their influence on coevolutionary dynamics in bacteria-phage systems  <cit> .

general model of selection in heterogeneous habitats
model description
we consider a metapopulation divided into n demes connected by migration in which a gene has two alleles, g and g, with frequencies gi and gi respectively in deme i . the species in the model is either haploid or, if diploid, is selfing with no remaining heterozygosity at the locus in question. we assume that soft selection occurs because plants compete for resources locally and thus the number of individuals per deme is fixed   <cit> ; specifically, we assume for convenience that all demes have infinite population size. each generation takes place as a two step process: 1) natural selection occurs within each deme, altering allele frequencies, then 2) migration occurs between demes . in deme i, allele g has a fitness of  and allele g a fitness of . after natural selection has occured in deme i, the frequencies of the two alleles are:

 gi′=gi1-τi1-giτi-giσi 

and

  gi′=gi1-σi1-giτi-giσi 

where gi' is the frequency of g in deme i after natural selection .

throughout this paper, we analyse ratios of allele frequencies to calculate frequency changes between generations. this has two advantages over the more usual analysis of frequencies of single alleles . firstly, it dispenses with complicated terms for mean fitness, greatly simplifying differentiation of functions of allele frequencies. secondly, in the absence of direct fds, the rate of change of the logarithm of the ratio of the frequencies of two alleles at a locus  is constant if the strength of natural selection is independent of allele frequencies. a non-zero first derivative of the rate of change of the logit-frequency therefore implies the existence of direct fds.

after natural selection has occurred, there is a migration phase during which deme i receives alleles from other demes . gi″ and gi″ are then the frequencies of the two alleles in deme i after the migration step , at the end of the generation under consideration:

  gi′′gi′′=gi′li+ ∑j≠igj′mjigi′li+ ∑j≠igj′mji 

where mji is the proportion of the population in deme i which originated in deme j  and li=1-∑j≠imji is the proportion of the population in deme i which originated in deme i itself. we assume that the allele of interest does not affect the probability of migration.

if there is no direct fds, the strength of natural selection on an allele does not depend on its frequency, so the change in log  over a generation is independent of gi. if γi = log and Δγi = γi″-γi, the change in γi between generations, then for given values of allele frequencies gj and gj in demes j ,

  Δγi= log1-τili+φiσi-τi+gi-11-σi1-σili+ψiτi-σi+gi-11-τi 

where φi and ψi are constants for given values of gj and gj and depend on the migration rates  and the selection coefficients in deme j :

 φi= ∑j≠igj1-τjmji1-gjτj-gjσj 

and

 ψi= ∑j≠igj1-σjmji1-gjτj-gjσj 

from , dΔγi/dγi <  <dig> when there is migration  and σ, τ or both differ between at least some demes . hence, there is negative direct fds, with the net benefit of allele g to fitness declining  as its frequency increases. dΔγi/dγi is never positive, so the selective advantage of an allele never increases with increasing frequency.

the conditions for metapopulation structure to generate negative direct fds in deme i  are therefore that the selection coefficients  on the alleles differ between deme i and one or more other demes  and that there is gene flow  from other demes into deme i . in biological terms, negative direct fds is generated by heterogeneous environments in a metapopulation because as gi increases, the net loss of g alleles from population i to other populations increases. hence the net rate of selection for g  in deme i falls as gi rises. this is the process described elsewhere as direct fds  <cit> . these are necessary but not sufficient conditions for stable polymorphism, because an additional condition is that the two alleles must have identical mean fitnesses at some value of gi/gi to generate balanced polymorphism due to migration-selection balance  <cit> . note also that negative direct fds is also generated if migration precedes selection .

gene-for-gene model in heterogeneous habitats
methods
model description
both hosts and parasites are haploid or selfing with no heterozygotes at the loci of interest and the population is of infinite size with a soft selection model. there are n demes. infection is monocyclic, with each plant attacked once by one parasite in each generation  <cit> . in this simple gfg system, a plant has one locus with two alleles, resistant  and susceptible , and the parasite one pathogenicity locus with two alleles, avirulent  and virulent . a parasite is not detected by a host and resistance is ineffective if the host has a susceptibility allele  or the parasite has a virulence allele ; in this case the fractional reduction in a plant's reproductive fitness being diseased is si in deme i . when the plant has a res allele matching the avr allele of the parasite by which it is attacked, the plant mounts a successful resistance reaction, preventing the parasite from causing disease. the plant fitness is thus  <dig>  and the fitness of avr parasites attacking res plants is 1-ci. normally, ci ≈  <dig> as these attacks are usually unsuccessful , but note that ci <  <dig> leads to a model of partial resistance  <cit> . the res and avr alleles have constitutive fitness costs ui and bi to hosts and parasites respectively in deme i  <cit> . in the metapopulation, gfg co-evolution takes place in a spatial structure in which demes are linked by migration of host seeds or pollen and of parasite spores. as in , selection in each deme takes place before migration between demes. we use models of gene frequencies, typical of population genetics, to investigate long-term outcomes of coevolution over time-scales of hundreds or thousands of generations; this means that epidemiological and life-cycle parameters are not specified explicitly but absorbed in the four fitness costs. our model therefore implies that, as in most previous theoretical research on the gfg system, epidemiological processes can be regarded as density-independent.

all parameters are in the range  <dig> to  <dig> 

extending the notation of , the subscripts h and p refer to the host and parasite. ri is the current frequency of res resistance alleles in deme i , and ri'  the frequency in the next generation. similarly ai and ai are the frequencies of avirulent  and virulent  parasites. the recurrence equation for the change in the ratio of res to res hosts in deme i between generations is calculated from table 1:

 ri′ri′=ri1-ui1-siailhiri1-silhi+ ∑j≠irj1-sjmhji 

  +∑j≠irj1-uj1-sjajmhjiri1-silhi+ ∑j≠irj1-sjmhji 

similarly, in the parasite population, the recurrence equation for the ratio of avr to avr frequencies in deme i is:

 ai′ai′=ai1-cirilpiai1-bilpi+ ∑j≠iaj1-bjmpji 

  +∑j≠iaj1-cjrjmpjiai1-bilpi+ ∑j≠iaj1-bjmpji 

in , host and parasite allele frequencies at generation t+ <dig> are composed of a fraction lhi  from deme i, and the sum of fractions mhji  of migrants from all other demes j ≠ i to deme i. there are trivial equilibrium points where one allele is fixed in each species throughout the metapopulation but there is also a non-trivial, interior equilibrium where ri=ri′=r^i and ai=ai′=Âi. values of the equilibrium frequencies of host alleles when the parasite  migrates between demes, or vice-versa, are derived in the additional file  <dig>  section  <dig>  equilibrium frequencies in the parasite population depends on the host costs, u and s  <cit> , and also on the host migration parameters . similarly, host allele equilibrium frequencies depend on the parasite fitness parameters b and c, as well as on parasite migration rates .

in the special case when there is no migration in either species, the dynamics of the gfg system is described by a pair of recurrence equations for a gfg model in a single population  <cit> :

 ri′r′i=riri⋅1-ui1-siai1-si 

and

  ai′ai′=aiai⋅1-ciri1-bi 

in addition to trivial equilibrium points, the non-trivial, interior equilibrium is defined by ri=ri′=r^i and ai=ai′=Âi:

 r^i=bici 

and

  Âi=ui1-sisi1-ui 

this equilibrium point is unstable in a population which is not connected to any other population, because there is only indirect fds, and not negative direct fds in . any deviation of gene frequencies from equilibrium ultimately results in fixation of host and parasite alleles  <cit> .

model description with  <dig> demes
for further analysis of the gfg coevolutionary model, we simplify the system of equations  into a model of two demes linked by migration. we assume symmetrical migration between the two demes , so that mpij = mpji = mp and mhij = mhji = mh. host  and parasite  migration rates can be chosen with equal or different values. the cost of resistance, cost of virulence, cost of being diseased and cost to an avr parasite of infecting a res plant are respectively u <dig>  b <dig>  s <dig> and c <dig> in deme  <dig> and u <dig>  b <dig>  s <dig> and c <dig> in deme  <dig>  the system of equations  becomes as follows for deme 1:

  r1′r1′=r1+mhr2r1+mhr <dig> 

and

  a1′a1′=a1+mpa2a1+mpa <dig> 

without migration, mp = mh =  <dig>  this system collapses to the gfg system analysed in  <cit> , which has no stable equilibrium at which the host and parasite are polymorphic.

RESULTS
analytical results for a gfg model with n demes
we first demonstrate that gene flow between heterogeneous demes generates negative direct fds on both res and avr loci. for simplicity of notation from , the frequencies r˜i and r˜i of the res  alleles after selection and before migration are r˜i=ri1-ui1-siai and r˜i=ri1-si. the change in the log-ratio of the frequencies ri and ri at the end of generation t, ρi = log, is

 Δρi= logr˜ilhi+ ∑j≠ir˜jmhji 

 -logr˜ilhi+ ∑j≠ir˜jmhji-ρi 

so the rate of selection on resistance in the host population is :

 dΔρidρi=-r˜irilhi ∑j≠ir˜jmhji+r˜irilhi ∑j≠ir˜jmhjir˜ilhi+ ∑j≠ir˜jmhjir˜ilhi+ ∑j≠ir˜jmhji 

  +∑j≠ir˜jmhji∑j≠ir˜jmhjir˜ilhi+ ∑j≠ir˜jmhjir˜ilhi+ ∑j≠ir˜jmhji 

this differential is never positive. it is always negative, especially when gene frequencies are close to the equilibrium point, implying that there is negative direct fds on the res gene if there is migration between population i and other populations and if the fitness cost of resistance  or the cost of disease  differs between at least some populations, i.e. for some demes j, ui ≠ uj . note that these results do not assume any specific pattern of migration in the metapopulation.

similarly for the parasite frequencies, writing Ãi=ai1-ciri and ãi=ai1-bi, the change in αi = log is

 Δαi= logÃilpi+ ∑j≠iÃjmpji 

 -logãilpi+ ∑j≠iãjmpji-αi 

the equation that describes direct fds on the avr locus is thus:

  dΔαidαi=-1+aiai1-cirilpiÃilpi+ ∑j≠iÃjmpji+1-bilpiãilpi+ ∑j≠iãjmpji 

this differential is never positive, implying that negative direct fds on the avr gene is generated by migration of the parasite between populations in which the cost of virulence  or the cost to being unable to infect a res host  varies between at least some populations , i.e. for some demes j, bi ≠ bj .

we are interested here in the stability of a local equilibrium point , which is given by the eigenvalues of the jacobian matrix ji for the given dynamical system .

  ji=dΔρidρidΔρidαidΔαidρidΔαidαi 

for the polymorphic equilibrium to be stable in a discrete time dynamical system, both eigenvalues of ji must lie within a unit circle centered on  in the complex plane. in other words, a necessary condition for stability is that the trace of the jacobian matrix  is negative. this is the case if dΔρi/dρi + dΔαi/dαi <  <dig>  <cit> . this condition implies that there is negative direct fds at either the res locus, the avr locus or both, because the change in ri depends on its own value as well as on ai and vice-versa .

analytical results for a gfg model with two demes
having shown in  that direct fds is generated in this gfg coevolutionary model with n demes, we now investigate which coevolutionary parameters are most important for promoting stable, balanced polymorphism in a simplified gfg system with  <dig> demes . in the following analysis, the frequency θi of coevolutionary cycles is calculated close to the internal equilibrium point in a single deme i . this can be computed approximately by linearising the system of equations around the interior equilibrium point. without migration, in deme i,

  θi≈12πarccos{1+biuicisi}− <dig>  

. θi depends strongly on the values of bi and ui, either of which increase θi. the frequency of cycles depends more weakly on si, increasing with si especially when si is not much greater than ui. in the usual case when ci is close to  <dig>  variation in ci does not affect θi greatly.

in our gfg system with two demes, the difference between the frequencies of oscillation of the coevolutionary cycles in the two demes is proportional to :

  Δθ∝∣b1u1s1-b2u2s2∣ 

we can then calculate the diagonal coefficients of the jacobian matrix j <dig> in deme  <dig> as a function of the equilibrium allele frequencies and the difference between the oscillation frequencies . we assume b <dig> = b and b <dig> = b + β but equal costs u and s between demes :

  dΔρ1dρ1≈-b1-buâmh4πΔθ1-2b1-mh+b1-buâ 

this implies that as the natural oscillation frequencies in the two demes diverge  because the costs of virulence b <dig> and b <dig> differ between demes, the strength of direct fds on r changes in the two demes. with increasing Δθ , direct fds thus becomes more negative in the deme with the lower cost b , and less negative in the deme with the higher cost b .

now assuming different costs of virulence u  or of disease s  but equal b  between demes:

  dΔα1dα1≈-buÂâmp4πΔθâ-Â1-mh+buÂâ 

as s or u diverges between demes, Δθ increases  so direct fds alters, with dΔα2/dα <dig> becoming more negative in the deme with lower u or higher s . conversely, dΔα1/dα <dig> becomes less negative in the deme with the higher u or lower s .

equations  demonstrate a close relationship between Δθ and direct fds. this can be analysed close to the interior equilibrium point when the host cost parameters, s and u, are the same in both demes and there is no gene flow in the pathogen, or when the cost of pathogen virulence, b, is constant and there is no host gene flow. in the former case, Δθ increases and dΔαi/dαi, becomes more negative as b diverges between demes . in the latter case, Δθ increases and dΔρi/dρi becomes more negative as the cost of being diseased, s diverges between demes, and also as u diverges so long as ui ≲ s/ <dig> in deme i , additional file  <dig>  section 7).

simulation results for  <dig> demes
we explore the behaviour of the gfg model with two demes  with respect to the various coevolutionary parameters in order to determine the parameters which most strongly influence the coevolutionary dynamics. analytical conditions for the non-trivial equilibrium point to be stable cannot be derived because the dynamics of  are non-linear and there is no general solution for  in a closed form. the quantitative behaviour of the system in general was therefore studied using numerical simulations.

when different demes have different values of one or more of the four parameters b, c, u and s, they oscillate at different frequencies  and figures  <dig>  2). if the frequencies of the oscillations differ sufficiently between two or more of the populations and the demes are connected by migration , the equilibrium points in all populations become stable rather than unstable . stabilisation of the oscillations is particularly responsive to differences in values of b and u, and to s when s is close to u . progress to stability is also determined by how far the initial gene frequencies are from the  equilibrium in each deme. in a system of two demes, if the initial frequencies are far from equilibrium in both demes, the dynamics are unstable in both locations . if one or both demes are initially close to equilibrium, however, both of them can evolve to stable polymorphism if migration rates lie within an appropriate range . mathematically, this behaviour is explained by the existence of stable limit cycles  <cit> . this is biologically important because, when a new allele arises by mutation or by migration from a remote population, its frequency is almost invariably far from equilibrium. this does not destabilise the system, however, because all demes can evolve to a new stable equilibrium.

we investigated the occurrence of stable polymorphism quantitatively by simulating a model with fixed costs in deme  <dig> . the costs of resistance and virulence were low, consistent with empirical evidence  <cit>  and in line with previous theoretical studies  <cit> . the rates of migration  and costs in deme  <dig>  varied and the outcome of coevolution was recorded after  <dig>  generations. the system was considered to be stable when the amplitude of the fluctuations of allele frequencies decreased over time and converged to an equilibrium value in both demes for three initial frequencies of resistant and virulent alleles . this ensured that limit cycles occurred only for initial allele frequencies below  <dig> . combinations of parameter values in deme  <dig> were order in relation to the width of migration rate range, between the critical upper and lower values, which promoted stable polymorphism .

the stability  or instability  of the gfg system depended on the balance between the strength of selection and the migration rate . more precisely, stability arose with increasing difference between the natural periods of oscillation in the two populations , additional file  <dig>  section 7). asynchrony between oscillators is thus responsible for stability in gfg systems because it creates negative direct fds  and additional file  <dig>  section7). in general, polymorphism occurred within an intermediate range of migration rates for given b, u, s. below this range, demes behaved independently of one another and thus had unstable co-evolutionary dynamics . above this range, all demes were synchronised to a frequency intermediate between the natural frequencies of each deme and the dynamics were unstable in all demes, with allele frequencies  spiralling outwards to fixation of virulent and susceptible alleles . variation between demes for costs of virulence  was an important factor promoting stability. variation between demes in the cost of being diseased  and cost of resistance  influenced the stability of polymorphism to a lesser extent. the smallest range of migration rates for which stable polymorphism was observed occurred for absence of costs in deme  <dig> . finally, comparing b <dig> or u <dig> =  <dig> ,  <dig>  and  <dig>  in figure  <dig>  other things being equal, increasing costs of resistance or virulence in deme  <dig> above values in deme  <dig> did not necessarily favour stable polymorphism. this counter-intuitive result occurs because direct fds is determined by the difference of the values of costs between demes in a non-linear manner .

the results of figure  <dig>  based on the system of equations , can be generalised to a system with arbitrary number of demes, because stability occurs in all populations in a deterministic model . as shown analytically , the system can be stable both in all demes and in the whole metapopulation if resistance, virulence or both are cost-free in some  demes .

transient polymorphism in a homogeneous metapopulation with two demes
an interesting special case occurs in a metapopulation with a homogeneous environment when all demes have the same set of parameter values but the initial allele frequencies are distant from equilibrium and differ between demes. examples are provided for this model based on the system of equations  assuming u <dig> = u <dig>  b <dig> = b <dig>  and s <dig> = s <dig>  there is first a transient phase in which allele frequencies move towards the unstable, interior equilibrium, driven by exchange of alleles between demes in which allele frequencies differ . as frequencies converge on the equilibrium point, the dynamics in the two demes become synchronised, then the graph spirals outwards and alleles become fixed . increasing migration between demes shortens the length of the initial transient phase of quasi-stabilisation .

simulation results for the gfg model with  <dig> demes
a stochastic version of the gfg model with four demes, based on equations  illustrates a realistic situation with finite, variable host and parasite population sizes . at each host generation, a random number of individuals of each genotype is added to or removed from the populations, the maximum change being a fraction f . for instance, the number of res plants added in a given generation is: Δr = nrfσ where σ is a random number from a uniform distribution between - <dig> and  <dig>  the results  are very similar to those of the deterministic model . while allele frequencies spiral towards equilibrium, stochastic events nudge them away. this results in allele frequencies cycling around the theoretical equilibrium, particularly when genetic drift is limited. higher values of genetic drift, and smaller population size  lead to increased stochasticity and higher probability of allele fixation .

discussion
it has been proposed that spatial subdivision of populations maintains genetic diversity  <cit> , in particular at genes controlling pathogenicity in parasites and resistance in hosts  <cit> . more specifically, it has been shown theoretically that spatial heterogeneity in a metapopulation can contribute to stabilising polymorphism in these genes if different demes have different environments, such that the coefficients of natural selection acting on the host or parasite vary between some or all demes  <cit> . the coefficients of natural selection include the cost to a host of being diseased  <cit>  and, here, the genetic costs of host resistance and parasite virulence in a gfg system.

the theory reported here describes the genetic processes which underpin the stabilisation of polymorphism in coevolving hosts and parasites in a spatially structured population. it is shown that gene flow within a heterogeneous environment generates direct frequency-dependent selection, which can act together with the indirect frequency-dependent selection inherent in host-parasite interactions to generate long-term, balanced polymorphism at interacting host and parasite loci. this is consistent with the "trench warfare" scenario of host-parasite coevolution  <cit> . note that the derivation of the mathematical conditions for the global stability of polymorphism and polymorphism in all demes lies beyond the present work, for which we refer readers to previous studies  <cit> .

the fitness of host organisms depends on gene frequencies in their parasites and vice-versa. this process, which is well-understood  <cit> , is an example of indirect fds  <cit> . together with costs of resistance  and virulence , it causes the frequencies of interacting host and parasite alleles to cycle. the oscillations are centred on an equilibrium point at which there is polymorphism at the corresponding loci in the two species .

direct frequency-dependent selection
gene flow in a heterogeneous environment generates direct frequency-dependent selection, such that the selective advantage of an allele in either species declines as that allele becomes more common . this has been described as balanced polymorphism due to heterogeneous habitats or migration-selection balance  <cit> . in the models of host-parasite coevolution analysed here, direct fds acts together with indirect fds to cause the cycles of gene frequencies to stabilise at a state of balanced polymorphism . in the absence of ecological or epidemiological processes which generate direct fds, the equilibrium is unstable and the oscillations expand outwards resulting ultimately in fixation of alleles in both species . when demes have different environmental conditions, resulting in different values of u, b or the cost to a plant of being diseased , the periods of the cycles of gene frequencies differ . in accordance with the general results from  <cit>  in single species models and those of nuismer for a gfg model  <cit> , we show that greater difference in these coevolutionary parameters between two or more demes generates more strongly negative direct fds and therefore a greater potential for stability of the polymorphic equilibrium point. our first important result  therefore demonstrates that migration-selection balance is a case of direct fds. note, however, that each deme's equilibrium point is only stable over a range of low migration rates  <cit> . this principle also applies widely to biological interactions, since prey and predator numbers can also be stabilised by damping of oscillations in their numbers, for example if there is spatial variation such as a gradient of birth rates  <cit> .

damgaard  <cit>  investigated a gfg model in a metapopulation where stable polymorphism occurs without costs of virulence or resistance . that model has spatially heterogeneous incidence of a second parasite species in a metapopulation with high rates of extinction and recolonisation of demes, and recolonisation of patches via a seed bank. we suggest that this model favours the occurrence of stable polymorphism because it comprises two features generating direct fds, disease severity varying in space due to the prevalence of a second parasite  and a seed bank  <cit> .

role of costs of resistance and virulence
costs of resistance  and virulence  are required to drive the cyclical dynamics of host and parasite gene frequencies in the gfg model. a positive value of u reduces the frequency of resistance when virulence is common  while a positive value of b reduces the frequency of virulence when resistance is rare . our second important result states that, in a metapopulation, direct fds is generated such that polymorphism can be stable even if one or both of these costs is zero in some demes, so long as they each have positive values in at least one deme . this implies that the observation of polymorphism in a given deme does not imply that the res and avr alleles are costly in that deme. instead, the deme may be linked by migration to other, possibly unobserved demes where b, u or both are positive . this is consistent with the lack of empirical evidence for high costs of res and avr alleles  <cit> , with a few significant exceptions  <cit> .

a third important result is that heterogeneity in costs of virulence  and to a lesser extent resistance  alleles are the main drivers for generating direct fds and stability of polymorphism . in fact, variability among demes only for the cost for a plant of being diseased  may not create strong differences in oscillations between demes . models  <cit>  and empirical tests  <cit>  of the geographic mosaic of coevolution have highlighted the importance of variation for disease severity or presence/absence of parasites for driving the coevolutionary dynamics . most observations of the coevolutionary dynamics have thus focused on revealing heterogeneity for disease severity or disease presence depending on local ecological conditions  and genotype-by-genotype-by-environment interactions  <cit> . our results indicate, however, that to understand the mechanisms maintaining genetic variability at plant resistance and parasite virulence genes it would also be fruitful to study variation in the costs of virulence  <cit>  or resistance  <cit>  alleles in different environments. recent experimental evidence for variability of costs has paved the way for future empirical tests of similar variability in natural populations. however, little is known as yet about the genetic mechanisms generating variation in costs in response to physical characteristics of habitats, such as temperature or humidity. our results also suggest that variability in levels of partial resistance between demes  and table 1) may not create strong differences in oscillations between demes , and thus may not be a main determinant in promoting stable polymorphism in gfg systems  <cit> .

metapopulation with homogeneous environment
in a metapopulation in which all demes have identical environments, transient polymorphism can be generated in two ways. firstly, as shown here, unstable dynamics can create an impression of stable polymorphism across the metapopulation ; this has been described as 'statistical polymorphism' in prey-predator models  <cit> . in a metapopulation with a high rate of population extinction, recolonisation of demes produces large, random variation in allele frequencies between populations, sustaining transient polymorphism and thus increasing the lifetime of alleles  <cit> , especially when there are several interacting pairs of res and avr genes  <cit> . asynchrony can arise between identical coupled oscillators, providing that each one has a specific noise function  <cit> . this implies that negative direct fds may arise in a homogeneous metapopulation if each deme exhibits high levels of random processes such as drift and extinction-recolonisation with different statistical characteristics  <cit> . note that the model of frank  <cit>  maintains polymorphism in an homogeneous metapopulation by considering density-dependent disease transmission following a lotka-volterra model for multiple gfg loci in host and parasite. density-dependence disease transmission, central to ecological feedback models  <cit> , generates negative direct fds and thus to stabilises gfg polymorphism in single populations  <cit> .

secondly, when host and parasite migration is limited to adjacent demes, and initial frequencies differ between populations, waves of genotypes can spread in the metapopulation  <cit> . asynchrony can then be maintained by a few patches which are out of phase with the rest of the metapopulation and act as pacemakers  <cit> , potentially leading to damping of local oscillations and stabilisation of gene frequencies, analogous to the process shown in figure  <dig>  polymorphism is thus present in the metapopulation as a whole, but not in each deme. it remains for empirical studies to be designed to test the existence of such phenomena .

observing gfg coevolution
observation of the long-term dynamics of polymorphism at interacting host and parasite genes and empirical tests to distinguish the "trench warfare" and "arms race" scenarios require either the collection of very long time series for host and parasite populations  <cit>  or the inference of past evolutionary events from sequence data  <cit> . the increasing availability of genomic data for multiple genes and multiple populations may allow tests of a wide range of complex coevolutionary scenarios  arising from heterogeneous abiotic conditions in space and genotype-by-genotype-by-environment interactions  <cit> .

the most promising body of empirical research testing coevolutionary scenarios analogous to our theory comes from controlled laboratory experiments of coevolving populations of phages  and bacteria . even though bacteria-phage systems may not present gfg interactions, but may have inverse-gfg relationships  <cit> , coevolutionary dynamics are observed in those experiments. the influence of key components of the theory on geographic mosaic of coevolution on actual coevolutionary dynamics has been empirically tested. these factors include for example gene flow across a spatially structured landscape with productivity gradients  <cit> , the importance of migration of hosts from parasite-free demes  <cit> , or the effect of dispersal from hot-spots to cold spots and vice versa on the speed of coevolution  <cit> .

these experimental designs of structured heterogeneous populations with gene flow can be adapted to test experimentally key predictions from gfg models. genetic variation in the costs of bacterial resistance or viral virulence alleles can be quantified  across environments . values of host fitness reduction upon infection determine both the expected frequencies of coevolutionary cycles  and the occurrence of stable polymorphism in different demes linked by migration  <cit> . this study indicates that heterogeneous costs of resistance or virulence between demes  is a more important determinant of stability in a coevolving host-parasite interaction rather than heterogeneous distribution of the cost of being diseased. our results imply that in a homogeneous metapopulation, high gene flow synchronises all demes to the most unstable dynamics, a phenomenon which can be tested empirically . finally, our simulations suggest that in an heterogeneous metapopulation, each deme presents a specific coevolutionary dynamics characterized by its equilibrium point and frequency of oscillations . our results agree thus with theoretical  <cit>  and empirical  <cit>  studies implying that host-parasite adaptation may not be positively correlated in space and time.

finally, our gfg model assumes that epidemiological processes are density-independent, and makes the simplifying assumption that population sizes are equal between demes. when realistic host-parasite systems are considered, one may expect parasite and host dispersal to depend on the density of susceptible and infected hosts in each patch. fluctuations in host density across patches would thus potentially affect patterns of local adaptation  <cit>  and maintenance of stable polymporphism. future analysis of coevolution would thus benefit from integrating epidemiological processes and ecological feedback  into current gfg models.

CONCLUSIONS
the general principle that migration in heterogeneous metapopulations can stabilise polymorphism in gfg interactions is applicable to any system of victims and exploiters, including interactions between animals and parasites, predators and prey, and hosts and parasitoids  <cit> . it provides a mechanism to drive the maintenance of biological diversity in models of the geographic mosaic of co-evolution  <cit> . we predict that the gfg polymorphisms which are observable in nature may involve genes which have fitness costs that vary due to varying abiotic or biotic conditions in space  or in time . our results also support the view that monoculture in arable or livestock farming increases the risk and potential severity of disease  <cit> , not only because genetic diversity is limited but also because agricultural environments are simplified and generally uniform.

authors' contributions
at and jkmb designed and performed research, and wrote the paper. all authors read and approved the final manuscript.

supplementary material
additional file 1
additional information for analytical results. the file contains  <dig> sections describing details of the analytical derivations.

click here for file

 additional file 2
figure s <dig>  the file contains the figure s <dig> 

click here for file

 acknowledgements
the authors thank two anonymous referees for helpful comments. this research was supported in part by the biotechnology and biological sciences research council. a.t. acknowledges support from the volkswagen stiftung  and dfg grant .
