BACKGROUND
the assessment of differences between communities is an important problem in ecological studies. by comparing the compositions of natural communities from different environments, locations or time periods, we can learn how specific factors affect community assembly and how species or individuals associate with each other  <cit> . the development of next-generation high-throughput sequencers, such as the  <dig> life sciences genome sequencer flx system, the illumina 1g genome analysis system, and applied biosystems solid sequencing, has profoundly changed our approaches to ecological studies. with the rapid development of sequencing technologies, it is now possible to sequence a particular gene, such as 16s rrna sequences, at very high depth without culturing  <cit> . the new sequencing technologies also make it possible to efficiently and economically sequence the whole metagenome within a community  <cit> . these techniques have revealed high microbial diversity present in the ocean, soil and human tissues.

many statistics have been proposed to compare communities based on genomic sequence data of a specific gene sampled from the communities. these include libshuff  <cit> , ∫-libshuff  <cit> , analysis of molecular variance   <cit> , and homogeneity of molecular variance   <cit> . they mainly depend on the distances or similarities between sequences within the same community and between different communities. other statistical methods for community comparison depend on a specific phylogenetic tree of the sequences and the tree can be either pre-defined or inferred from the genomic sequences. such statistics include the parsimony test  <cit> , unifrac  <cit> , and weighted unifrac   <cit> . in the parsimony test, each sequence is labeled according to the community it belongs to and then the parsimony score, the number of minimal changes along the tree necessary to explain all the labels of the sequences, is calculated according to fitch's parsimony algorithm  <cit> . the statistical significance of the parsimony score has been evaluated using two different randomization procedures. the first randomization procedure is to randomize the tree for the sequences  <cit>  and the second procedure is to randomize the labels of the sequences conditional on the tree  <cit> . these two randomization procedures test for different hypotheses. the first randomization procedure evaluates whether the sequences from the communities cluster randomly and the second procedure evaluates if the sequences are randomly distributed on the leaves of the given phylogenetic tree.

lozupone et al. proposed a novel statistical method termed unifrac  <cit>  and a weighted unifrac   <cit>  to test if two communities are significantly different based on a phylogenetic tree. they have been widely applied to numerous recent studies to compare microbial communities, and significant biological insights have been obtained  <cit> . the procedures for calculating unifrac and w-unifrac can be briefly described as follows. a phylogenetic tree composed of sequences from all the communities is first constructed using a phylogenetic analysis tool such as phylip  <cit> . similar as in the parsimony test, each sequence is labeled according to the community it comes from. then unifrac measures the distance between communities by the fraction of length of the tree branches that lead to descendants from each single community, but not from both communities  <cit> . the w-unifrac takes abundance information into consideration and weights each branch length by the difference of the fractions of sequences belonging to the branch for the two communities  <cit> . the significance of both tests are evaluated by randomizing the labels of the sequences. using this randomization procedure, both unifrac and w-unifrac test the hypothesis that the sequence labels are random along the leaves of the tree.

despite the many studies on statistical methods to compare communities, there had been some confusions about the hypotheses being tested for the different statistics. schloss  <cit>  addressed this important issue using simulations. it was shown that amova can be used to test if sequences from the different communities have the same mean  and homova can be used to evaluate if the variations within the communities are the same. on the other hand, the parsimony test, unifrac and w-unifrac are valid for evaluating the general hypothesis that the communities are the same.

note that in w-unifrac the length of a branch is weighted by the difference of relative abundances of the two communities for that branch of the tree. under the null hypothesis that the two communities are the same, the weights for the different branches in w-unifrac have difference variances and we provide a formula for calculating the variance in this paper. based on the variance formula, we propose a new weighting scheme for the branch length in w-unifrac by taking the variation of the weight into consideration. the new resulting statistic is termed variance adjusted weighted unifrac . the statistical significance of vaw-unifrac is evaluated by randomizing the labels of the sequences along the leaves of the tree. similar to unifrac and w-unifrac, the vaw-unifrac can be used to evaluate if two communities are different. more precisely, it tests the hypothesis that the sequences from the communities are randomly distributed along the leaves of the tree. to study the power of this new statistic, we first carried out simulation studies similar to that in  <cit>  to detect differences between communities based on unifrac, w-unifrac and vaw-unifrac. the power of vaw-unifrac is always higher than that of w-unifrac. when the individuals are uniformly distributed in both communities, unifrac can be more powerful than both w-unifrac and vaw-unifrac. however, when the individuals are not uniformly distributed, vaw-unifrac is more powerful than both unifrac and w-unifrac. we also utilized unifrac, w-unifrac, and vaw-unifrac in a reanalysis of four different real datasets, including three 16s rrna sequence collections from different studies and one forest census data. since vaw-unifrac demonstrated a capacity to gain novel biological insights beyond that of either unifrac or w-unifrac, we concluded that vaw-unifrac offers a highly useful alternative approach for comparing communities.

methods
unifrac and w-unifrac
given a phylogenetic tree composed of all individuals from two communities, unifrac distance  <cit>  is defined as the fraction of the branch length that leads to descendants from each single community, but not from both communities. thus, it captures the total amount of evolutionary history that is unique to each community, presumably reflecting adaptation to one environment, but non-adaptation to the other. w-unifrac  <cit>  weights each branch length by the abundance differences of the branch along the tree of the communities. unifrac focuses on the presence/absence of species in communities, not the abundance levels of these species. thus, the unifrac distance between two communities with the same species, but different species abundances, is zero, while the w-unifrac distance is not zero. therefore, if the abundance differences are of interest, w-unifrac should be used. the w-unifrac distance can be calculated using the following equation,  

in the numerator, n is the number of branches in the tree, bi is the length of branch i, ai and bi are the numbers of individuals that descend from branch i in communities a and b, respectively, and at and bt are the total numbers of individuals in communities a and b, respectively. in the denominator, n' is the number of different individuals in the two communities, dj is the distance from the root to individual j, while αj and βj are the numbers of times the sequences were observed in communities a and b, respectively . the same annotation will be used in the rest of the paper.

note that  

therefore, the denominator of wu is always larger than, or equal to, the numerator. equality holds when either ai =  <dig> or bi =  <dig>  which means that the two communities are totally separated. the numerators of both unifrac and w-unifrac can be written as  

in w-unifrac,  

and in unifrac,  

where , if there are sequences that descend from branch i in communities a, and  otherwise. the case is similar for . it means that the unifrac metric can be represented by  

a novel variance adjusted weighted unifrac  for comparing communities
from the definition of w-unifrac given above, we note that it does not consider the variance of the weight  for the i-th branch length assuming that the sequence labels are randomly distributed along the leaves of the tree. by ignoring the variance of ωi in w-unifrac, the true relationships between communities may not be well characterized. hence, we propose to adjust the weight ωi as follows. given individuals from two communities, a and b, we first generate a phylogenetic tree composed of all the at + bt individuals in communities as leaves. each leaf is labeled "a" or "b" to represent the community from which it comes. we test the hypothesis that the labels of the individuals are randomly distributed on the phylogenetic tree.

consider the i-th branch of the phylogenetic tree. let mi = ai + bi be the total number of individuals belonging to the i-th branch. let m = at + bt . we randomly choose at individuals from the total of m individuals, label them as being from community a and label the other leaves as being from community b. then, ai, the number of individuals in community a that belong to the i-th branch, is hypergeometric with parameters  under the null hypothesis. that is  

therefore,  

let  

under the null hypothesis that the at individuals are randomly sampled from the m individuals, we have  

and  

from the above derivation, we propose the following variance adjusted weight  for the length of the i-th branch of the tree,  

we standardize the resulting statistic so that its value is between  <dig> and  <dig>  the final vaw-unifrac is defined as  

in addition to the statistic t , we also consider a variation by taking the weight as  which gives  

similar to unifrac and w-unifrac, the vaw-unifrac aims to test if the two communities are different and, more specifically, if the sequences are randomly distributed along the leaves of the tree. the statistical significance of vaw-unifrac is evaluated by randomizing the labels of the sequences. we are interested in which methods, including unifrac, w-unifrac , vaw-unifrac  or sqt , are more powerful in detecting the relationship between two communities if they are related.

simulation studies to compare the power of the statistics for detecting the relationships between communities
schloss  <cit>  evaluated the power of several different statistics for comparing the relationships between communities and studied the validity of the different statistics for testing various hypotheses. these statistical techniques included treeclimber  <cit> , unifrac  <cit> , w-unifrac  <cit> , ∫-libshuff  <cit> , amova  <cit> , and homova  <cit> . in our study, similar simulation approaches are used to compare the power of unifrac, w-unifrac, as well as vaw-unifrac and its variation sqt. our objective is to understand which statistics are the most powerful and under what conditions. since the simulation approaches are similar to those in  <cit> , we only present a very brief description.

in the simulations, a community was represented by the interior of a circle or an ellipse with a certain density. changing the overlap between circles  or the distribution patterns of samples in circles  represented changing the differences between the communities. the maximum distance between any two points in one community was designed to be  <dig>  units according to the distance between sequences from different phyla  <cit> . three classes of overlapping patterns were simulated. in the first class, the two communities were represented as circles, and points were uniformly sampled from each circle. the different overlapping patterns were obtained by changing the center and the radius of one circle. in the second class, the two communities were represented as ellipses, and points were uniformly sampled from each ellipse. the overlapping patterns were obtained by rotating one of the ellipses. in the third class, the two communities were represented by the same circle. one community was uniformly sampled from the circle, and the distribution of the points in the other community was not uniform.

for one comparison, we first sampled  <dig> points from each community, resulting in a total of  <dig> points. second, euclidean distances among all  <dig> points were calculated. third, a phylogeny tree was generated based on this distance matrix using the neighbor joining method in the neighbor program in phylip  <cit> . fourth, the four statistics, unifrac, w-unifrac, vaw-unifrac, and sqt, could then be calculated. fifth, the labels of the  <dig> points were randomized  <dig> times with the tree topology unchanged, and the corresponding four statistics were calculated for each randomized dataset. finally, a p-value was calculated by the proportion of randomizations which result in statistics that are either equal to, or greater than, the original statistic. p-values less than  <dig>  were considered significant. therefore, after  <dig> independent samplings, a proportion of significant p-values was obtained, representing the type  <dig> error rate when two communities were the same and the statistical power when the communities were different.

applications to four real data sets
we applied unifrac, w-unifrac and vaw-unifrac to reanalyze three datasets consisting of 16s rrna sequences and one tropical forest census data. first, costello et al.  <cit>  investigated how environmental factors and foreign transplants shape skin bacterial communities. plots on two skin sites of volunteers, both forehead and left volar forearm, were first disinfected, then inoculated with foreign microbiotas from other tissues, and, finally, followed over  <dig>   <dig> and  <dig> hours. the data were downloaded from the european read archive . second, ley et al.  <cit>  studied the effects of obesity and kinship on mouse distal intestinal microbial communities based on 16s rrna gene sequence collections. they sampled 16s rrna gene sequences obtained from the distal ceca of  <dig> mice, including  <dig> heterozygous  mothers  and their  <dig> offspring with all three possible genotypes . the final data, including all the sequences, arb alignment  <cit>  and phylogenetic tree are publicly available at http://gordonlab.wustl.edu/mice. third, hollister et al.  <cit>  studied the microbial diversity of soil and sediments using both sanger sequencing and pyrosequencing. samples were collected at eight locations  along a geographical transect from the shoreline of a hypersaline lake and lakebed. point t3- <dig> is the terrestrial end of the transect, while point t3- <dig> is the aquatic end. for each sample, both sanger sequencing and pyrosequencing were performed. a total of  <dig> 16s rrna sequences were generated through  <dig> sequencing, and  <dig> 16s rrna sequences were generated through cloning and single-pass sanger sequencing. the pyrosequencing libraries ranged in size from  <dig> sequences at site t3- <dig> to  <dig> sequences at site t3- <dig>  the sanger clone collections ranged in size from  <dig> sequences at t3- <dig> and t3- <dig> to  <dig> sequences at t3- <dig>  <cit> . all the sequences were downloaded from ncbi . the fourth dataset involves tropical forest census data in three plots across a precipitation gradient in central panama  <cit> . the cocoli 4-ha plot is located in a dry, semi-deciduous forest on the pacific side, and it has  <dig> census data:  <dig>   <dig>  and  <dig>  the 50-ha bci plot is located in the tropical moist forest of barro colorado island  in central panama, and it has  <dig> census data: 1981- <dig>   <dig>   <dig>   <dig>   <dig>  and  <dig>  the third plot is the sherman  <dig> -ha plot, the wettest of the three, located near the atlantic coast,  <dig> km northwest of the cocoli site. this plot has three census data:  <dig>  late  <dig> to early  <dig>  and  <dig>  these census data recorded all free-standing woody plants with stem diameter  <dig> cm or above in the plots  <cit> . different from the above applications, the original abundance information for each species was available.

for each dataset, we first calculated the distances between each pair of communities using the three statistics: unifrac, w-unifrac and vaw-unifrac. then the unweighted pair group method with arithmetic averages  clustering  <cit>  was used to cluster the communities. the resulting clusters were then analyzed based on the characteristics of the individuals in each cluster. principal coordinate analysis   <cit>  was also used to project the communities into a two-dimensional plane determined by the first two principal coordinates to determine whether communities with similar characteristics tend to cluster together.

RESULTS
in order to study our new methods and compare their performance to unifrac and w-unifrac, we carried out simulation studies according to the simulation methods developed in  <cit> . we then used unifrac, w-unifrac, and vaw-unifrac to reanalyze four real datasets, three 16s rrna sequence collections from different research laboratories, and a tropical forest census dataset.

results from simulation studies
we carried out three classes of simulations for two communities: 1) both were uniform samples from two circles with different centers and radii; 2) both were uniform samples from two ellipses with different orientations; and 3) one community was a uniform sample, while the other was an uneven sample from the same circle.

simulation 1: communities were uniformly distributed on two circles
in this simulation, communities were represented by circles, and individuals were uniformly sampled from each circle. it is reasonable to assume that the magnitude of a circle's radius can reflect the diversity of the community that it represents. in order to investigate the type  <dig> error rates and statistical power of the four statistics, unifrac, w-unifrac, vaw-unifrac, and sqt, different levels of overlaps between communities were simulated by changing the distance between two centers, known as offset, and by changing the radius of one of the two circles . the radius of one circle corresponding to community a was set at  <dig> , and the radius of the other circle corresponding to community b was variably set at  <dig> ,  <dig>  and  <dig> . we let the offset be  <dig>   <dig> ,  <dig> ,  <dig> , and  <dig> , respectively. table  <dig> gives the power of the four statistics in detecting the differences between the two communities for type  <dig> error  <dig> . as expected, the type  <dig> error rates realized for all the four statistics are close to  <dig>   when the communities are identical, indicating the validity of the methods. the power of all four statistics increases with the offset and the difference between the radii of the two circles . the power of unifrac is superior to the other three in this simulation. however, among the three weighted methods, vaw-unifrac outperforms w-unifrac, while vaw-unifrac performs similarly as sqt.

the first community is represented as a circle with radius  <dig> , and the second community is represented as circle "b" with radii  <dig> ,  <dig> , and  <dig> , respectively. the offset is the distance between the centers of the two circles. the number of simulations is  <dig>  and the type  <dig> error rate is set at  <dig> .

simulation 2: communities were uniformly distributed on two ellipses
the second simulation was similar to the first, except that the two simulated communities were uniformly distributed on ellipses, with a length of  <dig>  units and a width of  <dig>  units. as in simulation  <dig>  we first made the two ellipses identical and calculated statistics and the resulting p-values. then different relationships between communities were simulated by pivoting one ellipse while fixing the other . the results turned out to be similar to those of simulation  <dig>  the type  <dig> error rate realized for each statistic is not significantly different from  <dig> . the power of each statistic increases when the differences between communities increase. the relative performance of each statistic is also similar to that of simulation  <dig> .

the "pivot" is the rotation angle between the long axes of the two ellipses. the number of simulations is  <dig>  and the type  <dig> error rate is set at  <dig> .

simulation 3: one community was uniformly and the other was unevenly distributed on a circle
in this simulation, we investigated the performance of the four statistics when one community was uniformly distributed and the other community was unevenly distributed on a same circle . this simulation mimics situations where two communities share the same membership, but have different distribution patterns. for one community, we drew points uniformly from a circle, while, for the other community, we drew points clumped to the periphery or center of the same circle. when we performed these uneven samplings, the distance from each point to the center was determined by the c-th root of a uniform sampling from  <dig> to  <dig> c so that the points we drew would clump to the periphery when c > <dig> and to the center when c < <dig>  when c =  <dig>  the points were uniformly chosen from the same circle . in this simulation, statistical power still increases with divergences of communities for all the statistics. when c > <dig>  unifrac outperforms w-unifrac. on the other hand, when c < <dig>  w-unifrac outperforms unifrac. vaw-unifrac outperforms both unifrac and w-unifrac in detecting the differences between the two communities by a significant margin for any values of c. vaw-unifrac also performs similarly as sqt.

the number of simulations is  <dig>  and the type  <dig> error rate is set at  <dig> .

summary of results from simulation studies
results of the three simulations reveal that vaw-unifrac always performs better than w-unifrac. in simulation  <dig> and simulation  <dig>  unifrac has the highest statistical power to detect differences between communities. these observations can be explained as follows. in the first two simulations, both communities are uniformly distributed, and there is no need to weight the branch lengths. the inclusion of weights for the branch lengths in both w-unifrac and vaw-unifrac introduces more noise into the statistics, resulting in lowered power to detect differences between the communities. in simulation  <dig>  one of the communities is not uniformly distributed, and since the inclusion of weights can adjust for the uneven distribution, the weighted version is more powerful in general. because the variance adjusted version takes both the abundance difference and its variance into consideration, it has the most power. since vaw-unifrac has power similar to sqt, we only utilize unifrac, w-unifrac, and vaw-unifrac in the following analyses of real data.

application 1: a study of bacterial communities on human skin across time after transplantation
we first studied the variable region  <dig>  of bacterial 16s rrna sequence data from costello et al.  <cit>  to understand the relationship between microbial communities in certain tissues after transplantation from another tissue. we present our results for the analysis of  <dig> microbial samples from four individuals , over two days, and with two plots by transplanting microbial organisms from the forehead to the left volar forearm at four different time points . the samples are listed in additional file  <dig> 

we first assigned each sequence in samples to its closest relative in a phylogeny of the greengenes core set  <cit>  using blast's megablast  <cit>  as in hamady et al.  <cit> . then we used only the phylogeny of the greengenes core set and removed the leaves that were not involved in the comparison when comparing two samples. the greengenes core set and the phylogeny were downloaded from the fastunifrac website  <cit> .

we wondered why the  <dig> native samples from individual f <dig> were clustered together and separated from other native samples of the same habitats according to vaw-unifrac, while the clustering of native samples from f <dig> was not detected at all by unifrac and w-unifrac. to investigate this phenomenon in more depth, we then applied the three statistics to all  <dig> native microbiotas in that study. the upgma results are shown in figure  <dig>  the results based on w-unifrac and vaw-unifrac are similar. according to both methods, the tongue samples are clustered separately from the skin samples. the forehead samples from individuals other than f <dig> are clustered together, while the forehead samples from f <dig> are separated from them. in the result derived by unifrac, there is no such obvious clustering pattern, but the samples from forehead and forearm of f <dig> are always mixed. these results further support the observation that the forehead and forearm samples from f <dig> are significantly different from those of other individuals.

application 2: comparison of microbial communities in mouse gut
we then applied the three statistics to analyze the 16s rrna sequences from mouse gut communities  <cit> . lozupone et al.  <cit>  applied unifrac and w-unifrac to this dataset and showed that analyses using the two different versions of unifrac can lead to completely different conclusions. therefore, we reanalyzed this dataset using vaw-unifrac. we calculated the three statistics for each pair of the  <dig> communities and used hierarchical clustering and principal coordinate analysis  to analyze the results. for each comparison, we used the same phylogenetic tree, but the leaves that were not in these two communities were removed so that the results of different comparisons were comparable.

as observed in  <cit> , both pcoa and upgma with unifrac revealed clear associations between populations of microbial communities and kinship . the siblings were clustered together, including two mothers who were sisters . m2a- <dig> and m2a- <dig>  which were represented by fewer than  <dig> sequences, were the only mice not clustered with their mothers , potentially resulting from the relatively small number of sequences in their communities. these results indicate that the presence/absence of microbial species in mouse gut is mainly determined by kinship. however, we were more interested in the performance of w-unifrac and vaw-unifrac. when w-unifrac was used to cluster the mice, lozupone et al.  <cit>  indicated that there was a greater correlation with the obesity genotype than with kinship. figure  <dig> shows that analysis using vaw-unifrac reveals not only a correlation with obesity genotype, but also a clear correlation with kinship. although pcoa analysis using w-unifrac does not separate the kinship well, pcoa analysis using vaw-unifrac clearly separates the offspring of m <dig> from the offspring of m <dig> and m <dig>  indicating that kinship plays the most important role in gut microbial community . in fact, the ob/ob individuals tend to cluster together within a given sibship using vaw-unifrac, but this is not so clear by w-unifrac. for instance, m1- <dig> and m1- <dig> clustered tightly by vaw-unifrac , but diverged by w-unifrac . moreover, m3- <dig>  m3- <dig> and m3- <dig> were clustered together by vaw-unifrac, but were dispersed by w-unifrac .

application 3: comparison of sequence collections derived by sanger- and pyro-sequencing technologies
in order to see how the statistics perform when they are applied to sequence collections derived by different technologies, but from the same sample, we analyzed the 16s rrna sequence data from soil and sediments from  <cit> . the same methods as in application  <dig> were used to build the phylogeny of the sequences. some short sequences that could not be assigned to any sequences in the greengenes core set, most of which were less than  <dig> bp in length, were ignored in our analysis.

after applying the three statistics to each pair of the  <dig> samples, we used pcoa and upgma to analyze the results and investigated the performance of the three statistics . the results from both pcoa and upgma analysis indicated that unifrac could not detect the similarity between two collections derived from the same sample. instead, it clustered the data from sanger sequencing and pyrosequencing separately. on the other hand, w-unifrac and vaw-unifrac could cluster some libraries of the two sequencing methods together according to geographical transect at some level, for example, the most water-logged sites . vaw-unifrac separated t3- <dig>  from the others. this is reasonable because t3- <dig> was the only site in a vegetated, upland area, and other sites were from exposed lakebed and water's edge  <cit> .

in fact, each pair of sequence libraries from the same sample using sanger sequencing and pyrosequencing is very different because pyrosequencing detected a greater variety of low-abundance taxa compared to sanger sequencing  <cit> . unifrac emphasized those low-abundance taxa to a greater degree than the two weighted statistics. consequently, unifrac clustered the data from two techniques separately. however, the results from such an analysis can be misleading as pyrosequencing usually generates a very large number of sequences and tends to be more prone to error, while, on the other hand, the number of sequences from sanger sequencing is usually relatively small, but tends to be more accurate. sometimes, we hope samples from the same community cluster together irrespective of which sequencing technologies are used. like when comparing communities based on sequence data from different studies, methods that are not highly sensitive to sequencing depth or sequencing technology are preferred. the weighted methods, such as w-unifrac and vaw-unifrac, are preferred in such cases.

application 4: analysis of compositions of tropical forests in central panama
although unifrac and w-unifrac were originally proposed to measure differences between microbial communities, they could also be applied to other communities, as long as the phylogeny of the individuals is available. therefore, as another example, we applied the three statistics to tropical forest census data in three plots across a precipitation gradient in central panama  <cit> . different from the above applications, the original abundance information for each species present was available.

in order to obtain the phylogeny of tree species in these censuses, we referred to a dated phylogenetic tree of all angiosperm families  <cit> . it was downloaded from http://svn.phylodiversity.net/tot/megatrees/davies <dig> bl.new at the phylomatic  <cit>  website. there were  <dig> out of a total of  <dig> detectable species of the censuses included in this phylogeny. we reconstructed the tree by positioning the genera and species at 2/ <dig> and 1/ <dig> the age of the corresponding family, respectively, similar to  <cit> .

we divided these plots into  <dig> 1-ha plots and compared their compositions using the three statistics. in order to obtain overall insight into the distribution of plants, trees from all census data were included in this study. details about geographical division are shown in figure  <dig>  both pcoa and upgma were used to analyze the results. pcoa plots showed that all three methods could perfectly cluster the communities by sites . this revealed that the tropical forests in the three sites differed substantially in species compositions, which had been verified by previous studies  <cit> . from upgma  clustering, we found that vaw-unifrac and w-unifrac provided almost identical clustering results.

within-site comparisons had some interesting differences between unifrac  and its weighted variations . for example, plot sherman <dig> apparently stood apart from other sherman plots based on the weighted measures. on the other hand, unifrac separated sherman <dig>   <dig>   <dig> from sherman <dig>   <dig>   <dig>  this revealed that the sherman <dig> plot had a species composition similar to sherman <dig>   <dig>  but differed significantly in species abundance. the result is consistent with the fact that the sherman <dig> plot was in a very young forest, probably cleared within the past  <dig> years  <cit> . the clustering results of  <dig> bci plots also showed the superiority of the weighted measures. in figures 9b and 9c, the clustering of the  <dig> small bci plots is consistent with the geographic distributions of the plots. on the other hand, unifrac separated plot bci <dig> from the other bci plots which seems not explicable. these resules indicate that within site, the differences between communities were mainly from abundances, while between sites, they were mainly from species presence/absence.

we also studied the effects of different tree construction methods for the sequences, e.g. neighbor-joining, maximum parsimony, and maximum likelihood, on the clustering results of the communities using the 16s rrna sequence data in  <cit>  as an example. the results are given in additional file  <dig>  it is shown that the clustering of communities based on vaw-unifrac does depend on the tree construction methods, however, the differences are generally small.

CONCLUSIONS
in this paper, we studied unifrac, a widely used phylogenetic method for comparing compositions of microbial communities, and a weighted variation, w-unifrac, which takes abundance information into account. both unifrac and w-unifrac can be written as a weighted sum of all the branch length in the phylogeny tree. however, different weighting methods resulted in differences in performance. for each branch, we showed that the number of sequences of one community that belong to the branch followed a hypergeometric distribution under the null hypothesis that community labels were not correlated with phylogeny. from this perspective, we developed a new variance adjusted weighted unifrac that takes into account variation of the weights to test if two communities are different. both simulations and applications on real data showed that vaw-unifrac is more powerful than w-unifrac. from real data analyses, we showed that our method could reveal biological insights not possible with either unifrac or weighted unifrac. furthermore, our results supported the conclusion of lozupone et al.  <cit>  that the different versions of unifrac can lead to different conclusions. with the increase of data containing abundance information, we expect that our new statistic will help to obtain new insights into community differences, especially for situations where the species are similar, but the differences in relative abundance are of great interest.

authors' contributions
yl and fs conceived and designed the experiments. qc performed the experiments and analyzed the data. qc drafted the manuscript and yl and fs finalized the manuscript. all authors read and approved the final manuscript.

supplementary material
additional file 1
the  <dig> samples where the microbiotas from foreheads were transplanted to forearms in application  <dig>  it contains the individuals, days, plots, and the times of sampling the communities.

click here for file

 additional file 2
the effects of tree-construction methods on the vaw-unifrac results. four tree construction methods are used to build a tree for the sequences. these methods include: 1) neighbor-joining, 2) maximum parsimony, 3) maximum likelihood, and 4) blast assignments of the sample sequences to the closet relatives on a known phylogenetic tree. the effects of the different tree construction methods on the results of unifrac, w-unifrac, and vaw-unifrac are presented.

click here for file

 acknowledgements
we thank the center for tropical forest science of the smithsonian tropical research institute for providing bci, cocoli and sherman datasets, and drs. wenhui wang and shuyun wang for helpful discussion. this research was partially supported by nsfc grants  <dig>   <dig>  and  <dig>  and the national basic research program of china . qc is supported by graduate independent innovation foundation of shandong university . fs is partially supported by us nsf dms <dig>  the bci forest dynamics research project was made possible by national science foundation grants to stephen p. hubbell: deb- <dig>  deb- <dig>  deb- <dig>  deb- <dig>  deb- <dig>  deb- <dig>  deb- <dig>  deb- <dig>  deb- <dig>  deb- <dig>  deb- <dig>  deb- <dig>  deb- <dig>  deb- <dig>  deb- <dig>  support from the center for tropical forest science, the smithsonian tropical research institute, the john d. and catherine t. macarthur foundation, the mellon foundation, the celera foundation, and numerous private individuals, and through the hard work of over  <dig> people from  <dig> countries over the past two decades. the plot project is part the center for tropical forest science, a global network of large-scale demographic tree plots.
