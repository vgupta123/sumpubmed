BACKGROUND
in the last few years, high-throughput sequencing assays have been replacing microarrays as the assays of choice for measuring genome-wide transcription levels, in so-called rna-seq  <cit> , as well as dna copy number , protein-nucleic acid interactions , and dna methylation . several studies assessing technical aspects of rna-seq have shown good reproducibility and significant improvements over microarrays in terms of dynamic range and accuracy of expression fold-change estimation  <cit> . nonetheless, as with microarrays, major technology-related artifacts and biases affect the expression measures  <cit>  and normalization remains an important issue, despite initial optimistic claims such as: "one particularly powerful advantage of rna-seq is that it can capture transcriptome dynamics across different tissues or conditions without sophisticated normalization of data sets"  <cit> .

here, we focus on biases related to gc-content in the context of rna-seq data generated using the illumina genome analyzer platform. briefly, mrna is converted to cdna fragments which are then sequenced to produce millions of short reads . these reads are then mapped back to a reference genome and the number of reads mapping to a particular gene reflects the abundance of the transcript in the sample of interest. however, raw counts are neither directly comparable between genes within a lane, nor between replicate lanes  for a given gene, and normalization of the counts is needed to allow accurate inference of differences in transcript levels. indeed, by virtue of the assay, one expects the read count for a given gene to be roughly proportional to both the gene's length and its transcript abundance. the read count will also vary between replicate lanes as a result of differences in sequencing depth, i.e., total number of reads produced in a given lane.

furthermore, as detailed in the literature review below, previous studies have reported selection biases related to the sequencing efficiency of genomic regions, whereby read counts depend not only on length but also on sequence features such as gc-content and mappability   <cit> . for instance, gc-rich and gc-poor fragments tend to be under-represented in rna-seq, so that, within a lane, read counts are not directly comparable between genes. additionally, gc-content effects tend to be lane-specific, so that the read counts for a given gene are not directly comparable between lanes. biases related to length and gc-content confound differential expression  results as well as downstream analyses, such as those involving gene ontology . as gc-content varies throughout the genome and is often associated with functionality, it may be difficult to infer true expression levels from biased read count measures. proper normalization of read counts is therefore crucial to allow accurate inference of differences in expression levels.

herein, we distinguish between two main types of effects on read counts:  within-lane gene-specific  effects, e.g., related to gene length or gc-content, and  effects related to between-lane distributional differences, e.g., sequencing depth. accordingly, within-lane and between-lane normalization adjust for the first and second types of effects, respectively.

within-lane normalization
the most obvious and well-known selection bias in rna-seq is due to gene length. bullard et al.  <cit>  and oshlack & wakefield  <cit>  show that scaling counts by gene length is not sufficient for removing this bias and that the power of common tests of differential expression is positively correlated with both gene length and expression level. indeed, the longer the gene, the higher the read count for a given expression level; thus, any method for which precision is related to read count will tend to report more significant de statistics for longer genes, even when considering per-base read counts. hansen et al.  <cit>  incorporate length effects on the mean of a poisson model for read counts using natural cubic splines and adjust for this effect using robust quantile regression. young et al.  <cit>  propose a method that accounts for gene length bias in gene ontology analysis after performing de tests.

another documented source of bias for the illumina sequencing technology is gc-content, i.e., the proportion of g and c nucleotides in a region of interest. several authors have reported strong gc-content biases in dna-seq  <cit>  and chip-seq  <cit> . yoon et al.  <cit>  propose a gc-content normalization method for dna copy number studies, which involves binning reads in 100-bp windows and scaling bin-level read counts by the ratio between the overall median and the median for bins with the same gc-content. more recently, boeva et al.  <cit>  propose a polynomial regression approach, based on binning reads in non-overlapping windows and regressing bin-level counts on gc-content . still in the context of dna-seq, benjamini & speed  <cit>  report that read counts are most affected by the gc-content of the actual dna fragments from the sequence library  and that the effect of gc-content is sample-specific and unimodal, i.e., both gc-rich and gc-poor fragments are under-represented. they develop a method for estimating and correcting for gc-content bias that works at the base-pair level and accommodates library, strand, and fragment length information, as well as varying bin sizes throughout the genome.

sequence composition biases have also been observed in rna-seq. hansen et al.  <cit>  report large and reproducible base-specific read biases associated with random hexamer priming in illumina's standard library preparation protocol. the bias takes the form of patterns in the nucleotide frequencies of the first dozen or so bases of a read. they provide a re-weighting scheme, where each read is assigned a weight based on its nucleotide composition, to mitigate the impact of the bias and improve the uniformity of reads along expressed transcripts.

roberts et al.  <cit>  also consider the problem of non-uniform cdna fragment distribution in rna-seq and use a likelihood-based approach for correcting for this fragment bias.

when analyzing rna-seq data from a yeast diploid hybrid for allele-specific expression , bullard et al.  <cit>  note that read counts from an orthologous pair of genes might overestimate the expression level of the more gc-rich ortholog. to correct for this confounding effect, they develop a resampling-based method where the significance of differences in read counts is assessed by reference to a null distribution that accounts for between-species differences in nucleotide composition.

while there has been general agreement about the need to adjust for gc-content effects when comparing read counts between genomic regions for a given sample  or between orthologs , the need to do so was not immediately recognized for standard rna-seq de studies, where one compares read counts between samples for a given gene. the common belief was that, for a given gene, the gc-content effect was the same across samples and hence would cancel out when considering de statistics such as count ratios. pickrell et al.  <cit>  seem to be the first to note the sample-specificity of the gc-content effect in the context of rna-seq and the resulting confounding of expression fold-change estimates. to address this problem, they developed a lane-specific correction procedure which involves binning exons according to gc-content, defining for each gc-bin and each lane a relative read enrichment factor as the proportion of reads in that bin originating from that lane divided by the overall proportion of reads in that lane, and scaling exon-level counts by the spline-smoothed enrichment factors. as noted by hansen et al.  <cit> , this approach suffers from two main drawbacks. firstly, as the enrichment factors are computed for each lane relative to all others, the procedure equalizes the gc-content effect across lanes instead of removing it. secondly, by adding counts across exons and lanes, the method does not account for the fact that regions with higher counts also tend to have higher variances.

zheng et al.  <cit>  note that base-level read counts from rna-seq may not be randomly distributed along the transcriptome and can be affected by local nucleotide composition. they propose an approach based on generalized additive models to simultaneously correct for different sources of bias, such as gene length, gc-content, and dinucleotide frequencies.

in their recent manuscript, hansen et al.  <cit>  show that gc-content has a strong impact on expression fold-change estimation and that failure to adjust for this effect can mislead differential expression analysis. they develop a conditional quantile normalization  procedure, which combines both within and between-lane normalization and is based on a poisson model for read counts. lane-specific systematic biases, such as gc-content and length effects, are incorporated as smooth functions using natural cubic splines and estimated using robust quantile regression. in order to account for distributional differences between lanes, a full-quantile normalization procedure is adopted, in the spirit of that considered in bullard et al.  <cit> . the main advantage of this approach is that it is lane-specific, i.e., it works independently in each lane, aiming at removing the bias rather than equalizing it across lanes. modeling simultaneously gc-content and length  leads to a flexible normalization method. on the other hand, for some datasets such as the yeast dataset analysed in the present article, a regression approach may be too weak to completely remove the gc-content effect and other more aggressive normalization strategies may be needed.

between-lane normalization
the simplest between-lane normalization procedure adjusts for lane sequencing depth by dividing gene-level read counts by the total number of reads per lane  of mortazavi et al.  <cit> ). however, this still widely-used approach has proven ineffective and more beneficial procedures have been proposed  <cit> .

in particular, bullard et al.  <cit>  consider three main types of between-lane normalization procedures:  global-scaling procedures, where counts are scaled by a single factor per lane ;  full-quantile  normalization procedures, where all quantiles of the count distributions are matched between lanes; and  procedures based on generalized linear models . they demonstrate the large impact of normalization on differential expression results; in some contexts, sensitivity varies more between normalization procedures than between de methods. standard total-count normalization  tends to be heavily affected by a relatively small proportion of highly-expressed genes and can lead to biased de results, while the upper-quartile  or full-quantile normalization procedures proposed in  <cit>  tend to be more robust and improve sensitivity without loss of specificity.

in this article, we propose three different strategies to normalize rna-seq data for gc-content following a within-lane  gene-level approach. we examine their performance on two different types of data: a new rna-seq dataset for yeast grown in three different media and well-known benchmarking rna-seq datasets for two types of human reference samples from the microarray quality control  project  <cit> . for the latter datasets, the gene expression measures from qrt-pcr and affymetrix chips serve as useful standards for performance assessment of rna-seq. we compare our approaches to the state-of-the-art cqn procedure of hansen et al.  <cit>  , in terms of bias and mean squared error for expression fold-change estimation and in terms of type i error and p-value distributions for tests of differential expression. we demonstrate how properly correcting for gc-content bias, as well as for between-lane differences in count distributions, leads to more accurate estimation of gene expression levels and fold-changes, making statistical inference of differential expression less prone to false discoveries. the exploratory data analysis and normalization methods proposed in this article are implemented in the open-source bioconductor r package edaseq.

methods
data
we benchmark our proposed normalization methods on two different types of data: a new rna-seq dataset for yeast grown in three different media and the maqc rna-seq datasets. the yeast dataset addresses a "real" biological question, while the maqc datasets are rather "artificial", but have the advantage of including qrt-pcr and affymetrix chip measures for comparison with rna-seq. the different experimental designs allow the study of different types of technical and biological effects.

by technical replicate lanes, we refer to lanes assaying libraries that differ only by virtue of the sequencing assay , not in terms of the biology . by biological replicate lanes, we refer to lanes assaying libraries that are distinct independently of/prior to the sequencing assay . there are therefore different levels/types of technical replication, depending on which aspect of the assay is varied . likewise, there are different levels/types of biological replication. furthermore, it is possible for biological effects to be confounded with technical effects, as is the case with culture and library preparation effects for the yeast dataset.

the maqc datasets are useful mainly for examining technical effects, i.e., for understanding the biases and variability introduced at various stages of the assay, as was done in bullard et al.  <cit> . the yeast dataset allows the study of both technical and biological effects of interest.

yeast dataset
illumina's genome analyzer ii high-throughput sequencing system was used to sequence rna from saccharomyces cerevisiae grown in three different media: standard yp glucose , delft glucose , and yp glycerol . specifically, yeast  were grown at 25°c to approximately 1-2e <dig> cells/ml, as determined by a beckman coulter z <dig> particle count and size analyzer. cells were harvested by filtration, frozen in liquid nitrogen, and kept at -80°c until rna extraction and purification. rna was extracted from the cells using a slightly modified version of the traditional hot phenol protocol  <cit> , followed by ethanol precipitation and washing. briefly,  <dig> ml of lysis buffer  and  <dig> ml of acid phenol were added to frozen cells and incubated at 60°c for  <dig> hour, with occasional vortexing, then placed on ice. the aqueous phase was extracted after centrifuging and additional phenol extraction steps were performed as needed, followed by a chloroform extraction. total rna was precipitated from the final aqueous solution, with 10% volume  <dig> m sodium acetate ph  <dig>  and ethanol, and resuspended in nuclease-free water. residual dna was removed from the rna preparations using the turbo dna-free kit . polya rna was prepared using the polypurist mag kit . strand-specific rna-seq libraries were prepared starting with 1- <dig> μg of polya rna using two different protocols  <cit> . "protocol 1" follows maniar & fire  <cit> , as described, and "protocol 2" follows parkhomchuk et al.  <cit> , as in  <cit>  with the following modifications: fragmentation was carried out before cdna synthesis as above and gel purification after pcr amplification was omitted.

the experimental design for the yeast dataset is summarized in table  <dig>  four distinct colonies were used to inoculate independent ypd cultures , each yielding a single rna library, which was then sequenced using two lanes of possibly different flow-cells. the libraries for y <dig>  y <dig>  and y <dig> were prepared using protocol  <dig> and the library for y <dig> was prepared using protocol  <dig>  for the delft medium, there are three cultures, each sequenced using protocol  <dig> on one lane within the same flow-cell. for the glycerol medium, there are also three cultures; culture g <dig> was sequenced in a single lane using protocol  <dig>  while cultures g <dig> and g <dig> were each sequenced using protocol  <dig> and one lane of the same flow-cell .

with three growth conditions and ten cultures from independent colonies sequenced using two different library preparation protocols and either one or two lanes in a total of five flow-cells, the design allows us to examine both technical effects  and biological effects . cultures grown under the same condition are viewed as biological replicates . there are various levels of technical replication: library preparation protocol, library preparation , flow-cell, lane. note, however, that here library preparation  effects are confounded with culture  effects.

illumina's standard genome analyzer pre-processing pipeline was used to yield  <dig> bp-long single-end reads. reads were mapped to the reference genome  <cit>  using bowtie  <cit> , considering only unique mapping and allowing up to two mismatches . the read count for a given gene is defined as the number of reads with 5'-end falling within the corresponding region. genes with an average read count below  <dig> for each of the three growth conditions were filtered out, i.e., gene j was filtered out if maxk∈{ypd,del,gly}ȳj,k< <dig>  where ȳj,k denotes the average read count for gene j in condition k. this procedure retained  <dig>   genes.

the yeast data are available in the ncbi’s sequence read archive  , under the accession number sra <dig> 

maqc datasets
illumina's genome analyzer ii high-throughput sequencing system was used to sequence rna for two types of biological samples from the microarray quality control  project  <cit> : ambion's human brain reference rna , pooled from multiple donors and several brain regions, and stratagene's universal human reference rna , a mixture of total rna extracted from  <dig> different human cell lines. the data are summarized below; additional detail about experimental design, pre-processing, and the associated qrt-pcr and microarray datasets can be found in bullard et al.  <cit> .

in dataset maqc- <dig>  brain and uhr rna were sequenced each using a single library preparation and seven lanes distributed across two flow-cells . there is no biological replication, but various types of technical replication . library preparation effects are confounded with the extreme differential expression one expects when comparing such different samples as brain and uhr. nonetheless, the availability of qrt-pcr measures for a subset of circa  <dig>  genes makes this a valuable benchmarking dataset.

in dataset maqc- <dig>  four different library preparations of uhr rna were each sequenced using three or four lanes from only one of two flow-cells. there is again no biological replication, but one can use this dataset for examining technical effects such as library preparation and lane effects. however, library preparations are nested within flow-cells, so that differences between flow-cells are confounded with library preparation effects.

for both the maqc- <dig> and maqc- <dig> datasets, reads were mapped to the genome  using bowtie  <cit> , with unique mapping and up to two mismatches. gene-level counts were obtained using the union-intersection  gene model of  <cit> . low-count genes were filtered out using a procedure analogous to that used for the yeast dataset. specifically, for maqc- <dig>  genes with an average read count below  <dig> for both the brain and uhr samples were filtered out, yielding  <dig>   genes. for maqc- <dig>  genes with an average read count below  <dig> for each of the four libraries were filtered out, yielding  <dig>   genes.

in the original maqc paper  <cit> ,  <dig> genes were assayed by qrt-pcr, with four measures  for each of the brain and uhr samples. this technology is regarded as yielding accurate estimates of expression levels and is used here as a gold standard for comparing normalization methods. following  <cit> , we consider only the genes which match a unique ui gene, are called present in at least three out of the four brain and uhr runs, and have standard errors across the eight runs not exceeding  <dig> . we found  <dig> genes in common with the rna-seq filtered genes and use this subset to compare expression measures between the technologies. the uhr/brain expression log-fold-change of a gene is estimated by the log-ratio between the average of the four uhr measures and the average of the four brain measures.

moreover, as reported in  <cit> , a number of microarray experiments were conducted on the brain and uhr samples. as in  <cit> , we consider the affymetrix data from the first site, where each biological sample was assayed using five chips . we pre-processed the data using rma  <cit> , as implemented in the bioconductor r package affy, and obtained p-values for uhr vs. brain differential expression using the limma package  <cit> , with the standard lmfit and ebayes pipeline. there are  <dig>  genes detected by rna-seq and present on the affymetrix chip. the maqc data are available in the sequence read archive, under the accession number sra <dig> 

within-lane gc-content normalization
we propose three novel within-lane normalization approaches to account for the dependence of read counts on gc-content. the first method is based on the simple idea of regressing gene-level counts on gc-content and is implemented using the loess robust local regression procedure; the global-scaling and full-quantile normalization methods involve stratifying genes in equally-sized bins  based on gc-content and then "matching" parameters of the count distributions across bins.

we choose to normalize the logarithms of the gene-level counts for at least two reasons. firstly, the logarithm is the canonical link for the poisson  distribution, hence it seems natural to work on the log-scale when considering regression for count data. moreover, regression on the log-scale is more robust to the presence of outliers  that can bias the fit.

in what follows, let yj and xj denote, respectively, the logarithm of the read count and the gc-content  for gene j =  <dig>  ..., j.

regression normalization
gene-level read counts  yj are regressed on gc-content xj using the loess robust local regression method  <cit>  and normalized expression measures yj′ are obtained by shifting the residuals to recover the scale of the raw counts, i.e.,

  yj′=yj-ŷj+t, 

where ŷj denote the fitted values and t a summary statistic such as the median.

global-scaling normalization
genes are stratified into k equally-sized bins based on gc-content. the normalized expression measures are defined as

  yj′=yj-t)+t, 

where k denotes the gc-content stratum to which gene j belongs and t denotes a summary statistic, e.g., median, upper-quartile, or count for control genes. for instance, on the original  scale, the normalized count for a particular gene could be its raw count divided by the ratio of the median count in its gc-bin to the overall median count of all genes.

full-quantile normalization
in full-quantile  normalization, genes are stratified according to gc-content as for global-scaling normalization. the quantiles of the read count distributions are then matched between gc-bins, by sorting counts within bins and then taking the median of quantiles across bins. this approach is analogous to the microarray between-chip normalization of irizarry et al.  <cit>  and the rna-seq between-lane normalization of bullard et al.  <cit> .

between-lane normalization
gc-content normalization is designed to reduce the dependence of gene-level read counts on sequence composition within a lane. however, other technical effects, such as between-lane differences in sequencing depth, can strongly bias differential expression results. we therefore apply a between-lane normalization procedure, as in bullard et al.  <cit> , after within-lane normalization and before differential expression analysis.

between-lane normalization methods inherently make count distributions more similar between lanes, at the risk of dampening down true differential expression. full-quantile normalization is the most aggressive of the methods we have proposed and both fq and total-count  normalization force equal library sizes  across lanes. for the yeast dataset, all four between-lane normalization methods  appear to yield similar results . since the cqn approach of hansen et al.  <cit>  involves fq between-lane normalization, we settle on fq normalization for comparison purposes . such a between-sample normalization approach was used for microarrays in irizarry et al.  <cit> . a thorough study of between-lane normalization procedures is beyond the scope of this paper and was carried out in bullard et al.  <cit> .

implementation of within and between-lane normalization procedures
the above within-lane and between-lane normalization procedures are implemented in the functions withinlanenormalization and betweenlanenormalization, respectively, of the edaseq package. for gc-content normalization, the withinlanenormalization function takes as input a genes-by-lanes table of counts and a vector of gene gc-content values and returns a genes-by-lanes table of normalized counts, on the original unlogged scale and rounded to the nearest integer. there is also the option to output a table of normalization offsets, equal to the difference between the normalized and unnormalized counts. the normalized counts  or the unnormalized counts and corresponding offsets can then be supplied to standard r packages for differential expression analysis, such as deseq  <cit>  or edger  <cit> . details are provided in the edaseq package vignette and help pages.

differential expression analysis
differential expression  analysis is performed using likelihood ratio tests  based on a negative binomial model for gene-level read counts  <cit> . the negative binomial distribution can be viewed as an extension of the poisson distribution, which accommodates over-dispersion by modeling the variance as a quadratic function of the mean μ, v = μ + ϕμ <dig>  with dispersion parameter ϕ. for ϕ =  <dig>  one recovers the poisson distribution.

we use the bioconductor r package edger  <cit>  to fit a negative binomial model to gene-level read counts and perform likelihood ratio tests of de. a common dispersion parameter is estimated for all genes.

while bullard et al.  <cit>  found that the poisson distribution was appropriate for the maqc datasets , we have noticed substantial over-dispersion for the yeast dataset, even after between-lane normalization .

evaluation criteria
our aim is to evaluate gc-content normalization approaches in terms of their impact on differential expression results. to achieve this, we consider bias and mean squared error in expression fold-change estimation. we also compare normalization methods in terms of their type i error rates and p-value distributions for likelihood ratio tests of de based on a negative binomial model for gene-level read counts  <cit> .

the global-scaling and full-quantile within-lane normalization approaches were implemented using k =  <dig> gc-content bins for the maqc datasets and k =  <dig> bins for the yeast dataset, to reflect the strength of the gc-content effect for each dataset.

bias and mean squared error for expression fold-change estimation
expression log-fold-changes are estimated by log-ratios of average normalized read counts between two sets of lanes corresponding to the two conditions of interest.

in order to compute bias and mean squared error , one needs to know the true value of the expression fold-change. for the maqc- <dig> dataset, one can use the estimate of the uhr/brain fold-change from qrt-pcr as the true value, since qrt-pcr is often considered as a gold standard for producing accurate estimates of expression levels. the rna-seq estimated fold-change is the ratio of the average of the normalized counts for the seven uhr lanes to the average of the normalized counts for the seven brain lanes. for a given gene, bias is then estimated as the difference between the estimated log-fold-changes from the two technologies.

for the yeast dataset, we consider only the eight ypd lanes , for which we do not expect any differential expression, and assume that the true log-fold-change when comparing any combination of such lanes is zero. specifically, we consider all /2= <dig> possible combinations of the eight ypd lanes into two groups of four lanes each. for each such "null pseudo-dataset", we compute the log-ratio of average normalized read counts between the two groups of four lanes. for a given gene, bias is estimated as the average of these  <dig> log-ratios and mse as the average of the square of these  <dig> log-ratios.

testing de based on negative binomial model
to evaluate the impact of normalization on differential expression results, we use the edger package  <cit>  to perform gene-level likelihood ratio tests of de, based on a negative binomial model for read counts, with common dispersion parameter.

for the yeast dataset, we assess type i error by considering again all  <dig> ypd null pseudo-datasets and by testing for de between each of the corresponding two groups. such a setting is intended to mimic the null hypothesis of no de and any gene called de yields a false positive. for a given pseudo-dataset and nominal type i error rate α, the actual type i error rate is defined as the proportion of genes with unadjusted p-values not exceeding α.

it is not possible to assess power with the yeast dataset, as one cannot identify with certainty the set of all genes expected to be de between growth conditions. nonetheless, we perform gene-level tests of de between the three growth conditions using edger and compare p-value distributions and numbers of genes declared de between different normalization procedures.

for the maqc samples, we compare uhr vs. brain differential expression results based on illumina rna-seq and affymetrix chip data. for rna-seq, we perform tests of de between the seven brain and seven uhr lanes using edger. tests of de between the five brain and five uhr chips are performed using limma. we then examine p-value distributions and numbers of genes declared de for the two technologies.

RESULTS
gc-content effect
as noted in pickrell et al.  <cit>  and hansen et al.  <cit> , the gc-content bias on read counts is sample-specific, meaning that the dependence of gene counts on gc-content may vary between lanes. for the yeast dataset, figures  <dig> and s <dig> show that the relationship between read count and gc-content  is the same for lanes assaying the same culture/library preparation, but can be different for lanes assaying different cultures/library preparations. the gc-content effect is also unimodal, in the sense that read counts first increase, then decrease with gc-content. likewise, for the maqc datasets, figure s <dig> illustrates that the gc-content effect varies between different library preparations, but not within library preparations, although the effect is weaker than for the yeast dataset. these observations suggest that the gc-content bias is likely to be introduced at the library preparation step . our findings are in agreement with benjamini & speed  <cit> , who point to pcr as the most important cause for gc-content bias.

the strong impact of gc-content on expression fold-change estimation is illustrated in figures  <dig>  s <dig>  and s <dig>  which contrast count log-ratios for lanes assaying the same library preparation to count log-ratios for lanes assaying different library preparations. specifically, for the yeast dataset, log-ratios for ypd lanes that are not expected to exhibit any de do not depend on gc-content for the same culture/library preparation ), but increase monotonically with gc-content for two different cultures/library preparations ). for the maqc- <dig> dataset, log-ratios for two lanes from the same uhr library preparation do not depend on gc-content ), while log-ratios for brain and uhr lanes vary with gc-content ). for the maqc- <dig> dataset, where one expects no differential expression, log-ratios for two lanes from the same uhr library preparation do not depend on gc-content ), while log-ratios for two lanes from different uhr library preparations do depend on gc-content ).

all four normalization procedures considered here reduce the dependence of both read counts and fold-change estimates on gc-content, with an edge for our proposed full-quantile normalization .

bias and mean squared error for expression fold-change estimation
for the maqc- <dig> dataset, qrt-pcr may be viewed as a gold standard, so that bias for different rna-seq normalization procedures may be assessed based on differences in log-fold-change estimates from the two technologies. figure  <dig>  panel , shows that most of the bias is due to differences in sequencing depths between lanes and that bias is greatly reduced by between-lane normalization. however, the black curve in panel  indicates that with only between-lane normalization, there is a strong dependence of bias on gc-content. all four within-lane gc-content normalization procedures reduce bias and its dependence on gc-content, although cqn still tends to over-estimate fold-changes and is not as effective as the other three approaches in terms of removing the dependence of bias on gc-content.

similar representations of bias and mse are provided in figures s <dig> and s <dig> for the yeast ypd pseudo-datasets, for which one would expect the log-fold-changes to be around zero. all within-lane gc-content normalization methods perform similarly on these artificial data. note, however, that fold-change estimates can vary greatly between the  <dig> datasets , likely due to culture/library preparation effects. there is a clear bias for unnormalized counts, with log-fold-change estimates as high as  <dig>  the full-quantile gc-content normalization method seems to be the most coherent in estimating the log-fold-change around zero.

testing de based on negative binomial model
type i error rate
to assess the impact of normalization on de tests, we first consider type i error rates. for the yeast data, the  <dig> ypd pseudo-datasets simulate an experiment in which all genes satisfy the null hypothesis of constant expression and hence any gene called de is considered a false positive.

figure s <dig> displays, for each of the  <dig> pseudo-datasets, the difference between the actual type i error rate  and the nominal type i error rate for the negative binomial lrt implemented in the edger package  <cit> . the figure indicates that type i error rates vary substantially between pseudo-datasets , although the median actual type i error rate is close to the nominal value for all within-lane gc-content normalization methods.

the  <dig> pseudo-datasets do not actually fully mimic the null hypothesis of no differential expression, due to culture/library preparation effects. indeed, regardless of the normalization approach, and as expected from biology, the eight ypd lanes cluster according to culture. only with median normalization does the clustering first reflect library preparation protocol . after verification, it turns out that the top curves in figure  <dig> correspond to "imbalanced" pseudo-datasets, where lanes are split according to culture: y <dig>  and y <dig>  cultures in one group, y <dig>  and y <dig>  cultures in the other group. the analog of figure  <dig> for the /2= <dig> ypd pseudo-datasets for libraries prepared using protocol  <dig> is provided in figure s <dig>  interestingly, the difference between fq within-lane normalization and only between-lane normalization becomes negligible, while cqn yields the most anti-conservative curve.

p-value distribution
to evaluate normalization methods in a biologically meaningful context, we consider the full yeast dataset  and perform gene-level lrt of growth condition effects on gene expression using edger. the stratified boxplots in figure s <dig> reveal a clear dependence of p-values on gc-content for all but the full-quantile gc-content normalization method. figure  <dig> indicates that the percentage of genes declared differentially expressed increases sharply with gc-content, again for all but full-quantile normalization . similar results are observed with unadjusted p-value cut-offs of  <dig>  and  <dig>  .

for the maqc- <dig> dataset, we examine p-value distributions when testing for de between brain and uhr using both rna-seq and affymetrix chip data. figure  <dig> shows that the gc-content effect on de results is technology-specific. indeed, for microarrays, p-values do not depend on gc-content. by contrast, with only between-lane normalization, rna-seq p-values tend to decrease with gc-content. full-quantile within-lane gc-content normalization removes this dependence.

tuning parameters
the main tuning parameter in our proposed global-scaling and full-quantile gc-content normalization procedures is the number of gc-content bins. this parameter is analogous to the span in loess robust local regression, thus the same considerations of bias/variance trade-off should guide its selection. intuitively, the larger the number of bins, the more adaptive and possibly noisy the normalization. the boxplots of bias in figure s <dig> indicate that de results are robust to the number of gc-content bins in fq normalization. we used k =  <dig> bins for the maqc datasets and k =  <dig> for the yeast dataset; a selection which reflects the stronger gc-content effect observed for the latter dataset.

discussion
we have compared differential expression results based on our three proposed within-lane gc-content normalization methods and the cqn method of hansen et al.  <cit> , on the maqc and yeast datasets. only full-quantile gc-content normalization appears to effectively remove the dependence of the proportion of de genes on gc-content. this could mean either that, for some biological reason, gc-richer genes are more likely to be truly de  or that gc-content bias is so strong that an aggressive normalization method is needed. since we are not aware of any plausible biological explanation for the dependence of de results on gc-content, we believe that the maqc and yeast data require a full-quantile approach and that merely regressing counts on gc-content is not sufficient to completely remove the bias.

to rule out a biological reason for the dependence of de on gc-content, we compared uhr vs. brain de results based on the maqc- <dig> rna-seq data to those based on affymetrix chip data  <cit> . figure  <dig> clearly indicates that the dependence of p-values on gc-content is technology-specific, i.e., unlike rna-seq p-values, microarray p-values do not depend on gc-content. full-quantile within-lane normalization reduces the dependence of p-values on gc-content. interestingly, and encouragingly, the much smaller p-values for the rna-seq data suggest that this newer assay is more powerful than microarrays for de analysis .

another well-known selection bias in rna-seq is due to gene length  <cit> . for the yeast dataset, we noticed only a minor length effect on read counts and de results ). in fact, genes with high gc-content tend to be shorter, so there seems to be a compensation effect due to sequence composition . mappability does not appear to affect read counts for this dataset ). gene length bias for the maqc datasets is discussed in  <cit> .

in addition to their good performance noted above, our proposed normalization methods offer a number of advantages. they are very simple to implement and extend and lead to de results that are robust to tuning parameters such as the number of gc-content bins . they could be applied to other genomic regions , either "from scratch" or by retaining the scaling from a previous gene-level normalization. they can easily be adapted to incorporate other sequence features such as gene length and mappability. note, however, that in the process of adjusting for gc-content one may already be adjusting indirectly for other covariates such as length. controls  could also be included.

our normalization procedures return genes-by-lanes tables of normalized counts, on the original unlogged scale and rounded to the nearest integer. some authors have argued that it is better to leave the count data unchanged to preserve their sampling properties and instead use an offset for normalization purposes in the statistical model for read counts  <cit> . it is out of the scope of this article to discuss whether it is preferable to normalize counts prior to modeling or to perform normalization within the model. nevertheless, it is worth noting that our normalization approaches can easily be modified to produce an offset, by considering the difference between normalized and unnormalized counts, in a manner similar to hansen et al.  <cit> . the edaseq package implements both strategies, i.e., its normalization functions can return either a table of normalized counts or a table of offsets.

we identified differentially expressed genes using a likelihood ratio test based on a negative binomial model for read counts. for the maqc datasets, bullard et al.  <cit>  found that it was appropriate to model read counts using the poisson distribution . for the yeast dataset, substantial over-dispersion remains after both within and between-lane normalization , which precludes relying on the poisson distribution. over-dispersion is greatly reduced by between-lane normalization and much less so by within-lane gc-content normalization. the four within-lane normalization procedures seem to have similar impact on the mean-variance relationship , so that de results do not appear to be driven by differences in dispersion estimates for the different procedures. furthermore, for the yeast dataset, goodness-of-fit analysis suggests that a negative binomial model with common dispersion parameter for the ensemble of genes is sufficient to capture the over-dispersion present in the counts . virtually identical results were obtained for three over-dispersion scenarios implemented in edger: tagwise, trended, and common dispersion. note that the violation of type i error control for the yeast pseudo-datasets is actually not as serious as it might seem at first. indeed, the largest deviations correspond to culture/library preparation effects  and nominal and actual type i error rates are close for most pseudo-datasets . a detailed evaluation of read count models and de methods is out-of-scope here, since our aim is to compare normalization approaches for a given de method.

there are two different types of gc-content effects. the first effect is to act as a proxy for sample size, in a similar manner as length, and relates to power: as gc-content increases, read counts first increase then decrease, and evidence in favor of de increases. if the effect was not sample-specific and simply a proxy for sample size, one would expect no dependence of expression fold-changes on gc-content and the effect on p-values to be due to the dependence of the variance on gc-content . one could therefore argue that it is not justified after all to normalize for gc-content and, in particular, that fq normalization is too aggressive. indeed, as seen in figure  <dig>  within-lane normalization methods not only remove the dependence of fold-changes on gc-content, but also tend to reduce the spread of fold-changes at high gc-content . this results in an overall decrease in the proportion of genes declared de . other approaches which account for gc-content could be based on standardized p-values, i.e., p-values that explicitly account for sample size  <cit> . a rule-of-thumb for standardizing a p-value pn based on a sample size of n to sample size  <dig> is p˜n= min <dig> pnn <dig>  in lieu of the sample size n, one could use gene length or gc-content. the second and more insidious effect, however, is sample-specific and hence biases fold-changes and the resulting de statistics . in particular, the standardized p-value approach does not address the sample-specificity  of the gc-content effect and would still lead to biased de results. likewise for methods that correct for the gc-content bias after performing de tests, e.g., in a fashion similar to that proposed in young et al.  <cit>  for gene length bias in context of gene ontology analysis. we therefore find it preferable to adjust for gc-content prior to statistical modeling and de analysis. the value of performing a within-lane gc-content normalization before combining/comparing counts between lanes is further supported by figure  <dig>  which shows that p-values based on microarray data do not vary with gc-content and hence suggests that the gc-content effect is a technology-related artifact. of the normalization procedures we considered, full-quantile normalization seems most effective at removing the dependence of de results on gc-content. however, results may vary in a dataset-specific manner and less aggressive approaches, such as loess or median normalization, may be robust alternatives. in the absence of controls, we recommend a thorough exploration of the data before choosing an appropriate normalization. in summary, there is a trade-off between bias removal and power: without within-lane gc-content normalization, fold-changes are biased, however normalization may mask true de.

gc-content bias is even more of an issue when comparing read counts between species, e.g., allele-specific expression in diploid hybrid of s. bayanus and s. cerevisiae  <cit> . we are considering extensions of our methods to address gc-content bias for between-species, within-gene de analyses.

it would also be interesting to consider adaptations of our methods to other sequencing assays, such as chip-seq and dna-seq.

finally, as with microarrays, positive and negative controls  are essential for conclusive validation and comparison of any inference method, e.g., in terms of bias, variance, type i error, and power. controls could also be incorporated as "anchors" within the normalization procedure itself  <cit> . the use of controls from the external rna control consortium  in the recent article of jiang et al.  <cit>  is an encouraging step in this direction.

CONCLUSIONS
we have reported the existence of strong sample-specific gc-content effects on rna-seq read counts, which can substantially bias differential expression analysis, and have proposed three simple within-lane gene-level gc-content normalization approaches. the gc-content effect seems to be the same for lanes assaying the same library preparation, but tends to vary between library preparations for the same type of biological sample. hence, the bias is likely to be introduced at the library preparation step . we have compared our methods to the state-of-the-art cqn procedure of hansen et al.  <cit>  , on both yeast and human rna-seq data, in terms of bias and mean squared error for expression fold-change estimation and in terms of type i error and p-value distributions for tests of differential expression. our proposed within-lane procedures, followed by between-lane normalization as in bullard et al.  <cit> , reduce gc-content bias and lead to more accurate estimation of expression fold-changes and tests of differential expression.

the normalization methods proposed in this article are implemented in the open-source bioconductor r package edaseq. the resulting normalized counts  can then be supplied seamlessly to other r packages for differential expression analysis, such as deseq  <cit>  or edger  <cit> .

software
the methods proposed in this article are implemented in the r package edaseq, released as part of the bioconductor project http://www.bioconductor.org. this package, for exploratory data analysis and normalization for rna-seq, implements a variety of numerical and graphical summaries of read data, within-lane normalization procedures to adjust for gc-content or other gene-level effects, and between-lane normalization procedures to adjust for distributional differences between lanes.

authors' contributions
dr co-developed the statistical methods, wrote the edaseq r package, performed data analysis, and drafted the manuscript. ks designed and performed the yeast experiments and prepared the dna sequencing libraries. gs designed the yeast experiments and edited the manuscript. sd co-developed the statistical methods, performed data analysis, drafted the manuscript, and designed and coordinated the research. all authors read and approved the final manuscript.

supplementary material
additional file 1
supplementary figures. additional figures referred to in the main article as figures s1-s <dig> 

click here for file

 acknowledgements and funding
we gratefully acknowledge ghia euskirchen and phil lacroute, for their help with sequencing, and andy fire and jay maniar, for help with the rna-seq protocol. we are also thankful to yuval benjamini and terry speed, for valuable discussions on the normalization of rna-seq data.

this work was funded by grant r <dig> hg <dig> from the nhgri at the nih  and grant cpda <dig> from the university of padua .
