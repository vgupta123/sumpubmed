BACKGROUND
cancer is a complex disease often associated with a characteristic series of somatic genetic variants  <cit> . substantial effort has been devoted to genetic profiling of tumors in hopes of identifying these driver mutations and studying how they drive tumor development and resistance to treatment  <cit> . tumors often contain multiple, genetically diverse subclonal populations of cells  <cit> , and in some cases it is possible to reconstruct the evolutionary history of the tumor, thereby aiding in the identification of driver mutations, by computing the population frequencies of mutations that distinguish the subclonal populations  <cit> .

somatic mutations can be detected, and roughly quantified, using exome and whole genome sequencing of a sample from a bulk tumor  <cit> . however, recent attempts to reconstruct subclonal phylogenies have employed much deeper targeted sequencing  <cit>  of tumor-associated single nucleotide variants  to achieve higher accuracy in estimated snv frequencies  <cit> . these snv frequencies were then used to partially reconstruct the evolutionary history of tumors based on a single  <cit>  or multiple  <cit>  samples of same tumor. however, due to short read sequencing, the frequencies of different snvs are measured independently, so linkage between the snvs in subclones is unavailable and standard phylogenetic methodology can not be used to construct evolutionary histories . however, if one makes the infinite sites assumption about tumor evolution, namely that every snv only appeared once, then it is possible to use snv frequencies to automatically reconstruct full or partial subclonal phylogenies while also inferring the multiple snv genotypes of the major subclonal lineages in the tumor.

here we describe a new method that automatically performs this phylogenetic reconstruction. first, we demonstrate that an unambiguous reconstruction is possible by describing topological constraint rules that are sufficient conditions to infer whether a triplet of snv frequencies is consistent with only a chain or a branching phylogeny. we then describe a new method, phylosub, that automatically infers tumor phylogenies from snv allele frequencies measured in single or multiple tumor samples. phylosub is based on a generative probabilistic model, inference in which implicitly implements the two rules by inferring the hidden phylogenies that have high probabilities of generating the observed snv frequencies. it uses bayesian inference, based on markov chain monte carlo  sampling, to infer a distribution over phylogenies that incorporates uncertainty due to multiple phylogenies being consistent with the snv frequencies and also noise in the measurement of the snv frequencies. phylosub uses a dirichlet process prior over phylogenies  <cit>  to group snvs into major subclonal lineages.

model assumptions
we assume that the tumor evolution proceeds according to the clonal evolution theory, namely that all tumor cells are derived from ancestors that gain growth advantages over normal tissue and begins to expand  <cit> . subsequent mutations can provide a further fitness or survival advantage to their subclonal lineage  <cit>  which subsequently increases in frequency compared to cells containing only the snvs in the parental lineage. a given tumor sample is a snapshot of this evolutionary process and may contain, at non-negligible frequency, cells from multiple major subclonal lineages, each containing a different assortment of these advantageous mutations. we make the infinite sites assumption <cit> , namely that each snv appears only once and furthermore that once it appears, it does not revert back to its original state. as we describe below and illustrate in figure  <dig>  in some circumstances, this assumption highly constrains the phylogenies that are consistent with the snv allele frequency data, especially if snv frequencies from multiple samples from the same tumor are available. finally, to make our model robust to low tumor cellularity, we assume that each tumor is derived from a single clone, however, this assumption is not critical in modeling tumor evolution and we revisit this assumption in the discussion section where we describe how to generalize our model to multicentral tumors .

to simplify our initial discussion, we will assume that the exact population frequencies of the cells containing each snv  are available before discussing how we estimate these frequencies from deep sequencing data of the snv locus. note, we assume that the copy number of a locus is available as per  <cit> . in the datasets that we considered, most snvs are heterozygous at a normal copy number locus and the population frequency of other snvs is easily inferred from their allele frequencies. in more complex situations, a number of tools are available to infer copy number changes associated with specific subclonal lineages from whole genome sequencing data  <cit> .

an important consequence of the infinite sites assumption is that if snv b occurred in a cell that contained snv a, then all cells that have b also have a and thus the population frequency of a must always be greater than or equal to that of b, regardless of where and when the tumor sample was taken. however, a given set of three snv population frequencies can still be consistent with two different phylogenies: a linear phylogeny or a branching phylogeny .

topological constraint rules
one can distinguish linear or branching descent under some circumstances. for example, if we have already established that snv a is ancestral to both b and c , then if the population frequency of b plus the population frequency of c is greater than the population frequency of a, then the phylogeny must be linear. this is true because in a branching phylogeny, there are no cells that contain both b and c, so the population frequency of a must be at least as large as sum of the frequencies of b and c . we call this the “sum rule”. however, because a linear phylogeny is consistent with any set of snv frequencies from a single sample, without making any further assumptions about the tumor evolution process, one needs at least two tumor samples to be able to rule out a linear phylogeny. however, given two samples and again assuming that snv a is ancestral to both b and c, if the population frequency of b is larger than that of c in one sample, and vice versa in the other, than neither b nor c can be ancestral to the other, and the only phylogeny consistent with both sets of snv frequencies is the branching one. we call this the “crossing rule” because the frequencies of b and c cross . however, there is no guarantee that one can apply either rule to any set of snv frequencies for all triplets of snvs, although increasing the number of tumor samples does make it more likely that either the sum or crossing rule will be applicable for one or a pair of tumor samples, respectively. furthermore, one needs to also consider the possibility of estimation error in the snv population frequencies because these are inferred from discrete read counts. note that these two rules also apply where snv a is a mock snv representing the wildtype state and having population frequency of 100%; as such these two rules also apply for multicentral tumors.

the phylosub algorithm
to explicitly model uncertainty in estimates of the snv population frequencies and the precise tumor phylogeny, we have developed the phylosub model that we describe here. phylosub attempts to explain the observed read counts in terms of a latent phylogeny that associates snvs with particular subclonal lineages. we provide software that takes as input a set of read counts for a set of snvs and the copy number status of each snv, performs inference in the phlyosub model to estimate the number of major subclonal lineages, the mutational profile of each lineage, and the proportion of each lineage within the tumor cell population from which the read data was drawn. phylosub implements the parsimony assumptions detailed above using a non-parametric prior over tree structures. it is “generative” in that it attempts to explain the observed snv frequencies in terms of an unobserved phylogeny; our model is also “bayesian” in that it infers a posterior distribution over phylogenies and associated subclonal lineage frequencies. we introduce a new visualization, the partial order plot, to represent the posterior uncertainty in the phylogeny when the snv frequencies alone do not provide sufficient information to uniquely reconstruct the phylogeny . the sum and crossing rule described above are implicitly incorporated into our generative model – our model assigns very low probability to any read counts that reflect deviations from either rule.

in the following, we provide a brief introduction to the phylosub model  and we demonstrate its application to datasets where a single sample is profiled  <cit>  and those where multiple samples are profiled  <cit> . we also report the application of the model on a simulated dataset to show that its prior parameterization allows it to represent a wide variety of phylogenies.

RESULTS
phylosub
phylosub represents the major subclonal lineages and their evolutionary relationships using a directed tree in which each node is associated with a subclonal lineage and the edges connect parental lineages to their direct child lineage. each subclonal lineage is associated with a distinct subset of the snvs input to the model, we call this subset the genotype of the lineage. each node is also associated with  a set of snvs that are present in this lineage but not its parent lineage and  the population frequency of cells with the lineage genotype . a subclonal lineage contains all of the snvs associated with its parent, so its full genotype can be reconstructed by taking the union of the snvs associated with its node and all of its ancestral nodes. similarly, the population frequency of an snv is the sum of the subclonal lineage frequencies of the lineage it appeared in and all of its descendent lineages. so, the subclonal lineage tree can be used to compute the population frequencies of each snv and the genotype of each subclonal lineage. associated with each snv is a variable that indicates its zygosity and copy number in the cells that it appears , we assume all cells with the snv have the same zygosity and copy number, and that all other cells have normal copy number at the snv locus. the snv genotype variable along with the population frequency is used to compute the allelic frequency of the snv i, p
i
. the data input to the model for each snv is the number of reads mapping to the snv locus, d
i
, and the number of these reads that do not contain the snv, a
i
. we evaluate the likelihood of a given subclonal lineage tree  by taking the product of the read count probabilities for each snv, where the probability for the locus of snv i is computed using a binomial distribution whose parameter is derived from p
i
 and an estimate of the error rate of the sequencer. phylosub also contains a vague prior over tree structures that is parameterized by three hyperparameters   that govern how the prior scores trees with more or fewer nodes, and different average numbers of siblings. we use ranges for these hyperparameters that in simulations have a slight preference for trees with fewer nodes but a limited preference for sibling numbers .

simulations
phylosub’s dirichlet process prior over tree structures depends on three hyperparameters: α <dig>  γ, and λ. the hyperparameters α <dig> and λ determine the number of nodes  in the tree, λ also affects the height of the tree and γ affects the number of siblings in the tree which in turn affects the width of the tree. in all the experiments, we sample these hyperparameters  <cit>  as part of the mcmc sampling from a range whose upper and lower bounds we establish in this section.

to establish the ranges that we use for the hyperparameters in phylosub, we simulated read counts from clusters with an average of nine snvs per cluster with snv population frequencies { <dig> , <dig> , <dig> , <dig> , <dig> , <dig> }, with a read depth of ≈ <dig> × which is a typical read depth for the targeting deep sequencing data that phylosub is designed for. we simulated heterozygous snvs at loci with normal copy number and sample read counts for each snv from a binomial distribution . the hyperparameter settings we used in the simulations are all possible combinations of α0∈{ <dig> , <dig> , <dig> }, γ∈{ <dig> , <dig> ,8} and λ∈{ <dig> , <dig> ,1}. the snv population frequencies are consistent with many different tree structures and figure  <dig> shows that the tree structures with highest complete-data likelihoods varies in the expected way for different settings of the tree prior hyperparameters. although the preferred structure varies, the inferred snv frequencies remain well-correlated with the baseline values  for these hyperparameter ranges, so the prior is not over-regularizing the snv frequencies for these settings. to allow a range of tree structures, we integrate over these ranges by placing a uniform prior on the choice of these settings in our mcmc simulations .

although we focused on high read depths in the above simulation, we found that phylosub works well for read depths ≈ <dig> x and was able to recover the clusters similar to the ones reported above and the snv frequencies are well-correlated with the baseline values . however, we found that the performance of the model degrades slightly at a read depth of ≈200x, due to merging of clusters whose nearby snv frequencies could not be distinguished. nonetheless, we note that the inferred snv population frequency estimates remain well-correlated  and that the majority of the clusters were recovered at read depth ≈200×.

the simulation as described above has no clear phylogeny by design. the snv frequencies were consistent with multiple phylogenies and the main goal of this simulation was to establish the ranges for our hyperparameters that permit a wide variety of tree structures. we integrate over these parameter ranges on the real data in order to remove any prior bias towards particular structures. to determine whether phylosub can correctly recover the phylogenies from a single sample of snv frequencies, we simulated read data from a chain phylogeny with snv population frequencies  <dig> → <dig> → <dig> → <dig> → <dig> . by the sum rule, these frequencies are only consistent with a chain phylogeny. phylosub was able to reliably recover this chain. the real datasets described in the later sections are representative of the types of problems that our methodology could be applied to as they contain single and multiple samples, some of which have clear phylogenies and some do not.

results on aml datasets
to assess phylosub on single samples, we applied it to data from jan et al. <cit>  who reported the coexistence of multiple subclonal lineages in hematopoietic stem cells  from acute myeloid leukemia  patient samples. the deep-targeted sequencing of all snv candidates identified by exome sequencing identified snvs with differing allelic frequency, suggesting multiple clonal populations in the hsc cells. an independent single-cell assay confirmed the existence of multiple clones, and thus provides a ground truth tree that shows some of the major subclonal lineages within the populations. here we apply phylosub to the two samples profiled by jan et al. that had three or more snvs profiled in a single-cell assay. these samples are su <dig> and su <dig> which have  <dig> and  <dig> snvs in the single-cell assay, respectively. although this assay confirmed the presence of some of the subclonal lineages, only 100- <dig> cells were assayed, so lineages with low population frequency in the sample  may not be detected.

we applied phylosub providing it with the copy number and zygosity of each snv . for both su <dig> and su <dig>  a number of different phylogenies were consistent with the snv read counts, and we developed the “partial order plot” to represent the posterior uncertainty in the phylogeny .

furthermore, one can interpret the partial order plot to indicate that both cxorf <dig> and cxorf <dig> are in the same lineage because they are both direct parents of dock <dig>  and there are no edges between them. for reference, in figure  <dig> we have included the results of the single-cell assay for su <dig> in the partial order plot representation – jan et al. report three subclonal lineages for su <dig>  as indicated by the snv colorings  <cit> . we note that these plots are largely consistent. indeed, we assign high posterior probability > <dig> , to two of the three subclonal lineages detected by jan et al. . for reference, we also provide the list of the subclonal lineage trees along with their posterior probabilities in see .

the one major difference between phylosub’s estimates and the single-cell data from jan et al. is that phylosub switches the order of the appearance of snvs cxorf <dig> and tet2-t1884a. in fact, there was not a single subclonal lineage that contained cxorf <dig> but not tet2-t1884a in  <dig>  subclonal lineage trees sampled from phylosub’s posterior. this switch is likely due to the observed snv frequencies, indeed the 95% confidence intervals of the snv frequencies of these two snvs do not overlap . one explanation for this difference is a systematic bias in the measurement of one or both of these snvs; it is also possible that the labels of these two snvs were switched in jan et al.. we also note, however, that in jan et al., the existence of the lineage that contains only cxorf <dig>  tet2-y1649stop, and cacna1h is only supported by  <dig> of the  <dig> clones that they profiled.
et al.
 <cit> 

for the tumor sample su <dig>  both the partial order plot and the single-cell assay agree on tet2-e1357stop event occurring early , and all other snvs are secondary mutational events as shown in figure 5b. note that the partial order plot shows a large uncertainty in the structure for the rest of the snvs and this is also reflected in the posterior over subclonal lineage trees and genotypes . there is no strong evidence for either a linear or branching lineage or for particular clustering among these snvs. also, from table  <dig>  we see a lot of variation in the allele frequencies of these snvs suggesting that they may not belong to the same subclonal lineages. the subclonal lineage inferred by jan et al.’s single-cell assay is shown in figure 5a and only contains two lineages, one with only tet2-e1357stop and the other with the other five snvs. the tet2-e1357stop lineage genotype has probability  <dig>  in our posterior, however the second genotype has a relatively small probability  under the posterior although we note that the genotype that contains all snvs but zmym <dig> has a posterior probability of  <dig>  . for reference, we also provide the list of the subclonal lineage trees along with their posterior probabilities in .
et al.
 <cit> 

in summary, the subclonal lineage trees inferred by phylosub on single samples of snv frequencies are largely consistent with ground truth but there remains substantial uncertainty in su <dig> about whether there was a linear or chain lineage. on the other hand, the snv frequencies in su <dig> were only consistent with a linear lineage and phylosub almost perfectly reconstructed the results of the single-cell assay with one misordering of the snvs. this difference may be explained by unmodeled systematic biases in the deep sequencing data or experimental error. nonetheless, we have shown that in some cases, it is possible to achieve a good estimate of the genotype of multiple subclonal lineages as well as their evolution from a single, targeted deep sequencing sample of snv frequencies.

results on cll datasets
to evaluate phylosub on a multiple sample dataset, we used data from a study of chronic lymphocytic leukemia  by schuh et al. <cit>  which quantified snv frequencies of a set of snvs during different time points spanning the patient therapy cycle. the candidate snvs were identified by exome sequencing and then subjected to targeted resequencing. the tumor samples from the three patients in the study labeled cll <dig>  cll <dig> and cll <dig> have  <dig>   <dig> and  <dig> snvs respectively with snv frequencies for five different time points. originally, schuh et al. reconstructed the evolutionary histories of each cancer by a semi-manual procedure in which they first automatically grouped snvs into subclonal lineages using k-means clustering on the allele frequencies and the differences in allele frequencies between the time points for each patient and then reconstructed the evolutionary structure of those lineages using a procedure that they do not describe in the paper. in phylosub, we model multiple samples from the same cancer as sharing the same evolutionary history but we allow subclonal frequencies to change between samples.

we applied phylosub to the snv read count data, providing the algorithm with the likely zygosity estimates – in most cases, snvs appeared to be heterozygous with normal copy number but in a few cases, snvs appeared to be hemizygous and were input to the model as such. for these data, because of the multiple samples per tumor, there is very little posterior uncertainty in the best fitting tree – as such, we only show the best single tree structure corresponding to the mcmc sample with the highest complete-data likelihood  <cit> .

for the tumor samples cll <dig> and cll <dig>  the best tree structure estimated by phylosub and the tree structure from schuh et al. <cit>  are in exact agreement and the population frequencies of the subclonal lineages are well-correlated. figures  <dig> and  <dig> compare the phylosub estimates with those reported by schuh et al. <cit> .

for the tumor sample cll <dig>  phylosub inferred a chain structure similar to the chain structure from schuh et al., but the major difference in phylosub’s best estimate of the tree structure is the splitting of cluster a into two clusters as shown in figure  <dig>  however, we found that the complete-data log likelihood of phylosub’s best estimate of the tree structure is higher than the one for the chain structure of schuh et al. and therefore phylosub prefers the splitting of the cluster a into two clusters.

in the cll dataset, there is no ground truth but to allow the reader to compare the two estimates of the evolutionary history, figure  <dig> plots the frequency of each snv in the three samples, and we have colored snvs according to their subclonal lineage assignments by schuh et al. these snv frequencies are not corrected for copy number, however, the hemizygous snvs are clear from examination of the figure.

in summary, having multiple samples of snv frequencies greatly reduces the posterior uncertainty in the evolutionary history of the tumor and phylosub is able to reconstruct histories produced by a semi-manual procedure.

CONCLUSIONS
we presented a nonparametric bayesian model called phylosub that uses a dirichlet process prior over trees  <cit>  to model the clonal evolutionary structure of tumors from next generation sequencing data. we also introduced a new visualization method, the partial order plot, to represent the posterior uncertainty in the phylogeny when the clonal frequencies alone do not provide sufficient information to uniquely reconstruct the phylogeny and mutational profiles of each subclonal lineage represented in the tumor. by enforcing a set of structural constraints on the snv population frequencies using mcmc methods, we were able to infer the phylogenetic relationships between subclones from both single and multiple tumor samples.

we have demonstrated that it is possible, in some cases, to detect a linear lineage from a single, high cellularity sample of the tumor. we have also shown that multiple samples highly constrain the possible lineages that are consistent with the snv frequency data. phylosub’s inferred subclonal lineage trees were in good agreement with single cell assays on single sample data and with an expert-driven, semi-manual reconstruction procedure on multiple sample data.

phylosub’s ability to detect and characterize subclonal lineages depends on the frequency of the lineage in the population , the number of snvs that define the lineage, as well as the accuracy with which the snv population frequencies are estimated which depends on both the sequencing depth as well as uncertainty about the copy number of the snv. simply put, for lineages defined by a single snv, the read depth has to be high enough that the uncertainty in the estimated snv frequency is less than the frequency of the subclonal population. having more lineage-defining snvs can relax this hard constraint. as such, the phylogenies of tumors with large numbers of subclonal lineages, each defined by a small number of snvs , will be hard to reconstruct with phylosub, or any other method, unless the snv frequencies are very accurately estimated. indeed, it is not clear how ground truth could be uncovered in such a case: the gold standard of single cell sequencing would require an exceptionally large number of single cells to survey this highly heterogeneous population, and each of these cells would need to be sequenced deeply in order to ensure precise somatic variant calling.

one potential difficulty in scaling our approach to orders of magnitude more snvs is that the markov chain may not mix in a timely manner, in other words, may get stuck in local minima. we note that finding suboptimal solutions is an issue for any method based on these data. in our case, the mixing time of the chain would depend largely on the number of subclones represented in the population with less of a dependence on the number of snvs. there are various techniques for determining whether or not a markov chain is well-mixed and we refer the reader to a recent excellent review  <cit> .

phylosub extends recent work on inferred cellularity and subclonal structure from somatic mutations. absolute uses whole genome sequence data or array cgh data to identify regions of copy number change in the tumor and based on this infers cellularity and copy number changes associated with different subclones  <cit> . theta  <cit>  also attempts to infer both the copy number profiles and their relative proportions using the whole genome sequencing data based on an infinite sites assumptions. neither of these algorithms explicitly reconstructs tumor phylogenies. our work is closest to pyclone  <cit>  which uses a flat dirichlet process mixture model to group snvs into subclonal lineages based on their frequencies; phylosub extends this work by reconstructing the phylogenetic relationships among these lineages and, in doing so, allows the full snv genotype of each subclonal population to be reconstructed.

we designed phylosub to assume a single clonal origin for the cancerous cells in the sample. we made this decision to increase the applicability of the sum rule for low cellularity tumors . however, removing this assumption would be a simple change to the model, which we have not evaluated.

another area of future innovation would be in modeling sequencing biases and uncertainty in snv allele frequencies resulting from them. we did not evaluate replacing our binomial model with a negative binomial one that would have allowed greater variability in the observed read counts for a given snv allele frequency  <cit> .

