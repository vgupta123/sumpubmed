BACKGROUND
the metabolome represents the collection of small compound metabolites in an organism or biological system, typically under  <dig> daltons  <cit> . the network of metabolic reactions, where outputs from one enzymatic chemical reaction are inputs to other chemical reactions, is a key component of the cellular physiology. in addition, the interactions of metabolites with other larger bio-molecules  are critical for many important biological processes. therefore, metabolomics, the study of all metabolites in a system, in its own has great implications in scientific and biomedical advancement  <cit> .

mass spectrometry is a popular technique for metabolic profiling  <cit> . in a typical experiment, metabolites in a sample are first derivatized and then separated using either liquid or gas chromatography . the separated metabolites are further analyzed by mass spectrometry to generate their fingerprint spectra . the identification of a metabolite is usually assisted by including a spectrum library where each spectrum's identity is known. the fingerprint spectrum is compared with each spectrum in the library using a numerical score that characterizes the similarity of the pair. the score used to measure mass spectral similarity is called similarity score. the metabolite in the library with the best score is matched to the fingerprint spectrum as the identification of the spectrum  <cit>  .

with the development of mass spectrometry technology, particularly combined with the comprehensive two-dimensional gas chromatography  that substantially improves the separation capacity, a large number of metabolites can now be identified at a time. by comparing spectra from those metabolites with spectra from known identities, identification is performed  <cit> . however, these identifications are subject to errors due to experimental noise, incompleteness of the library, technical limitations and so on. thus, it is in great need to improve the accuracy of both the identifications and estimates of false positives at the data analysis stage as the validity and efficiency of the downstream analyses rely on the quality of the identifications.

to our knowledge, there have been relatively few developments along this line, compared with similar analysis issues in mass spectrometry based proteomics  <cit> . several studies on spectra registration  for comprehensive two-dimensional gc data have been done  <cit> . in some studies, without addressing the identification issue, they assumed that metabolite identification by chromatof software is correct instead and used those identification results directly for alignment. in addition, no model to analyse score distribution has been developed in order to improve the accuracy of metabolite identification. in this paper, we propose an empirical bayes model which analyzes similarity score distribution to improve the accuracy of metabolite identifications and their confidence measures for gcxgc/tof-ms data. the model orchestrates all information coming from each experiment step and produces confidence measure of identification in the form of posterior probability. the advantages of our method include  the posterior probability allows straightforward estimation of false discovery rate   <cit>  and serves as the confidence measure;  metabolites in the library that are not matched to any spectrum are also assigned a confidence measure regarding their presence/absence status in the sample;  integration of different sources of evidence may provide better identification accuracy. a major novelty of our method is the inclusion of a competition score  for each metabolite j in the library, which is defined based on all spectra in the library. the competition score is a measure of the propensity of j being matched to some sample spectra through the resemblance of the spectrum of metabolite j with other spectra. as explained in details in methods section, the competition score provides useful information to discern the true from the false positives. in what follows, we provide a detailed description of the model and demonstrate the utility of our model through analysis of a mixture of metabolite standards and a real data set generated by gcxgc/tof-ms. for terminological clarity, since our identification is the compound identification via database search, it is also known as putative annotated identification. for simplicity, we use the word "identification" throughout the article.

RESULTS
experiments
experiment 1: mixture of metabolite standards
a mixture of  <dig> amino acids, fatty acids and organic acids were prepared in pyridine and derivatized with  <dig> μl of n-methyl-n- trifluoroacetamide . all gcxgc/tof-ms analyses were performed on a leco pegasus 4d time-of-flight mass spectrometer . then, acquired data were processed with a user defined data processing method. the leco chromatof software version  <dig>  was used for instrument control and spectrum deconvolution. a total of  <dig> sample spectra were obtained from this experiment.

experiment 2: rat plasma data
metabolites were extracted from a 100μl rat plasma sample using 900μl of organic solvent mixture  and further derivatized with mtbstfa. all gcxgc/tof-ms analysis were performed on a leco pegasus 4d time-of-flight mass spectrometer . the acquired data were processed with a user defined data processing method. the same software, leco chromatof software version  <dig>  was used for instrument control and spectrum deconvolution.  <dig> sample spectra were obtained from the experiment.

more details about both experiments are provided in the additional file additional file  <dig> 

library and database search
for the analysis of experiment  <dig> data, because of the derivatization, a total of  <dig> metabolites are considered to be the true positives. details of the  <dig> true positives are provided in the additional file. the spectra of the  <dig> true positives were extracted from nist/epa/mih mass spectral library  that was embedded in chromatof software. to introduce noises, we also randomly selected  <dig> false spectra from the same library. therefore, the library is composed of n =  <dig> spectra with known identities. we consider cosine score as the similarity score for a pair of spectra. the cosine score  is interpreted as the angle between two spectra with smaller angle indicating more similarity, which is defined

  s=180πcos-1<a,b>||a||⋅||b||, 

where < a, b >is the inner product of spectra a and b and || · || is the euclidean norm. to calculate the competition score bj, we conducted all pairwise comparisons among the  <dig> spectra in the library and considered two values for the threshold h, h =  <dig> and h =  <dig> . for each of the  <dig> sample spectra, we compared it with the  <dig> spectra from the library using cosine score and selected the metabolite with the best score  as the assignment to that sample spectrum.

for the analysis of experiment  <dig>  we used the library obtained from automated mass spectral deconvolution and identification system  software, which includes  <dig> spectra. amdis is a software for gc-ms data interpretation from national institute of standards and technology . again, bj was calculated based on all pairwise comparison of spectra in the library and database search assigned the metabolite with the best cosine score to each sample spectrum.

mixture of metabolite standards
we obtained ρ^= <dig>  based on the em algorithm. this suggests that about  <dig> % of the metabolites in the library, or  <dig> ×  <dig>  =  <dig>  are expected to be present in our sample. this is very close to the known number of true positives,  <dig>  furthermore, τ^= <dig> , which indicates that 84% of the matches of the true positives are correct. the three fitted normal curves and the mixture distribution  are shown in figure  <dig>  it can be seen that the estimated mixture distribution  fits the similarity score data well . one major advantage of the mixture sample of metabolite standards is that it allows us to assess the performance of any method because the identities of metabolites in a sample are known. for comparison purpose, we consider four methods: naive method, nist ms dot product, weighted dot product, and composite similarity based on the methods developed by stein and scott  <cit> . more details about three other methods except naive method are given in  <cit> . among them, the naive method has the best performance in terms of roc curve and fdr. all comparison results are provided in the additional file. thus, we chose the naive method to compare with our method, which is defined by using the average similarity score to call the status of a metabolite . figure  <dig> shows the receiver operating characteristic  curves of our method and the naive method. in the same graph, we also plot the true fdr for both methods. it is clear that our method has more discriminating power than the naive method. note that our library has much more true negatives than true positives, i.e.  <dig> v.s.  <dig>  implying that even minor compromise in specificity will significantly inflate the fdr. for instance, even though the specificity is controlled at 99%, the fdr is 28% with perfect sensitivity. therefore, we chose to compare the roc curve at high specificity range. as we can see in figure  <dig>  our method provides moderate sensitivity  even at extremely high level of specificity .

not only does our method provide better identification accuracy, but our method also provides a reliable estimate of the fdr. this is shown in figure  <dig>  where true fdr is plotted against estimated fdr for metabolites claimed to be present based on different thresholds of the posterior probabilities. it can be seen that the estimated fdr is very close to the true fdr and most of the time our fdr estimate is conservative.

the definitions of terminologies such as fdr, sensitivity, specificity and roc curve are provided in the additional file.

rat plasma
we present the results based on h =  <dig>  results based on h =  <dig> can be found in the additional file. figure  <dig> shows the distribution of the similarity scores of the  <dig> spectra generated by a sample of rat plasma. similar to the experimental data of the mixture of metabolite standards, there seems to be three distribution components as well. we fit similar model as the one used for the analysis of the data of mixture of metabolite standards. as shown in figure  <dig>  the estimated normal mixture  fits the empirical data well .

based on parameter estimates, we expect that 10%  of the  <dig> metabolites in the library are present in the sample. in a perfect world, there should be  <dig> metabolites with posterior probability equal to  <dig> and the rest have zero posterior probability. if it is the case, we have the maximum amount of knowledge on which metabolites are present or absent. however, in the real world, the confidence is not concentrated on  <dig> metabolites, but diluted to all  <dig> metabolites in the library. in table  <dig> we provide the number of positives and nominal fdr by applying different thresholds to the posterior probabilities. clearly, the probabilities are much more diluted to all  <dig> metabolites in the library and only  <dig> of them have a confidence higher than  <dig> . therefore, our certainty on which metabolites are present or absent has been reduced. essentially, the separation of the three distribution components is less obvious than the experiment  <dig>  as a result, discrimination of the true from the false metabolites in this experiment is more difficult. more results are given in the additional file.

number of claimed positives and fdr for rat plasma. ncp stands for the number of claimed positives and efdr stands for estimated false discovery rate

rationale behind the use of competition score and multiple similarity scores
in this section, we explain what kind of benefits we get from the use of competition score and multiple similarity scores of the same metabolite, the main advantages of our model. for this purpose, we present two illustrative examples by using experiment  <dig>  in the first example, we highlight the effective role of competition score in separating positives from negatives. to this end, we consider two hypothetical metabolites j =  <dig>   <dig>  all of which are assigned to two sample spectra with the same similarity scores  <dig> and  <dig>  however, the competition scores are different with  = , and  = , i.e., the only difference between two hypothetical metabolites is their competition scores. then, any difference in the posterior probability is attributed to the difference in the competition score. based on our model, the posterior probabilities for the two metabolites are  <dig>  and  <dig> , respectively. therefore, the competition score allows adjustment of the confidence of a metabolite in addition to the similarity scores. to understand the difference in posterior probabilities, note that given the same similarity scores, the confidence of a metabolite is driven by the likelihood ratio of equation  to equation  as a function of bj and bj*. metabolite  <dig> has higher confidence than metabolite  <dig> because the relative increase in likelihood of being matched due to the presence of metabolite  <dig> is higher than that of metabolite  <dig>  to summarize, the idea is that evidence on the presence or absence status of a metabolite based on the fact that it is matched to some sample spectrum should be quantified according to the capability of the metabolite's spectrum to mimic other spectra in the library, and how the likelihood of being matched will be altered from absence to presence.

in the second example, we elucidate the treatment of our model on multiple similarity scores. more precisely, we highlight the effect of multiple similarity scores on confidence of metabolite identification. what if we use single average score of those multiple scores instead of individual scores? to answer this question, we select two metabolites with bj =  <dig> from the mixture of metabolite standards to exclude the effect of competition score: one true positive tp <dig>  and one true negative tn <dig> . since we know which metabolite exists in sample in this case, a true positive presents a metabolite in library which exists in sample as well and is claimed as positive. tp <dig> was assigned to  <dig> sample spectra with similarity scores highlighted by * in red in figure  <dig>  tn <dig> was assigned to  <dig> sample spectra highlighted by * in blue. the bigger * represents the average score for each of the metabolites. the naive method is not able to discriminate the two metabolites because they have similar average scores, i.e. close to  <dig>  however, our empirical bayes model provides posterior probabilities  <dig>  and  <dig>  for tp <dig> and tn <dig>  respectively. the reason our model performs well here is that all individual scores, not the single average score are incorporated into the model and play a key role of producing posterior probability. the point is that taking into account the number of matches and the distribution of the similarity scores provides rich information in discriminating the true from the false positives.

discussion
in this paper, there are two elements in layers  <dig> and  <dig> that need more explanation. the detail description of the model is given in methods section. in layer  <dig>  the quadratic form of the function of conditional probability was inspired by the results of logistic regression. more specifically, we investigated the relationship between competition score and status of metabolites. for example, we fitted logistic regression model  to  <dig> true negatives and noticed that quadratic function is fitted well, i.e., p-values for parameters corresponding to bj and bj <dig> were less than  <dig> . in layer  <dig>  the characterization of score function was based on the distributional behavior of similarity scores. it varies from data to data. in the data we analyzed, we considered three component normal mixture and the model worked reasonably well. note that data-specific property of score distribution made us utilise different component mixing for each data set. for the mixture of standard metabolites, we considered ft to be two component normal mixture and ff single normal distribution. in contrast, for the rat plasma data, we considered ff to be two component normal mixture and ft single normal distribution.

the composition of the library will influence identification process. obviously the quality and species of the spectra included in the library will affect how well identification can be made. however, this aspect is complicated and beyond of the scope of this paper. actually it can be a separate study in its own right. nevertheless, we did make observations on the effect of the size of the library on the quality of identifications. when the library include much more false positives, identification of component in the standard mixtures become much more difficult as there are "false positives" with great similarity with the true positives. the posterior probability in this case tend to be much lower. note that this is not a failure of our model itself, it is simply because the matching score is not sufficiently discriminating anymore.

CONCLUSIONS
database-search based algorithm has been a popular approach to mass spectrometry-based high-throughput metabolite profiling. due to the complexity of the experimental procedure and dynamic nature of the fragmentation process, identifications of metabolites in gcxgc/tof-ms are subject to errors. the accuracy of identifications and false positive estimate are critical for the error control of downstream in silico or experimental investigations. during the database search, each candidate metabolite faces competition from other metabolites in the library to be the top hit. on the other hand, a large number of sample spectra also offer many opportunities for a candidate metabolite to be falsely matched. taking into account the competition and opportunity associated with each candidate metabolite allows one to more properly extract evidence on the presence/absence status based on whether or not a candidate metabolite is matched to some sample spectra. this type of evidence adds another dimension of information to the similarity score for the assessment of the confidence of metabolite identifications. in this article, we proposed the concept of a competition score to characterize the magnitude of competition and opportunity for each candidate metabolite. the competition score and similarity score are integrated by an empirical bayes model to yield confidence measure in the form of posterior probability.

since our method is a novel model-based approach to metabolite identification in gcxgc/tof-ms data, there is no other model-based method to compare with. thus, we compared it with four other methods, especially, the naive method which is solely based on the similarity score. through the experiment of mixture of metabolite standards, it was demonstrated that our model provides more accurate metabolite identifications than other methods. just as controlling type i error is very important issue in classical statistics problem, so is controlling false discovery rate in high-throughput data  <cit> . as we see in figure  <dig>  our estimate of fdr is reliable and conservative. from a sensitivity perspective, a moderate sensitivity  is retained even at the extremely high level of specificity . it should be noted that the primary goal of high-throughput data analysis is to select promising candidate for downstream target-orientated experimental studies. therefore, false positive is more of the investigator's concern than false negative. in this sense, we consider fdr is of higher priority than sensitivity in data analysis.

it is conceivable that the conditional probability of being a correct match given the presence status  may also depend on the competition score or some other more appropriate measures. extension of our model along this direction could lead to further accuracy improvement.

