BACKGROUND
genomic structural rearrangements are a hallmark of cancer. among them, deviations in the amount of genomic content that arise during tumorigenesis, called copy number alterations , can critically affect gene expression patterns  <cit> . a priori, expression could be expected to correlate with gene dosage. however, although a certain global correlation exists, individually, it has not been observed to be linear and, in some cases, it can even be inverse  <cit> . this is due to a range of dosage regulation mechanisms  <cit>  that confer the cell with robustness to the presence of cnas. still, greater expression variability arises from such regulation  <cit>  and, if large amounts of dna are affected by cnas, cell control cannot be kept  <cit> . furthermore, post-transcriptional and post-translational modifications, folding stability and gene-protein and protein-protein interactions greatly mask the effect of copy number changes, but correlation between gene dosage and protein expression has been found to be greater in the case of oncogenes  <cit> . indeed, the importance of cnas in cancer is demonstrated by the existence of cna patterns that allow to differentiate between cancer types  <cit>  and to analyze cancer progression and complexity  <cit> .

high-throughput technologies, including array comparative genomic hybridization , single nucleotide polymorphism  arrays and high-throughput sequencing  follow a similar computational analysis workflow for the detection of cnas: preprocessing of raw data, copy number profile segmentation and cna calling, based on the average values of the resulting segments. the first step, preprocessing, is vital for improved cna detection and is often underrated  <cit> . for hts data, this step starts with read summarization, which involves counting the number of reads that fall within genomic windows, typically non-overlapping and fix-sized. the result is a window read count  profile, which is a proxy to the true copy number profile. some reads, such as those with low mapping quality  <cit> , can be filtered during summarization, while whole windows can be filtered afterwards. preprocessing may continue with normalization, which corrects for technical or biological factors that confound the true copy number profile, mainly the gc content  <cit> . normalization against a matched normal sample allows a better correction of confounding factors  <cit>  and reduces the need for filters, but it is not always available  <cit> , hence the relevance of optimal filtering and gc content bias correction.

here, we present a user-friendly and highly-parallelized r package, called seqcna, which allows an integrated copy number analysis workflow. the package includes novel methodology on  window filtering, reducing false positives in comparison to assessed existing methods, and  gc content correction, improving profile quality, especially under great read coverage and high correlation between gc content and copy number.

implementation
seqcna is available as an r package through the bioconductor project  <cit> . it depends on the glad  <cit> , adehabitatlt  <cit> , dosnow  <cit>  and seqcna.annot r packages, which are automatically downloaded from the bioconductor and cran  <cit>  repositories as needed. the seqcna.annot companion package contains annotation on gc content, mappability and presence of common cnvs for the included genome builds, enabling several optional steps of the analysis.

an integrated read summarization function, seqsumm, written in c++ and interfacing with the r code through rcpp, makes seqcna the only tool required to obtain copy number profiles from sam alignment files . the subsequent functions in the package return visual feedback throughout the analysis and require little parameterization. a vignette with a worked example and detailed help on functions and parameters are included within the package.

RESULTS
workflow
the seqsumm function summarizes read counts into windows of the selected size, but it also classifies paired-end mapping  reads based on their sam flags - which consider read pairing, separation and orientation - and calculates mean window mapping quality, enabling two of the five window filters available in seqcna. the first filter involves pem read classification, which has previously been used to select reads prior to summarization  <cit>  and to detect the limits of structural genomic rearrangements, including cnvs  <cit> . improper reads are considered those that are not in read pairs with correct separation and orientation. we saw that genomic windows with an elevated proportion of improper reads tend to be outliers in the rc profile, probably indicating the presence of intra-window structural polymorphisms. if these windows are not of interest, they can be filtered by setting a maximum proportion of improper reads within each window. second, directly filtering low mapping quality reads reduces the signal-to-noise ratio  of the rc profile  <cit>  so, instead, seqcna provides a filter that discards windows, based on the mean mapping quality of proper reads. a third filter, the trimming filter, removes windows with extreme rc values, with the distinctive feature that a prior correction against gc content is performed, avoiding trimming extreme rcs that are only due to extreme gc content. the remaining two filters discard windows with the presence of common cnvs described by altshuler et al.  <cit>  and low mappability, where the mappability of a window reflects the uniqueness of 35-nucleotide long sequences within it  <cit> .

a matched normal sample is preferable  for the pem-based, mapping quality and trimming filters, in order to prevent biases that arise due to the presence of cnas. for instance, some extreme rcs on an unpaired tumoural profile can be due to cnas and should be kept, so the process of trimming should be able to spot them to avoid their filtering. for the matter, the trimming filter in seqcna uses an algorithm based on the wald-wolfowitz runs test to tell apart cnas from outliers on unpaired tumoural profiles. it measures the randomness of the position of those windows with rc above a certain threshold, where the higher the threshold, the greater the randomness due to outliers. the threshold is set where a sudden change in randomness occurs due to the inclusion of adjacent windows, not likely to be outliers . the five filters are independent and are applicable based on availability of pem reads, matched normal sample and genome build annotation. while each filter targets windows with a specific behavior, many windows are captured by more than one filter, increasing the filtering robustness .figure  <dig> 
window filtering on hcc <dig> sample’s rc profile. visual assessment of the filtering performed by seqcna on sample hcc <dig>  the profile  shows where the filtered windows lie within it. mappability-filtered windows are marked as orange triangles; mapping quality-filtered, as magenta crosses; and trimming-filtered, as purple dots. the venn diagram shows the overlaps among the windows filtered by the three applied filters. the plots on the right depict the density maps on which thresholds delimit the windows to be discarded based on the different filters.



the next step of the analysis is normalization, which accounts for confounding factors in the rc profile. if a matched normal sample is not available, normalization involves gc content bias correction, which removes a great part of the observed bias. the described relationship between gc content and rc  <cit>  is generally non-linear, so, until recently, gc content correction has been tackled through local regression  or polynomial fitting  <cit> . such approach is adequate for genomes where  gains and losses account for a small fraction of the genome or they are rather balanced and  gc content distribution is similar among regions with different copy numbers, but this is not typically the case of cancer genomes, where a linear relationship between copy number and gc content produces a bias in the regression. the gc correction algorithm in freec  <cit>  tries to improve mere regression by looking for the gc content curve of the main copy number, sampling window densities at specific gc content levels. thus, freec is able to handle the possible correlation between copy number and gc content, as long as the correlation does not affect the convergence of the algorithm towards the main copy number. furthermore, such algorithm works under the assumption of known sample ploidy and proportionality between rc and copy number, which may be shifted by the presence of subclones in the cell population.

the approach we propose for gc bias correction, called seqnorm, accounts for the correlation between copy number and gc content independently of sample characteristics. textitseqnorm is a two-iteration algorithm, with a first pass regression that removes much of the gc bias and a second step that accounts for the correlation between gc content and copy number before a second pass regression. while the first regression is sensitive to the correlation and can, therefore, under- or over-correct the gc curve, the gc bias generally decreases. afterwards, glad  <cit>  produces a segmented profile in a way that segments represent the maximal neighbourhoods in which the local constant assumption of the statistical model holds. such property is interesting because low intra-segment variability is key to the second regression, which is applied segment-wise. namely, segments with the highest rc variability, as well as those spanning few windows, may not provide robust enough fits. in turn, those with little gc content variability do not allow estimating the effect of extreme gc content. therefore, segments undergo a selection process . centering the selected segments removes the read count differences due to copy number changes, essentially removing the undesired correlation. thus, the subsequent segment-wise regressions provide good approximations to the genome-wide effect of gc content on read counts without the bias that emerges from the correlation and their median gives a robust estimate of the true effect . although devised to improve gc content normalization, seqnorm can also be used to normalize against matched paired normal.figure  <dig> 
gc correction of hcc <dig> sample’s rc profile. gc correction results over the hcc <dig> sample’s rc profile.  density plot of the normalized rc profiles. the density of the seqnorm-corrected profile distinguishes better the different copy numbers in the mixture.  read counts depending on the window’s gc content, with greater density as darker grey. in blue, regression line estimated through the typical approach. in orange, regression line estimated by seqnorm.



existing tools for cna detection on hts data perform a basic preprocessing and put their focus on the copy number calling step, taking advantage of allele-specific information  <cit>  and automatically predicting copy number profiles  <cit> . on the other hand, seqcna focuses on preprocessing and provides additional simple methods to obtain the final copy number profiles. hence, the analysis is completed by segmenting the seqnorm-corrected profile with glad and, through visual assessment, defining copy number limits .figure  <dig> 
copy number calling of hcc <dig> sample’s segmented rc profile. visualization of the gc corrected and segmented profiles of sample hcc <dig>  together with the thresholds that delimit copy number calls. chromosomes are delimited by black vertical lines. the gc corrected profile is shown as a black-coded density map, the segmented profile is shown in green and the thresholds are marked in red.



methodology assessment
for the methodology assessment, we used data from human samples according to the declaration of helsinki, the european guidelines on good clinical practice, relevant national and regional authority requirements and hospital clinico san carlos’s clinical investigation ethics committee . informed consent was obtained from every subject.

in a recent comparison  <cit> , we found gap  <cit>  to be the best performing cna-detecting method on snp-array data. knowing that, we compared the results from seqcna, gap and state-of-the-art cna-detecting methods on hts data, namely freec  <cit> , cnanorm  <cit>  and patchwork  <cit> , over two colon cancer samples we hybridized on snp-arrays and paired-end sequenced  under accession number egas00001000558). seqcna’s copy number profiles were the closest ones to gap’s  and presented the lowest departure from consensus profiles:  <dig> % in both cases . the novel pem-based and mapping quality filters are the main reason behind the reduced false positive rate in comparison to freec and cnanorm .

in order to assess seqnorm’s performance, we built a semi-simulated dataset from the combination of the copy number profiles of  <dig> cell-lines  <cit> , determined using picnic  <cit> , and the rc variability of  <dig> non-tumoural samples . on the semi-simulated dataset, real cell-line  <cit>  and prostate cancer samples  <cit>  the median signal-to-noise ratio  improvement with respect to typical regression ranged from 1% to 4% , with a maximum improvement between 27% and 77%, where 2% already yields a visibly more defined density map . we investigated the factors that affect this improvement and saw that it directly depends on:  the snr of the rc profile and  the correlation between gc content and copy number, which tends to be greater when the top main copy number  is  <dig> or  <dig> and there are between  <dig> and  <dig> distinct main copy numbers .

future development
as of the initial release, the annotation package covers the human genome with builds hg <dig> and hg <dig>  in the future, we aim at extending the package to include further genomes and builds based on users’ necessities.

we are also pondering possible extensions to the main package, including relevant region annotation and support for side-by-side displaying of copy number profiles in existing databases. increased automation is also plausible, especially in the final calling step, but we reckon that improved methodology needs to be developed in this regard in order to replace human judgment. in general, while gc bias correction is a mature issue, we expect the filtering and calling steps to see further developments. specifically, additional intelligent filter threshold selection and multifactorial filtering are issues that remain open.

CONCLUSIONS
we have presented seqcna, a tool that allows integral analyses for the detection of cnas in hts tumoural data and provides relevant advancements in the preprocessing steps. namely, it incorporates a novel normalization method, seqnorm, which significantly improves the performance of typical regression, especially on samples with high snr  and under high correlation between gc content and copy number. the tool also incorporates novelties for the filtering of windows in rc profiles - thus reducing the amount of false positives, including a pem-based filter, a method that automatically sets trimming thresholds and a sensible window filter that replaces the removal of low quality reads.

availability and requirements
project name: seqcna

homepage:http://www.bioconductor.org/packages/devel/bioc/html/seqcna.html

operating system: platform independent

programming language: r

other requirements: samtools 

license: gpl-3

any restrictions to use by non-academics: none

electronic supplementary material
additional file 1:
supplementary methods, figures and tables.


 competing interests

the authors declare that they have no competing interests.

authors’ contributions

dma developed the methodology, software and corresponding testing. ama supervised the project, was responsible for the sequencing of the contributed samples and assessed the user interface. nt worked on the clinical data classification and in the sample selection. sv, vdo and mlm collected the tumoural and non-tumoural tissues from colorectal neoplasms after surgery, extracted the dna and purified it. all authors have read and approved the manuscript as submitted.

