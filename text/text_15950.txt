BACKGROUND
microarrays have been the most popular technology for genome-wide profiling of gene expression for the past  <dig> years. the earliest microarrays used two channels, with two rna samples separately labeled and competitively hybridized to the same array, as a means of controlling inter-probe variability  <cit> . despite the rise of one channel microarrays and other expression profiling technologies, two-channel arrays, also known as two-color arrays, continue to be a cost-effective platform for assessing relative gene expression. the use of two channels is more efficient than one channel for many comparative experiments  <cit> . microarrays constructed from est libraries may also be most effective when used with two channels. for species with few genomic resources a common strategy for differential expression studies is to use est libraries or high throughput sequencing methods to obtain partial transcriptome information and then use the resulting transcripts to develop microarray probes. for example,  <cit>  developed a nimblegen microarray to investigate disease resistance in apple and  <cit>  used a custom microarray to assess differential gene expression in diseases of a marine flatfish. bay lk,  <dig>  <cit>  used a custom spotted cdna array to assess differential expression between populations of a reef-building coral.

the traditional and most common approach to the analysis of two-channel gene expression microarrays is to summarize the intensity values in terms of the log-ratios of the two channel intensities for each probe on each array  <cit> . most papers on the statistical analysis of two-channel microarrays have also taken this general approach  <cit> . expression levels measured by neighboring spots on the same array have been shown to be highly correlated  <cit> . observations of the two channels from the same physical spot are expected to be even more highly correlated. the practice of analyzing log-ratios in effect takes advantage of this correlation, as the variance of the log-ratio should be smaller than the sum of the variances of two individual positively correlated log-intensity values.

it has been argued however that log-ratio analyses are not fully efficient in that they do not use all the information available in the data  <cit> . a number of papers have popularized the idea of analyzing the individual channel intensities as separate observations  <cit> . one approach is to an estimate a random effect for each microarray spot to account for the correlation between the two channels  <cit> . this approach can be implemented by fitting a mixed model, a linear model with both fixed and random effects, to the expression data for each gene  <cit> . separate channel analysis has been used to analyze experiments for which two channels were available for some arrays and only one channel for others  <cit> . separate-channel approaches to the normalization of two-channel microarray data have also been discussed  <cit> .

apart from other efficiency gains, separate channel analysis gives the possibility of comparing treatment conditions that are not connected in a two-color experimental design  <cit> . a two-channel microarray design is said to be connected if every pairwise comparison among treatments can be expressed as a difference of log-ratios. for example, reference designs and loop designs are connected  <cit> . unconnected designs contain islands of arrays with treatments that are unlinked by hybridization to the same arrays. for example, if an experiment includes  <dig> treatments b, c, d and e with treatments b and c always hybridized together and treatments d and e always hybridized together, there is no way to compare treatments b and d using the log-ratio approach. separate channel models are necessary to analyze such unconnected designs.

a number of papers have shown that the two channel intensities from each spot are usefully represented in terms of the log-ratio  and the average log-intensity over the two channels  for each spot  <cit> . this article reinterprets the m and a-values in terms of within and between spot contrasts. the usefulness of this partition is shown to arise in good part from the fact that the m and a-values for a given spot are statistically independent even though the individual log-intensities are highly correlated.

this article goes on to reformulate the mixed model approach in terms of the m and a-values. this approach not only presents an efficient algorithm for estimating the mixed model but also elucidates the difference between the traditional log-ratio based approach and the analysis of separate-channels. use of the m-values alone for the analysis is shown to discard the between-spot information. the separate-channel approach amounts to recovering information from the between-spot error stratum, i.e., from comparisons among the a-values. the efficiency gains of separate-channel analysis are quantified in terms of the intra-spot correlation.

the idea of regularized statistical methods that borrow strength between genomic features is an important recurring theme in genomic data analysis. statistical research has shown that, across a wide range of multi-parameter problems, improvements in parameter estimation can be made by combining information across the datasets used to estimate the individual parameters  <cit> . this principle is especially important for microarray data analysis with tens of thousands of probe-wise variances to be estimated, and the idea has led to a number of popular regularized microarray methods  <cit> . regularization of variance components has also been shown to be beneficial for mixed model analyses of microarray data  <cit> . the article introduces a simple but effective regularization for the spotwise random effects by forcing the intra-spot correlation to be a constant value across all genes in the study. the genewise variances are subsequently regularized using a conjugate empirical bayes procedure  <cit> . the treatment of the intra-spot correlation as a global parameter leads to a number of important advantages. the global estimator is very precise, so the intra-spot correlation can be treated as a known parameter at the individual gene level. the permits the mixed model to be transformed into a form suitable for entry into the well-established empirical bayes analysis pipeline of the limma package  <cit> . unlike previous mixed model approaches, this approach leads to test statistics with exact parametric distributions under the null hypothesis, even for experiments with small numbers of samples  <cit> .

the method proposed in this article for separate-channel analysis is no more difficult to apply in practice than the traditional log-ratio analysis and provides an intuitive and powerful means to make comparisons that might otherwise not be possible. the separate channel tests of differential expression are shown to be more statistically powerful than those from the log-ratio approach, leading to reductions in both false discovery and false nondiscovery rates. this article includes several cases studies, which demonstrate the advantages of the separate channel approach and the performance of the proposed regularization approach for the intra-spot correlation and the genewise variances.

RESULTS
intra-spot correlation
suppose that a gene expression experiment has been conducted in which 2n rna samples have been hybridized to n two-channel microarrays, each printed with the same set of p probes. in general, there may be more than one spot on each microarray for the same probe dna sequence  <cit> , but we will suppose here that all spots are to be treated as if they correspond to independent probes. note we use “probe” here to refer to the cdna sequence used in the array design and “spot” to refer to the physical feature printed onto each array. two-color microarrays yield two intensities values for each spot, one for each channel. following usual practice, we will call the shorter wave-length channel “green” and the other “red”. most image analysis softwares yield a foreground and a background intensity for each channel for each spot. we will assume that the foreground intensities have been background corrected, normalized and log-transformed to yield log <dig> intensities. write ygi <dig> and ygi <dig> for the green and red channel log-intensities, respectively, for probe g on array i. we will assume that there are no missing values, that is, a finite ygic is available for all gic. in particular, all the background-corrected intensities are assumed to be positive so that the log-intensities are properly defined, as can be ensured by a variety of model-based background correction strategies  <cit> . the log-intensities are assumed to be normally distributed,

  ygic∼n 

where μgic is an unknown mean that depends on the probe and the treatment conditions applied to channel c on array i. the unknown σg <dig> is probe-specific but common across arrays for each probe.

we can view each physical spot on each array as a block giving rise to two observations, one for each channel. while it is reasonable to treat log-intensities observed on different arrays as independent, two observations from the same physical feature of the same array must almost inevitably be highly correlated. hence we assume ygic and yg′i′c′ are independent if i≠i′ but that

 corrygi <dig> ygi2=ρg 

where ρg is the unknown intra-spot correlation. we expect ρg to be positive to reflect the fact that the two channel observations share any characteristics local to that spot on that array  <cit> .

the separate channel linear model
probewise linear models provide a flexible and powerful approach to microarray data analysis  <cit> . we assume that the true mean log-expression values μgic can be represented by a linear model

 μgic=xictβg 

where the design vector xic indicates which treatment conditions are applied to the rna sample hybridized to channel c of array i, and βg is an unknown vector of coefficients representing population mean log-intensities or log-fold-changes between the treatment conditions. often xic is a vector of zeros and ones. in matrix notation, the linear model may be written

 eyg=xβg 

where yg is the 2n-vector of ygic values for probe g and x is the design matrix with rows xic.

the covariance matrix var is block diagonal, with diagonal elements equal to σg <dig> and off-diagonal elements either zero or equal to ρgσg <dig> for pairs of observations from the same spot. if an estimate of ρg is available, then the linear model coefficient vector βg can be estimated from the data by generalized least squares,

 β^g=xtcg−1x−1xtcg−1yg 

where cg is the correlation matrix obtained by dividing the variances out of var.

estimating the intra-spot correlation by mixed models
one approach to the separate channel linear model is to treat it as a mixed model with each spot a randomized block of size two  <cit> . the mixed linear model can be represented as

 ygic=μgic+bgi+εgic 

where bgi is the spot effect for probe g on array i and εgic is a residual error term. the spot and residual effects are both random, with bgi∼n and εgic∼n. here σbg <dig> is the variance component for spot-level variation or, equivalently, for array to array variation. the marginal variance for ygic is

 σg2=σgb2+σge <dig> 

and the intra-spot correlation is

 ρg=σgb2σgb2+σge <dig>  

the mixed linear model obviously assumes that ρg≥ <dig>  because σgb <dig> cannot be negative. a typical mixed model analysis will obtain reml estimators  <cit>  for σbg <dig> and σeg <dig>  leading to an estimate for ρg as above, and hence to a generalized least squares estimator for βg. obviously the mixed model constrains the intra-spot correlation to be positive.

fitting mixed models of this form has been used as the basis for two-channel microarray data analysis, although the test statistics have complex distributions that cannot be derived exactly  <cit> . in this article, we will reformulate the mixed model in order to obtain an exact distributional theory for empirical bayes test statistics, and in order to clarify the relationship between the mixed model and the traditional log-ratio analysis of microarray data.

spot-wise means and differences
following  <cit> , write mgi=ygi2−ygi <dig> for the log-ratio of red to green intensity for spot gi and agi=/ <dig> for the average log-intensity for the spot. these quantities were originally proposed for their use in normalization and quality assurance graphics, with “m” and “a” as mnemonics for minus and add respectively. here we make use of these same quantities as part of a formal statistical analysis.

a key observation is that mgi and agi are uncorrelated. they represent independent contrasts of the correlated observations ygi <dig> and ygi <dig>  in terms of the above mixed model, mgi can be interpreted as a within-spot contrast, whereas any comparison of the a-values represents a between-spot contrast. the variances are given by

 varmgi=σmg2=2σg21−ρg 

and

 varagi=σag2=σg21+ρg/ <dig>  

we see that the variance of m decreases with the intra-spot correlation whereas that of a increases. note in fact that

 12log4σag2σmg2=tanhρg, 

so that ρg can be estimated from the ratio of the two variances.

estimating the intra-spot correlation from the m-value and a-values
we now transform the mixed model for y into a model for the m-values and a-values. this has the effect of transforming the mixed model, in which the observations are not independent but all have the same variance, into a model in which all the observations are independent but the variances are unequal.

write mg=t and ag=t for the vectors of m and a-values respectively for probe g. note that these vectors are linearly related to yg through mg=cmtyg and ag=catyg with transformation matrices cmt=⊗in and cat=⊗in. also write zgt=t for the combined 2n-vector of m and a-values. then zg satisfies the linear model

 e=zβg 

where z is the related to the previous design matrix by z=tx.

the linear model for zg is heteroscedastic, because the first n values of zg have variance σmg <dig>  whereas the remaining n values have variance σag <dig>  the model can be fitted using an efficient reml algorithm designed for heteroscedastic regression models  <cit> . this yields reml estimators σ^mg <dig> and σ^ag <dig> from which an estimate of ρg can be obtained. this regression approach is more general than the mixed model approach described above in that the estimated intra-spot correlation can take negative as well as positive values. the reml estimators σ^mg <dig> and σ^ag <dig> can be shown to follow approximate chisquare distributions with fractional degrees of freedom dmg and dag respectively .

estimating the common intra-spot correlation
the intra-spot correlation ρg arises from the technical design of two channel arrays rather than from biological variation or from characteristics of the rna sources being compared. it is therefore reasonable to assume that the intra-spot correlation will be relatively consistent across the probes. this leads to the argument that the correlation estimators ρ^g may be pooled between probes, an approach similar to that used by  <cit>  when treating within-array replicate probes. from this point, we assume therefore that the intra-spot correlations are equal across probes, ρg=ρ for all g.

if the data from different probes were statistically independent, then the reml estimator of τ= tanh− <dig> would be

  τ^=12log4∑g=1gσ^ag2∑g=1gσ^mg <dig>  

although theoretically efficient under the independence assumption, this estimator is not robust against outliers.

a more robust estimator can be constructed by obtaining probe-wise estimates of τ. the individual probe version of equation  is

 τ^g=12log4σ^ag2σ^mg <dig>  

it is shown in methods that τ^g is a biased estimator of τ, but with a constant bias that can be computed from the degrees of freedom for σag <dig> and σmg <dig>  the bias correction term is similar to the analogous term derived in  <cit> . a trimmed mean of the bias-corrected τ^g across all probes then provides a suitably robust estimator of τ and hence of ρ= tanh. our software implementation trims 15% of the probes from each tail by default.

common correlation inference reduces to ordinary linear modeling
the pooled estimator ρ^=tanh is estimated from all the probes on the microarray, typically tens of thousands of probes, and hence can be considered to be a highly precise estimator on which each individual probe has little influence. a consequence of this is that ρ^ can be treated as known when undertaking inference about each individual probe. in particular, the heteroscedastic regression model for m and a-values described above can be transformed to an ordinary homoscedastic regression model by rescaling all the m-values by {2}1/ <dig> and all the a-values by {/2}1/ <dig>  this leads to a re-scaled version zg∗ of zg and a re-scaled version z∗ of the design matrix z. the estimator of βg finally is the ordinary least squares estimator

 β^g=z∗tz∗−1z∗tzg∗. 

in this way, the common correlation model permits us to undertake a separate channel analysis without incurring the inferential complexities of mixed models or heteroscedastic regression. once the common intra-spot correlation is estimated, the separate channel analysis can utilize the established framework of linear modeling for microarray data  <cit> . in particular, empirical bayes methods can be used to borrow strength between probes, leading to moderated t-statistics with exact distributions, as previously used for log-ratio analysis or for one-channel microarrays  <cit> . details are given in methods.

efficiency gains for separate channels over log-ratios
recovering information from the a-values
this section considers the relative efficiency gains of separate-channel versus log-ratio analysis for some commonly used designs. efficiency is considered on a gene by gene level, so the subscript g is suppressed in this section.

our reformulation of separate channel analysis in terms of m and a-values clarifies the relationship with log-ratio analysis, because the traditional log-ratio analysis is exactly equivalent to the m-value analysis. in other words the log-ratio analysis is equivalent to ignoring the second set of n observations in the heteroscedastic regression described above. the extra information recovered in the separate-channel approach compared to analysis of the log-ratios corresponds exactly to the information contained in the a-values about the treatment effects of interest. recovering this information in general improves our power to detect treatment differences.

paired design
the simplest comparative microarray experiment has only  <dig> treatments and only biological replication. on each array, one channel is hybridized to a sample from each treatment. in this case there is no information gained from recovering intra-probe information. both the log-ratio and the separate channel approaches yield the same t-statistic  for testing for differential expression for a given probe.

common reference design
the second simplest design also has only  <dig> treatments  and only biological replication. however, one channel on each array is hybridized to a common reference sample r, which is usually a technical replicate from a large rna pool, while the other channel is used for a sample from one of the  <dig> treatments of interest. suppose that there are n/ <dig> arrays comparing b with the reference and n/ <dig> comparing c with the reference. we will assume that the reference is always labeled green, but the analysis below is readily modified to accommodate dye-swap or dye-balanced designs, in which b and c may be hybridized with either label.

consider the analysis for a given probe. let m¯b be the mean of the m-values for the arrays hybridized with b and m¯c be the mean of the m-values for the arrays hybridized with c. define Āb and Āc similarly. then the laws of probability for sums and differences of random variables give:

 m¯b∼n/n)m¯c∼n/n)Āb∼n/n)Āc∼n/n) 

where βb, βc and βr are the log-expression values for the probe in rna samples b, c and r respectively. write γ for the log-ratio of interest, βb−βc. the m-values yield the estimator

 γ^m=m¯b−m¯c 

with variance

 varγ^m=8σ2/n 

the a-values yield the estimator

 γ^a= <dig> 

with variance

 varγ^a=8σ2/n 

the statistical  information provided by the m-values is 1/varγ^m while that from the a-values is 1/varγ^a.taking the ratio of these two variances shows that the extra information provided by the a-values relative to that provided by the m-values is

 1−ρ1+ρ. 

if ρ is close to one, then the added information is close to zero and the log-ratio analysis is nearly fully efficient. if ρ is small, however, then the a-values can contribute nearly as much information as the m-values, effectively doubling the statistical information that is used.

these formulas also allow us to explore the efficiency of the common reference design itself. suppose that, instead of hybridizing the reference sample to each array, one channel of each array had been left empty. in that case, the log-fold-change βb−βc would be estimated using a one channel analysis with variance 4σ2/n. comparing this with varγ^m shows that the use of competitive hybridizations with a common reference improves the precision of the experiment if and only if the intra-spot correlation is greater than  <dig> , assuming that the usual log-ratio analysis is performed. when the intra-spot correlation is less than  <dig> , subtracting the reference from each m-values increases the variance of the observation rather than decreasing it. on the other hand, when a separate channel analysis is used, the use of the common reference channel always improves the precision of the experiment relative to not observing the reference channel at all. by using all the information available, the separate channel analysis restores the intuition that adding extra observations to a data set should not worsen the results.

unconnected designs
separate channel analysis is most useful in the case of unconnected designs for which some comparisons cannot be made through the m-values. suppose that n/ <dig> arrays are hybridized with rna from sources b and c and n/ <dig> arrays are hybridized with sources d and e. then the comparisons b versus c and d versus e can be made using m-values but b or c vs d or e can not. let m¯bc be the mean of the m-values for the arrays hybridized with b and c and m¯de be the mean of the m-values for the arrays hybridized with d and e. similarly for Ābc and Āde. then

 m¯bc∼n/n)m¯de∼n/n)Ābc∼n/n)Āde∼n/n) 

where βb, βc, βd and βe are the log-expression values for the probe in rna samples b, c, d and e respectively. let γ=βb−βc be the population mean log-ratio between b and c for a given probe and let δ=βb−βd be the population mean log-ratio between b and d for the same probe. the a-values provide no information about γ so the mixed model approach yields the same estimate and t-statistic as the m-value linear model approach. this estimator is simply

 γ^=m¯bc 

with variance

 varγ^=4σ2/n. 

the m-values provided no information about δ meaning that the m-value approach is unable to estimate δ. the combined m and a-value approach yields the estimator

 γ^=m¯bc/2−m¯de/2+Ābc−Āde 

for δ with variance

 varγ^=4σ2/n 

notice that the relative efficiency of δ^ versus γ^ is 1−ρ. this represents the reduced efficiency of making an indirect contrast between arrays versus a direct contrast between channel hybridized to the same arrays.

as a published example of an unconnected design, consider the experiment of  <cit> . jin et al.  <cit>  considered gene expression differences by gender and age  in two genotypes of drosophila melanogaster. each array had a single combination of gender and genotype with both ages in the different channels. thus this is a paired design in the age main effect, and this is the only effect that can be tested using the log-ratio analysis. instead a mixed model separate channel analysis was used to analyze the design as a 2×2× <dig> factorial design.

size of efficiency gains in practice
as noted above, there are two extreme cases in which the efficiency gain from separate channel analysis is either zero or 100%. for the simplest two-color experiment in which two treatments are competitively hybridized on the same arrays, and probe-specific dye-effects are absent, then the log-ratios are fully efficient and there is no information to be gained from a separate channel analysis. the other extreme is that in which unconnected treatments are to be compared. in that case the log-ratios contain no information, and the information gained from separate channel analysis is 100% .

for all other designs, the efficiency gain from separate channel analysis depends on the size of the intra-spot correlation. the intra-spot correlation measures the proportion of total variability arising from technical variability of arrays. generally speaking, the more biological variability there is relative to technical inter-array variability in an experiment, the lower the intra-spot correlation and the greater the information gain. the titration experiment  provides an example of an experiment with technical replication only. in this case, all the variation is technical in nature and the intra-spot correlation is very high at  <dig> . the apoai knockout experiment  is conducted on genetically identical mice. this experiment has a moderate degree of biological variability and yields an intermediate intra-spot correlation of  <dig> . the california poppy data  shows a greater degree of biological variability and yields a relatively low intra-spot correlation of  <dig> . for a common reference design, the relative efficiency gain from separate channel analysis with these three intra-spot correlation scenarios would be 2%, 8% and 21% respectively. note that an efficiency gain of 21% achieves the same improvement in precision as increasing the number of biological samples and arrays by the same percentage.

case studies
analysis pipeline
this section considers three case studies. the apoai knockout data is from academic spotted arrays while the titration example used commercial agilent arrays. the california poppy study used custom agilent arrays designed from a shallowly sequenced transcriptome. unless otherwise noted, all analyses were undertaken using the limma software package  <cit> .

the intensity data were background corrected and normalized prior to differential expression analysis as described in methods. briefly, m-values were loess normalized  <cit>  using normalizewithinarrays while a-values were quantile normalized  <cit>  using normalizebetweenarrays. this pipeline normalizes both the m-values and the a-values in a way that agrees with the usual m-value normalization for a traditional log-ratio analysis. the log-ratio and separate channel analyses used the same pre-processed data in each case to ensure the analyses are directly comparable.

linear modeling used the lmfit function for log-ratio analyses and the intraspotcorrelation and lmscfit functions for separate channel analysis. in all cases the ebayes function was used to construct empirical bayes moderated t-statistics and p-values  <cit> .

apoai knockout experiment - a  <dig> sample common reference design
the apolipoprotein ai gene  is known to play a pivotal role in high density lipoprotein  metabolism. mice which have the apoai gene knocked out have very low hdl cholesterol levels. callow mj,  <dig>  <cit>  discusses an experiment to determine how apoai deficiency affects the action of other genes in the liver, with the idea that this will help determine the molecular pathways through which apoai operates. a common reference design was used with  <dig> arrays,  <dig> wild-type and  <dig> knock-out mouse liver samples labeled with cy <dig> and a common reference sample, created by pooling rna from the  <dig> wild-type mice labeled with cy <dig>  samples were hybridized to a custom spotted cdna microarray with  <dig> probes.

both log-ratio and separate channel analyses were conducted to find genes differentially expressed in the apoai samples as compared to wild-type. the intra-probe correlation was estimated to be  <dig> %, suggesting an efficiency gain of 8% for the separate channel over the log-ratio analysis.

the second and third columns show the number of genes declared differently expressed at various fdr levels by the log-ratio and separate channel analyses respectively. fdrs were estimated using the qvalue package. the separate channel analysis detects more significant genes.

the qvalue package  <cit>  implements storey’s  <dig> method  <cit>  for estimating positive fdrs  and for estimating the total proportion of probes that are not differentially expressed . the log-ratio and separate channel analyses yielded similar values for π^ <dig> . this suggests that there are actually over  <dig> probes that are truly differentially expressed but were not detected at conventional fdr levels because of small fold changes or high variability. as expected, the separate channel approach shows a gain in power and is able to detect more of these probes. at the same time, the fact that π^ <dig> does not decrease for the separate channel analysis shows that the separate channel analysis is not on average decreasing the p-values of non-differentially expressed genes.

the results in table  <dig> are for qvalue fdrs that incorporate the estimate of π <dig>  the nonadaptive benjamini and hochberg fdr estimator  <cit>  gives similar results but is slightly more conservative. if benjamini and hochberg fdrs are used, the number of probes detected by the separate channel method decrease slightly to  <dig> and  <dig> at fdrs  <dig>  and  <dig>  respectively.

titration data - a multi-treatment common reference design
two cell lines with very different gene expression profiles were used to prepare a titration series of mrna as a test of microarray technologies  <cit> . the two cell lines were mcf <dig>  a cell line derived from breast epithelial cancer cells, and jurkat, derived from t cell leukemia cells. rna samples from the two cell lines were mixed in a titration series with 0%, 50%, 76%, 88%, 94%, and 100% mcf <dig> mrna. each mixture was labeled with both red and green and hybridized to  <dig> arrays. a separate 0% mcf <dig> sample was used as a reference on each array, in a dye-swap reference design. the data analyzed here were hybridized to agilent commercial human arrays. the data are available at  <cit> . after normalization and filtering of very low expressing genes as described in methods,  <dig> spots were used in the analysis.

the analysis was performed as a comparison of each sample with the control sample with 0% mcf <dig>  we expect that the number of genes detected as differentially expressed should increase with the percentage of mcf <dig> in the sample. four analysis methods are compared: log-ratio analysis using limma <cit>  and three separate channel analyses: the ordinary linear mixed model as in  <cit>  computed with lme <cit> , the common correlation separate channel method implemented in limma and the variance component shrinkage method implemented in maanova <cit> .

the ordinary mixed model  <cit>  is the classical model for analysis of variance in an incomplete random block design. it includes a block  effect, or equivalently an intra-spot correlation, and an error variance computed for each gene. in the context of microarray data analysis, it has the disadvantage of not borrowing information between probes, so the analysis of each probe relies solely on the data for that probe.

for maanova we used the linear mixed model with array as a random effect, and used the “fs” option with tabulated p-values to estimate the differential expression p-values. this option imposes shrinkage of the gene-wise mean squared error similar to the method in limma as well as shrinkage of the gene-wise estimate of the random spot variance. however, there are two important differences between maanova and the common correlation separate channel analysis implemented in limma. firstly, maanova moderates the gene-wise estimate of the spot effect, while the common correlation model imposes a common value ρ for the intra-spot correlation for all genes and models the spot variance σgb <dig> for gene g as σgb2=σge2ρ/. because the common correlation model estimates the common intra-spot correlation ρ from the  thousands of spots on the arrays, it is treated as a known constant. hence the common correlation model adjusts only for the estimation of σge <dig> yielding larger error degrees of freedom. as well, because the implementation of the common correlation model in limma uses an empirical bayes estimator for σge <dig>  the posterior error degrees of freedom are used for evaluating p-values. maanova uses an empirical method of shrinkage of the estimates of both σgb <dig> and σge <dig> which does not provide a degrees of freedom adjustment. instead maanova has an option to compute the permutation null distribution of test statistic. however, in this analysis we chose to use the tabulated p-values, which use the usual anova degrees of freedom. these match the degrees of freedom for the tests performed in the mixed model and adjust for estimation of both σgb <dig> and σge <dig> 

of the  <dig> genes found significant by the separate channel analysis at 50% dilution and fdr <  <dig> ,  <dig>  are found significant at all higher dilutions and only  <dig>  are found only at this dilution, which corresponds well to the estimated false discovery rate. by contrast, the next most powerful method, the log-ratio method, finds only  <dig> significant genes at 50% dilution and fdr <  <dig> .

to see the comparative results in more detail, figure  <dig> shows the empirical cumulative distribution function of the log <dig> of the p-values for some of the comparisons. curves farther to the left indicate smaller p-values and hence more powerful tests. for each method, the power of the tests increases as the percentage of mcf <dig> in the sample increases. in the interests of clarity, we show only a few of the curves. the two black lines are the common correlation separate channel analyses at 50% mcf <dig>  and 100% mcf <dig> . the remaining curves are for the 100% mcf <dig> comparison. the log-ratio analysis, which also uses variance regularization, is the most powerful among the remaining methods, but is only about as powerful as the separate channel analysis at 50% mcf <dig>  the log-ratio analysis without variance regularization yields a curve that is almost indistinguishable from the mixed model. the correlation among the p-values for any pair of methods for the 100% mcf <dig> treatment is over 93%.

we expect π0= <dig> at the 0% dilution, because the comparison is pure jurkat vs jurkat, but the estimates actually ranged from  <dig>   to  <dig>  . while this cannot be explained on biological grounds, it is possible that some unknown technical effects in handling the arrays introduced some subtle batch effects. figure  <dig> displays the unadjusted p-values computed by each of the  <dig> methods for the 0% mcf <dig> comparison. the excess of small p-values accounts for the low estimates of π <dig>  for this comparison, the separate channel method gives  <dig> significant genes at 1% fdr and  <dig> at 2% fdr. while this is implausible from the biological point of view, all of the analysis methods indicate that π0≤ <dig>  as discussed above, indicating that there may be some unexplained technical effects inducing differential expression among these samples.

california poppy data - a double loop design
for an evolutionary study of gene expression in plant organs, tissues from  <dig> above ground organs were collected from california poppy in  <dig> biological replicates  <cit> . the mrna was labeled so that  <dig> biological replicates of each tissue were labeled with each dye, and the samples were hybridized to custom agilent microarrays with  <dig> unique poppy probes in a double loop design. the experiment is described in detail in  <cit>  and is illustrated in figure  <dig>  the design was selected to optimize the pairwise comparisons between certain tissues, while keeping the power of all pairwise comparisons as close as possible with  <dig> arrays and maintaining balance among the biological replicates.

the estimated intraclass correlation for this experiment is  <dig> %. the relative efficiency of the comparisons depends on their relative locations on the double loop in figure  <dig> <cit> .

rows give results for different tissue comparisons and different analysis methods. the column π^ <dig> gives the estimated proportion of probes that are not differentially expressed between the tissue types. fdrs and π <dig> values were estimated using the qvalue package. the separate channel method detects more significant genes but does not decreaseπ^ <dig> overall.

CONCLUSIONS
two-channel microarrays continue to provide cost-effective platforms for whole-genome studies. technological advances in printing and hybridization have greatly reduced the technical variance associated with microarray studies, while greatly increasing the number of features and reducing cost. improvements in the statistical analysis of two-channel microarray data further improves cost-effectiveness by improving both sensitivity and specificity especially for small sample sizes.

this study has demonstrated the improvement in efficiency of differential expression analysis that can be achieved for most designs through the use of separate channel analysis. the separate channel analysis can be used to perform comparisons between treatments that may not be possible using log-ratio analysis in unconnected designs. by reparametrizing in terms of spotwise means and differences, the extra information in the separate channel analysis was shown to be that recovered from the a-values about the treatment conditions. the insight that the m and a-values are statistically independent throws some light on why they have been useful quantities for normalization and plotting purposes of two-channel data.

a common correlation estimation strategy has been proposed for the separate channel model, achieving considerable simplification as well as further gains in efficiency by stabilizing the intra-spot correlation estimates. the common intra-spot correlation is more readily interpreted than a set of varying probe-wise estimates, and yields a greater theoretical understanding of how much information is gained from the separate channel analysis. the analysis shows that the efficiency gains are greatest when the intra-spot correlation is small, and this in turn occurs when biological variation is large. in other words, the gain in efficiency is greatest when it is most needed, when biological variation is large.

the common intra-spot correlation strategy is analogous to a common inter-spot correlation strategy proposed previously for combining information across multiple probes for the same gene on the same array  <cit> ]. the common correlation strategy can be viewed as an extreme form of shrinkage estimation in which the prior information about an individual probe g is reduced to a point mass at the common value. the current usage applies the same idea to observations from the same spot instead of from different spots in the same array.

experiments with modest numbers of biological replicates produce variance estimators that are very unreliable on an individual probe-wise basis, so it is important to borrow strength between genes to achieve good statistical power and false discovery control on a genome-wide basis. the common intra-spot correlation approach proposed here facilitates the use of empirical bayes test statistics with an exact distributional theory in small samples  <cit> ]. this approach cannot usually be applied to mixed models with multiple variance components, because the variance component estimators are not independent and do not follow scaled chisquare distributions. general methods to shrink variance components using james-stein type estimation have been proposed by cui et al <cit> ], and these offer an alternative route to regularized separate channel analysis. the resulting test statistics do not however have known null distributions in small samples, leading cui et al <cit> ] to suggest the use of permutation analysis to establish the null distributions. the common correlation approach of this article provides a more convenient strategy for complex multi-factor experiments.

the separate channel analysis reduces exactly to the log-ratio analysis of  <cit> ] if array is included as a factor in the linear model and the intra-spot correlation is set to zero. this exhibits the fact that the log-ratio analysis uses only within-array information while the separate channel analysis recovers information from between-array variation.

another possible approach that we have explored is to apply empirical bayes squeezing to the m and a-value variancesσ^mg <dig> and σ^ag <dig>  unlike the usual variance components σ^eg <dig> and σ^bg <dig>  the m-a variance components are approximately independent and chisquare distributed, and this is exact if the mixed model is balanced, in which case the m-a components are scaled versions of the within and between spot mean squares. nevertheless the common correlation model, with its aggressive regularization of the intra-spot correlations, appears to be better motivated in terms of technical design of two-channel microarrays.

a number of real data examples with various experimental designs have been used to demonstrate that the common correlation mixed model provides a powerful method for differential expression analysis that outperforms both the log-ratio method and separate channel analyses using the ordinary linear mixed model.

