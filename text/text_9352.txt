BACKGROUND
the serial analysis of gene expression  is a high-throughput method to quantify the distribution of mrna transcripts in a biological sample by sequencing a large set of tags  <cit> . as part of the process of generating tags, the sage method uses a restriction enzyme, termed the anchoring enzyme , to cleave the double-stranded cdna derived from mrna transcripts. cleavage by the ae generates sequence tags that are 3' adjacent to the cleavage site. depending on the specific technique used, tags generally range from  <dig> to  <dig> base pairs in length. tags are then concatenated into long fragments. this allows for the identification of multiple tags in a single sequencing reaction. in general, increasing tag length increases the probability that a tag can be unambiguously attributed to the transcript of a single gene. such tags are considered to be 'informative' while tags which cannot be unambiguously attributed to a single gene  are 'uninformative' using current techniques.

as with all empirical techniques, sage has a number of technical disadvantages and advantages. tag sampling can be thought of as a multinomial sampling process  <cit>  where the distribution of a focal tag follows a binomial distribution  <cit>  or is approximated with a poisson distribution  <cit> . because sage is a sampling based technique and only a limited number of tags are sequenced, sampling error is a major source of noise in sage data. consequently, sage provides little information on genes with low expression levels  <cit> . the uncertainty caused by limited sample sizes has been addressed by several methods. for example,  <cit>  use a hierarchical poisson mixture approach to deal with the uncertainty associated with genes with low expression levels, while  <cit>  utilizes a mixture model to adjust for differences between genes with high and low expression levels. other approaches have been developed to improve detection of differences between samples  <cit> .

another factor regarding the quality of sage data is ascertainment errors. for example, the use of pcr to amplify mrna samples can introduce copying errors into tag sequences. tags are identified via dna sequencing, which is an imperfect processes. depending on the tag's length, approximately 7–14% of all tags contain sequencing errors  <cit> . consequently, a number of sophisticated techniques have been developed to correct for such errors  <cit> .

in terms of advantages, in contrast to other methods for inferring mrna expression levels, sage is useful for identifying actual genes, as opposed to pseudo-genes. further, because sage measurements do not rely on florescence measurements, they do not suffer from saturation effects. as a result, sage data are considered to be more accurate than hybridization-based measurements for genes with high expression levels  <cit> . furthermore, as the cost of sequencing decreases and the accuracy of its measurements increases, sage may become increasingly advantageous  <cit> .

independent of these strengths and weaknesses, one common aspect of current sage data analyses which has not been questioned is the implicit assumption that observed tag frequencies are suitable estimates of mrna frequencies. however, as our results will demonstrate below, differences exist among genes in the probabilities of tag formation from their mrna transcripts. such differences must be taken into account in order to accurately estimate expression levels.

the probability of tag formation from an individual mrna transcript is determined by the number of unambiguous tags formed from the ae sites in its transcript and the cleavage efficiency of ae in a given experiment. because the number of ae sites can vary between genes and not all tags are unambiguous , the probability of detecting a transcript can vary greatly from gene to gene. a clear case of such differences in tag formation probabilities is illustrated by considering genes without any ae sites. because tag formation is dependent on ae cleavage, mrna lacking such sites have zero probability of forming tags and, consequently, cannot be detected by sage. our work extends this idea by recognizing that even amongst the set of genes with ae cleavage sites, not all genes are equally likely to form unambiguous, informative sage tags. we find that the probability of forming an informative tag is a complex function of the number of ae sites, the cutting efficiency of the ae, and the uniqueness of the tags produced. we also point out that a high ae cutting efficiency may not always be desirable.

because there is inter-genic variation in tag formation probabilities, the proportion of tags in the population sampled experimentally  is not equivalent to the proportion of a particular mrna transcript in the cell . this difference has, until now, been ignored by the current methods for sage data analysis. . in contrast, the proposed method recognizes the difference between the observed tag frequencies and the actual frequency of transcripts. more specifically, we formally link tag and mrna pools using a mechanistic model of how tags are formed from mrna transcripts which naturally incorporates the tag formation probability of each gene. intrinsically, genes with lower than average tag formation probabilities are underestimated while the converse holds for genes with higher than average tag formation probabilities. given that tag formation probabilities are positively correlated with gene length, which in turn is negatively correlated with expression level, we find that the bias introduced by during tag formation leads to systematic under- and over-estimation of lowly and highly expressed genes, respectively. fortunately, by taking the differences in tagging probability among genes into account, we can remove such biases and, thereby, increase the quality of inferences made from sage data.

RESULTS
the purpose of our study is to incorporate differences in the probability of tag formation into the analysis of sage data. we developed a formal framework for incorporating these differences, derive exact and approximate solutions, and then illustrate the framework's utility by applying it to a published saccharomyces cerevisiae sage data set  <cit> . the output from the analysis such as summary statistics, modal values, posterior percentiles, and 95%pi can be found in additional files  <dig>   <dig>   <dig>   <dig>   <dig>   <dig> 

model formulation
tag sampling & generation
the generation of a sage data set is frequently viewed as a multinomial sampling process in which tags are sampled from a tag pool. the generation of the tag pool from the mrna pool relies on the ae cleavage of the cdna copy of mrna transcripts. for simplicity, we assume that the cleavage probability is constant for all sites and that all cleavage events are independent of one another. we use p to denote the average cleavage efficiency of the ae and ki to denote the number of cleavage sites within an mrna transcript of gene i . later, when applying the model and in the appendix a, we explain how it is possible to estimate p from the observed intra-genic distributions of tags.

formation of the tag pool from the mrna pool
to derive the relationship between the tag and mrna pools, we begin by defining the mrna pool and the tag pool explicitly. the tag pool represents the set of informative tags which can be unambiguously assigned to specific genes. the mrna pool is the subset of the transcriptome which, through ae cleavage, can generate at least one informative tag. for simplicity, we assume that each gene generates only one kind of transcript . we represent the mrna pool that we are trying to estimate as m→
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgtbqbgawcaaaa@2e21@ = {m <dig>  m <dig>  ..., mn}, where mi represents the proportion of the ith gene out of n genes detectable by the sage method. by definition, ∑i=1nmi=1
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaaewaqaaiabd2gatnaabaaaleaacqwgpbqaaeqaaaqaaiabdmgapjabg2da9iabigdaxaqaaiabd6gaubqdcqghris5aogaeyypa0jaegymaedaaa@3843@ . the tag pool in turn is defined as θ→
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacuwf4oqcgawcaaaa@2e7b@ = {θ <dig>  θ <dig>  ..., θn}, where θi is the expected proportion of tags from gene i in the tag pool. the tag proportion of gene i, θi, is the sum of the individual proportions of all informative tags generated from the transcript of the ith gene. as with the mrna pool, by definition, ∑i=1nθi=1
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadaaewaqaaggaciab=h7axnaabaaaleaacqwgpbqaaeqaaaqaaiabdmgapjabg2da9iabigdaxaqaaiabd6gaubqdcqghris5aogaeyypa0jaegymaedaaa@389d@. our next step is to understand how the tag and mrna pool frequencies are linked.

k′i
m→
m^i
m˜i
θ→
θ^i
Φ¯
t→
α→
in order for a tag to form at a particular ae site, say the jth site, the ae must cut the cdna derived from an mrna transcript at the jth site but not at any of the other sites between 3' and the jth site. if there are ki potential ae sites in the ith gene, then it follows that the probability of forming a tag at the jth site is

 φi,j=pki−j.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfgpgzdawgaawcbagaemyaakmaeiilawiaemoaaogabeaakiabg2da9iabdchawjabcicaoiabigdaxiabgkhitiabdchawjabcmcapmaacaaaleqabagaem4aas2aasbaawqaaiabdmgapbqabawccqghsislcqwgqbgaaagccqgguaglaaa@3ff8@ 

the first term p represents the probability that ae cleaves a transcript at the jth site. the second term 
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqggoaakcqaixaqmcqghsislcqwgwbaccqggpaqkdaahaawcbeqaaiabcicaoiabdugarnaabaaameaacqwgpbqaaeqaasgaeyoei0iaemoaaomaeiykakcaaaaa@38bf@ represents the probability of the ae not cleaving a transcript between the  sites 3' to the jth site. the next step is to calculate the total probability that mrna transcripts for a given gene will be converted into informative sage tags.

because we assume that each site is cleaved independently, the total probability of tags being formed from mrna transcripts for a given gene is simply the sum of the cleavage probabilities for all possible informative tags. that is

 φi=∑jφi,j,
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfgpgzdawgaawcbagaemyaakgabeaakiabg2da9maaqafabagae8nxdy2aasbaasqaaiabdmgapjabcycasiabdqgaqbqabaaabagaemoaaogabeqdcqghris5aogaeiilawcaaa@3ada@ 

where the summation is over the set of ae sites which generate informative tags, j.

in the special case where all of the possible tags within a transcript are informative, the summation is from j =  <dig> to ki. under this scenario, φi=1−ki
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfgpgzdawgaawcbagaemyaakgabeaakiabg2da9iabigdaxiabgkhitiabcicaoiabigdaxiabgkhitiabdchawjabcmcapmaacaaaleqabagaem4aas2aasbaawqaaiabdmgapbqabaaaaaaa@3aec@. in general, the greater the number of ae sites that lead to informative tags |j|, the higher the tag formation probability φi for a given gene. for a given set of ae sites, φi increases with the cutting efficiency p, but the upper limit to φi is limited by the number and position of uninformative tags. this is because as p approaches one, the probability of forming a tag from the 3' most or kith
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgrbwadaqhaawcbagaemyaakgabagaeeidaqnaeeiaaggaaaaa@3259@ ae site also site approaches one. if p =  <dig> and the 3' most ae site leads to an informative tag, then φi would be equal to one. in contrast, if the 3' most ae site leads to an ambiguous tag, then the φi would equal zero. thus, depending on the genome and the genes of interest, a high cutting efficiency may not only be unobtainable  <cit> , it may also be undesirable.

because transcripts come in discrete units, inference on the proportion of the ith gene in the mrna pool, mi, depends only on the sum of the tag frequencies in the tag pool for the ith gene rather than the separate frequencies of each individual tag.

 θi=miφiΦ¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwf4oqcdawgaawcbagaemyaakgabeaakiabcicaoiqbd2gatzaalagaeiykakiaeyypa0jaemyba02aasbaasqaaiabdmgapbqabagcdawcaaqaaiab=z8amnaabaaaleaacqwgpbqaaeqaaagcbagafuopdykbaebaaaaaaa@3c02@ 

where

 Φ¯=∑i=1nmiφi.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqeaiabg2da9maaqahabagaemyba02aasbaasqaaiabdmgapbqabaaccigccqwfgpgzdawgaawcbagaemyaakgabeaaaeaacqwgpbqacqgh9aqpcqaixaqmaeaacqwgubgba0gaeyyeiuoakiabc6cauaaa@3d5a@ 

the term Φ¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqeaaaa@2e3e@ denotes the mean tag formation probability where the contribution of a gene to its value is a function of both its mrna frequency mi and tag formation φi probability.

intuitively, eq.  states that the tag frequency for the ith gene θi is equal to its frequency in the mrna pool weighted by the probability of tag being formed from its mrna transcripts relative to the weighted average φ value for all of the mrna genes that contribute to the tag pool. incorporating the relative tag formation probability, φi/Φ¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqeaaaa@2e3e@ in eq. , into inferences about mi is what distinguishes our approach from standard sage methods. standard methods assume that φi is constant across all genes and, therefore, φi/Φ¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqeaaaa@2e3e@ =  <dig>  hence, it equates the mrna pool with the tag pool. however, because φi varies between genes, this equality between pools does not hold.

joint posterior distribution of m→
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgtbqbgawcaaaa@2e21@
using our definition of θ→
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacuwf4oqcgawcaaaa@2e7b@ and the assumption of a multinomial sampling distribution for the tags, it follows that the conditional probability of observing a sample of gene tags t→
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgubavgawcaaaa@2def@ = {t <dig>  t <dig>  ... tn} given the gene expression levels m→
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgtbqbgawcaaaa@2e21@ is,

 p=∏i=1nti.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgqbaucqggoaakcuwgubavgawcaiabcyha8jqbd2gatzaalagaeiilawcccigaf8nxdymbasaacqggpaqkcqgh9aqpdaqadaqaauaabeqaceaaaeaacqwgubavdawgaawcbagaegimaadabeaaaoqaaiabdsfaunaabaaaleaacqaixaqmaeqaaogaeiilawiaemivaq1aasbaasqaaiabikdayaqabagccqggsaalcqgguaglcqgguaglcqgguaglcqggsaalcqwgubavdawgaawcbagaemoba4gabeaaaaaakiaawicacaglpaaadaqewbqaamaabmaabawaasaaaeaacqwgtbqbdawgaawcbagaemyaakgabeaakiab=z8amnaabaaaleaacqwgpbqaaeqaaagcbagafuopdykbaebaaaaacagloagaayzkaaaaleaacqwgpbqacqgh9aqpcqaixaqmaeaacqwgubgba0gaey4diunakmaacaaaleqabagaemivaq1aasbaawqaaiabdmgapbqabaaaaogaeiola4caaa@5c53@ 

note that if the tagging probabilities φi were equal for all genes, the joint distribution in eq.  would simplify yielding p=p
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgqbaucqggoaakcuwgubavgawcaiabcyha8jqbd2gatzaalagaeiykakiaeyypa0jaemiuaalaeiikagiafmivaqlbasaacqgg8bafiigacuwf4oqcgawcaiabcmcapaaa@3c32@, i.e. the standard method for estimating gene expression levels.

we can also combine the above marginal probability distribution with a prior distribution p to calculate the joint posterior distribution for m→
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgtbqbgawcaaaa@2e21@ given the data t→
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgubavgawcaaaa@2def@,

 f∝pf.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgmbgzcqggoaakcuwgtbqbgawcaiabcyha8jqbdsfauzaalagaeiilawcccigaf8nxdymbasaacqggpaqkcqghdistcqwgqbaucqggoaakcuwgubavgawcaiabcyha8jqbd2gatzaalagaeiilawiaf8nxdymbasaacqggpaqkcqwgmbgzcqggoaakcuwgtbqbgawcaiabcmcapiabc6cauaaa@4736@ 

as in all bayesian analyses, the choice of the prior distribution of m→
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgtbqbgawcaaaa@2e21@ has some impact on the posterior distributions and the inferences based upon it. given that m→
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgtbqbgawcaaaa@2e21@ represents a set of frequencies, the dirichlet distribution dir is a logical prior distribution for m→
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgtbqbgawcaaaa@2e21@. when αi =  <dig> for all genes, the prior distribution becomes a uniform or flat prior and eqn.  simplifies to,

 f∝∏i=1nti.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgmbgzdaqadaqaaiqbd2gatzaalagaeiifawnafmivaqlbasaacqggsaaliigacuwfgpgzgawcaagaayjkaiaawmcaaiabg2hi1oaarahabawaaewaaeaadawcaaqaaiabd2gatnaabaaaleaacqwgpbqaaeqaaogae8nxdy2aasbaasqaaiabdmgapbqabaaakeaacuqhmogrgaqeaaaaaiaawicacaglpaaaasqaaiabdmgapjabg2da9iabigdaxaqaaiabd6gaubqdcqghpis1aowaawbaasqabeaacqwgubavdawgaaadbagaemyaakgabeaaaagccqgguaglaaa@4c1d@ 

joint posterior mode of m→
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgtbqbgawcaaaa@2e21@
using bayes' theorem eqn.  and employing a lagrange multiplier to incorporate our constraints that ∑i mi =  <dig> and mi ≥  <dig>  we generate the following implicit solution for the values of mi at the joint posterior mode, m^
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgtbqbgaqcaaaa@2e1f@,

 m^i={0ti+αi−1<0ti+αi−1t0φiΦ¯^+α0−nelse
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgtbqbgaqcamaabaaaleaacqwgpbqaaeqaaogaeyypa0zaaiqabeaafaqaaegacaaabagaegimaadabagaemivaq1aasbaasqaaiabdmgapbqabagccqghrawkiigacqwfxoqydawgaawcbagaemyaakgabeaakiabgkhitiabigdaxiabgyda8iabicdawaqaamaalaaabagaemivaq1aasbaasqaaiabdmgapbqabagccqghrawkcqwfxoqydawgaawcbagaemyaakgabeaakiabgkhitiabigdaxaqaaiabdsfaunaabaaaleaacqaiwaamaeqaaowaasaaaeaacqwfgpgzdawgaawcbagaemyaakgabeaaaoqaaiqbfa6agzaaryaajaaaaiabgucariab=f7ahnaabaaaleaacqaiwaamaeqaaogaeyoei0iaemoba4gaaaqaaiabbwgaljabbygasjabbohazjabbwgalbaaaiaawuhaaaaa@58df@ 

note that in the cases where the choice of the prior is such that αi <  <dig> and ti =  <dig> the mode of the posterior occurs at  <dig>  the boundary of the parameter space. for convenience, we define j as the set of genes which satisfy the condition ti + αi -  <dig> ≥  <dig> 

although it might not be clear given our notation, the solution we present above is implicit since Φ¯^
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqegaqcaaaa@2e4d@ depends on the set of m^
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgtbqbgaqcaaaa@2e1f@ values themselves. however, employing the constraint that the sum of m^
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgtbqbgaqcaaaa@2e1f@ values must equal one, we can generate the following implicit solution for Φ¯^
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqegaqcaaaa@2e4d@,

 1=∑i∈jti+αi−1t0φiΦ¯^+α0−n.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqaixaqmcqgh9aqpdaaeqbqaamaalaaabagaemivaq1aasbaasqaaiabdmgapbqabagccqghrawkiigacqwfxoqydawgaawcbagaemyaakgabeaakiabgkhitiabigdaxaqaaiabdsfaunaabaaaleaacqaiwaamaeqaaowaasaaaeaacqwfgpgzdawgaawcbagaemyaakgabeaaaoqaaiqbfa6agzaaryaajaaaaiabgucariab=f7ahnaabaaaleaacqaiwaamaeqaaogaeyoei0iaemoba4gaaawcbagaemyaakmaeyici4saemosaoeabeqdcqghris5aogaeiola4caaa@4bb4@ 

numerically solving equation  for Φ¯^
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqegaqcaaaa@2e4d@ is straightforward and once done allows us to evaluate the solution for m^
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgtbqbgaqcaaaa@2e1f@ in eqn.  explicitly.

under the uninformative, flat prior where αi =  <dig> for all genes, eqn.  can be solved explicitly and yields,

 Φ¯^=t0∑i=1ntiφi
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqegaqcaiabg2da9maalaaabagaemivaq1aasbaasqaaiabicdawaqabaaakeaadaaewaqaamaalaaabagaemivaq1aasbaasqaaiabdmgapbqabaaakeaaiigacqwfgpgzdawgaawcbagaemyaakgabeaaaaaabagaemyaakmaeyypa0jaegymaedabagaemoba4ganiabgghildaaaaaa@3e7e@ 

and eqn.  simplifies to,

 m^i=tit0Φ¯^φi=tiφi.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgtbqbgaqcamaabaaaleaacqwgpbqaaeqaaogaeyypa0zaasaaaeaacqwgubavdawgaawcbagaemyaakgabeaaaoqaaiabdsfaunaabaaaleaacqaiwaamaeqaaaaakmaalaaabagafuopdykbaehbakaaaeaaiigacqwfgpgzdawgaawcbagaemyaakgabeaaaagccqgh9aqpdawcaaqaaiabdsfaunaabaaaleaacqwgpbqaaeqaaagcbawaaewaaeaadaaewaqaamaalaaabagaemivaq1aasbaasqaaiabdqgaqbqabaaakeaacqwfgpgzdawgaawcbagaemoaaogabeaaaaaabagaemoaaomaeyypa0jaegymaedabagaemoba4ganiabgghildaakiaawicacaglpaaacqwfgpgzdawgaawcbagaemyaakgabeaaaagccqgguaglaaa@5133@ 

the marginal posterior distribution of mi
the multinomial conditional distribution and dirichlet prior distributions used in eq.  can be used to generate a marginal binomial distribution and prior beta distribution for the ith gene to yield the posterior distribution,

 f∝tit0−timiα−1β− <dig> 
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgmbgzdaqadaqaaiabd2gatnaabaaaleaacqwgpbqaaeqaaowaaqqaaeaacuwgubavgawcaiabcycasggaciqb=z8amzaalagaeiilawiafuopdykbaebaaiaawea7aagaayjkaiaawmcaaiabg2hi1oaabmaabawaasaaaeaacqwgtbqbdawgaawcbagaemyaakgabeaakiab=z8amnaabaaaleaacqwgpbqaaeqaaagcbagafuopdykbaebaaaaacagloagaayzkaawaawbaasqabeaacqwgubavdawgaaadbagaemyaakgabeaaaagcdaqadaqaaiabigdaxiabgkhitmaalaaabagaemyba02aasbaasqaaiabdmgapbqabagccqwfgpgzdawgaawcbagaemyaakgabeaaaoqaaiqbfa6agzaaraaaaagaayjkaiaawmcaamaacaaaleqabagaemivaq1aasbaawqaaiabicdawaqabawccqghsislcqwgubavdawgaaadbagaemyaakgabeaaaagccqwgtbqbdaqhaawcbagaemyaakgabagae8xsdemaeyoei0iaegymaedaaogaeiikagiaegymaejaeyoei0iaemyba02aasbaasqaaiabdmgapbqabagccqggpaqkdaahaawcbeqaaiab=j7aijabgkhitiabigdaxaaakiabcycasaaa@6b41@ 

where α = αi and β=∑j≠iαj
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfyogycqgh9aqpdaaeqaqaaiab=f7ahnaabaaaleaacqwgqbgaaeqaaaqaaiabdqgaqjabgcmi5kabdmgapbqab0gaeyyeiuoaaaa@38d4@.

because the marginal posterior distribution of mi, f, depends on the ratio of the focal gene i's tag formation probability φi relative to Φ¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqeaaaa@2e3e@, the function implicitly depends on mi and the mrna frequencies at all of the other genes besides i. in other words, Φ¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqeaaaa@2e3e@ is a function of and, therefore technically changes with, mi. these changes in Φ¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqeaaaa@2e3e@ with mi can be taken into account when evaluating eq.  by re-estimating Φ¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqeaaaa@2e3e@ given a specific value of mi. reestimating Φ¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqeaaaa@2e3e@ is, however, numerically intensive. further, a majority of the probability mass of the marginal distribution occurs in the region very close to Φ¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqeaaaa@2e3e@ ). thus, the changes in Φ¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqeaaaa@2e3e@ over the most probable values of mi are negligable and, consequently, the effect of these changes on the marginal distribution of mi is also negligable. as a result, we ignore any impact changing mi might have on our estimate of Φ¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqeaaaa@2e3e@ and, instead, treat Φ¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqeaaaa@2e3e@ as a constant  in the calculations that follow.

approximations of the marginal posterior mode of mi
ignoring the dependence of Φ¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqeaaaa@2e3e@ on mi, we differentiate the marginal probability of mi in eqn.  with respect to mi and set it equal to zero. this results in a quadratic solution for the marginal mode of mi, m˜
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgtbqbgaacaaaa@2e1e@. the quadratic solution, however, is quite complex and we present it in appendix b. there we also derive a much simpler approximation based on a first order taylor series to expansion which gives,

 m˜i≈max⁡)+).
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgtbqbgaacamaabaaaleaacqwgpbqaaeqaaogaeyisisragiyba0maeiyyaemaeiieag3aaewaaeaacqaiwaamcqggsaaldawcaaqaaiabdsfaunaabaaaleaacqwgpbqaaeqaaogaey4kascccigae8xsdemaeyoei0iaegymaedabawaasaaaeaacqwfgpgzdawgaawcbagaemyaakgabeaaaoqaaiqbfa6agzaaryaajaaaaiabcicaoiabdsfaunaabaaaleaacqaiwaamaeqaaogaeyoei0iaeiikagiaemivaq1aasbaasqaaiabdmgapbqabagccqghrawkcqwfxoqycqghsislcqaixaqmcqggpaqkcqggpaqkcqghrawkcqggoaakcqwgubavdawgaawcbagaemyaakgabeaakiabgucariab=f7ahjabgkhitiabigdaxiabgucariab=j7aijabgkhitiabigdaxiabcmcapaaaaiaawicacaglpaaacqgguaglaaa@61b9@ 

this solution for the mode can be simplified further depending on the specific assumptions made about α and β.

for example, in calculating the marginal posterior distribution of mi under a uniform prior, the joint dirichlet prior with αj =  <dig> for all genes reduces to the parameters αi =  <dig> and βi = n -  <dig> for the marginal prior distribution distribution. with these parameter values,

  

assuming that n is large relative to ti and  <dig> 

if  ×  ≪  <dig>  then we can take another first order taylor series approximation around this term at zero to get a solution for the marginal mode as a function of the joint mode,

 m˜i≈m^i
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgtbqbgaacamaabaaaleaacqwgpbqaaeqaaogaeyisisrafmyba0mbakaadawgaawcbagaemyaakgabeaakmaabmaabagaegymaejaeyoei0yaasaaaeaacqwgubgbaeaacqwgubavdawgaawcbagaegimaadabeaaaagcdawcaaqaaiqbfa6agzaaryaajaaabaaccigae8nxdy2aasbaasqaaiabdqgaqbqabaaaaagccagloagaayzkaaaaaa@4098@ 

thus we see that the marginal mode of mi is always less than the value at the joint mode with the prior αi =  <dig> for all genes.

alternatively, if we assume an alternative prior of αi = 1/n, which implies that βi =  <dig> - 1/n, then using the same assumptions and approach as before we obtain the following set of approximate marginal modes,

 m˜i≈{0ti=0Φ¯^φi1nt0ti=1Φ¯^φiti−1t0ti≥ <dig> 
 mathtype@mtef@5@5@+=feaafiart1ev1aqatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgtbqbgaacamaabaaaleaacqwgpbqaaeqaaogaeyisis7aaiqabeaafaqaaewacaaabagaegimaadabagaemivaq1aasbaasqaaiabdmgapbqabagccqgh9aqpcqaiwaamaeaadawcaaqaaiqbfa6agzaaryaajaaabaaccigae8nxdy2aasbaasqaaiabdmgapbqabaaaaowaasaaaeaacqaixaqmaeaacqwgubgbcqwgubavdawgaawcbagaegimaadabeaaaaaakeaacqwgubavdawgaawcbagaemyaakgabeaakiabg2da9iabigdaxaqaamaalaaabagafuopdykbaehbakaaaeaacqwfgpgzdawgaawcbagaemyaakgabeaaaagcdawcaaqaaiabdsfaunaabaaaleaacqwgpbqaaeqaaogaeyoei0iaegymaedabagaemivaq1aasbaasqaaiabicdawaqabaaaaagcbagaemivaq1aasbaasqaaiabdmgapbqabagccqghljyscqaiyagmcqgguaglaaaacagl7baaaaa@58fe@ 

as a final point of comparison we compare our bayesian approaches in which we impose a consistent set of prior values on the probabilities of m→
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgtbqbgawcaaaa@2e21@ with a likelihood based approach. estimating mi based on likelihood is equivalent to the beta parameters αi =  <dig> and βi =  <dig> 

 m˜i=Φ¯φitit <dig> 
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgtbqbgaacamaabaaaleaacqwgpbqaaeqaaogaeyypa0zaasaaaeaacuqhmogrgaqeaaqaaggaciab=z8amnaabaaaleaacqwgpbqaaeqaaaaakmaalaaabagaemivaq1aasbaasqaaiabdmgapbqabaaakeaacqwgubavdawgaawcbagaegimaadabeaaaagccqgguaglaaa@3bb3@ 

note that although this solution is equivalent to the value of mi at the joint mode with a flat prior, it is not actually consistent with that model. this is because the maximum likelihood parameters imply that α = αi =  <dig> for the ith gene and yet the sum of the prior parameters for the remaining n -  <dig> genes is  <dig> rather than n -  <dig> 

model application and validation
sage data and observed tag counts ti
in the data set provided by velculescu et al.  <dig>  nlaiii is the anchoring enzyme whose recognition sequence is 5'-catg-3'. bsmfi is the tagging enzyme, which gives 14-bp tags. uninformative tags  were excluded from the calculation of φi and from our tag counts ti. as indicated earlier, the tag counts for an individual gene ti is equal to the sum of all informative tags observed for the ith gene in a given experiment. this exclusion of counts for ambiguous tags is also employed in other sage analyses.

estimation of cutting efficiency p
we applied our method to a sage data set generated in saccharomyces cerevisiae  <cit> . the first step during the implementation is to calculate the average cleavage efficiency of ae, p. the distribution of tags within the coding sequence  is a function of p. for example if p is close to one, then we expect to find the final intra-cds tag to represent the vast majority of tags seen. conversely if p is small, then the expected frequency of tags will increase little with position. in appendix a we show how cleavage efficiency parameter p can be estimated from the observed distribution of intra-cds tags from multiple genes using a bayesian approach. the posterior mode and 95% pi for the l, s, and g2m phases are presented in table  <dig> and the distributions are illustrated in figure  <dig>  despite being carried out in the same lab and, presumably, under similar conditions, our analysis indicates that there is significant variation in cleavage effciencies between experiments.

joint posterior mode estimate: Φ¯
simulation based estimate: Φ¯
posterior mode and 95%pi values for the ae cleavage efficency p, posterior mode value for the mean tag formation probability Φ¯^
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqegaqcaaaa@2e4d@, and simulation based estimates for Φ¯¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqegaqeaaaa@2e55@ for the three experiments in  <cit> : log growth , s phase-arrest, and g2/m phase-arrest. numbers in parentheses are the lower and upper bounds of 95% pi. parameters for the dirichlet prior distribution on m→
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgtbqbgawcaaaa@2e21@ was αi =  <dig> for all genes.

calculation of tag formation probability φ
the calculation φi is, in part, based on the number of ae sites within an mrna transcript. as a result, we need to know the transcript boundaries for every gene in order to determine all the possible ae sites for each gene. for  <dig> genes we obtained the transcript boundaries from the tiling array data set  <cit> . with this subset of genes we also calculated the median 5' and 3' utrs and used these values,  <dig> bp and  <dig> bp, respectively, for the remaining genes. we then inferred all potential ae sites for every transcript.

having an estimate of p and knowing the set of possible informative tag sites within each gene makes it possible to calculate the tag formation probability φi. for each individual gene, we used eqns.  and  and the posterior mode of p for a given experiment. thus, because p varies between experiments, φi also varies between experiments.

the distribution of tag formation probabilities for the log phase l experiment and its scaling effect on mrna frequency inferences are illustrated in figure  <dig>  note that intergenic variation in tag formation probabilities φi vary from zero to one. because genes with φi =  <dig> are invisible with respect to sage experiments, they have been excluded from the figure. intergenic variation in φi appears to be bimodal with a peak around  <dig>  and  <dig> . the first peak in the distribution of φi corresponds to genes with a single, unambiguous tag. the second peak in the distribution corresponds to genes with multiple unambiguous tags. estimates of φ for all three experiments  as well as unambiguous tag counts and frequencies at the joint mode can be found in additional files  <dig>   <dig>   <dig> 
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqggoaakcuwgtbqbgaqcaiabgkhitggaciqb=h7axzaajagaeiykakiaei4la8iaf8hudenbakaaaaa@3532@, for each gene is plotted relative to the right axis and indicated with a •.

posterior distributions and statistics
for the following calculations we worked only with genes in saccharomyces cerevisiae with a tag formation probability greater than 10- <dig>  this non-zero cut off prevented us from including the genes where an observed tag is most likely due to an experimental errors rather than coming from the gene itself. our dataset consisted of  <dig> genes and we assumed a flat, uninformative prior of αi =  <dig> for all genes in the analysis presented here.

with this set of genes we calculated the joint modes of the posterior distributions using eqn.  and the posterior marginal distributions  numerically. examples of these marginal distributions for four specific genes are illustrated in figure  <dig>  summaries of the posterior marginal distributions for all genes can be found in additional files  <dig>   <dig>   <dig>  the more general effect that the tag formation probability and the number of tag counts have on the marginal distributions are illustrated in figure  <dig> 

we found the marginal mode numerically by maximizing . for each of these genes we also used  to calculate the posterior 95% probability intervals . when comparing our numerical maximization of the marginal distribution to our various approximations, we find them to generally be withing a factor of 10-5

in order to verify the accuracy of the above results in a more independent manner, we simulated the joint posterior distribution utilizing a gibbs sampling strategies as discussed in  <cit> . from this joint posterior distribution we can obtain the appropriate marginal distributions. we find that our estimates of the means of the numerical and simulation based posterior marginal distributions are in good agreement.

although we can calculate the the joint mode estimate of Φ¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqeaaaa@2e3e@ directly, we cannot easily estimate its 95% pi. instead we calculated Φ¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqeaaaa@2e3e@ for each of our simulations and used these values to evaluate our uncertainty in Φ¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqeaaaa@2e3e@. the results are presented in table  <dig> and they indicate that Φ¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqeaaaa@2e3e@ can varies significantly between the experimental treatments, reflecting signficant changes in the set of genes contributing to the mrna pool.

somewhat surprisingly, we find that in two of the three cases the joint mode estimate of Φ¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqeaaaa@2e3e@ does not overlap with the 95% pi of Φ¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqeaaaa@2e3e@ based on our simulations. this apparent paradox can be explained by the fact that the tag formation probability of a gene is not independent of its mrna expression level. more specifically, genes with low expression levels are more likely to be longer and have unique tags than genes with high expression levels. this is because genes that are highly expressed tend to also be shorter, thus reducing the probability a ae site will occur. similarly, genes that are highly expressed also tend to show strong codon bias and, as a result, the rate at which novel genes generated via gene duplication diverge from their progenitor sequence will be slower, thus reducing the probability the gene's tags will be unique.

the reason the negative association between expression level and φ causes the simulations to produce Φ¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqeaaaa@2e3e@ values larger than the modal estimate is because the joint mode estimate of m for genes with no experimentally observed tags is on the zero boundary. in contrast, the simulations essentially sample from a dirichlet distribution and, consequently, will always pull a value greater than zero. thus in the simulations genes with low expression levels and high φ values contribute to Φ¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqeaaaa@2e3e@ more than they do in the calculation of Φ¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqeaaaa@2e3e@ based on the joint mode. we have verified this idea by randomly reassigning φ values to each gene, thus removing any relationship between φ and m. in these simulations the posterior mode overlaps with and simulation based 95%pi for Φ¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqeaaaa@2e3e@.

comparison of mrna and tag frequencies
we also calculated the marginal modes for the tag frequencies, which is equivalent to standard estimates. the relative differences between the tag and mrna pool frequencies as a function of φ are illustrated in figure  <dig>  the direct comparison between the marginal mode of tag and mrna frequencies, θ˜i
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacuwf4oqcgaacamaabaaaleaacqwgpbqaaeqaaaaa@2fff@ and m˜i
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwgtbqbgaacamaabaaaleaacqwgpbqaaeqaaaaa@2fa5@ are illustrated figure  <dig>  as a result these genes occur below the 1: <dig> line in figure  <dig>  illustrating how ignoring the tag formation process will lead to underestimates of these genes mrna frequencies. in contrast, genes with higher than average tag formation probabilities, i.e. φi > Φ¯^
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqegaqcaaaa@2e4d@, are over represented in the tag pool. as a result these genes occur above the 1: <dig> line in figure  <dig>  indicating how standard methods overestimate these genes mrna frequencies.
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqeaaaa@2e3e@ are over represented in the tag pool and, consequently, occur below the 1: <dig> line. conversely, genes whose tag formation cutting probability φi is less that Φ¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqeaaaa@2e3e@ are under represented in the tag pool and occur above the 1: <dig> line.

discussion
previous approaches to analyzing sage data equated the sampling of the tag pool with sampling the mrna pool . in this study we developed a novel, probabilistic approach to evaluate gene expression levels of sage data. our model takes into account the previously ignored tag formation process so that observations of gene tags are properly weighted by their probability of formation. previous research has not combined all of these factors in the analysis of sage data resulting in significant biases in estimates of expression levels.

our results indicate that the probability of a gene forming a sage tag varies greatly from gene to gene and between experiments. we find that genes with higher than average probabilities of forming sage tags will be over-represented in the tag pool. as a result, the mrna abundances of these genes are over-estimated using the standard approach. conversely, we also find that genes with lower than average probabilities of forming sage tags will be under-represented in the tag pool. predictably, the mrna abundances of these genes are under-estimated using the standard approach. the picture, however, becomes even more complex when one considers the fact that genes with low expression levels tend to have higher than average tag formation probabilities. thus, we argue that taking inter-genic variation in tag formation probabilities into account is a required step in order to properly interpret sage data.

sometimes the goal of a set of sage experiments is to make inferences about relative changes in mrna expression levels between two different treatments. even under these circumstances, accounting for the effect of tag formation will improve the quality of inferences made based on their observed frequencies. this is because the cutting efficiency p varies between experiments, thereby, causing the tag formation probability φi and Φ¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqeaaaa@2e3e@ to vary between experiments which, in turn, affect the ratio of the mrna estimates ). if sage data is being used an exploratory tool or to verify that a hypothesized gene is actually expressed as opposed to being a pseudo-gene, the methods developed here also have some application. intuitively, experimentalists already know that inferences for genes lacking unique tag sites cannot be made. however, instead of classifying genes as either detectable or non-detectable through sage , our methods allow researchers to develop a more nuanced understanding of a hypothesized transcript's ability to be detected.

we find that the probability of tag formation from an mrna depends on  the ae cleavage efficiency p,  the number of anchoring enzyme sites within a gene's mrna transcript and  whether such tags can be unambiguously assigned to a single gene. the ae cleavage efficiency effects the distribution of tags formed from an individual gene. it might seem that, experimentally, obtaining 100% ae cleavage efficiency would be a desirable goal. however, as discussed, extremely high efficiency has drawbacks. when cleavage efficiency is 100%, only the most 3' tags or final tag will be cleaved for each transcript, resulting in a single type of tag for each gene  <cit> . under such conditions, the distribution of tags formed is weighted fully with the final tag and any gene whose final tag is ambiguous will be rendered unobservable.

in contrast, as ae cleavage efficiency decreases, the distribution of tags formed is more evenly distributed, resulting in the formation of multiple tags from the set of mrna transcripts of a single gene  <cit> . thus, it is arguable that if the mrna pool is sufficiently large, a very low ae would actually be desirable since it would likely make all genes with multiple ae sites observable and reduce the sensitivity of the analysis to errors in determining the end of the 3' utr . experimentally, ae cleavage effciencies are significantly less than 100% and vary between experiments. this quantitative conclusion is also consistent with empirical observations that partial digestion often occurs during sage experiments  <cit> .

while the ae cleavage efficiency varies between experiments, in the absence of any alternative splicing, the number and type  of tags that can formed from a gene's mrna does not. however, tag site number and type do vary from gene to gene which leads to inter-genic differences in tag formation probabilities. because φi is the sum of tagging probabilities at informative sites, removal of a ae site close to the 3' end can greatly reduce the value of φi. because many of the most 3' tags are likely to reside in the 3' utr region, a region which is generally poorly understood and delimited, unambiguously assigning such tags to specific genes becomes increasingly problematic. because the incorrect inclusion  of a 3' tag erroneously elevates  the tag formation probability as an increasing function of p, a low ae cutting efficiency might actually be desirable in these situations. note, however, that as ae cutting effciencies decrease, the importance of correctly determining the 5' utr boundary increases.

in general, the more ae sites a gene contains, the larger is its value of φi. because shorter genes tend to have fewer ae sites, there is a positive relationship between gene length and φi . interestingly, in saccharomyces cerevisiae in either l and s phases, mi and φi have a loose negative correlation with one another . this indicates that highly expressed genes tend to be shorter in length and therefore have fewer potential ae sites. hence, in general, standard estimates, θ^i
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacuwf4oqcgaqcamaabaaaleaacqwgpbqaaeqaaaaa@3000@, will under-estimate the expression levels for highly expressed genes. for example, the tag count for gene ykl152c is  <dig> in the l-phase. there is a single ae site for this gene. therefore, its tagging probability  is  <dig>  in the l phase, which means a correction of ~ 15% in its expression level . thus accounting for variation in tag formation probabilities φ becomes especially important when trying to measure the saturation of microarray data by comparing it to sage data .

to incorporate variation in tag formation probabilities we took a decidedly bayesian approach, modeling the sampling of tag frequencies as a multinomial process and using a dirichlet prior for mrna abundances. despite the complexity of the tag formation process, we were able obtain a number of analytic results or approximations which were verified using simulation. more importantly, our analytic results offer a useful contrast of the assumptions involved in data analysis based on a bayesian and frequentist approaches.

one main drawback with the bayesian approach is the large amount of information that is assumed already known when using a flat, uninformative prior. with a dirichlet prior, the number of 'prior observations' implicit in a flat prior is equal to the number of genes observable with sage  <cit> . for the saccharomyces cerevisiae databases used here, this number is on the order of five thousand. this number of observations is only a few fold below the number of observed informative tags in a given sage dataset. alternatively, one could use other, less weighty priors such as αi = 1/n. doing so, however, results in the large, inconsistent shifts in the mode of the marginal posterior distribution with tag numbers when the observed number of tags are small . this prior also produces singularities in certain ranges of Φ¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuqhmogrgaqeaaaa@2e3e@, leading additional numerical complications when estimating its value.

in contrast, examination of the posterior marginal distributions illustrates how a bayesian framework differs from the frequentist approach. more specifically, the frequentist approach, which focuses on the marginal likelihood of a single gene is analogous to the bayesian posterior marginal distribution with the prior parameters of α = β =  <dig>  in the bayesian framework such a prior is undesirable because it results in an inconsistency. specifically, in a bayesian framework α = αi and β=∑j≠iαj
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfyogycqgh9aqpdaaeqaqaaiab=f7ahnaabaaaleaacqwgqbgaaeqaaaqaaiabdqgaqjabgcmi5kabdmgapbqab0gaeyyeiuoaaaa@38d4@, where i is the focal gene. so to have α = αi =  <dig> and β =  <dig> for one gene implies that αj cannot equal  <dig> for any of the other genes, yet that is exactly what is assumed when analyzing these other genes.

conceivably, if we can estimate the prior distribution empirically, we may further improve estimation of expression levels and avoid some of the problems encountered with regard to the large amount of 'prior observations' implicit in our flat, uninformative prior. however, the implementation of such an approach would be difficult since it would entail integration and possibly maximization over the the very high-dimensional dirichlet prior distribution.

in comparison to other bayesian methods developed to analyze sage data, thygesen and zwinderman  <cit>  use a combination of bayesian and maximum likelihood approaches to model the distribution of tags arising from sage analysis. instead of modeling observed mrna proportions, they used a hierarchical poisson model with a gamma prior to model the observed mrna counts. the main thrust of the paper is to fit the hierarchical poisson model using maximum likelihood although some discussion of bayesian inference is also included. the paper also seems to view the counts as independent and identically distributed observations making the additional variation of the hierarchical poisson model useful.

the analysis of morris, baggerly and coombes  <cit>  is closest in spirit to our work. they directly apply a bayesian multinomial-dirichlet model to the observed vector of tag counts. this approach improves upon most earlier work by considering simultaneous inference on all proportions mi. they provide a simple computationally tractable approach and consider the result of the statistical shrinkage effect which offers improved estimates for proportions with low tag counts while underestimating the expression proportions for tags with large counts. this leads them to propose a mixture dirichlet prior in order to mitigate the propensity to underestimate highly expressed genes. however, they do not consider the variation in tag formation probabilities which is the main focus of this paper.

CONCLUSIONS
previous studies of sage data have implicitly assumed that the tag pool is an unbiased representation of the mrna pool. by building a mechanistic model of tag formation we show how this assumption only holds when all genes have the same tag formation probability and, more importantly, how to properly adjust one's inferences according to the tag formation probability of the gene relative to the entire mrna population. we believe that this work is a valuable addition to the existing methods for sage data analysis and, given its probabilistic nature, can be integrated into other studies of sage data.

