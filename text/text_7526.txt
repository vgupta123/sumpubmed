BACKGROUND
chromatin immunoprecipitation followed by high-throughput sequencing  is widely used for genome-wide profiling of histone modifications  <cit>  and transcription factor -dna interactions  <cit> . popular applications of chip-seq include identifying binding sites of a tf in one or more samples  <cit> , comparing histone modifications across two or more samples, and detecting binding differences between alternative alleles  when snp data is available . chip-seq experiments start with shearing dna cross-linked with the protein of interest into short fragments. then, fragments associated with the protein or modification of interest are enriched by immunopreciptitation using an antibody specific to the protein or modification of interest. after purification and size selection, the remaining fragments are sequenced. currently, the most widely used sequencing platform for chip-seq experiments is illumina. this platform offers many options for experimental design; however, the impact of these design parameters are not well understood. the two key design parameters are read length and read type, i.e., single-end  in which only one end of the fragments are sequenced or paired-end  whereby both ends are sequenced. intuitively, long pe reads should capture more information than the short se reads; however, they can cost up to  <dig> ‚Äì <dig> times more , and nono from the human gm <dig> cell line and mafk from the human mcf <dig> cell line, as well as the control input data from these two cell lines, with a read-length of  <dig> bps at typical depths . we generated data with other read parameters in silico from these full data, and evaluated short  and long  pe and se read designs for their impact on alignment, peak calling, and allele-specific binding  detection. we complemented these comparisons with evaluations on simulated data where the underlying truth was known and established advantages and disadvantages of different designs in terms of accuracy and power. our study deepens the understanding on the impact of design in transcription factor chip-seq experiments, and is likely to provide insights on other types of chip-seq experiments.

methods
chip-seq data
we generated chip-seq datasets for ctcf, nono, and bhlhe <dig>  in gm <dig> cells and mafk in mcf <dig> cells as part of the phase  <dig> of the encode project . the information on the antibodies used for chip is available at the encode portal and can be accessed using the following accession numbers ctcf , bhlhe <dig> , nono  and mafk . a detailed protocol for the chip-seq can also be downloaded from the encode portal  <cit> . among these factors, ctcf, bhlhe <dig>  and mafk are sequence specific transcription factors with known motifs while nono does not have a well-defined motif. these data sets were chosen based on the availability within the encode community at the time of the research and their encode quality measures  <cit> . in particular, we excluded data with severe bottlenecking in library complexity  <cit> . due to our interests in motif analysis and allele-specific binding, we largely focused on sequence-specific transcription factors, and the cell line with the most complete diploid sequences available at the time of the research , but also included mcf <dig> as a second cell line. we used ctcf, mafk, and nono in read alignment comparisons, ctcf, mafk, and bhlhe <dig> in peak detection comparisons, and ctcf and bhlhe <dig> datasets in the asb detection comparisons. additional file 1: table s <dig> provides the numbers of fragments for each dataset.

in silico generation of chip-seq data of other designs from the original data
we randomly sampled one end from each paired-end read to generate single-end reads. we used homer software  <cit>  to trim the original reads to  <dig>   <dig>  and  <dig> bps for generating designs with shorter read lengths. additional file 1: table s <dig> provides the number of fragments, reads, and sequenced base-pairs in each design.

alignments by bowtie and bwa
we initially compared the alignment results of both bowtie -v mode  <cit>  and bwa  <cit> . bowtie can be set to report only uniquely mapped reads , whereas bwa also reports reads that can be mapped to multiple locations . our simulation results show that bowtie and bwa have almost identical coverage and accuracy when their alignment rules are comparable and if the multi-reads in bwa output are filtered. however, if the multi-reads are kept, the alignment accuracy of bwa could be low . thus we resorted to using only bowtie alignments for other comparisons. there are many other different alignment tools, such as bowtie <dig>  <cit>  and gem  <cit> . however, since alignments with bwa and bowtie dominate the chip-seq applications, we focused our attention to these two aligners. in our study, we used bowtie with the command ‚Äúbowtie -v ùúó -i  <dig> -x  <dig> -a ‚Äìbest ‚Äìstrata -m 1‚Äù, where ùúó= <dig>   <dig>   <dig>   <dig> and ‚Äú-i  <dig> -x 700" only applies to pe. here, ùúó denotes the number of mismatches allowed in each read, and  <dig> and  <dig> the allowed range of the fragment lengths in pe alignments. these upper and lower bounds were chosen based on bwa estimates of the fragment length from the ctcf dataset to make this parameter comparable between the two aligners. we considered four different options for bwa: ‚Äúbwa -q  <dig> -o  <dig> -n  <dig> ", ‚Äúbwa -q  <dig> -o  <dig> -n  <dig> ", ‚Äúbwa -q  <dig> -o  <dig> -n  <dig> ", and ‚Äúbwa -q  <dig> -o  <dig> -n 8", where -q  <dig>  -o  <dig> and -n  <dig>  are default options of bwa. the option -q allows trimming the low quality base-pairs from their 3‚Ä≤ ends, option -o allows user-specified numbers of gaps in the alignment, and option -n controls the number of allowed mismatches. specifically, when -n is an integer, it denotes the number of allowed mismatches. when -n is between  <dig> and  <dig>  the number of allowed mismatches is set to the quantile of a poisson distribution with mean  <dig>  √óread-length  with tail probability -n. we used ‚Äúbwa -q  <dig> -o  <dig> -n 8" to generate a relaxed alignment set. after the bwa alignment of the pe designs, we considered keeping all aligned pairs with both ends uniquely mapping  and additionally kept those with one uniquely mapping end . for se designs, we kept all the reads that are uniquely mapped .

abbreviations of designs and the design-alignment combinations
for simplicity, we introduced some abbreviations for the designs and the design-alignment combinations in additional file 1: tables s3‚Äìs <dig>  some illustrative examples of these abbreviations are as follows. we denoted pe data with read-length  <dig> bps as pe <dig>  se data with read-length  <dig> bps as se75; the bowtie alignments in -v mode allowing one mismatch as bowtiev <dig>  bowtiev <dig> alignment on pe <dig> data as pe36v <dig>  and the bowtiev <dig> on se <dig> as se75v <dig>  we used bwaq20o1ur to denote the alignment strategy where we first ran bwa -q  <dig> -o  <dig> -n  <dig>  and only kept reads that uniquely mapped to the reference genome . for pe, we kept the read pairs with at least one uniquely mapping end.

encode uniform chip-seq processing pipeline
we utilized the uniform chip-seq processing pipeline developed and benchmarked by encode  <cit> . this pipeline utilizes spp  <cit>  for calling peaks and generates a relaxed peak list with both true peaks and some regions with little or no enrichment of the chip-seq signal . then the irreducible discovery rate   <cit>  is applied to threshold the relaxed peak list and generate an optimal peak set for a given idr level . idr also accounts for the randomness between replicates. calculation of the average fragment length is also provided within this pipeline.

coverage analysis
we used spp to estimate the average fragment length for se designs, and extended the se reads to this length as their full length. the two ends of the pe reads were connected to form full length fragments.

coverage of repetitive elements
we calculated the coverage for each type of repeat element by summing over the fragment lengths of all reads overlapping with the instances of the repeat element and then normalizing the resulting sum with the total length of this type of repetitive element. for both the alignments and the peaks, we only counted those with at least  <dig> % overlap with repeat elements.

measuring alignment accuracy of chip-seq data using the relaxed alignment set
we used bwaq20o1n <dig> results of pe <dig> as a ‚Äúgold" standard relaxed set for benchmarking alignment accuracy in real chip-seq data analysis where the true origins of the reads were not available. this alignment rule is very relaxed and the alignment locations under this rule are not necessarily accurate. however, if a read cannot be mapped by this rule, it probably should not be mapped by any. thus, we marked those reads that cannot be aligned in this setting as ‚Äúunmappable". if an unmappable read was mapped under another design and using another alignment rule, we labeled it as a ‚Äúfalse positive" alignment. we then compared the false positive rates in the set differences of the alignments by the two designs. details of these calculations are illustrated in additional file 1: figure s <dig>  e.g., the false positive alignment rate of design-alignment  <dig> is a/ when it is compared with design-alignment  <dig>  in our simulation study, we found that bwaq20o1n <dig> results of pe <dig> has very high coverage , and accuracy . even though the simulation settings can never be as complex as the real data, the above results give us confidence about the sensitivity and specificity of bwaq20o1n <dig> alignment on pe <dig> 

motif analysis
for ctcf and mafk, we used encode defined motifs and corresponding positions weight matrices  from  <cit> . transcription factor bhlhe <dig> was not profiled in gm <dig> previously and did not have a pwm; therefore, we estimated its pwm from the top  <dig> peaks of the analysis of pe101v <dig> data using meme  <cit> . the peaks were scanned with these position weight matrices using fimo  <cit>  for all the motif analysis.

chip-seq peak calling by mosaics + idr pipeline
mosaics  <cit>  is a model-based approach for the analysis of chip-seq data. we combined it with idr to get a set of optimal peaks. the pipeline parameters were set as follows: thres: 99th percentile of the bin-level chip read count distribution; fdr:  <dig>  for generating the set of relaxed peaks. the relaxed peak set was filtered so that the chip read counts at the summit were at least as large as the sequencing depth normalized input read counts and the idr optimal peak set was filtered to contain peaks with at least  <dig> read counts at the summit.

minimax summit distance of the identified peaks
we define minimax summit distance lm to measure the spatial distance of the rank j peak among the top m peaks of the peak lists in the worst-case scenario across all replicates . small lm indicates better reproducibility. if lm is smaller than a given threshold t, we label rank j peak as reproducible in the top m peaks lists. let rm be the proportion of reproducible peaks among the top m peaks. large rm indicates that the top m peaks are more reproducible.

formally, for a fixed design, let pij be the rank j peak identified in simulation replicate i, where i= <dig> , <dig> , <dig> and j= <dig> ,‚Ä¶,m, and sij denote its summit location. the minimax summit distance for rank j peaks under the given design is defined as 
 lm‚â°maxi,k,i‚â†kmin‚Ñì‚â§ <dig> m|sij‚àísk‚Ñì|.  in the analysis presented in this paper, rank j peaks were labeled as reproducible if lm‚â§ <dig> bps, and the overall reproducibility of the top m peaks was measured by rm, the proportion of reproducible peaks. we varied m‚àà500√ó{ <dig> ,‚Ä¶,10}. the exact interpretation of rm is as follows: if we view two peaks with summit-to-summit distance less than  <dig> bps as the estimates of the same peak, then for any simulation replicate, the proportion of the targets of its top m peaks that can be recovered by the top  <dig> m peaks from another simulation replicate is at least rm.

analysis of peak set differences
when we compared the ranks of the peaks, if the summit distance between two peaks from two peak lists was less than  <dig> bps, we considered them as two estimates of the same binding event. we compared rankings of the two estimates of the same binding event from different designs in their respective relaxed peak lists. in the coverage comparisons of peaks, we only considered the peaks whose surrounding ¬±  <dig> bps windows contained no other peak summits from the other peak list, so that the closely-spaced binding events for which the coverage comparisons were difficult were excluded. then we defined the coverage around a summit as the number of reads overlapping with its surrounding ¬±  <dig> bps window.

allele specific binding detection by a modified alleleseq pipeline
alleleseq  <cit>  employs a binomial test of proportions for allelic imbalance detection. it aligns reads to the paternal and the maternal sequences of the sample to be analyzed and assigns each read to one allele based on the number of mis-matches with the ties broken by random assignment. during this process, it discards the reads with ambiguous base n, and those that align to both alleles but at different locations. it then applies the binomial test at the phased heterozygous snps with at least  <dig> reads to test the null hypothesis of no allelic imbalance and achieves fdr control via simulation. in our actual data analysis, we set fdr level to  <dig> . alleleseq was originally designed for se reads. we adapted it to the pe setting with the following modification. after the reads were aligned to both alleles by bowtie, we calculated the number of mis-matches of each fragment by summing the mis-matches from both ends, and then assigned the fragment to one allele based on this total number of mis-matches. we also discarded the reads that were aligned to both alleles with equal number of mis-matches. in both cases, we ran alleleseq without a specific peak set, and then overlapped the output with the optimal peak set of pe101v <dig> for detecting asb events. alleleseq aligns the reads using bowtie in v mode. we allowed one mismatch for the designs with read length  <dig> or  <dig> bps, and two mismatches for those with read lengths  <dig> or  <dig> bps.

roc curve in asb detection
in our simulation study, we ranged the cutoff of p-value from  <dig> to  <dig>  and calculated the empirical fdr and true positive rates. since alleleseq excluded the loci with insufficient coverage , the true positive rate did not go to  <dig>  even if we increased the p-value cutoff to  <dig> 

allele-specific open chromatin  regions and allele-specific co-binding 
we pooled the two replicates of 36mer se dnase-seq data from gm <dig> cells from the ucsc encode portal  <cit>  and ran alleleseq to detect allele-specific activity. to get a high quality set of asoc regions, we applied more restrictive rules in filtering and identifying allele-specific behavior. we discarded the snps covered by less than  <dig> reads, and only reported those with p-values ‚â§ <dig>  and at least  <dig>  fold-change between the coverage of two alleles.

in the ascb analysis of ctcf and bhlhe <dig>  we first defined co-binding events as the events with the summit-to-summit distance of a ctcf peak and a bhlhe <dig> peak less than  <dig> bps. then, the co-binding regions were defined as the union of the ¬± <dig> bps windows around these summits. if two or more co-binding regions overlapped, they were merged into a single region. we examined the consistency in allele-specific activity in each of such co-binding regions. we only considered snps that were covered by at least  <dig> reads, had a with p-value ‚â§ <dig> , and the read proportion from the winning allele were at least  <dig> . within each co-binding region, there could be many snps with asb for one or both tfs. we labeled a co-binding region to be allele-specific co-binding  if both tfs showed asb in favor of the same allele, bi-allele-specific binding  if the two tfs showed asb in favor of different alleles. in rare cases, one tf showed asb in favor of different alleles at different snps within the same co-binding region. these cases did not affect the overall conclusions and were excluded.

simulation for paired-end reads from the diploid sequence of gm <dig> chr19
we simulated paired-end reads from the diploid sequences of chr <dig> in gm <dig> cells using the following procedure. 
simulate fragment length l: we simulated the fragment lengths by rounding random samples from a shifted beta distribution 100+√óbeta. this distribution is similar to the empirical distribution of the fragment lengths estimated from bwa paired-end alignments.

simulate the middle point positions of the fragment on the reference sequence z: we utilized a read model similar to the model underlying csem  <cit>  and cnvcsem  <cit> . specifically, we simulated the middle point positions of the fragments from a discrete distribution where the probability is proportional to the read depth of the pooled ctcf  data under pe101v <dig> 

simulate the allele assignment a‚àà{mat, pat}: we drew a random sample from unif as the true maternal probability in each 1000bps window around snps. we further assumed equal maternal probabilities in overlapping windows and maternal probability of  <dig>  in regions outside of these windows. we sampled a based on the maternal probability of the sampled middle point position.

convert z to the corresponding coordinate on the assigned allele za: we converted z to the corresponding coordinate on the assigned allele by the liftover function in the bioconductor package rtracklayer. for the positions on the reference sequence that cannot be mapped to the assigned allele, we slightly perturbed z iteratively until it was properly mapped.

extract the read sequences at both ends for the sampled fragment from the assigned allele: we calculated the two end positions of the fragment based on za and l and extracted the true read sequences from both ends.

sample quality score: for each read, we sampled the quality score from the qualities of the ctcf data.

insert read errors based on the quality score: we calculated the base-wise error probability based on the sampled quality score, determined the read error locations based on the error probabilities, and inserted the read errors based on the error distribution provided in additional file 1: table s <dig> 



we performed simulation experiments for five times. each experimental replicate contains one chip sample and one input sample. the read-densities on the reference genome were from pe101v <dig> of pooled ctcf and input samples of gm <dig>  the chip samples contain  <dig> √ó <dig> reads and the input sample contains  <dig>  √ó <dig> reads, so that the coverage of the simulated samples were similar to the coverage of chr <dig> in the real data.

in our simulation, the reads were simulated from the diploid sequence. when assessing the accuracy in their alignment to the reference sequence, we treated a read as aligned correctly as long as the extended aligned read covered the true middle point position on the reference sequence. when assessing the accuracy of asb detection, we defined the true asb as the snps where the ratio between the maternal and the paternal alleles is larger than  <dig>  .

RESULTS
the first step of chip-seq data analysis is aligning reads to a reference genome, and the choice of alignment strategy impacts the downstream analysis. thus we started with a detailed comparison of data alignments with different read parameters, and throughout this paper, we paid attention to matching designs and analysis protocols so that the read error rates, the numbers of reads, and the numbers of sequenced bases were comparable when necessary. for simplicity, we introduced some abbreviations for the designs and the design-alignment combinations in additional file 1: tables s3‚Äìs <dig> . we also summarized the major comparisons of the design and alignment combinations and the rationale for these comparisons in table  <dig>  for example, we compared pe36v <dig> with se75v <dig> and also pe50v <dig> with se101v <dig> for a fair comparison of pe and se designs with similar numbers of sequenced bases and read error rate in alignment. pe designs interrogate the same number of chiped fragments with twice as many reads compared to the se designs. we controlled the numbers of reads by randomly sampling half of the pairs from pe designs, and denoted such designs as pehalf . at fixed read-lengths, pehalf designs have the same number of reads and the number of sequenced bases as their se counterparts, but they could potentially contain less biological information since the paired reads are representing information from the same dna fragment.


the effect of read parameters on alignment coverage and accuracy
alignment rates of bowtie
alignment rates have a profound effect on the downstream analysis because higher alignment rates lead to more aligned reads at fixed sequencing depth and typically yield identification of more true signals with higher confidence. our comparison in alignment rates revealed a complex interplay between the read parameters, alignment rules, and other biological factors  usually had higher alignment rates than the pe designs with the same read-length, but pe <dig> had higher alignment rates than se <dig> in most cases due to its higher uniqueness in alignment. for example, the alignment rates of se75v <dig> were 2‚Äì <dig> % higher than pe75v <dig>  but those of se36v <dig> were 1‚Äì <dig>  % lower than pe36v <dig> for most data except one replicate of ctcf. the effect of read length is more complicated. longer se reads had higher alignment rates than short se reads in most cases due to their higher sequence uniqueness. in contrast, median read lengths seemed to improve alignment rates for pe, and in most cases, pe50v <dig> and pe75v <dig> outperformed pe101v <dig> and pe36v <dig> in alignment rates, respectively. the observed lower alignment rates of pe101v <dig> may be largely due to the lower quality near the  <dig> ‚Ä≤ end of long reads, a phenomenon commonly observed and well characterized for illumina platforms  <cit> . however, how much lower it could be depends on the specific quality profile. when the number of sequenced bases was also controlled , se designs had 0‚Äì <dig> % higher alignment rates than their pe counterparts. in fact, for all datasets and all the bowtie alignment settings considered, we found that  se75v <dig> yielded the highest alignment rates for all except one replicate of ctcf where it was  <dig>  % less than se50v3; and  pe50v <dig> yielded the highest alignment rates in pe for ctcf and bhlhe <dig>  and the second highest in pe for mafk, where it was  <dig>  % and  <dig>  % less than pe75v <dig>  the results on the simulated ctcf data showed similar patterns .


effective genome coverage of bowtie alignments
one of the key differences between pe and se designs is that once the pe reads are mapped, genomic coverage, i.e., the numbers of bases spanned by the aligning reads, are readily available whereas this quantity relies on the fragment length estimation in se designs. we evaluated how the designs differed in coverage, and found that it heavily depended on data quality. in detail, we compared the designs in terms of multi-coverage that we defined as the sizes of the genomic regions  covered by at least five reads .

we used the peak finder spp  <cit>  to estimate fragment sizes for the se designs. we observed that pe designs had higher multi-coverage than the comparable se designs for mafk and nono, but not for ctcf. we conjectured that such disagreement is likely due to the antibody quality. we concluded that all the designs might have similar coverage for data with good antibody such as ctcf. however, for typical tfs, pe designs do provide better coverage. we did not find apparent pattern of differences between different read lengths for either the pe or the se design.

repetitive element coverage of bowtie alignments of different designs
repetitive elements are dna sequences that occur in multiple copies throughout the genome. these copies can be either adjacent to each other or interspersed. repetitive genomic elements are important for many biological processes including regulation of gene expression  <cit> . we evaluated the coverage of different designs over the repetitive genomic elements, and found that both pe designs and long reads had higher repetitive element coverage in most cases. we specifically focused on satellite dna, long interspersed nuclear elements , short interspersed nuclear elements , long terminal repeat  elements, and segmental duplication regions  in our evaluation. figure 1a and additional file 1: figure s <dig> report the coverage  in these repetitive regions. for nono and mafk, we found that  pe designs had up to  <dig> % higher coverage over the repeats than se with the same read length;  doubling the read-length  improved coverage for up to  <dig> % depending on the tf, read-length, and the type of repeats; and  the effect of long reads was larger for se than pe. as an example, for one replicate of mafk, the coverage over line elements of pe36v <dig> and se75v <dig> were  <dig> % and  <dig> % more than that of se36v <dig>  respectively, and the coverage of pe75v <dig> was  <dig>  % more than that of pe36v <dig> . for ctcf, pe designs and the long reads had much less or even no advantage, e.g., the coverage over line elements for se75v <dig> was only  <dig>  % more than that of se36v <dig>  and that of pe36v <dig> was even  <dig>  % less than se36v <dig> . we observed a trade-off between longer se reads and short pe reads when comparing pe36v <dig> and se75v <dig> at fixed number of sequenced bases. pe designs had higher  coverage over most repetitive elements for mafk and nono but not for ctcf . on the other hand, se designs had higher  coverage over sdrs.
fig.  <dig> alignment rate and accuracy of actual and simulated data. a coverage of repeat elements in a mafk dataset. total lengths of the reads that overlapped repeat elements are normalized by the total lengths of the repeat elements. b false positive rates of a ctcf dataset based on the relaxed alignment set . c and d alignment rate vs. accuracy of simulation data for bowtie and bwa, respectively. x and y axis are percentages of aligned reads and correctly aligned reads. medians across five replicates are reported for each comparison



thus, read length appeared to be a more critical parameter than the pe or se aspect for improving coverage in sdr. our results agreed with and complemented similar comparisons in the literature . one reason for higher coverage of pe designs in repetitive regions is the increased mappability  <cit>  of their reads. from this point of view, our results were consistent with the above numerical study, and also revealed that the tradeoff between read length and pe design in real data depends on the types of repetitive elements.

accuracy of bowtie alignments
false positives in alignment may cause false positives in detecting enrichment regions. we evaluated the alignment accuracy using both experimental data and fully simulated data, and found that both pe designs and longer reads improved alignment accuracy. we devised a strategy for evaluating alignment accuracy with the experimental data, even though the true origins of the reads were unknown. we used a relaxed alignment set, bwaq20o1n <dig> with the pe <dig> data as the ‚Äúgold" standard, and labeled those reads that could not be aligned by this relaxed rule as false positives. then we compared the false positive rates of the sequencing designs in pairs  and assessed the false positive rates in their alignment set differences . for example, the false positive rate of the reads that were aligned under se36v <dig> but not pe36v <dig> was  <dig>  %, and that of the reads aligned under pe36v <dig> but not se36v <dig> was only  <dig>  %. our results in fig. 1b showed that pe designs and longer reads led to lower false positive rates, and the advantage of longer reads was smaller for pe than for se. our simulation results, where the true origins of the simulated reads were used for measuring the accuracy, were consistent with the real data analysis . figure 1c also highlighted a trade-off between the alignment rate and accuracy. designs with  <dig> bps reads might have low alignment rates if the quality at the ends of the long reads are low, and the alignment rate of se <dig> reads might be also low due to the lack of uniqueness. other se designs had high alignment rates, but low accuracy, and pe <dig>  pe <dig>  and pe <dig> had both high alignment rates and accuracy.

coverage and accuracy of bwa alignments
bwa is also one of the most popular aligners for chip-seq data. compared to bowtie -v mode, it allows more flexible error control, and trimming of the poor terminal bases . it also reports one selected alignment location for reads aligned to multiple locations . while the majority of our analysis is based on bowtie -v mode, we investigated a comprehensive set of alignment strategies based on bwa and compared them to the bowtie -v mode in this section. this investigation also led to many practical suggestions on trimming  and filtering multi-reads in bwa alignment. in table  <dig>  where trimming of poor terminal bases was applied , we observed that the alignment rates under all designs were similar when all the multi-reads were kept. in contrast, when only the uniquely aligning reads were retained, both pe designs and long reads led to higher alignment rates. in our simulation study where we conducted a more comprehensive comparison, we observed a similar pattern . additionally, our comparisons of bowtie and bwa alignments indicated that they had almost the same coverage and accuracy when their alignment rules were comparable . in summary, both our data analysis and simulation experiments led to the following observations. discarding multi-mapping reads in bwa output improved alignment accuracy, especially for se designs. when such reads are retained, their inaccurate alignments were enriched in many regions with a potential impact on the downstream analysis . when filtering multi-mapping reads from bwa output of pe data, only those pairs with multiple alignment locations for both ends needed to be removed, and those with one uniquely aligned end could be kept without loss in accuracy. properly trimming by the -q argument in bwa increased coverage without loss in accuracy, especially for long se reads. for example, trimming increased the alignment rate of se <dig> from  <dig>  %  to  <dig>  % , while the accuracy remained almost the same  in the simulated data.

the effect of read parameters on peak calling
number of peaks by spp+idr
we next evaluated the impact of designs on the number of detected protein-dna interactions, i.e., peaks. we adopted the robust chip-seq uniform processing pipeline  <cit>  developed and extensively used by the encode consortium. this pipeline first generates relaxed peaks, a list of approximately 3√ó <dig> regions using peak caller spp  <cit> . then, the optimal set of peaks is selected as the subset of the relaxed peaks with better peak score than the threshold needed for controlling the irreproducible discovery rate   <cit>  at a given level.

we found that pe designs led to larger numbers of optimal peaks than se designs regardless of the idr level . this was largely driven by the number of reads because spp treats the two ends of pe reads as two se reads, instead of processing the pairs as pairs. when the numbers of reads were controlled , the two designs resulted in comparable numbers of optimal peaks. furthermore, read length had no noticeable impact on the numbers of peaks.
fig.  <dig> effect of designs on peak calling. a number of mafk peaks by the spp+idr pipeline. b reproducibility of the top spp peaks of the simulated data. the black solid vertical line is the number of true peaks. c percentages of the top spp-identified mafk peaks with the motif. d‚Äìf the  <dig> ,  <dig> , and  <dig>  quantiles of the distance between the motifs and the peak summits for the top ranked spp peaks, mosaics peaks and macs <dig> for mafk, respectively. their legends are the same as in . g‚Äìh ucsc genome browser view over two pe and se specific bhlhe <dig> peaks with large coverage change. chr16: <dig> g was identified as a peak only with pe36v <dig> but not se36v <dig>  and chr1: <dig> h was identified only with se75v <dig> but not pe36v <dig>  the coverage tracks in each peak are normalized to the same scale. lighter color on the mappability tracks indicates low mappability



reproducibility of peaks
discovery from high throughput assays are often subject to variability across biological replicates, and, as a result, reproducibility of the discovered signals is a recurrent concern. the chip-seq uniform processing pipeline of encode uses idr to capture the reproducibility of the peaks between two replicates. in our simulations, we compared the designs using the reproducibility of the peaks across five replicates, and found that pe designs had better reproducibility. we measured the reproducibility by the minimax summit distances of the highest ranked peaks, which can be viewed as the maximal distance between the estimates of the same target in the five replicates. we labeled a peak as reproducible if its minimax summit distance was less than  <dig> bps, and higher proportion of reproducible peaks among the top peaks indicated better reproducibility. overall, pe peaks were more reproducible than the se peaks , which further elucidated why pe designs led to more peaks for fixed idr levels.

peaks in repetitive elements
in the previous section, we compared the designs in terms of their alignment coverage of repetitive elements. in this section, we revisited the repetitive regions, and investigated their peak coverage  under different designs. we overlapped the top peaks of each design with satellite dna, line, sine, ltr elements, and sdrs . we compared these observations with those at the alignment level , and found that the two did not necessarily exhibit the same pattern. for example, pe designs yielded higher coverage of mafk reads in sine elements  but smaller portion of mafk peaks within the same type of repeats . in contrast, long reads led to both higher ctcf coverage and higher portion of ctcf peaks in sdr . we remark that, since pe designs identified more optimal peaks, they also yielded more peaks overlapping with repetitive elements than their se counterparts, even if the overall proportion was slightly smaller.

evaluation of the peak sets by motif occurrence and motif-to-summit resolution
the peaks of a sequence-specific dna binding transcription factor typically harbor dna motifs that the tf binds to. a commonly used metric for the quality of the peak lists is the proportion of the reported peaks with at least one motif. we found that a slightly higher proportion of the spp peaks from pe designs harbor a motif than the se peaks for mafk, but not for ctcf or bhlhe <dig> .

another commonly used criteria for evaluating peak quality is their resolution, the distance between the summit of the peak and the nearest motif. a shorter distance between the motif and the summit indicates better resolution in peak calling. in our motif analysis, pe designs yielded slightly better resolution than se for peaks of similar ranks for ctcf and mafk . the parameters that impact the peak-summit resolution include fragment size and numbers of correctly aligned reads. spp estimates the fragment size with the same procedure for both se and pe designs and utilizes a single estimated fragment size for all the reads. although chen et al.   <cit>  showed that the spp estimates of the fragment sizes are within 10‚Äì <dig> bps of the average value obtained from pe data, the use of a single fragment size discards the variation in the estimated fragment size, and spp does not fully utilize the information of individual fragment lengths available in pe reads.

the majority of the currently available peak callers are developed for se data, and only few of them are readily adapted for pe  <cit> . to evaluate the gain due to using read-specific fragment sizes which are readily available in pe data, we re-analyzed ctcf and mafk datasets with mosaics  <cit>  and macs <dig>  <cit> . mosaics processes pe reads by acknowledging that every read pair represents a single fragment. we combined mosaics with idr to make the error control compatible with the uniform processing pipeline. for each peak, mosaics has the capability of reporting two types of summits: a chip-seq signal-based summit and a sequence-based summit which incorporates sequence information into summit detection. we focused on the resolution analysis of the signal-based summit because these summits were more comparable to the summits reported by spp. as expected, we observed a larger advantage of pe over se in terms of motif-to-summit resolution . macs <dig>  <cit>  also processes pe reads properly. we ran a similar analysis using macs <dig> output with default parameters without idr control, because we did not have a reliable pipeline that combines idr and macs <dig>  nevertheless, the macs <dig> results were consistent with mosaics results . this analysis confirmed that fully leveraging the pe designs might improve peak calling in terms of resolution.

analysis of peak set differences
the optimal peak sets reported under different designs were highly similar . such consistency indicated that all designs targeted the same overall signal pattern. in this section, we focused on the peak set differences, and investigated to what extent the differences could be attributed to the change in the ranking of the relaxed peaks and the alignment differences that led to significant changes in coverage. we first used se36v <dig> as the baseline and investigated the changes in peak ranking and peak region coverage when switching to pe36v <dig> or doubling the read-length . additional file 1: tables s17‚Äìs <dig> summarize the results of these comparisons. for each pair of designs under investigation , we overlapped their top m peaks, i.e., two peaks were declared as overlapping if their summit-to-summit distance ‚â§  <dig> bps, treated the overlapping peaks as the estimates of the same target, and compared their ranks. for each tf, we chose nine m values ranging from  <dig> % to  <dig> % of the size of its optimal peak list. for example, among the top  <dig>  ctcf peaks under pe36v <dig>   <dig>  of them overlapped with the top  <dig>  se36v <dig> peaks, another  <dig>  peaks overlapped with the the se36v <dig> peaks ranked between  <dig>  and  <dig>  √ó <dig> , another  <dig> overlapped with se36v <dig> peaks ranked between  <dig>  √ó <dig>  and  <dig> √ó <dig>  and the remaining  <dig> did not overlap with any of the se36v <dig> relaxed peak. this comparison indicated that the ranks of the  <dig>  of the top  <dig>  pe36v <dig> peaks effectively remained unchanged under se36v <dig> ,  <dig>  of them underwent moderate rank change ,  <dig> of them suffered from large changes in rank, and at most  <dig> of them were specific to pe36v <dig>  and could not be recovered under se36v <dig>  in summary, we observed that  more than  <dig> % of the ranks effectively remained unchanged in any comparison;  the majority of the rank changes were moderate; and  only a small portion  of the peaks seemed specific to one design, with the exception of bhlhe <dig>  where 10‚Äì <dig> % of the se peaks were specific to the se designs. we focused on the peaks in the last category , and further examined their chip and input coverage. surprisingly, we found that even for these peaks, the coverage around the summits were usually similar in different designs, and only a small percentage  exhibited a fold-change of at least  <dig>  in any replicate of chip or input samples . thus, if more than 3√ó <dig> peaks were included in the relaxed peak list, an even larger portion of peak set differences could be explained by rank change. we next investigated the motif occurrence and repetitive element coverage of the design-specific peaks with at least  <dig>  fold-change in coverage between the designs . we observed that there were barely any motifs except in one case , and sdr were enriched for all the peaks that were specific to pe or long read designs. we visualized two such bhlhe <dig> peaks with motifs in the ucsc genome browser, and found that both were in low mappability regions .

the effect of read parameters on allele-specific binding detection
allele-specific binding detection by alleleseq
allele-specific binding  detection searches for differences in tf binding between the two alleles of the same individual at a given set of loci . asb studies provide insights in understanding genomic imprinting  <cit>  and non-coding disease variants  <cit> , and a well-controlled model for understanding the population effects of functional variations in tf binding  <cit>  and other epigenomic processes  <cit> . although there are currently a number of methods for asb detection  <cit> , the impact of design on asb detection has not been studied. in the following comparison, we utilized the current alleleseq  <cit>  pipeline for se designs and adapted it to the pe designs.

numbers of asb loci detected by different designs
we compared the numbers of asb loci detected by different designs at alleleseq default fdr level of  <dig>  and observed an increasing trend with the number of sequenced bases . at fixed number of sequenced fragments, i.e., pe versus se comparisons, longer reads detected more asb loci, and pe designs yielded  <dig>  to  <dig> times more detected asb loci than se with the same read-length. when both the number of fragments and the number of sequenced bases were similar , pe designs yielded  <dig> to  <dig> % more detected asb loci for ctcf, and 42‚Äì <dig> % more for bhlhe <dig>  at fixed read-length, pehalf designs, which have half of the fragments of se designs, were overall comparable to the se designs in the numbers of detected asb loci.
fig.  <dig> effect of designs on asb detection. a‚Äìb numbers of snps that exhibited asb in the ctcf and bhlhe <dig> datasets. c empirical fdr of asb detection in the simulated data. d percentages of asb exhibiting snps detected by alleleseq in the simulation study  under different designs. e roc curve of asb detection on simulated data. the reported values are averages over five replicates



sensitivity and specificity of asb detection
we next assessed the impact of sequencing designs on the sensitivity and specificity of asb detection with a simulation study. we applied alleleseq on the simulated data and thresholded the p-values at  <dig>  to compute the empirical fdr. we found that pe designs and longer reads had higher true positive rates regardless the range of the true maternal probability , at the expense of slightly higher fdr levels . we then evaluated the true and false positive trade-off with an roc curve , and observed that  the differences in performances were, to a large extent, driven by the number of sequenced bases; hence, long reads performed better than short reads, and pe designs better than the se designs with the same read-length;  the advantage of long reads over short reads was larger for se than for pe, and the  <dig> bps reads did not perform much better than  <dig> bps reads; and  when the number of sequenced bases was controlled, pe <dig> performed better than se <dig> and the performances of pe <dig> and se <dig> were similar.

consistency among designs in asb detection
when we overlapped the set of asb loci identified by different designs, we observed low overlapping rates for many comparisons , e.g., alleleseq identified  <dig> asb loci for ctcf under pe50v <dig>  and  <dig> asb under se101v <dig>  and only  <dig> of them were identical, roughly a 2/ <dig> overlapping rate. figure 4a,b provide illustrative examples of pe50v <dig> specific and se101v <dig> specific asb events, respectively. in these two figures, some reads were only mapped and covered the snp under one design . others were mapped in both designs and covered the snp . although both designs had low coverage in this example, low coverage was not generally correlated with the differences in asb detection. in fact, the overall read counts at the asb loci that were identified only by pe50v <dig>  were comparable to all asb detected under each design .
fig.  <dig> effect of designs on asb detection . a‚Äìb aligned reads at two snps with design-specific asb for ctcf. chr3: <dig> exhibits asb only under pe50v <dig> but not se101v <dig>  and vice versa for chrx: <dig>  the vertical lines indicate the snp location on the reference genome. yellow rectangles are the reads that are properly mapped and cover the snp under both designs. blue rectangles are the reads that are mapped only under one design, or are mapped under both designs, but only cover the snp under one design, but not the other. the two ends of the same fragments are connected via horizontal lines for the pe design. in each figure, the pe and se reads labeled with the same number are from the same fragment. if one number only appears under one design, this read must have been filtered out or could not have been mapped under the other design. the reads assigned to the maternal allele are above the long horizontal line, and those assigned to the paternal allele are below the horizontal line. alleleseq only counts the reads overlapping with the snp  when testing the allelic imbalance. c‚Äìd numbers of snps with asb and asoc in favor of the same allele  and different alleles  for ctcf and bhlhe <dig> datasets, respectively. e numbers of ascb and biasb of ctcf and bhlhe <dig> datasets



motif comparison of the two alleles at the asb loci
we next evaluated the accuracy of asb detection in the ctcf dataset using motif information, and found that pe and long reads led to higher detection accuracy. specifically, we compared the p-values of the fimo  <cit>  reported matches to the ctcf motif in the winning, and losing alleles. if the p-value of the motif match in the winning allele was smaller than that of the losing allele, this asb loci was deemed more likely to be a true positive because the winning allele supported binding with a better motif match. however, we did not expect the asb loci without this property to be false positives because asb might be manifesting itself through other factors such as open chromatin structure and binding of co-factors. we considered the intersection and set differences of the asb loci for each pair of designs under investigation  and compared fimo p-values of the motif matches in both alleles . we further reported the number of asb loci with a motif in both alleles, only in the winning, only in the losing allele, and in neither of the alleles in additional file 1: table s <dig> using the default threshold for the fimo p-values . in summary, we concluded that se75v <dig> design was better than pe36v <dig> in asb detection accuracy. this is largely because, for the asb loci only identified under se75v <dig> but not pe36v <dig>  the overall improvement of the motif score in the winning allele over the losing allele was larger than those that were only identified under pe36v <dig> . furthermore,  <dig> of the asb loci that were only identified under the pe36v <dig> design but not se75v <dig> design had a motif only in the winning allele, and  <dig> of them had one only in the losing allele. in contrast, the set of asb loci specific to se75v <dig> had  <dig> loci with motif only in the winning allele and one locus with motif only in the losing allele . these analysis further indicated that  for the same read-length, pe designs performed better than se;  long reads performed better than short reads for both pe and se, with a possible exception of pe101v <dig> vs. pe50v1; and  when the number of sequenced bases were controlled, pe36v <dig> under-performed compared to se75v <dig>  but pe50v <dig> was better than se101v <dig>  overall, the best design from this perspective was among pe50v <dig>  pe75v <dig>  and pe101v2; and in each pairwise comparison, the asb loci identified under both designs were better than the others that are specific to one design in terms of accuracy.

consistency between dnase-seq and chip-seq in allele-specific behavior
dnase-seq experiments elucidate broader regions of open chromatin which often exhibit transcription factor occupancy . therefore, it is natural to expect interactions between allele-specific open chromatin  structure and asb. towards this end, we examined the consistency between the detected allele-specific behavior from dnase-seq  <cit>  and chip-seq data from the same cell line. we identified a conservative list of loci with allele-specific behavior in dnase-seq as high confidence allele-specific open chromatin  regions. we expected these loci to be asb loci in favor of the same allele if they also overlapped chip-seq peak regions. there were  <dig> and  <dig> loci with asoc in ctcf and bhlhe <dig> peaks, respectively. figure 4c,d evaluate the sensitivity of asb detection by the number of loci with both asoc and asb in favor of the same allele, and the detection errors by the number of loci with asoc and asb in favor of different alleles. for the same read-length, pe designs had higher sensitivity than se designs, at the expense of slightly elevated error levels. the sensitivity gain for ctcf ranged in 3‚Äì <dig> % for ctcf, and in 32‚Äì <dig> % for bhlhe <dig>  in both cases, the gain was driven by the number of sequenced bases. when the number of bases were controlled , pe and se designs performed similarly.

allele-specific co-binding of ctcf and bhlhe40
we defined allele-specific co-binding  events as the peak regions where two or more tf bound in favor of the same allele. in contrast, we defined the peaks where binding by those factors favored different alleles as bi-allele-specific binding . partially due to the interaction between binding and open chromatin structure, we expected ascb to be more common than biasb. we then investigated asb behaviors of ctcf and bhlhe <dig> in their co-binding regions. similar to the last section, we adopted a more conservative criteria for asb detection. we observed that the designs with similar amounts of sequenced bases yielded similar numbers of ascb and biasb, and the numbers of biasb were much smaller than the numbers of ascb as expected .

CONCLUSIONS
the impact of sequencing design on the downstream analysis is profound and complicated. it relies heavily on research goals, data quality, and the computational tools chosen for the analysis. our results suggest that both pe designs and long reads improve the alignment accuracy of bowtie and coverage in repetitive regions. the trade-off between pe designs and long reads depend on the expected data quality. for peak calling, pe designs yield more peaks with comparable quality  to their se counterparts, and the quality of pe peaks can be further improved if the peak caller is able to properly process pe information. on the other hand, read-length does not have much effect in peak calling. for asb detection, both pe designs and long reads lead to more detected asb with higher accuracy.

our computational and data-driven experiments support pe designs for their higher alignment accuracy and higher coverage in repetitive elements especially for tfs where the antibody or other experimental conditions are far from ideal. we did not observe a clear advantage of read length of  <dig> bps. pe <dig> worked as good as other pe designs for peak calling and pe <dig> and pe <dig> worked best for asb. one reviewer suggested that the observed design differences may depend on the particular error profiles of the data used. while this could be true, the typical error profiles from illumina platforms have been well characterized and lower quality near the 3‚Ä≤ end of reads is commonly seen  <cit> . thus the insights we learned in this study could be generalized with reasonable caution. in addition, variation in read error profiles is not the only factor that may affect the generality of the studies on sequencing design. numerous technical and human factors are potential contributors.

while it is up to the individual investigator to decide whether the potential improvement in biological findings is worth the costs of the more expensive designs, this study provides a computational perspective and highlights the importance of using appropriate computational tools to maximize the power of the chosen design. for bwa alignments, we found that filtering improves the alignment accuracy, especially for se and short reads, and trimming by option -q improves the coverage in aligning the long reads. however, despite the evidence presented in this paper and in the literature  <cit> , we acknowledge that trimming could be a contentious topic due to the potential bias it introduces in read density. when identifying peaks from pe designs, we suggest using a peak caller that fully leverages the paired-end information of the data. without using appropriate computational tools in the analysis protocol, the extra cost of paired-end chip-seq experiments may not be justified.

we systematically investigated the design effects using in silico data generated from chip-seq experimental data, instead of comparing publicly available chip-seq experiments using the same antibody and the cell line, but different designs. this is because our approach avoids the unnecessary variations in chip-seq experiments performed by different investigators using different facilities at different times. for example, encode pe data are generally two to three years newer than their se counterparts. in addition, generating in silico data via subsampling and trimming methods is common practice in the literature  <cit> . hence it is reasonable to expect similar conclusions being drawn from the comparisons of the chip-seq experiments performed in exactly the same way except the read designs. we only considered bowtie and bwa as aligners in our current study because they are currently the most commonly used read mappers in chip-seq analysis. we mainly used spp for peak calling, because it works well with idr, which allowed us to assess reproducibility. the majority of the popular peak detection tools  do not process pe information appropriately. thus we only included mosaics and macs <dig>  two representative peak callers with such capability, instead of comparing all popular peak-calling tools. we focused on chip-seq experiments for transcription factors, and designed and adopted systematic evaluation criteria. interesting extensions include cross-species comparisons of the design effects, and investigating the sequencing design effects on chip-seq experiments for histone modifications, and other experiments such as bisulfite sequencing  <cit> , and 5-hmc sequencing  <cit> .

the impact of sequencing depth on the detection of enrichment regions and many other factors that affect alignment and peak calling in the context of chip-seq have been investigated by others  <cit> . our work extends the current literature in multiple important perspectives by focusing on the sequencing design parameters, considering multiple alignment strategies and evaluating the combinations of design and alignment strategies. most importantly, our study represents the first systematic evaluation of the impact of chip-seq designs on asb detection and highlights the power of pe designs for asb detection.

additional file
additional file  <dig> 
supplementary materials. the file that contains all supplementary notes, figures and tables. 

 competing interests

the authors declare that they have no competing interests.

authors‚Äô contributions

sk and mps conceived the study. qz and sk designed the study. tk and mps contributed the data. qz, xz, sy and sk designed the analysis pipelines, and analyzed the data. qz and sk wrote the manuscript with entries from tk and mps. all authors read and approved the final manuscript.

authors‚Äô information

qz and sy performed the research while they were postdoctoral research associates in the statistical genomics research group led by sk at university of wisconsin madison. xz performed research while she was a phd student supervised by sk in department of statistics at university of wisconsin madison. qz is now assistant professor in department of statistics at university of nebraska lincoln. tk is a research scientist in the lab led by mps at stanford university. mps is professor and chair of genetics, and director of stanford center for genomics and personalized medicine at stanford university. sk is professor in department of statistics, and department of biostatistics and medical informatics at university of wisconsin madison.

