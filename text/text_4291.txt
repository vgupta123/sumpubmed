BACKGROUND
high-throughput measurement technologies provide comprehensive data sets to obtain insight on disease mechanisms and the biological impact of exposure to active substances, such as drugs and environmental toxicants. however, the scientific community faces an ongoing challenge to analyze and interpret these data sets and derive useful insights about the studied biological systems. the analysis of high-throughput expression data typically leads to a list of differentially expressed genes. however, this approach often fails to provide mechanistic insights into the underlying biology. during recent years, researchers addressed the complexity of such data by evaluating them in a relevant biological context  <cit> , whereby genes are grouped based on a priori knowledge such as msigdb  <cit> . sets of genes are then used by algorithms determining their specificity  in a particular experiment  <cit> . kathri et al. <cit>  recently reviewed and categorized them into three main successive generations: over-representation analysis , functional class scoring  and pathway topology . unlike ora approaches that only consider differentially expressed genes, fcs approaches, such as gsea  <cit> , take into account the entire dataset without applying thresholds. the development of pt approaches was motivated by the increasing evidence that interactions between genes or proteins better describe underlying molecular mechanisms  <cit> . these approaches allowed for a better use of pathway and network collections, such as kegg, biocarta, mips  <cit> , the database of interacting proteins   <cit> , and the molecular interaction database   <cit> . the mapping of genes onto pathway or network representations has resulted in algorithms with better specificity because they account for the topology of the pathway or network  <cit> . nevertheless, most currently available pathway tools rely on the “forward assumption”, where protein activity changes are assumed to be directly correlated with expression changes of their coding genes  <cit> . this assumption does not always hold  <cit> ; furthermore calculations that are based on few genes may lack robustness. table  <dig> shows some representative of methodologies relying on this assumption, and their key features.

for each represented method, their properties are described. the method described in this study, toponpa, is to our knowledge the first backward pt methodology. ora: over-representation analysis, fcs: functional class scoring, pt: pathway topology. : with small modification.

in contrast, the “backward assumption” groups together the genes which have been described in the literature to be regulated by a given molecular entity, referred as to the upstream biological entity  . ubes are as diverse as transcription factors , protein activities, complexes or bioactive chemical compounds. relationships between a given ube and its regulated genes additionally include the sign  of the regulation. such signed gene sets are also called hyps, standing for “hypotheses”, as described in  <cit> . signed gene sets are leveraged by methodologies such as reverse causal reasoning  <cit> , modified gsa  <cit> , by the network perturbation approach  <cit>  . ubes can be further assembled into networks , whereby an edge between two entities represents a cause-and-effect relationship, typically an activation or an inhibition. network nodes may also include entities that are not known to regulate any genes. thus, these network models have a two-layer structure, as shown in figure 1a, where the functional level  is explicitly distinguished from the transcriptional level . recently, an ensemble of more than eighty such network models that consist of cause-and-effect relationships between molecular entities and activities  have been published  <cit>  and made available to the community for peer-review  <cit> . the description of the biological context has been manually built into the network models using prior knowledge extracted from both relevant literature and published datasets after a large-scale knowledge mining effort  <cit> . these networks describe biological processes such as cell proliferation, cell apoptosis and senescence, cell stress, and inflammation. further biological processes can be described using cause-and-effect relationships from the openbel framework  <cit> . openbel is an open platform technology designed to collect cause-and-effect statements that can be further assembled into two-layer networks.

to assess qualitatively the enrichment of such networks, one could leverage the results of any  gene set method testing the significance of the ube’s in the network and subsequently test the over-representation of the significant ones by a hypergeometric or binomial test. under the backward paradigm, such a method would correspond to an ora approach  with the limitations discussed in  <cit> , such as applying thresholds and ignoring inter-relationships between the entities in the network. in order to score a two-layer network, the entire network can be collapsed into a single signed gene set and an fcs approach that can handle signs  can be applied. martin et al. <cit>  followed this approach, using uniquely defined signs between entities in the network and a fixed reference node. this approach accounts only for a spanning tree of the network and disregards the rest of the topology, hence does not classify as a pt approach as such . in a “proof-of-principle” study, using this method, we have quantified the perturbation of a given ube based on high-throughput data  <cit>  and showed that it correlates with independent assay endpoint. however, the applicability of the method is restricted to causally consistent networks , and does not allow for the identification of the key drivers of the network perturbation. identifying the key mechanisms responsible for the activation or perturbation of a network/gene set is a valuable feature of any methodology, leveraging either the forward or the backward assumption. for example, gsea approaches extract the leading-genes of a scored gene set to serve as the basis for further interpretation. however many methods  do not provide such a layer for interpretation .

gene expression data have being used to derive diagnostic signatures that inform clinicians on disease states or treatment outcomes. majority of research has involved identifying and scoring signatures that are correlated with a disease phenotype  <cit> . due to the high number of genes that are measured with high signal to noise ratio and genotypic variability across individuals, gene-level signatures often lack consistency between independent studies. signatures may also lack biological meaning and interpretability because they are often derived from machine learning approaches that do not include a priori knowledge. a number of studies have shown that network markers tend to be more robust and more accurate when pathways or protein-protein interaction networks were used as substrates to derive predictive signatures  <cit> .

the objective of this research was to establish a computational methodology that can integrate gene expression data with a two-layer cause-and-effect network by using its full topology to identify, interpret and quantify the perturbation of the network in response to any treatment. the quantification of the network perturbation  extends the concept of differential expression of single genes to the pathways or networks  <cit>  and is of value in fields of toxicology and pharmacology  <cit> , where dose and time response are studied. this approach goes beyond the enrichment approaches used in many pathway/network tools, which are focused on testing a non-enrichment null hypothesis  <cit> . the quantification of the network perturbation in response to a treatment enables not only a comparison across several networks, but also a comparison between several treatments on the same network  <cit> . first, we applied our method to datasets and networks to compare the results qualitatively and quantitatively with the expected outcomes, as well as the results obtained when using other computational approaches. second, based on one additional dataset derived from a controlled experiment involving the cell cycle, we showed that the key drivers identified by our method are aligned with the expected biology. third, two additional public datasets were used to quantify the xenobiotic metabolism response to smoke exposure, identify the key drivers and derive a robust smoking exposure signature. the performance of our network-based signature was compared to several recognized computational approaches. finally, we applied our methodology to study the mechanisms underlying the unequal efficacy of an anti-inflammatory drug in patients suffering from ulcerative colitis and provide a plausible mechanistic hypothesis. utilizing the underlying mechanisms, an accurate and robust network signature for predicting individual patient responses was generated. the signature over-performed those generated by other computational approaches.

methods
data
the data used in this study were either obtained from internal experiments that are described hereafter  or downloaded from the public repositories such as gene expression omnibus  or arrayexpress  . raw rna expression data were analyzed using the affy and gcrma packages of the bioconductor suite of microarray analysis tools available in the r statistical environment . robust microarray analysis  background correction and quantile normalization were used to generate probe set expression values. the fold-changes and their moderated t-statistics were computed using limma  <cit> .

gse identifiers refer to datasets in gene expression omnibus  and e-mtab identifiers to dataset deposited in arrayexpress . the number of samples per group is indicated in parenthesis.

network models
networks models are a representation of the relationships between the biological activities taking place in the considered cellular systems. they are based on information extracted manually from the scientific literature and encoded in the bel syntax. bel is a computable format for unambiguously capturing biological entities and their inter-relationships and associating them with external vocabularies and ontologies  <cit> . the nodes of the networks correspond to molecular biological entities  and also include cellular processes . the network edges connect two nodes and represent the cause-and-effect relationship between the corresponding entities . edges are directed as a consequence of their causal nature. they are additionally signed, indicating whether the changes  of the connected nodes have same  or opposite  signs. an ensemble of more than eighty such network models are made available at  <cit> .

in the “backward-causal” paradigm, the changes in the activities of molecular biological processes, the ube’s, can be inferred based on the changes measured for their causally “downstream” entities, in our case the differential expression of the genes causally affected by considered processes. for example, the activity of cyp1a <dig> is not measured but its change, between a treated and untreated condition, is reflected in the expression of the genes described to be altered by it . another example is the change in the activity of a transcription factor which is deduced from the changes in the expression of its direct targets, and not from the changes in the expression of its mrna. this paradigm is becoming increasingly popular  <cit>  and among others, “backward-causal” features have been introduced recently in ingenuity pathway analysis software  <cit> . using rnai experimental data, markowetz et al. showed that upstream pathway relationships between unobserved molecular entities can be reliably deduced from downstream measurable entities  <cit> .

this is in contrast to the “forward-causal” approach, where the activity changes of a protein is approximated by the differential expression of its corresponding transcript . the number of “downstream” of a typical ube is between a dozen and several hundreds. additional details can be found in the additional file  <dig> 

in a nutshell, our networks models are made of signed gene sets  related by signed directed edges. by definition of the two-layer structure there are no edges between genes in the transcript layer as we assume here that relationships between genes are driven by the functional layer. an overview of network models used in this study is given in table  <dig>  one can observe that the size of the functional layer  is small as compared to the size of the transcript layer . the network models used in this study are further discussed in additional file  <dig> and are available in the additional file  <dig> 

the network edges and nodes can be found in the additional file  <dig> 

the topological network perturbation amplitude scoring: toponpa
our method aims at reducing the high dimensional transcriptomics data by combining the gene expression fold-changes into fewer differential backbone values . by definition of the two-layer structure, no measurements corresponding to nodes in the functional layer are available. the differential backbone values will be therefore determined by a fitting procedure that infers values that best satisfy the directional and signed relationships contained in the backbone model , while being constrained by the experimental data  . an overview of the steps involved in the methodology is summarized in figure  <dig> 

objective and problem statement
let g= be the signed directed graph underlying the biological network  and let us assume that  is strongly connected. the set of nodes of the transcript layer is denoted by v <dig> and its complement, the backbone, by v∖v <dig> 

for each negatively signed edge, x⊣y ⊣kaof), we assume that an additive change of α∈ℝ in the value of x results in a change of −w·α in the value of y where w> <dig> is a weight associated with the edge. similarly for positive relationships, a change of α∈ℝ in the value x results in a change of w·α in the value of y. in the absence of further information, the weights are assumed to be  <dig> as in many network-based approaches .

if the network model was perfectly representing the data, one could expect the values on v, denoted by f∈l2a, to satisfy all the “cause and effect” statements of the network model and, on v <dig>  to equal the computed fold-changes. hence, being given the vector of  fold-changes β∈l <dig> for the genes in the transcript layer, the optimal fit of the network to the data is computed as the “smoothest”  vector f∈l <dig> such that its restriction  to the transcript layer is equal to the observed fold-changes f|v0=β. therefore we solve the following optimization problem: 

 minf∈l2∑x→yf−signf2wsuch thatf|v0=β, 

 where w is the weight associated with the edge bounded by x and y. this problem relates directly to a dirichlet boundary condition problem in spectral graph theory  <cit> .

due to the fact that some biological entities of the backbone are more studied than others in the literature, ube’s with a lot of downstream genes  will have a very high degree in the graph, as compared other nodes in the backbone. to overcome this issue, the weights associated with the edges x→y from a backbone node to its nx downstream in the transcriptional layer  will be set to w=1nx. equivalently, all the genes have the same importance in describing the ube’s and therefore the out degree to the transcript layer of any ube will be  <dig>  this adjustment will value the backbone structure, which is intended to capture the biology and balances the importance of the backbone and the transcript layer .

solution of the constrained optimization
for x∈v let out ) be the weighted out -degree of the vertex x. leveraging the quadratic nature of the problem, one can show that it is equivalent to: 

 minf∈l2ftdiag+diag−a+atfsuch thatf|v0=β 

where a is the signed weighted adjacency matrix defined by 

 axy=sign·wifx→y0else 

even though the problem involves the directed edges only, the quadratic nature of the objective function leads to symmetric matrices and involves the matrix l=diag+diag−, which is the signed laplacian of the undirected graph; hence the directionality of the edges has no more importance at this stage.

let l <dig> denote the sub-matrix of l whose rows and columns consist of the backbone nodes, and l <dig> the sub-matrix whose rows correspond to the backbone nodes and columns to the genes in the transcript layer. a straightforward differentiation with respect to f of the expression above and using the constraint shows that the solution is given by 

 f|v∖v0=−l3−1l2tβ 

as l <dig> is weakly diagonal dominant and strictly diagonal dominant for at least one row  and as the underlying undirected backbone graph is assumed to be strongly connected, l <dig> is irreducibly diagonally dominant. therefore, it will be non-singular, ensuring the existence and uniqueness of the solution.

laplacian and related matrices, like the diffusion kernel on graphs, have been successfully used to prioritize disease genes or to assess pathway enrichment  where the added value for accounting for the full network topology is demonstrated. unlike these methods, where the data are mapped directly on a graph, the problem solved here involves an additional boundary constraint as the smoothing is applied to the backbone network only.

quantifying the perturbation
the objective is to summarize into a single number, called network perturbation amplitude, how well and how strongly the inferred values match with the network, with the aim to capture dose and time response of the network, typically in toxicological testing. if all the inferred differential backbone values are high and all the signed edges in the backbone are accommodated by those values , the highest should be the perturbation of the network. also, as the optimization problem is constrained, the differential backbone values can be relatively high, but still not accommodating well the edge signs. based on this intuition, we concluded that the perturbation should be a function of the edges and not the nodes alone. additionally, we should avoid canceling out  cumulative signed edge scores . this situation, where subnetwork perturbations and network perturbation are inconsistent, could typically happen in  <cit> . hence, our choice was to consider an “energy”  analogue quantity for each edge. therefore, the network perturbation amplitude is calculated using the differential backbone values, f|v∖v <dig> and is defined as a positive number representing the cumulated “energy” of f|v∖v0; i.e., each edge x→y contributes to +signf) <dig>  this score will be consistent with the objective function minimized.

formally this is defined by the sobolev  norm on the graph , normalized by the number of edges  allowing for more direct comparison between models. 

 toponpa=1c∑x→ys.tx,y∉v0f+signf2·w 

unless explicitly stated, w= <dig> for all the edges of the backbone. following the argument above, this expression is a quadratic form 1c·f|v∖v0tqf|v∖v <dig>  where q∈l2) is defined by 

 q=diagout|v∖v0+diag−−a−at|l <dig> 

this first step is described in figure 2a.

vanishing of the toponpa score
let gb−= be the signed subgraph induced by v∖v <dig>  and for which the sign function is defined by σb=−σ|eb. the signed laplacian of gb− is exactly q. it follows directly from the rayleigh quotients that the toponpa score is bounded by 

 0≤||f|v∖v0||2cλ1gb−≤toponpa≤||f|v∖v0||2cλngb− 

where λ1gb  is the smallest  eigenvalue of q.

let us focus on the vanishing of λ1gb−. by definition, a graph is balanced if and only if all its cycles are positive. this property is called “causally consistent” in  <cit> . equivalently, gb− is balanced if there exists a partition v=v1∪v <dig> such that every edge between v <dig> and v <dig> is negative and every edge within v <dig> or v <dig> is positive  <cit> . it follows from the matrix-tree theorem for signed graph, that λ1gb−= <dig> if and only if gb− is balanced  <cit> . this implies in this case that the kernel of q is exactly the subspace of constant functions f≡c on v <dig> and f≡−c on v <dig>  for any real c. as a formal consequence, if  the graph is balanced, a toponpa score can be zero while the backbone values are piecewise constant as described above; which rarely occurs due to the boundary constraint. the steps involved in building the toponpa score are depicted in figure 2a.

confidence intervals
in order to derive confidence intervals for the differential backbone values and the toponpa score, we show that the covariance between the gene fold-changes β  vanishes under a weak assumption. let  be a pair of random variables describing two genes and let us assume that |untreated,|treated)≐xu,yu,xt,yt∼nμu,μt,Σut. the covariance between the fold-changes, where we have m <dig>  i.i.d. samples in the treated  group, is given by: 

 cov1m1∑i=1m1xit−1m2∑i=1m2xiu,1m1∑j=1m1yjt−1m2∑j=1m2yju=1m1m1∑i,j=1m1covxit,yjt−1m1m2∑i=1m1∑j=1m2covxit,yju−1m2m1∑i=1m2∑j=1m1covxiu,yjt+1m2m2∑i,j=1m2covxiu,yju 

thus, assuming that there is no second order effect of the treatment =cov=cov=cov), the above expression vanishes. consequently, under this assumption, β∼n)); which leads to the variance-covariance matrix of the backbone differential values var=l3−1l2tdiagvarβil2l3−1t. as a consequence, the variance of a toponpa score can be computed as var=2tr+4μ2tqΣ2qμ <dig>  and Σ2=varf|v∖v0). asymptotically correct confidence intervals are then derived using the central limit theorem .

the companion statistics
although a toponpa score can be highly significant with respect to the biological variation , it does not imply that the gene fold-changes specifically reflect the network structure itself. in order to assess this aspect, two complementary permutation statistics are introduced: the “o” and the “k”-statistics. the ability to distinguish the specifically perturbed networks from the non-specific ones is key as a total of  <dig> sub-networks have been built to date and can be used simultaneously. these companion statistics quantify the relevance of the information contained in the network model in determining the score . 

“o” the first one assesses the adequacy of the downstream genes assignment  to the nodes of the backbone model by reshuffling the gene labels in the transcript layer. it tests the null hypothesis that the position of the genes in the transcript layer has no importance in defining the score. therefore gene labels are permuted and the toponpa score is recomputed. this procedure is repeated b times  and a permutation p-value is derived.

“k” the second statistic assesses the importance of the cause-and-effect relationships encoded in the backbone of the network in extracting the toponpa scores. it tests the null hypothesis that the structure of the backbone has no importance in deriving the toponpa score. the edges of the functional layer are randomly permuted , differential backbone values are re-computed and toponpa is recomputed using the original matrix q. this procedure is repeated b  times and a permutation p-value is derived.

the upper bound value on  states that the highest possible value for the toponpa  is achieved by the eigenvectors for the largest eigenvalues of gb−, which in spectral theory are called the high energy function on the graph. as the highest eigenvalue λngb− is invariant under the permutations described above, the two statistics can be interpreted as testing if the smoothest function on gb satisfying the constraints given by the experimental data is also a high l2-norm function and a high energy function  on gb−. subsequently, the network is considered to be specifically perturbed if both p-values are low . the toponpa results will always be interpreted in light of the three companion statistics: the two permutation p-values and its confidence interval.

the leading nodes
to ease the interpretation of a significant perturbation, the major contributors in the sum  can be identified. by sorting the terms in toponpa=1c∑x∈v∖v0·f|v∖v <dig>  one compute the contribution of any node y as 100·1c·f|v∖v0toponpa and rank those accordingly.the key contributors to the perturbation, referred to as leading nodes  are by definition the nodes that make up 80% of the toponpa score. it both accounts for the differential backbone values themselves but also to the centrality of the nodes in the functional layer. while 80% is an empirical choice, we have observed that it is usually a promising start to interpret the perturbation and does not preclude, if for example all the contributions are almost equal, to use further ranked nodes. as demonstrated in the next section, the notion of leading nodes is a very useful way to interpret the perturbation; an appropriate understanding of the perturbed biology can only be achieved if the topology of the network and the differential values of the network nodes are equally taken into account.

deriving network signatures
as differential backbone values are obtained through a linear transformation of the fold-changes, individual gene expression profiles can be transformed into backbone values that can subsequently be used for the purpose of classification. for single samples, gene expression profiles are centered, leading to a differential value between the individual profile and the population average. so to map the individual sample data x  to the backbone, we simply compute b=−l3−1l2tx. this new data matrix will serve as the basis for the classification tasks. as this linear transform does not depend on the data, cross-validation schemes can be performed on the transformed data b. the linearity of this transformation ensures that the differential backbone values obtained from the fold-changes are the same as the difference of the average backbone values of the individual mappings. the latter property is important for the coherence of the toponpa framework. this step of the methodology depicted in figure 1c, bottom panel, where points represent samples, colors code for different phenotypes and axes illustrate the backbone nodes.

comparison to quantification/enrichment methods
comparing gene set/pathway analysis methods in a real experiment is not straightforward because no quantitative performance metrics  are applicable as the “ground truth” is unknown. however, the methods can be compared based on how well their results fit with the existing biological knowledge. this type of assessment is the current best practice in this area  <cit> . in each use-case, two aspects will be compared to the expected biology: the presence or absence of an enrichment, based on the significance  and the dose-response patterns .

as our method is developed with the aim to exploit the specific two-layer structure of cause-and-effect networks, it was compared to the results of methodologies using the same structure, obtained by straightforward adaptations of existing approaches. those ones belong to three categories  <cit> : 

forward fcs approaches: gene-set enrichments methodologies are applied to the set of genes in the transcript layer. following  <cit> , several combinations of gene-level statistics and gene set enrichment statistics are used. for the gene-level statistics, moderated-t statistics and fold-changes are considered; the former being the canonical choice in fcs enrichment approaches and the latter being the statistics used in toponpa. for the enrichment statistics , we used the mean, maxmean  <cit> , and gsea  <cit> .

backward ora approaches: a straightforward approach to test the enrichment of a two-layer network model is to test the enrichment of each ube in the functional layer by rcr  <cit> , which is specifically designed for ube’s and subsequently test the enrichment of the network by a hypergeometric test. the overall “perturbation” is defined as −log <dig> 

backward fcs approaches: another approach is to test the enrichment of each ube in the functional layer  and subsequently test the enrichment of the significant ube’s by a hypergeometric test. to quantify the perturbation of the functional layer one simply considered the sum of squared enrichment scores of the ube’s  in additional file 1: figure s <dig> and s4). to test the enrichment of ube’s, the same combinations of gene-level statistics and enrichment statistics described above were used. the results were also compared to our previous methodology, npa  <cit> .

comparison to signature methods
the comparison between feature selection  and feature construction was the main aspect considered. hence the performance across different machine learning methods  was not the main focus of this work.

our results were compared to the classification performances of the following computational methods. the first method, not using any of the network information, was the method of the winning team of the improver diagnostic signature challenge  <cit> , referred to as, tforwardld. the first step of the method is to order the features by absolute values of the associated moderated t-statistics. in a second step, the predictors are used one after the other in a lda model based on this ordering . at each step an internal cross-validation is computed and the final set of features is selected accordingly. the selection step of this method is included within the cross-validation instances performed in the comparison study to avoid any selection bias in the performance assessment. this methodology was applied on the full set of genes and on the genes in the transcript layer only.

as highlighted in  <cit>  as a take home message of the sbv improver diagnostic signature challenge, the choice of the base classifier should not impact the prediction performance as much as the choice  of the features. this observation has led us to choose linear discriminant analysis , linear support vector machine , random forests   <cit>  and, nearest shrunken centroids   <cit>  as the base classifiers. in every instance, nsc algorithm cross-validation results were obtained by selecting the shrinking parameter by an internal cross-validation within each cross-validation step.

a more sophisticated methodology, the condition responsive genes  approach  <cit>  using the ube’s was also compared. in this approach, one new feature for each ube is constructed and a classifier is applied on the resulted set of features. again, the feature construction step is included within each cross-validation step as it depends on the training data.

finally, lda or nsc prediction models derived from the genes underlying each ube individually was build and the best one ) was reported.

the extraction of the differential backbone values for individual samples is a purely unsupervised computation and only involves a fixed linear transform of the data −l3−1l2t. therefore, the cross-validation for classifiers based on the backbones values is equivalent to the cross-validation on the original samples for the combination of the mapping to the backbone values and the classifier. all cross-validations are 10-fold cross-validation, averaged over  <dig> repetitions.

RESULTS
toponpa distinguishes specific from irrelevant perturbations and enables dose-response calculations
we first evaluated the ability of toponpa to capture quantitatively a network perturbation and the companion statistics to distinguish specific from irrelevant perturbations. for that purpose, networks and datasets were chosen where clear biological expectations were available. those biological expectations will serve as the basis for comparing toponpa to other methods.

description of the data and networks
the xenobiotic metabolism network is part of the cell stress model, representing the response to external stressors for non-diseased tissue with a focus on the pulmonary and cardiovascular systems  <cit> . representing an unrelated mechanism, the tnf-il <dig> α-tlr-nf κb network model, including the toll-like receptors , interleukin-1a  and tumor necrosis factor- α  arms, covers the major signaling pathways that lead to nuclear factor- κb  activation in response to inflammation  <cit> .

the first dataset  was derived from a 28-day cigarette smoke inhalation experiment conducted in rats and was expected to show perturbation in both networks, because cigarette smoke is a known inducer of inflammation and xenobiotic metabolism in the rat respiratory tract  <cit> . we have also used a second dataset  from rat large airway progenitor cells  treated with increasing doses of tnf for  <dig> ,  <dig>  and  <dig> hours.

in the first experiment, a dose response of the tnf-il <dig> α-tlr-nf κb network activation was expected  <cit> . similarly, the activation of the xenobiotic metabolism response network was expected to follow a dose response pattern  <cit> . in the second experiment, the tnf response was monitored by measuring the nuclear translocation of nf κb after treatment at  <dig>  hours  and led to expect a significant network perturbation amplitude evolving in a dose and time dependent manner. finally, no xenobiotic metabolism response was expected in this second experiment. the comparison of the results will be performed based on those biological expectations.

comparison to other quantification/enrichment methods
the perturbation of the tnf-il <dig> α-tlr-nf κb network was evident in the rat lung parenchyma when the rats were exposed to smoke as compared to the sham-treated animals . similarly, the network was activated in tnf treated rlak cells in a dose and time dependent manner . the examination of the p-values revealed a perturbation of the network even with small doses and short tnf treatment times. by contrast, while the biological processes represented in the xenobiotic metabolism network were clearly activated, following an expected dose-response pattern, in the smoke-exposed rat parenchyma , the companion statistic p-values indicated that they were not specifically perturbed in rlak cells, by any tnf treatment dosage or time .

none of the tested method was able to both qualitatively and quantitatively match the biological expectations for those use cases, as summarized in table  <dig> . the npa methodology in  <cit>  was also applied to the tnf-il <dig> α-tlr-nf κb network and shows a slightly inferior behavior . additionally, as the xenobiotic metabolism network is not causally consistent   to ahrr , this approach was not applicable and further motivated our method that does not assume causal consistency of the backbone.

√
/
√
√
/
√
√
/
√
√
/
√
√
/
√
√
/
√
√
/
√
√
/
√
√
/
√
a √ indicates that the result corresponds to the biological expectation, a  indicate that up to one exception it matches the expectation, a × indicates that it does not match the expectation, and “.” means that the aspect is unimportant in the case-study. finally, “na” indicates that the method does not apply. each use case is assessed for its quantitative  and its qualitative  aspects. the comparison scheme is discussed in the material and methods and the table is derived from figures s1-s <dig>  overall, toponpa behaves as expected and is the only method fully matching the expectations.

in summary, these examples demonstrate that the network perturbation quantifications are able to capture dose and time dependent response, and that, from a qualitative prospective, the developed companion statistics of the method are able to differentiate perturbed from non-perturbed biological processes.

leading nodes provide a mechanistic understanding of the perturbation
to assess the ability of our approach to elucidate the driving biological mechanisms in a given network, we applied our methodology to a transcriptomics dataset reflecting the entry to s-phase of the cell cycle, which is a well described mechanism.

description of the data and networks
normal human bronchial epithelial  cells were treated with a cdk inhibitor , thereby arrested in g1-phase, and then allowed to re-enter the cell cycle by inhibitor washout. in this experiment, the re-entry to the cell cycle was confirmed by fluorescence activated cell sorting  analysis of the s-phase cells at  <dig>   <dig>   <dig>  and  <dig> hours after cdk-inhibitor washout  and showed a time-response in the increased activity. transcriptomics data were generated for all time-points with ) and without  inhibitor washout . we have used our methodology to analyze network perturbation of the cell cycle network model, which is a subnetwork of the previously published cell proliferation model  <cit>  which comprises  <dig> nodes and  <dig> edges .

comparison to other quantification/enrichment methods
toponpa scores for the appropriate fold-changes  are shown in figure 3e). as expected, the scores reflected a time-dependent increase in the activation of the cell cycle following inhibitor washout, matching the increasing pattern from the facs analysis ). the increase was significant for all companion statistics at every time points, indicating a specific perturbation of the network. in table  <dig> , we observed that considering the transcript layer as a gene set and using a forward fcs approach was not efficient. this is due to the fact that more than 8’ <dig> genes are underlying this network . besides toponpa, the backward fcs approach based on the “fc/maxmean” enrichment statistics matched the best the expectations. however, it failed to quantify a positive activation of the cell cycle after  <dig> hours. the cell cycle model contains many negative feedback loops, hence is not causally consistent, preventing the use of  <cit> .

leading nodes interpretation
while the cell cycle subnetwork encompasses all phases of the cell cycle, the leading node analysis  were used to identify the key mechanisms that are relevant for re-entry into s-phase. e2f and its binding partner tfdp- <dig> were the most important nodes in all post-washout time-points that we analyzed, and the activity of the e2f/tfdp <dig> complex is essential in regulating progression through the cell cycle  <cit> . in agreement with the literature, several factors known to favor g <dig> arrest were leading nodes and were predicted to have a decreased activity following washout. these included cdk inhibitors cdkn1a , cdkn1b , and cdkn2a   <cit>  and the retinoblastoma protein  that forms a complex with e2f, resulting in an inactive or actively repressive complex. upon phosphorylation by the cdks, rb is released from e2f, allowing it to drive entry into s-phase  <cit> .

in summary, the toponpa could identify and quantify the activation of the cell cycle network upon inhibitor washout, and capture the essential molecular mechanisms involved in the g <dig> to s transition.

toponpa-based diagnostic signatures provide interpretable and robust predictions
to demonstrate how toponpa can be employed to derive robust network signatures, we predicted the smoking status of individuals based on the xenobiotic metabolism network using transcriptomics data from bronchial brushing. as mentioned above, the activation of the xenobiotic metabolizing machinery is the main immediate cellular response to combat environmental stressors. in respiratory tissue, the activation of this cellular defense system is highly sensitive and strictly controlled at the transcriptional level by the regulation of the aryl hydrocarbon receptor  activity. therefore, the activation of this cellular defense system may be a suitable marker to capture the actual exposure of the target tissue to environmental stressors such as cigarette smoke. the first data set  was derived from bronchial brushing of “current smokers”, “former smokers” and “never smokers” samples, as described by beane et al. the second data set  was generated from small airway epithelium samples obtained by bronchoscopy from smokers and non-smokers.

quantification of the xenobiotic network response
the first step was to compute the toponpa scores for the transcriptomics changes between current smoker and never smokers to confirm the activation of the xenobiotic metabolism machinery. for gse <dig>  we also compared former smokers with never smokers. the obtained scores were clearly elevated for the current smokers in both data sets , while the absolute scores of the two data sets were unequal. such differences may be due to short or long term smoking histories or the distinct cell types which compose the two samples   <cit> . the former smokers comprised in the gse <dig> data set exhibited a toponpa score similar to never smokers probably because the xenobiotic metabolism is no longer activated in former smokers as can be easily seen in the changes in gene expression  <cit> .

interpretation based on the leading nodes
the second step in our process was to identify the leading xenobiotic metabolism network nodes congruent with the two data sets.

despite the difference in absolute toponpa score, the leading node lists derived from the two datasets were very similar , taof  being the most highly ranked leading node. leading nodes such as diesel exhaust particles, polycyclic aromatic hydrocarbons  , and particulate matter represent stimuli that initiate signaling cascades similar to those known to be triggered by cigarette smoke. these include the catalytic activity  of the p <dig> family enzymes , catof, catof)  <cit>  leading to the production of reactive oxygen species   <cit>  as well as taof  <cit> , all highlighted as leading nodes. finally, cyp2e <dig> activity  “oxidase-like activity of cyp2e1”), also known to be activated by cigarette smoking  <cit> , is a leading node. by definition of the leading nodes, each of these entities are the processes in the backbone that are both highly perturbed and central in the network and altogether explain the network perturbation.

the nodes also extracted by nearest shrunken centroids are shown in bold.

network-based signature extraction and comparison to other methods
we next transformed the individual gene expression data into network differential backbone values. extracting the xenobiotic-relevant biology with the network backbone enables a supervised mechanism-based separation of the smoker and never-smokers groups. the comparisons were performed as described in the method section and were reported in table  <dig>  the best performance was obtained by training nearest shrunken centroids   <cit>  algorithm on the obtained backbone values, by selecting the shrinking parameter by cross-validation within each cross-validation steps. the resulting models led to very good cross-validation specificity  and sensitivity  for both datasets. importantly, classifying one study based on the other led to very robust results  . the best single ube classifier was based on the genes underlying 8-methyl-iqx, which was also a leading nodes .

d

1
→
d

2
d

2
→
d

1
the predictions of the samples from the dataset dj based on the model trained on the dataset di are reported in the columns di→dj. while not systematically having the best cross-validation performance, the predictors based on the backbone values show are more robust behavior when predicting one dataset based on the model trained on the other one. the mean of the g-performances  over the two independent test sets are shown in the rightmost column and is highlighted if > <dig> . the best ube-based models is chosen based on the mean cross-validation g-performance for the two datasets. the algorithms based on the backbone values leads systematically to good performances. the cross-validation standard errors are reported in additional file 1: table s <dig> 

while the cross-validation performances were roughly similar, methods based on the backbone values led systematically to higher accuracies on independent datasets .

this showed the ability of network signatures to efficiently handle inter-study bias which is known to greatly affect gene-based signature predictions. to illustrate the effect of the transformation to backbone values, principal component analysis  was carried out on a) the full set of genes, b) the set of genes underlying the network and c) the backbone values of each individual in the study. as can be seen from additional file 1: figure s <dig>  the effect of the smoking phenotype was not the dominant source of variation for the two first cases , and the direction of separation of the smoking group averages were strongly disagreeing. in contrast, the phenotype aligned with the first principal component  in the last case . this indicated that the transformation of the gene expression profiles into differential backbone values matched the smoking phenotype with the biology encoded in the xenobiotic metabolism network and potentially reduced the inter-study bias. finally, additional file 1: figure s6b shows that this property was not inherent in the gene set defined by the transcript layer.

the backbone nodes used by nearest shrunken centroids  are all leading nodes , with a single exception, “indirubin”. this shows a striking coherence between the important nodes in the network signature and the mechanistic explanation of the toponpa score based on leading nodes.

in summary, toponpa ability to establish a quantitative marker for cigarette smoke exposure was verified by applying the method to datasets from different studies. it enabled the derivation of a robust network signature for smoking exposure in the lung, and provided a robust mechanistic explanation, which showed the coherence of the toponpa framework. moreover, the method could extract the meaningful biology from a transcriptomics data set and classify study participants accordingly by reducing the importance of the sources of variations irrelevant to the biology.

toponpa identifies abnormal tlr signaling as a plausible explanation for poor response to anti-tnf α drug in the treatment ulcerative colitis
next we applied toponpa to derive a plausible mechanistic explanation of the unequal efficacy of an anti-inflammatory drug in patients suffering from ulcerative colitis and to generate an accurate and robust network signature for predicting individual patient responses to the treatment.

inflammatory bowel disease
inflammatory bowel disease  is regarded as a disturbance of immune homeostasis in the mammalian intestine  <cit> . as evidenced by a number of studies, tnf α plays a major role in ibd pathology, and tnf-blocking agents have proven an effective therapy to both ulcerative colitis  and crohn’s disease   <cit> . however, the treatment outcome is highly variable; a monoclonal antibody against tnf, infliximab , induces remission in only one third of patients with moderate to severe uc  <cit> . to avoid unnecessary adverse drug effects and needlessly high treatment costs, it is imperative to develop reliable biomarkers to predict treatment outcome  <cit> . gene signatures have emerged as powerful tools to predict treatment response  <cit> . these include a five-gene signature that could predict ifx response with high accuracy in one cohort, while lacking cross-cohort robustness  <cit> . the predictive genes were classified as being involved in the adaptive immune response, yet the biological pathways that mediate the resistance to therapy were not identified. to shed more light on the mechanistic reasons behind these ifx responses, we used the canonical tnf-il <dig> α-tlr-nf κb network model of nf κb signaling to capture the network response to measured gene expression levels. in addition to tnf signaling, the involvement of both the il- <dig> and tlr pathways are well established in ibd pathology  <cit> ; in the colonic mucosa, tnf, il1a, and toll-like receptor signaling all activate nf κb leading to further expression of inflammatory mediator genes  <cit> . by applying the toponpa approach to publicly available uc transcriptomics datasets, we set out to predict the treatment response in two distinct patient cohorts and investigate the biological pathways involved in the treatment outcome.

quantification of network perturbations
we evaluated the transcriptomics profiles of colon samples  from two cohorts of patients prior to receiving their first treatment with ifx for refractory ulcerative colitis  <cit> . each patient signature was compared with the average non-responder signature, and the network perturbation of the tnf-il <dig> α-tlr-nf κb model was used as the input, to find a mechanistic signature differentiating responders from non-responders. the scores for the perturbation of the tnf-il <dig> α-tlr-nf κb network in ifx responders and non-responders . we also used another dataset containing gene expression profiles of patient colonic biopsies collected pre- and post-treatment . overall, the non-responder network perturbation was already higher than the responder one. this suggests that the quantitative measure of network perturbation might be indicative of the susceptibility to the treatment.

interpretation based on the leading nodes
the initial investigation of the leading nodes that defined the difference between responder and non-responder patients prior to ifx treatment  highlighted the involvement of classical tnfr1- mediated signaling  <cit> . these nodes were important when comparing all uc patients with healthy controls and responders to non-responders. this is in accordance with previous reports that have demonstrated that tnf α gene expression in colorectal mucosa and high serum tnf levels can be used as a predictor for ifx therapy in ulcerative colitis and crohn’s disease, respectively  <cit> . interestingly, myd88-mediated pathways were also predicted to be important when comparing the pretreatment data from responders and non-responders.

using the dataset containing pre- and post-treatment effects, we observed that, while myd <dig> and tlr  remain important nodes to distinguish the non-responders from the responders even after treatment, il1r <dig> signaling was predicted to be similar in both subject groups . therefore, the underlying biological mechanisms that define the treatment response in uc patients were possibly related to abnormal tlr signaling and did not involve directly il1r <dig> 

extracting a network-based signature
standard gene expression-based approaches to predicting the response to ifx from such samples rely on finding gene signatures  informing the clinicians of the possible response to the treatment. arijs et al. reported a small gene signature using gene filtering and nearest shrunken centroids that suffers from a lack of robustness when using the gene signature derived from one cohort to predict the response of a second cohort of patients  <cit>  . the individual patient backbone values of the tnf-il <dig> α-tlr-nf κb model were used as the input for deriving a signature differentiating responders from non-responders.

a
→
b
b
→
a
the predictions of the samples from the cohort a  based on the model trained on the cohorts b  are reported in the columns a→b . the mean of the g-performances  over the two independent test sets are shown in the rightmost column and is highlighted if > <dig> . the best ube-based models is chosen based on the mean cross-validation g-performance for the two datasets. the algorithms based on the backbone values leads to good performances for a majority of algorithms. the cross-validation standard errors are reported in additional file 1: table s <dig> 

comparisons were performed following the scheme described in the method section above were reported in table  <dig>  nsc combined with the genes underlying a single ube and nsc based on the backbone values as the features for learning led to the best prediction performances across cohorts . as in the previous example, performance results showed a more robust behavior of network-based features as compared to gene selection, for the majority of the learning algorithms used. again, this is in line with the results of the improver diagnostic gene signature challenge  <cit> , where it is argued that features selection or construction are more important that the base learning algorithm chosen. the best predictions based on a single ube were obtained using the downstream genes of catof , which is one of the leading nodes  and is involved in the tlr-signaling.

as observed in the previous use-case, the inter-study robustness might be explained by the alignment of the responsiveness status with the first principal component  of the individual backbone values; as opposed to the behavior of the principal components based on the gene expression data .

discussion
we have presented several biological and clinical applications of toponpa, a novel quantitative approach that uses knowledge-based cause-and-effect biological network models describing complex processes involving thousands of genes. as an input toponpa requires high-throughput transcriptomics data obtained from appropriately designed and executed studies, and a network model relevant to the observed biological response. our method provides a coherent mechanism-based framework for assessing and quantifying the resulting perturbations of the network as required in a dose-response toxicity setting. it also guides mechanistic interpretation at node-level resolution in a fully coherent way with the perturbation itself. the relevance of the mechanistic interpretation of the network perturbation has been demonstrated in two controlled in vitro studies , and applied to two in vivo studies. in addition to the quantification of the perturbation and its interpretation, our framework enables the establishment of coherent, efficient and robust diagnostic classifiers based on individual sample network perturbations. we have shown how to use the established biology of xenobiotic metabolism to stratify a human cohort of smokers and non-smokers. the full potential of this powerful approach for deriving mechanism-based interpretation and diagnosis has been further demonstrated in the context of an in-vivo study of ulcerative colitis patients, where a testable hypothesis has been proposed regarding the individual response to the drug infliximab .

network perturbation amplitude methodology
overall, the toponpa approach belongs to the class of backward pt methods , and is threshold-free because it does not require any filtering of the gene expression data based on expression value or statistical significance. in our method, the absence of any fold-change between conditions can be as informative as high fold-changes. it provides a single framework for quantitative and qualitative evaluation of the amplitude of perturbation of a network.

it applies to two-layer cause-and-effect models without any assumption beyond the underlying undirected graph to be strongly connected. in contrast to the approach in  <cit> , the quantification of network perturbations as a positive-definite quantity  allows for causal inconsistency, does not require the choice of a reference node, uses fully the topology of the network and avoids canceling out “destructive interference” in cumulative signed amplitudes . our choice was to consider an “energy” analogue quantity  rather that a signed value as used by martin et al. as a particular case, if the functional layer was made of a single node , then the backbone differential value of that node would equal the npa score in  <cit> .

toponpa enables the quantification of the network response to a treatment, which is a key feature in systems toxicology. attempts to adapt existing gene set-based methods cannot exploit fully the two-layer network structure as either the quantification or the qualitative assessment of the perturbations computed in the different studies did not match the biological expectations .

our framework offers the possibility to identify key contributors of the perturbation in the network using the leading nodes , which have been shown to be pertinent in the positive control experiment . this aspect is not covered in our previous methodology  <cit>  as the network was aggregated in a single ube structure and subsequently scored. an even deeper investigation is possible by defining a similar notion of leading genes for any  node in the network. however, we believe that the gene expression is the consequence and not the driver for the biological processes of the network, and therefore this was not be systematically looked at. furthermore, the modern view of network biology implies that the essence of biological processes does not lie in the individual behavior of genes, but rather in their collective action, which is precisely captured by the biological network models  <cit> .

network-based signatures: constructing vs. extracting features
we have shown in two cases that our approach has led to accurate and, importantly, robust classification of individual samples. even if our goal was not to develop a purely machine-learning algorithm, it clearly appeared that an appropriate choice of the network model led to remarkable performances in classification tasks that is over-performing other approaches and the results published by the authors of the original studies. toponpa enabled to build network features that leads to more robust classification results, almost independently of the learning methodology used. the key aspect for this behavior is that gene expression profiles are used to construct  new features in a surjective way by a data independent linear mapping . as the dimension of the backbone is far lower than the dimension of the underlying gene space, it is expected that our network signatures will be robust. additionally if the phenotype of interest is associated with the biology encoded in the functional layer of the network, the class separation is expected to align with the main variation of the differential backbone values. this behavior is apparent in the pcas constructed on the backbone values: the inter-class variability is aligning with the main direction of variation. additionally, the transformation seems to reduce the inter-study bias. another benefit of this linear transformation is to move away from the so-called “ p>>n problem”, where there are far more variables than samples in a dataset and hence lead to more robust diagnoses. gene-sets or network have also been leveraged in classification problems based on gene-expression data  <cit> . however the enrichment of a given gene-set and its ability to provide discriminant score rely usually on independent algorithms. also, this aspect is not covered in our previous methodology  <cit> .

this application revealed a promising potential for our approach in the context of personalized medicine: personalized diagnosis based on the classifier to decide the administration of the infliximab treatment. also, the smoking network signature derived could serve as an individual marker of smoking exposure in a clinical trial.

network-based biological explanation and hypothesis generation
the analysis of uc patient data from responder and non-responder subjects prompted the generation of a network-level hypothesis. based on our analysis, tnfr1a-signaling seems to be an important node in defining the difference between the responders and non-responders before and after anti-tnf treatment. this suggests that the treatment fails to fully restore normal tnf signaling in the colonic mucosa of non-responders. however, a recent study has shown that tnf-expression returned to normal at week  <dig> in both ifx responders and non-responders  <cit> . therefore, the stimulated tnf signaling is not the only explanation for poor treatment outcome in non-responders. our results indicate that the underlying biological mechanisms that define the treatment response to tnf blocking agents in uc patients might be related to abnormal myd88-signaling. myd <dig> has been found to be involved in ibd pathology  <cit>  and the involvement of myd <dig> in response to tnf-blocking drugs has been demonstrated in studies on rheumatoid arthritis  patients  <cit> . our analyses further showed that myd <dig> and tlr  remained important nodes to distinguish the non-responders from the responders even after treatment. a recent study by toedter et al. showed that the genes involved in intestinal epithelial barrier defense were differentially expressed in the responder and non-responder colonic mucosa following infliximab therapy  <cit> . members of the tlr family are involved in the injury of the intestinal epithelial barrier, and their abnormal function could lead to defects in mucosal barrier defense in the non-responder population  <cit> . the identification of a high frequency of peripheral t-regulatory cells as a predictive marker for infliximab treatment response provides additional support for the involvement of abnormal tlr signaling  <cit> . triptolide, an active component isolated from the chinese herb tripterygium wilfordii with anti-inflammatory and immunosuppressive properties, has been proposed as an alternative compound for the treatment of cd. interestingly, the favorable effect was shown to be mediated by targeted inhibition of tlr2/tlr <dig> signaling in the il10-/- cd mouse model, and in cultured colon tissue samples from cd patients  <cit> . finally, gewirtz et al., discovered that patients from a specific ethnic background with deficient tlr <dig> were protected from developing cd, advocating the pharmacological inhibition of the tlrs as an alternative to anti-tnf compounds to treat ibd  <cit> . such an approach has already been applied for the treatment of ra, where tlr2/tlr <dig> antagonists have proven beneficial in treating an autoimmune disorder  <cit> .

on-going research in our group is currently using several network models in conjunction first, to develop methods of assessing the biological impact of individual substances, or a set of substances on a biological system, as we have discussed in  <cit>  and second to improve the performance of the backbone-based classifiers.

CONCLUSIONS
the methodology proposed in this study provides a coherent framework going beyond the work of  <cit>   to handle the two-layered structure of cause-and-effect networks . firstly, it quantifies network perturbations using differential gene expression in conjunction with the explicit network topology and tests a non-perturbation null hypothesis ; hence it positions itself as a backward-based pt methodology . secondly, our methodology calculates the perturbation of the network by inferring differential values for each node of the functional layer of the network model, referred to as differential backbone values. those quantities facilitate the biological interpretation by decomposing the amplitude of the perturbation and thereby identifying candidate key nodes of the functional layer. thirdly, it further enables the calculation of these differential backbone values at sample level, which serves to build a knowledge-driven classification of individual patients. such classifying signatures, which benefit from the mechanistic interpretation of the differential backbone values, can be used to classify individual patient samples. to the best of our knowledge this is the first approach that provides, in a systematic manner, the ability to fully exploit the information provided in two-layer causal models , that serves simultaneously for quantitative perturbation assessment, biological interpretation and diagnostic signature extraction. here we show that using our biological network models to quantify individual patient responses through a network model relevant to the phenotype of interest is a biologically meaningful, interpretable, robust and effective way of deriving network-based signatures.

as a summary, a novel network-based methodology for quantifying perturbation, interpreting data and for deriving network signature was presented. it fully exploits the specific structure of two-layer cause-and-effect network models, made of a functional layer and a transcript layer. the application of our methodology has provided insight into molecular mechanisms by capturing the perturbed network components with high specificity, and has led to robust signatures for diagnosis. the successful application of our quantitative method has clearly demonstrated the potential of toponpa in systems biology and systems toxicology.

endnote
al2=f:a→ℝ|∑a∈af2<∞ which, for a finite set a, is isomorphic to ℝn, where n is the cardinality of a.

competing interests
the authors declare that they have no competing interests.

authors’ contributions
fm developed and implemented the methodology. as and yx contributed to the methodology development. mt did the biological interpretation of the results. jh and mcp supported the project. all the authors contributed to the writing of the manuscript. all authors read and approved the final manuscript.

supplementary material
additional file 1
supplementary information on network models and data. all supplementary figures and tables are included in this additional file.

click here for file

 additional file 2
two-layer causal network models used in this manuscript, in excel format.

click here for file

 acknowledgments
the authors would like to acknowledge hector de leon and nikolai v. ivanov for reviewing the manuscript and for their useful comments, walter schlage for his priceless biological insights for building the network models and selventa collaborators for the fruitful discussions over many years around the network models. the research described in this paper was supported by philip morris international.
