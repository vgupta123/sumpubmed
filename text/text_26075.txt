BACKGROUND
metatranscriptomics, the large-scale sequencing of mrnas from complex microbial communities, allows for the observation of gene expression patterns . metatranscriptomics is a relatively new field, with the first mention around  <dig>  <cit> , but it is growing quickly. using high-throughput techniques developed in conjunction with “big data” computer-automated analysis approaches, metatranscriptomics offers a novel and complete method for looking at not just the organisms present, but also the transcriptional activity occurring within a complex and diverse population at any chosen specific point in time  <cit> . metatranscriptomics is especially useful for analyzing complex populations in flux, such as the gut microbiome, which can be impacted and altered by a large number of transitory factors .

however, because of the complexity of metatranscriptomic data, extensive analysis is needed to convert raw data into simplified and easily understood results. the raw data comprise tens of millions of individual reads per sample  <cit> . simplifying and condensing this very large data set requires multiple steps in a software pipeline and generally requires a dedicated bioinformatician to perform the analysis. current pipelines or in-house methods often require significant computing power or use several different tools, many of which were not originally intended for metatranscriptome analysis  <cit> . for researchers who want to utilize metatranscriptomic analysis but may not have the necessary bioinformatics experience, there is a strong need for a complete pipeline, designed to analyze this data from beginning to end without requiring extensive technical expertise.

in addition, as metatranscriptomics is a new area of genomic exploration, there are few established guidelines or standard protocols. standardized protocols exist for mrna collection  <cit>  and for stool-specific extraction  <cit> , but there is also a pressing need for an investigation of necessary sequencing parameters and depth, minimum read quality standards, and reliable reference databases against which metatranscriptome reads can be aligned. any researcher planing to sequence metatranscriptomic data must know the target sequencing depth and minimum recommended read length, whether to filter out ribosomal sequences, and the relative confidence of their predicted results based on these parameters.

in this paper, to develop a standard metatranscriptomic analysis pipeline that can be applied to a wide range of microbiome samples, we extracted and sequenced rna from human fecal material using experimentally validated protocols  <cit> . by testing various parameters and modifications, we determined the best practices at each step in obtaining and analyzing the metatranscriptomic data. in addition, we incorporated a publicly available metatranscriptomic data set examining the fecal gut microbiome in tyrosine kinase two knockout  mice compared to wild-type controls over time during the outbreak of dextran sodium sulfate  induced colitis  <cit> . examining this data, we provide new insights into differences in functional expression between the two different microbiomes over the course of the colitis development. by applying the approaches detailed here, researchers wishing to include metatranscriptomic analysis in their experiments can obtain accurate results without an investment in the development of bioinformatics tools.

RESULTS
creation of samsa, a new pipeline for metatranscriptome analysis
we created the samsa  pipeline, designed to fully analyze and characterize bacterial transcription within a metatranscriptome, illustrating relative level of transcriptional activity split by both organism and functional category. there are four phases to the pipeline: the preprocessing phase trims and combines reads for input to the annotation phase, the annotation phase provides an annotation for each read, the aggregation phase aggregates organsim and function information across all reads, and the analysis phase provides visualizations and statistical analysis .fig.  <dig> the samsa pipeline. this organizational chart shows the flow of data through the pipeline, beginning with raw reads at the top of the chart and ending with the graphical output of the results at the bottom. note that blue boxes denote intermediate generated output files, red boxes denote python scripts, orange boxes denote r scripts, and green boxes denote external reference databases



preprocessing phase
during preprocessing, raw sequences are trimmed to remove reads containing low-quality bases and eliminate adaptor contamination using trimmomatic, a flexible read trimming tool for illumina ngs data  <cit> . next, each pair of paired-end reads are aligned to each other using flash, a short read aligning program  <cit> . in our pilot samples, approximately 32–54 % of the raw reads in each sample were successfully aligned, with an average aligned read length of  <dig> base pairs.

annotation phase
next, these sequences are submitted for annotation to metagenomic rapid annotations using subsystems technology   <cit> . mg-rast includes several steps, including an initial sequence quality control check through solexaqa, gene calling through fraggenescan, clustering of amino acid sequences at 90 % identity through the uclust implementation of qiime, and then using sblat on each protein sequence cluster to locate the best match reference. for each sequence cluster, mg-rast selects the best match through the sblat similarity search. if multiple reference database matches tie for best matching score, they are both included in the final results. if the read does not achieve a match score above the minimum e-value cutoff, it is discarded. each match is linked to mg-rast’s internal identifier system and assigned an m5nr id, correlating with linked matches in all subsystems databases. the annotated output can be provided on a per-match basis, using the m5nr id to link each read to its best match from the subsystems database of choice. to create sorted abundance measures of the metatranscriptome using the samsa pipeline, all annotations with an acceptable best-match to the ncbi reference database   <cit>  are downloaded from mg-rast. annotations are downloaded for the best match to both organism and individual transcript. annotations are downloaded directly in tab-delimited form using mg-rast’s restful api interface  <cit>  and a custom python program to assemble the api call command. in addition, the annotated output is also downloaded from the seed subsystems reference database  <cit>  to provide ontology annotations.

aggregation phase
a custom python program parses each annotated output, storing each unique annotation match in a dictionary and maintaining counts of the number of occurrences of each unique annotation. after the annotation file is processed, unique annotations are sorted by abundance and exported as output.

analysis phase
annotation and abundance information from the aggregation phase are inputs to custom r scripts, which generate barplots and dendograms . to compare experimental versus control metatranscriptomes and determine significantly differentially expressed transcripts, r’s deseq <dig> package is used to test the output files for differential expression  <cit> . deseq2’s testing method adjusts for multiple hypothesis testing, performing pairwise comparisons in the scope of a larger overall data set. the pipeline’s r scripts export sorted lists of log2fold change in both organism and functional category activity, sorted by adjusted p-value. results are also stored in the local r environment and can be used for graphical output.

this complete pipeline, coded in python and r, is fully open source, is set up for streamlined use from the command line, does not require a local server for intense computation, and is freely available for download through github.

measurement of host transcripts in fecal metatranscriptomes
given that metatranscriptomes theoretically contain the transcriptional profile of all organisms present, we asked whether the transcriptomes of host cells could still be elucidated from fecal metatranscriptomes for which the primary goal was bacterial metatranscriptome analysis. we tried two methods of rna extraction followed by either ribosomal depletion or poly enrichment . neither method yielded many reads aligning to the human genome. we found  <dig> and  <dig> ribodepleted reads  matching the human genome, and  <dig> and  <dig> poly enriched reads  enriched reads) matching the human genome. thus, we conclude that host transcriptomes cannot be reliably extracted from stool metatranscriptomes that have been isolated and sequenced using standard methods.

use of ribosomal depletion methods in metatranscriptome preparation
transcriptomic and metatranscriptomic extractions are often treated with ribodepletion methods before sequencing for the removal of ribosomal reads, increasing the relative mrna yield  <cit> . comparing ribodepleted and non-depleted rna, we found that the ribo-zero gold ribodepletion kit from illumina showed an overall 63–82 % reduction in ribosomal reads present within our sample, but certain microbial ribosomes did not show any reduction, including members of the actinobacteria, cyanobacteria, and spirochaetes phyla . ribodepletion appears effective at depleting rrna reads within a sample, but also preferentially removes ribosomes from certain bacterial phyla over others, skewing ribosomal output within the metatranscriptome’s sequencing results.fig.  <dig> level of depletion in ribodepleted vs. control metatranscriptomes. identical pilot metatranscriptome samples were sequenced; protocol  <dig> included a ribodepletion step, while protocol  <dig> did not include this step. as is demonstrated, not all species were equally depleted, skewing the perceived abundances of different organisms within the metatranscriptome. normalized data shows the combined average depletion percentage for each phylum of bacteria present within the sample

two pilot metatranscriptomes were sequenced twice; the p <dig> protocol involved a ribodepletion step, while the p <dig> protocol did not. comparisons of the organism annotations reveal that ribodepletion led to a decrease in 16s rrna reads for most, but not all, bacterial phyla



optimal sequencing depth for gut microbiome metatranscriptomics
an important consideration when creating a metatranscriptome is sequencing depth: how many reads must be obtained in order to provide proper representation of all reads within a sample? as the proportionality of different reads within the sample is of crucial importance, sequencing depth must be large enough to ensure a balanced representation of each read’s relative abundance within the total sample. too little depth can result in inaccurate abundance and activity measurements.

to evaluate necessary sequencing depth using a bioinformatics based approach, we generated  <dig> randomly selected subsets of a large and comparatively over-sequenced metatranscriptome of  <dig>  million annotated reads , creating ten smaller stand-alone simulated metatranscriptomes for each size point measured, moving in ten percent increments from  <dig> million up to  <dig> annotated million reads per subset. within each simulated metatranscriptome, the relative percentage of various reads was measured, and these results were compared by simulated metatranscriptome size. this approach was performed looking at both high , medium , and low  abundance reads within the parent metatranscriptome . by comparing relative abundance in each subset metatranscriptome to the final full data, we quantified the accuracy of the abundance measurements. we defined accuracy as percentage deviation from final, stable abundance counts. this data shows that, for the human gut metatranscriptomes examined, a minimum a minimum of  <dig> and  <dig> million read annotations are needed to achieve above 90 % accuracy in low abundance reads. this is equivalent to about 40– <dig> million raw sequence reads. note that abundance estimates for medium and high abundance reads can be reasonably accurate with fewer annotations .fig.  <dig> effects of metatranscriptome size on read abundance variation. as the number of annotations in a metatranscriptome increases along the x axis, accuracy of abundance measurements increases for all reads. red denotes the top  <dig> most abundant transcripts within the sampled metatranscriptome , while blue denotes transcripts of medium abundance  and green denotes low-abundance transcripts . approximately 10– <dig> million annotations are needed before abundance accuracy for all transcripts tops 90 %. abundance accuracy was measured out to  <dig> million annotations, but the accuracy was 100 % in all categories beyond  <dig> million 



paired or single end sequencing for metatranscriptome analysis
another important consideration when sequencing a metatranscriptome is whether paired-end sequencing is necessary for proper read annotation. paired-end sequencing is more expensive on a per-read basis but the average output read length is significantly increased, allowing for a more accurate best-match annotation in the pipeline.

statistical comparisons of the relative organism activity results and the relative transcript abundance between single and paired end read versions of the same original metatranscriptome file show significant differences in both organism-of-origin and transcript identification by the annotation pipeline. in identical metatranscriptomes containing either paired-end or single end reads, the paired-end reads resulted in fewer reads removed due to quality controls , and a greater percentage of all reads matching at least one alignment in the reference database  .table  <dig> read count comparison between single and paired end files

two pilot paired-end metatranscriptomes were analyzed both in paired configuration, and using only the forward reads . despite higher numbers of total reads, the single-end data matched to fewer total and unique annotations in both cases



the paired-end sequencing data matched to a higher number of unique transcripts than the single read data , suggesting that increased read length leads to greater specificity in transcript annotation. correlations between paired-end and single-read processed identical metatranscriptomes averaged only  <dig>  between both pilot samples. given that these paired-end and single read metatranscriptomes were originally identical before the trimming of excess bases beyond  <dig> bases per read, these results indicate significant mislabeling or lost information in the single read approach when compared to the more accurate paired-end sample.

taken with the organism matching results, these numbers suggest that the increased read length generated either through paired-end sequencing or through 150-bp single-end sequencing is necessary to ensure accurate metatranscriptome annotation.

determining organisms present within fecal metatranscriptomes
using publicly available metatranscriptomes that were not depleted of ribosomal rnas  <cit> , we compared estimates of organism abundance using either mrna or rrna transcripts, using matches in ncbi’s refseq database for mrna and matches in the silva small subunit  database for rrna. we found a consistent correlation between abundance estimates from mrna vs. rrna  across all samples, suggesting that mrna abundance estimates may be able to provide useful representative population data within a sample. with filtering to remove non-bacterial annotations, we observed an average pearson correlation of  <dig>  at the order level,  <dig>  at the family level, and  <dig>  at the genus level of identification across all  <dig> samples.fig.  <dig> comparison of mrna vs. rrna based abundance estimates. a stacked bar graph measuring percentage distribution of total metatranscriptome activity by organism, with pairwise comparisons between mrna and rrna transcripts. to reduce potential mislabeling of organisms in the “long tail” of low-abundance organisms, only the top  <dig> most abundant organisms are displayed; other results are included in the purple “other” catchall category. b the same measurement, expressed in total number of annotations per metatranscriptome sample. due to a lack of ribodepletion, rrna transcripts dominate all samples



applying this pipeline to a public metatranscriptomic data set: organism and functional analysis
publicly available metatranscriptomic data  <cit>  was analyzed using the samsa pipeline described above . output tables generated by the pipeline are imported into r, where a stacked bar graph allows for comparing of relative activity levels both by organism  and by functional category . due to the large number of both organism and functional categories, the r analysis scripts generate graphs which show only the top  <dig> most abundant organisms and/or functional categories, with remaining categories grouped under an “other” catch-all category  or removed from display .fig.  <dig> organism output of  <dig> metatranscriptomes. a stacked bar graph measuring percentage distribution of total metatranscriptome activity by organism, comparing  <dig> wild-type to  <dig> tyrosine kinase  <dig> knockout gut microbiomes. to reduce potential mislabeling of organisms in the “long tail” of low-abundance organisms, only the top  <dig> most abundant organisms are displayed; other results are included in the purple “other” catchall category. b the same measurement, expressed in total number of annotations per metatranscriptome sample

fig.  <dig> transcript functional category output of  <dig> metatranscriptomes. a stacked bar graph measuring percentage distribution of total metatranscriptome activity by functional category, comparing  <dig> wild-type to  <dig> tyrosine kinase  <dig> knockout mouse gut microbiomes. to reduce graph complexity, only the top  <dig> most abundant functions in each sample are displayed. two samples were excluded due to very low total read counts. b the same measurements, expressed in total number of annotations per metatranscriptome



in the original paper  <cit> , which focused primarily on the response of mouse gut epithelial cells to dextran sodium sulfate  induced colitis, the authors used primarily only the rrna sequences from 16s amplicon sequencing of the samples to examine shifts in mouse gut microbiomes. they did report an increase in mrna matching enterobacteriaceae species in tyrosine kinase  <dig>  deficient mice, rising on day  <dig> of treatment, but provided no other mrna analysis of these samples.

examining the results of our pipeline, we observed a  <dig> -fold increase in enterobacteriaceae mrna expression in day  <dig> samples . indeed, looking across all bacterial species with greater than  <dig> average expressed transcripts, we found significant increases in transcriptional activity in escherichia and providencia species, both of which are associated with ulcerative colitis  <cit> . in addition, we noted a significant decrease in butyrivibrio species , when comparing between wild-type and tyk2-deficient mice over the course of dss-induced colitis. butyrivibrio is a probiotic-associated strain that may normally offer protection against colitis  <cit> . we also observed several significant changes in functional activity between the two groups, identifying more than  <dig> protein-coding transcripts differentially expressed between wild-type and tyk2-deficient mice .

discussion
although still an emerging field, metatranscriptomics offers a powerful approach for analyzing complex functional activity within a heterogeneous microbial population, such as that found within the gut microbiome. previous approaches for the study of the gut microbiome provide an incomplete picture, limited to only identifying variations in organism population levels and not including data on the gene expression of different species within the environment.

our pipeline fulfills the need for four main steps in metatranscriptomic data analysis: preprocessing, annotation, aggregation, and analysis. by leveraging mg-rast’s annotation server, we can provide comprehensive annotation and analysis of a metatranscriptome without requiring a dedicated private server. samsa generates outputs at each step, creating a streamlined pipeline where each stage in data analysis can be independently examined.

using the samsa pipeline, we have established a set of “best practices” for metatranscriptome sequencing. our work demonstrates that the increased specificity provided by a paired-end sequencing approach significantly increases specificity of read annotations. in addition, to provide a complete and accurate measure of read abundance within a metatranscriptome, approximately  <dig> million raw reads must be sequenced, providing an estimated  <dig> million mrna annotations.

due to the vast majority of extracted total rna originating from ribosomes, ribodepletion is strongly recommended for all metatranscriptome sample processing. we demonstrate that although ribodepletion is not successful at removing all rrna, and skews the proportions of remaining rrna within a sample, it greatly increases the number of mrna annotations obtained per metatranscriptome. although we only tested one commercially available ribodepletion kit, we believe that all ribodepletion methods based on hybridization with complementary rrna oligonucleotide probes will carry some intrinsic bias, skewing the proportions of remaining rrna within the sample. therefore, we recommend discarding all remaining ribosomal reads before performing further analysis on these samples.

although ribodepletion results in a loss of information regarding organism abundance within a metatranscriptomic sample, we show that total mrna can be used as an alternate method of evaluating overall organism presence within a sample. compared to mrna results, we found a higher number of false annotations among the rrna reads, particularly for eukaryotic organisms which were not present in the original fecal samples, including plant species such as sisymbrium , arabidopsis, and populus , bos taurus, human, and coptotermes . this increased mismatch rate may be due to the fact that mg-rast is not tailored to work with eukaryotic organisms. another reason that mrna and rrna results were not perfectly correlated is that there were insufficient mrna reads in the data set used for direct comparison. our data  suggested that a minimum of  <dig> million annotated reads are required for accurate annotations, while the non-ribosomal depleted data set averaged only 1– <dig> million annotated mrna reads per sample. while total mrna may not be a perfect proxy of organism population size, the extent of mismatches in the rrna data suggest that mrna is at least better than total rrna for judging overall activity-based abundance.

analyzing a public data set, we confirmed the rrna patterns previously described by the producers of that data  <cit> , and also identified significant changes in other, more specific genera of microbial species, including increases in escherichia and providencia and decreases in butyrivibrio. both the increase in escherichia and providencia and the decrease in butyrivibrio species were only notable at the genus level and would not be identifiable in 16s data, demonstrating the value of mrna-based metatranscriptomics analysis. in addition, we successfully identified a variety of functional expressed activities of gut microbes that significantly differed between wild-type and tyk2−/− strains of mice strains.

as the field of metatranscriptomics continues to grow and expand, we expect that metatranscriptome analysis will become increasingly important to understand the functional responses of gut microbiome communities. by using mrna transcripts to identify both the overall transcriptional activity levels of organisms within a sample and changes in specific gene or functional expression, we can gain a better understanding of the capabilities and actions within an active gut microbiome at any chosen point in time. because all parts of samsa are open source and publicly accessible, this tool can be used even by researchers with little previous experience in working with metatranscriptomes. we hope to encourage the more widespread use of metatranscriptomics as the next “big data” tool for determining activity within complex microbiome populations.

although the samsa pipeline successfully annotated and summarized gut microbiome metatranscriptome data without the need for large server resources, several limitations still exist. mg-rast’s annotation servers require waiting in a queue, and processing may be slowed by days to weeks. additionally, although samsa can reveal shifts in functional expression patterns, shifts in microbial population sizes cannot be measured as accurately as using shotgun metagenomics, and future approaches may focus on incorporating both techniques to ensure completeness.

future versions of this pipeline will focus on a more rapid in-house annotation step, using custom built reference databases and allowing for greater speed and additional analysis options, drawing from multiple reference databases as data progresses through the pipeline.

CONCLUSIONS
we have created a new pipeline for metatranscriptome analysis, functioning in conjunction with the mg-rast annotation pipeline. this pipeline is capable of determining functional expression activity within a sample at the transcript level, and provides measures of total transcription, differentiated either by organism or by functional category of transcript. this pipeline will enable more rapid adoption of metatranscriptomics methods. finally, we recommend that stool metatranscriptomes be ribodepleted and sequenced in a 100 bp paired end format with a minimum of  <dig> million reads per sample.

