BACKGROUND
chip-seq  is a powerful and widely used technique to map the genome-wide in vivo location of transcription factors, chromatin regulators, and histone modifications. with the growing popularity of this technique and the rapidly dropping cost of next-generation sequencing , laboratories now are routinely generating more and more chip-seq datasets. dnase-seq is a high-throughput technique to map genome wide active cis-regulatory elements based on chromatin accessibility. as of  <dig>  there are over  <dig>  chip-seq and dnase-seq samples  <cit>  in the public domain, and this number is increasing rapidly. however, quality control  and analyses of these data have not been straightforward, and the ongoing data explosion poses new challenges and opportunities for the development of computational pipelines for these datasets. first, such computational pipelines must be capable of processing large batches  of data efficiently with minimal user intervention. second, there is increasing recognition for the importance of chip-seq data qc, which should be conducted prior to detailed data analysis and interpretation. specifically, in the event of a “failed”  chip-seq or dnase-seq experiment, it will be highly advantageous for a pipeline to explore possible sources of failure that may enable users to modify and improve future experiments. third, the public availability of tens of thousands of chip-seq or dnase-seq datasets represents a rich resource of historical data that can be utilized to facilitate interpretation and identify potential problems.

although many computational approaches already exist to analyze chip-seq data, to the best of our knowledge, there are very few tools that are designed to tackle all three challenges simultaneously. for example, cistrome  <cit> , cisgenome  <cit>  and chipseeqer  <cit>  analysis pipelines provide user-friendly point-and-click solutions that can be conveniently applied only when the number of samples is relatively small. several new high-throughput computational tools have recently become available for chip-seq data analysis, including hichip  <cit> , fish the chips  <cit> , the annotation and visualization modules of sole-search  <cit> , seqminer  <cit>  and the peak calling and motif analysis tool homer  <cit> . while powerful, most of these tools focus on chip-seq data analysis rather than data qc. encode phantompeakqualtools  <cit> , chipqc  <cit> , htseqtools  <cit> , chipseeker  <cit>  are r packages specifically designed for chip-seq quality control and visualization; however, they all assume users to be familiar with r programming to utilize them. hichip implements a chip-seq analysis and qc pipeline, but none of its metrics have taken publicly available data into consideration. chance  <cit> , as a standalone qc gui software and includes chip-seq data from encode  <cit>  to help validate experiment quality. however, encode has a limited selection of proteins and histone marks in a limited number of cells compared to all that is available in the public. in addition, encode data quality  <cit>  often represent the best quality chip-seq data and thus do not necessarily provide a wide spectrum of data quality against which newly generated data can be compared. recently, a chip-seq qc system and database  <cit>  has collected many useful global and local sample qc indicators for  <dig>  publicly available profiles, but none of the indicators account for the chip matching input step. another database integrates limited types of qc metrics for  <dig> datasets only  <cit>  and, finally, remap  <cit>  emphasizes the quality control as well as the downstream analysis of publically available chip-seq data, but is focused solely on transcription factors. therefore, there is an unmet need for a chip-seq bioinformatics pipeline that combines data analysis and quality control in a unified framework, with the guidance of a comprehensive data quality atlas.

here, we present chilin, an integrated command line quality control and analysis pipeline for chip-seq or dnase-seq data. chilin has been exhaustively tested and applied to  <dig>  datasets from a wide variety of studies in the public domain obtained via geo. the atlas of all chilin-generated data quality metrics for these datasets is intimately linked to the cistrome data browser . further classification of the assay types can divide the qc atlas into assay type independent and dependent qc metrics, which facilitates better understanding of the quality of different assays. chilin builds on our previous chip-seq and dnase-seq expertise and uses historical data to provide a comprehensive data quality report and analysis results for validating chip-seq and dnase-seq experiments.

implementation
overall design
chilin is implemented as a python package, and the name represents an omen for luck and prosperity in chinese tradition. the full documentation is available at http://cistrome.org/chilin. the workflow of chilin is illustrated in fig. 1a, with each box representing a computational step in the chilin pipeline. there are data processing steps to perform analyses, and quality control steps to evaluate the results from the analyses. together, these steps are conceptually grouped into three layers: read layer, chip layer and annotation layer. each processing step can be easily extended by other functionality. chilin is equipped with a “simple” running mode, where the user specifies all requisite input files and minimal parameters in a single command line; alternatively, chilin can read all required inputs parameters from a configuration file, which is a convenient interface for batch processing. the output of chilin includes a quality control report in a pdf file, mapped bam files, a ready-to-view read signal bigwiggle file, narrowpeak and/or broadpeak bed files, for individual replicates and merged replicates, as well as json files containing all quality metrics.fig.  <dig> workflow of chilin and quality report. a arrows show the dependency relationship and order of the steps. data processing steps are indicated in black and quality control steps are indicated in white. b batch mode processing of datasets for user to customize internal qc database, post-processing script for compiling qc database is provided at https://github.com/cfce/chilin/blob/master/demo/compile_database.sh




read layer
at the read layer , chilin first checks the raw sequence quality and gc content using fastqc  <cit> . it then maps the chip and control fastq files onto a user-specified genome build. the default read mapping tool is bwa  <cit> , although the user can also specify bowtie  <cit>  or star  <cit>  for mapping. chilin reports the number of reads with mapping quality > <dig>  <cit>  as “uniquely mapped reads” and the corresponding “uniquely mapped ratio” . beyond the primary mapping target, chilin sub-samples 100 k reads from each original library and reports the uniquely mapped ratio for a range of species  to identify potential sample swaps or contamination.

chilin also examines library complexity in terms of unique locations ratio  and pcr bottleneck coefficient   <cit>  to identify potential over amplification by pcr. “unique locations” count is the number of genomic locations with one or more uniquely mapped reads. pbc is the number of locations with exactly one uniquely mapped read divided by the number of unique locations. higher unique location ratio  and higher pbc both indicate sequencing libraries with greater complexity. since these measures change with sequencing depth, chilin calculates these values from a sub-sample of four million uniquely mapped reads so samples with different sequencing depths can be compared .

for each user sample, chilin reports the percentile of the fastqc score and uniquely mapped ratio compared to the historical data based on a cistrome chilin compiled qc database  of fastqc scores and uniquely mapped ratios from publicly available chip-seq samples.

chip layer
the chip layer  has quality control metrics that help the user judge the quality of the chip enrichment . chilin uses macs <dig>  as the default peak caller. macs <dig> estimates fragment size from the cross correlation of reads in the high confidence peaks, and can perform narrow peak  or broad peak  calls, or both based on the user specification. in further analysis, chilin keeps one unique read for a position for peak calling to reduce false positive peaks. then it calculates the false discovery rate of the reported peaks by q-value  <cit> , and also reports the fold enrichment of each peak. high quality datasets typically have more peaks, a higher fraction of peaks with >10× enrichment and >20× enrichment, i.e.  <dig> and  <dig> fold confident peaks.

chilin measures the signal-to-noise ratio of a chip-seq data  <cit>  by frip, which is the fraction of non-mitochondrial reads in peak regions. since the frip score increases with sequencing depth, chilin calculates frip from a sub-sampling of 4 m uniquely mapped reads. another estimate of quality is the percentage of reads that falls in union of dnasei hypersensitivity sites . chilin derives the union dhs by merging all the peaks of dnase-seq data from encode  <cit> , which represent a comprehensive set of regulatory elements across many cell lines and tissues in the human and mouse genomes.

for datasets with replicates, chilin calculates the replicate consistency with two metrics:  <dig>  pearson correlation of chip-seq reads across the genome by using ucsc software wigcorrelate  <cit>  after normalizing signal to reads per million,  <dig>  percentage of overlapping peaks in the chip replicates. if more than three replicates available, chilin calculates both of the wiggle correlation and peaks overlap count for each pair of the replicates. then, we divided the peak overlap counts by the larger peak number for each pair of the replicates without considering the difference of the total reads number to deposit into chilin quality metrics table . chilin merges the raw reads from the replicates and re-runs macs <dig> which often yields more robust peak calls.

annotation layer
for the annotation layer  evaluation, chilin first plots the average phastcon conservation profile  <cit>  of all the peaks +/− 2 kb from the peak summits. chilin then reports the proportion of peak summits that fall within refseq promoter, exon, intron and intergenic regions. chilin also reports the percentage of top peaks  that fall within union dhs and blacklist regions .

blacklist regions are a set of regions found by the encode consortium to be consistently enriched in chip-seq/dnase-seq/mnase-seq/faire-seq data independent of cell lines and conditions  <cit> . union dhs regions, in contrast, represent the whole repertoire of regulatory elements in the human genome. low blacklist and high union dhs overlap ratios typically indicate good data quality. phantompeakqualtools  <cit>  requires blacklist regions to unbiasedly compute nsc and rsc score. chipqc  <cit>  assess a subsection of its chip enrichment quality metrics with blacklist regions filtered out. however, chilin computes blacklists overlapping ratio but keeps them in the analysis, since current qc database is built on hg <dig> and mm <dig> assembly which lack uniform blacklists. users can also customize the blacklist regions to compute the overlap ratio for their special needs, such as greylistchip  <cit>  for cell line specific copy number variation.

chilin next performs motif analysis on the top  peaks using the cistrome mdseqpos  <cit> , a method that weights motifs appearing more frequently at the stronger chip-seq peaks and at the center of peaks. large absolute z-scores of the motifs found from chip-seq peaks indicate good motif enrichment and high chip-seq data quality. finally, chilin calculates the regulatory potential score, a distance-weighted sum of all the binding sites within 100 kb from the transcription start site, of each refseq gene  <cit> . the list of genes ordered by regulatory potential represents the putative target genes of the protein of interest.

qc database
we compiled a comprehensive chilin quality metrics database of  <dig>  public chip-seq and dnase-seq samples  across the classified eight categories for user reference . we used chilin to process public data into datasets, then use post-processing scripts to build the chilin qc tables. users can use chilin simple mode to process batches of datasets on their computer clusters, then use the post-processing scripts to compile their custom qc tables .

RESULTS
chilin quality metrics evaluation
we first evaluated the influence of read length on the stability of chilin qc metrics. in general, an increase of read length can result in slight improvements in the uniquely mapping ratio .fig.  <dig> chilin quality metrics exploration. a overall chip samples quality metrics pairwise correlation across three layers of chilin analysis. b encode frip and chilin frip score comparison. c  <dig> samples for three degrees of chip-layer quality for exploring sequence depth relationship with frip. d frip score distribution along with sequence depth for the samples in c, background is the peak calling with down sampling reads, line and point colours indicates different quality level as in c. e frip background is the peak calling with all reads



we also evaluated all other pairwise relationships across  <dig> quality metrics. the overall frip is positively correlated with peak number across all assay types , although peak numbers vary significantly between different assay types from different studies . the frip scores of chromatin accessibility, transcription factor and chromatin regulators  is highly correlated with peak number, this is not true for histone modification samples  because broad and narrow histone marks are distinctly identified using macs <dig> for broad and narrow peak calling mode. in addition, only in dnase-seq is frip anti-correlated with estimated fragment size, indicating that shorter fragment length help obtain higher signal-to-noise ratio for dnase-seq .

lastly, we evaluated library complexity metric pbc and chip enrichment metric frip. chilin evaluation of pbc and frip is highly consistent with encode ones . the two metrics are variable across studies with different sequence depth. we chose samples based on different ranges of pbc and frip to demonstrate this point . we simulated different sequencing depth by sampling reads from one million up to the total number of reads, and calculated both pbc and frip at different sequencing depths. pbc score is largely influenced by sequencing depth . for frip, two settings are compared:  <dig>  peaks from down-sampled reads,  <dig>  peaks with all reads , which is built in chilin. the second setting produced qc statistics that were relatively stable as a function of sequence depth , far more so than the first setting . therefore, both of the metrics need to be compared at the same sequencing depth, and frip is better calculated by using peaks from all reads. chilin evaluates samples with all reads when the number of uniquely mapped reads is less than four million, which may cause potential biases when comparing to other samples . more than 93 % samples in this study  have more than four million uniquely mapped reads. so, we recommend biologists to produce data with at least four million reads uniquely mapped to the genome for fair quality control.

reference data quality atlas with classification
to generate a reference atlas of data quality for chip-seq and dnase-seq, we applied chilin to all raw sequencing files deposited in cistrome db , cistrome cr  <cit> , and cistromefinder  <cit> . this analysis resulted in quality metrics for  <dig>  samples and  <dig>  datasets of chip-seq and dnase-seq. in this study, a “sample” corresponds to a single fastq file, whereas a “dataset” has a one-to-one relationship to a unique chilin run, which may include multiple “samples” such as replicate ips and input controls. we summarized the chilin-generated quality metrics for all the samples and datasets  used in this study, which are freely available to download and use. the qc database is based on hg <dig> and mm <dig>  which includes data annotation, classification of assay types ,  <dig> qc metrics across three layers , and two replicate consistency metrics . we further divide the  <dig> qc metrics across three layers into assay type sensitive and insensitive metrics, in order to enable experimental scientists to better associate their own data with chilin qc data quality atlas to perform quality control on their sequencing runs, and interpret their data.

combined profiling of sequence quality score, ratio of uniquely mapped reads and pbc can help to establish criteria that will flag potentially low-quality chip-seq and dnase-seq data. by looking across assay types, we find no dependence of any of the three metrics on assay types in both chip and input samples . thus, the metrics of read layer are assay type insensitive. the cumulative distributions of these metrics  reveal that >85 % of samples are characterized by sequence quality score > <dig>  uniquely mapped read ratio > <dig>  and pbc > <dig> . this observation suggests that users may use these cutoffs in assessing the quality of their chip-seq data and deciding whether to investigate further. our qc analysis determined a median sequence depth of  <dig> million raw reads for chip-seq and  <dig> million for dnase-seq .fig.  <dig> reads layer quality metrics across eight categories. a median sequence quality score from fastq files. uniquely mapped ratio with bwa mapping quality above  <dig>  pcr bottleneck coefficient calculated from sampling four million reads from bam files. b reference sequence depth suggestions for the eight categories



in contrast to read layer qc, chip layer and annotation qc are often sensitive to assay types. histone marks, chromatin regulators and transcription factors have inherently heterogeneous chip enrichment levels, ip samples are typically higher than input control samples for all samples included in our study . dnase-seq displays the highest frip scores in general . most of the encode datasets have frip scores higher than 1 % as well as thousands of peaks as called by macs2; it is important to note that falling below 1 % frip score does not necessarily mean failure  <cit> . our observation suggests a frip score threshold of 1 % as a proper chip enrichment reference for a typical chip sample in that the proportion of chip samples  much higher than input samples  .fig.  <dig> chip layer quality metrics across eight categories. a macs <dig> peak calling of all peaks number, peaks number with fold change >=  <dig>  and >=  <dig> are displayed density distribution for the eight categories with threshold q value  <dig> . b overall frip score distributions for chip samples  and input control samples  across assay types. c scatterplot of replicates samples wiggle correlation against peaks overlapping ratio. d empirically cumulative distributions of the wiggle correlation and peaks overlapping ratio for the replicates consistency



the two quality metrics for replicates consistency correlates well . replicates with sufficient wiggle correlation and peaks overlapping ratio  are considered to be of high consistency between experiments.

because different assay types are known to possess differential binding preferences for various regions of a genome, experimentalists may find it useful to have access to a comprehensive assessment of the variations in the binding site distributions of different assay types across meta-regions of the genome. meta regions are defined as genomic regions that had been annotated as promoters, exons, introns, or intergenic regions. we generated meta region metrics distributions across assay types  along with the background ratios of the meta regions for human and mouse genome assemblies .fig.  <dig> annotation layer metrics across eight categories. overall distribution of all peak summit overlapping percentage with exons, introns, promoters and intergenic regions for different categories, and the overall distribution of the ratio of top  <dig> peaks overlapping union dhs from encode



next, we demonstrate how experimental scientists may use dhs overlap ratio to aid their data interpretation, particularly for histone marks. dhs are commonly identified as regions of accessible chromatin  <cit> , but their exact associations with the diverse set of histone marks have not been fully characterized. most of chromatin accessibility, transcription factor, and chromatin regulator datasets show a dhs overlap ratio of > <dig> . in contrast, histone mark datasets show considerably more variations depending on the specific type of histone mark . we note that most histone acetylation marks  show a fairly tight distribution of high overlap with dhs , comparable to the transcription factor, chromatin regulator and chromatin accessibility factor types. however, non-acetylation histone marks displays fairly high , intermediate , or low  values of union dhs overlap ratio . since different histone marks play distinct roles in gene regulation, it is noteworthy that many of these histone marks seem to display a broad range of dhs overlap ratios rather than a narrow distribution.

the threshold for each qc metrics is given in the last section of a chilin qc report, major metrics are highlighting as blue  or red  quality . users are encouraged to compare their chip-seq datasets against corresponding assay types or proteins provided in additional file 2: table s <dig> 

case studies across factor types
to showcase the utility of chilin in performing data qc for a variety of assay types, we present  <dig> representative examples of actual chilin qc reports for both bowtie and bwa . these reports had been generated from public chip-seq datasets of broad histone mark h3k27me <dig>  <cit>  , narrow histone mark h3k4me <dig>  <cit>  , h2a.z  <cit>  , transcription factors trrap  <cit>  , foxa <dig>  <cit>  , stat <dig>  <cit>  , ar  <cit>  , the pair end rad <dig>  <cit>  , and chromatin regulators rag <dig>  <cit>   and chd <dig>  <cit>  , chromatin accessibility dnase-seq  <cit>  .

broad histone mark chip-seq are harder to quality control, as indicated by the reference atlas obtained from public data. neither peak number , frip score , nor dhs overlap ratio  appears to be a good indicator of data quality for broad marks across different marks. the chilin qc reports of h3k27me <dig>  indicate that, although the h3k27me <dig> datasets meet the basic requirements of read layer quality control, neither of the replicate is of high quality in terms of chip layer . nevertheless, the annotation layer flat conservation profiles cannot flag the h3k27me <dig> quality as inferior since diffuse distribution of h3k27me <dig> make the broad mark conservation profile spread out in nature. though, for h3k27me <dig> in this study, the quality of the dataset with replicates  is still better than the one with single sample in terms of larger peaks numbers and frip scores . for diffuse marks like h3k27me <dig>  chilin evaluates frip with macs <dig> special broad peak calling mode. however, the low frip score with broad peaks is still a problem which is not resolved in general, even though there are some alternative tools “macs <dig> predictd”  for this, whose measure may still not be reliable. overlapping h3k27me <dig> with the compiled functional regions, such as hox genes or ezh <dig> binding sites is a potential solution, this is still ongoing work for chilin.

for the narrow histone marks h3k4me <dig> and h2a.z, chilin indicates that the datasets used in this study show good overall quality in read and chip layers. the h3k4me <dig> datasets with deeper sequence  is superior to the one with fewer reads  in terms of replicates consistency and conservation profile. the lower sequenced datasets of h3k4me <dig> replicates are not consistent , the 2nd replicate has much lower frip and peak number than the 1st one, which may need to be discarded. the higher sequenced h3k4me <dig> dataset and the h2a.z dataset is of high quality in terms of high uniquely mapping ratio, pbc, frip, peak number, high reproducibility, promoter ratio, union dhs overlap ratio and peaky conservation profile .

for transcription factors, chromatin regulators, cohensin and dnase-seq, chilin identifies the datasets from ar, foxa <dig>  chd <dig>  rag <dig>  rad <dig>  and the dnase-seq as being of good quality, and the quality metrics of these datasets are considered to be satisfactory across all the three chilin layers . specifically, the motif scan step, which is part of the chilin workflow, correctly recovers the corresponding foxa <dig>  ar, and the cofactor ctcf motifs from ar, foxa <dig>  and rad <dig> chip-seq dataset, respectively . in contrast, examination of the chilin report leads to the conclusion that the trrap, stat <dig> datasets are likely to be relatively lower quality . specifically, for stat <dig>  this is indicated by low frip scores , relatively low number of peaks , poor conservation profiles, and lack of motif enrichment. the trrap dataset shows poor wiggle correlation  and peak overlap count  between two biological replicates despite using the same anti-gfp antibody from abcam, so researchers may need to explore other reasons for the observed low reproducibility, or discard the poor replicate .

availability and requirements
project name: chilin: a comprehensive chip-seq quality control and data analysis pipeline

project homepage: http://cistrome.org/chilin/.

operating systems: linux, macos

programming language: python, r and bash.

other requirements: bwa , seqtk , fastqc , samtools , macs <dig> , bedgraphtobigwig, wigcorrelate, bx-python , mdseqpos.

license: 3-clause bsd.

any restrictions to use by non-academics: follow the license.

discussions
since many excellent tools are already available for chip-seq data analysis, we compared chilin features with several published computational tools and pipelines . we find that chilin is complementary to other tools by providing additional or expanded functionalities. for example, the seqminer software is a powerful toolset for integrative analysis of multiple chip-seq datasets normalization and visualization. the tools cisgenome, homer, chipseeqer and sole-search perform peak calling, peak annotation, motif searches and a series of useful analyses. they currently lack a module dedicated to data quality control. chance is a comprehensive package for chip-seq quality control and protocol optimization that compares the user’s data with encode’s large collection of published datasets, but its user-friendly gui-based design makes batch processing of large collections of data difficult. similar to chilin, hichip performs read quality check, read mapping, peak calling and consistency analysis between replicates, data visualization and summary report, and downstream analysis; unlike chilin, hichip does not report frip scores nor utilize historical data for quality metrics, or use known dhs and blacklisted regions from encode in its data quality control analyses. for numerous r-based chip-seq analysis tools including chipqc, htseqtools, chip-seeker and the phantompeakqualtools package used in encode program, quality control is their main concerns and alignment and/or peak files are required as input. consequently, they can only provide a specific and less comprehensive evaluation based on only a small number of the metrics available in chilin. chilin has been designed to address all the needs for both data processing and quality control. in combination with the data quality atlas we have assembled, chilin is a powerful tool for supporting chip-seq and dnase-seq studies of any size.

CONCLUSIONS
chilin is an extensible software suite, and it integrates a comprehensive set of qc metrics at various layers of the chip-seq and dnase-seq experiments. chilin reports these measures in a clear and automatically generated report. chilin can process large batches of chip-seq and dnase-seq data from single end and paired end experiments. a user can reproduce the quality control and analysis result with only a simple command in a single pipeline process. the incorporation of a simple running mode in chilin makes it relatively straightforward to develop customized gui’s. therefore, chilin can be an attractive solution to rapidly process batches of chip-seq datasets in an automated manner with detailed qc reports.

appendix
assay classification
the purpose of the assay classification is to gain better understanding of the quality metrics since chip and annotation layer qc measure is assay category sensitive metrics . we manually grouped the assays into eight categories by literature mining. the literature for classifying assay type is the cistrome cr  <cit> , histone database histome   <cit> , chromatin regulator literature  <cit> , and transcription factor database  <cit> . first, the assays are scored based on the following rationale : if a factor occurs in one particular reference, the score of the assays increments  <dig>  for that category if the reference describes it as a predicted transcription factor or chromatin regulator, otherwise the score of the assays increments  <dig> for certain transcription factor or chromatin regulator. then, the scores are summed up to determine the assays’ category following the criteria:  <dig>  if the scores of transcription factor  and chromatin regulator category  are both  <dig>  the assay is assigned to other category.  <dig>  if either of the score of class a or class b is  <dig> , then the classification is as below: a. if the score of class a is  <dig>  the score of class b is  <dig> , it is a predicted chromatin regulator; b. if the score of class b is  <dig>  the score of class a is  <dig> , it is a predicted transcription factor; c. if the score of class a is less or equal than  <dig> , the score of class b is larger or equal than  <dig>  it is a chromatin regulator; d. if the score of class b is less or equal than  <dig> , and the score of class a is larger or equal than  <dig>  it is a transcription factor; e. if the score of class a equals class b with a score of  <dig> , it is assigned to both predicted transcription factor and predicted chromatin regulator.  <dig>  if both of the scores are larger or equal than  <dig>  then  if the score of class b is larger than the one of class a, it is chromatin regulator;  if the score of class a is larger than the one of class b, it is a transcription factor. the reason for dividing transcription factor and chromatin regulator into predicted, certain or both is to be more accurate and faithful to the literature. for example, tfcat  <cit>  was one of resources we referred to annotate transcription factors, and they classified genes into tf genes, tf gene candidate and so on.

chilin library complexity and aligner effect evaluation
library complexity of single-end data underestimates the library complexity in comparison with the pair-end chip-seq data for su and h3k36me <dig>  <cit> . in concept, pbc is more conservative than non redundant tag  because pbc only consider unique regions with one read against unique regions number instead of considering unique regions against all mapped reads. further, pbc at lower sequence depth can more accurately estimate library complexity at higher sequence depth in comparison to other methods   <cit>  .

aligner effects are evaluated in two datasets. for both of the cases,  <dig> out of  <dig> metrics are quite similar except to the peaks annotation of union dhs ratio . the union dhs region overlap ratios are variable between aligners because previously we used all peaks to evaluate the union dhs ratio for bowtie with hg <dig>  and now we used top  <dig> peaks for bwa with hg <dig> .

four categories classification for the most commonly studied assays
different types of histone modification such as h3k4me <dig> and h3k27ac indeed have very different characteristics. while it is easy to classify some marks as broad or narrow this is more difficult for others, such as macroh2a, h2bk120ub, and h2bub <dig>  that have not been studied as much. we further looked into these well-known broad histone modification , narrow histone modifications , focal contacts , and chromatin accessibility . broad and narrow histone modifications can be arbitrarily separated by 450 bp of median peaks length . frip scores for most of the samples excels 1 % suggested thresholds, h3k4me <dig> and h3k36me <dig> have higher enrichment for frip than other  <dig> marks. peaks union dhs sites and promoter regions overlapping ratio can be used as rough guides for separating the active narrow marks from the broad repressive marks . for the selected focal and chromatin accessibility assays, on average, frip scores are higher than the suggested cutoff. frip of dnase-seq and ctcf are much higher than the others. the ratio of peak overlap with union dhs sites and promoter for all focal assays and dnase-seq are much higher than the threshold we set for union dhs and the background genomic promoter ratios . further, we used h3k9me <dig> as an example to determine the metric for broad mark by referring to encode chip-seq datasets. the overlapping ratio between all public h3k9me <dig> chip-seq broad peak and encode h3k9me <dig> chip-seq union broad peak is larger than 80 % .

chilin batch mode and performance
chilin support batch processing of datasets in two ways: first for computer servers with limited resources, chilin uses the sub-command batch to process different configuration files one after another; second, for computer clusters, user can prepare submission scripts with simple mode, following the examples publicly available at https://github.com/cfce/chilin/blob/master/demo/. for chip treatment of  <dig>  million reads with input  <dig>  million reads, chilin took approximately 9 h 11 min to finish the processing with a single thread, and the output folder was  <dig> gb in size. the hardware is cpu- 4x amd opteron™ processor  <dig>  each with  <dig> cores, ram is 256gb of ddr <dig> . for a batch of  <dig> datasets, chilin took 6 min to run one million reads on average using eight threads on centos with slurm cluster manager software .

additional files
additional file 1: figure s <dig>  library complexity method exploration. a. pbc score comparison between chilin and encode. b. correlation between  <dig> and 30 m uniquely mapped reads across different library complexity metrics for chip-seq and dnase-seq. c. linear regresssion f statistics between  <dig> and 30 m uniquely mapped reads library complexity metrics for chip-seq and dnase-seq. d. three degrees of library complexity quality, each with  <dig> samples. e. pbc score distribution at different sequence depths through sampling down the uniquely mapped reads, line and point colors indicates different quality level as in d. 

additional file 2: table s <dig>  sheet <dig> toolscomparison: chip-seq pipeline software comparison. sheet <dig> examples of chilin report. a summary of example data annotation of transcription factor, chromatin regulatory factor and histone modification chip-seq data. sheet <dig> protein classification standard for the  <dig> categories. sheet <dig> protein classification results. sheet <dig> bwa qc database. chilin samples and datasets quality metrics across three layers. a clean up table of cistrome samples and datasets quality metrics for chilin users’ reference. the qc results is based on the reference of hg <dig> and mm <dig> assembly. 

additional file 3: figure s <dig>  pairwise correlation of chilin qc metrics for the four main assay types across read, chip and annotation layer. a. chromatin accessibility, b.histone modification, c. transcription factor, d. chromatin regulator 

additional file 4: figure s <dig>  cumulative probability fraction of sequence quality score, uniquely mapped ratio, pcr bottleneck coefficients, macs <dig> estimated fragment size across eight categories 

additional file  <dig> 
figure s <dig>  well-known broad, narrow histone mark, transcription factor, chromatin regulator, and dnase-seq chip and annotation layer qc metrics. a. narrow histone modification  peaks length distribution along with the frip, peaks meta region annotation. red line for peaks length denotes the  <dig> arbitrary cutoff to separate broad and narrow mark, red line for frip and peaks union dhs overlapping ratio denotes the suggested cutoff of  <dig>  and  <dig> , red line for meta regions distribution labels the background ratio base pair ratio for exon, intron, promoters and intergenic regions as in additional file: figure s7a. b. the same as a for broad histone modification . c. the same as a for transcription factor  and chromatin regulator . d. the same as a for all the dnase-seq samples 

additional file  <dig> 
figure s <dig>  cumulative probability fraction of the chip and annotation layer qc metrics 

additional file 7: figure s <dig> a. the reference meta region distribution ratios for four human and mouse assemblies . b. overall samples h3k9me <dig> peaks from cistrome data browser overlapping ratio with encode <dig> h3k9me <dig> peaks. constitutive  <dig>   <dig>   <dig> is the genome regions with more than 60 %, 70 %, and 80 % of the encode <dig> h3k9me <dig> broad peak locates, union region is the merging genome region of all the encode <dig> h3k9me <dig> datasets. c. chilin runtime performance for  <dig> datasets. 

additional file 8: file s <dig>  h3k27me <dig> data qc report from chilin. the sequencing reads had been mapped to the mm <dig> genome build for bwa and bowtie. file s <dig>  second h3k27me <dig> data qc report from chilin. the sequencing reads had been mapped to the hg <dig> genome build for bwa and bowtie. file s <dig>  h3k4me <dig> data qc report from chilin. the sequencing reads had been mapped to the mm <dig> genome build for bwa and bowtie. file s <dig>  second h3k4me <dig> data qc report from chilin. the sequencing reads had been mapped to the mm <dig> genome build for bwa and bowtie. file s <dig>  h2a.z data qc report from chilin. the sequencing reads had been mapped to the mm <dig> genome build for bwa and bowtie. file s <dig>  trrap data qc report from chilin. the sequencing reads had been mapped to the hg <dig> genome build for bwa and bowtie. file s <dig>  foxa <dig> data qc report from chilin. the sequencing reads had been mapped to the hg <dig> genome build for bwa and bowtie. file s <dig>  stat <dig> data qc report from chilin. the sequencing reads had been mapped to the mm <dig> genome build for bwa and bowtie. file s <dig>  ar data qc report from chilin. this report includes two immunoprecipitated and two input samples. the sequencing reads had been mapped to the hg <dig> genome build for bwa and bowtie. file s <dig>  rad <dig> paired end data qc report from chilin. the sequencing reads had been mapped to the mm <dig> genome build for bwa and bowtie. file s <dig>  rag <dig> data qc report from chilin. the sequencing reads had been mapped to the mm <dig> genome build for bwa and bowtie. file s <dig>  chd <dig> data qc report from chilin. the sequencing reads had been mapped to the mm <dig> genome build for bwa and bowtie. file s <dig>  dnase-seq qc report from chilin. the sequencing reads had been mapped to the hg <dig> genome build for bwa and bowtie. 

additional file 9: figure s <dig>  bwa and bowtie difference for the chilin qc metrics. a-m,  <dig> qc metrics for the additional file 8: file s1-s <dig>  datasets resources is described in additional file 2: table s <dig>  n-p.  <dig> datasets comparison of hg <dig> with bwa and hg <dig> with bowtie 



abbreviations
cistrome dbcistrome data browser

dhsdnase hypersensitive site

fripfraction of reads in peaks

ipimmunoprecipitated

pbcpcr bottleneck coefficient

qcquality control

