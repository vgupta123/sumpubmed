BACKGROUND
genome-wide technologies such as microarray and sequencing are intensively used to study differential expression in e.g. disease and/or treatment, often compared with controls. power and sample size analysis give valuable information about the performance of the experiment: what is the optimal number of replicates? is the power sufficient to detect a biological effect?

absolute power and sample size estimation must be done using pilot experimental data in each problem separately, as they are influenced by variability that is both technical as well as biological  <cit> . for this a technology must be chosen. so it is important to understand beforehand how relative power and sample size behave depending on the technology used. in particular, different technologies may display different power depending on the gene expression range.

here we focus on estimating relative change in power and sample size, given either different effect sizes or different expression profiling technologies. in each case results are derived from pilot experiments, so conclusions relate directly to practice. the different expression profiling technologies include commercial and home-spotted gene-expression microarray platforms, as well as a deep sequencing technology. for power and sample size calculations, we adapted the method proposed by ferreira et al.  <cit> .

methods
power and sample size estimation
consider the case where samples are studied under two conditions, and interest lies in finding genes differentially expressed between these conditions. we use the power and minimal sample size calculation method of ferreira et al.  <cit> . this method assumes that for a set of test statistics measuring the differential expression, their distributions are given as each having a normal distribution . for each gene, under the null hypothesis h <dig> of non-differential expression we have the mean μ =  <dig>  and under the alternative h <dig> of differential expression μ ≠  <dig>  if we represent by k, l the cumulative distribution functions  of the test statistics under h <dig> and under h <dig>  respectively, then the observed test statistics have mixture cdf m given by

   

where λ represents the density of effect sizes θ and π <dig> the proportion of non-differentially expressed genes.

effect sizes can be seen as the difference between a gene's mean expression levels at two conditions, divided by its pooled standard deviation. note that m is observed and k and l are given, so π <dig> and λ need to be estimated. after estimating π <dig> using the approach suggested by langaas et al.  <cit> , λ is estimated by a deconvolution estimator. the average power can be estimated by solving the following equation for u:

   

where Γ represents the power for a single gene as function of the p-value u and effect size θ and δ is the user-defined false discovery rate. in fact, ferreira et al.  <cit>  showed that the average power, given by equation  <dig>  is controlled for multiple testing through the adaptive benjamini-hochberg method  <cit> . this is essentially the same as the originally proposed false discovery rate method of benjamini and hochberg  <cit> , corrected by the proportion of differentially expressed genes to avoid over-estimation.

the effect size density is estimated unconstrained, so after it is obtained it must be constrained to being non-negative, whilst integrating to  <dig>  to avoid discontinuities where the constraint is applied, we re-adjust the π <dig> estimate .

note that to estimate the average power in this way involves also the power to detect effect sizes around zero, which are technically very difficult to measure accurately. a small region around zero can be defined that will be excluded from the density of effect sizes and thereby increases the estimated average power.

data description
simulation experiment
a simulation study was performed based on the simulation perviously described by langaas et al.  <cit> . while keeping the proportion of non-differentially expressed genes fixed at  <dig> , we varied the effect size distribution. specifically, three different effect size distributions were constructed based on a symmetric bitriangular distribution  <cit> . this means that each differentially expressed gene is either over- or under-expressed with equal probability, and that the mean effect size per over-expressed gene is chosen at random from values in a window between a = log <dig> and b >a, with the mode at m = log <dig>  and for under-expressed genes a window between -a and -b is used, with the mode at -m. we used three values for b, namely log <dig>  log <dig>  log <dig>  generating situations with weak, intermediate and strong effect sizes respectively. this means for example that the weak-effect situation has genes with effect sizes between log <dig> and log <dig> 

a total of n =  <dig> simulations were performed with  <dig> independently generated normalized expression values and j =  <dig> samples in each of two groups. test-statistics were calculated as described by langaas et al.  <cit> . the observed power was calculated as the number of differentially expressed genes with benjamini-hochberg fdr ≤ 10% , divided by m <dig> =  <dig>  in addition, the estimated power was evaluated using the method proposed by ferreira et al.  <cit> .

example  <dig> - different biological effect sizes
pparα is a transcription factor that is activated upon binding by a variety of agonists, both of synthetic and natural origin  <cit> . in this experiment the outcome of specific pparα activation on murine small intestinal gene expression was examined using affymetrix genechip mouse  <dig>  <dig>  arrays. pparα was activated by several pparα-agonists that differed in activating potency. in this paper the data of three agonists were used, namely wy <dig> , fenofibrate and trilinolenin . the first two compounds belong to the fibrate class of drugs that are widely prescribed to treat dyslipidemia, whereas trilinolenin is an agonist frequently found in the human diet. for intestinal pparα, wy <dig>  is the most potent agonist followed by c18: <dig> and fenofibrate, as is detailed elsewhere . since time of exposure also affects the effect size, intestines were collected  <dig> hrs  or  <dig> days  after exposure. details of the rationale behind these designs have been previously published  <cit> . an overview of the dataset is given in the upper part of table  <dig>  probesets were redefined according to dai et al.  <cit> . expression estimates of probesets were obtained by gc-robust multi-array  analysis, employing the empirical bayes approach for background adjustment, followed by quantile normalization and summarization  <cit> . for each compound and exposure time, lists of moderated t-test statistics were computed, using the empirical bayes linear regression model as implemented in limma <cit> , for each contrast representing the effect of compound in pparα-null mice compared to wild-type mice. based upon these lists, which include the full range of effect sizes, the power and sample size analysis was performed.

 <dig> the sample size given refer to the number of biologically independent samples.

example  <dig> - different expression profiling platforms
gene expression profiles in the hippocampi of transgenic δc-doublecortin-like kinase mice were compared to wild-type. the sample size and power analysis was applied to expression data relating to the same samples, measured either by one of several microarray platforms, or by solexa/illumina deep sequencing  <cit> .

in this analysis we included expression data for the same samples obtained with four microarray platforms, previously analyzed in the platform comparison study of pedotti et al.  <cit> , namely affymetrix, agilent, illumina and home-spotted oligonucleotide arrays, the last containing the 22k sigma-compugen collection. ten microarrays were used for each platform. for the one-color platforms , each individual rna was hybridized to one microarray, yielding five hybridizations in each of the groups wild-type and transgenic mice. a direct design was used for hybridization of the two-color arrays , i.e. each microarray was hybridized with two rna samples from different groups. dye-swapped hybridizations were done with non-identical pairs. this design yielded ten hybridizations in each of the groups, five of which being biologically independent. the data has been pre-processed as described by pedotti et al.  <cit> . mrna expression levels from four samples of each group were also measured using the solexa/illumina deep sequencing; for details about sample preparation and pre-processing, see  <cit> . moderated t-test statistics were calculated, for each technology, using the empirical bayes linear regression model as implemented in limma <cit> .

to enable comparison between technologies, for each technology subsets were generated containing only genes mapped to the same ensembl tags, leaving  <dig> genes per technology  <cit> . the datasets were stratified into three subsets of genes of approximately equal size  as follows. first the median-expression values across wild-type samples for the solexa/illumina data were calculated, per ensembl tag. then the 33rd and 67th percentiles of these values were obtained. these two values were used to determine three strata: tags with solexa/illumina median -expression below 33rd percentile were put into the low-intensity range, followed by tags with median-expression between 33th and 67th percentiles being put into the intermediate-intensity range, and finally remaining tags were put into the high-intensity range. in the power and sample size analysis a region near zero  was excluded from the density of effect sizes.

software
we used the r  <cit>  environment for statistical computing for all calculations, the bioconductor  <cit>  packages gcrma <cit> , limma <cit>  and multtest <cit> , qvalue <cit>  and for graphs we used the lattice <cit>  package. we adapted the original s-plus scripts kindly made available to us by ferreira  <cit>  and developed an r package called sspa, available from bioconductor  <cit> .

RESULTS
simulation experiment
the main purpose of this small simulation experiment was to show that the proposed method of ferreira et al.  <cit>  is able to perform relative average power estimations in a scenario of varying effect size distributions. although the estimated average power is slightly conservative, the relative power is in agreement with the true positive rate, the fraction of truly differentially expressed genes amongst the significant genes .

example  <dig> - different biological effect sizes
in this first real-life example we provide a proof-of-principle that our method is able to correctly estimate relative power in a setting where different effect sizes are induced as a consequence of the treatment with compounds with different potency's and exposure times. this experiment was originally setup to examine the effects of pparα-activation by synthetic as well as nutritional agonists on gene expression in various tissues in mice, including intestine. comparative analysis in pparα-null mice enabled the specific study of the regulatory role of this transcription factor. previous, biology-driven analysis of the array data sets identified a hierarchy in pparα-activating potency  <cit>  . test statistics were obtained by measuring the differential response on gene expression between wild-type and pparα-null mice. we estimated power and minimal sample size for each combination of compound and exposure time separately, fixing the false discovery rate at 10%. figure  <dig> shows the estimated densities of effect sizes, per compound and exposure time. these densities describe the standardized effect sizes among the differentially expressed genes. for each exposure time, the densities show increasingly heavier tails with the expected pparα-activating potency of the compounds, from the weakest  to the strongest . moreover, for all compounds there is relatively more up-regulation than down-regulation. when comparing exposure times , it is obvious that longer exposure yields more pronounced effects, represented by the bimodal densities, compared with shorter exposure, where densities representing the mixture of up- and down-regulation on genes display a single overlapping mode, with a subtle separate effect seen on the lower tail for the stronger compounds.

from the left-panel of table  <dig> we can see that, by increasing exposure time from six hours to five days, the estimated power was doubled for the more potent compound wy <dig> , and increased almost by a factor of four for the weaker compound fenofibrate. indeed, the wy <dig>  reached around 60% power, where the fenofibrate had just 40% power. in addition, as the compound got less potent, the proportion of differentially expressed genes decreased, as expected. so it is clear that less potent compounds, or the ones exposed for a shorter time, yield little power to detect differences.

the power is estimated with a 10% fdr.

a more complete picture of the variation in power as the sample size increases is given in figure  <dig>  for each combination of compound and exposure time. as expected, the average power increased with pparα-activating potency and with exposure time. for example, if a power of 50% was desired to study the strong wy <dig>  compound,  <dig> arrays per group would be necessary considering a six hours exposure, whilst the same power would be already achieved using a five days exposure with four arrays per group. the other two compounds needed more than  <dig> samples per group for a six hours exposure to yield the same power, which after a five days exposure would be achieved with the fenofibrate compound with six samples per group.

example  <dig> - different expression profiling platforms
this study was designed to explore the capabilities of expression profiling technology to identify subtle differences in gene expression. to estimate power, it is essential to estimate the proportion of non-differentially expressed genes . in table  <dig>  we report π <dig> for the different expression profiling platforms, as estimated by the method of langaas et al.  <cit> . we used alternative methods for estimation of π <dig> with essentially similar results . the estimated proportion of non-differentially expressed genes differ significantly between the different technologies, with illumina displaying the highest proportion . however, perhaps the most marked point is that the power is generally low for all technologies used. this is a reflection of the fact that the effects on expression are mostly subtle.

as before, a better overview is given by the estimated power curves in figure  <dig>  the power continued to be generally low for the sample sizes considered, but increased with sample size. here solexa/illumina, agilent and affymetrix are shown to be the best performing technologies for all sample sizes. the higher performance of agilent compared to affymetrix may be a consequence of the pilot study size, upon which the estimation of the power curve depends. as the number of samples differs per technology , there is considerably more certainty about estimates for agilent and home-spotted, since their technical variability is better estimated, than for the other cases, especially so for solexa/illumina with the smallest sample size. yet, for all sample sizes solexa/illumina was estimated as having the highest power, which is an indication of how precise and powerful this technology is.

considering the two one-color platforms, illumina yields less power than affymetrix in this experiment . this is also reflected by the estimated densities of effect sizes .

the largest effects in this experiment were observed for genes expressed in the low-intensity range, so technologies that are more sensitive to detect differences in this range are expected to perform better. in order to gain more insight into the sensitivity of the various technologies, we split genes into subsets according to them being expressed in the low-, medium- and high-intensity ranges, as given by wild-type median- expression ranking of solexa/illumina. for each technology and subset the power was estimated again for a range of sample sizes. results are displayed in figures  <dig> and  <dig> for affymetrix, agilent and solexa/illumina, where figure  <dig> is ordered by intensity range and figure  <dig> is ordered by platform. in the low-intensity range, solexa/illumina displays considerably more power than the two microarray platforms, whilst in medium- and high-intensity ranges affymetrix and solexa/illumina were comparable, with agilent having a higher power . more interestingly perhaps, solexa/illumina displays comparable power across the three intensity ranges, whilst each one of the microarray platforms displays markedly less power in the low-intensity range compared to the intermediate- and high-intensity ranges . this is due to the presence of background, which is absent in solexa/illumina, but affects measurements in the low-intensity range of microarray platforms. so the largest effects found in the low-intensity range in this study are duly detected by solexa/illumina, but missed by the microarray platforms. this is further exemplified in additional file  <dig>  where the same comparison is made without filtering for small effect sizes.

discussion
we aim at helping researchers to understand: a) how much change in sample size different expression profiling technologies require to yield the same power; and b) by how much the sample size required for a fixed power would change, if smaller effects were to be detected. in order to do so, we use experiments carefully designed to answer these questions. our experiments use tissue samples from animal models, commonly used in practice. not only our conclusions are easily applicable to the design of microarray experiments, but also our approach is available for researchers to use on their own data via our bioconductor package sspa.

for our study, we use the method proposed by ferreira et al.  <cit> . it makes use of a pilot study to estimate distribution of effect sizes and proportion of non-differentially expressed genes, based upon which power is estimated.

various other methods to estimate sample size and power in microarray studies have been proposed. the first few assumed that multiple testing correction is done via control of the familywise error rate  <cit> , which is unlikely to be the case in current practice. more recently, methods were proposed to handle the more commonly used control of false discovery rate  <cit> . the methods differ in how they treat the distribution of effect sizes; simpler methods assumed a fixed value for all differentially expressed genes, or took a subset of the largest effect sizes  <cit> . these are unlikely to correctly describe effects from experimental studies. recently proposed methods  <cit>  estimated the distribution of effect sizes from a pilot data set. ferreira  <cit>  assumes that the test statistics follow a normal distribution, which is unlikely to be the case. however, the extension of ferreira's method to consider statistics with a more suitable student-t distribution is not trivial. indeed, to solve equation  <dig> is a much harder analytical problem under the student-t distribution. jørstad et al.  <cit>  proposed to solve this problem by discretizing the effect sizes and then estimating the components of the resulting mixture. ruppert et al.  <cit>  proposed to estimate the density of effect size by a linear combination of splines optimized via penalized least squares. the number of parameters that needs to be estimated by both methods is considerably larger than by the method of ferreira et al.  <cit> , making them computationally much more intensive. for this reason, we chose to use ferreira's method.

the simulation experiment shows that the estimated power is in agreement with the observed power. important for the power estimation is the estimation of the proportion of non-differentially expressed genes. the π <dig> estimates of the simulation experiment were all conservative and a little less than π <dig> =  <dig> , which may have led to overestimation of the power. however, the opposite was observed: the estimated power was found to be conservative. generally speaking it is good to be on the conservative side in power calculations. however, this may not be the case in other applications. indeed, we have observed that the relationship between observed and estimated power depends on both π <dig> and the effect size distribution . this issue deserves further investigation but is beyond the scope of this paper.

both our simulation study as well as example  <dig> demonstrate that our method correctly ranks the power of different experimental scenarios and is thus suited to evaluate the relative capacity to identify differentially expressed genes. some of the results obtained with this method are as expected: in example  <dig>  potent compounds yield higher power than weaker compounds, as does longer exposure time compared to a shorter one . the hierarchy of pparα-activating compounds found with this method confirms previously biologically-driven analysis  <cit>  . however, some results are unexpected, such as that the power seems to increase little after a certain sample size . since the power for  <dig> samples per group is already acceptably high , this result suggests that it is useless to analyse more than  <dig> samples to find differentially expressed genes.

the higher power for the longer-exposed compounds is associated with a markedly bimodal density of effect sizes . this density represents additional and important information for the researcher. in this case, for example, it can be seen that there are more genes up- regulated than down-regulated after short-term exposure, and that after long-term exposure this is more balanced, suggesting that up-regulation is kicked off earlier on. so, we have shown how the density of effect sizes reflects varying distributions of differential expression. this is intuitive and seems trivial, but no other method has produced this result before  <cit> .

example  <dig> shows great difference in performance for different expression profiling technologies to detect a subtle biological effect. commercial microarray platforms perform better than the home-spotted mainly due to their higher reproducibility. the poor performance of illumina may be attributed to the fact that less probes are used than affymetrix. by estimating power separately for genes expressed in intensity ranges varying from low to high, we can clearly see the added value of the solexa/illumina deep sequencing technology compared with microarrays. due to background, microarray platforms often cannot reliably measure expression in the low-intensity range. indeed, solexa/illumina displays with  <dig> replicates per group the same power as agilent and affymetrix with  <dig> replicates per group . the reduced power of microarray technologies is shown to be mainly due to lack of power to detect differential expression for lowly expressed genes, possibly due to presence of background intensities, a problem that does not affect solexa/illumina.

the estimated proportion of non-differentially expressed genes p <dig> shows great difference between the different expression profiling technologies. this is likely due to differences in genome mapping  <cit>  and hybridization efficiency. since it is known that the same samples were hybridized to the different platforms, one might wonder if by using a common, fixed π <dig>  value for all platforms more consistent results would have followed. that is not the case: power estimates are robust to variations of roughly 10% around the estimated π <dig> value . moreover, we believe this should not be done, as effects of technical differences between the platforms would then have been ignored, which is undesirable. so, we believe that for each experiment π <dig> should be estimated from the data, and that a sensitivity analysis may help reassure the researcher that power estimates are reliable.

our example  <dig> is not trivial and no previous article, to our knowledge, has produced power and sample size calculations in such datasets. indeed, the maqc study  <cit>  only involves technical replicates. so we do believe our work, by involving not only  <dig> different microarray platforms, but more importantly also a deep sequencing technology, does yield new knowledge. in particular, no previous work has shown that deep sequencing technology displays more power than microarrays in the presence of biological, in addition to technical, variability.

the objective of the study plays an important role in choosing the fdr-control level. indeed, if results are meant to be further explored via high-dimensional tools such as pathway analysis, then there is interest in having a longer list of possibly interesting features, albeit with a larger fdr. this effectively expands the space on which the subsequent analysis tool will look for associations, improving the chance of finding more subtle, and for that less obvious, ones. if, on the other hand, the list of selected features must be validated by time-consuming and labour intensive techniques, then a shorter list obtained with as low an fdr as possible is the best. for our objectives, we needed only to have at least a few features selected at each instance in order to be able to draw comparisons, but preferably not too many, and we find this is achieved by controlling the fdr at 10%. we made a fast and easy-to-use implementation of a power and minimal sample size calculation method adapted from ferreira et al.  <cit> . the only input needed is a set of test statistics obtained from the pilot data and the number of samples of the two groups. more details about this r package will appear elsewhere.

CONCLUSIONS
in conclusion relative power and sample size analysis can help researchers make important decisions about technology used for gene expression profiling. we showed that if interest lies in genes expressed in the low-intensity range solexa/illumina deep sequencing is the superieur technology compared to microarray technology. furthermore, we have implemented our method via a bioconductor package so that other researchers can use it on their own pilot data.

authors' contributions
mi performed the data analysis. pach provided the platform comparison data and interpretations of the results, and contributed to the manuscript. pp performed the differential gene expression analysis of the platform comparison. gjejh provide the nutrigenomics data and contributed to the manuscript. jtd was involved in many useful discussions. gjbo actively supported the deep sequencing experiments. jmb was involved in study design and interpretation of results. mi and rxm wrote the manuscript. all authors read and approved of the final manuscript.

supplementary material
additional file 1
adjusting the proportion of non-differentially expressed genes. a description of how the method for adjusting the the proportion of non-differentially expressed genes works.

click here for file

 additional file 2
estimates of proportion of non-differentially expressed genes  using three different methods , as well as estimates of the power. this table enables comparison between the methods used to compute π <dig>  and their effect on power.

click here for file

 additional file 3
example 2: power curves for three technologies and three intensity ranges. the figure has three panels which show power curves for high-, medium-, low-intensity range, with on the x-axis the sample size and on the y-axis the estimated power using a 10% fdr. each panel shows the power as function of the sample size for three technologies affymetrix , agilent  and solexa/illumina dotted green). these plots were obtained without the exclusion of a small region around zero.

click here for file

 acknowledgements
this work was part of the biorange programme of the netherlands bioinformatics centre , which is supported by a bsik grant through the netherlands genomics initiative . the work was conducted within the centre for medical systems biology , established by the netherlands genomics initiative/netherlands organisation for scientific research .
