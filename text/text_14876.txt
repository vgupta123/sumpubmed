BACKGROUND
the adaptive immune response selectively expands b- and t-cell clones from a diverse antigen naïve repertoire following antigen recognition by the hyper-variable regions of b- or t-cell receptors  respectively  <cit> . functional bcrs and tcrs are generated by site-specific recombination of v, , and j gene segments , with imprecise joining of the gene segments leading to random deletion and insertion of nucleotides at the junctional regions. clonal affinity selection for enhanced bcr-antigen or tcr-peptide binding contributes to shaping the mature immune repertoire .

mapping of bcr and tcr repertoires promises to transform our understanding of adaptive immune dynamics, with applications ranging from identifying novel antibodies and determining evolutionary pathways for haematological malignancies to monitoring of minimal residual disease following chemotherapy  <cit> . however, there is concern over the validity of biological insights gained from the different bcr and tcr enrichment, amplification and sequencing methods. with immune repertoire sequencing becoming an increasingly recognised and important tool for understanding the adaptive immune system, we have performed the first systematic comparison between different isolation, amplification and sequencing methods for elucidating b-cell repertoire diversity by deep sequencing. we have used samples of diverse b-cell populations from healthy peripheral blood , clonal b-cell populations from lymphoblastoid cell lines  and pb from chronic lymphocytic leukaemia  patients  <cit> . we have applied a number of approaches to assess the differences between methods. firstly, ighv gene usage is typically reported as an assessment of bcr repertoire structure, where healthy individuals exhibit low frequencies of most or all ighv genes, and where clonal populations have significantly higher frequencies of a single ighv gene or group of ighv genes  <cit> . we formally assess whether there is differential or biased method-specific amplification of each ighv gene by comparing ighv frequencies observed between different methods applied to each sample. secondly, we compare the individual bcr full-length sequence frequencies between different samples to assess the reproducibility of each bcr repertoire method. thirdly, the overall clonality of each sample can be assessed and compared using previously published clonality measures of vertex gini indices, cluster gini indices and maximum cluster sizes using bcr sequence network analysis  <cit> . briefly, the gini index is a measure of unevenness. when applied to the vertex size distribution for a given sample, the gini index indicates the overall clonal nature of a sample, and when applied to the cluster size distribution, the gini index indicates the overall somatic hypermutation in the sample. low vertex gini indices represent diverse populations and high vertex gini indices represent clonal populations of b-cells. similarly, low cluster gini indices represent populations with lower mutational diversity and high cluster gini indices represent clonal populations with higher mutational diversity. the maximum cluster size is the percentage of reads corresponding to the largest cluster and indicates the degree of clonal expansion of a sample. this allows assessment of whether overall bcr repertoire structures are faithfully retained between the different methods.

methods
samples
peripheral blood mononuclear cells  were isolated from 10 ml of whole blood from  <dig> healthy volunteers and  <dig> cll patients using ficoll gradients . total rna was isolated using trizol®  and purified using rneasy mini kit  including on-column dnase digestion according to manufacturer’s instructions. total rna was also isolated from 1× <dig> cells from  <dig> human lymphoblastoid cell lines  from the hapmap project  <cit> . research was approved by relevant institutional review boards and ethics committees , and all subjects gave written consent for the research  <cit> . samples are summarised in additional file 1: table s <dig> 

rna and dna multiplex pcr amplification
multiplex pcr amplification of rna samples were performed according to bashford-rogers et al.  <cit>  . for multiplex pcr amplification of dna, 30 ng of dna was mixed with the jh reverse primer and the fr <dig> forward primer set , using  <dig>  μl phusion® high-fidelity dna polymerase , 1 μl dntps , 1 μl dtt , per 50 μl reaction. the following pcr program was used: 3 minutes at 94°c, 35 cycles of 30 seconds at 94°c, 30 seconds at 60°c and 1 minute at 72°c, with a final extension cycle of 7 minutes at 72°c on an mj thermocycler.

rna-capture
total rna was initially processed for target enrichment using the nebnext kit  according to manufacturers protocol. briefly, mrna was isolated by polya + selection and converted to cdna. cdna at  <dig>  to  <dig>  ng/μl was fragmented to 200 bp , ligated to sequencing adaptors  and size selected at 200 bp . samples were then indexed for pre-capture pooling . a pre-capture library was generated using 12 cycles of pcr . libraries were pooled and hybridised to biotinylated rna-capture baits , agilent sureselect) at 65°c for 24 h. hybridised fragments were selected using streptavidin magnetic beads, washed and eluted for multiplexed sequencing on illumina miseq.

5’race
5’race was performed using smarter™ pico pcr cdna synthesis kit  according to clontech protocols, using the jh-reverse primer  and smarter 5’ primer for pcr amplification.

sequencing methods and read preparation
sequencing libraries were prepared using standard roche- <dig> rapid prep or illumina protocols, and sequenced using an flx titanium genome sequencer  or by 250 bp paired-ended miseq  respectively. raw  <dig> or miseq reads were filtered for base quality  using the quasr program.   <cit> . the 250 bp reads from the 5’race experiment were retained if they contained a jh-reverse primer sequence and orientated to begin with ighv gene. non-immunoglobulin sequences were removed and only reads with significant similarity to reference ighv genes from the imgt database  <cit>  using blast  <cit>  were retained . primer sequences were trimmed from the reads, and sequences retained for analysis only if both primer sequences were identified. reads from rna-capture were blast aligned to reference igh genes, and trimmed if the reads extended outside the ighv-d-j region. reads from each platform were filtered for length  and rna-capture miseq respectively). the combined per-base error-rate for the rt-pcr and sequencing process for the  <dig> and miseq platforms were similar to other studies   <cit> . excluding homopolymeric indels, the per-base error rate for  <dig> is  <dig> ×10− <dig> 

repertoire analysis
for identification of ighv genes, blast  <cit>  was used to align the bcr sequences against known bcr sequences from the immunogenetics  database  <cit>  . network assemblies and diversity measure calculations  were performed according to bashford-rogers et al.  <cit> . statistical analyses were performed in r. differences between  <dig> sequence sets excluded homopolymeric indels.

simulation of sampling bcr populations
for a given sequencing depth n, the range of values, x, within 10% of the true bcr proportion pi would be blower≤x≤bupper 

where blower = n * pi *  <dig>  blower = n * pi *  <dig>  and bupper = n * pi *  <dig> , and 0 ≤ blower, bupper ≤ n. with a sequencing error rate e per base, the probability of successfully sequencing the bcr sequence of length l becomes p = pi − . therefore the probability of sampling within the range x is the sum of the binomial probabilities of the range x: px=∑i=blowerbuppernipi1−pn−i 

to estimate the probability of sequencing at least one read of a given type, the poisson distribution can be employed: px≠0=1−e−λ 

where λ is the expected value of sequencing reads of that type, λ = n * p.

RESULTS
assessing the stochasticity of sampling b-cell repertoires
as exhaustive sampling of b-cells is not possible in humans, the “true” extent of the bcr repertoire in humans can only be estimated. a typical pb sample  accounts for ~ <dig> % of the total pb, from which only a fraction is used in current bcr sequencing methods. therefore, we examined the effect of resampling on repertoire structure. firstly, we repeated repertoire sequencing of the same multiplex pcr products from  <dig> lcl and  <dig> healthy pb samples using  <dig> sequencing . comparing frequency distributions for each ighv gene formally assesses differential representation of particular ighv genes. the ighv frequencies are highly correlated between repeats with a gradient close to unitary  even at low ighv frequencies , suggesting minimal stochasticity introduced through sequencing alone.figure  <dig> 
comparing different rna-capture and amplification methods. a) schematic diagram of all experiments. left side: rna was extracted from b-cell samples, and multiplex rt-pcr performed in triplicate: sequencing repeats , pcr repeats  and sequencing method comparisons . right side: rna was extracted from b-cell samples, and 5’race , rna-capture  were compared to pcr amplification of the same samples . graphs of ighv gene-usage frequency distributions between samples were generated from b) the sequencing repeats, d) rt-pcr repeats, f) sequencing method comparisons, h) multiplex pcr versus 5’race , j) multiplex pcr versus rna-capture . graphs c, e, g, i and k) are ighv gene-usage frequency distributions from only the low frequencies  respectively. point colors are red, blue and green for healthy, lcl and cll samples respectively. the linear regression equation and r2-values are given. l) plot of the probability of sampling within 10% of the true of a bcr proportion with varying read depths  assuming an initial population of  <dig> , <dig> bcr sequences after amplification.



next, we determined the stochastic variation observed when re-sampling  <dig> equimolar portions of the same rna from  <dig> cll pb samples, and repeating both pcr and miseq sequencing . the ighv frequencies were again highly correlated . the correlation is lower than the sequencing repeats suggesting greater re-sampling stochasticity introduced at the pcr steps. as the correlation might be skewed by the very high clonality of the cll samples, the expected correlation between experimental conditions using diverse samples is best assessed from low frequency gene usage, shown in figure 1e. as expected, the correlation between ighv genes present at low frequencies  is less than that of ighvs present at higher frequency reflecting lower probabilities of re-sampling rarer molecules , which is in-line with previous studies  <cit> .

we also used clonality measures, gini index and maximum cluster size, and individual bcr sequence frequencies to determine whether overall bcr repertoire structures were faithfully retained between the repeats  <cit> . these diversity measures correspond to that seen in equivalent sample types in previous studies . these repertoire diversity measures are strongly correlated between both sequencing and rt-pcr repeats . we show that the correlation between the individual bcr frequencies between rt-pcr repeats is strong , although again the correlation is weaker when considering only the low frequency bcrs . therefore, samples from the same rna pool exhibit some re-sampling stochasticity, particularly for low frequency variants. however, overall repeated samples are highly correlated and repertoires are reproducible.table  <dig> 
mean diversity measures for each sample type



sample type
mean maximum cluster size 
mean vertex gini index
mean cluster gini index

healthy

chronic lymphocytic leukemia 

human lymphoblastoid cell line 


assessing differences between sequencing methods
different sequencing platforms each have different read-lengths, depths and error profiles .  <dig> sequencing uses emulsion pcr and pyrosequencing and can produce reads potentially over 800 bp  <cit> , and therefore has the capacity to sequence a full bcr amplicon in a single read. however, the  <dig> platform has high homopolymeric base pair error-rates caused by accumulated light intensity variance . the illumina miseq has the highest throughput per run   <cit>  and lower overall error rate, particularly in homopolymeric regions  <cit> . miseq however has its own distinct error profile of single-base errors associated with ggc motif  <cit>  and at the 3’ end of the reads compared to the 5’ end. miseq can currently generate up to 300 bp paired-end reads that allows for paired-end joining and full coverage of multiplex pcr amplicons. we compared sequencing technologies by taking two portions of rna from  <dig> cll and  <dig> healthy pb samples and performed pcr followed by  <dig> or miseq  sequencing . the ighv frequencies between the sequencing methods were highly correlated . as the correlation might be skewed by the very high clonality of the cll samples, we assessed the correlation at low frequency gene usages. again, greater variation of low frequency variants suggests both effects of stochastic re-sampling and platform-specific differences . the individual bcr sequence frequencies were also highly correlated , suggesting that repertoire structure is retained when using the same amplification method on different sequencing platforms. however, due to the lower homopolymeric indel rate, only the miseq platform is currently appropriate for filtering read sets for open reading frames . miseq also has the advantage of a higher sequencing depth per lane, therefore allowing higher levels of multiplexing of samples and reducing the per-sample cost.

how deep do we need to sequence?
the sequencing depth required depends on the frequencies of clones of interest and sequencing method. reads from all methods were filtered for quality and presence of immunoglobulin sequence as detailed in the methods section. here, the percentage of filtered bcr sequences from pcr amplification was 60% and 76% for miseq and  <dig> sequencing respectively and 55% for 5’race . as the rna-capture baits target both bcrs and tcrs, the percentage of usable bcr sequences was only  <dig> % . therefore, between 35-50x higher sequencing depth is required for rna-capture to obtain the equivalent number of bcr-specific reads compared to the other methods. to determine the number of bcr sequences required for biological studies, we modelled the probabilities of sequencing bcr clones at varying bcr sampling proportions and sequencing depths. assuming an initial population of  <dig> , <dig> bcrs after amplification, when a bcr clone is >4% of the total population, a sequencing depth of only  <dig>  reads has a 95% probability of sequencing within 90% accuracy . for rarer bcr clones, higher sequencing depths can significantly increase sampling accuracy. for example, the probability of sequencing within 90% accuracy for a clone at  <dig> % of the total population is increased from  <dig>  at  <dig>  reads to  <dig>  at  <dig> , <dig> reads . for clones of < <dig> %, increasing the sequencing depth to as high as 1× <dig> does not significantly increase sequencing accuracy due to low re-sampling probabilities. thus, the optimum sequencing depth depends on the samples used and biological question. studies investigating highly clonal disorders, such as cll, require less reads to obtain information about clonal sequence than studies of healthy individuals with diverse repertoires of low frequency clones.

assessing different rna-capture and amplification methods
the three main bcr amplification methods are pcr using igh-specific multiplex primers  <cit> , 5’ rapid amplification of cdna ends   and rna-capture using rna bait/capture probes  <cit> . igh-specific multiplex pcr primers have been designed  <cit> , validated , and used in numerous biological studies . such multiplex pcrs can be performed on either rna or dna and require a relatively small amount of template. however, there is the potential for biased primer annealing and unequal pcr amplification of bcr sequences. rna-capture is based around the methods used for human exome sequencing and uses rna bait/capture probes and subsequent universal pcr amplification  <cit> . this allows for enrichment, amplification and sequencing of tcrs  and bcrs  simultaneously. pcr and rna-capture methods can use rna or dna, but have the potential for sequence-based differential annealing and biased capture. 5’race overcomes this by using a single igh-specific primer for first strand ig cdna synthesis and subsequent sequence-independent template switching primer for second strand cdna synthesis. this eliminates potential multiplex primer bias, but can have low efficiency, high non-specific amplification, and short fragment contamination from rna degradation or incomplete cdna synthesis and template switching . also, as the rna bait probes and multiplex pcr primers are generated from reference ig and tcr gene databases, they lack the same efficiency as 5’race for capturing human allelic variants of tcr or bcr segments that are not represented in the reference database.

to compare the different amplification methods, 5’race  was performed on  <dig> cll and  <dig> healthy pb samples, rna-capture  was performed on  <dig> healthy and  <dig> cll pb, and were compared to multiplex pcr of the same samples . strong ighv gene frequency correlations were observed between pcr and 5’race , and between pcr and rna-capture  . this correlation is again weaker for lower frequency bcr sequences . comparing individual bcr sequences rather than ighv gene frequencies showed strong correlations between all the methods  above 5% bcr sequence frequency. both pairwise-wilcoxon tests and paired t-tests between ighv gene frequencies  showed no significant differentially captured ighv genes between the rna-capture, 5’race or pcr methods. together, we suggest each method here captures similar bcr repertoires.

effect of amplicon length
shorter amplicons give less phylogenetic information and mutational pathways of b-cell clones may be lost, thus artificially separating related bcrs into different clusters. within b-cell networks different bcr sequences can be reduced into the same vertex if the mutations are located outside the read, so clusters have lower numbers of vertices. therefore, we compared the impact of using different length amplicons on the diversity of the generated bcr repertoire. the pcr sequencing reads were trimmed to represent three regions of the igh molecule: i) sequences containing bases within 250 bp from the end of the ighj region , ii) sequences covering the most variable part of the igh molecule, the complementarity-determining region  <dig> , that is often the focus of biological studies, such as  <cit> , or iii) the mean region covered by reads from rna-capture ), . the corresponding bcr sequence networks were generated. the number of unique bcr sequences per sample reduced significantly from  <dig> using the full-length pcr reads to  <dig>   <dig>   <dig> using 5’race-equivalent, cdr <dig> and rna-capture read-lengths respectively . the diversity of the resulting networks using cluster gini indices show significant deviation from the full-length pcr reads . using sequencing platforms with shorter read lengths, e.g. illumina with less than 250 bp reads also lower the potential to capture igh genetic diversity, thus reducing repertoire information. the diversity outside of cdr <dig> is very useful to capture for phylogenetic analysis and ultimately the full-length bcr sequence  is most informative for repertoire analysis.figure  <dig> 
variation of diversity measures with read-length. a) schematic diagram showing the read-lengths from each technique aligned against the bcr gene.  <dig> multiplex sequencing reads were trimmed either between i) containing bases within 250 bp from the end of the ighj region, ii) cdr <dig> region, iii) or the mean region covered by reads from the rna-capture method , and corresponding bcr networks were generated. plots show the variation of b) number of unique sequencing reads and c) cluster gini index. point colors are red, green and blue for healthy pbmc, lcl and cll samples respectively.



rna versus dna: which is best for bcr sequencing?
pcr and miseq  sequencing was performed on both rna and dna fractions from  <dig> cll patients’ pb to compare the effect of input material. first bcr allele defective-rearrangements present in the genomic dna have the potential to artificially increase the number of clones in the data  <cit> , whereas unequal numbers of rna molecules per cell may skew the bcr repertoires derived from rna. an average of  <dig> % of reads from the dna repertoire were represented at least once in the rna repertoire . sequences found in both rna and dna repertoires are likely to be functional bcr sequences, whereas dna sequences not observed in the rna repertoire could either be non-functional by the process of “allelic-exclusion”, or due to the lack of re-sampling. the frequencies of individual bcr sequences from rna compared to the functional dna reads  are strongly correlated  suggesting no repertoire-skewing between the dna and rna proportions, even at low frequencies . therefore, due to defective-rearrangements present in the genomic dna, rna is potentially more informative than dna for understanding bcr population structures.figure  <dig> 
comparison of rna and dna repertoires. rna and dna were extracted from each peripheral blood sample from  <dig> cll patients, on which multiplex rt-pcr or pcr was performed respectively and sequenced by miseq . a) the percentage of dna sequences found in each rna sample. the correlation between the bcr frequency in rna and functional dna repertoires  for the  <dig> cll patients in b) all ighv gene usage frequencies and c) the low frequency ighv gene usage frequencies only . if unequal numbers of rna molecules per cell significantly skewed the rna bcr repertoires, then deviation from y = x correlation would be expected.



CONCLUSIONS
next-generation sequencing of immune receptor genes can provide a quantitative understanding of the landscape of the adaptive immune response. the “true” bcr repertoire in humans is not known, and current methods rely on taking small samples of the total b-cells to estimate the population structure. here we show little sampling bias in repeat samples and that multiplex pcr, rna-capture and 5’race each captures a similar overall bcr repertoire and clonal features of each sample. rna capture offers the advantage of capturing both b and t-cell repertoires. we show that there is no significant inflation or deflation of clonality due to unequal numbers of rna transcripts per cell and suggest that using rna input is more informative for understanding b-cell population structure as genomic dna potentially exhibits artificially increased numbers of clones reflecting biallelic rearrangements in a single clone  <cit> . choice of sequencing platform does not significantly affect the repertoire structure captured but an amplicon and sequence reads covering the entire bcr is most informative for analysis and sequencing depth should be sufficient to allow capture of the bcr frequency of interest. the ability to detect bcr repertoire diversity and sensitivity varies with read length and depth respectively, resulting in an ideal bcr sequencing solution of amplification of the full vdj region to a depth of  <dig> , <dig> to identify unique bcrs at  <dig> % frequency with 90% theoretical accuracy.

we show that the repertoires generated by different sequencing and amplification methods is robust but read lengths, depths and error profiles should be considered in experimental design and multiple sampling approaches could be employed to minimise stochastic sampling issues. we consider the multiplex pcr method to be the most automatable and sensitive method, with consistently good amplification from samples with low numbers of b-cells. the number of pcr cycles can be tailored to the requirement of dna amount required for sequencing, and therefore the best method for large studies or using samples with low cell numbers. we recommend the use of 5’race if a sample is likely to be highly somatically mutated, thus potentially modifying the annealing sites for the multiplex pcr or rna capture. however, we have shown that in cll, where there is ongoing somatic hypermutation, we see no evidence of differential primer annealing ability. rna-capture can be useful for situations where both the b- and t-cell repertoires are to be assessed simultaneously. for sequencing, we recommend miseq as it is able to produce high quality reads covering the full bcr, with read depths allowing for sequencing of many samples on a single run by multiplexing.

additional file
additional file 1: 
supplementary information. description of data: supplemental data file.



abbreviations
bcrb-cell receptor

tcrt-cell receptor

pbperipheral blood

cllchronic lymphocytic leukemia

5’race5’ rapid amplification of cdna ends

lcllymphoblastoid cell line

competing interests

the authors declare that they have no competing interests.

authors’ contributions

rjmb-r, alp and pk designed the study; rjmb-r, si designed and performed the 5’ race and multiplex pcr experiments. dd aided design of the 5’ race experiments. lc, me, rc and mh designed and performed the rna capture experiments. rjmb-r analysed the data; gaf and gsv provided patient samples; gaf and gsv provided advice for the project; rjmb-r, alp and pk wrote the paper, and all authors reviewed and approved the manuscript.

