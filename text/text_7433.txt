BACKGROUND
over the last few years transcriptome deep sequencing  has almost completely taken over microarrays for high-throughput studies of gene expression. in contrast to microarrays, rna-seq technology quantifies expression in counts of transcript reads mapped to a genomic region  <cit> . these read counts are integer numbers ranging from zero to millions. this is why approaches that were developed for the analysis of microarray data are generally not applicable to the analysis of rna-seq data: microarray approaches model the gene expression by continuous distributions. the most common use of rna-seq has been identifying genes that are differentially expressed  between two or more conditions. typically, gene counts are modeled using poisson or negative binomial  distribution, and several commonly used software packages such as edger  <cit> , deseq  <cit> , and samseq  <cit>  adapted for rna-seq, are freely available. recently it was suggested to transform rna-seq count data prior to the analysis and apply normal-based microarray-like statistical methods, e.g. the limma pipeline  <cit>  to rna-seq data  <cit> .

similarly, a decade ago, the focus of microarrays data analysis was also on finding de genes. the methods for microarray data were dominated by univariate two-sample statistical tests for finding de genes. however, it was quickly recognized that  biologically relevant genes with small changes in expression are almost always absent in the list of statistically significant de genes, detected using two-sample tests with the correction for multiple testing  <cit> , and  because genes do not work in isolation, statistical tests need to account for the multivariate nature of expression changes  <cit> . to address the shortcomings of gene-level analyses, conceptually new approaches were suggested which operated with gene sets, i.e. treating a gene set as an expression unit. importantly, differentially expressed gene sets  incorporate existing biological knowledge into the analysis, thus providing more explanatory power than a long list of seemingly unrelated genes  <cit> . to date many methodologies for testing differential expression of gene sets have been suggested and are collectively named gene set analysis  approaches  <cit> .

gsa approaches can be either competitive or self-contained. competitive approaches compare a gene set against its complement that contains all genes except the genes in the set, and self-contained approaches test whether a gene set is differentially expressed between two phenotypes  <cit> . another technique that incorporates biological knowledge into the analysis, that requires a list of pre-selected de genes to proceed, is the gene set over-representation analysis. here, a set of pre-selected significantly de genes is tested for over-representation in annotated gene sets such as gene ontology  categories or kyoto encyclopedia of genes and genomes  using standard statistical tests for enrichment  <cit> . a shortcoming of the over-representation approach is that it still requires a preselected gene list and genes with small changes may not be accounted for  <cit> .

the first competitive gsa test for microarray data analysis  was developed a decade ago, and in the last decade pathways analysis for microarray data has become a method of choice for explaining the biology underlying the experimental results  <cit> . one would expect there to be plenty of gsa approaches suitable for rna-seq data analysis, yet well-tested and justified methods are scarce. the first approach, adapting gsa for rna-seq data, was suggested by young and colleagues  <cit> . they developed goseq, a go categories over-representation analysis that accounts for the over-detection of go categories enriched with long and highly expressed genes in rna-seq data. next, a non-parametric competitive gsa approach named gsva  has demonstrated highly correlated results between microarrays and rna-seq sets of samples of lymphoblastoids, cell lines which have been profiled by both technologies  <cit> . shortly after, wang and cairns  <cit>  suggested seqgsea, an adaptation of gsea to rna-seq data. all of the aforementioned approaches are not without inherent biases: go-seq results depend on the methods selected for finding de genes  <cit> , and competitive approaches  are influenced by the filtering of the data and can even increase their power by the addition of unrelated data and noise  <cit> .

the discussion about the possibility of using self-contained gene-level tests for gsa for microarrays data was on-going for a long time: such tests are straightforward and can be easily designed  <cit> . some authors  were recommending to use gene-level tests for gsa. at the same time, because these tests are not truly multivariate and have much lower power compared to multivariate approaches, some authors  <cit>  were advising against the application of gene-level tests for gsa. in a recent publication gene-level tests were claimed to be the first method of choice for gsa of rna-seq data  <cit> . in the simulation study expression data  were taken from a multivariate normal distribution  <cit> . because reads are integer numbers and are usually modeled using poisson or negative binomial distribution, the simulation results of the study  <cit>  may be inconclusive.

thus far, except for gene-level gsa tests  <cit> , the power and type i error rates of self-contained approaches were not examined in the context of rna-seq data. here we study the performance of several self-contained gsa approaches – multivariate and gene-level – for finding differentially expressed pathways in rna-seq data. the goals of our study are to: 1) describe several non-parametric multivariate gsa approaches developed for microarray data  <cit>  that do not have distributional assumptions and are readily applicable to rna-seq data given proper normalization; 2) evaluate the performance of the four most commonly used rna-seq normalization approaches in combination with the aforementioned non-parametric multivariate gsa; 3) describe how univariate tests specifically designed for finding de genes in rna-seq data can be extended to gene-level gsa tests by using procedures for combining genes p-values into a pathway p-value   <cit> , stouffer’s method   <cit>  and the soft thresholding gamma method   <cit> ); 4) evaluate the performance of the three most commonly used univariate tests for the analysis of rna-seq data  in combination with approaches for combining genes p-values into a pathway p-value; and 5) provide comparative power and type i error rate analyses for multivariate and gene-level gsa tests.

in addition we evaluate whether non-parametric multivariate gsa approaches with different normalizations as well as gene-level gsa tests are prone to different types of selection biases. we check all gsa approaches for over-detection of pathways enriched with long genes. this bias was shown to exist in gene set over-representation analysis  <cit> , but it is currently unknown whether it exists in gsa approaches. we also check whether gsa approaches over-detect pathways with small  number of genes and small  percentage of differentially expressed genes. in conclusion, we provide some recommendations for employing self-contained gsa approaches given rna-seq data.

in what follows we briefly describe several multivariate non-parametric tests  <cit> . we also consider the multivariate roast test  <cit>  designed for microarray data but, given proper normalization, also applicable to rna-seq. then we discuss approaches for combining p-values from univariate tests, such as edger, deseq, and ebayes, specifically designed for the analysis of differential gene expression using rna-seq data sets into a pathway p-value. approaches for rna-seq data normalizations together with a brief description of biological and simulated data used for testing purposes are presented in the end of this section.

methods
hypothesis testing
statistically speaking the problem of finding differentially expressed pathways is a hypothesis testing problem. consider two different phenotypes with n <dig> samples of measurements of p genes for the first and n <dig> samples of measurement of the same p genes for the second phenotype. let the two p-dimensional random vectors of measurements x =  and y =  be independent and identically distributed with the distribution functions f, g, mean vectors μx, μy and p × p covariance matrices sx , sy. we consider the problem of testing the general hypothesis h0: f = g against an alternative h1: f ≠ g, or a restricted hypothesis h0: μx = μy against an alternative h1: μx ≠ μy, depending on the test statistic.

multivariate tests
we adopted the multivariate generalization of the wald-wolfowitz  and kolmogorov-smirnov  tests  <cit>  as suggested by friedman and rafsky  <cit> . these two tests were not used before in the context of pathway analysis with rna-seq data. the multivariate generalization is based on the minimum spanning tree  of the complete network  generated from gene expression data.

for an edge-weighted graph g where v is the set of vertices and e is the set of edges, the mst is defined as the acyclic subset t ⊆ e that connects all vertices in v and whose total length ∑i,j ∈ t 
d is minimal. for the p-dimensional observations x and y, an edge-weighted complete graph can be constructed with n nodes and n/ <dig> edge weights estimated by the euclidean  distance measure between pairs of points in rp. the mst of such graph connects all n nodes  that are close in rp with n- <dig> nodes.

for a univariate two-sample test , the ks test begins by sorting the n = n1 + n <dig> observations in ascending order. then, observations are ranked and the quantity di = ri/n1 − si/n <dig> is calculated where ri  is the number of observations in x  ranked lower than i, 1 ≤ i ≤ n. the test statistic is the maximal absolute difference d = maxi|di|, and h0: μx = μy is rejected for large d. the multivariate generalization of the ks test ranks multivariate observations based on their mst to obtain the strong relation between observations differences in ranks and their distances in rp. the mst is rooted at a node with the largest geodesic distance, and then the nodes are ranked in the high directed preorder  traversal of the tree  <cit> . then, the test statistic d is found for the ranked nodes. the null distribution of d is estimated using samples label permutations, and h0: μx = μy is rejected for a large observed d  <cit> .

for a univariate two-sample test , the ww test begins by sorting the n = n1 + n <dig> observations in ascending order. then, each observation is replaced by its phenotype label , and the number of runs  is calculated where r is a consecutive sequence of identical labels. in the multivariate generalization of the ww test, all edges of mst incident between nodes belonging to different phenotype labels  are removed, and the number of the remaining disjoint subtrees  is calculated. the permutation distribution of the standardized number of subtrees is asymptotically normal, and h0: μx = μy is rejected for a small number of subtrees  <cit> .

we consider two other multivariate test statistics based on their high power and popularity. n-statistic  <cit>  tests the most general hypothesis h0: f = g against a two-sided alternative h1: f ≠ g: nn1n2=n1n2n1+n21n1n2∑i=1n1∑j=1n2lxi,yj−12n12∑i=1n1∑j=1n2lxi,xj−12n22∑i=1n1∑j=1n2lyi,yj1/ <dig> 

here we consider only l = ∥ x − y ∥, the euclidian distance in rp.

in the context of microarray data, a parametric multivariate rotation gene set test  became popular for the self-contained gsa approaches  <cit> . roast uses the framework of linear models and tests whether, for all genes in a set, a particular contrast of the coefficients is non-zero  <cit> . it accounts for correlations between genes and has the flexibility of using different alternative hypotheses, testing whether the direction of changes for a gene in a set is up, down or mixed   <cit> . for all comparisons implemented here the mixed hypothesis was selected. applying roast to rna-seq data requires count normalization first. the voom normalization  <cit>  was proposed specifically for this purpose where log counts, normalized for sequence depth, are used. in addition to counts normalization, voom calculates associated precision weights which can be incorporated into the linear modeling process within roast to eliminate the mean-variance trend in the normalized counts  <cit> . considering that this feature is suited specifically for roast, we apply voom normalization with roast and do not apply any other normalization .

combining p-values obtained using univariate tests for rna-seq
one way of designing a gsa test is to combine univariate statistics for individual genes  <cit> ; we refer to this technique as ‘gene-level gsa’ in what follows. there are two popular univariate tests specifically designed for rna-seq data that rely on negative binomial model for read counts: edger  <cit>  and deseq  <cit> . empirical bayes method  correctly identifies hypervariable genes in the context of microarray data and, when adapted for rna-seq data through voom normalization  <cit> , should be a powerful approach. thus, in our comparative power analysis of gene-level gsa approaches, we include the following univariate tests: edger, deseq, and ebayes. it should be noted that rna-seq counts are normalized for each test based on its recommended normalization method only.

the key question in designing a gene-level gsa test is how to combine statistics  from individual genes into a single gene set score . the problem of combining p-values has been recognized and studied for a long time . many methods for combining p-values are available and can usually be expressed in a form of t = ∑ih, where p-vales are transformed by a function h  <cit> . in particular, fisher’s method  uses h = − 2ln and stouffer’s method  uses h to be the inverse normal distribution function  <cit> .

gamma method  is based on summing the transformed gene-level p-values using an inverse gamma cumulative distribution function gw,1− <dig> where w is the shape parameter, i.e. the combined test statistic is given by t=∑igw,1−11−pi  <cit> . the shape parameter w controls the amount of emphasis given to gene-level p-values below a particular threshold. this feature is imposed by any transformation function h and is referred to as soft truncation threshold   <cit> . it is useful when there is pronounced heterogeneity in effects. the stt is controlled by w such that w=gw,1−11−stt. when w is large, gm becomes equivalent to the inverse normal stouffer’s method which has stt =  <dig> , and when it is  <dig> it becomes equivalent to fisher’s method with stt = 1/e. fridley et al. examined the performance of gm with various stt values and reported that stt values between  <dig>  and  <dig>  tend to give the best power  <cit> . for our study we chose w =  <dig>  that gives stt =  <dig> . .

approaches to normalize rna-seq data before applying multivariate tests
similar to microarray data  <cit> , rna-seq data should be properly normalized before any further statistical tests can be applied. raw counts are neither directly comparable between genes within one sample, nor between samples for the same gene. the counts of each gene are expected to be proportional to both gene abundance and gene length because longer genes produce more reads in the sequencing process. the counts will also vary between samples as a result of differences in the total number of mapped counts per sample . the first normalization for rna-seq data, ‘reads per kilobase per million’ , was suggested by mortazavi et al.  <cit>  and was supposed to guard against over-detection of longer and more highly expressed genes. recently, it was found that rpkm tends to identify weakly expressed genes as differentially expressed  <cit>  and is not able to remove the length bias properly  <cit> . oshlack and wakefield  <cit>  have demonstrated that the t-test power has a dependency on the square root of gene length even after rpkm normalization. while rpkm remains very popular, a number of other normalizations were suggested  <cit> . we employed three frequently used rna-seq normalization strategies to examine the performance of multivariate tests: the read per kilobase per million   <cit> , the quantile-quantile normalization   <cit> , and the trimmed mean of m-values   <cit> . since both qqn and tmm ignore gene lengths, they are followed by rpkm to account for within-sample differences .

instead of searching for better normalization, an alternative way of analyzing rna-seq data is to find a count data transformation such that all approaches developed for microarray data will become applicable  <cit> . it was shown that log counts, normalized for sequence depth, serve perfectly for this purpose when finding de genes . since voom achieves between-samples normalization only, we followed it with rpkm normalization to account for gene length differences. voom returns normalized data in a log scale, so, before applying the rpkm normalization, the data were back-transformed to a linear scale.

importantly, none of these normalizations  have been tested in the context of gsa approaches. here we provide the comparative power analysis of multivariate gsa approaches relying on the four aforementioned normalizations.

sample permutation
the null distribution of the test statistics used for the ww, ks, and n-statistic tests are estimated using sample permutations where sample phenotype labels  are permuted randomly and the test statistic is calculated many times. to get reasonable estimates here this process was repeated  <dig>  times. the empirical estimate of a p-value for a gene set is then taken as the proportion of permutations yielding a test statistic more extreme than the observed one from the original gene set. the same procedure was employed to compute the combined p-value pc for a gene set after gene-level p-values are transformed and combined. this is necessary due to the lack of independence between genes which renders the parametric approach inaccurate.

biological data and pathways
we analyzed the subset of the data from pickrell et al.  <cit> , the sequenced rna from lymphoblastoid cell lines  in  <dig> nigerian individuals. we selected  <dig> unrelated individuals ,  <dig> males and  <dig> females. pickrell et al.  <cit>  dataset  is attractive because there are two natural sets of true positives: genes that are escaping x-chromosome inactivation and are therefore overexpressed in females , and genes that are located on male-specific region of y chromosome and are therefore overexpressed in males . the dataset also contains a natural set of false positives: all x-linked genes that are not escaping inactivation . see additional file  <dig> for more details.

gene counts were obtained by detecting the overlaps between mapped short reads and the list of genomic ranges  under each gene using the bioconductor genomicranges package . short reads, which have non-unique mappings, were discarded. after filtering, the resulting count matrix had a total of  <dig>  annotated genes and  <dig> samples. the normalized counts were transformed to log-scale using the function log <dig> to further reduce the effects of outliers. .

except xi, msy, and xie other gene sets were taken from the c <dig> pathways set of the molecular signature database   <cit> . these gene sets were curated from online databases, biomedical literature, and knowledge of domain experts. genes not present in the filtered dataset were discarded, and only pathways with the number of genes  in the range of 10 ≤ p ≤  <dig> were included. the resulted dataset comprised  <dig>  genes and  <dig>  pathways. one c <dig> pathway, disteche_escaped_from_x_inactivation , contains  <dig> x-linked genes found in our filtered dataset that were reported to escape inactivation  <cit> . while we can’t be sure if the other c <dig> pathways are differentially expressed between males and females, we expect that at least the three aforementioned pathways  should be, and the xi pathway should not be detected by any gsa test. additional file  <dig> provides lists of all the genes and their descriptions in msy, xie, dex and xi gene sets.

simulation of rna-seq counts
we model the count for a gene i in sample j by a random variable yij from negative binomial  distribution yij ~ nb) = nb, where μij and φij are respectively the mean count and dispersion parameter of gene i in sample j. for each gene in a gene set, a vector of mean counts, dispersion, and gene length information , is randomly selected from a pool of vectors derived from the processed nigerian dataset . the dispersion parameter for each gene was estimated using the bioconductor package edger  by the empirical bayes method  <cit> . counts, normalized using different approaches, were transformed to log-scale using the transformation function log <dig> to further reduce the effects of outliers. additional file 3: figure s <dig> and s <dig> show the density and histogram plots for the original counts and nb simulated counts before and after different normalizations. the simulated counts match the original counts reasonably well.

to evaluate the tests performance as accurately as possible, simulation experiments should mimic real expression data as closely as possible. in a real biological setting, not all genes in a gene set are differentially expressed, and the fold changes of genes between different phenotypes can vary. therefore, we introduced two parameters: γ, the percentage of genes truly differentially expressed in a gene set; and fc, the amount of fold change in gene counts between two phenotypes. these parameters are expected to influence the power of different tests on a different scale. for the γ parameter, we consider γ∈{1/ <dig>  1/ <dig>  1/2}, and for the parameter fc, the values span the range from  <dig>  to  <dig>  using simulations we assess the detection power for all tests by testing the hypothesis h0: μx = μy  against an alternative h1: μx ≠ μy .

we simulated two datasets of equal sample size, n/ <dig>  forming  <dig>  non-overlapping gene sets, each constructed from p random realizations of nb distribution. these two datasets represent two biological conditions with different outcomes. for a gene set in one phenotype, we generate p random realizations of nb distribution with parameters . for the same gene set in the second phenotype, we generate nb realizations with parameters  when i ≤ γp represents de genes and nb realizations with parameters  when i > γp represents non-de genes. two cases were considered in our simulations: when the number of genes in a gene set is relatively small  or when the number is relatively large . to avoid having all the de genes up-regulated for all generated gene sets in one phenotype, we swapped the generated counts for half of the de genes  between the two phenotypes. hence, now in each generated gene set, half of the de genes are up-regulated and half are down-regulated between the two phenotypes. this will also avoid the problem of having large differences in total counts per sample between the two phenotypes.

to estimate the type i error rates for all tests using simulated count data, we set fc and γ to  <dig> and simulated two datasets of equal sample size, n/ <dig>  from  <dig>  gene sets, each constructed form p random realizations of negative binomial distribution with parameters  where p∈{ <dig> ,100}. then, we estimate the proportion of gene sets that reject h0: μx = μy  among the  <dig>  generated sets.

RESULTS
simulation study
type i error rate
table  <dig> presents the estimates of the attained significant levels for the multivariate tests with different normalizations. as expected as the sample size n increases, the type i error rates decrease. when the sample size is small , n-statistic with voom normalization gives the most conservative type i error rate, followed by roast . this can be explained by voom’s ability to model the mean-variance relationship of count data for small n. but when the sample size is larger, tmm almost always gives more conservative estimates than voom . ww seems to be the most liberal among multivariate tests, followed by ks. for every test the type i error rate is virtually unaffected when the number of genes in a pathway  increases.table  <dig> 
type i error rates for multivariate methods, α =  <dig> 


p 
= 
16
p 
= 
60
p 
= 
100
rpkm
qqn
tmm
voom
rpkm
qqn
tmm
voom
rpkm
qqn
tmm
voom





we next consider type i error rates for gene-level gsa tests that use univariate rna-seq specific tests  and employ different methods for combining p-values . to better understand the functional relationship between the transformed and the original p-values we applied the transformation functions h  to a range of p-values .figure  <dig> 
the functional relationship between the transformed and the original
p-
values for different transformation functions
h
.




figure  <dig> shows interesting biases that are introduced by different transformations . first, gm is only sensitive to the extremely small p-values and virtually ignores all the others. in practice it means that gene sets with a large number of genes will be called de by tests with gm more frequently than gene sets with a small number of genes. this is expected because, by pure chance alone, gene sets with a large number of genes have higher probability to contain genes with extremely small p-values, and gm ignores all the others. second, fm accounts not only for the extremely small p-values, but also for generally small p-values, as well as large p-values. therefore, tests with fm would call a gene set de if and only if most of the genes in a gene set have small p-values. gene sets with a large number of genes will be called de by tests with fm less frequently than gene sets with a small number of genes, because, again, by pure chance alone, gene sets with a large number of genes have higher probability to contain genes with large p-values and large p-values affect the fm score . third, unlike fm and gm, sm maps p-values less than  <dig>  and greater than  <dig>  to positive and negative values with magnitudes depending on the deviation from  <dig>  . as a result tests with sm would call a gene set de if and only if all genes in a set have small p-values. similar to tests with fm, tests with sm are expected to call de gene sets with a small number of genes.

the simulation results clearly demonstrate that the type i error rates are influenced by the aforementioned biases introduced by different transformation functions . as expected, for all gene-level gsa approaches that use univariate tests and different transformation functions to combine p-values, tests with gm show the highest type i error, followed by tests with fm and sm . also, for any p-values combining method, edger shows the highest type i error, followed by deseq and ebayes respectively. in addition, with gm transformation, when the number of genes in a gene set  increases, especially for edger and deseq, the type i error rate becomes extremely high.table  <dig> 
type i error rates for gene-level gsa methods, α =  <dig> 


p 
= 
16
p 
= 
60
p 
= 
100
edger
deseq
ebayes
edger
deseq
ebayes
edger
deseq
ebayes





the power to detect shift alternatives
figure  <dig> presents the power estimates for the n-statistic, ww and ks multivariate tests with different normalizations and roast with only voom followed by rpkm normalization , when h1: μx ≠ μy is true . it appears that roast outperforms all the other approaches followed respectively by the n-statistic, ww, and ks. different normalizations do not affect the tests’ power at all . when n =  <dig> and p =  <dig> , n =  <dig> and p =  <dig> , n =  <dig> and p =  <dig>  the results are similar, but the power to detect even small fold changes is higher for all tests.figure  <dig> 
the power curves of multivariate tests with different normalizations when shift alternative hypothesis

holds true and the number of genes in pathways
p 
= 
16
.




figure  <dig> presents the power estimates for gene-level gsa approaches that use univariate tests  and employ different methods for combining p-values  when h <dig> is true . when the percentage of truly differentially expressed genes is small , all three tests that apply gm have slightly higher power than those tests with fm, while the power of tests with sm is much smaller. when γ increases  the difference between tests with gm and tests with fm diminishes, and the power of tests with sm becomes very close to the power of tests with fm and gm. the results when n =  <dig> and p =  <dig> , n =  <dig> and p =  <dig>  and n =  <dig> and p =  <dig>  are similar, but the power to detect even small fold changes is higher for all tests. comparing the performance of the three univariate tests under each p-value combining method shows that edger has slightly higher power than deseq and ebayes, with both fm and gm, while ebayes has slightly higher power than edger and deseq with sm . additional file 3: figure s <dig> , additional file 3: figure s <dig> , and additional file 3: figure s <dig>  demonstrate a similar pattern with even more insignificant differences.figure  <dig> 
the power curves of gene
-
level gsa methods when shift alternative hypothesis

holds true and the number of genes in pathways
p 
= 
16
.




to summarize, figures  <dig> and  <dig> demonstrate, that when a gene set has only a few differentially expressed genes , edger  has a higher power to detect very small fold changes than the other multivariate and gene-level gsa methods. however, when γ = 1/ <dig> and γ = 1/ <dig>  roast has the same power as edger with gm or fm. it should be noted that the higher power of edger with gm or fm is caused by the higher type i error of edger with gm or fm .

the analysis of the nigerian dataset
type i error rate
to estimate how different tests control the type i error rate for the real data, we performed intra-condition comparisons using only male samples from the nigerian dataset. the male samples were randomly distributed over two groups, and gsa was conducted using all tests over c <dig> pathways from the msigdb  <cit>  database. there should be no gene sets differentially expressed between these two groups. the type i error rate was averaged over  <dig> sample permutations . for multivariate tests, roast has the lowest average type i error rate, followed by n-statistic, ks and ww. similar to the simulated data when the sample size is large, for real data tmm and qqn normalizations have lower average type i errors than rpkm and voom.table  <dig> 
average type i error rates attained from nigerian male samples, α =  <dig> 


rpkm
qqn
tmm
voom


interestingly, for gene-level gsa tests with different p-values transformations , the type i error rate estimates on real data mimic exactly the type i error rate estimates on simulated data . all three tests  that apply gm show the highest type i error followed by tests with fm and sm respectively. under each p-value’s combining method, edger has the highest type i error rate, followed by deseq and ebayes.

the type i error rate estimates on real and simulated data are perfectly correlated for gene-level gsa tests. for real data and multivariate tests, tmm and qqn normalizations lead to the more conservative type i error rate estimates.

detected pathways
while, for real data, the type i error rate of different gsa approaches can be directly evaluated by using two subsets from the same group, there is no straightforward and unbiased way to evaluate their power. we selected the nigerian dataset  <cit>  because it contains two sets of true positives: genes that are escaping x-chromosome inactivation and are therefore overexpressed in females , and genes that are located on male-specific region of y chromosome and are therefore overexpressed in males . all tests detect msy, xie, and dex  with high significance. all tests fail to detect xi  except for the univariate tests with gm, because univariate tests with gm have the highest type i error rate .

except for pathways containing gender-specific genes, there is no set of pathways that are guaranteed to be differentially expressed between male and female samples. we therefore decided to examine the entire set of c <dig> pathways with the goal to quantitatively characterize different methods based on:  a number of detected pathways at the different significance levels;  the average number of genes in detected pathways;  the average length of genes in detected pathways; and  the percentage of differentially expressed genes in detected pathways. this information will clarify whether there are methods that are:  overlay liberal ;  biased in terms of the number of genes in detected pathways;  biased in terms of the average gene length in detected pathways; or  detecting only pathways with small  number of differentially expressed genes.

among multivariate tests ww is the most liberal . ks is the next most liberal . n-statistic is more conservative than both ww and ks . roast is the most conservative among multivariate tests . methods with qqn normalization detect slightly more pathways as compared to the same method with other normalizations.

univariate tests with gm detect by far the highest number of pathways . tests with sm are the most conservative among methods , followed by fm . these observations are in agreement with the type i error rate estimates for univariate tests with different approaches for combining p-values .

the venn diagrams in figure  <dig> show the common pathways detected  by multivariate tests with different normalizations  and univariate tests with different p-values combining approaches. n-statistic detects more common pathways with roast than ww and ks and also has more common pathways across different normalizations . both ww and ks have much more unique pathways detected by one normalization method than n-statistic . when α =  <dig>  only highly significant pathways are detected, consequently, ww and ks now show similar common groups with roast .figure  <dig> 
venn diagrams showing the number of common pathways detected in the processed nigerian dataset by multivariate tests with normalizations and univariate tests with combined
p
-
values for gene
-
level gsa methods .  n-statistic with different normalizations and roast;  ww with different normalizations and roast;  ks with different normalizations and roast;  edger with different p-values combining methods;  deseq with different p-values combining methods;  ebayes with different p-values combining methods;  univariate tests with fm;  univariate tests with sm;  univariate tests with gm.



univariate tests with different p-values combining methods have very small overlap between pathways detected by different approaches , as compared to multivariate tests. the overlap between pathways detected by different univariate tests with the same p-value combining method  is larger than the overlap between pathways detected by the same univariate test with different methods for combining p-values . this demonstrates that the p-value combining method is the more important factor than the test itself in detecting de pathways.

figure  <dig> shows the number of genes, the percentage of de genes, and the average gene length in detected pathways for all tests . the de genes in each pathway were found using ebayes. figure  <dig> confirms the presence of biases in gene-level tests for gsa that are introduced by different p-value combining approaches. tests with sm and fm favor pathways with a small number of genes and require larger percentages of de genes in order to detect a pathway. on the contrary tests with gm favor pathways with a large number of genes and require less percentage of de genes to detect a pathway.figure  <dig> 
the percentage of de genes
,
number of genes and average gene length in detected pathways in the processed nigerian dataset by different methods.




to test whether there are methods that detect pathways with average gene lengths significantly different than the average gene length of all  <dig> c <dig> pathways, wilcoxon’s non-parametric test was applied. all univariate tests with gm, ebayes with sm, and ww with any normalization, detect pathways with longer genes than the average. the deviation found in ebayes with sm can be attributed to a small number of detected pathways with a small number of genes, which doesn’t allow accurate estimation of the average gene length per detected pathways. on the other hand, tests with gm detect a large number of pathways with a large number of genes, and it also makes the estimate of the average gene length per detected pathway biased.

discussion
here we have presented a comparative power and type i error rate analyses for self-contained gsa approaches that could be possibly used for rna-seq data. in contrast to microarrays, rna-seq data consists of discrete counts, therefore gsa approaches developed for microarrays are not directly applicable to rna-seq. we have evaluated and compared three multivariate non-parametric approaches  in combination with four different normalizations , roast,  <cit>  and gene-level gsa methods that use univariate rna-seq specific tests  and employed different methods for combining p-values . in sum we analyzed the performance of twenty-two combinations of tests, including normalization and p-value combining methods in the analysis of rna-seq data. all approaches were evaluated on simulated and real data, and their significance was evaluated from sample permutations.

we found that for simulated data the type i error rate and the power of different multivariate approaches in combination with four different normalizations were virtually unaffected by different normalizations. it should be noted that the type i error rate was only slightly  affected by the normalization used, while the power was not affected at all. expectedly, both measures were seriously affected by different test statistics. the best-performing approach, in terms of the smallest type i error rate and the largest power, when the percentage of truly de expressed genes in a pathway  and a fold change  were small, was roast  <cit> , closely followed by n-statistic. multivariate non-parametric wald-wolfowitz and kolmogorov-smirnov had the smallest power and the largest type i error rates with all normalizations. the type i error rate estimates on real data reproduced the trends observed on simulated data. again, roast was the most conservative approach among multivariate tests, and different normalizations didn’t affect the type i error rates as much as the different test statistics. all of the tests were able to detect gender-specific pathways  as differentially expressed between male and female samples with high significance. xi was not detected by any test.

we also examined the entire set of c <dig> pathways to quantitatively characterize different methods. the analysis of all c <dig> pathways confirmed that roast is the most conservative among multivariate tests, having the least amount of de pathways detected. similarly to the simulated data, roast was closely followed by n-statistic. again, for real data, only multivariate test statistics and not normalizations influenced the results to a measurable extent. thus, on simulated and real data, in terms of the type i error rate and power, roast and n-statistic outperformed all other tests, independently of the normalization used. we did not find any evidence of bias for multivariate tests in terms of the number of genes, or the percentage of de genes in detected pathways with any type of normalization. surprisingly, among all multivariate tests, multivariate non-parametric wald-wolfowitz with any normalization detected pathways with longer genes than the average. it might be related to the fact that ww was the most liberal test among all multivariate tests considered.

for the simulated data, gene-level tests for gsa were heavily dependent on the method used for combining p-values, and the differences in power and type i error rate between univariate tests with the same approach for combining p-values were much smaller than the differences when the same test, but different combining p-values approaches, were applied. when the percentage of truly differentially expressed genes  and fold changes were small, all three tests  with gm outperformed tests with fm and sm. this difference disappeared when γ increased.

for gene-level tests for gsa, it appeared that trends in type i error rates, estimated from real data, were again similar to the trends in simulated data. all gene-level tests for gsa detected gender-specific pathways, but, in addition, all tests with gm detected the xi pathway that should not be detected. for gene-level tests for gsa, the analysis of all c <dig> pathways shows that all of them  have very small overlap between pathways detected by different approaches as compared to multivariate tests. the overlap between pathways detected by different univariate tests with the same method for combining p-values was larger than the overlap between pathways detected by the same univariate test with different methods for combining p-values, but still in an order of magnitude smaller than for multivariate tests . this indicates that, first, the p-values combining method is the leading factor in detecting de pathways using gene-level tests for gsa, and, second, for real data they have less power than multivariate approaches in an order of magnitude.

the analysis of c <dig> pathways on the nigerian data confirmed our expectations, which were formed by the analysis of the functional dependencies between the original and transformed p-values for different p-values combining methods . all tests with gm exclusively detected pathways with a large number of genes and a small percentage of de genes as compared to the other approaches. all tests with sm exclusively detected pathways with a small number of genes and a large percentage of de genes as compared to the other approaches. the type i error rate, the number of genes and the percentage of de genes necessary to detect a pathway for all tests with fm, were exactly in-between gm and sm: smaller than for all tests with gm and larger than for all tests with sm. in agreement tests with gm and ebayes with sm all detected pathways with longer genes than the average .

the results from simulated and real data show that gene-level tests for gsa with gm have the highest type i error rates and the highest power. in addition all tests with gm had the highest number of genes and the smallest percentage of truly de genes in detected c <dig> pathways. these observations indicate that the gain in power for tests with gm is caused by the gain in false positives. tests with sm had the smallest power and the smallest type i error rates, while the results for tests with fm were intermediate.

it should be noted that recently edger with gm was found to outperform many other approaches for gsa in terms of power and type i error rate and was recommended for rna-seq data analysis  <cit> . indeed, we observed that edger with gm had the highest power among all the other approaches. in a recent publication edger with gm was suggested to be the first method of choice for gsa of rna-seq data  <cit> . in contrast to this result, our study showed that for simulated and real data edger with gm has the highest type i error rate among all the other tests for gsa. we hypothesize that the difference between the two studies stems from the way the data were simulated. in our study we used the negative binomial model, which is used in edger for finding de genes. in  <cit>  the multivariate normal distribution with fixed correlation structure was used, but, surprisingly, edger was used for finding de genes. therefore, in the latter case, the distributional assumption of the method  was not met, which could have led to the bias in the estimation of the type i error rates. however, all simulations are only crude approximations of biological reality. to estimate the type i error rates on the real data, we performed intra-condition comparisons using only male samples from the nigerian dataset: there should not be gene sets differentially expressed between these two groups. again, edger with gm had the highest type i error rate for real data among all other tests, confirming that in contrast with  <cit>  results, edger with gm has inadequate control of the type i error rate.

CONCLUSIONS
overall, for the self-contained category of gsa, multivariate gsa tests are insensitive to different normalizations and have better control of type i error rates and higher power as compared to gene-level gsa tests, both on simulated and real data. in addition, while standard gene set over-representation analysis shows as over-represented categories with longer genes  <cit> , standard multivariate gsa tests  with different normalizations do not have any biases in terms of the pathway size, the percentage of de genes, or the average gene length in a pathway. the opposite is true for all gene-level gsa tests. thus, our study argues against the use of gene-level tests for gsa whether with fisher’s combining probabilities method  <cit> , or stouffer’s method  <cit> , or the soft thresholding gamma method  <cit> , and emphasize the importance of using non-parametric multivariate tests for detecting de pathways for rna-seq data.

availability of software
software implementing the multivariate generalizations of the kolmogorov-smirnov and wald-wolfowitz tests in r was released within the gsar package in version  <dig>  of bioconductor .

additional files
additional file 1: 
supplementary material containing background, details of data processing steps and supplementary tables s1-s <dig> 


 additional file 2: 
supplementary lists of all the genes and their descriptions in msy, xie, dex and xi gene sets.


 additional file 3: 
supplementary figures containing supplementary figures s1-s <dig> 


 abbreviations
dedifferentially expressed

gsagene set analysis

gseagene set enrichment analysis

wwwald-wolfowitz

kskolmogorov-smirnov

roastrotation gene set test

fcfold change

fmfisher’s method

gmgamma method

smstouffer’s method

sttsoft truncation threshold

rpkmreads per kilobase per million

qqnquantile-quantile normalization

tmmtrimmed mean of m-values

nbnegative bionomial

msymale specific genes of chromosome y

xiechromosome x genes inactivation escaping

dexdisteche escaped from chromosome x inactivation

msigdbmolecular signature database

gogene ontology

keggkyoto encyclopedia of genes and genomes

competing interests

the authors declare that they do not have any competing interests.

authors’ contributions

gg and yr designed the study, performed the analysis and wrote the manuscript. fes contributed to the comparative power analysis and manuscript writing. all authors read and approved the final manuscript.

we are grateful to anonymous reviewers whose comments have helped us improve the manuscript. we thank our colleague nia indelicato for editorial help. support has been provided in part by the national center for advancing translational science award ul1tr <dig> and the idea networks of biomedical research excellence  grant p20rr <dig>  fes is supported by the epsrc . large-scale computer simulations were implemented using the high performance computing  resources at the ualr computational research center supported by the following grants: national science foundation grants cri cns‐ <dig>  eps‐ <dig>  mri cns‐ <dig>  and oise‐ <dig> 
