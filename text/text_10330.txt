BACKGROUND
evolution of complex adaptive features is a fundamental subject in evolutionary biology  <cit> . central questions in relation to this subject include whether the origin of complex features was gradual or sudden, and how the evolutionary changes that generated these features accumulated over long time periods  <cit> . leaf mimicry in butterfly wings  provides a striking example of complex adaptive features and has led to speculation about how wing patterns evolve a close resemblance to leaves from an ancestral form that did not resemble leaves  <cit> . conflicting perspectives on the evolution of leaf mimicry have led to controversial and contrasting hypotheses  <cit> . the origin of leaf mimicry and the process by which it evolved have not been resolved.

the genus kallima comprises leaf butterflies that display transverse, leaf-like venation across the ventral sides of the fore- and hindwing . the leaf pattern consists of a main vein and right- and left-sided lateral veins, each of which contain pigment elements whose spatial arrangement generates the leaf-like appearance . leaf mimicry in kallima spp.  was described by wallace as ‘the most wonderful and undoubted case of protective resemblance in a butterfly’  <cit> . following this description, darwin, poulton, and modern evolutionary biologists have argued that the leaf mimicry pattern is a product of gradual evolution by natural selection  <cit> . in contrast, mivart pointed out that although leaf mimicry is assumed to be an evolutionary adaptation, its chance of establishing in a population is predicted to be low because poor mimicry of a target during the incipient stages of evolution would lead to an increased probability of predation  <cit> . goldschmidt advocated the sudden emergence of leaf mimicry patterns  without intermediate forms  <cit> . despite enthusiastic debate, there is as yet no direct experimental evidence for the gradual evolution of the leaf pattern.figure  <dig> 
nymphalid ground plan and
kallima inachus
leaf wing pattern.  when resting, k. inachus folds its fore- and hind wings and displays a leaf-like pattern to potential predators.  nymphalid ground plan: this scheme consists of  <dig> elements. the three pairs of symmetry pattern elements include the proximal  and distal  bands designated as basal , central , and border  elements. four additional elements are designated as root , submarginal and marginal , discal spots  and a serial array of eye spots .  male ventral wings, resembling transverse leaf venation across fore and hind wings.  the leaf venation pattern is composed of several pattern elements representing a main vein and right and left lateral veins .  the nymphalid ground plan of the k. inachus leaf pattern analysed in this study.
nymphalid ground plan of nymphalinae butterfly wing patterns. using a comparative morphological approach, we dissected the extraordinarily diversified wing patterns into an assembly of nymphalid ground plan  elements. the right, ventral wings are shown  with drawings of the ngp . 
araschnia levana, 
mynes geoffroyi, 
symbrenthia hypselis, 
symbrenthia lilaea, 
hypanartia lethe, 
hypanartia dione, 
hypanartia kefersteini, 
vanessa cardui, 
vanessa atalanta, 
vanessa indica, 
antanartia delius, 
aglais io, 
aglais urticae, 
kaniska canace, 
nymphalis vau-album, 
polygonia c-album, 
polygonia c-aureum, 
hypolimnas bolina, 
precis andremiaja, 
precis archesia, 
precis octavia, 
junonia westermanni, 
junonia hierta, 
junonia orithya, 
junonia coenia, 
junonia lemonias, 
junonia almana, 
junonia atlites, 
junonia iphita, 
junonia erigone, 
junonia hedonia, 
salamis anteva, 
salamis cacta, 
protogoniomorpha anacardii, 
protogoniomorpha parhassus, 
yoma algina, 
yoma sabina, 
doleschallia bisaltide, 
kallima paralekta. colours are the same as those used in figure  <dig> 



we focused on the phylogenetic evolution of leaf mimicry patterns, for which a key principle is the ‘body plan’ or ‘ground plan’, referring to the structural composition of organisms by homologous elements shared across species  <cit> . notably, butterfly wing patterns are thought to be based on a highly conserved ground plan   <cit> . the ngp describes the extraordinary diversification of wing patterns as modifications of an assembly of discrete pattern elements shared among species, which are suggested to be homologous and inherited across species. previous studies have suggested the existence of the ngp in numerous species  <cit> , including the wing patterns of leaf moths  <cit>  and kallima inachus  <cit> . the ngp has also been validated by experimental molecular data  <cit> . if the ngp was present in both leaf mimics and non-mimetic butterflies, this would provide an opportunity to examine the evolution of leaf mimicry from non-mimetic patterns by tracing changes in the states of ngp elements through phylogeny.

the identification of homology provides a foundation for statistical testing of the likelihood of trait evolution within a phylogenetic framework. we employed bayesian phylogenetic inference using bayestraits  <cit> , which provides a platform for reconstructing ancestral states of traits  <cit>  and for analysing the dependent evolution of state transitions  <cit> . furthermore, given the rates of state transitions in traits, it is possible to assess whether changes in one trait are contingent upon the background state of another. in this analysis, contingency was defined as temporal dependency in trait evolution  <cit>  and quantified  as the degree of influence of unique, chance historical events on subsequent evolution . recent studies have documented well-supported molecular phylogeny of kallima and closely related species   <cit> , which facilitates bayesian phylogenetic inference.

our objectives were to generate statistical estimation of  ancestral wing patterns given a lineage of leaf mimicry evolution, and  evolutionary process of accumulation in state changes of ngp elements. through these analyses, we examined whether leaf mimicry evolved through gradual or sudden changes and whether these changes accumulated independently or contingently. here, we show the evolutionary origin and process of the kallima leaf pattern. we demonstrate that the leaf pattern is composed of an array of discrete elements described by the ngp that are also present in the wing patterns of closely related species. these results strongly suggest that evolution of the kallima leaf pattern can be traced by changes in the states of ngp elements. we then use bayesian phylogenetic methods to reconstruct ancestral wing patterns, and describe the evolution of leaf patterns through stepwise changes in intermediate states from the non-mimetic ancestral pattern.

methods
sampling strategy
the species used in this study were selected to represent major groups of nymphalinae, which includes three higher taxa . among all genera  comprising these three higher taxa, we selected  <dig> genera . among all species  comprising these  <dig> genera, we sampled  <dig> species  . in the analyses, one major group of nymphalinae, melitaeini, was excluded because of very autapomorphic wing patterns  <cit> , except for the following  <dig> species from  <dig> genera: euphydryas phaeton, melitaea cinxia, phyciodes cocyta, and chlosyne janais. phylogenetic comparative methods assume that extant species are either completely or proportionally sampled from the taxon of interest. we thus intended to minimize the effects of biased sampling on our statistical inferences by selecting representative species sampled from almost all genera. to evaluate whether the species we selected are representative of their genus with regard to wing patterns, we checked photos of butterfly wing patterns from validated and private web sites . because our analyses focus on geometrical characteristics  of pigmental elements forming wing patterns , it is necessary to select species displaying representative wing patterns in the genus that the species belong to. therefore, we observed the specimens and photos to determine whether the  <dig> characteristic states of the ngp used for phylogenetic comparative analyses are typical of the genera. we checked  <dig> species  and confirmed the unbiased selection of the species used in this study. for example, in the genus kallima, the two species we selected  appeared to be representative to this genus because they exhibited wing patterns similar with to those of another species  with regard to the nymphalid ground plan  . thus, although the results should be interpreted cautiously, we are confident that by applying unbiased sampling of species from most genera, we conducted a practical estimation of the evolution of wing patterns.figure  <dig> 
bayesian inference of ancestral character
-
state reconstruction of wing pattern evolution.  leaf vein features of the kallima wing pattern were coded as  <dig> characters  as follows: ch 1: parallelism of ds and b; ch 2: attachment of ds and cp; ch 3: cd a single broken straight line; ch 4: bending of bop to distal side; ch 5: straightness of upper side of bop; ch 6: vestigiality of ess; ch 7: vestigiality of b; ch 8: fragmentation of cp; ch 9: vestigiality of ds; ch 10: straightness of cd; ch 11: vestigiality of ess. these characters were also surveyed in the closely related species and coded as one of two binary states . characters in forewings  and hindwings  are coloured as in figure  <dig>   reconstructed ancestral character states are represented as pie charts indicating bayesian posterior probability at four selected nodes  by shaded circles . in the molecular phylogeny, genus kallima is highlighted in the red box. b, cp, cd, bop, ds, and ess are defined and presented in figure  <dig> 



molecular phylogenetic analysis
to take phylogenetic and branch-length uncertainty into account in our analyses, we generated bayesian trees by combining three recently published datasets  <cit>  and confirmed that our phylogeny was consistent with that proposed previously . we used eight nuclear  and one mitochondrial  gene sequences to reconstitute the phylogenetic tree of the species included in the analysis. multiple alignment was performed using clustalw  <cit>  in mega <dig>  <cit>  as previously described  <cit> . in brief, we aligned the nucleotide sequences based on their translated amino acid sequences, and the aligned sets of genes were concatenated for use in subsequent analyses. species names and genbank accession numbers of sequences used in this study are provided in additional file 1: table s <dig>  the original images of voucher specimens are cited in the nsg’s dna sequences database . six species  were used as the outgroup taxa. we constructed datasets composed of  <dig>  nucleotide sites from nine concatenated genes.

we used partitionfinder  <cit>  to identify nucleotide substitution models and partitioning strategies for the dataset. breaking down the nucleotide data by codon position resulted in  <dig> partitions , which were combined to result in nine partitions. a nucleotide substitution model was selected for each partition using the number of sites as the sample size based on the bayesian information criterion  . the sequence data as well as phylogenetic analysis are also available at treebase . we used mrbayes  <dig> . <dig> for the bayesian inference of phylogenetic trees, which includes the assumption of proportional branch length among the partitions. we ran four concurrent analyses of 2 ×  <dig> generations with eight chains each  using different random starting trees, and sampled every  <dig> generations. runs of all procedures were checked for stationarity, convergence, and adequate mixing of the markov chains using tracer version  <dig>   <cit> . from each data set, we discarded the first  <dig>  samplings as burn-in and combined the resulting mcmc tree samples for subsequent estimation of posteriors.

comparative morphological analysis for character assignment
identification of the ngp elements was conducted based on remane’s criteria, a validated comparative morphological procedure used in systematic studies  <cit> . this criterion consists of three principal rules: 1) similarity of topographical relationships, 2) similarity of special features, and 3) transformational continuity through intermediate ontogeny or phylogeny. we used the first and second criteria in this study. the first criterion is logically consistent with geoffroy st. hilaire’s ‘principe des connexions’  <cit> . to use this criterion, it is necessary to set the fixed point of the topographical frame, which is explicitly referenced by rieppel  <cit> . the position of the discal cell  is suggested for use as the fixed point for investigations of butterfly wing patterns  <cit> . the identification procedure was performed as follows:  using the discal cell as a fixed point, the ds and b  are easily identified;  according to the topographical relationships among elements, the cp was identified between the ds and b;  unique concentric shapes  formed a series of ess;  the cd and bop were arrayed in an orderly fashion from the ds to ess; and  bod was identified at the outer location of the ess. to confirm the identification of the ngp elements, we observed several specimens and used photographs from the nsg’s dna sequence database . although some species were referenced in previous studies  <cit> , there was no previous foundation for their validation. we used this rigorous method to identify the ngp; to clearly relate the positions of morphological elements to features of the wing veins, pigment cells surrounding the wing surface were carefully removed . although the ngp of the wing patterns was rigorously identified by a comparative morphological procedure, such determinations of homology remain hypothetical because of the lack of developmental genetic data.

character coding
morphological characteristics of butterfly wing patterns have been coded based on the ngp and systematic observations of individual specimens  <cit> . because the present study specifically focused on the evolution of leaf mimicry patterns in kallima spp., character coding should be performed relative to the morphological characteristics of this species wing pattern. therefore, we coded the morphology of wing-pattern elements as one of two states:  <dig>  or  <dig> . this coding strategy, where all states other than the one of interest are collapsed into a single state , was previously studied  <cit> . eleven morphological characters were coded, of which characters 1– <dig> were derived from the forewing and characters 7– <dig> were derived from the hindwing as follows. character 1: parallelism of ds and b ; character 2: attachment of ds and cp ; character 3: cd consists of a single broken line ; character 4: bop bends to the distal side ; character 5: straightness of upper side of bop ; character 6: vestigiality of ess ; character 7: vestigiality of b ; character 8: fragmentation of cp ; character 9: vestigiality of ds ; character 10: straightness of cd ; character 11: vestigiality of ess . the character codes for the butterfly wing patterns are summarized in additional file 1: tables s <dig> and s <dig> 

estimation of common ancestral states at phylogenetic nodes
reconstruction of ancestral character states was performed in a bayesian framework using bayestraits ver.  <dig>    <cit> . in contrast to the optimality criterion , the bayesian markov chain monte carlo  method has the advantage of investigating the uncertainty of the phylogeny and the parameters of the model for trait evolution  <cit> . bayestraits implements the program multistate, which calculates the posterior probability of states in all nodes across the posterior distribution of trees that are hypothetical ancestors of the taxa of interest. this calculation uses reversible-jump -mcmc simulations to combine uncertainty about the existence of a node and its character state, which enables sampling of all possible models of evolution  in proportion to their posterior probabilities  <cit> . reconstructions were performed using the most recent common ancestor  approach; when the node of interest did not exist, the minimal node that contained all terminal taxa of the clade defined by our node of interest  was reconstructed instead. in these analyses, polymorphic character states were accounted for, as they were considered as occurrences with an equivalent probability for calculation  <cit> .

to run the rj-mcmc chain,  <dig>  trees were subsampled from each of the four codon-partitioned mrbayes runs . to allow adequate mixing and achievement of stationary, the rj-mcmc chain was run for  <dig>  ×  <dig> iterations with the first 5 ×  <dig> iterations discarded as burn-in and a sampling interval of  <dig> iterations, for a final sample of 5 ×  <dig> iterations. we used a uniform prior for the analyses. to avoid autocorrelation and to allow exploration of ample parameter space, the ratedev parameter was automatically adjusted for each analysis to maintain an acceptance rate of 30%, to vary the amount by which the rate parameters were allowed to change between iterations of the markov chain , as recommended in the bayestraits manual  <cit> . we examined the output in tracer version  <dig>   <cit>  to confirm the stationarity of the log-likelihood. manipulation of trees was conducted using the ‘ape’ package  <cit>  in r.

estimation of dependent evolution
we used the discrete program implemented in bayestraits  <cit>  to test for dependence of pairs of character state changes. as described above, this method also controls for uncertainty of phylogeny and model parameters for trait evolution  <cit> . the bayesdiscrete model describes changes in two dichotomous traits over branches of a phylogenetic tree via a continuous-time markov process. the parameters of the trait evolution model represent the values of the transition rates between the eight possible character states in a model of dependent evolution. eight rate parameters constitute the dependent model, which assumes that each character evolves  at different rates depending on the state of the second character. in the independent model, forward and backward shifts in one character occur at the same rate regardless of the state of the second parameter . hence, a model of independent evolution has four parameters. the dependence of two traits can be investigated by comparing an independent model  with a dependent model where traits evolve in a correlated fashion. these models can be compared from the logarithmic bayes factor , calculated as  – log)  <cit> . the harmonic means of the log-likelihoods converge on the marginal likelihoods after an adequately long run of the markov chain  <cit> , and therefore can be used in calculating the bayes factors. following pagel and meade  <cit> , a result of greater than  <dig> approximated by the harmonic means from the final iteration of the mcmc runs was considered to represent evidence favouring the dependent model .

we used the same trees and settings  for the bayesian analysis of dependent evolution as were used for estimation of common ancestral states at phylogenetic nodes. we ran  <dig>  ×  <dig> generations, sampling every  <dig> generations to yield a sample of 5 ×  <dig> iterations after 5 ×  <dig> iterations were removed as burn-in. we used the same prior  for comparison of the harmonic means of the independent and dependent models for each pair of character state changes. because of potential instability of the harmonic mean likelihood  <cit> , we performed at least three separate mcmc runs for each analysis to ensure stability within and among runs.

estimation of order of accumulation
the posterior probability distributions of the eight transition parameters in the dependent evolutionary model were used to estimate whether the change in one state was contingent upon the background state of the other state  <cit> . this calculation was made from the proportion of evolutionary models analysed by rj-mcmc for which a value of zero was assigned to the transition parameter   <cit> . if the value of one transition rate parameter in the dependent model shows a higher z-score, that transition is less likely to occur. thus, the z-score represents a degree of restriction, where evolutionary trajectories or pathways are constrained. contingency of evolutionary changes was evaluated by comparing critical pairs of parameters . for example, if q <dig>  shows a higher z-score, but q <dig>  shows a lower z-score, then evolutionary change of the second character from  <dig> to  <dig> is more likely to occur when the background state of the first character = <dig>  this evolutionary case can be interpreted to indicate that change in the second character is contingent upon change in the first character. in the bayesian phylogenetic method, contingency in changes in character states was detected by a bias between sets of two transition rates .

estimation of contingency was conducted within pairs of character states that showed dependent evolution . contingency between a pair of character state changes was determined from the results of the model with a gamma hyperprior and evaluated according to relatively low transition rates   <cit> . the contingency between all pairs of character state changes was summarized in the form of a network , in which nodes represent events in the changes of character states and arrowed links represent the order of accumulation of character state changes.figure  <dig> 
bayesian inference of temporal order in character state changes.  evolutionary changes in  <dig> characters from state ‘0’ to state ‘1’.  evolutionary dependency map: summary of dependent evolution between character state changes. mutual dependency is shown by dotted lines, whereas contingent dependency by solid.  evolutionary contingency network: temporal order of accumulation of character state changes. line thickness reflects z-score  and thick for higher z-scores ). earlier changes are presented at the top of the network. mutually dependent evolution is shown by dotted lines . characters in forewings  and hindwings  are coloured as in figure  <dig> 



RESULTS
identification of the ngp in kallima and closely related butterflies
using remane’s criteria  <cit> , a rigorous comparative morphological method, we identified that the k. inachus leaf pattern was composed of the elements described by the ngp . our analysis decomposed the main vein of the leaf pattern into three ngp elements: the upper side of the border proximal  element, the lower side of the central distal  element in the forewing, and the cd element in the hindwing. the analysis then decomposed the left-sided lateral vein pattern into six ngp elements: upper side of the cd element, discal spots  and central proximal  element , basal  and root  elements in the forewing, and the cp element  in the hindwing. the right-sided lateral vein pattern was composed of two ngp elements: the bop and border distal  element in the hind wing. the eyespots  in both the fore and hind wings became vestigial. in this analysis, our rigorous method validated the inference proposed by süffert  <cit> . we also examined kallima paralekta and revealed that the leaf pattern in this species showed almost identical characteristics to those of k. inachus . the kallima leaf patterns were thus depicted by an assembly of the ngp elements.

subsequently, we found that the wing patterns of  <dig> butterfly species closely related to genus kallima were also composed of the ngp elements, although their appearances differed from the leaf-like patterns found in kallima . notably, differences among the species could be attributed to differences in geometric shape of the ngp elements. for example, in kallima, the cd element in the hindwing formed a straight line , whereas in polygonia c-album it did not . collectively, the cd elements in hindwings formed straight lines in twelve species  10; figure 2). these results strongly suggest that the kallima leaf patterns originated through evolutionary changes in character states of ngp elements from the ancestral species.

bayesian phylogenetic inference of ancestral wing patterns
the results of our comparative morphological analyses explain the evolution of the kallima leaf patterns, which are formed of ngp elements with specific modifications that confer a leaf-like appearance. a bayesian phylogenetic method was used to reconstruct the ancestral states of the butterfly wing patterns at phylogenetic nodes . we coded the k. inachus wing pattern using  <dig> prominent characters from the suite of characteristics that formed the leaf-like appearance . this coding was also performed on the closely related species and their wing patterns were characterized as one of two binary states . analyses implemented in bayestraits account for uncertainty in phylogeny and branch length; we reconstructed phylogenetic trees by combining three previously published datasets  <cit>   and obtained results that were consistent with previous reports  <cit> . the  <dig> character states at node a were estimated as follows in the forewing: the cp and ds elements were not attached , the cd element did not form a single, broken straight line , the bop was ordinarily curved , and the ess were not vestigial . in the hind wing, the b, ds, and ess were not vestigial , the cp element was not fragmented , and the cd element did not form a straight line  . taken together, these results strongly suggested that the most ancestral pattern was a non kallima-like pattern.

our analyses revealed further evolution of wing patterns . at node b of the phylogeny, the character states were reconstructed such that ds in the hindwing became vestigial  and the cd in the hindwing became straightened . the overall wing pattern evolved through the accumulation of changes from the most ancestral wing pattern at node a. then, at node c, the cd in the forewing changed to a single broken line , the b in the hindwing was vestigial , and the cp element in the hindwing became fragmented . the wing pattern evolved through additional changes that caused some characteristics to transition to a kallima-like state. finally, at node d, all character states had transitioned to the kallima-like state . these analyses demonstrate that the overall leaf pattern originated via stepwise transitions through intermediate forms. these results clearly showed that, at the very least, this evolutionary transition did not occur suddenly.

evolutionary accumulation of character state changes in evolution of wing patterns
the above analyses revealed that leaf mimicry evolved via stepwise transitions from one intermediate state to another. evolution by natural selection is expected to progress through the stepwise accumulation of changes. to gain an improved understanding of the evolution of leaf patterns, we further examined the process of accumulation of character state changes of ngp elements, focusing on mutual and temporal dependency  of the changes.

our bayesian phylogenetic analyses inferred that evolutionary changes in some pairs of character states were interdependent . among all possible combinations of pairs of characters ,  <dig> pairs of character state changes were significantly supported as dependent  >2; additional file 1: table s6); these dependencies were summarized as a linkage map . subsequent analyses examined whether cases of dependent evolution consisted of mutual or temporal dependence . among the  <dig> pairs of character states showing dependent evolution, six demonstrated mutual dependence and  <dig> evidenced temporal dependence . the temporal dependence indicated that some state changes in ngp elements were contingent upon the background states of other elements, suggesting a temporal order of accumulation of the changes, summarized as a form of network . the accumulation of character state changes occurred in the following order:  independent loss of the hindwing ds and b ;  evolution of the hindwing bd as a straight line  and of the forewing cd into a single broken straight line ;  evolution of the upper bop into a straight pattern ;  transition of the bend in the hindwing bop from proximal to distal . on the other hand, after the cd in the hindwing straightened, the ess in both fore- and hindwings became vestigial . taken together, evolution of the kallima leaf pattern progressed in concert with the sequential accumulation of state changes in ngp elements.

discussion
this study delivers the first clear picture of the evolution of leaf mimicry in kallima butterflies. our analyses clarified the ways in which butterfly wing patterns evolve to resemble leaves. from the perspective of comparative morphology, the kallima leaf patterns are decomposed into homologous pattern elements shared across closely related species. a lineage of leaf mimicry patterns evolved through stepwise changes and intermediate wing patterns. these results were further corroborated by in-depth analyses of trait evolution that revealed contingency in the sequential accumulation of traits; changes in states of elements influenced the subsequent evolution of other state changes. although some have argued that the gradual evolution of leaf mimicry is improbable  <cit> , our analyses reveal that leaf mimicry evolved gradually from the non-mimetic pattern without a sudden transition. we conclude that kallima leaf patterns evolved in a stepwise manner through intermediate forms with sequential accumulation of state changes .figure  <dig> 
schematic illustration of gradual evolution of
kallima
leaf mimicry patterns. the leaf pattern emerged through several intermediate patterns from the non-mimetic ancestor. the historical time course is shown using four time points  that correspond to the phylogenetic nodes in figure  <dig>  at the most ancestral point, the wing pattern may reflect the original developmental basis of the ngp . finally, the wing pattern reached the kallima-like state . evolutionary changes to the character state ‘1’ are shown at the nodes where a posterior probability of  <dig>  or greater occurs  are based on a posterior probability of  <dig>  or greater, which represents relatively lower confidence). characters and ngp elements are coloured as in figure  <dig> 



when performing phylogenetic comparative methods, it is important to perform an unbiased sampling of species to ensure accurate estimation of ancestral states or contingent evolution. we are confident that our analyses were conducted under satisfactory conditions for several reasons:  the species used in this study were selected to represent major groups of nymphalinae, which was carefully checked by observing photos of species from validated and private web sites ;  our reconstruction of species trees was consistent with previously reported trees;  for coding wing-pattern characters, specimens were carefully collected to identify the position of morphological elements relative to that of the wing veins for remane’s framework. given these points, it seems reasonable to consider that our analyses provide a practical estimation of phylogenetic statistical analyses, using a sufficient number and appropriate selection of species.

the temporal order of the accumulation of character state changes was assessed using z-scores. thus, contingency was a quantitative value and subsequent evolution was influenced to some degree by unique, chance historical events  <cit> . in the network of contingent evolution, only four character pairs showed strong evidence of contingent evolution, where the occurrence of one state change was highly contingent upon the background state of the other . the other three pairs of character state changes showed moderate contingency . under the loosest criteria , six pairs showed weak contingency, where one state change loosely restricted subsequent state changes. these results strongly suggested that the evolutionary trajectories in this lineage were not completely restricted. in fact, an alternative temporal order in state changes was likely to have occurred. for example, before the loss of the hindwing b , a straight hindwing bd  occurred in five species . although the evolutionary restriction varied from weak to strong, our analyses provided evidence that evolution of the leaf pattern resulted in sequential accumulation of character state changes.

we provide the analytical framework for evolution of complex adaptive phenotypes within a phylogenetic context. comparative morphological analysis revealed that kallima spp. and closely related species were explained by the same ngp scheme. thus, the morphological differences between species were attributable to differences in the states of subordinate elements. we suggest that this analytical approach is applicable to the evolution of other types of camouflage . previous studies demonstrated the utility of phylogenetic approaches to studying the evolution of camouflage and mimicry  <cit> , but the advantage of the ground plan scheme was unexplored. the phylogenetic homology-based comparative method used here provides a powerful way to explore evolutionary origins and processes of camouflage and mimicry as well as other morphological evolution, although the extent to which this framework can be applied to other cases remains to be determined.

although our data strongly suggest that leaf mimicry emerged gradually through intermediate states of wing patterns, the survival mechanisms of butterflies with intermediate patterns remain unclear. to date, many believe that intermediate wing patterns represent poor forms of mimicry, which generates criticism of the possibility of gradual evolution of leaf mimicry  <cit> . one plausible explanation for survival of poor mimics is found in the concept of imperfect mimicry  <cit> , which maintains that the survival of poor mimics  is often explained by a trade-off in predator foraging behaviours . this concept suggests the following evolutionary scenario: the larger the area in which a predator seeks prey, the less time the predator has to discriminate whether an object it encounters is edible, the lower the accuracy of discrimination, and the higher the probability that a poor mimic escapes predation  <cit> . applying this scenario to poor leaf mimics, predators may misidentify prey as leaves. because special resemblance of animals to natural objects is termed masquerade, we propose a hypothesis of “imperfect masquerade” for the above phenomena.

according to darwin’s theory, the sequential accumulation of individual changes is essential for natural selection of fortuitous variation. the present study demonstrated that evolution of leaf mimicry progressed in association with the sequential accumulation of character state changes. although our analyses were based on phenotypic evolution, these phenotypic changes are likely to be a result of a series of multiple genetic changes fixed by natural selection and neutral drift accumulated over long time periods. because our comparative morphological analyses demonstrated that the wing patterns of species closely related to kallima leaf butterflies are explained by the ngp, it is hypothesized that the developmental processes forming the wing patterns of these species include common molecular mechanisms, probably core developmental programs for wing pattern formation to satisfy the ngp. moreover, our analyses demonstrated that evolutionary divergence of these wing patterns occurs through alteration of the characteristic states of the ngp elements , strongly suggesting that secondary modifications have accumulated in the regulatory process to affect the behavior of such core molecular programs through long-term evolution. these investigations reveal genetic and developmental mechanisms underlying the evolution of leaf mimicry, as previously demonstrated for the molecular mechanisms and evolution of other types of butterfly wing patterns  <cit> . recent progress in omics approaches enables de novo genome assembly  <cit>  and transcriptome profiling of wildlife  <cit> . such analyses will provide great insight into genetic alterations and the relevant developmental molecular mechanisms that cause changes in wing patterns, and will provide further evidence for the stepwise evolution of leaf mimicry patterns.

leaf mimicry provides a textbook example of adaptation and is also a historically contentious subject that has spurred criticism of modern evolutionary synthesis. although darwin and wallace  argued for the gradual origin of leaf mimesis, the lack of direct experimental evidence has allowed antagonists to produce alternative evolutionary scenarios  for leaf mimesis  <cit> . in the past, leaf mimicry in kallima butterfly species was a cornerstone in arguments for saltatory evolution, in which context goldschmidt argued that this mimicry must have originated suddenly as a ‘hopeful monster’, without any intermediate forms  <cit> . the discovery revealed in this study refutes such claims and demonstrates that the appearance of leaf mimicry in kallima spp. has arisen in a stepwise and contingent fashion.

CONCLUSIONS
this study delivers the first clear picture of the evolutionary emergence of leaf mimicry in kallima butterflies. the evolutionary emergence of leaf mimicry has been a historically contentious issue and remains an unresolved conundrum. our analyses resolved this conundrum by demonstrating that the leaf pattern evolved gradually from a non-mimetic pattern. although we could not show the survival mechanisms of butterflies with intermediate patterns, the results of this study strongly suggest evolutionary trajectories toward leaf mimicry via intermediate states of wing patterns, and we therefore proposed an ‘imperfect masquerade’ to explain the presence of wing patterns with intermediate states. in the future, it will be necessary to investigate how butterflies with such intermediate patterns can survive by investigating the foraging behaviour of predators and escape strategy of butterflies.

in addition, we elaborated a powerful method to explore the evolutionary process of complex adaptive phenotypes. to date, comparative morphological approaches were used to investigate macro-level evolution; however, these approaches could be hardly applied to micro-level evolution, partly because of the lack of appropriate statistical methods to detect subtle phenotypic changes. the method that we developed is based on a comparative morphological approach in combination with phylogenetic bayesian statistics, which can be applied to a various examples of phenotypic evolution such as the evolution of vertebrate neuro-musculo-skeletal systems or that of insect camouflage and mimicry.

availability of supporting data
the data set supporting the results of this article is available in the labarchives repository at doi: <dig> /h4s180g <dig> 

additional files
additional file 1: figure s <dig>  phylogenetic relationship among genera of kallima, junoniini, and nymphalini. phylogeny of  <dig> genera of nymphalinae is shown. figure s <dig>  comparison of leaf wing patterns among three species of the genus kallima. the ventral fore and hind wings of three species of kallima are shown. figure s <dig>  phylogenetic tree for nymphalinae based on nine protein-coding gene sequences. the phylogenetic tree inferred by bayesian analysis is depicted with branch lengths proportional to time. figure s <dig>  contingent order detected as a bias of the transition rate using the z-score. contingency was analysed by comparing specific sets of transition parameters and the corresponding z-scores. table s <dig>  sampling density of species in this study. the genera of nymphalinae and the number of species within the genera are described. table s <dig>  species and genbank accession numbers of the nine genes used. eight nuclear  and one mitochondrial  gene accession ids were listed. table s <dig>  the character states of nymphalinae ventral-sided forewing patterns based on the nymphalid ground plan used in this study. character coding of forewing of species analysed. table s <dig>  the character states of nymphalinae ventral-sided hindwing patterns based on the nymphalid ground plan used in this study. character coding of hindwing of species analysed. table s <dig>  statistics for dependent  and independent  evolution between pairs of  <dig> characters . statistical dependence tests by using bayes factors. table s <dig>  z-score and transition rates between pairs of  <dig> characters  in dependent evolution. table s <dig>  contingent evolutioin  detected within dependent evolution . correspondence between dependent and contingent evolution are shown.

additional file 2: table s <dig>  check list of all of species belonging to genera used in this study.

additional file 3: 
supplementary data s <dig>  the alignment, partitioning and substitution models for construction of phylogenetic tree.



abbreviations
ngpnymphalid ground plan

rroot

bbasal

cpcentral proximal

cdcentral distal

bopborder proximal

bodborder distal

dsdiscal spots

esseyespots

chcharacter

mcmcmarkov chain monte carlo

competing interests

the authors declare that they have no competing interests.

authors’ contributions

tks designed the study, performed the experiments, analyzed the data, and wrote the paper; st constructed the molecular phylogeny and approved the manuscript; sh approved the final manuscript. all authors read and approved the final manuscript.

