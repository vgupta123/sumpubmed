BACKGROUND
walnut  is an economically important tree widely cultivated for its nuts and timber. a long reproductive cycle
 <cit>  limits its genetic improvement. walnut breeding would therefore greatly benefit from the development of molecular markers that could be used for gene discovery, marker-assisted selection, and other breeding applications that would accelerate breeding progress.

walnut genetic markers are currently inadequate to satisfy these needs
 <cit> . only a limited number of amplified polymorphic dna  markers, rapd-derived sequence characterized amplified regions , restriction fragment length polymorphisms , and amplified fragment length polymorphisms  have been developed
 <cit> . only a few simple sequence repeats  have been developed in walnut
 <cit> , although the recently reported bacterial artificial chromosome  end sequences  provide an opportunity for the development of a larger number of them
 <cit> .

single nucleotide polymorphism  is the most abundant type of dna variation in most species. the advent of massively parallel next generation sequencing , coupled with high throughput genotyping technology, makes it relatively easy to identify and use snps
 <cit> . an example of a high-throughput snp genotyping platform is illumina’s infinium snp oligonucleotide assay, which can simultaneously assay between  <dig>  and  <dig> million snps
 <cit> . the assay has been deployed in high-throughput snp genotyping of animals, such as cattle 
 <cit>  and swine 
 <cit> . a prerequisite for the development of an infinium snp assay is the availability of a large number of genome-wide snps.

genome-wide snp discovery utilizing ngs is predicated on bioinformatic tools facilitating mapping ngs reads to reference sequences
 <cit>  and variant calling
 <cit> . pipelines for processing of billions of short ngs reads for the purpose of discovery of genome-wide snps have been reported
 <cit> . standard approaches to genome-wide snp discovery are searches for variants in transcriptome assemblies of multiple individuals or mapping of ngs genomic reads of multiple individuals to a complete genome sequence. this approach is limited in many species by the absence of a complete genome sequence, and alternative strategies for genome-wide snp discovery are therefore needed.

one such strategy is to substitute shallow genome coverage of long sequence reads, or their assemblies, generated with the roche  <dig> or sanger sequencing technology for a complete genome sequence. this strategy was implemented in the agsnp pipeline for genome-wide snp discovery in self-pollinating  plants without a reference genome sequence. in agsnp, deep genome coverage of ngs reads from one homozygous individual was mapped to shallow  <dig> reads of another homozygous individual. snps were discovered between the two sets of reads. the assumption of homozygosity limits the universal utility of the pipeline because many plants and most animals are allogamous and hence heterozygous. we report here an update of agsnp for applications in allogamous species.

bac end sequences are one of several possible sources of shallow coverage, genome-wide, long dna reads. bess are often developed from bac libraries and are used for marker development and genome sequence composition surveys before whole genome sequencing
 <cit> . bess can also be used for anchoring fpc contigs on a genetic map by searching for homology between bess and marker sequences on the genetic map. the bes-based anchoring strategy is an alternative to contig anchoring via hybridization of radioactive probes with bac library screening membranes
 <cit>  or screening of multidimensional bac pools by pcr or illumina’s golden gate
 <cit> . the deployment of bess in snp discovery can therefore serve multiple objectives.

to develop markers for the construction of walnut genetic map and anchoring walnut fpc contigs on it, a total of  <dig>  bess from walnut cv ‘chandler’, a major walnut scion cultivar grown in california, have been generated by sanger sequencing
 <cit> . snps were identified in bess with the updated agsnp pipeline by mapping deep sequence coverage of walnut ngs reads to ‘chandler’ bess. an infinium assay for  <dig>  snps was developed and used to genotype a ‘chandler’ x ‘idaho’ f <dig> mapping population. the genotyping results were analysed to validate the snps and to improve the snp discovery rate with the pipeline by adjusting the snp filtering criteria.

RESULTS
updating agsnp
walnut is an outcrossing species, and walnut cultivars, such as ‘chandler’, are highly heterozygous clones propagated by grafting. ngs reads generated from a single walnut cultivar can consequently be derived either from a single haplotype if a locus is homozygous or from two different haplotypes if the locus is heterozygous. hence, observing two different nucleotides at a nucleotide position in a stack of mapped reads should be used as evidence for an snp . because the original version of agsnp was designed for mapping ngs reads of a homozygous line, observing two different nucleotides at a nucleotide position was used by agsnp as evidence for the presence of a paralogous sequence or a sequencing error and was filtered out. to update agsnp for snp discovery in heterozygous individuals, such as those of walnut, a new script was added to the pipeline to handle snp discovery using reads derived from potentially heterozygous loci. the updated pipeline program is available at
http://avena.pw.usda.gov/wheatd/agsnp.shtml.

updating the agsnp pipeline was based on the following rationale. reads forming a stack may vary either due to heterozygosity or sequencing and mapping errors. if heterozygosity was the cause of variation, two variants were expected at a nucleotide position in a stack of reads, and the expected frequency of each variant was  <dig> . if a sequencing or mapping error was the cause of variation, two or more variants were expected at a nucleotide position in a stack of reads, and the frequency of one of the variants was expected to be minor. variables ‘variant frequency’ , defined as the number of solid reads in a stack having a nucleotide at a specific nucleotide position that was different from the reference sequence divided by the total number of reads in the stack and ‘folded variant frequency’ , derived from vf were used to discriminate between these two possibilities. fvf is 1-vf if vf >  <dig>  and equal to vf if vf ≤  <dig> . the domain of vf was  <dig> to  <dig> and that of fvf was  <dig> to  <dig> . if fvf was  <dig>  the locus was homozygous. if fvf was minor, read variation was likely a sequencing or mapping error and if it was near  <dig> , read variation was likely caused by snp.

it was observed that the distribution of vf was skewed towards small values  and that fvf was significantly correlated to the quality scores of sanger bes sequences . both observations were consistent with the assumption that sequencing errors have low fvf. we therefore set fvf <  <dig>  as a cut of for filtering out false snps. the final fvf cut off value was based on a statistical test . if the test indicated that fvf at a nucleotide position was not significantly different from  <dig> , the variant nucleotide was assumed to be a true snp. a special case was when fvf >  <dig> but the stack of reads varied for two nucleotides, both differing from the reference sequence . if fvf did not statistically differ from  <dig> , variation of the reads was assumed to be caused by an snp and the nucleotide in the reference sequence was assumed to be a bes error.

discovery and characterization of snps
a total of  <dig>  bess of an average read length of 721 bp and totaling about  <dig> mbp were used as reference sequences. of them,  <dig>   were located in  <dig> of the  <dig> fpc contigs assembled from fingerprinted bac clones , which indicated that the bess were distributed across the entire walnut genome. to annotate these bess, homology was searched between the  <dig>  bess and walnut cdna sequence contigs at 1e- <dig>  a total of  <dig>  bess showed homology to cdna sequences. those bes were called genic bess whereas the remaining  <dig>  were called non-genic bess.

a total of  <dig> , <dig> high-quality solid reads  <dig> bp long were retained after removing low quality reads with an average read quality score <  <dig>  the total length of the reads was  <dig>  mbp, which translated to ~ <dig> x walnut genome equivalents. the filtered solid reads were mapped to the  <dig>  reference bess using the bwa program
 <cit> , and snps were called in the mapped solid reads using samtools
 <cit> .

the snp filtering criteria initially used are summarized in table 
 <dig>  a total of  <dig>  putative snps from  <dig>  genic bess and  <dig>  snps from  <dig>  non-genic bess were identified . they were present in approximately 31% of bess and their frequency was one snp per  <dig>  bp. genic bess had higher snp frequency  than non-genic bess .

 see the text for definition of
x¯ and s.  see methods.

snps are divided into two categories in the infinium hd assay, infinium i type  and infinium ii type , according to probe or bead type design. the infinium ii probe design employs one probe per snp  whereas infinium i probe design employs two probes . as the pricing and ordering of the custom beadchip product are determined by the number of bead types, rather than the number of snps, using only infinium ii snps increases the number of snp loci genotyped per constant number of probes and is therefore more economical. in this study, 88%  of snps were of infinium ii type . snps of infinium ii type were present in  <dig>  bac clones present in  <dig> fpc contigs containing  <dig>  bac clones, which accounted for  <dig> % of the walnut physical map.

snp genotyping
all of the  <dig>  putative snps identified in genic and non-genic bess were evaluated using illumina’s adt software. in the  <dig>  snps of infinium ii type,  <dig>  snps  had a score ≥ <dig> , and  <dig>   of snps had a score ≥  <dig>  . the design score of  <dig>  was used as a cutoff. after removing snps with design score <  <dig> ,  <dig>  snps located in  <dig> fpc contigs were retained. a total of  <dig>  of them,  <dig>  from genic bess and  <dig>  from non-genic bess, were chosen for designing a 6 k infinium snp assay and genotyping of 352 f <dig> walnut plants making up the mapping population from the ‘chandler’ x ‘idaho’ cross.

visualization of genotyping data with the genome studio program showed that  <dig>  of the  <dig>  snp markers produced genotyping data . based on the genotypes of cv ‘chandler’ and ‘idaho’ and their f <dig> progeny,  <dig>  snp markers generated good clustering in the genome studio graphs. of these,  <dig> snp markers generated 1:2: <dig> clustering of the mapping population, like an f <dig> ,  <dig>  snp makers generated 1: <dig> clustering, like a test-cross , and  <dig>  snp markers generated a single cluster indicating no polymorphism between the parents . of the  <dig>  snp markers,  <dig>  did not cluster accurately enough for genetic mapping although they could be scored. the conversion rate from discovered snps to potential snp markers was  <dig> % . hence,  <dig>  of the  <dig>  functional assays  that made up the 6 k infinium generated data that could be used for the intended purpose, the construction of a walnut genetic map and anchoring of fpc contigs on it.

to examine the reasons why  <dig> snp markers failed to generate scorable genotyping data, adt design score and the following five snp discovery criteria or variables were compared between the  <dig>  genotyped snps and  <dig> unscorable snps. the criteria were: average reference quality score , reference snp base quality score, snp mapping quality score  , rmd, and fvf . no significant difference was observed between the two groups in  <dig> of the  <dig> examined variables. an exception was rmd  . however, further analysis revealed no significant correlation between the rates of genotyped snps and rmds  . among the  <dig> unscorable snps,  <dig> were derived from genic bess and  <dig> from non-genic bess, while the remaining  <dig>  genotyped snps included  <dig>  snps from genic bess and  <dig>  snps from non-genic bess. a contingency χ <dig> test indicated that there was no significant association between snp source and snp genotyping success . it was therefore concluded that unscorable snps were most likely due to random effects in the infinium genotyping assay itself while adt design score  and other snp discovery factors did not impact the success rate of the conversion of snps to markers.

 average ± standard deviation; ** represents statistical significance at a  <dig>  probability level.

 average ± standard deviation; * and ** represent statistical significance at  <dig>  and  <dig>  probability level, respectively.

optimization of the pipeline
a total of  <dig>  false-positive snps were among  <dig>  putative snps that could be genotyped with the 6 k infinium assay, as evidenced by the lack of segregation in the ‘chandler’ x ‘idaho’ mapping population . an additional  <dig> snps that clustered like a test-cross were inferred to be false-positive as those loci were homozygous in ‘chandler’ . hence, the error rate in snp discovery was  <dig> %  using the initial snp filtering criteria . comparison between true-positive snps and false-positive snps showed statistically significant effects in rmd, fvf, mqs, and average reference quality score, especially in the first three variables . the distribution of rmd and fvf differed between true-positive and false-positive snp groups . rmd had a sharp distribution centered at  <dig>  reads in the true-positive snp group but a flat distribution centered at  <dig>  reads in the false-positive snp group . fvf was closer to  <dig>  in the true-positive snp group than in the false-positive snp group .

out of the  <dig>  false-positive snps,  <dig>  snps were from genic bess and  <dig> snps were from non-genic bess, while of the  <dig>  true-positive snps,  <dig>  snps were from genic bess and  <dig>  snps were from non-genic bess. there was a highly significant relationship between snp source and true/false-positive snp outcome ; snps from non-genic single-copy bess had a higher chance of being true-positive  than those from genic bess .

correlation analyses revealed that the rate of true-positive snps  was significantly positively correlated to fvf and mqs, and negatively to rmd . a logistic regression model of rtp with mqs , rmd  and fvf was fitted : log ) =  <dig>  -  <dig> x1 +  <dig> x <dig> -  <dig> x <dig>  where p is the probability of an snp to be declared false-positive. this model was statistically significant  and can therefore be used to predict whether an snp is true-positive or not. a total of  <dig>  of  <dig>  false-positive snps were correctly predicted with this model with an accuracy rate of  <dig> % and  <dig>  of  <dig>  true-positive snps were correctly predicted with this model with an accuracy rate of  <dig> %, showing that the model had higher prediction accuracy for true-positive snps than for false-positive snps. the overall prediction accuracy was  <dig> % . the predicted rate of true-positive genic snps was  <dig> %  and  <dig> %  of true positive non-genic snps. the overall rate of true-positive snps was  <dig> %, higher than the actual rate in  <dig>  snps .

mqs: snp mapping quality score; rmd: read mapping depth; fvf: folded variant frequency. *** represents statistical significance at a  <dig>  probability level.

the above analyses showed that the rate of true-positive snps was strongly affected by rmd, mqs and fvf. in order to increase the rate of true-positive snps generated by the pipeline in snp discovery, the cutoff values for those three variables were modified compared to those used initially. rmd and mqs were set to  <dig> and  <dig> , respectively. rmd was set to  <dig> based on
x¯+ <dig>  - s =  <dig>  +  <dig>  ×  <dig>  =  <dig> , which is approximately equivalent to the value of
x¯+1 - s =  <dig>  +  <dig>  ≈  <dig> based on the distribution of the rmd among the  <dig>  true-positive snps . for fvf, a t-test was used to check whether the fvf of an snp deviated significantly from the expected  <dig>  .
x¯ +  <dig> s is shown.

when rmd ≤  <dig>  mqs ≥  <dig>  and a non-significant difference of fvf from  <dig>  were used to filter  <dig>  snps used for genotyping,  <dig> %  of true-positive snps were obtained; a much higher rate than  <dig> % when initial cutoff values were used. when these criteria were used to filter all snps identified , a total of  <dig>  snps were identified in  <dig>  bess covering  <dig> fpc contigs, representing 98% of the physical map . by using the logistic regression model ,  <dig>   snps were predicted to be true-positive . considering the  <dig> % prediction accuracy of the model, a true-positive snp rate of  <dig> %  was expected. finally filtered snps and snps validated by the infinium assay are in additional files
 <dig> 
 <dig> and
 <dig> 

 estimated based on the logistic regression model in  <dig>  validated snps .

discussion
updating of the agsnp pipeline for snp discovery in cross-fertilizing species
the agsnp pipeline was originally designed as a high-throughput bioinformatic tool for large-scale, genome-wide snp discovery in large and complex genomes using sequences of two inbred, and hence homozygous, lines
 <cit> . sequences assembled from long reads, such as those produced by the sanger or roche  <dig> sequencing platforms, of one inbred line, and annotated using  <dig> cdna libraries, served as a reference. short reads of a great depth, such as those produced by the solid or illumina ngs platforms, of the other line were used to further annotate the assembled sequences and discover snps between the two lines. this pipeline was successfully used for snp discovery in the  <dig>  gbp genome of self-pollinating ae. tauschii. approximately half of million snps with a validation rate of over  <dig> % were identified in genic regions, single or low copy repeat regions, and uncharacterized low copy number sequences
 <cit> .

to discover snps in walnut, which is a wind-pollinated, out-crossing species, the pipeline had to be modified to accommodate heterozygosity. to generate snps for genotyping a mapping population, snp discovery can be limited only to a single out-crossed parent. each snp is detected as variation within the stack of mapped short ngs reads at a locus, rather than a difference between an invariant stack of mapped ngs reads and reference sequence. in this application of agsnp, the role of the reference sequence is to filter snps. therefore, the reference sequence can be derived either from the same genotype as the mapped reads or a different genotype . in this study, ‘chandler’ bess were used as a reference sequence and solid ‘chandler’ reads were mapped to them to identify snps in ‘chandler’.

snp filtering is a critical step for removing false-positive snps from the pool of putative snps during snp discovery. fvf is one of the most important variables used in snp filtering. it is used to set a boundary between variation caused by sequencing or mapping errors and that caused by true snps. ideally, fvf of true snps should be close to  <dig>  but it is difficult to find a fixed fvf cutoff that reasonably balances false-positive and false-negative snp rates. as the counts of variable reads at a nucleotide position follow a binomial distribution and the expected fvf for true snps is  <dig> , we used the binomial probability of deviation between observed fvf and  <dig>  to set the cutoff between true or false snps. the benefit of this approach to setting the cutoff value is seen using the following example. when the  <dig>  genotyped snps were declared true or false on the basis of a fixed fvf cutoff of ≥  <dig> , the false-positive snp rate insignificantly increased from  <dig> %  to  <dig> % . but when cutoff was set on the basis of the binomial test, the false-negative snp rate significantly decreased from  <dig> %  to  <dig> % .

the snp discovery in ae. tauschii <cit>  used a cutoff value of
x¯+ 2 s to identify single copy reference sequences or to set a maximum read mapping depth. in contrast, in walnut,
x¯+  <dig>  s turned out to be an optimal cutoff value. similarly, more stringent snp filtering cutoff values were required for the snp mapping quality score, average reference quality score, and reference snp quality score. after adjusting the cutoff values, a  <dig> % true-positive snp rate was obtained in walnut, which was much higher than  <dig> % with the initial cutoff values. this validation rate was lower than that obtained in self-pollinating species
 <cit>  but higher than that obtained using other snp discovery strategies in outcrossing maritime pine, loblolly pine, and sugar pine, in which snp validation rates ranged from  <dig> % to  <dig> %
 <cit> .

factors reducing the rate of false-positive snps in snp discovery
the analysis of validated snps showed that factors such as read mapping depth, snp mapping quality score, and folded variant frequency were closely related to the rate of true-positive snps in the updated agsnp pipeline. all those factors were directly or indirectly associated with a fundamental issue: mismapping of ngs reads to a reference sequence. because reference sequences and ngs reads are derived from heterozygous loci, mismapping can easily result in a large proportion of false-positive snps. focusing snp discovery on genic regions and single-copy non-genic sequences, increasing the stringency of mapping depth, increasing the snp mapping quality score, and increasing fvf will decrease false-positive snp rate. using paired ngs reads would probably also help since it will increase the likelihood of mapping reads to their correct locations. in addition, more stringent mapping parameters in the mapping software, e.g., the number of mismatched bases and the number of gaps, should be applied if reads from heterozygous genomes are used for snp discovery with the agsnp pipeline.

infinium genotyping
a total of  <dig>  snps scattered along most of the fpc contigs were selected to generate a 6 k iselect infinium beadchip. of them,  <dig> % produced genotyping data and  <dig> % were converted to potential snp markers for genetic mapping. this conversion rate of snp sequence to snp markers is higher than rates in an outcrossing tree species, maritime pine, 
 <cit>  using the custom golden gate assay but lower than the conversion rates evaluated using a custom infinium assay in animal species, such as pig 
 <cit>  and cattle 
 <cit> . the final genotyping success rate is the product of a combination of the conversion rate and the true-positive snp rate. in this study,  <dig> % conversion rate and  <dig> % true-positive rate yielded a final infinium genotyping rate of  <dig> %, still higher than the rate obtained in maritime pine 
 <cit>  using the custom golden gate assay. increasing true-positive snp rate in snp discovery will increase the final genotyping rate. overall, genome-wide snp discovery using bess and short ngs sequence reads resulted in successful snp genotyping strategy in the heterozygous walnut genome.

general utility of identified snps
the snps reported here were produced for the construction of a genetic map based on the mapping population ‘chandler’ x ‘idaho’ and for the anchoring of fpc contigs built from the ‘chandler’ bac clones on the genetic map. snps in the ‘chandler’ genome were therefore of a critical importance for the objectives of this project, and snp discovery was therefore focused solely on the ‘chandler’ genome. it is nevertheless of interest to evaluate the utility of snps discovered in ‘chandler’ for other applications. to answer this question,  <dig> walnut cultivars, in addition to ‘chandler’ and ‘idaho’, were genotyped with the 6 k infinum and their heterozygosity and pairwise genetic dissimilarity between them were estimated. as expected, heterozygosity  detected with the 6 k infinium was dependent on the degree of relatedness to ‘chandler’ , as indicated by positive correlation  between heterozygosity and coefficient of parentage  . therefore, the diversity of walnut germplasm distantly related or unrelated to ‘chandler’ would be underestimated if assessed by the 6 k infinium assay, and only about a third to half as many polymorphic snp markers would be found in germplasm distantly related or unrelated to ‘chandler’ compared to ‘chandler’ . nevertheless, the numbers of snps may still be adequate and informative in many breeding and genetic applications including phylogenetic studies. that is indicated by genome-wide distribution of snps in all studied walnut accessions  and by high correlation r = − <dig>   between pairwise dissimilarity among the  <dig> walnut accessions and cop . the agreement between the two measures of relatedness was about 60%.
 <cit>  and
 <cit> . the cultivars in bold font are parents or ancestors of ‘chandler’. the percentages of heterozygous loci are in square brackets behind some cultivars.

CONCLUSIONS
the agsnp pipeline was updated here and is now applicable to genome-wide snp discovery in all species, irrespective of their mating system, although the error rates of snp discovery with the pipeline are higher in autogamous species  than in allogamous species . the greater fidelity of snp discovery in autogamous species is undoubtedly related to greater efficiency with which the pipeline is able to separate snps from sequencing and mapping errors in autogamous species. the updated pipeline can be downloaded at
http://avena.pw.usda.gov/wheatd/agsnp.shtml.

