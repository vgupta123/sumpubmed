BACKGROUND
the goal of quantitative trait mapping based on genome-wide association study  data is to find single nucleotide polymorphisms  that are associated with a set of quantitative trait  values under study. many quantitative traits are thought to have both a genetic basis and an environmental basis, making the associated genes difficult to identify from genetic data alone. the biological complexity of the evolutionary history of genes and the environmental factors acting simultaneously on the trait values makes this a challenging task, even with very large data sets.

quantitative trait mapping has two distinct goals, detection and localization. detection is achieved if any snp in a certain region is found to be significant during the association study, while localization addresses how close the detected snp are to the true causative snp. localization is usually measured by distance between a significant snp and the true snp. since most data sets will include a large number of snps, it is very unlikely that any statistical method will pick up a truly causal snp, but clearly methods that can provide relatively precise localization will be the most useful.

methods of quantitative trait mapping can be broadly classified into two groups: those that model the shared evolutionary history, usually in the form of a phylogenetic tree, and those that do not. non-tree based methods used in quantitative trait mapping include methods that analyze each marker independently , and those that analyze groups of markers together . the t-test simply groups samples according to allele type at each snp, and uses a two-sided alternative to look for a significant difference in mean trait value between groups. both haplotype association mapping  and single marker association  perform an anova on particular groupings of samples to assess the significance of the groupings  <cit> . since these methods fail to consider the evolutionary relationships among snps, they may have difficulty detecting some associations between snps and quantitative traits. this leaves room for improvement in the power of detection of associated snps. in fact, it has recently been noted that the application of a phylogenetic framework to analysis of gwas data may be beneficial  <cit> .

by using information contained in the relationships among snps, tree-based methods gain power in detection and localization. however, this gain in power comes at the expense of an increased computational cost. in spite of the computational issues, many tree-based methods have recently been proposed for this problem. in the case of discrete trait data, these methods include latag, implemented in the software treeld  <cit> , margarita  <cit> , and blossoc  <cit> . for quantitative traits, tree-based methods in common use include treeqa  <cit> , qblossoc  <cit> , and htreeqa  <cit> . several of these methods  are based on the idea of local perfect phylogenies, which are phylogenies built on sets of neighboring compatible snps identified by the four-gamete test. these methods also require that the snp data be phased into haplotypes prior to analysis, which is a nontrivial task. the htreeqa method  <cit>  avoids this difficulty during analysis by using a tri-state semi-perfect phylogenetic tree, which can be built on unphased genetic data.

tree-based techniques must assume an underlying model to represent the genealogical history among snps along a chromosome. the most common model for evolutionary relatedness within a population is the coalescent process  <cit> . at a single locus, the coalescent process describes the genealogical history among sampled individuals in the form of a phylogenetic tree. in the case of gwas data, however, the two competing processes of coalescence and recombination are occuring simultaneously along a chromosome, and a single phylogenetic tree cannot be used to model the genealogical history among all individuals for the entire chromosome. when recombination occurs between two genetic sequences, the sequences exchange genetic material at a recombination point, leaving a situation where the portion of the genetic sequence on one side of the recombination point is the same as the sequence present before the recombination, while the portion of the sequence on the remaining side is new  <cit> . although phylogenetic trees model genetic sequence data well in the absence of recombination events, perfect phylogenetic trees do not exist to model incompatibilities in genetic data on both sides of a recombination point simultaneously. in this case, the genealogical history of a chromosome can be represented by an ancestral recombination graph , a phylogenetic network representing both recombination and coalescent events  <cit> . args provide a model that accommodates the fact that while a  local tree exists at each site along the chromosome, neighboring trees may be incompatible due to recombination events. args represent these clusters of incompatible local trees, and can be used to determine the marginal tree at each snp along the chromosome  <cit> . however, args can be difficult to estimate from snp data . methods have thus been proposed to estimate the important features of args for particular applications. many of the methods used in the gwas setting replace estimation of the entire arg by estimation of the marginal phylogenies at each snp. this will be the approach we use here.

the tree-based methods mentioned above vary in the way that the phylogenetic information is used in the subsequent analysis. one method of particular interest to the present study is qblossoc  <cit> . after local phylogenies are estimated for each snp, qblossoc uses this information to partition the sampled individuals into some number of clusters, k, and calculates a score for each possible set of k clusters defined by the phylogenetic tree. the score calculated is a penalized likelihood , where the likelihood is a multivariate normal with a different mean in each cluster and an overall shared variance, with zero covariance among observations. the maximum score over all possible sets of k clusters defined by the phylogeny is used to assess the significance of each snp. this technique produces a test statistic at each location along the genome. although this clustering technique accounts for the shared evolutionary history among snps, qblossoc has two weaknesses rooted in its assumptions during the score calculation; namely, qblossoc assumes both independence and a common variance among the quantitative trait values. the method proposed here is a modification of qblossoc that addresses these two weaknesses.

our proposed data analysis technique uses the same near local perfect phylogenies built by  <cit> , but also estimates the branch lengths of each marginal tree via a modification of the algorithm from  <cit> . estimating the branch lengths enables estimation of the variance-covariance structure of the data using a brownian motion model for trait values along the tree  <cit> . this modeling choice allows the covariance between two observations to be proportional to the length of their shared evolutionary history. our score statistic is also a penalized likelihood, where the likelihood is a multivariate normal likelihood for the observations using the same mean structure as qblossoc, but with variance-covariance structure determined by the estimated phylogeny. we find that the estimation and use of the variance-covariance structure is especially important in the presence of strong population structure among the observations. for instance, in the example data in figure  <dig>  the snp clearly has an effect on the trait value, but the evolutionary history is also very important. due to the mixture that occurs both early and late in the evolutionary history of the snp, assuming the resulting observations are independent among the subpopulations could hinder the ability to detect the association between this snp and the quantitative trait.

here, we propose a data analysis method that accounts for the covariance structure present in gwas data sets, and show that it generally performs similarly to qblossoc in terms of power of detection and localization, with strong performance in the presence of population structure. finally, the proposed data analysis method is applied to a gwas data set containing snp data for  <dig> outbred mice  <cit> . phenotypic data for each mouse includes observations of eight quantitative cardiovascular traits. the snp sites on two chromosomes with previously-detected strong signals and one chromosome without a previously-detected strong signal are analyzed.

methods
since the goal is to search for snps associated with a quantitative trait, we will consider both detection and localization. the proposed analysis technique includes calculation of a score at each snp site and an assessment of significance by performing hypothesis tests via permutation. in order to examine the performance of the methods, we use a novel data simulation technique so that we know the location of the snp truly associated with the quantitative trait . this yields an opportunity to compare the type i error and power of the proposed method with that of qblossoc. we begin by giving the details of the method of analyzing the data, and then describe the simulation technique.

data analysis
the evolutionary history at each snp site can be represented by a local phylogenetic tree, Θ. at each snp, the local tree topology is estimated using blossoc’s approach  <cit> . the branch lengths of each tree are estimated using a modification of the algorithm in  <cit> , which yields an approximation to the maximum likelihood estimate of the branch length. in the case of dna sequence data, the rogers-swofford method  <cit>  is based on the use of a fast heuristic method to approximate the state at each internal node of the tree. the distance between a pair of nodes in the tree, p^, is then calculated to be the proportion of the sites in the sequence that differ between the reconstructed states at each node. p^ can then be used to obtain an estimate of the branch length under an appropriate model, such as the jukes-cantor model  <cit> .

we modify this method to handle snp data as follows. first, the same heuristic method as in the rogers-swofford method  is applied to the phased 0- <dig> snp data at each internal node of the tree. the proportion of snps that differ between each node, p^, is counted, and the branch length connecting the two nodes is estimated to be: 

  d^=−12ln 

if p^= <dig> for a branch, then we set p^=1number of snps. this distance equation is derived under the m <dig> model, a two-state markov model for nucleotide sequence data, which is a specific case of the more general mk model described in  <cit> . notice that the branch length estimate, d^, increases as the proportion of differing snps between two nodes increases, as expected.

for each estimated local phylogeny, the branch lengths are used to estimate the variance-covariance matrix of the tree, v, as shown in the example in figure  <dig>  the covariance between two quantitative trait values is defined to be proportional to the time of shared evolutionary history between those two observations. given the local estimated phylogeny at the snp of interest, the quantitative trait data were assumed to follow a multivariate normal distribution, with covariance structure determined by the local phylogeny.

the proposed method accounts for only a focused portion of the evolutionary history among observations using a clustering technique. at each snp site, the tree can be partitioned into k clusters using only the earliest  edges in the tree. an example of this clustering is shown in figure  <dig>  for a fixed partition of the tree into k clusters, we define a matrix, d, with elements: 

  dij= <dig> if observationifalls in clusterj <dig> otherwise 

for i= <dig> ,…,n and j= <dig> ,…,k, where n is the number of observations . then the trait data, y=, are assumed to follow a multivariate normal distribution along tree Θ: 

  y∼n 

here, as in qblossoc, each cluster has its own mean, denoted μ=. however, instead of assuming independence, the variance-covariance matrix of the tree, σ2v=σ2v, allows for covariance structure to be present among the quantitative trait observations.

using the distribution in equation  <dig>  the maximum likelihood estimates of the parameters are straightforward to calculate, 

  μ^=−1dtv−1y 

  σ^2=tv−1n 

hypothesis testing is carried out using a likelihood framework. in particular, we use a penalized likelihood similar to that proposed by  <cit> . we define the likelihood score statistic  to be 

  lss=maxk{2lnl−kln}. 

to calculate lss, the maximum likelihood is penalized by subtracting a penalty as in the bayesian information criterion . calculation of the likelihood involves estimation of  parameters, including the mean trait value in each cluster and the variance, σ <dig>  the bic criterion penalizes for k of these parameters. at each snp, a local tree is scored according to , for varying numbers of clusters, k= <dig> …,kmax, and the resulting tree score is the maximum score over the number of clusters.

to address detection, after the score in equation  <dig> is calculated for the phylogenetic tree at each locus along a chromosome, permutation testing based on this location-specific test statistic can be used to evaluate significance. permutation of the observed trait values among the tips of the estimated phylogenetic tree yields permuted data sets, and the score in equation  <dig> is calculated for each permuted data set. the p-value for detection at each locus is the proportion of data sets scoring higher than the observed data set at each particular locus. to address localization, the distance  between the maximally-scored locus and the disease locus is calculated.

in addition to the tree topology, our method also requires an estimate of the covariance structure in the data. this covariance structure is estimated via estimation of the branch lengths along the topology. by using the clustered tree to consider only the broad-scale phylogenetic relationships among snps, our technique can account for the evolutionary history among genes without using all coalescent relationships. using only broad-scale relationships enables a computationally feasible algorithm that is able to account for the most important aspects of the covariance structure among observations.

data simulation
to assess the performance of the proposed likelihood technique, simulated data sets are used. this provides a setting where the presence and location of the snp truly associated with the quantitative trait is known. in our simulation study, we simulate snp data for  <dig> replicate data sets from a diploid population using the program ms   <cit> . each data set consists of the snp data corresponding to one chromosome. for each simulated replicate, a single dna base pair location is randomly chosen to be associated with the trait. this choice of “disease” locus is restricted so that the minor allele frequency is between 10% and 30%.

for each snp, quantitative data is simulated along the phylogenetic tree at the disease locus according to a generalized version of the ornstein-uhlenbeck  process described by  <cit> , 

  dyi=αθ−yidt+σydbi 

where yi is the quantitative trait value for the ith lineage at time t, Θ is the target trait value, α is the strength of selection toward the target value, σy is the standard deviation of the process per unit time, and dbi represents a brownian motion process for lineage i, so that values of dbi for small time increments, dt, are independent, identically distributed random variables from a normal distribution with mean zero and variance dt. thus, the ou process is a mean-reverting process with a deterministic component, α)dt, modeling the selection of a trait toward the optimum target value, and a stochastic component, σydbi, providing the “random noise” for the process. notice that the deterministic portion of this process implies that the selection of the trait toward the target is proportional to the distance between the trait and the target value, Θ. when two observations share a portion of their evolutionary history, they share the trait value, yi, for that portion of time. along the corresponding phylogenetic tree, observations share an evolutionary history when they evolve along the same lineage.

when this process is applied in the setting of phylogenetics, the stochastic process gives the same value during the time when the evolutionary history is shared for any two observations. however, after two lineages split, their trait values evolve independently from one another. this implies that before a split, two observations are perfectly correlated, while after the split, they evolve in an uncorrelated manner.

for this study, a more flexible form of the ornstein-uhlenbeck process is used, the generalized hansen model  <cit> . this allows the trait to evolve toward a non-constant optimum  as follows, 

  dyi=αθi−yidt+σydbiθi=θ <dig> ifxi=0θ <dig> ifxi= <dig> 

the trait is simulated according to this stochastic process with the target trait value determined solely by the snp state at any time in the evolutionary history at that snp, where xi is the snp state for the ith observation at time t.

using the generalized hansen model leaves us with a quantitative trait value for each haplotype that has both a  genetic component, determined by the snp, and a stochastic component. this process imposes an evolutionary history of the quantitative trait which can be portrayed by the phylogenetic tree at the disease locus, and allows the two haplotypes of a diploid individual to evolve independently along the phylogeny at the disease locus. this is intuitive as long as two haplotypes for an individual are unrelated to the trait. in order to simulate data for each individual, or diplotype, based on the haplotypic data, we use an additive model. the trait value for each diplotype is the average trait value across the two copies of the trait for each individual at the disease location.

during the simulation studies, we simulate the snp using these parameters in ms: the diploid population size was n0= <dig> , the neutral mutation rate for each dna base pair was μ= <dig> ×10− <dig>  the rate of recombination per generation per dna base pair was ν=10− <dig>  and each simulated chromosome was  <dig> , <dig> base pairs long. during simulation of the quantitative trait values, we vary the strength of selection, α, and the standard deviation of the quantitative trait per unit time, σy. the two target trait values we consider are θ1= <dig> and θ2= <dig> 

RESULTS
simulation studies
in order to assess the performance of the proposed technique in terms of power and type i error, we begin by analyzing data sets which either include a truly-associated snp, or do not include an associated snp. these data sets are simulated using the technique described above. after simulating the data sets for specified parameter values, the local phylogenetic tree at each snp is estimated using blossoc, and branch lengths are estimated as described previously. next, the score in equation  <dig> is calculated, using kmax= <dig>  the same technique is applied to  <dig> permutation data sets created by using a permutation of trait values across individuals. the type i error, power, and localization for qblossoc and lss are presented in tables  <dig> and  <dig> 

for the values of α  and σy  considered here, the type i error rates are all near  <dig>  for these simulation results.

for the values of α  and σy  considered here, the power and localization distance  are comparable for qblossoc and lss.

permutation testing results showed that both qblossoc and lss control the type i error around  <dig>  . in terms of power of detection lss is competitive with qblossoc in this general case. the average localization distance  is the shortest distance between the most significant  snp and the associated snp in dna base pairs. smaller distances indicate a better statistic, and the two methods show approximately the same performance in terms of localization distance.

the special case of population stratification was also investigated. by using ms, population structures involving six subpopulations were specified. here, the trees are constrained so that after a population splits into two subpopulations, no gene flow exists between the subsequent clades, and the subpopulations evolve independently of one another. this constraint is achieved through specification of times when the splits in populations occur, which are given below. specifying the number of subpopulations and divergence times allows the investigation of the effect of the complexity of the population structure on the results. an example of a true phylogenetic tree for a particular replication with six specified subpopulations is shown in figure  <dig> 

results for selected studies are shown in tables  <dig> and  <dig>  in each case, six subpopulations were specified. the divergence times, or cumulative times at which population splits occurred, are   <dig> ,  <dig> ,  <dig> ,  <dig> , and  <dig> , and are omitted from tables  <dig> and  <dig> for simplicity. these times are in evolutionary time units of 4n0μ= <dig> ×10− <dig> generations. the results in table  <dig> show that the type i error is controlled by both qblossoc and lss in this special case. also, the power of detection and localization distance  are very similar for the two techniques . however, upon further investigation, we see that even though the two techniques have comparable powers of detection and average localization distances, qblossoc and lss are detecting different data sets. the left plot of figure  <dig> shows the p-values for each simulated data set from the study with α= <dig> and σy= <dig> shown in table  <dig>  the horizontal and vertical lines represent the cutoff values for significance. the  <dig> observations in the lower left corner were detected by both qblossoc and lss, while the  <dig> observations in the upper right corner were detected by neither method. however, the seven observations in the upper left corner were detected by the proposed lss but not qblossoc, while the two observations in the lower right corner were detected by qblossoc but not lss. this is an indication that the proposed technique sometimes identifies different types of associations than qblossoc.

for the values of α  and σy  considered here, the type i error rates are all near  <dig>  for these simulation results in the case of six subpopulations. .

for the values of α  and σy  considered here, the power and localization distance  are comparable for qblossoc and lss in the case of six subpopulations. .

further, the right plot of figure  <dig> shows the localization distances for each data set. observations below the diagonal line indicate data sets in which qblossoc was able to better localize the associated snp, while observations above the diagonal line indicate data sets in which lss was able to better localize the associated snp. twenty-three observations were better localized by lss, while forty-three observations were better localized by qblossoc. these simulation study results indicate that the proposed method is comparable with qblossoc in the general case, and detecting different types of relationships between snps and quantitative traits in the case of population structure. additionally, both qblossoc and lss appear to control the type i error in these simulation studies.

real data analysis
having seen that the proposed method performs well for simulated data, we apply the method to a gwas data set. the data set from  <cit>  includes both snp data and phenotypic data for  <dig> outbred mice. phenotypic data for each mouse include observations about eight quantitative cardiovascular traits. here, the trait we will focus on is the high-density lipoprotein cholesterol level . we will set kmax= <dig> in lss and use  <dig> permutations for the data analysis. the snp sites on two chromosomes with previously-detected strong signals and one chromosome without a previously-detected strong signal are analyzed. in order to phase the data from genotypes into haplotypes, beagle  <cit>  was used, as in the original data analysis  <cit> .

chromosome  <dig> included data for  <dig>  snps, and was analyzed using the proposed method. the method detected the chromosome with a p-value less than  <dig> . the score results, presented in figure  <dig>  show that of the two sites detected as highly significant by  <cit> , lss shows a peak very near to one of these sites. in addition, three other sites not previously detected show very large peaks in lss. these results support the simulation study results, in which lss tends to detect different signals than previous methods.

zhang et al.  <cit>  also found a strong genetic signal on chromosome  <dig>  chromosome  <dig> included data for  <dig>  snps, and was analyzed using the proposed method. the method detected the chromosome with a p-value less than  <dig> . the results presented in figure  <dig>  show a peak in lss near the snp site previously detected as highly significant  <cit> . in addition, two other regions on the chromosome not previously detected show very large peaks in lss.

chromosome  <dig> was also analyzed, and results are presented in figure  <dig>  chromosome  <dig> included data for  <dig>  snp sites. zhang et al.  <cit>  did not detect any highly significant snp sites on chromosome  <dig>  the likelihood analysis resulted in a detection p-value of  <dig>  for this chromosome, which is not significant.

discussion and 
CONCLUSIONS
here, a method is presented to search for snps associated with quantitative traits in gwas data. the proposed method is a modification of qblossoc which relaxes the assumptions of independence and common variance between observations. the proposed method looks at this problem using a framework which accounts for the evolutionary relationships among snps. however, as opposed to previous techniques using these evolutionary relationships, the method here remains computationally feasible by using only the broad-scale relationships present in the evolutionary history among snps. these evolutionary relationships impact results especially in the presence of strong population structure.

using an innovative, biologically-sensible technique, simulated data sets were obtained in both the general case and in the presence of population structure. simulation results showed that lss is competitive with qblossoc in terms of localization and power of detection, and that different chromosomes may be detected by lss and by qblossoc. in the presence of population stratification, the proposed score shows particularly strong performance. for the real data example studying  <dig> outbred mice, analysis using the proposed tree estimation and likelihood score showed that lss detects two snps previously linked to hdl in mice. in addition, lss also detected several snps not previously mentioned in the literature.

one of the advantages of this proposed method is its use of ancestral information to approach this problem. this framework is more realistic than other previous approximations. also, the use of the broad-scale evolutionary relationships among snps makes the technique computationally feasible. computation times for the branch length estimation and lss analysis, including permutation testing, ranged from approximately  <dig>  to  <dig>  seconds per snp on a standard desktop linux machine for the simulated data sets with  <dig> observations, which typically included between  <dig> and  <dig> snps. for the real data analysis, with  <dig> observations, these computation times ranged from approximately  <dig> to  <dig> minutes per snp, depending on the number of snps along the chromosome . it should be noted that individual snp computations are easily parallelized in this setting.

although the proposed technique begins to address the limitations of current statistical methodology in the problem of quantitative trait mapping, the technique has several avenues that could be pursued in order to extend the method to more general cases. in the data simulation technique, only codominant trait models have been implemented, but dominant and recessive trait models are straightforward to implement and test. also, many traits are impacted by both a genetic component and an environmental covariate. by extending the quantitative trait simulation technique, many realistic traits could be simulated with both genetic and environmental covariates.

similarly, lss is flexible and could be generalized to include environmental covariates as well. additionally, the current likelihood score requires that genotypic data be phased into haplotypes prior to analysis. phasing is a nontrivial process which is subject to error. by extending the tree estimation method and likelihood score to be computed on genotypic data, these methods will be more easily applied to real data sets. advantages of the model include its ability to find different signals than previous statistical methods and its flexibility to be extended to analyze different types of data. although these extensions are under investigation, the proposed data analysis technique appears to be an impactful modification of the ideas presented in qblossoc, especially in the presence of population structure.

competing interests
both authors have no competing interests.

authors’ contributions
both authors developed the methodology. klt coded the algorithm, carried out all analyses, and drafted the manuscript. lsk revised the manuscript. both authors read and approved the final manuscript.

