BACKGROUND
microarray measurements of gene expression have become a popular tool for studying bacterial physiology, and hundreds of such studies are being conducted each year. generally, these studies compare a treatment, either environmental or genetic, to a control condition. after obtaining raw hybridization intensities by scanning the slides or chips, the next steps are to normalize the data to remove experimental artifacts and then to identify differentially expressed genes.

to assess the reliability of the microarray measurements and to distinguish significant changers from other genes, statisticians have analyzed the variation between replicate experiments  <cit> . implicitly, assessing significance by testing replication error assumes that replication captures all of the error in the data, and that there are no systematic biases. however, systematic errors have been observed due to many factors, including cross-hybridization, non-specific hybridization, dye incorporation bias, intensity-dependent effects, and spatial artifacts  <cit> . although normalization methods correct for some of these, systematic bias will likely remain; for example, most normalization methods cannot account for cross-hybridization or non-specific hybridization. to determine if systematic errors do remain after normalization, additional information besides the replicates is required.

for bacterial microarray experiments, we use operons to assess the amount of systematic error in the data. bacterial genes are often co-transcribed in multi-gene operons, and genes in the same operon should, in principle, have the same expression pattern. although genes in the same operon are often expressed at different levels due to the varying stability of different segments of the mrna, in steady-state situations, this will not affect the ratio in expression levels between conditions. because most mrna half-lives are short , mrna levels will be near steady state both in sustained growth  or within 20– <dig> minutes of a stress  being applied. thus, the steady state approximation should generally hold, and expression ratios should be consistent across an operon. another reason why expression patterns can vary within an operon is that some operons have internal promoters or differential regulation of mrna stability that can lead to differences in expression patterns  <cit> . in practice, however, genes known to be in the same operon usually have very similar expression patterns, and expression patterns can be used to predict operons  <cit> .

we assume that genes in the same operon have identical expression patterns, and infer that differences between the expression patterns of genes in the same operon are due to errors, which may be systematic or not. this assumption is somewhat conservative, because any true differences in expression patterns between genes in the same operon will be mistaken for errors, leading to overestimation of the amount of systematic error and conservative assessments of significance. in practice, however, this effect appears to be slight. because the operon structure of most genes has not been experimentally determined, we rely on operon predictions that are available for all prokaryotes  <cit> , along with estimates of their reliability  <cit> .

given this assumption about operons, we wish to estimate the amount of systematic bias in the data. one simple test is to ask how often two genes that are in the same operon have the same direction of change. however, even if one of the genes is a confident changer, and even if the operon prediction is highly confident, the measurement for the other gene in the operon may be noisy. in this case, the second gene will often report a change in the opposite direction from the first gene because of variation between the replicate measurements, and not because of systematic bias. thus, interpreting the external information from operons requires us to have a model of the replication error.

we extend linear models for microarray data with replicates  <cit>  to include systematic errors, and present an empirical bayes analysis of the overall amount of systematic error and of the significance of each gene. because we have observed that even low-confidence changers show a significant amount of agreement with operons, we do not assume that a minority of genes are changers and that the rest of the genes do not change  <cit> . instead, we will assume that all genes are changing, even if, for most of them, the magnitude of change is small and the direction of change cannot be determined with confidence. consequently, rather than trying to distinguish the changers from the rest of the genes, we estimate for each gene the posterior distribution for the gene's fold-change given the data and the model. this can be summarized as a confidence interval, as the posterior probability that the gene's expression level went up  in response to the treatment, or as the probability that the gene changed by  <dig> -fold or more.

to test our method, we conducted simulations and also analyzed several experimental data sets. in simulations, the method correctly estimates the amount of systematic bias in the data and gives reasonable p-values even when some of the assumptions of the method are violated. on real data, we tested the agreement with operons of genes having varying levels of significance. for both two-color cdna data and affymetrix oligonucleotide data, our method finds significant amounts of systematic error and reports plausible p-values that show a gradual reduction in agreement with operons as significance decreases. in contrast, approaches based on replication error, including non-parametric approaches  <cit> , often show low agreement with operons for confident changers . thus, methods that ignore systematic bias may be overstating significance dramatically.

we can also take advantage of operon structure to identify more changers. intuitively, if two or three genes in the same operon all change in the same direction then they are unlikely to be false positives, but a changer that disagrees with the other genes in the same operon is suspect. such reasoning is often used by biologists when examining microarray data. we derive a statistically sound "operon-wise" p-value, and show that these operon-wise p-values allow the identification of more changers at any specified level of significance than do single-gene p-values.

implementation
we present "opwise," an empirical bayes method for estimating the significance of the changes reported for each gene. the key elements of opwise are  a linear error model that includes systematic errors,  an approach for estimating the parameters of the error model , and, in particular, for inferring the amount of systematic error from the agreement within operons,  a mathematical solution for the posterior distribution of a gene's change in expression given the data for the gene and the parametrized error model, and  an extension to the method to take other genes in the same operon into account when estimating the significance of each gene.

to describe the expression of each gene, we use normalized expression ratios, as these should be consistent within each operon. in practice, we use log-ratios  rather than raw ratios. also, instead of assuming that only a small fraction of genes are changing, we assume that every gene is changing . furthermore, we assume that there is some unknown amount of systematic error in the measurement for each gene, so that errors will remain no matter the number of replicates. then, given the data for a gene i, we estimate the posterior distribution for the true log-ratio μi. this distribution can be summarized with a confidence interval or with the probability p that a gene's expression level went up in the treatment condition. this probability will be near zero for highly confident down-changers, near one for highly confident up-changers, and near  <dig>  for low-confidence measurements.

a linear model with systematic errors
first consider a simple experimental design with direct comparisons, where the samples from the conditions being compared are hybridized to the same chip. each gene i has an unknown true response μi, systematic error εi, and variance between replicates σi2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfdpwcdaqhaawcbagaemyaakgabagaegomaidaaaaa@30f0@. the measurements x→i
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwg4baegawcamaabaaaleaacqwgpbqaaeqaaaaa@2fbe@ for gene i are assumed to be normally distributed around μi + εi, and can be summarized by the observed mean mi = ∑jxij/ni, where ni is the number of measurements for gene i, and the total squared deviance si2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgzbwcdaqhaawcbagaemyaakgabagaegomaidaaaaa@3095@ = ∑j <dig>  so that the likelihood of the data for each gene i is given by

f=∏j=1nif∝σi−niexp⁡22σi2)=σi−niexp⁡2+si22σi2)     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaafaqabewacaaabagaemozaymaeiikagiafmieagnbasaadawgaawcbagaemyaakgabeaakiabcmcapiabg2da9maarahabagaemozaygaleaacqwgqbgacqgh9aqpcqaixaqmaeaacqwgubgbdawgaaadbagaemyaakgabeaaa0gaey4diunakmaabmaabagaemieag3aasbaasqaaiabdmgapjabdqgaqbqabagcdaabbaqaaggaciab=x7atnaabaaaleaacqwgpbqaaeqaaogaeiilawiae83wdm3aasbaasqaaiabdmgapbqabagccqggsaalaiaawea7aiab=v7alnaabaaaleaacqwgpbqaaeqaaagccagloagaayzkaaaabaaabagae8xhiurae83wdm3aa0baasqaaiabdmgapbqaaiab=jhitiabd6gaunaabaaameaacqwgpbqaaeqaaaaakigbcwgaljabciha4jabcchawjabcicaoiabgkhitmaalaaabawaaabeaeaacqggoaakcqwg4baedawgaawcbagaemyaakmaemoaaogabeaakiabgkhitiab=x7atnaabaaaleaacqwgpbqaaeqaaogaeyoei0iae8xtdu2aasbaasqaaiabdmgapbqabagccqggpaqkdaahaawcbeqaaiabikdayaaaaeaacqwgqbgaaeqaniabgghildaakeaacqaiyagmcqwfdpwcdaqhaawcbagaemyaakgabagaegomaidaaaaakiabcmcapaqaaaqaaiabg2da9iab=n8aznaadaaaleaacqwgpbqaaeaacqghsislcqwgubgbdawgaaadbagaemyaakgabeaaaagccygglbqzcqgg4baecqggwbaccqggoaakcqghsisldawcaaqaaiabd6gaunaabaaaleaacqwgpbqaaeqaaogaeiikagiae8hvd02aasbaasqaaiabdmgapbqabagccqghrawkcqwf1oqzdawgaawcbagaemyaakgabeaakiabgkhitiabd2gatnaabaaaleaacqwgpbqaaeqaaogaeiykakyaawbaasqabeaacqaiyagmaagccqghrawkcqwgzbwcdaqhaawcbagaemyaakgabagaegomaidaaagcbagaegomaijae83wdm3aa0baasqaaiabdmgapbqaaiabikdayaaaaagccqggpaqkaeaacawljagaaczcamaabmaabagaegymaedacagloagaayzkaaaaaaaa@a627@

another popular experimental design is to compare two types of samples separately to an external standard, such as genomic dna or pooled mrna samples. in these types of experiments, there are two sets of measured log levels for each gene, and the difference between them gives the log ratio. we refer to these log levels as x→1i
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwg4baegawcamaabaaaleaacqaixaqmcqwgpbqaaeqaaaaa@30ae@ and x→2i
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwg4baegawcamaabaaaleaacqaiyagmcqwgpbqaaeqaaaaa@30b0@, and summarize them with counts n1i and n2i, sample means m1i and m2i, and total squared deviances s1i2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgzbwcdaqhaawcbagaegymaejaemyaakgabagaegomaidaaaaa@3185@ and s2i2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgzbwcdaqhaawcbagaegomaijaemyaakgabagaegomaidaaaaa@3187@. we assume that the true variance in measurements x→1i
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwg4baegawcamaabaaaleaacqaixaqmcqwgpbqaaeqaaaaa@30ae@ and x→2i
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwg4baegawcamaabaaaleaacqaiyagmcqwgpbqaaeqaaaaa@30b0@ is identical, and that the unknown systematic bias εi affects the difference. we wish to estimate the distribution of μi = μ1i - μ2i. using the summary statistics ni = n1i + n2i -  <dig>  ni ≡ - <dig>  mi ≡ m1i - m2i, and si2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgzbwcdaqhaawcbagaemyaakgabagaegomaidaaaaa@3095@ ≡ s1i2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgzbwcdaqhaawcbagaegymaejaemyaakgabagaegomaidaaaaa@3185@ + s2i2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgzbwcdaqhaawcbagaegomaijaemyaakgabagaegomaidaaaaa@3187@, the likelihood is

f∝σi−niexp⁡2+si22σi2)     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgmbgzdaqadaqaaiabd2gatnaabaaaleaacqwgpbqaaeqaaogaeiilawiaem4cam3aa0baasqaaiabdmgapbqaaiabikdayaaakmaaeeaabaaccigae8hvd02aasbaasqaaiabdmgapbqabagccqggsaalcqwfdpwcdawgaawcbagaemyaakgabeaakiabcycasiab=v7alnaabaaaleaacqwgpbqaaeqaaagccaglhwoaaiaawicacaglpaaacqwfdistcqwfdpwcdaqhaawcbagaemyaakgabagae8nei0iaemoba42aasbaawqaaiabdmgapbqabaaaaogagiyzaumaeiieagnaeiicaanaeiikagiaeyoei0yaasaaaeaacqwgobgtdawgaawcbagaemyaakgabeaakiabcicaoiab=x7atnaabaaaleaacqwgpbqaaeqaaogaey4kasiae8xtdu2aasbaasqaaiabdmgapbqabagccqghsislcqwgtbqbdawgaawcbagaemyaakgabeaakiabcmcapmaacaaaleqabagaegomaidaaogaey4kasiaem4cam3aa0baasqaaiabdmgapbqaaiabikdayaaaaoqaaiabikdayiab=n8aznaadaaaleaacqwgpbqaaeaacqaiyagmaaaaaogaeiykakiaaczcaiaaxmaadaqadaqaaiabikdayagaayjkaiaawmcaaaaa@7285@

which is the same form as the direct comparison case except that ni has replaced ni in the exponential.

in either case, we use the conjugate prior to make the problem analytically tractable . we first assume that the distribution of θi ≡ 1/σi2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfdpwcdaqhaawcbagaemyaakgabagaegomaidaaaaa@30f0@ follows a chi-squared distribution . given σi2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfdpwcdaqhaawcbagaemyaakgabagaegomaidaaaaa@30f0@ for a gene, we then assume that the true mean μi, is normally distributed with variance proportionate to σi2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfdpwcdaqhaawcbagaemyaakgabagaegomaidaaaaa@30f0@. this assumption fits our data better than the alternative assumption of a fixed variance of μi across all genes , and previous work also used this proportionality  <cit> . we use the same proportionality for the systematic error εi. hence, our prior is:

θi≡1/σi2θi⋅α~χ2f=θiν−12e−αθi2ν+12Γμi~nεi~n     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaafaqabeqbcaaaaeaaiigacqwf4oqcdawgaawcbagaemyaakgabeaakiabggmi6kabigdaxiabc+caviab=n8aznaadaaaleaacqwgpbqaaeaacqaiyagmaaaakeaaaeaacqwf4oqcdawgaawcbagaemyaakgabeaakiabgwsixlab=f7ahjabc6ha+jab=d8ajnaacaaaleqabagaegomaidaaogaeiikagiae8xvd4maey4kasiaegymaejaeiykakcabaaabagaemozaymaeiikagiae8hude3aasbaasqaaiabdmgapbqabagccqggpaqkcqgh9aqpdawcaaqaaiab=h7axnaadaaaleaacqwgpbqaaeaadawcbaadbagae8xvd4maeyoei0iaegymaedabagaegomaidaaaaakiabdwgalnaacaaaleqabagaeyoei0yaasqaawqaaiab=f7ahjab=h7axnaabaaabagaemyaakgabeaaaeaacqaiyagmaaaaaowaaewaaeaadawcbawcbagae8xsdegabagaegomaidaaagccagloagaayzkaawaawbaasqabeaadawcbaadbagae8xvd4maey4kasiaegymaedabagaegomaidaaaaaaoqaaiabfo5ahnaabmaabawaasqaasqaaiab=17aujabgucariabigdaxaqaaiabikdayaaaaogaayjkaiaawmcaaaaaaeaaaeaacqwf8oqbdawgaawcbagaemyaakgabeaakiabc6ha+jabd6eaojabcicaoiabicdawiabcycasmaalaaabagaegymaedabagae8hude3aasbaasqaaiabdmgapbqabagccqwfyogyaagaeiykakcabaaabagae8xtdu2aasbaasqaaiabdmgapbqabagccqgg+bgfcqwgobgtcqggoaakcqaiwaamcqggsaaldawcaaqaaiabigdaxaqaaiab=h7axnaabaaaleaacqwgpbqaaeqaaogae83sdcgaaiabcmcapaqaaiaaxmaacawljawaaewaaeaacqaizawmaiaawicacaglpaaaaaaaaa@931c@

with hyperparameters α, ν, β, and γ. 1/α is the scale of the chi-squared, ν +  <dig> is its degrees of freedom, 1/β determines the amount of true changes in expression, and 1/γ determines the amount of systematic error.

we assume that the true means for the genes are independent, except that genes in the same operon have the same θi and μi . genes in the same operon are co-regulated, so μi should be similar. the assumption that θi is identical is required because in our model μi depends on θi the effectiveness of this assumption will be tested in the results. because operon predictions are only 80–90% accurate, we use a method that estimates the probability p that two adjacent genes are co-transcribed  <cit> , and treat the actual state of each potential operon pair as an unknown random variable. for example, the prediction method might estimate that two genes have a 90% probability of being in the same operon; in our model, we use this estimate as the true probability. we use only the likely operon pairs  ≥  <dig> ).

solving a simplified model
we first describe how to solve a simplified model with systematic errors removed, so that γ = ∞ and thus all εi =  <dig>  we need to estimate the hyperparameters from the data, so that we have a fully specified prior distribution, and then we need to infer the posterior distribution of the log-fold-change μi for each gene.

estimating the hyperparameters
in this simplified model, we need to estimate the prior distribution for θi , which is determined by the scale γ and degrees of freedom ν, and then the scale of variation for the true log-ratio μi given the variance σi2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfdpwcdaqhaawcbagaemyaakgabagaegomaidaaaaa@30f0@, which is given by 1/β. although we assume that μi is normally distributed for all genes, instead of being allowed to vary for a minority of genes, the variation between replicates in our model is the same as in  <cit> . as discussed by  <cit> , logs si2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgzbwcdaqhaawcbagaemyaakgabagaegomaidaaaaa@3095@  is approximately normally distributed, and its mean and variance can be written analytically. by fitting the hyperparameters α and ν to the observed mean and variance of log si2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgzbwcdaqhaawcbagaemyaakgabagaegomaidaaaaa@3095@,  <cit>  derived the following estimator:

ei≡log⁡si2−ψ+log⁡ψ'= mean{ <dig> ngenesngenes−1−ψ'}αν+1=exp⁡{e¯+ψ−log⁡}     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaafaqabewacaaabagaemyzau2aasbaasqaaiabdmgapbqabagccqghhjiucyggsbabcqggvbwbcqggnbwzcqwgzbwcdaqhaawcbagaemyaakgabagaegomaidaaogaeyoei0cccigae8hydknaeiikagyaasaaaeaacqwgubgbdawgaawcbagaemyaakgabeaakiabgkhitiabigdaxaqaaiabikdayaaacqggpaqkcqghrawkcyggsbabcqggvbwbcqggnbwzcqggoaakdawcaaqaaiabd6gaunaabaaaleaacqwgpbqaaeqaaogaeyoei0iaegymaedabagaegomaidaaiabcmcapaqaaaqaaiab=h8a5jabcecaniabcicaomaalaaabagae8xvd4maey4kasiaegymaedabagaegomaidaaiabcmcapiabg2da9iabbccagiabb2gatjabbwgaljabbggahjabb6gaujabbuha7jabbicaoiabdwgalnaabaaaleaacqwgpbqaaeqaaogaeyoei0iafmyzaumbaebacqggpaqkdaahaawcbeqaaiabikdayaaakiabc6caumaalaaabagaemota40aasbaasqaaiabdeganjabdwgaljabd6gaujabdwgaljabdohazbqabaaakeaacqwgobgtdawgaawcbagaem4zacmaemyzaumaemoba4maemyzaumaem4camhabeaakiabgkhitiabigdaxaaacqwfsislcqwfipqeieaacqgfnawjcqgfoaakdawcaaqaaiabd6gaunaabaaaleaacqwgpbqaaeqaaogaeyoei0iaegymaedabagaegomaidaaiabcmcapiabc2ha9bqaaaqaamaalaaabagae8xsdegabagae8xvd4maey4kasiaegymaedaaiabg2da9igbcwgaljabciha4jabcchawjabcuha7jqbdwgalzaaragaey4kasiae8hydknaeiikagyaasaaaeaacqwf9ogbcqghrawkcqaixaqmaeaacqaiyagmaagaeiykakiaeyoei0iagiibawmaei4ba8maei4zacmaeiikagyaasaaaeaacqwf9ogbcqghrawkcqaixaqmaeaacqaiyagmaagaeiykakiaeiyfa0habagaaczcaiaaxmaadaqadaqaaiabisda0agaayjkaiaawmcaaaaaaaa@b05a@

where ψ() is the digamma function, ψ'() is the trigamma function, and e¯
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacuwglbqzgaqeaaaa@2e17@ is the mean of the ei. ν can be obtained by inverting the trigamma function, which can be preformed numerically by newton iteration  <cit> . this leads to an estimate for α as well, and specifies the prior distribution of the true variances σi2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfdpwcdaqhaawcbagaemyaakgabagaegomaidaaaaa@30f0@ for each gene .

we then find the maximum likelihood estimate of β, which describes the prior distribution of the true means μi2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwf8oqbdaqhaawcbagaemyaakgabagaegomaidaaaaa@30e3@ for each gene . the likelihood of the data is

f=∏if=∏i∫0∞dθif∫−∞∞dμiff∝∏iββ+ni⋅−ν+ni+12     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaafaqabewacaaabagaemozaymaeiikagiafmyba0mbasaacqggsaalcqwgzbwcdaahaawcbeqaaiqbikdayyaalaaaaogaeiykakiaeyypa0zaaebuaeaacqwgmbgzcqggoaakcqwgtbqbdawgaawcbagaemyaakgabeaakiabcycasiabdohaznaadaaaleaacqwgpbqaaeaacqaiyagmaagccqggpaqkasqaaiabdmgapbqab0gaey4diunaaoqaaaqaaiabg2da9maarafabawaa8qmaeaacqwgkbaziigacqwf4oqcdawgaawcbagaemyaakgabeaakiabdagamjabcicaoiab=h7axnaabaaaleaacqwgpbqaaeqaaogaeiykakcaleaacqaiwaamaeaacqwfeispa0gaey4kiipaasqaaiabdmgapbqab0gaey4diunakmaapedabagaemizaqmae8hvd02aasbaasqaaiabdmgapbqabagccqwgmbgzcqggoaakcqwf8oqbdawgaawcbagaemyaakgabeaakmaaeeaabagae8hude3aasbaasqaaiabdmgapbqabaaakiaawea7aiabcmcapawcbagae8nei0iae8nhiukabagae8nhiukaniabguiiydgccqwgmbgzcqggoaakcqwgtbqbdawgaawcbagaemyaakgabeaakiabcycasiabdohaznaadaaaleaacqwgpbqaaeaacqaiyagmaagcdaabbaqaaiab=x7atnaabaaaleaacqwgpbqaaeqaaogaeiilawiae8hude3aasbaasqaaiabdmgapbqabagccqggpaqkaiaawea7aaqaaaqaaiab=1hi1oaarafabawaaoaaaeaadawcaaqaaiab=j7aibqaaiab=j7aijabgucariabd6eaonaabaaaleaacqwgpbqaaeqaaaaaaeqaaaqaaiabdmgapbqab0gaey4diunakiabgwsixpaabmaabagae8xsdemaey4kasiaem4cam3aa0baasqaaiabdmgapbqaaiabikdayaaakiabgucariabd2gatnaadaaaleaacqwgpbqaaeaacqaiyagmaagccqghfly1dawcaaqaaiabd6eaonaabaaaleaacqwgpbqaaeqaaogaeyyxictae8nsdigabagae8nsdimaey4kasiaemota40aasbaasqaaiabdmgapbqabaaaaagccagloagaayzkaawaawbaasqabeaacqghsisldawcbaadbagae8xvd4maey4kasiaemoba42aasbaaeaacqwgpbqaaeqaaiabgucariabigdaxaqaaiabikdayaaaaaaakeaacawljagaaczcamaabmaabagaegynaudacagloagaayzkaaaaaaaa@b79b@

where for direct comparison experiments, ni ≡ ni. this equation can be viewed as a product of t-distributions for the posterior probabilities of each gene's measurements. we choose β to maximize the  this likelihood, using a newton iteration method .

significance of individual genes
given estimates for the hyperparameters and the observed mean mi and total squared deviance si2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgzbwcdaqhaawcbagaemyaakgabagaegomaidaaaaa@3095@ for a gene i, the posterior probability distribution for μi is given by

f∝∫0∞fffdθi∝2+si2)−ν+ni2−1     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaafaqabegacaaabagaemozay2aaewaaeaaiigacqwf8oqbdawgaawcbagaemyaakgabeaakmaaeeaabagaemyba02aasbaasqaaiabdmgapbqabagccqggsaalcqwgzbwcdaqhaawcbagaemyaakgabagaegomaidaaagccaglhwoaaiaawicacaglpaaacqwfdistdawdxaqaaiabdagamnaabmaabagae8hude3aasbaasqaaiabdmgapbqabaaakiaawicacaglpaaacqwgmbgzdaqadaqaaiab=x7atnaabaaaleaacqwgpbqaaeqaaowaaqqaaeaacqwf4oqcdawgaawcbagaemyaakgabeaaaogaay5bsdaacagloagaayzkaaaaleaacqaiwaamaeaacqwfeispa0gaey4kiipakiabdagamnaabmaabagaemyba02aasbaasqaaiabdmgapbqabagccqggsaalcqwgzbwcdaqhaawcbagaemyaakgabagaegomaidaaowaaqqaaeaacqwf4oqcdawgaawcbagaemyaakgabeaakiabcycasiab=x7atnaabaaaleaacqwgpbqaaeqaaagccaglhwoaaiaawicacaglpaaacqwgkbazcqwf4oqcdawgaawcbagaemyaakgabeaaaoqaaaqaaiab=1hi1oaabmaabagae8xsdemaey4kasiae8nsdimae8hvd02aa0baasqaaiabdmgapbqaaiabikdayaaakiabgucariabd6eaonaabaaaleaacqwgpbqaaeqaaowaaewaaeaacqwf8oqbdawgaawcbagaemyaakgabeaakiabgkhitiabd2gatnaabaaaleaacqwgpbqaaeqaaagccagloagaayzkaawaawbaasqabeaacqaiyagmaagccqghrawkcqwgzbwcdaqhaawcbagaemyaakgabagaegomaidaaagccagloagaayzkaawaawbaasqabeaacqghsisldawcbaadbagae8xvd4maey4kasiaemoba42aasbaaeaacqwgpbqaaeqaaaqaaiabikdayaaaliabgkhitiabigdaxaaaaoqaaiaaxmaacawljawaaewaaeaacqai2agnaiaawicacaglpaaaaaaaaa@9676@

which is a t distribution with

mean=mi⋅niβ+nivariance=α+si2+mi2⋅ni⋅ββ+ni⋅d.f. = ν+ni+1     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaafaqabewacaaabagaeeyba0maeeyzaumaeeyyaemaeeoba4maeyypa0zaasaaaeaacqqgtbqbdawgaawcbagaeeyaakgabeaakiabgwsixlabb6eaonaabaaaleaacqqgpbqaaeqaaagcbaaccigae8nsdimaey4kasiaeeota40aasbaasqaaiabbmgapbqabaaaaagcbaaabagaeeodaynaeeyyaemaeeocainaeeyaakmaeeyyaemaeeoba4maee4yammaeeyzaumaeyypa0zaasaaaeaacqwfxoqycqghrawkieaacqgfzbwcdaqhaawcbagaeeyaakgabagaegomaidaaogaey4kasiaeeyba02aa0baasqaaiabbmgapbqaaiabbkdayaaakiabgwsixlabb6eaonaabaaaleaacqqgpbqaaeqaaogaeyyxic9aasqaasqaaiab=j7aibqaaiab=j7aijabgucariabb6eaonaabaaameaacqqgpbqaaeqaaaaaaoqaaiabbicaoiab=j7aijabgucariabb6eaonaabaaaleaacqqgpbqaaeqaaogaeiykakiaeyyxictaeiikagiae8xvd4maey4kasiae4nba42aasbaasqaaiabbmgapbqabagccqghrawkcqaixaqmcqggpaqkaaaabaaabagaeeizaqmaeeola4iaeeozaymaeeola4iaeeiiaaiaeeypa0jaeeiiaaiae8xvd4maey4kasiae4nba42aasbaasqaaiabbmgapbqabagccqghrawkcqaixaqmaeaacawljagaaczcamaabmaabagaeg4nacdacagloagaayzkaaaaaaaa@89e2@

intuitively, this distribution represents "shrunk" estimates of the mean and variance. mi2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgtbqbdaqhaawcbagaemyaakgabagaegomaidaaaaa@3089@ appears in the estimate of the variance σi2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfdpwcdaqhaawcbagaemyaakgabagaegomaidaaaaa@30f0@ because mi2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgtbqbdaqhaawcbagaemyaakgabagaegomaidaaaaa@3089@ contains information about the variance . the degrees of freedom for this t distribution includes both the observations ni and the prior knowledge about the variance ν.

given this posterior distribution, we can use the standard t test to answer questions about the confidence of measurement for gene i, e.g., to give a 95% confidence interval for the log-change μi or the posterior probability that the gene went up ).

accounting for systematic errors
the key advantage of our approach is to use biological knowledge  to take systematic errors into account. by definition, these systematic errors will not be eliminated by increasing the number of replicate measurements, but their size can be estimated from the variation between genes in the same operon. in this section, we add systematic errors to the above model  and describe how to account for such bias. specifically, we show how to estimate the amount of bias and how take the bias into account when assessing significance.

estimating the parameters
if we ignore the distinction between systematic error εi and true variation μi, then we can replace μi with μi'
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwf8oqbdaqhaawcbagaemyaakgabagaei4jaccaaaaa@30c7@ ≡ μi + εi. the distribution of μi'
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwf8oqbdaqhaawcbagaemyaakgabagaei4jaccaaaaa@30c7@ is given by

μi'~n+n=n)=n     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaafaqabegacaaabaaccigae8hvd02aa0baasqaaiabdmgapbqaaiabcecanaaakiabc6ha+jabd6eaonaabmaabagaegimaajaeiilawyaasaaaeaacqaixaqmaeaacqwf4oqcdawgaawcbagaemyaakgabeaakiab=j7aibaaaiaawicacaglpaaacqghrawkcqwgobgtdaqadaqaaiabicdawiabcycasmaalaaabagaegymaedabagae8hude3aasbaasqaaiabdmgapbqabagccqwfzowzaaaacagloagaayzkaaaabaaabagaeyypa0jaemota40aaewaaeaacqaiwaamcqggsaaldawcaaqaaiabigdaxaqaaiab=h7axnaabaaaleaacqwgpbqaaeqaaaaakiabgwsixlabcicaomaalaaabagaegymaedabagae8nsdigaaiabgucarmaalaaabagaegymaedabagae83sdcgaaiabcmcapagaayjkaiaawmcaaiabg2da9iabd6eaonaabmaabagaegimaajaeiilawyaasaaaeaacqaixaqmaeaacqwf4oqcdawgaawcbaacbigae4xaakgabeaakiqb=j7aizaafaaaaagaayjkaiaawmcaaaqaaiaaxmaacawljawaaewaaeaacqai4aaoaiaawicacaglpaaaaaaaaa@6b1e@

where 1/β' ≡ 1/β + 1/γ, so that the form of the distribution of mi for a model with systematic errors is the same as that for a model without systematic errors, except that we replace β with β'. the distribution of si2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgzbwcdaqhaawcbagaemyaakgabagaegomaidaaaaa@3095@ is not affected by systematic errors. thus, we can estimate α, ν and β' using the method for the simplified model.

we then find the maximum likelihood estimate of γ, which controls the amount of bias, by using our assumption that genes in the same operon will have the same values of μi and of θi = 1/σi2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaaiigacqwfdpwcdaqhaawcbagaemyaakgabagaegomaidaaaaa@30f0@. the total likelihood of the data can be decomposed into terms for individual genes and pairwise terms for operon pairs:

f=∏if∏ijff⋅f     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgmbgzcqggoaakcuwg4baegawcamaabaaaleaacqaixaqmaeqaaogaesojgskafmieagnbasaadawgaawcbagaemota4eabeaakiabcmcapiabg2da9maarafabagaemozaymaeiikagiafmieagnbasaadawgaawcbagaemyaakgabeaakiabcmcapmaarafabawaasaaaeaacqwgmbgzcqggoaakcuwg4baegawcamaabaaaleaacqwgpbqaaeqaaogaeiilawiafmieagnbasaadawgaawcbagaemoaaogabeaakiabcmcapaqaaiabdagamjabcicaoiqbdiha4zaalawaasbaasqaaiabdmgapbqabagccqggpaqkcqghfly1cqwgmbgzcqggoaakcuwg4baegawcamaabaaaleaacqwgqbgaaeqaaogaeiykakcaaawcbagaemyaakmaemoaaogabeqdcqghpis1aawcbagaemyaakgabeqdcqghpis1aogaaczcaiaaxmaadaqadaqaaiabimda5agaayjkaiaawmcaaaaa@6266@

we have already taken into account the effect of γ on the single-gene likelihoods f by introducing β', which is now being held constant, so these terms do not need to be considered. to derive an equation for the pairwise likelihood ratios, we first note the possibility that the operon prediction is incorrect, in which case the genes are independent and the likelihood ratio is 1:

ff⋅f=1−p+p⋅ff⋅f     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakqgabeqaag0abawaasaaaeaacqwgmbgzcqggoaakcuwg4baegawcamaabaaaleaacqwgpbqaaeqaaogaeiilawiafmieagnbasaadawgaawcbagaemoaaogabeaakiabcmcapaqaaiabdagamjabcicaoiqbdiha4zaalawaasbaasqaaiabdmgapbqabagccqggpaqkcqghfly1cqwgmbgzcqggoaakcuwg4baegawcamaabaaaleaacqwgqbgaaeqaaogaeiykakcaaiabg2da9iabigdaxiabgkhitiabdcfaqjabcicaoiabd+eapjabdchawjabdwgaljabdkhayjabd+gavjabd6gaunaabaaaleaacqwgpbqacqwgqbgaaeqaaogaeiykakcabagaaczcaiabgucariabdcfaqjabcicaoiabd+eapjabdchawjabdwgaljabdkhayjabd+gavjabd6gaunaabaaaleaacqwgpbqacqwgqbgaaeqaaogaeiykakiaeyyxic9aasaaaeaacqwgmbgzcqggoaakcuwg4baegawcamaabaaaleaacqwgpbqaaeqaaogaeiilawiafmieagnbasaadawgaawcbagaemoaaogabeaakmaaeeaabagaem4ta8kaemicaanaemyzaumaemocainaem4ba8maemoba42aasbaasqaaiabdmgapjabdqgaqbqabagccqggpaqkaiaawea7aaqaaiabdagamjabcicaoiqbdiha4zaalawaasbaasqaaiabdmgapbqabagccqggpaqkcqghfly1cqwgmbgzcqggoaakcuwg4baegawcamaabaaaleaacqwgqbgaaeqaaogaeiykakcaaiaaxmaacawljawaaewaaeaacqaixaqmcqaiwaamaiaawicacaglpaaaaaaa@924b@

the pairwise likelihood ratio for the operon case can be derived from

f=∫0∞dθijf∫−∞∞dμijf⋅f⋅f     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaafaqabegacaaabagaemozay2aaewaaeaacuwg4baegawcamaabaaaleaacqwgpbqaaeqaaogaeiilawiafmieagnbasaadawgaawcbagaemoaaogabeaakmaaeeaabagaem4ta8kaemicaanaemyzaumaemocainaem4ba8maemoba42aasbaasqaaiabdmgapjabdqgaqbqabaaakiaawea7aagaayjkaiaawmcaaiabg2da9maapedabagaemizaqgccigae8hude3aasbaasqaaiabdmgapjabdqgaqbqabagccqwgmbgzdaqadaqaaiab=h7axnaabaaaleaacqwgpbqacqwgqbgaaeqaaagccagloagaayzkaawaa8qmaeaacqwgkbazcqwf8oqbdawgaawcbagaemyaakmaemoaaogabeaakiabdagamnaabmaabagae8hvd02aasbaasqaaiabdmgapjabdqgaqbqabaaakiaawicacaglpaaaasqaaiabgkhitiab=5hilcqaaiab=5hilcqdcqghrii8aawcbagaegimaadabagae8nhiukaniabguiiydaakeaaaeaacqghfly1cqwgmbgzdaqadaqaaiabd2gatnaabaaaleaacqwgpbqaaeqaaogaeiilawiaem4cam3aa0baasqaaiabdmgapbqaaiabikdayaaakmaaeeaabagae8hvd02aasbaasqaaiabdmgapjabdqgaqbqabagccqggsaalcqwf4oqcdawgaawcbagaemyaakmaemoaaogabeaaaogaay5bsdaacagloagaayzkaagaeyyxictaemozay2aaewaaeaacqwgtbqbdawgaawcbagaemoaaogabeaakiabcycasiabdohaznaadaaaleaacqwgqbgaaeaacqaiyagmaagcdaabbaqaaiab=x7atnaabaaaleaacqwgpbqacqwgqbgaaeqaaogaeiilawiae8hude3aasbaasqaaiabdmgapjabdqgaqbqabaaakiaawea7aagaayjkaiaawmcaaaqaaiaaxmaacawljawaaewaaeaacqaixaqmcqaixaqmaiaawicacaglpaaaaaaaaa@9fa6@

f=∫0∞dθif∫−∞∞dμif⋅f     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgmbgzdaqadaqaaiqbdiha4zaalawaasbaasqaaiabdmgapbqabaaakiaawicacaglpaaacqgh9aqpdawdxaqaaiabdsgakhgaciab=h7axnaabaaaleaacqwgpbqaaeqaaogaemozay2aaewaaeaacqwf4oqcdawgaawcbagaemyaakgabeaaaogaayjkaiaawmcaaawcbagaegimaadabagae8nhiukaniabguiiydgcdawdxaqaaiabdsgakjab=x7atnaabaaaleaacqwgpbqaaeqaaogaemozay2aaewaaeaacqwf8oqbdawgaawcbagaemyaakgabeaaaogaayjkaiaawmcaaiabgwsixlabdagamnaabmaabagaemyba02aasbaasqaaiabdmgapbqabagccqggsaalcqwgzbwcdaqhaawcbagaemyaakgabagaegomaidaaowaaqqaaeaacqwf8oqbdawgaawcbagaemyaakgabeaakiabcycasiab=h7axnaabaaaleaacqwgpbqaaeqaaagccaglhwoaaiaawicacaglpaaaasqaaiab=jhitiab=5hilcqaaiab=5hilcqdcqghrii8aogaaczcaiaaxmaadaqadaqaaiabigdaxiabikdayagaayjkaiaawmcaaaaa@6e2c@

f=∫−∞∞dεif⋅f     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgmbgzdaqadaqaaiabd2gatnaabaaaleaacqwgpbqaaeqaaogaeiilawiaem4cam3aa0baasqaaiabdmgapbqaaiabikdayaaakmaaeeaabaaccigae8hvd02aasbaasqaaiabdmgapbqabagccqggsaalcqwf4oqcdawgaawcbagaemyaakgabeaaaogaay5bsdaacagloagaayzkaagaeyypa0zaa8qmaeaacqwgkbazcqwf1oqzdawgaawcbaacbigae4xaakgabeaakiabdagamnaabmaabagae8xtdu2aasbaasqaaiabdmgapbqabaaakiaawicacaglpaaaasqaaiab=jhitiab=5hilcqaaiab=5hilcqdcqghrii8aogaeyyxictaemozay2aaewaaeaacqwgtbqbdawgaawcbagaemyaakgabeaakiabcycasiabdohaznaadaaaleaacqwgpbqaaeaacqaiyagmaagcdaabbaqaaiab=x7atnaabaaaleaacqwgpbqaaeqaaogaeiilawiae8hude3aasbaasqaaiabdmgapbqabagccqggsaalcqwf1oqzdawgaawcbagaemyaakgabeaaaogaay5bsdaacagloagaayzkaagaaczcaiaaxmaadaqadaqaaiabigdaxiabiodazagaayjkaiaawmcaaaaa@708e@

to give

ff⋅f=−ν+12⋅γ⋅⋅ββ+ni'+nj'⋅β'⋅ΓΓΓΓ⋅−ν+ni+nj+12−−ν+ni+12⋅−ν+nj+12     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakqgabeqaag3abawaasaaaeaacqwgmbgzdaqadaqaaiqbdiha4zaalawaasbaasqaaiabdmgapbqabagccqggsaalcuwg4baegawcamaabaaaleaacqwgqbgaaeqaaowaaqqaaeaacqwgpbwtcqwgwbaccqwglbqzcqwgybgccqwgvbwbcqwgubgbdawgaawcbagaemyaakmaemoaaogabeaaaogaay5bsdaacagloagaayzkaaaabagaemozay2aaewaaeaacuwg4baegawcamaabaaaleaacqwgpbqaaeqaaagccagloagaayzkaagaeyyxictaemozay2aaewaaeaacuwg4baegawcamaabaaaleaacqwgqbgaaeqaaagccagloagaayzkaaaaaiabg2da9maabmaabawaasaaaeaaiigacqwfxoqyaeaacqaiyagmaaaacagloagaayzkaawaawbaasqabeaacqghsisldawcbaadbagae8xvd4maey4kasiaegymaedabagaegomaidaaaaakiabgwsixpaalaaabagae83sdcgabawaaoaaaeaacqggoaakcqwgobgtdawgaawcbagaemyaakgabeaakiabgucariab=n7anjabcmcapiabgwsixlabcicaoiabd6eaonaabaaaleaacqwgqbgaaeqaaogaey4kasiae83sdcmaeiykakcaleqaaaaaaoqaaiaaxmaacqghfly1dagcaaqaamaalaaabagae8nsdigabagae8nsdimaey4kasiaemota40aa0baasqaaiabdmgapbqaaiabcecanaaakiabgucariabd6eaonaadaaaleaacqwgqbgaaeaacqggnawjaaaaaaqabagccqghfly1dawcaaqaamaakaaabagaeiikagiae8nsdimaei4jaciaey4kasiaemota40aasbaasqaaiabdmgapbqabagccqggpaqkcqggoaakcqwfyogycqggnawjcqghrawkcqwgobgtdawgaawcbagaemoaaogabeaakiabcmcapawcbeaaaoqaaiab=j7aijabcecanaaaaeaacqghfly1dawcaaqaaiabfo5ahnaabmaabawaasqaasqaaiab=17aujabgucariabd6gaunaabaaameaacqwgpbqaaeqaasgaey4kasiaemoba42aasbaawqaaiabdqgaqbqabawccqghrawkcqaixaqmaeaacqaiyagmaaaakiaawicacaglpaaacqqhtowrdaqadaqaamaaleaaleaacqwf9ogbcqghrawkcqaixaqmaeaacqaiyagmaaaakiaawicacaglpaaaaeaacqqhtowrdaqadaqaamaaleaaleaacqwf9ogbcqghrawkcqwgubgbdawgaaadbagaemyaakgabeaaliabgucariabigdaxaqaaiabikdayaaaaogaayjkaiaawmcaaiabfo5ahnaabmaabawaasqaasqaaiab=17aujabgucariabd6gaunaabaaameaacqwgqbgaaeqaasgaey4kasiaegymaedabagaegomaidaaagccagloagaayzkaaaaaiabgwsixpaalaaabawaaewaaeaacqwgybawdawgaawcbagaemyaakmaemoaaogabeaakiabc+caviabikdayagaayjkaiaawmcaamaacaaaleqabagaeyoei0yaasqaawqaaiab=17aujabgucariabd6gaunaabaaabagaemyaakgabeaacqghrawkcqwgubgbdawgaaqaaiabdqgaqbqabagaey4kasiaegymaedabagaegomaidaaaaaaoqaamaabmaabagaemiwag1aasbaasqaaiabdmgapbqabagccqggvawlcqaiyagmaiaawicacaglpaaadaahaawcbeqaaiabgkhitmaaleaameaacqghsislcqwf9ogbcqghrawkcqwgubgbdawgaaqaaiabdmgapbqabagaey4kasiaegymaedabagaegomaidaaaaakiabgwsixpaabmaabagaemiwag1aasbaasqaaiabdqgaqbqabagccqggvawlcqaiyagmaiaawicacaglpaaadaahaawcbeqaaiabgkhitmaaleaameaacqwf9ogbcqghrawkcqwgubgbdawgaaqaaiabdqgaqbqabagaey4kasiaegymaedabagaegomaidaaaaaaagccawljagaaczcamaabmaabagaegymaejaeginaqdacagloagaayzkaaaaaaa@0335@

where

xi=α+si2+mj2⋅ni⋅β′β′+ni     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgybawdawgaawcbagaemyaakgabeaakiabg2da9ggaciab=f7ahjab=tcariabdohaznaadaaaleaacqwgpbqaaeaacqaiyagmaagccqghrawkcqwgtbqbdaqhaawcbagaemoaaogabagaegomaidaaogaeyyxictaemota40aasbaasqaaiabdmgapbqabagccqghfly1dawcaaqaaiqb=j7aizaafaaabagaf8nsdimbauaacqghrawkcqwgobgtdawgaawcbagaemyaakgabeaaaagccawljagaaczcamaabmaabagaegymaejaegynaudacagloagaayzkaaaaaa@4eb2@

and similarly for j, and

xij=α+si2+sj2+ni'⋅mi2+nj'⋅mj2−2β+ni'+nj'     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgybawdawgaawcbagaemyaakmaemoaaogabeaakiabg2da9ggaciab=f7ahjabgucariabdohaznaadaaaleaacqwgpbqaaeaacqaiyagmaagccqghrawkcqwgzbwcdaqhaawcbagaemoaaogabagaegomaidaaogaey4kasiaemota40aa0baasqaaiabdmgapbqaaiabcecanaaakiabgwsixlabd2gatnaadaaaleaacqwgpbqaaeaacqaiyagmaagccqghrawkcqwgobgtdaqhaawcbagaemoaaogabagaei4jaccaaogaeyyxictaemyba02aa0baasqaaiabdqgaqbqaaiabikdayaaakiabgkhitmaalaaabawaaewaaeaacqwgtbqbdawgaawcbagaemyaakgabeaakiabgwsixlabd6eaonaadaaaleaacqwgpbqaaeaacqggnawjaagccqghrawkcqwgtbqbdawgaawcbagaemoaaogabeaakiabgwsixlabd6eaonaadaaaleaacqwgqbgaaeaacqggnawjaaaakiaawicacaglpaaadaahaawcbeqaaiabikdayaaaaoqaaiab=j7aijabgucariabd6eaonaadaaaleaacqwgpbqaaeaacqggnawjaagccqghrawkcqwgobgtdaqhaawcbagaemoaaogabagaei4jaccaaaaakiaaxmaacawljawaaewaaeaacqaixaqmcqai2agnaiaawicacaglpaaaaaa@77cd@

and

ni'≡−1     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgobgtdaqhaawcbagaemyaakgabagaei4jaccaaogaeyyyio7aaewaaeaacqwgobgtdaqhaawcbagaemyaakgabagaeyoei0iaegymaedaaogaey4kascccigae83sdc2aawbaasqabeaacqghsislcqaixaqmaaaakiaawicacaglpaaadaahaawcbeqaaiabgkhitiabigdaxaaakiaaxmaacawljawaaewaaeaacqaixaqmcqai3awnaiaawicacaglpaaaaaa@4390@

and similarly for j. although much of eq.  <dig> has no simple intuitive explanation, and unfortunately the constant terms are required , the -df/ <dig> terms can be viewed as t distribution forms for the joint probability f divided by similar forms for the independent probabilities f and f.

given this solution for the likelihood of the data, we can use a newton iteration method to find the value of γ that maximizes the product of the pair-wise likelihood ratios given by eq.  <dig> 

significance of individual genes
if we ignore the information from other genes, then the posterior distribution of μi is given by a t distribution with

mean =mi⋅ni'β+ni'variance = α+si2+mi2⋅ni'⋅β/⋅d.f. = ν+ni+1     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaafaqabewacaaabagaeeyba0maeeyzaumaeeyyaemaeeoba4maeeiiaaiaeeypa0zaasaaaeaacqqgtbqbdawgaawcbagaeeyaakgabeaakiabgwsixlabb6eaonaadaaaleaacqqgpbqaaeaacqqgnawjaaaakeaaiigacqwfyogycqghrawkieaacqgfobgtdaqhaawcbagae4xaakgabawexlmbbxgbcf2cpn2qvrwzqf2zlnharygvljhzh5wyagabaiaa9dcaaaaaaagcbaaabagaeeodaynaeeyyaemaeeocainaeeyaakmaeeyyaemaeeoba4maee4yammaeeyzaumaeeiiaaiaeeypa0jaeeiiaayaasaaaeaacqwfxoqycqghrawkcqgfzbwcdaqhaawcbagae4xaakgabagae4nmaidaaogaey4kasiaeeyba02aa0baasqaaiabbmgapbqaaiabbkdayaaakiabgwsixlabb6eaonaadaaaleaacqqgpbqaaeaacqqgnawjaagccqghfly1cqwfyogycqqgvawldaqadaqaaiabb6eaonaadaaaleaacqqgpbqaaeaacqqgnawjaagccqghrawkcqwfyogyaiaawicacaglpaaaaeaadaqadaqaaiab=j7aijabgucariab+5eaonaadaaaleaacqgfpbqaaeaacaqfnaaaaagccagloagaayzkaagaeyyxic9aaewaaeaacqwf9ogbcqghrawkcqgfubgbdawgaawcbagae4xaakgabeaakiabgucariabigdaxagaayjkaiaawmcaaaaaaeaaaeaacqqgkbazcqqguaglcqqgmbgzcqqguaglcqqggaaicqqg9aqpcqqggaaicqwf9ogbcqghrawkcqgfubgbdawgaawcbagaeeyaakgabeaakiabgucariabigdaxaqaaiaaxmaacawljawaaewaaeaacqaixaqmcqai4aaoaiaawicacaglpaaaaaaaaa@9d5e@

this is the same as case without systematic bias except that ni, which describes the amount of data and hence the reduction in uncertainty due to replication, has been replaced by the smaller term ni'
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgobgtdaqhaawcbagaemyaakgabagaei4jaccaaaaa@302f@.

significance taking operons into account
although the method as described so far uses operon predictions to estimate the hyperparameters, it uses only the information for each gene when computing p-values. we will refer to these as "single-gene" p-values. in this section, we describe 'operon-wise" p-values that use information from other genes in the same operon to improve our estimates of the significance of each gene. as we will show in the results, using this additional information often allows increased confidence in the measurements.

first, assume that we have two genes i and j that are known to be in the same operon, with the same  μij and θij but with differing biases εi, εj. given measurements for the two genes, the posterior distribution for μij is a t distribution with

mean =ni'⋅mi+nj'⋅mjβ+ni'+nj'variance = α+si2+sj2+ni'⋅mi2+nj'⋅mj2−2β+ni'+nj'⋅d.f. =ν+ni+nj+1     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaafaqabewacaaabagaeeyba0maeeyzaumaeeyyaemaeeoba4maeeiiaaiaeeypa0zaasaaaeaacqqgobgtdaqhaawcbagaeeyaakgabagaei4jaccaaogaeyyxictaeeyba02aasbaasqaaiabbmgapbqabagccqghrawkcqqgobgtdaqhaawcbagaeeoaaogabagaee4jaccaaogaeyyxictaeeyba02aasbaasqaaiabbqgaqbqabaaakeaaiigacqwfyogycqghrawkcqqgobgtdaqhaawcbagaeeyaakgabagaee4jaccaaogaey4kasiaeeota40aa0baasqaaiabbqgaqbqaaiabbecanaaaaaaakeaaaeaacqqg2bgdcqqghbqycqqgybgccqqgpbqacqqghbqycqqgubgbcqqgjbwycqqglbqzcqqggaaicqqg9aqpcqqggaaidawcaaqaaiab=f7ahjabgucariabbohaznaadaaaleaacqqgpbqaaeaacqqgyagmaagccqghrawkcqqgzbwcdaqhaawcbagaeeoaaogabagaeeomaidaaogaey4kasiaeeota40aa0baasqaaiabbmgapbqaaiabbecanaaakiabgwsixlabb2gatnaadaaaleaacqqgpbqaaeaacqqgyagmaagccqghrawkcqqgobgtdaqhaawcbagaeeoaaogabagaee4jaccaaogaeyyxictaeeyba02aa0baasqaaiabbqgaqbqaaiabbkdayaaakiabgkhitmaaleaaleaadaqadaqaaiabb6eaonaabaaameaacqqgpbqaaeqaasgaeyyxictaeeyba02aasbaawqaaiabbmgapbqabawccqghrawkcqqgobgtdawgaaadbagaeeoaaogabeaaliabgwsixlabb2gatnaabaaameaacqqgqbgaaeqaaawccagloagaayzkaawaawbaawqabeaacqaiyagmaaaaleaacqwfyogycqghrawkcqqgobgtdaqhaaadbagaeeyaakgabagaee4jaccaasgaey4kasiaeeota40aa0baawqaaiabbqgaqbqaaiabbecanaaaaaaakeaadaqadaqaaiab=17aujabgucariabb6gaunaabaaaleaacqqgpbqaaeqaaogaey4kasiaeeoba42aasbaasqaaiabbqgaqbqabagccqghrawkcqaixaqmaiaawicacaglpaaacqghfly1daqadaqaaiab=j7aijabgucariabb6eaonaadaaaleaacqqgpbqaaeaaieaacqgfnawjaagccqghrawkcqgfobgtdaqhaawcbagae4naaogabagae43jaccaaagccagloagaayzkaaaaaaqaaaqaaiabbsgakjabb6cauiabbagamjabb6cauiabbccagiabb2da9iab=17aujabgucariab+5gaunaabaaaleaacqgfpbqaaeqaaogaey4kasiae4nba42aasbaasqaaiab+pgaqbqabagccqghrawkcqaixaqmaeaacawljagaaczcamaabmaabagaegymaejaegyoakdacagloagaayzkaaaaaaaa@ce9d@

it is straightforward to extend this formula to three or more genes.

in practice, operon predictions are uncertain, and we need to take this uncertainty into account in estimating confidence. we use only the adjacent pairs that are predicted to be in the same operon  ≥  <dig> ), as non-adjacent pairs are less reliable. in the most complicated situation, we have genes i and k on either side of our target gene j and four possible cases: singleton transcript j, two-gene operon ij, two-gene operon jk, or three-gene operon ijk. the posterior distribution of μj is then a mixture of the corresponding four posterior distributions, and a specific probability such as p is determined from a linear combination of the probabilities from four t tests.

to determine the weight of the terms in the mixture, we do not use the input probabilities p and p. instead, we use the posterior operon probabilities given the data. that is, we use the microarray data to help estimate the likelihood that a pair of genes are co-transcribed. using the posterior operon probabilities gives the rigorously correct posterior distribution for μj . using the posterior operon probabilities also prevents the method from asserting that a gene went down when it in fact went up but other genes in the operon went down, because in this situation the posterior probability of the operon will be low.

using bayes' law, these posterior probabilities p can be obtained from

pp=pp⋅ff⋅f     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadawcaaqaaiabdcfaqnaabmaabagaem4ta8kaemicaanaemyzaumaemocainaem4ba8maemoba42aasbaasqaaiabdmgapjabdqgaqbqabagcdaabbaqaaiqbdiha4zaalawaasbaasqaaiabdmgapbqabagccqggsaalcuwg4baegawcamaabaaaleaacqwgqbgaaeqaaagccaglhwoaaiaawicacaglpaaaaeaacqwgqbaudaqadaqaaiabgykaylabd+eapjabdchawjabdwgaljabdkhayjabd+gavjabd6gaunaabaaaleaacqwgpbqacqwgqbgaaeqaaowaaqqaaeaacuwg4baegawcamaabaaaleaacqwgpbqaaeqaaogaeiilawiafmieagnbasaadawgaawcbagaemoaaogabeaaaogaay5bsdaacagloagaayzkaaaaaiabg2da9maalaaabagaemiuaa1aaewaaeaacqwgpbwtcqwgwbaccqwglbqzcqwgybgccqwgvbwbcqwgubgbdawgaawcbagaemyaakmaemoaaogabeaaaogaayjkaiaawmcaaaqaaiabdcfaqnaabmaabagaeyiragtaem4ta8kaemicaanaemyzaumaemocainaem4ba8maemoba42aasbaasqaaiabdmgapjabdqgaqbqabaaakiaawicacaglpaaaaagaeyyxic9aasaaaeaacqwgmbgzdaqadaqaaiqbdiha4zaalawaasbaasqaaiabdmgapbqabagccqggsaalcuwg4baegawcamaabaaaleaacqwgqbgaaeqaaowaaqqaaeaacqwgpbwtcqwgwbaccqwglbqzcqwgybgccqwgvbwbcqwgubgbdawgaawcbagaemyaakmaemoaaogabeaaaogaay5bsdaacagloagaayzkaaaabagaemozay2aaewaaeaacuwg4baegawcamaabaaaleaacqwgpbqaaeqaaagccagloagaayzkaagaeyyxictaemozay2aaewaaeaacuwg4baegawcamaabaaaleaacqwgqbgaaeqaaagccagloagaayzkaaaaaiaaxmaacawljawaaewaaeaacqaiyagmcqaiwaamaiaawicacaglpaaaaaa@a61b@

where p is the prior probability and the formula for the ratio on the right was given in eq.  <dig>  given the individual pair probabilities and the mixture of four cases discussed above, the weight for each case is just its probability. for example, the weight for the three-gene operon case is

p=p⋅p     
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaafaqabegacaaabagaemiuaa1aaewaaeaacqwgpbwtcqwgwbaccqwglbqzcqwgybgccqwgvbwbcqwgubgbdawgaawcbagaemyaakmaemoaaomaem4aasgabeaakmaaeeaabagafmieagnbasaadawgaawcbagaemyaakgabeaakiabcycasiqbdiha4zaalawaasbaasqaaiabdqgaqbqabagccqggsaalcuwg4baegawcamaabaaaleaacqwgrbwaaeqaaagccaglhwoaaiaawicacaglpaaaaeaaaeaacqgh9aqpcqwgqbaudaqadaqaaiabd+eapjabdchawjabdwgaljabdkhayjabd+gavjabd6gaunaabaaaleaacqwgpbqacqwgqbgaaeqaaowaaqqaaeaacuwg4baegawcamaabaaaleaacqwgpbqaaeqaaogaeiilawiafmieagnbasaadawgaawcbagaemoaaogabeaaaogaay5bsdaacagloagaayzkaagaeyyxictaemiuaa1aaewaaeaacqwgpbwtcqwgwbaccqwglbqzcqwgybgccqwgvbwbcqwgubgbdawgaawcbagaemoaaomaem4aasgabeaakmaaeeaabagafmieagnbasaadawgaawcbagaemoaaogabeaakiabcycasiqbdiha4zaalawaasbaasqaaiabdugarbqabaaakiaawea7aagaayjkaiaawmcaaaqaaiaaxmaacawljawaaewaaeaacqaiyagmcqaixaqmaiaawicacaglpaaaaaaaaa@7d60@

RESULTS
we tested opwise on four data sets collected with a variety of measurement platforms  that used different methods of controlling systematic bias  and from several different bacteria: with these data sets, we first used simulations to test whether opwise fit the data and whether opwise was robust to deviations from its assumptions. we then tested for systematic bias in the real data and examined significance estimates from opwise and other methods. finally, we tested whether operon-wise tests were more powerful than single-gene tests.

data sets
• dvsalt <dig> – desulfovibrio vulgaris salt shock at  <dig> minutes . this data was collected using two-color glass slides with 70-mer probes. the experiment was an indirect comparison through a genomic control. there were three biological replications for each condition, measured with one slide each, and two spots per gene per slide, for a total of six replicate measurements for each gene and condition.

• ecox – a comparison of aerobic and anaerobic log-phase growth in escherichia coli . this data was from affymetrix oligonucleotide chips with three or four replicate hybridizations for each of the two conditions.

• shcold <dig> – shewanella oneidensis cold shock at  <dig> minutes . this data was a direct comparison of two-color glass slides using cdna probes. there were five biological replicates with one slide each and two spots per gene per slide , but no dye swap .

• shheat <dig> – shewanella oneidensis heat shock at  <dig> minutes  <cit> . this data was also a direct comparison of two-color cdna probes. there were three biological replicates, with two replicate slides each and two spots per gene per slide , and with dye swap .

for the two-color direct comparison data sets , we performed intensity-dependent and then spatial normalization on each slide. specifically, we first used a locally smooth estimator to remove intensity-dependent effects and then subtracted the median from each sector, similar to the recommendations of  <cit> . for the indirect comparison data set , we treated the ratio of intensities between the channels corresponding to cdna and to genomic dna as a raw expression level. we first performed a global normalization for each slide so that the total expression level was the same for each slide, and then computed the average of the log-expression levels across slides from the two conditions. we then applied the intensity-dependent and spatial normalization approaches to these log-levels. for all three of these data sets, we considered the different spots for each gene as independent sets of replicates. there was little difference between within-slide and between-slide variance . for the affymetrix data set , the data we downloaded had already been normalized with dchip  <cit> , so we used the normalized expression levels provided; to prevent small values of expression level from giving extreme outliers for log ratios, we added a small constant  to the expression levels before taking a logarithm.

for each data set, we also performed  <dig> simulations using the parameters estimated for that data set by opwise. each simulation had the same proportion of missing data as the corresponding data set. for operons, we randomly assigned adjacent genes on the same strand to be in the same operon or not with the probabilities given by the prediction method, but only if the probability was  <dig>  or greater. with these simulations of the opwise model, we were able to test our assumptions about the distribution of means and variances. to emulate the heavy tails in ecox , we performed  <dig> simulations where 10% of the genes had much higher variation in the mean  than the other genes. finally, to test our assumptions that  the true mean and true variance are correlated and  the true variance is correlated within each operon, for each data set we performed  <dig> "uncoupled" simulations where the mean was independent of variance  and genes in the same operon had independent variances.

fit of model to data
to see how well the model fit the data, we inferred the hyperparameters for each data set, used these parameters to create simulated data, and compared the simulated data to the original data sets. the model's inverse chi-square distribution gave an excellent fit to the observed distribution of squared deviance si2
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacqwgzbwcdaqhaawcbagaemyaakgabagaegomaidaaaaa@3095@ . the simulated distribution of observed means had heavier tails than a normal distribution, due to the wide spread of deviances. the distribution of means fit the data fairly well for three of the data sets, but for the ecox data set, the true distribution had even heavier tails .

to test our assumption that the variation in the true means depends on the true variances, we compared the correlations of observed means and squared deviances in the real data to simulations using the opwise model and also using an uncoupled model in which the means and variances were independent. the observed mean and squared deviance were much more correlated than in the uncoupled model, except in the shcold <dig> data set . similarly, within each operon the squared deviances were significantly correlated . however, the correlations were generally weaker than in the simulations, indicating deviations from the assumptions.

robustness of opwise in simulations
to test opwise, we created simulated data sets based on our statistical model. we wanted to verify that the estimated hyperparameters were accurate enough to give reasonable p-values. because opwise uses operons to estimate the overall reliability of the measurements, we also hypothesized that opwise would be robust to the modest deviations from its assumptions. in particular, opwise assumes that the variance in the true change of each gene depends on the variance of measurement for that gene. because we found a weaker-than-expected relationship between observed deviances and means, we performed "uncoupled" simulations where the true means and variances were uncorrelated. our statistical model also uses normal distributions. although different genes can have widely varying variances of measurements, which allows the observed means to have somewhat heavy tails, even heavier tails were observed for the ecox data set. so, we also conducted heavy-tailed simulations .

we examined the single-gene estimates of p for the simulated data . for the simulations using the opwise model, we compared these p-values computed with estimated hyperparameters to "ideal" p-values computed with the true hyperparameters. for the "uncoupled" simulations with μi independent of σi, and for the heavy-tailed simulations, we compared the p-values to the actual sign of μi for each gene.

when comparing the log odds of the estimated p-values to the log odds of the ideal p-values, we consistently observed a strongly linear relationship, with correlation coefficients above  <dig>   ≡ log⁡p1−p
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacyggsbabcqggvbwbcqggnbwzdawcaaqaaiabbchawbqaaiabbgdaxiabgkhitiabbchawbaaaaa@357e@). in other words, the ordering and shape of the significance values was not affected, but the overall scale of significance could be. to summarize this linear relationship between the two sets of significance estimates, we used the slope of the ideal log odds as a function of the estimated log odds. as shown in figure 1b, most simulations had slopes very close to the ideal value of  <dig> . in a total of  <dig> simulations across  <dig> data sets, the most extreme aggressive slope was  <dig>  . this corresponds to reporting p =  <dig>  when the true p =  <dig> .

for the uncoupled and heavy-tailed simulations, which violated the assumptions of our model, we did not have ideal p-values to compare to, so we instead used logistic regression  to estimate the slope. logistic regression identifies the multiplier for the estimated log odds that best fits the observed pattern of whether μ >  <dig> or not – see figure 1c. as shown in figure 1d, the accuracy of opwise was not dramatically affected by uncoupling the mean from the variance. however, the heavy-tailed simulations for the ecox data set produced slopes around  <dig> , with a maximum of  <dig> .  a slope of  <dig> , which corresponds to reporting p =  <dig>  when the true p =  <dig> , is not ideal, but as we will show, methods that do not account for systematic bias, including non-parametric methods, can perform dramatically worse.

for all simulations, we also compared the operon-wise p-values to either the ideal or true significance. these gave similar slopes as the single-gene p-values, but with consistently smaller deviations from  <dig>  . overall, opwise was largely insensitive to deviations from its assumptions.

presence of bias
opwise identified large amounts of systematic bias, similar in magnitude to the true changes in gene levels and the replication error, in all four data sets . furthermore, the bias was statistically highly significant in all four data sets, as determined by a maximum likelihood ratio test .

one source of apparent bias might be correlation between the replicates. that is, if the replicate measurements are not truly independent and some of the replicates are correlated, then the noise in the average of the replicate measurements will be larger than expected. for example, the shheat <dig> data set had a total of  <dig> measurements per gene . in this data set, the replicate measurements with the same dye assignment were more correlated than those with reversed dyes. to test the pattern of bias with fully independent replicates, we created two subsets of the data. first, we used only the first spot for each gene on the slides and a single biological replicate, leaving two replicates with different dye assignments. second, we used only a single dye assignment and only the first spot per slide, leaving three replicates from different samples. in both cases, we still observed large amounts of bias . we also verified that opwise was not sensitive to correlations between replicates. we created an exact duplicate of each replicate, and this "doubled" data set gave significance values very similar to the original data set .

we also considered the possibility that mrna levels in shcold <dig> and shheat <dig>  which were measured only  <dig> minutes after the stress was applied, were far from steady-state and that some operons would have poor agreement because of differential mrna decay. however, later time points from these same experiments showed similar amounts of bias . overall, these analyses confirmed that systematic bias is a major problem in real data sets. next, we show that ignoring this bias can lead to overestimating the significance of individual genes.

opwise estimates significance correctly
to test the quality of the significance estimates on real data, we compared the confidence assigned by opwise to the extent of agreement with operons. although our p-values are single-tailed – they test only the hypothesis that μi >  <dig> – we wanted a two-tailed notion of confidence, because this is more comparable to other methods. we defined the two-tailed confidence as c = 2·|p - 1/2|. for each data set, we sorted genes by confidence into eight groups. for each gene, we then identified other genes predicted to be in the same operon, and asked whether the two genes changed in the same direction.  intuitively, if a group of genes are 99% confident changers, then 99% of the time, the measurement for that gene is correct, and it will always have the same sign as other genes in the operon; the other 1% of the time, there is no information about the gene, and the genes will have the same sign, by chance, 50% of the time. that is, p = c + / <dig>  or 2·p -  <dig> = c we also needed to correct for the possibility that the operon prediction is incorrect, which gives 2·p -  <dig> = c·p. thus, we defined an adjusted measure of agreement, whose expectation ranges from  <dig> for data that is all noise to  <dig> for perfect data, as adjusted = /p, where agree is  <dig> if true and  <dig> if false. this measure corrects for variations in the confidence of operon predictions between groups of genes – in some data sets, the most confident changers were, on average, in more confidently predicted operons . finally, even if the measurement for the first gene in the operon is highly confident and correct, the measurement for the other gene in the operon may be noisy, and the two genes may not agree. as there is no simple way to correct for this, we used the simulations described above, and compared the relationship between confidence and agreement in the real data to that in the simulations. the relationship between confidence and adjusted agreement with operons was approximately linear in all data sets  and was largely consistent with simulations .

furthermore, for most groups of genes, including those with modest confidence values, the adjusted agreement with operons was much larger than zero. this suggests that the expression levels of all genes in these experiments were in fact changing, even if many individual genes could not be measured with confidence. in all four data sets, the top six of eight confidence groups had significantly more operon pairs that agreed with microarray data than not . this confirmed our assumption that all genes are changers.

bias-free significance estimates are unreasonable
we also compared the confidence estimates from our model to those from a popular non-parametric method, sam version  <dig>   <cit> . for each gene, sam tests the null hypothesis that the gene's expression level is identical in the two conditions. sam uses a modified t statistic with a pseudovariance term in the denominator, but rather than using a t test, sam estimates the null distribution for the modified t statistic by performing random permutations of the data. sam then uses the proportion of genes with high p-values to estimate the proportion of genes that are non-changers, and hence the proportion of genes that are true changers . finally, it corrects for multiple testing and estimates the false discovery rate .  to compare significance values from sam to the confidence levels from opwise in figure  <dig>  we needed the proportion of false positives within each group, also known as the local false discovery rate – the confidence is  <dig> minus the local fdr. for the most significant group, the local fdr is simply the fdr for the least significant member of the group. for the less significant groups, the number of false positives can be estimated from the fdr by subtracting the false positives expected for the more significant groups .

as shown in figure  <dig>  for the shheat <dig> and shcold <dig> data sets, sam is far too confident, and is similar to the parametric model without bias. for the shheat <dig> data set, sam estimated an fdr of under 10- <dig> for  <dig>  genes, representing three quarters of all genes! in contrast, opwise estimated that this group of genes was only 80% confident, implying a false discovery rate of 20%. the modest agreement with operons of these genes suggests that opwise's estimate is reasonable . indeed, the subset of the sam significant changers that were not considered significant by the single-gene opwise method  showed much lower agreement with operons than those that were considered confident . reporting a fdr of 10- <dig> when the true value is around  <dig>  is far worse an overstatement of p-values than we ever observed in the opwise simulations, even in those that violated our distributional assumptions .

for the dvsalt <dig> data set, which has a moderate amount of bias, sam was also more confident than our model, at least for the more significant changers . the sam curve was also noticeably below the simulation curve, suggesting that it was  over-confident. finally, for ecox, which has little bias and a heavy-tailed distribution, sam performed well , while opwise was perhaps slightly over-confident. overall, we concluded that the bias opwise inferred in these data sets was genuine, and that ignoring this bias  leads to unreasonable p-values.

operon-wise tests have greater power
we hypothesized that when genes in operons have consistent measurements, higher confidence can be assigned to those measurements. we calculated "operon-wise" p-values that, for each gene, take into account the data for other genes in the same operon . to test whether operon-wise p-values were more powerful than single-gene p-values, we compared the distributions of the operon-wise significance values to that of the single-gene significance values. significance was defined as  <dig> - c. as shown in figure  <dig>  the operon-wise significance estimates are much more confident in each of the data sets, and at a significance cutoff of  <dig> , 2– <dig> times more genes can be identified.

to summarize the performance of the various methods considered here – sam, single-gene opwise p-values, operon-wise p-values, and single-gene opwise with bias ignored – we report the number of putative changers identified at a confidence threshold of  <dig>  and the agreement with operons of those changers . if bias is ignored, then single-gene opwise generates similar results as sam, but with bias accounted for, opwise changers have much higher agreement with operons. this is probably because opwise correctly identifies fewer genes as statistically reliable changers. the exception is the ecox data set, which has less bias , and hence all three methods give similar results. compared to single-gene opwise, the operon-wise method identifies more genes, which also show excellent agreement with operons, as this is part of how they are selected.

CONCLUSIONS
we have described how operons can be used to detect systematic errors in measurements of prokary-otic gene expression patterns, to account for the bias when estimating significance, and to increase the confidence of measurements that are consistent within an operon. opwise relies on the assumption that genes in the same operon have matching expression profiles. although this assumption is only approximately correct, it is effective in practice, and is strongly preferable to ignoring the presence of systematic errors in the data. this assumption could be made more accurate by excluding from consideration those operon pairs that span an internal promoter or a partial terminator. unfortunately, predicting alternative transcripts remains a challenging problem even in e. coli  <cit> .

opwise also relies on assumptions about the distributions of the true means and variances of the data. these assumptions are not entirely accurate, but without such assumptions, it would not be possible to distinguish low agreement within operons due to replication noise from that due to systematic bias. in simulations, opwise was robust to the observed deviations from the assumptions.

in four data sets, opwise identified significant and sometimes large amounts of systematic error. if this bias is not taken into account, as is generally the case with current approaches, then the statistical analysis can be far too aggressive. this bias is not an artefact arising from errors in operon predictions or from our distributional assumptions.

likely sources for this bias include cross-hybridization or non-specific hybridization of some probes  <cit> . indeed the data set without large amounts of bias  was collected using affymetrix gene chips that use  <dig> probe sets per gene, and was normalized with a method that attempts to identify "bad" probes and remove them from the data  <cit> .

irrespective of bias and for all four data sets, the operon-wise method identified many more genes at any desired level of significance than the single-gene method. although we only tested the operon-wise approach with one method for assessing significance, in principle, operon-wise p-values can be computed using single-gene p-values from any method. however, operon-wise p-values should not be used to rank genes, because consistent operons with modest changes can be ranked highly, and these could be indirect effects that are of low biological interest. instead, we recommend setting a confidence threshold and then ranking all genes  above that confidence level by their fold-change. in any case, the main benefit of the present work is not for ranking or other broad exploratory analyses but in the ability to obtain reasonable p-values for specific hypotheses of the form "was gene x or operon y upregulated in this experiment?" we also note that the benefit of opwise is in assessing the reliability of the measurement, and not in estimating the amount of change for any gene.

as microarray technology becomes less expensive, experiment designs with high amounts of replication are becoming common. we observed that the systematic error can be comparable to or even larger than the variation between replicates. if systematic error is large relative to replication error, then performing many replicate measurements may not be cost-effective, and using several different probes for each gene might be preferable.

finally, although the method we describe here requires operons and is only applicable to prokaryotic data, a similar approach might be useful for eukaryotes if there is prior knowledge of pairs of genes that have matching expression patterns. for example, stable complexes in yeast are often co-expressed  <cit> , and the worm c. elegans has operons . in any case, our finding that statistical confidence levels from single probes can be misleading because of systematic bias probably applies to eukaryotic data.

availability and requirements
• project name: opwise

• project home page: 

• operating system: linux, windows, macos

• programming language: the r open-source statistics language 

• any restrictions to use by non-academics: none

authors' contributions
m.n.p and e.j.a. conceived the project. m.n.p derived the method, analyzed the results, and wrote the manuscript. a.p.a. provided support and guidance. all authors edited the manuscript.

supplementary material
additional file 1
distributions, in actual and simulated data, for observed means and squared total deviances

click here for file

 additional file 2
relationship between means and variances in the data and in simulations

click here for file

 additional file 3
single-gene significance and agreement with operons for additional simulations

click here for file

 additional file 4
opwise.zip 

click here for file

 acknowledgements
we thank zhili he and jizhong zhou for pre-publication access to data and pat flaherty for suggesting that we examine the correlation between replicates. this work was supported by a grant from the doe gtl program .

figures and tables mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaacyggsbabcqggvbwbcqggnbwzdawcaaqaaiabdcfaqnaabmaabaaccigae8hvd02aasbaasqaamxvp5wqsxmqhnxajn0bkvguhdwzzbqegyvzyrwyufgaiqgacagfpbaabeaakiabg6da+iabicdawagaayjkaiaawmcaaaqaaiabigdaxiabgkhitiabdcfaqnaabmaabagae8hvd02aasbaasqaaiaa+lgaaeqaaogaeyopa4jaegimaadacagloagaayzkaaaaaaaa@4c40@) as a function of the "ideal" log odds based on the true values of the hyperparameters. the slope is from linear regression with the intercept fixed at zero.  slopes from  <dig> simulations for each data set's hyperparameters. the boxes show the first and third quartiles and the medians, the whiskers show the most extreme point within  <dig>  times the inter-quartile range of the box, and the points indicate outliers.  a typical "uncoupled" simulation where means and variances were independent. we sorted the genes by their estimated log odds into  <dig> bins of equal size. for each bin, a point shows the true log odds  and the average of the estimated log odds. logistic regression gave a slope of  <dig>  .  slopes from  <dig> uncoupled simulations for each data set and from  <dig> heavy-tailed simulations for the ecox data set. the dashed lines in  and  show x = y.

the typical size of the bias in the apparent log2-ratio is the square root of its variance, or e)
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaach8aky=wiffydh8gipec8eeeu0xxdbba9frfj0=oqffea0dxdd9vqai=hguq8kuc9pgc9s8qqaq=dirpe0xb9q8qilsfr0=vr0=vr0dc8meaabaqaciaacagaaeqabaqabegadaaakeaadagcaaqaaiabdweafjabcicaoiabigdaxiabc+cavggaciab=h7axnaabaaaleaacqwgpbqaaeqaaogaeyyxictae83sdcmaeiykakiaeiykakcaleqaaaaa@3976@, where e = α/. the bias over the signal is the square root of the ratio of variances . the bias over the replicate error is also the square root of the ratio of variances , and considers a single measurement . we also report the typical bias divided by the standard deviation of the observed log-changes mi. to show that the bias is statistically significant, we compared the likelihood ratio of the best-fitting model given systematic error to that without , using eq.  <dig>  because we are testing whether γ lies at a boundary, in the absence of bias the distribution of 2·log approximates a 50: <dig> mixture of two chi-squared distributions with  <dig> and  <dig> degrees of freedom  <cit> .

for opwise, genes were selected if the two-tailed confidence was 95% or higher  <  <dig>  or p >  <dig> ). for sam, genes were selected if the false discovery rate was 5% or lower. for each method and for each data set, we report how many genes were selected as significant changers and what percentage of the operon pairs that contain those genes changed in the same direction. this "agreement" should be 100% for perfect microarray data and perfect operon predictions and 50% for random data.
