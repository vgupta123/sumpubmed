BACKGROUND
for microbial surveillance and discovery based on nucleic acids from an uncharacterized sample, sequencing provides the most in-depth and unbiased information. however, the expense and time required for sequencing using high throughput methods such as  <dig> , solexa , or solid  can make these methods prohibitive for routine use, especially when the resources required for data processing and analysis are taken into account. viruses at low concentration may be missed if coverage is insufficient, and host sequence may make up 90% or more of the reads  <cit> . at the other end of the cost spectrum, pcr assays are very fast and sensitive, but have limited capacity for multiplexing . they are also intolerant of primer-target mismatches; this is an advantage for detecting a microbe whose sequence is precisely known, but a great disadvantage for discovery of novel species, or for detecting variant strains of a known species.

microarrays span a middle ground between sequencing and pcr, offering high probe density for detection of diverse and possibly unexpected targets, costs in the hundreds rather than thousands of dollars per sample, and processing times on the order of  <dig> hours or less. arrays can be designed with a combination of detection and discovery probes, which respectively target species-specific regions , or more conserved regions . compared to sequencing, microarray analysis has the disadvantage that probes designed from known sequences are unlikely to detect truly novel organisms lacking homology to those sequences. however, microbial genomes are difficult and time-consuming to characterize when they have no similarity to known sequences, so the ability of sequencing to identify novel genomes has limited practical benefit in a rapid diagnostic context.

microbial detection arrays provide an assessment of known pathogens complementary to that provided by a functional gene array, such as the array to detect virulence and antibiotic resistance gene families described in  <cit> . detection arrays can tell what organisms are present, while functional arrays can tell what capabilities those organisms might possess. together these tools may be applied to detect antibiotic resistant or virulent pathogen variants, natural chimeras, or genetically engineered organisms with unusual gene content.

detection/discovery microarrays have proven useful in identifying or discovering viruses with homology to known species  <cit> . they may thus be used to guide the selection of a subset of samples for further analysis by sequencing. arrays can also be applied to study clinical samples for which pcr diagnostics have been uninformative. often, the cause of a clinically severe infection is unknown, complicating the decision of whether to treat with antibiotics, antivirals, or other therapies. with optimization, and sufficiently high pathogen titers, we have successfully generated array results in as little as  <dig> hours . moreover, arrays can assist in uncovering co-infections with more than one organism. microbial detection arrays can also be used to check isolate stocks and vaccines for adventitious contaminants  <cit> . finally, arrays can be used to assess the complexity of a metagenomic sample to determine the desired depth for sequencing, potentially saving costs on low complexity samples. microarrays may reveal greater diversity in complex environmental samples than sequencing of a typical sized clone library  <cit> . until the processing time and cost of high throughput sequencing  decreases enough to be feasible for large numbers of samples at sufficient depth, microarrays will continue to be a valuable tool.

several groups have designed microarrays containing probes for microbial detection, discovery, or a combination of both  <cit> . their approaches may be distinguished according to the range of pathogens targeted, the probe design strategy, and the array platform used.

the virochip discovery array was one of the first to target a broad range of pathogens; it is best known for its role in characterizing sars as a coronavirus  <cit> . it was designed by selecting probes from regions conserved in the same family or genus based on blast nucleotide sequence similarity, so that all complete viral genomes available when it was designed  were represented by  <dig> probes. later generations of the virochip had 5- <dig> probes per genome and covered a larger set of genomes; version  <dig> of the array included approximately  <dig>  probes. it was fabricated using spotted oligo technology, which limits the number of probes that can be included on one array.

chou et al.  <cit>  designed conserved genus probes and species specific probes covering  <dig> viral families and  <dig> genera, requiring two probes per virus. they empirically tested a subset of  <dig> probes targeting the coronavirus, flavivirus, and enterovirus families against pure cultures of six species, although they did not examine clinical samples.

palacios et al.  <cit>  built the greenechippm, an array targeting vertebrate viruses and rrna sequences of fungi, bacteria, and protozoa, containing approximately  <dig>  probes. it is an oligonucleotide array fabricated using the agilent ink-jet system. viral probes were designed to target a minimum of three genomic regions for each family or genus, including at least one highly conserved region coding for polymerase or structural proteins, and two or more variable regions. bacterial, fungal and protozoan probes were exclusively designed against variable segments of rrna genes , flanked by highly conserved regions, so that the target regions could be amplified with a small number of specific pcr primers. other groups have followed similar strategies for bacterial array design  <cit> . the lack of any similar genes universally conserved among viruses precludes using this approach for viral target amplification.

similar arrays designed by the same group include the greenechipvr  <cit>   and the greenechipresp  <cit>  . the greenechippm array successfully identified viruses at the species level, and was used to implicate plasmodium falciparum for an unexplained death. it performed less well with bacterial samples, because probes against the 16s rrna variable regions frequently cross-hybridized across taxa, so that some bacteria could only be identified at family or class resolution.

array design to fit all probes to span an entire kingdom on a single microarray demands substantial investment in probe selection algorithms. jabado et al.  <cit>  developed probe design software used to target conserved amino acid regions in viruses using profile hidden markov models and motif analysis, for which uniqueness relative to non-targets was not a consideration. to our knowledge, experimental data has not yet been published for this array. satya et al.  <cit>  built a software pipeline tofi-beta for selecting target-specific probes that are unique relative to a database of non-targets, without requirements for conservation within a set of multiple targets, and illustrated its application in silico using two bacterial genomes.

in this study we describe a comprehensive, high-density oligonucleotide array for detection and discovery of bacteria and viruses. the large number of features on this array, together with an efficient probe design strategy, made it possible to cover all complete bacterial and viral genome sequences with a much larger number of probes per target than previously reported array designs. we discuss the process used for array design, and report the results of testing the array against known mixtures of dna and rna viruses, as well as a variety of clinical  samples. we also present a novel statistical algorithm for analysis of detection/discovery arrays, which combines a predictive model of probe hybridization with a greedy likelihood maximization procedure to identify the combination of targets in a complex sample that best explains the observed probe intensity pattern.

RESULTS
array design
the array design process is diagrammed in figure  <dig>  in designing probes for our array, we sought to balance the goals of conservation and uniqueness, prioritizing oligo sequences that were conserved, to the extent possible, within the family of the targeted organism, and unique relative to other families and kingdoms. the design process is detailed in methods, and summarized here.

we designed arrays with larger numbers of probes per sequence  than previous arrays having only 2- <dig> probes per target. the large number of probes per target was expected to improve sensitivity, an important consideration given possible amplification bias in the random pcr sample preparation protocol, which could result in nonamplification of genome regions targeted by some probes  <cit> . all bacteria and viruses with sequenced genomes available at the time we began the mda v. <dig> design  were represented: ~ <dig>  virus sequences representing ~ <dig> species, and ~ <dig> bacterial sequences representing ~ <dig> species. version  <dig> of the array had only viral probes. a second version of the array  was designed using both viral and bacterial probes. probes were selected to avoid sequences with high levels of similarity to human, bacterial and viral sequences not in the target family. low levels of sequence similarity across families were allowed selectively, when the statistical model of probe hybridization used in our array analysis predicted a low likelihood of cross-hybridization.

favoring more conserved probes within a family enabled us to minimize the total number of probes needed to cover all existing genomes with a high probe density per target, enhancing the capability to identify the species of known organisms and to detect unsequenced or emerging organisms. strain or subtype identification was not a goal of probe design for this array. nevertheless, our ability to combine information from multiple probes in our analysis made it possible to discriminate between strains of many organisms.

the array design also incorporated a set of  <dig>  negative control probes. these probes had sequences that were randomly generated, but with length and gc content distributions chosen to match those of the target-specific probes.

modeling of probe-target hybridization
we developed a novel statistical method for detection array analysis, by modeling the likelihood of the observed probe intensities as a function of the combination of targets present in the sample, and performing greedy maximization to find a locally optimal set of targets; the details of the algorithm are shown in methods. it incorporates a probabilistic model of probe-target hybridization based on probe-target similarity and probe sequence complexity, with parameters fitted to experimental data from samples with known genome sequences. to accurately determine the organism responsible for a given array result, the pattern of both positive and negative probe signals is taken into account. the algorithm is designed to enable quantifiable predictions of likelihood for the presence of multiple organisms in a complex sample.

a key simplification used in this algorithm was to transform the probe intensities to binary signal values , representing whether or not the intensity exceeds an array-specific detection threshold. the threshold was typically calculated as the 99th percentile of the intensities of the random control probes on the array. the outcome variables in the likelihood model are the positive signal probabilities for each probe, given the presence of a particular combination of targets in the sample. the resulting predictions are more robust in the presence of noisy data, since the outcome variable is a probability rather than the actual intensity. discretizing the intensities also led to considerable savings of computation time and resources, which are significant for arrays containing hundreds of thousands of probes.

although one might assume that reducing intensities to binary values means discarding valuable information, the log intensity distribution for a typical array  shows that the actual information loss is much less than expected. the figure shows separate density curves for three classes of probes: those with blast hits to one of the known targets in the sample , those without hits , and negative controls. a vertical dashed line is drawn at the 99th percentile threshold intensity. log <dig> intensities for target-specific probes either cluster with the control and nonspecific probes , or approach the maximum possible value . this occurs because detection array probes are designed for high sensitivity to low target concentrations, so that probe intensities approach the saturation level whenever a probe has significant similarity to a target in the sample. therefore, the information content of a probe signal is already reduced by saturation effects.

certain probes were found to be more likely than others to yield positive signals, even when the sample on the array was known to lack any targets with sequences complementary to them. we observed that this nonspecific hybridization occurs more often with probes having low sequence complexity, i.e. long homopolymers and tandem repeats. one measure of the complexity of a probe sequence is the entropy of its trimer frequency distribution, which we compute as described in methods. to study whether the sequence entropy could be used as a predictor of nonspecific hybridization, we selected data from nine mda v <dig> arrays for which all sample components had known genome sequences. we selected probes with no blast hits to any of the known targets, grouped them by entropy into equal sized bins, computed the positive signal frequency , converted the frequency to a log-odds value, and plotted the log-odds against the trimer entropy, as shown in figure  <dig>  we also fit a logistic regression model for the probe signal as a function of entropy; a dashed line with the resulting slope and intercept is shown in the plot. the figure shows that the trimer entropy is an excellent predictor of the non-specific positive signal probability, and that probes with low entropy are more likely to give positive signals regardless of the target sequence.

while the nonspecific probe signal probability depends on the probe sequence only, the target-specific signal probability was assumed to be a function of both the probe sequence and probe-target sequence similarity. to determine an appropriate set of predictors for the specific signal probability, given the presence of a specific target, we blasted the probe sequences against our database of target genomes, obtaining the best alignment  for each probe-target pair. we then derived various covariates from the probe-target alignment, including the alignment length, number of mismatches, bit score, e-value, predicted melting temperature, and alignment start and end positions. we tested all combinations of up to three covariates, using logistic regression to fit models to data from samples containing known targets, and performed leave-one-out validation to find the combination with the strongest predictive value. the best combination included three covariates:  the predicted melting temperature, computed as described in methods;  the blast bit score and  the alignment start position relative to the 5' end of the probe. we expected the alignment start position to have a significant effect, because we observed in our previous work  <cit>  that probe-target mismatches had a weaker effect on hybridization if the mismatch was closer to the 3' end of the probe .

likelihood maximization algorithm
to find a combination of targets whose presence in the sample best explains the observed data, we used a greedy algorithm to find a local maximum for the log-likelihood, as described in methods. we can think of the likelihood maximization algorithm as an iterative process, in which we first find the target that explains the largest portion of the observed positive probe signals, while minimizing the number of negative probes that would be expected to bind to the target. in each subsequent iteration, we choose the target that explains the largest part of the signal not already explained by the first target, while again minimizing the number of expected negative probes. the process continues until a maximal portion of the observed probe signals are explained, or for a specified maximum number of iterations.

the analysis results are typically visualized as shown in figures  <dig>   <dig>   <dig>   <dig>   <dig>   <dig>   <dig>  and  <dig>  the bar graphs in the right-hand column show the initial and final log-odds scores for the target genomes predicted to be present , together with the highest-scoring targets in the same taxonomic families as the predicted targets. the bars are divided into light and dark shaded sections, corresponding to the initial and final scores respectively. bars with the same hue correspond to targets in the same family.

the bar graphs in the left-hand column represent expectation  values of the positive probe counts for each target, given the presence of the corresponding target genome. the larger "expected" score is obtained by summing the positive signal probabilities for all probes; the smaller "detected" score is derived by limiting this sum to probes having positive signals. because probes often cross-hybridize to multiple related genome sequences, the numbers of "expected" and "detected" probes may greatly exceed the number of probes that were actually designed for a given target organism. the probe count bar graphs are designed to provide some additional guidance for interpreting the prediction results.

testing on pure and mixed samples of known viruses
several viruses with sequenced genomes  were each hybridized to mda v. <dig> arrays in separate array experiments. analysis of each array identified the known virus as the highest scoring target . several mixtures of both rna and dna viruses were also tested . all spiked species were detected in the mixture, including most of the segments of bluetongue virus . strain discrimination was not expected, since probes were designed from regions conserved within viral families. nevertheless, the highest scoring targets in the single virus experiments with adenovirus, bvdv, vaccinia and human herpesvirus 6b  were in fact the strains hybridized to the arrays. human endogenous retrovirus k <dig> was also detected in two of the three mixtures, possibly from host cell dna.

for three samples tested, we compared the spiked strain identities with those predicted by analyzing either 1) only the llnl probes versus 2) analyzing only the virochip probes which were also included on the mda. the llnl probes identified the correct gomen strain of human adenovirus type  <dig> while the virochip probes identified the correct species but the incorrect nhrc  <dig> strain. in another example, when rsv long group a  was hybridized to the array, the related rsv strain atcc vr- <dig> was predicted by mda probes, but the virochip probes failed to detect any rsv strain. for the detection of bvdv singer strain, both llnl and virochip probes were able to predict the exact strain hybridized.

false negative error rates were estimated for mda v. <dig> from experiments in which some or all of the viruses in the sample had known genome sequences , for probes that met our design criteria . the rsv and btv probes were excluded from this estimate, as sequences were not available for the exact strains used in the experiments. all  <dig> selected probes had signals above the 99th percentile detection threshold, yielding a zero false negative error rate.

to validate mda v. <dig> with known spiked viruses, bvdv type  <dig>  and a mixture of vaccinia lister and hhv 6b  were correctly identified to the species level. virus sequences selected as likely to be present are highlighted in red in these figures. on the vaccinia+hhv 6b array, human endogenous retrovirus k <dig> was also detected. in addition, several organisms that were unlikely to be present were predicted, probably because of non-specific probe binding or cross-hybridization. these organisms, mariprofundus ferrooxydans , candidate division tm <dig> , and marine gamma-proteobacterium  were detected with low log-odds scores on numerous experiments using different samples. genome sequences for these were not included in the probe design because they became available only after we designed the microarray probes or because they were not classified into a bacterial taxonomic family; therefore probes were not screened for cross-hybridization against these targets. however, these sequences were included in the analysis database, since this database included sequences not classified as to bacterial family and it was compiled a few months after the probes were designed. genome comparisons indicate that m. ferrooxydans, tm7b, and marine gamma proteobacterium htcc <dig> share 70%, 55%, and 61%, respectively, of their sequence with other bacteria and viruses, based on simply considering every oligo of size at least  <dig> nt also present in other sequenced viruses or bacteria, so many of the probes designed for other organisms may also hybridize to these targets.

testing on blinded samples from pure culture
blinded samples were provided from collaborator robert tesh at utmb for  <dig> viruses. we hybridized each of those samples separately to mda v. <dig> and predicted the identities of each virus . ten of  <dig> of the species predicted by the mda were confirmed by dr. tesh. in addition, endogenous retroviruses were also detected in  <dig> of the samples as well as the uninfected vero cell control, indicating the presence of host dna from the culture cells. these included one or more of the following: baboon endogenous virus strain m <dig> and human endogenous retroviruses k <dig>  k <dig>  and hcml-arv, with human endogenous retrovirus k <dig> being the most common. the one sample that we failed to detect on the array was vesicular stomatitis virus, nj . we confirmed that it was present in the sample using two proprietary, unpublished taqman assays developed by colleagues at llnl and tested by llnl colleagues at plum island that specifically detect vsv nj. there were no complete genomes of vsv nj available. consequently, we designed no probes for this species. nor was it included in our database for the statistical analyses. it is sufficiently different from the genomes available for vsv indiana that none of those probes had blast similarity to the partial sequences available for vsv nj. there were  <dig> probes from the virochip corresponding to vsv nj that were detected. these probes were designed from partial sequences  <cit> .

detection of viruses and bacteria from clinical samples
we tested a clinical induced sputum sample provided to us by the ucsf derisi lab on mda v. <dig> , and detected human respiratory syncytial virus and human coronavirus hku <dig>  we confirmed the results using specific pcr for these two viruses . the results were also confirmed by the derisi lab using the virochip. the mda results indicated small log-odds scores for influenza a, leek yellow stripe potyvirus, and hiv- <dig>  although these low scores are a result of just a few probes and are likely due to nonspecific binding rather than true positives. other samples tested using mda v. <dig> also had low scoring predictions for influenza a and leek yellow stripe potyvirus , which we suspect were due to non-specific binding.

closer examination of probes giving high signal intensities that were not consistent with the "detected" organisms showed that there were some "sticky" probes that seemed to bind non-specifically. on the mda v. <dig> array, we noted that  <dig> probes were detected in a majority  of arrays hybridized to a wide variety of sample types. a small number of these probes were found to have significant blast hits to the human genome. since most of the samples tested on the array were either human clinical samples or were grown in vero cells , the frequent high signals for these few probes can be explained by the presence of primate dna in the sample. the vast majority of sticky probes, however, were not explained by cross-hybridization to host dna. we did note significant differences between sticky and non-sticky probes in the distributions of trimer entropy and hybridization free energy; sticky probes had smaller entropies  and more negative free energies  compared to  <dig> non-sticky probes detected in  <dig> or fewer samples. consequently, in v. <dig> of the chip design, we imposed an entropy filter as described in the methods, and additionally designed more probe sequences at the expense of the number of replicates per probe.

we tested partially amplified clinical samples provided by joe derisi's laboratory at ucsf on mda v. <dig>  the source  was blinded during our analyses, but was provided later: sample 1_ <dig> from serum , and the rest from fecal sources . no patient history was provided. a strong signal indicating the presence of hepatitis b virus was detected in sample 1_ <dig> . in all the remaining samples, signals were detected for a mixture of both viruses and bacteria, many of which are known to be associated with gastrointestinal distress. all of the organisms detected by the array were confirmed by pcr except serratia proteamaculans in sample 2_ <dig> and the e. coli papec o2-colv plasmid in sample 2_ <dig>  in some cases, multiple species in a genus have similarly high log-odds ratios, suggesting that a member of that genus is likely to be present, but the mda cannot make a definitive call as to which species. for example, signals for multiple streptococcus species were detected in sample 2_ <dig> . we expect that this pattern could arise in cases where a novel unsequenced isolate from the genus is present, in cases where conservation at the genus level is sufficiently high that the conserved probes do not provide species discrimination, or when multiple related organisms are present. since the probes were selected from conserved regions within a family, the array was not designed for stringent species or strain discrimination. in sample 2_ <dig>  we saw a strong signal for the presence of chicken anemia virus which was confirmed by pcr. this circovirus infects chickens, pointing to a dietary influence on the components of this human fecal sample. it is similar to the recently discovered and widespread human tt virus and ttv-like mini virus   <cit> . other studies have also found viruses from food in fecal samples  <cit> . phage are also commonly detected in feces, particularly when sample preparation enriches for phage, for example, by purification in a cesium chloride gradient  <cit> . we did not do any gradient purification for phage enrichment, and although we detected more signals from bacteria than from the bacteriophage that infect those bacteria, we did detect signals for staphylococcus aureus phage as the viral component of sample 2_ <dig>  as well as signals that its host bacteria was present .

discussion
we report on a high density oligo microarray and statistical analysis method that has detected viral and bacterial sequences from single dna and rna viruses and mixtures thereof, various clinical samples, and blinded cell culture samples provided to us by our collaborators. results from clinical samples were validated using pcr. the mda v. <dig> has higher probe density and larger phylogenetic representation of viral and bacterial sequenced genomes than other published array designs. it can be applied to problems in viral and bacterial detection from pure or complex environmental or clinical samples. it may be particularly useful to widen the scope of search for microbial identification when specific pcr fails, as well as to identify co-infecting organisms.

the analysis method described here differs in several key ways from previous statistical approaches to analyze microbial detection arrays, such as e-predict  <cit>  and greenelamp  <cit> . e-predict compares a probe intensity vector for each array against a theoretical hybridization free energy vector for each sequence in a target database, both normalized to unit length, using the pearson correlation coefficient. significance values are assigned to the correlation scores by comparing them against an empirical distribution derived from over  <dig>  array experiments. to handle samples that may contain a mixture of organisms, there is an iterative version of e-predict, which, after identifying the most likely target on an array, sets the intensities of the probes matching the target to zero, computes new correlation coefficients, and repeats the identification process. since it requires a corpus of data from previous experiments with the same array design, e-predict cannot be applied to new, prototype array designs. e-predict also has limited applicability to complex samples, in which several closely related strains of the same species may be present.

the greenelamp algorithm  <cit>  assigns probes to target taxa using blast alignments, and computes a p-value for each probe intensity by performing a z-test against a log-normal distribution. intensities are first background-corrected, using data from a matched control array when available, or random control probes on the same array otherwise. the parameters of the distribution are inferred from the intensities of all probes on the array, under the assumption  that only a small fraction of probes will hybridize to the target on the array. probes are categorized as positive or negative by comparing their p-values against a fixed threshold. the p-values for the positive probes associated with each taxon are then multiplied, and an aggregate p-value computed for the product, using the method of bailey  <cit> . finally, candidate taxa are ranked by the aggregate p-value. the greenelamp method depends heavily on the assumption that probe intensities are independent measurements of target genome abundances, which is not always justified. an iterative version of the method has not been reported to date; this makes it inappropriate for identifying mixtures of organisms in a sample, since the output of the algorithm is a single ranked list of taxa

the mda array design and accompanying analysis algorithm have been found to perform well in identifying mixtures of known pathogens. in cases where a sample contains an organism that has not been sequenced , but is sufficiently similar to other sequenced microbes, the analysis will identify multiple related organisms most similar to the one in the sample. similar results will be seen when the sample dna is degraded or low in concentration, so the analysis cannot determine that a novel or unsequenced organism is present. therefore, users of the mda will need to interpret the data in the context of what else is known about the sample, to determine whether the predicted organisms are exact matches to known species or are novel but with some similarity to other sequenced microbes. highly novel targets with no similarity to genomes in the database or probes on the array will not be detected. the failure of the mda to detect vsv nj in pure culture illustrates this well, and highlights a shortcoming of our approach to use only complete genomes to design the array. future versions of the array will include all available sequence data, including partial sequences and gene fragments, for species lacking complete genomes. modified statistical algorithms will then be required to deal with sequence length bias when partial genomes are included in the database. most importantly, as new sequence data becomes available from newly discovered or newly sequenced organisms, the mda must be updated with probes to detect them. we are currently designing version  <dig> of the mda to address these issues, probing both partial and complete bacterial and viral sequences, as well as fungi and some protozoa.

CONCLUSIONS
the mda is a tool to identify viral and bacterial organisms present in simple or complex samples. we have demonstrated the capability of the array and our statistical methods to identify multiple bacteria and viruses in clinical samples and verified results with pcr. improvements are suggested for the design of future detection arrays, and continued updates to incorporate probes for newly sequenced microbes will be required.

