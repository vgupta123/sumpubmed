BACKGROUND
array comparative genomic hybridization  is a technique that uses microarrays to perform high-resolution and genome-wide screening of dna copy number changes. its most important applications are in cancer research  <cit>  and clinical genetics  <cit> . in this paper we focus on acgh experiments comparing two groups of cancer samples. previously, we introduced the wilcoxon test with ties to identify chromosomal copy number differences when comparing two groups  <cit> . the goal of comparing two groups is generally to identify disease biomarkers, chromosomal regions  for survival, therapy, progression, et cetera. an important problem that arises in the planning of acgh experiments is the choice of the sample size, which we explore here. data analysis of microarray experiments comparing two groups generally involves calculating a test statistic for each array element and setting a cutoff for rejecting the null hypothesis of no difference between the groups. with a single array element, there are therefore two typical errors that can occur in the process. a type i error occurs when the null hypothesis is rejected even though it was actually true and the cut-off was exceeded only by chance. a type ii error involves accepting a null hypothesis that should have been rejected, thus failing to identify a true difference. to broaden the perspective from individual array elements to the framework of multiple testing covering the entire microarray, two concepts are used: false discovery rate   <cit>  and average power. fdr is the expected percentage of discoveries that are false. statistical power is the probability of recognizing a single array element with a true difference, and average power refers to the expected percentage of true positives that is identified. in general, it is desirable to have the fdr as close to zero and average power as close to one as possible. setting the cut-off for rejecting the null hypothesis is a delicate balance between sensitivity and specificity; while a stringent cut-off lowers the fdr, it also lowers average power and vice versa.the only way to improve both, or one without affecting the other, is to increase the number of biological replicates and thus perform more arrays. sample size calculations can generally be divided into two categories. the first category asks the user to define values for certain parameters, such as the effect size  and the proportion of genes that are truly differentially expressed  <cit> . the second category estimates these parameters from existing data  <cit> . the method proposed here follows the latter approach and therefore requires pilot data.

to adapt mrna expression array power calculations for acgh and copy number changes, two key aspects need to be taken into account. instead of concentrations of individual mrna molecules, the underlying biology measured by acgh consists of blocks of chromosomal dna. each block is  present in a normal copy number of two, but may contain areas of one or two-copy losses and one or more gains. higher level amplifications can also be present. the aberrations contain both driver and passenger genes, and the breakpoints may vary from one sample to another.

as the entity being measured is dna present in a discrete number of copies , but individual array elements yield log <dig> ratios, acgh data preprocessing generally involves the following steps that aim to better capture the biological relevance. normalization first removes technical artifacts and makes the log <dig> ratios comparable across different hybridizations. segmentation then identifies areas that share a common copy number and are separated by breakpoints. finally, calling determines a discrete copy number level for each segment. at the moment, there is no clear consensus regarding the optimal stage of preprocessing from which the data should be used for downstream analysis. we discussed the topic and proposed that in most cases the recommended choice be to use calls, which have the clear advantage of having an attached biological meaning  <cit> . for power calculations however, the use of calls is problematic, as it would require the use of the chi-square test, for which no method of sample size calculation in large fdr-based multiple testing contexts is presently available. while both normalized and segmented log ratios allow the use of a t-test, they fail to take full advantage of the adjacency of consecutive array elements. aberrations typically show great variation in their sizes ranging from focal amplifications to gains and losses of entire chromosome arms. working directly with the original array elements does not take this into account, and gives larger aberrations significantly more weight than smaller ones as they contain more array elements. a possible improvement is therefore to replace array elements with regions, which are defined as a series of neighboring array elements sharing the same copy number signature. this reduces dimensionality with little loss of information  <cit> . throughout this paper, the term regions is used to refer to the results of this analysis step.

for cghpower, we are combining the advantages of regions with the feasibility of log ratios, by replacing the hard calls with median log ratios of all the array elements within a region. together with these region-wise log ratios , the regions are then taken as a representation of the underlying biology . each region is coupled to a null hypothesis stating that the means of the two groups do not differ from each other, which is the framework required for the power calculations proposed here. regions that have a true difference between the two groups  will be referred to as "differentially behaving regions".

after this preprocessing, power calculations are performed using regions as ferreira et al.  <cit>  previously described for both real and simulated gene expression data. t-statistics and p-values are calculated for each region from the rwlrs. all p-values from non-differentially behaving regions are expected to follow a uniform distribution, while those from the differentially behaving ones should follow another, unknown distribution . two separate estimators of g are calculated: a non-parametric () and a parametric one , which assumes that g follows a normal distribution. both of these estimators depend on another unknown parameter, γ, which is the proportion of non-differentially behaving regions. when the estimate of γ used to calculate Ĝn and  moves away from its true value, the difference between the two g estimators increases. the estimate of γ is therefore chosen so that this difference is minimized. the limiting density of effect sizes  is then estimated using deconvolution, and so is g. once these estimates have been calculated, approximate sample size calculations can be made using an adaptive version of the benjamini-hochberg method for multiple testing. while the original method  <cit>  allows control over the fdr, the adaptive version also allows the estimation of average power  <cit> .

while optimizing the protocol, there were certain options that we considered: whether to calculate the rwlrs as the mean or median of the log ratios, whether to use the student's t-test assuming equal variances or welch's t-test that allows unequal variances, and finally whether to calculate the p-values from normal or student's t-distribution. all of the possible combinations were tested, and the optimum performance was observed with median log ratios, unequal variances and the normal distribution. these choices were then fixed in cghpower.

implementation
evaluation data sets
to evaluate the performance of cghpower, eight recently published acgh data sets that could be divided into two groups were collected. they will be referred to as chin et al.  <cit> , douglas et al.  <cit> , fridlyand et al.  <cit> , myllykangas et al.  <cit> , nymark et al.  <cit> , postma et al.  <cit> , smeets et al.  <cit>  and wrage et al.  <cit>  a total of five different array types were used among the data sets: vumc  <dig> k spotted oligo  <cit>  for data sets  <cit> , agilent human  <dig> cdna microarray for  <cit> ,  <dig> k bac array  <cit>  for  <cit> ,  <dig> k bac array  <cit>  for  <cit>  and  <dig> k bac array for  <cit> . table  <dig> provides a summary of the cancer and array types, together with group definitions and sizes.

eight public data sets were collected to evaluate the performance of cghpower. they represented five different cancer types and bac, cdna and oligo-based microarray platforms, with resolutions varying from  <dig> k to  <dig> k array elements. the last column contains the distinguishing factor used to divide the data set into two groups, along with the number of arrays in each group. the simulated data sets were generated by introducing artificial aberrations into a set of clinical genetics samples. a total of  <dig> simulations were generated, and the remaining ones are available at http://www.cangem.org/cghpower/. er = estrogen receptor, msi = microsatellite instability, cin = chromosomal instability, hpv = human papilloma virus, bm = bone marrow metastasis.

simulated data sets
in addition to real data sets, evaluation was also performed with simulated data. while generating the simulations, we attempted to implement realistic aspects of both signal and noise of tumor profiles. in the context of an acgh experiment comparing two groups, the signal consists of aberrant regions that are specific to one of the groups. noise consists of regions common to both groups, random aberrations in individual samples, and technical noise. further characteristics are also that the sizes of the aberrant regions vary from entire chromosomes to focal aberrations, the exact start and end positions of a region vary slightly from one sample to another, and even a "common" region might not be be present in all of the samples.

the simulated data were generated by introducing artificial aberrations into a data set of clinical genetics samples of patients with mental retardation and no or few chromosomal aberrations  <cit> . to achieve a simulated data set of the desired size, resampling was performed with replacement. aberrant regions were then randomly introduced as follows. a single array element was chosen at random as the starting point of a region. the size of the region was then chosen at random with a 10% probability for a single cytoband, 30% for three consecutive bands, 30% for six consecutive bands, 20% for the whole chromosome arm, and 10% for the entire chromosome. the type of the aberration was randomly chosen as a gain or loss with equal probabilities, but for the smallest aberrations of individual cytobands, a 2% probability for amplifications was also included. when introducing a region to a set of samples, the exact samples receiving the aberration were sampled from the bernoulli distribution with p = 70%. randomness was also introduced to the exact start and end positions of aberrations in individual samples by shifting the starting and ending array elements by a random number between - <dig> and  <dig> 

a simulated data set of  <dig> +  <dig> arrays was generated with  <dig> common regions, and  <dig> regions for each individual sample. these copy number changes do not separate the two groups from each other, and therefore represent background noise. this data set is referred to as simulation  <dig>  single regions specific to the two groups were then introduced to simulation  <dig> yielding data set simulation  <dig>  this process was repeated ten times resulting in a set of  <dig> simulations with the amount of differential signal ranging from none in simulation  <dig> to  <dig> regions specific to each group in simulation  <dig>  only simulations  <dig>   <dig> and  <dig> are presented in this paper, but the full cghpower outputs for all of them are available on the program's web page.

preprocessing
all evaluation data sets were preprocessed starting from raw log <dig> ratios. first, the data were median normalized. wavy patterns typically seen in many acgh profiles were removed  <cit>  from the  <dig> k arrays  <cit> . normalized log ratios were segmented using the dnacopy algorithm  <cit>  and called by cghcall  <cit>  to identify gains, losses and amplifications. regions between breakpoints were then collapsed into single data points, when shared between most of the samples  <cit> . finally, the median log ratio was calculated for each of these regions in each sample, resulting in region-wise log ratios . all algorithms were run with default parameters, and sex chromosomes were excluded from the data.

sample size calculations
for each region, t-statistics were calculated with a welch's t-test allowing unequal variances and p-values computed from the normal distribution. the proportion of non-differentially behaving regions  was estimated by minimizing the difference between parametric  and non-parametric () estimators of g, which is the unknown distribution of the p-values from differentially behaving regions. the limiting density of effect sizes and g were then estimated using deconvolution. finally, with fdr fixed at 10%, these parameter estimates were used to approximate average power as a function of sample size.

RESULTS
estimates of average power as a function of sample size were calculated for the eight evaluation data sets and  <dig> simulations . the reliability of the power calculations depends directly on the the quality of parameter estimation, which in turns depends on compliance with required assumptions. the first assumption is that the proportion γ of non-differentially behaving regions be "substantially" smaller than  <dig> . the second assumption is that the rwlrs be approximately normally distributed, being neither particularly asymmetric  nor heavily tailed or extremely peaky . the complete cghpower program output contains diagnostic plots from different stages of the power calculations procedure. these plots help determine to which extent these assumptions are fulfilled. while it is impossible to know what the true values of γ and λ are, one can easily evaluate how well the two estimators of g agree with each other . if they show a clear discrepancy, the accuracy of parameter estimation is questionable and the resulting power calculations consequently unreliable. different scenarios in the quality of parameter estimation observed with the evaluation data sets are examined for each of the data sets to estimate the reliability of the calculated power.

the data sets douglas et al., smeets et al., fridlyand et al. and chin et al. are examples where the goodness-of-fit of the g estimators was satisfactory, ranked in this order according to their fits . what appears to be the most important factor distinguishing these data sets from the others, is the density of the p-values. if there is no difference detected between two groups, p-values are expected to follow a uniform distribution, and their density function appears as a flat line. when the number of differentially behaving regions increases , density at low p-values increases and the function is expected to be convex . this can also be seen on the simulations where the amount of differential signal gradually increases from simulation  <dig> to simulation  <dig>  along with the increase in density for low p-values, also the goodness-of-fit systematically improves .

less satisfactory performance was observed with data sets of postma et al. and myllykangas et al. the goodness-of-fit shows more disagreement between the two estimators of g  and as a result power estimates are less reliable. the density is increasing for low p-values, but slightly less and the function is not convex as expected . compared to simulation  <dig>  which has no true differences between the groups, the increase in p-value density for the data set of myllykangas et al. is very small. one explanation is that there is simply not enough differential signal that is detectable with a t-test. alternatively, the number of differentially behaving regions might be too low . while these data sets do give γ estimates of  <dig>  and  <dig> , respectively, these estimates cannot be trusted if the estimates of g disagree with each other. therefore it is recommended that the goodness-of-fit plot be used to assess the reliability of the estimates of other parameters. also, judging from the results with the simulated data sets, cghpower seems to underestimate the true value of γ.

while assumptions regarding γ seem to be most important, the rwlrs are also assumed to be normally distributed. the program output contains histograms of the skewness  and kurtosis  of the rwlrs, superimposed with those of a normal distribution . assumptions of normality become more critical with small sample sizes and less important with large ones. within the evaluation data sets, most violations of normality were observed with the chin et al. data set, yet this is one of the better-performing ones in terms of goodness-of-fit. this might be explained by the relatively large sample size  of the study. another factor besides the number of arrays, is the number of regions found after the preprocessing step. the larger the number of regions, the better the performance of the parameter estimation and therefore the reliability of power calculations. the assumption of normality is therefore more crucial with samples containing very few biological differences.

the data sets of nymark et al. and wrage et al. are examples where our method failed to work, despite the differences reported and technically as well as biologically validated. in the case of nymark et al. the obtained power curve is a flat line . this can happen when parameter estimation fails. the explanation can be found from the density of the p-values, but now the assumptions were violated more severely than in the cases of postma et al. and myllykangas et al. the density function is actually concave and shows even less density at low p-values than would be expected by chance . with wrage et al., failure can be observed at the preprocessing step, as only  <dig> regions are detected . since the sex chromosomes are excluded from the analysis, this means that only one copy number breakpoint was detected in the whole genome using the fixed cghpower preprocessing described above. as preprocessing and power calculations procedures are fixed earlier in cghpower, it was not optimized it for every acgh platform or data set. allowing the user to fine-tune different settings and immediately see the result of each change would require implementing a more complex user interface, similar to desktop software, which would be impractical for a single-purpose web tool. as an alternative option, if the goodness-of-fit and density plots indicate that power calculations failed, users can perform preprocessing independently, turn off the preprocessing step from the program, and perform the power calculations only.

consistency as the pilot size is increased
cghpower was initially developed to be used on smaller pilot data sets in the planning stages of larger microarray experiments or for verifying power achieved in past experiments. we wanted to evaluate whether the resulting power estimates hold while more and more arrays are added to the data set. assuming that a pilot of  <dig> +  <dig> arrays has estimated an experiment with  <dig> +  <dig> arrays should result in an average power of approximately 70%. the data set of  <dig> arrays is then generated and for verification the power calculations are repeated with the entire data set. if the new results indicate that the achieved power is in fact only 50%, and that  <dig> +  <dig> new arrays are needed in order to achieve our goal of 70%, then the two power calculations have to be declared inconsistent. to evaluate whether the power estimates remain consistent while the pilot size is increased, power was calculated with smaller subsets of the chin et al. data set, since it is our largest one. this data set contains a total of  <dig> arrays , which was split into smaller subsets to represent pilots of a larger study. nine resamplings ranging from 10%  to 90%  of the original data set were randomly selected for the power calculations. each resampling was repeated  <dig> times and the results were averaged. two of the ten repetitions of the 10% subset and one repetition in the 20% subset experienced a failed power estimation resulting in flat power curves as with the nymark et al. data set. these cases were removed before averaging the results. a plot of the resulting power estimates shows that except for the smallest subset , the results appear to be consistent . this suggests that as long as the pilot is of sufficient size, power estimates generated with cghpower using smaller pilot data sets are in fact representative of a subsequent larger study. while the exact requirement for a "sufficient pilot" is hard to define beforehand, the power calculations can be repeated when more arrays are performed to see whether power estimates are still changing or have been stabilized.

CONCLUSIONS
we have explored sample size calculations in the context of acgh and copy number changes and propose a dedicated tool for this purpose. from a pilot data set, cghpower estimates the biological diversity between two groups of cancer samples and estimates average power as a function of sample size using an adaptive version of the benjamini-hochberg method for multiple testing  <cit> . pilot data is used for parameter estimation and this requires certain assumptions to hold in an approximate sense. we have evaluated the performance of cghpower with eight published data sets, four of which show satisfactory performance using predefined preprocessing measures. among these data sets were bac and oligo-based array platforms, whose resolution varied from less than  <dig> k for bacs to almost  <dig> k for oligos. the differences in resolution did not have a direct impact on the obtained power estimates, which should be determined more by the amount of biological variation between the two groups.

in two data sets violations of critical assumptions lead to problems in parameter estimation and therefore power estimates are less reliable. more severe violations and/or the inflexibility of a completely predefined analysis procedure lead to failed execution for the two other data sets. even though the proposed method has its limitations, it is to our knowledge the only proposed one for acgh data and copy number changes. as the program allows performance evaluation through diagnostic plots, critical judgement can be applied for each data set.

as a summary on the evaluation of cghpower results, users should consider paying attention to the following: 1) do the copy number profile plots appear similar to the aberrations that you have detected in your own analysis? if cghpower does not seem to detect the important aberrations, consider performing the preprocessing before uploading and use cghpower only for the power calculations. 2) do the estimators of g agree with each other? if the goodness-of-fit is poor, so will other parameter  estimates. 3) is the density function of the p-values convex, and showing a higher density at small p-values? a straight or concave function might be caused by too small effect size, or γ being too close to one. 4) excess skewness and/or kurtosis in the data might also affect the performance, but this seems to be less crucial.

the proposed method uses log ratios instead of calls, even though we feel the latter is generally the preferred choice when working with acgh data. calls have the benefit of a clear biological meaning and are therefore easier to interpret. however, their use for power calculations in the context of fdr is problematic, as it would require using the chi-square test, a setting that is not as well developed as the gaussian one. also, as log ratios are the basis for calls in the first place, they do contain all the necessary information even though they are not as clear to interpret.

in comparison to sample size calculations for mrna expression arrays, the differentiating factor for acgh studies is the concept of regions, which stems from the different biological phenomenon underlying the microarray log <dig> ratios. compared to the number of array elements, the number of regions is relatively small, which presents challenges to parameter estimation from the data. as the total number of regions is remarkably smaller than with expression arrays, the estimation might fail if the number of differentially behaving regions is too small, even if there is a true difference between the groups.

an important concern when performing power calculations is the actual power requirement. a power curve typically plateaus out at some point, indicating saturation. increasing the average power from e.g. 60% to 70% requires a significantly bigger increase in sample size than is needed for an increase from 50% to 60%. therefore it is difficult to set a a predefined gold standard of adequate power. one option is to try to find where the slope of the power curve is decreasing rapidly. this should give a reasonable compromise between statistical power and cost of the experiment. another aspect worth pointing out, is that the level of power needed also depends on the research question. for example, if the goal is to construct a classifier that can classify future samples into one of the two groups, a lower level of average power might yield a perfectly satisfactory classifier even though not all differences are detected.

availability and requirements
cghpower is a web-based application and can be freely accessed at http://www.cangem.org/cghpower/. it allows direct uploads and can also automatically retrieve data stored in the cangem database  <cit> . the computation times of cghpower may vary considerably depending on the number of samples and array elements in the data set, and also on the prevailing load of the linux cluster where the calculations are performed. as an example, running times for a data set of  <dig> samples and  <dig> k array elements have been around 1- <dig>  hours in our test runs. the software has been implemented in r  <cit>  and the source code is available upon request.

authors' contributions
by conceived the study. is, jaf, maw and by designed cghpower. is performed the implementation. is, jaf, maw and by wrote the manuscript with critical comments from sk and gam. all authors read and approved the final manuscript.

