BACKGROUND
cellular heterogeneity is present in nearly all biological specimens. when the genome-wide transcriptional profile of heterogeneous samples is measured under different physiological states, any observed differences are strongly confounded by differences in cell type compositions between samples
 <cit> . recent studies suggest that the microenvironment of a tissue may change under different physiological states and can contribute to the etiology of diverse diseases
 <cit> . consequently, to fully understand gene expression differences associated with different physiological states, deconvolution of tissue expression into the component expression profiles of each cell type is critically needed.

fluorescence activated cell sorting , laser capture micro-dissection  and translating ribosome affinity purification  have been used to physically separate defined cell types before gene expression analysis
 <cit> . however, technical difficulties, such as limited availability of good surface markers, cell type specific promoters and transgenic models, have restricted the application of these techniques. furthermore, the sorting process may introduce additional stress on cells and hence alter their gene expression profiles.

unsupervised mixture models have been developed to solve the gene expression devolution problem. for example, a latent dirichlet allocation  model trained with a variational expectation maximization framework was used to estimate the breast cancer cell gene expression profiles from heterogeneous tumor samples
 <cit> . an alternative approach
 <cit>  is to first reduce the observed mixture using standard dimension reduction algorithm, such as principal components analysis  or independent components analysis , find a minimum-volume polytope with k vertices that enclose the reduced data and then transform the reduced data back to the gene expression profiles. the success application of these unsupervised approaches will depend on the availability of large number of observation over a wide range of tissues
 <cit> . in addition, these algorithms do not use the biological knowledge on the cell type markers.

several supervised and semi-supervised computational deconvolution algorithms have also been proposed to tackle this problem
 <cit> . however, they require prior knowledge of either the cell type frequencies within a given tissue
 <cit> , or the in vitro gene expression profiles of each component cell type
 <cit> . in reality, this information can be difficult to obtain and presents a major roadblock for these kinds of approaches. our previous work
 <cit>  has proved that gene expression deconvolution should be done in linear space rather than log-transformed space, as is often used in microarray studies. based on our previous findings, we propose a novel digital sorting algorithm  that can deconvolve the expression of a tissue into the component profiles of each cell type using a set of marker genes that are highly expressed in each cell type.

RESULTS
to test whether our proposed dsa algorithm can estimate the cell type proportions in a mixed tissue or cell population, we analyzed a benchmark dataset where rna from the liver, brain and lung of a rat were mixed at  <dig> different proportions and the mixing parameters are known. the gene expression of pure liver, brain, and lung, and of the mixed samples, was measured using affymetrix expression arrays. dsa uses a set of gene markers that are highly expressed in specific cell types to estimate the cell type frequencies; the expression level of these markers in pure cell types is not required. a list of tissue-specific markers for the liver, brain and lung was obtained from tissue-specific gene expression and regulation 
 <cit>  database and genenote
 <cit>  . using these markers, we were able to estimate the cell type frequencies for each cell type from the mixtures . our results demonstrate that dsa can accurately estimate the cell type proportions using marker genes.

next, we examined whether dsa can accurately deconvolve the gene expression profile from mixed tissue samples into tissue specific expression profiles. using the cell type frequencies we estimated using marker genes, we were able to accurately estimate the expression profiles of the liver, brain and lung cells that constitute the mixture . the deconvolved expression was highly correlated with the true gene expression profile in each tissue type. the error measure was smaller for genes that are highly expressed, as would be predicted given that technical variations tend to have larger impact for genes that are expressed at low levels. the effect of the number of marker genes used in estimating the proportion of each cell type was also studied. we randomly sampled the marker genes from the tiger list . in  <dig> repetitions, we plotted the correlation and mean absolute difference between the estimated and pure cell-specific expressions against the number of markers used. our results demonstrate that dsa is robust to the number of marker genes and only requires several marker genes for accurate gene expression deconvolution .

we next asked whether dsa can identify differentially expressed genes between different tissue types. to do this, we computed the gene expression fold change using the deconvolved gene expression profile, and then carried out a receiver operator curve  analysis to assess dsa’s ability to detect changes more than two-fold between any tissue types. our results demonstrate that dsa is highly specific and sensitive in identifying differentially expressed genes .

in the benchmark data, liver, brain and lung were used to construct the mixtures. however, the expression differences between different cell types within a tissue sample are much smaller compared to the differences between liver, brain and lung. hence, we tested whether our dsa algorithm works on real tissue samples composed of cell types with gene expression profiles that are more similar to each other.

im- <dig>  raji, jurkat and thp- <dig> cells were mixed in different proportions and the expression profile of each mixture was measured by microarray
 <cit> . marker genes for each of the cell types was extracted from the immunogenetic related information source  database
 <cit> . first, we used the genes that are highly expressed in each of these cells  to estimate the cell type proportions accurately . next, using the estimated cell type frequencies, we deconvolved the expression profiles of the mixture into profiles for each individual cell type . finally, to test whether the estimated expression profiles of immune cells can be used to identify genes that are differentially expressed between cell types, we applied an roc analysis on our deconvolved expression profiles . high auc values  were observed, indicating that differentially expressed genes can be identified accurately with high specificity and sensitivity.

population specific expression analysis 
 <cit>  is an algorithm that has the same input parameters as dsa. however, psea uses the marker gene information as normalization factors in the gene expression deconvolution analysis. hence, the estimated gene expression profiles are not the absolute gene expression values, but are relative to the average of the marker genes for each cell type. in practice, the marker genes from different cells are not guaranteed to have the same expression level. this critical assumption of psea makes comparing results between different cell types biased towards the marker gene expression.

to compare the performance of dsa and psea, we tested both algorithms on the liver-brain-lung benchmark dataset. the fold change differences estimated by dsa are highly correlated with the true difference . however, the fold change differences estimated by psea between liver and brain are all negative, due to the fact that the marker genes of liver are expressed at higher levels than the markers genes of brain . our results demonstrate that the fold change estimated by dsa is more accurate than psea. since dsa only assumes that marker genes are highly expressed and does not require the marker genes to be expressed at same level, dsa tends to estimate the absolute expression level as measured by the array on pure cell populations.

we were next interested in determining the lower limit of cell type frequency that could be estimated from a mixed tissue. to test this, we simulated blood samples using  <dig> different immune cell types with cell type proportions ranging from 60% to  <dig> % . cells that are present at a frequency greater than 10% in the tissue sample could be accurately estimated . cell types that are present at greater than 1% but less than 10% can still be estimated, though with relatively larger errors . cell types that are present at lower than 1% in the tissue failed to be identified . to summarize our results systematically, we plotted the error of estimation and frequencies of each cell type against the signal to noise ratio . clearly, snr decreases as cell type frequency goes down, and the mean square of errors  goes up with decreasing snr . to assess the sensitivity and specificity of differential gene analysis, we applied roc analysis on deconvolved expression profiles and found that samples with high accuracy in deconvolution have high auc value. for samples that have low frequencies in a tissue and poor accuracy in deconvolution, differential gene analysis can still identify genes that are significantly changed between cell types with reasonable -- but significantly reduced -- sensitivity and specificity .

we next tested whether dsa is capable of estimating the frequency of a cell type in a mixed tissue in vivo, and subsequently obtaining its gene expression profile. to this end, we applied our algorithm on a set of human hodgkin’s lymphomas, in which macrophage frequency was shown to predict progression-free survival
 <cit> . a set of tumor associated macrophage  specific genes was selected by comparing mouse mammary tumor associated macrophages to normal mouse splenic macrophages
 <cit>  . using these tam-specific genes, dsa was applied to the gene expression profiles of a set of hodgkin’s lymphomas. for each tumor, dsa was able to estimate the percentage of tams in the sample. we found that the estimated tam percentage is a predictor of progression free survival for these patients . a 30-fold lower p-value was achieved using our estimation than using cd <dig> as a marker for tams. the hazard ratio between tam high and tam low group is  <dig> . using dsa, we were able to obtain the gene expression profile of tams in the patient samples. by comparing the tam transcriptome to the tumor transcriptome, we identified a list of genes that are highly expressed in tams. when gene ontology  analysis was applied to these genes
 <cit> , we identified response to wounding, defense response, and inflammatory response as high significantly enriched biological processes . these results confirmed that the estimated gene expression profile is indeed enriched for macrophage related functions.

CONCLUSIONS
in conclusion, we have demonstrated the general feasibility of a digital sorting algorithm  to obtain cell type specific gene expression profiles from a complex tissue. dsa represents a dramatic improvement over the conventional deconvolution approaches, which typically require prior knowledge of cell type frequencies or in vitro gene expression profiles for each cell type. by using cell type specific genes, dsa overcomes these limitations. we have also demonstrated that dsa is an unbiased estimation algorithm for signal reconstruction and deconvolution. downstream analysis, such as differential gene analysis, will benefit from digital sorting and yield better results. most important of all, we have demonstrated that dsa can be used to extract the expression profile of a specific cell type from a complex tissue. this will allow for investigation of the properties of specific cell types in mixed tissues in vivo. for example, we can obtain the gene expression profile of a particular cell type in the cancer microenvironment just from microarray data from the bulk tumor. in principle, the dsa framework could be applied to any unbiased high-throughput dataset, such as global dna methylation array, next generation sequencing data, metabolic data, and proteomics. partially, rna-seq is a more accurate technology compared to microarray. the linearity assumption holds true in rna-seq studies, hence we believe that our dsa framework can also be applied to rna-seq data.

in many real-world applications, a small number of cell type specific markers are often available to molecular biologists since these markers are frequently used in biochemical assays. for example, the cancer stem cell markers are known for many types of tumors. the use of these markers in gene expression deconvolution greatly improved the performance and also enabled the application of this algorithm not only to cancer studies, but also to other biological studies involved with heterogeneous samples.

dsa is implemented in a single r package . the package also includes sample data from liver, brain and lung benchmark data and the cell type specific markers.

