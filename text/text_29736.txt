BACKGROUND
a gene family is a group of genes with similar sequences and biochemical functions  <cit> . investigation of the evolution of gene families provides valuable information regarding the evolutionary forces that may have shaped the genomes of species  <cit> . advancing biotechnology provides a vast amount of data for the studies of gene family evolution. meanwhile, probabilistic models, describing the evolutionary process of gene families along a phylogenetic tree, significantly facilitate the analyses of gene family data  <cit> . the size of a gene family may expand or contract over time due to gene duplication and loss  <cit> . the birth and death  model  <cit> , which assumes that the size of a gene family follows a birth and death process  <cit> , is one of the most frequently used models for gene family evolution  <cit> . given the phylogenetic tree, the probability distribution of the size of a gene family has been derived under a probabilistic graphical model   <cit> . parameters in the pgm include the birth and death rate λ and the counts of gene copies  at the internal nodes of the phylogenetic tree. the pgm assumes that the phylogenetic tree is given  <cit> , though the tree is often estimated from other sources of data. the pgm provides a probabilistic judgment of the hypothesis that different evolutionary forces may have acted on particular gene families or particular lineages of the phylogenetic tree  <cit> . the pgm can be used to simulate gene family data to evaluate the performance of various computational methods for gene family evolution, including comparative phylogenetic methods  <cit>  that estimate gene duplication and loss events by mapping gene trees onto the species tree  <cit> . in contrast to comparative phylogenetic methods, the maximum likelihood  method  <cit>  under the pgm is able to estimate the birth and death rate λ.

in this study, we develop a bayesian approach for estimating the birth and death rate λ and the sizes of ancestral gene families at the internal nodes of the phylogenetic tree. moreover, a bayesian hypothesis test  <cit>  is developed to identify the gene families that are highly unlikely under the birth and death model. our major goal is to provide a bayesian alternative to the ml method for estimating parameters in the birth and death model  <cit> . although simulation results suggest that the bayesian estimates of the model parameters are more accurate than the maximum likelihood estimates, it does not necessarily imply that the bayesian method developed in this paper, in general, outperforms the ml method. in fact, both methods are useful for making inferences on the evolution of gene families.

methods
a bayesian model for gene family evolution
let x = {xij,i =  <dig> ...,i and j =  <dig> ...,j} denote gene family data, where xij is the size  of gene family i for species j, i is the total number of gene families in the data, and j is the number of species. the bayesian model has the following parameters; ψ: the phylogenetic tree; θik: the size of gene family i at internal node k; and λ: the birth and death rate parameter. we assume that the topology and branch lengths  of the phylogenetic tree are known. the bayesian model consists of two major components  <cit> ; the prior distribution of model parameters {λ,θ,ψ} and the likelihood function f, i.e., the probability distribution of gene family data x given parameters {λ,θ,ψ}. as the phylogenetic tree is known, the prior distribution of ψ is trivial, i.e., the phylogenetic tree with branch lengths is fixed with probability  <dig>  given the tree ψ, we assume that the prior distribution f of the birth and death rate λ is uniform ), where max is the largest branch length in the tree . we also assume that there is no prior knowledge about θ , i.e., the prior f of θ is a discrete uniform distribution.

the probability distribution of x given parameters {λ,θ,ψ} is derived under the pgm. let tk be the length of branch k . the counts of gene copies {xi <dig>  xi <dig>  xi <dig>  xi <dig>  xi5} at the tips of the tree represent the sizes of gene family i for species  <dig>   <dig>   <dig>   <dig>  and  <dig>  while {θi <dig>  θi <dig>  θi <dig>  θi <dig> } are the counts of gene copies at the internal nodes for gene family i . under the bd model, the probability that the number of gene copies changes from s  to c  after time t on a particular branch w is  <cit> .

  pw{xc=c|xp=s,t}= ∑j=0minsjs+c-j-1s-1αs+c-2jj, 

where α=λt1+λt and λ is the birth and death rate parameter. because  must be positive, the birth and death parameter λ is subject to a constraint λ<1/max in which max is the largest branch length in the tree. with a complete assignment of all nodes in the tree, the birth and death processes on the different branches are independent of one another. the probability distribution for gene family i  is thus the product of the probabilities defined in  across all branches in the phylogenetic tree, i.e.,

  f= ∏w=12j-2pw{xc=c|xp=s,t}, 

note that there are  branches in a j-taxon phylogenic tree. finally, the probability distribution of x is equal to the product of the probability densities defined in  across all gene families, i.e.,

  f= ∏i=1if. 

bayesian estimation of model parameters
estimation of the birth and death rate λ and assignments θ of the internal nodes is based on the joint posterior probability distribution f of λ and θ, i.e.,

  f=fff∬{λ,θ}fffdλdθ. 

as the integral in the denominator of f is analytically intractable, the metropolis-hastings algorithm  <cit>  is employed to estimate the posterior probability distribution f in . the algorithm starts with a set of arbitrary values of parameters λ and θ. the value of λ  is then updated at each iteration  <cit> . the new value λ' is accepted with a probability defined by the hastings ratio h,

 h=minffffff,  <dig>  

after the burn-in period, the metropolis-hastings algorithm converges to the posterior probability distribution f. the convergence rate of the metropolis-hastings algorithm is largely dependent on the starting values of λ and θ. it follows from  that given s and time t, the mean and variance of c are equal to :

thus assignment θik ) of internal node k for gene family i can be consistently estimated by the average count θ^ik of gene copies at the terminal nodes that are the descendants of node k. according to the law of large numbers, θ^ik is a consistent and unbiased estimator of θik. additionally, the variance of a transformed random variable yij=xij2θi*t*, where θi* is the assignment of the tree root for gene family i and t* represents the tree height, is equal to λj  var=varxij2θi*t*=λj. 

the last equality in  is derived from  by setting s = θi*, t = t*, and λ = λj. equation  suggests that λj can be consistently estimated by the variance of the transformed data {y1j, y2j,..., yij } for species j, i.e.,

  λ^j=1i-1∑i=1i <dig>  

if the assignment of the root for gene family i is unknown, θi* in  is replaced by its consistent estimate θ^i*. when λ is constant among all branches of the tree, it is straightforward that the average rate, i.e., λ^=1j∑j=1jλ^jis a consistent estimate of λ. we use these consistent estimates as the starting values of λ and θ to improve the convergence rate of the metropolis-hastings algorithm. convergence of the metropolis-hastings algorithm may be assessed by comparing the results from two or more independent runs  <cit> . running multiple chains, however, will dramatically increase the computational time. more commonly, convergence of the algorithm is evaluated by examining the log likelihood values for a single run  <cit> .

posterior predictive p-value for detecting unlikely gene families
some gene families may have significantly higher or lower birth and death rates than other families in the dataset. these gene families are highly unlikely to be observed under the bd model that assumes a constant birth and death rate among all gene families. the classical p-value for detecting unlikely gene families depends on the assignment of the tree root  <cit> . because the size of a gene family at the root of the tree is unknown in most practical situations, the classical p-value cannot be directly calculated. this is generally called "nuisance parameter problem"   <cit> . to overcome this problem, hahn et al.  <cit>  proposed to compute the maximum conditional p-value among all possible assignments of the root. although hahn et al.  <cit>  have demonstrated that the maximum conditional p-value can be used to detect unlikely gene families, it should be noted that the maximum conditional p-value is no longer the tail-area probability as intended in classical approaches  <cit> .

posterior predictive p-value  is the bayesian alternative to the classical p-value  <cit> . the bayesian p-value can be used to evaluate statistical significance for the  hypothesis that the observed size of a particular gene family is highly unlikely under the bd model. here the null hypothesis is that the bd model can explain the observed size of the gene family across species. the bayesian p-value is defined as the average p-value pλ,θ,h <dig> over the posterior distribution f under the null hypothesis , i.e.,

  ppp= ∫ Ωpλ,θ,h0×f dλdθ. 

in , Ω represents the space of parameters λ and θ. the conditional p-value pλ,θ,h <dig> is the probability that the likelihood score f of a random gene family xi* is less than that of the observed family xi, i.e.,

 pλ,θ,h0= pr{f<f}. 

a random gene family xi* is generated from the bd model at each cycle of the mcmc algorithm. the ppp of gene family xi is estimated by the proportion of cycles at which the likelihood score f is less than f  <cit> . under the null hypothesis, ppp is expected to be near  <dig>   <cit> . extreme ppps  imply that gene family xi is highly unlikely to be observed under the bd model. moreover, a gene family with a slow birth and death rate tends to have a higher likelihood score than a gene family with a fast rate. thus a small ppp  indicates that the birth and death rate of the gene family is significantly greater than those of other gene families. a large ppp  implies that the birth and death rate of the gene family is significantly less than the rates of other gene families.

testing homogeneous birth and death rates among branches of the tree
the hypothesis of homogeneous birth and death rates among branches of the tree can be tested under the maximum likelihood framework  <cit> . under the bayesian framework, the evidence for supporting the null hypothesis  against the alternative hypothesis  is evaluated by the bayes factor  <cit> , bf=ff, where f is the marginal likelihood under the null hypothesis  and f is the marginal likelihood under the alternative hypothesis . in general, ln> <dig>  <cit>  is interpreted as strong evidence for supporting the alternative hypothesis .

RESULTS
simulation
gene family data were simulated from the pgm with a phylogenetic tree of six primates  specified in an example file in cafe  <cit> . we assumed a constant birth and death rate among all branches in the phylogenetic tree. three simulations were conducted with λ =  <dig> ,  <dig> ,  <dig>  respectively. the simulated datasets were analyzed by the bayesian and ml methods to estimate λ and the proportions of gene families that showed expansion, contraction, and no change along the eight branches of the phylogenetic tree. the ml analysis was conducted in cafe  <cit> . the simulations were repeated  <dig> times. for the bayesian analysis, the mcmc algorithm ran for  <dig> iterations. the log-likelihood score approached stationarity at the 100000th iteration for all the  <dig> simulations randomly chosen for convergence diagnosis. we discarded the initial  <dig> iterations as burn-in. to evaluate the performance of the two methods, we calculated the estimation errors of the bayesian and ml estimates  of λ. the estimation error of λ^ is equal to 1w∑i=1w <dig>  where w is the number of simulations and λ^i is the estimate of λ for the ith simulation. similarly, we calculated the error of estimating the proportions of gene families that showed expansion, contraction, and no change on the eight branches of the tree.

the simulation results show that the estimation error of the bayesian estimate of λ is less than that of the maximum likelihood estimate  for all three simulations with λ =  <dig> , λ =  <dig> , and λ =  <dig>  . it suggests that the bayesian method outperforms the maximum likelihood method in estimating the birth and death rate λ. the ml method appears to consistently underestimate λ because the proportion of trials underestimating λ approaches  <dig>  when the number of gene families increases . in contrast, the bayesian method produces a more unbiased estimate of λ when the true value of λ is relatively small  . for a large λ , the bayesian method tends to underestimate the value of λ, but the proportion of trials underestimating λ appears to decrease as the number of gene families increases . the simulation results also suggest that the bayesian method outperforms the ml method in estimating the proportion of gene families that showed expansion, no change, or contraction on the eight branches of the phylogenetic tree .

gene family data were simulated from the birth and death model with λ =  <dig> ,  <dig> ,  <dig>  respectively. the bayesian model and cafe were then applied to the simulated data to estimate the proportions of gene families that showed expansions, contractions, or no change. the estimation error is equal to the square root of the mean squared error of the estimated proportions of expansions, contractions, and no change. in general, the estimation error decreases as the number of gene families increases.

additional simulations were carried out to compare the performance of the hypothesis tests based on the bayesian p-value and the maximum conditional p-value. a total of  <dig> gene families were simulated using the phylogenetic tree in figure  <dig> with λ =  <dig> . another gene family was generated from the same phylogenetic tree with a higher birth and death rate λ =  <dig>  and treated as the unlikely gene family. this represents the scenario that the unlikely gene family has a faster birth and death rate than other gene families. we also considered the scenario where the unlikely gene family has a slower birth and death rate than other gene families. the unlikely gene family was generated with a birth and death rate λ =  <dig> , while other gene families were generated with λ = <dig> . the simulated gene families were analyzed by the bayesian and ml methods  respectively to identify unlikely gene families. we carried out two bayesian hypothesis tests. the one-sided bayesian hypothesis test identified an unlikely gene family if ppp <  <dig> , while the two-sided bayesian hypothesis test identified an unlikely gene family if ppp <  <dig>  or ppp >  <dig> . because a small ppp is associated with the unlikely gene families that have a fast birth and death rate, we expect that the one-sided bayesian test  is able to identify unlikely gene families with a high birth and death rate . however, the one-sided bayesian test is incapable of identifying unlikely gene families with a slow birth and death rate . in contrast, the two-sided bayesian hypothesis test works for both scenarios. the type i error was set  <dig>  for both bayesian and classical hypothesis tests. the simulations were repeated  <dig> times and we calculated the proportion of trials yielding the true unlikely gene families. finally, we increased the number of simulated gene families from  <dig> to  <dig>  to investigate the effect of the sample size  on the performance of the bayesian and classical hypothesis tests.

overall, the hypothesis tests based on the bayesian  and maximum conditional p-values perform almost equally well in identifying the unlikely gene families with a fast birth and death rate . however, cafe and the one-sided bayesian hypothesis test perform poorly in detecting unlikely gene families with a slow birth and death rate . in contrast, the two-sided bayesian hypothesis test, as we expected, is capable of identifying gene families with a slow birth and death rate, though the discovery rate is rather low .

real data analysis
the bayesian model was applied to a gene family dataset generated from five saccharomyces  genomes. the dataset contains  <dig> gene families. the phylogenetic tree was given by hahn et al.  <cit> . the mcmc algorithm ran for  <dig> , <dig> generations. the log-likelihood score reached stationarity at the  <dig> ,000th generation. with the assumption of a constant birth and death rate along the lineages of the phylogenetic tree, the bayesian analysis for the yeast dataset estimated the birth and rate λ^= <dig> , which is close to the maximum likelihood estimate λ^= <dig>  in the previous study  <cit> . however, the consistent unbiased estimates ) of the birth and death rates along the lineages leading to the five extant species are  <dig> ,  <dig> ,  <dig> ,  <dig> ,  <dig>  respectively, indicating that the homogeneous rate model may not be able to adequately explain the yeast dataset. the bayesian analysis of model selection described in the previous selection confirmed that the bf  strongly favors the heterogeneous rate model. thus the analysis of the yeast dataset is based on the bayesian heterogeneous rate model.

unlikely gene families were identified on the basis of their ppp values under the bayesian heterogeneous rate model. a gene family is identified as an unlikely family if ppp <  <dig>  or ppp >  <dig>  . a large ppp  suggests that the birth and death rates of the unlikely gene families on some branches of the phylogenetic tree are significantly smaller than those of other gene families. a small ppp  suggests that the birth and death rates of unlikely gene families on some branches are significantly larger than those for other gene families. the two-sided bayesian hypothesis test suggests that  <dig> gene families have ppp values >  <dig> . it is not a surprise because all these gene families have no change in size across five yeast species, extremely unlikely to be observed under the bd model. this result suggests that the yeast dataset may reflect two different evolutionary patterns. a majority of gene families  have no change in size across five saccharomyces species, suggesting a very slow birth and death rate , while the sizes of the remaining  <dig> gene families are distinct across species, suggesting a relatively fast birth and death rate. it would be more appropriate to analyze the two groups of gene families separately. it is, however, unnecessary to analyze the  <dig> gene families with no change in size because these gene families obviously support a very slow birth and death rate λ.

we analyzed the remaining  <dig> gene families under the bayesian heterogeneous rate model. the 95% bayesian credible intervals for the birth and death rates on the eight branches of the phylogenetic tree suggest that the rates on the branches leading to the species s.mikatae and s. kudrizvzevii are significantly higher than the rates on other branches . moreover, there is a clear pattern of expansion on the two branches leading to s. kudrizvzevii and s. mikatae , which agrees with the previous result  <cit>  except that the total number of gene families in the current study is  <dig> while it was  <dig> in the previous study. the expansion pattern on the branches leading to s. mikatae and s. kudrizvzevii is consistent with the fast rates estimated for these branches . the bayesian analysis under the heterogeneous rate model identified  <dig> unlikely gene families  , in contrast to  <dig> unlikely gene families found in the previous study  <cit> . only  <dig> of the most significantly unlikely gene families  found in the previous study are confirmed by the bayesian analysis. the dihydrourdine and alpha/beta hydrolase families, ))) and ))), were identified as unlikely gene families in the previous study, because the numbers of gene copies of species s. mikatae  for these gene families are significantly greater than those of other species. the bayesian analysis for  <dig> gene families under the homogeneous rate model identified alpha/beta hydrolase ))) as an unlikely gene family, but not dihydrourdine. it indicates that the difference is probably due to the exclusion of  <dig> gene families in the bayesian analysis. interestingly, neither dihydrourdine nor alpha/beta hydrolase were identified as unlikely families by the bayesian analysis under the heterogeneous rate model. in contrast to the homogeneous rate model, the heterogeneous rate model estimates a relatively high birth and death rate  on the branch leading to species s. mikatae, which can explain the observed large number of gene copies for species s. mikatae. thus alpha/beta hydrolase is not identified as an unlikely gene family under the heterogeneous rate model.

numbers in the first column are the branch numbers highlighted in fig.  <dig> 

discussion
simulation results suggest that the maximum likelihood method tends to underestimate the birth and death rate, while the bayesian approach is able to produce more accurate estimates of the birth and death rate and other parameters in the bd model. it is not intended in this paper, however, to claim that the bayesian method is, in general, superior to the maximum likelihood method in estimating model parameters. there might be some cases for which the maximum likelihood method outperforms the bayesian method and provides more accurate estimates of parameters in the bd model. it demands an extensive simulation study and a sufficient number of empirical data analyses to get a clear picture of how the two methods perform in various situations, which is certainly beyond the scope of this paper.

recently, cohen and pupko  <cit>  developed several probabilistic-evolutionary models for analyzing gene family data. these models assume that the evolution of gene family content follows a continuous time two-state markov process. the models coupled with stochastic mapping are able to identify horizontal gene transfer events on the lineages of the phylogenetic tree  <cit> . these models allow the gain and loss rates to vary across gene families  <cit> . similarly, the bayesian model developed in this paper can be extended to handling variable rates over gene families by assuming a probability distribution for the gene-family-specific rates.

choosing the appropriate prior distribution for model parameters is always challenging in bayesian analyses. a non-informative prior is desirable if there is no prior knowledge about the probability distribution of parameters, but it is often difficult to find a non-informative prior for model parameters. it is reasonable to specify a flat prior  for parameters λ and θ if there is no prior information available for λ and θ. alternatively, an informative prior may be used in the bayesian analysis of gene family data. nevertheless, concerns about the choice of prior distribution will be greatly alleviated when gene family data, especially those from genomic studies, have a large sample size .

both ml and bayesian methods involve intensive computation. it is unfair, however, to directly compare the computational time for the ml and bayesian methods because the ml method  produces only the point estimates of model parameters, while the bayesian method estimates the posterior probability distribution of model parameters. thus we here only provide the computational time for the bayesian method . the computational time for running the bayesian analysis for  <dig> iterations  increases linearly with respect to the number of gene families and the number of species. however, the mcmc algorithm will probably need much more than  <dig> iterations in order to converge when there is a large number of species in the dataset. for example, the bayesian analysis for the yeast dataset took about  <dig> hours  on a mac computer .

the bayesian p-value appears to be useful in identifying unlikely gene families. it should be noted, however, that neither the classical p-value nor the bayesian p-value represents the probability that the null hypothesis is true. thus they do not provide direct evidence for accepting or rejecting the null hypothesis. the bayesian p-value can be interpreted as a measure of discrepancy between the observed data and those expected from the assumed probabilistic model under the null hypothesis. gene families with small  or large  bayesian p-values can be regarded as outliers , which are unlikely to be observed under the null hypothesis. the bayesian p-value provides a general way to handle the problem of nuisance parameters  <cit> . regardless of the type of p-values  in use, the hypothesis test for unlikely gene families does not appear to have much power when the unlikely gene family has a slow birth and death rate .

CONCLUSIONS
accurately estimating the birth and death rate as well as the numbers of gene copies at the internal nodes of the phylogenetic tree is the major goal of the statistical analyses of gene family data. in this paper, we develop a bayesian approach for estimating these parameters from gene family data. the results of the simulation study and the empirical data analysis suggest that the bayesian method can accurately estimate the parameters in the bd model. the source code for implementing the bayesian analysis is written in c and available at http://code.google.com/p/begfe.

authors' contributions
ll and ly developed the method and conducted the analyses. ll, ly, vk and zl drafted the manuscript. all authors read and approve the final manuscript.

