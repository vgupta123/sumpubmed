BACKGROUND
epigenetic modification of histones and dna adds heritable information to the genome  <cit> . in mammals, dna is methylated at the c <dig> position of cytosine residues mainly in cpg dinucleotides in a tissue specific pattern  <cit> . dna methylation is an essential process and abnormal methylation is associated with human diseases such as cancer  <cit> . dna methylation is intensively studied as illustrated by the finding that a pubmed search for 'dna methylation' retrieved more that  <dig>  entries. bisulfite genomic sequencing is the standard technique for the analysis of dna methylation at high resolution. in this approach, the genomic dna is treated with sodium bisulfite, which converts all unmethylated cytosines to uracil, whereas the methylated cytosines remain unconverted. the region of interest is amplified by pcr with primers specific for converted dna and the pcr product is sequenced  <cit> . detecting a cytosine in the sequence indicates that the respective position was methylated in the original dna whereas a thymine indicates that the respective cytosine was unmethylated. when combined with subcloning and sequencing of individual clones, the dna methylation pattern can be determined at single molecule and nucleotide resolution for continuous tracks of up to  <dig> base pairs   <cit> .

the analysis of the primary bisulfite sequencing data, which should comprise about 20- <dig> subcloned dna molecules for statistical analysis , requires the following tasks: 1) the experimental sequences need to be aligned to the in silico converted genomic reference. 2) the sequence identity and the conversion rate of each experimental sequence need to be measured, and sequences which do not comply with the quality criteria must be removed. 3) clonal sequences, which were amplified from the same template molecule in the pcr, need to be detected and removed. 4) the cpg sites need to be identified in the reference sequence and the aligned experimental sequences. 5) the methylation state of the cpg sites in the experimental sequences needs to be determined and the data summarized and presented.

there are different softwares available for the analysis of bisulfite sequencing data, which can be divided into those for analysis of dna methylation in plant such as kismeth  <cit>  or mammals such as the biq analyzer  <cit>  and quma  <cit> . while plant methylation analysis conceptually deals with cpg and non-cpg methylation, in mammalian bisulfite sequencing analyses cytosines at non-cpg positions are usually considered an artifact of the method  and used to measure the conversion rate. here we focus on this approach for bisulfite sequencing data analyses which is assisted by the biq analyzer and quma as well. however, both of these have major drawbacks:

• convenience of use: biq analyzer needs installation and has slow performance.

• sequence alignment: the biq analyzer sometimes fails to construct the sequence alignment between the experimental and reference sequences without manual user intervention.

• filtering for clonal sequences: quma has not implemented a filtering of clonal sequences. the biq analyzer for certain datasets erroneously suggests removing too many sequences as clonal. in addition, the filtering routine of the biq analyzer software erroneously assumes two molecules as non-clonal, which differ by the existence of an unresolved nucleotide annotation  only.

• identification of cpg sites and annotation of methylation states: the biq analyzer often fails detecting cpg sites which are located downstream of a t-stretch. quma does not check for the presence of the corresponding cpg guanine in the experimental sequences and annotates methylation states at sites with alignment errors, sequencing errors and mutations, like ta, tt, tn, or cn.

• the genetic diversity among repetitive sequences requires a different strategy for analysis of the bisulfite sequencing data which is not provided by any software so far.

therefore, we developed a new software called bisulfite sequencing dna methylation analysis . bisma provides a highly automated, simple and fast workflow for the analysis of bisulfite sequencing experiments. it can be used for the analysis of subcloned pcr products from unique and repetitive genomic regions. all uploaded data will be automatically processed, filtered for sequence identity, conversion rate and clonal sequences and analyzed. bisma has implemented an improved strategy for detection of clonal sequences, which preserves identical methylation patterns and ignores n-sites during pattern analysis. furthermore, bisma has implemented a new algorithm for detection of cpg sites in the bisulfite sequencing data.

we embedded the bisma software in the existing dna methylation data analysis platform bdpc, which allows for further downstream data processing, compilation, web presentation and statistical analysis of results  <cit>  as well as clustering and graphical data presentation  <cit> . the bisma software is a freely available online tool for academic purposes http://biochem.jacobs-university.de/bdpc/bisma/.

implementation
dataset and software comparison
biological samples were obtained and treated as described before  <cit> . published primary sequencing data of the amplicons 51_new <dig>   <dig>   <dig>  327_iii and  <dig> were used for comparison of the programs  <cit> . treatment of cells with 5-azacytidine was performed as described before  <cit> . bisulfite treatment, pcr-product purification, subcloning and sequencing was done as described  <cit> .

briefly, about 200- <dig> ng genomic dna were digested with an appropriate restriction enzyme at 37°c overnight to facilitate the subsequent denaturation process, then the dna was converted with sodium bisulfite in a thermocycler for  <dig> min at 99°c,  <dig> min at 50°c,  <dig> min at 99°c,  <dig>  h at 50°c,  <dig> min at 99°c,  <dig>  h at 50°c. the converted dna was used as a template for pcr. the pcr products were purified by chargeswitch pcr clean-up kit  and subcloned using the strataclone kit . a high number of clones for each amplicon were sequenced.

the xist promoter was amplified using the following primers:  from tailtip dna of a female mouse. the alu regions were targeted using the published primer set  <cit>  without the 5'-overhangs . the analysis was performed using the matching region of the alu-sx subfamily consensus sequence . we downloaded, installed and used the biq analyzer v <dig>  software on a core duo l <dig> computer with a  <dig>  gigahertz processor and  <dig> gigabyte installed random-access memory on a microsoft windows xp professional operation system. we installed java runtime environment version  <dig> update  <dig> . we used the remote-clustalw option such that all multiple sequence alignments were performed on a server at the max planck institute for informatics. we used 95% and 90% as lower threshold for the conversion rate and the sequence identity in all three programs for comparison.

bisma software implementation
bisma is a php coding language based web application which manages the sequencing data information using a mysql database for temporary storage. currently, bisma is running on an opensuse  <dig>  linux web server. if sequences in abi file format are uploaded to bisma the dna sequence is automatically extracted from the abi files as they were edited by the user. for this task bisma uses the perl module bio::trace::abif  <cit> . all pair wise and multiple sequence alignment steps in the bisma software are performed using the clustalw software  <cit> . after the alignment, bisma compares each uploaded sequence with the reference or consensus sequence to calculate the sequence identity, the conversion rate and the occurrence of gaps. sequences which do not pass the user defined threshold will be excluded from further analysis. bisma uses the following default quality filtering thresholds for the analysis of unique genomic sequences: sequence identity 90%; conversion rate 95%; gaps 20%. for the analysis of repetitive sequences bisma uses the following default thresholds: sequence identity 70%; conversion rate: sequences with  <dig> and more unconverted cytosines in  <dig> bps are excluded; gaps: 20%.

RESULTS
the bisma software is designed for upload of primary bisulfite sequencing datasets derived after subcloning of pcr products from unique and repetitive sequences. bisma has implemented automatically sequence processing, alignment, filtering for sequence quality, filtering of clonal sequences, data analysis and presentation.

uploading and sequencing data processing
sequencing data can either be directly uploaded in abi file format, as text files containing the extracted sequence or as a single multi-fasta file . for the uploading process of separated sequencing files, these files need to be archived using the zip standard, which is implemented in current desktop operation systems from microsoft, apple and many free linux distributions. currently, the total size of all uploaded files is limited to  <dig> mb, which corresponds to approximately  <dig> sequences in original abi format. bisma automatically prepares two pair wise sequence alignments of the submitted sequence and its reverse complement to the in silico converted reference sequence. based on the quality of the alignments, bisma determines the correct sequence direction and automatically removes the vector sequence. pair-wise alignments of the reference sequence with the experimental sequences are used to create an alignment of all sequences. this strategy is significantly faster than a clustalw multiple sequence alignment and a similar algorithm is implemented in the quma software. in principle, such strategy is favorable, since the reference sequence and the experimental sequences of a bisulfite sequencing data set are not of equal weight, but each experimental sequence needs to be compared with the reference sequence.

however, we observed that a clustalw multiple sequence alignment sometimes will provide a better alignment than the combination of pair-wise alignments. the massive occurrence of thymine after bisulfite conversion and pcr leads to the presence of long poly-t stretches, which often cause pcr and sequencing artifacts in form of thymine insertions or deletions. under these circumstances the combined pair wise alignments often fail at the last cpg position. therefore, with default settings bisma automatically will apply a clustalw multiple sequence alignment if a cpg site is close to the end of the pcr product and associated with a t-stretch. beside this, the user can manually choose between pair wise and clustalw multiple sequence alignment.

quality control of aligned sequences
bisma automatically determines for each sequence the degree of identity to the reference sequence, the conversion rate, the appearance of insertions and deletions and the number of unresolved nucleotides  at reference sequence cytosine positions, which are in general an indication of low sequence quality . these parameters are then used for quality control filtering and sequences which do not pass user defined thresholds will be excluded. recently, non-cpg methylation has been reported for mammalian cell lines as well which seems to be correlated with the degree of differentiation  <cit> . although bisma has a cpg centered approach of data analysis, it can be used for initial visualization of sequences with non-cpg methylation. if this is intended, the threshold of the conversion rate needs to be lowered manually, because otherwise clones with high non-cpg methylation will be excluded because of low conversion. as bisma does not analyze non-cpg methylation, it might be considered to use the plant methylation analysis softwares kismeth  <cit>  or cymate  <cit>  for this task. however, discrimination of non-cpg methylation from incomplete conversion in mammalian cell types requires careful controls and ideally additional experimental evidence.

cpg site detection and annotation of the methylation state
bisma uses an improved strategy for detection of cpg site positions in the experimental sequences  when compared to the biq analyzer and quma. briefly, bisma first checks if a cpg guanine is present in the experimental sequence at the appropriate position and only then determines the methylation state of the cpg site using the sequencing result of the next base in 5' direction.

this strategy allows correct and reliable evaluation of the methylation state and resolves cases of deletions or insertions of thymine by pcr artifacts. as introduced above, such artifacts frequently happen during amplification of t-stretches in the bisulfite converted dna. bisma displays the multiple sequence alignment including the annotation of the methylation pattern, unconverted cytosines and possible clonal molecules for visual inspection .

filtering for clonal sequences
one important caveat of bisulfite methylation analysis is the possibility of amplifying single converted dna molecules , which after subcloning of the pcr product and sequencing of individual clones, could give rise to several identical sequence reads. therefore, bisma performs a second filtering to remove such clonal sequences by preparing a pair wise comparison of the cytosine patterns of all sequences . bisma ignores n-sites during this procedure, because they indicate bad sequencing data quality and are not suitable to discriminate between cytosine patterns. if two sequences have the same cytosine pattern, these molecules might be either the result of clonal pcr or represent an identical methylation pattern in different template molecules. removing all sequences with an identical cytosine pattern, therefore, may lead to the erroneous elimination of clones with identical methylation patterns . this potential mistake is critical in highly methylated or unmethylated pcr products. in contrast, identical patterns of methylation and unconverted cytosines in non-cpg context, which in human dna usually are considered bisulfite conversion artifacts, always is a clear indication of clonal pcr. therefore, bisma removes such sequences with default settings, but it keeps those sequences where the identical cytosine pattern is restricted to cpg sites. however, the user can change the mode of filtering of clonal sequences and manually edit the selection of sequences to be included in the final analysis . it should be noticed, however, that there is no absolute safe way for filtering of clonal molecules; in critical cases the pcr reaction on the bisulfite converted dna has to be repeated to resolve this issue experimentally.

final output of analyzed data
the bisma output  consists of the following elements: 1) an annotated alignment, 2) a graphical display of the methylation pattern in context of the cpg site distribution in the reference sequence, 3) a graphical display of the condensed methylation pattern, 4) a graphical display of the average methylation at each cpg site, 5) statistics about the overall methylation percentage and the percentage of cpg sites analyzed and 6) the overall methylation percentage of each clone. bisma will automatically sort the sequences in the alignment and all output files and graphical presentations by their methylation level, if selected by the user. bisma has implemented a threshold for the average methylation report of individual cpg sites, such that only statistics are calculated and reported if at least  <dig> experimental sequences could be analyzed at the respective site. this avoids over-interpretation and propagation of weak data points. all statistics and the alignment are combined in one html file for data storage, presentation and further manual or automatic downstream analysis. for example, the output files of many analyses can be combined and submitted to the bdpc compilation software on the same server.

methylation analysis of bisulfite sequencing data from repetitive sequences
the methylation state of repetitive genomic sequences is frequently investigated using bisulfite genomic sequencing as a measurement of global methylation difference or to determine the repeat specific methylation . different approaches have to be used for the investigation of the methylation state of unique and repetitive genomic sequences, because the genomic reference for a repeat sequence is not defined as these elements are present in many copies with similar but not identical sequences. for example, a single primer pair designed to determine the methylation of alu sequences will amplify pcr-products from about  <dig>  template regions in bisulfite converted human dna  <cit> . as a consequence, the genomic origin of each amplified molecule is unknown, such that it cannot be directly compared with a defined reference sequence. therefore, the standard approach for the analysis of unique sequences, where each cpg position is compared against its genomic reference sequence and the methylation state of each cpg site can be determined, is not an option in the analysis of sequencing data from repetitive genomic sequences. instead, with repeats a consensus sequence has to be used for sequence alignment and analysis. however, this does not allow distinguishing an unmethylated cpg site from one that is mutated to tg. furthermore, the experimental sequences may contain additional cpg sites which are not present in the consensus.

to determine the methylation state of repetitive sequences, bisma has implemented two strategies. the first approach uses the consensus sequence for validation of the amplified sequences and sequence alignment only. the bisma software for repetitive sequences extracts the position of methylated cpg sites in the aligned experimental sequences and calculates the number of methylated cpg per sequence, which can be located at consensus and non consensus positions. for each sequence, the following information is stored in the output file: the sequence identifier, the number of methylated cpg sites found in the sequence, and the position of each methylated cytosine in the aligned sequence. the methylated cytosines are plotted in an overview graph . sequences are sorted according to the number of methylated cpg sites. bisma visualizes the cpg sites at the consensus sequence positions in black, while those at non consensus positions are plotted in red. bisma also displays and stores the distribution of methylated cpg sites among sequences  and the corresponding average occurrence of methylated cpgs in  <dig> bps .

to illustrate the functionality of the new bisma software for analysis of repetitive sequences, we amplified a short region of the alu repetitive element from bisulfite converted dna from various samples and used the matching part from the alu-sx subfamily consensus sequence  <cit>  for data analysis. as shown in figure  <dig>  we observed high methylation in the alu sequences from peripheral blood leukocytes, cultured fibroblast cells, the immortalized cell line hek <dig> and the human hepatocellular liver carcinoma cell line hepg <dig>  which is in agreement with literature data on the methylation state of the alu sequences  <cit> . in spite of this, several molecules were found without methylation or low methylation especially in hepg <dig> and even more pronounced after treatment of hek <dig> cells with 5-azacytidine. such observation is consistent with reported loss of global methylation during cancer progression  <cit> , which for example was documented especially for the line <dig> repetitive element in hep-g <dig>  <cit> .

as an alternative analysis strategy, we implemented the estimation of the overall methylation as introduced by yang et al.  <dig>  <cit> . this method focuses on the consensus cpg positions. it estimates the rate of cg to tg mutations in the sequenced strand by determining the number of cg to ca mutations, which corresponds to cg to tg exchanges in the opposite strand. assuming that the mutation rate is similar in both dna strands, the number of unmethylated cpg sites can be calculated by correcting the number of tg sites by the fraction of mutated sites. then, the overall dna methylation percentage is calculated from the number of unmethylated and methylated cpg positions. using our test dataset from leukocytes, we obtained an overall methylation of alu repeats of  <dig> %, which is higher than reported previously  <cit> . such difference might be in the range of inter-individual variation or result from the absence of the 5'-overhangs in the primers used here.

comparison of bisma with existing bisulfite sequencing analysis programs
we used datasets from published results  <cit>  for the human genes s100b, ncam <dig>  col6a <dig>  znf <dig> and h2bfs to compare the performance of the new bisma software for unique sequences with the biq analyzer and quma showing examples of improved cpg site detection and methylation state annotation  and filtering for clonal molecules .

a summary of the comparison of the bisma software with the biq analyzer and quma software is shown in figure  <dig>  bisma is the only software which supports the analysis of bisulfite sequencing data from repetitive sequences. all three programs can be used free of charge for academic purpose. the online tools quma and bisma do not require an installation on the user's computer, while the biq analyzer requires an installation in a java runtime software environment.

the result files of the bisma software for analysis of unique sequences and the biq analyzer are capable for direct web presentation and are compatible with the bdpc compilation software. quma and bisma automatically sort the clones in the multiple sequence alignment, the output files and figures by methylation. for comparison of the analysis time, we measured the time needed for the automated analysis. when comparing the average processing time, quma is slightly faster  than bisma but the biq analyzer is significantly slower  . however, quma's analysis algorithm has not implemented the filtering of clonal molecules, which might explain the slightly faster performance. the main reason for the gain of speed of the quma and bisma programs when compared with the biq analyzer is the automatic detection of the sequence direction and vector sequence removal, which is implemented in bisma and quma. another aspect for the increase in speed is the use of pair wise alignments of the reference sequence to the experimental sequences. this strategy is faster than a multiple sequence alignment especially with large number of sequences. a choice between different alignment methods is a unique feature of bisma.

all three programs support uploading of sequencing files in text format. however, bisma is the only software which supports direct uploading of abi sequencing data. all three tools identify and remove improper sequencing results based on sequence identity and conversion rate. in addition, quma and bisma remove sequences with insertions or deletions which do not pass the user defined threshold. only bisma directly filters clones for n-sites at cytosine positions as well. all three programs provide an annotated alignment of all sequence of the final dataset.

the accurate determination of the methylation state of each aligned cpg position is one of the most important tasks during analysis of bisulfite sequencing data. the new bisma software has implemented an improved algorithm for cpg site detection, which detected all positions accurately. the biq analyzer fails if the methylation site under investigation is not directly aligned with the respective cytosine position, which frequently happens in aligned bisulfite sequencing results at t-stretches . the quma software erroneously reports a methylation result of mutated  and unknown  positions .

the biq analyzer and bisma programs offer filtering of clonal molecules, while the quma software does not check for clonal sequences and it includes obvious examples of clonal pcr for methylation analysis . however, bisma has implemented an improved algorithm that keeps clones with identical cytosine patterns, which do not have conversion artifacts. more stringent filtering as implemented in the biq analyzer inappropriately removes valid methylation patterns . bisma ignores n-sites during filtering of clonal sequences, which is not implemented in the biq analyzer . therefore, the filtering routine of the biq analyzer leads to preferential analysis of sequences with conversion artifacts and bad sequencing data quality. this is critical when analyzing highly methylated or unmethylated regions.

to illustrate the functionality of the improved filtering for clonal sequences, we isolated dna from mouse tail tip, converted it with sodium bisulfite and amplified a part of the xist promoter from a female animal . in females, the xist promoter is methylated on the active x-chromosome, while unmethylated on the other chromosome which is subject to x-chromosome-inactivation. therefore, the expected methylation pattern consists of half methylated and half unmethylated clones  <cit> . as shown in figure 3c, the strict filtering of identical cytosine patterns led to the removal of many clones and artificially created a heterogeneous methylation pattern, which might mislead the interpretation. in contrast, the data analyzed with the modified settings nicely reflect the true methylation pattern.

bdpc as an integrated platform for bisulfite sequencing dna methylation analyses
bdpc is a platform, which assists the full dna methylation analysis workflow . the embedded bisma software for unique sequences is useful for single pcr product analysis. its result files can be collected and directly submitted to the bdpc compilation software, which integrates methylation data of cpg sites on the level of amplicons  <cit> . it displays the whole dataset in form of an html presentation, which can be linked to the versatile ucsc genome browser. finally, large methylation analysis projects often aim to compare the compiled data among the samples analyzed and need condensed pictures for data presentation. these demands are supported by the bdpc clustering software, which prepares a heatmap of all methylation data clustered by the amplicon methylation state and a tissue clustering, which is plotted in a dendrogram  <cit> .

CONCLUSIONS
the bisma software supports the analysis of subcloned pcr products from bisulfite sequencing experiments. it has implemented an improved strategy for detection of clonal sequences and a new algorithm for detection of cpg sites. bisma is the first software which supports analysis of bisulfite sequencing from repetitive genomic regions. the highly automated and simple workflow of the bisma software minimizes the required user interactions to successfully analyze the dataset within a short time. bisma provides full user control and allows adjusting the thresholds of many parameters and selection of the final dataset on the basis of an annotated sequence alignment. the bisma software can be freely used as an online tool for academic purposes at http://biochem.jacobs-university.de/bdpc/bisma/.

availability and requirements
project name: bisma

project home page: http://biochem.jacobs-university.de/bdpc/bisma/

operating system: platform independent online software

license: source code available upon request for academic use

any restrictions to use by non-academics: licence needed

abbreviations
bdpc: bisulfite sequencing data presentation and compilation; bisma: bisulfite sequencing dna methylation analysis software; bps: base pairs; ucsc genome browser: university of california santa cruz genome browser; n-sites: unresolved nucleotide sites in sequencing reads

authors' contributions
cr and aj conceived project and wrote the manuscript. cr wrote the bisma source code. cr, yz and rr performed the experiments. cr conducted the statistical analyses. all authors read and approved the final manuscript.

supplementary material
additional file 1
supplemental text s <dig>  correlation between number of analyzed clones and precision of the estimate of biological methylation levels. supplemental text s <dig>  examples in literature for bisulfite sequencing of subcloned pcr-products obtained from repetitive elements. supplemental text s <dig>  improved cpg site detection and improved annotation of the methylation state. supplemental text s <dig>  improved cpg site detection. supplemental text s <dig>  improved annotation of the methylation state. supplemental text s <dig>  automatic detection of clonal molecules. supplemental text s <dig>  improved detection of clonal molecules avoids inappropriate filtering of valid sequences. supplemental text s <dig>  improved detection of clonal molecules ignores n-sites at cytosine positions. supplemental figure s <dig>  complete alignment of all bisulfite sequencing data used to create the results shown in figure 3c.

click here for file

 acknowledgements
technical assistance of ms. sandra becker and the web server capacities of the jacobs university including its maintenance by dr. achim gelessus are gratefully acknowledged. we acknowledge dr. tomasz p. jurkowski for discussions about implementation of sequencing data extraction and alignment tools in web applications. this work was supported by the ngfn <dig> program of the german minister of research and education .
