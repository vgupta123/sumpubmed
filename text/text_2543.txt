BACKGROUND
mass spectrometry is a promising technology for biomarker discovery  <cit> . there are a wide variety of mass spectrometers from which one could choose from during the design of a biomarker discovery experiment, reviewed in  <cit> . matrix assisted laser desorption/ionization time-of-flight mass spectrometry  can ionize whole proteins intact over a wide range of protein mass values, making it suitable for biomarker discovery in complex media such as blood serum, where both protein concentrations and masses vary greatly  <cit> . surface-enhanced laser desorption/ionization time-of-flight mass spectrometry   <cit>  is a variant of maldi that adds an on-chip chromatographic separation step at the front end of the analysis pipeline. this, combined with robot-automated sample preparation, enables seldi to be high-throughput, an attractive feature for many laboratories. for a recent review of the application of seldi in the context of biomarker discovery, see  <cit> .

the typical seldi work flow involves the collection of samples  from patients, application of the samples to seldi proteinchips® selected for desired physicochemical properties, and analysis in the seldi mass spectrometer. the raw data must be preprocessed to detect relevant peaks which correspond to proteins in the sample. typical signal preprocessing steps performed are spectral alignment, denoising/smoothing, peak detection, peak matching, normalization, and quantification . the preprocessing of the raw seldi spectra is typically accomplished using one of several available software packages . artifacts due to insufficient preprocessing of the data have, in the worst case, led to erroneous biological conclusions in early seldi studies  <cit> . this fact inspired several important comparison studies of seldi preprocessing algorithms  <cit> . we now briefly summarize a few of the major contributions. for a more detailed overview, see the introduction of  <cit> .

coombes et al introduced the use of wavelets for denoising seldi spectra  <cit> , providing a more adaptive approach to denoise compared to moving average filters . meanwhile, morris et al introduced the notion of a mean spectrum, which represents average protein activity of a group of spectra. under non-restrictive assumptions, the mean spectrum has less noise and allows one to circumvent complicated peak matching algorithms that consolidate peak predictions among individual spectra into a consensus prediction. malyarenko et al introduced a novel baseline removal algorithm based on a proposed charge accumulation model of the saturation phenomenon of the detector  <cit> . this was one of the first algorithms that was designed from the "bottom-up", starting with physical considerations of seldi. later, deconvolution filters were shown to be a possible approach for improving mass resolution of seldi  <cit> .

sköld et al analyzed single-shot spectra  <cit> , the basic components of a final seldi spectrum obtained by summing the results of many laser shots. they suggested that the observed counts in the single shot spectra may be proportional to a poisson random variable, proposing a heteroscedastic model for the data. meuleman et al also make use of single-shot spectra  to derive a preprocessing algorithm based on analyzing these components separately  <cit> .

in an attempt to improve on the bottom-up approach to preprocessing, we analyze the statistics of the seldi signal over a wide range of intensity values. based on data presented herein, we propose a natural exponential family model with quadratic variance function for the statistics of the detector response for seldi experiments. we believe this model is a plausible explanation for acquisition of single-shot spectra, summing of single-shot spectra into a final spectrum, and extracting protein estimates from a mean spectrum under a unified framework. under this framework, we introduce a new preprocessing approach, adaptive to changing noise characteristics per spectrum and per experiment, and show favorable peak prediction performance.

RESULTS
buffer-only intensity measurements
electronic measurements exhibit natural random fluctuations  <cit> . in many cases, these fluctuations are independent of the signal and are modeled as additive white gaussian noise. in order to understand the nature of the noise fluctuations inherent to seldi, we study the response of the detector under controlled experiments applying different buffers instead of protein samples under varying laser intensities . this eliminates the complexity introduced by adding serum to the chips while facilitating measurements of ion counts over a wide range of intensity values. in principle, this gives us a set of n repeated experiments from which we can study the statistics of the detector response compounded with noise and interference inherent to seldi. in this fashion, we have generated two separate buffer + matrix datasets, denoted buffer <dig> and buffer <dig>  which represent data generated on the same seldi pbs iic machine by different scientists and different machine parameters. buffer1/buffer <dig> contain 183/ <dig> spectra, respectively.

we visualize all of the spectra in buffer <dig> and buffer <dig> in figure  <dig>  in particular, we are interested in analyzing the region between  <dig> and  <dig> kda, since this is the mass focusing region in our experiments. in this region, the observations across spectra for a fixed time  point represent approximately independent, identically-distributed measurements in buffer <dig> or buffer <dig>  respectively. figure  <dig> shows the median, 75% quantile, and 25% quantile of buffer <dig> and buffer <dig>  the median spectrum shows the form of an ordinary measurement, with any measurement between the 75% and 25% spectrum lines considered typical as well.

we study the detector response  for seldi under varying input conditions, creating a detector response curve as follows. for each fixed time  point across spectra from buffer <dig> in the mass focused region , we estimate the mean intensity observed and the corresponding variance, with the same repeated for buffer <dig>  these are displayed as a scatter plot in figure  <dig> along with the best fit quadratic curve. observing figure  <dig> we see

 <dig>  intensity fluctuation/variance increases monotonically with the mean.

 <dig>  the variance of the detector response is a quadratic function of the mean, to a very good approximation

 <dig>  the detector response curves for buffer <dig> and buffer <dig> are quite different, and thus are dependent on the machine settings.

the detector response statistics thus exhibit a quadratic variance function. briefly, a random variable x is said to have a quadratic variance function  if

  v=υ0+υ1μ+υ2μ <dig>  

with μ being the mean of x, v the variance, and υ <dig>  υ <dig>  υ <dig> constants, some of which may be zero.

from these observations, summarized in figures  <dig> and  <dig>  it seems unlikely that an algorithm optimized for buffer <dig> would work well on buffer <dig> and vice versa. further, neither a homoscedastic approach  or a simple heteroscedastic approach  to preprocessing the data is likely to be sufficient.

data for evaluating preprocessing algorithms
we have generated two new datasets for evaluating preprocessing algorithms in order to improve upon purely simulation-based datasets used in previous comparison studies  <cit> . a good comparison dataset should have the following properties :

 <dig>  exact protein content is known 

 <dig>  analyzed sample is complex containing many proteins/peaks

 <dig>  noise and baseline characteristics should be as close to those of real seldi data as possible.

if one uses simulated data  <cit> , complete control can be attained over requirements 1) and 2) at the expense of having noise/baseline characteristics that are overly ideal. if one uses purely real data, the noise, baseline, and artifacts that arise in actual experiments are present. however, this usually accompanies the trade-off of either not knowing the exact protein content  or an overly simplified scenario .

we combine the advantages of purely simulated and real data by introducing the notion of a hybrid spectrum. to generate a hybrid spectrum, we use an implementation of the simspec  <dig>  seldi simulator  <cit> http://bioinformatics.mdanderson.org/software/cromwell/simspec.zip to generate a "clean" seldi spectrum, shown at the top of figure  <dig>  this gives an accurate peak shape characteristic as would be seen in low resolution seldi/maldi for given mass and ion abundance values, without any electronic noise or baseline present. we then select one of our buffer + matrix spectra  and add the two together to produce the hybrid spectrum shown at the bottom of figure  <dig>  thus, in a hybrid spectrum we know the exact virtual protein content specified to the simulator a priori while maintaining exactly the same noise, baseline, and other artifacts one encounters with real seldi data.

further details on the hybrid spectra can be found in the methods section and in additional file  <dig>  the collection of hybrid spectra under different operating conditions results in test sets, denoted hybrid <dig> and hybrid <dig>  with each test set containing thirty datasets of fifty hybrid spectra each. the mean performance of a preprocessing algorithm on hybrid <dig> and hybrid <dig> can be interpreted as the expected performance of the preprocessing approach in each separate operating condition in a repeated experiment or sampling from a homogeneous population .

new preprocessing algorithms for seldi
we have developed a set of matlab® scripts for preprocessing seldi spectra named libseldi. for information on how to obtain libseldi and the associated scripts used to produce the figures in this paper, contact the authors. we compare our preprocessing package to the massspecwavelet package from the bioconductor project  <cit> . massspecwavelet has been established as one of the best approaches in terms of peak finding in recent comparison studies  <cit> , and has been downloaded >  <dig> times in the past two years as of march  <dig> http://bioconductor.org/packages/stats/bioc/massspecwavelet.html. both packages have the advantage of having only one main user-adjusted parameter.

in order to compare the performance of each preprocessing program, we generate operating characteristic curves   <cit> , one for each of the  <dig> datasets of hybrid <dig> and hybrid <dig>  by varying the peak area threshold  and signal-to-noise ratio threshold  parameters in the programs. code snippets showing how massspecwavelet was tested can be found in additional file  <dig>  this allows us to understand the trade-offs between false discovery rate  and sensitivity  achieved by each algorithm. the results for both the hybrid <dig> and hybrid <dig> collections are shown in figure  <dig>  where we have plotted the fdr-axis in log scale to emphasize the low fdr region which is usually of most interest in biomarker discovery applications. note that, since both hybrid <dig> and hybrid <dig> are collections of datasets representing repeated trials , the oc curves we show in figure  <dig> are the mean oc curves across the  <dig> datasets for each.

the results show that libseldi tends to have a considerable advantage in the low fdr region, while massspecwavelet tends to have higher sensitivity for fdr > 25%. one way to summarize the performance of the algorithms is using the area under the oc curve for the fdr region of interest. we compute two area under the curve values, pauc  <cit>  , and pauc <dig> . the results are shown in table  <dig>  where we have normalized each score separately so that a perfect pauc <dig>  score is  <dig> 

area under the operating characteristic curve in a range of false discovery rate values of interest is a useful way to compare peak prediction performance. we show two partial area under the curve metrics, calculated in the range fdr ∈   and fdr ∈  . pauc is more of overall measure of peak prediction potential, while pauc <dig> focuses on measuring performance at low fdr. the number shown is the average  calculated from the  <dig> operating curves from hybrid <dig> and hybrid <dig>  libseldi shows particularly appealing pauc <dig> performance.

in figure  <dig>  we show the specific operating characteristics for libseldi and massspecwavelet for dataset  <dig> of hybrid <dig>  while both algorithms perform well, libseldi resolves more than  <dig> proteins correctly before making a mistake. since operating characteristics show false discovery rate along the x-axis rather than false positive rate , they tend to penalize more when false predictions are made with very few true proteins found. indeed, in this case massspecwavelet got its first protein prediction correct but its second prediction wrong, leading to the point at fdr = 50%, tpr = 7%. thus, operating characteristics with false discovery rate along the x-axis enforce the principle of conservative decision making, rewarding approaches that are successful with their initial large threshold  predictions and penalizing those that make mistakes early.

at fdr values greater than 30%, massspecwavelet outperforms libseldi. however, this is at the expense of generally more promiscuous predictions, since massspecwavelet generates  <dig> potential protein predictions compared to  <dig> for libseldi.

discussion
we posit that the detector response is a member of the natural exponential family with quadratic variance function , which is a proper subset of the exponential family of distributions  <cit> . figures  <dig> and  <dig> show that assuming the detector response takes the form of a specific distribution is impractical, but that the detector response v has a qvf. the nef-qvf family of distributions occur often in practice and have the following useful properties, characterized by morris  <cit> :

 <dig>  if a random variable x ∈ nef-qvf, it is completely specified by its variance function v

 <dig>  if x ∈ nef-qvf, a, b constants then ax + b is also nef-qvf

 <dig>  additivity: if x1; x <dig> ∈ nef-qvf, then x <dig> + x <dig> is nef-qvf

 <dig>  affine combinations of normal, poisson, gamma, binomial, negative binomial, and generalized hyperbolic secant distributed random variables generate all possible distributions in the nef-qvf family.

there are some physical reasons as to why the nef-qvf assumption could be reasonable as well. some plausible justifications for the first two terms in eq.  are:

 <dig>  constant term: this is possibly due to thermal noise  which is common to all electronic measurement devices  <cit> 

 <dig>  linear term: the ability to detect an ion in a multiple stage electron multiplier, a common type of detector in maldi-like instruments, is described by compound poisson statistics  <cit> .

the existence of a plausible physical explanation for the quadratic variance term remains an open question. however its effect is measured in both buffer <dig> and buffer <dig> and cannot be neglected. while the qvf model explains the data well in the mass focused region between  <dig> and  <dig> kda, it is likely to break down at lower masses around 2- <dig>  kda where the baseline reaches a maximum. in this region the detector often saturates, introducing a non-linearity into the data that we have not accounted for.

the success of our univariate model for seldi may indicate that we have selected the most important feature to consider in the preprocessing of the data: namely, the fluctuations in the response of the ion detector subject to different inputs. the analysis of expression values of preprocessed data, on the other hand, requires multivariate methods as there are significant statistical dependencies between the peak heights corresponding to proteins that may be interacting. while these correlations are important in the analysis performed after the data is preprocessed, our results indicated it may be safe to ignore them during the preprocessing. while we have shown libseldi to be accurate for estimating peak m/z values, we have not assessed the usefulness approach for estimating peak intensities in this work. the utility of libseldi for accurately estimating peak intensities remains an open question and subject of future work.

it is entirely possible that the quadratic variance model could be applicable to other similar technologies such as maldi and newer seldi mass spectrometers. this, however, has not been confirmed.

having buffer only spectra allows one to estimate the parameters of the detector response curve. knowledge of the detector response curve enables us to apply the modified antoniadis-sapatinas denoising scheme described in the methods. using this approach in our libseldi package yields excellent peak detection performance. we have proved this concept on hybrid <dig> and hybrid <dig> by estimating the qvf parameters of  using the buffer-only spectra that were randomly selected from buffer <dig> and buffer <dig> respectively. this implies that spots on seldi chips should be reserved for buffer-only spectra. thus, the trade-off for using our approach is increased cost in terms of the number of chips one must use. the modified antoniadis-sapatinas denoising is computationally intensive as well, taking approximately seven minutes per spectrum on a high-end workstation.

we argue that some of the cost is recovered by the potential for adaptive and accurate preprocessing, but not all. it may be possible to use qc and/or calibration samples to estimate the qvf as well rather than buffer-only spots. however, this would add in some additional variation due to the nature of the medium .

while libseldi outperforms massspecwavelet on the hybrid <dig> and hybrid <dig> test sets, the applicability of this comparison and of these results to purely real data remains an open question. there is some basic biological variability modeled in our test sets . however, data from complex biological samples such as serum or plasma likely contains more biological variation and artifacts than we have modeled in hybrid <dig> and hybrid <dig>  the investigation of how biological variation affects the model in qc samples is a work in progress.

in addition to achieving a better mean oc curve at lower fdr values, libseldi consistently predicts fewer peaks than massspecwavelet, leading to protein predictions closer to the true number of proteins in the data, as shown in figure  <dig>  this is further evidence that the adaptive modified antoniadis-sapatinas denoising approach using the nef-qvf model for the detector response is smoothing the spectra by close to the right amount.

CONCLUSIONS
we have shown that the variance of the intensity of a seldi spectrum is quadratic in the mean signal strength. we further make the flexible assumption that the underlying distribution of the intensities is from a natural exponential family. from this point of view, we use a modified antoniadis-sapatinas wavelet shrinkage approach for denoising seldi spectra. with this method at the core of our libseldi program for preprocessing seldi data, we demonstrate excellent sensitivity at low false discovery rates. for applications that can tolerate higher false discovery rates, the massspecwavelet algorithm performs better in this region.

our work has implications in the design of seldi experiments. namely, the modified antoniadis-sapatinas denoising technique performs well but requires an estimate of the quadratic variance function  describing the seldi detector. this, in turn, is affected by machine settings. we have used buffer-only spectra to estimate the qvf. thus, buffer-only spots could be interlaced on chips. we are investigating less expensive ways to estimate the qvf in future work.

