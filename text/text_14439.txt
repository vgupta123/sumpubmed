BACKGROUND
naturally occurring germline dna variants in human populations and distinct strains of model organisms affect many phenotypes, including basal levels of gene expression . when the genotype of a variant is significantly associated with expression of a nearby gene, that variant is said to tag a cis-acting expression quantitative trait locus . several groups have noted that single nucleotide polymorphisms  can interfere with hybridization of cdna to the microarray probes that span the snp . this technical artifact produces spurious eqtl signals if only one strain or population subgroup bears the snp, as the artificially lower gene expression appears to indicate a cis-acting eqtl.

a recent publication highlighted this serious problem which has caused incorrect findings to be reported and replicated widely in the genetics literature  <cit> . ramasamy et al. suggested a protocol that removed microarray probes bearing snps, but did not provide software tools to automate this approach. previously published packages predict the presence of snps that affect microarray hybridization using statistical models  <cit> . the equalizer package provides a general solution to this problem for the commonly used affymetrix gene expression microarrays. equalizer can be applied to any experiment performed on the affymetrix gene or ivt platforms where founder sequences are known, including humans. in this manuscript i compare equalizer’s results to the performance of a recently published method for identifying probe bias by statistical measurements  <cit> . i demonstrate the application of equalizer to microarray data generated for an eqtl study of mouse skin and mammary gene expression, as well as human lymphoblastoid cell lines.

the equalizer package makes several contributions. first, as it uses known genomic variants to identify probes affected by snps, it does not require expression measurements in replicate parental samples. such replicates are not available in human populations and may not be available in individual studies of model organisms. second, it can remove any probe that intersects a feature specified in a variant call format  file, and is not restricted to genes expressed in a particular tissue used to identify potentially affected probes. it is straightforward to prepare custom microarray annotations for any genome where variant information is available. third, while equalizer is fully compatible with bioconductor analysis tools, equalizer generates a new copy of the affymetrix array definition files and can be used by any analysis pipeline.

implementation
affymetrix microarrays report a probeset expression value summarized from an ensemble of probes. the location and probeset assignments are controlled during the normalization procedure by files available from the manufacturer. equalizer improves the signal quality in the presence of snps by selectively removing probes that intersect the snps from their probeset assignments . to create a modified affymetrix description file set, the user provides equalizer with the appropriate platform description files freely available from the affymetrix web site , including a bed-formatted file describing all probe locations. the user also provides one or more vcf files specifying the location of snps or other genomic features that may interfere with probe hybridization. equalizer then uses the bedtools package  <cit>  to identify probes which overlap with the location of a snp and a software script written in python to create a new set of internally consistent platform description files consisting of probesets where these probes have been removed. equalizer also produces a report indicating how many probes were removed from each probeset. if every probe in a probeset is removed by equalizer, the probeset itself is also removed from the new annotation files. the resulting files are suitable for use by any downstream normalization pipeline, including r’s oligo package  <cit>  or the partek genomics suite. equalizer can be invoked either from an r package  or by calling a python script from the command line. if called from the command line, equalizer produces an r script that can be used to create an r platform design information package.fig.  <dig> 
equalizer reduces snp eqtl bias. a schematic illustration of equalizer operation. b,c,d,e histograms of mean effect of a single mouse fvb/n allele, calculated from the difference of mean expression levels for a given gene when divided by genotype at eqtl locus. at any given eqtl all mice will be either homozygous  or heterozygous . a value greater than zero indicates mice homozygous for fvb/n alleles at that locus have higher expression levels. histograms plotted for b m <dig> uncorrected skin, c gene st uncorrected mammary, d m <dig> corrected skin, and e gene st corrected mammary



RESULTS
eqtl analysis with equalizer
genetic crosses between mouse strains with differing susceptibility to cancer are a useful tool for identifying genes which play a role in cancer biology. the goal of these studies is to map loci associated with gene expression and other phenotypes. the snp bias problem is particularly obvious in genetic studies of model organisms where the founder strains are not evolutionarily equidistant from the reference strain against which the microarray probes were designed. the inbred mouse strain mus spretus is separated by approximately two million years of evolution from mus musculus strains such as c57bl/ <dig>  the reference mouse genome strain. we have previously performed eqtl experiments using backcrosses of the mus spretus strain  and a mus musculus strain   <cit> . backcrossed mice were generated by breeding inbred mus spretus spret/ei animals with inbred mus musculus fvb/n animals to make an f <dig> generation, and then breeding f <dig> progeny with the fvb/n line. genotypes at any given locus on backcross chromosomes one through nineteen are therefore expected to be 50 % heterozygous  and 50 % homozygous .

analysis of published genome sequences for the strains fvb/n and spret/ei  <cit>  by equalizer indicated that of the  <dig>  probes on the affymetrix gene  <dig>  st array,  <dig>  intersected a spret/ei snp while only  <dig>  intersected a fvb/n snp. the imbalance between spret/ei and fvb/n snps was more extreme on the older mouse m <dig>  <dig>  chip; of its  <dig>  probes,  <dig>  intersected a spret/ei snp while  <dig>  intersected a fvb/n snp. probe-intersecting snps could therefore affect eqtl results for either parental genome, but were a priori more likely appear on the spret/ei genome at a ratio of more than 7: <dig> for gene st array or 10: <dig> for the m <dig> array. an unusually large number of cis-eqtl with lower expression associated with the spret/ei allele would strongly suggest technical bias due to probe hybridization artifacts.

to test equalizer i obtained  <dig> affymetrix m <dig>  <dig>  microarrays measuring gene expression in mouse skin and  <dig> affymetrix gene st  <dig>  microarrays measuring gene expression of normal mouse mammary tissue  <cit> . eqtl analysis of a backcross design tests all loci to determine whether animals heterozygous at a given locus show significantly different expression levels for a given gene compared to animals with a homozygous genotype at that locus. there are many phenotypic differences between mus spretus and mus musculus strains of mice  <cit> , but there is no reason to expect a priori that these macroscopic differences would be consistently associated either higher or lower expression of any particular gene when that gene is derived from a spret/ei allele. we therefore expect higher expression to be associated with the heterozygous eqtl allele 50 % of the time.

i identified eqtl in the skin and mammary datasets using a custom-written software package  that `performs linear regression for eqtl experiments . for each of the  <dig>  probesets the eqtl program tested the association between probeset expression and genotype variation at each locus, reporting the statistically strongest locus as a candidate eqtl. in the skin dataset, mice bearing a spret/ei allele at these loci had lower average expression of the eqtl probeset 76 % of the time . in the gene st dataset, 70 % of cis-eqtl had lower average expression for the spret/ei allele . as noted above, the expected value in both cases in the absence of snp bias was 50 %. after correction using equalizer, this analysis reported lower average expression for the spret/ei in only 57 % of genes in the m <dig> experiment and 53 % of genes in the gene st experiment .

after equalizer correction many eqtl significance values changed. in the mouse mammary data, after correction  <dig> of the  <dig>  probesets  decreased in statistical significance. however, considering only those probesets where the uncorrected eqtl result was significant at a fdr ≤  <dig> , 68 % of results decreased in significance after correction. genes with higher uncorrected statistical significance were significantly more likely to have reduced significance after correction, indicating that many of the strongest results were inflated by probe bias . however, a large number of loci also increased in eqtl significance after correction . this indicated that in many cases probe interference artifacts were reducing the statistical significance of eqtl effects. a typical example was the cis-eqtl for the gene cell division cycle  <dig> , which increased in statistical significance after correction from p =  <dig>  to p =  <dig> x 10− <dig> . nine of the original  <dig> probes for this probeset were removed by equalizer. the remaining three probes reported lower average expression levels than the original  <dig>  but these remaining probes should be free of snp bias and therefore a more effective tool for detecting eqtl.fig.  <dig> the effect of equalizer on eqtl results. a plot of the change in eqtl statistical strength after correction vs. the uncorrected eqtl statistical strength for mouse mammary data. b, c expression of cdc <dig> at the cis-eqtl locus  before correction and  after correction, showing an increase in significance after correction. expression levels are divided between homozygous  and heterozygous  genotypes, where fvb indicates fvb/n and spr indicates spret/ei. p values indicate linear regression, box and whiskers plots indicate median and first/third quartiles. d,e plot of the change in eqtl statistical strength after correction vs. the uncorrected eqtl statistical strength for,  human eur data and  human afr data. f,g expression of hla-dpa <dig> in human afr samples  before correction and  after correction, showing a decrease in statistical significance after correction. expression labels are divided between the aa, ab, and bb versions of the rs <dig> genome variant. plotted as 2b



many individual strains of model organisms have been sequenced, making it possible to have complete knowledge of the possible genotypes of their progeny. however, many human eqtl studies are conducted without exome or whole genome sequences of the participants. to test the applicability of equalizer to human samples where individual genome sequences may not be available, i identified snps with a minor allele frequency greater than 5 % in caucasian-derived  and african-derived  genome sequences obtained by the  <dig> genomes project  <cit> . this identified  <dig> , <dig> eur snps and  <dig> , <dig> afr snps. i then obtained microarray and genotype data measured in lymphoblastoid cell lines derived from  <dig> donors of european ancestry  and  <dig> donors of african ancestry   <cit> . of the  <dig>  probes on the hg-u <dig> plus  <dig>  array,  <dig>  overlapped a eur snp, while  <dig>  probes overlapped an afr snp. these numbers were dramatically lower than those in the mouse genome experiments, reflecting the relative proximity of human genomes to the human reference compared to that of the mice to the mouse reference. as expected from the overall larger number of snps in african-derived populations compared to caucasian-derived populations, african-derived samples had a larger number of probe-intersecting snps than caucasian-derived samples. i then separately corrected gene expression for caucasian-associated and african-associated snps.

in both afr and eur samples the observed eqtl effect sizes and the changes in eqtl significance after correction were smaller than those observed in the mouse samples . in a mouse genetic backcross there are only two possible genotypes, and the expected minor allele frequency is 50 %. in contrast, the minor allele frequencies in human populations varied from  <dig> to 50 %. however, removing probes which intersected snps still affected many cis-eqtl, and spurious snp-associated effects could be detected. hla-dpa <dig> is a member of the major histocompatibility complex, a highly polymorphic family of genes crucial for immune cell recognition and antigen recognition  <cit> . uncorrected gene expression profiles suggested a strong eqtl influencing expression of hla-dpa <dig> in african-derived samples , but this relationship was not present after removing the seven probes that intersected a snp .

comparison to other approaches
the maskbad algorithm recently published by dannemann and colleagues  <cit>  attempts to identify probes with snp hybridization problems through a statistical model applied to replicates of each founder strain. to compare equalizer to maskbad, i trained maskbad on previously published microarray measurements of mouse skin from four inbred fvb/n and four inbred spret/ei mice. maskbad was highly sensitive, assigning low quality scores to most probes bearing a snp, and high quality scores to most probes lacking a snp . as expected, probes assigned high probe quality scores by maskbad despite the presence of a snp verified by sequence analysis were more likely to be those reporting low expression levels . these probes would usually be eliminated from downstream analysis due to low signal quality. however, a significant minority of probes expressed above background levels and bearing snps would not be excluded by maskbad. figure 3c plots the number of above-background probes bearing or lacking known snps compared to their maskbad quality score. of the  <dig>  probes in probesets that were expressed above background levels,  <dig>   do not intersect a snp.  <dig>  probes  had a maskbad quality score above  <dig> . at this stringency level maskbad would remove  <dig>   probes that lack a known snp and retain  <dig>   probes that that bear a known snp.fig.  <dig> 
maskbad scores for probes kept or excluded by equalizer. a,b histograms of maskbad scores for probes that  intersect a snp and  do not intersect a snp in either fvb/n or spret/ei genomes. c number of probes in probesets expressed above background levels selected at maskbad quality scores ranging from  <dig> to  <dig>  plotted separately for probes with no snp in the probe  and probes with a snp in the probe 



discussion
equalizer significantly reduced the effect of snp bias, although the correction was not complete. it is plausible that the remaining deviation from the expected value of 50 % is due in part to the fact that this analysis corrected only for the presence of snps and did not account for other variants such as insertions, deletions, or germline copy number variations which could also affect gene expression levels. there are also large gene families such as the hair follicle keratins which may be expressed systemically at higher or lower levels in one species, and this would affect the predicted effect of a single fvb/n allele for those genes.

maskbad showed strong specificity and sensitivity if the correct quality score cut-off was chosen, and for situations where the required data are available to train its model, maskbad is a valuable tool. choosing a stringent maskbad quality cut-off would result in high sensitivity and specificity, but the best value for this parameter is hard to assess without the parental genome sequences. the effect of snps on probe hybridization is complex, and some snps which intersect a probe will have no detectable effect on probe hybridization. this is more likely to be true when snps are located near the end of a probe rather than near the middle. particularly in the case of genes with multiple isoforms, the effect of a given probe on the reported gene expression levels can vary between different tissues. a conservative approach which removes potentially compromised probes even if they are not obviously a problem in a particular tissue is therefore a reasonable choice. a future development step for equalizer will be to generate a version of the software entirely as an r package to avoid the requirement for calling a command-line script.

CONCLUSIONS
the equalizer package makes it straightforward to remove individual probes from affymetrix annotations by reading directly from vcf files describing genomic features such as snps which may affect cdna hybridization. this reduces prevalence of false-positive findings in eqtl mapping studies. importantly, this correction also increased the statistical significance of some eqtl, indicating that equalizer both reduced false positive signals and allowed results previously obscured by snp bias to be detected. equalizer provides a complementary approach to statistical methods such as maskbad, and it can be applied in situations such as human experiments where complete parental gene expression measurements are unavailable.

