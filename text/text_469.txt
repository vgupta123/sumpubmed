BACKGROUND
since the introduction of molecular-cytogenetic technologies for whole genome copy number aberration screening  <cit> , considerable advances have been made to work with a variety of sub-optimal material , both in the areas of dna preparation, labeling and platform technologies as well as in bioinformatic processing of the experimental read-out. however, dna copy number profiles from current microarray and sequencing experiments sometimes suffer from the presence of systematical “wave patterns”  <cit>  throughout the whole genome, where within each genomic segment the estimated copy number deviates from the true value which is supposed to be a constant. these wave artefacts disrupt the piecewise constant signal of the copy number data and may lead to false positives or negatives in identifying cnas.

one of the known causes to the wave artefacts is differential dna retrieval across chromosomal regions, which may be due to gc-content bias  <cit> , dna replication timing  <cit> , differences in chromatin organization during dna isolation  <cit>  and damages to the dna by fixation procedures  <cit> . copy number profiles with heavy wave artefacts sometimes can be corrected if certain requirements are met. marioni et al. developed a method to remove wave artefacts in copy number profiles for normal samples without obvious cnas  <cit> . wiel et al. suggested to eliminate waves in tumor profiles with many cnas using calibration profiles  <cit> . some methods correcting gc-content bias have also been implemented for microarray  <cit>  and sequencing experiments  <cit> . however, the methods proposed in these studies have a limited ability to remove wave artefacts or put many restrictions on the type and variability of the input data itself. in addition to wave artefacts, large derivative log ratio spread   <cit>  correlating with poor dna quality also leads to unreliable copy number profiles.

the limited ability of existing experimental and bioinformatic methods to remove wave artefacts or to correct for source dependent dna quality variations motivated us to devise a method for assessing if genomic copy number can be reliably estimated from a pre-processed, technology agnostic copy number profiling dataset. rather than developing a method for improving the sample derived copy number profiles themselves, our primary intention here is to provide measures for the contamination of copy number profiles through artefacts and thereby to support decisions regarding the suitability of these copy number profiles for downstream data analysis and interpretation.

zhang and zhang previously designed such a measure in an explorative study  <cit>  where they proposed using autocorrelation scanning profile  to evaluate data quality, and demonstrated on simulated data that the median of asp  can be used as a discriminative metric. however, it will be shown in the “discussion” section that medasp is not an adequate measure for real-world data of different scenarios.

in this paper, we assess the reliability of copy number profiles using a machine learning approach. from our experience and by experiment, we selected four features which are able to adequately represent the copy number profiles for reliability assessment, i.e. the number of steps that can be detected by the step-fitting algorithm in the copy number profile, a quantitative value indicating how much the copy number data is step-like, the number of segments induced by both cnas and wave artefacts detected by circular binary segmentation  <cit> , and the mean of dlrs within segments. we will explain in detail about these features in the “results and discussion” section and discribe the step-fitting algorithm by which the first two features are generated in the “methods” section. based on these features, we trained a classifier to predict the reliability of the copy number profile. we will describe the way of classifying reliable and unreliable profiles, and subsequently assigning them into one of the five subcategories each having a biological or experimental correspondence. our reliability assessment method can also be adapted to assess copy number profiles generated by those sequencing platforms from which copy number estimates could be computed as a piecewise constant signal.

RESULTS
piecewise constant model and segmentation
tumor samples often contain cnas, in which chromosomal segments are found gained or lost in copy number, deviating from the normal diploid status. genome-wide copy number can be depicted as a piecewise constant signal, where the change-points are the boundaries of the chromosomal segments that differ in copy number, and the constant value between a pair of change-points is the copy number of the corresponding segment. copy number profiling by microarray and sequencing techniques gives noisy estimates of the true copy number at specific genomic positions, which can be modeled as follows:

assume a series of n log ratio copy number estimates x={x
i:i= <dig> ,⋯,n} ordered by genomic position. the piecewise constant model for the series is 
  <dig> xi=μi+εi,i= <dig> ,⋯,n, 


where μ={μ
i:i= <dig> ,⋯,n} is a piecewise constant function and ε={ε
i:i= <dig> ,⋯,n} is a sequence of independent and identically distributed errors. assuming a series of m+ <dig> change-points τ={τ
j:j= <dig> , <dig> ⋯,m} where 1=τ
0<τ
1<⋯<τ
m=n+ <dig> delimit m segments with copy number level θ={θ
j:j= <dig> ,⋯,m} such that 
  <dig> μi=θj,i∈[τj− <dig> τj),j= <dig> ,⋯,m. 


the errors are usually assumed to be gaussian ε∼n and supported by experimental data on self-self hybridizations  <cit> , although this assumption is not crucial if the distances between successive τ
j’s are large  <cit> . the dlrs is denoted by σ and estimated by the standard deviation of the error ε.

segmentation is applied to recover the genomic position of the boundaries and the underlying copy number for chromosomal segments from the noisy copy number estimates. under the piecewise constant model, the segmentation problem is to find the change-points τ delimiting the segments and the copy number levels θ for each segment. if τ is known, θ
j can be estimated by the mean of the copy number estimates that fall in the j-th segment, that is 
  <dig> θj^=∑i=τj−1τj−1xiτj−τj− <dig> j= <dig> ,⋯,m. 


many segmentation algorithms have been proposed , among which the popular circular binary segmentation  algorithm  <cit>  was found to be one of the most accurate methods. starting with the whole chromosome, the cbs algorithm detects change-points delimiting a sub-segment with a different copy number level in the middle of a larger segment, and does it recursively until no more change-points can be found in any of the segments. for any interval [a,b) and 1≤a<b≤n, let the null hypothesis be that the log ratio copy number estimates x
a,x
a+ <dig> ⋯,x
b are independent and identically distributed gaussian and the alternative be that there is a sub-segment with different mean and same variance. cbs calculates the maximal t-statistic t=max
a≤i<j≤b|t
ij|, 
  <dig> tij=y¯ij−z¯ijsij−1+− <dig>  


where y¯ij=/, z¯ij=/, and sij <dig> is the corresponding mean squared error.

step detection and step-likeness quantification by step-fitting
ideally, dna is uniformly retrieved from the chromosomes during sample preparation, that is, the amount of dna retrieved is proportional to the true copy number of the chromosomal segments present in the cells. in this case, the log ratio copy number estimates contain only abrupt jumps which satisfy the piecewise constant assumption. however, in practice, due to gc-content bias  <cit> , dna replication timing  <cit>  and other biological phenomena such as differences in chromatin organization during dna isolation  <cit>  or damages to the dna caused by formalin fixation  <cit> , dna is sometimes retrieved differentially across the genome, which adds artefacts in the form of waves to the otherwise piecewise constant signal. these wave artefacts adversely affect detecting change-points which truly delimit the gained and lost chromosomal segments.

existing segmentation algorithms such as cbs are poorly suited to discriminate the change-points that are boundaries of the cna segments from those introduced by wave artefacts. when the magnitude of the waves are less than that of the cna signal, cbs leads to “hyper-segmentation”, in which many change-points caused by waves are detected in a single cna segment. in the worst case where the true copy number signal is buried in the waves with comparable or even greater magnitude, change-points detected by cbs largely depend on the wave artefacts and are no longer boundaries of the cna segments.

fortunately, in practice, cnas induce abrupt jumps which are visualized as steps and wave artefacts only induce gradual changes. as a result, for copy number profiles containing cnas, reliable samples are usually step-like, with few waves in each cna segment, whereas unreliable ones contain a lot of waves or the overall shape of the signal does not resemble steps any more. based on these observations we implemented a fast step-fitting algorithm of time complexity o adapted from the method originally proposed by kerssemakers et al.  to capture the step signal which are mostly cnas regardless of the change-points introduced by wave artefacts, and assess how much the copy number profile is step-like. see “methods” section for a detailed explanation about the step-fitting algorithm and the adaptation.

computer simulation: cbs versus the step-fitting algorithm
to demonstrate the differences between cbs and the step-fitting algorithm in detecting change-points,  <dig> groups of copy number profiles each containing  <dig> samples of  <dig>  dimensions were generated . group a are reliable copy number profiles containing many cnas; group b are unreliable copy number profiles in which the piecewise constant cna signal is buried in waves; group c are hyper-segmented copy number profiles in which many change-points caused by waves are present in a single copy number segment. see additional file  <dig> for details on how simulations were performed.
fig.  <dig> an example of simulated copy number profiles. samples of  <dig>  dimensions  were generated for  <dig> reliability groups, i.e. a: reliable copy number profiles containing many cnas; b: unreliable copy number profiles having indiscernible cnas due to wave artefacts; c: hyper-segmented copy number profiles. in group a, both cbs and step-fitting recovered majority of copy number segments well; in group b, both methods fitted noise and cbs detected more change-points than step-fitting; in group c, cbs detected too many change-points whereas step-fitting recovered majority of segments well


fig.  <dig> cbs versus step-fitting for  <dig> set of simulated copy number profiles. scatter plot of the number of segments detected by cbs  and step-fitting , plotted against the number of true cna segments. in group a, the number of segments recovered by cbs approximates true cna segments very well; the number of segments recovered by cbs is close to that of step-fitting. in group b, both methods fitted noise in which cbs found more change-points than step-fitting in general. in group c, cbs recovered much more segments than the number of true segments, whereas step-fitting found majority of cna segments well




the observation from fig.  <dig> can be generalized to the set of  <dig> simulated copy number profiles as shown in fig.  <dig>  for reliable copy number profiles in group a, the number of segments recovered by cbs is a very good approximation to the true cna segments , while step-fitting recovered majority of cna segments well except for those very short segments of low signal to noise ratio . for copy number profiles in group b containing heavy wave artefacts, both methods fitted noise. cbs recovered more segments than the number of true segments  and although in our simulation there is still correlation  as the waves introduced in different samples are of comparable size, the correlation is not expected in real data where the waves are of various size coming from different sources. furthermore, in group b, the number of segments found by step-fitting is largely less than cbs and independent of the number of true segments . last, for hyper-segmented copy number profiles in group c, cbs recovered far more segments than the number of true segments , whereas step-fitting found majority of cna segments well .

reliability assessment metrics
in this section we further develop the reliability assessment method on  <dig> previously published copy number profiles from different experimental batches and microarray platforms .
a to e shows copy number profile of a particular case segmented by cbs, and the lower panel shows the same copy number profile segmented by step-fitting in the optimal iteration when s
peak, the maximum value of s generated by the step-fitting algorithm was attained. the corresponding s values throughout iterations are plotted in fig. 3
f .
fig.  <dig> five example specimen of copy number profiles for each of the reliability groups. 3a: case  <dig>  hyper-segmented, discernible cnas with some waves; 3b: case  <dig>  reliable, discernible cnas with few waves; 3c: case  <dig>  unreliable, indiscernible cnas with heavy waves; 3d: case  <dig>  unreliable, large dlrs, undetectable cnas; 3e: case  <dig>  reliable, control sample or without many cnas. in each subgraph 3a to 3e, the upper panel shows the copy number profile segmented by the cbs algorithm, and the lower panel displays the same copy number profile segmented by step-fitting in the optimal iteration when s
peak was attained, where the red line is the fit and the blue line is the counter-fit. in fig. 3
f, s values are shown for the same five copy number profiles. for each curve the s-values for  <dig> iterations are shown. the geo accession numbers  <cit>  for the five cases are: case  <dig>  gsm <dig>  <cit> ; case  <dig>  gsm <dig>  <cit> ; case  <dig>  gsm <dig>  <cit> ; case  <dig>  gsm <dig>  <cit> ; and case  <dig>  gsm <dig>  <cit> 




in fig. 3
a to c, the performance of cbs versus step-fitting is consistent with that on simulated data in the previous section: in reliable copy number profiles , segments recovered by cbs are comparable to those from step-fitting; in unreliable copy number profiles with heavy wave artefacts  both methods fitted noise in which cbs found more change-points than step-fitting; in hyper-segmented copy number profiles  cbs detected a great many change-points within individual steps recovered by step-fitting, resulting in a higher number of cbs derived segments. an additional feature associated with reliability can be discovered by looking closer into the three cases in which both the reliable and the hyper-segmented copy number profile have clear step-like structures, while in the unreliable case the boundaries of the cna segments are much less defined. this property is reflected by the peak value of s: as shown in fig. 3
f, the hyper-segmented  and the reliable copy number profile  both attained relatively high s
peak whereas s
peak for the unreliable copy number profile  is much lower.

in fig. 3
d and e, no apparent cna exists or can be detected. the former is unreliable due to large dlrs so that the cnas, even if are present, cannot be detected properly, whereas the latter is a reliable control sample diploid across the genome. nevertheless, in both cases step-fitting merely fitted noise and the corresponding s values for case  <dig> and  <dig> in fig. 3
f increase throughout iterations yet remain close to  <dig> and no apparent peak can be observed.

so far we have discussed  <dig> features related to the reliability of copy number profiles, i.e. s
peak, an indicator of how much the copy number profile is step-like; l, the number of steps detected by step-fitting; v, the number of segments detected by cbs which could be induced by both cnas and wave artefacts; and σ, which is the dlrs estimated by the standard deviation of the error ε in eq. .

the full set of reliability assessment metrics is summarized in table  <dig>  where l and v combined represent the wave density.
s
peak
σ

s
peak quantifies how much the copy number data is step-like; wave density depends on two features l and v, where l is the number of steps recovered by step-fitting in the copy number profile and v is the number of change-points detected by cbs which could be induced by both cnas and wave artefacts; and σ is the mean of dlrs within segments




cnara: reliability assessment for copy number profiles
to turn the qualitative metrics into quantitative ones and therefore allow to predict the reliability of a given copy number profile, a support vector machine  classifier was trained on the  <dig> previously published copy number profiles labeled as reliable or unreliable by experts .

the  <dig> features s
peak, l, v and σ were extracted for each of the  <dig> samples and were used with the svm classifier. the svm function in the e <dig> r package  <cit>  which is the interface to the c++ implementation libsvm  <cit>  was called, where the cost was set to  <dig> and the radical basis function  kernel e
x
p was chosen in which the parameters were set by cross validation. tenfold cross-validation on the  <dig> training samples resulted in a total prediction accuracy of  <dig>  % with standard deviation  <dig>  . the extremely high accuracy suggests that the  <dig> features chosen can represent the copy number profile very well for reliability assessment. the resulted classifier can predict any new copy number profiles as reliable or unreliable in terms of whole-genome cna evaluation. for fine tuning of the methodology to particular sample compositions or evaluation goals, we have included the option to use user provided training sets .

for a copy number profile predicted as reliable, the value of s
peak tells if it has many cnas or not . usually control samples from normal tissues or samples without many cnas have s
peak≤t
h
r
 <dig>  while tumor samples containing cnas that we are interested in have s
peak>t
h
r
 <dig>  where t
h
r
 <dig> is a threshold with default value  <dig> .

copy number profiles predicted as unreliable can be further divided into  <dig> subcategories , by carrying out the following procedure: denote samples in the training set by ,l,v,σ) where i= <dig>   <dig>  ⋯,  <dig>  given any unreliable sample b=, create two dummy samples d
1=), σ) and d
2=)) by substituting v or σ by the minimum of the training set correspondingly, and predict the reliability of d
 <dig> and d
 <dig>  if d
 <dig> is reliable, b contains wave artefacts and therefore can be subcategorized as either case  <dig> or 3; if d
 <dig> is reliable, b has large dlrs and thus belongs to case 4; otherwise b suffers from both wave artefacts and large dlrs and can be either case  <dig> or  <dig>  as hyper-segmented samples in case  <dig> may still be of interest for certain tasks such as looking for cna regions but not counting the number or keeping track of the size of copy number gains or losses, a more stringent threshold t
h
r
 <dig> greater than t
h
r
 <dig> for s
peak could be set, for example, to accept those hyper-segmented samples having s
peak>t
h
r
 <dig> with caution where the default value of t
h
r
 <dig> is  <dig> .

discussion
a comparison between cnara and medasp
the performance of cnara and medasp  <cit>  was compared and shown in fig.  <dig>  the  <dig> samples were randomly split into training and validation sets at the proportion of 50: <dig> % and the svm classifier of cnara was trained on the training set where the parameters for the cost and the rbf kernel were set the same as in the previous subsection. the probability of being predicted as unreliable for each sample in the validation set was computed by the libsvm implementation  <cit>  and the median of asp was computed for the same sample in the validation set. the receiver operating characteristic  curves for the two values were then generated against the true class labels for the validation set.
fig.  <dig> cnara versus medasp. roc plots of cnara and medasp on the validation set. the  <dig> samples were split into training and validation sets  at random, and the svm classifier of cnara was trained on the training set. the auc of cnara is  <dig> , compared to the auc of medasp 




as shown in fig.  <dig>  the area under the roc curve  for medasp is  <dig> , which suggests that the assumptions made in the medasp study  <cit> , i.e. simulating copy number profiles with a gain and a loss region of fixed size, does not comform well with feature distribution in real-world data. by contrast, the auc of cnara is  <dig>  which is consistent with the extremely high prediction accuracy of the svm classifier stated in the previous subsection. the value approaching  <dig> once again implies that the  <dig> features chosen summarize the copy number profile very well in terms of its reliability.

custom training set
apart from the training set consists of absolutely reliable and unreliable copy number profiles, cnara is flexible to take in additional average quality samples labeled by experts to the training set to accomodate to their own need. for example, the boundaries of the cna segments for formalin-fixed paraffin embedded  samples are known to be less well defined than fresh-frozen samples in general  <cit> . therefore, when working with a large set of ffpe samples, one may wish to keep those slightly contaminated samples and reject others that are highly contaminated. to achieve this, people can create their own training set by including several slightly contaminated samples as reliable and highly contaminated as unreliable according to expert knowledge to the original training set .

CONCLUSIONS
during our efforts on the curation of human cancer copy number data from genomic screening experiments  <cit> , we have frequently encountered data sets challenging the state-of-the-art quality assessment procedures. while several methods have been proposed to improve the readout of genomic copy number profiling both through improvements of experimental design  <cit>  as well as application of advanced bioinformatic methods  <cit> , many data sets still contain artefacts that can not be removed sufficiently by these existing methods. as a result, when working with tens of thousands of genomic copy number profiles derived from a multitude of platforms and different pre-processing methods, a robust method capable of identifying the low quality data sets based on extractable features is needed.

previously, some downstream quality control measures such as genotyping call rate  <cit>  and derivative log-ratio spread   <cit>  have been reported for microarrays to describe the noise induced during sample hybridization onto the arrays. however, existing evaluation methods are limited in controlling for inherent noise due to differential dna retrieval across the genome during sample preparation, which is a severe problem in the generation of genomic copy number profiles, and therefore reliability assessment for copy number profiles remained an open problem. zhang and zhang previously did an explorative study  <cit>  where they proposed medasp as a discriminative metric for evaluating the quality of copy number profiles and achieved good accuracy on simulated data. however, it has been shown in the previous section that medasp is not an adequate measure for real copy number data which contains different amount of copy number gains and losses of various sizes at different genomic positions.

in this paper, we proposed a method for assessing the reliability of dna copy number profiles. we showed five typical cases each corresponding to one of the reliability groups that can often be observed in practice and discussed in detail about the  <dig> features which can represent the copy number profiles well in terms of reliability, namely the number of steps detected by step-fitting, an indicator of how much the copy number data is step-like, the number of segments induced by both cnas and wave artefacts detected by cbs and the mean of dlrs within segments. to obtain the first two features we proposed a fast step-fitting algorithm of time complexity o which is scalable to high-throughput copy number data. taking these  <dig> features as input, an svm classifer was trained on  <dig> samples labeled as reliable or unreliable according to expert knowledge. by tenfold cross-validation on the whole dataset, the resulting classifier achieved a total accuracy of  <dig>  % with standard deviation  <dig> . predicted samples can be further subcategorized into the five reliablility classes, each having a biological or experimental correspondence. to the best of our knowledge, this is the first application developed for real-world data filling the gap of controlling the quality problem regarding differential dna retrieval for copy number profiles, which is non-overlapping with and complementary to the objectives of any state-of-the-art quality control measures.

our method can be applied to log ratio copy number data before or after normalization. applied before normalization, it helps to judge if the log ratio copy number data needs normalization and noise correction; applied to the normalized data, it assesses the utility of the data in downstream analysis. nonetheless, since it evaluates an aspect of the quality different from any existing quality control measures, we suggest our reliability assessment method to be the last step after any possible downstream quality control and bias correction methods, to decide if the normalized sample can be finally included in data mining experiments for biomedical knowledge generation. we have to emphasize that, while our method can deliver information about the quality of the signal derived from whole genome copy number screening experiments, by itself it does not address problems arising from the possible clonal heterogeneity, e.g. in biosamples derived from cancer tissues. also, the impact of reliability assessment will depend on the intended downstream analyses; for instance, the reliability of whole-genome cna profiles, as determined by our method, may be of less concern when using statistical cna peak finding tools like gistic  <cit> .

thanks to the competing efforts on estimating genomic copy number from exome and whole-genome sequencing  <cit>  especially recent development of copywriter  <cit>  which is capable of extracting uniformly distributed copy number information from sequencing data, we are optimistic that in the near future piecewise constant signal for copy number estimates could be computed reliably with comparable acurracy to that of microarray platforms. due to the universality of our method in dealing with samples from different platforms and the flexibility in taking new training samples, at that time our reliability assessment method can also be easily adapted to those copy number profiles generated by sequencing platforms.

