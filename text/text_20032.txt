BACKGROUND
high-throughput analysis methods are commonly used in molecular biology. recently, high-throughput phenotyping has been introduced to capture phenotypical data in larger quantities. automated greenhouses, in which plants are grown and analysed automatically and images are taken in regular intervals, are the basis for high-throughput phenotyping for plants. image analysis software augments an observer's ability to evaluate plant phenotypes.

plants are the main source of human nutrition, increasingly meaningful for renewable resources and can provide ingredients that provide health benefits. plant research deals with questions such as which genetic information is responsible for the plants' characteristics in order to gain high yield, or stability despite the global warming and other stress situations.

to improve plant-breeding, numerous experiments for large plant populations grown under strictly controlled environmental conditions  are conducted. to determine the performance and the tolerance to different biotic and abiotic environmental conditions  phenotypes should be analysed non-invasively by imaging throughout their growth cycle.

for this purpose various fully automatic high-throughput plant growth and phenotyping platforms have been developed. a technology called phenopsis  <cit>  developed by optimalog is used by the french national institute for agricultural research  for arabidopsis thaliana. the research center jülich analyses phenotypes of different plant species with the in-house growscreen system  <cit> . both techniques use a camera which is moved over the plants. the company cropdesign developed the traitmill™ platform  <cit> , a high-throughput technology that enables large-scale transgenesis and plant evaluation of oryza sativa. this and the high-throughput phenotyping platform developed by lemnatec  <cit>  are fully automatic greenhouse systems that screen plants non-destructively over a period of time. lemnatec systems are, for example, used at the australian centre for plant functional genomics  and the leibniz institute of plant genetics and crop plant research  in gatersleben. as an example, the system at ipk gatersleben allows the growth of barley plants in  <dig> pots under controlled environmental conditions. each plant is located in a carrier which is situated upon a conveyor belt. the conveyor belt system automatically retrieves each plant as needed and passes it through the image capture units . in this system, plants are captured autonomously in near infrared-, ultra violet- and visible spectra in three boxes. each box contains a top view camera and a side view camera and furthermore a turnable lifter which enables the plants to be lifted and turned. after imaging, plants pass the watering and weighing unit, which automatically measures weights and waters the plants. since each carrier is tagged with an rfid chip each plant can be identified and traced during its growth cycle. an extensive amount of data is generated by the platform within a period of plant development. this data is stored in a database system.

high-throughput image analysis for automated phenotyping is used to extract several phenotypic parameters related to growth, yield and stress tolerance of the plants. in this manner the tedious and time-consuming manual analysis of many phenotypes is reduced. however, no freely available, open-source software for high-throughput image analysis is available, and commercial systems are limited. for example, the lemnatec system is delivered with the commercial software lemnagrid. this proprietary software with its built-in algorithms cannot easily be modified if desired, except for a limited set of parameters, and results of the standard pipeline for new plant species are often unsatisfactory.

there exists a clear need for robust, flexible and step by step traceable image analysis tools for plant phenotyping. in this study, we describe the imagej  <cit>  plugin htpheno, which is a freely available open source pipeline to handle image data from plants. it has been developed in a modular way to allow the analysis of images from different phenotyping sources. htpheno has been tested with the lemnatec system, as other phenotyping platforms were not available to the authors. however htpheno is a generalized image analysis pipeline which can be adapted by the user to other phenotyping systems and therefore be used by a wide community of plant scientists. it is also possible to record the images independent from automated phenotyping systems which acquire all images of the individual plants. if a laboratory would like to use the htpheno image processing pipeline the user could acquire images in a manual fashion as shown in figure  <dig> 

such a manual image acquisition consists of a commercially available standard camera with a camera tripod which is positioned in some distance to the plant to reduce perspective distortion. depending on the lens of the camera and its resolution the perspective distortion could also be reduced by a preprocessing step in the image analysis pipeline. the plant should be arranged on a table which is in front of a unicolour wall. in our experiments light blue showed a good colour choice as it is easily separable from colours in the plants. for an adequate illumination it is recommended to install a light sources above and on both sides of the plant. this setup enables the user to record images from different plants manually. images from such a manual and low cost system can also be the source for computation of phenotypic parameters by htpheno. to enable a versatile applicability of htpheno to different high-throughput phenotyping setups, we decided to follow a modular approach: several configuration files allow the adjustment of the plugin to the users' needs. with the htpheno plugin it is possible to retrieve single images or a series of images from the local file system and to automatically analyse the coloured images via colour segmentation. the phenotypic data is determined on the basis of the segmented plant: for the side view it is plant height, width and projected shoot area; for the top view it is x-extent, y-extent, projected shoot area and the diameter of the plant.

images are finally illustrated in an image stack and the phenotypic data are composed in a result table which can be exported into various spreadsheet applications to derive meaningful diagrams.

implementation
image analysis pipeline htpheno
there exist several tools supporting image editing, image processing and image analysis for many biological applications  <cit> . one popular tool is imagej  <cit> , a flexible, open source image processing software based on java. it comes with a graphical user interface and, with regard to scientific analysis, a collection of useful plugins and tools. besides platform independence, the main reason for the wide distribution of the imagej software is the extensibility via java plugins.

htpheno is such a plugin and provides an adaptable image analysis pipeline for high-throughput phenotyping. with two built-in functions,  the calibration  to specify different parameters for segmentation and  the automatic image processing, it can be used for analysing colour images in side view and top view. the htpheno plugin realises automatic image processing for a number of images involving steps such as: region definition, object segmentation, display of the object extraction, morphological operation and compilation of the analysis results . finally, analysis results for all plants are comprised in a table and processing steps for each plant are visualised in an image stack.

calibration of parameters for segmentation
segmentation, which specifies if a pixel belongs to a defined object or not, is the essential and critical step in image processing. a colour image segmentation approach consists of the monochrome segmentation approach operating in different colour spaces. some commonly used monochrome segmentation approaches are: histogram thresholding, feature space clustering, region based approaches, fuzzy approaches, neural networks or physics based approaches. they can operate in, for example, the following colour spaces: rgb, yiq, yuv, i1i2i <dig>  hsv, nrgb, cie l*u*v* or cie l*a*b*  <cit> . two fundamental questions arise in this context:

• which colour space is suitable for the recorded images?

• which segmentation method achieves a precise segmentation of the plant?

the colour image segmentation approach used here is multidimensional histogram threshholding: the histogram thresholding in combination of the two colour spaces rgb and hsv, which are appropriate colour spaces for images recorded by the high-throughput phenotyping platform.

colour space
based on the high correlation among the three primary colours red , green  and blue  colour image segmentation poses a challenge. if the brightness of the image changes due to changing or instable light conditions, all three colour components change accordingly. hence we decided to use additionally the hsv colour space which is more intuitive to human perception. it separates colour information from brightness information. the human vision system can distinguish different basic colours  easily, whereas the change of brightness  or purity of colour  does not imply the recognition of different colours  <cit> .

by using nonlinear transformation the hsv colour space can be derived from rgb colour space. this means a linear change in h, s and v does not result in a linear change of rgb parameters. therefore a slight change of input r, g, and b values can cause a large jump in the transformed h, s, and v values. due to nonlinear transformation hue has a non removable singularity and is numerically unstable at low saturation. if the intensity of the colour is close to white or black, hue and saturation play little role in distinguishing colours  <cit> . the hsv colour space alone is not sufficient for the segmentation of images recorded by the lemnatec facility. using a combination of rgb and hsv colour space results in a strong correlation of the calculated parameters obtained by htpheno with the manually measured values .

segmentation method
the irregular morphology of plants  restricts the development of a simple model which is at least necessary for the physics based segmentation approach. images from the high-throughput phenotyping platform often have non-uniform illumination with the consequence of colour similarity between objects  and inhomogeneity within one object. hence tests with an automatic segmentation method, the imagej plugin multi otsu threshold  <cit> , an implementation of the otsu threshold algorithm to find up to  <dig> optimal threshold level  of an image  <cit> , does not deliver the required thresholds.

the best choice under these preconditions is to use a pixel based segmentation approach called multidimensional histogram thresholding . it utilises gray values of pixels without considering the neighbourhood. an image consists of areas in different gray level ranges. these areas can be separated in the histogram of the image by means of thresholds. applied to colour images this approach operates in each colour channel histogram. an object is thus defined by a minimal and a maximal threshold for every channel of the rgb colour space and hsv colour space. to easily determine the thresholds for the object segmentation the function htpcalib was developed. images recorded by the high-throughput phenotyping platform contain beside the plant other objects. the user defines these objects by assigning them the correct colours in the image.

some objects have a colour similar to the plant. using this segmentation approach they would be segmented as plant as well. therefore segmentation takes place in user-defined regions for top view images and side view images. a known object can only be situated within its defined region. hence a set of regions can be defined. here five regions are defined for top view images  and three regions are defined for side view images  since the cameras are installed in a fixed position . once defined, regions grow and shrink automatically dependent on a user-defined scaling factor which depends on camera settings. also a factor to translate pixel size into millimeter is set in htpcalib.

after completing the calibration the automatic image processing for top view images and side view images can be applied.

image processing
htpheno retrieves single or series of images from the local file system and analyses automatically these images. each processing step is visualised by an image  first the original image is loaded , then the defined regions of the image are added  and after applying the object segmentation  a colour-coded image is shown .

before performing the next step in the analysis pipeline the object of interest  is extracted . the plant has no defined region since plant parts can be located anywhere in the image. some incorrectly segmented pixels and regions of the plant may occur because of colour similarity. to improve the segmentation of the plant the morphological operation opening is applied. opening solves the problem by performing erosion followed by dilation. opening removes small objects from the foreground  of an image, placing them in the background and then smoothes objects.

the resulting refined segmented plant has a lower noise level .

finally calculations based on the morphology result are performed. the visual analysis result is transferred to the original image and consists of plant outline; plant x-extent, plant y-extent and plant diameter ; plant width and plant height . to get an impression of the plant size a scale bar  is added to the image in the bottom right corner. all analysis steps can be checked by direct comparison of processed and non-processed images in an image stack per plant. a result table comprises all obtained phenotypic data: x-extent, y-extent and diameter in top view, width and height in side view as well as projected shoot area in both views for all plants. this result table can be exported into various spreadsheet applications for further processing.

RESULTS
analysing images from high-throughput screening experiments is time consuming and computationally demanding. high-throughput screening facilities produce thousands of images of plants per day and researchers are currently limited by the lack of open source software for automated high-throughput image analysis. the htpheno plugin for imagej  <cit>  is such an automated high-throughput software to analyse images and to detect characteristics of different plant phenotypes.

the tool analyses phenotypic parameters in a much shorter period of time than manual measurements. for example, measuring  <dig> plants at  <dig> different time points in side view and top view manually means to measure parameters from  <dig> images. obtaining parameters such as height and width in side view images and x-extent, y-extent and diameter in top view images takes  <dig> hours of manual work. using htpheno the same task can be accomplished in less than one minute on a state of the art desktop pc. during this process the software additionally calculates the projected shoot area. a manual measurement of this parameter implies great effort and needs more time.

validation
to validate the results produced by the htpheno plugin images of  <dig> plants were chosen from an experiment period which started at day  <dig> after sowing and ended at day  <dig> after sowing. different parameters were measured manually for comparison with the obtained parameters from the htpheno plugin . the x-extent values in top view images and the width values in side view images obtained by htpheno correlate strongly with the manually measured x-extent values and width values .

the mean values of all obtained parameters by htpheno deviate slightly from the manually measured parameters. the x-extent, y-extent and diameter in top view  and the width and hight in side view  are smaller than the manually obtained values. due to colour similarity between objects and the plant itself and because of shadows and reflexions htpheno currently cannot detect yellow and brown parts of the plant such as leaf tips. if these colours are defined as plant it may occur that parts of the soil and the cages are detected as plant parts too. therefore yellow and brown tones are currently excluded from the measurements performed by htpheno. this leads to an offset of the interquartile range below the base line and also to outliers. investigating the analysis results the outliers were particularly caused by leaf tips and brown and yellow leaf parts which could not be segmented as plant.

nevertheless there exists an outlier at day  <dig> after sowing in the deviation of width and height in the side view image above the base line. for example, the obtained width deviates more than  <dig> percent from the manually measured value. an investigation of the analysis results shows that reflexions at the pot and at a screw of the carrier are also segmented as plant. since this plant is very small at this developmental stage the deviation seems to be large. however, the absolute difference is small, the value calculated by htpheno is  <dig> mm and the manually measured value is  <dig> mm.

except for these outliers all parameters obtained by htpheno are in agreement with the manually measured parameters. altogether htpheno provides good results for the analysis of colour images taken from side view and from top view.

application example
the application example shown in figure  <dig> represents the comparison of different barley  cultivars. both cultivars barke and morex are precisely defined homozygous genotypes. barke plants are identical among each other and morex plants are identical among each other, but barke and morex do not correspond. they are  <dig>  percent genetically identical, but vary widely in morphological characteristics. the habitus of cultivar barke has semi-dwarfed growth and develops thin leaves. to compensate the semi-dwarfed growth barke plants tiller . morex plants by contrast grow higher and develop leaves with larger area .

to compare the fitness of these two cultivars with different treatments over a period of time the phenotyping platform took side view images of  <dig> plants per condition and cultivar.  <dig> of  <dig> barke plants and  <dig> of  <dig> morex plants were exposed to drought stress, the remaining plants were well watered during the experiment period. in this experiment images were taken from day  <dig> after sowing until day  <dig> and the drought stress period started at day  <dig> and ended at day  <dig>  all images were analysed by htpheno to obtain phenotypic parameters such as width, height and projected shoot area. the growth rate over a period of time measured at  <dig> time points is illustrated by average values of all plants per cultivar and condition and the standard deviation .

the average projected shoot area of cultivar morex is under both conditions larger. due to its morphology morex is tall and has widespread leaves occupying a great area of the images. barke tillers more and has many thin overlapping leaves occupying a smaller area of the images than morex. the standard deviation of morex under normal conditions is much higher than the one for barke. investigating the images it was observed that morex plants develop differently whereas barke plants develop more similarly. both cultivars have a smaller average projected shoot area under drought stress conditions.

the image analysis shows that the phenotypic parameter projected shoot area can be used to describe morphological differences between the two barley cultivars barke and morex as well as differences in growth under different conditions.

CONCLUSIONS
in this paper htpheno, a novel open source image analysis pipeline for high-throughput plant phenotyping, has been presented. this imagej plugin provides the possibility to automatically analyse the colour images taken from side view and from top view. with the calibration function htpcalib parameters of htpheno can be adapted to analyse other plant species recorded by a high-throughput phenotyping platform. in the application example we have shown that htpheno is a useful plugin for measuring phenotypic parameter, such as projected shoot area in top and side view of plants to distinguish different phenotypes.

we hope to inspire ideas within the phenotyping community for further development. researchers are welcome to download the java source code http://htpheno.ipk-gatersleben.de/ and add new analysis tools to the system.

availability & requirements
project name: htpheno

project home page: http://htpheno.ipk-gatersleben.de/

programming language: java

other requirements: java  <dig> or higher; imagej

authors' contributions
the software was designed and written by ah and rh. fs created the software concept. ns designed the biological study. ah, tc and fs evaluated the results. ah drafted the manuscript. all authors finalised and approved the manuscript.
