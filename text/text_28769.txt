BACKGROUND
hla loci on chromosome 6p <dig>  are one of the most diverse and polymorphic region in the human genome, and the imgt/hla database release  <dig> . <dig> currently containes  <dig>  allele sequences  <cit> . hla class i molecules present endogenous antigens to cd8+  t cells, whereas hla class ii molecules present exogenous antigens to cd4+  t cells  <cit> . hla matching of classical class i loci  and three of class ii loci  between a donor and patient lowers risks of acute graft-versus-host disease in unrelated haematopoietic stem cell transplantation  <cit>  or organ transplantation  <cit> . specific alleles of class i loci have been found to be associated with the rate of progression from human immunodefinciency virus type  <dig>  infection to the acquired immunodefiniency syndrome   <cit> . hla-dr and -dq loci have been found to be associated with autoimmune diseases, such as in type i diabetes  <cit> , narcolepsy  <cit>  and multiple sclerosis  <cit> . hence, a method to determine hla types accurately and conveniently is needed for both clinical practices and basic research.

conventionally, hla types have been determined at 2-digit resolution , which approximates the serological antigen groupings. more recently, sequence specific oligonucleotide probes  method has been used for hla typing at 4-digit resolution , which can distinguish amino acid differences  <cit> . currently, targeted dna sequencing for hla typing  <cit>  is the most popular approach for hla typing over other conventional methods. since the sequence-based approach directly determines both coding and non-coding regions, it can achieve hla typing at 6-digit  and 8-digit  resolution, respectively. hla typing at the highest resolution is desirable to distinguish existing hla alleles from new alleles or null alleles from clinical perspective  <cit> .

because of recent improvement and cost reduction of the next generation sequencers , several methods have been proposed to predict hla types from high-throughput sequencing data. seq2hla  <cit>  predicts 2-digit hla types from rna-seq data, but is not designed for 4-digit hla typing. hlaminer  <cit>  predicts hla types at 4-digit resolution based on the best alignment score of reads to the reference hla allele sequences, whereas the most recently proposed phlat  <cit>  predicts hla types at 6-digit resolution based on the likelihood score considering snp sites against reference sequences. since there exists uncertainty in read alignments to highly homologous hla allele sequences, accurate hla typing at high-resolution is still challenging.

we have developed a computational method, hla-vbseq, to estimate hla types effectively and accurately at 8-digit resolution from whole genome sequencing data. in the first step of the hla-vbseq pipeline, read sequences are aligned to the reference genomic sequences of the registered hla allelles in the imgt/hla database, in which multiple hits are allowed. then, hla-vbseq optimizes both read alignments to the hla allele sequences and relative quantities of reads on hla alleles simultaneously under a statistical framework by variational bayesian inference. our approach considers all the possible alignments of reads to hla allele sequences, and calculates the marginal likelihood of data from gapped alignments of reads to the reference sequences, in which deletions and insertions as well as snp sites are naturally considered. in our bayesian approach, an optimal set of hla allele sequences is estimated for accurate hla typing. we apply hla-vbseq to the simulation data of 5x, 10x, 20x and 30x coverage and compare prediction performance of our method with those of phlat and hlaminer. we also apply hla-vbseq to the whole genome sequencing data of a ceu trio to show the effectiveness of the proposed method.

methods
hla-vbseq pipeline
an overview of the hla-vbseq pipeline for estimating hla types is described in figure  <dig>  first, reads obtained by whole-genome sequencing are aligned to the reference genome  with decoy sequences  with an alignment tool, bwa-mem  <cit> . bwa-mem is robust to sequencing errors and can be applicable to read sequence lengths up to a few megabases  <cit> . second, reads aligned to hla loci  and unmapped reads are extracted from the bam file with samtools  <cit> . for the case of paired-end sequencing data, if one of the paired-end mates is aligned to an hla locus and the other is not, then both reads of the pair are extracted and used for downstream analyses. then, the extracted reads are re-aligned to the collection of all the genomic hla allele sequences in the imgt/hla database, in which multiple alignments to the reference sequences for each read are allowed with the "-a" option in bwa-mem. here, all the genomic dna sequences registered in the imgt/hla database release  <dig> . <dig>  including pseudogenes, are considered. for example, the numbers of registered genomic dna sequences for hla-a, -b, -c, - dqa <dig>  -dqb <dig>  and -drb <dig> are  <dig>   <dig>   <dig>   <dig>   <dig>  and  <dig>  respectively. finally, expected read counts on hla alleles are estimated by variational bayesian inference under a statistical framework for hla typing. details are described in the following sections.

optimization of read alignments to hla allele sequences
from the bam file constructed above, our goal is to estimate the most appropriate alignments of reads to the allele sequences, and to predict the most likely set of hla types at the same time. the generative model of read data used in hla-vbseq is described in figure  <dig>  in the statistical framework, an ambiguous alignment of the first and second nucleotide sequences of read n to the reference hla allele sequence t is treated as the hidden variable znt, where znt is an indicator variable and it takes one if read n is generated from allele t, and zero otherwise. read abundance  on hla alleles are treated as a model parameter θ. in the variational bayesian approach, model parameters are estimated as the posterior distribution. we use the dirichlet distribution for the prior distribution of the parameter vector θ

 p=1c∏t=0tθtαt- <dig>  

where c is a constant, ∑t=0tθt= <dig>  t is the number of hla alleles considered, and αt >  <dig> is the hyperparameter, which controls the complexity of model parameters. in our method, we use the uniform hyperparameter α <dig> and it is selected as a maximizer of the log marginal likelihood of the observed data.

our goal is to estimate the posterior distributions of θ given the data. however, this requires integrals over hidden variables and is intractable to compute in closed form. hence, we use variational bayesian  inference to obtain the approximation of the full posterior distribution by assuming the factorization of latent variables and model parameters  <cit> . in the variational bayesian e  step, for read n, an expected read count generated from the hla allele t is calculated based on the current estimate of the abundance parameter as rt^=∑nezznt= <dig>  in the variational bayesian m  step, the read abundance on each allele is calculated based on the current estimate of the expected read counts by eθθ^t=αt^/∑t′αt′^, where αt^=α0+rt^ each step is iterated until a convergence criterion is satisfied . update equations in each step can be calculated similarly as described in the previous work  <cit> .

hla typing from the optimized read alignment on hla alleles
after the inference algorithm converges, hla types are predicted based on the expected number of reads assigned to each allele. because there exist sequencing errors  and alignment errors, a threshold for the depth of coverage on hla alleles is set. in our analysis, we set the threshold as 20% of the depth of coverage . for each hla locus, a diplotype is decided as follows:

• if there is no allele that passes the threshold, then it is considered that there are not enough reads to identify a correct hla type, and hence no allele is called.

• if there is only one allele that passes the threshold, and the depth of coverage is more than or equal to twice as that of the threshold, then the hla locus is considered to be homozygous of that hla allele. if the depth of coverage is less than twice as that of the threshold, then the allele is called as heterozygous.

• if there are two or more alleles that pass the threshold, then alleles are sorted according to the depth of coverage from high to low. the top two alleles are selected as candidates of hla types. if the depth of coverage of the top one is more than twice as that of the second one, then the hla locus is set as homozygous of the top one. otherwise, the hla locus is predicted as a diplotype of the top and second one.

performance measure of hla typing
prediction performance is evaluated in terms of the prediction accuracy. in our analysis, the prediction accuracy is defined as the fraction of true positive predictions among the true hla types. in this simulation experiment, two hla alleles  for six hla loci , or  <dig> hla alleles in total, are evaluated for each individual. the prediction performance is evaluated separately at the 2-digit, 4-digit, 6-digit and 8-digit resolution for each method.

RESULTS
simulation data analysis
first, we evaluate the performance of predicting hla types with hla-vbseq compared to other methods in simulation data analysis. from the comparative study recently published  <cit> , we chose phlat and hlaminer as comparable methods that can type hla class i  and class ii  loci at 4-digit resolution from whole-genome sequencing data. we prepared the simulation data of  <dig>  human samples, whose hla diplotypes for the six hla loci were randomly chosen from the registered hla alleles in the imgt/hla database release  <dig> . <dig>  once hla types are fixed for each individual, one snp per  <dig>  bp is incorporated in the hla allele sequences for each individual, which is based on the average base diversity in the human genome  <cit> . then,  <dig> bp paired-end read data , whose mean and standard deviation of the fragment length distribution were set as  <dig> bp and  <dig> bp, respectively, are generated with  <dig> % substitution, deletion and insertion errors uniformly across hla allele sequences.

the accuracies of each method are calculated at 8-digit, 6-digit, 4-digit, and 2-digit resolution from the 30x simulation data. phlat only predicts hla types at 6-digit, 4-digit and 2-digit resolution, and hlaminer only predicts hla types at 4-digit and 2-digit resolution.

real data analysis
hla-vbseq was applied to the pcr-free whole-genome sequencing data of ceu trio samples, na <dig>  na <dig>  and na <dig>  the  <dig> bp paired-end data were generated with the hiseq <dig>  whose average insert size is  <dig> bp and depth of coverage is 45x for each sample . table  <dig> shows the summary of the predicted hla types of the ceu trio. the hla types for class i loci  estimated with hla-vbseq coincided with the experimentally validated hla types at 4-digit resolution   <cit> . notably, many of the hla types were predicted at 8-digit resolution with hla-vbseq. predicted hla types of hla-a, -b and -c loci with hla-vbseq were coincided with those with phlat at 6-digit resolution except b*07:02: <dig> . another literature also reported that one of hla-b alleles of na <dig> as b*07:02: <dig>  <cit> . instead, phlat predicted the corresponding hla type as b*07:02: <dig>  overall, hla types of the trio  predicted with hla-vbseq were more consistent than those with phlat.

predicted hla types of hla-a, -b, and -c loci with hla-vbseq were experimentally validated at 4-digit resolution in  <cit> , which is shown in bold text. predicted hla types of hla-dqa <dig>  -dqb <dig> and -drb <dig> loci with hla-vbseq were coincided with those with phlat at 6-digit resolution except dqa1*01:01: <dig> . phlat instead predicted them as dqa1*01:01: <dig>  whose genomic sequence was missing in the imgt database release  <dig> . <dig> , and hence hla-vbseq could not predict the hla allele in our experimental condition.

predicted hla types of hla-dqa <dig>  -dqb <dig> and -drb <dig> loci with hla-vbseq were coincided with those with phlat at 6-digit resolution except dqa1*01:01: <dig> . phlat instead predicted them as dqa1*01:01: <dig>  whose genomic sequence was missing in the imgt database release  <dig> . <dig>  and hence hla-vbseq could not predict the hla type in our experimental condition.

CONCLUSIONS
hla-vbseq is an efficient and accurate hla typing method using whole-genome sequencing data without the need of primer design for hla loci or prior knowledge of hla allele frequencies. although we have evaluated the prediction performance with hla-vbseq using the simulation data of various depth of coverage and real data of whole-genome sequencing data, other high-throughput sequencing data, such as from target-sequencing can be utilized with minor modifications in the pipeline. however, we should bear in mind that because of the complexity of hla loci and a fairly polymorphic nature of each locus, off-target sequences are often obtained by the target-sequencing approach, such as from pseudogenes  <cit> . as population-wide sequencing data becomes available, hla-vbseq can be easily applied for hla typing at any hla loci, which will be useful for association studies to identify links to phenotypes, as well as for clinical works such as donor-recipient matching. since the genomic sequences registered in the imgt/hla database are still not complete, there is room for improvement in predicting hla types with hla-vbseq in the future.

availability of supporting data
the implementation of hla-vbseq and the documentation is available in the website, http://nagasakilab.csml.org/hla

competing interests
the authors declare that they have no competing interests.

authors' contributions
nn and mn conceived the study, nn, kk, and mn designed the computational experiments, nn performed the analysis, and nn, kk, tm and mn interpreted the results. ss, ys, yk, yyk, and jy collaborated on data collection and interpretation of the results. nn, kk, tm, ys, yk, yyk, jy and mn wrote the manuscript. all the authors read and approved the final manuscript.

