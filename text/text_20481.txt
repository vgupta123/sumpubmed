BACKGROUND
rna secondary structures serve important functions in many non-coding rnas and cis-acting regulatory elements of mrnas  <cit> . they mediate rna-protein/rna-rna interactions in many different biological pathways and some even show enzymatic activity themselves. functional constraints lead to evolutionary conservation of the rna structure that in many cases can exceed the level of sequence conservation. therefore, conserved structures are characteristic evolutionarily signatures of functional rnas. most programs developed for the detection of novel functional rnas rely on these signatures.

qrna  <cit>  was the first program that detects conserved rnas. it models rna structure in a pair of sequences using a stochastic context free grammar. similarly, evofold  <cit>  models the structure of a multiple alignment taking into account a phylogenetic tree . alifoldz  <cit>  also analyzes multiple alignments. it uses, however, a thermodynamic folding model based on the rnaalifold algorithm  <cit> . all three programs fold and evaluate the conservation of the potential rna at the same time. as a consequence, their scores combine contributions of rna stability and conservation.

rnaz  <cit>  disentangles both contributions by calculating two separate scores for stability and conservation. the latter, dubbed structure conservation index , is thus a measure for structural conservation only. two other programs, msari  <cit>  and ddbrna  <cit> , are available that also calculate a pure conservation score.

in this paper, we revisit the problem and propose a series of other possible strategies to measure structural conservation and compare their performance on a large data set of structural rna families. the main motivation is to explore alternatives and possible improvements to currently applied measures, especially the sci used in rnaz. this study seems worthwhile, since comparative approaches like rnaz and others are starting to get extensively used to annotate rna structures on a genome wide scale  <cit> . at the same time, however, the increasing availability of additional sequence data makes it necessary to already reconsider and adapt these strategies. for example, while for the first prototype-screens in the human genome  <cit>  only  <dig> vertebrate genomes were available, we now face the challenge of analyzing alignments of up to  <dig> species  <cit> . while the signal from rna stability is important when only few sequences are available, more emphasis has to be put on the evolutionary signature in future screens. this might improve the specificity of the predictions, a major limitation of current algorithms  <cit> .

however, the results presented here are not only of relevance for comparative de novo ncrna prediction. the sci, for example, has also been used to measure structural similarity in a clustering approach to find new ncrna families within one species  <cit> . in principle, conservation measures of that kind could also be useful for general rna homology search algorithms that combine sequence and structure conservation  <cit> .

moreover, using a structure conservation measure on an alignment of sequences that are known to have a conserved rna structure can help to assess the quality of the alignment. this idea has been used to benchmark the performance of multiple alignment programs on structural rnas  <cit> , and more recently to detect mis-aligned sequences and assist in the semi-automatic improvement of rna alignments  <cit> .

finally it must be noted that assessing structural conservation, at the same time, means measuring change of rna structures throughout evolution. exploring different ways to quantify such structural changes can help inferring structure based phylogenies  <cit>  and might improve our understanding of rna structure evolution  <cit> .

methods for measuring structural conservation
structural conservation can be measured on different levels. in the following sections we describe  <dig> different methods that are based on  comparison of predicted minimum free energies ,  comparison of single structures,  comparison of ensembles of structures representing the whole folding space, and  the two specialized methods used by ddbrna and msari. a short summary of all methods is given in table  <dig> 

methods based on folding energies
the idea to evaluate structure similarity indirectly through the minimum free energy  rather than by direct comparison of the structure itself seems to be counter-intuitive at the first glance. the principle, however, becomes clear when considering the rnaalifold algorithm. rnaalifold implements a consensus folding algorithm for a set of aligned rna sequences. it extends standard dynamic programming algorithms for rna secondary prediction  <cit>  by averaging the energy contributions over all sequences and incorporating covariation terms into the energy model to reward compensatory mutations and to penalize non-compatible base-pairs. this procedure results in a "consensus mfe" for the alignment. the absolute value of the consensus mfe is of little value to assess the conservation of structures since it mainly reflects the folding energy that is heavily dependent on the nucleotide composition and the length of the alignment. therefore, the consensus mfe econs is normalized by the average mfe e¯single of the single sequences as computed by rnafold giving the structure conservation index

  sci=econs/e¯single 

if the sequences show equally stable folding energies if forced to fold into a common structure compared to being folded independently, this indicates a conserved structure and the sci is high. the lower bound of the sci is zero, indicating that rnaalifold is not able to find a consensus structure, while a sci close to one corresponds to perfect structure conservation. compensatory mutations adding additional bonus energies to the consensus mfe can even give rise to a sci higher than one.

the sci, as given above, requires the computation of a consensus structure for the whole alignment. alternatively, one can consider formulating a similar measure based on pairwise comparisons of all sequences. to this end, the folding energy of each sequence is evaluated when forced to fold into the structures of the other sequences. the pairwise sci for an alignment a is given by

  scirn aeval=∑x,y∈ax≠ye∑x∈ae 

where e denotes the free energy of sequence x when adopting the minimum free energy structure sy of sequence y, and n is the number of sequences in the alignment. the free energies for a given sequence in a given structure can be easily evaluated with the program rnaeval from the vienna rna package  <cit> . therefore, we refer to this method as the "rnaeval" method.

methods based on single structures
a more intuitive way to assess structural similarity is by comparing structures themselves rather than comparing the energies associated with these structures. conservation measures derived from various structure metrics are described in this section. unlike the energy based methods from the previous section that are inherently linked to thermodynamic folding, the following methods do not depend on the way of how structures are predicted. there are several different ways, like thermodynamic energy minimization  <cit> , kinetic folding  <cit>  or probabilistic models  <cit> , but the choice of the method will not influence the underlying concept. however, since the goal of this study is not to compare the accuracy of different folding algorithms, we use here exclusively energy minimization  to ensure comparability between all methods.

base-pair distance
the most simple distance measure between two sequences is the hamming distance, i.e. the number of positions with different nucleotides. for rna structures, one could think of calculating the hamming distance of two strings in dot bracket notation with the three characters "". however, this does not account for the correlations between the opening and closing positions that are characteristic for the structure.

an alternative to the hamming distance more suitable for secondary structures is the so-called base-pair distance. the base-pair distance between to rna secondary structures sx and sy is defined as the number of base-pairs not shared by the two structures. formally it can be described in terms of set theory, where the base-pair distance corresponds to the cardinality of the symmetric set difference:

  dbp=|∪|=|sx∪sy|−|sx∩sy|=|sx|+|sy|−2|sx∩sy|=∑i<j 

with δijx =  <dig> if  is a base-pair of structure sx, and δijx =  <dig> otherwise. dbp itself is not a suitable measure for comparison as long it is not set in relation to the union of the base-pairs in sx and sy. the normalized base-pair distance scaled to the interval  <cit>  between two structures is given by

  dbp=|sx∪sy|−|sx∩sy||sx∪sy|=∑i<j∑i<j 

the overall score for a multiple alignment a can either be calculated as the average of all pairwise sequence comparisons

  2n∑x,y∈ax>ydbp 

or as the average of all comparisons of each sequence to a consensus structure

  1n∑x∈adbp 

if not stated otherwise, also all other methods that are based on pairwise comparisons can be calculated either as the average over all n/ <dig> pairwise comparisons, or the average of all n comparisons to the consensus structure.

mountain metric
the mountain metric is based on the mountain representation of rna secondary structures  <cit>  and follows the idea that the distance between two structures sx and sy can be expressed as the difference of the two mountain graphs. for this purpose, a lp-norm can be defined that induces a metric dmp on two secondary structures sx and sy as the difference of the two mountain functions m and m  <cit> :

  dmp:=||m−m||:=−mk|p)1p 

the mountain function mk is defined as the number of base-pairs enclosing position k. the effect that base-pairs are weighted differently can be overcome by scaling each base-pair to the range it spans.

  mk=∑i<k∑k<j1j−i− <dig> 

as dmp is expected to grow with the length of sequences, we are in the need of defining a normalized distance measure to be able to compare distances for sequence pairs of different length. the maximal distance of a secondary structure smax on a sequence of length n to the open chain sopen is obtained if smax is a stem of maximal height /2⌋), which is a hairpin loop enclosing three unpaired bases. the normalized mountain metric dmp is then defined as the ratio of the distance dmp  of two secondary structures with length n to the maximal distance dmp  at length n:

  dmp=dmpdmp 

tree editing
rna secondary structures can be represented as ordered, rooted trees  <cit> . the tree representation can be deduced from the dot-bracket notation " correspond to the 5' base and the 3' base in the base-pair, respectively, while "." denotes an unpaired base), as the brackets clearly imply parent-child relationships. the ordering among the siblings of a node is imposed by the 5' to 3' nature of the rna molecule. to avoid formation of an unconnected forest of trees, a virtual root has to be introduced.

the tree representation at full resolution without any loss of information with regard to the dot-bracket notation can be derived by assigning each unpaired base to a leaf node and each base-pair to an internal node. the resulting tree can be rewritten to a homeomorphically irreducible tree  by collapsing all base-pairs in a stem into a single internal node and adjacent unpaired bases into a single leaf node  <cit> . each node is then assigned a weight reflecting the number of nodes or leaves that were combined.

shapiro proposed another encoding that retains only a coarse-grained shape of a secondary structure  <cit> . this is useful in the case of comparison of major structural elements of a rna molecule but it comes along with a loss of information . a secondary structure can be decomposed into stems , hairpin loops , interior loops , multi-loops , and external nucleotides . while external nucleotides are assigned to a leaf, unpaired bases in a multi-loop are lost. the weighted coarse-grained approach compensates the effect of information reduction at least by assigning to each node or leaf the number of elements that were condensed to it.

tree editing induces a metric in the space of trees and hence a metric in the space of rna secondary structures. an edit script, which is a series of edit operations, namely deletion, insertion and relabeling of a node, each assigned a cost can transform any tree tx into any other tree ty. the distance between two trees d is then defined as the cost of the edit script with minimal cost. normalization of the tree editing distance is done by comparing the distance of two trees d to the sum of the costs of deleting either of the two secondary structures, where • denotes a tree consisting solely of a root:

  dt=dd+d 

among the methods used here, tree editing is the only one that can act on structures of unequal length. in this work we will focus on two different implementations of tree editing. rnadistance  <cit>  a tool from the vienna rna package implements a tree editing algorithm initially proposed by shapiro  <cit>  and acts on the full representation, hit representation  <cit> , coarse-grained and weighted coarse-grained representation  <cit> . allali & sagot  <cit>  pointed out some shortcomings of the classic tree editing operations and introduced novel editing operations called node-fusion and edge-fusion, implemented in the program migal. migal uses a new concept of encoding trees at different levels of abstraction called layers  <cit> , which are interconnected to each other via vertex coloring operations.

methods considering the entire folding space
distance of structure ensembles
because the stabilizing energies of base-pair formation are in the same energy range as the thermal energy, rna molecules in physiological conditions are far away from being caged into one rigid secondary structure. instead, one usually observes an ensemble of rna structures, which can be represented by an energy weighted boltzmann distribution. mccaskill proposed a dynamic programming algorithm  <cit>  that allows to efficiently compute the partition function q, where Δg is the conformational gibb's free energy change, r is the gas constant, t is the absolute temperature, and s is the ensemble of possible secondary structures.

  q=∑s∈se−Δgrt 

the probability of a single structure s is then given by

  p=e−Δg/rtq 

and hence the probability of a single base-pair  is

  pij=∑s∈spδijs 

where δijs is one if  is a base-pair of structure s, and zero otherwise. using these assumptions the equation of the base-pair distance can be remodeled to calculate the average base-pair distance 〈dbp〉 between all structures of the two ensembles sx and sy.

  〈dbp〉=∑sx∈sx∑sy∈sy=∑i<j=∑i<j=∑i<jpijx+pijy 

as one can see in the last line, this corresponds to the the naïve approach of multiplying the probability of the base-pair  in the ensemble sx with the probability of not expecting the base-pair  in the ensemble sy and vice versa. taking a closer look at equation  <dig>  one can see that the distance between the structure ensemble of one sequence ⟨dbp⟩ is not zero. instead, it is the average distance between the structures in the ensemble, referred to as ensemble diversity. as we are interested in the distance between two ensembles, one has to subtract the average of the ensemble diversities to ensure identity and symmetry. the ensemble distance densemble between two ensembles sx and sy is then defined as follows:

  densemble=〈dbp〉−12〉+〈dbp〉)=∑i<j−12∑i<j−12∑i<j=∑i<j=∑i<j <dig> 

the result, which is simply the sum over the squared differences of the pair probabilities, is a very intuitive distance measure of two ensembles. note that this measure is not a metric since the triangle equation is not fulfilled. however, densemble is a metric, as it corresponds to the euclidean distance between two vectors.

also the mountain metric approach previously discussed can be readily extended to incorporate base-pairing probabilities  <cit> . the mountain function mk gives then the number of base-pairs that are expected to enclose position k on average:

  mk=∑i<k∑k<jpijj−i− <dig> 

distance of one dimensional pair-probability vectors
another method to compare the folding space of two rna sequences is by aligning one dimensional base-pairing probability vectors  <cit> , as implemented in the program rnapdist. from all base-pairing probabilities of base i the probabilities of being paired downstream , paired upstream , and unpaired  are computed:

  pi<=∑i,jpijpi>=∑i>jpijpio=1−pi<−pi> 

in this study we use a rnapdist-like variant drn apdist as a distance measure for a precomputed alignment of two sequences x and y as follows:

  drn apdist=1l∑ilδi 

where l is the length of the alignment and δ given by

  δ={1−pi<pi<−pi>pi>−piopioaligned position0inserted or deleted position 

abstract shapes
giegerich et al.  <cit>  introduced the concept of abstract shapes, coarse-grained abstractions of full secondary structures. the current implementation of rnashapes offers five levels of abstraction and partitions the folding space into structural families represented by the different shapes. the probabilities for shapes are calculated by summing up the probabilities of all structures that are assigned to the same shape  <cit> .

a pairwise similarity measure s comparing two shape spaces sx and sy can be defined as follows, where p and p is the probability of shape s given sequence x and y, respectively.

  s=∑s∈sx∪sypp 

other methods
one key characteristic of conserved structures are compensatory mutations. compensatory mutations that maintain the secondary structure will accumulate as this helps keeping the rna molecule functioning. while all methods described so far include structure predictions and only indirectly depend on such compensatory mutations, di bernardo et al.  <cit>  proposed a method that is solely based on the existence of compensatory mutations. ddbrnacounts compensatory mutations in all possible stem loops in all sequences of an alignment without making use of a folding model of any sort. in this paper we will use the number of compensatory mutations per length that is calculated by ddbrna as measure for structural conservation.

coventry et al.  <cit>  follow with their msari algorithm a similar but more elaborate strategy than that of ddbrna. decision about structural conservation is made upon statistical significance of short, contiguous potential base-paired regions. the partition function implementation of rnafold is used to predict base-pair probabilities. each base-pair  with a base-pairing probability higher than 5% is then examined individually. for each sequence in the alignment a window of length seven is centered on nucleotide i and compared with a series of windows centered around j ± { <dig>   <dig>  2} . the window pair with the maximal number of reverse complementary positions is chosen for further analysis, which is the evaluation of the probability of seeing at least as many compensatory positions against a null-hypothesis distribution for random mutations. the estimation of the significance of observed base-pairs is then used to assess the total significance of the alignment.

the main interest of this paper is to detect structural similarities in a given alignment. clearly, the problem of calculating the alignment and detecting a conserved structure is closely related. for example, structural alignment algorithms based on the sankoff algorithm  <cit>  can be used to detect conserved structures  <cit>  or homologues of a given structure  <cit> . aligning sequences requires a notion of sequence similarity and, therefore, sequence substitution models of rnas have been developed. examples are the ribosum matrices for the homology search program rsearch  <cit>  or a specifically parametrized general time reversible  model for its <dig> sequences  <cit> . we do not cover methods here that are primarily focused on the alignment problem, such as sankoff based algorithms, nor methods that combine sequence and structure comparison such as the family of edit distances on arc annotated sequences by zhang and coworkers  <cit>   or tree alignment as implemented in rnaforester  <cit> . if used with a sequence weight of zero, we would expect these methods to give similar results to the rnadistance tree editing. liu & wang  <cit>  recently proposed a method for rna secondary structure similarity analysis based on the lempel-ziv compression algorithm. however, since the authors do not provide an implementation of their method it could not be considered in this study.

benchmarking
to assess the performance of the various methods to detect conserved rna structures in multiple sequence alignments, we conducted a comprehensive benchmark on the bralibase database version  <dig>   <cit> . this database provides a reasonable sized data set of homologous rnas of different families. in addition to the structural alignments provided by the database we generated for each alignment a corresponding sequence-based alignment using clustal w  <cit> .

despite their shortcomings, pure sequence based alignments represent a more realistic scenario because structural alignments are not always available in real life situations . there are many structural alignment programs available. as mentioned before, the problem of structural alignment and finding structural similarities is closely related. however, we do not want to compare the efficiency of different alignment programs and thus stick with the two extreme cases of purely sequence based alignments and manually curated reference alignments. at this point we want to mention, that our results might be interesting for some of the alignment algorithms. for example, the heuristic algorithm of cmfinder  <cit>  uses a distance measure based on tree editing in one of the first alignment steps.

as a negative control of alignments that do not harbor a conserved structure we randomized each alignment of the database by shuffling. the procedure is described in detail in reference  <cit> . it is as conservative as possible and keeps the most relevant alignment parameters like base composition, conservation patterns, gap-patterns etc. intact while any correlation arising from the original structure is efficiently removed.

the sensitivity to detect a conserved rna structure depends on the sequence variation in the alignment. it is difficult to detect any signature of a conserved structure in alignments with high sequence identity. the more sequence changes in the alignment the more information is available. the overall "information content" is thus dependent on  the divergence of the sequences and  the number of the sequences in the alignment. a common measure describing sequence variation in a multiple sequence alignment is the average pairwise sequence identity . although this measure is widely used, it is only capable of assessing sequence variation, and does not take the number of sequences of the alignment into account. we found it helpful to use a combined measure for the content of evolutionary information for presenting the results of our analysis. we used the normalized shannon entropy h. in the case of alignments of rna sequences we are dealing with an alphabet Σ = {a,c,g,u,-} composed of the four nucleotides plus the gap character "-". the probabilities are approximated by the observed frequencies . the normalized shannon entropy of an alignment a is then defined as the sum of the shannon entropies of the individual columns divided by the length of the alignment denoted by l:

  h=−1l∑il∑j∈Σpjilog⁡2pji 

although it is convenient to use this measure, most people are more familiar with the api. fig.  <dig> shows the relation of the api and the shannon entropy for alignments with different number of sequences.

in order to assess and compare the performance of the various strategies, we perform receiver operating characteristic  curve analysis. a roc curve  <cit>  is a plot of the true positive rate  versus the false positive rate , while varying the discrimination threshold of a scoring classifier. the more a roc curve is shifted to the upper left corner of the plot, the better the discrimination is. the area under the roc curve  is a single scalar value ranging from  <dig> to  <dig> representing the overall discrimination capability of a method. a random classifier has an auc value around  <dig> , while perfect classification is indicated by an auc value of  <dig> 

RESULTS
overview
the results of the benchmark are summarized in tab.  <dig> and fig.  <dig>  the test set was binned by entropy and for each bin we calculated the average auc as overall performance measure for each method. in table  <dig>  we additionally give the sensitivity of each method for a given specificity of 95%. in other words, this number is the percentage of correctly identified conserved structures at a false positive rate of 5%, a somewhat more practical measure than the auc. almost all methods can be applied in a pairwise comparison manner and as a comparison of single structures to a consensus structure/energy. we will simply refer to these cases as 'pairwise' and 'consensus'.

low, medium and high refer to the same information content categories as shown in fig.  <dig>  each column consists of two numbers: left: average auc, right: sensitivity at 5% false positive rate. bold numbers indicate the most accurate method in each category.

as a main result one can note that over all entropy ranges and for both the structural and sequence based alignments, either an energy based method  or the base-pair distance performs best. these methods are followed by the tree editing methods based on rnadistance. migal based tree editing, mountain metric and ensemble methods perform significantly worse.

sci/rnaeval and base-pair distance
in general, the sci shows the best overall discrimination power on the structural alignments. on the medium and high entropy sets it apparently makes use of the large number of consistent/compensatory mutations that are explicitly considered in the sci through the rnaalifold consensus energy that contains a covariation score. the use of the covariation scoring model in rnaalifold does improve the discrimination capability of the sci significantly compared to a version where the covariation score was turned off .

only on the low entropy set that contains highly conserved alignments with little evolutionary information the sci is outperformed by the rnaeval and base-pair distance measures. in cases with only a few structural changes, the base-pair distance, which considers the exact position of pairs, seems to be more sensitive than the sci that uses the folding energy as abstraction of the structure.

interestingly, the clear winner in the low entropy set is the rnaeval method that, similar to the sci, also uses the folding energy instead of the structure itself. still, it performs significantly better  than the sci. the sci and the rnaeval approach operate on two different scales. while the sci is bounded below by  <dig>  the rnaeval approach is bounded above by  <dig>  which causes favoring of two extreme cases. in the case of the sci an alignment with loads of compensatory and consistent mutations will yield a sci above  <dig> due to the covariance score. the rnaeval approach will give at most  <dig> as compensatory and consistent mutations are not specially rewarded. in the case of an alignment of sequences that do not share a common fold the sci will be  <dig>  while the rnaeval approach will yield a value below  <dig> as the evaluation of a sequence forced to fold into a structure that is not likely to be adopted by that sequence will give positive energy values. hence, in the case of the sci we are dealing with a better dispersion of positive examples, and vice versa in the rnaeval approach with a better dispersion of negative examples.

the overall trend looks slightly different on the clustal w generated alignments. the sci loses discrimination power and the base-pair distance performs equally well or, in most cases, even better. so it seems that the base-pair distance is more robust against alignment errors than the sci.

another difference between the results for the structural and clustal w sets is the overall shape of the curves in fig.  <dig>  for the structural alignments, the classification power increases with increasing information content. this trend is of course entirely expected, and it is also visible for the clustal w alignments. however, there are two marked valleys at about  <dig>  and  <dig>  shannon entropy. the first one is caused by a prevalence of pairwise alignments with low sequence identity. an average pairwise identity of 60% to 65% or below is considered as critical with regard to secondary structures for alignments generated solely on sequence information  <cit> . this results in a relatively low discrimination capability in this region. as soon as low identity pairwise alignments do not constitute the majority of instances in a bin, the predictive power rises again. the second performance drop is again caused by prevalence of alignments with low sequence identity, in this case alignments with three sequences.

tree editing
the best tree editing approach , in general shows weaker performance than the sci on both the structural and the clustal w generated data sets. detailed results for all tree editing methods are shown in fig.  <dig>  there is a clear hierarchy among tree editing approaches. an abstraction of structural details in the representation is accompanied with a loss in discrimination power, which is especially well pronounced on the structural data set. tree editing using the full and hit representations, which encode a rna secondary structure without any loss of information, give best results, while the coarse grained approach which is abstracting at most shows the weakest performance.

the weighted coarse-grained approach maintains a higher level of structural information than the coarse-grained representation and therefore generally performs better. the use of different costs for the tree editing operations has significant influences on the discrimination power of the methods. tree editing distances of the coarse-grained and weighted coarse-grained representations were calculated using the cost matrix of the vienna rna package and the costs initially proposed by shapiro  <cit> . although the editing costs are in both cases chosen more ore less arbitrarily, the weighted coarse-grained approach using the vienna rna package costs performs significantly better or at least equally well on both structural and clustal w generated alignments than the weighted coarse-grained approach using shapiro's costs .

as migal makes use also of the nucleotide sequence and not secondary structures alone, we evaluated migal only in pairwise comparisons. also for the migal methods, we observe the trend that the more information is encoded in a representation or layer, respectively, the better the discrimination capability. however, despite its more sophisticated algorithm, migal performs worse than the simpler tree editing algorithms of the vienna rna package.

tree editing is the only method that can be applied per se to sequences of unequal length, and is hence not subjected to the alignment quality. this seems to be an advantage of this method. however, this only holds for pairwise comparisons as the calculation of a consensus structure is dependent on a given alignment. since the consensus approaches show much better performance than their pairwise counterparts on structural alignments, and at least comparable results on clustal w generated alignments, the advantage of alignment independent pairwise comparisons is questionable.

mountain metric
the mountain metric shows the weakest performance of all methods that are based on single structures. this trend becomes even worse when using base-pairing probabilities. although the mountain representation allows easy comparison of rna structures by visual examination, when put to formalism by the mountain metric this approach fails. the weak performance indicates that the difference in the mountain functions of closely related rna molecules is in many cases in the range of differences one obtains by comparing non-related structures.

ensemble methods
in principle, secondary structure predictions that take into account the whole thermodynamical ensemble of the folded rna hold more information than the mere mfe structure. however, we observe that this does not translate into improved detection performance of conserved rna structures . the ensemble distance shows only moderate performance on structural alignments, and fails completely on clustal w generated alignments. it seems that taking into account sub-optimal base-pairs only adds noise to the comparison and blurs the signal instead of improving it.

the extreme sensitivity to alignment errors can be explained by the fact that each probability of each possible base-pair of one sequence has to be compared to the corresponding probability of the other sequences or the consensus, respectively. a base-pair present in one ensemble that does not have a counterpart in the other ensembles adds its full squared probability to the distance.

the rnapdist-like methods show best overall performance of the ensemble based methods. this is consistent with the observations above, since the rnapdist method only considers a condensed and thus lessnoisy version of the full pair-probability matrix.

consensus versus pairwise comparison
in general, one can observe that methods based on the comparison to a consensus structure perform better than methods based on pairwise comparisons only. the consensus structure predicted by rnaalifold which is usually more accurate than single structures prediction, improves the discrimination power significantly. there are two exceptions: in the case of the ensemble methods and in the low entropy test-set, the trend is reversed with pairwise methods performing better than their consensus variant.

in the case of the ensemble methods, this is apparently due to the way base-pairing probabilities are calculated by rnafold and rnaalifold. for single sequence there are no special rules for two bases to form a base-pair, they just have to belong to the set of valid base-pairs. rnafold can therefore assign a base-pair probability to each valid base-pair. on the alignment level this is more complicated as we are dealing with columns of nucleotides rather than with single nucleotides. in the rnaalifold algorithm, only those column pairs in which at least 50% of the sequences can form a base-pair are used in the computation. in the case of the consensus comparison approach there may be many base-pairing probabilities in the single sequences that do not have a consensus counterpart.

also in the low entropy range, which is dominated by alignments with little sequence variation, pairwise comparison approaches show better discrimination capability than their consensus counterparts. here, there is almost no additional mutational information that could give rnaalifold an advantage over rnafold on single sequences.

other methods
as both ddbrna and msari show limitations to the data sets that can be applied, we evaluated both methods only on appropriate subsets of our test set. in case of ddbrna these are pairwise and three-way alignments, and in case of msari 10-way and 15-way alignments.

in this study we use ddbrna to evaluate the number of compensatory mutations per length as a measure of evolutionary conservation of structure. the ddbrna approach shows only moderate discrimination capability and performs significantly worse than the sci on both structural and clustal w generated alignments . ddbrna is extremely sensitive to the alignment quality as the detected stems must be present in all sequences of an alignment.

as msari implements a strategy that compensates slight mis-alignments, the results are almost identical for structural and clustal w generated alignments, but it shows significant lower discrimination capability than most other methods tested in this paper, e.g. the sci as shown in fig.  <dig>  the shape of the roc curves for msari indicates that only a few conserved instances are detected as truly conserved. they are assigned very low p-values and it is not likely to find false positive examples at this low level. however, a large fraction of conserved instances is not considered to be conserved and is assigned a p-value of  <dig> 

due to the exponential growth of the shape space with the length of the sequence and the resulting computational costs, we evaluated the rnashapes approach as a proof of concept only on a small set of trnas. although this method shows clear discrimination capability, it is far below the performance of the sci which is able to perfectly separate this specific trna test set . the observation that the shape type  <dig>  performs significantly better than the shape type  <dig>  is consistent with the observations that increasing abstraction of detailed structural information is related to a loss in discrimination power.

correlation of methods
we have tested a variety of different methods in order to measure the same property, namely structural conservation. a question that is still open is whether all these methods essentially detect the same features or focus on different aspects of the conserved structures. to get some clues on this question, we investigated the correlation between selected measures . all methods correlate statistically significantly  with each other on the tested subset. the degree of correlation varies, however. not surprisingly, among the highest correlations  are the two tree editing methods using the hit representation and migal layer  <dig>  as they act both on trees of full structural detail. the base-pair distance is also highly correlated with the tree editing methods. the sci shows the highest correlation to rnaeval , which again does not come unexpected, as both measures are based on folding energies. however, the relatively high degree of correlation between sci/rnaeval and the other methods is remarkable. rnaeval, for example, has the same degree of correlation to the pairwise base-pair distance  as the pairwise base-pair distance to the pairwise rnadistance measure. this shows that also sci/rnaeval, methods that actually do not regard the structure, effectively measure it. this seems noteworthy, as the name "structure conservation index" has been criticized in the past of being misleading because the sci does not measure structural conservation explicitly.

dependence on base composition
all scores used in this study are normalized with respect to sequence length and the number of sequences in the alignment. in principle, all our methods should also be independent of the base composition. the energy based methods sci and rnaeval compare folding energies in a way that the absolute value of the free energy  is also normalized. all other methods, except tree editing using migal with layer  <dig>  do not even explicitly consider the sequence but act on the predicted structure only. although all methods should be normalized for base composition by construction, we still investigated how they are affected by the gc content.

the somewhat surprising results are shown in fig.  <dig>  while pairwise tree editing, base-pair distance and mountain metric approaches do not show any significant correlation to the gc content, energy based methods and tree editing using a consensus structure derived by rnaalifold show high correlation. the consensus base-pair distance method shows little correlation, but correlation increases slightly when moving to higher entropy ranges .

these results suggest that the observed gc-dependence is mainly a consequence of using a rnaalifold consensus structure. in the case of the sci, this is easiest to understand. the sci is the ratio of the consensus energy and the mean of the single sequence energies. both components are functions of the base composition, with higher gc content resulting in lower free energies. although consensus predictions use the same energy model as single sequence predictions, the additional constraints imposed by folding several sequences together result in a slightly different gc dependence. similar effects seem to be responsible for the gc dependence of the rnaeval measure and the consensus based tree editing measures.

for the purpose of this study, the gc dependence does not directly affect the results due to the design of our benchmark. the positive and negative test set contains sequences with the same base composition. however, for practical reasons when considering these measures in rna gene finding algorithms this effect is of relevance. the gc dependence of the sci seems to be the main reason why the rnaz program shows a small bias towards gc rich regions  <cit> .

statistical significance of the scores
in this study we compared the different methods on the basis of their ability to discriminate between alignments containing true conserved structures and random controls. while this approach gives us information on the performance of the methods relative to each other, none of the scores used in this study  is normalized for sequence diversity. alignments with 100% sequence identity get, by definition, the highest score of perfect structure conservation. for the purpose of detecting evolutionary conserved structures this is of little help. ideally, one would like to answer the question of whether there is an unusually conserved structure in an alignment despite the given sequence diversity.

this problem can be addressed in different ways. the optimal solution is to devise a direct statistical model as in the case of msari. however, this seems only feasible if one considers a simplified score like the base-pair derived score in msari. it seems impossible to analytically derive the background distribution of a more complex score like the sci, since it depends on complex folding algorithms that cannot be modeled directly.

as an alternative, machine learning algorithms can be used. in the case of rnaz, the dependence of the sci on the number of sequences and the average pairwise identity is trained on a large test set of known ncrnas and random alignments.

yet another possibility is to derive the background distribution empirically for each alignment under test. this approach is used by alifoldz, which calculates a z-score by comparing the score of the original alignment to the score distribution of randomized alignments.

this last method is computationally demanding, but has the advantage that it can be applied to any score without modification.

availability
we have set up a web-server that calculates relevant scores used in this study for a given alignment and assesses the statistical significance by calculating a z-score and an empirical p-value. the web server can be accessed under .

CONCLUSIONS
the aim of this work was to find the most effective ways to detect evolutionarily conserved rna structures in sequence alignments. a few methods and algorithms have been proposed previously. here, we devised a series of novel measures and evaluated their performance systematically on a large test set of known conserved rna structures.

as the most accurate measures we could identify the folding energy based "structure conservation index" and a measure based on the base-pair-distance structure metric. interestingly, these two are among the simplest methods tested and generally outperform all of the more sophisticated methods. only the methods based on tree editing distances could compete to some degree with the sci/base-pair distance. here we can note that more complex tree representations show better performance than simplified "coarse grained" abstractions. however, more sophisticated algorithms like migal do not give better results than the basic algorithms as implemented in the vienna rna package. all other methods show only very poor performance and do not appear to be a reasonable choice in any "real-life" application. among these methods we have to list the mountain metric, all methods based on structure ensembles and also the ddbrna and msari algorithm.

as a general trend we could observe that the measures relying on a consensus structure prediction by the rnaalifold algorithm have clear advantage over methods that only use single sequence structure predictions.

all these results are fairly consistent over all tested alignments with one notable exception. for highly conserved sequences the rnaeval approach based on pairwise folding energy comparisons shows the highest accuracy and all other measures, including the sci, perform significantly worse.

taken together we can conclude that the simple methods based on either folding energies or base-pair distance are the methods of choice. although the sci was the only method that was tested when rnaz was first published, our results clearly show that this was a reasonable choice. an interesting new aspect is the gc dependence of the sci that we observed here. this makes it necessary to consider base composition when evaluating the statistical significance of the sci, for example by including the gc content as an additional classifier in the rnaz machine learning algorithm. this can be expected to increase the specificity of the program.

another result which has practical implications is the fact that the sci performs poorly on highly conserved sequences. the rnaeval method turned out to be significantly better and might help to improve ncrna gene prediction under these particularly difficult conditions.

the ever-growing pace of current genome sequencing projects confronts current rna gene finders with new problems. having sequences of dozens or even hundreds of species, the paradigm of detecting conserved structures will change. only a few extraordinarily conserved rnas like trnas or rrnas will show a signal of structure conservation across the whole phylogeny. the next generation of rna gene finders will have to deal with the problem of finding lineage specific and evolving structures. the strategies presented here can be the basis of algorithms that find sub-groups of related structures or detect outliers of mis-aligned sequences. we plan to enhance our programs rnaz and alifoldz with such capabilities. the results obtained here guide such efforts as they clearly show which measures are worth considering and which should be avoided.

