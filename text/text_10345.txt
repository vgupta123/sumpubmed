BACKGROUND
gene expression microarrays are designed to measure the relative abundance of gene transcripts by detecting sequence-specific hybridization between a fixed dna probe and a labeled rna target. for intentional or unintentional reasons, some probes may detect multiple genes, and some genes may be detected by multiple probes. for many types of analysis, this is not a problem. for example, microarrays can be used as a screening tool to identify differentially expressed genes associated with a biological phenotype. in this case, a probe set with an expression pattern of interest can be mapped to a particular gene or set of transcripts using annotations from the manufacturer or from others  <cit> .

however, some analyses require expression estimates for a specific set of genes, where the abundance of specific splice isoforms is unimportant. for example, in studies of breast tumors it may be important to determine the expression level of the genes esr <dig> and erbb <dig>  which correspond to the clinically important estrogen receptor  and her <dig> proteins  <cit> . on the hg-u133a platform, there are nine probe sets designed to detect esr <dig>  but only one of these probe sets is strongly correlated with er status determined by immunohistochemical methods  <cit> . as another example, one may wish to assess the expression of a set of genes in a previously defined signature or module; each gene may correspond to multiple affymetrix probe sets.

at least three systematic approaches could be used to estimate a single expression value for a particular gene: 1) use the average expression value of all probe sets that map to the gene. 2) redefine the mapping between individual probes and probe sets, such that there is a one-to-one mapping between genes and redefined probe sets  <cit> . 3) from the set of probe sets that map to a particular gene, select a single, most representative probe set. the disadvantage of the first approach is that the signal from accurate probe sets can be corrupted by noise from inaccurate probe sets. the disadvantages of the second approach are a lack of a clear standard for defining the probe sets, unstable probe set definitions that may change as genome and transcriptome data are updated, and a requirement for raw data that may not always be available. thus, the second approach adds a layer of complexity that may be acceptable when analyzing a single data set but complicates the comparison with results generated at different times or with different remappings. however, the third approach is conceptually simple, is likely to be more accurate than the first approach, uses only the stable, manufacturer-supplied identifiers, and can be readily applied to expression data for which the original probe-level data is unavailable. therefore, we set out to produce a one-to-one mapping from each gene to its single, optimal probe set.

to evaluate the suitability of a probe set, we considered three factors. first, the probes in the probe set should respond specifically to the target gene and not to other genes. several studies have explored the specificity of affymetrix microarray probes and found that probe sets are most effective when their individual probes match their intended target  <cit> . furthermore, probes that partially match other, unintended targets may deliver misleading results  <cit> .

second, the probe set should detect as many splice isoforms of the target gene as possible. the present work is primarily concerned with analytical problems in which the gene, but not the specific isoform, is specified. for this purpose the overall expression level of a gene, counting all functional splice isoforms, is the desired measurement. if the expression level of individual splice isoforms is desired, other tools are available  <cit> .

third, the probe set should query the target gene at a position near the 3' end of the corresponding transcripts. the microarrays considered in this work are designed to be used with an eberwine-type target generation protocol. because the reverse transcription and in vitro transcription steps are initiated at the poly-a tail, there is a 3' bias in the amount of labeled target that is generated  <cit> . thus, probes that are too far from the 3' end of the target are likely to have a lower signal intensity, and for this reason most  probes are designed by affymetrix to query their target within  <dig> bases of the 3' end of the transcript, or within  <dig> bases for the x3p array. in addition to a weaker signal, probes far from the 3' end of the gene are susceptible to false signal changes resulting from variations in rna integrity  <cit> .

we developed a method to score each probe set according to the three criteria described above. for genes that are detected by more than one probe set, we selected the highest-scoring probe set to represent that gene. we evaluated this one-to-one mapping by comparing measured gene expression levels to protein levels.

RESULTS
algorithm
we acquired probe sequences for four widely used human gene expression microarrays from affymetrix: u95av <dig>  u133a, u <dig> plus  <dig> , and x3p. we used ncbi blastn to search the 25-base probe sequences for matches to the refseq human cdna database  <cit> . the blastn search was run with the default parameters, except that the word size was set to  <dig> to increase sensitivity. we used the maximum alignment score  between each probe and cdna as an indication of hybridization affinity. we defined three levels of alignment: a strong alignment has a score between  <dig> and  <dig>  indicating that at least  <dig> bases are identical and that the probe is very likely to detect the target. a moderate alignment has a score between  <dig> and  <dig>  corresponding to an uninterrupted alignment of length  <dig> to  <dig> bases; the probe may or may not respond to the target. a weak alignment has a score less than  <dig> and is unlikely to respond to the target.

specificity
a probe was considered to specifically detect a given gene if it strongly aligned to at least one transcript of the gene, but did not have a strong or moderate alignment to a transcript from any other gene. the gene specifically detected by the largest number of probes in a probe set is considered the targeted gene of the probe set. the specificity score ss of a probe set is the fraction of its probes that specifically detect the targeted gene.

coverage
a transcript of the targeted gene was considered detected by a probe set if the transcript has a strong alignment to the majority of the probes in the probe set. the coverage score sc of a probe set is the fraction of all transcripts belonging to the targeted gene that are detected by the probe set.

robustness
the processivity requirement for a probe-transcript alignment is the number of bases between the 5' end of the alignment and the 3' end of the transcript sequence; this corresponds to the length of labeled target that must be synthesized by in vitro transcription to reach the query region. the overall processivity requirement n of a probe set is the median processivity requirement for all strong alignments between probes in the probe set and transcripts in the targeted gene. we define the robustness score sr of a probe set as the probability that synthesis of the target up to the processivity requirement is achieved without interruption:

 sr=1-pn 

here, p is the probability of the ivt synthesis being interrupted at each base, due to either transcript degradation or lack of enzyme processivity. the value of p is likely to be variable in clinical specimens, but for simplicity we use a value corresponding to the manufacturer's design criteria: 1/ <dig> for the x3p array, or 1/ <dig> for the other arrays.

overall score
we define the overall score so as the product of the three scores described above:

 so=ssscsr 

for a given gene, the probe set targeting this gene with the highest overall score is selected to represent the gene.

testing
calculation of jetset scores
we calculated scores corresponding to four affymetrix human gene expression microarray platforms that are highly represented in the geo database. in general, we observed higher specificity scores for the newer  platforms than for the older hg-u95av <dig> platform, likely reflecting the more accurate genome data available when the newer arrays were designed . the coverage scores were similar on each platform, with ~85% of probe sets achieving a perfect coverage score . the robustness scores were notably lower in the x3p platform, perhaps reflecting the difficulty of meeting the design criteria for this platform by placing the probe set within  <dig> bases of the 3' end of the transcript . because of this, the overall score distribution was also lower in the x3p platform .

comparison with er and her <dig> status in breast tumors
we evaluated the jetset mappings using a publicly-available data set representing  <dig> breast tumor specimens with hg-u133a microarray measurements and er protein status as determined by ligand-binding assay, enzyme immunoassay, or immunohistochemistry  <cit> . in this data, we expected that the er protein status should correlate with the esr <dig> gene expression level. using annotations from the manufacturer, from bioconductor, and from the analysis described here, we identified nine probe sets that could possibly detect the esr <dig> gene . of these, the jetset algorithm identified 205225_at as the best probe set to detect the esr <dig> gene. we observed that 205225_at was the only esr <dig> probe set to show strongly differential expression correlated with protein levels .

gene annotations are from the manufacturer  or from bioconductor  or derived in the present analysis . probe sets that did not meet the jetset annotation specificity criteria are indicated by "--". each probe set was scored for specificity , coverage , robustness against mrna degradation , and a combined overall score . for each gene, the probe set with the highest overall score  is selected to represent that gene.

we also evaluated the performance of two alternative probe set definitions: the brainarray "hgu133ahsentrezgcdf" and the gatexplorer "genemapperhgu133acdf", both of which redefine probe sets such that each queries an individual gene  <cit> . in both cases, the remapped probe set querying esr <dig> failed to detect strong differential expression between er-positive and er-negative tumors .

we next evaluated a second publicly-available breast cancer data set for which clinical her <dig> status based on protein immunohistochemistry or on fluorescence in situ hybridization  was annotated in  <dig> breast tumors  <cit> . here we expected the her <dig> status to correlate with the erbb <dig> gene, which encodes the her <dig> protein. the manufacturer, bioconductor, and jetset annotations agree that erbb <dig> is queried by two probe sets . we evaluated these two probe sets as well as two remapped erbb <dig> probe sets as described above, and found that the probe set selected by the jetset algorithm, 216836_s_at, best distinguished between her2-positive and her2-negative tumors .

concordance of a gene expression module in breast tumors
we previously identified a set of  <dig> co-expressed genes whose expression is associated with chromosomal instability  in cancer  <cit> . these "cin70" genes were identified based on their correlation in multiple microarray data sets using various platforms; therefore we expect the genes in this module to be generally correlated with each other in other cancer data sets. furthermore, for any of the cin <dig> genes, we expect that the probe set selected by the jetset algorithm should be more likely to be correlated with the other genes in the signature than a probe set with a lower score. for each of the  <dig> tumors in the first breast cancer data set, we defined the cin <dig> score as the median expression value of all  <dig> probe sets that query the cin <dig> genes. for the  <dig> cin <dig> genes that were queried by more than one probe set, we calculated the pearson correlation between individual probe set expression values and the cin <dig> score. we compared these correlation values between the highest-scoring probe set and the lowest-scoring probe set, and found that the highest-scoring probe sets  were generally better correlated .

we also performed a similar analysis using the individual components of the overall score: specificity, coverage, and robustness. the specificity score alone did not perform well in identifying highly-correlated probe sets . the coverage score alone did not vary enough to perform meaningful analysis . however, the robustness score alone was able to essentially reproduce the performance of the overall score .

implementation
the individual scores calculated by these methods can be found on the project website  <cit> . additionally, we developed an r package called "jetset" that contains these scores along with functions to retrieve the highest-scoring probe set for a given gene. the r package is available from our website and has been submitted to bioconductor  <cit> . the jetset data and package will be updated following the bioconductor release cycle .

discussion
we have developed a heuristic method for rating probe sets and a tool for choosing a single representative probe set for a given gene. the intended use of this tool is to rapidly select probe sets to assess the expression of a previously-defined set of genes in a microarray data set. we do not necessarily expect that every probe set in our mapping is the optimal choice, but our results suggest that our mapping performs reasonably well at least in our test cases.

our approach is intended to complement, not replace, probe-level remapping methods. we and others have previously used probe-level remapping to redefine probe sets such that each reflect a single gene, with generally acceptable results. however, when performing analysis across a large number of data sets, we found probe-level remapping to be inconvenient because we were unable to include many data sets for which we did not have the raw probe-level data.

our evaluation of esr <dig> and erbb <dig> probe sets indicates that jetset chooses the probe set that best matches protein or fish-based histological results, confirming the utility of our method. furthermore, the identification of these specific probe sets is in agreement with previous results  <cit> . suprisingly to us, the probe-level remapping approaches performed substantially worse for the esr <dig> gene, likely because this gene is queried by an uncharacteristically large number of probe sets rendered ineffective by their distance from the 3' end of the transcript. we also evaluated our method by analyzing the coherence of genes in the previously described cin <dig> module and again found that the probe sets selected by jetset outperformed the probe sets with lower scores. interestingly, in both sets of evaluations, it appears to be the robustness score that primarily drives the probe set selection, likely because a large fraction of probe sets have robustness scores that are very low.

jetset is designed as a general tool, and thus it is not necessarily optimized for specific projects. the specificity score and coverage score are calculated without consideration of the relative abundance of splice isoforms. this abundance varies from one tissue type to another, and a sophisticated user may wish to consider this aspect when selecting a probe set. also, by providing the three individual scores, we have left the possibility for the user to decide on an overall scoring scheme most suitable for a specific project. for example, the robustness score might be more important for use with samples that are known to be highly degraded, e.g. paraffin-embedded tumor specimens. furthermore, this approach is not valid for data from all types of microarray. for example, whole-transcript amplification methodologies, as used in the newer arrays from affymetrix, do not require that the probe be located near the 3' end of the transcript.

it might be possible to use this method or similar to identify probe sets as good or bad, regardless of the mapped gene. however, sample quality can vary greatly depending on the type of specimen, and hybridization specificity can vary due to choice of protocol; as discussed above both of these factors can affect the relative importance of the scores. therefore, deriving an absolute score cutoff to separate good probe sets from bad probe sets would not be generally applicable to all experiments, and we did not attempt to do this.

CONCLUSIONS
we have described a method to calculate principled, unbiased quality scores for affymetrix probe sets, and to use these scores to define a simple, unambiguous mapping from gene to probe set.

