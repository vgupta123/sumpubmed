BACKGROUND
systems biology is an interdisciplinary field with ultimate goal to elucidate the relationships between molecular states and higher order properties of complex biological systems. microbial communities are such systems and the study of their collective behavior is a major challenge in the post-genomic era  in order to identify the sources and role of heterogeneity in the behavior of microbial populations and uncover the mechanisms that lead to specific phenotypes of interest, such as persister cells  <cit>  and biofilms  <cit> . it has also become clear that deciphering the dynamics of evolving bacterial communities requires multidisciplinary approaches  <cit> . microscopy is an important tool that can help us capture data and correlate information at multiple scales, from cell populations to molecules  <cit> . in particular, time lapse microscopy allows us to monitor the evolution of bacterial communities and generate "cell movies" massively  <cit> . however, accurate and fully automated image analysis and single-cell analytics methods are required before we can really exploit this abundance of "big data"  <cit>  for systems biology.

it is a fact that we currently know very little on the role single-cell heterogeneity plays in the dynamic behaviour of microbial communities. technical difficulties hamper the automatic monitoring and tracking of subpopulations and individual cells in growing bacterial colonies at a large scale  <cit> . studies on the variability of individual cells behaviour rely on laborious manual annotation of cell movies with only a small number of cells per frame . tracking cells across image frames in overcrowded  bacterial communities with many colonies and thousands of cells in the field of view, extracting automatically single-cell attributes  and correlating them to molecular and other signatures  remains elusive. developing robust and high throughput image analysis pipelines that routinely accomplish these tasks effortlessly will enable single-cell analytics and provide new insights to compelling open questions. it is the combination of accurate single-cell image analysis and single-cell analytics that will empower the development of effective stochastic modeling and systems microbiology approaches. this new capability will allow us to characterize stochasticity in colonial growth dynamics of single-cells  <cit> , model stochastic gene expression in single-cells  <cit> , measure phenotypic variation in bacteria  <cit> , model bacterial state transitions from regular to persister cells  <cit> , or from planktonic to biofilm cells  <cit> .

bioimage analysis has evolved to become an important discipline in bioinformatics and computer vision  <cit> . for bacterial image processing, well known open source software packages for analyzing cell movies are the tlm-tracker  <cit> , celltracer  <cit> , microbetracker  <cit>  and its successor oufti  <cit> , and schnitzcells  <cit> . the tlm-tracker  <cit>  uses multiple alternative algorithms for cell segmentation, such as threshold-based, watershed transform and level-set methods. to construct the lineage tree of a colony, it matches overlapping cells in consecutive movie frames. the celltracer  <cit>  employs the concept of hybrid grey-scale/black-white images and extends image filtering and mathematical morphology operators developed for grey-scale images to work with such hybrid images. this allows it to extract cells iteratively as it gradually converts the original grey-scale image into a binary mask of segmented cells. the microbetracker  <cit>  and its successor oufti  <cit>  combine several algorithms developed for medical image segmentation and computer vision, including clustering, template-matching, active contours, region growing and level set methods. schnitzcells  <cit>  can segment cells in either fluorescence or phase contrast images, track cells in a frame-to-frame manner  <cit>  and measure fluorescence.

the main features of the aforementioned state-of-the-art methods are summarized in . their most important limitations that have motivated our work are the lack of generality and automation. currently available methods fail quite often to process cell movies acquired using diverge imaging settings  and require time consuming human involvement in a trial-and-error mode in order to produce acceptable results. moreover, they require extensive parameterization thus becoming unfriendly since users need to become familiar with image processing concepts to make good use of them. for all these reasons, bacterial image analysis has remained a serious bottleneck limiting the complexity of cell movies that can be analyzed efficiently and ultimately the throughput of systems microbiology studies. it is therefore important to develop fully automated computational approaches that can analyze more complex cell movies with many frames, many colonies per frame, many cells per colony, and extract, characterize and track colonies and single-cells successfully, even in movies with imperfect image quality and multiple overcrowded colonies with thousands of cells in the field of view.

motivated by this need, we present here a complete pipeline that combines image processing and machine learning algorithms to achieve precise bacterial colonies and single-cell segmentation, tracking and phenotypic characterization. our pipeline, called basca , allows the fully automated segmentation and morphology/expression analysis of individual cells in time-lapse cell movies. we employ a “divide-and-conquer” strategy allowing the independent analysis of different micro-colonies in the input movie. at the colony level, we divide again the problem in order to successively reach down to the single-cells level. this recursive decomposition approach allows us to analyze efficiently colonies regardless of their cell density and deal effectively with dense cell images. to the best of our knowledge, our bacterial image analysis approach is the only one in the field following an aggressive “divide-and-conquer” computation strategy that also facilitates a parallel processing software implementation .

besides its robustness across different imaging modalities and its complete automation , our pipeline supports a high throughput analysis and estimation of a plethora of single-cell properties, a prerequisite for developing a high throughput micro-environment data analytics platform. moreover, basca offers several unique capabilities: tracking of multiple colonies  in the field of view, constructing the lineage tree of each colony, visualizing on the lineage tree the evolution of any desirable single-cell property , construction of time trajectories of selected single-cell properties  across image frames etc. all these data analytics capabilities favor high throughput analysis and enable systems biology orientated research both at a higher resolution  and at a large-scale . it therefore becomes possible with basca to account for single-cell stochasticity in different phenomena without losing sight of the community effects that may drive it  <cit> .

the rest of the paper is organized as follows. in the methods section we first describe the time lapse movies and evaluation metrics used to compare basca to other state-of-the-art methods , and then elaborate on the pipeline of algorithms involved in basca . in the results and discussion section, we present evaluation results with different datasets demonstrating the most important single-cell analytics features of basca and examples of how they can be used in practice. finally, in the conclusions section we summarize our findings and point to interesting future research directions.

methods
materials
datasets
the following datasets were used in the evaluation of this work:

salphase
a time lapse movie acquired by phase-contrast optical microscopy, monitoring four single cells of salmonella enterica serotype typhimurium that divide to become three discrete micro-colonies . from now on, we will refer to this movie as "salphase" and going from top left to bottom right we will refer to the three colonies encountered as colony  <dig>   <dig> and  <dig> respectively. this dataset is provided as additional file  <dig> 



additional file 2: salphase time-lapse movie. 




multi-salphase
this time lapse phase-contrast optical microscopy movie includes multiple growing micro-colonies of s. typhimurium . this more complex movie contains overcrowded merging colonies and the total number of cells exceeds three thousands in late frames. this dataset is provided as additional file  <dig> 



additional file 3: multi-salphase time-lapse movie. 




individual frames
we have also analyzed several image frames of different imaging modalities generated by different laboratories that are publically available. microbetracker’s frame is a phase-contrast cslm image  of sparse escherichia coli cells and micro-colonies available at microbetracker’s webpage  <cit> . celltracer’s frame contains a micro-colony of e. coli acquired by phase-contrast optical microscopy  and was derived from a movie produced in  <cit>  and provided at celltracer’s webpage  <cit> . tlm-tracker’s image contains a micro-colony of bacillus megaterium acquired by bright-field optical microscopy  generated in  <cit>  and available at tlm-tracker’s webpage  <cit> . finally, schnitzcells’ frame contains a micro-colony of e. coli acquired by phase-contrast optical microscopy  and was derived from a movie provided at the schnitzcells’ webpage  <cit> . let us mention that schnitcells can handle only uint <dig> format images, thus each of the aforementioned datasets was converted to this format too so as to enable comparative evaluation of schnitchells with the rest of the methods.

evaluation metrics
comparative evaluation was performed based on metrics commonly used in pattern recognition, such as true positives , i.e. actual cells that were correctly classified as cells, false positives , i.e. artifacts that were incorrectly classified as cells, and false negatives , i.e. actual cells that were missed. we remark that artifacts can be either due to noise or fragments of over-segmented cells. furthermore, for each method we computed the true positive rate  or recall


tpr = tp/,

which represents the percentage of the true cells found, the positive predictive value  or precision


ppv = tp/,

which represents the probability that a detected cell is a true cell. the former metric is used to characterize the sensitivity and the latter the specificity of a method. additionally, we computed the f-measure  <cit> , i.e. the harmonic mean of tpr and ppv that is commonly used to assess the recall versus precision trade-off:


f = 2 ⋅ /.

methods
the developed basca analysis pipeline consists of five stages: image preprocessing, bacterial colonies segmentation, single-cells segmentation, cells tracking and lineage trees construction, single-cell attributes estimation and visualization. specifically, we formed a computational pipeline, focusing on detecting, segmenting and characterizing each colony and individual cell in the movie. initially, we process the whole image and extract individual colonies. then we analyze each colony into a partition of “objects” containing one or more cells. gradually, we zoom in and reach the desired result; accurate single-cell boundaries detection and cell features estimation. below, we describe each stage of the developed pipeline in detail.

image preprocessing and colonies segmentation
image preprocessing is a necessary initial step to suppress noise and correct for image background abnormalities ). we apply first contourlet transform based image denoising, as described in . then, we use contrast-limited adaptive histogram equalization   <cit>  to enhance cell regions in the image and suppress any luminous local micro-colonies background that exists in some imaging modalities ). as a result, we manage to remove noise and at the same time separate the background from information bearing cell regions.fig.  <dig> image preprocessing and colonies segmentation. a input image with three colonies . b contourlet based denoising and adaptive histogram equalization used to sharpen cell edges. c colony masks created using morphological filtering, otsu’s global thresholding and canny edge detection; they are used to separate colony regions from image background so that each colony can be processed separately in the pipeline . d adaptive thresholding is used to remove the colony’s local background pixels. e multiplication of the image generated by adaptive thresholding with the corresponding extracted mask  removes the noise  and the artifacts  while revealing cell objects inside the colony




after preprocessing, our colony segmentation method creates a binary mask used to separate each colony from the image background. we first apply a mathematical morphology operation   <cit>  to estimate the image background. then we use otsu’s global thresholding  <cit>  and canny’s edge detection algorithms  <cit>  to create a binary image  outlining as precisely as possible the region of each colony, regardless of its size ).

after completing this task for each image frame, we track each colony and extract its properties  in the time-lapse movie. specifically, in order to determine the correspondence of two colonies in two consecutive frames, we check whether the centroid of a colony in the previous frame lies inside the bounding box of a colony in the current frame, and if so this colony is matched. if a colony in the current frame matches to no colony in the previous frame, we treat it as a new one, since we consider it possible for a colony to enter to the microscope’s field of view while the experiment is running. when two or more colony centroids of the previous frame lie inside the bounding box of the same colony in the current frame, the algorithm identifies that these colonies have merged. this capability is important since in a large bacterial community colonies can merge or move out of the field of view. keeping track of colonies as they grow and merge is important not only for archiving their time varying properties but also for knowing the colony from which each individual cell has emerged i.e. the subpopulation to which it belongs to, without using any fluorescent markers. to the best of our knowledge, our divide and conquer computational approach is the only one that can track multiple subpopulations  that may merge, in addition to single-cells, in cell movies.

single-cell segmentation algorithm
having defined a colony’s region as accurately as possible, we can now “zoom in” and detect individual cells effectively. a visual overview of the whole segmentation approach is provided in fig.  <dig> fig.  <dig> overview of the cells segmentation method.  colonies segmentation.  objects identification inside a colony.  skeleton based object classification;  complex object segmentation: 4a) watershed algorithm application, 4b) “puzzle solving” step, 4c) new dataset generation, 4d) unsupervised gaussian mixture modeling, 4e) final result of bacterial cells segmentation.  collinear object segmentation: 5a) application of the “deep valley" criterion to identify “bow tie” points, 5b) final result of bacterial segmentation. at step , there is a bifurcation leading to different processing routes based on the object's classification. see text for details




from colonies to cell objects
despite the applied preprocessing, each colony may still contain local background pixels due to large illumination variations ). to overcome this problem, we use adaptive thresholding  <cit>  to separate cells from the non-uniformly illuminated background ). we remark that this type of background variability is typical for images acquired by optical microscopes  but not for images acquired using confocal laser scanning microscopes   <cit> . nevertheless, the adaptive thresholding method used here has no negative effect on clsm images. however, as illustrated in fig.  <dig> adaptive thresholding introduces "salt and pepper" noise, so in order to eliminate it we multiply the processed image with the global background mask. the result is an image with the global background removed and the local noise inside each colony suppressed  for the 3rd colony of salphase movie).

however, the individual cells inside the colony may not be fully separated  at this stage. we rather observe that the colony is partitioned into "cell objects", where each object is a set of cells "touching" each other  for examples). the union of these objects covers all cells in the colony and their pairwise intersection is empty . in the colony of fig.  <dig>  three objects have been colored for demonstration purposes, one green and two red. the green is a so called collinear object while the two red ones are considered complex objects. to determine an object’s category  we developed a divide-and-conquer approach where we analyze each object individually. first, we compute the object's skeleton as presented in  <cit>  ). then, if the skeleton has "junction points"  the object is considered complex. on the other hand, if we find no junction points, the object is either a single-cell or a cascade of single-cells , see fig.  <dig> .fig.  <dig> cell objects extraction and classification. a each colony is an ensemble of cell objects corresponding to one or more “touching” cells; e.g. see three cell objects marked with color. we first extract the skeleton of each object and classify it as complex  or collinear  according to the presence  of skeleton junctions . b the skeleton of the smaller red object has two junctions  so it is classified as a complex object. c colony object with no junctions  classified as collinear object. d a complex object  with four junctions. see text for details




collinear object analysis
in order to ascertain if a collinear object corresponds to a single-cell or a series of connected single-cells  we developed a simple algorithm based on the observation that the shape of a bacterium at the fission stage  <cit>  resembles that of a bow tie ). the algorithm searches for "bow tie points" by computing the euclidean distances  <cit>  of all pairs of diametric pixels  lying on opposite boundaries with respect to the object’s centerline. then, it identifies significant local minima ) of the distance curve, meeting the following criteria:fig.  <dig> collinear objects analysis - "bow ties" identification. a extracted collinear object. b skeletonized object with skeleton pixels numbered. the red numbers mark the “bow tie" locations on the centerline. c distance curve of the object: to construct it we form pairs of opposite-side diametric boundary pixels  and compute their euclidean distance . then we search for “deep valleys”  and,  we split the object at bowtie points , that correspond to the deep valley positions in . e the collinear object is segmented into three single-cells





localmin/leftlocalmax ≤ t and localmin/rightlocalmax ≤ t


where localmin is the local minimum and leftlocalmax and rightlocalmax are the local maxima lying around the local minimum. such local minima  are called “deep valleys” , indicated by red circles). intuitively, t is the ratio of the minimum to maximum width  measured at the frame before the first cell division. the value of threshold t is automatically set by the pipeline and is usually in the range . when the algorithm identifies the existence of deep valleys, we split the object into discrete cells at these locations ), that correspond to the deep valley points on the centerline ) because the centerline pixels are ordered ). otherwise the collinear object remains intact and is considered as a single-cell. finally, for each segmented cell, we identify its centroid by averaging its pixel coordinates ).

complex object analysis
complex objects are treated differently than collinear objects. first we use the watershed transform  <cit>  to estimate how many cells are possibly "hidden” inside a complex object. we determine the centroids of extracted watersheds and consider them as initial estimates for the centroids of potential cells in the complex object ). however, a well-known problem of the watershed transform is that it favors over-segmentation  <cit> . so, we apply the “deep valleys” algorithm again, but in a slightly modified way. this time we need to decide whether we should merge erroneously over-segmented cell fragments, so as to avoid generating false positive cells. fragments in the neighborhood of a given fragment are examined to determine if they should be merged with it or not. two touching fragments can be merged if there is no bowtie point between them, identified using the deep valleys criterion. if a potential cell  can be merged with more than one neighboring cells, then the merging that leads to maximum solidity is chosen. solidity is defined as the ratio of the resulting area to the resulting convex hull area, based on the conjecture that elementary objects, i.e. well-formed single-cells, tend to have a solidity value close to one. moreover, the new object  is inserted into a processing queue in order to be further examined whether it should be merged with another watershed fragment. we call this iterative procedure “puzzle solving” algorithm ).

in order to outline the detected cells as accurately as possible and improve the segmentation result, we apply a machine learning method based on gaussian mixture modeling   <cit> . in  <cit> , we have shown how to transform image pixel intensities to a properly constructed set of data points before applying gmm to identify protein spots in a 2d electrophoresis  gel image. in our case, pixel intensities provide no information about cell structure since they follow a uniform distribution ). so we use the minimum distance from cell boundary ) as the basis for data points generation. specifically, we consider each pixel of the object acting as a data points generator in its neighborhood . the total number of data points, n, to be generated by random sampling and used to represent each object will be proportional to the number c of its estimated cell centroids. these n data points are apportioned to the pixels of the object according to each pixel’s euclidean distance from the object’s boundary, meaning that more internal pixels will be allowed to “throw” more data points in their neighborhood. following this data generation scheme, the pixels closer to the object’s centerline belong to it with higher probability than the more distant ones.fig.  <dig> distance transform. a cell object depicted in 3d; the image pixel intensities are shown in the z-axis. b same object's distance transform in 3d; the distance values are shown in the z-axis. it is obvious that the distance transform  <cit>  smoothens object abnormalities while sharpening the valley between the two cells comprising the cell object


fig.  <dig> complex object analysis - generation of a dataset representing the object. a a very complex object  including potentially  <dig> single-cells. b data points generation for the object in  by random sampling ,  <dig> data points generated. c a less complex object with only  <dig> potential cells. d data points generation for object in ,  <dig> data points generated. the number of generated data points is proportional to the number of the complex object centroids, thus it depends on the object’s structural complexity . also, more data points are randomly “thrown” around the cells’ medial axes, so as to best represent cell structures 




we may think of this process  as a reverse engineering step where the resulting data points represent best the bacterial shape. specifically, a pixel i located at coordinates  with distance d
i acts as a data generator using a 2-d gaussian model n with center μ = . finally, we get a gmm  <cit>  having as many gaussian components as the number of the pixels m in the object. each component has a mixing coefficient proportional to its distance value and equal to:


π = d
i/∑j = 1m
d
j.

so for each pixel i of the object we draw n∙π data points from a 2-d gaussian distribution which is centered at the pixel’s location μ =  with diagonal covariance matrix Σ having its elements set to  <dig> . the variance value  was selected to be smaller than  <dig>   in order to ensure that data points generated by the model  will be distributed in a manner that guarantees that their abundance reflects the distance, thus preventing the generation of “hills” of data points in-between pixel locations. this variance value was determined by experimentation and is kept fixed throughout the analysis, irrespectively of the image modality.

as mentioned before, the number n of data points generated for a complex object is proportional to the number of the estimated candidate cell centers c it may contain. in particular we use n=12ccelllength×cellwidthcalfactor <dig>  


where celllength is the expected cell length, cellwidth is the expected cell width of the species under examination and can be estimated from literature. for example for salmonella s. typhimurium the width  range considered is  μm , and in length range is  <cit>  μm  based on literature  <cit> . let us remark that even if these cell size parameter values are overestimated the approach will suffer only from a performance loss . moreover, calfactor is the spatial calibration factor of the experiment’s microscope used to convert the size of an image object from pixels to physical units .

using an n value that is proportional to c was a deliberate choice because the number of identified candidate centers can act as an object’s complexity indicator approximating the number of single-cell structures expected to be present in a complex object's region. so, if a complex object contains a lot of candidate centers, it is justified to “throw” more data points  in order to capture adequately the underlying structure of the different single-cells included in it. as shown in fig.  <dig>  the generated data set for the object with the six candidate centers ) "spent" less data points ) than the object with the  <dig> candidate centers  and ).

after generating the data points we associate each one of them with its closest center using euclidean distance  <cit>  and nearest neighbor classification  <cit> . starting with this initial assignment, we can determine the initial parameters of a 2-d gmm having c components  and compute the log-likelihood of each data point to belong to this initial mixture model:


logpyiΘ=log∑m=1cwmpyiθm,

where Θ≡{θ
 <dig>  …, θ
c, w
 <dig>  …, w
c} is the complete set of mixture model parameters and w
m are the mixing coefficients.

the next step is to apply finite mixture modeling   <cit>  in two dimensions . an important issue in mixture modeling is the selection of the proper number of components to use. with too many components the mixture may overfit the data, while with too few components it may not be flexible enough to capture the true underlying reality  <cit> . in our case, this would translate to a solution with either more or less components than the actual number of cells present inside a complex object. in order to overcome this difficulty we apply a modified expectation maximization  algorithm  <cit>  which also employs the minimum message length  criterion  <cit>  for best model selection. however, since the em with mml is computationally expensive we first apply the "puzzle solving" algorithm to estimate the initial number of components properly i.e. start the iterative algorithm at a number not too far from that of the best model. using the mml criterion ensures that the best model will not end up being an unnecessarily complex one unless if it pays for itself. therefore, it is possible that the best model may end up containing less than the initial number of c components . at the end, it is possible that some circular object fragments may still remain isolated and not merged with the cell they really belong to, especially when analyzing low resolution cell movies. to overcome this difficulty, we check if a fragment’s area is under a pre-specified thresholdfig.  <dig> cells segmentation - best gaussian mixtures model fit. initialization of gaussian mixture model parameters is performed after associating data points to cluster centers using nearest neighbor classification. for the complex object in  we have initially c =  <dig> components  in the mixture and for the model in  c =  <dig> components. we then apply the expectation-maximization  algorithm and use the minimum message length  model selection criterion to identify the number of mixture model components that produces the best model fit. in  this results to a reduction of clusters from 6– <dig>  and in  from 17– <dig>  each component in the final model represents a segmented single-cell 


 a=14π⋅cellwidthcalfactor <dig> 


determined automatically by the pipeline using the pre-specified parameters. fragments with area less than a are merged with the "touching" neighbor that maximizes the resulting object's solidity after the merging  otherwise they remain intact and are considered to be undersized single-cells. intuitively, considering a cell's projection on the plane as a curved parallelogram with two attached semi-circles , its area must be at least the area of the two cell poles, i.e. the area of a circle with radius equal to one half of the expected cell's width as in a.

lineage tree construction
a cell in a time-lapse movie frame can: 1) proliferate, 2) divide, and 3) die or disappear from the microscope’s field of view. in order to construct the lineage of a single cell, first we have to segment the cells of each colony efficiently and then we have to track the colonies and their cells along consecutive frames. in order to track cells in overcrowded bacterial time-lapse movies, we have developed an algorithm inspired by motion estimation techniques used for video compression  <cit>  which also follows a divide-and-conquer strategy. our cell tracking algorithm will not be discussed here since it has been published in  <cit> .

single-cell and colony properties extraction
for each colony, we compute growth curves in terms of the colony’s area  or in terms of cell population . in addition, we extract numerous properties at the single-cell level. we divide single-cell properties into two categories: cell attributes and cell life attributes. attributes are cell properties changing with time, characterizing each cell at each frame of the time lapse movie. for example, cell attributes that we track are: area, fluorescent protein quantity , major axis length , minor axis length , distance from the colony’s centroid etc. on the other hand, cell life attributes are statistics of attributes  characterizing a cell’s whole life "trajectory", i.e. from its birth to its division. in addition, elongation  and division time  are life attributes too. additionally, given an attribute’s evolution  we can estimate life attributes e.g. estimate an individual cell’s elongation rate by fitting an exponential model to the cell’s trajectory. all these properties are estimated and exported  to a bio-database for each individual cell and time frame in the movie. moreover, several useful visualizations can be produced for displaying the computed cell attribute values directly using color on top of the input time-lapse movie videos  or on top of a colony’s lineage tree or divisions tree as it will be demonstrated in the results and discussion section.



additional file 4: computed cell length overlaid on salphase time-lapse movie. 



additional file 5: multi-salphase time-lapse movie; cell length visualization after segmentation. 



additional file 6: salphase time-lapse movie; color indicates cell generation index as determined by the cell tracking algorithm. 




implementation
the pipeline of algorithms presented here has been coded in matlab version r2015b  <cit> . we used extensively the image processing, statistics and machine learning, wavelet and curve fitting matlab toolboxes. all presented results were obtained using a desktop computer with intel core i5- <dig> processor running at  <dig>  ghz, 8gb ram, under microsoft windows  <dig> professional operating system. the current implementation is not optimized for performance. nevertheless, a discussion of the trends of its running time is provided in supplementary material section  <dig> . due to the divide-and-conquer strategy followed that breaks large problems into smaller subproblems, we expect that the use of parallel processing can significantly accelerate the analysis. all post-processing capabilities are also implemented in matlab, so as to enable users to interact with the data produced using simple function calls. the authors' intention is to complete the software integration and performance optimization, add a proper user interface and then make the software accessible to the systems biology community. the emphasis of this methodology paper is on the innovative methods integrated in the basca pipeline and not on the software architecture and implementation.

RESULTS
comparison to the state of the art
in order to compare the segmentation performance of the proposed pipeline with state-of-the-art methods, we chose software packages that are extensively used by different labs worldwide to analyze cell movies and that have been referenced in several studies . moreover, we analyzed representative still  frames provided by the state-of-the-art software packages at their websites , as well as two more images, a frame from our salphase movie  and a frame from our multi-salphase movie . the recall, precision and f-measure was computed for each dataset and method used in the comparative evaluation.

the table in fig.  <dig> summarizes the evaluation results. dashes  in table entries indicate that the specific method did not return results  respectively. celltracer was able to analyze only the frame downloaded from the celltracer’s movie. tlm tracker performed well with images having only one small-size colony in the field of view . oufti and schnitzcells were the most robust among the state-of-the-art methods, returning results for all images. the proposed pipeline exhibited a notable f-measure advantage for all imaging modalities and datasets used; its f-measure remains very high  even for images with multiple overcrowded colonies in the field of view. moreover, it outperformed the other approaches even when using images from their own repertoire. only basca returned near perfect results  for the salphase movie, achieving perfect recall and an almost 10% higher f-measure than oufti. in multi-salphase, a movie containing many overcrowded colonies in the field of view, basca achieved f-measure  <dig> % in comparison with the state-of-the-art software, schnitzcells which achieved  <dig> %. oufti did not provide reliable segmentation results for this dataset. the results of the comparative evaluation for all methods along with the used parameterizations and input images are provided for each dataset as supplementary material .fig.  <dig> comparative evaluation summary. each section of the table reports the evaluation results for an image suggested by one of the methods under comparison. the table columns list the true positives , false positives , false negatives , as well as the recall, precision and f-measure achieved by each method. salphase frame  <dig> and multi-salphase frame  <dig> were used to assess the performance of the methods on images with dense and overcrowded colonies. dashes  indicate failure to return results for a specific dataset. tildes  indicate very poor performance. the proposed method  achieved consistently very high f-measure , suggesting that it is robust across imaging modalities and datasets produced by different labs. 




one of the main contributions of this work is that, in contrast to the state-of-the-art methods, basca can segment successfully images with multiple overcrowded colonies as they grow and merge, potentially with thousands of bacteria in a field of view . figure  <dig> illustrates this fact. segmentation accuracy when analyzing frames with overcrowded colonies is almost as high as in non-overcrowded frames. recall remains over 98%, precision over 91% and the f-measure over 94%. due to its high segmentation robustness, basca can estimate several time-varying colony and single-cell level properties accurately fulfilling the expectations of image driven single-cell analytics for predictive microbiology.fig.  <dig> segmentation of overcrowded and merging colonies. the four colonies in frame  <dig> of movie multi-salphase  are merged several frames later . top panels: input image frames. bottom panels: segmentation results: the cyan boxes report the tp, fn and fp for each colony. the red boxes summarize the evaluation measures for each frame. pseudo-colors are used to make cell boundaries visible. basca achieves both high recall and high precision and an f-measure over 94%




we should emphasize that the state-of-the-art software packages used in the evaluation require a different parameterization for each imaging modality. thus, we had to perform extensive experimentation to find the most appropriate parameter settings for each dataset before the evaluation . this is a laborious task that requires the user has knowledge of image processing concepts e.g. to select filter types, set parameters, select segmentation methods etc. . in contrast, the parameterization of basca is trivial. all parameters used by the pipeline are set automatically once the user inputs the spatial calibration factor, image modality and the expected value for the average cell length and cell width  of the species under examination as discussed in methods. eliminating the need for an elaborate parameterization was a deliberate choice since our objective was for the pipeline to be used trivially by microbiologists with no expertise in image analysis and to be easy to integrate into larger service workflows for high throughput single-cell analytics and systems biology.

in summary, basca extends the current state of the art by being:  more accurate,  more versatile since it can process datasets produced using different microscopy types/imaging modalities and return trustworthy results,  high throughput, automated, without requiring a human in the loop, and  able to analyze efficiently and at many levels cell movies with multiple colonies that grow and merge, resulting in overcrowded bacterial communities with thousands of cells in the field of view.

comparison to the ground truth
in fig.  <dig>  we present a summary of the comparison of our pipeline's results versus the ground truth for the whole salphase movie . we observe that basca achieves a recall over 99% and precision over 96%. overall it achieves a very high f-measure of 98%. in this movie we have accounted correctly for  <dig> out of the  <dig> true cells and made only  <dig> errors, mostly false positives. the results per frame and per colony are provided in additional file  <dig>  it is significant that the proposed methodology achieves a very high f-measure score  in all frames, which proves its segmentation robustness. the segmentation results for the frame with the lowest f-measure  are provided in . the majority of the errors appear during the exponential phase ; beyond this point the colonies start growing in the 3rd dimension. in summary, the results suggest that the developed pipeline remains both very sensitive and very precise as long as colonies maintain their 2-dimension structure.fig.  <dig> growth rates - evaluation w.r.t. the ground truth. a evaluation results summary for the salphase movie . the developed pipeline achieves a very high f-measure above 98%,  comparison of manual vs. automatic basca counting for the three colonies of the salphase movie by fitting a baranyi and roberts model  <cit> ; the kinetic parameters of microbial growth are almost identical,  automatically estimated growth curves of the three micro-colonies in the dataset




basca can provide, in a high throughput no-human in the loop manner, accurate data to support predictive modeling for systems microbiology. in order to demonstrate this important capability we also fit the primary model of baranyi and roberts  <cit>  to the growth curves of each colony in the salphase movie. this mathematical model is commonly employed by microbiologists to estimate growth kinetic parameters of a cell population in a given environment. the kinetics parameters of the population are its lag time  and the maximum specific growth rate . to describe the abrupt transition of the observed cell growth from the lag to the exponential phase the values of the model parameters m and n were fixed to  <dig> and  <dig> respectively as in  <cit> . in fig.  <dig>  we present the estimated kinetic parameters for the three growing colonies in the salphase movie extracted using manual and automatic cell counting. we can see that the kinetic parameters using the ground truth  are almost identical to those estimated using automated basca counting. in fig.  <dig>  we observe that although in the movie we have three colonies emanating from three single-cells and growing concurrently in the same micro-environment, their growth dynamics are quite different as also shown in  <cit> . consequently, it becomes apparent that our analysis pipeline not only provides trustworthy results without any human involvement, but also provides a useful tool for characterizing the stochasticity exhibited in colony dynamics. this can accelerate predictive microbiology studies that try to elucidate the functional role of stochasticity  and how it is affected by community effects  <cit> .

single-cell analytics and visual exploration
accurate and automated image analysis for large size bacterial communities enables single-cell analytics and high throughput systems microbiology. in fig.  <dig>  we present the entity-relationship  model  <cit>  of a database schema that supports the image-driven single-cell analytics system developed. in this bio-database representation of a cell movie, we capture essential information regarding the settings of the underlying experiment , and the time lapse microscopy characteristics . in addition, we store a plethora of properties extracted by the image analysis for each colony in the field of view , as well as for each segmented single-cell of each colony . specifically, we store single-cell properties that may change at every time instant  as well as properties that characterize a cell’s whole life span, from birth to division time . for example, in the cell instant table we store extracted cell attributes , while in the cell table, we store the estimated/measured cell life attributes . the bio-database stores the "big data" that result from the analysis performed at different levels , providing essential meta-data for the experiment that can accompany the imaging data, and/or used in lieu of the imaging data in subsequent analytics and modeling efforts. this unique aspect of basca not only enables image-driven systems microbiology, but provides a mechanism for reducing the cell movies massive data down to the useful information that can be exploitable by downstream processes. this is a very useful feature for building repositories of annotated cell movies with meta-data that can be searchable and usable in systems biology workflows over the internet.fig.  <dig> single-cell analytics database er-diagram. organization of the database storing information about the experiment that generated the cell movie  and the time lapse microscopy characteristics . in addition, we store the image analysis generated information for each colony in the field of view  and for each segmented cell within each colony. specifically, single-cell attribute values changing at every time point are stored in the cell instant table, while cell life attributes that characterize the whole cell life trajectory are stored in the cell table. the database summarizes the cell movie image analysis completely and can be used for downstream single-cell analytics and visualization. moreover it forms the basis for building repositories of cell movies under different conditions for large scale high throughput systems microbiology experiments




in fig.  <dig>  we present a visualization of the cell segmentation results. we observe ) that segmentation is accurate since the overlaid green contours outline the real contour of each cell. as a consequence, we can have confidence that we can measure cell attributes correctly. in fig.  <dig> can be visualized using basca. the different colors represent cell length , in the range indicated by the color bar. this kind of simple visualization allows the user to distinguish spatial patterns, or even focus on specific bacteria according to the chosen cell attribute of interest. moreover as a byproduct of the multi-scale image analysis basca can generate time-lapse movies of segmented growing colonies that animate the visualization of any extracted cell attribute of the user's choice. additional files  <dig> and  <dig> provide video animations of the space-time evolution of the cell length attribute for the salphase and multi-salphase cell movies, respectively.fig.  <dig> cell attribute visualization. a basca segmentation results for colony  <dig> of the salphase movie . green curvatures mark the contours of segmented cells. b cell length visualization using color, overlaid on each segmented cell. movies of cell length visualization are provided in additional file  <dig> and  <dig> for salphase and multi-salphase datasets respectively




automated lineage tree construction of large-size over-crowded colonies is also an important requirement for high throughput systems microbiology. celltracer, tlm-tracker and schnitzcells support lineage tree construction; however, they are limited to colonies with a small number of cells and do not exploit lineage trees as drivers for single-cell visual analytics  <cit> .

our methodology allows users to exploit lineage tree construction to visualize the evolution of single-cell attributes extracted from the automated image analysis of time-lapse movies. for example, we can visualize on top of the lineage tree the evolution of single-cell area in a colony , and thus inspect easily how it tends to change during the cells' life span. moreover, we can visualize the evolution of cell life attributes e.g. their division time. we achieve this by constructing a condensed circular tree, called divisions’ tree, containing as nodes only the cell division events. in fig.  <dig>  we use tulip  <cit>  to visualize on the divisions tree, the cell division times of the 3rd colony cells of the salphase movie. this is a very useful visual analytics feature since it can help us to quickly assess how cell life attributes evolve across generations under different experimental conditions.fig.  <dig> single-cell attribute evolution visualization on the lineage tree. the lineage tree of colony  <dig>  of the salphase movie. the area attribute is visualized using color on the tree for every cell and time instant  of the movie. triangular  shape node glyphs are used for time instants that a cell lies in the colony’s boundary or within the colony respectively. any cell attribute available in the database produced by the image analysis can be visualized in the same manner


fig.  <dig> cell life attribute visualization on the cell divisions tree. a circular tree of cell divisions  for colony  <dig> of the salphase cell movie. colors represent here division times  as indicated by the color bar. we can easily assess visually how division times vary along tree branches  and tree levels . triangular  nodes represent cells that lie on the colony’s boundary  respectively. any cell life attribute available in the database produced by the image analysis can be visualized in the same manner. the figure was created using the tulip software package  <cit> 




image-driven single-cell analytics support systems microbiology
using the results of the analysis at the single-cell level, i.e. cell attributes and cell life attributes, allows us to verify literature results and formulate interesting new hypothesis for future research. for example, given the extracted lineage tree of a colony and the estimated length of every cell at every time instant, we can fit to each cell's length trajectory  an exponential model  <cit> . specifically, let us consider as in  <cit>  a single-cell length model of the form l
t = l
0 ⋅ e
kt, where l
 <dig> is the birth length of a stalked cell and k is its growth rate . in this way we can capture the growth characteristics of each cell and estimate its personalized kinetic parameters. in fig.  <dig> we provide the growth curves of each individual cell of the salphase movie estimated using non-linear least squares  <cit> . we observe that single-cell growth kinetics exhibit great variability, something that cannot be observed by population based experiments. in fig.  <dig> we provide the average single-cell growth curves for each colony of the salphase movie. we notice that average growth curves vary among colonies of the same movie that grow in the same micro-environment under the same experimental conditions. clearly, colony  <dig> exhibits less heterogeneity  than the rest of the colonies. single-cell analytics enables zooming in and extracting useful information regarding subpopulation characterization for any cell attribute of interest among the many extracted by basca.fig.  <dig> single-cell exponential growth curves. a single-cell growth curves estimated from the image-analysis data after fitting an exponential individual cell length model . different colors represent different single-cell lifespan trajectories. b average cell growth curves of each colony . dashed lines represent one standard deviation above and below the average curve. we observe that cell growth exhibits considerable variability among colonies, and cells within the same colony 




single-cell analytics also allows characterization of intra and inter-colony as well as intra and inter-generation variability of cell life attributes. in fig.  <dig>  we present the best gamma distribution fits of the single-cell elongation rate k, division time t, and cell length at division l
f per colony . the estimated best model parameters are provided in . we observe that the cell life attribute distributions of the 3rd colony have a lower variance than the rest of the colonies. intuitively, this suggests that the cells of the 3rd colony grow and divide more synchronously across generations. this is actually confirmed by examining the cell generations movie, i.e. a version of the salphase movie in which we have colored cells according to their generation index at any instance as determined by our automated tracking and lineage tree construction algorithms . such subpopulation investigations would be impossible without a single-cell analytics focus; our image-driven single-cell analytics approach enables zooming-in and characterizing cell properties at any desirable level of community organization, in space  or in time .fig.  <dig> life attributes variability per colony. gamma distributions  of  the cell division time t,  the cell elongation rate k,  the cell division length l
f for colonies  <dig>   <dig> and  <dig> . the proposed methodology allows us to characterize the variability of cell life attributes across colonies. similar analysis can be performed for any life attribute available in the database after image analysis using basca




in fig.  <dig>  we provide the best fit gamma distributions of the aforementioned cell life attributes, but now per cell generation . we chose the gamma distribution because the histograms of the aforementioned attributes have similar shape  to it . moreover, the gamma distribution is a flexible two-parameter distribution that belongs to exponential family and is used to model physical quantities that take positive values in microbiology, such as the cell division time , the cell elongation rate . the estimated parameters are provided in . in fig.  <dig> we observe that there is a trend towards lower mean and smaller variance for the cell division length attribute as the generation index increases. single-cell analytics offer the capability to quantify the stochasticity and examine inter and intra-generation variability by estimating epigenetic correlations of single-cell attributes.fig.  <dig> life attributes variability per generation. gamma distributions  of  the cells division time t,  the cell elongation rate k, and  the cell length at division l
f for the 3rd to the 8th generation of cells of the salphase movie . by delving into each generation’s individuals we can characterize a life attribute's intra and inter-generation variability . similar analysis can be performed for any life attribute available in the database after image analysis using basca




however, the division length does not correlate explicitly neither with the elongation rate nor with the division time, since the estimated pearson correlation coefficients are very low for both cases . this is a rational result because cells growth depends both on the elongation rate and on the life span  of the cell simultaneously, as shown in  <cit> , factors which are both epigenetic information inherited by the cell's progeny as mentioned in  <cit> . so, we cannot assume that a cell that is going to live longer, i.e. that will have higher division time, will necessarily become lengthier too, given a specific birth length. in order to demonstrate this we computed the correlation coefficients of cell life attributes estimated by our image analysis and compared them to corresponding coefficients estimated in  <cit>  where e. coli cells were grown individually in microfluidic devices. specifically, we considered single-cell elongation, defined as e=loglfl0=k⋅t, and computed its correlation to the natural logarithm of the cellular birth length ). the pearson correlation coefficient was found to be r = - <dig>  ), and this is in striking accordance to what was found in  <cit>  . the anti-correlation between elongation and cell birth length ) is entirely due to a modulation of the division time, with the elongation rate appearing to be independent of birth length ) as it was also found in  <cit> . it is also interesting that the correlation coefficients of ) to cell division time  and elongation rate  we found through single-cell analysis match closely the values reported in  <cit>  ). these findings verify that basca algorithms quantify accurately single-cell properties when analyzing bacterial colonies growing in microenvironments accounting for the community dynamics.

CONCLUSIONS
we presented basca, a novel bacterial image analysis driven single cell analytics pipeline which enables the high throughput analysis, down to the single-cell level, of complex time lapse cell movies with many colonies and potentially thousands of cells in the field of view. the results presented demonstrate its robustness and universality. in contrast to other methods, basca is fully automated and does not require users to be familiar with image processing concepts and/or provide an elaborate parameterization to get good results any time a new movie is analyzed. basca not only improves the accuracy of segmentation but also achieves this without requiring a human in the loop. moreover, it tracks effectively colonies and single-cells as they grow and divide to form overcrowded bacterial communities and extracts a plethora of colony and single-cell properties on the fly.

basca is the first bacterial image analysis methodology designed with high throughput single-cell analytics in mind. it thus provides an important tool for dissecting the phenotypic diversity at different levels of community organization and understanding how inter-cellular interactions play a role on important phenomena for human health, such as biofilms formation, persister cells emergence etc.

as it has been demonstrated, the proposed methodology introduces several single-cell data analytics capabilities. it is designed for high throughput and enables systems biology orientated research both at a higher resolution  and at a larger scale . it can therefore be used to study the role of single-cell stochasticity without losing sight of community effects that may drive it.

work in progress includes algorithmic improvements, e.g. to allow segmentation of movies with filamentous cells  and the design of a suitable user interface. moreover we are optimizing the performance of basca by exploiting the divide-and-conquer nature of the segmentation method in order to parallelize the analysis both at the colony and the cell object levels. the ultimate goal is to be able to analyze efficiently and without human intervention stacks of cell movies in a high throughput mode as needed to construct well annotated repositories of cell movies and calibrate mathematical models accounting for single-cell stochasticity, so as to capture and characterize adequately the "logic" of bacterial communities’ behavior under different stress conditions.

additional files

additional file 1: supplementary material. 

 
additional file 7: contains for each dataset the segmentation results of each method  and corresponding parameterization files . 

 
additional file 8: salphase time-lapse movie ground truth table. 

 


abbreviations
bascabacterial image analysis driven single cell analytics

clahecontrast-limited adaptive histogram equalization

clsmconfocal laser scanning microscope

emexpectation maximization

erentity-relationship

fmmfinite mixture modeling

fnfalse negatives

fpfalse positives

gmmgaussian mixture modeling

mmlminimum message length

ppvpositive predictive value

tptrue positives

tprtrue positive rate

