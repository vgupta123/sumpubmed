BACKGROUND
the accurate characterization and quantification of orthologous transcripts across species are critical for understanding the evolution of gene expression and the transcriptome–phenotype relationship. previous comparative studies have shown that the evolutionary changes in gene expression play a key role in phenotypic changes between species, including the differences between human and closely related non-human primates 
 <cit> .

the development of sequencing technology, such as rna-seq, has provided significant advantages over previous microarray technology, for quantifying expression divergence. rna-seq does not rely on specific predesigned probes or a priori knowledge of the transcriptome under investigation, thereby theoretically allowing unbiased whole transcriptome profiling of any species and performing cross-species comparisons 
 <cit> . furthermore, in contrast to microarray, where even a single nucleotide mutation in probe sequence may affect the efficiency of probe hybridization, rna-seq is more robust to sequence variations between species. however, comparing transcriptomes of different species using rna-seq is challenging. one critical challenge is the lack of high-quality annotation of orthologous genes. although multiple databases, such as ensembl homologs 
 <cit> , orthodb 
 <cit>  and eggnog 
 <cit> , provide a catalog of orthologs between species, none of them provide coordinates of corresponding orthologous regions on reference genomes, which makes it difficult to employ them for rna-seq analysis. prevailing annotations for cross-species rna-seq analysis are based on sequence conservation through either whole genome alignment or local alignment, and have been previously implemented in analyzing transcriptional differences between humans and non-human primates 
.

another challenge in cross-species transcriptome comparisons is the variation of short-read mappablity to orthologs among species. although the leading short read mapping algorithms all try to identify the best mapping position for each read, a read may still map equally well or nearly equally well to multiple positions because of paralogous sequences in the reference genome 
 <cit> . furthermore, a previous study has shown that mappability varies greatly between species and gene classes 
 <cit> . in rna-seq analysis, the quantification of gene expression will thus be affected by the existence of paralogous sequences. the problem becomes apparent when we perform differential expression analysis between species. a gene may be falsely identified as differentially expressed gene due to differences in mappability between species.

here, we first analyzed the bias in estimating inter-species difference in expression caused by inter-species difference in mappability based on current annotations, using a published dataset consisting of rna-seq and high-density exon array. we then created a pipeline named xsanno, which generated a model of orthologs by combining whole genome alignment, local alignment and multiple filters to remove regions with difference in mappability  between species. the steps in our computational pipeline are inspired by common practice for annotating orthologous regions, but were modified to suit the specific aim of comparative transcriptome analysis. to assess our method, we performed rna-seq on dorsolateral prefrontal cortex  of  <dig> humans,  <dig> chimpanzees and  <dig> rhesus macaques and benchmarked the performance of xsanno on identifying differentially expressed  genes between species, by comparing with annotations used in previous studies 
. validation by ddpcr revealed that our approach greatly reduced the false positives, while keeping the number of false negatives low.

RESULTS
differences in mappability between species skew gene expression comparisons
to assess the effects of inter-species difference in mappability on estimating inter-species difference in expression using current annotations, we took advantage of a published dataset including rna-seq and high-density human exon junction array data from cerebellum of human, chimpanzee and rhesus macaque 
 <cit> . the rna-seq data included a total of five lanes of 36 bp single-end reads with two technical replicates for human and macaque and one lane for chimpanzee . the microarray data included  <dig> replicates of human, chimpanzee and rhesus macaque cerebellum samples . to avoid bias in gene expression quantification, only microarray probes that perfectly matched the genome sequences of all three species were used. as microarray probes were designed to uniquely detect a set of known genes, microarrays are less biased by inter-species differences in mappability than rna-seq. therefore, we tested the performance of annotations generated by two most widely used approaches by comparing them with the microarray data. one set of annotation was built based on ensembl annotation  
 <cit>  through whole genome alignment as described in the original study and other studies 
 <cit>  . the other set was originally built in blekhman et al. 
 <cit>  and updated in primate orthologous exon database , which includes a catalog of unique, non-overlapping, 1:1: <dig> orthologous exons of human, chimpanzee and rhesus macaque indentified through local alignment from ensembl annotation.

in the wga annotation,  <dig>  human-chimpanzee orthologs and  <dig>  human-macaque orthologs were shared with microarray. in poed annotation,  <dig>  1:1: <dig> human-chimpanzee-macaque orthologs were shared with microarray. to identify genes with difference in mappability , we generated ten lanes of simulated rna-seq  reads per species based on each set of annotation, with the setting that all the transcripts were equally expressed. dim genes were identified by deseq 
 <cit>  with fdr <  <dig> , using s-rna-seq data. we then plotted the inter-species difference estimated by rna-seq data against inter-species difference estimated by microarray data . dim genes in wga annotation showed larger inter-species difference than genes with consistent mappability between species  based on rna-seq . on the contrary, dim genes showed similar inter-species difference to consistent genes based on microarray . the difference between rna-seq and microarray suggested that variations in mappability affected the estimation of inter-species difference. as expected, poed annotation included fewer genes with variant mappability between species, because it is a set of orthologs shared by three species and built with local alignment, which is more stringent in terms of sequence conservation, compared with wga annotation . we observed similar larger inter-species difference of dim genes estimated by rna-seq than by microarray using poed annotation . besides, more genes with no s-rna-seq reads aligned were identified using poed annotation, suggesting shortened gene length during the process of ortholog identification . the inter-species differences of these genes were also more dispersed from  <dig> in rna-seq than in microarray , suggesting that the gene expression cannot be well represented if the gene model is truncated too much in the process of ortholog identification.figure  <dig> 
the effects of different mappabality between species on estimating inter-species gene expression differences. inter-species gene expression differences estimated by rna-seq were plotted against inter-species differences estimated by microarray, using wga annotation  and poed annotation . the inter-species differences were calculated as log <dig> fold change of rpkm  or intensity . the rug plots along x and y axes show the distribution of interspecies differences estimated by microarray and rna-seq, respectively. dim genes  and genes without simulated reads mapped  show larger inter-species variation in rna-seq than in microarray.  comparison between human and chimpanzee .  comparison between human and rhesus macaque .



another problem with using only local alignment is the loss of syntenic information of genome. in poed annotation, we found some human orthologs in chimpanzee or macaque with exons located in unreasonably distant genomic regions. for example, in poed, the length of rin <dig> is around 130 kb in human, but ~ 125 mb in macaque, including an 125 mb intron.

outline of the xsanno framework
to fit the aim of rna-seq analysis, we developed the xsanno framework for annotating orthologous regions for cross-species gene expression comparisons. xsanno integrates whole genome alignment, which preserved syntenic information of genome and local alignment, which removes exons that are not highly conserved in sequence with multiple filters, which filters out exons and genes with varied mappability between species :figure  <dig> 
the xsanno pipeline. pipeline for building ortholog annotation. blue boxes denote exons and red crosses label the exons or transcripts filtered out.

 our pipeline started with whole-genome alignment , which preserves syntenic information of the genome. we use ucsc liftover tool  <cit> , which converts the genome coordinates between species based on whole genome alignment. we select one species , usually the one with better annotation, as reference species and lift the annotation to the other species . the lifted annotation on sp <dig> is then lifted back to the genome of sp <dig>  the parameters of liftover are carefully selected by bootstrapping . in the process, we filter out exons that cannot be lifted from sp <dig> to sp <dig>  exons cannot be lifted back to the original genomic location of sp <dig>  and transcripts without all exons lifted to the same chromosome or strand.

 we then perform local alignment  to remove exons that are not highly conserved in sequence and exons that may cause ambiguity in rna-seq read mapping. we align the exons from step one of both species to their reference genome and the reference genome of the other species, respectively, using blat  <cit> . only exons with a unique conserved ortholog but without highly conserved paralogs are kept. thresholds of inter- and intra-species percent identity  and percentage of mapped length  are chosen to maximize the number of retained exons .

 finally, we filter out dim exons and genes. we generate simulated rna-seq data using simngs  <cit>  , incorporating sequencing errors, and setting all transcripts to be equally expressed. with this setting, exons and genes with different mappability of s-rna-seq reads show statistically significant differential expression and are therefore removed. besides, we remove genes that are truncated too much .



generation of human-chimpanzee and human-macaque annotations by xsanno
as an example of comparisons between closely-related species, our pipeline was first applied to generate human-chimpanzee orthologous genes based on human gene annotation  
 <cit> , human reference genome  
 <cit> , and chimpanzee reference genome  
 <cit> . starting with  <dig>  genes  in ensembl human gene annotation, we identified  <dig>  human-chimpanzee orthologous genes, including  <dig>  protein-coding genes . higher conversion rates were observed for protein-coding genes and lincrnas,  <dig> % and  <dig> %, respectively .table  <dig> 
number of genes in the annotation




as expected, the application of xsanno to human and rhesus macaque, a pair with a more distant evolutionary relationship, identified fewer orthologs. we identified  <dig>  human-macaque orthologous genes, including  <dig>  protein-coding genes . compared with human-chimpanzee orthologs, the decrease in human-macaque orthologs mainly occurred in non-protein-coding genes, particularly pseudogenes  due to the existence of highly conserved paralogs.

the xsanno started with wga annotation and filtered exons and genes which were not highly conserved in sequence or different in mappability between species. the xsanno genes were shorter than wga genes, as expected, but longer than poed genes .

each filtering step filtered out genes with large variation in mappability between species . the genes filtered out displayed larger inter-species variation compared with the remaining genes in rna-seq , but not in microarray , suggesting rna-seq overestimated inter-species differences of these genes.figure  <dig> 
assessment of filtering steps in xsanno using published data. comparison of inter-species difference estimated by rna-seq and inter-species difference estimated by microarray, using wga annotation  and using wga+la annotation . genes filtered out in step  <dig>  and step  <dig>  are labelled red. these genes display larger inter-species difference using rna-seq data than using microarray data.  comparison between human and chimpanzee .  comparison between human and rhesus macaque .



testing the performance of xsanno on differential expression analyses
since the above used published dataset consists of only two technical replicates for human and macaque and no replicates for chimpanzee, it lacks statistical power to identify differentially expressed  genes. furthermore, the samples were sequenced as 36 bp single-end reads. therefore, we performed mrna-seq  of dfc tissue from  <dig> chimpanzee and  <dig> rhesus macaques  and compared with the complementary mrna-seq dataset of  <dig> human dfc samples generated by the brainspan project  . the resulting sequencing reads have been deposited to the national center for biotechnology information  short-read archive under the accession number prjna <dig> 

the xsanno human-chimpanzee annotation covered  <dig> % chimpanzee rna-seq reads, which was lower than  <dig> % in wga annotation as expected, but greater than  <dig> % in poed .  <dig> % of the human-expressed xsanno orthologs were also expressed in chimpanzee. similarly, the xsanno annotation for human and macaque covered  <dig> % macaque rna-seq reads, greater than  <dig> % in poed .  <dig> % of the human-expressed xsanno orthologs were also expressed in rhesus macaque. besides, wga annotation annotates  <dig> % and  <dig> % junctions identified by tophat 
 <cit>  in chimpanzee and macaque, respectively, indicating that the gene structures were preserved in the first step of ortholog identification in our pipeline. the filters applied later reduced the coverage of junctions, but still maintained majority of the junctions, suggesting that our annotation can also be implemented in analyzing alternative splicing .

to assess the filtering steps in xsanno pipeline, we first compared the inter-species difference of included genes with that of excluded genes. the genes filtered out in each step showed larger estimated inter-species variation than that of genes remained . to rule out the possibility that our filters selectively removed differentially expressed genes, we compared the inter-species variation of exons from the same gene. similar to the expression of genes, the expression of retained exons was less variable between species than that of excluded exons from the same gene .

since our annotation was designed for cross-species expression comparison, we first assessed the performance of each filtering step in our pipeline. the number of dex genes was dramatically reduced after filtering . for validation, we intersected the human-chimpanzee dex gene list and the human-macaque dex gene list to differentially expressed in human compared with both chimpanzee and macaque . the top  <dig> human dex genes found only in the wga annotation, the top  <dig> human dex genes in the wga + la annotation but not in the xsanno annotation, and the top  <dig> human dex genes in the xsanno annotation were selected for validation by droplet digital pcr  . as expected, our approach performed better between species with closer evolutionary distance. in the comparison between human and chimpanzee, the number of false positives reduced from  <dig> using wga annotation to  <dig> using xsanno annotation, while the number of false negatives remained at  <dig> . in the comparison between human and macaque, the number of false positives reduced from  <dig> using wga annotation to  <dig> using xsanno annotation, while the number of false negatives rose to  <dig> . sequence analysis of the genes identified as human dex only in wga or wga + la annotation revealed the existence of highly conserved paralogs in one species but not in the other, which explained the difference in mappability between species . among the genes we validated, our pipeline reduced the false positives and kept the false negative rate low, compared with wga and poed annotations .figure  <dig> 
the performance of xsanno in inter-species differential gene expression analysis. validation by ddpcr. the number of false positives reduced, while the number of false negatives kept low throughout xsanno filtering steps. hp: comparison between human and chimpanzee; hm: comparison between human and macaque. fp: false positive; fn: false negative.



CONCLUSIONS
we described a pipeline to build ortholog annotations for comparative transcriptome analysis between closely-related species. the xsanno pipeline incorporates previous whole genome alignment and local alignment methods with multiple filters to eliminate false positives caused by differences in mappability. even though our pipeline was tested on human and non-human primate brain transcriptome data, it is not limited to these species.

our pipeline aims to generate annotation of a conservative set of orthologs to avoid false positives in cross-species analysis. therefore, it excludes genes with high rate of dna changes and genes with highly conserved paralogs. although the level of conservation can be adjusted by tuning parameters in the pipeline to meet specific requirements of each study, separate approaches would be necessary to study genes with large structure changes and duplicated genes.

compared to existing ortholog databases, the xsanno pipeline provides a more flexible way to identify orthologs between any pair of closely-related species. it generates gene models that are specifically designed for comparative transcriptome analysis. rna-seq and ddpcr validation suggest that our approach reduced false positives in cross-species expression analysis, while keeping the false negative rate low. the xsanno package and pre-processed ortholog annotations of selected species are available in additional file  <dig> and can be downloaded at http://medicine.yale.edu/lab/sestan/resources/index.aspx.

