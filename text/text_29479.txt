BACKGROUND
the human genome is composed of billions of heritable non-static epigenetic arrangement of histone and dna sequence that controls how genes are expressed  <cit>  dna methylation, along with some other covalent modifications of histone or dna sequences, have regulatory control over gene expression. in  <dig>  two key publications have suggested that methylation of cytosine residues in the context of cpg dinucleotide could be an epigenetic marker of dna sequences  <cit> . a large majority of cpg islands of the vertebrate genome reside in or near the promoter regions  <cit> . since then, dna methylation has been intensively studied and, specifically, dna methylation in promoter regions has been shown to be associated with cell development, tumor progression, and aging 

through years of efforts, many experimental methods have been developed to assay the methylation status of cpg in a genome-wide manner. currently, the golden standard of genome-wide profiling of dna methylation is the whole genome bisulphite sequencing, which involves treatment of sodium bisulphite followed by high throughput sequencing   <cit> . however, there are two major disadvantages for bs-seq. firstly it requires genome-wide deep sequencing in order to precisely identify modification at base-pair level, which currently is not cost effective. secondly, datasets generated by bs-seq might also give rise to alignment difficulties due to c/t modification. on the other hand, affinity-based method, such as methylated dna immunoprecipitation followed by high throughput sequencing   <cit>  and methyl-cpg binding domain-based capture followed by high throughput sequencing   <cit> , are established as alternatives to bs-seq for genome-wide dna methylation profiling which are more cost effective. it has been shown that medip-seq is more sensitive to highly methylated, high-cpg densities regions and mbdcap-seq is more sensitive to highly methylated, moderate-cpg densities  <cit> .

mbdcap-seq approach uses methyl-cpg binding domain of the mbd <dig> protein to capture double-stranded dna, combined with subsequent high throughput sequencing, to systematically identify methylated regions in the genome. there are some unique characteristics of mbdcap-seq. dna methylation profiling by mbdcap-seq is biased by underlying cpg properties of the genome, more precisely,, methylated regions with high gc contents are more likely to be eluted than regions with low gc contents. in terms of quantification of dna methylation levels and the determination of differential methylation , current methods used for testing of differential methylated regions  generally do not take the sample specific background noise during mbd capture, which is caused by non-specific pull-down behavior of methyl-cpg binding domain, into consideration. last but not least, up till now, there is no software that is designed specifically for processing large mbdcap-seq datasets. previously, we developed an algorithm called bimmer for testing genome-wide differential methylation, where we constructed a two-layer hidden markov model  to model the differential methylation status  <cit> . however, because of the complexity of the algorithm and the nature of expectation-maximization  solution, bimmer is relatively slow in speed and is not suited for analyzing mbdcap datasets in large scale. our aim for the study presented here is to provide an efficient computational pipeline specifically designed for identification of dm genes by using mbdcap-seq protocol.

methods
genome-wide mbdcap sequencing for prostate cancer patient samples
mbdcap-seq protocol was carried out to identify methylated regions across the genome for a set of prostate cancer samples as listed in table  <dig>  total of  <dig> primary prostate tumors derived from patients that have different clinical outcome  and  <dig> no evidence of disease ) were processed and sequenced. methylated fragments, bound to a methyl-cpg binding domain protein, were eluted for sequencing with the illumina hiseq  <dig> sequencer with 50 bp single read  sequencing module. approximately  <dig> million sequence reads were generated and around 78 % reads were mapped to unique genome locations for all  <dig> samples. the mbdcap-seq analysis pipeline is:table  <dig>  <dig> prostate tumor samples profiled with mbdcap

apply fastqc to short read sequences to examine sequencing qc and other characteristics of sequence reads. extract the file fastqc_data.txt for gc enrichment analysis;

perform bwa aligner to align sequence reads to ucsc human genome build hg <dig>  <cit> ;

remove sequence reads with equal and more than 2 bp mis-match and non-uniquely mapped to the genome;

sort, convert and index bam file for each sample;

count number of reads in 100 bp bins tiling through entire genome by using bedcoverage/bedtools  <cit> ;

count number of reads within 4kbp regions ) of each gene by using bedcoverage tool.



determination of gc enrichment
normal human genome has gc content percentage roughly around 40 % . the fastqc algorithm generates a gc counting statistic from all reads in fastqc_data.txt. if a sample contains portion of dna that are enriched in gc content, we expect to see a shifted distribution, as illustrated in the results section fig.  <dig>  to the right side of the normal genomic dna gc distribution. thus, by assuming a mixture model of  <dig> gaussian distributions , or g = p1n + p2n, where p1 + p2 =  <dig>  we can determine gc enrichment score,fig.  <dig> workflow for mbddiff and simulation procedure

fig.  <dig> roc curves of mbddiff, medips and deseq for simulated datasets in different scenarios. roc curves for simulated mbdcap-seq datasets with low, intermediate or high level of background noise with  <dig> number of replicates in each group, 10 % of dm promoters with  <dig> fold of difference ; different levels of background noise but only for highly methylated promoters above 75 % quantile of methylation levels ; different levels of background noise but only for lowly methylated promoters below 25 % quantile of methylation levels ; roc curves for simulated mbdcap-seq datasets with low, intermediate or high level of background noise with  <dig> number of replicates in each group, 10 % of dm promoters with  <dig> fold of difference ; simulation was carried out  <dig> times and the average results is used

fig.  <dig> false discovery curves of mbddiff, medips and deseq for simulated datasets in different scenarios. false discovery curves for simulated mbdcap-seq datasets with low, intermediate or high level of background noise with  <dig> number of replicates in each group, 10 % of dm promoters with  <dig> fold of difference ; different levels of background noise but only for highly methylated promoters above 75 % quantile of methylation levels ; different levels of background noise but only for lowly methylated promoters below 25 % quantile of methylation levels ; false discovery curves for simulated mbdcap-seq datasets with low, intermediate or high level of background noise with  <dig> number of replicates in each group, 10 % of dm promoters with  <dig> fold of difference ; simulation was carried out  <dig> times and the average results is used

fig.  <dig> statistical power of mbddiff, medips and deseq for simulated datasets in different scenarios. bar plot of statistical power for simulated mbdcap-seq datasets with low, intermediate or high level of background noise with  <dig> number of replicates in each group, 10 % of dm promoters with  <dig> fold of difference ; different levels of background noise but only for highly methylated promoters above 75 % quantile of methylation levels ; different levels of background noise but only for lowly methylated promoters below 25 % quantile of methylation levels ; bar plot of statistical power for simulated mbdcap-seq datasets with low, intermediate or high level of background noise with  <dig> number of replicates in each group, 10 % of dm promoters with  <dig> fold of difference ; simulation was carried out  <dig> times and the average results is used

  <dig> es=p2μ2−μ1/p1× <dig> 

we initialized the model fitting with following parameters , μ1 =  <dig>  μ2 =  <dig>  and p1 = p2 =  <dig> . for our default setting , es =  <dig> . if only 20 % reads are enriched for gc content , we will have es =  <dig> , assuming other parameters stay the same. we select samples with es >  <dig> , otherwise, samples will be discarded without further data analysis.

construction of reference regions to measure background noise
gene annotation  of human genome hg <dig> build was downloaded using ucsc table browser . promoter regions were defined as regions ranging from  <dig> kb upstream of tss to 2kb downstream of tss. we only kept one tss for transcripts with same tss. in total, we constructed annotation for  <dig>  promoters. to identify regions that potentially contribute to background noise, we built a 100 bp tiling window across the whole genome. we then used bedtools to count the number of mapped reads within each tiling window of the  <dig> prostate cancer samples. in order to identify the regions for measuring background noise, we applied following procedures:filtering step: we exclude any 100 bp genome-wide tiling windows that reside in promoter regions, predicted cpg islands regions and any windows that contain ambiguous bases ;

construction step: we then select preliminary background regions based on gc content as follows: for each promoter region, identify  <dig> 100 bp windows nearby that has low in gc content  and also relatively proximal to the corresponding tss; and

finalize background regions based on average transcript per million : for each promoter region, choose  <dig> out of  <dig> 100 bp windows that are relatively low in tpm  <cit>  as defined as tpm=rg×rl×106flg×∑grg×rlflg, where rg is the number of reads mapped to each 100 bp window, rl is the read length, flg is fragment length, in our case,  <dig> 



statistical framework and differential methylation testing of mbddiff algorithm
the read count for promoter region of gene i can be decomposed into two components, true signal si, which is directly associated with real methylation level, and background noise bi, which is attributed mainly to the random pull-down events from the wet-lab procedure of mbdcap-seq. previously, we have developed an algorithm, xbseq  <cit> , for testing for differential expression for rna-seq experiments. here we applied similar statistical framework for mbdcap-seq experiments. simply speaking, we assumed that the true signal  si possesses a negative binomial distribution and background noise bi follows a poisson distribution. then the observed signal  xi is a convolution of si and bi, which is governed by a delaporte distribution  <cit> . xi=si+bi   <dig> si~nbripi  bi~poissonλi 

we further assumed that background noise bi and true signal si are independent. by default, we applied a non-parametric method for parameter estimation. the poisson parameter λι for bi can be estimated as:  <dig> λi=1m∑j=1mbij where bij denotes estimated background noise for promoter i across m replicates for each condition. following the estimation of poisson parameter, we will be able to infer mean μsi and standard deviation σsi for each promoter region:  <dig> μsi=esi=exi−ebi   <dig> σsi2=σxi2+σbi2−2ρσxiσbi, 

then the parameters for negative binomial distribution can be estimated by  <dig> ri=μsi2/σsi'2−μsi   <dig> pi=μsi/σsi' <dig> 

where σsi' denotes adjusted variance for si. this has proven to be useful when the sample size is small  <cit> . details regarding non-parametric parameter estimation can be found in our previous publication of xbseq  <cit> .

when sample size is relatively large , the maximum likelihood estimation  is applied to estimate parameters. the likelihood function is given by  <dig> lθi=∏j=1mpxij|αi,βi,λi⋅∏j=1mpbij|λi=∏j=1m∑k=0xijΓαi+kβikλixij−ke−λiΓαik!1+βiαi+kxij−k!⋅∏j=1mλibije−λibij! which has no closed form. broyden–fletcher–goldfarb–shanno  algorithm is used to estimate the parameters by iterative updating. αi and βi are parameters for gamma portion of delaporte distribution which are related to negative binomial parameters by:  <dig> ri=αi   <dig> pi=1/βi+ <dig> 

after successful estimation of all parameters, differential methylation testing of each promoter between two groups  will be carried out by using moderated fisher’s exact test:  <dig> p=∑pab≤pxypab∑allpab where a and b are constrained by a + b = x + y

simulation
in order to evaluate the performance of our method, we generated a set of simulated datasets where we can control the differential methylation status of each promoter region. in this study, true signal s was simulated from a negative binomial distribution and background noise b was simulated from a poisson distribution with parameters estimated from real mbdcap-seq datasets. we compared mbddiff with medips  <cit> , an r package designed for general purpose dna fragments enrichment experiments, such as medip-seq and mbdcap-seq for their ability to detect differntially methylated regions. we also compared mbddiff with deseq  <cit> , an algorithm originally designed for differential expression analysis where the background noise is not considered for testing of expression difference between two conditions. we choose deseq algorithm due to the fact that it has similar signal distribution assumption  and differential test statistic .

we followed a similar simulation procedure described in xbseq. basically, to estimate model parameters from a given mbdcap-seq dataset,  <dig> promoters were randomly selected with replacement after discarding promoters with relatively low mapped reads or larger dispersion . the true signal s was simulated from a negative binomial distribution based on the mean and variance estimated from the  <dig> promoters. 10 % or 30 % of the promoters were selected to be differentially methylated with enrichment fold change either  <dig> or  <dig>  we simulated experiments with either  <dig> or  <dig> replicate samples per group to examine the potential effect of the number of replicates. to simulate background noise b, we first simulated read counts for the selected 100 bp windows. then for each promoter region, background noise b was the summation of the read counts from all the corresponding 100 bp windows. we generated background noise in three different scenarios, with different level of dispersion, to examine the performance of our method in normal and noisy conditions. background noise with different dispersion levels were simulated for each 100 bp window from a hybrid model:  <dig> binc~m*normμσ where μ is from a poisson distribution μ ~ poisson. in our simulation, we set m =  <dig>  σ =  <dig>  the noise factor nf can be chosen from  <dig>   <dig>   <dig>  each represents experiments with low background noise, intermediate background noise and high background noise. simulations were repeated  <dig> times and statistical metrics were evaluated based on the average performance.

we evaluated different algorithms  for their ability to discriminate between differentially methylated and non-differentially methylated promoters in terms of the following metrics: area under the roc curve, number of false discoveries, statistical power, false discovery rate at pre-selected p value cutoff, distribution of p values under null model where there are no differentially methylated promoters. we also examined the performance of different methods separately for lowly and highly methylated promoters to see whether the performance is affected by methylated level of the promoter.

in order to investigate performance of different methods when the underlying model assumption can not be met. we simulated true signal from normal distribution with parameters estimated from a real mbdcap-seq dataset and background noise from either normal or uniform distribution to see whether the performance of different methods is affected or not. for instance, to simulate background noise from normal distribution. we also applied equation . the difference is that, the parameter μ is from a normal distribution with parameters estimated from a real mbdcap-seq dataset.

additional dna methylation datasets for testing
in addition to our in-house prostate cancer samples, we also applied our method mbddiff to previously published mbdcap-seq datasets where we compared endometrial cancer patient with either recurrent or non-recurrent outcome.  <dig> patients in each group were selected and processed with different methods to identify potential factors that contribute to endometrial cancer recurrence. details about the experiments can be found in gse <dig>  <cit> .

similarly, we also selected and processed three tumor and normal samples from public domain dataset gse <dig>  where mbdcap-seq were carried out to investigate dna methylation profile for tripe negative breast cancers   <cit> .

comparison with other software for mbdcap-seq datasets
we also compared our algorithm with some other methods for mbdcap-seq datasets, including medips , deseq . all these evaluations were carried out under r version  <dig> . <dig> and bioconductor version  <dig> . details regarding simulation procedure and workflow of mbddiff is illustrated in fig.  <dig> 

RESULTS
implementation of mbddiff
in order to use mbddiff, we need to construct species specific background annotations that will be used to measure background noise for mbdcap-seq datasets. several background annotation files have already been constructed and can be downloaded from github page . please follow instructions from mbddiff package if you want to construct background annotation for your organism of choice. currently mbddiff uses bedtools to count reads mapped to promoter and background regions. so users need to have bedtools installed on their computer.

after counting reads mapped to promoter and background regions, mbddiff then applies quality control procedure to examine the quality of mbdcap-seq datasets. differential methylation testing will be carried out by xbseq algorithm. in addition, mbddiff also provides a set of visualizing tools for mbdcap data analysis.

discrimination between dm and non-dm promoters
in order to compare mbddiff, medips and deseq for processing mbdcap-seq datasets, we generated synthetic datasets when the differential methylation status and fold change of each promoter region can be controlled. we followed the simulation procedure described in the methods section. briefly, methylation levels from  <dig> promoter regions and their corresponding background noise were simulated with model parameters estimated from a given prostate cancer mbdcap-seq dataset. among  <dig> promoter region simulated, 10 % or 30 % promoters were designated for enrichment fold-change at  <dig> or  <dig>  different background noise levels were simulated and all statistical metric calculation were reported as an average over  <dig> repeats.

we first compared the three methods for their ability to discriminate between differentially methylated and non-differentially methylated promoters in terms of the area under the receiver operating characteristic  curve . as shown in fig.  <dig> and additional file 1: table s <dig> and s <dig>   <dig> sample per group generally performed better than  <dig> samples per group in terms of auc under various conditions. overall, mbddiff performs better with a higher auc compared to medips and deseq with different levels of background noise. for instance, under the condition of  <dig> samples per group, 10 % of differentially methylated promoters and 2-fold difference between two groups, mbddiff achieved auc  <dig>  when background noise is relatively low, while the aucs for medips and deseq are  <dig>  and  <dig>  respectively. even though all three methods have decreased auc when background noise is increased , mbddiff is relatively resistant to higher background noise and performs much better even when the background noise is at very high level. we then examined the performance of the three methods separately for highly methylated  and weakly methylated  promoters. mbddiff performs only slightly better compared to medips and deseq for highly methylated promoters . however, for weakly methylated promoters, mbddiff performs much better than medips and deseq which indicates that background noise estimation procedure is essential for accurate dm detection under weakly methylation condition .

control of false discoveries
we then compared the performance of mbddiff, medips and deseq in terms of the false discoveries encountered among the top ranked differential methylated promoters based on p value. overall, mbddiff picked up the least number of false discoveries in various conditions . for example, under the condition of  <dig> samples per group, 10 % of differentially methylated promoters and 2-fold difference between two groups, mbddiff identified  <dig> out of  <dig> number of false discoveries compared to medips  and deseq  when the background noise has relatively low dispersion. when the background noise is increased, mbddiff also picked up increased number of false discoveries , but is relatively resistant to the increase of background noise compared to medips  and deseq . we also took a similar approach to examine the three methods separately for highly methylated  and weakly methylated  groups. the three methods picked up similar number of false discoveries for highly methylated promoters . however, for weakly methylated promoters, mbddiff again performs the best with lowest number of false discoveries encountered . we also examined false discovery rate at pre-selected p value cutoff . mbddiff has relatively low false discovery rate  compare to medips  and deseq . overall, mbddiff is more robust against false discoveries compared to medips and deseq especially for weakly methylated promoters even when the background noise is relatively high.

statistical power
finally, we compared mbddiff, medips and deseq in terms of the statistical power at selected cutoff . as shown in fig.  <dig> and additional file 1: table s1& <dig>  medips performs the best when the background noise is relatively low. however, when we increased the dispersion of background noise, mbddiff became the best method with the largest statistical power. for instance, under the condition of  <dig> samples per group, 10 % of differentially methylated promoters and 2-fold difference between two groups, mbddiff achieved statistical power of  <dig>  compared to medips  and deseq  when the background noise is relatively low. however, when the background noise is higher, mbddiff performs better with statistical power of  <dig>  compared to medips  and deseq . similarly, we also compared statistical power of the three algorithms separately for highly methylated  and weakly methylated  promoters. for highly methylated group, medips performs slightly better than mbddiff as shown in fig. 4b and additional file 1: figure s1e. in contrast, for weakly methylated groups, mbddiff performs much better than medips when the background noise is relatively high . overall, mbddiff remains one of the best method in terms of statistical power in various conditions and is more robust against the increase of background noise.

apply mbddiff to prostate cancer datasets
we recently carried out mbdcap-seq to examine whole genome dna methylation profile in prostate tumors in order to identify potential factors that are involved in the development of prostate cancer after treatment. we excluded one patient sample because of a relative different gleason score from other  <dig> samples. then we applied mbddiff to  <dig> samples in order to identify differentially methylated promoters between met group and ned group. as shown in fig.  <dig>  there is a clear enrichment of gc content for highly methylated regions, which indicates the effectiveness in mbd <dig> capture procedure for our prostate samples. the enrichment of gc content was further assessed in fig.  <dig>  where  <dig> samples  were selected and their gc enrichment scores are  <dig>  an  <dig> , respectively. figure  <dig> showed the distribution of background noise and promoter regions. we also examined the relationship between tumor samples. as we can observe from fig.  <dig>  patients with ned outcome are more dispersed than patients with met outcome which might suggests a common mechanism for prostate cancer metastasis. after performing differential methylation algorithm, we identified  <dig> differentially methylated promoters with absolute log <dig> fold change greater than  <dig>  p-value smaller than  <dig>  and averaged methylation levels greater than  <dig> . ano <dig>  a gene hyper-methylated in prostate cancer identified by our study, has been reported that it may act as a target gene for antibody-based immunotherapy  <cit> . f13a <dig>  which is also identified as differentially methylated, is associated with bone metastasis in prostate cancer  <cit> . to conclude, by using mbddiff, we were able to identify  <dig> promoters that were differentially methylated between met and ned. this set of genes might be of helpful for future studies of prostate cancer metastasis.fig.  <dig> gc enrichment assessment. we perform gc enrichment test for all samples processed with mbdcap-seq protocol. a enrichment score  of  <dig>  were detected for a met sample. the dash lines are two gaussian mixture models . es score is evaluated by using eq.  <dig>  b es of  <dig>  for a ned sample. both samples pass the threshold of >  <dig>  requirement. in both  and , blue-line is the empirical density from the actual data, and red-line is the mixture model density. both figure showed a tight estimation

fig.  <dig> apply mbddiff to prostate cancer datasets.  density plot of gc content grouped by different levels of methylation for all 100 bp windows across the whole genome of one example prostate met sample;  distribution of background noise and promoter counts;  3d pca plot of sample relation. c indicates ned patients and t indicates met patients;  heatmap of selected promoters for  <dig> prostate cancer samples



apply mbddiff to breast cancer datasets
to demonstrate the functionalities of mbddiff, we also applied mbddiff to a public dataset derived from tnbcs . we selected and processed  <dig> samples in both tumor and normal conditions. firstly, mbddiff assessed the quality of the samples by examining the gc enrichment for all 100 bp windows with different levels of methylation. as shown in fig.  <dig>  there is a clear enrichment of gc content for regions with higher mapped reads compared to ones with lower mapped reads which potentially contribute to background noise. after quality assessment, mbddiff continued to estimate the context-specific background noise for each sample based on the preliminary background annotation. as shown in fig.  <dig>  background noise clearly coincides with the left hump of promoter mapped reads, indicating that the background noise we estimated indeed reflects the nature of mixture model for our observation. mbddiff also provides some visualization functionalities including 3d principal component analysis  to examine sample relationship based on dna methylation levels of promoter regions, more versatile heatmap visualization of dna methylation levels across samples, etc. alternatively, you can also generate an html report that contains several dynamic visualizations. details can be found at our github page: https://github.com/liuy12/mbddiff.fig.  <dig> functionalities for mbddiff for processing tbnc datasets. a density plot of gc content grouped by different levels of methylation for all 100 bp windows across the whole genome of one example tnbc sample;  distribution of background noise and promoter counts;  3d pca plot of sample relation, t indicates tumor samples, n indicates normal samples;  heatmap of selected promoters for  <dig> tnbc samples



as illustrated in fig.  <dig>  there is a clear separation between tnbc tumor and normal samples. figure  <dig> showed heatmap of methylation levels of selected promoters across all samples . finally, mbddiff performed differential methylation statistical tests based on xbseq. very interestingly, the dispersion for promoters showed a ‘s’ shape curve caused by promoters with either very small or very large dispersions, which probably is due to the artifacts of methylation measure from the mbdcap-seq protocol . differential methylated promoters are identified by selecting promoters with absolute log <dig> fold-change greater than  <dig>  adjusted p-value less than  <dig>  and averaged methylation levels greater than  <dig>  additional file 1: figure s3b showed the ma plot after differential methylation tests. with this stringent selection criterion,  <dig> unique promoters with significant differential methylation were obtained . interestingly, by using david  <cit> , we found that the genes of these promoters are enriched in biological processes, including regulation of transcription  and regulation of neuron differentiation , which might indicate the involvement of neuronal stem cell regulators in tnbcs  <cit> .

apply mbddiff to endometrial cancer datasets
finally, we applied mbddiff to our previously published dataset where mbdcap-seq procedure was carried out to examine the global methylation patterns for a total of  <dig> primary samples in endometrial cohorts, breast cancer cohorts and breast cancer cell lines . for the purpose of testing our algorithm, we randomly selected three samples from endometrial cancer patients with either recurrent or non-recurrent outcome to identify potential factors that contribute to recurrence of endometrial cancer. after alignment procedure with bwa, the six samples were processed with mbddiff. as shown in fig. 8a, there is a clear enrichment of gc content for regions with relatively high methylation levels, which indicates that the dataset generated is of good quality. figure 8b shows the distribution of background noise and true signal. then mbddiff assesses sample relationship based on methylation patterns of promoter regions. as shown in fig. 8c, there is a clear separation between patients with recurrent and non-recurrent outcome. figure 8d shows heatmap of promoter regions that are differentially methylated between the two groups. finally, differential methylation test was carried out to identify potential factors that might cause recurrence of endometrial cancer. totally we identified  <dig> differentially methylated promoters with fold change larger than  <dig>  adjusted p value smaller than  <dig>  and average mean methylation level bigger than  <dig>  compared to original paper we identified much less number of differentially methylated regions, the reason might be: 1) we only focus on differential methylation testing for promoter regions; 2) we only used  <dig> patient samples in each group. among all the differential methylated genes, dkk <dig> has been shown to be a novel biomarker for endometrial carcinoma.fig.  <dig> apply mbddiff to endometrial cancer datasets. a density plot of gc content grouped by different levels of methylation for all 100 bp windows across the whole genome of one example endometrial sample with recurrence outcome;  distribution of background noise and promoter counts for one example endometrial sample with recurrence outcome;  3d pca plot of sample relation, r indicates samples with recurrence outcome, nr indicates samples with non-recurrence outcome;  heatmap of selected promoters for  <dig> samples



discussion
in order to compare mbddiff, medips and deseq, we carried out simulation procedure to generate datasets with different levels of background noise. then we compared the three methods in terms of various statistical metrics. as we showed in the results section, mbddiff generally outperformed medips and deseq in terms of auc  and number of false discoveries . in terms of statistical power, medips performed slightly better than the other two methods when the background noise is relatively low. however, with higher background noise, mbddiff has a better statistical power compared to medips and deseq. taken together, mbddiff is more robust against higher background noise for accurately identifying differentially methylated promoters.

as designed in the simulation procedure, true signal was simulated from negative binomial distribution and background noise from poisson distribution. while these are commonly consented models for data generated from ngs protocols, real data may deviate from nb and/or poisson distributions. to investigate whether there is a potential bias with regards to the models we used for simulating true signal as well as background noise, we tested performance of the three methods with different models for true signal and background noise for simulation. firstly, we simulated the true signal from a normal distribution and background noise from poisson distribution . as shown in additional file 1: figure s2a, irrespective of which models we used for simulation, mbddiff performed better then the other two methods in terms of auc . all these three methods tend to perform better when negative binomial is used for simulating true signal as we expected: the simulated data derived from models match the underlying models in these algorithms. then we also tested the effect of using different models for simulating background noise . we used negative binomial model to simulate true signal but coupled with background noise derived from normal, uniform, or poisson distribution. as shown in fig s2b and additional file 1: table s <dig>  mbddiff outperformed medips and deseq, regardless of which noise model you use for simulating background noise. in summary, mbddiff is robust under different signal and background noise models. while for medips and deseq, they work better when uniform and poisson distributions  rather than normal distribution for background noise. potential bias can also be observed by examining the distribution of p values under a null hypothesis when no promoters are differentially methylated. as shown in additional file 1: figure s2d, p values generated by all three algorithms roughly follow the uniform distribution as we expected, with higher variation generated from medips.

we also benchmarked the three algorithms for experiments with different numbers of replicates. as shown in additional file 1: figure s <dig>  deseq consumes the most amount of time, followed by mbddiff and medips. higher computing cost for deseq and mbddiff with more replicate samples in each condition is mostly attributed to fisher’s exact test for assessing statistical significance.

CONCLUSIONS
we developed an r package, mbddiff, which aims specifically to process mbdcap-seq datasets. mbddiff provide users the ability to assess quality of datasets, test for differential methylation of promoter regions and visualization functionalities.

abbreviations
auc, area under the curve; bs-seq, bisulphite sequencing; dm, differential methylation; mbdcap-seq, methyl-cpg binding domain-based capture followed by high throughput sequencing; medip-seq, methylated dna immunoprecipitation followed by high throughput sequencing; met, metastasis samples; nb, negative binomial ; ned, no evidence of disease samples; roc, receiver operating characteristic.

additional file
additional file 1: supplementary information. supplementary figures and tables to provide additional analysis results. 



