BACKGROUND
over the past two decades, a wealth of high-dimensional biological data types have emerged including microarray, rna-seq, proteomics, epigenomics, metabolomics, lipidomics, and many others  <cit> . a common use of these data is to gather and compare samples from multiple conditions, e.g., disease and non-diseased, in an attempt to identify molecular identifiers  that distinguish between different conditions. currently, the most common method of comparing samples from different conditions is differential expression analysis  <cit> . recently, new methods for detecting differential co-expression or differential correlation analysis have emerged to gain insights into the difference in gene-gene relationships between various conditions of interest. distinct from differential expression, differential correlation operates on the level of gene pairs rather than individual genes . differential co-expression analysis can start with coexpressed gene modules or clusters based on the similarity of their gene expression in each condition using wgcna  <cit>  and megena  <cit>  and then computes module overlap statistics between conditions  <cit>  or the average modular differential connectivity  <cit> . alternative approaches including dicer  <cit> , dingo  <cit> , coxpress  <cit> , sdc  <cit> , diffcoex  <cit> , gsca  <cit> , and gsnca  <cit>  were developed to identify differential co-expression relationships between conditions and gene modules in each condition simultaneously.fig.  <dig> an example demonstrating the theoretical difference between differential expression and differential correlation. the top panel shows the rna expression levels for two example genes in two example conditions. the bottom left panel shows that both of these genes have decreased expression values from condition a to condition b. on the other hand, the bottom right panel shows that these genes have positive correlation in condition a but no correlation in condition b, which could not have been predicted on the basis of the differential expression relationships alone




while differential coexpression analysis has proven useful in identifying significantly different modular connectivity patterns, differential correlation analysis of individual gene pairs is far more granular. as an example of such a differential correlation, rna levels of the prostate cancer biomarker gene amacr have been found to have positive correlation with the tumor suppressor gene pten in adjacent normal tissue samples, but not in prostate cancer tissue samples  <cit> . multiple approaches for identifying differential correlation between individual gene pairs have been developed, including diffcorr  <cit> , ebcoexpress  <cit> , and discordant  <cit> . diffcorr calculates correlations in each condition and uses the difference in z-transformed correlation coefficients to calculate p-values. ebcoexpress uses an empirical bayesian approach and a nested expectation-maximization algorithm to estimate the posterior probability of differential correlation between gene pairs. discordant fits a mixture distribution of correlation classes in each condition and uses an expectation-maximization algorithm to estimate the posterior probability of each differential correlation category  <cit> .

in this manuscript, we introduce dgca, an r package to identify differential correlations between gene pairs in multiple conditions. dgca shares some features with existing approaches for identifying differential correlation. like diffcorr, dgca transforms correlation coefficients to z-scores and uses differences in z-scores to calculate p-values of differential correlation between genes. like discordant, dgca classifies differentially correlated gene pairs into the nine possible categories. however, dgca differs from the existing differential correlation approaches in four key ways. first, dgca calculates false discovery rate of differential correlations through non-parametric sample permutation. second, dgca can calculate the average difference in correlation between one gene and a gene set across two conditions. third, dcga integrates with megena to perform multiscale clustering analysis of differential correlation networks to identify gene modules  and hub genes. finally, dgca provides comprehensive downstream functional analysis of differential correlation structures including visualization, gene ontology  enrichment, and network tools.

to assess the performance of dgca and the existing methods ebcoexpress and discordant in identifying differentially correlated gene pairs, we designed and implemented a simulation study. next, we applied dgca to the breast cancer data from the cancer genome atlas  with and without p <dig> and pten coding mutations. we identified five genes with a significant change of correlation with tp <dig> in the p53-mutated samples, and two genes with a significant change of correlation with pten in the pten-mutated samples. we showed that each gene’s differential correlation with tp53/pten between p53/pten wildtype and inactivated samples is uncorrelated with its differential expression in this data set. by evaluating differential correlations between the overall correlation matrices, dgca allowed us to harness additional insights about the regulatory patterns among tp53’s targets following p <dig> mutation. we further performed dgca on the estrogen receptor-positive  and triple negative  breast cancer subtypes in the tcga breast cancer data and identified key gene ontology categories that differ in regulation between breast cancer subtypes. by integrating dgca with the multiscale clustering approach megena, we identified modules containing key hub genes that coordinate differential correlations between the two subtypes. we demonstrated that dgca/megena can better detect modules than the established approaches dicer and diffcoex in another simulation study. furthermore, we showed that a majority of the modules detected by dgca/megena in the tcga breast cancer data were not detected by diffcoex or dicer, while a majority of the modules detected by either diffcoex or dicer were uncovered by dgca/megena, revealing the novelty of our proposed module detection approach.

methods
differential correlation analysis flow
dgca has three main inputs including a matrix of gene expression values, a design matrix specifying conditions associated with samples, and a specification of the conditions for comparison . prior to the actual analysis, users have the option to filter the input expression matrix to remove genes with low expression central tendency and/or dispersion, since these genes are more likely to have spurious correlations. note that central tendency refers to measures of centrality in a distribution, including the arithmetic mean or median, while dispersion refers to measures of spread in a distribution, including the standard deviation and the dispersion index . to stabilize the variance of sample correlation coefficients in each condition, the fisher z-transformation is employed  <cit> :fig.  <dig> workflow for the differential gene correlation analysis  r package. users input a gene expression matrix, a design matrix to specify the conditions, and a comparison vector to specify which conditions will be compared. dgca then calculates the gene pair correlations within each condition, processes these correlation values, and compares them to build up a difference in correlation matrix. if permutation testing is chosen, dgca will perform the same procedure on permuted gene expression matrices. these permutation samples are used to estimate an empirical false discovery rate. after investigators choose the significance threshold for differential correlation between conditions  to choose downstream gene pairs, they can use dgca’s capacities for visualization, gene ontology  enrichment, and/or network construction


 z=atanhr=12loge1+r1−r where r is the sample correlation coefficient, log
e is the natural logarithm function, and atanh is the arc-tangent hyperbolic function. in this context, the fisher z-transformation function serves as a normalizing transformation. the variance of the resulting z-scores depends on whether the sample correlation coefficient is the pearson product-moment correlation coefficient  or the spearman’s rank correlation coefficient   <cit> . when the underlying distribution is assumed to be bivariate normally distributed, the variance can be calculated by varrp=1n−3orvarrs= <dig> n− <dig> where n is the sample size of the calculated correlation. notably, the variance of the correlation coefficients in a particular condition could differ due to a different number of samples or due to missing data in one or both of the genes’ expression measurements. these equations for the variance have been found to be valid over a wide range of sample sizes that are common in current biological data sets  <cit> . due to the denominator, the equations require that there are at least  <dig> samples in each condition considered. the difference in z-scores  between two conditions can then be calculated by, dz=|sz12−sz22| where szx <dig> refers to the variance of the z-score in condition x. using the difference in z-scores dz, a two-sided p-value can be calculated using the standard normal distribution. gene pairs can then be ranked on the basis of their relative strength of differential correlation.

multiple hypothesis testing correction
when testing for differential correlation between gene pairs in genome-wide experiments, the number of hypothesis tests grows quadratically in the number of genes. for example, differential correlation analysis of  <dig>  genes would require  <dig> , <dig> hypothesis tests. therefore, dgca offers several options for adjusting p-values for multiple hypothesis tests, including the conservative benjamini-hochberg p-value adjustment method  <cit>  and the local false discovery rate method  <cit> . however, even when using these options, it can be difficult to make intuitive sense of the p-values returned because the p-values are originally derived from the difference of z-scores method, which depends on specifying the correct form for the variance of the sample correlation coefficients, and in turn on the bivariate distribution of the gene expression values. therefore, dgca also offers to generate permutation samples by randomly shuffling the sample labels across the input conditions and then re-computing the differential correlation calls. the z-scores from the original and permuted data sets are used to calculate empirical p-values, using a reference pool distribution approach adapted from the r package qvalue  <cit> . these empirical p-values are used to estimate the proportion of null hypotheses in empirical p-values by extrapolating a linear trend from a cubic spline fitted over candidate ranges of the tuning parameter lambda  <cit> . then, q-values are calculated based on the empirical p-values and the estimated proportion of null hypotheses.

classifying differentially correlated gene pairs
at the most basic level, gene pairs can be classified as having gain of correlation  or loss of correlation  between one condition compared to another. for example, a gene pair with ρ =  <dig>  in a condition a and ρ =  <dig>  in a condition b is defined as having a gain of correlation in the condition a and a loss of correlation in the condition b. to go beyond this binary classification, we also determine if two genes are significantly correlated in each condition or not. by default and throughout this manuscript, the α threshold for statistical significance of the hypothesis test that the correlation in each condition is significantly different from zero is defined as p <  <dig> , although users can set different thresholds. this p-value is calculated based on the approximation that the correlation coefficient follows a t-distribution with n -  <dig> degrees of freedom, where n is the sample size of the calculated correlation  <cit> . the p-values associated with the hypothesis test of non-zero correlation in each separate condition are not adjusted for multiple tests by default. based upon a threshold for correlation significance and the sign of correlation in each condition , gene-gene correlations in each condition can be categorized into  <dig> classes, i.e. significant positive correlation, no significant correlation, and significant negative correlation. therefore, there are  <dig> classes for differential correlations between two conditions . dgca also allows users to perform downstream analyses of differential correlation classes, including heatmap visualization and gene ontology  enrichment analysis of the genes in each differential correlation class.fig.  <dig> definition of differential correlation classes. this diagram demonstrates the definition of differential correlation classes used throughout dgca in the case of two conditions. the default p-value significance level threshold  parameter setting for the hypothesis test of non-zero correlation in one individual condition in dgca and throughout this manuscript is  <dig> , although users of dgca can adjust this parameter if they choose to. in each condition, gene pairs are defined as having a non-significant correlation , a significant and positive correlation  > 0), or a significant and negative correlation  < 0). the cartesian product of the  <dig> possible correlation classes in one condition with the  <dig> in the other condition yields a total of  <dig> possible differential correlation classes. note that, theoretically, a gene pair with a significant positive correlation in one condition and a non-significant correlation in another condition may not be significantly differentially correlated between these conditions since the correlation class identification is independent of the differential correlation hypothesis test




calculating the average differential correlation between gene pairs
it is sometimes useful to measure the difference in average correlations of a gene and a set of genes between two conditions. dgca quantifies the median difference in z-transformed correlation coefficients of a gene and a gene set  between two conditions. in this context, a median difference in z-score above  <dig> indicates a tendency towards a gain of correlation between the given gene and the gene set in the first condition with respect to the second condition, while a median difference in z-score below  <dig> indicates a tendency towards a loss of correlation. to measure the significance of the median change in correlation, dgca leverages the permutation samples to calculate empirical p-values, as illustrated by the following equation, 1−∑pnj:j≠imeddzij>j:j≠imeddzijp/n where, med refers to the function for the median of a set, i is the gene for which the median difference in z-score is being compared between conditions, dz
ij is the difference in z-transformed correlation coefficients between genes i and j in the two conditions, p refers to a permutation, and n refers to the total number of permutations. as a generalization, dgca also offers to calculate the median difference in z-score between all gene pairs in two conditions. in this case, in order to calculate a two-sided p-value, the median is taken over all of the gene pairs using the following equation, 1−∑pni,j:i≠jmeddzij>i,j:i≠jmeddzijp/n 


this approach is similar to the modular differential correlation calculation that was previously described and used  <cit> .

simulated biological data and comparison with ebcoexpress and discordant
we designed a simulation study to assess the performance of dgca and the existing methods ebcoexpress   <cit>  and discordant   <cit>  at detecting differentially correlated gene pairs in the presence of noise. we did not compare dgca to diffcorr  <cit>  in the simulation study, since both of these packages use the fisher z-transformation and z-score calculation as its underlying algorithm, although dgca offers a number of additional options, including permutation testing to quantify the statistical significance of gene-gene differential correlation. among the  <dig> genes in our simulation study,  <dig> have high average expression and high dispersion  and  <dig> have high average expression and one-fold lower dispersion , and  <dig> have substantially lower average expression and high dispersion . we built two covariance matrices to describe the dependence structure of the  <dig>  gene pairs in each condition. we specified these covariance matrices so that  <dig> gene pairs, for which both of the genes were in the “activated” gene set, were segregated into each of the  <dig> differential correlation classes. note that by default all of the gene pairs in the covariance matrices are set as  <dig> and the “0/0” differential correlation class means that two correlations under two conditions are not statistically different and thus it are not specified. to maintain a positive-definite covariance matrix in the case of negative correlations, we only set the super- and subdiagonals of the off-diagonals of the covariance matrix to non-zero values. the super- and subdiagonals were set to  <dig>  or - <dig>  times the variance of a particular gene pair, corresponding to positive or negative correlation in one condition, respectively. because two differential correlation classes, ρ = +/+ and ρ = -/-, do not specify a difference between correlation between conditions, the number of actually differentially correlated gene pairs is reduced from  <dig> to  <dig>  we then simulated the mean values for each gene using a negative binomial distribution with a dispersion parameter of  <dig> , and set the mean values of less than one to one. the negative binomial distribution and its parameters were designed to approximately match the bimodality of expression means observed in rna expression experiments  <cit> . with the mean values for each gene as well as the covariance matrix, we simulated multivariate normally distributed gene expression matrices for various numbers of samples using the r package mass  <cit> . we then employed receiver operating characteristic  curves  <cit>  to measure the performance of dgca and ebcoexpress on detecting the  <dig> truly differentially correlated gene pairs out of the total  <dig>  gene pairs, for six different numbers of simulated samples in each condition, i.e., n =  <dig>   <dig>   <dig>   <dig>   <dig>  and  <dig>  we ran the simulation  <dig> times in order to estimate the standard error of the area under curve  statistics in the roc curves. to estimate the statistical significance of the difference in performance between these methods, we used student’s t-test to compare their aucs at various sample sizes. we adjusted the p-value threshold required to call a comparison as significantly different for the number of simulated cases .

of the six types of differential correlation in this simulation study,  <dig> truly differentially correlated gene pairs had a strong difference  in correlation coefficient between conditions, while  <dig> had a medium difference  in correlation coefficient between conditions. we measured the accuracy of each of the methods to distinguish truly differentially correlated gene pairs for both the strong and medium difference classes, using the same comparison approach as in the full simulation experiment. for the simulations with n =  <dig> simulated samples, we also plotted representative roc curves for each class, to visualize the ability of each of the differential correlation r packages to detect truly differentially correlated gene pairs in each of the  <dig> differential correlation classes. r code for this simulation study is available online .

data processing for applications using breast cancer rna expression data
we applied dgca to the breast cancer rna-seq data from the cancer genome atlas   <cit>  under two scenarios: a) the samples with and without a p53/pten mutation and b) the estrogen receptor-positive  samples and the triple negative  samples. the level  <dig> rnaseqv <dig> data of breast cancer in the tcga data portal first went through a log transform, then was quantile-normalized, and finally was corrected for age, batch, race, and gender using a linear regression approach. for the differential correlation analysis of p53/pten, this rna expression data was filtered to contain only genes previously described as within p53/pten pathways , but underwent no expression filtering. for the differential correlation analysis between er+ and triple negative breast cancer, rna expression data was filtered to remove genes in the bottom 25th percentile of median expression and/or dispersion index of expression , but underwent no filtering for specific gene sets.

differential correlation of p53/pten targets in normal and p53-/pten-mutated breast cancer tumor samples
somatic mutation data was obtained from tcga-curated mutations . we identified a set of rna expression samples with and without a) a non-silent p <dig> dna mutation and b) a non-silent pten dna mutation. for the p <dig> analysis, we next filtered these rna expression matrices to contain only genes that contain a p <dig> response element  <cit> , are in the molecular signatures database  p <dig> hallmark gene set  <cit> , and/or are a downstream target of p <dig> in the pathway interaction database  <cit> . for the pten analysis, we filtered the rna expression matrices to only contain genes that are in the biocarta pten pathway  <cit> , the sigma-aldrich pten pathway  <cit> , and/or have been identified in physical interactions with pten by affinity capture, as curated via biogrid  <cit> . we then calculated the differential spearman correlations on this filtered rna expression matrices between the p53/pten mutated and non-p53/non-pten mutated breast cancer samples. for p <dig> only, we used the signtype argument in dgca to restrict the difference in z-score calculation between conditions to positive correlations, since p <dig> is a transcriptional activator and we reasoned that negative correlations with tp <dig> are less likely to be biologically meaningful. notably, the signtype argument in dgca, which refers to the differential correlation sign type , can also be used to restrict the difference in z-score calculation between conditions to negative correlations if users are interested in only considering negative correlations as non-zero when assessing the difference in correlation between conditions. to assess the significance of the difference in gene-gene correlations, we generated empirical p-values via  <dig>  permutations. for p <dig>  we further visualized the global difference in correlations among p53-associated genes using the dgca heatmap visualization, which builds on the gplots r package . we then visualized the gene-gene correlation matrix in each condition, and calculated both the median change in correlation for each gene and the median change in correlation for all gene pairs between the conditions, using  <dig> permutations to quantify the significance.

differential correlations in rna expression data from estrogen receptor-positive compared to triple-negative breast cancer samples
for the data from the er+ and tn breast cancer samples, we removed the genes in the bottom 25th percentile of median expression and/or dispersion index of expression. note that the dispersion index is calculated as the ratio of the variance divided by the mean. we measured the differences in pearson correlation between all pairs, using  <dig> permutations to quantify the significance of the difference in correlation, and identified genes with q-value <  <dig>  for downstream analysis. upon identifying the significantly differentially correlation gene pairs, we first collapsed these gene pairs to identify the genes uniquely present in gene pairs with a gain of correlation in one condition compared to the other, and used the dgca wrapper function to perform gene ontology  enrichment analysis based on the gostats r package   <cit>  and org.hs.eg.db go annotation r package . for the go enrichment analysis, we used genes identified in gene pairs with q <  <dig> , since this greater specificity yielded a larger set of genes uniquely present in only one of the two differential correlation conditions. to compare the go enrichment between the two conditions, we first filtered for those go terms with between  <dig> and  <dig> gene symbols with a nominal significant p-value  in at least one of the conditions. we next took the log of the ors, since log ors converge more rapidly to a normal distribution. we then calculated the standard error for the log ors in each condition, using the following equations  <cit> , or=logn11∗n22n12∗n <dig> 
 seor=1n11+1n12+1n21+1n <dig> where, n <dig> is the number of genes in the intersection between a gene signature and a go term, n <dig> is the number of member genes in the go term but not in the gene signature, n <dig> is the number of genes in the signature but not in the go term, and n <dig> is the number of genes in the universe but not in either group. in order to quantify the significance of the difference in the log ors in each group, we used the following equation, z=or1−or2seor1−seor <dig> where, or <dig> and or <dig> refer to the log odds ratio of the enrichment in conditions  <dig> and  <dig>  respectively, while z refers to the z-score of the difference in log ors. we then calculated the associated p-value from the z-score using the cumulative distribution function for the standard normal distribution. for each go term type , cellular component , and molecular function ), we adjusted these p-values using the benjamini-hochberg false discovery rate  method. we chose the top  <dig> terms in each group with fdr <  <dig>  for visualization.

next, we used the megena r package   <cit>  to first build a planar filtered network  from significantly differentially correlated gene pairs  and then identify multiscale gene modules in the pfn. we used the absolute value of the z-score for the difference in correlation between conditions as the network weights, and after calculating the perfuse forced network, we also normalized these weights, to follow the convention that network weights fall between  <dig> and  <dig>  next, we identified modules and hubs, using the default megena parameters values, including module significance threshold of p <  <dig> , a hub detection significance threshold of p <  <dig> ,  <dig> network permutations, and a module size of between  <dig> and  <dig>  we then calculated the odds ratios of the enrichment of correlation class edges in each module using the hypergeometric test, and adjusted the enrichment p-values for each correlation class using the benjamani-hochberg method. further, we performed the enrichment of go terms in each modules using the gostats r package  <cit>  and org.hs.eg.db go annotation r package and adjusted the resulting p-values for all go terms in each module with the benjamini-hochberg method. we visualized two of the networks derived from differential correlation modules using cytoscape and created interactive versions of them via cynetshare.

comparison to alternative module detection approaches
we sought to compare dgca/megena to two approaches to differential correlation module detection, diffcoex  <cit>  and dicer  <cit> . for diffcoex, we downloaded the r script that the authors released in their supplementary materials and used the same method and set of r commands they used therein. for dicer, we downloaded the java executable file from the author’s website  on 8/21/ <dig> and ran it using java v.  <dig> .0_ <dig>  we designed a simulation study to assess the performance of different approaches for detecting differentially correlated modules. this simulation study uses many of the same parameters as our previous simulation study of differentially correlated gene pairs but has several unique features. first, instead of individual gene pairs that vary in correlation between conditions, we designated two modules of  <dig> genes each, a fraction of the pairs of which were positively correlated in one of the conditions but had no correlation in the other. in the simulation, we changed the fraction of positively correlated gene pairs in a module, defined as the network connectivity κ, from κ =  <dig>  to  <dig>  in increments of  <dig> . further, to ensure positive-definite covariance matrices, we set the numerical tolerance to  <dig>  in simulating each of the multivariate normally distributed gene expression matrices. because this numerical tolerance moderated the strength of the correlation difference between conditions, we increased the strength of correlated gene pairs to  <dig>  in the positively correlated condition. notably, we used the default  <dig> permutations and q-value threshold of  <dig>  for dgca in the simulation study to identify differentially correlated gene pairs as input to megena for module detection. to be consistent with dicer, the minimum module size was set to  <dig> for both megena and diffcoex. for each of the  <dig> simulation runs, we computed the highest sensitivity  for all modules with less than  <dig> members for each module detection method. in each simulation run, we also computed the highest jaccard index  for all modules for each module detection method. in the case that no modules were detected by a method, a pseudo-module comprised of all the genes in the simulation study was assigned, leading to a jaccard index of  <dig>  . we then compared the sensitivity statistics and jaccard indices of all simulation runs between the methods at each network connectivity fraction and number of samples using a t-test.

we next compared the module detection methods in terms of their performance on the same set of filtered genes for er+ and tn breast cancer rna expression data as used by the dgca/megena pipeline. we first assess the relevance of the sets of modules identified by the three methods through the enrichment test for five gene signatures characterizing these breast cancer subtypes under study. the modules from each method were filtered by size to retain modules with greater than  <dig> and less than  <dig> members. the five gene sets used were a set of genes associated with er+ breast cancer in multiple data sets  <cit> , a set of genes associated with tnbc in multiple data sets  <cit> , a set of genes associated with er signaling curated from several data sets , kegg cell cycle genes, and kegg dna mismatch repair genes  <cit>  . the benjamini-hochberg adjustment method was used to correct the enrichment p-values for multiple testing, and we used an fdr threshold of  <dig>  for all the enrichments of the gene sets. we then tested how the modules detected by one method are conserved in each other method based on a significance threshold  of the benjamini-hochberg adjusted fisher’s exact test  enrichment p-value. a module is defined as unique to a method if it does not significantly overlap with any module identified by any other method. this procedure allowed us to determine the proportion of modules specific to each of the three methods or in any pairwise comparison of modules.

RESULTS
simulation study to measure the accuracy of detecting differential correlation
dgca is an r package designed to detect differences in the correlations of gene pairs between distinct biological conditions. we first developed a simulation study to confirm that dgca can accurately detect differential correlation relationships between gene pairs. specifically, we designed an in silico experiment with  <dig> genes and  <dig> differentially correlated gene pairs out of  <dig>  total gene pairs. thirty eight of the truly differentially correlated gene pairs had a strong difference  in correlation coefficient between conditions, while  <dig> had a medium difference  in correlation coefficient between conditions. the accuracy of dgca increased as the number of simulated gene expression samples in each condition increased . dgca also demonstrated significantly higher accuracy under these simulation conditions than discordant with and without use of the fisher z-transformation for n =  <dig>   <dig>   <dig>   <dig>  and  <dig> samples , although the two packages did not significantly differ in accuracy at n =  <dig> samples . dgca demonstrated significantly higher accuracy in the simulation study than ebcoexpress at all of the sample sizes tested . furthermore, dgca was substantially faster than the other two methods . at n =  <dig> samples, all three methods more accurately detected gene pairs with strong difference in correlation than gene pairs with medium difference in correlation, but there were no major differences within methods between correlation classes within the strong or medium groups . all the methods have similar power to detect gene pairs with strong differences in correlation at any of the sample sizes tested . for medium strength gene pairs, dgca does not significantly differ from discordant at n =  <dig> and  <dig> in terms of accuracy, but outperforms discordant at n =  <dig>   <dig>   <dig>  and  <dig>  while dgca outperforms ebcoexpress at all sample sizes tested . therefore, dgca outperforms the two established approaches, ebcoexpress and discordant, in our simulation study.fig.  <dig> comparing dgca to alternatives in the differential correlation simulation study. a-d: representative receiver operating characteristic  curves show the ability of dgca, ebcoexpress, and discordant with and without the use of the fisher z-transformation  to accurately detect truly differential correlated gene pairs at different simulated sample sizes in each condition, including n =  <dig> a, n =  <dig> b, n =  <dig> c, and n =  <dig> d. black lines show the roc curves of dgca, while blue lines show the roc curves of ebcoexpress, red lines show discordant without the fisher transformation, and orange lines show discordant with the fisher transformation. e: comparison of area under curve  statistics for  <dig> runs of the simulation study using each of the methods at different numbers of samples, where errors bars represent the standard error of the mean. asterisks indicate a bonferroni-adjusted significant difference in the aucs  between dgca and each of the other methods, tested using a two-sided t-test


the time  for each analysis tool to take an input gene expression data with  <dig> genes and the given number of samples and output a table of differential correlation predictions for all  <dig>  gene pairs. for dgca, speed times both with and without  <dig> permutations  are shown. these numbers were calculated from  <dig> runs of the simulation study, representing the arithmetic mean +/- the standard error of the mean across the simulations


fig.  <dig> comparing dgca to alternatives segregated by the strength of correlation difference. a-c: representative receiver operating characteristic  curves show the ability of dgca a, ebcoexpress b, and discordant  c to accurately detect truly differential correlated gene pairs in each of the six differential correlation classes that specify a difference in correlations between conditions, as well as when comparing all gene pairs with a gain in correlation  or a loss of correlation  in one condition compared to the other, at a sample size of n =  <dig>  d-e: comparison of area under curve  statistics for  <dig> runs of the simulation study using each of the three methods at different numbers of samples, where errors bars represent the standard error of the mean, segregated to only those gene pairs with a strong difference in correlation  or segregated to only those gene pairs with a medium strength difference in correlation . asterisks indicate a bonferroni-adjusted significant difference in the aucs  between dgca and each of the other methods, tested using a two-sided t-test




differential correlation of p <dig> targets in normal and p53-mutated breast cancer tumor samples
we downloaded rna-seq data of breast cancer samples with and without non-silent p <dig> dna mutations from tcga , and corrected the data for known covariates. we chose this data set because the ability of p <dig> to affect the expression of its downstream targets is known to be altered following p <dig> mutation  <cit> . we filtered the rna-seq data to select  <dig> genes in the data set as the p <dig> signature that have previously been associated with p <dig> . since p <dig> is known to be a transcriptional activator, we restricted our analysis to positive correlations with tp <dig> in the two groups . we then quantified the significance of these differential correlation relationships using permutation testing. we identified five genes that have a significant  change in correlation with tp <dig> in the group of samples with p <dig> mutations . two of these are due to a loss of correlation following p <dig> mutation , while three are due to a gain of correlation . the gene with the strongest loss of correlation with tp <dig> is gnb2l <dig> , a ribosomal gene whose expression is strongly predictive of breast cancer outcome  <cit> . cdkn1a, a well-established transcriptional target of p <dig> that encodes the protein p <dig>  demonstrated an increased correlation with tp <dig> in the group of samples with p <dig> mutations, possibly reflecting compensatory p53-independent transcriptional activation of cdkn1a  <cit> .fig.  <dig> expression correlations of five genes with tp <dig> in samples with and without p <dig> mutations. expression values for genes from breast cancer samples without p <dig> mutation, or p <dig> wildtype , compared to samples with non-silent p <dig> coding mutations . for each gene pair, the expression of tp <dig> is on the x-axis, while the expression of gnb2l1
a, rps12
b, cdkn1a
c, tsc22d1
d, and dgka
e are on the y-axis. for visualization purposes, a linear model was fit to the data in each comparison, with the grey lines representing 95% confidence intervals. this visualization was made using a dgca wrapper function to the ggplot <dig> r package


the output of running dgca on the p <dig> pathway gene set in the breast cancer rna-seq samples, comparing correlations of these genes with tp <dig> in p53-wildtype samples to correlations in p53-mutated samples, using the option to consider only positive correlations in calculating differential correlation between conditions. the top  <dig> gene pairs are shown here, while the rest are available in the supplementary data. the “classes” column indicates the correlation class of each of the gene pairs where, e.g., “+/0” indicates a significant  positive correlation in the p53-wildtype samples and no significant correlation in the p53-mutated samples. note that the significance for the correlations within each condition is not adjusted for multiple comparisons.  <dig>  permutation samples were generated in order to estimate empirical p-values, using a pooled reference distribution approach, from which q-values were calculated


wt wildtype, mut. non-silent p <dig> mutation




we further explored the relationship between differential correlation and differential expression. we performed differential expression analysis on these genes using the r package limma . we then calculated the spearman correlation between the magnitude of differential expression  and the differences in positive correlation values with tp <dig> for all of the genes. although these two measures trended in the same direction, they had no significant correlation between them . because this lack of correspondence may have been influenced by our restriction to differences in positive correlations, we also measured the correlation between differential expression and differential correlation with tp <dig> across all the correlations, and found no correlation in that case either . the lack of correlation corroborates our theoretical claim that differential expression and differential correlation are complementary approaches to identifying differences in gene expression between conditions.fig.  <dig> comparing differential expression and differential correlation with tp <dig> in samples with and without p <dig> mutations. for each gene, we plot both dgca’s calculated differential correlation z-score between that gene and tp <dig> in p <dig> non-mutated breast cancer samples and p53-mutated samples , as well as limma’s differential expression t statistic for that gene’s differential expression between the same p <dig> wildtype samples and p53-mutated samples . when differential correlation z-scores are calculated on positive correlation values only a, the spearman correlation between these two measures is not significant , and when differential correlation z-scores are calculated across all correlation values b, the spearman correlation between these two measures is also not significant . the blue line represents a linear model of the best fit, with the grey lines representing 95% confidence intervals, computed using ggplot2




to gain more insights into the overall change in correlation structure in rna expression matrices between p53-mutated and p53-non-mutated breast cancer samples, we used dgca to visualize the all gene pair correlations in both conditions . genes in this heatmap are ordered by their median z-score correlation difference with all of the other genes in the filtered set between the two conditions, without the restriction to positive correlations. when we quantified the difference in correlation between all gene pairs using permutation testing, we identified a global loss of correlation between p53-mutated and p53-wildtype samples  = - <dig> , p =  <dig> ), suggesting that p <dig> mutations decrease the correlations among the p <dig> signature genes. because visual inspection of the heatmap indicated that a subset of genes tended towards gain in correlation while others tended towards a loss in correlation, we used permutation testing to measure whether each gene’s median change in correlation was more extreme than expected, and adjusted the resulting empirical p-values for multiple hypothesis testing. using this approach, we identified genes with significant changes in median correlation in p53-mutated samples . notably, the transcription factor foxa <dig> has a gain in correlation with the other genes in the p <dig> signature in the p53-mutated breast cancer samples . this suggests that foxa <dig> may play a role in transcriptional compensation following p <dig> mutation, which is consistent with the finding that foxa <dig> binding sites are enriched in p <dig> binding sites  <cit> . on the other hand, the transcription factor atf <dig> has a loss of correlation with the other genes in the set , which is consistent with its highly synergistic role with p <dig> in mediating transcription  <cit>  and ability to directly bind to and suppress mutant p <dig>  <cit> . ldhb also has a strong loss of correlation in p53-mutated samples . since ldhb  is a marker of highly glycolytic cancers  <cit> , its broad dysregulation following p <dig> mutation may reflect the disrupted role of p <dig> in regulating glycolytic activity  <cit> . these examples highlight the ability of dgca to parse out the individual components of the differential correlation structure between conditions.fig.  <dig> differential correlations between the genes in the p <dig> pathway in p <dig> non-mutated and p53-mutated breast cancer samples. the top panel shows a histogram of the correlation values pooled between both conditions that also demonstrates the color schema used to indicate the expression correlation strength for each gene pairs. the bottom panel shows a heatmap of correlation values in the two conditions. the bottom left panel shows the correlation of gene pairs in the non-p53-mutated breast cancer rna-seq samples, while the upper right panel shows the correlation of gene pairs in the samples with  p <dig> mutations. the diagonal is marked black as each gene’s self-correlations from both conditions are omitted. genes are ordered by the median difference of z-score in correlation between that gene and all of the other genes present in both the rows and columns. this plot was made using the dgca wrapper function to the gplots r package


the top  <dig> genes by their median difference in correlation for each gene and all other genes in the p <dig> pathway gene set between non p53-mutated and p53-mutated breast cancer rna-seq samples.  <dig> permutation samples were generated in order to estimate empirical p-values for each gene, which were then adjusted by the benjamini-hochberg method to control the false discovery rate among this set of genes




differential correlation of pten targets in normal and pten-mutated breast cancer tumor samples
we used a similar approach to measure the differential correlation of genes known to be associated with pten following pten dna mutation, using the same processed breast cancer rna expression data as we used for p <dig>  pten is typically considered a tumor suppressor, and its role in breast cancer pathogenesis has been suggested to be related to loss of pten protein activity  <cit> . we filtered the rna-seq data to select  <dig> genes in the data set as the pten signature that have previously been associated with pten . because pten was not considered as a transcriptional activator, we did not restrict the correlations to positive values prior to calculating differential correlations as we did for p <dig> . we identified two genes with a significant gain in correlation with pten in breast cancer samples with pten mutations  compared to samples without pten mutations , faslg and ipcef <dig> . faslg encodes fas ligand, which induces apoptosis upon binding to fas, and polymorphisms in which contribute to breast cancer risk  <cit> . fas signaling typically activates pten as a part of its promotion of apoptosis  <cit> . the expression of fas and pten have previously been found to be negatively correlated in prostate cancer  <cit> , consistent with the negative correlation we identify between pten and faslg in the pten wildtype breast cancer samples, suggestive of negative regulation at baseline. in the absence of pten protein activity, activation of fas may lead to compensatory increased transcription of pten in a failed attempt of negative regulation, perhaps mediated in part by microrna- <dig>  <cit> , thus inducing a strong positive correlation between the expression of these two genes. ipcef <dig> encodes a scaffold protein involved in signal transduction downstream of growth factors and ras  <cit> . ipcef <dig> is less well-studied, so its differential correlation with pten in the presence of pten mutations may provide a way to study its function. we next examined the relationship between differential expression and differential correlation with respect to pten. as in the case of p <dig>  there is no correlation between the genes differentially expressed between the groups with and without pten mutations and the genes differentially correlated with pten .table  <dig> differential correlations of genes with pten between non pten-mutated and pten-mutated samples

the output of running dgca on the pten pathway gene set in the breast cancer rna-seq samples, comparing correlations of these genes with pten in pten-wildtype samples to correlations in pten-mutated samples. the top  <dig> gene pairs are shown here, while the rest are available in the supplementary data. the “classes” column indicates the correlation class of each of the gene pairs. note that the significance for the correlations within each condition is not adjusted for multiple comparisons.  <dig>  permutation samples were generated in order to estimate empirical p-values, using a pooled reference distribution approach, from which q-values were calculated


wt wildtype, mut. non-silent pten mutation


fig.  <dig> summary of differential correlation results of pten in samples with and without pten mutations. a-b: expression values for genes from breast cancer samples without pten mutation, or pten wildtype , compared to samples with non-silent pten mutations . for each gene pair, the expression of pten is on the x-axis, while the expression of faslg
a and ipcef1
b are on the y-axis. for visualization purposes, a linear model was fit to the data in each comparison, with the grey lines representing 95% confidence intervals. c: for each gene, we plot both dgca’s calculated differential correlation z-score between that gene and pten in pten non-mutated breast cancer samples and pten-mutated samples , as well as limma’s differential expression t statistic for that gene’s differential expression between the same pten non-mutated samples and pten-mutated samples . the correlation between the two measures is not significant . the blue line represents a linear model of the best fit, with the grey lines representing 95% confidence intervals




global differential correlations between estrogen receptor-positive and triple-negative breast cancer samples
we next sought to use dgca to make a global comparison of gene expression correlation patterns between estrogen receptor-positive  and triple-negative  breast cancers in tcga . we filtered out genes in the bottom 25th percentile of median expression and/or dispersion index of expression, which yielded a total of  <dig>  genes. we found the difference in pearson correlations among all of these gene pairs across the two conditions, and identified  <dig>  differentially correlated gene pairs at q-value <  <dig>   between the er+ and tn breast cancer gene expression samples. we first measured gene ontology  of the genes in gene pairs with a gain of correlation in er+ samples to the go enrichment of genes found in gene pairs with a gain correlation in tn samples, but found no significant differences in the go term enrichments between groups, likely due to the small number of unique genes in each category . however, by restricting to the  <dig>  gene pairs at q <  <dig>   for specificity, we were able to perform go enrichment on a larger set of genes unique to gene pairs with a gain of correlation in er+ samples  or a gain correlation in tn samples . genes in gene pairs with a gain of correlation in er+ samples were enriched in the go term vasculature development , which makes sense in light of the finding that er+ breast cancer samples harbor a relatively high proportion of blood vessels in the tumor environment  <cit> . further, genes in er+ specific gene pairs were enriched in calcium ion binding , which is consistent with the ability of calcium to stimulate estrogen receptor-alpha expression and mimic estrogen  <cit> . on the other hand, genes in gene pairs with a gain of correlation in tn samples were enriched in the go term negative regulation of viral life cycle , which may be explained by reports that a subset of tn breast cancers are associated with viral infection  <cit> . surprisingly, despite the presence of multiple gene sets related to estrogen-regulated genes in the go annotation set employed, including “estrogen receptor activity” and “estrogen receptor binding”, none of these were identified as significantly enriched in differentially correlated gene pairs unique to er+ or tn samples. this may be because changes in the correlations of er-responsive genes with other genes occur in both er+ and tn samples, suggesting that dgca can pull out novel biology for further investigation.fig.  <dig> gene ontology enrichment of genes associated with gain or loss of correlation in er+ samples compared to tn. genes identified as members of gene pairs with a significant gain in correlation  in the estrogen receptor-positive  samples compared to the triple negative  breast cancer samples were used as inputs to gene ontology  enrichment analysis in gostats. go terms with less than  <dig> or greater than  <dig> gene symbol members were filtered out included for the purposes of interpretability. odds ratios for the go enrichment of terms were compared between these two groups, and p-values were adjusted using the benjamini-hochberg method for each go term category to yield false discovery rates . up to  <dig> go terms enriched in one of the groups compared to the other at fdr <  <dig>  are shown. no terms from the “molecular function” go term category portion passed this fdr threshold and are therefore not shown. this plot was made using the dgca wrapper function to the plotrix r package




in order to identify coherent subnetworks and hub genes constituted by differential correlations, we integrated dgca with megena   <cit>  and used the set of  <dig>  gene pairs found at q <  <dig>  as inputs to planar filtered network  construction. megena projects candidate interactions onto a topological sphere and parses the resulting planar filtered network into multiscale modules  defined at multiple resolutions, and has been shown to effectively reconstruct gene regulatory networks  <cit> . the resulting planar filtered network had  <dig>  edges, from which we identified  <dig> modules using multiscale clustering analysis . we measured the enrichment of the edges in these modules in each of the differential correlation classes, and further found their most enriched go terms . we first focused on the module with the strongest enrichment of edges with positive correlation in the er+ samples and no correlation in the tn samples , which is most enriched in the go term vasculature development . we also used megena to identify hub genes  in this module, which revealed that cyyr <dig>  fam171a <dig>  pros <dig>  ccdc <dig>  gjc <dig>  rem <dig>  and cav <dig> are its hub genes . the locus at cyyr <dig> encodes seven or more cyyr <dig> alternatively spliced isoforms as well as an antisense gene with high expression variability across tissue types  <cit> . our data suggests that cyyr <dig> drives and/or is associated with a strong reprogramming of transcription in er+ compared to tn breast cancer samples. we next focused on the module with the strongest enrichment of edges with negative correlation in er+ samples and positive correlation in tn samples , which is also significantly enriched in edges with no correlation in er+ samples and positive correlation in tn samples . this module is most enriched for the go term immune response , consistent with reports of the relatively strong role of the immune system in mediating tnbc . the hub genes identified in this network are nags, jade <dig>  dram <dig>  ptger <dig>  and prob <dig> . notably, the protein product of jade <dig> has been found to act as a ubiquitin-ligase to regulate the activity of the histone demethylase lsd <dig> in neuronal differentiation  <cit> , suggesting that it may play a role in shifting the immune-related epigenetic landscape in tnbc samples. interactive figures for these two differential correlation networks are available online .fig.  <dig> planar filtered network of differentially correlated genes. gene pairs with a significant change in correlation  in estrogen receptor-positive  compared to triple negative  breast cancer samples were to construct a planar filtered network shown here. the modules identified at p <  <dig>  in this network with between  <dig> and  <dig> members are identified with distinct colors. this plot was made using cytoscape 


fig.  <dig> enrichment of go terms and differential correlation classes in the multiscale modules. this plot displays the enrichments of each of the multiscale modules  in the er+ vs tn differential correlation network. the left panel shows the enrichment  of edges in each of the differential correlation  classes in each of the modules. the right panel shows the most significantly enriched gene ontology  term  for the genes in each of the corresponding modules, along with the go enrichment of that same go term in all the other modules. this plot was made using a dgca wrapper function to r package ggplot2


fig.  <dig> the differential correlation module most enriched in gene pairs that gain in correlation in er+ breast cancer. this module of genes was identified using megena and chosen for downstream analysis because it was most enriched for the gene pairs with positive correlations in er+ breast cancer but no significant correlation in triple negative  breast cancer. node size and gene symbol text size are proportional to the number of connections for each gene. edges are colored according to the differential correlation class , while edge weight is proportional to the absolute value of the z-score for the difference of correlation between er+ and tn breast cancer samples. this plot was made using cytoscape 


fig.  <dig> the differential correlation module most enriched for the gene pairs that gain correlation in tn breast cancer. this module of genes was identified using megena and chosen for downstream analysis because it was most enriched for the gene pairs that were positively correlated in tn breast cancer but were either negatively or not significantly correlated in er+ breast cancer. node size and gene symbol text size are proportional to the number of connections for each gene. edges are colored according to the differential correlation class , while edge weight is proportional to the absolute value of the z-score for the difference of correlation for that gene pair between er+ and tn breast cancer samples. this plot was made using cytoscape 




evaluation of differential correlation module detection approaches
to evaluate the performance of dgca/megena in detecting differential correlations, we first compared it with two established methods, diffcoex  <cit>  and dicer  <cit> , using a simulation study. in this simulation, we designed two differential correlation modules of  <dig> genes each, out of a total of  <dig> genes. in each module, a fraction of gene pairs  have significant positive correlations in one condition but no significant correlation in the other. for each of the true modules across various numbers of simulated samples , we identified the top sensitivity and jaccard index statistics of the modules detected by each method and then compared them . dgca/megena identified modules with significantly higher sensitivity and jaccard indices than diffcoex and dicer in all the simulation conditions that have κ <  <dig> , with the exception of the jaccard index comparison with dicer at κ =  <dig> , n =  <dig> samples . in the extreme condition where all the gene pairs are differentially correlated , diffcoex identifies modules with higher jaccard indices  but not higher sensitivities than dgca/megena at all sample sizes, while dicer identifies modules with higher sensitivities and jaccard indices than both methods at n =  <dig>   <dig>  and  <dig> . however, even under the extreme and limited condition of κ =  <dig>  the practical performance difference between dgca/megena and the other two methods is very small. in contrast, diffcoex and dicer usually fail to identify the differentially correlated modules under the more general conditions . in summary, dgca/megena demonstrated the best performance in detecting differential correlation modules under the more general simulation conditions.fig.  <dig> performance comparison of dgca/megena, dicer and diffcoex in detecting differential correlation modules. in the simulation study, there were two modules and  <dig> genes were assigned to each module, within which a fraction  of the gene pairs had differential correlation, where κ varied from  <dig>  to  <dig> across simulation runs. we also simulated different sample sizes in each condition . the highest sensitivity  and jaccard index b between the detected and true modules were calculated and averaged for each method  across all the independent runs in the simulation study. in the case that no module was detected by a method, all the genes were considered to belong to one single module for calculating jaccard index, indicated by the dotted horizontal line. each jaccard index mean was calculated from ten simulation runs and two true modules per run




we next examined whether the differential correlation modules identified by dgca/megena on the er+ and tn breast cancer rna expression differed from those identified by diffcoex  <cit>  and dicer  <cit>  . although these alternative methods do not automatically specify gene-gene links or identify hub genes, they do also identify differentially correlated gene modules. we first counted the number of modules identified by each method that were significantly enriched  in five gene sets chosen because of their importance in breast cancer . we found that dgca/megena identified the most modules significantly enriched in genes associated with er+ breast cancer and estrogen receptor  signaling, while dgca/megena and dicer tied in the number of modules significantly enriched in tnbc genes, and dicer identified the most modules significantly enriched in the kegg terms cell cycle and mismatch repair. we then identified the modules unique to each method. we found the proportion of modules for each method that were not significantly enriched in any of the modules by one  or either  of the other methods . dgca/megena identified a higher proportion of unique modules compared both pairwise and globally to the existing methods diffcoex and dicer.fig.  <dig> comparison of modules detected with dgca/megena to those detected with diffcoex and dicer. a: the number of modules significantly enriched  that were detected by each of dgca/megena , diffcoex , and dicer  in five different gene sets selected for their relevance to breast cancer. b: the proportion of modules detected by each of the three methods that are not significantly enriched in  any of the modules detected by one  or both  of the other methods, by fisher’s exact test, benjamini-hochberg adjusted p-value <  <dig> . columns labels denote the reference method compared; e.g., 62% of dgca/megena-detected modules do not significantly overlap with modules detected by either method, and 78% of dgca/megena-detected modules do not significantly overlap with any dicer-detected modules




discussion
the r package dgca developed by this study is a powerful new tool for querying the regulatory relationship of gene pairs under different conditions. dgca is applicable to a wide range of input data types, including microarray data, tissue-level or single-cell rna-seq data, proteomic data, methylation data, and metabolomic data. in general, dgca can be used to compare the correlations between features from both continuous- and count-based data types. users input a gene expression matrix with gene identifiers in rows and samples in columns, a design matrix specifying which samples correspond to which conditions, and a vector specifying the conditions to be compared. in our differentially correlated gene pair simulation study, dgca significantly outperformed ebcoexpress and discordant in terms of accuracy and speed. when we applied dgca to the rna-seq data from the tcga breast cancer samples with and without p <dig> mutations, we identified p <dig> pathway genes that had significant changes in correlation with tp <dig> between the p53-mutated samples and those without p <dig> mutations. we revealed that p <dig> mutations altered the correlation patterns between the p53-pathway genes. we also studied the effect of non-silent pten dna coding mutations, and showed that these mutations led to differential correlation between pten and two genes that it has been found to interact with. in the future, we will examine additional genes such as myc, kras, and erbb <dig> in breast cancer and other cancers.

one of the limitations of our differential correlation approach to studying p <dig> mutations in breast cancer is that there is a wide variety in the functions of p53-mutations  <cit>  and our approach averaged over many of them. as the sample size of the available data increases, it would be valuable to perform differential correlation on groups defined by individual p <dig> mutations or classes of p <dig> mutations. given a larger sample size allowing for factorial analyses in differential correlation, it would also be interesting to consider both the effect of heterozygous deletions of the short arm of chromosome  <dig> that contain the p <dig> gene, which is often seen in combination with p <dig> coding mutations  <cit> . this would allow investigators to study whether tp <dig> gene dosage affects p <dig> activity, especially because some but not all p <dig> coding mutations are able to act in a dominant-negative manner  <cit> . another factor we will consider in future studies is mdm <dig> gene amplification, which can also modulate the activity of p <dig>  <cit> .

dgca fits in well with the growing suite of tools available in the r statistical programming ecosystem for analyzing gene expression data, and can be used synergistically with a number of them. for example, as demonstrated empirically in this study, differential correlation is complementary to differential expression for discovering differences in gene expression between conditions. differential correlation as a complement to differential expression is particularly apt in the case that the expression of a regulatory gene  has its activity altered in one of the conditions without fully abrogating its expression, as is often the case for dna mutations in tumor cells. however, differential correlation can be applied more broadly as well; for example, in discovering differences in the pathways that genes participate in between tissues and cell types. differential correlation is also complementary to module detection approaches, such as megena, as was shown in this manuscript through a comparison of estrogen receptor-positive breast cancer to triple-negative breast cancer. by using the finely-grained dgca method, our approach was able to identify individual differential correlations between key gene pairs, and use them to create “bottom-up” differential correlation network modules. further, differential correlation of individual gene pairs works particularly well downstream of higher-level module detection approaches, such as wgcna, to perform “top-down” identification of modules with significant differential correlation. this is because parsing up the input gene expression matrix into smaller sets is often critical in order to make sense of the millions or even billions of gene pair combinations that can be analyzed in a typical rna expression data set. in order to add further to the r programming gene expression analysis suite, future directions for improving dgca include detection of linear changes in correlation across more than two conditions and integration with differential expression to define genes with differential wiring across conditions  <cit> .

aside from integration of dgca and megena, there are several alternative approaches available to identify modules of differentially correlated genes between conditions. one of the earliest studies to address this problem identified gene sets that led to the largest difference in an additive model that scored co-expression of genes in each condition  <cit> . this model-based approach allowed for an efficient search for gene sets that are co-expressed in one condition but not the other. a distinct approach called coxpress first uses hierarchical clustering to identify groups of genes that are coexpressed across conditions, and then leverages sample permutations to measure whether each of these gene sets is significantly differentially coexpressed between conditions  <cit> . a separate approach called sdc  uses a biclustering approach to identify gene sets that are differentially coexpressed in subsets of each of two conditions  <cit> . diffcoex calculates dissimilarity scores between gene pairs in two or more conditions, and then uses leverages the wgcna approach to identify modules based on this dissimilarity matrix  <cit> . an approach called dicer  first calculates a probabilistic score for genewise differential correlation between conditions  <cit> , and then performs hierarchical clustering on these differential correlation scores to identify modules of differential correlation, as well as meta-modules of modules that demonstrate differences in correlation across conditions. another class of approaches also quantifies differential coexpression between conditions given an initial collection of gene sets, including gene set co-expression analysis   <cit>  and gene sets net correlations analysis   <cit> .

the module detection method described in this manuscript differs from all of these methods in that it does not set out solely to identify modules, but rather to identify individual gene pairs links with significant differentially correlations between conditions. using this empirically identified set gene pairs, we demonstrated how integration with megena, which has been previously shown to outperform alternatives in co-expression network construction  <cit> , can be used to construct a planar filtered network and identify informative modules. this integration allows for visualization of the individual differential correlation links and their differential correlation classes, as well as the identification of hub genes within each module, which to the best of our knowledge none of the existing methods offer. notably, dgca is also complementary with several of the previously described approaches, since dgca offers functions to calculate the average correlation difference across conditions within a module of genes, both averaging across all genes in the module and averaging across one gene compared to all other genes in the module.

we further sought to comprehensively assess the performance of the differential correlation modules identified by dgca/megena in comparison with the two most similar methods, diffcoex and dicer. first, in our simulation study for detecting differentially correlated modules, dgca/megena consistently outperformed diffcoex and dicer under the more general simulation settings, whereas dgca/megena has comparable performance with diffcoex and dicer under the more extreme circumstance in which a vast majority of gene pairs are differentially correlated. this result makes sense in light of the fact that dgca/megena adopts a “bottom-up” approach by first identifying differentially correlated gene pairs and then detecting modular structures, whereas diffcoex and dicer employ a “top-down” approach that relies more heavily on a consistent relationship between many gene pairs within a module across conditions. therefore, dgca/megena works well under a wider range of circumstances where diffcoex and dicer miss many less densely connected modules. next, we found that all three of the methods identified differential correlation modules that were significantly enriched for gene signatures related er+ and triple-negative breast cancer subtypes, though dgca/megena and dicer identified the most relevant modules. a limitation of this analysis is that although enrichment of disease-relevant gene sets as a proxy for efficacy in different coexpression module detection has been used before  <cit> , it is unclear whether a more sensitive approach to disease-associated module detection is necessarily better when considering the possibility of false positives. therefore, the problem of optimal differential coexpression module detection on realistic biological data awaits future study, including the identification of a gold-standard data set to compare across methods in an unbiased and biologically meaningful way. however, dgca/megena identified the highest proportion of unique modules and this strongly suggests that dgca/megena does represent a novel method for differential correlation module detection. thus, dgca/megena increases the diversity of options for this type of analysis.

as an important aspect of dgca is the use of permutation samples to assess the statistical significance of differential correlations, we offer some guidelines for the use of this approach. it is important to distinguish between permutation analyses that use pooled empirical null distributions as opposed to analyses that use empirical null distributions from each gene or gene pair  <cit> . for pooled approaches, fewer permutations are needed because information is shared across gene pairs; for example, given a  <dig>  gene data set and five permutations, the differential correlation of each actual gene pair is compared to  <dig> , <dig> permuted gene pairs in order to estimate empirical null p-values. however, this vastly increases the memory footprint required for empirical p-value calculation and q-value estimation. perhaps as a result, some investigators have used only one permutation of the data in such analyses  <cit> . if these memory constraints limit the number of permutations possible, we suggest that a reasonable approach is to repeat the analysis. for example, we repeated the er+ vs tn breast cancer differential correlation analysis three times and found that the number of significantly identified differentially correlated gene pairs at both q <  <dig>  and q <  <dig>  were within acceptable limits  for the purpose of downstream analyses on gene sets. although the above reasoning applies to cases with many gene pairs, heavy filtering of the input data and/or differential correlation calculations of only one gene compared to all others leads to far fewer empirical null statistics. for example, five permutations of the  <dig> gene pairs for the p <dig> differential correlation analysis would lead to only  <dig> permuted gene pairs for use in estimating empirical null p-values, which is why we used more permutations  in this case. non-pooled approaches are commonly used on the data sets with reduced dimensionality, such as the module level, or in our case, in the comparison of the average correlation of each gene compared to all other genes in two conditions. non-pooled permutation approaches commonly use on the order of  <dig> or  <dig> permutations  <cit> , and we use  <dig> permutations to balance interpretability with computational efficiency. notably, the number of permutations in non-pooled approaches delineates a clear lower bound on the empirical p-value that can be ascertained from the analysis. overall, the number of permutations used in dgca for pooled reference distributions depends on the total number of empirical gene pairs under consideration, while for non-pooled reference distributions it depends on the desired sensitivity of the lower bound of empirical p-values.

CONCLUSIONS
despite the theoretical advantages of studying differences in the correlation of key gene pairs between conditions, differential coexpression or differential correlation is not yet widely utilized, partially due to the lack of effective and biology-oriented software packages that enable biological meaningful findings. our r package, dgca, provides a comprehensive and user-friendly tool for not only calculating differential correlation between two conditions but also performing a number of downstream functional analyses including categorization of differential correlations, identification of multiscale differential correlation clustering structures, detection of key differential correlation hubs, and enrichment tests of functional pathways in differential correlation categories and clusters. our differentially correlated gene pair and module detection simulation studies show that dgca and dgca/megena perform favorably compared to the existing alternative methods. our application to breast cancer data demonstrates that dgca is capable of unlocking novel insights into real biological problems. this user-friendly, effective, and comprehensive software tool will greatly facilitate the application of differential correlation analysis in many biological studies and thus will help identification of novel signaling pathways, biomarkers, and targets in complex biological systems and diseases.

software and data availability
the dgca r package will be available for download from cran , a repository of open-source software. source code and other files are available at https://github.com/andymckenzie/dgca.

below is r code for using the dgca package to analyze a subset of a publicly available single-cell rna-seq data set.step  <dig>  load the dgca r package. > library


step  <dig>  read in the gene expression matrix. > data


step  <dig>  read in the design matrix. > data

step  <dig>  perform the basic differential correlation analysis for the gene rtn <dig> between oligodendrocytes and neurons. > dgca_res = ddcorall, adjust = “perm”, nperm =  <dig>  splitset = “rtn4”)


step  <dig>  view the top  <dig> genes differentially correlated with rtn <dig> as well as their differential correlation statistics. > head


step  <dig>  visualize the correlation in each condition between rtn <dig> and its top differentially correlated gene pair in this data set. > plotcors, genea = “rtn4”, geneb = “cox6a1”)


for a more detailed explanation about package usage, please read the r help documents or vignettes. > help; vignette


the cancer genome atlas  datasets supporting the conclusions of this article are available in the national cancer institute's genomic data commons, https://gdc.cancer.gov/.




additional files

additional file 1: gene sets used in the enrichment analysis for the breast cancer modules. the five cleaned gene sets used for enrichment analysis of the differential correlation modules. 


additional file 2: full table for differential correlation output from the p <dig> mutation study. the output of running dgca on the p <dig> pathway gene set in the breast cancer rna-seq samples, comparing correlations of these genes with tp <dig> in non-mutated samples to correlations in p53-mutated samples, using the option to consider only positive correlations in calculate differential correlation between conditions. the “classes” column indicates the correlation class of each of the genes where, e.g., “+/0” indicates a significant positive correlation in the non-mutated samples and no significant correlation in the p53-mutated samples. note that the significance for the correlations within each condition is not adjusted for multiple comparisons.  <dig>  permutation samples were generated in order to estimate empirical p-values, using a pooled reference distribution approach, from which q-values were calculated. wt = wildtype, mut. = non-silent p <dig> mutation. 


additional file 3: differential expression output from the p <dig> mutation study. the results of differential expression  on the input breast cancer rna-seq data filtered for genes in the p53-pathway. note that the contrast called in limma used p <dig> non-mutated samples as the reference condition, so positive logfc values are upregulated in the mutant condition compared to wildtype, while negative logfc values are downregulated in the mutant condition compared to wildtype. 


additional file 4: full table for average differential correlation output from the p <dig> mutation study. genes are ranked by the significance of their median difference in correlation for each gene and all other genes in the p <dig> pathway gene set between non p53-mutated and p53-mutated breast cancer rna-seq samples.  <dig> permutation samples were generated in order to estimate empirical p-values for each gene, which were adjusted by the benjamini-hochberg method to control the false discovery rate among this set of genes. 


additional file 5: full table for differential correlation output from the pten mutation study. the output of running dgca on the pten pathway gene set in the breast cancer rna-seq samples, comparing correlations of these genes with pten in non-mutated samples to correlations in pten-mutated samples. the “classes” column indicates the correlation class of each of the genes where, e.g., “+/0” indicates a significant positive correlation  in the non-mutated samples and no significant correlation in the pten -mutated samples. note that the significance for the correlations within each condition is not adjusted for multiple comparisons.  <dig>  permutation samples were generated in order to estimate empirical p-values, using a pooled reference distribution approach, from which q-values were calculated. wt = wildtype, mut. = non-silent pten mutation. 


additional file 6: differential expression output from the pten mutation study. the results of differential expression  on the input breast cancer rna-seq data filtered for genes in the pten-pathway. note that the contrast called in limma used pten wildtype samples as the reference condition, so positive logfc values are upregulated in the mutant condition compared to wildtype, while negative logfc values are downregulated in the mutant condition compared to wildtype. 


additional file 7: differential correlation modules from each method analyzed. genes identified in each of the differential correlation modules with > <dig> and < <dig> members by dgca/megena, dicer, and diffcoex from the same filtered er+ vs tnbc rna expression data set. 




abbreviations
dgcadifferential gene correlation analysis 

dzdifference in z-scores

er+estrogen receptor-positive 

fdrfalse discovery rate

gocgain of correlation

locloss of correlation

p53tumor protein  <dig> protein isoform

tcgathe cancer genome atlas

tntriple negative 

tp53tumor protein p <dig> gene.

