BACKGROUND
statistical approaches to investigating spatial heterogeneity within dna sequences have attained a considerable interest for decades. however, the foci of such investigations have varied to a large extent from the analysis of spatially heterogeneous base compositions pioneered by works such as  <cit>  and  <cit> , to a kaleidoscope of methods for detecting anomalous evolutionary patterns caused e.g., by gene conversions, viral recombinations etc  <cit> . here we focus on the statistical discovery of recombinant  segments within multilocus dna sequences from bacteria representing heterogeneous populations of fairly closely related species. for a discussion of the various perspectives on the genomic evolution of bacteria, see, e.g.  <cit> . in this article, we use the word population rather loosely to describe a group of related bacteria. this group may correspond for example to a species, or a subgroup of species that is on its way to become a new species . at some points we may also use the word population in another meaning to refer to all strains present in a data set . in such a situation populations within the population may be termed subpopulations. we expect that the meaning of the word should be apparent in any particular situation.

the recent trend among the statistical methods for evolutionary molecular biology is the upsurge of bayesian methods, facilitated by the emergence of a class of powerful markov chain monte carlo  algorithms for fitting complex models to molecular data. examples of such methods in the context of detecting recombination are  <cit> . chan et al.  <cit>  compared the performance of some popular methods for detecting recombination in a phylogenetic framework, and concluded that the bayesian approach yielded accurate inferences. however, their simulation scenario was restricted to a four-taxon comparison, which is very simple in comparison with typical population genetic datasets. .

when targeting to investigate the evolutionary relationships, the quality and informativeness of data as a representation of molecular variation in a population is of utmost importance. the prevailing situation regarding the applicability of the statistical methods is thus somewhat paradoxical, as the large data sets, which are the most representative and comprehensive, are beyond the reach of the currently available bayesian methods. the approach in  <cit>  where bacterial microevolution is considered in terms of recombination intensity, is capable of handling much larger data sets than the above-mentioned change-point models. however, it is not intended for making inferences about the origins of putatively recombinant segments, assuming instead that all recombination events introduce novel polymorphisms. to meet the above-stated challenges, we introduce here a novel statistical method for the detection of recombination events, including a probabilistic characterization of the uncertainty related to the origin of any particular site within the investigated dna sequences. our approach is based on a bayesian spatial structural model representing the continuum of origins for multilocus sequences that has certain similarity with dna segmentation models discussed in  <cit> . bearing in mind the complex microevolutionary patterns typically observed in large-scale analyses of bacterial populations, we do not attempt to solve the inferential problem from an ordinary phylogenetic perspective, but utilize instead a recently introduced successful bayesian framework for modeling genetic population structure. to enable a statistically accurate and practically feasible approach to the analysis of large-scale data sets representing a single genus, we have developed a novel software tool , implementing the model and the corresponding learning algorithm, which is capable of identifying the posterior optimal structure and to estimate the marginal posterior probabilities of putative origins over the sites. the estimated structures can be efficiently explored using the built-in graphics options in brat.

a multitude of challenging simulation scenarios and an analysis of real data from seven housekeeping genes of  <dig> strains of genus burkholderia are used to illustrate the potential of our approach. our method assumes that a clustering of the strains to different populations is available. in our illustrations, we utilize the clustering of the strains obtained from baps  software, see e.g.  <cit> . consequently, the simulations illustrate also the behavior of baps as an unsupervised classification tool for bacterial strain data.

the structure of the paper is as follows. methods section is divided into three subsections: bayesian model for locating recombination events and their related origins describes the model on a general level. details of the bayesian model contains the technical details of the model. estimation algorithms outlines the algorithm for finding the optimal model structure. results section is likewise divided into three subsections: coalescent simulation – a complete example, repetitive phylogenetic simulation experiments and burkholderia data include illustrations of the method with both simulated and real data sets. in discussion we summarize various aspects of the behavior and applicability of the model and compare the introduced method to some alternatives. finishing remarks are provided in conclusions.

methods
bayesian model for locating recombination events and their related origins
we consider a set of sampled bacteria for which aligned dna sequences are available over g genes, indexed as g,  g =  <dig>  ..., g. the cardinality of the sampled set will be kept implicit in our notation to simplify it as much as possible. the observed dna sequences will be denoted by yig for any particular gene g and an individual strain i in the sample. such data for a single strain, say di, are unambigously represented by the integer vectors yig=∈{ <dig> , <dig> }ng, g =  <dig>  ..., g, where the four integers correspond to a mapping from the set of bases {a, c, g, t} and ng is the length of the aligned sequence for the particular gene. we assume that there are no missing observations. correspondingly, d refers to the complete set of observed data for all strains.

in order to achieve a detailed understanding of the gene flow in a population, it is necessary to establish both the presence of genetically separated subgroups inside it , as well as the individual ancestral patterns valid for the members of such subpopulations. a popular approach to modeling the genetic structure of a population is to use a bayesian framework, where the number of putative genetically separated subpopulations is unknown a priori. corander and tang  <cit>  derived a model for this purpose in the present setting, by extending the earlier work of  <cit>  to linked molecular information. however, for large-scale data sets, it is not computationally practical, or often not even feasible, to learn within a single statistical model the genetic population structure, and simultaneously the detailed ancestry of each of the individuals at the finest possible level. at a coarser level, such as that represented by the commonly used admixture models , this is computationally challenging, but still manageable in practice.

admixture models provide useful information concerning the evidence for the presence and absence of genetic barriers among various subsets of the data, and the average amount of putative recombinations that can have taken place to yield the molecular patterns present in the observed sequences. nevertheless, while these models typically contain parameters that correspond to the percentage of the genotype deemed to originate in a specific ancestral group for each individual, they cannot directly pinpoint the locations in the sequences and thus assess the statistical uncertainty about them. the approach developed here can be considered as a complementary statistical tool to be utilized in conjunction with the methods introduced in  <cit>  and  <cit> , to achieve the latter goal of locating recombination events and assessing the uncertainty associated with them.

assume that an estimate, say s, of the genetic population structure underlying the data d is available from the baps software implementing the various methods referred to . in a generic notation, such an estimate will contain samples from k underlying genetically separated groups k, k =  <dig>  ..., k. each of the k groups can now be putatively considered as the origin of any particular genomic segment present in di. in addition to the putative ancestral origins identified in the unsupervised classification, we also consider explicitly the possibility that any particular dna segment has its origin outside the investigated set of samples. in the sequel we let one of the k clusters corresponds to the outgroup, from which no reference samples are available, while the rest of the clusters correspond to the non-empty clusters detected in the clustering analysis.

the notation used in the sequel will treat the recombination events for each gene separately, conditional on the population structure s. in order to simplify the notation, the dependence of the proposed model on s will be kept implicit, whenever possible. however, we wish to emphasize that the statistical uncertainty about the molecular characteristics of each inferred subpopulation in s is taken into account by our model. let ρ = be a partition or segmentation of the sequence yig, defined by the set of breakpoints satisfying  <dig> = ρo <ρ <dig> < ... <ρm- <dig> <ρm = ng, such that each ρc, c >  <dig>  is an integer determining the end point of a segment in the partition of yig. if the number of segments m >  <dig>  the actual set of sites belonging to the segment c in the partition is given by , otherwise the whole sequence consists of a single segment . note that the number of segments m is considered unknown in our modeling framework, and it is one primary target for the statistical inference. in concrete terms, each ρc in ρ specifies here a segment of a nucleotide sequence which has originated as a whole, either by binary fission or by recombination from one of the k putative ancestral sources.

let z =  be a random vector specifying the origins for each of the m segments in ρ, i.e. zc ∈ { <dig>  ..., k}. thus, z determines unambiguously the origin xj ∈ { <dig>  ..., k} for each site j, j =  <dig>  ..., ng in yig. our inferential goals can now be specified as follows. firstly, we seek to identify the partition of yig and the origins of its segments, leading to an optimal probabilistic prediction for the observed sequence. this estimate corresponds to a pair  maximizing the posterior distribution over the joint space of combinations of partitions and origin vectors. secondly, we aim to quantify the uncertainty related to the estimation by providing marginal posterior probabilities for every xj, the origin of the jth base in yig.

to represent the nucleotide variation existing in a bacterial population due to mutation and recombination, our model incorporates parameters for the unknown relative frequencies of bases at each considered site, separately for each of the k subpopulations in s. these are determined by pkjl, g =  <dig>  ..., g, k =  <dig>  ..., k, j =  <dig>  ... ng, l =  <dig>  ...,  <dig>  where the last index corresponds to the four possible bases. let θ denote jointly the set of all such parameters pkjl and p the corresponding distribution over the joint space of probability vectors Θ, describing the uncertainty remaining about θ after the qualitative genetic structure s has been learned. to make inferences about the structure  of the sequence yig, given all the observed data d, we utilize the posterior distribution of , which can be written as

  p∝pp=p∫Θppdθ, 

where p  is a prior distribution for the structure of the sequence and p  the likelihood of the observed sequence, conditional on the model parameters. the exact mathematical details of these model components are provided in the next subsection details of the bayesian model.

the analytical form of the posterior distribution  of  derived in the next subsection enables computationally attractive ways of learning plausible ancestral structures, represented by , for observed sequences, as discussed in the subsequent subsection estimation algorithms. recall that our second inferential goal is to provide an estimate for the marginal posterior probabilities of xj's, i.e. the origins of all the bases. the probability of xj = xj can be estimated by summing the posterior probabilities  of all structural models , for which this condition holds. since it is computationally impossible to use a complete enumeration to treat all the possible models, and we wish to avoid a tedious mcmc analysis, we have developed an approach to choose those models which are the most relevant ones for calculating the marginal probabilities .

details of the bayesian model
here we provide the mathematical details of the bayesian estimation of the structural parameters  for the sequence yig. because the analysis will be the same for all i and g, we will drop the indices here to simplify the notation, and use simply y = for the gene g of individual i. similarly, n denotes the length of the gene g, pkjl the relative frequency of base l in population k, in site j of the gene g, etc.

let s* denote a partition of the strains obtained from the original population structure s by removing the strain under investigation. let nkjl denote the observed count of base l at site j in population k in s*, and nkj the total number of observations available from population k at site j. the likelihood term in the posterior  is defined as

  p=∏k=1k∏j=1n∏l=14pkjlnkjl+i 

where i  is an indicator function, which equals unity if the jth site in y is assigned to the kth cluster and the base at the site equals l, otherwise i is equal to zero. this form of the likelihood  corresponds to the assumption of conditional independence of the sites within a single gene g, given the population relative frequencies of the bases θ. more complex models formulating the linkage of the sites could also be used, such as the one introduced by  <cit> . however, the current form of the likelihood leads to a simplified computation. the conditional independence assumption is commonly utilized in bayesian models, and works usually quite well, even if it may be unrealistic in practice  <cit> .

given an initial prior for the vector l= <dig> equal to the dirichlet  distribution, the corresponding posterior for l= <dig> is also a dirichlet distribution. here we use αl = 1/ <dig>  l =  <dig>  ...,  <dig>  which leads to the following expression for the marginal likelihood

  p=∫Θppdθ=∏k=1k∏j=1nΓΓ))×∏l=14Γ)Γ=∏k=1k∏j=1n1Γ)×∏l=14Γ)Γ. 

the specification of the posterior  still requires that we quantify prior probabilities for the underlying sequence structure

  p  = p  p . 

firstly, conditional on the partitioned sequence, we consider all combinations of segment origins to be equally likely, which leads to

  p  = k-m. 

secondly, there are two characteristics to be met by the prior distribution p . the prior should be relatively vague, in order to avoid strong influences towards the locations and abundance of recombination events, and also, it should lead to computationally tractable solutions. an immediate candidate for such a prior would be the uniform distribution over all possible partitions of the sequence. however, such a prior would give too much weight to partitions in which some, or many of the segments are only one or few bases long. this is not reasonable from a biological perspective, as the recombinant sequences could then be reduced to point mutations in the most extreme configurations. also, from the statistical perspective, the resulting partitions could easily reflect unidentifiable models. to resolve this issue, we utilize a prior defined by

  p = c × i, 

where c is a constant and i is an indicator function, such that

 i={ <dig> if ρc−ρc−1≥l,∀c= <dig> ...,m− <dig> otherwise. 

thus, the prior  is uniform over all partitions, which do not contain any segments shorter than l, except that the first and the last segments are allowed to be of any length due to computational simplicity and also the obvious biological fact that in practice the recombined segments may continue beyond the endpoints of a gene.

sequence data usually contain quite limited information for formal learning of the parameter l. therefore, we have chosen a strategy of using a fixed value l =  <dig>  which was considered reasonable from the biological point of view. in general, we concluded that as long as l is not too small, the results are quite robust with respect to the exact value of l . if l is too small, say less than  <dig>  then local features may have strong influence on the calculated marginal posterior probabilities . this undesired behavior was actually the main reason why the prior  excluding unrealistically small segments was selected. the above derived analytical form of the kernel function of the posterior distribution  of  now enables computationally attractive ways of learning plausible ancestral structures for observed sequences.

as stated earlier, our second inferential goal is to provide an estimate for the marginal posterior probabilities of xj's, i.e. the origins of all the bases. the probability of xj = xj can be estimated by summing the posterior probabilities  of all structural models  for which this condition holds. since it is computationally impossible to use complete enumeration to treat all possible models, and we wish to avoid a tedious mcmc analysis, we have developed an approach to choose those models which are the most relevant for calculating the marginal probabilities. for this purpose, some new notation is necessary to be introduced. let ρ denote a partition induced by ρ for the interval  of bases, i.e., for all j, j' such that a a ≤ j, j' ≤ b, j and j' belong to the same segment in ρ, if and only if they belong to the same segment in ρ. analogously let z  be the vector of origins for the segments in ρ, induced by z. in the sequel we denote the subset of data d corresponding to positions  by d .

the marginal posterior probabilities of origin for any single site are defined by

  p=∑:xj=xjpp∑pp 

using the assumed conditional independence of the values of the bases, given the structural parameters, the probabilities in the numerator can be expressed using the following factorization:

  ∑:xj=xjpp=∑∋j,b−a+1≥lpk−1×∑ρ,zpk−|ρ|×∑ρ,zpk−|ρ|,=∑∋j,b−a+1≥lp×k−1pp 

the interpretation of  is that instead of summing directly over all possible partitions, we take the outmost sum over all possible segments including the jth position, and outside that segment, we still sum over all possible ways of partitioning the sequence.  because of the assumed conditional independence of the sites,

 p=∏r=abp, 

we see that  is a sum of products, such that p  is a factor in all of the terms, and the closer i is to j, the more terms in the sum have the marginal likelihood of the ith site, p, as a factor. thus, because k- <dig> p  p in  does not depend on xj, we conclude that p  is mostly determined by the sequence positions close to j.

this motivates the following approximation for :

  ∑∋j,l≤b−a+1≤lmax⁡pk−1pp 

where lmax is a sufficiently large integer to provide reasonable accuracy for the approximation. thus, lmax specifies the distance along the gene such that observed values further than lmax from site j have no direct effect on the calculated marginal posterior probabilities for site j  by affecting p  and p ). thus, the exact value of lmax has some effect on the calculated marginal posterior probabilities by determining a region in the sequence from which the evidence is summarized by the marginal posterior probability distribution for origins of site j . to derive an appropriate value for lmax in practice, we calculate a value using the criterion

  lmax⁡=min⁡{x∈ℕ+:p> <dig> }, 

where p is calculated using the prior probability for the partitions. lmax is calculated in practice using the recursive procedure described at the end of this section.

since an exhaustive enumeration of the possible partitions for the regions outside of the segment  in  is computationally impossible, we will utilize an approximation for the values of p  and p . bayesian asymptotics, see, e.g.  <cit> , show that

  p≈pp 

when the amount of data increases, i.e. the sum of marginal likelihoods will be dominated by the single term corresponding to the optimal model  for the interval . we simplify  further by writing

  pp∝pp, 

where k^ denotes the single origin maximizing  for the segment . thus, instead of using the globally optimal model for interval , we use a model in which the segment  has been assigned as a whole to one optimal origin. in practice the effect of approximation  usually cancels out. suppose that some part of  should be from another origin than k^. then, using the correct model would increase the marginal likelihood p  in  by some factor. however, the value of p  acts as a factor in the sum  in a term corresponding to interval  also for a competing origin, say xj∗, and thus the approximation treats the competing origins equally. furthermore, because we are only considering the surroundings of j up to a distance of lmax, possible recombinant segments more distant than lmax bases from j would affect p  for all of the terms in the sum  for any origin xj, and thus cancel out. in supplementary material  we illustrate the error caused by the approximations  and , and conclude it to be negligible in practice. the probability p is approximated analogously to p. because the models considered in the approximation all consist of three segments, and thus have equal priors, our final version of the required marginal probability can be written as

  p∝∑∋jl≤b−a+1≤lmax⁡p×p×p. 

all the terms in  can be evaluated analytically using an expression corresponding to one segment in 

 p=∏k=1k∏j=ab1Γ)×∏l=14Γ)Γ. 

to derive an appropriate value for lmax in , we utilize the following recursive procedure under the specified prior distribution  for the sequence partitions. let a denote the number of partitions of a sequence of length t, such that all segments, except possibly the first, are at least of length l =  <dig>  for small values of t we have

 a =  <dig>  for k =  <dig>  ...,  <dig>  

further, for t =  <dig>  ..., n, where n denotes the length of the gene, a may be written using a recursive formula as

 a=1+∑j=1t−15a, 

where  is a segment and the sum is over all possible locations j for the breakpoint preceding t. thus, the number of partitions in which  is one segment is given by

 n={ <dig>  if a=1 and b=n,a, if a=1 and b<n,a, if a>1 and b=n,a∗a, otherwise. 

consequently, the sum of prior probabilities of partitions in which  is one of the segments, is given by

  n∑j=n−14na, 

where the denominator is the number of all partitions with positive prior probability . the prior probability that the length of the segment containing j equals t is obtained by summing values given by  for all , which contain j and are of length t. for instance, for gene lengths between 300– <dig> bases, the prior probability that a segment containing j is shorter than  <dig>  is at least  <dig> , which in this case provides us a value for lmax in .

estimation algorithms
standard mcmc algorithms, such as the gibbs sampler or metropolis-hastings algorithm have generally been adopted as tools of choice for fitting bayesian models to data  <cit> . however, it is generally acknowledged in statistical literature that numerical convergence and mixing problems for such methods are burdening their application to complex models. therefore, a myriad of methods have been developed to solve various problems arising in the practical applications, see, e.g.  <cit> . particularly challenging classes of bayesian learning problems are represented by situations where the model dimensionality is not fixed a priori , as well as general combinatorial optimization tasks  <cit> .

our sequence structure model introduced in the previous subsections has the necessary characteristics to enable estimation of the posterior using the general parallel non-reversible metropolis-hastings algorithm introduced by  <cit> . a central feature of the algorithm is the possibility to utilize intelligent stochastic search operators for which proposal probabilities cannot be calculated in a closed form. corander et al. demonstrated that already with relatively simplistic random search operators the non-reversible algorithm outperformed a comparable reversible algorithm for fitting a bayesian unsupervised classification model to a large bacterial database. nevertheless, as concluded by  <cit> , despite of its advantages, the parallel non-reversible algorithm is still very demanding computationally on a single cpu architecture for complex models. as this limitates the application in practice,  <cit>  developed a stochastic greedy optimization algorithm that utilizes intelligent search operators both locally and globally to identify model structures associated with high posterior probabilities. here we exploit an analogous approach to optimize the partition of the sequence and origins for different clusters based on .

to enhance the search for the optimal structure, we identify first a candidate structure for the sequence by using the calculated marginal probabilies  to assign each base to the origin with the highest marginal probability. although this procedure may lead to a non-legitimate initial model structure with some segments having length smaller than l , these are merged later in the actual search procedure to yield only models with positive prior probabilities.

given an initial model configuration, our search for the posterior optimum uses the following steps:

 <dig>  identify the two adjacent segments of different origins for which an assignment to the same origin yields the largest improvement in the posterior probability of the structure. repeat such assignments until no improvement can be obtained for the posterior probability.

 <dig>  for all c =  <dig>  ..., m -  <dig>  where m is the current number of segments, identify the location of the breakpoint ρc associated with the highest posterior probability for the subsequence from ρc- <dig> +  <dig> to ρc+ <dig> 

 <dig>  if the current partition contains segments with length <l, each of them is merged to an adjacent segment leading to largest posterior probability among the two alternatives.

the three above steps are repeated in our algorithm until no improvement is obtained for the posterior probability. in practice the algorithm converges very rapidly, and furthermore, partitions with one or more segments having length <l  occurred very seldom after the second step in our computational experiments with both real and simulated data. the reason for this can be seen from the analytical form of the marginal likelihood conditional on the structural parameters, as it is unlikely that such a short interval would contain enough information to compensate for the increased uncertainty related to the parameters specifying the origin of the interval  when a novel segment is added). thus, the last search operator rather guarantees under such unlikely events that all considered states are legitimate, i.e. having strictly positive posterior probabilities. as with greedy search algorithms in general, no guarantee can be given that the search really finds the globally optimal model. local modes are more commonly encountered in a situation with a lot of uncertainty. this uncertainty is in our approach reflected by the marginal posterior probabilities of the origins of the sites. thus, if these probabilities show a considerable amount of uncertainty, it is likely that the model space contains models which are approximately equally good descriptions of the data, and the search finds only one of the alternatives. in such a situation the uncertainty related to the estimated model should anyway be taken into account when interpreting the results. notice also that although the parameters l and lmax do not have a direct effect on the optimal model, they may have an indirect effect on the estimated optimal model in a situation with a lot of uncertainty, because they have some effect on the marginal posterior probabilities which are used to define the starting point for the search .

in practice the number of putative origins of a segment in a data set may be very large. however, it is not feasible to consider all of them as equally likely candidates in the segmentation model, because this would make it impossible to produce any meaningful graphical presentation of the results. to account for the uncertainty relevant for most practical situations, we restrict the maximum number of putative origins to equal  <dig> for any single sequence. the most plausible origins are detected automatically by our software implementation for the investigated strain. we have implemented the automated selection of the putative origins as follows. firstly, the most important putative origin equals the subpopulation into which the investigated strain was allocated in the genetic clustering suggested in the previous sections as the first phase of the recombination analysis. secondly, an empty cluster should always be included to account for the events where a segment has an ancestral source outside the subpopulations present in the current sample. to select the remaining eight origins, we scan through all the segments of length  <dig> bases and select all those subpopulations which have the highest predictive likelihood in some segment. if less than eight clusters are selected in this way, additional clusters will be chosen, based on the predictive likelihood for the whole sequence. if more than eight clusters are selected, those of the selected clusters which have the lowest predictice likelihood for the whole sequence, will be removed. the resulting group of ten clusters will be used in the analysis.

RESULTS
coalescent simulation – a complete example
we next illustrate our method with a realistic synthetic data set, created by using a software recodon  <cit> , which is able to generate samples of codon sequences from populations with recombination, migration and demography, using a coalescent. recodon allows the user to specify several parameters defining the properties of the simulation. the values of different parameters can be found in the parameter file  which we provided as an input for the software.

the simulated data set consists of genes of length  <dig> bp for a set of  <dig> strains. a genetic mixture analysis of these data with baps software yielded six clusters. these clusters represent various levels of heterogeneity, such that the average distances among the members of a single cluster are in the interval from  <dig> to  <dig> bp, whereas the average distances between different clusters range from  <dig> to  <dig> bp. as it is not feasible to present here the complete results, some interesting features are highlighted for three selected strains, and the complete results are shown in the supplementary material . results for the strains selected for illustration show features which can be expected to be observed in typical data sets. the simulation process created a total of  <dig> recombination breakpoints, and hence, the strains consist of  <dig> gene fragments with differing evolutionary histories. the evolutionary trees for the fragments were obtained from recodon output. we used drawgram program included in phylip software package  <cit>  to draw the trees. an example of such a tree is shown in figure  <dig> for the second gene fragment. remaining trees are provided in the supplementary material. in general, the clustering obtained with baps correlates strongly with the true evolutionary histories of the fragments. this is also apparent in figure  <dig>  with the following two exceptions. firstly, strain # <dig>  which is assigned to the magenta-colored cluster, is with respect to this fragment very closely related to the strains of the cluster labeled by the red color. secondly, strains # <dig> and # <dig>  which form the cluster labeled by the green color, are not very closely related to each other.

as our first example, we investigate more closely the strain # <dig>  the results of recombination inference for this strain given the baps clustering are shown in figure  <dig>  the results of the recombination analysis are summarized by two plots, marginal probability profile, which shows graphically the posterior distributions for xj, and optimal model profile, which shows the optimal partition with each segment assigned to the optimal origin. we will refer to these two profiles jointly as a recombination profile. figure  <dig> also displays for each gene fragment the average molecular distances between strain # <dig> and the strains in the six identified clusters. recalling that the strain was assigned to the magenta-colored cluster in baps clustering, this cluster is indeed associated with high values in the marginal probability profile for the fragments 3– <dig>  also, for all these fragments, the magenta-colored cluster is the closest one in terms of sequence similarity, which can be seen from the lower pane of figure  <dig>  an inspection of the evolutionary histories of these gene fragments  verifies that the strain # <dig> is most closely related to other strains of the magenta-colored cluster. the optimal segmentation model assigns the first two gene fragments to the red-colored cluster, supported by conclusive marginal probabilities. as already seen in figure  <dig>  the second fragment of the strain # <dig> is really evolutionarily linked to the strains of the red-colored cluster, and the same result holds for the first gene fragment .

the last two gene fragments are in the optimal segmentation model assigned to the magenta-colored cluster. however, the marginal probability profile associates also the blue-colored cluster with high values. an inspection of the distances in figure  <dig>  reveals that the magenta- and blue-colored clusters are roughly equally distant from the strain # <dig> in the second last fragment, and furthermore, that in the last fragment this strain resembles most the members of the blue-colored cluster. the close relationships of the strain # <dig> with the strains in magenta- and blue-colored clusters can similarly be seen in the evolutionary histories for these fragments.

our second and third examples illustrate cases where the optimal model suggests a recombination event which is not supported by the evolutionary histories of the gene fragments. figure  <dig> displays the results of recombination inference for the strain # <dig>  for which a gene segment  is assigned to the red-colored cluster by the optimal model. this recombination event can not be identified in the evolutionary histories of the corresponding fragments. however, a closer investigation reveals that in this segment the strain # <dig> is in fact identical to all the strains in the red-colored cluster, whereas it has on average  <dig>  bp differences to the other strains allocated to the blue-colored cluster . thus, the recombination suggested by the optimal model corresponds here to a region in which mutations are by chance accumulated in an unexpectedly short interval.

the third example is shown in figure  <dig>  where the results from recombination inference are shown for the strain # <dig>  it can be concluded that the yellow-colored cluster is located closest to this strain in all the gene fragments. however, there is still a short segment overlapping the first and the second fragments, which is considered as recombinant in the optimal model. this is explained by the fact that, apart from the strain # <dig>  there is only one additional strain in the yellow-colored cluster. therefore, there is considerable uncertainty regarding the nucleotide frequencies associated with the cluster. consequently, the cluster may be assigned fairly low marginal posterior probabilities, if there exists at least a single alternative cluster with the characteristic that its strains are equally dissimilar to the considered strain. in the segment identified as putatively recombinant by the optimal model, the cyan-colored cluster is least dissimilar to the strain # <dig>  with an average distance of  <dig>  bps, whereas the other strain in the yellow-colored cluster differs by one nucleotide.

the second and the third examples illustrate potential causes of a phenomenon which can be considered as false positive recombination discovery. however, it should be stressed that the putatively recombinant segment in the optimal model was not conclusively supported by the marginal posterior probabilities in neither of these cases, as opposed to the first example where the true recombination event was identified. in particular, it is important when interpreting the results that the conclusions based on the optimal recombination profile reflect the uncertainty present in the marginal probability profile. it is also worth noticing that in these cases the suggested recombinant segments were relatively short . this feature we have observed also more generally to hold in similar situations. to aid the interpretation of the estimation results, our software implementation of the method  provides an immediate access to the average distances with respect to the different clusters for an arbitrary selected sequence region, as well as to levels of molecular variation within the clusters.

repetitive phylogenetic simulation experiments
as the analysis of the coalescent data set in the previous subsection illustrated, the behavior of the introduced method depends on the characteristics of any particular data analysis situation. these characteristics include for example the genetic distance and sizes of the populations involved in the recombination event.

in this subsection we investigate more closely five different types of scenarios, which cover the most important types of characteristics expected to be present in a molecular data set. these scenarios are: 1) recent recombination between distantly related strains, 2) recent recombination between closely related strains, 3) old recombination, such that the recombined fragment is present in all members of a population, 4) recombination event involving a population with only a very limited number of members , and 5) recombination where the recombinant fragment is not acquired from any of the populations present in the observed data. each of these five situations is further investigated under three different levels of molecular variation.

the used simulation setup was inspired by  <cit> . each of the five different scenarios was generated by dividing the recombined gene into two parts, such that the left part was  <dig> and the right part  <dig> bases long. for both parts we used fixed evolutionary trees. for the left-side tree we used a tree corresponding to the sixth fragment in the coalescent simulation in the previous subsection. this tree is shown in figure  <dig>  and it was chosen as the basis for the repetitive simulations given the perfect correspondence between the tree and the estimated clustering . the right-side trees were created by manually modifying the left-side tree in the different situations as follows: 1) a strain was moved to a branch on the other side of the tree, 2) a strain was moved to a nearby branch, 3) a branch containing all the members of a population was joined with another branch, 4) a strain from a miniature cluster was moved to another branch in the tree, and 5) a strain was moved to its own branch which joins the tree near the root. for details of which specific strains were moved, see caption of figure  <dig>  figures of the right-side trees are shown in the supplementary material . for each type of data,  <dig> replicate data sets were generated using software seq-gen  <cit>  using hky model  <cit>  with base frequencies arbitrarily specified as  <dig> ,  <dig> ,  <dig>  and  <dig>  for a, c, g and t respectively, and transition/transversion ratio set to  <dig> . the three different levels of molecular variation were achieved by specifying three different heights of the tree:  <dig> ,  <dig>  and  <dig> , where the height corresponds to the distance from the root to any one of the tips in units of mean number of subsitutions per site.

we analyzed the generated data sets using the fixed populations shown in figure  <dig>  however, as the level of genetic variation is expected to affect the resolution of the clustering obtained from baps, it is of interest to investigate how the clustering would be different, if it had been estimated with baps. for this purpose, we used baps to cluster five arbitrary data sets corresponding to the first data set type and each of the three levels of molecular variation.  indeed, the resolution increased with respect to the increasing height of the tree, because the divergence between different populations increased. when the height of the tree was  <dig> , four out of five data sets were clustered in exactly the same way as the specified clustering, and the clustering for the remaining data set contained one additional cluster, corresponding to the branch containing strains  <dig> and  <dig>  when the height was  <dig> , all the estimated clusterings were exactly the same as the specified clustering, except that the miniature cluster with yellow label was merged with the cluster with red label. when the height was  <dig> , both the miniature clusters  were merged with their closest clusters. additionally, in one data set also clusters with blue and magenta labels were merged. thus, it is possible that some of the investigated situations would not be encountered in practice, if the clustering was performed with baps  would be identified as a separate cluster in baps analysis).

we analyzed the recombined strains in the generated data sets with the introduced method . in the data type in which more than one recombined strain was present in a data set , only one of the recombined strains was analyzed from each data set. the results of these analyses are summarized in figures  <dig>   <dig>   <dig>   <dig>   <dig>  here we describe the findings for each data type separately.

 <dig>  figure  <dig> shows the results for the strains which have had recent recombination with strains to which they are distantly related. the results show that the method has little difficulty in identifying this type of recombination events. in the optimal model profiles the breakpoints are inferred very close to the correct location, and only in the situation where the populations are least diverged  two additional breakpoints are present in the optimal profiles. the marginal probability profiles correctly assign high probabilities to the left-side origin in sites 1– <dig>   although the variation in the marginal probability profiles increases with decreasing divergence between populations, even in the least diverged case  the worst-case profile assigns very high probabilities for left-side origin in a vast majority of sites 1– <dig>  thus facilitating the correct interpretation.

 <dig>  figure  <dig> shows the results for the strains which have had recent recombination with strains belonging to a nearby branch in the evolutionary tree. because the populations of origin of the fragments are now closer to each other, some additional variation is added to the results as compared to those in figure  <dig>  especially the locations of the breakpoints are now slightly more widely spread around the correct location and the left-side origin may be assigned higher values also in the sites 501– <dig>  this is observed especially with h =  <dig> . yet, it can be concluded that the results still reflect very well the underlying biological truth.

 <dig>  figure  <dig> shows the results for recombined strains which belong to a population where all members have a recombined fragment . in this case, it would be equally correct for the optimal model to assign the right-side fragment to either of the possible populations. the presence of two alternative origins for the fragments clearly affects the inferred breakpoints in the optimal profiles. the number of breakpoints is around  <dig> for h =  <dig>  and h =  <dig> , indicating that at most about a third of the strains had any breakpoints in their optimal model profile while a majority of optimal models constituted of just one segment assigned to the left-side origin. the number of breakpoints is yet lower with h =  <dig> . furthermore, although these breakpoints are most often found close to the 500th site, they are also found spread along the whole fragment.

to aid in making the correct interpretation, the marginal probability profiles should assign clearly non-zero probabilities to both of the possible origins in sites 501– <dig>  regardless of the inferred optimal model . interestingly, it is now the case with the least variation  in which the marginal probabilities are closest to the optimal behavior, as even the 0th and 100th percntiles are clearly separated from zero and unity for probabilities assigned to both the possible origins. the explanation is that the amount of divergence between the populations after the recombination event matters here considerably more than the divergence before it . indeed, because in the right-side tree the population with the recombined fragment still constitutes its own subbranch in the branch of the other population, with increasing h the difference between these populations becomes statistically relevant. this can be seen in the case with h =  <dig> , where the left-side origin is on average assigned clearly higher probabilities than the right-side origin in sites 501– <dig> 

as can be seen in the worst-case profile with h =  <dig>  and h =  <dig> , the condition that both origins should be assigned clearly non-zero probabilities in sites 501– <dig> to aid the making of the correct interpretation does not always hold. however, with h =  <dig>  the 5th and 95th percentiles are clearly separated from zero and unity, indicating that for the majority of strains the correct interpretation can be reached. we investigated this further by counting the number of strains such that for either origin there are maximally  <dig> sites in which the origin is assigned a probability less than or equal to  <dig>  . altogether  <dig> strains out of  <dig> satisfied this condition indicating that in the majority of cases the correct interpretation can be reached. for the case h =  <dig>  the same figure was only  <dig>  because the right-side origin was assigned clearly lower probabilities in general than the left-side origin. this fact simply highlights the point that the populations have already become so diverged that the model treats them as distinct. although the correct interpretation can be made for some strains, for other strains only traces of the shared evolution are still visible in terms of elevated probabilities for the right-side origin at some parts of the recombined fragment.

 <dig>  figure  <dig> shows the results for the strains belonging to a cluster with only a limited number of strains . these results highlight the fact that when there is considerable uncertainty concerning the nucleotide frequencies in the cluster to which the strain under investigation is assigned, the results should be interpreted with caution. the optimal models contains a large number of breakpoints within the left-side fragment, and there is also a lot of variation in the marginal probability profiles within this fragment. with h =  <dig>  the worst-case probabilities assigned to the left-side origin in sites 1– <dig> are completely misleading. with h =  <dig>  the situation is somewhat improved while with h =  <dig>  the results are already decent, such that in the majority of sites even in the worst-case profile the left-side origin is assigned high probabilities. however, as discussed above, it is unlikely that the h =  <dig>  case would be encountered in practice, if the populations are inferred using baps, because the miniature cluster would most likely be merged with another cluster . nonetheless, it may be completely possible to identify a fragment which has been obtained from another population with at least a moderate number of strains, as the results for the right-side fragments illustrate.

 <dig>  figure  <dig> shows the results for the strains where the recombinant fragment has its origin outside the populations represented in the data. these results quite expectedly show that the detection of the recombination is in such scenario more difficult than in the case where the origins of the fragments are present in data. nevertheless, the statistical power to detect such recombination events increases with increasing divergence between the populations . while with h =  <dig>  the recombination from outside may in the worst-case be completely undetected, on average the results are already satisfactory with h =  <dig> . with h =  <dig>  the recombined fragments from the outside can be inferred with good accuracy. it is worth noticing that within the fragments obtained from the outside of populations the optimal model may contain short intervals assigned to different origins. this is simply a consequence of the fact that the optimal model must assign all the sites to some origin, and certain parts of the fragment may by chance always resemble strains in some population. thus, if the marginal probability profile contains areas where the outside origin is assigned elevated probabilities, the optimal models should again be interpreted with caution.

in addition to the above simulation experiments, in the supplementary material we present experiments based on fairly simplistic stochastic forward simulations, which were initially utilized to investigate the elementary behavior of the developed method under various circumstances. three main types of such experiments were performed: 1) balanced sample sizes and true sources of recombinant segments present in the data, 2) balanced sample sizes present but the true source of recombinant segments remaining outside of the available data, 3) unbalanced sample sizes with multiple species represented by a very limited number of strains. especially the third situation setup provides some relevant additional information to the simulations presented here. specifically, when there are several strains in a data set which are sole representatives of their true populations, such strains may be combined into a single hybrid-like cluster in the baps analysis . because the estimates of the nucleotide frequency parameters of such clusters contain considerable uncertainty, the recombination profiles may look noisy, as with the data type involving recombination with a miniature cluster. for further illustration of hybrid clusters, and guidelines for drawing correct interpretations in a situation involving them, see the supplementary material.

to summarize the simulations briefly, we conclude that the method works very well in situations where a sufficient number of strains from populations involved in the recombination event are present in the data. in a situation where some fragment is shared by two populations, the optimal model most often contains no breakpoints, but the marginal probability profiles assign elevated probabilities to the alternative origins. we have also investigated and discussed cases where the nucleotide frequencies of an origin for some fragment include a lot of uncertainty . in such situations the optimal model profile often contains several short segments assigned to various origins, and the marginal probability profiles fluctuate, but do not indicate strong evidence for any particular population. in these situations we recommend a conservative way of making interpretations, such that only the conclusions which are strongly supported by the marginal probability profile should be considered. also, we recommend investigating all the genes of a strain when making interpretations concerning any particular gene, as information pointing consistently to the same direction can be useful . also, investigating the results for all the strains in a cluster as a whole may be helpful if there is some structure within the cluster. in the next subsection, we show how to use these guidelines when investigating a real data set.

burkholderia data
to illustrate the presented method with a real data set, we use burkholderia data introduced earlier in  <cit> . the data set consists of  <dig> strains from burkholderia cepacia complex . the bcc is a widespread group of related bacteria found in a variety of environments, although little is known about the natural history of these organisms  <cit> . the bcc are potentially economically very important but are also important opportunistic pathogens among vulnerable individuals  <cit> .

the strains in the data set either belong to one of nine different species, or are unlabelled. some of the species are further divided into subgroups. the names of the species, as well as the number of strains from each species are shown in table  <dig>  each strain is characterized by seven genes, the lengths of which vary between  <dig> and  <dig> bases. table  <dig> shows a distance matrix for the species present in the data.

the species present in the burkholderia data set, their labels, and the number of strains from each species.

the distances are measured as the number of differing bases in the sequences. the off-diagonal values are average distances between the members of the corresponding species. the values on the diagonal are average distances between the members of any single species. the total length of the seven genes in the data is  <dig> bases.

the bcc have recently emerged as human pathogens and provide us with a fascinating group of important model organisms with varied population biology across their different species. human colonisation by some strains and their ability to survive anti-infectives may have been heightened by adaptation processes with other bcc strains  <cit> . they represent an exceptional group to examine how opportunistic pathogens have evolved and how we might use this information to inform on their control.

the novel mlst  scheme of the bcc having identical alleles and therefore comparable sequence data across > <dig> species, has provided us with a unique framework, enabling us to explore mutation and recombination events and their impact upon evolution, speciation, niche adaptation, antimicrobial resistance and pathogenicity. although co-colonisation of different bcc is documented clinically  <cit> , little is really known about the ecology and genetic exchange of bcc in the environment. from genome sequences available for several bcc species it is clear that they have multi-chromosome genomes  of which  <dig> – <dig>  mb can be accounted for by mobile elements, phage, is and genomic islands. the distribution and functional impact that this laterally acquired dna has on pathogenicity is largely unknown  <cit> , though comparisons can be made with the b. pseudomallei and b. mallei genomes  <cit> .

the results obtained by the introduced method will provide a starting point in answering the following biologically relevant questions:

 <dig>  do genetic alterations facilitate niche jumping from different environments to clinical settings?

 <dig>  how does recombination affect pathogenicity and pathogen-host interactions and how does this shape our understanding of natural communities?

 <dig>  what are the roles of local or widespread recombination events in the emergence of new species?

the unsupervised mixture classification with baps identified eight clusters for the burkholderia data, shown in table  <dig>  the obtained population structure is highly consistent with the species classification given in the database. only one of the species, b. cenocepacia, is split into two distinct groups, corresponding to different subspecies for b. cenocepacia. in total, two of the obtained clusters contained strains from two or more species.

the eight clusters for the burkholderia data set identified by the unsupervised mixture clustering analysis.

in addition to using baps to identify the required clustering for the data, we carried out an admixture analysis for the data with an admixture model, also implemented in baps  <cit> . as opposed to the methodology introduced here, baps admixture model considers simultaneously the observed pieces in the whole genome to estimate the appropriate weights for the admixture proportions corresponding to the different ancestral origins, while not reflecting the actual locations of the recombined areas in the sequences. for this reason, it is also possible that baps may fail to identify some recombination events, even in the presence of a strong signal within a relatively short interval of bases, when the signal is not significant on the level of the complete observed concatenated sequence. the results obtained by the introduced method are compared with the corresponding admixture results obtained by baps.

here, our goal is not to give a complete description of the obtained results or to draw profound biological conclusions. rather, we aim to illustrate the behavior of the introduced methodology  in a realistic challenging setting. to do this, we consider in detail three different specific issues concerning the structure of the molecular data. each of these issues is illustrated by estimated sequence structure of a particular strain and the related statistical characterization of the uncertainty, and is accompanied by a different biological interpretation. to maintain readability, we leave out some details of the analysis leading to presented conclusions. a more detailed description can be found in the supplementary material .

b. cenocepacia iiic
the baps admixture analysis identified five strains as having statistically significant evidence for admixture. in particular, both strains from species b. cenocepacia iiic were identified. as our first example, we consider in detail one of the admixed b. cenocepacia iiic strains. in total six of the clusters were associated with non-zero estimated admixture coefficients for this strain in the baps analysis, the estimates being: cluster 1:  <dig> , cluster 2:  <dig> , cluster 4:  <dig> , cluster 5:  <dig> , cluster 6:  <dig> , and cluster 7:  <dig> . the recombination profile obtained by the introduced method is shown in figure  <dig>  immediately, areas in the sequence having a particular cluster as the most likely origin can be identified for each cluster associated with non-zero coefficients in the baps admixture analysis. furthermore, some segments are also assigned to cluster  <dig>  and to the cluster corresponding to an unknown origin.

by examining the recombination profile and using the built-in option of brat to calculate the distances of the strain to the different clusters in a given interval, we were able to identify areas in the sequence with strong evidence of shared ancestry with the clusters  <dig> and  <dig>  corresponding to the second and the third largest coefficients in the baps admixture analysis. for example, the third and the sixth gene have long areas where the cluster  <dig> dominates the marginal probabilities, while the rightmost  <dig> bases in the fifth gene are strongly associated with the cluster  <dig>  the other clusters, suggested by the optimal model profile as possible origins for some parts of the sequence were also investigated in a similar manner. interestingly, we were not able to find areas with strong evidence for the other origins, not even for the cluster  <dig>  which had the largest coefficient in the baps analysis. while the distances  were somewhat supporting the suggested origin, they were not conclusive, as with the clusters  <dig> and  <dig> 

to focus on the biological interpretation for this strain we recall that the strain was assigned in the unsupervised classification phase to a cluster , which consists of strains from species b. cenocepacia iiic, iiid, b. antina and a group named as others. furthermore, many of these species are represented by only a small number of strains. thus, it is possible that the cluster  <dig> is an example of what was earlier referred to as a 'hybrid cluster', i.e. a collection of strains from species which are represented in the data set by an insufficient number of strains to be identified as a distinct cluster. such a misleading classification for the strain under investigation is also suggested by the fact that there are some areas in the sequence where the cluster corresponding to the unknown origin gets high probabilities.

thus, we can summarize our findings for this strain as follows. there is strong evidence that some parts of the sequence share ancestry with the cluster  <dig>  and some parts with the cluster  <dig> . furthermore, there is strong evidence that there are areas in the sequence which are not closely related to either of the mentioned clusters. these areas are mostly represented by the cluster  <dig>  and some other clusters. however, there is no strong evidence that these clusters in fact represent the true origin for these areas, they may just be the statistically most appropriate ones of the available alternatives.

b. cenocepacia iiia and iiib
in the mixture clustering, the subspecies iiia and iiib of b. cenocepacia were clustered together, which reflects their close evolutionary relation. in the baps admixture analysis none of these strains was identified as having admixture with species in the other clusters. however, the recombination profiles calculated for the strains support a different conclusion. there is also a clear distinction in the recombination profiles between the strains in the two groups. out of the ten iiia strains, only two had one recombination event in one gene in their optimal recombination model. on the other hand, all the ten iiib strains had at least one recombinant segment in their optimal model profiles, and most of these strains had actually a couple of such segments. these segments were mostly assigned to the clusters corresponding to species b. ambifaria and b. vietnamiensis. figure  <dig> shows the profile of one strain belonging to iiib. the segment assigned to b. ambifaria can be seen at the beginning of the fourth gene . the segment assigned to the b. vietnamiensis species can be seen at the end of the third gene. by investigating the marginal probability profile for these areas, and calculating the distances to the different clusters, we can conclude that these intervals have their origins in a different source than the rest of the sequence. analogous conclusions can be made for other suggested recombinant segments from b. ambifaria and b. vietnamiensis for the strains of species b. cenocepacia iiib. on the other hand, the two possible recombinant segments which were observed in the optimal profiles of b. cenocepacia iiia did not obtain conclusive support. thus, the biological interpretation of these results would be that the difference between b. cenocepacia iiia and b. cenocepacia iiib is that iiib has had recombination with b. ambifaria and/or b. vietnamiensis, while iiia has not.

b. pyrrocinia
the recombination profile of a strain belonging to b. pyrrocinia species is shown in figure  <dig>  this strain was not identified as admixed in the baps admixture analysis. however, the profile shows a striking feature which is not present in any other profile in the whole data set. apart from some small stretches, the third gene is assigned as a whole to an unknown origin in the optimal model, i.e. origin not represented by any of the known clusters. this can also be seen, when the average distances to the different clusters are calculated. the average distance in this gene to the cluster closest to the strain is  <dig> mutations, while the average distance in this gene between the strains in any cluster is at most approximately  <dig> mutations. thus, this gene is dozens of mutations further apart from any species present in the data. because this is the only gene of the strain with this characteristic, a plausible biological explanation would be that this gene is obtained as a whole by recombination with some species not present in the data set.

discussion
we have introduced a bayesian approach for the identification of recombination events in dna sequences obtained from bacteria. uncertainty related to a solution can in our approach be expressed in terms of marginal posterior probabilities for origins of different sites in the sequences. the computational advantages of our approach stem from a characterization of the putative origins for a segment by parameters corresponding to relative frequencies of different nucleotides at each site. in this respect our approach is less realistic than the recently introduced bayesian approaches based on phylogenies, which have an explicit model for mutations . in our model the variation caused by mutations in bacterial populations is taken into account by the varying nucleotide frequency parameters. also, as opposed to the phylogeny-based approach, we do not try to model the complete evolutionary histories of all putative recombinant segments, but determine a probabilistic characterization of plausible origins for each detected segment. if there are several plausible origins for some segment, the corresponding posterior probabilities will be substantial for all of them. at the same time, this provides indirect evidence of a common evolutionary history of the possible origins in this segment. the utilized approximations involve two open parameters l and lmax which have a smoothing effect on the calculated marginal probability profiles. these parameters are given default values, which are deemed reasonable through theoretical considerations. also, the behavior of the method under the default selections has been examined through substantial simulation experiments, and the effect of these parameters has been illustrated through examples in the supplementary material . however, we wish to point out that no in depth experimental study has been carried out to assess their effect, and possible bias caused to the calculated marginal probability distributions, in all possible situations.

the adopted simplifications in the model formulation allow us to apply the method efficiently to data sets consisting of hundreds of strains. for example, an analysis of all the seven genes of one burkholderia strain, discussed in real data analysis, takes about  <dig> seconds on a desktop pc with a  <dig>  ghz processor. as the strains are analyzed independently, the required cpu time is linear to the number of strains and genes to be analyzed.

we utilized baps software to define the reference populations for our analysis. it would also be possible to use a reference clustering obtained by some other method, although we have not considered such an alternative in this work. there are two primary reasons for this. firstly, the stochastic urn model for unsupervised classification, combined with the stochastic optimization algorithm, as implemented in baps, has a superior accuracy compared to standard bayesian computation, in particular, when the data represents a complex population structure with many underlying clusters  <cit> . secondly, due to the similarities in the likelihood function, by utilizing a preclustering obtained with baps one will never in practice encounter a paradoxical situation in which some strain is assigned to a cluster for which the recombination analysis does not yield high probabilities anywhere within the observed sequence. as illustrated by several examples in this article and the supplementary material, baps is able to provide a clustering which in general reflects very well the evolutionary relationships of the strains. the only scenario in which a clustering obtained by baps clearly deviated from the 'true' population stratification occurred when some populations were represented by a very limited number of strains in the data set. even then, the behavior of baps is well-characterized, leading for example to a hybrid cluster, as discussed in illustrations in the previous section, as well as in the supplementary material.

the reference populations were summarized in our approach by posterior distributions for the nucleotide frequencies. an alternative would be to use a consensus sequence to summarize the reference populations, enabling one to proceed for example with the phylogenetic framework. however, such a strategy would be inferior as it neglects the variation within the sequences in a population. for example, a cluster may in reality contain two subgroups of strains, which are otherwise similar, but different in some segment. then, a strain which reminds either of these subgroups in this segment will show elevated posterior probabilities for the corresponding cluster in our approach , while the consensus strain would be likely to abandon the information concerning one of the subgroups. also, taking the variation into account is important when considering the possibility of some segment originating from an outgroup, i.e. a population not represented by any of the strains in the data set. for instance, assume that a particular strain i has an elevated level of distance to the nearest cluster  within some gene segment. further, if the strains in that cluster are identical or nearly identical over the same gene segment, and the remaining clusters are also internally homogeneous within the segment, then it is likely that this segment of the strain i has a deviating ancestry, and the outgroup will be associated with a high posterior probability. on the other hand, if there is more variation in the observed nucleotides within the nearest cluster, especially at those sites at which the strain is most different from the strains in the cluster, then it would be more likely that the particular segment is associated with the cluster, and consequently, the outgroup would not be assigned high posterior probability in our approach. see also a related discussion in  <cit> .

the optimal use of the introduced method requires that the estimates of the relative frequencies of different nucleotides in the populations must be reasonably good. in practice this means that each underlying population must be represented by a sufficient number of strains in the data set. what sufficient means depends in practice on characteristics of the data, for example on the level of divergence between and within different clusters. in our analyses we have discovered that the calculated posterior probabilities for strains in populations represented by one or two strains may look noisy. on the other hand, already populations with five strains seem to provide a sufficient level of accuracy. fortunately, it is usually quite straightforward to recognize the situations in which the interpretation of the results requires extra care, e.g. when the cluster to which the strain belongs is very small, or constitutes a so-called hybrid cluster. notice also that while the introduced method works best with a sufficient number of strains present in a data set, the phylogeny-based methods are mainly intended to be used with a limited number of strains only. thus, in addition to the different levels of model abstraction, as discussed above, the two methods also differ by the type of a data set for which they are the most suitable. for these reasons, we do not consider the two approaches as exclusive, but rather as complementary to each other.

apart from the sizes of the reference populations and the quality of the clustering solution, the reference samples may be distorted by strains which are recombined themselves. this may be expected to increase the level of noise in the resulting profiles. however, as long as the reference populations fairly adequately correspond to the different types of strains present in a data set, we do not expect this to actually lead to wrong interpretations, but just increase the uncertainty related to the conclusions. the coherence of the reference populations is ensured by using baps for clustering the strains. for example, assume that there are some 'mosaic-like' strains in a cluster, say k, carrying a recombined segment whose origin is different compared to those strains which are the 'pure' representatives of the cluster. consider then recombination inference for a strain which resembles closely the 'mosaic-like' strains in this particular segment. the posterior probabilities may then be clearly elevated for the origin corresponding to the cluster k, if there is no other cluster representing solely the 'mosaic-like' strains. however, because the reference clusters are defined only in terms of the strains they contain, in reality there are no 'pure' or 'mosaic-like' representatives of a cluster. consequently, the fact that such a cluster is associated with elevated probabilities highlights the point that the cluster hosts strains which might share ancestry with the strain under consideration in this particular gene segment. thus, the uncertainty illustrated in the profiles is increased in the manner one would expect.

we end the discussion by considering briefly the process of using the introduced method to analyze a data set. the task of statistically detecting recombination among the observed strains is a challenging one, due to the many possible uncertain elements involved. for this reason, the presented method, or any other statistical method for the same purpose, should not be used as a black-box tool, and the results inevitably require some subjective interpretation. to reach the correct conclusion, it is important to understand the behavior of the method in any specific situation. for this reason, we strongly encourage all potential appliers to read carefully through the examples in this paper. as a general strategy, we suggest that the first step of the analysis is the investigation of the optimal model profile. if no recombinant fragments are present in the optimal model profile, then it is plausible to conclude that no recombination has taken place. if the optimal model contains recombinant fragments, then all other available information should be taken into account when making the interpretation, including the calculated marginal probability distributions for the origins of the sites, the molecular distances to different clusters, the levels of molecular variation within the clusters  and biological knowledge about the species under investigation. optimally, the putative recombination events would be confirmed by independent in vitro experiments, as e.g. in  <cit> .

CONCLUSIONS
statistical discovery of recombinant and other 'anomalous' segments within dna sequences has been an area of considerable research activity for more than two decades. in general, it has been shown in a multitude of contexts that model-based approaches provide quite accurate characterizations of the evolutionary processes, and help to assess uncertainty related to the central issues of interest. however, regarding the analysis of large bacterial dna databases, the currently available model-based tools have restricted applicability in practice. the methodology introduced here is precisely intended to bridge this gap between the complexity of the currently existing data and the capacity of the methods. the importance of this issue will further increase in the future, as a consequence of the evolving sequencing techniques which will enable the investigation of much larger quantities of samples, as well as a denser coverage of the genomes.

our statistical tool  is developed to provide the results of the bayesian analysis in an easily utilizable format, including high-resolution graphical displays of the estimated structures of the investigated sequences.

authors' contributions
jc and pm developed the bayesian model. pm implemented the method and carried out the analyses. ab and wph contributed in the biological aspects of the model. ab, cd, and em provided the example real data set and expert knowledge about burkholderia. ab, jc, wph and pm wrote the article. 

supplementary material
additional file 1
package of supplementary material. file brat_supplementary.zip available at  includes a file brat_supplementary_text.pdf, which contains additional information on following issues: 1) elementary simulation experiments, 2) illustration of the effect of used parameter values and utilized approximations, and 3) a description of the real data analysis with more details than presented in the main text. the zip package also includes two folders. the folder "coalescent_results" contains complete results for the analyzed coalescent data set, see the readme file in the folder for further details. the folder "trees for repetitive simulations" contains the figures of the left-side and right-side trees used in different types of simulations.

click here for file

 acknowledgements
this work was supported by funding to p. marttinen from commit graduate school and by a grant from the academy of finland to j. corander. we thank david posada, university of vigo, spain, for his suggestions concerning the simulations in the manuscript.
