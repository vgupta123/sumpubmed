BACKGROUND
dna microarrays are well established means of monitoring genome-wide patterns of gene expression  <cit> . the first level of analysis requires determining whether observed differences in expression are significant. data analysis techniques are actively being developed for this purpose including classical anova methods  <cit>  and bayesian approaches based on both gaussian  <cit>  and non-gaussian  <cit>  models. several problems arise with classical statistical inference due to the lack of replications and the large amount of genes in cases of multiple testing  <cit> . none of the existing methods estimate the variability of the measurements from equally expressed genes. our goal is to introduce a new bayesian approach for transcriptome analysis, arraylearna, based on the intrinsic variability of the equally expressed genes estimated from genomic dna features printed on the microarray slide and on the predicted transcriptional organisation of operons. the model underlying arraylearna assumes that the log ratios have a gumbel distribution; this gives an asymmetric posterior distribution with a very steep tail, which is more discerning than that obtained from the gaussian model.

to test arraylearna, we compared it with two other analysis approaches: a constant two-fold cut-off value, i.e. two-fold changes between intensities, and opwise  <cit> . the reasons for the choice of these two methods are that the two-fold cut-off is a common practice for data analysis with some commercial analysis packages and opwise is a bayesian approach based on a gaussian model, as used in other published approaches  <cit> . opwise also incorporates predicted operon structure to inform on systematic microarray errors and to decide whether the expression is significantly different. the performance of these analysis approaches is illustrated using three experimental hybridization datasets with prior knowledge of expected transcription patterns.

we introduce the use of genomic dna features printed as serial dilutions on the microarray slide and demonstrate that the measurements from these features are equivalent to the measurements of genes that are equally expressed under different experimental conditions. the normalization approach presented in this paper, based on these genomic control features, was compared with the so-called lowess normalization  <cit>  based on the lowess non parametric regression  <cit>  applied to describe the relationship between the difference  and the average  of the logarithm of the intensities. we use the genomic controls not only in data normalization, but also in data analysis for the estimation of the parameters of the bayesian model. also the bayesian model includes the information on the transcription of the predicted operon to help the correct assignment of genes with low confidence measurements. arraylearna is implemented in a new user-friendly software tool freely available  <cit> .

description of the analysis
hybridization datasets analyzed in this study


dataset i is the result of a microarray hybridization of cdna obtained from c. jejuni strains  <dig> and  <dig> and labelled with cy <dig> and cy <dig>  respectively. there are  <dig> replicates for each orf and ca. 8– <dig> replicates for each genomic dna control feature  from each strain.

dataset ii was obtained from a hybridization of cdna made from two replicated cultures of s. pneumoniae tigr  <dig>  the samples of cdna were differentially labelled with cy <dig> and cy <dig>  the dataset contains ca.  <dig> replicated measurements from each orf and ca.  <dig> replicated measurements of each genomic dna feature .

dataset iii was obtained from two independent hybridizations. each hybridization was carried out by mixing genomic dna with cdna both obtained from e. coli. the mixture was hybridized to the microarray slide. dataset iii was constructed by combining the fluorescence intensities measured from the cdna sample in each hybridization. the dataset consisted of one measurement of each orf and ca.  <dig> replicated measurements of each genomic dna feature .

dataset iv was generated from dataset i. the log ratios of differentially expressed genes were made positive so that  <dig> genes were up-regulated in sample  <dig> and none in sample  <dig>  then, a set of  <dig> equally transcribed genes were randomly selected. this gives an asymmetric gene expression dataset with  <dig> genes from which  <dig> genes up-regulated in sample  <dig> and  <dig> genes equally transcribed, and therefore the mean ratio of the whole dataset is very different from the mean ratio of the equally transcribed genes.

standardization of the hybridization datasets
data standardization was based on the genomic dna features printed on the microarray slides at different concentrations. we reasoned that equal amounts of each differentially labelled cdna sample will hybridize to the genomic control features and can therefore be used as a reference to standardize the whole hybridization dataset. in order to do this, the relationship between the intensities measured on the genomic features is described as:

 log <dig> i <dig> = αg + βg log2i <dig> 

where i <dig> and i <dig> are the fluorescence intensities observed from each sample differentially labelled and hybridized on one slide in the case of cdna vs cdna hybridizations. for cdna vs genomic dna hybridizations, i <dig> and i <dig> are the intensities corresponding to the cdna samples measured in two different slides.

the standardization of the intensities was based on both parameters αg and βg specifically estimated for each microarray hybridization. both the intensities measured from orfs and genomic features were corrected as follows:

 log <dig> i1' = βg log <dig> i <dig> + αg 

 log <dig> i2' = log <dig> i <dig> 

the value of 2αg, the constant of proportionality between intensities, should in theory be  <dig>  i.e. αg =  <dig>  because equal amounts of differentially labelled cdna should hybridize to the genomic features. a value of βg different from  <dig> expresses lack of linearity between the intensities. to avoid unnecessary non-linear data transformation, βg took a value different from  <dig> only if an f test rejected the null hypothesis βg =  <dig> 

after standardization, the average of the logarithm of the ratios between the intensities measured from the genomic features was equal to zero. accordingly, the logarithm of the ratios measured from orfs with equal amounts of transcripts of both samples hybridized is also expected to be centred on zero.

bayesian inference test
we denote the logarithm of the ratio between intensities as r = log <dig>  - log <dig>  where i <dig> and i <dig> are the fluorescence intensities measured for two differentially labelled samples of cdna. samples  <dig> and  <dig> are either hybridized on one slide in the case of cdna-cdna hybridizations or on two slides in the case of cdna-dna hybridizations.

we assume that r has a gumbel distribution with density function

 gr=1bea−rbe−ea−rb−∞<r<∞
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaacpc6xni=xi8qivkypfjydhavhbbf9v8qqaqfr0xc9vqfj0dxdbba91qpepei8k8fii+fsy=rqgqvepae9pg0db9vqaivgfr0xfr=xfr=xc9adbaqaaegacagaaiaabeqaaeqabiwaaagcbaqbaeqabegaaaqaaiabdegannaabaaaleaacqwgsbguaeqaaogaeiikagiaemocainaeiykakiaeyypa0tcfa4aasaaaeaacqaixaqmaeaacqwgibgyaagccqwglbqzdaahaawcbeqcfayaamaalaaabagaemyqaekaeyoei0iaemocaihabagaemoyaigaaaaakiabdwgalnaacaaaleqabagaeyoei0iaemyzau2aawbaawqabkqbagaadawcaaqaaiabdgeabjabgkhitiabdkhaybqaaiabdkgaibaaaaaaaagcbaaccagae8nei0iaeyohiuqaeyipawjaemocainaeyipawjaeyohiukaaaaa@4d5b@ 

where a and b are the location and scale parameters, respectively. after an experiment, there is uncertainty concerning the location parameter, a, which has a prior distribution ξa prior. the parameter b is invariant and known using the genomic control features. when b is known a conjugate family of distributions for the parameter a exists .

we wish to know whether a gene is differentially expressed. for genes that show similar expression in both samples, the ratios are fairly close to  <dig> and the value of the location parameter, a, is centred on a value a <dig>  to avoid an arbitrary asymmetry in the results, the hypothesis test is made by using only one tail of the posterior distribution of a. additionally, the information on the transcription pattern of the operon to which the gene belongs is to be used in the analysis. for these reasons we chose an informative prior for a given by:

 ξa prior=|p1cfif −∞<a<a0p0cfif a0≤a<∞
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaacpc6xni=xi8qivkypfjydhavhbbf9v8qqaqfr0xc9vqfj0dxdbba91qpepei8k8fii+fsy=rqgqvepae9pg0db9vqaivgfr0xfr=xfr=xc9adbaqaaegacagaaiaabeqaaeqabiwaaagcbaaccigae8nvdg3aasbaasqaaiabdgeabjabbccagiabdchawjabdkhayjabdmgapjabd+gavjabdkhaybqabagccqggoaakcqwghbqycqggpaqkcqgh9aqpdaabbaqaauaabaqaciaaaeaajuagdawcaaqaaiabdchawnaabaaabagaegymaedabeaaaeaacqwgdbwqaagccqwgmbgzcqggoaakcqwghbqycqgg7awocqwfxoqycqggsaalcqwfyogycqggpaqkaeaacqqgpbqacqqgmbgzcqqggaaiiiaacqgfsislcqgheispcqgh8aapcqwghbqycqgh8aapcqwghbqydawgaawcbagaegimaadabeaaaoqaakqbaoaalaaabagaemicaa3aasbaaeaacqaiwaamaeqaaaqaaiabdoeadbaakiabdagamjabcicaoiabdggahjabcuda7iab=f7ahjabcycasiab=j7aijabcmcapaqaaiabbmgapjabbagamjabbccagiabdggahnaabaaaleaacqaiwaamaeqaaogaeyizimqaemyyaemaeyipawjaeyohiukaaagaay5bsdaaaa@6eb6@ 

where f=1bβαΓeabαe−βeab
 mathtype@mtef@5@5@+=feaafiart1ev1aqatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaacpc6xni=xh8vivgi8gi=heeeu0xxdbba9frfj0xb9qqpg0dxdb9aspei8k8fii+fsy=rqgqvepae9pg0db9vqaivgfr0xfr=xfr=xc9adbaqaaegacagaaiaabeqaaeqabiwaaagcbagaemozaymaeiikagiaemyyaemaei4oasdccigae8xsdemaeiilawiae8nsdimaeiykakiaeyypa0tcfa4aasaaaeaacqaixaqmaeaacqwgibgyaawaasaaaeaacqwfyogydaahaaqabeaacqwfxoqyaaaabagaeu4kdckaeiikagiae8xsdemaeiykakcaaogaemyzau2aawbaasqabeaajuagdawcaaqaaiabdggahbqaaiabdkgaibaaliab=f7ahbaakiabdwgalnaacaaaleqabagaeyoei0iae8nsdimaemyzau2aawbaawqabkqbagaadawcaaqaaiabdggahbqaaiabdkgaibaaaaaaaaaa@5072@ is described in the appendix  and a <dig> is the centred value of the parameter a for those genes equally expressed in both samples; p <dig> and p <dig> quantify the information of the transcription of the operon and comply with p <dig> + p <dig> = 1; c=∫−∞a0p1fda+∫a0∞p0fda
 mathtype@mtef@5@5@+=feaafiart1ev1aqatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaacpc6xni=xh8vivgi8gi=heeeu0xxdbba9frfj0xb9qqpg0dxdb9aspei8k8fii+fsy=rqgqvepae9pg0db9vqaivgfr0xfr=xfr=xc9adbaqaaegacagaaiaabeqaaeqabiwaaagcbagaem4qamkaeyypa0zaa8qmaeaacqwgwbacdawgaawcbagaegymaedabeaakiabdagamjabcicaoiabdggahjabcuda7ggaciab=f7ahjabcycasiab=j7aijabcmcapiabdsgakjabdggahjabgucarawcbagaeyoei0iaeyohiukabagaemyyae2aasbaawqaaiabicdawaqabaaaniabguiiydgcdawdxaqaaiabdchawnaabaaaleaacqaiwaamaeqaaogaemozaymaeiikagiaemyyaemaei4oasjae8xsdemaeiilawiae8nsdimaeiykakiaemizaqmaemyyaegaleaacqwghbqydawgaaadbagaegimaadabeaaasqaaiabg6hilcqdcqghrii8aaaa@58f9@ is a normalizing constant such that ∫−∞∞ξpriorda=1
 mathtype@mtef@5@5@+=feaafiart1ev1aqatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaacpc6xni=xh8vivgi8gi=heeeu0xxdbba9frfj0xb9qqpg0dxdb9aspei8k8fii+fsy=rqgqvepae9pg0db9vqaivgfr0xfr=xfr=xc9adbaqaaegacagaaiaabeqaaeqabiwaaagcbawaa8qmaeaaiigacqwf+oaedawgbawcbagaemicaanaemocainaemyaakmaem4ba8maemocaihabeaakiabcicaoiabdggahjabcmcapiabdsgakjabdggahjabg2da9iabigdaxawcbagaeyoei0iaeyohiukabagaeyohiukaniabguiiydaaaa@4261@.

bayes theorem gives a posterior distribution for a as:

 ξa post=|p1gfp1∫−∞a0gfda+p0∫a0∞gfdaif −∞<a<a0p0gfp1∫−∞a0gfda+p0∫a0∞gfdaif a0≤a<∞ 

where g=1bnenabe−∑i=1nribe−k˜eab
 mathtype@mtef@5@5@+=feaafiart1ev1aqatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaacpc6xni=xh8vivgi8gi=heeeu0xxdbba9frfj0xb9qqpg0dxdb9aspei8k8fii+fsy=rqgqvepae9pg0db9vqaivgfr0xfr=xfr=xc9adbaqaaegacagaaiaabeqaaeqabiwaaagcbagaem4zacmaeiikagiaemocai3aasbaasqaaiabigdaxaqabagccqgguaglcqgguaglcqwgybgcdawgaawcbagaemoba4gabeaakmaaeeaabagaemyyaegacaglhwoacqggpaqkcqgh9aqpjuagdawcaaqaaiabigdaxaqaaiabdkgainaacaaabeqaaiabd6gaubaaaagccqwglbqzdaahaawcbeqcfayaamaalaaabagaemoba4maemyyaegabagaemoyaigaaaaakiabdwgalnaacaaaleqabagaeyoei0yaaabcakqbagaadawcaaqaaiabdkhaynaabaaabagaemyaakgabeaaaeaacqwgibgyaaaameaacqwgpbqacqgh9aqpcqaixaqmaeaacqwgubgba4gaeyyeiuoaaagccqwglbqzdaahaawcbeqaaiabgkhitmaagaaabagaem4aasgacagldmaacqwglbqzdaahaaadbeqcfayaamaalaaabagaemyyaegabagaemoyaigaaaaaaaaaaa@5c40@ is the density function of the sample of measurements conditioned by a = a as described in the appendix ; n is the number of independent measurements for the gene in study and k˜
 mathtype@mtef@5@5@+=feaafiart1ev1aqatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaacpc6xni=xh8vivgi8gi=heeeu0xxdbba9frfj0xb9qqpg0dxdb9aspei8k8fii+fsy=rqgqvepae9pg0db9vqaivgfr0xfr=xfr=xc9adbaqaaegacagaaiaabeqaaeqabiwaaagcbawaaacaaeaacqwgrbwaaiaawowaaaaa@2df5@ is a sample statistic: k˜=n⋅e| r¯/b|
 mathtype@mtef@5@5@+=feaafiart1ev1aqatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaacpc6xni=xh8vivgi8gi=heeeu0xxdbba9frfj0xb9qqpg0dxdb9aspei8k8fii+fsy=rqgqvepae9pg0db9vqaivgfr0xfr=xfr=xc9adbaqaaegacagaaiaabeqaaeqabiwaaagcbawaaacaaeaacqwgrbwaaiaawowaaiabcicaoiabdkhaynaabaaaleaacqaixaqmaeqaaogaeiola4iaeiola4iaemocai3aasbaasqaaiabd6gaubqabagccqggpaqkcqgh9aqpcqwgubgbcqghfly1cqwglbqzdaahaawcbeqaamaaemaabawaasgbaeaacqqggaaicuwgybgcgaqeaaqaaiabdkgaibaaaiaawea7cagliwoaaaaaaa@4410@ where r¯
 mathtype@mtef@5@5@+=feaafiart1ev1aqatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaacpc6xni=xh8vivgi8gi=heeeu0xxdbba9frfj0xb9qqpg0dxdb9aspei8k8fii+fsy=rqgqvepae9pg0db9vqaivgfr0xfr=xfr=xc9adbaqaaegacagaaiaabeqaaeqabiwaaagcbagafmocainbaebaaaa@2d59@ is the mean value of the ratios measured for the gene in study. k˜
 mathtype@mtef@5@5@+=feaafiart1ev1aqatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaacpc6xni=xh8vivgi8gi=heeeu0xxdbba9frfj0xb9qqpg0dxdb9aspei8k8fii+fsy=rqgqvepae9pg0db9vqaivgfr0xfr=xfr=xc9adbaqaaegacagaaiaabeqaaeqabiwaaagcbawaaacaaeaacqwgrbwaaiaawowaaaaa@2df5@ is a reformulation of the statistic k defined in the appendix. k˜
 mathtype@mtef@5@5@+=feaafiart1ev1aqatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaacpc6xni=xh8vivgi8gi=heeeu0xxdbba9frfj0xb9qqpg0dxdb9aspei8k8fii+fsy=rqgqvepae9pg0db9vqaivgfr0xfr=xfr=xc9adbaqaaegacagaaiaabeqaaeqabiwaaagcbawaaacaaeaacqwgrbwaaiaawowaaaaa@2df5@ is a function of the absolute value of the average of the ratios so that the sign of the difference between the log intensities do not affect the result. also, the effect of outlier measurements on the analysis is drastically minimized. k˜
 mathtype@mtef@5@5@+=feaafiart1ev1aqatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaacpc6xni=xh8vivgi8gi=heeeu0xxdbba9frfj0xb9qqpg0dxdb9aspei8k8fii+fsy=rqgqvepae9pg0db9vqaivgfr0xfr=xfr=xc9adbaqaaegacagaaiaabeqaaeqabiwaaagcbawaaacaaeaacqwgrbwaaiaawowaaaaa@2df5@ takes values in the interval [ <dig>  8). the greater the absolute ratio of the intensities, the greater is the probability of a to have small values. thus, the value of a is greater in genes equally expressed than in differentially expressed genes. thus, p = p is the posterior probability of equal transcription in both samples and it is estimated as

 p=∫a0∞ξa post da=p0p0+p1f1−f
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaacpc6xni=xi8qivkypfjydhavhbbf9v8qqaqfr0xc9vqfj0dxdbba91qpepei8k8fii+fsy=rqgqvepae9pg0db9vqaivgfr0xfr=xfr=xc9adbaqaaegacagaaiaabeqaaeqabiwaaagcbagaemiuaalaeiikagiaemyqaekaeyyzimraemyyae2aasbaasqaaiabicdawaqabagcdaabbaqaaiabdkhaynaabaaaleaacqaixaqmaeqaaogaeiola4iaeiola4iaemocai3aasbaasqaaiabd6gaubqabaaakiaawea7aiabcmcapiabg2da9maapedabaaccigae8nvdg3aasbaasqaaiabdgeabjabbccagiabdchawjabd+gavjabdohazjabdsha0bqabagccqggoaakdaabcaqaaiabdggahbgaayjcsdgaemocai3aasbaasqaaiabigdaxaqabagccqgguaglcqgguaglcqwgybgcdawgaawcbagaemoba4gabeaakiabcmcapiabbccagawcbagaemyyae2aasbaawqaaiabicdawaqabaaaleaacqgheispa0gaey4kiipakiabdsgakjabdggahjabg2da9kqbaoaalaaabagaemicaa3aasbaaeaacqaiwaamaeqaaaqaaiabdchawnaabaaabagaegimaadabeaacqghrawkcqwgwbacdawgaaqaaiabigdaxaqabawaasaaaeaacqwggbgrdaqadaqaaiabdggahnaabaaabagaegimaadabeaacqgg7awocqwgubgbcqghrawkcqwfxoqycqggsaalcqwfyogycqghrawkdaaiaaqaaiabdugarbgaay5adaaacagloagaayzkaaaabagaegymaejaeyoei0iaemoray0aaewaaeaacqwghbqydawgaaqaaiabicdawaqabagaei4oasjaemoba4maey4kasiae8xsdemaeiilawiae8nsdimaey4kasyaaacaaeaacqwgrbwaaiaawowaaagaayjkaiaawmcaaaaaaaaaaa@87b2@ 

where f=∫−∞a01bα+nΓeabe−eabda
 mathtype@mtef@5@5@+=feaafiart1ev1aqatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaacpc6xni=xh8vivgi8gi=heeeu0xxdbba9frfj0xb9qqpg0dxdb9aspei8k8fii+fsy=rqgqvepae9pg0db9vqaivgfr0xfr=xfr=xc9adbaqaaegacagaaiaabeqaaeqabiwaaagcbagaemoray0aaewaaeaacqwghbqydawgaawcbagaegimaadabeaakiabcuda7iabd6gaujabgucarggaciab=f7ahjabcycasiab=j7aijabgucarmaagaaabagaem4aasgacagldmaaaiaawicacaglpaaacqgh9aqpdawdxaqaakqbaoaalaaabagaegymaedabagaemoyaigaamaalaaabawaaewaaeaacqwfyogycqghrawkdaaiaaqaaiabdugarbgaay5adaaacagloagaayzkaawaawbaaeqabagae8xsdemaey4kasiaemoba4gaaaqaaiabfo5ahjabcicaoiab=f7ahjabgucariabd6gaujabcmcapaaakiabdwgalnaacaaaleqabaqcfa4aasaaaeaacqwghbqyaeaacqwgibgyaawccqggoaakcqwfxoqycqghrawkcqwgubgbcqggpaqkaagccqwglbqzdaahaawcbeqaaiabgkhitmaabmaabagae8nsdimaey4kasyaaacaaeaacqwgrbwaaiaawowaaagaayjkaiaawmcaaiabdwgalnaacaaameqajuagbawaasaaaeaacqwghbqyaeaacqwgibgyaaaaaaaakiabdsgakjabdggahbwcbagaeyoei0iaeyohiukabagaemyyae2aasbaawqaaiabicdawaqabaaaniabguiiydaaaa@71a9@ as shown in the appendix . then, a gene can be declared differentially expressed if its posterior probability is smaller than some predefined cut-off. throughout this paper, we will use  <dig>  as cut-off value

parameter estimation
the estimation of the parameters was carried out with the ratios measured from the genomic control features printed on the same slide as the dataset to be analyzed.

the parameter b of the gumbel distribution was estimated by the method of moments as b^=6π2sdg
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaacpc6xni=xh8vivgi8gi=heeeu0xxdbba9frfj0xb9qqpg0dxdb9aspei8k8fii+fsy=rqgqvepae9pg0db9vqaivgfr0xfr=xfr=xc9adbaqaaegacagaaiaabeqaaeqabiwaaagcbagafmoyaimbakaacqgh9aqpjuagdawcaaqaamaakaaabagaegonaydabeaaaeaaiigacqwfapacaagccqaiyagmcqwgzbwccqwgkbazdawgaawcbagaem4zacgabeaaaaa@36e1@ where sdg represents the standard deviation of the ratios measured from the genomic features. in nine experimental hybridizations the standard deviation of the ratios of genes equally transcribed was greater, from  <dig>  to  <dig>  fold, if measured in orfs features than if measured in genomic features. for this reason, b was estimated assuming that the standard deviation of the ratios of the genes equally transcribed is twice as much as that of the ratios measured from genomic features.

after data standardization, the ratios of equally transcribed genes are expected to be centred on  <dig>  thus, the centred value, a <dig>  of the hyperparameter a is estimated by the method of moments as a^0=0− <dig> ⋅b^
 mathtype@mtef@5@5@+=feaafiart1ev1aqatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaacpc6xni=xh8vivgi8gi=heeeu0xxdbba9frfj0xb9qqpg0dxdb9aspei8k8fii+fsy=rqgqvepae9pg0db9vqaivgfr0xfr=xfr=xc9adbaqaaegacagaaiaabeqaaeqabiwaaagcbagafmyyaembakaadawgaawcbagaegimaadabeaakiabg2da9iabicdawiabgkhitiabicdawiabc6cauiabiwda1iabieda3iabieda3iabikdayiabgwsixlqbdkgaizaajaaaaa@3a8f@

to estimate the parameters α and β, the first consideration is that for the genomic features p <dig> = p <dig> =  <dig> . thus, the prior distribution of a for the genomic features can be simplified as

 ξa prior=1bβαΓeabαe−βeab−∞<a<∞
 mathtype@mtef@5@5@+=feaafiart1ev1aqatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaacpc6xni=xi8qivkypfjydhavhbbf9v8qqaqfr0xc9vqfj0dxdbba91qpepei8k8fii+fsy=rqgqvepae9pg0db9vqaivgfr0xfr=xfr=xc9adbaqaaegacagaaiaabeqaaeqabiwaaagcbaqbaeqabegaaaqaaggaciab=57a4naabaaaleaacqwgbbqqcqqggaaicqwgwbaccqwgybgccqwgpbqacqwgvbwbcqwgybgcaeqaaogaeiikagiaemyyaemaeiykakiaeyypa0tcfa4aasaaaeaacqaixaqmaeaacqwgibgyaawaasaaaeaacqwfyogydaahaaqabeaacqwfxoqyaaaabagaeu4kdckaeiikagiae8xsdemaeiykakcaaogaemyzau2aawbaasqabeaajuagdawcaaqaaiabdggahbqaaiabdkgaibaaliab=f7ahbaakiabdwgalnaacaaaleqabagaeyoei0iae8nsdimaemyzau2aawbaawqabkqbagaadawcaaqaaiabdggahbqaaiabdkgaibaaaaaaaagcbaaccagae4nei0iaeyohiuqaeyipawjaemyyaemaeyipawjaeyohiukaaaaa@5c5d@ 

as indicated in the appendix, the transformation x=eab
 mathtype@mtef@5@5@+=feaafiart1ev1aqatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaacpc6xni=xh8vivgi8gi=heeeu0xxdbba9frfj0xb9qqpg0dxdb9aspei8k8fii+fsy=rqgqvepae9pg0db9vqaivgfr0xfr=xfr=xc9adbaqaaegacagaaiaabeqaaeqabiwaaagcbagaemiwaglaeyypa0jaemyzau2aawbaasqabkqbagaadawcaaqaaiabdgeabbqaaiabdkgaibaaaaaaaa@3289@ has a gamma distribution with shape parameter α and scale parameter 1/β. accordingly, the ratios measured from the genomic features, rg, are transformed into rg′=erg− <dig> bb
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaacpc6xni=xh8vivgi8gi=heeeu0xxdbba9frfj0xb9qqpg0dxdb9aspei8k8fii+fsy=rqgqvepae9pg0db9vqaivgfr0xfr=xfr=xc9adbaqaaegacagaaiaabeqaaeqabiwaaagcbagaemocai3aa0baasqaaiabdeganbqaaogamai4gkdiicaacqgh9aqpcqwglbqzjuagdaahaaqabeaadawcaaqaaiabdkhaynaabaaabagaem4zacgabeaacqghsislcqaiwaamcqgguaglcqai1aqncqai3awncqai3awncqaiyagmcqwgibgyaeaacqwgibgyaaaaaaaa@40ef@. from the transformed ratios, the maximum likelihood estimates for the parameters α and α of a gamma distribution are obtained as described by  <cit> . for the gamma function we used the approximation derived by lanczos  <cit> .

to estimate the expected value and variance of a , the digamma function was approximated by using the formula  <dig> . <dig> p. <dig> of  <cit> .

 <dig> normalization is based on the genomic features measurements;  <dig> logarithm to the base  <dig> of the ratio between the intensities;  <dig> assuming p1= p <dig> =  <dig> , r =  <dig> and  <dig>   <dig> and  <dig> replicates for datasets i, ii and iii, respectively.

the values of p <dig> and p <dig> are calculated from the transcription pattern of the operon to which the gene in study belongs. if the operon information is not available, p <dig> = p1=  <dig> . but if available, p <dig> and p <dig> are calculated by iterating the analysis and could affect the posterior probability p  by taking values different from  <dig> . the greater the value of p <dig>  the greater is p, while the greater the value of p <dig>  the greater is the chance of that gene being differentially expressed. initially, p <dig> and p <dig> do not favour any result with values p <dig> = p <dig> =  <dig> . with these initial values, the hybridization dataset is analyzed for the first time and a preliminary classification is obtained for each gene in the dataset. genes are assumed to have increased or decreased expression relative to the control sample  when p  <  <dig> . the values of p <dig> and p <dig> are updated as follows:

 p0=12+n04t−n14tp1=12−n04t+n14t
 mathtype@mtef@5@5@+=feaafiart1ev1aaatcvaufkttlearuwrp9mdh5mbpbiqv92aaexatlxbi9gbaebbnrfifhhdyfgasaacpc6xni=xi8qivkypfjydhavhbbf9v8qqaqfr0xc9vqfj0dxdbba91qpepei8k8fii+fsy=rqgqvepae9pg0db9vqaivgfr0xfr=xfr=xc9adbaqaaegacagaaiaabeqaaeqabiwaaagcbaqbaeqabiqaaaqaaiabdchawnaabaaaleaacqaiwaamaeqaaogaeyypa0tcfa4aasaaaeaacqaixaqmaeaacqaiyagmaagccqghrawkjuagdawcaaqaaiabcicaoiabdsfaujabgkhitiabigdaxiabcmcapiabd6eaonaabaaabagaegimaadabeaaaeaacqai0aancqggoaakcqwgubavcqghrawkcqaixaqmcqggpaqkcqwgubavaagccqghsisljuagdawcaaqaaiabcicaoiabdsfaujabgkhitiabigdaxiabcmcapiabd6eaonaabaaabagaegymaedabeaaaeaacqai0aancqggoaakcqwgubavcqghrawkcqaixaqmcqggpaqkcqwgubavaaaakeaacqwgwbacdawgaawcbagaegymaedabeaakiabg2da9kqbaoaalaaabagaegymaedabagaegomaidaaogaeyoei0scfa4aasaaaeaacqggoaakcqwgubavcqghsislcqaixaqmcqggpaqkcqwgobgtdawgaaqaaiabicdawaqabaaabagaeginaqjaeiikagiaemivaqlaey4kasiaegymaejaeiykakiaemivaqfaaogaey4kasscfa4aasaaaeaacqggoaakcqwgubavcqghsislcqaixaqmcqggpaqkcqwgobgtdawgaaqaaiabigdaxaqabaaabagaeginaqjaeiikagiaemivaqlaey4kasiaegymaejaeiykakiaemivaqfaaaaaaaa@75e2@ 

where n <dig> and n <dig> depends on the classification of the gene in study. when the gene in study is equally transcribed, n <dig> = card  and n <dig> = |card  – card | where card  denotes the cardinal number of the set of genes. if some genes of the operon are up-regulated and some of them are down-regulated in the same sample they cancel each other and do not decrease the probability of the equal transcription in both samples; hence, n <dig> is calculated as the absolute value of the difference between the cardinal numbers of the up and down regulated genes. if the gene in study is classified as up-regulated, n <dig> = card  + card  and n <dig> = card . if the gene in study is down-regulated, n <dig> = card  + card  and n <dig> = card . t is the number of genes of the operon involved in the estimation, i.e. t = n <dig> + n <dig> +  <dig>  therefore, p <dig> and p <dig> are based only on those genes successfully analysed within an operon. the operons composition is that published at  <cit> . the analysis of the dataset is iterated several times. five iterations have been proven sufficient. in each iteration genes are reclassified and the values of p <dig> and p <dig> are updated.

RESULTS
we demonstrate a bayesian method of microarray data analysis based on using internal positive controls for normalisation and as a basis of the bayesian model, plus using predicted operon structure to improve assignments of differentially expressed genes. the method has been tested on microarray data obtained from three different bacterial organisms.

fig  <dig> shows the results for the analysis of the three datasets. dataset i is the result of a microarray hybridization prepared from two differentially labelled cdna samples obtained from two strains of c. jejuni,  <dig> and nctc  <dig>  amplicons specific to strain  <dig>  should only hybridize labelled cdna from this strain and should therefore represent a set of down-regulated genes in the strain nctc  <dig>  likewise for amplicons specific to strain nctc  <dig> . dataset ii results from two samples of differentially labelled cdna obtained from two replicated cultures of s. pneumoniae tigr <dig> and hybridized on a single slide. dataset iii was prepared from two samples of cdna obtained from two replicated cultures of e. coli k <dig> but the samples of cdna were mixed with labelled genomic dna and hybridized independently on  <dig> microarray slides. the dataset includes the intensities measured for the cdna samples only. datasets ii and iii were obtained from replicated cultures and all the genes are expected to be equally expressed. we expect these datasets to show different variability, which will be reflected in the genomic control measurements, as a result of the different hybridization protocols.

for dataset i arraylearna classified  <dig> differentially expressed genes. from the features unique to the strain  <dig>  arraylearna misclassified  <dig> orfs while  <dig> misclassifications were detected from the features unique to the strain nctc  <dig>  as shown in fig  <dig>  the intensities from those misclassified features showed typical values of equally expressed genes. in dataset ii, arraylearna misclassified  <dig> genes in dataset ii and  <dig> genes in dataset iii. some of these misclassified genes showed large ratios and may reflect real changes in gene expression due to subtle experimental differences during bacterial culture or technical microarray artefacts.

the opwise method was applied by using the computing tool provided by the authors. the cut-off values for the posterior probability of equal expression were  <dig>  and  <dig>  for opwise. this is equivalent to the cut off chosen for arraylearna that is  <dig>  of posterior probability associated to the absolute value of the ratio between intensities.

in dataset i, the  <dig> orfs unique to strain  <dig> could not be analysed because the operon composition is not available for this strain. regarding the features unique to the strain nctc  <dig>   <dig> features were misclassified as equally expressed. some of the misclassified features showed large ratios . the misclassification of features with large rations was associated to features with few replicate measurements as a result of discarding bad quality measurements. for dataset i, opwise was too conservative and failed to classify clearly differentially expressed genes . opwise is a bayesian approach based on a gaussian model that can be expressed in terms of the t distribution. the posterior probability can be formulated without taking into account the operon information. when the model underlying opwise was applied without operon information, only  <dig> genes, with ratios greater than  <dig> , were classified as differentially expressed and the number of features unique to the strain nctc  <dig> that were misclassified as equally expressed increased to  <dig>  therefore, for this dataset, the operon information decreased the number of misclassified genes. in dataset ii, opwise misclassified  <dig> genes that showed equal expression in both samples. in this case, the model without operon information performed better and did not misclassify any gene. dataset iii could not be analysed with opwise because there was only one replicate of each orf.

when applying the two-fold cut-off value in dataset i,  <dig> genes showed ratios greater than the arbitrarily chosen two-fold value; this is significantly higher than the  <dig> and the  <dig> genes differentially expressed according to arraylearna and opwise methods, respectively. fifty five features unique to  <dig> and  <dig> features unique to  <dig> were incorrectly classified but as mentioned above and shown in fig  <dig>  these features exhibited typical values of identically expressed genes. the two-fold approach did not misclassify any gene on dataset ii but misclassified  <dig> genes in dataset iii. the variability of dataset ii was relatively small because the mixture of differentially labelled cdna was hybridized on a single slide and each orf had ca.  <dig> replicates. this contrasts the set-up of the experiment from which dataset iii was derived, where the labelled cdna samples were mixed with labelled genomic dna and hybridized on different slides and the final dataset contained only  <dig> ratio per orf. therefore variability of dataset iii was greater and  <dig> genes of this dataset showed ratios larger than  <dig>  a constant cut-off value arbitrarily chosen is not an advisable analysis technique in any case.

arraylearna was applied after normalizing the datasets with the correcting factors estimated from the genomic features. opwise and the two-fold cut-off were applied after lowess normalization. the effect of the normalization technique was studied in dataset iv which was generated from dataset i as described above. dataset iv is an asymmetric gene expression dataset with  <dig> up-regulated genes in one of the samples and  <dig> equally transcribed in both samples. the mean ratio of the whole dataset is very different from the mean ratio of the equally transcribed genes. dataset iv was analysed using arraylearna, opwise, and the two-fold cut-off following a) normalization using the genomic controls, b) lowess normalization , and c) without using any normalization method, i.e. non-transformed data . when applying arraylearna, the parameters of the model were always estimated from the original genomic features and therefore equal for all the cases. in the dataset normalized according to the genomic controls, the performance of the three approaches improved with respect to the non transformed dataset. however, after lowess normalization all methods misclassified a large number of genes. opwise misclassified  <dig> up-regulated genes in sample  <dig> as equally transcribed; the two-fold approach misclassified  <dig> genes as up-regulated in sample  <dig> and  <dig> genes as equally transcribed. arraylearna misclassified  <dig> genes as up-regulated in sample  <dig> and  <dig> as equally transcribed. when applying the normalization approach based on the genomic features, the genomic features and the identically expressed genes showed the same average ratios, so that the normalized ratios of the equally transcribed genes were centred in  <dig> and accordingly the ratios of the differentially expressed genes were corrected, therefore, results improved with all the analysis approaches. with lowess normalization, the centre of gravity of the whole dataset was considered to be the centre of gravity of the equally transcribed genes. thus the normalized ratios of the genes located in the centre of gravity of the whole dataset were close to  <dig> and wrongly considered to be equally expressed. on the other hand, the ratios of the truly equally transcribed genes were shifted towards typical values of differentially transcribed genes. hence, after this normalization approach, misclassification is due to occur with any kind of analysis. other problems derived from lowess normalization are described in  <cit> .

in the non-transformed and normalized with genomic controls datasets, arraylearna was more accurate than the other two approaches. in the non-transformed dataset, arraylearna misclassified  <dig> genes and only  <dig> in the dataset normalized according to the genomic controls. some genes equally transcribed showed ratios slightly greater than  <dig>  therefore, the two-fold approach misclassified  <dig> genes in the non-transformed dataset and  <dig> after genomic normalization. opwise misclassified  <dig> and  <dig> genes in the non-transformed and normalized dataset, respectively. opwise misclassified a large number of genes up-regulated in sample  <dig> as equally transcribed. the two-fold cut-off approach with narrower boundaries mostly misclassified genes equally transcribed as up-regulated .

discussion
we present a bayesian microarray analysis tool which takes advantage of genomic dna control features and predicted operon structure to provide an accurate and informed analysis of transcriptomic data.

the estimation of the model parameters relies on the ratios measured from genomic dna features of the appropriate strain printed on the microarray slide. this is the scenario for which arraylearna has been designed. if genomic dna features are not printed on the slide, the computing tool implementing arraylearna allows the user to input the ratio at the boundary between genes equally and differentially expressed. the parameters of the model are then estimated to obtain approximately the desired boundary. an alternative solution could be to identify genes shown to have consistently non-changing expression patterns instead of printed genomic dna

arraylearna can be run without knowing the operon structure of the genome. operon predictions are not indispensable for the analysis but help the classification of genes with low confidence measurements. the operon information is quantified by p <dig> and p <dig>  which comply with p <dig> + p <dig> =  <dig>  the greater p <dig>  the greater is the probability that the gene in study is identically expressed in both samples. the value of p <dig> is greater than  <dig>  if the number of equally expressed genes in the operon is higher than the number of differentially expressed genes. the initial value of p <dig> and p <dig> is  <dig>  and has no effect on p. moreover, p is very robust to the prior values of these two parameters, even if these values were completely erroneous, the genes classified with high confidence would not be affected. starting from the initial values, the analysis is iterated to obtain the true values for p <dig> and p <dig>  and recalculate p to help correctly classify genes with low confidence measurements. the values of p <dig> and p <dig>  and thus p, depends on both the predicted structure of the operon and the number of genes of the operon. fig 4a shows the effect of the transcription pattern on p by using an example in which the gene in study is up-regulated in one sample and belongs to an operon with  <dig> additional genes. if all the other genes of the operon are also up-regulated in that sample then p decreases by ca. two-fold, while if they are equally transcribed p increases by ca. two-fold; if  <dig> genes of the operon are up-regulated and  <dig> equally transcribed, p is not affected. the same behaviour is observed if the gene in study is classified as equally transcribed. that means that only genes with values for p very close to the cut-off values, i.e. low confidence measurements, are reclassified. fig 4b shows the effect of the size of the operon on p. the plot represents the transcriptional pattern with the greatest effect on p: the gene in study is temporally classified as equally  transcribed and the rest of the genes in the operon have the opposite classification. when the operon has only  <dig> genes, p remains largely unaffected. the effect of the transcriptional pattern on p increases when the size of the operon increases, but it soon converges so that an operon of  <dig> genes has practically the same effect as an operon of  <dig> genes. we chose this range of numbers because we observed that the largest predicted operons for e. coli k <dig>  c. jejuni nctc  <dig> and s. pneumoniae tigr <dig> contain,  <dig>   <dig> and  <dig> genes, respectively. in any case, p is slightly affected so that the classification of genes truly expressed either in one or both samples is not modified; for instance, for an operon with  <dig> genes, only genes with values for p greater than  <dig>  would be reclassified as equally transcribed  and only genes with values for p smaller than  <dig>  would be reclassified as differentially expressed. arraylearna differs from opwise in this respect. opwise does not take into account the size of the operon but uses only the information of the pair of genes flanking the gene in study. with arraylearna, only genes with low confidence measurements, showing ratios close to the boundary between equally and differentially transcribed genes, may be reclassified. thus reclassifications, due to the use of the operon information, are not possible for genes with high confidence measurements. in contrast, when taking into account the operon information, opwise misclassified  <dig> genes as differentially expressed in dataset ii although many of them had ratios with values of ca.  <dig> . this is a consequence of the fact that opwise uses the transcriptional information of only the two genes flanking the gene in study and in dataset ii these genes had very similar average ratios and relatively small variances. thus, several genes with average ratios even smaller than  <dig>  were incorrectly classified as differentially expressed.

the underlying model in arraylearna is different from the gaussian models developed by  <cit> . the approaches of  <cit>  model the expression measurements by normal distributions parameterized by means and variances with conjugate prior distributions and assuming dependence between means and variance. as an alternative to full bayesian treatment,  <cit>  suggested the use of an intermediate solution using a regularized t-test, in which the variance is replaced by the posterior mean of the variance of the model.  <cit>  modified the gaussian model by introducing a bernoulli random variable, indicating whether the gene is differentially expressed. the parameter, p, of the bernoulli distribution describes the proportion of differentially expressed genes and it is estimated by the iteration of the analysis. the effect of this parameter in the posterior probability is similar to that of p <dig>  or p <dig>  introduced in arraylearna to quantify the operon information. the model underlying opwise  <cit>  is also based in the above gaussian model but introducing a new component of the error called systematic error or bias estimated from the measurements of the genes belonging to the same operon. the posterior probabilities are estimated for single genes without operon information and with operon information as a mixture of the posterior probabilities of all the possible operon composition combinations of the gene in study with the pair of genes adjacent to it.

the model underlying arraylearna assumes that the log ratios have a gumbel distribution with a known scale parameter, a location parameter with conjugate prior and the genes being independent. the probability of equal transcription is estimated in the steepest tail of the posterior distribution, which results in a steeper probability curve and a neater boundary between genes equally and differentially expressed than when using the gaussian model . the number of replicates affects the posterior probability but this effect is smaller when using the gumbel distribution. arraylearna gives more conclusive results with very low number of replicates than the gaussian approach . for the case presented in fig  <dig>  the log ratio for which the probability of equal expression is less than  <dig>  varies between  <dig> , if n =  <dig>  and  <dig>  if n =  <dig>  as expected in statistical inference, replication leads to greater resolution of small differences in gene expression  <cit> . in general, statistical analysis techniques are conservative with small sample sizes and may under estimate the number of genes up- or down-regulated. researchers should seek confirmation of results before proceeding to undertake more elaborate, gene-specific experiments.

the scale parameter of the gumbel distribution is estimated from the standard deviation of the ratios measured from the genomic control features. this is an estimation of the variability in equally expressed genes intrinsic to the experimental hybridization and overcomes the uncertainty of estimations with low number of replicates and the fact that replicated measurements, in the same or replicated slides and from the same or replicated experiments, may not reflect the variability of the set of features with equal amounts of hybridized transcripts from each sample. thus the genomic dna features printed on the microarray slide offer a significant advantage not only for data normalization but also for determining whether the differences in expression are significant based on the robust estimation of the variability of equally transcribed genes. moreover, printed genomic dna offers distinct advantages over other types of features designed to be non-crosshybridizing controls  in combination with exogenously added cdna. such controls will only account for part of the experimental variability, compared to printed genomic dna, which reflects the variability arising from the experimental hybridization of the labelled cdna prepared from the rna under study.

CONCLUSIONS
we have introduced a bayesian model based on the gumbel distribution, in combination with printed genomic dna controls and predicted operon information, and demonstrated that it is a robust method for analysing microarray expression profiles. the method is applicable to data derived from hybridizations of labelled cdna samples as well as from hybridizations of labelled cdna with genomic dna. the method can equally be applied to datasets where differentially regulated genes predominate. the method we introduce performed better than two existing methods  when analysing the experimental datasets presented in this work.

