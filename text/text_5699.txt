BACKGROUND
over the past decades, context-dependent evolutionary models have been the subject of an increasing number of studies. these studies demonstrate that the assumption of site-independent evolution is overly restrictive and that evolutionary models that take into account context-dependencies greatly improve model fit. most context-dependent models have a temporal aspect in that the evolution of a given site over a branch is assumed to depend upon its immediate neighbours at the start of the branch. specifically, context-dependent models are useful when studying mammalian genomes, due to the extensive methylation of c in cg doublets, which could make such cs hotspots for mutation .

by allowing for mutations of both single nucleotides and pairs of neighbouring nucleotides, arndt et al.  <cit>  considered the evolution of an initial random sequence of nucleotides in discrete time steps, according to a set of update rules. arndt et al.  <cit>  further computed dinucleotide odds ratios to measure whether a given dinucleotide pair is over- or underrepresented and concluded that these correctly capture the strong underrepresentation of the cpg-dinucleotides in the human chromosome  <dig> 

hwang and green  <cit>  not only allow the evolution of a given site over a branch to depend upon its immediate neighbours at the start of the branch but further partition each branch into two or more small discrete time units, when the length of that branch is sufficiently long, in order to accurately approximate the continuous-time markov substitution process. the authors estimate separate context-dependent rate matrices for five different clades and for a sixth group comprising the remaining ancestral branches. hwang and green  <cit>  further model a dependency pattern along the sequence at the ancestral root using a second-order markov chain.

empirical studies  have shown that the preceding or succeeding bases in a sequence have a large influence on the occurrence of a base, both in coding and non-coding sequences. this suggests the importance of modelling dependencies along the sequence. for example, erickson and altman  <cit>  studied the nucleotide sequence of the rna of the bacteriophage ms <dig> using markov chains found that the total nucleotide sequence of the rna of the bacteriophage ms <dig> showed very significant second-order dependence. blaisdell  <cit>  studied sixty-four eukaryotic nuclear dna sequences, half of them coding and half non-coding using first-, second- and third-order markov chains and found significant statistical evidence in favour of a third-order markov chain in  <dig> of the  <dig> non-coding sequences longer than  <dig> bases, suggesting that most sequences required at least second-order markov chains for their representation while some required chains of third order.

in previous work  <cit> , we have introduced a context-dependent model of evolution which allows the evolution of a site across a branch to depend upon the identities of its two immediate flanking bases at the start of the branch. since the root of the tree does not have any ancestral sequence, we have assumed a site-independent distribution at the ancestral root sequence using a set of context-independent model frequencies, which is also used in the estimation of the context-dependent substitution rates. in this paper, we relax this assumption by modelling markov chains of varying orders at the ancestral root sequence, thus modelling a context-dependency scheme across the entire tree. we also show that the assumption of using a single set of model frequencies for analyzing context-dependencies is overly restrictive. we allow for a set of context-dependent model frequencies which aims to accurately model the context-specific sequence composition throughout the underlying tree and test the performance of such a model by calculating the appropriate  bayes factors using thermodynamic integration  <cit> . we show that context-dependent model frequencies drastically increase the model fit and allow for accurate estimation of the parameters involved in specifying the ancestral root distribution. we assess the performance of an ancestral sequence composition that is coupled to the context-dependent model, inspired by the approach of arndt et al.  <cit>  and provide evidence that a decoupled root distribution outperforms a coupled root distribution. we compare the parameter estimates of our model for two approaches, i.e. a first approach that allows the evolution of a given site to depend only upon the identities of its immediate flanking bases at the start of a branch versus a second approach which partitions each branch into two or more parts to better accommodate evolving flanking bases across the branch.

methods
data
we have used a first dataset consisting of  <dig> vertebrate species , as in baele et al.  <cit> . in terms of the sequences used, this dataset is a subset of the alignment analyzed in the work of hwang and green  <cit>  and margulies et al.  <cit> , containing sequences all orthologous to a ~ <dig> -mb region on human chromosome 7q <dig>  which contains the cystic fibrosis transmembrane conductance regulator gene . we have extracted the ancestral repeats, transposons that appear to have been dispersed, and then become inactive, prior to the divergence of the species in question, and that are believed to have been evolving more or less neutrally since that time . the resulting ancestral repeats dataset consists of the same type of sites as in the work of siepel and haussler  <cit> , but contains only primate sequences. the dataset consists of  <dig>  sites for each of the  <dig> sequences and is analyzed using the following rooted tree topology , gorilla), orang-utan), , vervet)), , squirrel monkey)).

a second dataset consists of the ψη-globin pseudogene sequences of six primates , containing  <dig>  nucleotides in each sequence. we have used the fixed consensus tree shown in the work of yang  <cit> : , gorilla), orang-utan), ).

bayesian markov chain monte carlo using data augmentation
bayesian inference of phylogeny is based on a quantity called the posterior probability function of a tree, in the same way as maximum-likelihood inference is based on the likelihood function. while the posterior probability is generally tedious to calculate, simulating from it is relatively easy through the use of markov chain monte carlo  methods . relaxing the assumption of independent evolution leads to computational difficulties, which we handle via a data augmentation scheme  <cit> . let θ be the collection of unknown parameters indexing the evolutionary model of interest, yobs the observed nucleotide sequences  and ymis the unknown ancestral sequences . the observed-data posterior  is intractable under our model because it involves the likelihood of the observed data which is computationally cumbersome. however, when yobs is "augmented" by a random draw for ymis from the distribution f of the ancestral sequences, the resulting complete-data posterior f becomes tractable. a detailed discussion of the data augmentation approach in our proposed bayesian markov chain monte carlo approach and in the thermodynamic integration framework for model comparison can be found in previous work  <cit> .

context-dependent modelling assumptions
we provide a model-based approach to test the assumptions put forward in the empirical research of blaisdell  <cit>  and assume zero-, first-, second- and third-order markov chains to specify the probability that a given base appears at a given site in the  root sequence, given the identities of its preceding sites . for example, a second-order markov chain is a temporal or spatial sequence of events characterized by the property that the outcome of any event in the chain may be dependent upon  the two events immediately preceding it, but has no residual dependence on any further events preceding those. in other words, in the ancestral root sequence the probability that a given site occurs depends on the identities of the sites preceding it  in that same ancestral sequence. arndt et al.  <cit>  used a two-cluster approximation to calculate dinucleotide frequencies, yielding an exact solution if the stationary state of the mutation process is a first-order markov chain, while hwang and green  <cit>  modelled the distribution of bases at the ancestral root as a second-order markov chain.

in the case of a zero-order markov chain, one set of frequencies πroot = {πa, πc, πg, πt} is used to specify the distribution at the root sequence. when a first-order markov chain is used, four independent sets of frequencies are required: πroot = {πx|a, πx|c, πx|g, πx|t}, with x ∈ {a, c, g, t} the identity of the site preceding the given site. likewise, a second-order πroot = {πyx|a, πyx|c, πyx|g, πyx|t} markov chain and a third-order πroot = {πzyx|a, πzyx|c, πzyx|g, πzyx|t} markov chain is specified with y ∈ {a, c, g, t} the identity of the site  <dig> positions prior to the given site and z ∈ {a, c, g, t} the identity of the site  <dig> positions prior to the given site. zero-, first-, second- and third-order markov chains increase the parameter space with respectively  <dig>   <dig>   <dig> and  <dig> sets of base frequencies . note that our notation for the distribution at the root sequence differs from the typical notation for conditional probabilities in that we put the conditional part before the 'pipe' symbol .

to study the context-dependent substitution process across the remainder of the underlying tree, we estimate a general time-reversible model  in each of the  <dig> possible neighbouring base combinations, yielding a context-dependent model consisting of  <dig> parameters . in each context , the general time-reversible model has the following substitution rates in the case of context-dependent model frequencies πxy = {πx|a|y, πx|c|y, πx|g|y, πx|t|y} and rate exchangeability parameters qx|w→z|y, with x  the 5' and y  the 3' neighbouring base at the ancestral sequence of the branch  and w the base at the start of a branch and z the base at the end of that branch . these parameters are estimated for each context independently:  .

let θ be the collection of terms of the off-diagonal elements of the matrix above , each multiplied by the probability that one would start with that starting base . this context-dependent model, although consisting of a collection of reversible models, allows for describing non-reversible evolutionary phenomena, such as the cpg-methylation-deamination process . the context-dependent evolutionary model and the markov chain used to estimate the ancestral root distribution are hence decoupled . note that in the case of context-independent model frequencies, the model simplifies to the model in  <cit> . throughout the remainder of this paper, we will use the notation rx|ac|y, rx|ag|y, rx|at|y, rx|ca|y, rx|cg|y, rx|ct|y, rx|ga|y, rx|gc|y, rx|gt|y, rx|ta|y , rx|tc|y and rx|tg|y to indicate the substitution rates between two nucleotides. for instance, rx|ac|y = πx|ac|y . qx|a→c|y denotes the substitution rate from a to c with x the 5' and y the 3' neighbouring base at the ancestral sequence of the branch. when it is clear which neighbouring bases are meant or when no context-effects are assumed, we will use the notation rac, rag, rat, rca, rcg, rct, rga, rgc, rgt, rta, rtc, and rtg to indicate the substitution rates.

further, we assume a fixed underlying phylogenetic tree structure  for the evolutionary relationship between the species in our dataset. the branch lengths of the tree are estimated in our mcmc-run, along with all the other parameters of the context-dependent evolutionary model.

prior distributions
let t be the set of branch lengths with tb one arbitrary branch length and μ a hyperparameter in the prior for tb in t. the following prior distributions q are chosen for our analysis, with Γ the gamma function. dirichlet priors  assign densities to groups of parameters that measure proportions . for each set of model frequencies of which the ancestral root sequence is composed, the following prior distribution is assumed:  

for the model parameters of each context  independently, the following prior distribution is assumed :  

for each of the frequencies in each neighbouring base combination, with x the 5' and y the 3' neighbouring base at the ancestral sequence of the branch , the following prior distribution is assumed:  

further, branch lengths are assumed i.i.d. given μ:

tb|μ ~exponential ,  for each tb in t

and

μ ~inv-gamma , , μ >  <dig> 

bayes factor calculation
by allowing for context-dependent evolution, evolutionary models become more parameter-rich. as previously discussed  <cit> , consistency problems may arise with such high-dimensional models, along with potential computational burdens. in view of this, a model-selection approach should be used that penalizes the addition of extra parameters unless there is a sufficiently impressive improvement in fit between model and data  <cit> . to compare the different assumptions concerning the root distribution, we have calculated  bayes factors  <cit> . log bayes factors are typically divided into  <dig> categories depending on their value: from  <dig> to  <dig>  indicating nothing worth reporting; from  <dig> to  <dig>  indicating positive evidence of one model over the other; from  <dig> to  <dig>  indicating strong evidence of one model over the other; and larger than  <dig>  indicating very strong evidence of one model over the other  <cit> . we have chosen to calculate bayes factors using thermodynamic integration  <cit> , since the traditional harmonic mean estimator of the marginal likelihood systematically favors parameter-rich models and is hence unfit to compare these complex context-dependent models. we have used the model-switch integration method and have performed bidirectional checks, i.e., we have calculated both annealing and melting integrations under various settings to obtain very similar runs, as suggested in the work of rodrigue et al.  <cit> . when comparing different models, we report  bayes factor estimates for both annealing and melting integrations, as well as their mean. more details concerning the bayes factor calculation using a data augmentation approach can be found in baele et al.  <cit> .

coupled root distribution and context-dependent evolutionary model
our approach for estimating context-dependent evolutionary patterns across a phylogenetic tree separates the estimation of the root distribution probabilities from the estimation of the context-dependent evolutionary patterns. this approach is similar to that of hwang and green  <cit>  but clearly different from the approach of arndt et al.  <cit>  and jensen and pedersen  <cit> . arndt et al.  <cit>  derive the root distribution probabilities from the substitution process. our substitution probabilities are different from theirs, as the dependencies cascade from the leaves of the tree up to its root, whereas the substitution probabilities in arndt et al.  <cit>  do not. in view of this, we integrated both approaches by means of a two-cluster approximation  to derive the root distribution probabilities from our context-dependent evolutionary model. we focus here on deriving formulas for calculation of a first-order root distribution  using the context-dependent model frequencies present in the context-dependent evolutionary model, with ai the identity of the base at a given site i, p the probability of observing ai, p the probability of observing ai when the preceding base is ai- <dig>  p the probability of observing ai when the preceding base is ai- <dig> and the succeeding base is ai+ <dig>  and p the probability of observing ai+ <dig> when its second left-most base is ai-1:  

with:  .

this last equation can be rewritten using the two-cluster approximation as:  

substitution in the expression for p then yields the expression for the first-order root distribution probabilities. since analytic solutions were not possible, we used an iterative approach based on successive approximation  to solve this system in each iteration of our mcmc approach. for each approximation we have used five iterations  to make the system converge towards a new solution.

simulation studies
we have performed two series of simulation experiments to examine the accuracy of our mcmc-approach and to assess whether our results might be influenced by the choice of prior distributions. the first series of simulations focuses on a second-order ancestral root distribution decoupled from the context-dependent evolutionary model while the second series of simulations focuses on a first-order ancestral root distribution coupled to the context-dependent model. both simulations show that our method is able to reliably infer root distribution estimates, context-dependent model parameters and frequencies, as well as branch lengths from a large dataset. for more information on the set-up of the simulations, as well as the results of both simulations, we refer to additional file  <dig>  additional file  <dig> and additional file  <dig> 

continuous-time approximation
in view of the computational complexity, we make the weak assumption that the identities of the immediate flanking neighbors remain constant across each branch of the tree. as the dataset analyzed in this paper contains closely related organisms, i.e. short internal and terminal branches will be estimated for the given tree topology, we expect that this assumption will not lead to drastically different parameter estimates compared to a branch-partitioning approach such as the one proposed by hwang and green  <cit> . indeed, while this assumption makes our approach less biologically realistic, branch-partitioning is most likely only required for longer branches . to assess the need for partitioning the branches in our dataset, we split each branch into two or more parts of equal length such that the average substitution rate per time unit is smaller than or equal to  <dig>   <cit>  and compare all the parameter estimates of our context-dependent model with a second-order markov chain at the ancestral root to our approach without branch partitioning. instead of estimating context-dependent substitution patterns on  <dig> branches, these patterns now have to be estimated on  <dig> branch parts, which leads to an almost 3-fold increase in computation time. the branch-splitting approach of hwang and green is a discrete-time method. for a comparison of both continuous and discrete-time methods to sample substitution histories along branches, in terms of performance and accuracy, we refer to the work of de koning et al.  <cit> . apart from comparing the parameter estimates, we have also calculated an additional  bayes factor of our context-dependent model with a second-order markov chain against an independent gtr model, with the branch lengths partitioned.

RESULTS
ancestral repeats
independent model frequencies: bayes factors
in figure  <dig>  we calculate the increase in model fit vis-à-vis the general time-reversible model, brought about by relaxing the assumption of site-independent evolution at the ancestral root sequence . the assumption of a separate set of base frequencies at the root already provides a significant increase in terms of model fit over the model of baele et al.  <cit> , even though such a zero-order markov chain still assumes a site-independent distribution at the ancestral root sequence. the first- and second-order markov chain at the root sequence yield a phenomenal increase in terms of model fit. the assumption of a third-order markov chain at the root sequence yields no further improvement, which may be related to the corresponding drastic increase in number of parameters.

context-dependent model frequencies: bayes factors
we have calculated  bayes factors for our context-dependent model with context-dependent model frequencies and markov chains of different orders at the ancestral root sequence in the same way as reported above, with the general time-reversible model as the reference model. the results are shown in figure  <dig> . even when assuming a site independent distribution at the ancestral root sequence, a drastic increase in model fit is realized through context-dependent model frequencies. as when assuming independent model frequencies, optimal fit is reached when assuming a second-order markov chain at the ancestral root sequence, although the increase in model fit is now higher than when assuming independent model frequencies.

coupled root distribution and context-dependent evolutionary model: bayes factor
inspired by the work of arndt et al.  <cit> , we have calculated the log bayes factor for this first-order successive approximation approach with coupled root distribution against the independent gtr model, resulting in an annealing estimate of  <dig>   and a melting estimate of  <dig>  , yielding a bidirectional mean log bayes factor of  <dig>  log units. we conclude that our approach to couple the root distribution to the evolutionary model, inspired by the work of arndt et al.  <cit> , yields a suboptimal model fit for this data.

continuous-time approximation: bayes factor
as mentioned above, the context-dependent model with context-dependent model frequencies and a second-order markov chain at the ancestral root sequence yields a a bidirectional mean log bayes factor of  <dig>  log units, compared to the independent gtr model  log units for the annealing scheme and  <dig>   log units for the melting scheme). we have recalculated the log bayes factor for this model, this time splitting the branches where appropriate. due to the use of a full data likelihood , the branches under both the context-dependent and independent model being compared need to be split into parts as otherwise the two likelihoods corresponding to the two models would be incomparable. the independent model will however not benefit from the branch partitioning, as it is an approach aimed at approximating the continuous distribution of the context-dependent markov substitution process. the split branches model comparison yields a bidirectional mean log bayes factor of  <dig>  log units, compared to the independent gtr model  log units for the annealing scheme and  <dig>   log units for the melting scheme). this difference of approximately  <dig> log units cannot solely be attributed to the difference in evolutionary model estimates, given that these differ only slightly between both approaches. the main reason for this significant difference is hence likely the more accurate approximation of the context-dependent markov substitution process by allowing the ancestral sequences to change in between the internal speciation nodes .

independent model frequencies: root distribution estimates
from previous work  <cit> , we have obtained the stationary distribution given  by: πa =  <dig>  , πc =  <dig>  , πg =  <dig>   and πt =  <dig>  . these estimates, as well as those presented in the remainder of this work, were obtained by performing  <dig>  mcmc iterations, discarding the first  <dig>  as the burn-in sequence and calculating the mean of the remaining  <dig>  samples.

modelling a zero-order markov chain along the ancestral root sequence still assumes a site-independent distribution but relaxes the stationarity assumption by allowing for a different set of base frequencies to estimate the evolutionary models that describe substitutions in the remainder of the tree. by comparing the two sets of base frequencies, one can assess the restrictions imposed by assuming a stationary distribution across the entire tree. the estimates for the base frequencies along the ancestral root sequence  πa =  <dig>  , πc =  <dig>  , πg =  <dig>  , πt =  <dig>   are different from those used throughout the remainder of the tree πa =  <dig>  , πc =  <dig>  , πg =  <dig>  , πt =  <dig>  .

allowing for a first-order markov chain along the sequence yields the four sets of base frequencies for the ancestral root sequence in table  <dig>  the estimates from the first-order markov chain at the ancestral root sequence clearly show an important effect of mammalian evolution, i.e. the presence of a so-called cpg-effect . indeed, the probability of encountering a g at the ancestral root sequence when it is preceded by a c is extremely low , which leads to increased probabilities of observing either a, c or t at the root sequence when the preceding site is a c. this confirms the result of arndt et al.  <cit> , who calculated dinucleotide frequencies and odds ratios and showed that the cpg dinucleotide is underrepresented in mammalian sequences as a result of the cpg-methylation-deamination process, although the estimate in table  <dig> is much lower than theirs. this underscores the importance of  a first-order markov chain when modelling context-dependent evolution. the comparison of the remaining rows in table  <dig> illustrates the presence of other evolutionary patterns. for example, while the probability of observing a c or a g in the ancestral root sequence is quite similar regardless of whether the preceding site is g or t, there is a higher probability of observing an a when the preceding site is g than when it is t.

estimates  for the four sets of base frequencies at the ancestral root sequence and the set of base frequencies used in the remainder of the tree, for the context-dependent model with independent model frequencies and a first-order markov chain at the ancestral root. the extremely low estimate for the probability of observing a g when the preceding base is a c, is a direct consequence of the cpg-methylation-deamination process in mammalian sequences. note that the base frequencies used throughout the remainder of the tree differ from those when assuming a zero order markov chain at the ancestral root sequence.

to assess whether the probability of observing a given nucleotide at a given site in the ancestral root sequence depends only on its immediate preceding site, we have also modelled a second-order markov chain at the ancestral root sequence. this was also used by hwang and green  <cit> , but without testing whether it was supported by the data. the estimates for the sixteen sets of base frequencies for the ancestral root sequence are shown in table  <dig> 

estimates  for the sixteen sets of base frequencies at the ancestral root sequence and the set of base frequencies used in the remainder of the tree, for the context-dependent model with independent model frequencies and a second-order markov chain at the ancestral root. the probabilities are grouped by the identity of the immediate preceding site. note that the base frequencies used throughout the remainder of the tree are similar to those when assuming a first order markov chain at the ancestral root sequence.

the estimates from the second-order markov chain at the ancestral root sequence show additional differences in base frequencies when compared to the estimates from the first-order markov chain. for example, there are large relative differences in the probabilities of observing a g when the preceding site is a c. when that c is preceded by an a, the probability of observing a g is more than twice as much as when c is preceded by g. likewise, from table  <dig> we see that the probability of observing an a equals  <dig> % when its preceding site is an a. however, the site two positions away causes variation in this estimate, i.e. from  <dig> % up to  <dig> %. this illustrates the importance of using a second-order markov chain at the ancestral root sequence.

independent model frequencies: parameter estimates
we have shown that the addition of a second-order markov chain at the ancestral root sequence increases model fit drastically over a site-independent distribution at the root. to determine whether the inferred context-dependent parameters are influenced by modelling a second-order markov chain at the ancestral root sequence we have performed two separate mcmc runs of  <dig>  iterations, one for the independent general time-reversible model and one for the context-dependent model  with a second-order markov chain at the root. after discarding the first  <dig>  iterations as the burn-in sequence, we have constructed posterior difference densities for each of the  <dig> entries in the context-dependent matrices. the resulting posteriors were used to determine a bayesian p-value  for each of the  <dig> entries to test whether the parameter estimates were significantly different between both mcmc runs. this approach resulted in the detection of  <dig> significantly differing evolutionary parameters . interestingly, all of these were found to include one of the transition parameters. indeed,  <dig> out of  <dig> neighbouring base combinations showed different estimates for rag ,  <dig> out of  <dig> neighbouring base combinations showed different estimates for rtc  and  <dig> out of  <dig> neighbouring base combinations showed different estimates for rct . as the assumption of a second-order markov chain at the ancestral root sequence results in a drastic increase in model fit over assuming a site independent distribution at that root sequence, we show the substitution rates for the  <dig> off-diagonal elements in our context-dependent model using independent model frequencies in figure  <dig>  the difference with the substitution rates shown in our previous work  <cit>  is that figure  <dig> shows the matrix entries of the evolutionary models .

context-dependent model frequencies: root distribution estimates
as a second-order markov chain at the ancestral root sequence yields the largest increase in model fit, we have re-estimated the corresponding root distribution probabilities when assuming context-dependent model frequencies. the results can be seen in table  <dig>  we compare them with the results reported in table  <dig>  which were obtained using a single set of independent model frequencies. large relative differences occur in those combinations of sites involved in the cpg-methylation-deamination process. indeed, the root distribution probabilities differ in the following combinations of preceding sites: ac, cc, gc, tc and cg. as each row in table  <dig> sums to one, a difference in one probability estimate influences the three remaining probability estimates given the same combination of preceding sites.

estimates  for the sixteen sets of base frequencies at the ancestral root sequence under the context-dependent model with context-dependent model frequencies. the probabilities are grouped by the identity of the immediately preceding site.

each of the four preceding site combinations ac, cc, gc, tc has a drastically different estimate for the probability of a g occurring at the succeeding site. this is in accordance with arndt et al.  <cit> , who considered a more approximate development based on dinucleotide frequencies and odds ratios conditional on the left preceding base . the estimates indicate a dependence of the probability of observing a g on the second left-most base. indeed, the probability of observing a g at a given site is respectively  <dig> % and  <dig> % when ac and cc precede that site, but only  <dig> % and  <dig> % respectively, when gc and tc precede that site.

the decreased probabilities of observing a g at a given site when a c precedes it, is caused by the hypermutability of cpg in human and other species, which, in turn, is due to the fact that cytosine is methylated only in cpg dinucleotides . both cytosine and 5-methylcytosine undergo high rates of spontaneous hydrolytic deamination, but deamination of 5-methylcytosine produces thymine, and mismatch repair of c → t transitions is less efficient than that of c → u transitions . further, when cg precedes a given site, the probability of observing a c at that site drops from  <dig> % when assuming a single set of independent model frequencies to  <dig> % when assuming context-dependent model frequencies. these differences demonstrate the importance of relaxing the assumption of independent model frequencies.

context-dependent model frequencies: parameter estimates
based on the estimated  <dig> off-diagonal matrix entries of our context-dependent model assuming context-dependent model frequencies, we constructed bayesian p-values  to test whether the parameters were significantly different between an mcmc assuming independence at the ancestral root  and a second-order markov chain. for matters of comparison, figure  <dig> shows all the substitution rates of our context-dependent model using context-dependent model frequencies, assuming a zero-order markov chain to describe the sequence composition of the ancestral root. it shows large variation in substitution rates across different neighbouring base combinations. given the presence of the cpg-methylation-deamination process in mammals, we focus on the substitution rates from c to t  in the axg, cxg, gxg and txg contexts as well as their compensating substitution rates from g to a  in the respective cxt, cxg, cxc and cxa contexts. the mean substitution rates rct are  <dig> ,  <dig> ,  <dig>  and  <dig>  for the axg, cxg, gxg and txg contexts, respectively, and  <dig> ,  <dig> ,  <dig>  and  <dig>  for the compensating substitution rates rga in the cxt, cxg, cxc and cxa contexts, respectively. while the compensating substitution rates are clearly elevated, they can hardly be called compensating .

when comparing these estimates to the estimates of the matrix entries when assuming a second-order markov chain at the ancestral root sequence,  <dig> significantly differing substitution rates are observed out of the  <dig> tested at the 5% significance level. specifically, the following substitution rates were found to differ most : rga in contexts cxa, cxc, cxg and cxt; rct in contexts cxa, axg, cxg, gxg and txg; rat in contexts cxa, cxc, cxg and cxt; rag in contexts cxc and cxt; rca in context cxg; rta in context cxg; rgt in context cxa; and rac, rgc in contexts cxa, cxc, cxg and cxt and rct in context cxg. all these differences are observed in those contexts related to the cpg-methylation-deamination process, as the increase in rct and rga substitution rates influences the remaining parameters of the evolutionary model.

however, as can be seen from figure  <dig>  a second-order markov chain at the ancestral root sequence along with context-dependent model frequencies offers the largest increase in model fit when compared to the independent general time-reversible model. we show the substitution rates for the  <dig> off-diagonal elements in our context-dependent model using context-dependent model frequencies and a second-order markov chain at the ancestral root sequence in figure  <dig>  the difference with employing a zero-order markov chain at the ancestral root is staggering, specifically in terms of the substitution parameters that describe the cpg-effect. the mean substitution rates rct are now  <dig> ,  <dig> ,  <dig>  and  <dig>  for the axg, cxg, gxg and txg contexts, respectively, versus  <dig> ,  <dig> ,  <dig>  and  <dig>  for the compensating substitution rates rga in the cxt, cxg, cxc and cxa contexts, respectively.

the context-dependent substitution rates rct clearly illustrate the hypermutability of cpg in mammals, as the rct rates in the cpg-related contexts are about  <dig> times higher than those in other contexts. further, they are in accordance with the root distribution estimates reported in the previous section. indeed, the higher the context-dependent rct rate, the lower the corresponding ancestral root distribution estimate as the mean substitution rates rct of  <dig> ,  <dig> ,  <dig>  and  <dig>  for the axg, cxg, gxg and txg contexts correspond to the following probabilities of observing a g at a given site of  <dig> %,  <dig> %,  <dig> % and  <dig> %, when preceded by ac, cc, gc and tc respectively.

these results are clearly more indicative of the effect of compensating mutations at the opposite side of a stem region and are supported by the largest increase in model fit. however, as discussed by green et al.  <cit>  and siepel and haussler  <cit> , three of the nine studied genes are located on the opposite strand from the other six so our data contains a mixture of bases that correspond to the transcribed and non-transcribed strands. this supports our findings of compensating substitution rates at opposing stem regions, although we find that the rct substitution rate is between  <dig> % and  <dig> % higher than the compensating rga substitution rate when a given site has a g as its 3' neighbour.

finally, in table s <dig> , we report the estimates for the context-dependent model frequencies for our optimal model. note that these probabilities are conditional on the identities of the two immediate flanking bases, while those at the ancestral root sequence are dependent upon the two left flanking bases. the table reveals two sets of frequency estimates related to the cpg-methylation-deamination process: πa|c|g, πc|c|g, πg|c|g, πt|c|g and πc|g|a, πc|g|c, πc|g|g, πc|g|t. the estimates of πa|c|g and πc|g|t are nearly identical, which can be attributed to the fact that these frequencies represent compositional aspects of opposing sides of a stem region. this also holds for πt|c|g and πc|g|a but not for the other two pairs. the reason for πc|c|g and πc|g|g as well as πg|c|g and πc|g|c to differ is reflected in the estimated substitution rates in figure  <dig>  indeed, for the cxg and gxg neighbouring base combinations there is a discrepancy between the rct and rga substitution rates corresponding to the difference in estimates for the context-dependent model frequencies.

third-order markov chains
while bayes factor calculations did not support the assumption of a third-order markov chain at the ancestral root, this may be partly related to the inflation in number of parameters in such models. to gather additional information on the usefulness of a third-order markov chain at the ancestral root sequence, we have therefore applied a four-dimensional  principal component clustering for the identity of the left-most base on which a given site is assumed to depend in a third-order markov chain. we found that the most plausible combinations where the identity of the left-most nucleotide has no additional influence are: x-a-c, x-c-a, x-c-t, x-t-a and x-t-g . in other words, reducing the third-order markov chain for these combinations to a second-order markov chain may improve model fit. we provide additional information on this approach in additional file  <dig> 

coupled root distribution and context-dependent evolutionary model: parameter estimates
















estimates  for the four sets of base frequencies at the ancestral root, for both first-order markov chain approach and the successive approximation first-order approach using our context-dependent model with context-dependent model frequencies. bayesian p-values are reported within brackets with the successive approximation estimates, shedding light on whether the root distribution probabilities are significantly different from one another under both approaches.

the underperformance of the coupled root distribution is quite unexpected as the substitution process along the lineages of the tree should give rise to the root distribution . lineage-dependent substitution processes, when unaccounted for, can disturb the estimation of the coupled root distribution . to assess whether the context-dependent substitution process is lineage-dependent, we have divided our observed sequences in three clades: a first clade, called the 'human clade', consists of the sequences for human, chimpanzee, gorilla and orang-utan; a second clade, called the 'baboon clade', consists of the sequences for baboon, macaque and vervet; and a third clade, called the 'marmoset clade', consists of the sequences for marmoset, dusky titi and squirrel monkey. we have performed one mcmc run for each of these three datasets to estimate the context-dependent substitution parameters. figure  <dig>  to  <dig>  compares these  <dig> parameters between the three clades using xy plots . large differences can be seen on all three figures, indicating that many context-dependent substitution rates are in fact lineage-dependent, which may explain the underperformance of the coupled root distribution approach.

continuous-time approximation: parameter estimates
we have performed  <dig>  iterations  to estimate the parameters of our context-dependent evolutionary model with a second-order markov chain at the root, when the branches are split so that the average substitution rate per time unit is smaller than or equal to  <dig>   <cit> . we compare all the estimates involved with those of the same model without splitting the branches in figure  <dig>  the evolutionary parameters show no differences and only minor differences can be seen for the estimates of the model frequencies. no significant differences could be found for the root distribution estimates nor for the branch length estimates. for more details, we refer to additional file  <dig> 

pseudogenes
independent model frequencies: bayes factors
we have again compared the performance of the four different markov chains  along the root sequence by calculating the appropriate  bayes factors. this time, the general time-reversible model  was used as the reference model. in figure  <dig>  we calculate the increase in model fit brought about by relaxing the assumption of site-independent evolution at the ancestral root sequence, while assuming a context-dependent model with independent model frequencies . a first-order markov chain at the ancestral root sequence yields the largest increase in model fit, outperforming a second-order markov chain at the ancestral root, which also drastically increases model fit compared to the reference model. all other assumptions in terms of the ancestral root distribution yield negative log bayes factors compared to the gtr model and are hence outperformed by a site-independent evolutionary model. the assumption of a third-order markov chain at the root sequence yields a drastic decrease in model fit compared to the first- and second-order markov chains, which may be related to the increase in number of parameters.

context-dependent model frequencies: bayes factors
context-dependent model frequencies: root distribution and parameter estimates
as a first-order markov chain at the ancestral root sequence, combined with context-dependent model frequencies in the evolutionary model, yields the largest increase in model fit, we here report the root distribution and parameter estimates for this model. the first-order ancestral root distribution estimates can be seen in table  <dig>  from which the decreased probability of observing a g at a given site when its preceding site is a g is immediately apparent due to the 5-methylcytosine deamination process . this is in accordance with the results for the ancestral repeats dataset, although in that dataset a second-order markov chain was used. these differences once again demonstrate the importance of relaxing the assumption of independent model frequencies.

estimates  for the sixteen sets of base frequencies at the ancestral root sequence under the context-dependent model with context-dependent model frequencies. the probabilities are grouped by the identity of the immediately preceding site.

in table s <dig> in additional file  <dig>  we report the estimates for the context-dependent model frequencies for our optimal model for the pseudogenes dataset. the decreased rct substitution rate in the gxg context mentioned above is reflected in the first set of frequency estimates related to the cpg-methylation-deamination process: πa|c|g, πc|c|g, πg|c|g, πt|c|g , where it can be seen that the πg|c|g estimate is much higher than the estimates for πa|c|g, πc|c|g and πt|c|g. the second set of cpg-related frequency estimates however shows fairly equal estimates for πc|g|a, πc|g|c, πc|g|g, πc|g|t.

discussion
in this paper we have demonstrated the importance of modelling non-independent root distributions at the ancestral root sequence in a phylogenetic tree. this completes the dependency scheme across the entire tree so that the evolution at every nucleotide, ancestral or observed, is allowed to depend on other nucleotides. we have found that the use of a second-order markov chain at the ancestral root sequence results in the largest increase in terms of model fit for a large dataset of primate ancestral repeat sequences. for a smaller dataset of primate pseudogenes, we have found that a first-order markov chain at the ancestral root sequence yields the largest increase in model fit. we have calculated the differences in model fit using computationally demanding , but accurate bayes factor calculations and report drastic increases in model fit by modelling context-dependence, especially compared to other evolutionary assumptions such as among-site rate variation. indeed, as shown in previous work  <cit> , the increase in model fit brought about by assuming among-site rate variation equals about  <dig> log units, which is drastically lower than the more than  <dig>  log units increase reported here. further, for the pseudogenes dataset, the increase in model fit brought about by the optimal context-dependent model and root distribution equals about  <dig> log units, compared to an increase in model fit for among-site rate variation with a bidirectional mean log bayes factor of  <dig>  units , corresponding to the findings of yang  <cit> . as far as we know and given the known presence of cpg-effects in our dataset, context-dependent models seem to be the best choice for increasing the evolutionary model's realism.

our approach is probably best compared to that of hwang and green  <cit> , although we have not employed branch-specific context-dependent models due to the fact that our dataset consisted only of primate sequences. we have shown, using careful and computationally intensive model selection, that the choice of the ancestral root distribution heavily influences the substitution rates for the cpg-methylation-deamination process and that first- and second-order markov chains at the root sequence, independent of the context-dependent evolutionary model, are better fit to describe the data than a first-order approximation coupled to the context-dependent evolutionary model. hwang and green  <cit>  do not employ a model selection approach in their study on a branch-specific context-dependent model.

even though hwang and green  <cit>  use more data , statistical support for their modelling choices in terms of observed increase in model fit, which we have shown here to be a crucial aspect of examining complex evolutionary models, should be used to further strengthen their findings  <cit> . given the complexity of branch-specific context-dependent models, model comparison is however seriously hampered by the immense computational demands. our estimates of the substitution rates for the cpg-effect seem to be lower than those reported by hwang and green  <cit> , although the authors do not report the mean estimates so only a visual comparison is possible. the rct and rtc substitution rates are generally more elevated in the work of hwang and green  <cit> , but this could be specific to the untranscribed regions the authors have investigated.

we have also shown that the discrete approximation to the continuous-time markov substitution process, as used by hwang and green  <cit> , yields a significant increase in model fit in terms of the log bayes factors calculated. as the evolutionary model parameters were unaffected by partitioning the branches where appropriate, the branch partitioning approach itself is responsible for more accurately modelling the ancestral states throughout the underlying phylogenetic tree. as mentioned in the methods section, we have split each branch into two or more parts of equal length such that the average substitution rate per time unit is smaller than or equal to  <dig>   <cit> . however, by no means does this approach guarantee that the optimal number of branch partitions are used and that the corresponding increase in model fit over an independent evolutionary model is maximized. further research on such discrete approximations is reported in the work of de koning et al.  <cit> .

the design and study of context-dependent evolutionary models is also of interest when studying coding sequence evolution, as shown by recent publications on mutation-selection models . indeed, while current mutation-selection models use the general-time reversible model  for modelling mutation bias , the context-dependent model presented in this manuscript may be better suited to model mutation bias at either one of the three codon positions.

CONCLUSIONS
designing accurate context-dependent models is a complex process, with many different assumptions that require testing using an accurate procedure for model testing, which are computationally very demanding. not only the context-dependent evolutionary model itself requires estimation and evaluation, we have also shown that the choice of an adequate ancestral root distribution is essential to accurately estimate the model's parameters. moreover, we have also shown that the choice of an ancestral root distribution, changes across different datasets. in other words, there is no single context-dependent model or ancestral root distribution that can be argued to work well for a given dataset, without having to actually perform a series of model comparisons.

we have shown in this paper that context-dependent models are very useful when analyzing primate sequences, due to the presence of the cpg-methylation-deamination process. since this is a process known to occur in mammalian evolution, context-dependent evolutionary models should also prove useful in the analysis of non-primate mammalian datasets. even though the context-dependent models presented in this paper greatly increase model fit over independent models in the two datasets studied, additional work on context-dependent evolutionary models is required. for example, we have shown that an ancestral root distribution coupled to the context-dependent model does not improve model fit as much as a decoupled ancestral root distribution does. while we have provided a possible explanation for this result, additional work is required to clarify this issue.

software availability
additional file  <dig> contains the necessary software routines, evolutionary models, ancestral root distributions and several example input files for the software to reproduce the various results presented in this paper. more information on how to use the software can be found in additional file  <dig> 

authors' contributions
gb initiated the study, designed the context-dependent evolutionary model, implemented the markov chain root distribution approach, co-designed the coupled root distribution approach, performed all the analyses, programmed the software routines and wrote a first complete version of the manuscript. yvdp contributed biological expertise to the analyses and edited the manuscript. sv contributed statistical expertise to the analyses, co-designed the coupled root distribution approach and edited the manuscript. all authors read and approved the final manuscript.

supplementary material
additional file 1
file containing supplementary material and information that was not included in the main document.

click here for file

 additional file 2
file containing supplementary figure s <dig>  encapsulated postscript figure.

click here for file

 additional file 3
file containing supplementary figure s <dig>  encapsulated postscript figure.

click here for file

 additional file 4
file containing supplementary figure s <dig>  encapsulated postscript figure.

click here for file

 additional file 5
file containing software classes, alignments used and example input files.

click here for file

 acknowledgements
yves van de peer acknowledges support from an interuniversity attraction pole  grant for the biomagnet project . stijn vansteelandt acknowledges support from iap research network grant nr. p06/ <dig> from the belgian government . we acknowledge the support of ghent university .
