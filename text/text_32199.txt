BACKGROUND
chromatin immunoprecipitation on microarrays  is a technique that has been used primarily for investigating the binding locations of a protein on a genome-wide scale. with the availability of custom tiling arrays, this approach has yielded unprecedented resolution for these binding events. much of the work so far has focused on binding of transcription factors  <cit> , and many computational methods have been developed to identify the bound regions  <cit> . recently this technology has been extended to the genomic mappings of other features, such as histone modifications  <cit> , transcriptionally active regions  <cit> , and binding sites of other protein complexes  <cit> . in the present work, we examine several issues related to the experimental design and data analysis of chip-chip experiments, with a focus on two-color platforms. despite their increasing popularity  <cit> , some basic analytical issues still remain unresolved.

one issue is related to the role of mock controls in the design of experiments. mock control experiments using non-specific antibody or no antibody are often performed together with chip-chip experiments to control for sample handling, labeling bias, preferential amplification, and other biases that may occur in the experiment. for experiments with two-channel arrays, the immunoprecipitated sample is hybridized against the input dna and the mock control is hybridized against the same input dna. this design allows the same mock control to be used in multiple experiments and tends to give less noise than hybridizing directly against the mock ip, as the amount of input dna is much larger than that of the mock ip. without the mock control, it is possible to get false positive bound sites due to an artifact in the experimental procedure; on the other hand, the mock controls increase the experimental cost substantially and may in fact add other artifacts in some cases. the importance of this design issue was underscored in a recent paper  <cit> . in that work, differential enrichment of genic and intergenic regions is observed in the chip-chip experiments for histone occupancy in yeast. however, the mock control data also display a similar feature, and there is no substantial differential enrichment once the mock control data are used to normalize the histone occupancy data. if in general the conclusion drawn in a study depends on whether or not the mock control data are used, there is a need to perform mock control experiments in all cases, and the conclusions drawn in those experiments without mock control may be suspect. in fact, in many published works, mock control data sets are missing, and the control experiments do not appear to have been performed.

another important and related issue is normalization of the data. there are many sources of systematic variation in microarray experiments, and normalization is a computational process for reducing the experimental artifacts, both within each array and between arrays. this issue has been studied extensively for gene expression microarray data  <cit> , and the standard normalization methods for expression arrays have been extended to chip-chip experiments  <cit> . a difficulty with chip-chip data, however, is that the distribution of the log-ratios is asymmetric. there is only a 'bump' in the right side of the distribution, corresponding to the binding events. standard normalization methods for expression analysis assume that there is a roughly equal number of up- and down-regulated genes or that the proportion of differentially expressed genes is small. neither type of assumption is satisfied in general for chip-chip data, and standard methods do not work well. some fixes have been proposed previously, such as mirroring the left side of the distribution to the right to estimate the background distribution  <cit> . however, we have noticed that the distribution of log-ratios is often not centered at zero or does not appear to have a symmetric background. a quantile normalization  <cit> , which forces the signals in each array to follow the same distribution, has been used in some cases, but this seems to be too stringent, eliminating the variation in the degree of binding among experiments. the bias in the gc content of each probe also influences its hybridization characteristics and a normalization effect for this has been proposed recently  <cit> .

we also note that the chip-chip data for chromatin-associated proteins and histone modifications present additional challenges, as they often display broad regions of enrichment. this is in contrast to the isolated and sharp peaks that are typical for the binding of transcription factors. some examples are given in figure  <dig>  in figure 1a, the log-ratios for the binding of the male-specific lethal  complex show that some regions are clearly bound, compared to the mock control. in this particular case, the bound regions appear to be between  <dig> kb and  <dig> kb; an extreme case is shown in figure 1b, where the bound region is larger than  <dig> kb. the presence of these large regions mean that the typical within-array normalization schemes mentioned above are even less likely to work because of the increased asymmetry in the distribution of log-ratios. it also means that the common algorithms for finding bound regions based on hidden markov models  are likely to give incorrect results. standard hmms, by their construction, assume a geometric distribution of fragments, which is unlikely to hold in this data set.

in this work, we present a novel normalization method designed specifically for chip-chip data and show its effectiveness in correcting dye-bias and other systematic errors. we also find that proper normalization is closely related to the issue of whether mock control should be used: in the absence of proper normalization, mock control is generally necessary to eliminate the effect of systematic errors; but through appropriate normalization, the lack of mock controls may be compensated. we find that the use of the proposed normalization method alone without the use of mock control is sufficient to identify the binding events and that the correlation among biological replicates also improves as a result. furthermore, our normalization strategy also yields insight into the question of differential enrichment of histone occupancy in genic and intergenic regions  <cit> .

this methodological investigation is made possible by a unique data set we have generated on dosage compensation in drosophila  <cit> . the msl complex is known to bind specifically to the x chromosome to up-regulate the x-linked genes  <cit> . with tiling array data for the binding of the msl complex on both the x chromosome and autosomes , analytical methods can be evaluated for their efficiency of identifying bound regions on the x with autosomes as control regions. this interesting feature of drosophila msl binding also offers evaluation of normalization schemes and other data analysis strategies.

RESULTS
experimental design
unnormalized data require mock control experiments
to examine the role of the mock control, we first examine the msl binding data. the data are from nimblegen tiling arrays with  <dig> bp resolution . in figure  <dig>  the scatter plots of the log-ratios for chip-chip versus mock control are shown, along with density contours. figure 2a and 2b are the scatter plots for x and 2l chromosomes, respectively. the x-specificity of msl complex binding is clearly reflected in this comparison of x and autosomes. the data points from the 2l chromosome are roughly centered on zero on both axes and are scattered around the diagonal line y = x, as expected. the deviation from this straight line is due to noise in the experiment. the symmetry of the blue region along line y = x confirms that there is no msl complex binding on 2l chromosome and that data on 2l chromosome can be regarded as background noise. on the other hand, the data points from the x chromosome show a large number of points that have higher log-ratio in the experiment than in the mock data.

to determine the optimal method for separating the signal from the background, we superimposed the scatter plots for x and 2l chromosome binding data in figure  <dig>  first, it appears that the mock data plays an important role and should not be ignored. without them, the threshold for determining a bound region would depend only on the experiment, corresponding to a horizontal line in the figure. one may still be able to capture a significant portion of enrichment with that approach, but it would clearly result in many false positives  and false negatives . a better method would be to utilize mock control data by subtracting the mock data from the experiment and then using a threshold on the difference. this is the typical use of the mock data in chip-chip studies. this direct subtraction of mock control is equivalent to drawing a line  parallel to the diagonal  to separate the red signal region from the blue background regions. however, the shifting of this parallel line alone, which is equivalent to changing the threshold of the log-ratio to define bound probes, cannot achieve the optimal separation  of these two regions. instead, it appears from the figure that further improvements can be made by a threshold that weighs the experiment and the mock data differently . this appears to capture the shape of the background distribution from the 2l data and thus best separates the x-specific signals. of course, the bound regions and the background regions usually cannot be separated in this way and none of the methods we develop here require such separation. but the unique characteristics of our dosage compensation system allows us to validate our methods.

dye-bias and the use of mock control data
the purpose of the mock control experiment is to correct dye-bias and other systematic errors in chip-chip experiments. the correlation observed in figure 2b indicates that there may indeed be some systematic bias. to examine possible dye-bias, we plot the log-ratio as a function of signal intensity. often referred to as the 'ma plot,' we plot the log-ratios m = log on the y-axis and the average intensity a = log on the x-axis, where r and g are the intensities of the two-channels. this is equivalent to a scatterplot of the two channel intensities but the  <dig> degree rotation and rescaling makes it easier to interpret.

in figure  <dig>  the ma plots of a chip-chip experiment and its corresponding mock control data are shown. if there had been no intensity-dependent dye-bias, the bulk of the points should fall on the horizontal line m =  <dig>  instead, we see a striking display of intensity-dependence. clearly, setting a threshold on unnormalized data without mock data subtraction, which would be equivalent to a horizontal line in figure 4a, would result in a large number of false positives and negatives. such a phenomenon has been observed in many two-color expression arrays previously and has been attributed to the differences in the size of the dye molecules and their differing efficiency, as well as nonlinearity in the scanning process  <cit> . the same patterns displayed in figure  <dig> have been observed consistently in many tens of nimblegen arrays. while it may not be as strong for other platforms, we have observed the same type of dye-bias in most data sets we have examined .

the use of mock data is one possible solution to this problem. because the mock data contain the same dye-bias , subtraction of the mock data from the experiment data would eliminate much of the bias. however, because noise exists in both chip-chip and control experiments, a direct subtraction of the mock control has the disadvantage of introducing additional noise. this effect is shown in figure  <dig>  in which the probes in the small green region selected from the background of chip-chip experiment  are spread out in the background of mock control experiment  due to noise.

within-array normalization
rather than eliminating systematic variation by subtracting the mock data, we consider the possibility of normalizing each array first. normalization is a process for reducing the variations within and between arrays of non-biological origin  <cit> . it is an important step for any array analysis, as it has been shown that different normalization methods can lead to divergent results in expression data analysis  <cit> . for two-color arrays, the conventional normalization method is to fit a line through the background portion of the data in the ma plot and then to regard this line as the new horizontal line m =  <dig>  because one cannot distinguish the signal from the background, a robust line fitting method called locally weighted regression and smoothing scatterplots   <cit>  is often applied. this technique fits the line through the dense part of the distribution and is resistant to outliers, which are likely to be the signal. while this procedure has been shown to work well for expression arrays, it is unlikely to be effective for chip-chip data. the reason for this is that the signal is only positive, unlike the up- and down-regulation in expression arrays and that the amount of signal  can be very large, especially for histone modifications or chromatin-associated proteins, as illustrated in figure  <dig>  these issues were described in the background section. indeed, when the lowess method is applied to our data shown in figure  <dig>  the fitted curve is 'pulled' by the signal  and is far away from the background data . because of the heavy bias in this data set, even a more robust version of lowess, such as one based on interquartile range of residuals, is unlikely to work near the high-intensity spots. other line fitting methods we have tried also gave the same unsatisfactory results. while it is not difficult to see where the line should be from visual inspection, the problem of fitting a line through the background when the background is mixed with the signal is not trivial.

we propose a novel method to solve this issue. the main idea is that we perform the line fitting not on the original data but on the first order differences of the probe values along their chromosomal location. this is a discrete version of taking a derivative. this idea is illustrated in figure  <dig> with a simulated profile. when there is a binding in the profile , the distribution of log-ratios has a 'bump' on the right side of the distribution . but when we look at the differences of neighboring probes, the beginning and the end of the bound region give a positive and a negative value, respectively, but the middle of the bound region is indistinguishable from unbound regions . that is, the distribution of the log-ratios is symmetrized.

our novel normalization procedure based on the above idea is illustrated in figure  <dig>  first, when the bias is strong, as is the case here, we rotate the data in the ma plot rather than fitting a lowess curve first. based on the scatterplot, measuring the deviation perpendicular to the background appears reasonable, and this also ensures that the signals do not dominate the background at all different intensities. to select the rotating angle from the ma plot, we transform the data to the differences between neighboring probes for both m and a, denoted by σ and σ . this σ vs σ plot shows the same dye-bias trend as the ma plot, but signal portion is scattered in a symmetric manner as to not influence the determination of the rotating angle, regardless of the amount of the signal. after rotation , we can perform the standard lowess-type normalization for any remaining nonlinear artifacts. in order to further minimize the effect of signal in the line fitting, outlier log-ratios can be given smaller weights. in our example, for instance, those log-ratios  more than two standard deviations away from their median were given zero weights in the lowess fitting. we also employed an iterative procedure in which the outliers were redefined after each step and the curves were refit, but it gave similar results. figure 6d shows the final ma plot after normalization steps.

after this normalization, the scatterplot between experiment and mock control changes dramatically, as shown in figure 7a . with the reduction of the systematic variations, the log-ratios have a small deviation, and a horizontal line is now sufficient to separate the signal from the background. this suggests that correcting the chip-chip data using mock control may be neglected after a proper normalization.

the combinatorial method of rotation and lowess normalization with no use of mock control data in fact results in improved correlations among biological replicates compared to the subtraction of the mock data, both at the probe level and at the gene level. for the two chip-chip replicates for two cell types , the correlations at the probe level increases from 73% and 78% to 82% and 79%, respectively. for the agreement for enrichment at the gene level, the matches increase from 89% and 86% to 96% and 95%, respectively. this may be partly due to the reduction in the noise level as a result of avoiding the subtraction of log-ratios. a further improvement in the identification of the signal can be made by simple smoothing of the profiles  along their chromosomal location, for both chip-chip and the mock control. regardless of the algorithm used for finding bound regions, the smoothing step suppresses the effect of outlier probes and results in improved performance. the amount of smoothing applied depends on the type of binding sites and the spacing of the arrays. in our case, a running median smoothing along each probe with a window size of  <dig> probes gave good results. in contrast to figure 7a, there are fewer stray probes in figure 7b and both the signal and background parts appear to be 'tighter' with smaller standard deviations.

measurement of noise levels and normalization across arrays
in the previous section, we used the differences of log-ratios from neighboring probes as a means to symmetrize the distribution and perform curve fitting. but the same idea can be used to estimate the level of array-specific noise, which can be used to normalize between arrays. as shown in figure  <dig>  the differences of the consecutive probes is not affected by the amount of binding, other than few outlier points corresponding to the ends of the bound regions. thus, a measure of deviation for the distribution of differences  would serve as a reasonable measure of noise. the median absolute deviation can be used to obtain a robust measure of deviation .

more generally, we can study the spatial correlation between neighbors i and i + j, for some j ≥  <dig>  because sonicated fragments are being hybridized, there is still correlation between consecutive probes . as the probes farther away are compared, this correlation weakens and, conversely, the estimate of the background noise increases. in our data, we have found that after j ≈  <dig>  the correlation is significantly diminished and the noise estimate becomes relatively stable. this is illustrated in figure  <dig> for both the experiment and the mock control. with  <dig> bp resolution on our arrays, j =  <dig> corresponds to a distance of  <dig> bp, which is roughly the size of the dna fragments.

to see how the amount of binding affects this estimate, the noise estimates were obtained separately for chromosomes x and 2l as well as the combined data . for chromosome 2l, there is a clear stabilization of the noise estimate; for chromosome x, it continues to increase due to the long range correlations but the increase is very slight. for the mock control, there is almost no distinction between the x and the 2l chromosomes and they reach a plateau around j =  <dig>  the proximity of the curves near j =  <dig> for x and 2l indicate that the proposed estimate of noise is resistant to the different amount of binding. this estimate can therefore be used to rescale the log-ratios explicitly or as a basis for determining a significance threshold on each array.

validations
to determine the effectiveness of the proposed normalization, we examine how the analysis results change between this and the standard mock subtraction normalization. this is studied in the context of two data sets.

identification of binding sites by the msl complex
we had previously used mock subtraction for our analysis and identified several hundred binding sites that show up repeatedly in biological replicates  <cit> . in the current analysis, we seek to determine the overlap between the sites identified from the old and the new analyses, using drosophila embryo data as an example. in figure  <dig>  we display venn diagrams that show the overlap of the clusters obtained between the two replicates using the mock subtraction analysis and each of replicates using the new analysis. first, we see that the overlap between the two replicate was already high in the previous analysis , with the size of the intersection over the size of the union being / = 85%. with the new analysis , most of the overlapping binding sites are reproduced  = 98% and  = 97%). to determine whether the new method can be a substitute for the old one, we compare the result of  embryo sample  <dig>  vs embryo sample  <dig>  with that of  embryo sample  <dig>  vs embryo sample  <dig> . as shown in figure 9a, the result is in fact slightly better for case . there are more overlapping binding sites in case  than in case ,  <dig> +  <dig> vs  <dig> +  <dig>  and fewer non-overlapping binding sites in case  than in case ,  <dig> +  <dig> vs  <dig> +  <dig>  that is, the bound genes obtained by the normalization method without the mock data is at least as accurate as those obtained with mock subtraction. a similar result is obtained for the other embryo sample . to make it fair, roughly the same number of clusters had to be chosen in each case in this comparison. hence, the number of probes called significant was equalized by taking the same top 13% of the log-ratios from the x chromosomes, which corresponded to the number of sites found in the original work  <cit> . the clusters were then formed based on these probes.

histone occupancy and modification
in pokholock et al  <cit> , the authors generated genome-wide maps of nucleosome acetylation and methylation patterns in yeast. they examined the relationship between the modification status of various histones and transcriptional activity, and they associated specific events with different parts of actively transcribed genes. agilent arrays were used, with 44k 60-mer probes covering  <dig> mb  of the yeast genome except the highly repetitive regions and an average probe density of  <dig> bp. importantly, the authors note their surprise in finding that while differential enrichment of intergenic and genic regions was observed in histone occupancy, the same was also observed in control experiments without antibody or antibody recognizing a nonhistone protein, possibly due to the different relative levels of intergenic and genic dna recovered during extraction procedures. when these controls experiments were used to normalize the histone h <dig> data, they found that the difference between the relative levels of intergenic vs genic dna was not substantial. the authors show that the use of a different control explains the discrepancy between their conclusions and that of an earlier paper  <cit> , in which genomic dna was used. to investigate whether the above observation is affected by the statistical technique used for normalization, we applied the proposed normalization method to the same data set. in figure  <dig>  ma plots are shown for mock control , histone occupancy with anti-h <dig> antibody, and histone occupancy with anti-h <dig> antibody. although not as strong as in the drosophila data set above, there is a substantial dye-bias that requires correction, especially for the no-antibody case. it is clear that a direct subtraction of the mock data to correct dye-bias in chip-chip data can introduce additional noise in the analysis. there is no obvious cluster of points with positive log-ratios corresponding to the binding this time, but the signal is still present.

the binding pattern across all rescaled genes is shown in figure  <dig>  without any normalization, both histone occupancy and mock control data show differential enrichment of genic regions over intergenic regions, as described in the original manuscript  <cit> . however, when the data are normalized with rotation and lowess-fitting, the no-antibody case no longer shows differential enrichment while the h <dig> and h <dig> cases still show it. this lends a strong support to the conclusion that the differential enrichment exists and that the problem of a control experiment having the same enrichment pattern may have been an artifact.

CONCLUSIONS
the x-specificity of drosophila msl complex binding provides an excellent opportunity for the development of methods for identifying bound regions in chip-chip data. we have found that there is significant bias due to the differences in the dye, as seen on the average intensity vs log-ratio plot, and that this must be corrected to obtain accurate estimates of binding sites. one way to fix this problem is via direct subtraction of the mock control, but it appears that the lack of mock control may be compensated through proper normalization steps. we developed a normalization procedure for chip-chip experiments based on the differences of the neighboring probes along the chromosome and found that it improves both the correlation of log-ratios at probe level and the overlap at gene level among replicates. conventional normalization methods may work for chip-chip experiments with transcription factors because the proportion of the bound probes is generally small. but with histone modifications or binding of chromatin-associated proteins, that proportion may be much greater and the standard methods do not work well. we also used the same idea to measure array-specific noise for normalization across arrays.

we have examined the nimblegen and agilent platforms in detail here, but other studies using these and other two-dye platforms are likely to have experimental artifacts. it is thus important that the data are processed properly to obtain accurate description of the binding sites.

