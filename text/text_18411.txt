BACKGROUND
major histocompatibility complex  molecules play an essential role in host-pathogen interactions determining the onset and outcome of many host immune responses. only a small fraction of the possible peptides that can be generated from proteins of pathogenic organisms actually generate an immune response. mhc class ii molecules present peptides derived from proteins taken up from the extracellular environment. they stimulate cellular and humoral immunity against pathogenic microorganisms through the actions of helper t lymphocytes. in order for a peptide to stimulate a helper t lymphocyte response, it must bind mhc ii in the endocytic organelles  <cit> .

the mhc class i molecule is highly specific and binds a limited set of peptides of a narrow length distribution  <cit> . in contrast to this, the mhc class ii molecule is highly promiscuous both with respect to composition and length of the peptide ligands  <cit> . during the last decade, large efforts have been invested in developing methods to allow for in silico screening of pathogenic organisms with the purpose of identifying peptides that will bind mhc class ii molecules in a given host  <cit> . the majority of these methods are trained on limited data sets covering a single or a few mhc molecules. the binding of a peptide to a given mhc molecule is predominantly determined by the amino acids present in the peptide-binding core. however, peptide residues flanking the binding core  do also to some degree affect the binding affinity of a peptide  <cit> . most published methods for mhc class ii binding prediction however focus on identifying the peptide-binding core only, ignoring the effects on the binding affinity of pfrs.

in two recent publications, we have demonstrated i) how a stabilization matrix method  could be applied to simultaneously identify the peptide-binding core and predict the binding strength  <cit> , and ii) how this peptide core alignment together with information about the peptide flanking residues could be integrated in a neural network-based algorithm that allows for pan-specific hla-dr binding prediction   <cit> . both the smm-align and the netmhciipan methods have in recent benchmarks been shown to be among the best publicly available methods for hla-dr peptide binding prediction  <cit> .

here, we show how an artificial neural network-based alignment method, nn-align, can significantly outperform both the smm-align and netmhciipan methods. the nn-align method includes explicit encoding of the peptide flanking residues in terms of amino acid composition and length, as well as a novel scheme for neural network training that deals with the data redundancy inherent in the peptide data due to multiple examples of identical binding cores. the nn-align method is trained on a large data set of more than  <dig>  quantitative peptide mhc binding values covering  <dig> hla-dr alleles. the performance is evaluated on five independent data sets and its performance is compared to the best publicly available state-of-the-art mhc class ii prediction methods.

methods
data
a quantitative iedb hla-dr restricted peptide-binding data set was obtained from the data published by nielsen et al.  <cit> . the data set comprises  <dig> hla-dr alleles each characterized by at least  <dig> and up to  <dig> peptide binding data points. to minimize the peptide overlap between training and testing data, the binding data for each hla-dr allele was partitioned into  <dig> data sets using the approach outlined by nielsen et al.  <cit>  minimizing the sequence overlap between the training and test data. each data set and corresponding partition is made available online at http://www.cbs.dtu.dk/suppl/immunology/netmhcii- <dig> .php.

the method was evaluated further on five independent data sets taken from recent mhc class ii benchmark publications. the hla-dr class ii ligand data set from the syfpeithi database  <cit>  was taken from nielsen et al.  <cit> . only ligands restricted by one of the  <dig> hla-dr alleles in the quantitative binding data set were included. this syfpeithi data set consists of  <dig> mhc ligands. the peptide core data set was also taken from nielsen et al.  <cit>  to evaluate the ability of the proposed method to identify the core of hla-dr binding peptides. as a further evaluation, the method was evaluated against the benchmark data sets published by lin et al.  <cit>  and wang et al.  <cit> . the lin data set data set contains binding affinities of  <dig> overlapping peptides to seven common hla-dr molecules . only six of the seven alleles were included since the drb1* <dig> allele is not covered by the data in the quantitative training data set. all methods from the lin benchmark that cover all six alleles and which were labeled as "best performing" by lin at al. were included in the benchmark. the wang et al. benchmark consists of quantitative binding data to  <dig> hla-dr alleles. in this benchmark, the predictive performance of the nn-based method was evaluated using 10-fold cross-validation. finally, to investigate how the performance of the nn-based method depends on the inherent similarity in the peptide data, the method was benchmarked using the el-manzalawy benchmark data set  <cit> . three data sets with different degrees of inherent peptide similarity were selected from the iedb benchmark data set: upds; unique peptides from the iedb data base, srds1; sequence similarity reduced upds data excluding peptides sharing  <dig> mer subsequences, and srds2; sequence similarity reduced srds <dig> data ensuring maximum 80% similarity between pairs of peptides. three support vector machine  based mhc class ii binding prediction methods were included in the el-manzalawy et al. benchmark; composition transition distribution , local alignment kernel , and k-spectrum kernel . the performance of the different methods was evaluated using the auc measure since this is the only measure provided in the el-manzalawy paper that does not depend on binding affinity classification.

method
nn-align was implemented as a conventional feed-forward artificial neural network method  <cit> . the method consists of a two-step procedure that simultaneously estimates the optimal peptide binding register  and network weight configuration. initially, all network weights were assigned random values. given this set of network weights, the core of a given peptide was identified as the highest scoring of all  <dig> mers contained within the peptide. the score of a  <dig> mer peptide was calculated using the conventional feed-forward algorithm. the network weights were updated using gradient descent back-propagation. given a peptide core alignment, the weights were updated to lower the sum of squared errors between the predicted binding score and the measured binding affinity target value. the quantitative binding data contains a large degree of redundancy since many peptide data points have been measured repeatedly with single amino acid mutations in order to identify for instance the effect of the amino acids flanking the peptide-binding core. to limit the effect of such data redundancy, the network back-propagation was modified so that the step-size of back-propagation was divided by the binding core redundancy of the given peptide. the binding core redundancy was calculated using a hobohm- <dig> algorithm  <cit>  to define clusters of identical binding cores. for a peptide belonging to a cluster containing five peptides with identical binding core, the step-size of back-propagation was thus divided by five. the identification of peptide clusters was done repeatedly during the network training based on the given binding core configuration.

the  <dig> mer peptide was encoded to the network as described for the netmhciipan by nielsen et al.  <cit> . in brief, the peptide core was presented to the network using blosum encoding, where each amino acid was encoded by the blosum log-odds vector  <cit> . the peptide flanking regions  were presented as the average blosum substitution frequency vector over a maximum length of three amino acids. the pfr length was encoded as lpfr/ <dig>  1-lpfr/ <dig>  where lpfr is the length of the pfr , and the peptide length was encode as lpep, 1-lpep, where lpep = 1//2)) and l is the peptide length. to impose an amino acid preference at the p <dig> position of the binding core, a log-odds position specific scoring matrix  was constructed using the gibbs sampler method for class ii binding prediction  <cit>  using the peptide binders in the training data for the allele in question. next, the core p <dig> amino acid was encoded as the p1-pssm score for that given amino acid, i.e. for a given peptide binding register, one additional value was added to the network input as the score of the core p <dig> amino acid at the p <dig> position in the pssm. for each peptide core, the input to the neural network thus consisted of the peptide sequence , the pfrs , the peptide length , the length of the c and n terminal pfr's , and the p1-pssm score  resulting in a total of  <dig> input values. the peptide binding affinity ic <dig> values were encoded to the neural network as log-transformed values, using the relation 1-log /log, where aff is the measured binding affinity  in nm units  <cit> .

the networks were trained using cross-validation. network ensembles were trained with  <dig>   <dig>   <dig>   <dig> and  <dig> hidden neurons, respectively. the procedure of i) identifying the optimal peptide core, and of ii) updating the network weights to lower the predictive error was repeated for  <dig> cycles for each network architecture. since the "search landscape" has a large set of local minima, each with close to identical performance values, the network training was run  <dig> times, each time with different initial configuration values, for each network architecture. this led to a significantly improved prediction accuracy . in total  <dig>  networks were created for each training/test set configuration. for each training/test set configuration, the  <dig> networks with the highest test-set pearson correlation coefficient were selected to form the final network ensemble. the binding core of a given peptide was assigned by a majority vote of the networks in the ensemble.

statistical tests
all statistical comparisons were made using one-tailed binomial tests. for each comparison, it is calculated how often one method outperforms the other , and based on these numbers one-tailed p-values were calculated. p-values less than  <dig>  were taken to be significant.

smm-align and netmhciipan methods
the smm-align method was trained as described by nielsen et al.  <cit>  on the iedb quantitative data set combined with hla-dr ligand data obtained from the syfpeithi database  <cit> . the netmhciipan method was used via the online server-link http://www.cbs.dtu.dk/services/netmhciipan.

RESULTS
the quantitative iedb benchmark data set
the predictive performance of the artificial neural network  based methods on the quantitative iedb benchmark data set is shown in table  <dig>  the performance was estimated using five-fold cross-validation. in each cross-validation, 1/ <dig> of the data were left out for evaluation and the remaining 4/ <dig> were used for a four-fold cross-validated training as described in the methods section. the four-fold cross-validated training resulted in an ensemble of  <dig> networks. the predictive binding affinity for the peptides in the evaluation set was next calculated as a simple average over the  <dig> network predictions, and the peptide-binding core was identified by a majority vote. in this approach, no peptide from the evaluation set was included in either the network training or the identification of the optimal network ensemble.

the performance was estimated using five-fold cross-validation and is given as the area under the roc curve  calculated using a binding affinity threshold of  <dig> nm. smm-align is the smm-align method described by nielsen et al.  <cit>  re-trained on the quantitative benchmark data set. tepitope refers to the method developed by sturniolo et al.  <cit> . nn is the standard nn-based method, nn-w is the nn-based method including data redundancy step-size rescaling, nn-p <dig> is the nn-based method including pssm-p <dig> amino acid encoding, nn-w-p <dig> is the nn-based method including data redundancy step-size rescaling and pssm-p <dig> amino acid encoding. nn-xpfr is the nn-w-p <dig> method excluding peptide-flanking residue encoding. for each allele, the best performing nn method is highlighted in bold and the best performing of all methods is underlined. ave is the average per-allele performance over all  <dig> alleles, and ave* is the average predictive performance over the  <dig> alleles weighted by the number of data points for each allele.

from table  <dig>  it is clear that the nn-based methods that include data redundancy step-size rescaling  significantly outperformed  their non-rescaled counterparts . when compared to the smm-align and tepitope methods, the nn-based methods all showed a significantly improved predictive performance . only for two alleles  did the smm-align method outperform nn-based methods, while tepitope did not perform best for any of the alleles.

the per-allele binomial statistical test applied here places equal weight on all alleles and does not take into account the large differences in the peptide data available for each allele. to place a relative weight on the performance of the different alleles, table  <dig> includes a performance value for each method calculated as the mean weighted by the number of peptides per allele. however, a pooled statistical test on all peptide data would favor methods being able to accurately predict binding for the alleles described by most data over other methods. in the per-allele binomial test for instance, the methods nn and nn-p <dig> have comparable performance. nn has the best performance for  <dig> alleles and the nn-p <dig> method performs best for  <dig> . this difference is not significant. when performing a binomial test on the predicted error per peptide for the pooled set of  <dig>  peptides, the difference between the two methods comes out highly significant in favor of the nn method . however, 35% of the peptide binding data are measured for the drb1* <dig> allele. the nn method performs best of the four nn-based methods on the hla-drb1* <dig> allele and pooling the data hence favors this method over the other. when performing the same test on the pooled peptide data excluding the drb1* <dig> data, the two methods come out with comparable performance . since it is essential to demonstrate that a prediction method has high predictive performance across a large set of different alleles, we therefore here limit the statistical tests to per-allele binomial tests.

comparing the performance of the nn-based method with  and without peptide-flanking residue encoding  demonstrated the importance of the latter for improved prediction accuracy. for  <dig> of the  <dig> alleles, did the inclusion of pfr improve the prediction accuracy . the direct and linear relationship between the nn-w-p <dig> prediction score and the measured binding affinity is apparent when calculating a least square linear fit between the prediction score and the log-transformed binding affinities. here, the average slope was  <dig>  ±  <dig>  and the intercept  <dig>  ±  <dig>  .

the nn-based method with p1-pssm amino acid encoding  showed a lower performance compared to the method without p1-pssm amino acid encoding . however, when investigating the amino acid distribution at the p <dig> position of the predicted binding cores of the two methods, it became apparent that the nn-w-p <dig> method produces a p <dig> binding core amino acid preference that is in stronger accordance with prior experimental knowledge than the nn-w method. only hydrophobic amino acids have experimentally been found to be allowed at the p <dig> position in the binding core of hla-dr molecules  <cit> . for the  <dig> alleles in table  <dig>  we found that the nn-w method on average assigned 30% of the predicted binders to have non-conventional p <dig> amino acids, whereas the corresponding value for the nn-w-p <dig> method was 16%.

identification of the peptide-binding core
to further investigate the effect of this difference in p <dig> binding core amino acid preference, the ability to correctly identify the binding core of hla-dr binding peptides was investigated. the hla-dr binding core data set was taken from nielsen et al.  <cit>  and consists of  <dig> peptides where the binding register to a hla-dr allele has been determined from the structure of the protein complex. the result of the benchmark is shown in table  <dig>  from this table, it is clear that the nn-w-p <dig> method was to a higher degree capable of identifying peptide-binding cores than nn-w. tepitope correctly identified all  <dig> binding cores, the nn-w-p <dig> method  misaligned one peptide by a single amino acid residue, whereas the nn-w method misaligned  <dig> peptides.

 <dig> hla-dr restricted peptides compiled from the protein database  <cit> . the columns in the table state the hla restriction, the peptide sequence, the binding core as determined from the protein structure, followed by the binding core as predicted by tepitope, smm-align, netmhciipan, nn-w-p <dig> , and nn-w , respectively. erroneous predictions are underlined.

identifying endogenously presented peptides
we next turned to the benchmark of hla-dr endogenously presented ligands. the benchmark was performed as described by nielsen et al  <cit> . in short, the ligand source protein was split into overlapping peptide sequences of the length of the ligand. all peptides except the annotated hla ligand were taken as negatives. this is a very strong assumption since suboptimal peptides that could be presented on the hla molecule are counted as negatives. this setup thus most likely underestimated the predictive performance, but the effect should be equal for all methods. for each protein-hla ligand pair, the predictive performance was estimated as the auc value. in the benchmark, we compared the predictive performance of the nn-based method including data redundancy step-size rescaling with  and without  pssm-p <dig> amino acid encoding to that of tepitope and netmhciipan  <cit> . the smm-align method was not included here since it was trained on both quantitative and hla ligand binding data  <cit> . the summary of this benchmark is shown in table  <dig> 

the benchmark data set consists of  <dig> hla-dr restricted ligands downloaded from the syfpeithi database of mhc ligands covering  <dig> hla-dr alleles. the predictive performance was estimated in terms of the auc as described in the text. ave is the average per-allele performance over all  <dig> alleles. ave* is the average predictive performance over all  <dig> ligand/hla-dr pairs. ave** is the average per allele performance over the  <dig> alleles covered by the tepitope method. netmhciipan is the hla-dr pan-specific method described by nielsen et al.  <cit> . tepitope refers to the method developed by sturniolo et al  <cit> . nn-w-p <dig> is the nn-based method including data redundancy step-size rescaling and pssm-p <dig> amino acid encoding. nn-w is the nn-based method including data redundancy step-size rescaling. nn-xpfr is the nn-w-p <dig> method excluding peptide flanking residue encoding. for each allele, the best performing nn method is highlighted in bold and the best performing of all methods is underlined.

for the hla-dr ligand benchmark, the nn-w-p <dig> method including p1-pssm encoding clearly outperforms its counterpart, nn-w, not including p1-pssm encoding. only for two alleles did nn-w outperform the nn-w-p <dig> method making this difference highly statistically significant . furthermore, the nn-w-p <dig> method significantly outperformed both the netmhciipan  and tepitope  methods. likewise, it is clear that the inclusion of peptide-flanking residues significantly improved the predictive performance of the nn-w-p <dig> method .

the wang el al. benchmark data set
the evaluation of the nn-based method on the wang et al. benchmark is shown in table  <dig>  from this benchmark, it is clear that the nn-w-p <dig> and nn-w methods have similar predictive performance and that they significantly outperformed all other methods in the benchmark . the nn-based methods were outperformed only for one allele .

nn-w-p <dig> is the nn-based method including data redundancy step-size rescaling and p1-pssm encoding and nn-w is the nn-based method including data redundancy step-size rescaling. both methods were evaluated using 10-fold cross-validation. the performance values for the  <dig> other methods were taken from wang et al.  <cit> . for each allele, the best performing nn method is highlighted in bold and the best performing of all methods is underlined.

the lin et al. benchmark data set
the predictive performance of the nn-w-p <dig> and nn-w methods was next evaluated on the lin et al. benchmark data set  <cit> . the result of this benchmark is shown in table  <dig>  all methods from the lin benchmark that cover at least six alleles and that were labeled as "best performing" by lin at al. were included in the benchmark. also from this benchmark, it is apparent that the nn-w-p <dig> and nn-w methods have similar predictive performance and that they outperformed all other methods in the benchmark.

nn-w-p <dig> is the nn-based method including data redundancy step-size rescaling and p1-pssm encoding and nn-w the nn-based method including data redundancy step-size rescaling. all other methods are described in the lin et al. publication. the auc was calculated using the following binding affinity threshold values for each of the  <dig> alleles: drb1* <dig>   <dig>   <dig>  and  <dig> threshold =  <dig> nm, drb1* <dig>   <dig>  and  <dig>  threshold =  <dig> nm . the performance values for the  <dig> methods above the dotted line were taken from lin et al.  <cit> . for each allele, the best performing nn method is highlighted in bold and the best performing method is underlined.

the el-manzalawy benchmark data set
the recent benchmark by el-manzalawy and co-workers  <cit>  demonstrated that the predictive performance of a given prediction method depends strongly on the inherent peptide similarity in the training data and that a benchmark ranking of peptide binding prediction algorithms could vary as a function of this similarity. to investigate to what extent the nn-align method and its performance were influenced by peptide similarities, we compared the performance of the nn-w-p <dig> and nn-w methods to the mhc class ii binding prediction methods  included in the el-manzalawy paper on three data sets, each with a different degree of inherent sequence similarity. from the results summarized in table  <dig>  it is clear that the nn-based methods significantly outperformed the three other methods included in the benchmark, independent of the inherent peptide similarity in the training data. only for one single comparison, nn-w-p <dig> versus ctd, the difference was only marginally significant . the nn-w method had the highest predictive performance. the difference to nn-w-p <dig> was, however, only significant for the srds <dig> data set . this analysis demonstrated that the nn-based methods are robust and perform well also in situations where the peptide similarity is low.

the methods included are nn-w-p <dig> , nn-w , ctd, la, and 5-spectrum. the performance values for the latter three methods are taken from the el-manzalawy publication  <cit> . the benchmark data sets are upds: unique peptides from the iedb database, srds1: sequence similarity reduced upds data excluding peptides sharing  <dig> mer subsequences, and srds2: sequence similarity reduced srds <dig> data ensuring maximum more than 80% similarity between pairs of peptides. for each allele, the best performing nn-based method is highlighted in bold and the best performing method is underlined.

the nn-align method
from the large set of benchmark studies, we conclude that the two methods nn-w-p <dig> and nn-w share comparable predictive performance. the nn-w-p <dig> method was shown to be more accurate in identifying the peptide core binding register, whereas the nn-w was more accurate when predicting the binding affinity. however, none of these differences were consistently statistically significant. the final method, called nn-align, was therefore implemented with a switch that allows the user to select whether or not to include the p1-pssm amino acid preference encoding.

discussion
prediction of which peptides will bind to a given mhc molecule has great implications for the understanding of how a given host will react to a pathogen infection. here, we have developed an artificial neural network-based method, nn-align, for mhc class ii peptide binding prediction. the nn-align method is inspired by the earlier published gibbs sampler  <cit> , smm-align  <cit> , and netmhciipan  <cit>  methods. the method is trained on a large set of quantitative peptide binding data consisting of more than  <dig>  peptide affinity values covering  <dig> human mhc class ii dr molecules. each peptide is encoded to the method in terms of the peptide binding core and information about the length and composition of the residues flanking this core. nn-align was trained using a novel training algorithm that allows for correction of bias in the training data due to redundant binding core representation. inclusion of peptide flanking residues was shown to significantly improve the prediction accuracy. the method was benchmarked on six independent data sets and was shown to consistently and significantly outperform other state-of-the-art mhc class ii prediction algorithms, like tepitope, smm-align, and netmhciipan. in particular, it was demonstrated that the nn-align method could provide both accurate quantitative predictions that directly translate into ic <dig> binding values and correct identification of the peptide-binding core.

in contrast to the smm-align method , nn-align is neural network based and can hence take into account higher order sequence correlations. for mhc class i binding, this has been demonstrated to be of importance for accurate prediction of peptide binding to mhc molecules  <cit> . furthermore, nn-align incorporates pfr and peptide length directly into the training of the method. this is in contrast to smm-align, where the pfr and peptide length are dealt with in an ad-hoc manner. the allele-specific nn-align and pan-specific netmhciipan methods are highly similar in their design and use of peptide features. the pan-specific method, however, is one single universal method capable of predicting binding for all hla-dr alleles of known protein sequence, in contrast to the allele-specific method, nn-align, that is trained individually for each allele. as observed for mhc class i methods, it is therefore expected that the allele-specific method will outperform the pan-specific method for alleles where sufficient data is available to accurately characterize the binding motif, as is the case for most alleles in the quantitative data set used here  <cit> .

the nn-align algorithm, even though here only applied to the problem of peptide mhc class ii binding prediction based on peptide data points, should be generally applicable to find subtle linear sequence motifs in large scale quantitative data sets like peptide chip data for mhc binding, tcr recognition, monoclonal antibodies etc., where the precise location of the receptor peptide interaction is not a priori known  <cit> .

CONCLUSIONS
we have developed a method, nn-align, for prediction of peptide binding to mhc class ii molecules. nn-align was trained using a novel training algorithm that allowed for correction of bias in the training data due to redundant binding core representation. the predictive performance of the method was significantly improved by incorporation of information from residues flanking the peptide-binding core. large scale benchmarking comprising six independent data sets covering  <dig> human mhc class ii alleles demonstrated that nn-align outperformed other state-of-the-art mhc class ii prediction methods. the method and benchmark data are made publicly available at http://www.cbs.dtu.dk/services/netmhcii- <dig> .

authors' contributions
mn developed the nn-align method, designed the benchmark, trained the prediction method and did the performance comparison between the different prediction methods, and drafted the manuscript. all authors read and corrected the manuscript.

supplementary material
additional file 1
predictive performance for  <dig> hla-dr alleles in the quantitative iedb benchmark data set. the performance is estimated using five-fold cross-validation, and the predictive performance is estimated in terms of the pearson's correlation. smm-align is the smm-align method described by nielsen et al.  <cit>  re-trained on the quantitative benchmark data set. nn is the standard nn-based method, nn-w is the nn-based method including data redundancy step-size rescaling, nn-p <dig> is the nn-based method including pssm-p <dig> amino acid encoding, nn-w-p <dig> is the nn-based method including step-size rescaling and p <dig> amino acid encoding. nn-xpfr is the nn-w-p <dig> method excluding peptide-flanking residue encoding. for each allele, the best performing nn method is highlighted in bold and the best performing of all methods is underlined.

click here for file

 additional file 2
predictive performance in terms of the auc on the iedb el-manzalawy benchmark. the methods included are nn-w-p <dig> , nn-w , ctd, la, and 5-spectrum. the performance values for the latter three methods are taken from the el-manzalawy publication  <cit> . the benchmark data sets are upds: unique peptides from the iedb database, srds1: sequence similarity reduced upds data excluding peptides sharing  <dig> mer subsequences, and srds2: sequence similarity reduced srds <dig> data ensuring maximum more than 80% sequence similarity between pairs of peptides. for each allele, the best performing of all methods is underlined.

click here for file

 acknowledgements
this work was supported by nih contracts hhsn266200400083c and hhsn266200400025c.
