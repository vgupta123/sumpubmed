BACKGROUND
ancestral state reconstruction attempts to predict properties of ancestral proteins, genes and even whole genomes in a given phylogeny according to data of extant species. this approach to understanding protein functions and evolution was first proposed by pauling and zukerkandl in their seminal work  <cit> . thereafter, with the increasing availability of biological data it has become a technique of growing importance in investigating the functions and origins of genes and proteins  <cit> .

parsimony and maximum likelihood  are the two most popular criteria utilized to reconstruct ancestral states when the phylogenetic tree representing the evolutionary history of a character is known  <cit> . parsimony methods minimize the total number of hypothetical substitutions along all branches of the evolutionary tree. the fitch method was the first parsimony method for inferring ancestral states  <cit> . it is a linear time algorithm and is accurate for taxa with highly similar sequences. the method was later modified by sankoff to account for different rates of substitutions among states  <cit> . the reader is referred to a survey book  <cit>  for reviews of parsimony methods and their variants. in contrast to parsimony methods, ml methods choose a state to be the ancestral state such that the observed states could have been evolved from it with maximum likelihood. ml inference of ancestral sequences was pioneered by yang, kumar and nei  <cit>  and by koshi and goldstein  <cit> . later, a widely used variant of ml method called the bayesian approach was introduced by huelsenbeck and his coworkers  <cit> . the reader is referred to  <cit>  and  <cit>  for reviews of ml methods and their variants.

due to the extensive usage of ancestral reconstruction methods, it has become a significant scientific endeavor to study their reconstruction accuracies. these accuracies of different methods have been either estimated by statistical simulations  <cit>  or calculated precisely by theoretical analyses  <cit> . for example, under a 2-state jukes-cantor model, several recurrence systems for calculating the reconstruction accuracies of the fitch algorithm were presented for a given phylogenetic tree  <cit> . it was shown in these studies that the reconstruction accuracies depend largely on the topology of the phylogenetic tree. thus, reconstruction accuracies and their asymptotic properties on the number of leaves were also analyzed for extremal trees like complete binary trees and comb-shaped trees   <cit> . however, by far most theoretical analyses have been limited to 2-state models. more effort should be made to study the reconstruction accuracies under higher-state models as there are  <dig> states for dna sequences and even  <dig> states for protein sequences.

in this paper, we study the ambiguous and unambiguous reconstruction accuracy of the fitch algorithm for reconstructing the root state under n-state evolutionary models. we first present a general recurrence system for calculating the reconstruction accuracies on any given phylogenetic tree. we developed software that implements this system. as pointed out by li et al.  <cit> , more taxa are not necessarily better for the reconstruction of ancestral states. our recurrence system and software can be used to select good subsets of taxa to reconstruct ancestral dnas, proteins, or other characters.

after that, we restrict the analyses to  <dig> extremal evolutionary trees under the n-state jukes-cantor model, namely equal-branch complete binary tree, equal-branch comb-shaped tree and hennigain comb-shaped tree  <cit> . it is clear that for the equal-branch trees the substitution probability along any branch is the same and is denoted by p, thus the conservation probability is q: =  <dig> - p. as examples, we analyze reconstruction accuracies and their asymptotic properties on the number of leaves for n =  <dig>   <dig>   <dig>   <dig>  we also compare the limiting ambiguous and unambiguous reconstruction accuracy of using all taxa with those of using a nearest root-to-leaf path. finally,  <dig> yule trees with  <dig> leaves are generated by the software mesquite  <cit>  and analyzed to simulate real phylogenetic trees.

from the studies, we observe several interesting properties for the reconstruction accuracies under n-state models. first, for equal-branch complete binary trees, there always exists an equilibrium interval  of conservation probability q such that, with the number of leaves tending to infinity, the ambiguous reconstruction accuracy converges to 1n, the reconstruction accuracy of randomly picking the ancestral state from n possible states. for example, the equilibrium interval for complete binary trees is  <cit>  under the 2-state jukes-cantor model  <cit> . however, a becomes  <dig> when n ≥  <dig>  we calculate b for n =  <dig>  ...,  <dig> and find that b decreases slowly with the increase of n. the reconstruction accuracies for  <dig> yule trees exhibit similar behaviors. second, for any equal-branch comb-shaped tree, the limiting reconstruction accuracies using the nearest root-to-leaf path are always greater than those using all taxa if the conservation probability is larger than 1n. finally, for any hennigian comb-shaped tree, the limiting ambiguous reconstruction accuracy is always equal to that of randomly picking a state, 1n, whereas the limiting unambiguous one is equal to nn−2∑i=lnnn−i!!.

our results suggest that more taxa should be used for reconstructing ancestral states if the tree topology is balanced and the sequences are highly similar, whereas some taxa close to the root are recommended if the tree topology is very unbalanced. in addition, under evolutionary models with molecular clock, the reconstructed state by the fitch algorithm is as bad as a state randomly picked when the conservation probability is low or the phylogenetic tree is very unbalanced. the suggestions are also partially applicable for ml methods as ml inference of the root state is the same as that of maximum parsimony estimation under simple models such as jukes-cantor models when the branch lengths of the phylogenetic tree are unknown  <cit> .

methods
the fitch method
let c be a character with state set s and t be a rooted phylogenetic tree in which each leaf is assigned a state in s. the fitch method infers the states of internal nodes in a two-stage process, namely the "leaf-to-root stage" and the "root-to-leaf stage". in the first stage, it assigns a set of states su to each node u of t as follows:

 if u is a leaf, su contains only the state of u,

 if u is an internal node having children v and w,

 su=sv*sw={sv∩swif sv∩sw≠∅,sv∪swotherwise. 

the assignment starts from the leaves, and proceeds to the internal nodes until the root r is assigned a subset sr. in the second stage, only one state su is chosen from the state subset su at each node u. this is realized by first picking randomly a state in sr, and proceeding downwards as follows. suppose v is a child of u, then

 sv={suif su∈sv,any state in svotherwise. 

as a result, any state in sr is chosen as the root state with an equal probability 1|sr|, where |sr| denotesthe cardinality of sr.

reconstruction accuracies of the fitch method
unambiguous and ambiguous reconstruction accuracy are two important criteria to evaluate the quality of a reconstruction method. let c be a character with state set s={s <dig>  s <dig>  . . ., sn}. for simplicity, we order the states and restate s={ <dig> ,⋯,n}. in order to study the reconstruction accuracies of the fitch method on a given phylogenetic tree t with root r, a markov model is usually assumed to represent the true biological evolutionary process of c, which specifies:

 pr, that is, the initial probability that the root state is i for i =  <dig>   <dig>  ..., n , and

 pr, that is, the transition probability that a state i evolves to j along the branch from node u to v for any i, j =  <dig>   <dig>  ..., n and branch uv.

in particular, pr is called the conservation probability of i along uv, and pr with i ≠ j is called the substitution probability from i to j along uv. clearly, the probability of a state in each node is already determined by the model. for any state i and vertex u in t, we use pr to denote the probability that the state of u is i. we assume throughout this paper that the evolutionary model is symmetric on all states, that is pr = pr and pr = pr for any two states i and j, and any branch uv.

after the character evolves from the root r under the model, the leaves will receive one of many possible distributions of the states each with some probability. the fitch method is then applied to these distributions to infer ancestral states. let Ψ be the set containing all the possible distributions of leaf states. for any state i∈s and any distribution d∈ Ψ, let pr be the probability that the leaf nodes receive the distribution d, given that the state at the root is i. let b⊆s, we further let c be the probability that the fitch method reconstructs set b at root from d. since both the evolutionary model and the fitch method are symmetric on all states, the reconstruction accuracies are independent of the prior distribution of initial states. thus, we choose  <dig> to be the root state and the unambiguous reconstruction accuracy  is defined as

  ua=∑d∈Ψpr c , 

the probability that it outputs the true state  <dig>  similarly, the ambiguous reconstruction accuracy  is defined as

  aa=∑1∈b1|b|∑d∈Ψprc. 

that is, if the reconstructed set b contains  <dig>  there is still a probability of 1|b| to infer the true root state.

recurrence relations to calculate reconstruction accuracies
let z be an internal node with two children x and y. since the evolutionary model is symmetric on all n states, the substitution probability between any two states is the same along a given branch. we use px and py to denote the substitution probabilities along branches zx and zy, respectively. clearly, the corresponding conservation probabilities on any state are  <dig> - px and  <dig> - py. in the following, we derive a recursive system involving 2n -  <dig> recursive formulas to calculate the reconstruction accuracies of a parent node from those of its two children.

before we present the system, it is worthy of mentioning that the original dynamic programming approach in maddison  <cit>  can be applied to calculate both accuracies for n-state models. however, it involves the calculation of 2n -  <dig> recursive formulas to calculate the reconstruction accuracies of a parent node from those of its two children, which is not efficient when both the evolutionary tree and the number of states n are large. here, we take the advantage of the symmetries of both the fitch method and the evolutionary models. more precisely, the reconstructed root states are categorized into 2n -  <dig> classes. let ℬ2i−1={b⊆s:1∈band|b|=i} for  <dig> ≤ i ≤ n and ℬ2i={b⊆s:1∈band|b|=i} for  <dig> ≤ i ≤ n -  <dig>  then ℬ={ℬ <dig> …,ℬ2n−1} is a partition of the set of all non-empty subsets of s. for any node u, define

 aiu=∑d∈Ψprucu, 

where pru denotes the probability that the leaf configuration under u is d given that the true state at u is  <dig>  and cu denotes the probability that the reconstructed set at u from d is ℬi. by this definition, ua=a1r and aa=∑k=1n1ka2k−1r.

for any node u, let the reconstructed state set be bu. then for any b∈ℬi, bz = b if and only if:  bx ∩ by = b, or  bx ∩ by = ∅ and bx ∪ by = b. thus aiz can be calculated from the reconstruction accuracies on node x and y in conjunction with the substitution or conservation probabilities along the two branches zx and zy . recurrence formulas for 2-state models can be found in  <cit> . we present the recurrence system and initial conditions for n-state models in additional file  <dig>  to facilitate our study, we also implemented a computer program which takes a phylogenetic tree in newick format and the substitution rate along branches as inputs. the phylogenetic tree can be inferred by methods like neighbor-joining  <cit>  and the substitution rate can also be estimated, see for example  <cit> . a potential application of our algorithm and program is to select the subsets of taxa to accurately reconstruct ancestral sequences such as dnas and proteins.

RESULTS
as the reconstruction accuracies of the fitch algorithm depend largely on the topology of phylogenetic trees, we focused our attention on two extremal tree shapes: complete binary trees which are the most balanced trees and comb-shaped trees , the most unbalanced trees. we are interested in trees with many taxa and in our results and figures we choose sufficiently many taxa to exhibit the asymptotic behavior. in order to simulate more realistic evolutionary scenarios, we also generated and analyzed  <dig> yule trees with  <dig> leaves.

reconstruction accuracies for equal-branch complete binary trees
let tn be the equal-branch complete binary tree of 2n leaves in which the substitution probability is p on each branch, and thus the conservation probability is q =  <dig> - p. since the subtree rooted at each child of the root r is the complete binary tree of 2n -  <dig> leaves, the recurrence system to calculate the reconstruction accuracy can be simplified . we simulated the obtained system by matlab and studied the asymptotic properties of ambiguous and unambiguous reconstruction accuracy by using all taxa as well as by using a root-to-leaf path. the results for n =  <dig>   <dig>   <dig> and  <dig> are plotted in figure  <dig> 

similar to the 2-state case in  <cit> , we observed that for n =  <dig>   <dig> and 20:  ua or aa on a root-to-leaf path is always less than or equal to aa on all the terminal taxa, and  ua or aa on a root-to-leaf path is greater than ua on all terminal taxa when q is small but becomes smaller than that when q is larger than a threshold. we conjecture that the two properties hold for arbitrary number of states.

it is shown in  <cit>  that for 2-state models, ua and aa diverge when q < <dig> and converge to  <dig> and  <dig>  respectively, when 18≤q≤ <dig>  as n tends towards infinity. surprisingly, we observed that the divergent interval vanishes for more than two states. in addition, in an interval  aa converges to 1n, the probability of randomly picking a state. a possible reason is that in the 2-state scenario, the node state changes alternatingly with the increase of the level in complete binary trees. as a result, both ua and aa are alternating and thus divergent. however, their even and odd series converge to different limits . for more-state models, the alternating property vanishes since there are more states to travel. if q is not very large, the probability for a node state to be one specific state becomes randomized as the level increases. consequently, both ua and aa are convergent and aa converges to 1n. clearly, b is a very important parameter. we listed in table  <dig> the estimated values of b for n =  <dig>  ...,  <dig>  table  <dig> shows that b decreases with the increase of n and it seems to converge to a number between  <dig>  and  <dig> . we offer the following explanation why more states make it easier for the fitch algorithm to be better than random: with increasing number of states and constant conservation probability it is less likely that there are independent mutations from the root state to the same non-root state. instead, it will happen more often that there are independent mutations from the root state to different non-root states. the latter situation makes it easier for the fitch algorithm to reconstruct the ancestral state correctly. for example, if the reconstructed state sets at the children of an interior vertex z are { <dig>  i} and { <dig>  j} , respectively, then the set reconstructed at z is { <dig>  i} if i = j and just {1} otherwise. it seems that this advantage of many states is stronger than the disadvantage of less frequent backwards mutations to the root state which are lucky for ancestral reconstruction.

in summary, when q ≤ b the performance of the fitch method is as poor as randomly picking a state. only when q > b, the fitch method could be used to reconstruct ancestral states and the performance improves quickly with the increase of q. as a conclusion, conservation probability is the most important factor to determine the performance of the fitch method. the method is reliable only when q is large, which indicates that the taxa are highly similar. however, as we know, when taxa are not similar, no reconstruction method performs good, so more effort should be made in developing a reliable method in this scenario. a suggestion for ancestral reconstruction is that, instead of treating all taxa as a whole, one first reconstructs subset of very similar taxa and make use of the reconstructed ancestral sequences to infer the ancestor of the whole taxa set.

reconstruction accuracies on comb-shaped trees
due to their extreme unbalanceness, comb-shaped trees  are widely studied. a comb-shaped tree is a rooted binary tree where every internal node is adjacent to at least one leaf node. we studied two comb-shaped trees as shown in figure  <dig>  the tree in figure  <dig> is called equal-branch comb-shaped tree, which assumes that substitution happens mostly at speciation events and thus each branch length can be considered as equal. the other tree is called hennigian comb-shaped tree, which assumes that substitution occurs continuously during the course of evolution. more precisely, we assume that all interior edges have the same length and all leaves are equally far away from the root.

equal-branch comb-shaped trees
in this tree, a descendant leaf x of the root is closer in evolutionary distance than other leaves. let the substitution probability of any kind along any branch be p. since the left subtree of the root is a branch and the right subtree is a repeat of the tree with one leaf less, the recurrence formula can be obtained by substituting aiz=ain,aiy=ain− <dig> for i= <dig> ⋯,2n− <dig> a1x= <dig> and ajx= <dig> for j ≠  <dig>  we simulated the obtained system by matlab and studied the asymptotic properties. the results for n =  <dig>   <dig>   <dig> and  <dig> are plotted in figure  <dig> 

an interesting observation is that, in contrast to complete binary trees, there is no interval of conservation probability such that aa converges to 1n for any equal-branch comb-shaped tree. a possible reason is that the leaves that are close to the root dominate the reconstruction accuracy and their distances to the root do not increase with time. in addition, the limiting aa using the nearest root-to-leaf path is always greater than that using all taxa if conservation probability is larger than 1n.

hennigian comb-shaped trees
clearly, complete binary tree and hennigian comb-shaped tree are the two kinds of extremal ultrametric trees. by comparing the reconstruction accuracies on both trees with those on real evolutionary trees, one can examine which extremal trees are more realistic. under the jukes-cantor model, for a hennigian comb tree in which each branch has its own length l, the substitution probability is p=1n−1ne−nλl, and the conservation probability is q=1−p=1n+n−1ne−nλl, where λ is the substitution rate. similarly, the recurrence system to calculate ua of the fitch algorithm along the hennigian tree can be derived from the general recurrence relations.

an observation from the recurrence system is that aa is always convergent to 1n. as an indication, the fitch algorithm is not suitable for ancestral reconstruction on evolutionary trees with shape similar to hennigian comb-shaped trees with many taxa. in addition, ua is convergent to nn−2∑i=lnnn−i!! . to illustrate the result, we also listed in table  <dig> the simulated convergent values of ua from the recurrence system for some numbers n between  <dig> and  <dig> 

reconstruction accuracies for yule trees with  <dig> leaves
as can be seen from figure  <dig>  the  <dig> randomly generated yule trees show the same qualitative behavior as the equal-branch complete binary tree with the same number of leaves. that is, there is an interval  of conservation probability q in which aa is almost equal to the probability of randomly picking a state, when q > b, the reconstruction accuracies are improved quickly with the increase of q. a possible explanation is that the number of taxa increases exponentially with the time, and correspondingly, very long edges are rare. another interesting observation is that sometimes the reconstruction accuracies on the yule trees are even higher than those of the complete binary tree. this contradicts the intuition that equal-branch complete binary trees always maximize the reconstruction accuracies and leaves an open problem which trees do so.

CONCLUSIONS
in this paper, we study the unambiguous and ambiguous reconstruction accuracy of the fitch method. we first present a general recurrence system as well as a program for calculating reconstruction accuracies on arbitrary trees. based on the system and program, we analyze  <dig> special trees under the jukes-cantor evolutionary model, namely equal-branch complete binary trees, equal-branch comb-shaped trees, and hennigian comb-shaped trees, as well as  <dig> randomly generated yule trees to simulate real evolutionary scenarios. from the analyses, we conclude that  for equal-branch complete binary trees, there always exists an interval  of conservation probability, in which the ambiguous reconstruction probability converges to 1n, the probability of randomly picking a state, when the conservation probability is greater than b, both reconstruction accuracies increase rapidly, the randomly generated yule trees also exhibit the same behavior,  for unbalanced trees like comb-shaped trees, the reconstruction accuracies using the nearest root-to-leaf path are always greater than or equal to those using all taxa. as a conclusion, more taxa are suggested for ancestral reconstruction when the tree topology is balanced and the sequences of taxa are highly similar, and a few taxa close to the root are recommended otherwise.

availability and requirements
the software as well as the source code in c++ to calculate the reconstruction accuracy of the fitch method on any tree with arbitrary states under the one parameter jukes-cantor model can be found in additional file  <dig>  the reader is referred to the "install.txt" and "help.txt" file for the installation and usage of the program, or alternatively run the bash file "accuracy.out" in a unix/linux system. the programs to draw the figures and tables are written in matlab, which can also be found in additional file  <dig>  so matlab should be installed to run these codes.

authors' contributions
sg and jy conceived the methods. jl and jy performed the experiments. jy prepared the manuscript. all authors contributed to the discussion and have approved the final manuscript.

supplementary material
additional file 1
the recurrence system for the reconstruction accuracy of the fitch method on n-state models. in this file, we provide the general recurrence system and initial conditions for calculating the reconstruction accuracy of the fitch method on n-state models.

click here for file

 additional file 2
the recurrence system of calculating reconstruction accuracies for the complete binary tree tn. in this file, we provide the recurrence system and initial conditions for calculating the reconstruction accuracy of the fitch method on the complete binary tree tn with 2n leaves.

click here for file

 additional file 3
a sketch of the proof for the formula of limiting ua on hennigian comb-shaped trees. in this file, we provide a sketch of the proof that the limiting ua on hennigian comb-shaped trees with n leaves is nn∑i=lnnn−in!!.

click here for file

 additional file 4
programs and source codes to calculate the reconstruction accuracy and draw figures and tables. in this file, we present the software as well as its source code in c++ to calculate the reconstruction accuracy of the fitch method on any tree with arbitrary states under the one parameter jukes-cantor model. the programs in matlab to draw the figures and tables for extremal trees are also provided.

click here for file

 acknowledgements
this work was partially supported by the natural science foundation of china .
