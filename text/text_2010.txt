BACKGROUND
bayesian statistics has gained popularity in scientific inference, especially in population genetics and genomics  <cit> . consider a model creating data d determined by parameters θ whose joint prior density is denoted by π . the quantity of interest is the posterior distribution of the parameters θ, which is given by bayes theorem as π ~fπ , where f is the likelihood of the data. unfortunately the evaluation of likelihoods is often difficult or even impossible for complex models. however, monte-carlo simulations can be used to approximate the likelihood function. for instance, a simple rejection algorithm has been proposed  <cit>  to estimate the likelihood: a candidate parameter vector θ is simulated from a prior distribution and accepted if the corresponding vector of summary statistics s is sufficiently "close" to the observed summary statistics sobs with respect to some metric in the space of s . the precision of the posterior estimate will improve with smaller values of ε, but small ε values are often associated with very small acceptance rates  and will thus require many more computations.

more recently, beaumont et al.  <cit>  introduced a simple post-sampling adjustment to improve the estimation of posteriors from the joint distribution of accepted parameter and summary statistics vectors. they introduced a locally-weighted linear regression of parameters on summary statistics around the observed summary statistics, which allows one to obtain good estimations with relatively large acceptance intervals. additional improvements have been proposed to more efficiently explore the parameter space, including several variations of likelihood-free mcmc  <cit>  or particle-based samplers  <cit> . all these methods are generally referred to as approximate bayesian computations  and reviewed in  <cit> .

here, we present abctoolbox, a series of computer programs that can be pipelined to estimate parameters of complex models. in complement to available abc packages  <cit> , abctoolbox incorporates several abc algorithms, handles various types of data by interacting with external simulation programs and includes tools to rigorously validate estimations, a necessary step of any bayesian inference. abctoolbox comes with a detailed manual introducing all implemented algorithms and giving hints on how to successfully apply abc inference. we demonstrate the usability of abctoolbox by inferring sex-specific migration rates and population sizes of the common vole microtus arvalis.

implementation
an abc estimation is typically done in two steps: a large number of simulations are first carried out  and then used to estimate posterior distributions . the package incorporates two main programs for these two steps : abcsampler generates the simulations and computes summary statistics via ancillary programs, and abcestimator calculates marginal posterior distributions of parameters from recorded simulations, with or without regression adjustment. both programs are implemented in c++ and can be fully parameterized via input files or the command line, which makes our package suitable for being used on computer grids or clusters. we will now outline the functionality of both programs in more detail.

abcsampler  samples model parameter values  calls an external simulation program,  calls an external program computing summary statistics on simulated data, and  writes parameter values and resulting summary statistics to a file. these four basic steps are then iterated many times until a large set of simulations is generated. the main parameters for abcsampler are the names of the simulation program and the program to compute summary statistics, and the abc sampler to be used. the sampling of parameter values can either be done using a rejection algorithm  <cit> , a likelihood free mcmc  <cit>  or a population monte carlo sampler  <cit> . we refer the reader to the original papers and to the abctoolbox user manual for details on the implemented algorithms. due to the fully object orientated implementation of abcsampler, it would be straightforward to include additional sampling algorithms such as likelihood free mcmc with state-space augmentation  <cit>  or to adopt a tempering scheme for the likelihood free mcmc  <cit> .

interaction of abcsampler with external programs is done via the command line or via input files, which allows one to use most of the many genetic data simulation programs available, such as simcoal <dig>  <cit> , splatche  <cit> , ms  <cit>  or fregene  <cit> . abcsampler is also fully flexible concerning the number of programs to be called per iteration, which allows one to generate different types of data for the same model parameters . for instance, dna sequences and microsatellites data with different ploidy levels can be generated by calling simcoal <dig> twice with different parameter files as input. abcsampler also offers the possibility to call any script or program to modify the output of the simulation program . this feature allows, for instance, to simulate observed patterns of missing data by simply removing simulated genotypes from the output of simcoal <dig>  abcsampler can also deal with linear combinations of summary statistics like partial least squares , where one computes a few orthogonal components in the summary statistics space best explaining the parameter variability  <cit> .

the program abcestimator directly reads the output of abcsampler and computes posterior distributions based on a fraction of the simulations closest to the observed data. the regression adjustment implemented in abcestimator follows a recent formulation termed abc-glm  <cit>  that differs from that proposed by beaumont et al.  <cit> , but it also leads to the marginal posterior distribution of each parameter. in addition, it computes the marginal density of a model, which naturally leads to the computation of bayes factors and performing bayesian model choice  <cit> . abcestimator further offers two ways to validate the estimation procedure. first, one can test the ability of abc to estimate parameters by analyzing a large number of simulated data sets with known parameter values drawn from the prior distributions   <cit> . based on such a test dataset, abcestimator computes accuracy measures, such as bias, mean squared errors and coverage properties  <cit> . secondly, abcestimator offers a new way to check if the observed data are in strong disagreement with the assumed model. the idea is to compute the distribution of the marginal densities for all simulations retained for posterior estimation. the marginal density of the observed data is then compared against this distribution to compute a p-value indicative of the ability of the model to reproduce the data.

abctoolbox is also bundled with several additional command line utilities: the command-line version of the program arlequin  <cit> , arlsumstat, to compute summary statistics, an additional program to compute simple summary statistics on microsatellite data , a program to linear-transform summary statistics , a program to simulate data from general linear models  and r scripts to estimate pls components and to visualize results. the functionalities and usage of abctoolbox are fully described in a user manual, which also includes a complete methodological references of all algorithms implemented in abctoolbox and many hints and suggestions on how to perform successful abc parameter estimations.

RESULTS
we demonstrate the use of abctoolbox by studying the history of the common vole microtus arvalis. this small rodent is probably the most abundant european mammal  <cit>  and it has become a model species to study recolonization processes in europe after the last ice age  <cit> . the common vole has generally very limited dispersal abilities  <cit> , and differences in migration patterns between males and females have been reported  <cit> . here we use  <dig> available population samples from the central  and eastern  m. arvalis evolutionary lineages to infer sex-specific migration rates and population sizes, along with key parameters of the demographic history of these lineages. all  <dig> sampled individuals  have been typed for  <dig> nuclear microsatellites and for  <dig> bp of the female transmitted mitochondrial dna  control region  <cit> .

assumed model of microtus arvalis evolution
following previous findings  <cit> , we assumed an evolutionary model , where the central and eastern mtdna lineages of m. arvalis diverged from a panmictic population tdiv generations ago. we describe here the model first for mtdna. each lineage is modeled as a large panmictic continent-island model where samples are taken from small islands. the effective size of the i-th island ni is assumed to be normally distributed with mean n and standard deviation σn. all remaining  populations are collectively represented by a large panmictic continent . as commonly assumed in continent-island models, migration is only allowed from the islands to the continent looking backward in time, and is constant over time and of rate nm for each island. under this model, sampled populations do not directly exchange genes, which implies that the most recent common ancestor of any pair of genes drawn from different populations is not found in any of the sampled populations. this seems a very reasonable assumptions given the huge number of m. arvalis populations.

we used simcoal <dig> to perform genetic simulations and arlsumstat to compute summary statistics. abcsampler called simcoal <dig> twice per iteration, once to simulate mtdna and once to simulate microsatellite data. the same parameter values were used for both calls, but all population sizes were scaled by  <dig> and all migration rates were calculated as  <dig> for microsatellites, where nmmales is independently drawn from prior distribution. this parameterization simply indicates that the number of mtdna genes is equal to the number of diploid females in the population and that mtdna gene flow only occurs through females. microsatellite diversity depends here on both male and female individuals, and we assumed that the number of autosomal genes is equal to two times the number of males and females in the population, the number of males potentially differing from that of females by a factor β. the prior distribution of mtdna mutation rate μdna was based on previous estimates  <cit> . locus-specific mutation rates for the microsatellites were assumed to be distributed as a gamma   <cit> , with α being considered as a nuisance parameter. all prior distributions are summarized in table  <dig>  note that parameters with prior distributions defined on a logarithmic scale were estimated on the same scale. note finally that we used an average of  <dig>  generations per year  <cit>  to translate divergence times into years.

athe posterior distributions of these parameters were estimated on a logarithmic scale. the reported posterior characteristics were then transformed onto the natural scale.

b whereas the prior of the divergence time tdiv is expressed in generations, its posterior is expressed here in years for convenience, assuming  <dig>  generations per year  <cit> 

c the highest posterior density interval hpdi is chosen as the continuous interval of parameter values with highest posterior density.

estimation procedure and validation
we computed a total of  <dig> summary statistics on the  <dig> populations and both mtdna and microsatellite datasets, which were then reduced to  <dig> pls components using specific r scripts of abctoolbox. using abcsampler, we ran a likelihood-free mcmc chain of  <dig> steps with tolerance δ =  <dig>  and proposal range ϕ =  <dig>  as defined in  <cit> . posterior distributions were generated with abcestimator under the abc-glm approach  <cit>  using the best  <dig> simulations. we validated the estimation procedure using abcestimator based on  <dig> datasets simulated with known parameter values generated with abcsampler. in this validation step, posterior distributions were generated based on  <dig> simulations performed under a standard rejection sampling  <cit> , as we could use the same set of  <dig> simulations to estimate parameters for all  <dig> datasets. we report in figure  <dig> the histograms of the posterior quantiles for each parameter, along with the p-value obtained by a kolmogorov-smirnov test of distribution uniformity  <cit> . we found none of these distributions to significantly differ from uniformity after correcting for multiple testing , which suggests that our posteriors have an adequate coverage. in order to check if the observed data are in agreement with the simulated model, we computed the distribution of the marginal densities for the  <dig> simulations retained for posterior estimation. the marginal density of the observed data was then compared against this distribution to compute a p-value . we found the observed values to fall nicely within the simulated data , which suggests that the assumed model is capable of reproducing the observed summary statistics .

microtus arvalis recent demographic history
we report in figure  <dig> posterior distributions of the parameters under the assumed evolutionary scenario described in figure  <dig>  properties of these posteriors are summarized in table  <dig>  in keeping with previous results  <cit> , we find that the number of male immigrants is ~ <dig> times larger than that of females. contrastingly female effective sizes are found four times larger than male effective sizes, which is in keeping with the large variance in reproductive success among m. arvalis males . note however, that local population sizes are found to be extremely small on average , but with a large standard deviation , which is in good agreement with field observations  <cit> . our results also support previous evidence  <cit>  for a divergence between the central and the eastern lineage around the time of the last glacial maximum in europe . the strong demographic differences between males and females inferred here suggest that an incomplete picture may arise when studying colonization processes or inferring demographic history based on mtdna alone.

CONCLUSIONS
abctoolbox allows a user to perform all the necessary steps of a full abc analysis, like parameter sampling from prior distributions, data simulations, computation of summary statistics, estimation of posterior distributions, model choice, validation of the estimation procedure, and visualization of the results. it includes various abc algorithms, several of which are not found in any other available software package so far , and the future addition of new algorithms is straightforward due to abctoolbox's object-oriented design. in combination with simcoal <dig>  <cit> , abctoolbox is more flexible than available programs to perform abc estimation of demographic parameters from genetic data  <cit>  in that it allows  the simultaneous use of several data types , each with potentially different ploidy levels and modes of transmission  the inference of parameters under complex demographic scenarios including any combination of admixture, divergence and migration between an arbitrary number of populations with dynamic size changes, and  the incorporation of additional features of the data, such as varying levels of missing data or population-specific inbreeding levels. however, abctoolbox is not tied to simcoal <dig> and may equally well be used with other genetic simulation programs, like ms  <cit> , splatche  <cit>  or fregene  <cit> . it can thus allow parameter inference under spatially explicit models or models with natural selection. in fact, abctoolbox can interact with virtually any command-line simulation software and is capable of using several simulation programs per iteration, which could allow for instance the simultaneous analysis of different data sets or different types of data. the additional ability to use linear combinations of summary statistics best explaining parameter variability is also of interest when a prior selection of the most informative statistics is difficult.

the flexibility of abctoolbox has a cost in performance. indeed, for each simulation, external programs may need to be launched, and communication between programs is mediated by text files, which is not optimal, and therefore simple models may be more quickly analyzed with canned abc sampling software . however, this disadvantage may become negligible when considering the possibility of distributing simulations over the nodes of a cluster, or when simulation time of large data sets under complex models are much more costly than communication between subprograms. in any case, the overall speed of the computations primarily depends on the speed of the genetic simulations program. in this respect, we have used here simcoal <dig> for its flexibility and ease of parameterization rather than for its speed, and the use of continuous-time coalescent simulations  should lead to much faster inferences.

availability and requirements
project name: abctoolbox

project home page: http://www.cmpg.iee.unibe.ch/

operating system: platform independent with supported linux and windows binaries

other requirements: windows users need to install the cygwin linux-like environment for windows, available on http://www.cygwin.com.

programming language: c++ and r

license: gnu gpl version  <dig> or later

authors' contributions
dw, sn and le designed and implemented abcsampler. dw and cl designed and implemented abcestimator. dw implemented all other programs and scripts. dw and le performed the analysis and wrote the paper. all authors have read and approved the final manuscript.

