BACKGROUND
label-free proteomics
in a standard “bottom-up” proteomics experiment, proteins are first digested into peptides by a proteolytic enzyme. peptides in this mixture are then physically separated by chromatography, often liquid chromatography . eluting peptides are converted to gas phase ions, which are separated in a mass spectrometer  by mass-to-charge ratio, and the relative abundance of each ion is measured by a detector. lc-ms experiments utilize a single mass analyzer, resulting in a retention time, mass-to-charge ratio, and intensity for each analyte. in lc, tandem ms experiments, or lc-ms/ms, select precursor ions are further fragmented into product ions, resulting in an additional level of information for each peptide ion. the product ions are analyzed to determine a peptide sequence, which is used to identify the parent protein. a recent variation of lc-ms/ms - data independent acquisition  - generates product ions for virtually every precursor ion, providing tremendous utility for quantification and identification in a single data set. examples of dia include swath  <cit>  and mse <cit> . in mse, precursor ions enter a collision cell, rapidly alternating between high and low kinetic energy states. this “high-low switching” fragmentation enables the measurement of both precursor and product ions in a single experiment. an even more recent dia approach to bottom-up proteomics experiments - hdmse – incorporates ion mobility  spectrometry, an additional separation of peptide ions after lc, and before mse. im spectrometry separates ionized peptides based on charge and three-dimensional cross-sectional area.

label-free proteomics data processing
several data processing steps are required to elucidate individual peptide intensities from raw label-free proteomics data. a typical data processing pipeline for a label-free proteomics experiment with multiple samples is illustrated in figure  <dig>  peptide peaks must be discerned from noise, charge states determined, and isotopic distributions identified and often combined into peptide features. further details regarding current peak detection, de-isotoping, and charge state detection methods are described in dowsey et al.  <cit>  and zhang et al.  <cit> . the lc retention times and elution order of peptides often shift between runs. such variations in retention time are typically called warp. the process of correcting these distortions to allow accurate matching across runs is called de-warping. many de-warping methods exist, performing linear or non-linear  corrections of two or more samples  <cit> . this de-warping step is either performed on raw profile data , or on feature data . after generation of a peptide feature set, peptide identifications are made wherever possible, and intensity measurements of both identified and unidentified peptides are grouped across runs, creating a peptide-by-sample intensity array for subsequent analyses. it should be noted that the order of data processing steps may vary within different pipelines. these data processing steps pose significant computational challenges, and are thought to be the source of much irreproducibility. this was illustrated by a recent test study by bell et al.  <cit> . in the study, a sample of  <dig> proteins was distributed to  <dig> different labs, experimentally analyzed, and subjected to a variety of computationsl data-processing methods. there were significant discrepancies in reported proteins, however, all raw data was sufficient to identify all  <dig> proteins when centrally re-processed.

label-free proteomics data alignment
we focus on the problems of simple data de-warping, and matching peptide intensities across multiple high-throughput proteomics runs - a combined processing step we call alignment. our analysis emphasizes the data matching step. accurate alignment is essential in large-scale proteomics experiments, particularly in biomarker discovery where the comparative nature of these studies require intensities of the same peptide to be compared across samples  <cit> . in addition, accurate matching across samples can increase identifications as information can be leveraged from all individual runs  <cit> . the complexity of biological samples, however, poses significant computational challenges for both data alignment and peptide identification. most samples contain tens of thousands of peptides and measurements often reflect “overlapping” peptides, or co-eluting peptides having nearly the same mass-to-charge ratio. these overlapping peptides complicate and often prevent identification. however, recent experimental advancements provide additional separation information that has not yet been leveraged in data alignment - namely comprehensive product ion information with dia, and im drift times with hdmse. product ions have been used extensively in database matching for peptide identification  <cit> , but are not widely used in proteomics data alignment. matching across samples is typically performed using experimentally measured and inferred characteristics of each peptide feature. measured characteristics include precursor ion retention time, mass-to-charge ratio, and intensity. depending on the experimental methods, some or all peptide features may have additional measured characteristics including the intensities, mass-to-charge ratios, and retention times of product ions. in dia experiments, virtually every peptide feature has measured product ion data. in hdmse experiments, all precursor and product ions have a measured im drift time as well. inferred characteristics include charge state for nearly every peptide feature, and an amino acid sequence for some peptide features. modern high-throughput proteomics experiments offer a great deal of information, not all of which is currently utilized in data processing - specifically in data alignment steps.

previous alignment approaches
matching methods utilize various aspects of the data to group peptide measurements across samples. previously utilized characteristics include retention time, mass-to-charge ratio, intensity, and amino acid sequence. incorporating additional data provides a higher degree of specificity when making matches  <cit> . the majority of existing alignment techniques utilize mass-to-charge ratio and retention time information. such methods include specarray  <cit> , amt tag approaches  <cit> , xalign  <cit> , mzmine  <cit> , msinspect  <cit> , xcms  <cit> , petal  <cit> , openms  <cit> , aplcms  <cit> , and mzmine <dig>  <cit> . semi-supervised approaches such as pepper  <cit>  and a method by fischer et al.  <cit> , take advantage of existing ms/ms peptide identifications. more recent alignment methods by tang et al.  <cit>  and zhang et al.  <cit>  utilize peptide intensity along with mass-to-charge ratio and retention time. superhirn  <cit>  indirectly incorporates intensity information during multiple alignments by performing pairwise alignments in a specific order based on lc-ms similarity and intensity correlations.

in addition to utilizing novel data characteristics, our method is designed to avoid common pitfalls of other approaches including static distance cutoffs, elution order assumptions, and the selection of a single reference sample. methods should not rely on the fact that peptides always elute in the same order from the lc column as this is a false assumption and can introduce matching errors  <cit> . multiple alignment methods often require a reference run to which all other runs are aligned. while this approach is successful for the de-warping step, choosing a single reference run for the matching step can be problematic. if the measurement variability is high in the reference sample, this can result in incorrect matches. we present a novel statistical alignment method that corrects for linear global variation, is not restricted by static distance cutoffs, and has the ability to utilize retention time, mass-to-charge ratio, peptide identifications, and previously ignored aspects of proteomics data - ion mobility drift times, and product ion data. our method is an adapted bayesian dirichlet process gaussian mixture model   <cit> , adding sample-specific shift and scale parameters. the proposed method is also easily extensible to incorporate additional dimensions, such as a second lc separation. we present the results of our alignment model on various datasets, comparing alignment accuracies with the inclusion of various data characteristics.

RESULTS
e. coli lysate data
to assess both the performance of our alignment method, and the utility of various data characteristics, we aligned technical replicates of e. coli lysate data. three technical replicates of 500ng of e. coli lysate were analyzed with waters mse and hdmse. the mse data was used to compare our alignment method with pepper  <cit> , and the feature matching functionality of openms  <cit> . the pepper peakmatch module was downloaded from genepattern  <cit>  and run locally using default parameter settings. similarly, the mapalignerposeclustering, and featurelinkerunlabeled functions of openms version  <dig> . <dig> were run using default parameter settings to align peptide features of mse data. the hdmse data was used to compare the results of our alignment method when utilizing various data characteristics. table  <dig> shows the four different combinations of data characteristics utilized for alignment. we assess alignment performance using held-out peptide identifications resulting from product ion spectra.

the alignment type names and data utilized that were compared in the analysis.

the msee. coli lysate data was aligned using pepper, openms, and our alignment method, utilizing precursor ion mass-to-charge ratio and retention time . each alignment method was provided with the same  <dig> “given matches” to initialize model hyperparameters – the  <dig> identifications shared by all three replicates having the highest average proteinlynx global server  identitye <cit>  peptide score. when assessing alignment performance, we examine matches between each replicate pair – id <dig> vs. id <dig>  id <dig> vs. id <dig>  and id <dig> vs. id <dig>  correct matches occur when two identified peptides shared between the pair of technical replicates are aligned. mismatches occur when two identified peptides with conflicting identifications are aligned. since pepper allows multiple peptides from a single sample to be present in a “cluster”, there may be more than one identification from a single replicate. in these cases, we counted a correct match if shared identifications were present in the same cluster. similarly, we counted a mismatch if conflicting identifications were present in the same cluster. as there are varying levels of confidence in peptide identifications, we present the results of each alignment method considering identifications having a plgs identitye <cit>  peptide score of five, six, and seven or greater. panels a and b of figure  <dig> show the recall rate and the mismatch rates, respectively, for each alignment method. as pepper does not directly report match confidence, recall and mismatch rates were computed from all reported matches for each method. we see that our alignment method obtains significantly higher recall rates than openms featurelinker and pepper, for identified peptides of each confidence level. when comparing the mismatch rates, computed as the number of mismatches divided by the total matches, we see that our method obtains mismatch rates comparable with openms, while pepper obtains significantly higher mismatch rates, particularly at lower peptide scores. it should be noted that this mismatch rate is not a false positive rate. the total match count includes many matches which cannot be identified as correct or incorrect, as neither peptide has a putative peptide sequence. when examining the total match counts in panel c of figure  <dig>  we see that our method obtains match counts comparable to pepper, and significantly more matches than openms.

the hdmsee. coli lysate data was aligned using different data characteristics to compare their utility for alignment. as with the mse data, each alignment was provided with the same  <dig> “given matches” to initialize model hyperparameters and the remaining identifications were used to assess alignment performance. we present the results of each alignment only considering identifications having a plgs identitye <cit>  peptide score of five or greater. results at additional peptide score thresholds are provided in additional file  <dig>  comparing the hdmse alignments with various data combinations informs about the utility of each dimension in data alignment. we examine matches between each replicate pair – id <dig> vs. id <dig>  id <dig> vs. id <dig>  and id <dig> vs. id <dig>  a match across two samples occurs when a measured peptide feature from each sample is assigned to the same latent peptide feature. panels a and b of figure  <dig> show the recall rate and the rate and number of mismatches, respectively, for each of the four alignments. we performed a series of two-sample t-tests assuming equal variance for the recall rates and mismatches to assess differences between alignments. when examining the results of the two-dimensional parent ion alignments, mz-rt and mz-im, we see that the mz-rt alignment obtains significantly higher recall rates for matches of all confidence levels. utilizing all parent ion data characteristics obtained via hdmse with a three-dimensional alignment  results in significantly higher recall rates than the two-dimensional alignments, with a small increase in mismatches from the mz-rt alignment, and a significant increase in mismatches from the mz-im alignment. when including product ion profiles, we see significant increases in recall rates, particularly with more confident matches. we see an insignificant increase in mismatches from the mz-rt and mz-rt-im alignments. the alignment including product ion profiles results in much more confident matches overall. it should be noted that the results presented for the e. coli lysate analysis assume that all peptide identifications having an identitye <cit>  peptide score  <dig> or greater are correct. we also assume that a match of two peptides differing only by a leucine vs. isoleucine amino acid call or by amino acid order in the peptide sequences, still represents an mismatch. the resulting p-values across the range of match probability stringencies are available in additional file  <dig>  we also examined the match probabilities of all shared identifications – the peptides that should be matched - between the replicates, for each of the four alignments. histograms of the match probabilities are shown in panel c of figure  <dig>  we see many more confident match probabilities  of the shared identifications for the mz-rt-im when comparing to both two-dimensional alignments. when including product ion profiles with the mz-rt-im-he alignment, we also see an increase in confident match probabilities, with a migration of all intermediate match probabilities to near-zero.

human with e. coli lysate decoy
in order to assess alignment performance without experimental identification bias, we aligned technical replicates of e. coli lysate data with a human plasma decoy, and technical replicates of human plasma with an e. coli lysate decoy. one technical replicate of the e. coli lysate sample was aligned with another e. coli lysate technical replicate combined in silico with a decoy human plasma sample. to combine the samples, we append the human plasma peak list onto the peak list of one of the e. coli replicates. the human plasma was a pooled sample from  <dig> individuals, run with  <dig> technical replicates. similarly, one replicate of the human plasma was aligned with another plasma technical replicate combined with an e. coli lysate sample. as with the e. coli lysate data, we performed the four different alignments described in table  <dig>  each alignment was provided with the same  <dig> “given matches” – the  <dig> identifications shared by the technical replicates, and having the highest average plgs identitye <cit>  peptide score. to assess alignment performance, we determine the proportion of incorrect species alignments. this provides a false discovery rate that avoids experimental identification bias - assuming the set of shared peptides across species is negligible  <cit> . figure  <dig>  panel d shows the correct and incorrect species match counts for each of the four alignments. we see that the mz-rt-im and mz-im alignments yield similar results, while the mz-rt alignment obtains fewer incorrect species matches, but fewer matches overall. the mz-rt-im-he alignment obtains the least incorrect species matches, and many more correct species matches at reasonably confident match levels. the results of the inverse decoy analysis  are available in additional file 1: figure s <dig> 

hepatitis-c and osteoarthritis data
to illustrate the utility of aligning datasets obtained from two different tissues, we aligned mse serum samples of hepatitis-c patients with mse human urine samples from an osteoarthritis cohort using peptide ion mass-to-charge ratio and retention time. peptide identifications from the urine samples were carried over to the serum via alignment. we examined the  <dig> peptides having the most significant differential expression with a phenotype of interest – hepatitis-c treatment response. significance was assessed with two-sample t-tests assuming equal variance, on peptide intensities that were log-transformed, mean-centered by sample, and standardized by peptide. we explored the inferred identifications that were carried over via alignment from urine, in order to identify potential biomarkers. specifically, we looked at the previously unidentified peptides exhibiting significant differential expression having an inferred identification from the alignment results. we analyzed these inferred identifications using gather  <cit>  and david  <cit>  to search for functional and pathway enrichment. the lists of proteins from these inferred identifications and their gather and david analysis results are available in the additional file  <dig>  the inferred identifications of peptides exhibiting differential expression for hepatitis-c treatment response totaled  <dig> corresponding proteins. these proteins were significantly enriched for defense response , immune response , and response to biotic stimulus , having gather p-values  <dig> e- <dig>   <dig> e- <dig>  and  <dig> e- <dig>  respectively. these functional annotations are very much in accordance with what one would expect with a response to viral infection, suggesting that useful identifications were obtained with the alignment. in addition, the genes encoding  <dig> of these proteins were located at 14q <dig>  indicating significant chromosome location enrichment with gather p-value  <dig> e- <dig>  this is the location of the immunoglobulin heavy locus – a region containing genes encoding the heavy chains of antibodies. differential expression of genes in this region is also in accordance with what one would expect for hcv treatment response.

discussion
we have developed a novel method for label-free proteomics data alignment that incorporates aspects of the data ignored by other open-source data alignment methods. our alignment method incorporates ion mobility separation data and ms/ms product ion data. our results suggest that the inclusion of more data characteristics increases alignment sensitivity, and increases matching robustness.

when comparing to openms, our method obtains significantly higher recall rates, as well as more overall matches. this is likely due to the density of the data we use for comparison, and the matching technique of openms. after the de-warping step, openms makes pairwise matches between samples, or “maps”, if the putative match is the nearest neighbor and the distance to the second-nearest neighbor is significantly greater. this results in low false positive rates, as seen in panel b of figure  <dig>  however, in dense datasets this appears to result in lower recall rates as many true matches are not considered. in panel c of figure  <dig>  we also observe that for openms, one pairwise combination of technical replicates shows significantly more matches than the other pairwise combinations. this may be the result of selecting a single reference sample to which all other samples are aligned. openms first selects the sample with the most features as the reference. each remaining sample is then aligned to the reference, estimating a “consensus” with each pairwise alignment. the density and number of features within the consensus increases with each pairwise alignment, resulting in fewer matches meeting the nearest-neighbor criteria at each step. it should be noted that we only evaluated the peptide feature-based functionality of openms as a comparison to our feature-based alignment method. the ability to work with raw data, alignment specificity and ease-of-use of openms are advantageous for many applications.

our alignment model before the addition of the product ion component is very similar to pepper  <cit>  – both methods are built on the principles of gaussian mixture models. our results in the mse comparison  reflect the similarity of our approaches. the three main differences between pepper and our mz-rt method are the technique for inferring the number of mixture components, pepper’s splitting of the data by charge state, and our constraint allowing only one measured peptide per sample in a given mixture component. we chose to ignore charge state information to avoid propagation of errors from earlier data-processing steps, although alignments can easily be stratified by charge state with our method.

in our decoy experiment, we observed that the addition of product ion data results in a dramatic decrease in false matches, this is likely due to the lack of confounding product ion assignments to precursor ions as the decoy data is a separate experiment. however, if one were utilizing product ion data to align measurements to an amt tag-like database, we would expect a comparable situation. these results also speak to the importance of accurate product ion to precursor ion assignment in dia – if peptides were well separated experimentally and accurate product ion assignments were made, alignment accuracy would increase dramatically.

aligning data from different experiments can actually yield additional identifications, as illustrated by the alignment of human urine data to human serum. due to the diverse protein composition of different types of samples, specific peptides may be identified more easily in certain types of samples. it is worth noting that this behavior is much like spectral library searching  <cit> , because surrounding peptides will not confound the product ion assignments to precursor ions. we show that the alignment of data from different tissues  has utility for inferring peptide identifications. if this were extended to a database and data from many tissues were used to update the database, it could have a comprehensive identification set of measured peptides, and be utilized as an additional resource or replacement for de novo identification. this is particularly useful in biomarker analyses when performing a label free experiment for an initial analysis, and then identifying proteins of interest for a subsequent targeted analysis. also, the addition of product ion data will provide more confident alignments, and thus more confidence in identifications that may be carried over.

although we argue that the incorporation of product ion data can result in more matches of increased confidence, it should be noted that the method in which these data are incorporated has importance. if the presence of additional product ions, or the lack of product ions is highly penalized, alignments are likely to obtain fewer matches due to the variability in measurement of product ions. conversely, if differences in product ions are not penalized enough, alignments are likely to obtain more matches, and more mismatches – particularly because nearby peptides with respect to mass-to-charge ratio, retention time and drift time, will be those with incorrect, but similar product ion profiles. when incorporating product ion data, researchers should consider the penalization of extra and missing product ions within the data being aligned. we found that similarity functions based on sums rather than products worked well, specifically, the sum of squared differences. our exploration of other product ion profile similarity functions is described in additional file  <dig> 

CONCLUSIONS
we have developed a flexible alignment method that effectively incorporates two data characteristics novel to open-source peptide feature matching. our method provides accurate and robust matches between samples or datasets with measures of confidence. we also show that peptide feature alignment of disparate data sets has utility in biomarker analyses, as the ability to identify certain proteins may vary by tissue. the results presented here provide motivation for further exploration of incorporating additional separation information into proteomics data processing, particularly as experimental advancements are made in the field.

