BACKGROUND
advances in high-throughput sequencing and computational power have enabled phylogenetic analyses on an unprecedented scale  <cit> . large-scale phylogenetic studies of gene families can be used to clarify the relationships among organisms  <cit>  or to study the evolution and function of the genes themselves  <cit> . such analyses are frequently restricted to only those genes for which a full-length sequence is available, because partial sampling of a gene family may diminish the accuracy of downstream applications such as orthology assignment  <cit>  and gene-tree reconciliation  <cit> . thus, it would be desirable for many applications to sample additional gene family members from the much larger number of partial gene sequences that are available.

partial gene sequences are primarily derived from expressed sequence tags   <cit> . ests are generated by isolating bulk mrna from a given tissue, reverse-transcribing the mrnas into cdnas, cloning the cdnas into a vector, and then sequencing many individual clones from one or both ends using universal primers. because overlapping segments of the same gene may be sequenced multiple times, it is customary to assemble overlapping ests into a single consensus unigene. since even unigenes rarely cover the full-length of their corresponding transcript sequences, multiple sequence alignments derived from est unigenes are often gappy. the gaps tend to be clustered at the beginning and/or the end of each unigene sequence, and the positions that are missing often overlap but do not exactly correspond between unigenes . typically, an alignment that contains est unigenes will also contain at least some genes that are full-length: either because a complete genome sequence is available for the species, because the cdna for that particular gene has been sequenced, or, more rarely, because the entire gene is spanned by the unigene. we also note that other high-throughput sequencing techniques  <cit>  can lead to similar patterns of gappiness and may eventually contribute a large proportion of the partial gene sequences in public databases.

gappy alignments present a number of difficulties for phylogenetic analysis. first, phylogenetic inference is statistically compromised by a lack of data. second, different regions in an alignment do not necessarily have the same intrinsic substitution rate due to differences in the strength of purifying and positive selection. this may introduce bias if these different regions are more complete in some sequences than in others. one may overestimate the phylogenetic distance between two sequences that overlap in a fast-evolving portion of the alignment and underestimate the phylogenetic distance between two sequences that overlap in only the slowly-evolving regions. finally, for phylogenetic methods that utilize a pairwise distance matrix, it may not even be possible to compute all pairwise distances due a lack of overlap between some pairs of sequences.

the debate about how to deal with missing data in phylogenetic analysis  is not new  <cit> . a number of these studies have focused on incomplete gene sampling when evaluating a superalignment approach to an incomplete multigene dataset  <cit> . the general conclusions have been that the relative amount of missing data is not the most important factor in determining whether a correct phylogeny can be computed. instead, the absolute amount of available, informative data within an alignment is more important. accurate phylogenies can be obtained even if up to half the sequences within an alignment contain up to 90% missing data  <cit> . however, the pattern of gappiness seen in a superalignment , where some genes are missing from some taxa, differs from the pattern of gappiness due to partial gene sequences. in the former case, the boundaries of the missing data blocks strictly coincide among subsets of the sequences in a superalignment, while in the latter case the gaps are staggered . to our knowledge, it has not yet been determined whether the patterns of missing data in concatenated alignments and within est-like alignments have comparable effects.

here, we use simulated data to specifically examine the effects of est-like gappiness on phylogenetic accuracy. our analyses are based on correct alignments, while in real life situations, correct alignments are often unknown and hard to compute, especially in regions that contain gaps. our alignments therefore represent the "ideal cases" of true alignments. using these simulated data, we explore the contribution of a variety of factors by comparing alignments that differ with respect to number of sequences, tree topology, alignment length, and gap pattern. we have found that est-like gappiness results in lower accuracy than the pattern of missing data obtained with incomplete gene sampling in a superalignment, even in the absence of alignment error. to address this problem, we have compared two methods designed to increase the accuracy of phylogenetic inference from a gappy alignment: alignment masking and alignment subdivision. in alignment masking, certain alignment columns and input sequences are excluded from phylogenetic analysis. in real data, alignment masking may also be used to ensure the positional homology of the columns that remain, to eliminate positions that appear to have undergone multiple substitutions, and to exclude systematically misaligned sequences in an automated alignment workflow. although alignment masking is most often based on subjective criteria, systematic approaches have also been developed  <cit> . because masking comes at the necessary expense of failing to include some fraction of the input sequences, we have also explored an alignment subdivision approach in which the data are partitioned into subalignments with minimal gaps. the phylogenetic tree is computed from a combined distance matrix estimated by weighting the data from each subalignment and imputing missing data. we have found that both approaches can improve the accuracy of phylogenies computed from gappy alignments.

RESULTS
in order to measure phylogenetic accuracy, we used a set of simulated gappy protein alignments that resemble those derived from est data . briefly,  <dig> full-length protein sequence families varying with respect to their lengths, number of sequences, substitution rate, and tree topology were generated by the rose software package  <cit> , and the true multiple sequence alignments and phylogenetic topologies were recorded. to simulate patterns of missing data comparable to those obtained with est unigenes, ten gap patterns were then chosen based on protein sequence alignments in the phytome plant comparative genomics database  <cit>  and applied to each of the full simulated alignments. in order to separate the effects of est-like gappiness from the effects of missing data per se, we generated two types of control alignments. for these, the same amount data were removed as for the est-like gappy alignments, but the residues to be deleted were either concentrated within alignment columns or randomly distributed throughout the alignment .

alignments with no missing data
we first tested whether the  <dig> full simulated alignments contained sufficient phylogenetic signal to recover the true trees using neighbor-joining , maximum parsimony , and maximum likelihood . all comparisons of true trees with estimated trees are given as standardized quartet distances stqd, which is a measure of how many quartets, or sets of four sequences, differ in topology between two phylogenies  <cit> . our stqd thus ranges from zero  to one . results are shown in figure 2a. the standardized quartet distances for mp had a median of  <dig> and a mean of  <dig>  . for nj, stqd had a median of  <dig> and a mean of  <dig> . for ml, stqd had a median of  <dig> and a mean of  <dig> . taken together, these results confirm that the data in the full simulated alignments are sufficient to allow recovery of very nearly true trees, most of the time, using all three phylogenetic inference approaches.

alignments with missing data
we then evaluated the extent to which missing data within these alignments compromise phylogenetic accuracy, and the effect of est-like gappiness relative to other patterns of missing data. nj, mp, and ml phylogenies were computed for the  <dig> est-like alignments, the  <dig> column-deleted alignments, and the  <dig> random-deleted alignments . the stqd values for the est-like gappy alignments were substantially higher than for the full alignments, with a median approaching  <dig>  in the case of mp. the median stqd for the column-deleted alignments was zero or very close to zero, although the missing columns did lead to some lengthening of the upper tail of the distribution of stqd values. the difference in phylogenetic accuracy was less pronounced between est-like and random-deleted alignments, and the rank order of performance among nj, mp, and ml was similar between these treatments. the maximum stqd for mp in the random-deleted alignments was  <dig> , meaning that no quartets in the true tree were accurately inferred.

overall, ml had the highest accuracy and the least sensitivity to missing data. however, the performance of the different algorithms depended to some extent on the nature of the alignments used. in particular, the gap pattern had a major effect on the relative performance of the different phylogenetic methods. for ≈ <dig> % of the est-like alignments, nj resulted in the most accurate phylogeny. of these, approximately 80% were generated using gap patterns  <dig>   <dig>  or  <dig>  of the ≈37% est-like alignments for which nj resulted in the most inaccurate trees, 25% each were generated using gap patterns  <dig> and  <dig>  for approximately ≈ <dig> % of the est-like alignments, mp yielded the best tree. of these, 90% were the shortest alignments , 82% were the alignments with only  <dig> sequences, and approximately 75% were generated using gap patterns  <dig>   <dig>  or  <dig> 

alignment masking
one common approach to preprocessing a gappy alignment prior to phylogenetic inference is to mask the alignment such that only columns and sequences containing sufficient and reliable phylogenetic information are included. here, we used a simple algorithm we have named reap   <cit> , which is designed to mask  columns containing many gaps and/or highly diverse amino acids and  sequences that either have little overlap with other sequences or appear to be systematically misaligned. in our simulated sequence families, since there are no actual alignment errors in the simulated dataset, reap is discarding true phylogenetic information in the data.

to determine the appropriate masking parameters to use in this study, we conducted a factorial experiment in which  <dig> parameter combinations were tested . we recorded the number of sequences retained after masking, and the stqd of the nj tree. because of the prohibitive amount of time that would have been required, mp and ml trees were not calculated. we analyzed the  <dig>  of the alignments for which phylogenies could be computed for all  <dig> parameter combinations . evaluation of the computed phylogenies showed that the exclusion of sequences with varying proportions of gaps had much larger effects on phylogenetic accuracy than the exclusion of gappy columns. analysis of variance demonstrated that all parameters had significant main effects, and a variety of higher-level interactions were significant . the parameter with the largest marginal effect on both accuracy and retention was gs, the maximum proportion of gaps allowed in a sequence. overall, we found a clear trade-off between the accuracy of the phylogeny obtained and the proportion of sequences eliminated from the alignment . parameter settings of sc =  <dig> , gc =  <dig>  gs =  <dig>   were determined to strike the best compromise between topological accuracy and sequence retention, regardless of window size. thus, unless otherwise noted, we used these parameters with a window size of six for subsequent analyses.

using the selected parameters, we applied reap to all three sets of gappy alignments  and then computed phylogenies using nj, mp, and ml . quartets involving sequences that were not retained by reap did not contribute to the calculation of stqd. for est-like alignments, masking greatly improved accuracy for all three phylogenetic methods. the greatest improvements were obtained using nj and ml . mp trees improved less dramatically . results were qualitatively similar for random-deleted alignments. by contrast, masking of column-deleted alignments led to less accurate trees using all three phylogenetic methods. for nj and ml, the masked column-deleted alignments resulted in less accurate trees, on average, than the masked est-like alignments. this may be due to the nearly complete retention of sequences in the masked column-deleted alignments compared to approximately 80% retention in the masked est-like alignments . as can also be seen in figure 2b, levels of retention were similar for est-like and random-deleted alignments.

to determine which factor in the simulated alignments  most affected phylogenetic accuracy, we performed analysis of variance on stqd of the nj, mp, and ml trees after alignment masking . this analysis showed that overall, no single parameter predominantly influenced the stqd values. instead, all parameters had significant main effects. furthermore, several two-way and three-way interactions were significant, as was the four-way interaction of number of sequences, tree topology, alignment length, and gap pattern.

p ≤  <dig> ***, p ≤  <dig> **, p ≤  <dig> *; parameters: length = alignment length; rate = evolutionary rate; seqs = number of sequences in the alignment; topol = tree topology of true tree; gap = gap pattern applied to full alignment. siaa refers to the full sia trees, while siab refers to the pruned sia trees.

statistically correcting for missing data
in contrast to the approach of alignment masking, in which data are excluded from the analysis, it might be possible to improve phylogenetic accuracy by statistically modeling the missing data. the approach we examined in this study is called "sia", for subdividing incomplete alignments  and is illustrated in figure  <dig> . sia attempts to estimate the distance matrix that would be obtained in the absence of missing data, thereby improving phylogenetic accuracy  without sacrificing sequence retention. in brief, the full multiple sequence alignment is partitioned into subalignments that have little to no missing data, and a distance matrix is computed for each subalignment. a phylogenetic tree is then computed from a combined distance matrix estimated by weighting the distance data from each subalignment and imputing missing data.

in our implementation of sia, est-like alignments yielded an average of four subalignments , with a mean subalignment length of  <dig>  columns. column-deleted alignments predictably yielded only one subalignment, while the random-deleted alignments yielded a prohibitively large number of potential subalignments  and thus could not be analyzed for comparison. nj phylogenies could be computed for  <dig>  of the est-like families. of the  <dig> families that were discarded,  <dig> with gap pattern  <dig> and two with gap pattern  <dig> had too many missing pairwise distances to impute values using the four-point metric . the remaining  <dig> families were discarded by reap due to insufficient alignment data.

the median percentage of sequences retained within a family was 100%, while the median stqd was  <dig>  . thus, the phylogenetic accuracy obtained by sia is comparable to that obtained by masking followed by mp, but with substantially higher retention of sequences. since the sia trees include more sequences than the masked trees, and the additional sequences might be among the most problematic to place accurately in the tree due to their reduced length, a fairer comparison would be to compute stqd for a pruned sia tree having the same set of sequences as the masked tree. pruned sia trees had a median stqd of  <dig> , which, though better than unpruned sia trees, is still less accurate on average than obtained by masking followed by nj or ml. to determine which  parameters used to generate the alignments significantly affected the phylogenetic accuracy, we performed anova on stqd for both full and pruned sia trees. the results generally agreed with those from alignment masking: all simulation parameters had significant main effects and contributed to higher-level interactions .

algorithm performance relative to simulation parameters
for a more detailed comparison of results for the sia approach and alignment masking followed by either nj, mp, or ml, we compared stqd among the  <dig>  families for which we were able to compute phylogenies for all four methods. we also examined variation in stqd among the ten gap patterns. we found that alignment masking, when followed by either nj or ml, resulted in the most accurate phylogeny in ≈72% of cases , and that alignments with  <dig> sequences were over-represented in this set. alignment masking followed by mp resulted in the best trees for ≈9% of the families. of these, almost 70% were alignments of length  <dig>  nearly 70% contained  <dig> sequences, and approximately 60% had gap patterns  <dig> or  <dig> applied to them. in only ≈7% of the families, the sia approach resulted in the most accurate phylogeny. of these, 80% were the shorter alignments, 70% were those to which gap pattern  <dig> had been applied, and 64% had only  <dig> sequences. in approximately 20% of all families, no difference was observed across any of the methods. these were in most cases perfect phylogenies . all of these were alignments of  <dig> sequences, and masks  <dig> and  <dig> were overrepresented among them .

discussion
ests and other partial gene sequences are the predominant source of sequence data for a large and taxonomically diverse set of species. these sequences are tremendously valuable for gene discovery, genome annotation, comparative genomics, marker development, and a variety of other uses  <cit> . however, for studies of gene family evolution or for large-scale analyses of gene families, one must contend with the large amount of missing data in alignments derived from partial sequences. for example, of the ≈ <dig>  families in the phytome database  <cit>  for which there are three or more sequences, the average proportion of alignment gaps is 37%.

are these missing data really a problem? we found that it was possible to recover accurate trees from alignments in which the missing residues were clustered into columns. even though half of the simulated alignments had between 50% and 60% missing data, the median stqd for the nj and ml trees were  <dig>  and the median stqd for the mp trees was  <dig> . these results confirm that the presence of missing data itself does not lead to an incorrect phylogeny as long as sufficient data is available for the analysis  <cit> .

however, est-like gappy alignments appear to be qualitatively different. when the same amount of missing data was distributed in a pattern typical of est unigenes, phylogenies were much less accurate: mean stqd for trees computed from these alignments ranged from  <dig>  for ml to  <dig>  for mp. when using nj, the phylogenetic accuracy was even lower for the est-like gappy alignments than for alignments in which the same number of residues were randomly deleted. one explanation for these results is that for the random-deleted alignments, there is at least some overlap between all the pairs of sequences. for the est-like gappy alignments, on the other hand, it is common for some pairs of sequences to share no columns in which data are present , and thus no distance can be computed. this poses particular problems for distance methods. for example, phylip reports a distance of "- <dig> " for any two sequences that do not overlap in the input alignment. this is taken at face value during execution of the nj algorithm, leading to a systematic bias toward overly close relationships between sequences in the tree as a result of the lack of overlap between them. the importance of the distribution, and not just the amount, of missing data, was shown earlier in a different context by wiens  <cit> . in that study, lower accuracy was obtained when missing genes were randomly distributed among the sampled taxa, compared to data sets in which the missing genes were restricted to monophyletic subsets of taxa.

we have shown that one can improve phylogenetic accuracy by taking either one of two diametrically opposed approaches. in the first approach, one excludes gappy columns and sequences from the analysis through alignment masking. in our implementation of masking , we mimic the way it would be performed on real data by also excluding columns and rows that show evidence of misalignment, even though there is no alignment error in our simulation. most of the trees computed from masked alignments using either nj or ml methods were comparable to those computed from alignments without any missing data . even for mp tress, alignment masking was able to improve the trees approximately to the level of unmasked nj trees . while this may be due solely to the removal of gaps, it may also reflect the removal of alignment positions that have undergone multiple substitutions, thus making the phylogenetic signal clearer in those that remain. either way, one cannot escape the paradox that the phylogeny is made more accurate by ignoring error-free alignment input. another important point is that alignment masking comes at the necessary expense of failing to retain all the sequences. on average, 27% of the sequences within an est-like alignment were excluded by masking in our experiments.

a very different approach is to attempt to model the missing data, which we have done through a technique we call alignment subdivision. relative to masking, we found that our implementation of alignment subdivision  was able to retain a much higher proportion of the sequences; the median proportion of retained sequences using sia was 100%. sia generally, though not universally, led to more accurate trees than those computed directly from the gappy alignment. the greatest improvements in accuracy under sia were seen in those families that had many subalignments. where incomplete alignments were divided into  <dig> or more subalignments, sia resulted in a more accurate phylogeny in almost all cases. on the other hand, when there were only two subalignments, the phylogeny computed directly from the original alignment was more accurate two-thirds of the time. perhaps not surprisingly, the number of subalignments was closely associated with the gap pattern used in the simulation. gap patterns  <dig>   <dig>   <dig>  and  <dig> typically resulted in only one to four subalignments, while gap patterns  <dig>   <dig>  and  <dig> typically resulted in a much larger number; thus, certain gap patterns are intrinsically more likely to see an improvement under sia than others.

the improvement in phylogenetic accuracy was generally much higher with masking than with subdivision. nj trees computed from est-like alignments were over 100-fold more accurate with alignment masking  than when directly computed . the same differential was only about two-fold when using sia . the phylogenetic accuracy using sia was thus comparable to the masked mp trees and the unmasked ml trees. furthermore, the sia approach is computationally laborious. taken together, our results suggest that alignment masking is the preferred approach when the distribution of missing data is est-like in nature.

while it appears from our results that alignment masking is not necessary when ml is used to infer the phylogeny, this may reflect the lack of alignment error in the simulated data. although under some circumstances, the choice of phylogenetic inference method is known to have a major effect on phylogenetic accuracy  <cit> , previous studies have shown that both alignment accuracy  <cit>  and the ratio of phylogenetic signal to noise in the alignment  <cit>  can be even more important than the choice of phylogenetic method. while we have not studied the effects of misalignment due to using partial gene sequences as input, we suggest that alignment error is likely to improve the relative performance of masking.

in modeling the missing alignment data, we have estimated the distance matrix that we would expect to see in the absence of missing observations. to further develop and optimize the sia method, other approaches for combining subalignments can be tested in future studies. for example, we have imputed pairwise distances that could not be computed from the submatrices using a four-point metric  <cit> . future implementations of sia could be improved by incorporating a three-point metric or a weighted least-squares imputation  <cit> . however, because only  <dig> % of the cells in the combined matrices were missing, we expect the difference in imputation quality to have only minor effects on the results. alternative approaches that model the missing alignment data probabilistically or by imputation would allow more accurate  phylogenetic techniques to be applied while still retaining all the input sequences. another interesting approach would be to infer phylogenies separately for each subalignment and then calculate a supertree for the full dataset  <cit> .

CONCLUSIONS
given that the vast majority of publicly available sequence data from complex genomes is derived from large-scale partial gene sequencing projects, it would be a serious handicap to limit phylogenetic analyses to alignments derived only from full-length sequences. however, we have shown that the particular pattern of gappiness found in alignments of partial gene sequences needs to be handled with care in order to obtain accurate phylogenies. both masking and model-based approaches to missing data show potential for improving the accuracy of the trees obtained from gappy alignments. their performance will have to be compared to other approaches to deal with incomplete alignments  <cit> . such methods will be critical for the application of techniques that rely upon large numbers of accurate gene trees, as is common in phylogenomics  <cit> .

